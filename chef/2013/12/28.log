[2013-12-28 00:00:34 -0500] flaccid_: coderanger: the .sh has a query mode?
[2013-12-28 00:00:51 -0500] coderanger: No?
[2013-12-28 00:01:04 -0500] coderanger: The omnitruck script just downloads a package and installs it
[2013-12-28 00:02:36 -0500] flaccid_: coderanger: so i built chef-11.8.2_0.arch.3.12.5-1-ARCH.sh but that doesn't actually contain the installation? it still downloads that online?
[2013-12-28 00:03:02 -0500] coderanger: I don't know what that is
[2013-12-28 00:03:12 -0500] coderanger: Is that some kind of self-unpacking installer?
[2013-12-28 00:03:21 -0500] coderanger: What OS are you installing on to?
[2013-12-28 00:04:03 -0500] flaccid_: coderanger: i'm doing from source with https://github.com/opscode/omnibus-chef.git for arch linux
[2013-12-28 00:05:01 -0500] coderanger: I thought pacman just uses tarballs
[2013-12-28 00:05:09 -0500] flaccid_: this isn't pacman
[2013-12-28 00:05:21 -0500] flaccid_: but i am packaging it for pacman thus why i need to confirm this
[2013-12-28 00:05:29 -0500] flaccid_: i guess ./chef-11.8.2_0.arch.3.12.5-1-ARCH.sh --tar tvf
[2013-12-28 00:05:39 -0500] coderanger: What is it then?
[2013-12-28 00:06:01 -0500] flaccid_: what is what?
[2013-12-28 00:06:09 -0500] coderanger: Whats in that script file?
[2013-12-28 00:06:19 -0500] flaccid_: the contents of the embedded tar is not the location where it installs
[2013-12-28 00:06:24 -0500] coderanger: I know omnibus has some bin-blob support for solaris
[2013-12-28 00:06:27 -0500] flaccid_: chef is in the script file
[2013-12-28 00:06:32 -0500] coderanger: But I wouldn't expect you to be using it
[2013-12-28 00:06:52 -0500] flaccid_: well someone has to package omnibus-chef for arch heh, thats what i'm doing
[2013-12-28 00:07:19 -0500] flaccid_: but there isn't a way i can audit all the locations it installs to, of course we know it goes in /opt, but what else..
[2013-12-28 00:07:22 -0500] coderanger: unless its just the default and there is no support for building pacman stuff
[2013-12-28 00:07:43 -0500] coderanger: You should be able to tell fpm (via omnibus) to just give you a simple tarball
[2013-12-28 00:09:04 -0500] coderanger: https://github.com/opscode/omnibus-ruby/blob/629a8ab1abbc35af104457b994850119b2a6c92d/lib/omnibus/project.rb#L403-L418
[2013-12-28 00:09:10 -0500] flaccid_: is that documented? because i just have the readme files in omnibus-chef and omnibus-software to go by
[2013-12-28 00:09:15 -0500] coderanger: That seems to be the thing that determines format
[2013-12-28 00:10:17 -0500] flaccid_: right, so basically there is no support for arch linux platform and pacman in it yet
[2013-12-28 00:11:17 -0500] coderanger: Right, but you just want to call rake projects:chef:tar
[2013-12-28 00:11:24 -0500] coderanger: instead of projects:chef:makeself
[2013-12-28 00:12:29 -0500] flaccid_: a pacman package is a tar.xz though
[2013-12-28 00:12:30 -0500] coderanger: Or just add support for pacman into omnibus :-)
[2013-12-28 00:12:32 -0500] coderanger: That seems easier
[2013-12-28 00:12:42 -0500] coderanger: Right, but you can tar -t then
[2013-12-28 00:12:51 -0500] coderanger: or unpack and repack it
[2013-12-28 00:13:07 -0500] coderanger: I presume pacman packages have some extra metadata in them too
[2013-12-28 00:15:42 -0500] flaccid_: so best is to add support or pacman into omnibus, but for now have it spit out a tar instead of makeself
[2013-12-28 00:15:57 -0500] coderanger: Probably how I would proceed
[2013-12-28 00:16:05 -0500] flaccid_: how can i do that if i build it using CHEF_GIT_REV=11.8.2 bundle exec omnibus build project chef ?
[2013-12-28 00:21:47 -0500] coderanger: flaccid_: in #package_types, add when 'arch' [ 'tar' ]
[2013-12-28 00:22:12 -0500] flaccid_: oh there is no cli param?
[2013-12-28 00:22:15 -0500] coderanger: No
[2013-12-28 00:22:31 -0500] coderanger: When you said you are adding arch support, I presume that meant you were hacking on omnibus
[2013-12-28 00:23:40 -0500] flaccid_: well, i'll leave that for another day. atm can just do work to get https://github.com/opscode/omnibus-chef#usage working which i can package
[2013-12-28 00:25:57 -0500] flaccid_: doing when 'arch' [ 'tar' ] would only be a workaround for now and require source editing which wouldn't be permanent. better to stive for when 'arch' [ 'pacman' ] or what not
[2013-12-28 00:26:17 -0500] coderanger: Depends on how far down the stack you want to go, but sure
[2013-12-28 00:26:38 -0500] coderanger: you could either have fpm make a tar.gz and then fix it up in omnibus
[2013-12-28 00:26:45 -0500] coderanger: or have fpm spit out the relevant package
[2013-12-28 00:28:41 -0500] coderanger: Also source editing is plenty permanent when you submit a patch :P
[2013-12-28 00:30:08 -0500] flaccid_: yes but no point just editing it to give tar. because i can just use the makeself with https://wiki.archlinux.org/index.php/DeveloperWiki:Building_in_a_Clean_Chroot but it would be nice to know what it actually installs, the files in the embedded tar (tar tvf) are not the relative locations it installs to
[2013-12-28 00:34:39 -0500] flaccid_: appreciate the help coderanger, what i'll do is work my way through the various different options starting with using the makeself because we are waiting for a pr already thus needing to use a fork https://wiki.archlinux.org/index.php/Chef and i have one more pr to do which is to build with no-tcl and no-tk
[2013-12-28 06:43:27 -0500] brucelee: sadf
[2013-12-28 06:44:15 -0500] brucelee: im trying to make a change to my cookbook and updating it to the chef server using berkshelf, but failing
[2013-12-28 06:44:32 -0500] brucelee: first i change the default.rb file within the cookbook, and then i do berks update <cookbookname>
[2013-12-28 06:44:36 -0500] brucelee: then berks upload
[2013-12-28 06:44:49 -0500] brucelee: but when i view it within the chef server WEB UI, the change isnt reflected
[2013-12-28 06:46:25 -0500] coderanger: brandont: bump the version
[2013-12-28 06:46:28 -0500] coderanger: er, brucelee ^^
[2013-12-28 06:46:30 -0500] coderanger: (mistab)
[2013-12-28 06:46:49 -0500] coderanger: brucelee: By default berkshelf freezes uploads, meaning you can't upload over that version again
[2013-12-28 06:47:32 -0500] brucelee: coderanger: :P
[2013-12-28 06:47:38 -0500] brucelee: coderanger: ohh
[2013-12-28 06:47:48 -0500] brucelee: coderanger: what if you need to make a change to that cookbook?
[2013-12-28 06:47:54 -0500] coderanger: Don't?
[2013-12-28 06:47:57 -0500] coderanger: I mean there is a force option
[2013-12-28 06:48:15 -0500] coderanger: But don't use it unless something is holyshitballsonfire
[2013-12-28 06:48:29 -0500] coderanger: Pushing a cookbook to the chef server is releasing a version of it
[2013-12-28 06:48:35 -0500] brucelee: coderanger: im new to chef, but modifying cookbooks is a standard thing right?
[2013-12-28 06:48:39 -0500] coderanger: No
[2013-12-28 06:48:54 -0500] coderanger: Develop locally with vagrant, pushing to the server is a release event
[2013-12-28 06:49:01 -0500] coderanger: and should have a git tag, etc
[2013-12-28 06:49:02 -0500] brucelee: coderanger: ahhh
[2013-12-28 06:49:08 -0500] brucelee: coderanger: i see
[2013-12-28 06:49:21 -0500] coderanger: the chef server is an artifact repository, just like an apt repo, yum repo, nexus, etc
[2013-12-28 06:49:43 -0500] coderanger: (in fact thats about all I use it for at this point)
[2013-12-28 06:50:05 -0500] brucelee: coderanger: im testing my changes by actually pushing to the server, but my server is just a test environment
[2013-12-28 06:50:24 -0500] coderanger: Yeah, don't do that :)
[2013-12-28 06:50:37 -0500] brucelee: coderanger: 'artifact' repo, where artifact is mostly cookbooks right?
[2013-12-28 06:50:42 -0500] coderanger: Yes
[2013-12-28 06:50:44 -0500] brucelee: coderanger: :D
[2013-12-28 06:50:54 -0500] brucelee: coderanger: ok nice to know that
[2013-12-28 06:51:08 -0500] brucelee: coderanger: im basically pushing to a vmware workstation vm
[2013-12-28 06:51:14 -0500] coderanger: Otherwise tracking what versions of what cookbooks are on the server is a nightmare
[2013-12-28 06:51:14 -0500] brucelee: doesnt vagrant do pretty much the same thing, except with virtualbox
[2013-12-28 06:51:40 -0500] coderanger: https://github.com/nsidc/vagrant-vsphere
[2013-12-28 06:51:51 -0500] brucelee: using vmware workstation :D
[2013-12-28 06:52:01 -0500] coderanger: Oh, there is a plugin but you have to pay for it
[2013-12-28 06:52:06 -0500] coderanger: (worth it)
[2013-12-28 06:52:06 -0500] brucelee: ah
[2013-12-28 06:52:16 -0500] brucelee: ill probably look into it
[2013-12-28 06:52:25 -0500] coderanger: http://www.vagrantup.com/vmware
[2013-12-28 06:52:35 -0500] coderanger: Otherwise you can test using knife solo perhaps
[2013-12-28 06:53:43 -0500] brucelee: i guess for testing purchases now, ill just up the version of the cookbook
[2013-12-28 06:54:00 -0500] brucelee: im not sure if the cookbooks are actually committed into git
[2013-12-28 06:54:06 -0500] coderanger: You can give --no-freeze to berks upload
[2013-12-28 06:54:16 -0500] coderanger: but this _will_ bite you eventually, I promise you
[2013-12-28 06:54:32 -0500] coderanger: "wait, why is that dev version of the cookbook deploying to prod"
[2013-12-28 06:58:13 -0500] brucelee: lol
[2013-12-28 06:58:23 -0500] brucelee: can totally see that
[2013-12-28 06:58:34 -0500] brucelee: but im just trying to learn chef now though, whats the most common way to do that?
[2013-12-28 06:58:38 -0500] brucelee: with vagrant right?
[2013-12-28 06:58:58 -0500] coderanger: To do what?
[2013-12-28 06:59:01 -0500] brucelee: trying to make changes to cookbooks, deploy... see if it works, and if it doesnt, then just change the cookbook, redeploy
[2013-12-28 06:59:14 -0500] coderanger: vagrant + chef solo (or now chef zero)
[2013-12-28 06:59:14 -0500] brucelee: for example, i have a java cookbook downloaded straight from cookbook.opscode.com
[2013-12-28 06:59:23 -0500] brucelee: i see
[2013-12-28 07:06:40 -0500] brucelee: maybe ill just use vagrant with vsphere, is that free?
[2013-12-28 07:06:52 -0500] coderanger: Yes
[2013-12-28 07:06:54 -0500] brucelee: nice
[2013-12-28 07:07:01 -0500] brucelee: ill just use that then
[2013-12-28 07:07:07 -0500] brucelee: trying to wrap my head around using all these new tools
[2013-12-28 07:07:12 -0500] brucelee: knife, berkshelf, now vagrant :)
[2013-12-28 07:07:25 -0500] brucelee: trying to get an oracle jdk cookbook running
[2013-12-28 07:07:41 -0500] flaccid: good ol closed sourced/prop stuff made usable by open source
[2013-12-28 07:07:48 -0500] brucelee: by default it installs openjdk, whcih i found out after doing a berks upload, and realizing i had to change a flag to make it by default install oracle :p
[2013-12-28 07:08:32 -0500] brucelee: ive never used git either, so i guess add that to the list :p
[2013-12-28 07:08:41 -0500] brucelee: im not sure how to bump the version of the java cookbook
[2013-12-28 07:08:46 -0500] coderanger: Yeah, that was because for a while the cookbook couldn't legally install oracle jdk
[2013-12-28 07:08:57 -0500] brucelee: coderanger: yeah, its so awesome that it can now
[2013-12-28 07:08:59 -0500] brucelee: cant wait to get it to work
[2013-12-28 07:09:07 -0500] coderanger: brucelee: Were you editing the java cookbook directly?
[2013-12-28 07:09:11 -0500] brucelee: yeah
[2013-12-28 07:09:16 -0500] brucelee: coderanger: yes
[2013-12-28 07:09:19 -0500] coderanger: Oh, thats another thing to not do :-)
[2013-12-28 07:09:25 -0500] coderanger: Just pull it in via berkshelf :)
[2013-12-28 07:09:34 -0500] coderanger: make a wrapper cookbook named <yourcompany>-java
[2013-12-28 07:09:40 -0500] coderanger: and put your specializations in there
[2013-12-28 07:09:41 -0500] brucelee: ohh
[2013-12-28 07:09:49 -0500] coderanger: and then have it depend on the java cookbook
[2013-12-28 07:10:19 -0500] flaccid: why would you need to do that to install java?
[2013-12-28 07:10:42 -0500] brucelee: why would i need to do what to install java?
[2013-12-28 07:10:49 -0500] brucelee: make a wrapper cookbook?
[2013-12-28 07:10:57 -0500] flaccid: yeah
[2013-12-28 07:11:10 -0500] coderanger: flaccid: To change the default install type from openjdk to oracle
[2013-12-28 07:11:14 -0500] brucelee: i uploaded the cookbook using berkshelf and then realized i needed to make a change
[2013-12-28 07:11:35 -0500] flaccid: coderanger: can't you just do that with changing the node attribute?
[2013-12-28 07:11:58 -0500] coderanger: flaccid: Yes, and you do that with a wrapper cookbook
[2013-12-28 07:12:17 -0500] brucelee: oh, so overwrite the changes of the node attribute using the wrapper cookbook
[2013-12-28 07:12:19 -0500] brucelee: i see
[2013-12-28 07:12:27 -0500] coderanger: brucelee: One sec, I'll find you an example
[2013-12-28 07:12:29 -0500] brucelee: and then just create a new wrapper cookbooks
[2013-12-28 07:12:38 -0500] brucelee: for additional changes? :P
[2013-12-28 07:12:42 -0500] flaccid: coderanger: i'm not a fan of writing a wrapper cookbook just to change the value of a node attribute
[2013-12-28 07:12:48 -0500] coderanger: brucelee: https://github.com/balanced-cookbooks/balanced-citadel/blob/master/attributes/default.rb
[2013-12-28 07:12:52 -0500] brucelee: flaccid: what do you usually do?
[2013-12-28 07:12:58 -0500] coderanger: flaccid: Then your opinions are incorrect, sorry :D
[2013-12-28 07:13:00 -0500] brucelee: coderanger: thanks :p
[2013-12-28 07:13:15 -0500] coderanger: brucelee: So thats overriding a setting from the citadel cookbook, but same idea
[2013-12-28 07:13:18 -0500] flaccid: coderanger: how are they incorrect? you can set node attributes without doing another un-needed cookbook
[2013-12-28 07:14:05 -0500] coderanger: flaccid: Because the other ways to set attrs are roles (avoid due to versioning issues), node.set (which means special snowflakes, avoid) and chef envs (and this isn't an env-specific change)
[2013-12-28 07:14:34 -0500] flaccid: coderanger: roles are good or a plain old node.json
[2013-12-28 07:14:53 -0500] coderanger: flaccid: roles are bad, and node.json is node.set, you are doing it one node at a time and thats Wrong
[2013-12-28 07:15:29 -0500] flaccid: there is a severe issue with chef if roles are bad.
[2013-12-28 07:15:43 -0500] coderanger: flaccid: Yes, welcome to the current state of chef dev :)
[2013-12-28 07:15:52 -0500] coderanger: The fix will likely be in Chef 12
[2013-12-28 07:15:57 -0500] flaccid: wow
[2013-12-28 07:15:59 -0500] coderanger: (making roles versioned)
[2013-12-28 07:16:33 -0500] flaccid: need to set a node attribute value? create a cookbook <-- ridiculous
[2013-12-28 07:16:39 -0500] coderanger: ::shrug::
[2013-12-28 07:16:48 -0500] coderanger: Making a cookbook is like 4 commands
[2013-12-28 07:16:49 -0500] flaccid: its the truth
[2013-12-28 07:17:03 -0500] flaccid: thats not the point, the point is you have to make a cookbook to use a cookbook
[2013-12-28 07:17:09 -0500] coderanger: berks init, edit attributes/default.rb, write a test, release
[2013-12-28 07:17:25 -0500] coderanger: Whats wrong with cookbooks?
[2013-12-28 07:17:44 -0500] flaccid: i don't need another car to drive the car i already have
[2013-12-28 07:18:22 -0500] coderanger: flaccid: Writing reusable cookbooks is Hard, we (for some value of we) have found the library/application/wrapper split works out pretty well
[2013-12-28 07:18:37 -0500] coderanger: If you have a better model, I would love to read the blog post and/or code :D
[2013-12-28 07:19:17 -0500] brucelee: i think flaccid is talking about doing what im tryin gto do right?
[2013-12-28 07:19:35 -0500] brucelee: im trying to change a node attribute value in attribute/default.rb :p
[2013-12-28 07:20:02 -0500] brucelee: flaccid: the other way is to bump the version of the cookbook
[2013-12-28 07:20:24 -0500] brucelee: is bumpoing the version of the cookbook a worst way of changing the node value
[2013-12-28 07:20:51 -0500] coderanger: brucelee: No, editing of an upstream cookbook is always bad
[2013-12-28 07:21:01 -0500] coderanger: He is saying to use a chef role instead of a wrapper cookbook
[2013-12-28 07:22:12 -0500] coderanger: Which you can do, but I can't recommend it as roles have a few painful flaws right now and while writing a wrapper cookbook is more verbose, it is also easier to work with in the long term
[2013-12-28 07:27:26 -0500] brucelee: coderanger: ok
[2013-12-28 07:27:48 -0500] brucelee: coderanger: so when you need to make changes to a cookbook, the best way is to bump the version right?
[2013-12-28 07:28:12 -0500] coderanger: Yes, and don't edit upstream cookbooks under (almost) any circumstance
[2013-12-28 07:28:24 -0500] coderanger: Doing so is equivalent to forking a dependent library
[2013-12-28 07:28:36 -0500] coderanger: and should be done with exactly as much concern for maintenance
[2013-12-28 07:29:09 -0500] brucelee: coderanger: editting an upstream cookbook is changing the cookbook without upping the version right?
[2013-12-28 07:29:29 -0500] coderanger: No, as in editing it at all
[2013-12-28 07:29:32 -0500] brucelee: oh
[2013-12-28 07:29:43 -0500] brucelee: so if a change is needed on the cookbook
[2013-12-28 07:29:50 -0500] brucelee: do i rename the cookbook then?
[2013-12-28 07:29:55 -0500] brucelee: create a copy of it, and rename it?
[2013-12-28 07:30:07 -0500] coderanger: Just like with dependency libs in any other software, you don't edit them, and you fork only as a last resort
[2013-12-28 07:30:08 -0500] brucelee: kind of confused now :P
[2013-12-28 07:30:17 -0500] coderanger: if fixes are needed, submit them back upstream
[2013-12-28 07:30:28 -0500] coderanger: and switch off your fork as soon as they are merged
[2013-12-28 07:31:08 -0500] brucelee: im not a dev, but i think i know what youre saying
[2013-12-28 07:31:16 -0500] brucelee: so how do you update that library?
[2013-12-28 07:31:23 -0500] brucelee: like fixing a bug
[2013-12-28 07:32:24 -0500] flaccid: coderanger: i don't think writing reusable cookbooks has much to do with it. its the equiv of wanting to set a variable
[2013-12-28 07:32:27 -0500] coderanger: When needed, fork the cookbook on github, use berkshelf to look at your copy via "cookbook 'java', github: 'yourname/java'"
[2013-12-28 07:32:38 -0500] coderanger: and then when the patch is ready, submit a pull request
[2013-12-28 07:32:58 -0500] coderanger: and once merged, remove the line from your berksfile
[2013-12-28 07:33:25 -0500] flaccid: brucelee: coderanger is saying to create a cookbook to effectively control the cookbook
[2013-12-28 07:34:02 -0500] coderanger: Indeed
[2013-12-28 07:34:36 -0500] flaccid: coderanger: of course i don't have to create a wrapper cookbook to set a node attribute when i use rightscale :)
[2013-12-28 07:35:43 -0500] coderanger: Rightscale has their own control backplane, so many of the issues with chef-server don't apply
[2013-12-28 07:35:59 -0500] coderanger: Ditto with Opsworks
[2013-12-28 07:36:41 -0500] brucelee: :p
[2013-12-28 07:36:59 -0500] brucelee: so in the event where i want to change all of the java installations on all the servers
[2013-12-28 07:37:18 -0500] brucelee: the way to go about it is not to change the java cookbook, upload the new cookbook
[2013-12-28 07:37:31 -0500] coderanger: Correct, you make a wrapper cookbook
[2013-12-28 07:37:38 -0500] coderanger: and apply needed changes there
[2013-12-28 07:37:43 -0500] brucelee: ahh
[2013-12-28 07:37:50 -0500] brucelee: ok
[2013-12-28 07:38:01 -0500] brucelee: i see
[2013-12-28 07:38:39 -0500] brucelee: b
[2013-12-28 07:38:48 -0500] brucelee: clear
[2013-12-28 07:39:03 -0500] brucelee: for a second my computer just went completely blank
[2013-12-28 07:43:22 -0500] flaccid: coderanger: indeed
[2013-12-28 07:53:41 -0500] brucelee: coderanger: do you recommend using wrapper cookbooks for the following use case: new app is released, and gets released every week. so i would create a new cookbook which depends on the previous version and just overwrite node attributes? but what if there are some node attributes that are present in the older one that are no longer needed?
[2013-12-28 07:54:04 -0500] coderanger: brucelee: You mean create a new cookbook every week?
[2013-12-28 07:54:06 -0500] flaccid: brucelee: you update your wrapper cookbook, not create another one
[2013-12-28 07:54:09 -0500] brucelee: would the new wrapper cookbook need to be created in a way that undos all the unneeded changes of the old cookbook
[2013-12-28 07:54:10 -0500] coderanger: Yeah
[2013-12-28 07:54:20 -0500] coderanger: You just make a new version of the wrapper cookbook
[2013-12-28 07:54:35 -0500] brucelee: ohhh
[2013-12-28 07:54:41 -0500] brucelee: so you just dont change the cookbooks that i download
[2013-12-28 07:54:59 -0500] coderanger: Right, upstream cookbooks you didn't write shouldn't be edited is all
[2013-12-28 07:55:05 -0500] brucelee: oh ok
[2013-12-28 07:55:08 -0500] coderanger: Those are just pulled in via berkshelf a la maven
[2013-12-28 07:55:38 -0500] brucelee: i see
[2013-12-28 07:55:39 -0500] brucelee: :D
[2013-12-28 07:55:42 -0500] brucelee: makes a lot more sense now
[2013-12-28 08:56:53 -0500] twoSeats: hi all, i tried asking on #learnchef but didn't get a response. trying to find out if it's possible to provision nginx with ngx_pagespeed. can anyone point me to a tutorial? (or is this even possible? i don't see the module in the opscode nginx cookbook)
[2013-12-28 09:07:42 -0500] coderanger: twoSeats: Sure, you just have to make a recipe that handles getting the code in place
[2013-12-28 09:08:04 -0500] coderanger: and set [nginx][source][modules]
[2013-12-28 09:08:14 -0500] coderanger: https://github.com/opscode-cookbooks/nginx/blob/master/recipes/source.rb#L90-L92
[2013-12-28 09:09:26 -0500] coderanger: twoSeats: See https://github.com/opscode-cookbooks/nginx/blob/master/recipes/ngx_lua_module.rb for an example
[2013-12-28 09:28:13 -0500] twoSeats: thanks coderanger i'll have a look
[2013-12-28 11:22:19 -0500] prognostikos: how can I get access to a provider like e.g. s3_file from within one of the files executed by the deploy cookbook callback (before_symlink)? include_recipe "s3_file" in the callback doesn't seem to work
[2013-12-28 13:35:27 -0500] flaccid: how do i add the omnibus gems to my user env so i can use knife and such without sudo?
[2013-12-28 14:34:39 -0500] soergener: Hello. Knife bootstrap windows winrm localhost -x administrator -P "..." returns failed authenticate to ["localhost"] as administrator. Bad HTTP response 401
[2013-12-28 17:23:11 -0500] coderanger: flaccid: Just add /opt/chef/bin to your path
[2013-12-28 17:25:48 -0500] stormerider: coderanger: don't you also need /opt/chef/embedded/bin, or has that changed with 11.8?
[2013-12-28 17:26:16 -0500] coderanger: stormerider: Thats only if you are doing Weird Things
[2013-12-28 17:26:37 -0500] stormerider: i know with 11.6 gem was under embedded/bin
[2013-12-28 17:26:41 -0500] coderanger: bin/ has just the public chef binaries like knife, chef-client, etc. embedded/bin has the stuff like gem and irb
[2013-12-28 17:26:52 -0500] coderanger: Yeah, you shouldn't generally be calling that :P
[2013-12-28 17:28:34 -0500] stormerider: yeah, i did that for a while until i gave up on the osx ruby and switched to using ruby from homebrew instead, but my workstation wasnt a client
[2013-12-28 18:00:11 -0500] coderanger: stormerider: Yeah, I install as a gem for all my workstation usage
[2013-12-28 18:15:08 -0500] prognostikos: how can I get access to a provider like e.g. s3_file from within one of the files executed by the before_symlink callback from the deploy cookbook? it's complaining that the provider doesn't exist, and include_recipe "s3_file" doesn't work
[2013-12-28 18:18:13 -0500] coderanger: prognostikos: To access a cookbook's providers, all you need is a depends line in your metadata.rb, no include_recipe
[2013-12-28 18:20:52 -0500] prognostikos: coderanger: thanks. what if I'm not in the context of one of my own cookbooks? this is opsworks, running the callbacks from their deploy cookbook, from my app repo
[2013-12-28 18:21:15 -0500] coderanger: I'm not very familiar with opsworks, sorry
[2013-12-28 18:21:47 -0500] coderanger: Can you expand "context of one of my own cookbooks"?
[2013-12-28 18:24:29 -0500] prognostikos: opsworks uses the deploy cookbook, which executes e.g. a deploy/before_symlink.rb file at the top level of the application being deployed. (not sure if that's standard for the deploy cookbook or an opsworks thing). Since it's done by the deploy cookbook, there's no metadata.rb to add the depends statement
[2013-12-28 18:24:57 -0500] prognostikos: well there is, but I can't edit it
[2013-12-28 18:25:56 -0500] coderanger: Just add a stub cookbook to your run list that has a blank recipe and depends on the s3 cookbook then
[2013-12-28 18:26:01 -0500] coderanger: Its a hack, but it should work
[2013-12-28 18:26:14 -0500] coderanger: In related news, the more I learn about Opsworks, the more I dislike it :P
[2013-12-28 18:27:12 -0500] prognostikos: yeah, i'm not entirely convinced either - was just tring to save maintaining another server but it's been more of a pain to get started with than I'd anticipated
[2013-12-28 18:48:30 -0500] someara: If you're just trying to get a single machine set up on ec2, kitchen-ec2 is shockingly easy
[2013-12-28 19:05:40 -0500] AntelopeSalad: someara: what are the benefits of using that over something like knife-ec2?
[2013-12-28 19:06:07 -0500] someara: slightly different use cases
[2013-12-28 19:06:23 -0500] someara: test-kitchen is mostly used for testing as one would guess =)
[2013-12-28 19:07:07 -0500] AntelopeSalad: oh
[2013-12-28 19:07:08 -0500] someara: so you ship a .kitchen.yml in your individually maintained cookbook scm repository, and do "kitchen test"
[2013-12-28 19:07:23 -0500] someara: which will spin up various machines and tear them down
[2013-12-28 19:07:37 -0500] someara: but really theres nothing stopping you from just doing "kitchen converge" and leaving them there
[2013-12-28 19:07:58 -0500] AntelopeSalad: i have not gotten into using kitchen yet
[2013-12-28 19:08:03 -0500] someara: plus it promotes the application cookbook pattern over the old school chef-repo+messy ass run_list pattern
[2013-12-28 19:08:19 -0500] someara: berks is integrated, etc etc
[2013-12-28 19:08:37 -0500] someara: test-kitchen is pretty badass
[2013-12-28 19:08:42 -0500] someara: I use it every day
[2013-12-28 19:08:53 -0500] someara: but then again all I do is work on cookbooks, I don't actually run anything in real life =)
[2013-12-28 19:09:26 -0500] AntelopeSalad: it's too bad that opscode webinar didn't cover berkshelf
[2013-12-28 19:10:14 -0500] someara: berks was a community tool that we're just now adopting "for real"
[2013-12-28 19:10:24 -0500] someara: there's a lot of momentum behind the old ways
[2013-12-28 19:10:28 -0500] coderanger: AntelopeSalad: Learnchef does cover it a little
[2013-12-28 19:10:54 -0500] AntelopeSalad: because right now i watched all 6 videos and it uses the "old" chef-repo way with run lists and manually dealing with dependencies
[2013-12-28 19:12:31 -0500] darron: Is there a better way to tell if I'm not running on AWS thank looking for node.ec2?
[2013-12-28 19:12:38 -0500] AntelopeSalad: coderanger: i didn't see any coverage in that series
[2013-12-28 19:12:59 -0500] darron: should be /thank/than
[2013-12-28 19:13:02 -0500] AntelopeSalad: the only thing that happpened was the starter kit created a berksfile that was never used in the series
[2013-12-28 19:13:38 -0500] someara: right now, most people develop their own cookbooks because they pretty much have to.... the chef-repo is arguably easier for (a certain set of) people to grok while getting started and maintaining their own "java" cookbooks and such
[2013-12-28 19:14:17 -0500] someara: the berks style places heavy emphasis on "doing it right" and artifacting cookbooks
[2013-12-28 19:14:21 -0500] AntelopeSalad: right now after the series i have this mentality that i should be always inside of the chef-repo dir and put everything there, even if it's across multiple "apps"
[2013-12-28 19:14:37 -0500] someara: right now the defacto artifact repo is the community site
[2013-12-28 19:14:57 -0500] someara: which contains a "variety of quality"
[2013-12-28 19:15:29 -0500] AntelopeSalad: the artifact-cookbook on riot's repo?
[2013-12-28 19:15:36 -0500] someara: no thats something different
[2013-12-28 19:15:58 -0500] someara: once upon a time, the idea was that a "chef-repo" should be the artifact
[2013-12-28 19:16:16 -0500] someara: one chef-repo maps to one chef-server API endpoint, and its all under version control
[2013-12-28 19:16:17 -0500] AntelopeSalad: the word artifact is foreign to me in a chef context
[2013-12-28 19:16:19 -0500] someara: cookbooks, databags, and all
[2013-12-28 19:16:27 -0500] AntelopeSalad: do you mean it's some isolated thing?
[2013-12-28 19:16:30 -0500] someara: yep
[2013-12-28 19:16:39 -0500] someara: one managed and "released" thing
[2013-12-28 19:17:00 -0500] AntelopeSalad: yeah that makes more sense to me from a developer POV
[2013-12-28 19:17:07 -0500] someara: turns out, its better practice to isolate each cookbook into an individual repository
[2013-12-28 19:17:22 -0500] someara: and artifact (tag and release) those individually
[2013-12-28 19:17:26 -0500] AntelopeSalad: to have a "foo" directroy and inside of this foo directroy could have a /chef and /app folders, etc.. everything would be self contained
[2013-12-28 19:17:32 -0500] someara: with meaningful metadata and dependency information
[2013-12-28 19:18:08 -0500] AntelopeSalad: ok
[2013-12-28 19:18:16 -0500] someara: so now you can do
[2013-12-28 19:18:24 -0500] AntelopeSalad: so i should forget basically everything i learned from the webinar and try to find tutorials on using berkshelf?
[2013-12-28 19:18:35 -0500] someara: git clone somecookbook ; cd somecookbook ; kitchen converge
[2013-12-28 19:18:55 -0500] someara: and berks will pull deps via metadata just like bundler
[2013-12-28 19:19:23 -0500] someara: the honest answer is.... its depends on exactly what your use case and situation
[2013-12-28 19:19:27 -0500] someara: unfortunately
[2013-12-28 19:19:41 -0500] darron: This is a pretty good tutorial that uses Test Kitchen, Berkshelf, etc - http://kitchen.ci/docs/getting-started/ - was great for me.
[2013-12-28 19:19:48 -0500] AntelopeSalad: i'm a developer looking to ungimp my deployment process
[2013-12-28 19:20:04 -0500] someara: if you have a team of programmers, and you're on the cloud without insane network restrictions.. then I'd go with the berks stuff
[2013-12-28 19:20:14 -0500] someara: if you understand git and bundler... do the berks thing
[2013-12-28 19:20:21 -0500] AntelopeSalad: after going through the webinar it gave me enough knowledge to get comfy using hosted chef, setting up my dev machine and deploying simple nodes, etc.
[2013-12-28 19:20:40 -0500] someara: if you're in an "enterprise" kind of situation, then it may be better to go chef-repo until the kinks are shaken out
[2013-12-28 19:20:57 -0500] AntelopeSalad: i'm just freelancing 1-3 server deploys for multiple clients
[2013-12-28 19:21:07 -0500] someara: go berks
[2013-12-28 19:21:45 -0500] AntelopeSalad: darron: thanks, i'll look into this
[2013-12-28 19:22:06 -0500] AntelopeSalad: i totally understand what berkshelf is trying to do, i am just not sure how it all falls together
[2013-12-28 19:22:15 -0500] darron: And yeah - once you get used to the multiple cookbooks berkshelf way - you won't want to go back.
[2013-12-28 19:22:18 -0500] someara: also, I'm (very slowly) trying to make "model" cookbooks for people to pattern-copy
[2013-12-28 19:22:31 -0500] AntelopeSalad: this guide looks like it'll be great, lots of things to read makes me happy
[2013-12-28 19:22:44 -0500] someara: so, here's the yum cookbook, complete with tests of various kinds:
[2013-12-28 19:22:45 -0500] someara: https://github.com/opscode-cookbooks/yum
[2013-12-28 19:23:13 -0500] someara: and here's yum-epel, which uses yum as a library
[2013-12-28 19:23:14 -0500] someara: https://github.com/opscode-cookbooks/yum-epel
[2013-12-28 19:23:43 -0500] AntelopeSalad: what were you saying before about not being able to use the community page for cookbooks?
[2013-12-28 19:23:48 -0500] AntelopeSalad: do they not play well with berkshelf?
[2013-12-28 19:23:51 -0500] someara: and in your applicaiton cookbook that needs a package from epel, you would depend on yum-epel in your metadata.rb, include_recipe "yum-epel" in a recipe before a package resource, and let berkshelf sort it out
[2013-12-28 19:24:11 -0500] someara: no they don't play well with The Enterprise (yet)
[2013-12-28 19:24:27 -0500] AntelopeSalad: i was under the impression that berkshelf just took a bunch of cookbooks and handled annoying issues like dependencies and also giving you a single file that tells you exactly what books are being used
[2013-12-28 19:24:37 -0500] AntelopeSalad: identical to a gemfile
[2013-12-28 19:24:41 -0500] someara: a lof of them make assumptions that they shouldnt
[2013-12-28 19:24:52 -0500] AntelopeSalad: and bundler
[2013-12-28 19:24:54 -0500] someara: yea so berkshelf was designed to be "bundler for chef"
[2013-12-28 19:25:38 -0500] AntelopeSalad: what makes them not work properly for the enterprise?
[2013-12-28 19:25:53 -0500] someara: ruby : rubygems :: chef : community-site :: bundler :: berkshelf
[2013-12-28 19:26:06 -0500] darron: Here's a dead simple application cookbook that includes a bunch of other cookbooks - https://github.com/octohost/octohost-cookbook - was built after I did that tutorial
[2013-12-28 19:26:15 -0500] darron: Using Berkshelf, TK, etc.
[2013-12-28 19:26:23 -0500] zenloop: hey does chef solo with with the search databags function?
[2013-12-28 19:26:41 -0500] AntelopeSalad: darron: nice, i'll bookmark for after i read the guide
[2013-12-28 19:26:44 -0500] AntelopeSalad: *that
[2013-12-28 19:26:52 -0500] someara: AntelopeSalad very often in "enterprise" situations, you have dumb rules like "you can only write into /opt"
[2013-12-28 19:27:05 -0500] zenloop: Do I have to manually iterate through the databag items instead of using the search function (for chef-solo)?
[2013-12-28 19:27:06 -0500] someara: or "you cant be root" which means you cant install packages normally
[2013-12-28 19:27:09 -0500] someara: that kinda crap
[2013-12-28 19:27:34 -0500] AntelopeSalad: darron: does this octohost repo handle what the chef-repo/starter kit does for authentication?
[2013-12-28 19:27:50 -0500] AntelopeSalad: someara: oh
[2013-12-28 19:27:56 -0500] someara: or you have to use some crpyto-patched version of java installed from an internal web server and distributed as a tarball
[2013-12-28 19:28:08 -0500] AntelopeSalad: so the real problem isn't the cookbook structure, it's just the rules the authors used?
[2013-12-28 19:28:14 -0500] someara: right
[2013-12-28 19:28:17 -0500] darron: No - it's just an application cookbook that brings a bunch of other cookbooks in (using Berkshelf) to install a single application
[2013-12-28 19:28:31 -0500] darron: It's just a model to look at - not a starter kit
[2013-12-28 19:28:53 -0500] AntelopeSalad: would we even use the starter kit supplied by opscode anymore when using berkshelf?
[2013-12-28 19:29:05 -0500] darron: I don't think so.
[2013-12-28 19:29:33 -0500] darron: I have my own - https://github.com/darron/skeleton-cookbook - which was forked from https://github.com/mlafeldt/skeleton-cookbook
[2013-12-28 19:29:43 -0500] darron: That's for an individual cookbook.
[2013-12-28 19:30:03 -0500] someara: if you've used the started kit and understand what'd going on well enough to be in here asking these kinds of questions, I'd consider you "started" ;)
[2013-12-28 19:30:30 -0500] AntelopeSalad: sort of, i haven't done anything beyond toy examples
[2013-12-28 19:30:31 -0500] coderanger: zenloop: There is a cookbook that monkey patches it in, but just use chef-zero or chef-client local mode
[2013-12-28 19:30:49 -0500] AntelopeSalad: to me the starter kit is just a github repo but it contains a few things i'm not 100% sure on
[2013-12-28 19:30:55 -0500] AntelopeSalad: *git repo
[2013-12-28 19:31:29 -0500] someara: so the big "learning curve" everyone loves to talk about is recipes as policy... a resource statement runs to repair the state of a machine
[2013-12-28 19:31:31 -0500] AntelopeSalad: for instance i have no idea how i would manage this berkshelf way with knife
[2013-12-28 19:31:34 -0500] someara: and can be applied repeately
[2013-12-28 19:31:44 -0500] someara: multiple resources make a recipe with intent
[2013-12-28 19:31:52 -0500] someara: and you apply that policy over and over
[2013-12-28 19:32:17 -0500] someara: this is contrasted with the classic "log in and manually manipulate a state machine with your fingers" method that people have been using for the past 20 years
[2013-12-28 19:32:43 -0500] AntelopeSalad: i haven't gotten into that too much but it doesn't seem too bad to take in
[2013-12-28 19:33:25 -0500] AntelopeSalad: if chef-client runs at some interval and all it does is sync cookbooks/policies/etc., then it would make less sense if it didn't repair the machine in the process of doing that?
[2013-12-28 19:37:04 -0500] AntelopeSalad: darron: i'm looking at your octohost example now, i noticed you have a metadata file with the dependencies for each cookbook you use
[2013-12-28 19:37:04 -0500] someara: it can run at an interval, or you can trigger it "manually"
[2013-12-28 19:37:42 -0500] AntelopeSalad: yeah
[2013-12-28 19:38:06 -0500] someara: all this tooling around manipulating cookbooks and recipes has been moving very fast over the past year or two
[2013-12-28 19:38:07 -0500] AntelopeSalad: i've been doing it manually for now but at the end of the webinar series they introduced the chef-client cookbook that sets it up to run as a cronjob
[2013-12-28 19:38:12 -0500] someara: and is coming together very nicely
[2013-12-28 19:38:43 -0500] AntelopeSalad: i guess the part i'm stuck on is how tie this into the starter kit
[2013-12-28 19:38:46 -0500] AntelopeSalad: *how to
[2013-12-28 19:39:32 -0500] AntelopeSalad: going back to his repo https://github.com/octohost/octohost-cookbook it seems like all this contains is a list of dependencies managed by berkshelf
[2013-12-28 19:41:06 -0500] someara: brb
[2013-12-28 19:41:22 -0500] coderanger: AntelopeSalad: The starter kit isn't used it you go full berkshelf
[2013-12-28 19:41:30 -0500] coderanger: other than to grab the knife config from it
[2013-12-28 19:41:48 -0500] AntelopeSalad: my brain still sees the starter kit as "the thing that auths me with hosted chef and gets me going with knife"
[2013-12-28 19:42:47 -0500] AntelopeSalad: i noticed in his repo the build task just calls berks install
[2013-12-28 19:42:59 -0500] coderanger: AntelopeSalad: It is, just ignore the other stuff in it
[2013-12-28 19:43:27 -0500] AntelopeSalad: now i'm checking the berkshelf docs since i have not read them yet
[2013-12-28 19:43:41 -0500] AntelopeSalad: but it seems like that just puts them into something similar to what the chef-repo/cookbooks dir was?
[2013-12-28 19:43:56 -0500] AntelopeSalad: maybe this one is isolated on a per berks-project basis? i didn't read that far
[2013-12-28 19:44:45 -0500] coderanger: AntelopeSalad: Berkshelf is a package manager like bundler, pip, or npm
[2013-12-28 19:44:59 -0500] coderanger: Except the "packages" are cookbooks
[2013-12-28 19:45:02 -0500] AntelopeSalad: yeah
[2013-12-28 19:45:15 -0500] AntelopeSalad: in npm's case the modules are installed locally to your project tho
[2013-12-28 19:45:22 -0500] AntelopeSalad: assuming you didn't npm install them globally
[2013-12-28 19:45:40 -0500] AntelopeSalad: and with bundler you can do the same local install with gemsets (per project gems)
[2013-12-28 19:46:50 -0500] AntelopeSalad: it seems like berkshelf lets you do that with the --path flag?
[2013-12-28 19:48:17 -0500] coderanger: Yeah, you wouldn't generally use that
[2013-12-28 19:48:35 -0500] coderanger: Instead most tools integrate with the berkshelf API to assemble a temporary cookbooks folder on the fly
[2013-12-28 19:49:03 -0500] coderanger: More like how bundler works (except it does it in-memory)
[2013-12-28 19:49:12 -0500] AntelopeSalad: i think this is starting to fall together now, your comment about the knife config helped a lot
[2013-12-28 19:49:38 -0500] AntelopeSalad: so all i would do is copy the knife config and my auth files to a berk init'd directory and in theory i'm good to go?
[2013-12-28 19:50:08 -0500] coderanger: Yep, or more often the folder one level down since each cookbook will be its own repo, so you want the knife config to apply to all of them
[2013-12-28 19:50:32 -0500] coderanger: Like I have my .chef/knife.rb in ~/src/bal, and then stuff like ~/src/bal/jenkins, ~/src/bal/ci, etc
[2013-12-28 19:50:34 -0500] AntelopeSalad: ok, that makes sense
[2013-12-28 19:50:51 -0500] coderanger: (actually its a symlink so we can store it in git)
[2013-12-28 19:52:13 -0500] AntelopeSalad: and manually using knife to upload the berks generated cookbook (to test it) is something i won't need to do anymore?
[2013-12-28 19:52:26 -0500] AntelopeSalad: since there are likely other tools to handle testing that i have not yet discovered
[2013-12-28 19:52:28 -0500] coderanger: Indeed, `berks upload -e test`
[2013-12-28 19:52:38 -0500] coderanger: And yeah, for testing using test-kitchen
[2013-12-28 19:52:43 -0500] coderanger: (and chefspec)
[2013-12-28 19:53:10 -0500] AntelopeSalad: ok
[2013-12-28 19:53:24 -0500] AntelopeSalad: thanks a lot, between all of that and the recommended guide from before i should be set
[2013-12-28 19:53:36 -0500] coderanger: Also check out reset's blog post
[2013-12-28 19:53:45 -0500] AntelopeSalad: you guys are all using berks 3.0 too right?
[2013-12-28 19:53:49 -0500] coderanger: http://blog.vialstudios.com/posts/166848-the-environment-cookbook-pattern
[2013-12-28 19:54:05 -0500] coderanger: AntelopeSalad: No, few people are using berks 3
[2013-12-28 19:54:11 -0500] coderanger: It is still in prerelease
[2013-12-28 19:54:22 -0500] coderanger: I would highly recommend it though
[2013-12-28 19:54:53 -0500] AntelopeSalad: are 2 and 3's api close enough that i won't get lost trying to follow a 2.x guide?
[2013-12-28 19:55:06 -0500] coderanger: mostly, yes
[2013-12-28 19:55:20 -0500] coderanger: the only difference is how the site and chef_api directives work
[2013-12-28 19:55:30 -0500] coderanger: For the most part, just leave those out and you'll be fine
[2013-12-28 19:56:04 -0500] AntelopeSalad: ok, i'll give 3.x a shot then
[2013-12-28 19:57:01 -0500] AntelopeSalad: now i really see why software estimates are usually off by a lot haha
[2013-12-28 19:57:19 -0500] coderanger: Welcome to a very very rapidly evolving ecosystem
[2013-12-28 19:57:25 -0500] coderanger: We all only kind of know what we're doing
[2013-12-28 19:57:42 -0500] AntelopeSalad: about a week ago i said to myself "let's learn chef today, nothing to do for 10hours"
[2013-12-28 19:59:30 -0500] AntelopeSalad: is it even worth going back to watch the foodshow casts that are somewhat old?
[2013-12-28 19:59:47 -0500] AntelopeSalad: and i guess somewhat old in this case would be around pre-august? lol
[2013-12-28 19:59:56 -0500] coderanger: Yeah, a lot of that is still relevant
[2013-12-28 20:00:05 -0500] coderanger: And each person finds their own workflow
[2013-12-28 20:00:11 -0500] coderanger: so more info is always good :D
[2013-12-28 20:00:19 -0500] AntelopeSalad: i definitely liked the webinar
[2013-12-28 20:01:04 -0500] AntelopeSalad: i'd rather someone be extremely detail oriented and spend 15 minutes explaining something trivial rather than gloss over the details and assume the listener knows
[2013-12-28 20:01:28 -0500] AntelopeSalad: the dude who lectured that series really took his time explaining things clearly
[2013-12-28 20:02:02 -0500] coderanger: Heh, haven't watched it, maybe I should :)
[2013-12-28 20:02:55 -0500] AntelopeSalad: i'm not sure how much you'll benefit from it, i was coming at it from basically ground 0 chef knowledge
[2013-12-28 20:05:02 -0500] tabolario: Gah my dependencies still seem to be putting the berks resolver into an infinite loop
[2013-12-28 20:10:38 -0500] viknesh: i am new to chef . my mentor told me to setup chef workstation , server in ubuntu
[2013-12-28 20:10:59 -0500] viknesh: can anyone help me with that , please :-X
[2013-12-28 20:11:40 -0500] coderanger: viknesh: getchef.com/chef/install/
[2013-12-28 20:12:39 -0500] viknesh: coderanger: really thank you :-D
[2013-12-28 20:13:46 -0500] viknesh: coderanger: it dosent have 13.04 ubuntu . So what option is better to be choosed
[2013-12-28 20:14:02 -0500] coderanger: viknesh: You can use the 12.04 installer
[2013-12-28 20:14:25 -0500] viknesh: k thank u
[2013-12-28 20:14:50 -0500] coderanger: viknesh: You really shouldn't be using 13.04 though
[2013-12-28 20:14:59 -0500] coderanger: Either upgrade to 13.10 or use an LTS
[2013-12-28 20:15:22 -0500] viknesh: what is the problem with that
[2013-12-28 20:15:36 -0500] coderanger: (you'll find a lot of projects only keep installers and guides for latest Ubuntu and the active LTSs)
[2013-12-28 20:17:22 -0500] coderanger: Thats not a chef-specific thing
[2013-12-28 20:17:23 -0500] viknesh: k can i upgrade after installing chef . Should i setup chef again after upgrade
[2013-12-28 20:17:41 -0500] coderanger: just in the Ubuntu ecosystem, non-LTS releases are generally assumed to be on stuff you want to upgrade
[2013-12-28 21:44:33 -0500] geggam: so im feeling dumb right now... if i set a default node attribute in an environment like so   "default_attributes": {
[2013-12-28 21:44:34 -0500] geggam:     "node": {
[2013-12-28 21:44:34 -0500] geggam:       "myenv": "ops_beta"
[2013-12-28 21:44:34 -0500] geggam:     } Then i should be able to get it into a template like so ... Prefix "collectd.<%= node[:myrole] %>.<%= node[:myenv] %>.<%= @instanceid %>."
[2013-12-28 21:44:41 -0500] geggam: right >
[2013-12-28 21:44:42 -0500] geggam: ?
[2013-12-28 21:45:26 -0500] coderanger: I don't see anything about myrole in there
[2013-12-28 21:45:44 -0500] coderanger: Also drop the node: {}
[2013-12-28 21:45:57 -0500] coderanger: just default_attributes: {myenv: "whatever"}
[2013-12-28 21:46:14 -0500] coderanger: (or use node['node']['myenv'] )
[2013-12-28 21:46:37 -0500] geggam: my role is set in the role
[2013-12-28 21:46:51 -0500] coderanger: Heh, so one thing worth noting, you can use the env name directly too
[2013-12-28 21:46:58 -0500] coderanger: <%= node.chef_environment %>
[2013-12-28 21:47:09 -0500] coderanger: rather than making a node attr
[2013-12-28 21:47:10 -0500] geggam: is that for the role too ?
[2013-12-28 21:47:19 -0500] coderanger: Kind of
[2013-12-28 21:47:27 -0500] coderanger: You could do <%= node['roles'].first %>
[2013-12-28 21:47:36 -0500] coderanger: but that list could have more than one entry
[2013-12-28 21:47:41 -0500] coderanger: depending on how you setup your run lists
[2013-12-28 21:47:44 -0500] geggam: yeah... it will have
[2013-12-28 21:48:56 -0500] geggam: not sure i want to spin off the prepopulated tho... people have a habit of getting cute with names and will likely break something
[2013-12-28 21:51:29 -0500] coderanger: Heh, thats up to you :-)
[2013-12-28 21:53:36 -0500] geggam: thanks for the help ... my brain was wedged for some reason
[2013-12-28 21:53:45 -0500] geggam: too much facebook or something
[2013-12-28 22:38:29 -0500] mdpatrick: Running into a frustrating issue with vagrant/chef-solo. I setup my chef recipe to install RVM, but once it's installed if I run vagrant provision later (which tries to run chef-solo) it will fail since my rvm'ed ruby doen't have chef-solo or chef-client
[2013-12-28 22:41:01 -0500] coderanger: mdpatrick: Are you using vagrant-omnibus?
[2013-12-28 22:41:07 -0500] mdpatrick: I am
[2013-12-28 22:41:34 -0500] coderanger: Hmm, it should be directly running /opt/chef/bin/chef-solo then
[2013-12-28 22:42:12 -0500] mdpatrick: maybe I'm misunderstanding the error message: /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:247:in `to_specs': Could not find chef (>= 0) amongst [bundler-1.3.5, bundler-unload-1.0.2, executable-hooks-1.2.6, gem-wrappers-1.2.1, rubygems-bundler-1.4.2, rvm-1.11.3.8] (Gem::LoadError)
[2013-12-28 22:42:29 -0500] mdpatrick: 1.9.1... I guess that IS the correct ruby then
[2013-12-28 22:42:49 -0500] coderanger: That sounds like your rvm cookbook is fucking with the chef ruby
[2013-12-28 22:42:54 -0500] coderanger: Is there a reason you are using RVM?
[2013-12-28 22:43:11 -0500] coderanger: Its a terrible piece of sofware and rbenv or omnibus-rubies is a way better option
[2013-12-28 22:43:47 -0500] mdpatrick: hmm
[2013-12-28 22:44:27 -0500] mdpatrick: Don't know. I thought rvm was the standard. Maybe I should look into rbenv
[2013-12-28 22:44:57 -0500] mdpatrick: The reason for my rvm was just to get an upgraded ruby with discrete gemsets for my webserver to use on a per-site basis
[2013-12-28 22:45:13 -0500] mdpatrick: didnt want my gems being all intermingled together
[2013-12-28 22:45:34 -0500] AntelopeSalad: that's why i use rvm too mdpatrick
[2013-12-28 22:45:49 -0500] coderanger: mdpatrick: Use bundler, it is a far better solution to that
[2013-12-28 22:47:12 -0500] stormerider: yes, rvm and chef do not play nicely together in my experience
[2013-12-28 22:47:12 -0500] coderanger: But if you really insist, rbenv supports gemsets too via a plugin
[2013-12-28 22:47:25 -0500] coderanger: rvm and everything don't play well together
[2013-12-28 22:47:35 -0500] coderanger: it turns out overriding cd is a bad idea, fancy that
[2013-12-28 22:47:36 -0500] AntelopeSalad: i thought chef may have used its own embedded ruby version?
[2013-12-28 22:47:46 -0500] AntelopeSalad: (i haven't provisioned a box yet with rvm)
[2013-12-28 22:47:59 -0500] stormerider: i dont really use ruby outside of chef, so i dont have anecdotal experience otherwise coderanger :)
[2013-12-28 22:48:07 -0500] coderanger: AntelopeSalad: It does, but it you set GEM_HOME and GEM_PATH globally, it affects any ruby on the system
[2013-12-28 22:48:14 -0500] stormerider: AntelopeSalad: rvm tends to muck with... what coderanger said
[2013-12-28 22:48:33 -0500] stormerider: gmtabstf
[2013-12-28 22:48:35 -0500] AntelopeSalad: oh
[2013-12-28 22:49:39 -0500] AntelopeSalad: i may have to give rbenv a fair look at some point then, i stuck with rvm so far because i never had a reason to think otherwise
[2013-12-28 22:50:10 -0500] coderanger: Usually a safe plan, but in this case rbenv is far superior
[2013-12-28 22:50:30 -0500] coderanger: and in production I would look at kallistec's omnibus-rubies project to just build the version you want
[2013-12-28 22:50:44 -0500] coderanger: (i say this as I sit waiting for rbenv to compile so I can run my kitchen tests)
[2013-12-28 22:50:45 -0500] AntelopeSalad: yeah i like the idea of not using rvm in production
[2013-12-28 22:51:05 -0500] AntelopeSalad: but my requirements are different than mdpatrick's i think
[2013-12-28 22:51:19 -0500] AntelopeSalad: he mentioned multiple sites, so maybe that means multiple ruby versions too
[2013-12-28 22:52:58 -0500] AntelopeSalad: i have to say omnibus-rubies looks really cool
[2013-12-28 22:53:06 -0500] mdpatrick: mostly multiple gemsets :) but yes possibly multiple ruby version. It's my understanding that Bundler does not actually keep gemsets separate from each other... that's RVM (or rbenv?)'s job.
[2013-12-28 22:53:35 -0500] mdpatrick: Bundler just manages making sure that specific version are available where ever the system is installing gems.
[2013-12-28 22:54:13 -0500] coderanger: mdpatrick: No, if you run via bundle exec (or a binstub, or a tool that integrates with the bundler API) it fully isolates things by hard-locking versions in memory
[2013-12-28 22:54:35 -0500] stormerider: any suggestions as to what to look at what's bogging things down at the "resolving cookbooks for run list" stage? seems like it takes a long time to get from there to syncing
[2013-12-28 22:54:37 -0500] coderanger: bundler pokes the load paths and the rubygems APIs to effectively construct a gemset on the fly
[2013-12-28 22:55:26 -0500] coderanger: stormerider: It means you have a cranky version constraint set and it is probably doing a lot of backtracking to find a solution
[2013-12-28 22:57:15 -0500] mdpatrick: Where is it saving the gems then, coderanger?
[2013-12-28 22:57:44 -0500] coderanger: mdpatrick: Normal gems folder for the ruby
[2013-12-28 22:58:02 -0500] mdpatrick: aha... we're both right, actually :)
[2013-12-28 22:58:03 -0500] coderanger: mdpatrick: But Ruby already handles things like multiple versions of a gem being installed at once
[2013-12-28 22:58:05 -0500] mdpatrick: path (BUNDLE_PATH): The location on disk to install gems. Defaults to $GEM_HOME in development and vendor/bundle when --deployment is used.
[2013-12-28 22:58:30 -0500] mdpatrick: So I could totally get away with NOT using rvm, so long as I don't need multiple versions of ruby...
[2013-12-28 22:58:31 -0500] coderanger: Yes, the point is that isolated folders are no longer needed because it can do the isolation by tweaking the import APIs
[2013-12-28 22:58:42 -0500] AntelopeSalad: oh so RVM sets $GEM_HOME to .rvm/gems or whatever?
[2013-12-28 22:59:09 -0500] coderanger: Well rvm and rbenv specialize in installing versions of Ruby, so if you want something other than the system default (usually 1.8) you need something
[2013-12-28 23:00:12 -0500] AntelopeSalad: my reasoning behind using gemsets was the same as not installing gems globally with npm when i work on node apps
[2013-12-28 23:00:39 -0500] AntelopeSalad: i just like having everything contained to a project, if i delete a project and all its deps it shouldn't affect other projects
[2013-12-28 23:02:05 -0500] coderanger: AntelopeSalad: "delete a project" in modern terms is killing the VM or container
[2013-12-28 23:02:08 -0500] stormerider: coderanger: any idea what to look for? flipping the node to _default didn't speed things up
[2013-12-28 23:02:22 -0500] coderanger: stormerider: Unfortunately debugging tools for this are pretty minimal
[2013-12-28 23:02:37 -0500] AntelopeSalad: coderanger: oh, i am looking at it from a developer POV, a project to me is some application for xyz client
[2013-12-28 23:03:12 -0500] stormerider: is this maybe an indicator i should clean up some old cookbook revs to speed up the depsolver?
[2013-12-28 23:03:19 -0500] coderanger: AntelopeSalad: For a workstation is very different than a prod server
[2013-12-28 23:03:36 -0500] coderanger: stormerider: Maybe, but unless it has to actually backtrack through them it shouldn't matter
[2013-12-28 23:03:47 -0500] coderanger: stormerider: The depsolver system is very hard to reason about right now though
[2013-12-28 23:04:15 -0500] AntelopeSalad: yeah, so i guess you use rbenv on your dev box and then use omnibus-rubies for the deploy?
[2013-12-28 23:04:52 -0500] coderanger: AntelopeSalad: That would be optimal, yes :)
[2013-12-28 23:05:12 -0500] stormerider: nod, i know it's getting refactored, just wasnt sure what guidance there was for current. i only really noticed this when i switched from pushing stuff into roles to using a wrapper cookbook, but im not sure why that would matter. but it's an older box (albeit with 8g ram) so it could just be that *shrug*
[2013-12-28 23:05:42 -0500] stormerider: hosted chef is what... 5 nodes? i might be low enough to be able to switch back to that
[2013-12-28 23:05:49 -0500] AntelopeSalad: i don't mind spinning up a new server for each project but some people do treat their production boxes as an "almost dev" box
[2013-12-28 23:05:55 -0500] AntelopeSalad: in the sense that they will host more than 1 app on it
[2013-12-28 23:06:02 -0500] coderanger: AntelopeSalad: Those people are Wrong :D
[2013-12-28 23:06:18 -0500] coderanger: If nothing else, thats a security nightmare
[2013-12-28 23:06:35 -0500] AntelopeSalad: yeah i stayed away from that style too, it's more popular in non-ruby development
[2013-12-28 23:07:20 -0500] stormerider: depends on scale, imo. im hosting multiple wordpress stacks on a single linode, doesnt make financial sense to have one for each site. but that's probably not the scale that most chef users would be working at.
[2013-12-28 23:07:29 -0500] AntelopeSalad: mainly due to the resources required to run a few web workers and something like sidekiq
[2013-12-28 23:09:41 -0500] coderanger: ::shrug:: a t1.micro is pretty cheap :D
[2013-12-28 23:09:59 -0500] geggam: pretty shittty performance too
[2013-12-28 23:10:25 -0500] geggam: its like a vm that has been reniced to 19
[2013-12-28 23:12:31 -0500] stormerider: though down the road i'll probably see if i can just convert things over to one large WPMU stack instead of multiple separate instances. yeah, the network performance on t1.micro is pretty bad, too.
[2013-12-28 23:13:03 -0500] geggam: so any devs out here please please please make operation leaning guys really happy and pick one directory to put your random binaries in ... /opt /srv and others are non standard paths and create the desire to facepunch people when attempting to automate things... tyvm * your ranting devops dude *
[2013-12-28 23:14:41 -0500] mdpatrick: its interesting that your use of facepunch might be a barometer of your feelings of the subject. A facepunch is a little less lifethreatening than a throatpunch so I guess it's kind of like, "hey, I feel strongly about this" but not enough to keeeel anyone. :)
[2013-12-28 23:15:24 -0500] geggam: meh... 1st offense
[2013-12-28 23:15:56 -0500] AntelopeSalad: i have a small site going on a micro instance, the performance has very high variance
[2013-12-28 23:16:22 -0500] geggam: with fpm there really shouldnt be any non packaged binaries going into a system
[2013-12-28 23:17:32 -0500] geggam: but im working with devs who spin up ec2 nodes.. install tools /  compilers on instance... build stuff then run it
[2013-12-28 23:17:39 -0500] geggam: so breaking bad habits everywhere
[2013-12-28 23:18:10 -0500] coderanger: geggam: +1, gcc on a server is a code smell
[2013-12-28 23:18:34 -0500] geggam: jenkins and release management was one of those moments they looked really embarassed :)
[2013-12-28 23:18:46 -0500] geggam: soon ill even start talking about unit tests
[2013-12-28 23:20:43 -0500] AntelopeSalad: what kind of devs are you working with geggam
[2013-12-28 23:22:08 -0500] geggam: languages vary ... decent devs... oppen to suggestions and whatnot.. just used to making code and letting someone else manage it i guess ?
[2013-12-28 23:22:34 -0500] geggam: trying to learn them some good devops practices
[2013-12-28 23:22:50 -0500] AntelopeSalad: oh, i just found it weird that they don't write tests but are comfortable setting up ec2 instances
[2013-12-28 23:22:57 -0500] AntelopeSalad: unless you meant tests for their cookbooks?
[2013-12-28 23:23:16 -0500] geggam: um... i prefer pure devs stay out of the production chef :)
[2013-12-28 23:23:48 -0500] geggam: they can make cookbooks on their stuffs and let me see if i want to put them in prod... so many devs want to make heavy heavy recipes that do everything...
[2013-12-28 23:24:03 -0500] geggam: the lighter you can do this stuff the better it runs
[2013-12-28 23:24:23 -0500] geggam: modular type recipes
[2013-12-28 23:25:01 -0500] AntelopeSalad: yeah
[2013-12-28 23:25:06 -0500] geggam: pretty bad when you can see chef runs on the performance graphs :)
[2013-12-28 23:25:40 -0500] coderanger: geggam: Fuck that, if someone doesn't feel comfortable running a service, they have no business writing it
[2013-12-28 23:27:20 -0500] geggam: i take it you havent met java programmers ?
[2013-12-28 23:28:32 -0500] coderanger: geggam: I am fortunate in that I can choose to not work with such people :)
[2013-12-28 23:28:49 -0500] coderanger: I mean I know great java devs, but I know what you are referring to
[2013-12-28 23:29:23 -0500] AntelopeSalad: there is definitely a steep learning curve, but i don't blame chef
[2013-12-28 23:31:29 -0500] geggam: i can choose to work where i need to coderanger .... but a friend asked for some help and i would rather help people that need it and stay busy vs hanging around a crew that knows wtf to do and me getting bored
[2013-12-28 23:32:16 -0500] coderanger: geggam: The balanced crew knows whats going on, but oh god am I far from bored
[2013-12-28 23:32:23 -0500] coderanger: So much stuff to be build, so many broken windows :)
[2013-12-28 23:33:34 -0500] geggam: um... windows the OS ?
[2013-12-28 23:33:43 -0500] geggam: i do draw the line at that crap
[2013-12-28 23:33:58 -0500] coderanger: geggam: https://en.wikipedia.org/wiki/Broken_windows_theory
[2013-12-28 23:34:29 -0500] coderanger: Basically there is a lot of crap we all just used to, and so tolerate, but it has strong negative impacts on both us and the state of the industry
[2013-12-28 23:35:16 -0500] AntelopeSalad: pragmatic programmer tip!
[2013-12-28 23:36:05 -0500] coderanger: This applies to dev too, usually in form of "oh yeah, we know that test fails"
[2013-12-28 23:36:11 -0500] geggam: so... im of the opinion humans are more like the self regulating when you remvoe the rules ... see things like the montana paradox and this german community http://www.csmonitor.com/World/Global-News/2010/0331/What-happens-when-you-remove-all-traffic-signs-A-German-town-finds-out
[2013-12-28 23:36:51 -0500] geggam: if you dont designate someone as responsible then people tend to have more personal responsibility
[2013-12-28 23:36:59 -0500] geggam: plus you dont get vigilantes
[2013-12-28 23:37:31 -0500] coderanger: That seems largely orthogonal
[2013-12-28 23:38:01 -0500] AntelopeSalad: how about that one guy who creates a 6,500 line php file that does everything under the sun?
[2013-12-28 23:38:07 -0500] coderanger: My job is basically just to iteratively make ops suck a little less, solidify common patterns, write docs, etc
[2013-12-28 23:38:52 -0500] geggam: well... if you see something broke you fix it... if its someone elses job to fix it you wont
[2013-12-28 23:39:01 -0500] geggam: is what i was attempting to convey
[2013-12-28 23:39:41 -0500] coderanger: My job description is literally to fix the world, so its all my job :D
[2013-12-28 23:40:31 -0500] stormerider: is there a good cli tool to query current community cookbook versions?
[2013-12-28 23:41:13 -0500] geggam:  knife cookbook site list
[2013-12-28 23:41:33 -0500] coderanger: and cookbook site show
[2013-12-28 23:41:33 -0500] geggam: coderanger, <%= node['filesystem']['Device'].first %> doesnt get me the xen device... what would ?
[2013-12-28 23:41:37 -0500] stormerider: ah, i guess i dont really need to use pessimistic matching for most of the stuff in my Berksfile
[2013-12-28 23:41:58 -0500] geggam: in ec2
[2013-12-28 23:42:00 -0500] coderanger: geggam: pastebin `ohai filesystem`, I would need ot see the structure
[2013-12-28 23:43:36 -0500] geggam: http://pastebin.mozilla.org/3885908 coderanger
[2013-12-28 23:43:50 -0500] stormerider: ...huh. random oddness: searching community.opscode.com for apache2, the actual apache2 cookbook was 5th on the list. seems like that algorithm should prioritize exact matches highest
[2013-12-28 23:43:51 -0500] geggam: i wants  "/dev/xvde1":
[2013-12-28 23:45:29 -0500] stormerider: geggam: seems like you would want to do node['filesystem']['/dev/xvde1'], not ['Device']... or if Device is meant to be a variable, it shouldnt be quoted
[2013-12-28 23:45:32 -0500] coderanger: geggam: node['filesystem'].find{|k, v| k[0] == '/' && v['mount'] == '/'}.first
[2013-12-28 23:46:26 -0500] geggam: seems like that should be somewhat easier to get to coderanger  :)
[2013-12-28 23:46:49 -0500] stormerider: i dont think xvde is usually the root filesystem, geggam
[2013-12-28 23:46:52 -0500] coderanger: geggam: It is just a literal dump of the sysfs data on mounts
[2013-12-28 23:46:52 -0500] geggam: ec2 is changing them from xvde1 to xvda1 sometimes
[2013-12-28 23:47:01 -0500] geggam: damned annoying
[2013-12-28 23:47:17 -0500] coderanger: In other news, why the bloody hell does EC2 have usbfs mounted?
[2013-12-28 23:47:18 -0500] stormerider: yeah, im used to xvda1 myself
[2013-12-28 23:47:40 -0500] geggam: so they can plug in the nsa thumb drives
[2013-12-28 23:47:43 -0500] geggam: ;)
[2013-12-28 23:47:46 -0500] stormerider: coderanger: my instances dont, i dont think (*goes to check*)
[2013-12-28 23:48:55 -0500] stormerider: yeah, not seeing that myself. i'd imagine that's something in the ami geggam is using
[2013-12-28 23:49:37 -0500] geggam: company makes those amis... i dont.. they put quite a bit of stuff in them i wouldnt
[2013-12-28 23:49:51 -0500] geggam: but... its secure according to them so im good
[2013-12-28 23:50:29 -0500] coderanger: geggam: broken windows ;-)
[2013-12-28 23:50:34 -0500] stormerider: i have (besides the xvd devices) none, udev, tmpfs, proc, sysfs, devpts, and rootfs
[2013-12-28 23:50:52 -0500] geggam: yeah yeah... ill fight that battle after i get my devs all better
[2013-12-28 23:50:56 -0500] geggam: :D
[2013-12-28 23:51:06 -0500] stormerider: coderanger: not familiar with that term?
[2013-12-28 23:51:25 -0500] geggam: <coderanger> geggam: https://en.wikipedia.org/wiki/Broken_windows_theory
[2013-12-28 23:51:36 -0500] geggam: that one stormerider  ^
[2013-12-28 23:51:39 -0500] coderanger: :-)
[2013-12-28 23:51:40 -0500] stormerider: thanks
[2013-12-28 23:52:17 -0500] stormerider: also, does the apache2 cookbook support 2.4 yet? not seeing it mentioned in the readme, but there are so many config settings it's hard to tell, heh
[2013-12-28 23:52:45 -0500] stormerider: huh, interesting phrase
[2013-12-28 23:53:01 -0500] coderanger: stormerider: It installs whatever the system package is
[2013-12-28 23:53:35 -0500] stormerider: coderanger: the config is different between 2.4 and 2.2... some of the settings in 2.2 actually break 2.4
[2013-12-28 23:53:59 -0500] geggam: ive quit pulling the site packages down.. i just hack them down to just about nothing and its faster to build than it is to tear apart
[2013-12-28 23:54:38 -0500] geggam: not to mention i know when i write bugs :)
[2013-12-28 23:54:41 -0500] stormerider: in general i try to use them where possible and commit back
[2013-12-28 23:54:52 -0500] geggam: i cannot
[2013-12-28 23:54:53 -0500] stormerider: at least on my own time
[2013-12-28 23:55:04 -0500] stormerider: i havent broached that with $work yet
[2013-12-28 23:55:22 -0500] geggam: i dont have my own time... i work ... am married... have kids... im running a time deficit.. hence working on saturday
[2013-12-28 23:55:52 -0500] geggam: too bad the fed cant print me some minutes
[2013-12-28 23:56:00 -0500] stormerider: (my own time, my own servers, im free to do what i want codewise as long as it doesnt compete with the core business of $work.)
[2013-12-28 23:57:00 -0500] geggam: when i get old and know wtf im doing ill contribute back... actually when i get this gang on their feet im gonna see if i cant make chef server run on openbsd
[2013-12-28 23:57:08 -0500] stormerider: im married but no kids, i tend to use my devices for research/familiarization with things i then go on to use at work
[2013-12-28 23:57:12 -0500] geggam: dunno how long that will take
[2013-12-28 23:59:14 -0500] geggam: i find getting jobs that push my limits teaches me faster and i get to use better hardware than what i can afford stormerider
[2013-12-28 23:59:31 -0500] geggam: when i was a consultant i would sell shit i had no clue how to do
[2013-12-28 23:59:33 -0500] geggam: :)
[2013-12-28 23:59:48 -0500] geggam: wanna see a hockey stick learning curve do that
