[2013-12-23 00:25:23 -0500] seif: Hello, I am trying to share a cookbook with `knife cookbook site share NAME CAT` but getting AUTHENTICATION_ERROR, my knife config is here http://pastebin.com/krEanBR8 I am able to upload the cookbook to opscode managed chef server, which from my reading is what I need to have configured properly for my user/key. What exactly needs to be configured for this to work properly?
[2013-12-23 00:33:49 -0500] flaccid: seif: are you using hosted chef with opscode?
[2013-12-23 00:34:26 -0500] seif: flaccid: yes, I am able to upload the cookbook to my organisation in hosted chef with opscode
[2013-12-23 00:35:38 -0500] seif: flaccid: I am trying to share the cookbook on the community site
[2013-12-23 00:37:03 -0500] flaccid: seif: is ENV['ORGNAME'] set ?
[2013-12-23 00:37:19 -0500] flaccid: and ENV['OPSCODE_USER']
[2013-12-23 00:37:47 -0500] flaccid: i guess i'd just be checking the ENV vars and that the files exist per th conf
[2013-12-23 00:39:35 -0500] seif: flaccid: user and org are there, checking file now, but it must exist, as otherwise I wouldn't be able to upload cookbook to opscode managed chef server. I didn't do any extra configuration in the community cookbook site
[2013-12-23 00:41:32 -0500] flaccid: seif: log into the community site with the opscode user and see if looks configured correctly. i think log out of the chef dashboard thing, then log into the community site and then go back to console to see if you are viewing the same account
[2013-12-23 00:46:16 -0500] seif: flaccid: logged out of everything chef, logged into the community site with the same opscode user, not sure what to look for to check if it is configured correctly, there is no where to see the configured key, just a link 'get private  key' which takes me to the getchef.com/account/passoword page (and didn't ask me to login)
[2013-12-23 00:48:29 -0500] seif: flaccid: nop, I lied, when it took me to the opscode Account Management page, I had to login again, but same user/pass as the user configured in knife
[2013-12-23 00:49:23 -0500] flaccid: seif: i havnt actually used that knife function before so i don't think i'm the right guy to help
[2013-12-23 00:49:44 -0500] seif: flaccid: no problem, thanks for trying
[2013-12-23 00:49:56 -0500] flaccid: just isn't people alive here atm i dont think :(
[2013-12-23 00:56:05 -0500] seif: flaccid: makes sense, Sunday before christmas, wonder why we are here :) Spent most of weekend writing up a cookbook (my first), thought publishing would be the easy part, no luck. berks package creates a weird archive that even even the webui refuses, knife cookbook site share has auth problems. Maybe something to finish up for the new year
[2013-12-23 00:56:42 -0500] flaccid: seif: well its monday where i am, i'm at work. i use the community site and just upload the cookbook..
[2013-12-23 00:58:14 -0500] seif: flaccid: How do you package the cookbook?  I managed to upload this yesterday: http://community.opscode.com/cookbooks/eventstore by running the knife command, failing auth, going to the temp directory and uploading the file from thewebui
[2013-12-23 00:58:46 -0500] seif: flaccid: Not happy with all the files that ended up in the package, and not happy with having to upload manually, trying to improve things
[2013-12-23 00:59:42 -0500] flaccid: seif: i guess i just uploaded a zip or tarball or something via http://community.opscode.com/cookbooks/new
[2013-12-23 01:00:03 -0500] seif: flaccid: Did you zip stuff manually?
[2013-12-23 01:00:48 -0500] flaccid: i can't remember :(
[2013-12-23 01:01:30 -0500] flaccid: it says tarball so i probably just downloaded tarball from github
[2013-12-23 01:04:01 -0500] seif: flaccid: ah well, I just uploaded manually again, with a little progress, seems I had to put the chefignore file in my configured cookbooks path, so it ignored some files. Will ask again some other time to get berkshelf/knife working properly. Time to sleep, working tomorrow, thanks again for your help
[2013-12-23 01:04:17 -0500] flaccid: ok, have a good one y0
[2013-12-23 09:41:13 -0500] paresh: how can i create the /etc/chef-server/admin.pem file which i deleted accidentally
[2013-12-23 09:41:27 -0500] paresh: s2r2: hey help neede
[2013-12-23 10:12:45 -0500] hakunin: how come every time i run knife search node "tags:cron" i get all the nodes, even the ones obviously not tagged cron according to the web interface
[2013-12-23 10:14:36 -0500] hakunin: what is even going on
[2013-12-23 10:16:48 -0500] hakunin: i run knife search node "tags:cron" -a tags <- and the output doensn't have tag cron on many of them
[2013-12-23 10:16:58 -0500] hakunin: so confused
[2013-12-23 10:20:08 -0500] hakunin: Same thing with any other tag that exists. It returns all nodes regarless whether they have the tag. Returns 0 nodes for tags that don't exist anywhere.
[2013-12-23 10:54:34 -0500] siva: hello
[2013-12-23 13:46:19 -0500] zeroXten: how do people feel about this cookbook naming convention https://gist.github.com/zeroXten/1663dc0467958df2abad ?
[2013-12-23 13:53:05 -0500] lewiz: zeroXten: I don't like the chef in there
[2013-12-23 13:53:24 -0500] zeroXten: hmm, they double up as git repos :)
[2013-12-23 13:53:45 -0500] zeroXten: could drop the chef i guess
[2013-12-23 13:53:46 -0500] lewiz: zeroXten: the names will get too long.  the chef is superfluous
[2013-12-23 13:55:58 -0500] zeroXten: r
[2013-12-23 14:10:38 -0500] EnriqueCadalso: Hi, I am having this error when using librarian-chef install: /Users/enrique/.rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/tsort.rb:152:in `block in tsort_each': topological sort failed: ["windows", "powershell"] (TSort::Cyclic). It used to work, same Cheffile. Any ideas how to troubleshoot this problem?
[2013-12-23 14:38:25 -0500] erichs: Hi there, chefs! I'm fairly new to the framework, so I hope this is a real no-brainer: I've got several production nodes configured and under version control. That was great, and super easy. I'd like to be able to selectively transition some or all of them out of production and into a different state for 'development' mode: stop certain services, etc. How is this typically handled? With different Environments
[2013-12-23 14:38:27 -0500] erichs: for each state?
[2013-12-23 14:44:41 -0500] kristianpaul: The chef solo binary is installed along chef-clieng (using curl etc) ?
[2013-12-23 14:44:45 -0500] kristianpaul: Hello all btw
[2013-12-23 14:50:34 -0500] kristianpaul: ah rubygems
[2013-12-23 14:50:46 -0500] erichs: Hi, all! Anyone feel like fielding a newbie question?
[2013-12-23 14:53:21 -0500] mattsurabian: what else is IRC here for? :-p
[2013-12-23 14:53:57 -0500] erichs: Hi there, chefs! I'm fairly new to the framework, so I hope this is a real no-brainer: I've got several production nodes configured and under version control. That was great, and super easy. I'd like to be able to selectively transition some or all of them out of production and into a different state for 'development' mode: stop certain services, etc. How is this typically handled? With different Environments
[2013-12-23 14:53:58 -0500] erichs: for each state?
[2013-12-23 14:55:30 -0500] mattsurabian: erichs: I'm using Chef under rightscale, so the workflow is a bit different. But in my case we use different environments and have recipes to get each server where they need to be. In the development environment we provide different attribute data, which causes things to be configured as we need them in "develop"
[2013-12-23 14:55:33 -0500] mattsurabian: does that makes sense?
[2013-12-23 14:56:15 -0500] mattsurabian: I'm not clear exactly what you'd need to change to go into "development mode" as you say. If it's just stopping some services and stuff
[2013-12-23 14:56:19 -0500] mattsurabian: you could do that with a recipe
[2013-12-23 14:56:54 -0500] mattsurabian: in my case we need completely different configuration values and stuff
[2013-12-23 14:57:18 -0500] erichs: mattsurabian: I think I track you. So, I might have a boolean attribute that means 'make sure this service is started', set to true for production, and false for 'debug' or 'develop' mode.
[2013-12-23 14:57:36 -0500] erichs: and case logic in the recipe.
[2013-12-23 14:58:10 -0500] mattsurabian: yeah that would be one way to go about it erichs
[2013-12-23 14:58:30 -0500] mattsurabian: in that example you've given
[2013-12-23 14:58:36 -0500] mattsurabian: you could also restructure your runlist
[2013-12-23 14:58:55 -0500] mattsurabian: so if you've got a "configure service a" recipe and a "start service a" recipe
[2013-12-23 14:59:00 -0500] erichs: mattsurabian: hrm, so have separate recipes that reflect the different service states?
[2013-12-23 14:59:02 -0500] mattsurabian: your production runlist might have both recipes in it
[2013-12-23 14:59:18 -0500] mattsurabian: while develop maybe only configures the service
[2013-12-23 14:59:27 -0500] mattsurabian: there are lots of ways to go about it as I think you can see :-p
[2013-12-23 14:59:45 -0500] mattsurabian: I like having multiple recipes to control custom services
[2013-12-23 14:59:48 -0500] mattsurabian: start stop restart
[2013-12-23 14:59:50 -0500] mattsurabian: configure
[2013-12-23 15:00:00 -0500] mattsurabian: makes the recipes short and sweet
[2013-12-23 15:00:26 -0500] erichs: mattsurabian: right! That's more 'single responsibility' oriented, maybe.  I like it.
[2013-12-23 15:01:23 -0500] erichs: mattsurabian: thanks for the tip.
[2013-12-23 15:01:30 -0500] mattsurabian: happy to help
[2013-12-23 15:14:27 -0500] volker-: Therfore suggestion: news/update page on logstash.net, announce mailinglist (with low traffic), topic in irc "rollback, current release X.Y.Z"
[2013-12-23 15:16:32 -0500] helfire: isnt it odd that databags are not ruby hashes? Chef::Mixin::Template::TemplateError (undefined method `has_key' for #<Chef::DataBagItem:0x00000003d7e5a8>) on line #30:
[2013-12-23 15:18:59 -0500] acharlieh: Isn't the method name actually 'has_key?' not 'has_key'
[2013-12-23 15:19:17 -0500] helfire: well.. :)
[2013-12-23 15:19:19 -0500] helfire: let me try
[2013-12-23 15:21:02 -0500] acharlieh: I haven't tried it exactly, but https://github.com/opscode/chef/blob/master/lib/chef/data_bag_item.rb#L47 would seem to make me think that it should have the methods delegated through to the wrapped Hash/Mash
[2013-12-23 15:21:10 -0500] helfire: acharlieh: your right!
[2013-12-23 15:21:20 -0500] helfire: i thought the ? was optional null safe operation
[2013-12-23 15:21:26 -0500] helfire: like groovy
[2013-12-23 15:21:34 -0500] kristianpaul: no no wait, gem chef install not enought and if i do chef search chef-solo is confusing cause get multiple gems
[2013-12-23 15:23:00 -0500] acharlieh: no worries... it's taken me a while to get used to method names with punctuation marks as well :)
[2013-12-23 15:40:35 -0500] tjr9898: helfire: ? is often not nil safe in Ruby :(
[2013-12-23 15:41:20 -0500] helfire: ya, figuring that out the hard way :), though good i'm figuring it out in dev
[2013-12-23 15:42:14 -0500] tjr9898: will see `foo && foo.has_key?`
[2013-12-23 16:29:51 -0500] kristianpaul: Is it normal that knife create a branch when installing a cookbook?
[2013-12-23 16:30:02 -0500] storme_away: yes
[2013-12-23 16:32:08 -0500] kristianpaul: where i can change that behavior?
[2013-12-23 16:33:32 -0500] storme_away: use something else like librarian or berkshelf
[2013-12-23 16:36:01 -0500] kristianpaul: I see
[2013-12-23 16:36:48 -0500] kristianpaul: Let said i wanna undo a chef run, is that posible?
[2013-12-23 16:41:00 -0500] stormerider: not that im aware of, but never had any reason to investigate along those lines
[2013-12-23 16:41:46 -0500] stormerider: you do have backups, right? :)
[2013-12-23 16:42:21 -0500] kristianpaul: lol
[2013-12-23 16:42:46 -0500] kristianpaul: In other words i can start from scratch, yes :p
[2013-12-23 16:44:14 -0500] Takumo: What's the easiest way to test a cookbook? I'm having a hard time with gitlab's cookbook and can't work out why
[2013-12-23 16:48:30 -0500] j^2: any knife-openstack guys around?
[2013-12-23 16:56:55 -0500] kristianpaul: talking about openstack, whats the prefered virt tech that works with chef?
[2013-12-23 16:57:24 -0500] kristianpaul: Got a lxc cookbook but looked tied to ubuntu/debian ...
[2013-12-23 17:05:21 -0500] mattsurabian: Does anyone know the behavior of an upstart provider on a start call? If I say start and the service is already started is it a noop or does it restart?
[2013-12-23 17:06:39 -0500] mattsurabian: ah here we go
[2013-12-23 17:06:39 -0500] mattsurabian: https://github.com/opscode/chef/blob/master/lib/chef/provider/service/upstart.rb
[2013-12-23 17:10:39 -0500] mattsurabian: looks like a noop, nice
[2013-12-23 18:26:45 -0500] maplebed: Is there a chef primitive to let me copy a file that exists to a new location, all on the target host? or should I make a ruby block (with a not-if) and %x{cp...}?
[2013-12-23 18:27:12 -0500] maplebed: (context - a package I'm installing lays down a file that I want to copy to a different place)
[2013-12-23 18:27:37 -0500] maplebed: I'm also interested if I can do the same thing moving instead of copying.
[2013-12-23 18:27:57 -0500] stormerider: maplebed: you could symlink it maybe?
[2013-12-23 18:28:12 -0500] maplebed: I think that'd work.
[2013-12-23 18:28:15 -0500] stormerider: but otherwise, i cant think of a primitive
[2013-12-23 18:28:17 -0500] maplebed: is there a symlink primitive?
[2013-12-23 18:28:20 -0500] stormerider: link
[2013-12-23 18:28:39 -0500] maplebed: cool.
[2013-12-23 18:28:46 -0500] stormerider: http://docs.opscode.com/resource_link.html
[2013-12-23 18:28:51 -0500] maplebed: thanks!
[2013-12-23 18:28:54 -0500] stormerider: np
[2013-12-23 18:30:05 -0500] ggolin: hello
[2013-12-23 18:30:26 -0500] ggolin: is it possible to pass an object from one recipe to another?
[2013-12-23 18:35:32 -0500] sudosteph: maplebed, I think you could also use remote_file. The description for source says you can use "file://
[2013-12-23 18:35:50 -0500] sudosteph: for local files. http://docs.opscode.com/resource_remote_file.html
[2013-12-23 18:36:30 -0500] maplebed: ah neat. I'll read that, though I think symlink is actually better (I just didn't think of it first. :P )
[2013-12-23 18:36:46 -0500] stormerider: sudosteph: oh, that's neat to know
[2013-12-23 19:37:39 -0500] lmickh: I'm trying to set a user's password on el6.  Keep getting "undefined method 'sp_pwdp".  Did a gem install ruby-shadow, but still no luck.  Can anyone point me in the right direction?
[2013-12-23 19:39:01 -0500] jstump: lmickh: Depending on how you install Chef you might need to do `chef_gem` on that install.
[2013-12-23 19:39:33 -0500] jstump: lmickh: The `chef_gem` is used for installing Gems into the Omnibus bundled Ruby environment. So if you have a recipe dying on a missing Gem that could help fix your issue.
[2013-12-23 19:40:06 -0500] jstump: lmickh: Pretty sure `gem_package` (and a normal `gem install` as root) would install that package into the global scope where Chef very likely might not be looking.
[2013-12-23 19:41:18 -0500] lmickh: jstump: I installed from the omnibus and knife bootstrapped the node.  Got on the name and ran gem install using the /opt/chef/embedded/bin/gem
[2013-12-23 19:42:01 -0500] lmickh: on the node*
[2013-12-23 19:42:15 -0500] jstump: lmickh: Ah, can't say then. I'd try `chef_gem` just to be sure (also, you'll want it in a recipe or bootstrap template anyways if you need this for every node).
[2013-12-23 19:43:42 -0500] lmickh: jstump:  I don't see a 'chef_gem'.  Is it supposed to be in /opt/chef/bin or elsewhere?
[2013-12-23 19:43:59 -0500] jstump: lmickh: chef_gem is an LWRP you'd use via a Chef recipe.
[2013-12-23 19:44:06 -0500] lmickh: ah ok
[2013-12-23 19:44:12 -0500] jstump: lmickh: http://docs.opscode.com/resource_chef_gem.html
[2013-12-23 19:44:45 -0500] jstump: lmickh: You might also wish to look into a custom bootstrap script depending on your environment. http://docs.opscode.com/knife_bootstrap.html#custom-templates
[2013-12-23 19:45:07 -0500] jstump: lmickh: Bootstrap templates are compiled and ran as a command during `knife bootstrap` (if you use `knife ec2` it's also used there).
[2013-12-23 19:47:28 -0500] lmickh: jstump:  Thanks.  I'll look into that.
[2013-12-23 19:49:04 -0500] jstump: lmickh: As a footnote you shouldn't need a custom bootstrap template. My guess is your default run list with a chef_gem will fix this when the cookbooks are compiled.
[2013-12-23 19:50:10 -0500] lmickh: jstump: Yea, I looked at the doc for custom bootstrap earlier, but decided to not jump into that yet.
[2013-12-23 19:51:02 -0500] jstump: lmickh: Yeah, I've only had to do that once to get around a weird catch 22 in the bootstrapping + cookbook compiling process.
[2013-12-23 19:52:08 -0500] lmickh: Put in a quick chef_gem "ruby-shadow"still gives the same error
[2013-12-23 19:52:30 -0500] jstump: :(
[2013-12-23 20:31:17 -0500] njero: Hey all, I am trying to install a cron job with chef and the cron lwrp and it is giving me an error: "Error executing action `create` on resource 'cron[backup]'" and "Error updating state of backup, exit: 1"  Here is the rest of the output http://pastie.org/private/krx0wrb6u95eziftp7jxrw
[2013-12-23 20:31:20 -0500] njero: Any idea?
[2013-12-23 20:36:55 -0500] helfire: is there a better way to import ca's instead of just appending them to this file /etc/pki/tls/certs/ca-bundle.crt in linux? it doesnt include others that are just in there it seems
[2013-12-23 20:52:15 -0500] bryanl: helfire: i use keytool for importing
[2013-12-23 20:54:09 -0500] helfire: keytool just does in java key stores though (which i still need to do
[2013-12-23 21:03:18 -0500] ktam: Hi, I saw another user posted having this issue in this channel earlier this morning but I didn't see a response - started getting a /users/username/.rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/tsort.rb:152:in `block in tsort_each': topological sort failed: ["windows", "powershell"] (TSort::Cyclic) error running librarian-chef update or librarian-chef install since this morning - worked as recently as friday, no changes to the cheffile.
[2013-12-23 21:04:13 -0500] jstump: ktam: Dude, just started getting this in my CI environment on a cookbook of mine. LITERALLY happened *between* builds. Haha
[2013-12-23 21:04:23 -0500] ktam: Any suggestions how to troubleshoot would be great: have uninstalled/reinstall librarian-chef/librarian gems, reinstalled ruby (and different version), started from scratch with a blank Cheffile
[2013-12-23 21:04:26 -0500] jstump: ktam: I (currently) have no solution.
[2013-12-23 21:04:54 -0500] brandont: any idea if cookbook code review is happening today?
[2013-12-23 21:05:12 -0500] ktam: @jstump, of course it happens right before christmas too
[2013-12-23 21:05:26 -0500] jstump: ktam: Haha, of course. Luckily we have egg nog to power us through.
[2013-12-23 21:06:51 -0500] ktam: @jstump, well, at least that's confirmation it's happened to at least 3 different people without any clear cause. Fingers crossed that something magically fixes itself when I get back from vacation, whee. Thanks for the response!
[2013-12-23 21:07:15 -0500] jstump: ktam: no problemo.
[2013-12-23 21:29:28 -0500] mattsurabian: what's the preferable way to check if a process is running by name?
[2013-12-23 21:29:45 -0500] mattsurabian: there's got to be something better than backtick in an else right?
[2013-12-23 21:57:41 -0500] coderanger: fnichol: So something I've been pondering, how hard do you think it would be to make TK pull back a junit XML file from each server after verification so it could display nicely formatted stuff (and produce its own xml output for jenkins et al)
[2013-12-23 22:07:20 -0500] mattsurabian: am I going crazy? This should be ok right?
[2013-12-23 22:07:22 -0500] mattsurabian: if `ps aux | grep "redis-server \*:#{redis_port}"` === ""
[2013-12-23 22:12:14 -0500] coderanger: mattsurabian: What are you trying to do?
[2013-12-23 22:13:15 -0500] mattsurabian: got an if else block with different logic depending on whether or not the redis server on the port is running or not
[2013-12-23 22:13:39 -0500] mattsurabian: the individual chunks of the if else work, but I'm not getting the expected results from that check
[2013-12-23 22:13:49 -0500] mattsurabian: seems like it's always coming back empty
[2013-12-23 22:14:26 -0500] mattsurabian: executing on the command line I get the expected results
[2013-12-23 22:14:35 -0500] mattsurabian: so I'm not really sure whats going on
[2013-12-23 22:17:07 -0500] coderanger: mattsurabian: Make sure you are taking into account that chef is a two-pass system
[2013-12-23 22:18:59 -0500] mattsurabian: coderanger: not sure that would burn me here
[2013-12-23 22:19:26 -0500] mattsurabian: must be something with how it's returning I guess?
[2013-12-23 22:19:37 -0500] mattsurabian: I can't even do a puts or print on it
[2013-12-23 22:19:40 -0500] mattsurabian: just get no output
[2013-12-23 22:19:51 -0500] coderanger: mattsurabian: Can you pastebin your code?
[2013-12-23 22:21:03 -0500] mattsurabian: http://pastebin.com/ZpCE6tVb
[2013-12-23 22:21:08 -0500] mattsurabian: pretty basic
[2013-12-23 22:21:36 -0500] mattsurabian: the logic within if and else works fine as it's been tested seperately
[2013-12-23 22:21:46 -0500] mattsurabian: it's really just that backtick chunk ?
[2013-12-23 22:23:17 -0500] coderanger: mattsurabian: So === is not what you think it is
[2013-12-23 22:23:26 -0500] coderanger: thats object identity checking
[2013-12-23 22:23:39 -0500] mattsurabian: right, shouldn't `` return a string?
[2013-12-23 22:23:49 -0500] coderanger: Yes, but == is for quality
[2013-12-23 22:23:52 -0500] coderanger: er, equality
[2013-12-23 22:24:01 -0500] coderanger: === is check if two objects are literally the same
[2013-12-23 22:24:12 -0500] coderanger: also you reeeeeally want to use mixlib-shellout for running subcommands
[2013-12-23 22:24:27 -0500] coderanger: and I would recommend doing the grep in Ruby code rather than using a shell pipeline
[2013-12-23 22:24:45 -0500] mattsurabian: for what it's worth I had == before
[2013-12-23 22:24:49 -0500] mattsurabian: still no luck
[2013-12-23 22:24:56 -0500] mattsurabian: like I said I can't even get output if doing this
[2013-12-23 22:25:23 -0500] mattsurabian: http://pastebin.com/TVeXW4k8
[2013-12-23 22:25:43 -0500] coderanger: >> `ps`[0..10]    => "  PID TTY  "
[2013-12-23 22:25:59 -0500] coderanger: Your paste shows a non-backtick though
[2013-12-23 22:26:11 -0500] coderanger: ` is a unicode backtick
[2013-12-23 22:26:19 -0500] coderanger: well, unicode backquote
[2013-12-23 22:26:25 -0500] mattsurabian: hmmmm wonder if that
[2013-12-23 22:26:33 -0500] mattsurabian: might have a lot to do with it
[2013-12-23 22:27:08 -0500] mattsurabian: not sure if I can use mixlib-shellout I'm using chef through rightscale :-(
[2013-12-23 22:27:57 -0500] coderanger: No idea, they forked Chef long ago I think
[2013-12-23 22:28:06 -0500] mattsurabian: unfortunately that's true
[2013-12-23 22:28:06 -0500] mattsurabian: heh
[2013-12-23 22:28:16 -0500] mattsurabian: workflow can be a bit jacked sometimes
[2013-12-23 22:28:24 -0500] mattsurabian: so my char encoding for ` is wrong??
[2013-12-23 22:28:27 -0500] coderanger: Calling it "chef" at this point is probably borderline untrue :P
[2013-12-23 22:28:35 -0500] coderanger: No idea, it might have just been when you pasted it
[2013-12-23 22:29:22 -0500] mattsurabian: I might just cheat and have upstart write me some files to check instead of this process list grep nonsense
[2013-12-23 22:30:00 -0500] coderanger: Basically don't use Redis because its Wrong
[2013-12-23 22:30:01 -0500] coderanger: :)
[2013-12-23 22:30:09 -0500] mattsurabian: hehehe
[2013-12-23 22:30:25 -0500] mattsurabian: would be nice if there was a reload but lehsigh
[2013-12-23 22:30:36 -0500] mattsurabian: have to send one off ops and write config to disk
[2013-12-23 22:30:54 -0500] mattsurabian: figured it'd be no problem but of course the final check is what's being the pain heh
[2013-12-23 22:31:41 -0500] coderanger: Perhaps this will help
[2013-12-23 22:31:42 -0500] coderanger: https://github.com/balanced-cookbooks/jenkins/blob/master/libraries/jenkins.rb#L405-L428
[2013-12-23 22:33:13 -0500] mattsurabian: yeah I thought about something like that, it's a bit brittle though
[2013-12-23 22:33:20 -0500] mattsurabian: no gaurantee it's redis listening on the port
[2013-12-23 22:33:26 -0500] mattsurabian: just that "SOMETHING" is on the port
[2013-12-23 22:33:35 -0500] coderanger: You can check that easily enough
[2013-12-23 22:33:39 -0500] coderanger: netstat -lntp
[2013-12-23 22:34:09 -0500] mattsurabian: sadly the program name column is -
[2013-12-23 22:34:11 -0500] mattsurabian: :-(
[2013-12-23 22:34:24 -0500] mattsurabian: - all the way down
[2013-12-23 22:34:25 -0500] mattsurabian: heh
[2013-12-23 22:34:37 -0500] mattsurabian: silly me thinking this would be one line
[2013-12-23 22:35:09 -0500] coderanger: It shows how to call stuff at least
[2013-12-23 22:35:14 -0500] coderanger: you can use the same idea for calling ps
[2013-12-23 22:35:25 -0500] mattsurabian: cheating with upstart is quickly running to the top of my list
[2013-12-23 22:35:32 -0500] mattsurabian: then I can drop the entire if else block
[2013-12-23 22:35:39 -0500] mattsurabian: and only start if the pid file exists
[2013-12-23 22:35:45 -0500] mattsurabian: errr DOESN'T exist
[2013-12-23 22:35:53 -0500] mattsurabian: lil not_if
[2013-12-23 22:53:47 -0500] jstump: mattsurabian: I've started targeting all of my cookbooks specifically at Ubuntu LTS 12.04 w/ Upstart scripts because Upstart is so awesome.
[2013-12-23 22:53:59 -0500] mattsurabian: it really is
[2013-12-23 22:54:11 -0500] jstump: mattsurabian: I've also been porting some of the community cookbooks to assume this.
[2013-12-23 22:54:19 -0500] mattsurabian: nice
[2013-12-23 22:54:24 -0500] stormerider: it's certainly a lot smaller config than sysv init scripts
[2013-12-23 22:54:33 -0500] jstump: Haha, indeed.
[2013-12-23 22:54:33 -0500] mattsurabian: hahah just a little :-p
[2013-12-23 22:54:36 -0500] stormerider: and a lot easier to config as a result
[2013-12-23 22:54:44 -0500] mattsurabian: replaced a 75 liner with a 3 liner the other day
[2013-12-23 22:54:48 -0500] mattsurabian: gotta love that
[2013-12-23 22:54:54 -0500] stormerider: plus i love the auto-restart feature
[2013-12-23 22:55:01 -0500] coderanger: jstump: Did you just claim upstart is awesome?
[2013-12-23 22:55:02 -0500] mattsurabian: that's why I got into it
[2013-12-23 22:55:07 -0500] jstump: This is kind of my goal w/ the project. Assume EC2, assume LTS, require tests, require SSL by default, assume Nginx proxies, etc.
[2013-12-23 22:55:24 -0500] jstump: coderanger: I did, but I'm sure there are neck beards who will disagree w/ me.
[2013-12-23 22:55:38 -0500] mattsurabian: coderanger: no love for upstart?
[2013-12-23 22:55:47 -0500] eliklein: has anyone run into something like this: "Failed to complete #converge action: [closed stream]"? This is coming up for me when I attempt to run multiple test-kitchen runs as a single user on a single box in a CI environment
[2013-12-23 22:55:50 -0500] coderanger: jstump: 1) woah strawman 2) upstart's ordering framework is insane
[2013-12-23 22:55:57 -0500] jstump: coderanger: I've used monit, God, libslack's daemon, deamontools, etc. I've found upstart to be a really nice mishmash of those.
[2013-12-23 22:56:06 -0500] eliklein: when i get that closed stream error, all my tk runs die simultaneously..
[2013-12-23 22:56:12 -0500] stormerider: i mean, i wish they would support the ability to run with reading pid files if specified in the config, as some $work scripts fork in a manner that doesn't play nicely, but i'm using bluepill for those.
[2013-12-23 22:56:28 -0500] eliklein: and running with a single executor works fine
[2013-12-23 22:56:30 -0500] coderanger: jstump: systemd is probably the best thing out there right now if you want to run Fedora, otherwise supervisor is way better.
[2013-12-23 22:57:11 -0500] Death_Syn: this neckbeard uses runit
[2013-12-23 22:57:28 -0500] Death_Syn: upstart is bearable
[2013-12-23 22:57:32 -0500] jstump: coderanger: As I mentioned I only run Ubuntu LTS. I've used supervisor before as well. I like that Upstart is baked into my distro. I've not run into any situation where Upstart didn't work while `daemon` or `supervisor` did.
[2013-12-23 22:57:34 -0500] coderanger: runit is shit, I mean its super solid tech, but the docs are effectively non-existent
[2013-12-23 22:57:37 -0500] Death_Syn: but any init that depends on dbus is probably not a good idea
[2013-12-23 22:57:53 -0500] Death_Syn: what's wrong with the man pages?
[2013-12-23 22:58:04 -0500] Death_Syn: it's so simple, there's not much docs required
[2013-12-23 22:58:33 -0500] coderanger: Death_Syn: Figure out how to send a sighup to restart something just from reading the man pages
[2013-12-23 22:58:34 -0500] stormerider: i havent played with a bunch of the newer systems like systemd, but upstart is pretty nice. i might not be accurate but it seemed to me that upstart came on the scene to revamp the architecture and then a bunch of variants also popped up. (daemontools has been around forever, but i personally hate it)
[2013-12-23 22:58:40 -0500] Death_Syn: sv h <service>
[2013-12-23 22:59:05 -0500] coderanger: Death_Syn: No, I mean learn how to use the magic control files
[2013-12-23 22:59:18 -0500] coderanger: Death_Syn: To even learn that exists you need to figure out `man runsv`
[2013-12-23 22:59:26 -0500] coderanger: which is so far from obvious it makes my head spen
[2013-12-23 22:59:28 -0500] coderanger: spin
[2013-12-23 22:59:46 -0500] coderanger: Death_Syn: Saying "I know how to use it" is very different from "it is easy to use"
[2013-12-23 22:59:58 -0500] stormerider: or "it is obvious how to use it"
[2013-12-23 22:59:59 -0500] Death_Syn: oh., i've been using it 10 years, guess it is just natural to me
[2013-12-23 23:00:02 -0500] coderanger: runit has a learning curve like running full speed into a brick wall
[2013-12-23 23:00:10 -0500] Death_Syn: but i was using daemontools before that
[2013-12-23 23:00:14 -0500] Death_Syn: runit made things simpler
[2013-12-23 23:00:19 -0500] coderanger: Death_Syn: And that statement explains a lot of the sorry state of our industry ;-)
[2013-12-23 23:00:31 -0500] stormerider: coderanger: truth.
[2013-12-23 23:00:38 -0500] coderanger: We become immune to our own complexity
[2013-12-23 23:00:53 -0500] stormerider: just because something is better doesnt make it good.
[2013-12-23 23:00:58 -0500] Death_Syn: yeah, but tools like upstart and systemd are like fixing a broken faucet with a particle accelerator
[2013-12-23 23:01:19 -0500] jstump: coderanger: It's called self-selection and confirmation bias. ;)
[2013-12-23 23:01:25 -0500] stormerider: personally, i like that upstart hooks into /sbin/service (even if it bitches)
[2013-12-23 23:02:05 -0500] coderanger: stormerider: No, thats terrible, I already have issues at work where people think that /sbin/service is the Right Way to check on the state of a service
[2013-12-23 23:02:13 -0500] coderanger: rather than using an actual control plane
[2013-12-23 23:02:42 -0500] coderanger: So we make fake wrapper init scripts for supervisor and runit services so that "service foo status" keeps working >_<
[2013-12-23 23:02:49 -0500] josephholsten: ooh, I think I just missed a good convo
[2013-12-23 23:03:01 -0500] stormerider: coderanger: again with the "i used something terrible" bias, i used centos long enough for it to become second nature
[2013-12-23 23:03:02 -0500] Death_Syn: if you link sv to init scripts, it does the job for you
[2013-12-23 23:03:53 -0500] coderanger: And yet the right way is to do this with an API against your monitoring layer because thats what it is there for :P
[2013-12-23 23:03:56 -0500] stormerider: i should caveat C5, i have no experience with C6
[2013-12-23 23:04:23 -0500] jstump: FWIW, I have zero issues with tried and true sysv init.d scripts. The main reasons for moving to Upstart were, as stormerider mentioned, it "just works" with Ubuntu tooling and it offered the basic process management I needed anyways. Seemed like a nicer happy medium than setting up init.d *and* God or monit scripts.
[2013-12-23 23:05:28 -0500] stormerider: coderanger: not sure i follow that, can you expound?
[2013-12-23 23:05:37 -0500] josephholsten: coderanger: when you say actual control plane, can you give an example of some project that does this well?
[2013-12-23 23:05:41 -0500] coderanger: stormerider: About which part? That was a lot of rants
[2013-12-23 23:05:47 -0500] coderanger: josephholsten: Easy, heroku
[2013-12-23 23:05:50 -0500] stormerider: the monitoring layer
[2013-12-23 23:05:53 -0500] Death_Syn: i use runit plus monit in my environment.. monit watches some processes for memory leaks and nicely calls sv q on them to make them recycle
[2013-12-23 23:05:55 -0500] jstump: coderanger: Speaking of monitoring layer, have you seen Sensu?
[2013-12-23 23:06:07 -0500] jstump: coderanger: It allows you to define remediation steps. Pretty nice.
[2013-12-23 23:06:13 -0500] coderanger: stormerider: Nagios/sensu/whatever should already know what services are up and do way more detailed checks
[2013-12-23 23:06:21 -0500] jstump: +1
[2013-12-23 23:06:27 -0500] Death_Syn: but nagios and sensu only check occasionally
[2013-12-23 23:06:33 -0500] Death_Syn: they won't immediately restart a downed service
[2013-12-23 23:06:40 -0500] coderanger: Death_Syn: That should be at least 1/s
[2013-12-23 23:06:41 -0500] jstump: Death_Syn: Sensu is queue based, you can get it down to 1 second intervals.
[2013-12-23 23:06:47 -0500] coderanger: Death_Syn: If not, fix your monitoring
[2013-12-23 23:06:50 -0500] josephholsten: coderanger: I'm not sure I follow. there's a bunch of things you might be referring to as a control plane in heroku
[2013-12-23 23:07:13 -0500] Death_Syn: coderanger: sounds like a good way to push load up massively
[2013-12-23 23:07:15 -0500] coderanger: josephholsten: If a dyno goes down, rather than worry about what happened it just zaps the container and spawns a new one
[2013-12-23 23:07:30 -0500] coderanger: Death_Syn: Load on what?
[2013-12-23 23:07:34 -0500] Death_Syn: i've got runsv sitting on top of processes, it uses less ram than the nagios checks
[2013-12-23 23:07:48 -0500] stormerider: mm. while i agree in theory, ive never worked at a place that had nagios configured for quick or fully covered monitoring to the point that i would want to depend on it in that fashion. but maybe in '14 once we get everything into chef :)
[2013-12-23 23:07:50 -0500] Death_Syn: my finish scripts also mail me when state changes
[2013-12-23 23:07:59 -0500] coderanger: Death_Syn: my collectd agents generally take less than 10M of RAM for all system checks
[2013-12-23 23:08:20 -0500] josephholsten: Death_Syn: I <3 that you would possibly bring ram usage into an env where we run chef
[2013-12-23 23:08:33 -0500] jstump: heheeeeee
[2013-12-23 23:08:39 -0500] mattsurabian: :-p
[2013-12-23 23:08:44 -0500] Death_Syn: yes, but how much processor time are they taking constantly checking on the process, versus being the parent that immediately gets control back when the child dies?
[2013-12-23 23:09:24 -0500] josephholsten: esp with cool kids running chef + logstash on each node. you're not wrong, but I would pay to see you actually convince someone with a ram based argument
[2013-12-23 23:09:41 -0500] stormerider: Death_Syn: i think that the concept is even if you wanted to do it in that fashion you still need monitoring of the process anyways in case it dies and restarting doesn't fix it
[2013-12-23 23:09:43 -0500] coderanger: Death_Syn: The CPU time to poke a control socket for runit or supervisor or upstart is so negligible you'll literally be unable to measure it I bet
[2013-12-23 23:09:47 -0500] coderanger: Death_Syn: Thats like 5 syscalls
[2013-12-23 23:10:07 -0500] coderanger: open(); write(); read();
[2013-12-23 23:10:12 -0500] coderanger: and maybe a stat or two
[2013-12-23 23:10:20 -0500] Death_Syn: i'll give it a bench sometime
[2013-12-23 23:12:47 -0500] coderanger: In related news, does nagios not monitor when stuff goes down even with runit?
[2013-12-23 23:12:48 -0500] jstump: josephholsten: That is the approach we take. We treat servers as people on Heroku treat Dynos.
[2013-12-23 23:12:51 -0500] coderanger: because thats totally a thing that happens
[2013-12-23 23:13:21 -0500] coderanger: Its especially fun when its something like a config syntax error and runit sits there trying to restart the thing 1000 times a second forever
[2013-12-23 23:13:22 -0500] jstump: coderanger: Oh fuck. I gave up on Nagios. Really love Sensu's "standalone" checks. You define the checks in the services rather than in the Nagios server.
[2013-12-23 23:13:35 -0500] coderanger: jstump: I use "nagios" as a generic term at this point
[2013-12-23 23:13:45 -0500] coderanger: jstump: Personally my alerting is all collectd -> riemann
[2013-12-23 23:14:14 -0500] jstump: coderanger: Word.
[2013-12-23 23:14:16 -0500] coderanger: jstump: Unfortunately sensu is fundamentally the wrong model
[2013-12-23 23:14:29 -0500] mattsurabian: I'm also all collectd, we're deployed using rightscale so all the alerts just fire off the collectd data
[2013-12-23 23:14:31 -0500] coderanger: jstump: (though it optionally supports the right one)
[2013-12-23 23:14:45 -0500] jstump: coderanger: I assume you mean the optional one being the standalone?
[2013-12-23 23:14:55 -0500] mattsurabian: I haven't noticed a ny impact with additional collectd daemons doing frequent polling
[2013-12-23 23:14:57 -0500] jstump: (Where the node reports to the server, rather than the server asking nodes it's configured to ask.)
[2013-12-23 23:15:07 -0500] coderanger: jstump: Yeah, as opposed to the master queuing checks
[2013-12-23 23:15:31 -0500] jstump: coderanger: Totally agree. I'm using only standalone checks for this reason.
[2013-12-23 23:15:57 -0500] coderanger: jstump: and once you're using that style, having rabbit in the mix makes little sense
[2013-12-23 23:16:24 -0500] jstump: coderanger: It isn't clear to me why they chose to require both Rabbit and Redis.
[2013-12-23 23:16:41 -0500] jstump: coderanger: And they get negative points for at least not making those abstract interfaces so I could use other options.
[2013-12-23 23:17:00 -0500] coderanger: jstump: Originally the plan was to make it more modular, just never happened
[2013-12-23 23:17:11 -0500] jstump: Ah, word.
[2013-12-23 23:17:24 -0500] coderanger: jstump: Sensu is still the best if you want something thats relatively drop in and worlds better than nagios
[2013-12-23 23:17:36 -0500] coderanger: jstump: Just as someone that knows what they want, I can do better :)
[2013-12-23 23:17:45 -0500] jstump: coderanger: Yeah, that was where I netted out, but I hadn't seen riemann.
[2013-12-23 23:18:10 -0500] coderanger: riemann is the best CEP framework I've ever seen
[2013-12-23 23:18:27 -0500] coderanger: I really need to write something up about what CEP is and why people need it
[2013-12-23 23:18:34 -0500] jstump: CEP?
[2013-12-23 23:18:40 -0500] coderanger: complex event processing
[2013-12-23 23:18:44 -0500] jstump: Oh, word.
[2013-12-23 23:18:50 -0500] josephholsten: +1
[2013-12-23 23:18:54 -0500] coderanger: data routing, processing, filtering, etc
[2013-12-23 23:19:08 -0500] coderanger: Like Riemann itself doesn't _do_ anything, its just a processing framework
[2013-12-23 23:19:23 -0500] coderanger: data flows in from collectd, and out to PD, graphite, logstash, etc
[2013-12-23 23:19:56 -0500] jstump: coderanger: Yeah, I'm seeing that. It's very similar to how Sensu handles things, but looks to be more generic (and therefore likely more robust/usable). Thanks for the tip!
[2013-12-23 23:20:05 -0500] josephholsten: too bad it's not distributed. but if you get a chance, listening to @aphyr explain why is a delightful rabbit hole into distributed queueing
[2013-12-23 23:20:23 -0500] coderanger: jstump: Yep, and almost 100% tool/process/environment agnostic
[2013-12-23 23:20:49 -0500] jstump: josephholsten: Distributed queues are really hard. I once had a phone call with the SQS lead who quickly laid out reasons why I shouldn't attempt such a thing. ;)
[2013-12-23 23:21:01 -0500] jstump: coderanger: I like. I'll look into this stuff.
[2013-12-23 23:22:13 -0500] josephholsten: jstump: are you the stu.mp guy?
[2013-12-23 23:22:28 -0500] jstump: josephholsten: That is me.
[2013-12-23 23:22:36 -0500] jstump: josephholsten: Well maybe, why? ;)
[2013-12-23 23:22:45 -0500] josephholsten: loved simplegeo
[2013-12-23 23:23:00 -0500] jstump: Ah, thanks. :)
[2013-12-23 23:23:04 -0500] jstump: I miss SimpleGeo Context. :(
[2013-12-23 23:23:33 -0500] coderanger: jstump: Unrelated, tell Justin I say happy birthday if he is still around the office :)
[2013-12-23 23:23:50 -0500] jstump: coderanger: He's OOO today. I think him and Tracy are holiday hacking. :)
[2013-12-23 23:23:58 -0500] coderanger: Also if there is a "damn you UA" bandwagon, I'm totally on board with that
[2013-12-23 23:23:59 -0500] jstump: coderanger: Are you a PDX'er?
[2013-12-23 23:24:04 -0500] coderanger: jstump: Nah, SF
[2013-12-23 23:24:07 -0500] jstump: Ah, word.
[2013-12-23 23:24:16 -0500] coderanger: jstump: Just also a Django-ite
[2013-12-23 23:25:02 -0500] jstump: Ah, nice. Our use of Django continues to shrink. It's basically just a glorified auth server and JSON serializer now.
[2013-12-23 23:25:13 -0500] coderanger: Yeah, I've not used it in years
[2013-12-23 23:25:24 -0500] coderanger: Hell, I've been writing Ruby and JS for the last 4 years :P
[2013-12-23 23:25:27 -0500] jstump: Node? Go?
[2013-12-23 23:25:32 -0500] jstump: I know. :(
[2013-12-23 23:25:42 -0500] coderanger: Frontend JS
[2013-12-23 23:25:55 -0500] jstump: The first time I used !== again in JS I literally screamed, "I THOUGHT I LEFT THIS SHIT BEHIND YEARS AGO?!"
[2013-12-23 23:27:20 -0500] coderanger: JS, because one man hacking together a DSL in 10 days to meet a deadline is totally what will power the future
[2013-12-23 23:27:46 -0500] jstump: Haha
[2013-12-23 23:28:29 -0500] jstump: coderanger: Near as I can tell Ruby tooling is DSLs all the way down.
[2013-12-23 23:29:00 -0500] coderanger: jstump: Ruby is at least better at it than most other things (except Lisp, but I lost that battle long ago)
[2013-12-23 23:29:35 -0500] jstump: coderanger: I find the tooling and approach to be somewhere in between the terribleness of PHP and the opinionated of Python.
[2013-12-23 23:30:28 -0500] tjr9898: I was trying to setup a standalone enterprise 11 server today, but it was having a problem connecting to a postgres server
[2013-12-23 23:31:00 -0500] tjr9898: Should I just install the a postgres server on the node before I run the private reconfig
[2013-12-23 23:31:14 -0500] tjr9898: The setup seems a little black boxish
[2013-12-23 23:31:39 -0500] coderanger: tjr9898: Not sure what you mean, it ships its own Postgres server internally
[2013-12-23 23:32:05 -0500] tjr9898: That's what I was thinking, but it stopped at the postgres install
[2013-12-23 23:32:22 -0500] tjr9898: You know the whole purpose of a standalone install
[2013-12-23 23:32:50 -0500] coderanger: tjr9898: Your best bet for enterprise support is to email support@opscode.com (or getchef.com if you don't think thats amazingly silly)
[2013-12-23 23:34:53 -0500] tjr9898: Well now that i'm actually looking.  It installed postgres but did not create the correct database
[2013-12-23 23:37:28 -0500] regork: Hi, a question about encrypted data bags? Can someone use them in a recipe if they don't have access to knife or chef backend? i.e. just someone who is writing a recipe and wants to store credentials (encrypted) in their cookbook?
[2013-12-23 23:37:48 -0500] coderanger: regork: There is a roughly 1% chance that that will address your needs
[2013-12-23 23:37:52 -0500] coderanger: regork: What are you trying to do?
[2013-12-23 23:38:03 -0500] regork: heh, what do you suggest?
[2013-12-23 23:38:35 -0500] coderanger: regork: One of manual provisioning, chef-vault, or citadel
[2013-12-23 23:38:43 -0500] regork: I maintain a Chef server but our users (writers of cookbooks) don't have access to ti.
[2013-12-23 23:39:27 -0500] regork: chef-vault? hmm...should read up on that.
[2013-12-23 23:39:57 -0500] coderanger: So the tl;dr is secrets management sucks, and is a super hard problem both from a crypto and infra perspective
[2013-12-23 23:40:20 -0500] coderanger: chef-vault is probably the easiest solution for most people right now, but it requires your infra be relatively stable and unchanging
[2013-12-23 23:40:54 -0500] regork: What's the big advantage of chef-vault over good old edbs?
[2013-12-23 23:41:31 -0500] coderanger: encrypted bags require you to manually transfer a secret (the symmetric decryption key) to all servers outside of Chef
[2013-12-23 23:41:39 -0500] jstump: coderanger: Do you use Kitchen CI per chance? Thoughts?
[2013-12-23 23:42:06 -0500] coderanger: If you have a system for doing that, you can just it to distribute your actual secrets and have much better failure domains
[2013-12-23 23:42:12 -0500] coderanger: jstump: I do, not sure how people survive without it
[2013-12-23 23:42:29 -0500] jstump: coderanger: Awesome to hear. I have my chef spec running in Travis-CI right now, but this looks super nice.
[2013-12-23 23:42:41 -0500] regork: Having listened to the foodfight show on secrets, chef-vault also uses symmetric encryption, right? Just that it's individualized per node iirc.
[2013-12-23 23:43:15 -0500] colagrb: jstump of Portland?
[2013-12-23 23:43:24 -0500] jstump: colagrb: That is me.
[2013-12-23 23:43:28 -0500] coderanger: regork: It bases the encrypt on the asym pair that already exists for chef API auth
[2013-12-23 23:46:30 -0500] regork: coderanger: that would be client.pem?
[2013-12-23 23:46:48 -0500] coderanger: regork: Thats the private key of each server
[2013-12-23 23:49:21 -0500] regork: coderanger: cool, let me download chef-vault and go over its source, thx!
[2013-12-23 23:49:57 -0500] coderanger: regork: As long as you don't start or stop servers often, chef-vault is probably your best bet right now
[2013-12-23 23:50:21 -0500] regork: yes, uptime is in the months for us.
[2013-12-23 23:51:30 -0500] coderanger: Long term, I'm hoping Barbican turns into something that does secrets management decently well
