[2013-10-21 00:21:43 -0400] Majost_: Is there a clever way to read a node attribute into a library variable
[2013-10-21 00:26:19 -0400] Majost_: this makes me think the answer is a certain "no": https://github.com/opscode/chef/blob/1bb1a934fe397874b86ec00d6aff2df7b3eb6017/lib/chef/run_context/cookbook_compiler.rb#L69-L75
[2013-10-21 00:27:44 -0400] Majost_: If it was a lwrp opposed to a library I am guessing I could pickup the attributes
[2013-10-21 00:34:05 -0400] noahmehl: Hey all, I'm working on a cookbook, and I'm having trouble installing a .deb package after extracting it
[2013-10-21 00:34:08 -0400] noahmehl: I read the manual
[2013-10-21 00:34:14 -0400] noahmehl: and I'm trying to add the extracted file with http://docs.opscode.com/resource_remote_file.html
[2013-10-21 00:34:24 -0400] noahmehl: but I'm not quite understanding the syntax
[2013-10-21 00:34:35 -0400] noahmehl: basically, I download a sfx archive
[2013-10-21 00:34:38 -0400] noahmehl: then I extract it
[2013-10-21 00:34:55 -0400] noahmehl: all in the {Chef::Config[:file_cache_path]}
[2013-10-21 00:35:01 -0400] noahmehl: but when I goto add the remote_file
[2013-10-21 00:35:08 -0400] noahmehl: I don't understand what I should use for the name
[2013-10-21 00:35:31 -0400] noahmehl: and the source doesn't seem to work with: "file://#{Chef::Config[:file_cache_path]}/folder/package/package.deb"
[2013-10-21 00:35:37 -0400] noahmehl: any ideas?
[2013-10-21 00:35:52 -0400] noahmehl: btw, I'm trying to create a cookbook for PBIS open
[2013-10-21 00:51:24 -0400] noahmehl: nvm
[2013-10-21 00:51:32 -0400] noahmehl: i'll just distribute the package with the cookbook
[2013-10-21 00:51:38 -0400] noahmehl: but, that's probably not the best way to do it
[2013-10-21 01:45:12 -0400] Majost_: noahmehl, can you post a gist of the cookbook and error?
[2013-10-21 01:45:44 -0400] noahmehl: Majost_: yeah, just a second
[2013-10-21 01:46:12 -0400] noahmehl: Majost_: I already dumped the recipe I was working on
[2013-10-21 01:46:15 -0400] noahmehl: but this was the error:
[2013-10-21 01:46:16 -0400] noahmehl: [2013-10-21T00:39:23+00:00] ERROR: Connection refused connecting to : for /tmp/vagrant-chef-1/pbis-open-7.5.2.1527.linux.x86_64.deb.sh/file:///tmp/vagrant-chef-1/pbis-open-7.5.2.1527.linux.x86_64.deb.sh, retry 1/5
[2013-10-21 01:46:27 -0400] noahmehl: basically, I had created a remote_file
[2013-10-21 01:47:26 -0400] Majost_: sounds like there was a syntax error
[2013-10-21 01:47:31 -0400] noahmehl: with the source of: "file://#{Chef::Config[:file_cache_path]}/pbis-open-7.5.2.1527.linux.x86_64.deb.sh"
[2013-10-21 01:47:32 -0400] Majost_: but I would need to see it to be sure
[2013-10-21 01:47:40 -0400] noahmehl: Majost_: I can try again later
[2013-10-21 01:50:27 -0400] noahmehl: Majost_: I fail for not versioning my work :(
[2013-10-21 01:51:04 -0400] noahmehl: I'm going to step away for a bit, but I do appreciate your help :)
[2013-10-21 02:08:40 -0400] Majost_: np
[2013-10-21 02:45:23 -0400] bastilian: is there a way i can have databags, nodes locally in my chef-repo instead of on opscode.com?
[2013-10-21 04:26:35 -0400] noahmehl: Majost: hey
[2013-10-21 04:26:36 -0400] noahmehl: yt?
[2013-10-21 04:40:37 -0400] titusjose: Wanted to know if a custom report handler can be installed and executed in same chef-client run
[2013-10-21 04:44:26 -0400] samsonasu: any ideas why bundler wouldn't run when I'm deplying a rails app using application_ruby.  I'm specifying bundler true in the config and it just skips it
[2013-10-21 05:02:10 -0400] noahmehl: Majost: I'm dumb, I should have been using the file resource, and not the remote_file resource
[2013-10-21 06:44:26 -0400] flaccid_: coderanger: going to finally address this! https://github.com/coderanger/chef-collectd/pull/4
[2013-10-21 07:04:56 -0400] mhulan: will there ever be support for organizations (multi tenancy) in open-source version of chef?
[2013-10-21 07:16:34 -0400] flaccid_: mhulan: probably not the right place to ask
[2013-10-21 07:17:07 -0400] mhulan: flaccid_: where's the right place then?
[2013-10-21 07:17:45 -0400] linuxboy: hello. Does anyone here use chef-solo under vagrant? I've got some strange gem issues with the mysql cookbook. It looks like the gem isn't being installed under the chef's embedded ruby
[2013-10-21 07:17:46 -0400] flaccid_: mhulan: not sure, opscode product management wherever they are :)
[2013-10-21 07:18:29 -0400] flaccid_: linuxboy: #vagrant . the box should use the omnibus chef
[2013-10-21 07:18:39 -0400] mhulan: so why community does not built it by itself? :-)
[2013-10-21 07:18:45 -0400] linuxboy: flaccid_: I've done that, I'll ask in there
[2013-10-21 07:18:55 -0400] flaccid_: mhulan: you are part of the community
[2013-10-21 07:20:21 -0400] mhulan: flaccid_: ok, the question should have been put this way, is there some effort already?
[2013-10-21 07:22:06 -0400] flaccid_: mhulan: no idea, try google :)
[2013-10-21 07:57:07 -0400] jaykatta: Hi
[2013-10-21 07:57:26 -0400] jaykatta: Response:  Invalid signature for user or client 'user1'
[2013-10-21 07:57:34 -0400] jaykatta: may I knw how to fix that error?
[2013-10-21 07:58:27 -0400] jaykatta: -query : Response:  Invalid signature for user or client 'user1', how to fix this error..?
[2013-10-21 07:59:37 -0400] ezotrank: rm -rf /etc/chef/*.pem and regenerate new pem key for this client?
[2013-10-21 08:03:22 -0400] jaykatta: rm -rf /etc/chef/*.pem needs to execute on cleint machine?
[2013-10-21 08:04:11 -0400] ezotrank: yes
[2013-10-21 08:04:35 -0400] jaykatta: newly generated private key should be names as ?
[2013-10-21 08:20:14 -0400] jaykatta: -query : Response:  Invalid signature for user or client 'user1', how to fix this error..?
[2013-10-21 08:39:03 -0400] laurent\: superbaloo: bonjour, btw where does chef11.tgz come from ?
[2013-10-21 08:40:42 -0400] laurent\: nico: not been affected by https://tickets.opscode.com/browse/CHEF-3975 ?
[2013-10-21 08:42:12 -0400] superbaloo: laurent\: this is just work from a teammate of nico
[2013-10-21 08:42:33 -0400] superbaloo: which brings /etc/{default,init.d}/chef-client
[2013-10-21 08:43:31 -0400] laurent\: superbaloo: oh ok, i haven't really looked at it, i thought it was a tgz of chef-server :)
[2013-10-21 08:43:42 -0400] nico: laurent\: checking; not sure we use that expression
[2013-10-21 08:44:27 -0400] laurent\: nico: i guess you don't :)
[2013-10-21 08:45:02 -0400] nico: git grepping
[2013-10-21 08:45:27 -0400] nico: we do use it
[2013-10-21 08:45:36 -0400] nico: hmm
[2013-10-21 08:46:10 -0400] nico: got to look at stuff; but if it had broke I think I'd be aware as we would not have host in nagios anymore :)
[2013-10-21 08:47:07 -0400] superbaloo: laurent\: actally i was using a .tgz for the gist which made difficult embedding static files, now it's a real git repo, i can just extract the tgz into the git repo
[2013-10-21 08:47:59 -0400] nico: laurent\: oh, we don't use it for databags
[2013-10-21 08:48:04 -0400] nico: only attributes
[2013-10-21 08:48:12 -0400] laurent\: lucky you :)
[2013-10-21 09:07:44 -0400] arussel: I'm trying to debug a recipe on a node with chef-shell, I've loaded the recipe and I'm trying to run a template resource
[2013-10-21 09:08:08 -0400] arussel: it fails with: Chef::Exceptions::CookbookNotFound
[2013-10-21 09:08:22 -0400] arussel: Cookbook  not found. If you're loading  from another cookbook, make sure you configure the dependency in your metadata
[2013-10-21 09:09:08 -0400] arussel: I'm not really sure what cookbook the template resource is looking for. I've run a directory, remote_file and bash resource previously without problem
[2013-10-21 09:10:37 -0400] Cope: ohai
[2013-10-21 09:10:50 -0400] jonlives: arussel: can you gist the recipe / cookbook please?
[2013-10-21 09:11:37 -0400] arussel: Cope: do you mean it is missing hte ohai cookbook ?
[2013-10-21 09:12:30 -0400] Cope: arussel: no... I just mean "ohai" :)
[2013-10-21 09:12:38 -0400] Cope: as in: hello, good morning
[2013-10-21 09:12:42 -0400] jonlives: arussel: that's the chef way of saying good morning :p
[2013-10-21 09:12:59 -0400] arussel: jonlives: https://gist.github.com/arussel/7080897
[2013-10-21 09:13:42 -0400] arussel: great, I've been on chef for a month, and I don't even get when people say good morning ...
[2013-10-21 09:13:47 -0400] jonlives: arussel: in metadata.rb for that cookbook, are there any dependancies listed?
[2013-10-21 09:14:13 -0400] arussel: jonlives: no
[2013-10-21 09:14:52 -0400] arussel: I've followed: http://blog.vicecity.co.uk/post/58905064410/chef-11-libraries-and-lwrp-testing-in-chef-shell to load the recipe
[2013-10-21 09:15:05 -0400] arussel: I really have a hard time debugging recipe
[2013-10-21 09:15:05 -0400] jonlives: arussel: it's this one? http://community.opscode.com/cookbooks/java-wrapper
[2013-10-21 09:15:11 -0400] arussel: yes
[2013-10-21 09:16:25 -0400] jonlives: let's have a looksee
[2013-10-21 09:17:26 -0400] arussel: I'm copy/pasting each resource and running them in the shell, it blows when I try to run the template one, so I'm assuming the java-wrapper cookbook isn't loaded and the template source isn't found, how can I verify this ?
[2013-10-21 09:18:10 -0400] jonlives: arussel: ah, I hadn't grokked this was in the shell...when you first run it, it should tell you what recipes it's loaded.
[2013-10-21 09:18:55 -0400] arussel: I'm actually loading manually the recipe following: http://blog.vicecity.co.uk/post/58905064410/chef-11-libraries-and-lwrp-testing-in-chef-shell
[2013-10-21 09:19:25 -0400] glen: hi. how can i handle exceptions from remote_file successfully?
[2013-10-21 09:19:40 -0400] arussel: jonlives: is there a way to ask which recipe is loaded ?
[2013-10-21 09:19:42 -0400] jonlives: arussel: what do you get when you type node.run_list?
[2013-10-21 09:19:44 -0400] jonlives: ^^
[2013-10-21 09:20:20 -0400] arussel:  => recipe[java-wrapper]
[2013-10-21 09:20:42 -0400] arussel: (I'm in recipe_mode)
[2013-10-21 09:20:50 -0400] jonlives: ok, so it's loaded the cookbook
[2013-10-21 09:22:03 -0400] arussel: jonlives: the complete stack trace might help: http://pastebin.com/tC2dqiQW
[2013-10-21 09:22:32 -0400] arussel: I would understand template not found, but cookbook not found, I don't get it.
[2013-10-21 09:23:27 -0400] jonlives: arussel: I'd guess it's complaining because it's trying to look up variables passed to the template and can't find them.
[2013-10-21 09:24:16 -0400] jonlives: arussel: in recipe mode, what happens if you do include_recipe "java-wrapper"
[2013-10-21 09:24:38 -0400] jonlives: arussel: then do run_chef
[2013-10-21 09:25:22 -0400] arussel: [2013-10-21T09:25:11+00:00] DEBUG: I am not loading java-wrapper, because I have already seen it.
[2013-10-21 09:25:40 -0400] jonlives: ok, so it's definitely loaded it.
[2013-10-21 09:25:53 -0400] arussel: and I get the same error than when copy/pasting each resource
[2013-10-21 09:26:10 -0400] jonlives: when you do run_chef?
[2013-10-21 09:26:15 -0400] arussel: yes
[2013-10-21 09:26:41 -0400] jonlives: ok one sec...
[2013-10-21 09:29:00 -0400] arussel: note that I'm more trying to find a good workflow to debug recipe than trying to debug this particular recipe. This recipe does have an error, but in the second template section, not the first one;
[2013-10-21 09:29:36 -0400] jonlives: one sec, trying to replicate
[2013-10-21 09:36:17 -0400] jonlives: arussel: ok, replicated - looking for the issue
[2013-10-21 09:37:26 -0400] jonlives: arussel: ah right I think I see what it's doing - lemme see if I can find the right way to do what you want
[2013-10-21 09:47:30 -0400] bcave: morning
[2013-10-21 09:53:41 -0400] bcave: i was wondering if someone could help with using "notifies" and the different phases of a chef client run
[2013-10-21 09:55:15 -0400] bcave: in 1 of my recipes, I have a "template" block defined. The template references variables that need to be configured by ruby code. Initially, I have the ruby in-line (which was executed during the resource phase), and the variables were globally accessible
[2013-10-21 09:55:43 -0400] bcave: because of initialization requirements, I moved the configuration of the variables into a ruby block....
[2013-10-21 09:59:15 -0400] bcave: so the variables are now defined in a ruby block, and are not accessible in the template block
[2013-10-21 10:02:03 -0400] bcave: how would I make the variables from a ruby block available to a template block?
[2013-10-21 10:03:40 -0400] jonlives: arussel: I've had zero success getting chef-shell to load resources from a cookbook in standalone mode. If the cookbook is on my chef server and I run chef-shell in client mode, it works fine
[2013-10-21 10:04:01 -0400] jonlives: arussel: maybe worth uploading the cookbook to your server and trying that way?
[2013-10-21 10:05:19 -0400] arussel: jonlives: thanks a lot for your help. I was hoping to be able to have a very short test/fix cycle where I could just type  a resource in the shell and run it.
[2013-10-21 10:05:26 -0400] jonlives: it *should* work the way you're trying it, but chef-shell really doesn't seem to like loading recources from a local cookbook.
[2013-10-21 10:05:55 -0400] jonlives: if anyone else manages to figure out how to get that to work, please let me know, cos it's pissing me off :p
[2013-10-21 10:06:03 -0400] arussel: :-)
[2013-10-21 10:06:13 -0400] arussel: I'll keep trying and asking :-)
[2013-10-21 10:06:27 -0400] arussel: it would save me so much time to be able to do it
[2013-10-21 10:07:34 -0400] jonlives: arussel: indeed - the annoying thing is that it *should* totally be possible.
[2013-10-21 10:07:53 -0400] jonlives: arussel: I'll dig into it more later and see if I can get to the bottom of it
[2013-10-21 10:12:15 -0400] bcave: or alternatively....
[2013-10-21 10:16:23 -0400] bcave: will an "include_recipe" execute all phases in the included recipe before any phases in the current (i.e. the "execute" phase of included is completed before the "resources" phase of current) ?
[2013-10-21 10:57:19 -0400] ikrima: stupid question, macports comes as a default resource in chef right?
[2013-10-21 11:03:37 -0400] ocholetras: anyone knows why array attributes are merged when same level, except when you declare it on recipes?
[2013-10-21 11:03:38 -0400] ocholetras: O_o
[2013-10-21 11:15:52 -0400] arussel: ocholetras: you're talking about https://coderanger.net/2013/06/arrays-and-chef/
[2013-10-21 11:19:28 -0400] ikrima: why do i keep getting "No such file or directory" when trying to use the macports_package resource?
[2013-10-21 11:45:21 -0400] ocholetras: arussel: yea posted that link 2 days ago ^^
[2013-10-21 11:45:50 -0400] ocholetras: but the behaviour on recipes still doing wrong..
[2013-10-21 11:46:14 -0400] ocholetras: at same precedence level, the recipe value overrides the one that is on the attribute file.
[2013-10-21 11:46:17 -0400] ocholetras: both default attributes
[2013-10-21 11:46:32 -0400] ocholetras: when you put it on a role, they both are merged
[2013-10-21 11:46:51 -0400] ocholetras: like say here: http://docs.opscode.com/essentials_node_object_deep_merge.html#addition
[2013-10-21 11:48:46 -0400] legal90: Hi guys! 'remote file' is very cool LWPR, but downloaded files still placing in the Chef Cache directory.  Does anybody know a gracefull method to delete them after?
[2013-10-21 11:59:07 -0400] Cope: Mithrandir: do you have/recommenda centos varnishcookbook
[2013-10-21 12:03:55 -0400] bcave: can someone point out how / where I am going wrong?  I'm looking at encrypted data bags, and testing out a few ways of getting the secret key to the node
[2013-10-21 12:04:04 -0400] bcave: 1 method is by fetching it from a remote service
[2013-10-21 12:04:21 -0400] bcave: Here's the gist of it: https://gist.github.com/brettcave/7082764
[2013-10-21 12:05:24 -0400] bcave: the load_secret fails, with an "invalid zero length secret" error. if i check the file, it exists with the expected contents
[2013-10-21 12:05:35 -0400] Cope: wow so much encrypted data bag pain
[2013-10-21 12:05:50 -0400] bcave: but it's almost like the load_secret is running before the file has been persisted to disk
[2013-10-21 12:06:55 -0400] bcave: lol Cope. for that example?
[2013-10-21 12:16:09 -0400] Cope: bcave: it's just that it seems that several times a day I see people complaining about encrypted data bags
[2013-10-21 12:16:18 -0400] Cope: every day
[2013-10-21 12:19:01 -0400] bcave: Ah, ok. I don't know if it's databag specific. I'm guessing you could replicate by doing something like a File.open("/downloaded_file","r") do |file| log file.contents
[2013-10-21 12:19:12 -0400] bcave: instead of a "load_secrets" call
[2013-10-21 12:19:49 -0400] bcave: it seems that the recipe continues executing, trying to load the secret key file before it's been properly written and closed.
[2013-10-21 12:20:53 -0400] Cope: you're using chef11?
[2013-10-21 12:25:20 -0400] bcave: yep
[2013-10-21 12:25:49 -0400] bcave: 11.6
[2013-10-21 12:26:37 -0400] Cope: I've seen race conditions with chef 10
[2013-10-21 13:02:57 -0400] bcave: workaround: sleep 3
[2013-10-21 13:05:37 -0400] bigbigbang: Hi chefs ! Does someone knows how can I perfom this : partial_search(:node, "passwd:#{user} AND hostname:#{hostname} AND NOT shell:/sbin/nologin OR NOT shell:/bin/bash OR NOT shell:/bin/ksh ") ? My #{users} and #{hostname} works, I just can't find a way for the end of my query : AND NOT shell OR NOT ...
[2013-10-21 13:06:13 -0400] bigbigbang: If i can use some braket or something like this it would be great but I can't find the rifht syntazx ..
[2013-10-21 13:06:59 -0400] ascendantlogic: Have you tried grouping it via parentheses?
[2013-10-21 13:08:29 -0400] bigbigbang: ascendantlogic: I only have tried with [] something like this ... AND NOT shell:["/sbin/nologin","/bin/bash","/bin/ksh"] but dose'nt work will try with ()
[2013-10-21 13:09:51 -0400] ascendantlogic: Can you query the shell value and then use ruby and do an "unless @shells.include?([shell1, shell2])"?
[2013-10-21 13:10:15 -0400] ascendantlogic: So take the shell query out of your chef search and use ruby logic instead?
[2013-10-21 13:10:42 -0400] ascendantlogic: Obviously it's cleaner to have all the conditions in one query but I'm usually all about getting it working and then trying to refactor to something "cleaner"
[2013-10-21 13:11:04 -0400] legal90: Is there some fluent way to clear Chef Cache folder?
[2013-10-21 13:11:20 -0400] ascendantlogic: during a run or just as maintenance?
[2013-10-21 13:11:57 -0400] legal90: during a run. I want to clear cache in the end of chef-client(solo) execution
[2013-10-21 13:11:58 -0400] ascendantlogic: hmm, not sure
[2013-10-21 13:12:23 -0400] bigbigbang: thanks ascendantlogic , if I can't find a way for a 'one query' with chef search, will try xomething in ruby ..
[2013-10-21 13:15:15 -0400] ascendantlogic: no problem. Good luck
[2013-10-21 13:31:46 -0400] bigbigbang: me again .. This work : partial_search(:node, "passwd:#{user} AND hostname:#{hostname} AND  shell:/sbin/nologin \|\| shell:/bin/bash \|\| shell:/bin/ksh") do |matching_node|  ... but If I type AND NOT shell ....  it doesn't work .. can't figure out why ...
[2013-10-21 13:32:04 -0400] shlomo: Hi folks
[2013-10-21 13:32:42 -0400] shlomo: I have lots of cookbook_files in a cookbook's files/default dir and lots of templates in the templates dir
[2013-10-21 13:32:56 -0400] shlomo: How do I get a list of the files that are there programmatically?
[2013-10-21 13:36:04 -0400] shlomo: To make that clearer: In the following statement, what do I put here instead of "LIST_ALL_FILES_IN_THIS_COOKBOOKS_files_default_DIR" ?:
[2013-10-21 13:36:20 -0400] shlomo: [LIST_ALL_FILES_IN_THIS_COOKBOOKS_files_default_DIR].each do |file|
[2013-10-21 13:36:24 -0400] ocholetras: No "rare" files uploaded with the cookbook to the server, but ERROR: undefined method `close!' for nil:NilClassERROR: undefined method `close!' for nil:NilClass
[2013-10-21 13:36:26 -0400] ocholetras: so wtF
[2013-10-21 13:36:27 -0400] ocholetras: ?
[2013-10-21 13:36:35 -0400] shlomo:   # copy this file somewhere
[2013-10-21 13:36:36 -0400] shlomo: end
[2013-10-21 14:04:10 -0400] mihai_omniosuser: hi all
[2013-10-21 14:04:38 -0400] mihai_omniosuser: maybe someone can help me, I am so new to chef that I do know where to start
[2013-10-21 14:04:58 -0400] mihai_omniosuser: I have Host os Fedora
[2013-10-21 14:05:13 -0400] mihai_omniosuser: guest os Centos
[2013-10-21 14:05:27 -0400] mihai_omniosuser: I wasnt ot use vagrant to have virtual machines with centos
[2013-10-21 14:05:43 -0400] mihai_omniosuser: so I have the virtual machine it boots and works.
[2013-10-21 14:06:07 -0400] ocholetras: http://www.opscode.com/training/
[2013-10-21 14:06:23 -0400] kevinrsa: anyone here with some experience installing sql server on a windows 2008 machine?
[2013-10-21 14:07:14 -0400] mihai_omniosuser: I would like to use chef to install stuff on the guest os
[2013-10-21 14:08:00 -0400] mihai_omniosuser: I did found docs on the web, I am not yet familiar with the concept so I need to understand in order to use chef-solo for thsi simple setup
[2013-10-21 14:08:35 -0400] mihai_omniosuser: where chef needs to be installed? knife? is this needed? what is this?
[2013-10-21 14:08:37 -0400] mihai_omniosuser: thank you!
[2013-10-21 14:11:08 -0400] TCMSLP: mihai_omniosuser: The tutorial at http://www.opscode.com/training/ covers most of what you're asking.  It included using chef to 'bootstrap' a new VM.
[2013-10-21 14:11:21 -0400] bigbigbang: ^^
[2013-10-21 14:11:42 -0400] TCMSLP: I do not know chef at all, but followed this tutorial to bootstrap an AWS instance.
[2013-10-21 14:11:52 -0400] mihai_omniosuser: TCMSLP: looking at it right now. thans!
[2013-10-21 14:12:36 -0400] TCMSLP: No problem, it's not difficult, I'm sure people here will help if you hit problems
[2013-10-21 14:15:36 -0400] ascendantlogic: mihai_omniosuser: knife is installed on your laptop/desktop/wherever you are and is what you use to bootstrap servers with chef
[2013-10-21 14:16:05 -0400] ascendantlogic: I use a self-hosted chef server so I also use knife to interact with that server
[2013-10-21 14:16:23 -0400] ascendantlogic: I don't have much experience with chef solo outside of Vagrant, so I can't really speak to that
[2013-10-21 14:16:29 -0400] TCMSLP: ascendantlogic: How much extra stress is there in using a self hosted chef server?
[2013-10-21 14:16:42 -0400] ascendantlogic: not much, although I wasn't the one that set it up
[2013-10-21 14:16:49 -0400] ascendantlogic: so I can't speak to what the last guy went through
[2013-10-21 14:17:05 -0400] ascendantlogic: but most of my stress comes from gem and cookbook dependency hell ><
[2013-10-21 14:17:19 -0400] ascendantlogic: but I think that's not something specific to using chef server
[2013-10-21 14:17:23 -0400] s2r2: TCMSLP: it's easy with the omnibus packages
[2013-10-21 14:17:47 -0400] s2r2: TCMSLP: and it's incredibly easy using chef-solo and the chef-server cookbook ;)
[2013-10-21 14:17:59 -0400] ascendantlogic: chef bootstrapping chef
[2013-10-21 14:18:03 -0400] ascendantlogic: or should I say, chef inceptioning chef
[2013-10-21 14:18:41 -0400] bigbigbang: any knife query expert here ? I can't firgure out why this work : partial_search(:node, "passwd:#{user} AND hostname:#{hostname} AND shell:/sbin/nologin OR shell:/bin/bash OR shell:/bin/ksh ") do |matching_node|    and not this : [....]AND NOT shell:/sbin/nologin OR NOT shell:/bin/bash OR NOT shell:/bin/ksh " ..       plz help !
[2013-10-21 14:19:15 -0400] bigbigbang: precedence probleme here ?
[2013-10-21 14:21:07 -0400] BriGuy: is there any way to have the template resource use a HTTP source like remote_file - or if not, use a template file with remote_file?
[2013-10-21 14:30:00 -0400] bigbigbang: it seem's that I resolved my issue, I have to use NOR in my query... never saw this option in the knife search page... I hope i 'm not wrong again  :-)
[2013-10-21 14:31:03 -0400] ascendantlogic: NOR? interesting
[2013-10-21 14:31:33 -0400] bigbigbang: yeah , I'm trying it right now to chek if thix works ..
[2013-10-21 14:32:27 -0400] spstarr_work: Question
[2013-10-21 14:32:46 -0400] spstarr_work: my recipe config is not getting values  from my environment.rb file
[2013-10-21 14:32:51 -0400] spstarr_work: for example:   default[:cloudpassage_linux][:daemon_key]
[2013-10-21 14:33:39 -0400] spstarr_work: in my environment.rb file I put default_attributes({ "cloudpassage_linux" => {"daemon_key" =>  "value" }})
[2013-10-21 14:33:59 -0400] spstarr_work: should this work? will the cookbook recipe get the value from my environment.rb ?
[2013-10-21 14:33:59 -0400] mihai_omniosuser: TCMSLP: that is a classs :) I have no time now for it:) but thanks anyway
[2013-10-21 14:34:33 -0400] spstarr_work: if i just do "cloudpassage_linux" =>  { "daemon_key" => "Value" }} I get no value in recipe output
[2013-10-21 14:34:36 -0400] mihai_omniosuser: ascendantlogic: thank you , that was the answer I was hoping to get :)
[2013-10-21 14:35:03 -0400] mihai_omniosuser: ascendantlogic: so then I heve knife on my host and chef on the guest?
[2013-10-21 14:35:11 -0400] spstarr_work: or more importantly what is difference of default[:variable][:variable] vs  default[variable][variable] without ':' ?
[2013-10-21 14:35:19 -0400] ascendantlogic: yes
[2013-10-21 14:36:00 -0400] mihai_omniosuser: and now a more advanced question, is it there a way to install chef automated ?
[2013-10-21 14:36:11 -0400] TCMSLP: mihai_omniosuser: apologies, wrong link
[2013-10-21 14:36:22 -0400] TCMSLP: mihai_omniosuser: https://learnchef.opscode.com/quickstart/workstation-setup/
[2013-10-21 14:36:37 -0400] TCMSLP: mihai_omniosuser: I used an AWS instance in place of VirtualBox & Vagrant
[2013-10-21 14:36:50 -0400] mihai_omniosuser: so I have a new virtual machine and how do I get chef deplyed wiythout intervetnion?
[2013-10-21 14:37:41 -0400] mihai_omniosuser: TCMSLP: now we are on the same page. thet is cool. thank you!
[2013-10-21 14:37:52 -0400] ascendantlogic: depends where you're spinning up the new virtual machine
[2013-10-21 14:37:57 -0400] TCMSLP: mihai_omniosuser: You have your destination VM built, ssh access enabled, ideally a user with sudo privs - knife will then connect as that user, escalate privs, install chef, then run through all the cookbooks associated
[2013-10-21 14:37:58 -0400] ascendantlogic: there are knife plugins for EC2, Rackspace, etc
[2013-10-21 14:38:35 -0400] spstarr_work: oh keys.. ruby
[2013-10-21 14:38:37 -0400] mihai_omniosuser: TCMSLP: all right then thank you!
[2013-10-21 14:38:39 -0400] ascendantlogic: so for instance I have the ec2 plugin and a script that does "knife ec2 server create" and I specify a bunch of parameters and a run list of roles/recipes
[2013-10-21 14:38:48 -0400] ascendantlogic: it creates the server and then bootstraps chef onto it for me
[2013-10-21 14:38:49 -0400] ascendantlogic: all in one shot
[2013-10-21 14:39:02 -0400] s2r2: plus: it plants the proper ohai hints
[2013-10-21 14:39:28 -0400] TCMSLP: ascendantlogic: That sounds great - I'd suggest following the tutorial first though, it only takes 15 minutes and covers much of the basics :)
[2013-10-21 14:39:40 -0400] ascendantlogic: right
[2013-10-21 14:39:48 -0400] ascendantlogic: crawl before you run
[2013-10-21 14:39:55 -0400] ascendantlogic: one step at a time, etc ;)
[2013-10-21 14:39:56 -0400] TCMSLP: ascendantlogic: doing voodoo with the ec2 API sounds good though!
[2013-10-21 14:40:10 -0400] ascendantlogic: it's nice to not have to manually spin up boxes if I don't want to
[2013-10-21 14:40:22 -0400] ascendantlogic: I usually manually spin up my EC2 instances for one-offs and random stuff
[2013-10-21 14:40:35 -0400] ascendantlogic: but we have scripts for setting up entire stacks of servers for our applications
[2013-10-21 14:40:43 -0400] ascendantlogic: and that's where we use the EC2 plugin
[2013-10-21 14:41:01 -0400] TCMSLP: ascendantlogic: I'm still a newbie - I was amazed how simple it was to bootstrap with chef
[2013-10-21 14:41:10 -0400] TCMSLP: My previous experiences with puppet were not so smooth
[2013-10-21 14:41:15 -0400] mihai_omniosuser: TCMSLP: I am using an environment with no internet. is there an non registered  knife
[2013-10-21 14:41:39 -0400] ascendantlogic: Yeah, I haven't worked with Puppet. Chef is really nice
[2013-10-21 14:41:55 -0400] ascendantlogic: but it's not a panacea...Chef has its own problems
[2013-10-21 14:42:07 -0400] ascendantlogic: usually revolving around gem and/or cookbook dependency conflicts
[2013-10-21 14:42:14 -0400] ascendantlogic: but that's usually once your setup starts getting pretty complex
[2013-10-21 14:42:17 -0400] TCMSLP: mihai_omniosuser: I'm guessing without internet you'll need your own chef server.
[2013-10-21 14:42:27 -0400] mihai_omniosuser: I want chef solo
[2013-10-21 14:42:32 -0400] TCMSLP: yeah, that's the one
[2013-10-21 14:42:32 -0400] mihai_omniosuser: no Internet
[2013-10-21 14:42:37 -0400] ascendantlogic: Chef solo should be able to bootstrap without internet
[2013-10-21 14:42:45 -0400] bigbigbang: or even with chef opens-source ..
[2013-10-21 14:42:53 -0400] ascendantlogic: because you'll have all your cookbooks locally on your desktop
[2013-10-21 14:43:01 -0400] ascendantlogic: and they will just get uploaded to your VM
[2013-10-21 14:43:08 -0400] mihai_omniosuser: well, I just want my host and my VM
[2013-10-21 14:43:15 -0400] mihai_omniosuser: I cloned the git coockbooks
[2013-10-21 14:43:35 -0400] ascendantlogic: mihai_omniosuser: Is your VM on the same machine you are?
[2013-10-21 14:43:37 -0400] mihai_omniosuser: but the doc says that this knife wants to check credentials ...
[2013-10-21 14:43:40 -0400] ascendantlogic: if so, look into Vagrant
[2013-10-21 14:43:45 -0400] ascendantlogic: which will automate some of the chef-solo stuff for you
[2013-10-21 14:43:58 -0400] mihai_omniosuser: yes vm on the same machine
[2013-10-21 14:44:10 -0400] ascendantlogic: http://www.vagrantup.com/
[2013-10-21 14:44:15 -0400] mihai_omniosuser: I came to the channel to nunderstand the concept.
[2013-10-21 14:44:22 -0400] mihai_omniosuser: and thank you for that
[2013-10-21 14:44:31 -0400] ascendantlogic: lets you set up VM's in VirtualBox or VMWare and specify chef-solo cookbooks and stuff to run
[2013-10-21 14:44:39 -0400] mihai_omniosuser: I already understood that knife is in the Host and chef is in the Guest
[2013-10-21 14:45:06 -0400] mihai_omniosuser: now  I was wondering how to automate chef install
[2013-10-21 14:45:15 -0400] ascendantlogic: http://docs.vagrantup.com/v2/provisioning/chef_solo.html
[2013-10-21 14:45:16 -0400] mihai_omniosuser: I have already a machine, whitout chef
[2013-10-21 14:46:02 -0400] mihai_omniosuser: and is my base machine, I wasnted to found out hpw wopuld be chef installed there without me ssh-ing in
[2013-10-21 14:47:31 -0400] mihai_omniosuser: so I'm getting there :)
[2013-10-21 14:48:13 -0400] ascendantlogic: Chef definitely has a learning curve to it. Don't get frustrated though since the payoff is pretty big
[2013-10-21 14:48:52 -0400] mihai_omniosuser: ascendantlogic: I can see the benefits already :) I will be pationt. thank you!
[2013-10-21 14:49:06 -0400] ascendantlogic: :)
[2013-10-21 14:49:55 -0400] bigbigbang: mihai_omniosuser:  perhaps i don't understand you clearly, you just want to install chef server ? without ssh-ing ? what about the package opscode provides ? http://www.opscode.com/chef/install/
[2013-10-21 14:50:22 -0400] mihai_omniosuser: bigbigbang: no chef server , chef-solo
[2013-10-21 14:50:27 -0400] ascendantlogic: He wants to use chef-solo
[2013-10-21 14:50:33 -0400] ascendantlogic: to provision VM's locally on his laptop/desktop
[2013-10-21 14:50:35 -0400] bigbigbang: mihai_omniosuser: ok I know I missed something ..
[2013-10-21 14:50:46 -0400] ascendantlogic: which is why I pointed him towards Vagrant, which makes that a lot easier
[2013-10-21 14:50:57 -0400] mihai_omniosuser: but I do not have some links in my understanding
[2013-10-21 14:51:15 -0400] mihai_omniosuser: so now I know knife from host does stuff on guest using chef
[2013-10-21 14:51:53 -0400] ascendantlogic: yep, knife will ssh onto the guest using the username and password or key you specify, upload the cookbooks, bootstrap chef and then run the specified roles/recipes
[2013-10-21 14:52:48 -0400] mihai_omniosuser: awsome, that is what I was missing :) thans!
[2013-10-21 14:54:49 -0400] ascendantlogic: no problem :)
[2013-10-21 14:55:26 -0400] TCMSLP: As a newbie the options are very confusing;  chef hosted, chef server, chef solo, vagrant...
[2013-10-21 14:55:45 -0400] ascendantlogic: Vagrant isn't really part of the chef ecosystem
[2013-10-21 14:55:50 -0400] ascendantlogic: Vagrant is a way to manage VM's for development
[2013-10-21 14:56:03 -0400] ascendantlogic: it can use Chef, or Puppet, or Ansible (I think) to provision the VM
[2013-10-21 14:56:09 -0400] ascendantlogic: maybe even SaltStack
[2013-10-21 14:56:24 -0400] mihai_omniosuser: ok guys see you tomorrow gtg
[2013-10-21 14:56:27 -0400] ascendantlogic: Vagrant is just there to help you create development environments that match your production environments
[2013-10-21 14:56:35 -0400] ascendantlogic: take it easy mihai
[2013-10-21 14:56:54 -0400] ascendantlogic: chef-solo is for very simple tasks, such as provisioning dev VM's
[2013-10-21 14:56:58 -0400] ascendantlogic: so you can see how those two work well together
[2013-10-21 14:57:06 -0400] mveitas: Wanted to get some thoughts about the use of 'Roles' vs using a cookbook to represent a "Role".  I have heard rumors that Roles will be versioned in a future Chef release
[2013-10-21 14:57:24 -0400] TCMSLP: Oh I see *checks vagrant web* - the way the Opscode tutorial talks about it makes it sound like part of chef.  Admittedly I skipped that section and used AWS instead - perhaps that's where my misunderstanding came from.
[2013-10-21 14:57:27 -0400] ascendantlogic: chef-server and chef-hosted do the same thing...create a central place to hold Chef data for management of large-scale infrastructure
[2013-10-21 14:57:52 -0400] ascendantlogic: the difference is do you want to host the server and manage it or pay Opscode to do it for you
[2013-10-21 14:58:15 -0400] ascendantlogic: versioning roles would be really nice
[2013-10-21 14:58:36 -0400] ascendantlogic: I don't use role-based attribute overrides because of the versioning issue
[2013-10-21 14:58:55 -0400] ascendantlogic: Just using roles to group cookbooks is fine though, so I'd say it's 6 of one, half a dozen of the other
[2013-10-21 14:59:11 -0400] ascendantlogic: I also don't use environment-based attribute overrides either, for the same reason
[2013-10-21 14:59:14 -0400] ascendantlogic: except for one special case
[2013-10-21 14:59:23 -0400] ascendantlogic: that is truly environment-based across multiple cookbooks
[2013-10-21 15:00:02 -0400] mveitas: I was going to have roles just be empty markers that make searching for servers a bit easier
[2013-10-21 15:00:12 -0400] ascendantlogic: that's a valid use of them
[2013-10-21 15:01:37 -0400] TCMSLP: I'm still learning how all this stuff fits together
[2013-10-21 15:01:58 -0400] TCMSLP: I spent the last couple of weeks learning Ruby - so I could understand why things are laid out the way they ae
[2013-10-21 15:02:02 -0400] TCMSLP: are
[2013-10-21 15:02:36 -0400] ascendantlogic: The biggest complaint I had with Chef was how complicated it seemed when I didn't understand it
[2013-10-21 15:02:48 -0400] ascendantlogic: There are a few moving parts to a good setup
[2013-10-21 15:02:54 -0400] ascendantlogic: environments, roles, data bags, cookbooks
[2013-10-21 15:03:18 -0400] ascendantlogic: I still don't fully know about attribute precedence. I go to the page for that and my eyes glaze over
[2013-10-21 15:03:24 -0400] ascendantlogic: and then I black out and wake up 10 minutes later
[2013-10-21 15:03:41 -0400] TCMSLP: How long have you been working with Chef?
[2013-10-21 15:03:46 -0400] ascendantlogic: about 6 months now
[2013-10-21 15:03:55 -0400] ascendantlogic: I'm an Android developer professionally, or was
[2013-10-21 15:04:02 -0400] ascendantlogic: before I had to step into the devops role here at my company ;)
[2013-10-21 15:04:10 -0400] ascendantlogic: I also know enough Rails to be dangerous to nearby servers
[2013-10-21 15:05:12 -0400] TCMSLP: Rails is a mystery to me.  I keep reading gotchas "x in y in Ruby, unless you're in rails then it's completely the opposite" or similar.  I figured it's best avoided ;)
[2013-10-21 15:07:25 -0400] ascendantlogic: heh
[2013-10-21 15:07:36 -0400] ascendantlogic: A lot of people (myself included) learn Ruby by doing Rails first
[2013-10-21 15:07:42 -0400] ascendantlogic: Rails is its own beast
[2013-10-21 15:07:43 -0400] cpuguy83: TCMSLP: If you say so.
[2013-10-21 15:08:10 -0400] ascendantlogic: Rails has a niche, and that's getting a webapp up and running really fast
[2013-10-21 15:08:17 -0400] cpuguy83: Rails is just a collection of stuff to make web dev's life easier.  It has a lot of sane defaults so you worry about code, not configuration.
[2013-10-21 15:08:24 -0400] ascendantlogic: once you go into maintenance/scaling mode though, it's not as awesome
[2013-10-21 15:08:47 -0400] cpuguy83: ascendantlogic: I completely disagree.
[2013-10-21 15:09:12 -0400] DeadZen: cpuguy83: then you've lost all credibility
[2013-10-21 15:09:32 -0400] cpuguy83: How is it hard to maintain or scale?
[2013-10-21 15:09:39 -0400] ascendantlogic: Well
[2013-10-21 15:09:45 -0400] ascendantlogic: I didn't say it was hard to maintain or scale
[2013-10-21 15:09:51 -0400] ascendantlogic: I said it wasn't as awesome at that point
[2013-10-21 15:10:02 -0400] ascendantlogic: Rails is fantastic when you're first writing the app
[2013-10-21 15:10:31 -0400] cpuguy83: What makes it "less awesome"?
[2013-10-21 15:10:57 -0400] TCMSLP: I'm not a dev btw - even OOP was new to me.  Rails just seemed confusing but then I'm not used to having stuff done for me.
[2013-10-21 15:11:28 -0400] ascendantlogic: Well for one...and this isn't an issue with Rails...Ruby GC sucks
[2013-10-21 15:11:36 -0400] cpuguy83: Tracking down bugs is no different than any other Ruby project, except you are encouraged to TDD your Rails code, and tests are setup for you.
[2013-10-21 15:11:38 -0400] ascendantlogic: stop-the-world GC kills me
[2013-10-21 15:11:43 -0400] ascendantlogic: yes
[2013-10-21 15:11:44 -0400] cpuguy83: ascendantlogic: Use Rubinius or JRuby
[2013-10-21 15:11:52 -0400] ascendantlogic: Right, that's the go-to answer
[2013-10-21 15:12:04 -0400] ascendantlogic: but I work at a company...with 20ish devs...and a big project that's somewhat mature
[2013-10-21 15:12:08 -0400] ascendantlogic: can't just flip the switch on that overnight
[2013-10-21 15:12:10 -0400] cpuguy83: GC is not Rail's problem.
[2013-10-21 15:12:26 -0400] ascendantlogic: right, I said it's not a rails problem
[2013-10-21 15:12:27 -0400] cpuguy83: ascendantlogic: Well, you could with Rubinius, most likely.
[2013-10-21 15:12:35 -0400] ascendantlogic: but it's a problem that Rails deals with because of its marriage to Ruby
[2013-10-21 15:12:56 -0400] ascendantlogic: a lot of Rails problems comes from people and ecosystem too
[2013-10-21 15:13:11 -0400] ascendantlogic: too many devs that crank out a new app, then when it comes time for maintenance they're on to the next big thing
[2013-10-21 15:13:26 -0400] cpuguy83: JRuby you'd have to swap out some gems to replace C-Extensions, _maybe_ a few other things here and there, but still it's Ruby.
[2013-10-21 15:13:32 -0400] ascendantlogic: Yep
[2013-10-21 15:13:41 -0400] ascendantlogic: trust me, I don't dislike Rails
[2013-10-21 15:14:03 -0400] ascendantlogic: It's this beautiful magical thing when you're writing your app
[2013-10-21 15:14:31 -0400] ascendantlogic: I got into Rails back in the 1.x days
[2013-10-21 15:14:34 -0400] ascendantlogic: so it was a real mess back then
[2013-10-21 15:16:03 -0400] cpuguy83: My point is, a lot of people says Rails has issues with X or Y, but can't point out an example.  It's nothing more than a stigma
[2013-10-21 15:16:19 -0400] ascendantlogic: Well Rails used to have very real scaling problems
[2013-10-21 15:16:25 -0400] ascendantlogic: especially in the pre-mongrel days
[2013-10-21 15:16:39 -0400] cpuguy83: Ruby webapps had scaling issues.
[2013-10-21 15:16:50 -0400] cpuguy83: Well... Ruby had scaling issues.
[2013-10-21 15:20:25 -0400] TCMSLP: So, using Rails you don't have to worry about CGI posts etc, it's more an event driven framework with 'routes'?
[2013-10-21 15:21:02 -0400] bean_: TCMSLP: this the #chef room. Some of us probably have rails experience, but you're probably better off asking rails questions in #rubyonrails
[2013-10-21 15:21:14 -0400] LeBop: Hi, can someone help me please with a problem? I have this variable
[2013-10-21 15:21:14 -0400] LeBop: plain   = "sudo chef-solo -c #{vm.config.recipe.chef} -j #{vm.config.recipe.json} --override-runlist"
[2013-10-21 15:21:15 -0400] LeBop: but when I print it, it returns
[2013-10-21 15:21:15 -0400] LeBop: udo chef-solo -c #<Vagrant::Config::V2::DummyConfig:0x0000000454eb48> -j #<Vagrant::Config::V2::DummyConfig:0x00000004550650> --override-runlist
[2013-10-21 15:21:36 -0400] TCMSLP: bean_: Sure, I was just curious really.  Apologies if it's too off topic.
[2013-10-21 15:21:39 -0400] LeBop: does anyone know how to transform that pointer into the actual value?
[2013-10-21 15:22:29 -0400] LeBop: you cand find the entire code here https://github.com/rsimiciuc/vagrant-recipe/blob/master/lib/vagrant-recipe/command.rb
[2013-10-21 15:24:31 -0400] s2r2: LeBop: just a quick thought -- have you set up a chef-solo provisioner in your vagrantfile
[2013-10-21 15:24:38 -0400] s2r2: ...?  i guess it needs one.
[2013-10-21 15:25:21 -0400] LeBop: yes
[2013-10-21 15:25:30 -0400] LeBop: if i run the command manually.. it works
[2013-10-21 15:25:56 -0400] LeBop: the problem is that my plugin tries to execute "chef-solo -c #<Vagrant::Config::V2::DummyConfig:0x0000000454eb48> -j #<Vagrant::Config::V2::DummyConfig:0x00000004550650> --override"
[2013-10-21 15:26:08 -0400] LeBop: with those pointers instead of the actual value
[2013-10-21 15:28:13 -0400] ascendantlogic: sounds like you're interpolating the object instead of some value contained within the object
[2013-10-21 15:28:44 -0400] ascendantlogic: like "#{DummyConfig}" instead of "#{DummyConfig.some_string_value}"
[2013-10-21 15:29:05 -0400] TCMSLP: LeBop: Not something as stupid as requiring quotes is it?
[2013-10-21 15:36:50 -0400] s2r2: hmm https://github.com/rsimiciuc/vagrant-recipe/blob/master/lib/vagrant-recipe/config.rb#L7
[2013-10-21 15:39:02 -0400] LeBop: what about that line?
[2013-10-21 15:39:20 -0400] s2r2: nothing that's where the referenced accessor is...
[2013-10-21 15:39:53 -0400] s2r2: LeBop: got your Vagrantfile somewhere already?
[2013-10-21 15:40:06 -0400] LeBop: https://github.com/p0deje/vagrant-exec/blob/master/lib/vagrant-exec/config.rb
[2013-10-21 15:40:14 -0400] LeBop: my plugin is a fork from vagrant-exe
[2013-10-21 15:40:20 -0400] LeBop: which does the same
[2013-10-21 15:40:43 -0400] LeBop: I have no idea about ruby... but I just changes a lines of code for my plugin
[2013-10-21 15:40:48 -0400] LeBop: but it seems it does not work
[2013-10-21 15:40:59 -0400] LeBop: and I can not figure out why
[2013-10-21 15:41:04 -0400] s2r2: Tried #vagrant? ;)
[2013-10-21 15:41:18 -0400] workmad3: LeBop: going to take the hint and try #vagrant soon? :P
[2013-10-21 15:42:27 -0400] LeBop: here is my Vagrant file
[2013-10-21 15:42:27 -0400] LeBop: http://pastebin.com/YT2G2ue8
[2013-10-21 15:43:04 -0400] s2r2: hmm so the variables should all have their default settings
[2013-10-21 15:44:53 -0400] LeBop: yes
[2013-10-21 15:45:04 -0400] LeBop: in vagrant-exec it works for the folder variable
[2013-10-21 15:47:12 -0400] s2r2: LeBop: vagrant-exec doesn't reference its config in that way, though: https://github.com/p0deje/vagrant-exec/blob/master/lib/vagrant-exec/command.rb#L62-L68
[2013-10-21 15:47:39 -0400] s2r2: not sure what it does, but it doesn't pass "vm.config.exec.bundler" verbatim into a shell command
[2013-10-21 15:49:38 -0400] LeBop: it does this
[2013-10-21 15:49:38 -0400] LeBop: https://github.com/p0deje/vagrant-exec/blob/master/lib/vagrant-exec/command.rb#L14
[2013-10-21 15:49:43 -0400] sparr: I'm storing information about what a node's network configuration should be. I decided to put it in a data bag previously, but am considering that custom node attributes might be more appropriate. Thoughts?
[2013-10-21 15:50:13 -0400] LeBop: where vm.config.exec.folder is a config variable like mines
[2013-10-21 15:50:57 -0400] s2r2: LeBop: true.
[2013-10-21 15:51:15 -0400] ascendantlogic: @sparr using attributes in a cookbook is certainly easier to deal with instead of the added step of managing and searching the data bags
[2013-10-21 15:51:37 -0400] ascendantlogic: I generally only use data bags for when I need encrypted values like API keys and credentials
[2013-10-21 15:51:42 -0400] ascendantlogic: otherwise I go with cookbook attributes
[2013-10-21 16:19:56 -0400] gchristensen: so how do people prevent chef from breaking the world? ex: I have tests for a recipe and ran them, pushed the cookbook to staging and it worked fine, in production a bug was exposed and quickly wrote out to all the webheads bringing everything down. obviously I wrote a test and fixed it, but I'd rather not break the world.
[2013-10-21 16:21:15 -0400] jmartin: gchristensen: do rolling updates? coordinate with ZK maybe?
[2013-10-21 16:21:22 -0400] chris613: gchristensen: We never run chef without reviewing the --why-run output first.
[2013-10-21 16:21:53 -0400] chris613: Have created a dashboard in splunk that lets us review all of the changes that chef is proposing to make. It's not perfect, but it's far better than just running it and cleaning up afterwards
[2013-10-21 16:22:41 -0400] gchristensen: jmartin: right now I run every 5min with a 300s splay. I don't have ZooKeeper, but the company's initials are ZK so I was confused at first :) ... chris613: so do you manually run chef in those machines? watch the -W output in splunk and then run it individually?
[2013-10-21 16:23:28 -0400] yvan_: coderanger: Question... I need to postpone the evaluation of a command until the chef run reaches the command (no pre-validation). Any idea how would I do this ?
[2013-10-21 16:23:59 -0400] jlast: Question: What is the proper way to get the response body from http_request provider?
[2013-10-21 16:24:13 -0400] gchristensen: maybe set the run frequency to every 10 minutes with a 300s splay to avoid breaking the world *quite* so fast, but I do want it regular and automatic - it has brought a lot of value to this org
[2013-10-21 16:27:14 -0400] danryan: yvan_: have you looked at http://docs.opscode.com/resource_ruby_block.html ?
[2013-10-21 16:28:29 -0400] chris613: gchristensen: Essentially, yes, we run it manually. When it comes time to do the run we essentially do `knife ssh '...' -- chef-client` to hit all the nodes
[2013-10-21 16:28:51 -0400] gchristensen: got it
[2013-10-21 16:28:58 -0400] gchristensen: chris613: how many nodes are you working with, if I may?
[2013-10-21 16:29:09 -0400] chris613: gchristensen: ~500
[2013-10-21 16:29:23 -0400] gchristensen: thank you
[2013-10-21 16:29:47 -0400] yvan_: danryan: I did check this. Basically I need to run an executable and retreive the output outside the ruby block.
[2013-10-21 16:29:55 -0400] chris613: We run a real-time service (asterisk mostly) so running chef on a short frequency is not an option; too each to break things from unauited changes, and even if we don't the sudden gulp of RAM can be damaging to our service
[2013-10-21 16:30:21 -0400] gchristensen: ahh that makes sense
[2013-10-21 16:31:05 -0400] spstarr_work: Can someone tell me the difference between these two variable references:     command "sudo /etc/init.d/cphalod start --daemon-key=#{node[:cloudpassage_linux]['daemon_key']} --tag=#{node[:cloudpassage_linux][:tag]}"  ?
[2013-10-21 16:31:28 -0400] gchristensen: chris613: I get a lot of value out of auto-running on a highly regular basis, because I have a PHB which likes to muckity muck in the configurations, this scares him away
[2013-10-21 16:31:41 -0400] spstarr_work: im having difficulties with staging.rb (environment)  roles (myrole.rb)  cookbook attributes/default.rb
[2013-10-21 16:31:54 -0400] spstarr_work: the ordering if who sets what and why one of those is a key and the other a string?
[2013-10-21 16:33:53 -0400] chris613: gchristensen: When we see spurious entries in our why run dashboard we hunt down the offenders
[2013-10-21 16:36:17 -0400] oofoof: so, here's a fun one (not a n00b) - i'm trying to set up opensource chef-server 11 in the tiered configuration, and not having a lot of luck bootstrapping.  anyone tried to just get erchef running on a node, talking to a different backend server/collection?
[2013-10-21 16:37:39 -0400] yvan_: Question: I need to run an executable and retreive the returned output within a recipe. How would I do this?
[2013-10-21 16:38:17 -0400] gchristensen: yvan_: the execute block probably
[2013-10-21 16:38:24 -0400] sfalcon: oofoof: should totally be possible, but not well tested :( What have you tried and where are you running into problems?
[2013-10-21 16:38:40 -0400] oofoof: notably, the chef-server omnibus installer doesn't drop a chef-server.rb in place
[2013-10-21 16:39:04 -0400] yvan_: gchristensen: it only returns (int) return codes. No text.
[2013-10-21 16:39:15 -0400] gchristensen: yvan_: you may need to use the bash block for it
[2013-10-21 16:39:20 -0400] coderanger: yvan_: execute resource?
[2013-10-21 16:39:21 -0400] oofoof: i'm running a totally functional normal full "back & front" end install on machine Z, and then trying to add a tiered set of load balanced frontend erchef workers on "a,b,c,d" servers.
[2013-10-21 16:39:22 -0400] sfalcon: oofoof: that's true, but fairly easy to address? And then in chef-server.rb you'd enable/disable the various services
[2013-10-21 16:39:55 -0400] oofoof: i've been trying to change the chef-server attributes to "false" on the backend components and then run chef-server-ctl reconfigure to do the right hting and regen the configs
[2013-10-21 16:40:27 -0400] oofoof: so, 1) why don't i get a chef-server.rb on a functiononw opensource 11 install (ie: even on Z, it's not there)
[2013-10-21 16:40:34 -0400] yvan_: coderanger: Nope. A windows exe that returns a string value that I could put in a variable then use the value later on in the recipe.
[2013-10-21 16:40:49 -0400] oofoof: and 2) is modify attributes / re-run chef-server-ctl the recommended path for these sorts of changes?
[2013-10-21 16:40:51 -0400] coderanger: yvan_: ruby_block resource + shellout
[2013-10-21 16:41:08 -0400] coderanger: yvan_: and make sure you use the new lazy attribute mode
[2013-10-21 16:41:20 -0400] yvan_: coderanger: shellout ?
[2013-10-21 16:41:47 -0400] coderanger: yvan_: https://github.com/opscode/chef/blob/master/lib/chef/mixin/shell_out.rb#L43
[2013-10-21 16:41:50 -0400] yvan_: gchristensen: sorry .... i am in windows.
[2013-10-21 16:42:08 -0400] gchristensen: powershell block? yvan_
[2013-10-21 16:42:09 -0400] sfalcon: oofoof: 1) I don't think there's a good reason for initial install not to include /etc/chef-server/chef-server.rb. Patch :) 2) Yes, general plan would be modify chef-server.rb and then run c-s-c reconfigure to apply the changes.
[2013-10-21 16:42:34 -0400] sfalcon: oofoof: the chef-server cookbook does include the config file and might provide a good starting point for driving the install that you're interested in.
[2013-10-21 16:43:08 -0400] coderanger: yvan_: In general it would be better to figure out how to make more isolated idempotent blocks, but sometimes its just simpler to do it the way you describe
[2013-10-21 16:43:09 -0400] oofoof: ok.  then 3) in re: patch; i'm getting chef-server-running.json.  is that the "old" chef-server.rb / am i missing an upgrade/patch?  I'm running 11.0.8-1.
[2013-10-21 16:43:15 -0400] oofoof: (also, thank you thank you!)
[2013-10-21 16:44:20 -0400] sfalcon: oofoof: chef-server-running.json captures values from the bootstrapped server -- you're not missing a version -- and you will expect to see that even if you have an /etc/chef-server/chef-server.rb file.
[2013-10-21 16:44:40 -0400] yvan_: coderanger: I will take a look at shellout and be back to you.
[2013-10-21 16:45:00 -0400] sfalcon: So when the server bootstraps itself, it generates pg passwords, e.g., which go in that json file so that you don't reset the world on each reconfigure.
[2013-10-21 16:45:30 -0400] oofoof: interresting
[2013-10-21 16:48:06 -0400] oofoof: yeah, the thing that I think is happening is that there's no case logic around read-the-attributes, then don't-run-the-config-create-for-that-block foo.  ie: i disable postgress, run c-s-c reconfig and it still tries to generate the postgress config.
[2013-10-21 16:48:33 -0400] oofoof: i'm going to try to generate a fully clean runnign chef-server.rb, and then strip it out for use on my workers.
[2013-10-21 16:51:04 -0400] oofoof: the fun part is that chef-server-running is json, and chef-server should be ruby :)
[2013-10-21 16:54:24 -0400] jchauncey: can you use an already defined LWRP attribute as part of a default in another attribute defined in the same file?
[2013-10-21 16:54:43 -0400] jchauncey: so I define an attribute :foo and I would like to use :foo as part of a default in another attribute :bar
[2013-10-21 16:58:12 -0400] mattupstate: anyone successfully using the x509 cookbook?
[2013-10-21 17:08:09 -0400] CPS: if I create an Environment in the web ui, how do i download it to the workstation? is git's responsibility?
[2013-10-21 17:08:57 -0400] jmickle: anyone have a good way to merge a hash into a default hash
[2013-10-21 17:09:00 -0400] jmickle: to pass through cookbooks?
[2013-10-21 17:09:16 -0400] dgarstang2: Anyone using google compute? How are you building images?
[2013-10-21 17:09:28 -0400] dgarstang2: ... to be later used by chef. :)
[2013-10-21 17:24:59 -0400] memelet: How does one debug an error of: "Chef::Exceptions::MultipleFailures: Chef::Exceptions::MultipleFailures
[2013-10-21 17:24:59 -0400] memelet: "? The entire stacktrace is internal chef code.
[2013-10-21 17:25:44 -0400] memelet: mixlib-shellout was the last call, but no additional info.
[2013-10-21 17:44:30 -0400] jose__: Hi,
[2013-10-21 17:45:07 -0400] jose__: Is there a way to read/write tags in a recipe from onther node?
[2013-10-21 17:46:57 -0400] alxism: Hi guys, the chef server 'Status' page shows the Last Check-in time of each node. Do you know if that information is stored in a node attribute? If so, which one?
[2013-10-21 17:47:46 -0400] sfalcon: alxism: part of the automatic attributes "ohai" data, yes.
[2013-10-21 17:48:21 -0400] alxism: [:ohai][:ohai_time] ?
[2013-10-21 17:48:22 -0400] CPS: if I create an Environment in the web ui, how do i download it to the workstation? is git's responsibility?
[2013-10-21 17:48:39 -0400] alxism: lol I mean ['ohai']['ohai_time']
[2013-10-21 17:48:42 -0400] alxism: ?
[2013-10-21 17:49:48 -0400] objectiveous: What's the convention for making file systems? I looked for a mkfs recipe but didn't come across anything obvious.
[2013-10-21 17:50:02 -0400] dgarstang2: How can I recover a chef admin user password?
[2013-10-21 17:50:39 -0400] alxism: @ sfalcon: is the attribute node['ohai'] ?
[2013-10-21 17:50:40 -0400] sfalcon: alxism: I think just node['ohai_time']
[2013-10-21 17:50:44 -0400] alxism: thx
[2013-10-21 17:50:54 -0400] sfalcon: e.g. knife search node role:blah -a ohai_time
[2013-10-21 17:51:00 -0400] yvan_: coderanger: don't know why but aImost everyting I put in a ruby_block is not executed! I put a Chef::Log and an execute cmd. the Log is written but not the command.
[2013-10-21 17:51:14 -0400] mondo: Is anyone managing RHN Channel Subscriptions with Chef?
[2013-10-21 17:51:26 -0400] alxism: @sfalcon thanks
[2013-10-21 17:51:28 -0400] coderanger: yvan_: please pastebin the recipe code, I can take a quick look
[2013-10-21 17:52:50 -0400] yvan_: coderanger: Hold on. Someone else here will try.
[2013-10-21 17:53:46 -0400] dgarstang2: How can I recover a chef admin user password?
[2013-10-21 17:54:45 -0400] jose__: Hi guys, Is there a way to read/write tags in a recipe from another node? I only see tag('mytag'), untag('mytag') and istagged?('mytag') which can't be pointed to another node
[2013-10-21 18:04:35 -0400] oofoof: ah ha.  sfalcon - I see that I'm not the first with this question:  http://www.opscode.com/blog/2013/03/11/chef-11-server-up-and-running/#comment-826855282
[2013-10-21 18:06:01 -0400] coderanger: jose__: You can read them via the search API
[2013-10-21 18:06:12 -0400] coderanger: jose__: By default (and I wouldn't recommend changing it) you can't write them
[2013-10-21 18:06:50 -0400] coderanger: jose__: search(:node, 'name:whatever').first['tags'].include?('mytag')
[2013-10-21 18:07:24 -0400] jose__: Why I shouldn't write them?
[2013-10-21 18:08:05 -0400] jose__: I need to maintain the state of some nodes
[2013-10-21 18:08:28 -0400] jose__: and then from another node decide based on the state
[2013-10-21 18:09:01 -0400] jose__: Imagine like this: One node is load balancer and many other nodes are web servers
[2013-10-21 18:09:22 -0400] coderanger: jose__: do you use open source server, or enterprise?
[2013-10-21 18:09:32 -0400] jose__: Open spurce
[2013-10-21 18:09:36 -0400] jose__: source
[2013-10-21 18:09:49 -0400] coderanger: Then yeah, the only way to allow writing is to mark the node doing the writing as an admin
[2013-10-21 18:09:56 -0400] coderanger: which lets it write to _everything_
[2013-10-21 18:10:22 -0400] coderanger: needless to say this has poor failure mode if there is a security compromise on that box
[2013-10-21 18:10:38 -0400] jose__: sure
[2013-10-21 18:10:49 -0400] coderanger: Generally you would use the search index to maintain that state though
[2013-10-21 18:10:53 -0400] coderanger: not nodes writing to each other
[2013-10-21 18:10:59 -0400] jose__: And is there any LWRP for writing tags inside a recipe?
[2013-10-21 18:11:00 -0400] jose__: ok
[2013-10-21 18:11:04 -0400] jose__: data bag would be better?
[2013-10-21 18:11:21 -0400] coderanger: No, nodes writing to anything except themselves is generally bad
[2013-10-21 18:11:28 -0400] coderanger: and flat out doesn't work in open source
[2013-10-21 18:11:34 -0400] coderanger: (unless you set the admin bit)
[2013-10-21 18:11:59 -0400] coderanger: Nodes set tags on themselves, other nodes search for those tags to establish state
[2013-10-21 18:12:19 -0400] coderanger: or you can use any other attribute, tags aren't special at all
[2013-10-21 18:12:35 -0400] jose__: The problem is the following:
[2013-10-21 18:12:49 -0400] jose__: I have two load balancers which adds all the web servers
[2013-10-21 18:13:16 -0400] jose__: I need to first add the webservers as disabled in the load balancer
[2013-10-21 18:14:14 -0400] jose__: because If I add a server enabled, one load balancer will have the server and the other load balancer won't until runs chef-client
[2013-10-21 18:14:35 -0400] miah: make load balancers run chef more often
[2013-10-21 18:14:36 -0400] miah: =)
[2013-10-21 18:14:52 -0400] coderanger: Or don't use Chef to manage that state
[2013-10-21 18:15:11 -0400] coderanger: If you need a distributed transactional database, chef is not the right tool
[2013-10-21 18:15:21 -0400] jose__: But I'll always have the problem that one balancer will have it included before the other
[2013-10-21 18:15:40 -0400] miah: why is that a problem?
[2013-10-21 18:16:03 -0400] coderanger: jose__: ZooKeeper node watch would let you keep that sync interval in the 10ms range most of the time (barring network partition)
[2013-10-21 18:16:32 -0400] jose__: Because session on one LB won't be klnown in the other LB
[2013-10-21 18:17:00 -0400] jose__: ANd adding webservers first as disabled in both LB will work.
[2013-10-21 18:17:00 -0400] miah: haproxy supports sharing of session data across nodes
[2013-10-21 18:17:15 -0400] miah: i have no idea why people think apache and nginx are load balancers
[2013-10-21 18:17:16 -0400] jose__: Yes, I'm doing exactly that with HAProxy
[2013-10-21 18:17:26 -0400] jose__: I'm using HAProxy
[2013-10-21 18:17:39 -0400] miah: you can just redispatch if the lb isn't fully aware of the session
[2013-10-21 18:17:43 -0400] coderanger: jose__: I mean at some point you are going to hit CAP theorem on this, there is no way to make it perfect, but there are things better than chef if you really need it to be in sync
[2013-10-21 18:17:43 -0400] miah: unless your session code is that fugly
[2013-10-21 18:17:58 -0400] jose__: And I share session between HAProxy nodes
[2013-10-21 18:18:27 -0400] jose__: The problem is that adding a new server is always done to one of the HAProxies first
[2013-10-21 18:18:42 -0400] coderanger: jose__: The closest you could get would be a dedicated interconnect on the nodes and have the "master side" orchestrate the process of adding new nodes on both
[2013-10-21 18:18:58 -0400] coderanger: using something like zk or heartbeat to establish master status
[2013-10-21 18:19:31 -0400] jose__: If I add the new webserver in disabled state to both and then I change the config to enabled, it will work (even if a session goes to the haproxy that has the node has disabled)
[2013-10-21 18:20:25 -0400] coderanger: Basically Chef is not a great tool when you have multiple servers that need to interact in a very well ordered way
[2013-10-21 18:20:36 -0400] jose__: ok, thanks
[2013-10-21 18:20:39 -0400] coderanger: (pushy might help some cases, but not all)
[2013-10-21 18:21:07 -0400] coderanger: Chef excels at idempotent stuff, but the process you are describing isn't really idemopotent
[2013-10-21 18:21:18 -0400] miah: chef is not a service orchaestration platform, thats what zookeeper and etcd do
[2013-10-21 18:21:39 -0400] coderanger: You could build the state machine in chef recipes out of idempotent states and then just run chef-client a lot of times to pump the state machine
[2013-10-21 18:21:43 -0400] coderanger: but its going to be hairy
[2013-10-21 18:21:57 -0400] jamesturnbull: sascha_d: /msg sascha_d hey apparently I am going to FlowCon :)
[2013-10-21 18:21:59 -0400] miah: i tend to just set my load balancers chef-interval to <5minutes
[2013-10-21 18:22:13 -0400] sascha_d: ahaha!
[2013-10-21 18:22:16 -0400] miah: and ensure that my client-run takes less than 5 minutes
[2013-10-21 18:22:19 -0400] jamesturnbull: sascha_d: :)
[2013-10-21 18:22:19 -0400] coderanger: miah: Yeah, ditto
[2013-10-21 18:22:26 -0400] miah: i wont be at flowcon. but i will live in SF during flowcon
[2013-10-21 18:22:37 -0400] miah: *cough*
[2013-10-21 18:22:39 -0400] sascha_d: I will be there all wee
[2013-10-21 18:22:40 -0400] sascha_d: k
[2013-10-21 18:22:41 -0400] jose__: @miah, yes, I run chef-client in the LB <5 minutes
[2013-10-21 18:22:47 -0400] sascha_d: teaching a class for two days too
[2013-10-21 18:22:56 -0400] sascha_d: I tweeted that I'd be in SF for halloween
[2013-10-21 18:22:59 -0400] sascha_d: wat to do?
[2013-10-21 18:23:07 -0400] miah: jose__: if the run interval is low enough, any 'out of sync' stuff should be minimized
[2013-10-21 18:23:30 -0400] miah: i know we're getting down into 'but this race condition still exists'
[2013-10-21 18:23:42 -0400] jose__: Not true for my case.
[2013-10-21 18:23:44 -0400] miah: and ya.. but without flock_of_chefs or pushy its nearly impossible
[2013-10-21 18:23:45 -0400] coderanger: sascha_d: CalAcademy is doing a thing
[2013-10-21 18:23:50 -0400] jose__: There's a way not to have the race condition
[2013-10-21 18:24:14 -0400] coderanger: sascha_d: And DNA lounge is always fun
[2013-10-21 18:24:21 -0400] miah: the way to not have it is to write a daemon that talks to haproxy via its unix-domain-socket and only add servers that way
[2013-10-21 18:24:21 -0400] jose__: Adding the webserver as disabled in both HAProxies
[2013-10-21 18:24:33 -0400] coderanger: jose__: Sure there is, both LBs need to query each other's state and only advance when it is safe
[2013-10-21 18:24:34 -0400] jose__: No, you're complicationg it too much
[2013-10-21 18:24:34 -0400] sascha_d: @coderanger true, I've been to DNA tho not on halloween
[2013-10-21 18:24:42 -0400] coderanger: jose__: It will be super annoying to write though
[2013-10-21 18:24:50 -0400] jose__: No, let me explain
[2013-10-21 18:24:58 -0400] miah: please do
[2013-10-21 18:25:28 -0400] miah: i will be avoiding the world on halloween, and instead be at a friends house. because fuck going anywhere for the dirty unwashed public
[2013-10-21 18:25:50 -0400] jose__: You add the new webserver in one LB with the disabled state
[2013-10-21 18:26:07 -0400] miah: how are you procuring your list of web-servers?
[2013-10-21 18:26:08 -0400] jose__: You add the same webserver to the second LB in disabled state
[2013-10-21 18:26:18 -0400] adamjk-dev: anyone seen issues with Chef getting 403 errors after 15 minutes?
[2013-10-21 18:26:29 -0400] jose__: You now change the webserver to active state
[2013-10-21 18:26:41 -0400] miah: adamjk-dev: on hosted-chef ya. because nginx is a shitty lb and opscode ignores that ;)
[2013-10-21 18:26:55 -0400] adamjk-dev: miah: hehe, this is private chef in fact
[2013-10-21 18:26:58 -0400] cheeseplus: sascha_d: if you're in SF for halloween you should come by Ricon :P
[2013-10-21 18:27:04 -0400] jose__: Is a request arrives to the LB which has the WB in the disabled state, HAproxy will still honoring the session
[2013-10-21 18:27:04 -0400] miah: jose__: how are you going to determine which webserver in the list is 'the new server'
[2013-10-21 18:27:14 -0400] adamjk-dev: miah: i saw a few tickets, one which mentioned S3 timeouts, but yeah it is private chef
[2013-10-21 18:27:19 -0400] jose__: Now you can go and set the webserver as enabled in the 2nd LB
[2013-10-21 18:27:27 -0400] jose__: There's no race-condition
[2013-10-21 18:27:30 -0400] miah: what is going to orchaestrate enabling web-servers?
[2013-10-21 18:28:12 -0400] jose__: What do you mean?
[2013-10-21 18:28:31 -0400] miah: 1. you are getting the list of 'webservers' to add to your haproxy.cfg (from where?)
[2013-10-21 18:28:36 -0400] jose__: Yes
[2013-10-21 18:28:44 -0400] miah: 2. how do you determine which server is the 'new server' that should be 'disabled'
[2013-10-21 18:28:50 -0400] jose__: from a search on nodes with "app" role
[2013-10-21 18:29:01 -0400] adamjk-dev: so, to rephrase, has anyone seen issues with Chef failing after 15 minutes with private Chef?
[2013-10-21 18:29:13 -0400] ascendantlogic: I have no
[2013-10-21 18:29:13 -0400] ascendantlogic: t
[2013-10-21 18:29:20 -0400] slillibri: adamjk-dev: are your chef runs taking 15 minutes to run?
[2013-10-21 18:29:32 -0400] miah: so, with search results, how are you going to determine which servers are 'new' vs 'old' ?
[2013-10-21 18:29:33 -0400] adamjk-dev: slillibri: presumably so, I am asking for another developer in house
[2013-10-21 18:29:36 -0400] jwitrick: I have seen that with opensource chef11
[2013-10-21 18:29:43 -0400] sfalcon: adamjk-dev: fail how? Guess is that 15 min is the configured value for the pre-signed cookbook content URLs and they are expiring
[2013-10-21 18:29:45 -0400] adamjk-dev: jwitrick: yeah, that is what it is
[2013-10-21 18:29:59 -0400] jose__: 2. That's the whole point of my problem:). One Idea was to have all servers when start tagged as "first-run"
[2013-10-21 18:30:08 -0400] adamjk-dev: sfalcon: I am getting the error right now, sec
[2013-10-21 18:30:20 -0400] jwitrick: ya there is a default configuration value on the chef11 server that you can change from 15 min to what ever you want
[2013-10-21 18:30:23 -0400] adamjk-dev: sfalcon: i imagine you are correct, that sounds right
[2013-10-21 18:30:27 -0400] miah: jose__: ya, that sounds like a mess
[2013-10-21 18:30:32 -0400] jose__: Then the recipe running on the LB would mode servers from first-run to disabled to enabled in subsequent runs
[2013-10-21 18:30:39 -0400] adamjk-dev: https://tickets.opscode.com/browse/CHEF-4253
[2013-10-21 18:30:48 -0400] adamjk-dev: jwitrick: https://tickets.opscode.com/browse/CHEF-4253 ?
[2013-10-21 18:30:50 -0400] jose__: mode -? move
[2013-10-21 18:30:51 -0400] adamjk-dev: sfalcon: https://tickets.opscode.com/browse/CHEF-4253 ?
[2013-10-21 18:30:55 -0400] miah: tags shouldn't really be used that way imho.
[2013-10-21 18:31:07 -0400] jose__: ok, good
[2013-10-21 18:31:29 -0400] jwitrick: correct, that is the only work around i know of
[2013-10-21 18:31:30 -0400] sfalcon: adamjk-dev: you can change the TTL for those URLs in private-chef.rb yes
[2013-10-21 18:31:36 -0400] miah: mainly because modifying tags on a node is difficult without servers having admin privileges
[2013-10-21 18:31:52 -0400] adamjk-dev: sfalcon: do you know where the settings file would be on private chef?
[2013-10-21 18:32:00 -0400] jose__: So, I've never seen zookeper. Do you still suggest to use it?
[2013-10-21 18:32:21 -0400] miah: zookeeper is non-trivial, go look at it, and look at etcd as well
[2013-10-21 18:32:36 -0400] jose__: etcd is another cookbook?
[2013-10-21 18:32:38 -0400] miah: i think you'll still need to write some management code that speads to that service and then to chef
[2013-10-21 18:32:49 -0400] jose__: ok
[2013-10-21 18:33:03 -0400] miah: https://github.com/coreos/etcd
[2013-10-21 18:33:14 -0400] sfalcon: adamjk-dev: should be /etc/opscode/private-chef.rb ? And I think you can use the same example config
[2013-10-21 18:33:18 -0400] jose__: Thanks
[2013-10-21 18:33:20 -0400] sfalcon: (as in the ticket)
[2013-10-21 18:33:26 -0400] miah: in general, a cookbook is not going to solve your problem. unless the author actually wrote some ruby and didnt just abuse chef resource primitives
[2013-10-21 18:33:34 -0400] adamjk-dev: sfalcon: for the S3 that is?
[2013-10-21 18:33:57 -0400] sfalcon: adamjk-dev: right.. erchef['s3_url_ttl'] = 3600
[2013-10-21 18:34:14 -0400] adamjk-dev: sfalcon: ok, thank you very much, I just figured that wouldnt work on private chef when I found the ticket... I will give it a try
[2013-10-21 18:34:16 -0400] sfalcon: adamjk-dev: http://docs.opscode.com/config_rb_chef_server_enterprise.html
[2013-10-21 18:34:32 -0400] jose__: will see
[2013-10-21 18:34:35 -0400] jose__: Thanks again
[2013-10-21 18:34:39 -0400] adamjk-dev: sfalcon: very nice, thanks again
[2013-10-21 18:34:45 -0400] oofoof: heh, that's the same config file that I think is not getting generated (as ruby) but as json in opensource chef
[2013-10-21 18:35:04 -0400] oofoof: adamjk-dev are you getting that config file laid down in a private chef install?
[2013-10-21 18:35:31 -0400] sfalcon: oofoof: You are right that OSC doesn't create that file and that presently you have to create (chef-server.rb) yourself. Not the same as the running json data.
[2013-10-21 18:36:33 -0400] adamjk-dev: oofoof: checking now
[2013-10-21 18:39:17 -0400] airtonix: what are the chances of getting uwsgi support into https://github.com/opscode-cookbooks/application_python ?
[2013-10-21 18:40:24 -0400] gchristensen: are there any good articles on using the opscode pxe-dust cookbook? I'm coming up with cooking articles about dusting with powdered sugar
[2013-10-21 18:41:41 -0400] miah: probably not
[2013-10-21 18:41:54 -0400] gchristensen: wonderful
[2013-10-21 18:46:12 -0400] miah: you can probably just read any article about pxe with isc dhcpd and tftpd though
[2013-10-21 18:46:56 -0400] gchristensen: yeah, I'm on it. my big hangup right now is figuring out a way to test it well
[2013-10-21 18:47:10 -0400] gchristensen: but I'm not at the point of asking questions yet. just research, then trying
[2013-10-21 18:47:30 -0400] adamjk-dev: sfalcon: that file is in /etc/chef-server/chef-server.rb FYI
[2013-10-21 18:48:14 -0400] sfalcon: adamjk-dev: which now? I thought you said you were using Private Chef?
[2013-10-21 18:48:39 -0400] adamjk-dev: sfalcon: I am, and that documentation page says that location as well at the very top
[2013-10-21 18:49:06 -0400] sfalcon: adamjk-dev: ah, that needs enhancement :( For Private Chef, the file you want is /etc/opscode/private-chef.rb
[2013-10-21 18:49:49 -0400] adamjk-dev: sfalcon: hrm... my chef server does not have a directory /etc/opscode
[2013-10-21 18:49:57 -0400] adamjk-dev: sfalcon: would that be like an override or something?
[2013-10-21 18:50:17 -0400] CPS: check /opt?
[2013-10-21 18:50:50 -0400] adamjk-dev: i have /opt/chef-server
[2013-10-21 18:51:21 -0400] sfalcon: adamjk-dev: Then I think you are running the Open Source Chef Server :)
[2013-10-21 18:51:36 -0400] adamjk-dev: sfalcon: I am sorry, I clearly messed that up in talking with you
[2013-10-21 18:51:45 -0400] adamjk-dev: sfalcon: I am running my own open source chef server, not private chef
[2013-10-21 18:51:47 -0400] oofoof: i'm the distraction :)
[2013-10-21 18:51:57 -0400] adamjk-dev: no its fine... if I would just type correctly
[2013-10-21 18:52:18 -0400] sfalcon: adamjk-dev: roger. I was a bit confused there. And so I sent you the wrong doc link (which itself has an error which we'll fix)
[2013-10-21 18:52:18 -0400] adamjk-dev: so with the open source chef server, is it okay to modify it from /etc/chef-server/chef-server.rb ?
[2013-10-21 18:52:39 -0400] ponyofdeath: hi, trying to overwrite this { '(lib|css|js|resources)' => 'https://prod-app-vip' } default attribute but am unsure how it will translate to the json format? will "blah": "{ '(lib|css|js|resources)' => 'https://stage-elect-vip' } work"
[2013-10-21 18:52:39 -0400] sfalcon: Soooo. yeah, you want the file you just referenced :) Just like the ticket you pasted :)
[2013-10-21 18:52:39 -0400] adamjk-dev: sfalcon: well, now we are on the right page and we found a problem
[2013-10-21 18:53:06 -0400] adamjk-dev: sfalcon: great, the world makes sense, I am testing the change now with a long running chef run
[2013-10-21 18:53:10 -0400] adamjk-dev: thanks for the help guys
[2013-10-21 18:54:58 -0400] oofoof: huh, so adamjk-dev you do have an /etc/chef-server/chef-server.rb from OSC?  maybe I am PEBKAC :)
[2013-10-21 18:56:37 -0400] adamjk-dev: oofoof: yeah, I do haha
[2013-10-21 18:56:44 -0400] adamjk-dev: oofoof: we are all set now I believe
[2013-10-21 18:58:06 -0400] ssd7: Ohai Chefs
[2013-10-21 18:59:15 -0400] oofoof: grepping through the ominbus chef-server install, i sure don't see how chef-server.rb gets created, and it's not happening on this vanilla RHEL install.  looks like the json gets created (not the rb) in the recipe:
[2013-10-21 18:59:15 -0400] oofoof: https://github.com/opscode/omnibus-chef-server/blob/04057c9dd4150f6c811aee9496671ec566512f0b/files/chef-server-cookbooks/chef-server/recipes/default.rb
[2013-10-21 19:02:40 -0400] dgarstang2: How can I recover a chef admin user password?
[2013-10-21 19:03:13 -0400] sfalcon: oofoof: it does not get created. You have to create it if you want it.
[2013-10-21 19:04:09 -0400] airtonix: https://dpaste.de/t9XH#L4,5,6,7,8,9 << how do i make this work without repeating the highlighted lines in each of the vagrant definitions ?
[2013-10-21 19:05:03 -0400] sfalcon: oofoof: maybe this: https://github.com/opscode-cookbooks/chef-server
[2013-10-21 19:05:33 -0400] oofoof: ok, roger that sfalcon.  we're back on the same page.  Is there any tooling that we *should* do?  We just wrote a little json->rb translator and are manually dropping it into /etc/chef-server/
[2013-10-21 19:06:22 -0400] sfalcon: oofoof: not sure I follow, but I also haven't tried setting up the multi-tier thing.
[2013-10-21 19:06:27 -0400] CPS: in a recipe, what resource would you use to stop the iis service on a windows node?
[2013-10-21 19:08:41 -0400] oofoof: oh snap.  i found it.  the template and huge changes are in version 2.0.0 of the chef-server cookbook, but when I install the 11.0.8-1 omnibus installer, i get version 0.1.0 of the same cookbook!  huzzah.
[2013-10-21 19:09:10 -0400] dgarstang2: How can I recover a chef admin user password?
[2013-10-21 19:10:06 -0400] sfalcon: oofoff: omnibus package embedded cookbooks aren't the same beast as the chef-server cookbook FWIW.
[2013-10-21 19:11:21 -0400] ssd7: CHEF Code Review: https://plus.google.com/hangouts/_/9db9d235813302a0faf60006f6595e4fe3964801
[2013-10-21 19:11:30 -0400] oofoof: oh!  can you elaborate as to why?  and, can i just copy https://github.com/opscode-cookbooks/chef-server and run it against the omnibus install?
[2013-10-21 19:12:58 -0400] sfalcon: oofoof: so the embedded stuff is part of the omnibus Chef Server packaging. We package everything and use chef-solo to configure the "cluster".
[2013-10-21 19:13:19 -0400] sfalcon: The chef-server cookbook was refactored to manage the installation of an omnibus packaged Chef Server.
[2013-10-21 19:13:26 -0400] sfalcon: does that help?
[2013-10-21 19:14:46 -0400] oofoof: somewhat.  I thought that the docs said to install via the omnibus.  It seems clear that omnibus and the chef-server cookbook differ.  So that I don't bug you much more, what's the best practice for running a chef-server install?
[2013-10-21 19:15:03 -0400] oofoof: i was trying to rtfm :) http://docs.opscode.com/install_server.html
[2013-10-21 19:17:38 -0400] mondo: dgarstang2, check /etc/chef-server on your chef server
[2013-10-21 19:19:37 -0400] mondo: dgarstang2, you should be able to use the admin key with knife to create a new admin user
[2013-10-21 19:20:11 -0400] jmickle: miah you around?
[2013-10-21 19:20:15 -0400] oofoof: hot damn. running the latest verison of the cookbook creates /etc/chef-server/chef-server.rb correctly
[2013-10-21 19:20:20 -0400] sfalcon: oofoof: The intention was that using bare omnibus install should work. And that for folks desiring to automate custom installs of the server they would use chef-server cookbook to install and customize an omnibus install. I think that's the category you fall into. And that you might even need to take the customization further by hacking on the chef-server cookbook (or similar)
[2013-10-21 19:20:26 -0400] sfalcon: :)
[2013-10-21 19:20:36 -0400] jmickle: sfalcon
[2013-10-21 19:20:44 -0400] jmickle: can you help me
[2013-10-21 19:20:47 -0400] sfalcon: jmickle: pong
[2013-10-21 19:20:51 -0400] jmickle: hehe
[2013-10-21 19:21:17 -0400] jmickle: sfalcon: I'm doing a wrapper cookbook that runs some other recipes inside of the cookbook and there is a default node attr that = hash.new
[2013-10-21 19:21:50 -0400] oofoof: straight up awesome sfalcon.  now we're on a good path, and thank you so much!
[2013-10-21 19:21:54 -0400] jmickle: i need to update node[x][y] from each included recipe so that in the main recipe I can compile it down to a hash and include it into the provider
[2013-10-21 19:22:04 -0400] jmickle: sfalcon: am i doing it wrong? or how do i do that?
[2013-10-21 19:22:17 -0400] jmickle: i keep returning a {}
[2013-10-21 19:22:43 -0400] sfalcon: jmickle: have a gist or github link?
[2013-10-21 19:22:58 -0400] sfalcon: oofoof: :) yay!
[2013-10-21 19:22:59 -0400] thebishop: is it possible to override/set manually the ip chef-client reports to chef server?
[2013-10-21 19:23:09 -0400] jmickle: sfalcon: node["monitor"]["additional_client_attributes"].to_hash.merge(client_attributes)
[2013-10-21 19:23:33 -0400] jmickle: sfalcon: i am using the sensu wrapper cookbook and trying to pass additional params into the client install provider
[2013-10-21 19:23:33 -0400] thebishop: i have a EC2 chef node that's reporting its eth0 ip to Chef Server.  I want it to report its elastic IP
[2013-10-21 19:24:23 -0400] dgarstang2: Oh chef. y u no like me? /opt/chef/embedded/lib/ruby/1.9.1/net/http.rb:762:in `initialize': Operation timed out - connect(2) (Errno::ETIMEDOUT)
[2013-10-21 19:24:47 -0400] sfalcon: dgarstang2: did you get your admin reset sorted out?
[2013-10-21 19:25:05 -0400] dgarstang2: sfalcon: yah. Did this... http://lists.opscode.com/sympa/arc/chef/2013-03/msg00335.html
[2013-10-21 19:25:06 -0400] sfalcon: jmickle: hmm, not my area of greatest expertise.
[2013-10-21 19:25:21 -0400] jmickle: sfalcon: got it thank
[2013-10-21 19:25:36 -0400] jmickle: sfalcon: il keep hacking :-/
[2013-10-21 19:26:26 -0400] sfalcon: jmickle: still not clear on a full example of what you're trying and what's not working.
[2013-10-21 19:35:08 -0400] ichilton: Why wouldn't this show in the chef-client output?
[2013-10-21 19:35:09 -0400] ichilton: Chef::Log.error("--> _SENSU_CHECKS")
[2013-10-21 19:35:26 -0400] ichilton: i've tried error and info and using -l to change the logging level
[2013-10-21 19:35:53 -0400] ichilton: It's running the recipe and the recipe in /var/chef has the logging in
[2013-10-21 19:36:39 -0400] ichilton: It's running the recipe because I see:
[2013-10-21 19:36:40 -0400] ichilton: Recipe: audacious_common::_sensu_checks * git[/var/chef/cache/sensu-plugins] action sync (up to date)
[2013-10-21 19:36:54 -0400] ichilton: (the git thing is further down in the recipe)
[2013-10-21 19:36:58 -0400] ichilton: Am I going crazy??
[2013-10-21 19:37:05 -0400] ascendantlogic: is your updated recipe uploaded to the server?
[2013-10-21 19:37:09 -0400] ascendantlogic: I do that to myself all the time
[2013-10-21 19:37:09 -0400] ichilton: yep
[2013-10-21 19:37:16 -0400] ascendantlogic: change a recipe and then forget to upload it
[2013-10-21 19:37:28 -0400] ichilton: I checked the debugging was in the copy in /var/chef
[2013-10-21 19:37:40 -0400] ichilton: yeah, I do that too, but for once I didn't :)
[2013-10-21 19:37:52 -0400] ascendantlogic: did you bump the metadata version or clear the local cache on the node you're converging?
[2013-10-21 19:37:56 -0400] ascendantlogic: to ensure the latest code is there and running?
[2013-10-21 19:38:12 -0400] ascendantlogic: you're not pinned to an earlier version of the cookbook via environment?
[2013-10-21 19:39:10 -0400] ichilton: not pinned
[2013-10-21 19:39:26 -0400] ichilton: I didn't bump the version as I generally do berks upload --force
[2013-10-21 19:39:46 -0400] ichilton: the latest version is on the node and i've not had a problem with chef-client not recognising the update before?
[2013-10-21 19:40:06 -0400] ichilton: I'll try another node
[2013-10-21 19:40:15 -0400] ascendantlogic: yeah, not sure why
[2013-10-21 19:40:23 -0400] ascendantlogic: I mean, the obvious answer is that the code is not being called
[2013-10-21 19:40:46 -0400] ascendantlogic: so perhaps because it's on an already-bootstrapped node presumably with the recipe run the code is being skipped
[2013-10-21 19:40:49 -0400] patcon: coderanger: hey man, you're still the go-to guy for community.opscode.com, right? For feedback and stuff?
[2013-10-21 19:40:57 -0400] patcon: coderanger: also, hello!
[2013-10-21 19:40:58 -0400] coderanger: patcon: Not anymore, sorry
[2013-10-21 19:41:22 -0400] patcon: coderanger: no worries. know who would be? Just to @mention someone in a github issue :)
[2013-10-21 19:41:27 -0400] coderanger: Not sure there really is anyone, btm might be your best bet
[2013-10-21 19:41:37 -0400] patcon: coderanger: thx!
[2013-10-21 19:41:48 -0400] coderanger: But I'm no longer with Opscode, so I can't say for certain who/if anyone is working on it
[2013-10-21 19:41:54 -0400] dgarstang2: Can anyone tell me why chef redirects traffic on a knife upload part way through?
[2013-10-21 19:42:04 -0400] ichilton: eh
[2013-10-21 19:42:09 -0400] savant: Hi all
[2013-10-21 19:42:17 -0400] coderanger: dgarstang2: You mean the sandbox upload phase?
[2013-10-21 19:42:17 -0400] ichilton: ran it on another node and it runs the git stuff but ignores everything else
[2013-10-21 19:42:19 -0400] savant: does anyone know of a way to parallelize foodcritic tests?
[2013-10-21 19:42:20 -0400] sfalcon: dgarstang2: not sure what you mean. Any chance you've configured knife.rb to http instead of https?
[2013-10-21 19:42:23 -0400] ichilton: I really don't get it
[2013-10-21 19:42:58 -0400] dgarstang2: I'm uploading to a chef server in google cloud, and I've seen this multiple times with Amazon too. Upload working fine... then it hangs. A tcpdump shows it first using the external GCE and then it starts to use the internal GCE IP address and fails to connect cuz that's not reachable.
[2013-10-21 19:43:26 -0400] dgarstang2: coderanger: don't know...
[2013-10-21 19:43:42 -0400] coderanger: dgarstang2: What are the URLs involved?
[2013-10-21 19:43:52 -0400] sfalcon: dgarstang2: ah, so that sounds familiar and has to do with how the server is configured for talking to bookshelf.
[2013-10-21 19:43:56 -0400] coderanger: and does it happen only when uploading cookbooks and not other data types
[2013-10-21 19:44:06 -0400] coderanger: yeah, usually means the value of the server_name in nginx is wrong
[2013-10-21 19:44:11 -0400] dgarstang2: sfalcon: you lost me a bit thee
[2013-10-21 19:44:25 -0400] dgarstang2: coderanger: I'm not uploading cookbooks. I'm uploading .
[2013-10-21 19:44:29 -0400] dgarstang2: oops / rather
[2013-10-21 19:44:32 -0400] sfalcon: For the current release of OSC, you need working DNS for the chef server.
[2013-10-21 19:44:42 -0400] coderanger: dgarstang2: bookshelf == s3 clone the open source chef uses for storing cookbook files
[2013-10-21 19:45:01 -0400] dgarstang2: sfalcon: hosts file isn't good enough to get started?
[2013-10-21 19:45:09 -0400] dgarstang2: coderanger: oic
[2013-10-21 19:45:13 -0400] sfalcon: When you upload cookbooks, you upload the cookbook content (the files in the cookbook dir) to either bookshelf or s3.
[2013-10-21 19:45:27 -0400] sfalcon: And the server sends the client a pre-signed URL to PUT the data to.
[2013-10-21 19:45:30 -0400] dgarstang2: sfalcon: if bookshelf is internal, then it's bookshelf.
[2013-10-21 19:45:35 -0400] coderanger: The cookbook upload process works by first you make an API call to the chef server to create a "sandbox", it sends you a bunch of URLs to upload the files to, you upload those, then commit the sandbox
[2013-10-21 19:45:44 -0400] coderanger: its a transactional upload API basically
[2013-10-21 19:45:48 -0400] sfalcon: dgarstang2: makes sense.
[2013-10-21 19:46:15 -0400] dgarstang2: so, how could I get the redirected URL's to be the external IP?
[2013-10-21 19:46:53 -0400] coderanger: dgarstang2: Update the server name in your chef-server.rb and chef-server-ctl reconfigure
[2013-10-21 19:47:01 -0400] sfalcon: dgarstang2: so you can configure (via /etc/chef-server/chef-server.rb) to use the external IP but this could cause a problem if the external IP can't be used internally
[2013-10-21 19:47:28 -0400] sfalcon: Nightly builds have a fix that use the Host header in the request which I think would solve it for you.
[2013-10-21 19:47:30 -0400] coderanger: By default it uses the systems fqdn, which on amazon is the internal hostname
[2013-10-21 19:48:31 -0400] dgarstang2: coderanger: find / -name chef-server.rb == nothing.
[2013-10-21 19:48:51 -0400] coderanger: As I said, it has a default value, so it isn't in there normally
[2013-10-21 19:49:08 -0400] coderanger: The chef-server docs have a listing of all the config values though
[2013-10-21 19:49:09 -0400] sfalcon: dgarstang2: the file doesn't get created on a default install. If you create /etc/chef-server/chef-server.rb and run chef-server-ctl reconfigure it will pick up config changes you place there.
[2013-10-21 19:49:26 -0400] dgarstang2: sfalcon: and what goes in the file?
[2013-10-21 19:49:38 -0400] dgarstang2: coderanger: k
[2013-10-21 19:49:56 -0400] fak3r: writing a variable to a file during bootstrap, it fails with 'trailing garbage'. What am I doing wrong? https://gist.github.com/philcryer/7089685
[2013-10-21 19:51:03 -0400] dgarstang2: http://docs.opscode.com/config_rb_chef_server.html .... nothing obvious
[2013-10-21 19:53:27 -0400] dgarstang2: really...
[2013-10-21 19:54:01 -0400] coderanger: fak3r: Hmm, can you check what ends up in the file?
[2013-10-21 19:54:15 -0400] joe_k: anyone had jenkins spawn off nodes with e.g. knife-ec2 ?
[2013-10-21 19:54:19 -0400] coderanger: fak3r: First guess would be either it doesn't like the trailing newline, or maybe unicode whitespace
[2013-10-21 19:54:26 -0400] joe_k: i find a jenkins cookbook, but i want jenkins to use chef to provision nodes
[2013-10-21 19:54:48 -0400] joe_k: s/find/found
[2013-10-21 19:54:57 -0400] coderanger: dgarstang2: Search for "server_name", you'll find it :)
[2013-10-21 19:55:26 -0400] fak3r: coderanger: thanks, it shows up as ascii text: # file .curlrc  .curlrc: ASCII text
[2013-10-21 19:56:27 -0400] sfalcon: dgarstang2: yeah, not so obvious. I would try: api_fqdn "IP"
[2013-10-21 19:57:03 -0400] sfalcon: where IP is either IP or fqdn that is reachable by clients. But you may run into problems if that address isn't also routable from the server itself.
[2013-10-21 19:57:32 -0400] fak3r: coderanger: thanks, figured it out, basically should be 'proxy' not 'http_proxy'!
[2013-10-21 19:57:54 -0400] coderanger: fak3r: doh, got to love graybeard-level error messages :(
[2013-10-21 19:57:57 -0400] coderanger: fak3r: lolunix
[2013-10-21 19:59:53 -0400] mattupstate: what do you guys usually use for node names in EC2?
[2013-10-21 20:00:06 -0400] coderanger: mattupstate: The internal fqdn
[2013-10-21 20:00:40 -0400] mattupstate: coderanger: do you by change add anything into the name to denote it's role?
[2013-10-21 20:00:43 -0400] mattupstate: *by chance
[2013-10-21 20:00:50 -0400] coderanger: mattupstate: Nope
[2013-10-21 20:01:20 -0400] mattupstate: right on, just wanted to get someone elses perspective
[2013-10-21 20:01:33 -0400] coderanger: mattupstate: Hosts are ephemeral IMO, no need to worry about their names :)
[2013-10-21 20:02:13 -0400] mattupstate: right, the system i inherited uses a convention of "<environment>-<name>-<index>"
[2013-10-21 20:02:19 -0400] mattupstate: rather annoything
[2013-10-21 20:03:19 -0400] ascendantlogic: So if I have a chef node based on an EC2 node, and I assign an elastic IP after I converge the node, what's the best way for me to update the IP in the node on my server?
[2013-10-21 20:03:21 -0400] ascendantlogic: just re-converge?
[2013-10-21 20:03:24 -0400] ascendantlogic: edit the node manually?
[2013-10-21 20:03:32 -0400] mattupstate: rerun chef-client
[2013-10-21 20:03:35 -0400] ascendantlogic: k
[2013-10-21 20:08:46 -0400] btm: patcon: need something?
[2013-10-21 20:09:20 -0400] patcon: btm: nothing major, was just commenting on a github issue and wanted to let someone at opscode know that they were being talked about somewhere :)
[2013-10-21 20:09:31 -0400] patcon: https://github.com/isaacs/github/issues/114
[2013-10-21 20:09:50 -0400] patcon: btm: feel free to provide input or just leave it be
[2013-10-21 20:29:42 -0400] thebishop: how can i override the node['ipaddress'] value detected by Ohai?  It's breaking my cookbook against EC2 hosts
[2013-10-21 20:30:02 -0400] thebishop: it chooses the private ip on interface eth0 rather than the elastic ip
[2013-10-21 20:30:34 -0400] coderanger: thebishop: Rather than using node['ipaddress'] in your other recipes, use node['cloud']['public_ipv4']
[2013-10-21 20:30:54 -0400] coderanger: That still won't be the elastic IP though, not sure we catalog that
[2013-10-21 20:31:57 -0400] thebishop: coderanger, thanks, i'll try it
[2013-10-21 20:32:32 -0400] CPS: with open source chef, where on the server does it store recipes and the like?
[2013-10-21 20:32:54 -0400] coderanger: CPS: bookshelf, which uses the local file system
[2013-10-21 20:33:06 -0400] CPS: where on the file system?
[2013-10-21 20:35:45 -0400] sfalcon: CPS: for OSC, /var/opt/chef-server/bookshelf/data/
[2013-10-21 20:36:20 -0400] sfalcon: Not (exactly) human readable. Files are stored with checksum header and then content.
[2013-10-21 20:36:48 -0400] CPS: is there a way to retrieve them out of there in the event my workstation craps the bed?
[2013-10-21 20:37:27 -0400] coderanger: CPS: knife download?
[2013-10-21 20:37:56 -0400] CPS: just knife download? that will retrieve everything?
[2013-10-21 20:57:24 -0400] wootwootowe: how do you choose rbenv in application_ruby? even a way to choose the version that's in a .ruby-version-sample
[2013-10-21 20:57:46 -0400] coderanger: wootwootowe: That is not supported
[2013-10-21 20:57:59 -0400] coderanger: Seriously don't use rbenv on servers
[2013-10-21 20:58:12 -0400] coderanger: Its a development tool
[2013-10-21 20:58:12 -0400] wootwootowe: oh. thanks for pointing it out
[2013-10-21 20:58:15 -0400] wootwootowe: rvm then?
[2013-10-21 20:58:23 -0400] coderanger: No, never use rvm for any reason :P
[2013-10-21 20:58:28 -0400] coderanger: (but its also a dev tool)
[2013-10-21 20:58:43 -0400] coderanger: If you need ruby on your servers, either compile it and make a package, or use the ark cookbook
[2013-10-21 20:58:46 -0400] coderanger: I recommend the former
[2013-10-21 20:58:49 -0400] wootwootowe: huh, do you suggest that it makes use of system's ruby?
[2013-10-21 20:59:24 -0400] coderanger: Nope, personally I advocate shipping apps using omnibus and as such they should be 100% standalone from the system :)
[2013-10-21 20:59:34 -0400] coderanger: But thats complicated and not always worth it
[2013-10-21 20:59:46 -0400] coderanger: But just compiling ruby and using FPM is an easy baseline
[2013-10-21 20:59:59 -0400] jmickle: coderanger:
[2013-10-21 21:00:01 -0400] jmickle: ping
[2013-10-21 21:00:02 -0400] jmickle: haha
[2013-10-21 21:00:06 -0400] coderanger: Yo
[2013-10-21 21:00:06 -0400] wootwootowe: yep. thanks for that
[2013-10-21 21:00:27 -0400] coderanger: wootwootowe: If you use Ubuntu, there are also lots of PPAs available to save you the trouble :)
[2013-10-21 21:00:31 -0400] jmickle: coderanger: hey man I've been trying to figure out how to update a node[x][y] attr that is set as hash.new
[2013-10-21 21:00:44 -0400] coderanger: jmickle: Not sure what you mean
[2013-10-21 21:00:47 -0400] jmickle: coderanger: so that i can update it from a couple recipes and then pass it to a client install of sensu in another
[2013-10-21 21:01:11 -0400] jmickle: coderanger: so i have a default attr node[sensu][additional_params]
[2013-10-21 21:01:37 -0400] jmickle: coderanger: i have multiple recipes which do different things based on recipe (think type of server and variables for each such as memory)
[2013-10-21 21:02:02 -0400] jmickle: coderanger: in each of these recipes id like to update that main default attribute that i set to hash.new
[2013-10-21 21:02:13 -0400] jmickle: coderanger: but it seems to be immutable.....
[2013-10-21 21:02:34 -0400] jmickle: any idea how to accomplish that?
[2013-10-21 21:02:51 -0400] coderanger: jmickle: sec, meeting
[2013-10-21 21:02:55 -0400] jmickle: no worries
[2013-10-21 21:08:33 -0400] coderanger: jmickle: So first thing, are you sure this should be a node attribute? It doesn't sound like something that should persist, you just want a shared global var to cram stuff in, yes?
[2013-10-21 21:08:50 -0400] jmickle: coderanger: pretty much
[2013-10-21 21:08:56 -0400] coderanger: Okay, so best way to do that
[2013-10-21 21:09:21 -0400] coderanger: run_context.run_state[:sensu_crud] ||= {}; run_context.run_state[:sensu_crud][:foo] = 'bar'
[2013-10-21 21:09:36 -0400] coderanger: That run state hash is cleared between runs
[2013-10-21 21:09:44 -0400] coderanger: and not persisted back up to the server
[2013-10-21 21:10:25 -0400] jmickle: ah
[2013-10-21 21:11:23 -0400] fak3r: so I need to knife delete a host and readd it (ip/hostname change, key no longer works) what's the best way to do it? delete then re-bootstrap?
[2013-10-21 21:11:58 -0400] coderanger: jmickle: Its also just a standard hash stuff, so no merging or mutability constraints
[2013-10-21 21:12:07 -0400] jmickle: ok thanks coderanger
[2013-10-21 21:12:31 -0400] coderanger: fak3r: So just remove /etc/chef/client.pem and copy the validation key back over
[2013-10-21 21:12:52 -0400] coderanger: fak3r: Then knife node show -Fj <oldname> to get teh data
[2013-10-21 21:13:12 -0400] coderanger: fak3r: And after it re-registers, apply the old node data via knife node from file
[2013-10-21 21:14:19 -0400] coderanger: fak3r: If the only data you need is the runlist, you can just use knife bootstrap again after you remove the client.pem
[2013-10-21 21:19:31 -0400] duckdive: Does the ifconfig resource always rewrite the ifcfg-eth#:# config file?
[2013-10-21 21:20:37 -0400] mondo: anyone know how to escape a / in a bash code block?
[2013-10-21 21:20:46 -0400] coderanger: mondo: In what wat?
[2013-10-21 21:20:49 -0400] coderanger: er, way
[2013-10-21 21:20:52 -0400] fak3r: coderanger: thanks again, worked
[2013-10-21 21:21:00 -0400] coderanger: forward slash isn't a bash metachar
[2013-10-21 21:21:24 -0400] mondo: it's chef/ruby that's stripping it out
[2013-10-21 21:21:32 -0400] mondo: I'll post a gist
[2013-10-21 21:22:07 -0400] mondo: https://gist.github.com/andrewfraley/7091241
[2013-10-21 21:22:12 -0400] mondo: line 8
[2013-10-21 21:22:29 -0400] mondo: the \ is getting removed
[2013-10-21 21:22:43 -0400] coderanger: Oh, you said / :P
[2013-10-21 21:22:58 -0400] coderanger: Just double it, \\
[2013-10-21 21:24:07 -0400] mondo: coderanger, awesome thanks, that worked.  I don't know why I didn't try that in the first place... :)
[2013-10-21 22:20:43 -0400] jameson__: I am really bad at this cookbook packaging business -_-
[2013-10-21 22:21:30 -0400] jameson__: whelp, I guess this version is stuck with a .kitchen directory...
[2013-10-21 22:39:42 -0400] josephholsten: so I've got this crazy idea that instead of having to specify the instance size and default image every time I do a knife ... server create, I could actually just pass a tool (say mkbox) the role and env, and it would figure out all that from the chef-server
[2013-10-21 22:40:08 -0400] dgarstang2: wut. "Ridley::SandboxResource crashed!"
[2013-10-21 22:40:50 -0400] josephholsten: but it feels strange to store an instance size or image in a default_attributes param
[2013-10-21 22:41:27 -0400] josephholsten: alternatively, it seems annoying to have to create a data bag just to augment each role
[2013-10-21 22:46:07 -0400] dgarstang2: Why would this be hanging on berkshelf upload? Uploading bc-role (0.14.0) to: 'https://chefs01.us4.foo.com:443/' ?
[2013-10-21 22:46:34 -0400] dgarstang2: I can telnet to port 443 on that host
[2013-10-21 22:47:35 -0400] jameson__: what is bats default driver? bash?
[2013-10-21 22:49:57 -0400] dgarstang2: Why the heck would a chef server hang on upload when an openssl WORKS?
[2013-10-21 22:50:06 -0400] jameson__: uhh right.. bash-ats @_@
[2013-10-21 22:50:20 -0400] jameson__: auth? endline?
[2013-10-21 22:50:23 -0400] coderanger: jameson__: I think you mean the default test-kitchen driver?
[2013-10-21 22:50:44 -0400] jameson__: coderanger: yeah, the busser-bats
[2013-10-21 22:51:32 -0400] dgarstang2: and why are chefs logs so bad?
[2013-10-21 22:52:34 -0400] coderanger: jameson__: Yeah, bats is the default
[2013-10-21 22:57:17 -0400] jameson__: k, so I am not going crazy.
[2013-10-21 22:59:00 -0400] coderanger: jameson__: It is only the default by virtue of the docs, you have to be explicit in all cases
[2013-10-21 22:59:14 -0400] idlemichael: looking at the official nginx cookbook, https://github.com/opscode-cookbooks/nginx , it would appear there's no way to use the HttpEmptyGifModule in nginx w/o writing your own template?
[2013-10-21 22:59:19 -0400] coderanger: jameson__: The name of the folder is used to find the right busser plugins
[2013-10-21 23:00:17 -0400] jameson__: coderanger: yeah, I was staring at that for a minute, my brain is working really slowly today.
[2013-10-21 23:11:56 -0400] Skeletor2: Hi all, doing a RoR deployment, how are you all doing the gem dependency for the app(running bundle install in the RoR  directory)?
[2013-10-21 23:12:18 -0400] coderanger: Skeletor2: If you use application_ruby is does a bundle install --vendor for you
[2013-10-21 23:13:33 -0400] Skeletor2: Thanks coderanger
[2013-10-21 23:20:19 -0400] miah: because thats all\win 15
[2013-10-21 23:20:22 -0400] miah: doh
[2013-10-21 23:20:44 -0400] miah: i fail irc today
[2013-10-21 23:20:56 -0400] coderanger: No we know her password!
[2013-10-21 23:21:13 -0400] miah: my passwords are much more complex
[2013-10-21 23:21:49 -0400] miah: they have at least the words 'sex' 'god' and '123'
[2013-10-21 23:21:54 -0400] coderanger: hunter2hunter2hunter2hunter2hunter2hunter2hunter2
[2013-10-21 23:22:09 -0400] miah: buffalobuffalobuffalobuffalobuffalo..
[2013-10-21 23:23:22 -0400] miah: knife download /. its making me shake fists today.
[2013-10-21 23:30:02 -0400] garrett__: is it possible to display a secondary, descriptive, node label within the management console? ec2 hostnames are sort of messy
[2013-10-21 23:30:15 -0400] coderanger: Not currently
[2013-10-21 23:30:30 -0400] coderanger: However node names need not match the system hostname
[2013-10-21 23:30:56 -0400] garrett__: oh, true; i'm just trying to avoid painting myself into a corner for now
[2013-10-21 23:31:13 -0400] garrett__: so i was wondering if there were existing options, or if i should just tweak the way i'm bootstrapping nodes
[2013-10-21 23:32:27 -0400] garrett__: i'll just write some glue to pull it from the ec2 human-disgestable instance name, then
