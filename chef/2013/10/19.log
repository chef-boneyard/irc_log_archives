[2013-10-19 00:00:04 -0400] objectiveous: It requires some gems be installed and, by default, they are not. So, I need to load them up.
[2013-10-19 00:00:48 -0400] objectiveous: jbz: That's the behavior I'm seeing. So the question becomes, how should my LWRP cookbook go about loading the gems it needs to be happy?
[2013-10-19 00:02:36 -0400] jbz: LWRPs, afaik, should be self-contained.  I'd install them as part of the LWRP, but I'm not sure what the 'proper' pattern is here.
[2013-10-19 00:05:01 -0400] objectiveous: jbz: Thanks. I'm thinking I could call the resource GemPackage directly from within my provider.
[2013-10-19 00:05:11 -0400] jbz: Yep
[2013-10-19 00:05:29 -0400] jbz: unless you need the gem installed for the code in the lwrp itself to work
[2013-10-19 00:06:18 -0400] jbz: in which case you probably need chef_gem
[2013-10-19 00:07:24 -0400] objectiveous: Ah. Right.
[2013-10-19 00:08:01 -0400] objectiveous: Would that look like "foo = Chef::Resource::ChefGem.new"
[2013-10-19 00:09:24 -0400] jbz: I thought there was actually a resource for it now
[2013-10-19 00:09:33 -0400] tmichael: yeah, there is: http://docs.opscode.com/resource_chef_gem.html
[2013-10-19 00:09:34 -0400] jbz: chef_gem do  (stuff) end
[2013-10-19 00:09:47 -0400] tmichael: objectiveous  ^^
[2013-10-19 00:10:34 -0400] objectiveous: jbz: Err. I can do that from within my provider?
[2013-10-19 00:11:14 -0400] jbz: I think so, but I don't know for sure...
[2013-10-19 01:25:37 -0400] pwelch: has anyone dealt with a json conflict? : Unable to activate chef-11.6.2, because json-1.8.1 conflicts with json
[2013-10-19 01:27:36 -0400] pwelch: is there a fix for json-1.8.1 conflict with chef?
[2013-10-19 02:06:47 -0400] teukka: pwelch: I've seen that somewhere. I just pinned down the json to `<= 1.7.7` in Gemfile
[2013-10-19 02:07:15 -0400] pwelch: teukka: Im trying to include it with a gemfile in a subdirectory of a rails 4 project
[2013-10-19 02:08:38 -0400] teukka: pwelch: if you have some other gem that requires newer json you have a problem...
[2013-10-19 02:08:50 -0400] pwelch: teukka: thats what I was worried about :/
[2013-10-19 02:09:08 -0400] teukka: welcome to the dependency hell :(
[2013-10-19 02:10:57 -0400] pwelch: trying to include it for Rails Rumble. Guess I will do it outside of the repo and commit it at the end
[2013-10-19 03:11:34 -0400] Cope: pwelch: is there a reason to include it as part of your rails app bundle?
[2013-10-19 03:11:59 -0400] Cope: the omnibus install is designed specifically to avoid these kinds of issues
[2013-10-19 03:12:23 -0400] Cope: so you can keep all your chef stuff separate, and not get into dependency concerns
[2013-10-19 03:12:25 -0400] pwelch: Cope, using knife-solo to deploy a rails app for a competition so I was going to try and include the code there
[2013-10-19 03:12:41 -0400] Cope: right
[2013-10-19 03:13:12 -0400] Cope: yeah i can see the advantage of bundle install, knife
[2013-10-19 03:13:53 -0400] pwelch: apparently rails 4 uses json 1.8. working around it at the moment
[2013-10-19 03:14:00 -0400] Cope: :(
[2013-10-19 03:14:34 -0400] pwelch: dependency hell sucks
[2013-10-19 03:14:40 -0400] Cope: it really does
[2013-10-19 05:54:52 -0400] ajsharp: anyone awake?
[2013-10-19 05:56:14 -0400] lawnchair: who knows
[2013-10-19 08:07:28 -0400] jaykatta: Hi
[2013-10-19 08:08:44 -0400] jaykatta: knife configure -i command from workstation is giving following error -
[2013-10-19 08:09:01 -0400] jaykatta: ERROR: Your private key could not be loaded from /etc/chef-server/admin.pem Check your configuration file and ensure that your private key is readable
[2013-10-19 08:09:13 -0400] jaykatta: can anybody help here
[2013-10-19 08:12:13 -0400] jaykatta: ERROR: Your private key could not be loaded from /etc/chef-server/admin.pem Check your configuration file and ensure that your private key is readable
[2013-10-19 13:01:08 -0400] ichilton: gchristensen: dmdeklerk: re our conversation yesterday about the 2nd edition of TDI - previous buyers of the 1st ed ebook get 2nd ed for free it seems - it's showing in my oreilly account now.
[2013-10-19 13:26:43 -0400] Cope: FML: http://lpaste.net/94485
[2013-10-19 13:28:04 -0400] dmdeklerk: Cope: got your book yesterday, 2nd edition, i like it
[2013-10-19 13:28:13 -0400] Cope: dmdeklerk: ooh ace :)
[2013-10-19 13:28:33 -0400] Cope: If you like it (or even if you don't) please leave a review! Feedback is *so* important
[2013-10-19 13:28:42 -0400] dmdeklerk: where?
[2013-10-19 13:28:54 -0400] dmdeklerk: oreilly shop?
[2013-10-19 13:29:00 -0400] Cope: O'Reilly website has a review section
[2013-10-19 13:29:09 -0400] Cope: on the book page
[2013-10-19 13:29:11 -0400] dmdeklerk: oke, consider it done
[2013-10-19 13:29:52 -0400] Cope: Also if you find errors or have improvements, use the errata; books like these need to be living... as things change and improve so much
[2013-10-19 13:31:28 -0400] dmdeklerk: I thought I found an error but it turned out not to be. In the beginning you run chef-client on the local system. This confused me since I expected it to be on the server
[2013-10-19 13:31:59 -0400] dmdeklerk: Later realized it was for show only
[2013-10-19 13:36:36 -0400] countdigi: Cope: I noticed your quotes in the beginning from Steve Traugott and Joel Huddleston, Steve Traugott actually got me into "infrastructure-as-code" w/ the original isconf system - used to configure sun boxes w/ glorified make file and scripts - how long we have come :-)
[2013-10-19 13:48:43 -0400] Cope: countdigi: awesome!
[2013-10-19 14:22:38 -0400] ajsharp: Anyone know the best way to enforce only one instance of a service is running across the infrastructure?
[2013-10-19 14:25:45 -0400] dmdeklerk: Put the service in its own recipe, make a role with only that recipe, on the service resource place a not_if and in that do a search for the role with that service??
[2013-10-19 14:25:52 -0400] Cope: ajsharp: could you give an example?
[2013-10-19 14:25:53 -0400] ascendantlogic: beat me to it
[2013-10-19 14:26:00 -0400] ajsharp: Sure
[2013-10-19 14:26:30 -0400] ajsharp: I use this: https://github.com/tomykaira/clockwork
[2013-10-19 14:26:55 -0400] ajsharp: basically an abstract scheduler -- it runs every X, X being configurable
[2013-10-19 14:27:01 -0400] ajsharp: but you only want it running once, globally
[2013-10-19 14:28:15 -0400] ajsharp: so, let's say I have 4 app servers -- i only want to run this scheduler on one of them
[2013-10-19 14:28:28 -0400] ajsharp: and i'm not sure how to do that with chef
[2013-10-19 14:29:05 -0400] ajsharp: I think it's a little tricky b/c Chef is really supposed to ensure your infrastructure is homogenous
[2013-10-19 14:29:11 -0400] ajsharp: per a given role
[2013-10-19 14:31:47 -0400] ajsharp: Cope ascendantlogic ^^
[2013-10-19 14:32:40 -0400] dmdeklerk: ajsharp: did you not see my anwser?
[2013-10-19 14:32:44 -0400] ascendantlogic: Right, given the solution dmdeklerk proposed it'd be a case of whichever had the recipes run first
[2013-10-19 14:32:54 -0400] ajsharp: dmdeklerk oh, i did not, thank you
[2013-10-19 14:33:24 -0400] ascendantlogic: at some point if you really need to make sure only one is running it it might have to be manual...aka different role or slightly different recipe
[2013-10-19 14:33:40 -0400] ajsharp: Right, so i've got it in it's own recipe
[2013-10-19 14:33:41 -0400] ascendantlogic: but as long as you're not converging all 4 servers at once you can control it via dmdeklerk's answer
[2013-10-19 14:33:55 -0400] dmdeklerk: or use a central redis server or something
[2013-10-19 14:34:03 -0400] dmdeklerk: thats atomic
[2013-10-19 14:34:07 -0400] ajsharp: I'm less clear on how to do the role stuff. I'm using AWS opsworks, and they abstract all that stuff from you
[2013-10-19 14:34:16 -0400] ascendantlogic: ah
[2013-10-19 14:34:17 -0400] ajsharp: dmdeklerk yea, it's definitely not the best infrastructure
[2013-10-19 14:34:19 -0400] ajsharp: but it works for now
[2013-10-19 14:58:58 -0400] ajsharp: dmdeklerk so, how amazon appears to solve this for database migrations, is they appear to have some config somewhere that assigns an attribute in each instances json config file that determines wheteher or not migrations should be run on each instance
[2013-10-19 15:51:17 -0400] josephholsten: anyone from the opscode seattle office around?
[2013-10-19 16:21:17 -0400] jhayden: node attribute question:
[2013-10-19 16:21:44 -0400] jhayden: I have created an attribute called foo with a default setting of off
[2013-10-19 16:22:01 -0400] jhayden: using knife I set foo to on
[2013-10-19 16:22:29 -0400] jhayden: I want a chef recipe to execute a piece of code when foo says on
[2013-10-19 16:22:45 -0400] jhayden: and then set it back to off when done
[2013-10-19 16:23:10 -0400] jhayden:  Ican't seem to get this to work. Am I missing something?
[2013-10-19 16:23:59 -0400] gchristensen: jhayden: 1) please try and think of your entire question and ask it all at once, instead of over 2 minutes and 6 messages. 2) maybe set the default attribute to on and then do node.set['foo'] = 'on' in he recipe after running?
[2013-10-19 16:24:24 -0400] gchristensen: also - http://docs.opscode.com/essentials_cookbook_resources_first_run.html
[2013-10-19 16:26:05 -0400] jhayden: gchristensen: Thanks for the response and sorry for the way I posted, won't happen again  8-)
[2013-10-19 19:15:00 -0400] gad0lin: heyo, I am fighting with promoting devops, and chef in my company (big one). Sending everyone to my gitlab is good, but I really would love to have frontend like - http://community.opscode.com/. Is there any thing like that opensourced?
[2013-10-19 19:16:37 -0400] gad0lin: I am pretty sure middle of saturday, is not the best time to ask about that ;)
[2013-10-19 19:16:49 -0400] gchristensen: truth
[2013-10-19 19:53:52 -0400] tubbo: does anyone here run their own chef server?
[2013-10-19 20:14:44 -0400] daos: anyone here using chef-vault?
[2013-10-19 20:22:54 -0400] pabst^: can I use attributes in data bag's? like if I do something like command => "command -C #{node['this']['attribute']}" will that work?
[2013-10-19 20:28:57 -0400] gchristensen: pabst^: no :
[2013-10-19 20:28:59 -0400] gchristensen: :)
[2013-10-19 20:29:12 -0400] pabst^: gchristensen: thanks. I didn't think so.
[2013-10-19 20:33:10 -0400] gchristensen: pabst^: you might make your cookbook act on the attributes somehow, with placeholders or what have you
[2013-10-19 20:33:32 -0400] pabst^: nah
[2013-10-19 20:34:13 -0400] pabst^: im working with the nagios cookbook... its upsetting me
[2013-10-19 20:34:29 -0400] pabst^: Ohio States defense looks like a fricken MAC team
[2013-10-19 20:34:46 -0400] gchristensen: pabst^: hrm... what do you want placeheld?
[2013-10-19 20:35:54 -0400] pabst^: gchristensen: my mind
[2013-10-19 20:37:02 -0400] gchristensen: :) ("Where is my mind" -- Pixies)
[2013-10-19 20:38:01 -0400] pabst^: I hate when I do dumb stuff
[2013-10-19 20:38:15 -0400] pabst^: im obviously a hateful person
[2013-10-19 20:38:26 -0400] gchristensen: pabst^: I hate how hateful you are.
[2013-10-19 20:41:53 -0400] pabst^: gchristensen: I hate being so hateful.
[2013-10-19 20:42:05 -0400] pabst^: I hate that Iowa just scored
[2013-10-19 21:07:30 -0400] tubbo: ugh fuck you chef
[2013-10-19 21:07:44 -0400] tubbo: just tell me all the cookbook deps i need at the start you jerk
[2013-10-19 21:11:38 -0400] tubbo: fuck it i'm installing berkshelf
[2013-10-19 21:19:48 -0400] dmdeklerk: Just went to #xchat with a question on XChat, within a second the @assistent bot replied with an answer. Wouldn't that be cool for #chef?
[2013-10-19 21:35:58 -0400] WilliamPietri: tubbo: Berkshelf definitely reduced the rage in my life.
[2013-10-19 21:36:36 -0400] tubbo: yeah...was hoping i wouldn't have to do that
[2013-10-19 21:36:50 -0400] tubbo: b/c we don't really use berkshelf here and what i'm doing isn't so importnat
[2013-10-19 21:36:52 -0400] tubbo: important*
[2013-10-19 21:37:01 -0400] tubbo: just trying to see how hard it would be to get gitlab on our private git server @ work
[2013-10-19 21:37:16 -0400] tubbo: once i get all the cookbooks installed i'm hoping this will all just work :P
[2013-10-19 22:02:01 -0400] WilliamPietri: Is this possible with roles? I want one or two machines to have a time_server role, and the rest time_client. I'd like to just put the time_client role in my base role, but say that time_server should ignore time_client. Doable?
[2013-10-19 22:03:54 -0400] jbz: WilliamPietri: The role itself can't do the logic, but you can have the cookbook itself check for which role it has (either via the runlist or more easily by having the role set an attribute flag) and run the appropriate recipe (I'm assuming time_server and time_client use different recipes in the same cookbook).
[2013-10-19 22:04:26 -0400] jbz: Alternately, you could have the attribute flag in the roles - and have time_server have a higher precedence than the flag in time_client
[2013-10-19 22:04:31 -0400] WilliamPietri: Interesting! They both use the stock ntp cookbook with different attributes.
[2013-10-19 22:04:56 -0400] WilliamPietri: Ah, ok. Sounds like precedence is what I want.
[2013-10-19 22:05:23 -0400] jbz: If your'e using the same attribute with different values to determine which gets run ,then absolutely.
[2013-10-19 22:05:57 -0400] jbz: Have the time_server role set the attribute with 'normal' and have the time_client role set it with 'default'.
[2013-10-19 22:06:37 -0400] WilliamPietri: Ah, thanks. I was just looking at the docs and swearing. Am I the only one who finds the opscode docs painful? They make me crazy.
[2013-10-19 22:07:36 -0400] jbz: What's awful is that they're much better than they used to be :-)
[2013-10-19 22:08:16 -0400] WilliamPietri: I will try to feel thankful.  :P
[2013-10-19 22:08:38 -0400] jbz: heh
[2013-10-19 22:10:13 -0400] WilliamPietri: In my ruby role definition, I had "default_attributes(" and then the attributes. "normal_attributes" doesn't work, but "override_attributes" does. Should I care?
[2013-10-19 22:12:54 -0400] jbz: oh hm right roles may not be able to set normal, I can't recall.  No, you shouldn't, use override for the higher pri one.
[2013-10-19 22:13:09 -0400] WilliamPietri: Cool. Thanks. That seems to work fine.
[2013-10-19 22:13:59 -0400] jbz: Excellent.  Yep, that's right, roles can't set 'normal', only default/override.
[2013-10-19 22:16:05 -0400] WilliamPietri: Thanks!
[2013-10-19 22:34:02 -0400] daos: i'm messing with chef server 11 (trying to upgrade form chef server 10) and i'm having an issue where i can't upload cookbooks to the new server -- it keeps timing out. other knife commands work and i can authenticate with the server. any ideas?
[2013-10-19 22:38:28 -0400] daos: figured it out
[2013-10-19 22:38:39 -0400] daos: i adjusted the SSL port on my chef server by modifying the nginx config directly
[2013-10-19 22:38:57 -0400] daos: i should have set the attribute in/etc/chef-server/chef-server.rb
[2013-10-19 22:39:06 -0400] daos: and then ran chef-server-ctl reconfigure
[2013-10-19 23:43:02 -0400] WilliamPietri: I'm trying to create a data bag item from a recipe. I'm getting a 403 forbidden, and I can't find anything in the docs or the web UI about permissions. Anybody know the right search terms to get to useful docs?
[2013-10-19 23:43:52 -0400] Guest19530: I have a question
[2013-10-19 23:43:59 -0400] Guest19530: I want to do something like
[2013-10-19 23:44:03 -0400] Guest19530: only_if do           File.exists?("/home/#{params[:name]}/.ssh") && !params[:public_key].nil?          end
[2013-10-19 23:44:12 -0400] Guest19530: but it doesn;t work...
[2013-10-19 23:44:13 -0400] WilliamPietri: Oh, nevermind, found it. "Altering data bags from the node when using the open source server requires the nodes API client to be granted admin privileges. In most cases, this is not advisable."
[2013-10-19 23:44:25 -0400] Guest19530: How do I add a 2nd condition to only_if ?
[2013-10-19 23:45:05 -0400] WilliamPietri: Guest19530: Have you tried just "only_if File.exists?("/home/#{params[:name]}/.ssh") && !params[:public_key].nil?"
[2013-10-19 23:45:51 -0400] Guest19530: same error
[2013-10-19 23:45:54 -0400] Guest19530: Chef::Exceptions::ValidationFailed: Option type must be equal to one of: string, array, hash, symbol!  You passed "boolean".
[2013-10-19 23:46:14 -0400] WilliamPietri: Hmmm, let me look at some of mine.
[2013-10-19 23:48:13 -0400] WilliamPietri: Guest19530: Which version of Chef?
[2013-10-19 23:48:37 -0400] Guest19530: 11.4
[2013-10-19 23:49:31 -0400] WilliamPietri: Weird. in 1.6, I am definitely passing blocks, like this: "only_if { File.read('/etc/hosts').lines.grep(host_line_exp).empty? }"
[2013-10-19 23:49:35 -0400] WilliamPietri: Er, 11.6
[2013-10-19 23:49:58 -0400] RaulChef: ok, I'll try with { condition }
[2013-10-19 23:49:59 -0400] WilliamPietri: So your do/end thing should work as well.
[2013-10-19 23:51:11 -0400] RaulChef: tried with {} ... still no luck
[2013-10-19 23:51:35 -0400] jtimberman: only_if and not_if take either a string, or a block (enclosed in {}'s)
[2013-10-19 23:51:55 -0400] jtimberman: if the argument is a string it is a shell command executed, if it is a block, it's ruby code evaluated.
[2013-10-19 23:52:39 -0400] RaulChef: params[:public_key] is not defined in json
[2013-10-19 23:52:48 -0400] RaulChef: it should return nil, right?
[2013-10-19 23:53:48 -0400] WilliamPietri: I think so.
[2013-10-19 23:53:57 -0400] WilliamPietri: It does with the stock Ruby JSON library, anyhow.
[2013-10-19 23:54:11 -0400] RaulChef: let me try set it to null in json
[2013-10-19 23:55:53 -0400] RaulChef: oh... the problem seems to be somewhere else...
[2013-10-19 23:56:03 -0400] RaulChef: thanks for the help anyway
[2013-10-19 23:56:56 -0400] WilliamPietri: No problem. Good luck!
