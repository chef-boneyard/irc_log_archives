[2013-10-30 00:02:38 -0400] quack_up: ok, so the chef-client cookbook thing... i appear to have just gotten it to work but really by adding  a "service chef-client start" at the end of a custom bootstrap template.  is that really how we're supposed to do this?  i don't think i'm using the chef-client cookbook right.
[2013-10-30 00:03:52 -0400] nickh: whoever asked about the multiple recipe role example, I created a gist here: https://gist.github.com/nshenry03/7224891
[2013-10-30 00:07:12 -0400] nickh: If you set a default attribute in 'attributes/default.rb' (for example: default['jumpcloud']['databag_name'] = 'secrets'), you should just be able to use that in a recipe without setting in a role or environment first, correct (and it should just use that as the default value)?  For example: jumpcloud_credentials = Chef::EncryptedDataBagItem.load(node['jumpcloud']['databag_name'], node['jumpcloud']['databagitem_name'])
[2013-10-30 00:07:24 -0400] darkdust: hello, anyone familiar with using knife essentails + chef11? specifically, I'm able to download all object except environment objects on a Chef 11 server. I didn't have this problem with Chef 10 sever. Has anyone seen this behavior?
[2013-10-30 00:24:26 -0400] quack_up: anybody know the minimum required to get chef to run as a service (or cron, i don't care) with the chef-client cookbook?  while i have a role with config/service/init_service recipies in it, when i apply that role the service isn't started.  i still have to log in and start it.
[2013-10-30 02:58:56 -0400] otakup0pe: keep getting inconsistent Net::SSH::Disconnect: connection closed by remote host wth knife ssh
[2013-10-30 02:59:01 -0400] otakup0pe: and it's making me a saaaaaaad panda
[2013-10-30 03:53:41 -0400] chrisstreeter: when making a cookbook repo on github, do people typically prefix the repo name with chef- or cookbook- ?
[2013-10-30 03:54:23 -0400] gchristensen: chrisstreeter: if it isn't an organization specifically for chef cookbooks, I prefix it with chef-
[2013-10-30 03:55:09 -0400] chrisstreeter: gchristensen: ok, yeah, i wasn't sure if chef- was for chef addons or if it could be used for cookbooks too
[2013-10-30 03:55:23 -0400] gchristensen: hrmm interesting question
[2013-10-30 03:56:15 -0400] gchristensen: chrisstreeter: I write 100x more cookbooks than chef extensions, and chef extensions would probably be packaged in he form of a cookbook, so I go that route.
[2013-10-30 03:58:18 -0400] chrisstreeter: a quick perusal of github search shows mostly chef- with some <name>-chef and chef-cookbook-<name> and very few cookbook-<name>
[2013-10-30 03:58:33 -0400] chrisstreeter: so no consensus. gchristensen: sounds like chef-<name> is the winner :)
[2013-10-30 04:01:24 -0400] chrisstreeter: gchristensen: thanks for the reply
[2013-10-30 04:01:28 -0400] gchristensen: surely
[2013-10-30 07:13:45 -0400] stormerider: can you include a role from a recipe?
[2013-10-30 07:29:25 -0400] webdev: hi there, i'm getting confused about the order of operations in my cookbook
[2013-10-30 07:30:07 -0400] Guest50259: hi there
[2013-10-30 07:30:19 -0400] Guest50259:  i'm getting confused about the order of operations in my cookbook
[2013-10-30 07:30:37 -0400] Guest50259: do the directives get evaluated and executed in the order they show up in the cookbook?
[2013-10-30 08:19:45 -0400] krakensden: has anyone used the official ucspi-tcp cookbook recently?
[2013-10-30 08:20:09 -0400] krakensden: It seems... deeply broken as is, but someone signed off on it 22 days ago
[2013-10-30 08:29:48 -0400] irr: Ohai Chefs. How to tune opensource chef setup to create search indexes for the new nodes asap? It takes almost 30 seconds for the new node to appear in search results here
[2013-10-30 08:36:53 -0400] irr: I believe I need to tune solr. Any advices here?
[2013-10-30 08:39:01 -0400] bigbigbang: irr: no, but i'm interested in your work
[2013-10-30 08:40:14 -0400] bigbigbang: irr: Just to say : apparently this is the component in opensource chef that will be down first in case of overload...
[2013-10-30 08:41:21 -0400] irr: bigbigbang: yeah, going to enable some logging to see how long does it take to create an index for now. Reading solr wiki...
[2013-10-30 08:48:50 -0400] arussel: I see how I can run a recipe in a vm using kitchen and that it would fail if there is an error, but is there a way to run some additional check inside the created vm ?
[2013-10-30 09:15:42 -0400] arussel: looks like busser is the way to go, what cookbook can I look into to see an example ?
[2013-10-30 09:29:02 -0400] s2r2: arussel: +1 for busser, this is a comprehensive blog post series that helped me a lot: http://misheska.com/blog/2013/08/06/getting-started-writing-chef-cookbooks-the-berkshelf-way-part3/#iteration-16---writing-your-first-serverspec-test
[2013-10-30 09:34:39 -0400] arussel: s2r2: thanks
[2013-10-30 09:35:07 -0400] s2r2: :)
[2013-10-30 09:54:30 -0400] lewiz: It's a shame the service provider doesn't offer a timeout
[2013-10-30 10:15:36 -0400] arussel: is there a way to create a dummy recipe to be run with kitchen ?
[2013-10-30 10:16:05 -0400] arussel: I was hoping that just adding test/fixtures/cookbooks/dummytest would do it, but no
[2013-10-30 10:37:13 -0400] arussel: I'm using berks to manage cookbooks, and it updload the cookbooks to the vm:
[2013-10-30 10:37:15 -0400] arussel: /tmp/kitchen-chef-solo/cookbooks/test_java_wrapper
[2013-10-30 10:39:37 -0400] fitzdsl_: is there any documentation about how to write and use a class that inherit from EventDispatch::Base ?
[2013-10-30 11:17:42 -0400] chris__: hello
[2013-10-30 11:26:55 -0400] mattsmith: Morning All, Looking to setup/install a Cassandra cluster on EC2 using Opscode Chef, Is there a preferred cookbook for this?
[2013-10-30 11:36:45 -0400] chris__: sounds like it
[2013-10-30 11:50:53 -0400] nXqd: hi guys
[2013-10-30 11:51:04 -0400] nXqd: I have problem with this error : Network Error: getaddrinfo: nodename nor servname provided
[2013-10-30 11:51:17 -0400] nXqd: when I try to run this command `knife solo prepare vagrant`
[2013-10-30 12:07:53 -0400] _cocytus_: Hi all, I'm wondering if anyone has seen some good examples of working with chef-zero
[2013-10-30 12:08:33 -0400] _cocytus_: I've been trying to get up to speed with a nagios community cookbook, but it requires some search functions that wont work in chef solo
[2013-10-30 12:53:02 -0400] dyer: hey kallistec, u around ?
[2013-10-30 12:54:14 -0400] dyer: word on the street is that you are the guy to talk to about the release task in omnibus...
[2013-10-30 12:54:15 -0400] dyer: :)
[2013-10-30 13:06:49 -0400] fitzdsl_: anyone know how to backport the PR for https://tickets.opscode.com/browse/CHEF-4363 on 11.4 branch ?
[2013-10-30 13:12:52 -0400] chris__: good morning
[2013-10-30 13:19:09 -0400] chris__: I am having trouble with the gitorious recipe.
[2013-10-30 13:19:57 -0400] chris__: I figure it is not as well maintained as something like an apt or mysql recipe.
[2013-10-30 13:21:45 -0400] chris__: I am a developer and want to know what the translation for unit tests are in chef and what the translation for integration tests are.
[2013-10-30 13:22:47 -0400] programmerq: chris__: unfortunately, many cookbooks don't really have a lot of tests included.
[2013-10-30 13:22:50 -0400] n1ko: chris__: you cant start with serverspec and foodcritic
[2013-10-30 13:22:56 -0400] n1ko: neither is exactly what you are looking for
[2013-10-30 13:23:43 -0400] chris__: OK thanks.
[2013-10-30 13:23:49 -0400] programmerq: there is also the bats testing framework included in test-kitchen (1.0.0.beta.3, not 0.5), as well as minitest-handler
[2013-10-30 13:25:06 -0400] programmerq: so, I've recently discovered knife-solo. I'm pretty happy with it. Are there any 'competitors' to it?
[2013-10-30 13:38:07 -0400] midnite-chef: join #learnchef
[2013-10-30 13:38:10 -0400] midnite-chef: oops
[2013-10-30 13:58:43 -0400] teukka: programmerq: for sure there are many alternatives. depends on your needs. I'm happy with knife-solo for my solo needs (in addition to vagrant's chef-solo provisioner)
[2013-10-30 13:59:18 -0400] teukka: programmerq: I'm also very biased in regards of knife-solo ;)
[2013-10-30 14:07:50 -0400] UukGoblin: ERROR: Network Error: Error connecting to http://cookbooks.opscode.com/api/v1/cookbooks?items=10&start=600 - Connection timed out - connect(2)
[2013-10-30 14:07:53 -0400] UukGoblin: twice already
[2013-10-30 14:08:13 -0400] UukGoblin: although it might be on my end... office network isn't exactly known for reliability
[2013-10-30 14:23:26 -0400] mathewpeterson: Hello. I'm using chef solo 11.6 on an ubuntu 12.04 box and I'm trying to install a gem using the gem_package resource. The log says that the gem installed however it I can't actually run the gem. Does chef install ruby gems as a dependency? Any suggestions?
[2013-10-30 14:31:53 -0400] azret: does anyone know how to get the node's hostname to appear in a file
[2013-10-30 14:32:22 -0400] azret: i can't get node[:fqdn] to work when inserting that call into a template file
[2013-10-30 14:33:48 -0400] fixxxermet: Hi everyone.  Having some issues with knife spork.  Getting this:  ERROR: Chef::Exceptions::CookbookNotFound: Could not find cookbook 'mm' in any of the sources!
[2013-10-30 14:35:01 -0400] fixxxermet: Coworkers are telling me that spork worked out of the box for them and threw up their hands.
[2013-10-30 14:44:28 -0400] fish_: hi
[2013-10-30 14:45:24 -0400] fish_: any idea why I can't set the environment in shef via some_node.set['environment'] = 'foo'; some_node.save?
[2013-10-30 14:45:54 -0400] awgross: fish_: environment is a special attribute
[2013-10-30 14:46:03 -0400] awgross: you can access it via node.chef_environment
[2013-10-30 14:46:09 -0400] awgross: but i dont think you can set it
[2013-10-30 14:46:13 -0400] awgross: it gets set at the beginning of the run
[2013-10-30 14:46:35 -0400] fish_: ah, so I can read from some_node.environment but not set it. thanks chef for your consistent api...
[2013-10-30 14:46:41 -0400] fish_: awgross: thanks, I'll try
[2013-10-30 14:47:58 -0400] fish_: nope. that doesn't work either
[2013-10-30 14:48:27 -0400] fish_: awgross: do you know any way to set the env on a bunch of nodes (aka: not manually by knife node edit..)
[2013-10-30 14:48:33 -0400] awgross: fish_: there are a few weird ones that you cant set
[2013-10-30 14:49:59 -0400] awgross: fish_: for chef-client i pass it in when I first bootstrap the node
[2013-10-30 14:50:20 -0400] fish_: ah it works with node.chef_environment 'foo'
[2013-10-30 14:50:32 -0400] awgross: interesting
[2013-10-30 14:51:10 -0400] fish_: awgross: 'interesting' is very positive ;)
[2013-10-30 14:51:22 -0400] fish_: well, rather s/very/too/
[2013-10-30 14:51:53 -0400] fish_: it's unbearable how 'interesting' various aspects of chef are
[2013-10-30 14:52:19 -0400] awgross: fish_: agreed, there are many gotchas that I havent found a better way to explain other than when they are stumbled across
[2013-10-30 14:53:06 -0400] fish_: I'm working with chef for over two years not on a everyday basis in a large scale infrastructure and I'm so sick of it..
[2013-10-30 14:53:13 -0400] fish_: s/not/now/
[2013-10-30 14:53:37 -0400] bigbigbang: fish_: you can put a bunch of server in a specific environnement like this : knife exec -E 'search(:node, "hostname:nodename*") { |n| n.chef_environment("environnement"); n.save }'
[2013-10-30 14:53:44 -0400] fish_: and I almost run daily into such issues and unexpected behaviour..
[2013-10-30 14:53:58 -0400] awgross: fish_: Im sorry to hear that
[2013-10-30 14:54:06 -0400] geekbri: While I admit it can be a challenge to deal with some of the unexpected behavior of chef, I find most of the time it's my own fault.
[2013-10-30 14:54:21 -0400] fish_: bigbigbang: yes, figured that out now. but it's really confusing that the environment is readable via 'environment' and 'chef_environment', looks like a node attribute but can't set like one..
[2013-10-30 14:54:25 -0400] geekbri: The only time i really get burned is when I go reading source and I write something to their implementation instead of their interface
[2013-10-30 14:55:34 -0400] fish_: geekbri: don't be too hard to yourself: it should a primary goal for every technology to be as simple as possible (and complex as necessary) and chef isn't doing a good job regarding that
[2013-10-30 14:56:40 -0400] fish_: and that's especially true for a configuration/infrastructure "framework"
[2013-10-30 14:57:36 -0400] fish_: there is just no excuse for having something that looks like a node attribute, can be read like a node attribute but in fact isn't a node attribute and can't be set like one. and this is just one example
[2013-10-30 14:59:36 -0400] fish_: the best way to avoid shooting yourself in the foot with chef is to avoid using it for any more advanced use case. basic installation of some packages and rendering a static configuration file might be okay. but as soon as you touch environments, searches, layered attributes and so one you're fucked
[2013-10-30 14:59:52 -0400] chef316: hi there
[2013-10-30 15:00:04 -0400] chef316: i'm confused about order of operations in the cookbook
[2013-10-30 15:00:06 -0400] fish_: sorry for being such a dick, but I needed to blow off some steam
[2013-10-30 15:00:17 -0400] fish_: chef316: ha! who isn't :)
[2013-10-30 15:00:18 -0400] chef316: is everything evaluated and ran in order?
[2013-10-30 15:00:34 -0400] chef316: does everything need to be in blocks or pure ruby runs just fine?
[2013-10-30 15:00:50 -0400] chef316: can i run blocks based on the outer ruby conditionals?
[2013-10-30 15:00:56 -0400] awgross: chef316: there a 2 phases, first it chef reads in all the info about all the blocks etc, then it runs them in order
[2013-10-30 15:01:10 -0400] awgross: chef316: during the first part, ruby code not in a ruby_block gets executed
[2013-10-30 15:01:24 -0400] awgross: so if you have debug statements etc, they will seem out of place
[2013-10-30 15:01:31 -0400] awgross: unless you place them in a block
[2013-10-30 15:02:12 -0400] awgross: chef316: you can run blocks based on outer ruby conditionals, but the conditions will be decided when it gets parsed, not when it gets to that block.  You should prefer to use not_if, only_if
[2013-10-30 15:02:15 -0400] chef316: awgross: i see, so everything then needs to be in blocks then right? if i have some variables that get set outside of the blocks, they wouldn't get set properly right?
[2013-10-30 15:02:56 -0400] fish_: chef316: no, that's fine. they will be still valid in the scope of that block
[2013-10-30 15:03:10 -0400] chef316: but pure ruby will get executed on the first pass, so by the second time chef parses the cookbook, the variables should be in place, and i should be able to use the variables in the not_if or only_if right?
[2013-10-30 15:03:47 -0400] fish_: chef316: yes
[2013-10-30 15:04:21 -0400] chef316: got it, thx
[2013-10-30 15:05:11 -0400] awgross: chef316: correct
[2013-10-30 15:23:42 -0400] fish_: I would expected run_list sets the run list for all envs, but that doesn't seem to be the case
[2013-10-30 15:25:19 -0400] fish_: I have a node here with a role setting the run list via run_list. now I changed the env, expecting that it will still execute run_list but the chef client dies
[2013-10-30 15:26:58 -0400] fish_: yep, confirmed. if chef_environment != _default, it will never execute the run_list (but only whats set by env_run_list)
[2013-10-30 15:27:10 -0400] fish_: awgross: you're using environments, right? can you confirm that?
[2013-10-30 15:28:05 -0400] awgross: sec, reading
[2013-10-30 15:28:17 -0400] awgross: we use roles and envs, roles set the runlist
[2013-10-30 15:28:23 -0400] awgross: envs set the cookbook versions
[2013-10-30 15:28:40 -0400] fish_: awgross: yes, but it seems like 'run_list' is only executed when env = _default
[2013-10-30 15:28:43 -0400] awgross: what did you change in the environment
[2013-10-30 15:28:48 -0400] awgross: also
[2013-10-30 15:29:00 -0400] awgross: where is the node registered, _Default env?
[2013-10-30 15:29:25 -0400] fish_: awgross: and even the examples here: http://docs.opscode.com/essentials_roles.html look like the ndoe would always execute run_list and additionally to that env_run_lists
[2013-10-30 15:30:16 -0400] fish_: what I mean:
[2013-10-30 15:30:17 -0400] fish_: run_list
[2013-10-30 15:30:17 -0400] fish_: A list of recipes and/or roles that will be applied and the order in which those recipes and/or roles will be applied
[2013-10-30 15:30:25 -0400] fish_: ^- that's only true for environment _default
[2013-10-30 15:30:26 -0400] awgross: hmm, I havent used env_run_list before, unsure
[2013-10-30 15:31:08 -0400] awgross: it seems it assumes _default by.. default
[2013-10-30 15:31:10 -0400] awgross: but you can set more
[2013-10-30 15:31:11 -0400] awgross: env_run_lists "prod" => ["recipe[apache2]"], "staging" => ["recipe[apache2::staging]"], "_default" => []
[2013-10-30 15:31:54 -0400] fish_: awgross: yes, but it's cumbersome, unexpected and the documentation misleading
[2013-10-30 15:32:02 -0400] fish_: but yeah, it will get the job done
[2013-10-30 15:39:33 -0400] awgross: fish_: what are you using env run lists for? Just curious since i havent used them
[2013-10-30 15:39:56 -0400] fish_: awgross: for applying different cookbook versions to differnt environments
[2013-10-30 15:40:17 -0400] awgross: you can do that without environments though right?
[2013-10-30 15:40:33 -0400] awgross: err, with environments but without environment run lists
[2013-10-30 15:41:19 -0400] fish_: awgross: in my current use case I need it to controll the rollout of a new cookbook version. all nodes have the same role applied and using the same cookbook, now I want to roll out a new cookbook version one-by-one
[2013-10-30 15:41:40 -0400] fish_: awgross: how would you do it?
[2013-10-30 15:43:16 -0400] awgross: fish_: I see. I normally push all at once.  If it cant go out all at once (like a clustered DB) then I'll turn off chef and roll it once by one.  Not an issue I have grappled much with
[2013-10-30 15:44:08 -0400] awgross: fish_: It would certainly be a useful tool, to roll changes in small waves over the infra
[2013-10-30 15:45:07 -0400] fish_: yes I stopped chef-client in the past for similar changes, but this time it will takes several days to roll the cookbook out to all systems because I need to reinstall the systems before upgrading the cookbook
[2013-10-30 15:45:23 -0400] awgross: fish_: I see
[2013-10-30 15:46:32 -0400] gchristensen: mattray: are you seeing Plymouth being installed on your pxe servers? its breaking my installs
[2013-10-30 15:46:41 -0400] fish_: (so it's basically: set all nodes to env "old", pin the current cookbook version to that env, upload the new cookbook version, remove first system from chef and reinstall it (-> it will come up in _default env and get the new cookbook), repeat
[2013-10-30 15:47:10 -0400] fish_: but now I really consider disabling chef again for this change
[2013-10-30 15:47:21 -0400] mattray: gchristensen: haven't had any issues
[2013-10-30 15:47:35 -0400] mattray: my pxe server is currently Debian 7.1
[2013-10-30 15:47:44 -0400] mattray: but I've used Ubuntu 12.04 previously
[2013-10-30 15:48:02 -0400] gchristensen: I mean on ubuntu targets. something fishy is going on
[2013-10-30 15:48:07 -0400] awgross: fish_: yes that doesnt seem like a use case that is easily served by the chef defaults
[2013-10-30 15:48:17 -0400] gchristensen: and it seems that preseeds are Deep Magic without much docs
[2013-10-30 15:48:35 -0400] fish_: awgross: as I said, chef is ok for really basic system installation but not actually managing your infrastructure
[2013-10-30 15:49:05 -0400] fish_: that's how big users like facebook and airbnb are using chef
[2013-10-30 15:49:22 -0400] mattray: gchristensen: I agree that preseeds are deep magic
[2013-10-30 15:49:32 -0400] mattray: what are you trying to change?
[2013-10-30 15:49:50 -0400] mattray: I'd recommend starting with the one in the pxe_dust cookbook
[2013-10-30 15:49:56 -0400] mattray: the darkest magic is around partitioning
[2013-10-30 15:50:48 -0400] gchristensen: mattray: oh I did, the issue is that my IPMI serial consoles are broken from plymouth (mountall: disconnected from plymouth) so my natural instinct is to disable plymouth (I don't really want a GUI login screen on a server anyway :)
[2013-10-30 15:52:34 -0400] mattray: agreed. I think I looked into removing plymouth and it was pretty wired up into other Ubuntu stuff
[2013-10-30 15:52:43 -0400] mattray: so I left it alone
[2013-10-30 15:52:59 -0400] gchristensen: ah you may be right
[2013-10-30 15:53:08 -0400] kallistec: dyer: what's up?
[2013-10-30 15:53:11 -0400] gchristensen: yeah, its on my other ones. now to figure out why plymouth is breaking my world
[2013-10-30 15:53:45 -0400] awgross: fish_: True
[2013-10-30 15:57:18 -0400] t0r: looking at using chef for doing config management on a ton of centos servers.  i've heard in the past that rhel-based stuff wasn't well supported on chef, but looking around at cookbooks it seems like that might have been resolved.  can anyone weigh in?
[2013-10-30 15:58:35 -0400] t0r: we've got some SLES systems too but hopefully those'll get phased out soon
[2013-10-30 16:01:27 -0400] hugespoon: mattray: any thought/plan to extend pxe_dust to rhel/cent as well or just leaving it at ubuntu as thats all you need?
[2013-10-30 16:02:03 -0400] mattray: hugespoon: it's on my TODO list
[2013-10-30 16:02:06 -0400] mattray: which is huge
[2013-10-30 16:02:16 -0400] mattray: but I'd take patches
[2013-10-30 16:02:33 -0400] mattray: realistically I'm working on OpenStack
[2013-10-30 16:02:39 -0400] hugespoon: mattray: yeah, i might have to hack around on it, id prefer you keep working on the knife cloud stuff :D
[2013-10-30 16:02:51 -0400] hugespoon: exactly
[2013-10-30 16:03:12 -0400] mattray: so once I have grizzly stabilized I upgrade to havana, then ha-havana, then havana with ceph in our deployment
[2013-10-30 16:03:21 -0400] mattray: THEN I switch to RHEL :)
[2013-10-30 16:03:28 -0400] mattray: which means I upgrade my toolchain
[2013-10-30 16:03:52 -0400] mattray: so I can do automated deployments of Cent 6
[2013-10-30 16:04:03 -0400] hugespoon: havana with ceph sounds like exactly what im interested in! haha hopefully your work can be released on it
[2013-10-30 16:04:17 -0400] mattray: hugespoon: everything I do is open sourced and documented
[2013-10-30 16:04:18 -0400] hugespoon: err on it can be released*
[2013-10-30 16:04:26 -0400] mattray: hugespoon: docs.opscode.com/openstack.html
[2013-10-30 16:04:29 -0400] mattray: just slow
[2013-10-30 16:04:39 -0400] hugespoon: solid, just wasnt sure if it was internal deploy only
[2013-10-30 16:05:07 -0400] mattray: I'm doc'ing my lab, then it'll transition over to Opscode's internal deploy
[2013-10-30 16:05:16 -0400] mattray: but that should get doc'd too
[2013-10-30 16:05:31 -0400] mattray: lab = 5 boxes, opscode ~ 30
[2013-10-30 16:06:02 -0400] sassyn: hi all
[2013-10-30 16:06:07 -0400] sassyn: a quick question
[2013-10-30 16:06:20 -0400] sassyn: I have a chef server running for my local network,
[2013-10-30 16:06:34 -0400] hugespoon: mattray: very nice, thanks for the info
[2013-10-30 16:07:17 -0400] sassyn: we are now join a new company to our network, and I would like to use the chef server I have to support the new site. but I want to have a divided system so same chef server - with two diffrent site
[2013-10-30 16:07:20 -0400] sassyn: it is possible?
[2013-10-30 16:07:22 -0400] awgross: mattray: fix you oddly mirror twitter/github pics O.o
[2013-10-30 16:07:28 -0400] awgross: oddly mirrored*
[2013-10-30 16:07:34 -0400] mattray: awgross: :)
[2013-10-30 16:08:51 -0400] sassyn: so I have CHEF Server X, and Chef Server X - support nodes, X , Y , Z with some cookbooks, and A, B ,C with diffrent cookbook
[2013-10-30 16:09:12 -0400] dyer: @kallistec - I am wondering how u guys use the release task in omnibus ?   I am trying to use it in my inline provisioner in Vagrant, but it seems to want me to pass the name of the artifact as an argument to the task.  I sorta got around that by doing a grep for the artifact in the pkg directory, which seems ugly  ( https://gist.github.com/johntdyer/07f58bdbaa48c491d3bd#file-gistfile1-txt-L7-L8 ).  I am wondering if I am going about this wrong ?
[2013-10-30 16:10:56 -0400] kallistec: dyer: so far we only use the release command for one-offs, for example we build a bunch of ruby/gem combinations just for ubuntu and then use those for internal Ci
[2013-10-30 16:11:46 -0400] tubbo: sassyn: what's been your experience running your own chef server? we're sorta running a ghetto chef server right now. basically it's an app that kickstarts machines, loads a specific OS from PXE boot, and then downloads ruby/chef/our chef repo and runs chef-solo. but i feel like a hosted chef server might be better.
[2013-10-30 16:12:21 -0400] kallistec: dyer: I had a master plan to generalize the release stuff we use for chef and move that into the omnibus repo, currently the script is here: https://github.com/opscode/omnibus-chef/blob/master/jenkins/release.rb
[2013-10-30 16:12:52 -0400] sassyn: tubbo
[2013-10-30 16:12:53 -0400] kallistec: dyer: but then error too many yaks
[2013-10-30 16:13:35 -0400] sassyn: I'm not such experience  - kind of a new baby in chef . but we have a server up and running, when I define some roles and recpies
[2013-10-30 16:13:48 -0400] tubbo: cool
[2013-10-30 16:14:08 -0400] sassyn: now we want to add this to a new network we added, but instead of building a new chef server we would like to use the same one
[2013-10-30 16:14:29 -0400] sassyn: but make sure we have different organisation configuration
[2013-10-30 16:14:54 -0400] sassyn: So, once chef server, two organisation, different cookbooks
[2013-10-30 16:15:14 -0400] hugespoon: sassyn: so you probably want enterprise chef, which offers multi-tenancy
[2013-10-30 16:17:00 -0400] sassyn: OK
[2013-10-30 16:17:08 -0400] sassyn: will read about it - thanks u hugespoon
[2013-10-30 16:17:47 -0400] nicgrayson: Is there a way to search encrypted data bags?
[2013-10-30 16:17:52 -0400] nicgrayson: Ex: admins = data_bag('admins')
[2013-10-30 16:17:52 -0400] nicgrayson: admins.each do |login|
[2013-10-30 16:17:59 -0400] nicgrayson: for non encrypted data bags
[2013-10-30 16:18:12 -0400] gchristensen: nicgrayson: well that isn't really searching
[2013-10-30 16:18:28 -0400] nicgrayson: well searching or doing a .each
[2013-10-30 16:18:44 -0400] tubbo: sassyn: cool, thanks!
[2013-10-30 16:18:51 -0400] gchristensen: you can retrieve them by name, you could probably also enumerate over all of them.... searching inside of them is not possible, no
[2013-10-30 16:19:00 -0400] gchristensen: that defeats the purpose of having your data encrypted at the server
[2013-10-30 16:19:16 -0400] nicgrayson: i don't see a method for loading an encrypted data bag unless you specify an item
[2013-10-30 16:21:02 -0400] nicgrayson: gchristensen: i can't get the data unless i have the item name
[2013-10-30 16:21:05 -0400] sassyn: tubbo: thank u also
[2013-10-30 16:21:06 -0400] sassyn: :-)
[2013-10-30 16:21:15 -0400] gchristensen: ahh lame
[2013-10-30 16:21:22 -0400] nicgrayson: and i want to iterate on all of the items in the bag
[2013-10-30 16:22:23 -0400] gchristensen: you may need to treat the encrypted data bag like a normal databag, and call thelibraries yourself to decrypt them
[2013-10-30 16:23:11 -0400] fish_: when I add a recipe to a runlist without version constraint, it uses the latest cookbook - correct? what if I have two run list entries, one with version constraint and one without?
[2013-10-30 16:24:26 -0400] fish_: let me guess? BOOOOM.
[2013-10-30 16:24:44 -0400] gchristensen: fish_: it uses the version constraints
[2013-10-30 16:25:45 -0400] xerxas: when a service doesnt declare a provider, how does chef determines the provider ?
[2013-10-30 16:26:17 -0400] xerxas: can I override a service to use the upstart provider, outside of this cookbook ?
[2013-10-30 16:26:39 -0400] xerxas: (outside of the cookbook which defines this service, without specifying a provider)
[2013-10-30 16:28:59 -0400] awgross: xerxas: I want to say there are defaults depending on OS
[2013-10-30 16:29:20 -0400] awgross: xerxas: if I am on ubuntu and createa service block, it will try to use init.d by default
[2013-10-30 16:30:30 -0400] xerxas: awgross: thx
[2013-10-30 16:30:45 -0400] gchristensen: nicgrayson: maybe ... data_bag('encrypted').each do |name| data = Chef::EncryptedDataBagItem.load('encrypted', name, secret_key) end ?
[2013-10-30 16:31:00 -0400] xerxas: im working with saucy (which doesnt have boxes, nor chef packages, but I build some  with bento and chef-omnibus) 
[2013-10-30 16:31:14 -0400] xerxas: and saucy converted a number of services from init.d to upstart
[2013-10-30 16:31:25 -0400] xerxas: awgross: any Idea how should I handle that ?
[2013-10-30 16:31:50 -0400] xerxas: patch the upsteam cookbooks ? and have some case platform_version ?
[2013-10-30 16:31:51 -0400] awgross: unsure, dont have a ton of experience with it
[2013-10-30 16:32:00 -0400] awgross: could do that
[2013-10-30 16:32:05 -0400] awgross: also check out chef-rewind
[2013-10-30 16:32:16 -0400] awgross: for modifying the service block if needed
[2013-10-30 16:32:20 -0400] xerxas: yeah I could do that, but this is something I woud like to avaoid ;)
[2013-10-30 16:32:22 -0400] xerxas: avoid
[2013-10-30 16:32:46 -0400] xerxas: chef-rewing, might be an option, yes , looked at it , and generally I like fnichols works  never used it
[2013-10-30 16:32:56 -0400] xerxas: (chef-rewind if from fnichol, right ? )
[2013-10-30 16:32:57 -0400] awgross: its pretty easy to use
[2013-10-30 16:33:10 -0400] awgross: brian berry i believe
[2013-10-30 16:33:53 -0400] xerxas: ah ;)
[2013-10-30 16:34:01 -0400] xerxas: doesnt change a lot ;)
[2013-10-30 16:34:09 -0400] xerxas: awgross: thx for the advice
[2013-10-30 16:44:07 -0400] nicgrayson: gchristensen: i think i'm going to just load the data bag and 'search' the keys then decrypt the item when i find one i need to decrypt. i forgot the keys are not encrypted
[2013-10-30 16:45:06 -0400] gchristensen: got it
[2013-10-30 16:53:01 -0400] matticulous: hoping for some direction - our chef server (open source) is running at ~100% cpu. the erchef service is consuming all. is there a recommended path to determine what is going on?
[2013-10-30 16:59:02 -0400] sassyn: tubbo: still around?
[2013-10-30 16:59:07 -0400] tubbo: yup
[2013-10-30 16:59:09 -0400] tubbo: sassyn: ^
[2013-10-30 16:59:11 -0400] tubbo: :D
[2013-10-30 16:59:16 -0400] tubbo: but i'm about to go get lunch
[2013-10-30 16:59:43 -0400] sassyn: why more thing I have in mind which I don't understand is why do I need to publish the validation.pem to my node
[2013-10-30 16:59:49 -0400] sassyn: OK so have a good lunch
[2013-10-30 16:59:51 -0400] sassyn: I will wait
[2013-10-30 16:59:55 -0400] sassyn: thank u!
[2013-10-30 17:00:16 -0400] tubbo: sassyn: nah i just meant i can only stay a second...i think validation.pem is for auth'ing to your chef server, right?
[2013-10-30 17:00:25 -0400] sassyn: yep
[2013-10-30 17:00:25 -0400] tubbo: like that's how your server knows whether to send config data down to the box?
[2013-10-30 17:00:32 -0400] tubbo: so that's why you need it
[2013-10-30 17:00:43 -0400] sassyn: yep - but this it the private key
[2013-10-30 17:00:45 -0400] gchristensen: validation.pem is used for the initial registration of teh node, after that it is unused and can (should) be removed from the node
[2013-10-30 17:00:56 -0400] sassyn: I would understand if I send into the wire the public key
[2013-10-30 17:01:00 -0400] sassyn: but never the private key
[2013-10-30 17:01:15 -0400] sassyn: like in SSH auth
[2013-10-30 17:01:44 -0400] gchristensen: sassyn: the validation.pem is used to register, its used to locally sign the request and send it up to the chef server to exchange it for a local private key
[2013-10-30 17:02:23 -0400] sassyn: gchristensen: yep I understand - but why the client need to have the private key?
[2013-10-30 17:02:55 -0400] gchristensen: its just How Its Done I reckon. you could pregenerate the client pem's ahead of time I suppose, but thatisn't automated at the moment I don't think.
[2013-10-30 17:03:42 -0400] mattray: sassyn: it uniquely identifies the node with the machine and can be revoked or given additional privileges
[2013-10-30 17:04:04 -0400] gchristensen: mattray: he's referring to the validation.pem needed on the node itself
[2013-10-30 17:04:22 -0400] mattray: gchristensen: don't need it after the initial client registration
[2013-10-30 17:04:31 -0400] gchristensen: mattray: that's what I was saying :)
[2013-10-30 17:04:36 -0400] mattray: the chef-client cookbook has a delete validator recipe
[2013-10-30 17:05:06 -0400] sassyn: so this key is only for the register process of the node to the chef server?
[2013-10-30 17:05:14 -0400] sassyn: this means I can delete this key after?
[2013-10-30 17:05:39 -0400] mattray: yes
[2013-10-30 17:06:02 -0400] mattray: https://github.com/opscode-cookbooks/chef-client/blob/master/recipes/delete_validation.rb#L24
[2013-10-30 17:07:12 -0400] sassyn: mattray: thanks
[2013-10-30 17:07:59 -0400] sassyn: so let me understand - I frist need to create the node in the chef server. then I need to copy the validation.pem  to the node
[2013-10-30 17:08:03 -0400] sassyn: then start the node
[2013-10-30 17:08:17 -0400] sassyn: the node create a client.pem - which is it's own private key
[2013-10-30 17:08:44 -0400] sassyn: which is sign with the server public key
[2013-10-30 17:08:57 -0400] sassyn: the validation.pem is only used for the register
[2013-10-30 17:09:02 -0400] sassyn: is this is true?
[2013-10-30 17:09:02 -0400] stormerider: sassyn: no, you can just toss the validation on the node and it self registers.
[2013-10-30 17:09:24 -0400] stormerider: if you precreate the node+client you can just copy the client.pem onto the node directly
[2013-10-30 17:09:26 -0400] sassyn: stormerider: can u please explain
[2013-10-30 17:12:49 -0400] sassyn: stormerider: how can I do this?
[2013-10-30 17:13:21 -0400] sassyn: in chef server I see node as only it's public key
[2013-10-30 17:13:23 -0400] sassyn: not private
[2013-10-30 17:13:35 -0400] sassyn: private is only on the node
[2013-10-30 17:13:53 -0400] stormerider: sassyn: youre conflating nodes and clients
[2013-10-30 17:14:08 -0400] stormerider: if you create a new client you'll get the option to download the private key
[2013-10-30 17:14:37 -0400] sassyn: stormerider: yep I'm kind of a new baby in chef
[2013-10-30 17:14:45 -0400] sassyn: so I have client and I have node
[2013-10-30 17:14:52 -0400] sassyn: what's the diffrent?
[2013-10-30 17:14:57 -0400] stormerider: clients talk to chef server. nodes are the info about the box.
[2013-10-30 17:15:06 -0400] stormerider: in a nutshell.
[2013-10-30 17:15:07 -0400] sassyn: OK
[2013-10-30 17:15:14 -0400] someara: why precreate and copy when you could copy and delete?
[2013-10-30 17:15:39 -0400] stormerider: someara: indeed, just explaining that if you precreate you dont need the validation file
[2013-10-30 17:15:56 -0400] stormerider: but if you dont, you need to register on the client.
[2013-10-30 17:16:00 -0400] sassyn: so if I create a client on the server, then I just need to copy the client.pem to this node
[2013-10-30 17:16:02 -0400] stormerider: need it*
[2013-10-30 17:16:08 -0400] heathsnow_: Am I missing something or is there no "Install Windows Service" provider?  Do I need to use windows_batch to accomplish this task?
[2013-10-30 17:16:47 -0400] someara: the default bootstrapping methodology copy the validation.pem, use it for registration, then delete it with a recipe in your run_list
[2013-10-30 17:17:09 -0400] someara: er well then you're supposed to delete it
[2013-10-30 17:17:12 -0400] someara: its not used after that
[2013-10-30 17:17:18 -0400] sassyn: stormerider: so to summarizes I create the node and client on the server, export the private key of the node to a file, then copy this file to the node and no vailidation is done
[2013-10-30 17:18:19 -0400] sassyn: or as someara point I can use the bootstrapping methodology  which copy the validation.pem auto and then delete it,
[2013-10-30 17:18:27 -0400] someara: sassyn that will totally work however its easier to use the validation key to authenticate the registration so you're not having to go clickyity click in the webUI every time you want a new node
[2013-10-30 17:18:30 -0400] stormerider: sassyn: essentially, the validator is a private key for self registration. it's only needed if your nodes are creating themselves. (unless you're talking about a workstation, which is another beast)
[2013-10-30 17:19:14 -0400] sassyn: OK i got it....
[2013-10-30 17:19:24 -0400] sassyn: but then this mean we send the private key on the wire
[2013-10-30 17:19:33 -0400] sassyn: which is not the best option
[2013-10-30 17:19:40 -0400] stormerider: sassyn: which is why you should use SSL :)
[2013-10-30 17:19:48 -0400] someara: how are you bootstrapping?
[2013-10-30 17:19:53 -0400] sassyn: i do
[2013-10-30 17:19:57 -0400] someara: knife ec2 server create
[2013-10-30 17:19:57 -0400] sassyn: i use both method
[2013-10-30 17:20:01 -0400] sassyn: apt-get on the node
[2013-10-30 17:20:02 -0400] someara: knife boostrap 1.2.3.4
[2013-10-30 17:20:11 -0400] sassyn: or using bootstrapping
[2013-10-30 17:20:22 -0400] stormerider: apt-get install of chef? that's... going to be very very old
[2013-10-30 17:20:28 -0400] someara: knife bootstrap copies it over and ssh pipe
[2013-10-30 17:20:50 -0400] sassyn: i use the repo from opcode
[2013-10-30 17:20:51 -0400] someara: s/and/an/
[2013-10-30 17:21:03 -0400] sassyn: work like magic
[2013-10-30 17:21:20 -0400] stormerider: wasnt aware there was an up to date repo
[2013-10-30 17:21:38 -0400] someara: apt-opscode.com has Very Old Packages
[2013-10-30 17:21:43 -0400] stormerider: last i knew it was an old 10.x rev
[2013-10-30 17:21:48 -0400] sassyn: https://wiki.opscode.com/display/chef10/Installing+Chef+Server+on+Debian+or+Ubuntu+using+Packages
[2013-10-30 17:22:02 -0400] tcate: does anyone know an easy way to add an entry to a node array attribute, without blowing away the current entries?
[2013-10-30 17:22:03 -0400] stormerider: dont use 10 unless you need to.
[2013-10-30 17:22:13 -0400] someara: you want this one
[2013-10-30 17:22:14 -0400] someara: http://www.opscode.com/chef/install/
[2013-10-30 17:22:20 -0400] stormerider: if you're just starting, use 11.
[2013-10-30 17:22:56 -0400] sassyn: someara: thanks
[2013-10-30 17:23:00 -0400] someara: select the drop boxes until it gives you a url
[2013-10-30 17:23:14 -0400] someara: https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chef_11.6.2-1.ubuntu.12.04_amd64.deb
[2013-10-30 17:23:36 -0400] someara: or if you're feeling dangerous, you can curl install.sh into your pipe and bash it
[2013-10-30 17:23:49 -0400] someara: which just generates that url anyway
[2013-10-30 17:23:56 -0400] sassyn: someara:  thank u !
[2013-10-30 17:24:12 -0400] sassyn: so this mean I can't use bootstap
[2013-10-30 17:24:22 -0400] sassyn: if I go with this method
[2013-10-30 17:24:24 -0400] sassyn: right?
[2013-10-30 17:24:26 -0400] stormerider: no, bootstrap has support for omnibus
[2013-10-30 17:24:45 -0400] sassyn: sorry for asking such stupid quetions
[2013-10-30 17:24:49 -0400] sassyn: what is omnibus?
[2013-10-30 17:25:09 -0400] someara: everything on that page is
[2013-10-30 17:25:43 -0400] someara: omnibus is a flat client dpkg format package (or rpm or whatever)
[2013-10-30 17:25:50 -0400] someara: ships The Universe into /opt
[2013-10-30 17:25:59 -0400] someara: instead of following the debian packaging policy
[2013-10-30 17:26:45 -0400] sassyn: OK
[2013-10-30 17:26:58 -0400] sassyn: someara: so get this pkg from where u send it to me
[2013-10-30 17:27:10 -0400] sassyn: and then just do the bootstarp
[2013-10-30 17:27:32 -0400] someara: well
[2013-10-30 17:27:49 -0400] someara: the way most people do it
[2013-10-30 17:28:19 -0400] someara: 1) on your "workstation", install chef, configure knife to point at your chef-server endpoint
[2013-10-30 17:28:48 -0400] someara: 2) knife bootstrap an.ip.ad.dr -r 'recipe[something]'
[2013-10-30 17:28:51 -0400] someara: or
[2013-10-30 17:29:09 -0400] someara: 2) knife ec2 server create -someargs -r 'recipe[something]'
[2013-10-30 17:29:37 -0400] someara: the bootstrap sshes into the target node, installs the validation.pem, chef, and runs chef-client
[2013-10-30 17:29:43 -0400] dmdeklerk: I have no experience regarding web servers and need to choose between nginx or apache to run my rails app. Which one should I go for? What is the latest trend in ops land?
[2013-10-30 17:30:02 -0400] sassyn: someara: OK
[2013-10-30 17:30:05 -0400] sassyn: I understand!
[2013-10-30 17:30:12 -0400] thehar: dmdeklerk: depends on your requirements
[2013-10-30 17:30:19 -0400] thehar: there's nginx and unicorn or there's apache and passenger
[2013-10-30 17:30:19 -0400] dmdeklerk: Difficulty is not so important I taught myself everything uptill now
[2013-10-30 17:30:35 -0400] sassyn: someara: is there diffrent between workstation then node?
[2013-10-30 17:30:38 -0400] stormerider: dmdeklerk: nginx is faster but has less features. depends on what you need.
[2013-10-30 17:30:56 -0400] someara: well "the node" is the computer you're managing
[2013-10-30 17:31:00 -0400] stormerider: sassyn: workstation is your administration setup. ie, your laptop.
[2013-10-30 17:31:04 -0400] stormerider: or desktop
[2013-10-30 17:31:06 -0400] someara: "the workstation" is the computer you're driving things from
[2013-10-30 17:31:11 -0400] sassyn: OK
[2013-10-30 17:31:20 -0400] dmdeklerk: What would be a feature I would miss in nginx?
[2013-10-30 17:31:25 -0400] sassyn: the worksation is where I play with the cockbook, knfie etc...
[2013-10-30 17:31:43 -0400] sassyn: thank u all for the help!
[2013-10-30 17:31:44 -0400] stormerider: sassyn: indeed. in general, knife == workstation.
[2013-10-30 17:31:45 -0400] sassyn: u are cool!
[2013-10-30 17:31:46 -0400] thehar: dmdeklerk: simplicity
[2013-10-30 17:31:53 -0400] sassyn: all of u
[2013-10-30 17:31:58 -0400] sassyn: thanks in million times!
[2013-10-30 17:32:04 -0400] someara: apache has a large amount of configuration options, a rich module set, precompiled packages for many platforms (the modules too) etc
[2013-10-30 17:32:06 -0400] stormerider: sassyn: you may want to check out the chef webinars, i believe week three is tomorrow
[2013-10-30 17:32:13 -0400] dmdeklerk: thehar: apache being simple
[2013-10-30 17:32:13 -0400] someara: nginx is compile your modules into your bin from source
[2013-10-30 17:32:15 -0400] stormerider: and weeks 1 and 2 should be online already
[2013-10-30 17:32:20 -0400] thehar: nginx is simple
[2013-10-30 17:32:24 -0400] someara: but its totallywebscalecallbacksyo
[2013-10-30 17:32:26 -0400] thehar: passenger with apache is a bit comple
[2013-10-30 17:32:27 -0400] thehar: x
[2013-10-30 17:32:39 -0400] sassyn: stormerider: I will look into it
[2013-10-30 17:32:39 -0400] thehar: the application cookbooks for passenger are already out there and easy to get up though
[2013-10-30 17:32:44 -0400] thehar: i'm not sure about unicorn + nginx
[2013-10-30 17:33:04 -0400] sassyn: it just I allready have a private key and public key for all my nodes.... in my local network
[2013-10-30 17:33:08 -0400] sassyn: and I want to use them
[2013-10-30 17:33:16 -0400] sassyn: instead of having new ones
[2013-10-30 17:33:22 -0400] sassyn: all of them are RSA keys 4096
[2013-10-30 17:33:26 -0400] sassyn: long
[2013-10-30 17:33:46 -0400] sassyn: so my best option is to try to avoid the bootstap
[2013-10-30 17:33:52 -0400] sassyn: and use the same keys
[2013-10-30 17:34:04 -0400] dmdeklerk: Once I have apache running with passenger, how much work goes in to keeping things running compared to nginx + unicorn?
[2013-10-30 17:34:35 -0400] thorrsson: Hi #chef
[2013-10-30 17:34:35 -0400] stormerider: sassyn: do you mean SSH keys?
[2013-10-30 17:34:44 -0400] thehar: that depends on your scale
[2013-10-30 17:34:46 -0400] stormerider: or chef keys?
[2013-10-30 17:34:49 -0400] dmdeklerk: Since I dont have experience wouldnt the simple (less things I can f up) nginx be the safer choice?
[2013-10-30 17:35:19 -0400] dmdeklerk: Regarding scale, things will run on aws, the cheaper the boxes the better.
[2013-10-30 17:36:25 -0400] dmdeklerk: Lets say learning curve is not an issue, would that then be nginx or apache?
[2013-10-30 17:37:23 -0400] Cope: I always go with apache
[2013-10-30 17:37:42 -0400] Cope: I think thom went httpd->nginx->httpd
[2013-10-30 17:37:43 -0400] dmdeklerk: Ok, we're done here. I trust you ;-)
[2013-10-30 17:37:47 -0400] Cope: so he may have a view too
[2013-10-30 17:37:53 -0400] thehar: i prefer apache as well
[2013-10-30 17:38:10 -0400] thehar: the only thing nginx offers over apache is it's faster loading time of static content
[2013-10-30 17:38:17 -0400] thehar: modules with apache are easier to maintain
[2013-10-30 17:38:23 -0400] thehar: you don't have to compile them and keep them around, etc
[2013-10-30 17:38:35 -0400] dmdeklerk: thehar: is memcahed regarded static content?
[2013-10-30 17:38:36 -0400] thom: i probably would not use passenger, but yes, httpd to puma/unicorn or similar
[2013-10-30 17:38:37 -0400] thehar: use nginx to load balance to your rails instances instead
[2013-10-30 17:39:04 -0400] Cope: thehar: even then you can run a separate httpd with a different MPM
[2013-10-30 17:39:11 -0400] bean: i'd never use apache to proxypass. Nginx is way better at it, imo.
[2013-10-30 17:40:05 -0400] thehar: bean: agreed
[2013-10-30 17:40:22 -0400] Cope: bean: how are you measuring and defining better?
[2013-10-30 17:40:32 -0400] bean: Load averages are wayyyyyy lower.
[2013-10-30 17:41:23 -0400] sassyn: stormerider:  not SSH keys
[2013-10-30 17:41:26 -0400] sassyn: sorry
[2013-10-30 17:41:33 -0400] gchristensen: perhaps even a decent load balancing tool like varnish would be a better option
[2013-10-30 17:41:55 -0400] gchristensen: nginx can do it, but its less robust at LBs
[2013-10-30 17:42:22 -0400] sassyn: stormerider:  Have a crazy wife - when she call me I nee to obay :-)
[2013-10-30 17:42:29 -0400] thehar: bean: i have used mox_proxy to server up a great deal of traffic but nginx or haproxy are definitely a bit faster with page loads
[2013-10-30 17:42:42 -0400] bean: ^
[2013-10-30 17:42:48 -0400] Cope: 2.4 is much more efficient
[2013-10-30 17:43:15 -0400] Cope: and mod_proxy_balancer is mature and featureful
[2013-10-30 17:43:28 -0400] Cope: also you get the event mpm
[2013-10-30 17:43:38 -0400] stormerider: sassyn: generally a smart idea with spouses in general :)
[2013-10-30 17:44:21 -0400] dmdeklerk: Thank you all very much for your input. I guess there is no *wrong* choice here. That by itself is very insightfull
[2013-10-30 17:44:52 -0400] thehar: dmdeklerk: fwiw
[2013-10-30 17:45:01 -0400] thehar: apache2_passenger cookbook works pretty well out of the gate
[2013-10-30 17:45:07 -0400] dmdeklerk: thehar: in the land of the blind
[2013-10-30 17:45:47 -0400] Cope: dmdeklerk: I'm not a massive fan of passenger, but the cookbook 'just works' and you have fewer moving parts
[2013-10-30 17:46:03 -0400] dmdeklerk: I'm already using apache2_passenger so i'll stck with that for now. Thank you
[2013-10-30 17:46:28 -0400] thehar: passenger is fine for small deployments.. it gets tricky when you scale
[2013-10-30 17:46:28 -0400] thehar: imho
[2013-10-30 17:56:32 -0400] miah: also it forces you to run apache
[2013-10-30 17:56:45 -0400] miah: when you don't need to run apache or nginx at all (if you CDN all of your static content)
[2013-10-30 17:57:03 -0400] miah: haproxy -> unicorn
[2013-10-30 17:57:04 -0400] miah: ftw.
[2013-10-30 17:57:53 -0400] gleam: passenger doesn't need apache or nginx
[2013-10-30 17:57:53 -0400] Guest19756: If I try to create a user that already exists, I get the error "usermod: no options". Is there a way to check if the user already exists *and* it has everything set correctly already?
[2013-10-30 17:58:16 -0400] gleam: well, that's misleading
[2013-10-30 17:58:23 -0400] gleam: it can run like unicorn but it does it by building its own nginx
[2013-10-30 17:58:34 -0400] Guest19756: I don't want to skip the code altogether if the user already exists, becaues there may need to be a change to the user
[2013-10-30 18:01:07 -0400] miah: gleam: no? it used to be an apache module and required it (or nginx)
[2013-10-30 18:01:18 -0400] t0r: hey all.  looking for some opinions.  considering using chef to manage centos systems.  i've heard in the past that support for rhel-based distros wasn't so strong in chef and the community cookbooks, is that still true?
[2013-10-30 18:01:30 -0400] miah: but i see. if its building its own nginx. like i said. you dont need that at all =)
[2013-10-30 18:01:52 -0400] dmdeklerk: miah: gleam: my app being mostly NOT static instead its db generated pages all over. that would be plus (or less min) for apache right?
[2013-10-30 18:02:34 -0400] miah: you dont need apache or nginx if you are serving primarily dynamic content
[2013-10-30 18:02:44 -0400] miah: and using puma or unicorn
[2013-10-30 18:02:57 -0400] miah: which both use rack iirc
[2013-10-30 18:03:22 -0400] miah: your load balancer can deal with them better when speaking directly than through apache/nginx
[2013-10-30 18:03:42 -0400] miah: many site load issues are related to shit queuing in apache/nginx and waiting for backend unicorn/passenger to actually process
[2013-10-30 18:04:08 -0400] miah: nobody gets it right, everybody does it wrong. when you point out to people that its wrong you get called a liar
[2013-10-30 18:04:09 -0400] Cope: right, until you need ssl or to plug your auth into ldap or some other such thing
[2013-10-30 18:04:18 -0400] miah: Cope: haproxy does ssl termination =)
[2013-10-30 18:04:22 -0400] Cope: sure haproxy 1.5 foes
[2013-10-30 18:04:31 -0400] miah: why would i use anything else?
[2013-10-30 18:04:45 -0400] miah: and ruby has ldap libraries
[2013-10-30 18:04:54 -0400] miah: still dont need apache or nginx to speak to those
[2013-10-30 18:05:31 -0400] Cope: miah: last time I terminated ssl on haproxy 1.5 (a few months ago) I had load and stability problems;
[2013-10-30 18:05:46 -0400] Cope: things may have improved... but 1.5 was pretty new then
[2013-10-30 18:06:07 -0400] miah: eh, you could alwayus use something like stud to terminate ssl too
[2013-10-30 18:06:07 -0400] Cope: agree - you could totally do ldap auth in the app
[2013-10-30 18:06:19 -0400] miah: i havent really had any issues using haproxy for this
[2013-10-30 18:06:19 -0400] Cope: it's a neat solution
[2013-10-30 18:06:32 -0400] miah: i proved that EY was ripping us off at last job with their setup
[2013-10-30 18:06:49 -0400] miah: we had ~50 servers and i could server _more_ traffic with 5 servers and a properly configured haproxy
[2013-10-30 18:06:54 -0400] Cope: nice
[2013-10-30 18:06:59 -0400] thehar: miah: heh really?
[2013-10-30 18:07:02 -0400] miah: yes
[2013-10-30 18:07:10 -0400] miah: hitting around 5000rpm's with ~50 app servers
[2013-10-30 18:07:18 -0400] thehar: .....
[2013-10-30 18:07:18 -0400] thehar: WHAT
[2013-10-30 18:07:20 -0400] miah: hit 4000rpm's with 5 servers
[2013-10-30 18:07:24 -0400] miah: =)
[2013-10-30 18:07:33 -0400] thehar: that's absurd
[2013-10-30 18:07:34 -0400] miah: http://www.amazon.com/The-Art-Capacity-Planning-Resources/dp/0596518579
[2013-10-30 18:07:45 -0400] miah: i used johns advice =)
[2013-10-30 18:08:03 -0400] Cope: which was..
[2013-10-30 18:08:06 -0400] miah: the problem is that you end up sending too many sessions to a specific host
[2013-10-30 18:08:17 -0400] miah: let me try to elaborate
[2013-10-30 18:08:45 -0400] miah: on our ec2 instance type, ~35 sessions was about perfect for unicorn
[2013-10-30 18:08:52 -0400] miah: if i sent it 50, all requests would take longer
[2013-10-30 18:09:08 -0400] miah: when you have haproxy -> nginx -> unicorn
[2013-10-30 18:09:25 -0400] miah: nginx is incapable of easily configuring a maximum sessions to a upstream
[2013-10-30 18:09:44 -0400] Cope: hmm good point
[2013-10-30 18:09:45 -0400] miah: and getting nginx to only accept 35 sessions and not queue stuff is also difficult
[2013-10-30 18:09:54 -0400] miah: furthermore
[2013-10-30 18:10:03 -0400] miah: if unicorn goes down
[2013-10-30 18:10:08 -0400] miah: nginx will still queue sessions
[2013-10-30 18:10:10 -0400] Cope: yes
[2013-10-30 18:10:22 -0400] miah: haproxy has no way to determine that the next hop after nginx is bad
[2013-10-30 18:10:35 -0400] miah: but it can be smart if you speak directly to your app server
[2013-10-30 18:10:45 -0400] miah: and have it monitor http status codes
[2013-10-30 18:11:16 -0400] miah: and if you dont need sticky-sessions you can redispatch sessions to other available nodes when they are available
[2013-10-30 18:11:20 -0400] miah: things go _much_ faster
[2013-10-30 18:11:30 -0400] thehar: sounds like i should read this book
[2013-10-30 18:11:33 -0400] miah: yes
[2013-10-30 18:11:44 -0400] miah: everybody should
[2013-10-30 18:12:10 -0400] miah: also, trying things 'outside the box' (eg, what people aren't blogging about)
[2013-10-30 18:12:20 -0400] miah: because most bloggers just cargocult bullshit
[2013-10-30 18:12:25 -0400] gchristensen: +1
[2013-10-30 18:12:40 -0400] dmdeklerk: miah: (quiet voice) how relevant is "The art of ..." it says its from 2008
[2013-10-30 18:12:43 -0400] miah: for proof, go look for "optimized sysctl network settings"
[2013-10-30 18:12:51 -0400] miah: dmdeklerk: its still very very relevent
[2013-10-30 18:13:02 -0400] dmdeklerk: miah: (quiet voice) oke carry on
[2013-10-30 18:13:08 -0400] miah: remember. the web is only about 18 years old =)
[2013-10-30 18:13:35 -0400] miah: (i know its older, but most people didnt start using it until mid 90's)
[2013-10-30 18:13:55 -0400] miah: and therefore we didn't really start thinking about scaling issues until around mid 2000's
[2013-10-30 18:14:12 -0400] gchristensen: miah: every time you talk about things, it makes me want you to look at my infrastructure and tell me its all crap and how to make it better. O.o
[2013-10-30 18:14:18 -0400] miah: haha
[2013-10-30 18:14:43 -0400] miah: sadly im really good at saying whats crap, and how to fix it. makes many people angry
[2013-10-30 18:15:01 -0400] dmdeklerk: miah: f them all
[2013-10-30 18:15:05 -0400] miah: because people dont want to be criticised for their decisions. and im not really criticising people. just technology.
[2013-10-30 18:15:28 -0400] miah: we can build things so much better than we do
[2013-10-30 18:15:35 -0400] miah: we have the technology
[2013-10-30 18:15:43 -0400] miah: we just dont have the group buy-in
[2013-10-30 18:16:30 -0400] Cope: miah: just sayin... I love you <3
[2013-10-30 18:16:32 -0400] miah: =)
[2013-10-30 18:16:38 -0400] gchristensen: I can haz you on my team?
[2013-10-30 18:16:50 -0400] miah: pretty happy at Simple right now
[2013-10-30 18:16:59 -0400] miah: but i do take monetary bribes ;)
[2013-10-30 18:17:59 -0400] miah: i gladly accept gittip and bitcoin =)
[2013-10-30 18:18:40 -0400] miah: also. unrelated. but having a blanket at your desk is totally awesome. why did i never bring a blanket to work before (easier now that i wfh.. but)
[2013-10-30 18:19:37 -0400] gchristensen: agreed. I keep one at my coworking space and another at the HQ for when I hea down
[2013-10-30 18:20:11 -0400] Cope: miah: totally agree
[2013-10-30 18:20:15 -0400] miah: also. http://www.kitchensoap.com/
[2013-10-30 18:20:19 -0400] miah: for more allspaw readings
[2013-10-30 18:20:32 -0400] dmdeklerk: The community cookbook for puma has 20 commits and 1 issue. https://github.com/yourabi/chef-puma Anyone know of one that is more actively developed?
[2013-10-30 18:20:39 -0400] miah: and http://highscalability.com/ for more awesome
[2013-10-30 18:20:59 -0400] miah: dmdeklerk: id' think that puma would be part of your rails deploy
[2013-10-30 18:21:07 -0400] miah: so you wouldnt need a recipe on its own
[2013-10-30 18:21:12 -0400] miah: just use the deploy resource
[2013-10-30 18:21:49 -0400] dmdeklerk: miah: again thank you. you saved me another couple of hours!
[2013-10-30 18:22:13 -0400] miah: =)
[2013-10-30 18:23:23 -0400] Cope: Can anyone think of a compelling reason to include the instance name as part of the varnish cache path
[2013-10-30 18:23:26 -0400] Cope: default['varnish']['storage_file'] = '/var/lib/varnish/$INSTANCE/varnish_storage.bin'
[2013-10-30 18:23:33 -0400] miah: no
[2013-10-30 18:23:35 -0400] Cope: nor me
[2013-10-30 18:23:40 -0400] miah: also, $INSTANCE
[2013-10-30 18:23:43 -0400] miah: a global variable constant?
[2013-10-30 18:23:47 -0400] Cope: fuck knows
[2013-10-30 18:23:54 -0400] Cope: just started looking
[2013-10-30 18:24:02 -0400] Cope: porting varnish cookbook to centos
[2013-10-30 18:24:10 -0400] Cope: this is one of the things that breaks
[2013-10-30 18:24:28 -0400] miah: doh
[2013-10-30 18:25:20 -0400] sparr: # Do not put any cookbook_file or template directives below this line, previous directive runs so long that the session expires and HTTP 403 errors are encountered
[2013-10-30 18:25:36 -0400] sparr: that comment saves me headache every time I remember to read it :)
[2013-10-30 18:26:47 -0400] gchristensen: oh my god
[2013-10-30 18:29:00 -0400] sparr: ?
[2013-10-30 18:29:07 -0400] miah: wow
[2013-10-30 18:29:13 -0400] miah: that sounds... bad.
[2013-10-30 18:29:26 -0400] gchristensen: yeah
[2013-10-30 18:29:31 -0400] sparr: it's a known bug
[2013-10-30 18:29:32 -0400] gchristensen: that
[2013-10-30 18:29:44 -0400] sparr: I just don't expect it to be fixed in the near future
[2013-10-30 18:29:56 -0400] sparr: so the workaround is to make sure the really long thing stays at the bottom of my recipe
[2013-10-30 18:32:48 -0400] miah: just rmember. bottom of your recipe doesn't mean end of run_list =)
[2013-10-30 18:33:02 -0400] miah: and also probably doesnt mean end of run_queue
[2013-10-30 18:36:01 -0400] Cope: Now look at me like a stormtrooper in drag
[2013-10-30 18:37:05 -0400] Cope: miah: do you use the runit cookbook?
[2013-10-30 18:37:56 -0400] joe_k: is whatever-validator.pem the server's public key?
[2013-10-30 18:38:20 -0400] joe_k: i.e. not a secret I need to keep secret?
[2013-10-30 18:38:55 -0400] mattray: joe_k: it's a secret inasmuch that it can be used to create new node clients
[2013-10-30 18:39:16 -0400] joe_k: so don't check it into a public repo
[2013-10-30 18:39:29 -0400] Cope: joe_k: on the contrary, it's more like your own superpowerful private key
[2013-10-30 18:39:30 -0400] mattray: which is why chef-client::delete_validator is around
[2013-10-30 18:39:30 -0400] mattray: yes
[2013-10-30 18:40:06 -0400] joe_k: i understand having private keys for the users on the server but don't understand what prinicpal the -validator.pem represents
[2013-10-30 18:41:58 -0400] joe_k: basically its feeling like I shouldn't check .chef in
[2013-10-30 18:43:15 -0400] joe_k: is anyone else using chef to provisions machines for test runs? Where do your scripts that do that live? I want them with the project but I'm not sure about checking in a chef-repo with the project
[2013-10-30 18:43:38 -0400] joe_k: and having one chef-repo "per organization" doesn't seem right when many packages tests would be in there
[2013-10-30 18:44:11 -0400] mattray: joe_k: what kind of testing?
[2013-10-30 18:44:21 -0400] sparr: miah: would I still encounter the problem for a later item in the run list?
[2013-10-30 18:44:22 -0400] joe_k: integration testing of our app
[2013-10-30 18:44:37 -0400] mattray: single-box testing you should check out chef-zero, no server cleanup required
[2013-10-30 18:44:40 -0400] sparr: miah: in this case my run list is a single cookbook containing a single recipe, but that might not be the case eventually, so it would be good to know now
[2013-10-30 18:53:10 -0400] miah: sparr: single cookbook / recipe doesnt matter. chef doesn't really care about recipes. once it evaluates them it completely discards them.
[2013-10-30 18:53:18 -0400] miah: they are only around to build up the ResourceCollection and run_queue
[2013-10-30 18:53:39 -0400] miah: notifications and subscriptions could reorder your run_queue
[2013-10-30 18:53:50 -0400] midnite-chef: hi guys
[2013-10-30 18:54:00 -0400] midnite-chef: what's the best approach for chef to replace kernel version?
[2013-10-30 18:54:04 -0400] miah: and if you have a resource that _can_ cause a timeout, you might at some point hit a run_queue reordering that blows things up
[2013-10-30 18:54:33 -0400] miah: because you can't guarentee a run order of resources in chef
[2013-10-30 18:54:56 -0400] miah: notifications and subscriptions will help a little. but its not perfect.
[2013-10-30 18:55:03 -0400] miah: certainly hard to reason about mentally.
[2013-10-30 18:55:14 -0400] dmdeklerk: you cant? it runs in the same order its declared right?
[2013-10-30 18:55:18 -0400] dmdeklerk: resources
[2013-10-30 18:57:15 -0400] dmdeklerk: I allways thought your resources in your recipes run in the exact same order they are declared. If they are not that surprizes me.
[2013-10-30 18:57:55 -0400] sparr: miah: ok, thanks. I'll have to try harder to keep that action at the end of the list, when the list gets more complicated
[2013-10-30 18:58:06 -0400] miah: they are generally added in the order they are found in
[2013-10-30 18:58:15 -0400] miah: but notifications and subscriptions modify placement in the queue
[2013-10-30 18:58:28 -0400] miah: http://erik.hollensbe.org/2013/03/16/the-chef-resource-run-queue/
[2013-10-30 18:58:31 -0400] miah: reads
[2013-10-30 18:58:37 -0400] dmdeklerk: off course, i get that, but still there is order then
[2013-10-30 18:58:43 -0400] midnite-chef: anyone can help me out?
[2013-10-30 18:58:52 -0400] dmdeklerk: thanks for digging up the link!
[2013-10-30 18:59:53 -0400] joe_k: I have a script that runs berks install before running knife ec2 server create
[2013-10-30 19:00:07 -0400] miah: run_queue is iirc an Array, so ruby does 'order' that
[2013-10-30 19:00:10 -0400] joe_k: do I have to push the result of the berks install to the server before bootstrapping the ec2 node?
[2013-10-30 19:00:37 -0400] miah: imho it should be a Set =)
[2013-10-30 19:00:42 -0400] miah: and the order shouldn't matter
[2013-10-30 19:01:05 -0400] miah: because each resource should be able to do what it needs without the side effect of another resource
[2013-10-30 19:01:38 -0400] miah: https://en.wikipedia.org/wiki/Side_effect_%28computer_science%29
[2013-10-30 19:01:52 -0400] dmdeklerk: the order of recipes/roles should not matter, inside those recipes order of resources do matter. otherwise you should turn everything into an lwrp.
[2013-10-30 19:02:02 -0400] miah: but recipes don't matter to chef
[2013-10-30 19:02:08 -0400] miah: so we are putting value where none exists
[2013-10-30 19:02:15 -0400] dmdeklerk: ?
[2013-10-30 19:02:20 -0400] miah: and yes, you should turn everything into a lwrp =)
[2013-10-30 19:02:20 -0400] btm_: @opscode Chef/Ohai Code Review: join: https://plus.google.com/hangouts/_/72cpjfgple06t1ftn1p3obeqi8, watch: http://youtu.be/OVXhEJUVSiE
[2013-10-30 19:02:35 -0400] dmdeklerk: lol
[2013-10-30 19:02:41 -0400] miah: recipes are only a way to add items to the resource collection and run_queue
[2013-10-30 19:02:55 -0400] joe_k: "A recipe is the most fundamental configuration element within the organization."
[2013-10-30 19:03:00 -0400] joe_k: http://docs.opscode.com/essentials_cookbook_recipes.html
[2013-10-30 19:03:02 -0400] miah: yes
[2013-10-30 19:03:22 -0400] miah: its the easiest way to gain entry to the program flow
[2013-10-30 19:03:40 -0400] miah: but often the way we use it is not the best
[2013-10-30 19:03:47 -0400] dmdeklerk: I guess there are many debatable constructs to be using the library that is chef
[2013-10-30 19:03:52 -0400] miah: ya
[2013-10-30 19:04:05 -0400] miah: basically, my problem with recipes is that we're dealing with abstracts rather than realities
[2013-10-30 19:04:19 -0400] miah: and we have no easy way to make a determination about an abstract
[2013-10-30 19:04:27 -0400] miah: vs, a resource, which has a state
[2013-10-30 19:04:49 -0400] dmdeklerk: so what do you mean, you dont use recipes. how could that be done? i dont think i understand
[2013-10-30 19:05:03 -0400] miah: i can easily reason about a 'bind' resource that tells me via its attributes that its listening on port 53 and that its state is 'enabled'
[2013-10-30 19:05:30 -0400] miah: i can't easily reason about a package resource that installs bind, a service resource that sets up a initscript for a item named bind etc etc
[2013-10-30 19:05:35 -0400] miah: how do i know those items are actually related?
[2013-10-30 19:05:41 -0400] miah: they are only loosely coupled by the recipe
[2013-10-30 19:05:52 -0400] gchristensen: grrr rubocop makes me angry... it requires I have no blank line at the end of the file, which is so bizarre to me
[2013-10-30 19:06:01 -0400] miah: once its evaluated their relationship status is unknown
[2013-10-30 19:06:07 -0400] miah: gchristensen: eh. i <3 it.
[2013-10-30 19:06:18 -0400] miah: the only file that needs a blank line is crontab =)
[2013-10-30 19:06:32 -0400] dmdeklerk: gcristensen: that is weird yes
[2013-10-30 19:06:39 -0400] gchristensen: miah: I love the rest of rubocop, but having a single blank line at the end of my source is something I've known to be a common standard
[2013-10-30 19:06:46 -0400] dmdeklerk: I put newlines everywhere
[2013-10-30 19:06:55 -0400] miah: i certainly dont
[2013-10-30 19:07:19 -0400] dmdeklerk: rubocop smacked that out of you ;)
[2013-10-30 19:07:34 -0400] dmdeklerk: and now you love it.
[2013-10-30 19:07:52 -0400] joe_k: so annoying to click the whitespace below the text and the cursor ends up at the end of the final line instead of the beginning of the blank line
[2013-10-30 19:08:03 -0400] miah: i started by following the ruby_style_guide then moved to rubocop
[2013-10-30 19:08:14 -0400] gchristensen: ruby style guide says nothing about a single trailing line
[2013-10-30 19:08:18 -0400] miah: yes
[2013-10-30 19:08:25 -0400] miah: but i dont leave whitespace where its un-needed
[2013-10-30 19:08:39 -0400] miah: its not a big deal really
[2013-10-30 19:09:16 -0400] gchristensen: definitely, its a personal preference, which irks me that I can't configure it. someone submitted a PR adding the functionality but closed it.
[2013-10-30 19:10:02 -0400] dmdeklerk: miah: btw puma is looking good i think i'll go with that
[2013-10-30 19:11:17 -0400] someara: @cope have any handy tk+serverspec examples?
[2013-10-30 19:16:44 -0400] bean: i never ever have a blank line at the end of my files.
[2013-10-30 19:17:14 -0400] miah: you can disable specific rules in rubocop
[2013-10-30 19:23:12 -0400] rdobbs: Hi! Any suggestions for using multi-line strings in a data bag? like an ssh key? When I try I get a parsing error: Yajl::ParseError: lexical error: invalid character inside string.
[2013-10-30 19:23:27 -0400] coderanger: rdobbs: \n
[2013-10-30 19:23:36 -0400] rdobbs: tried that, as well as putting a
[2013-10-30 19:23:39 -0400] rdobbs: ^M
[2013-10-30 19:23:40 -0400] rdobbs: :/
[2013-10-30 19:23:48 -0400] rdobbs: maybe tehre's some other funky character?
[2013-10-30 19:23:49 -0400] coderanger: "asdf\nqwer"
[2013-10-30 19:23:54 -0400] coderanger: Thats the way to do it
[2013-10-30 19:24:48 -0400] rdobbs: ah, so join all of the lines?
[2013-10-30 19:25:22 -0400] coderanger: Yes, there is no multiline anything in JSON, its an encoded format
[2013-10-30 19:26:19 -0400] rdobbs: Perfect, thanks :)
[2013-10-30 19:26:27 -0400] rdobbs: worked perfrectly, I really appreciate it, have a good one!
[2013-10-30 19:26:34 -0400] coderanger: Cheers
[2013-10-30 19:26:48 -0400] coderanger: You might also want to consider changing your databag format to be an array of strings
[2013-10-30 19:26:57 -0400] coderanger: and join them with "\n" in the recipe code
[2013-10-30 19:27:48 -0400] pcn: Does anyone have an example of using the lazy keyword with a template, specifically how to use it in chef 11 to get data out node["someattribute"] in the template, using template variables?
[2013-10-30 19:30:38 -0400] miah: or just write a singleton that grabs ssh keys from github instead of databags =)
[2013-10-30 19:33:44 -0400] midnite-chef: what is chef's equivalent to cron @reboot?
[2013-10-30 19:36:16 -0400] Cope: someara: sure - lots
[2013-10-30 19:36:25 -0400] Cope: someara: just grabbing dinner - catch you in 30?
[2013-10-30 19:36:56 -0400] coderanger: midnite-chef: What do you mean?
[2013-10-30 19:37:08 -0400] pcn: No examples of lazy being used and dereferenced in a template?
[2013-10-30 19:37:26 -0400] midnite-chef: was looking for the @reboot cron. nvm, found it
[2013-10-30 19:38:12 -0400] coderanger: midnite-chef: Do you mean getting chef to run something at startup?
[2013-10-30 19:38:59 -0400] midnite-chef: need to do some rebooting
[2013-10-30 19:40:14 -0400] failshell: anyone has a SSH server to recommend for Windows?
[2013-10-30 19:40:49 -0400] coderanger: failshell: winrm
[2013-10-30 19:40:53 -0400] coderanger: not actually SSH
[2013-10-30 19:41:02 -0400] coderanger: but built in
[2013-10-30 19:41:09 -0400] failshell: coderanger: im half using that with vagrant. but you can't shell in
[2013-10-30 19:41:18 -0400] failshell: unless im not understanding the vagrant-windows plugin
[2013-10-30 19:41:32 -0400] coderanger: You kind of can, you can do powershell remote sessions through it
[2013-10-30 19:41:36 -0400] coderanger: but thats windows-to-windows
[2013-10-30 19:42:46 -0400] coderanger: failshell: http://blogs.msdn.com/b/powershell/archive/2008/04/08/powershell-on-linux-solaris-mac-etc.aspx is possibly an option, but I've got no idea if its still around
[2013-10-30 19:45:47 -0400] failshell: i spent hours trying to get ssh running on cygwin to find out the last release is bugged. there's a broken script. you can't really use old cygwin versions
[2013-10-30 19:46:04 -0400] failshell: im bummedo ut
[2013-10-30 19:46:48 -0400] coderanger: failshell: Yahr, Interix is probably your best bet, but its deprecated for win8
[2013-10-30 19:47:27 -0400] coderanger: Or the native openssh server
[2013-10-30 19:49:42 -0400] coderanger: failshell: but WinRM is the only thing thats vaguely supported long term
[2013-10-30 19:51:40 -0400] heathsnow_: Hmmm, how can my LWRP determine which cookbook is calling it?
[2013-10-30 19:51:51 -0400] coderanger: heathsnow_: Yes, self.cookbook_name
[2013-10-30 19:52:10 -0400] heathsnow_: I'll give it a shot, thx coderanger :)
[2013-10-30 19:52:21 -0400] coderanger: because I happen to have it up anyway https://github.com/opscode/chef/blob/master/lib/chef/dsl/recipe.rb#L65
[2013-10-30 19:55:16 -0400] gchristensen: is it recommended against to have test-kitchen keep the box around? otherwise its very slow to run
[2013-10-30 19:55:29 -0400] coderanger: When doing active development, yes
[2013-10-30 19:55:56 -0400] coderanger: though check out kitchen-docker
[2013-10-30 19:56:05 -0400] coderanger: I've not gotten to play with it, but I know it exists
[2013-10-30 19:56:16 -0400] gchristensen: when rapidly developing it is not recommended? that is when I would benefit from it :)
[2013-10-30 19:56:48 -0400] coderanger: gchristensen: Too many double negatives, you know what I mean :P
[2013-10-30 19:56:56 -0400] gchristensen: haha yes, okay.
[2013-10-30 20:04:16 -0400] gchristensen: kitchen test --destroy=never -- this appears to be destroying it anyway. has this syntax changed, coderanger?
[2013-10-30 20:04:31 -0400] btm_: @opscode Cookbook code review: join: https://plus.google.com/hangouts/_/72cpi4lat1oq420u8rvfghnfuo, watch: http://youtu.be/2y3s2KQKsOs
[2013-10-30 20:04:38 -0400] coderanger: gchristensen: I just use the different subcommands manually
[2013-10-30 20:04:47 -0400] gchristensen: ah
[2013-10-30 20:17:30 -0400] Cope: failshell: I generally think that ssh on windows is just 'wrong', but I've had success with freesshd on up to server 2012
[2013-10-30 20:18:01 -0400] failshell: Cope: i share the same view. can you install with CLI arguments? From what ive seen on the site, you need to use the GUI?
[2013-10-30 20:18:19 -0400] Cope: failshell: I used the chocolatey lwrp
[2013-10-30 20:18:31 -0400] failshell: Cope: ok will keep that in mind
[2013-10-30 20:18:34 -0400] failshell: tx
[2013-10-30 20:18:51 -0400] Cope: but even then it was a bitch to maintain and wasn't super reliable
[2013-10-30 20:18:53 -0400] Cope: winrm ftw
[2013-10-30 20:19:23 -0400] Cope: someara: back from dinner; working, but around
[2013-10-30 20:20:44 -0400] failshell: Cope: im kind using winrm with vagrant-windows. but it doesn't implement the 'vagrant ssh' feature
[2013-10-30 20:21:13 -0400] jgoulah: it would be so cool if someone would merge this so travis-ci would start passing again: https://github.com/opscode/chef/pull/1095
[2013-10-30 20:21:53 -0400] coderanger: failshell: Yeah, WinRM is more like an RPC layer than SSH
[2013-10-30 20:22:09 -0400] joe_k: if only microsoft could stop playing NIH
[2013-10-30 20:22:12 -0400] Cope: failshell: right; I had a look at this before... I can't remember what I concluded
[2013-10-30 20:22:26 -0400] Cope: joe_k: dude winrm is way better than anything in linux land
[2013-10-30 20:22:30 -0400] joe_k: powershell hooked up to sshd would be just fine and would solve the OTHER windows problem - the lame console
[2013-10-30 20:22:54 -0400] joe_k: if you like proprietary, heavyweight protocols i guess
[2013-10-30 20:23:10 -0400] Cope: on what grounds do you define winrm as heavyweight?
[2013-10-30 20:23:12 -0400] joe_k: its a difference in philosophy between windows and unix
[2013-10-30 20:23:28 -0400] jgoulah: oh maybe someone patched directly... cool
[2013-10-30 20:23:41 -0400] joe_k: remote method invocation and data marshalling vs text stream
[2013-10-30 20:24:06 -0400] Cope: apples and pears; but yeah, point taken.
[2013-10-30 20:24:32 -0400] Cope: I do wish microsoft would ship an ssh server with the OS
[2013-10-30 20:24:43 -0400] Cope: but I don't think they're playing NIH
[2013-10-30 20:24:52 -0400] Cope: winrm is an entirely different beast
[2013-10-30 20:25:01 -0400] joe_k: they would ship it turned off, with ports blocked, and with a default configuration that didn't allow inbound connections without pre-arranged keys :)
[2013-10-30 20:27:37 -0400] pcn: ohai again.  So if I have a template with variables ({ "foo" => lazy {node["foo"]})
[2013-10-30 20:28:17 -0400] pcn: how do I reference @foo["bar"] in the template?  Are there examples of this working?
[2013-10-30 20:28:57 -0400] pcn: I am having issues when trying to treat it as a node object, e.g.:
[2013-10-30 20:29:11 -0400] pcn: undefined method eys' for #<Chef::DelayedEvaluator:0x000000029c6100>
[2013-10-30 20:29:20 -0400] Cope: the node is in scope in the template
[2013-10-30 20:29:30 -0400] Cope: you don't need an instance variable
[2013-10-30 20:30:26 -0400] pcn: That's one way to look at it.  However, I strongly dislike groping around node in templates.
[2013-10-30 20:31:18 -0400] pcn: It seems that if I set node attributes in e.g. ruby_blocks before this, I am expected to use lazy in order to use the instance variable.
[2013-10-30 20:31:51 -0400] pcn: However I don't get the attributes I'd expect.  Is there e.g. a lazy.realize! or somethign that is not documented that I can use here?
[2013-10-30 20:41:09 -0400] coderanger: pcn: lazy is just an alias for proc
[2013-10-30 20:41:17 -0400] coderanger: pcn: It is only auto-resolved in attrs
[2013-10-30 20:41:36 -0400] coderanger: so you could do variables lazy { {"foo" => node["foo"]} }
[2013-10-30 20:41:44 -0400] coderanger: or resolve it yourself via #call
[2013-10-30 20:46:06 -0400] pcn: Ah, so in the template i can start with @real_foo = @foo.call?
[2013-10-30 20:48:07 -0400] stormerider: so, i know the "%w{ admin editor learn rsm }.each do |app|" syntax, but is there another way in ruby to define an array of strings?
[2013-10-30 20:48:42 -0400] pcn: coderanger thatnks for giving me some ideas.  The docs really don't make it clear how this should be used at my level of not-a-ruby-guy-foo
[2013-10-30 20:49:38 -0400] stormerider: ah, "array = [ '1', '2', '3' ]"
[2013-10-30 20:49:38 -0400] coderanger: kallistec: ^^ not a bad idea, to recurse through template vars and resolve delayedevals
[2013-10-30 21:02:03 -0400] pcn: I have to say that the variables lazy { { :foo => node["bar"] }} is increadibly user-unfriendly.  Having the resource or the template itself evaluate and relize that (at least for templates) would make it much more usable
[2013-10-30 21:02:44 -0400] pcn: That said, I'm grateful for the help still
[2013-10-30 21:03:42 -0400] crombar: I am setting up 'knife ec2 server create' to create a ec2 instance, but it fails after launching the instance with: 'Waiting for sshd..done    Bootstrapping Chef on xxxx.comute.amazonaws.com     ERROR: Errno::ENOENT: No such file or directory - /etc/chef/validation.pem', Has anyone seen this before and  has a clue what is going on? Distro is ubuntu 12.04
[2013-10-30 21:10:28 -0400] pcn: https://wiki.opscode.com/display/chef/Common+Errors#CommonErrors-Nosuchfileordirectory-/etc/chef/validation.pem
[2013-10-30 21:10:30 -0400] palms: crombar: are you including your key in the parameters? ssh login could be failing. should be something like -i .chef/ec2sshkey.pem
[2013-10-30 21:10:41 -0400] palms: or, that.
[2013-10-30 21:11:14 -0400] crombar: palms: yes. I just tried specifying both -i 'path-to-my-private-key.pem' and -S 'name-of-private-key'
[2013-10-30 21:12:22 -0400] crombar: pcn: i am using chef solo. Not sure how that applies here.
[2013-10-30 21:13:05 -0400] pcn: crombar I don't think you are
[2013-10-30 21:13:42 -0400] pcn: I think your bootstrap is trying to bootstrap from a chef server
[2013-10-30 21:17:17 -0400] crombar: pcn: that  makes sense. Not sure what is wrong. I was hoping to get it all going using knife-solo, but I couldn't find any documentation that was very clear about bootstraping ec2
[2013-10-30 21:18:23 -0400] dsferreira: Hi there. Anyone with experience with knife linode? I just created a linode VPS with knife linode using: knife linode server create -r 'role[webserver]' --linode-node-name 'my-linode' but then I got this error message: ERROR: Errno::ENOENT: No such file or directory - /etc/chef/validation.pem
[2013-10-30 21:18:49 -0400] dsferreira: Anyone knows what to I need to do here?
[2013-10-30 21:19:35 -0400] dsferreira: The remaining params for the knife linode command are stored in the knife.rb file.
[2013-10-30 21:20:10 -0400] dsferreira: This is my first attempt of using chef so I'm really lost here
[2013-10-30 21:20:32 -0400] dsferreira: It seems that the bootstrap needs the chef server?
[2013-10-30 21:20:34 -0400] crombar: pcn: seems like this isn't even an issue. I guess a just have to run knife solo prepare after creating the instance.
[2013-10-30 21:21:01 -0400] crombar: Would be great if provisioning an ec2 instance and running knife solo prepare could be combined. Has anyone done that?
[2013-10-30 21:21:10 -0400] dsferreira: My goal is to be able to configure the linode using chef.
[2013-10-30 21:21:23 -0400] dsferreira: Any ideas?
[2013-10-30 21:23:00 -0400] teukka: crombar: yes you can do that =)
[2013-10-30 21:23:23 -0400] teukka: just put `knife[:solo] = true` in .chef/knife.rb
[2013-10-30 21:24:16 -0400] teukka: knife-solo monkey pathces knife's bootstrap class which is also used by `knife ec2 server create`
[2013-10-30 21:24:19 -0400] crombar: teukka: interessting. knife solo appears to create an entry looking like this: 'knife[:chef_mode] = "solo"'
[2013-10-30 21:25:13 -0400] teukka: crombar: no, that is not created by knife-solo...
[2013-10-30 21:27:08 -0400] crombar: teukka: seems like that's correct. must have picked up from some tutorial or something then. Thanks. I will just give it a try :)
[2013-10-30 21:28:03 -0400] teukka: crombar: that is kind of a proof of consept and totally undocumented :)
[2013-10-30 21:29:09 -0400] teukka: knife-digital_ocean is currently the only cloud plugin which has `--solo` option. but all that use Knife::Bootstrap should work with tweaking of knife.rb
[2013-10-30 21:30:02 -0400] teukka: I'm not even sure if opscode would accept `--solo` option to their plugins. but we could monkey patch it in knife-solo...
[2013-10-30 21:30:37 -0400] crombar: teukka: thanks, I guess i should remove that then :)
[2013-10-30 21:30:38 -0400] teukka: but let's see what happens in the future. I assume chef-zero will obsolete most of knife-solo's code
[2013-10-30 21:30:55 -0400] teukka: crombar: well, it should definetly work. I've been using it
[2013-10-30 21:31:15 -0400] teukka: definitely even
[2013-10-30 21:32:01 -0400] jkeiser: Chef 11.8 will have chef-client --local-mode (or chef-client -z) which will serve that purpose (spins up chef-zero invisibly in the background during the client run)
[2013-10-30 21:32:11 -0400] crombar: teukka: I am a little confused. are you talking about the value I had in my knife.rb or the 'knife[:solo]' you mentioned
[2013-10-30 21:32:14 -0400] jkeiser: There's an RC out for that now
[2013-10-30 21:34:08 -0400] teukka: jkeiser: yep. Still you need to install chef and sync you cookbooks etc to the node. I have intented to spike something on top of kallistec's bootstrapper using chef-zero. but haven't gotten there yet
[2013-10-30 21:34:49 -0400] teukka: crombar: oh, I was speaking about knife[:solo] and the monkey patches
[2013-10-30 21:35:48 -0400] crombar: teukka: ah, k. Would you recommend to use chef zero instead of knife solo?
[2013-10-30 21:35:54 -0400] jkeiser: teukka: if the issue is syncing cookbooks to multiple nodes, yeah, a server is what you want
[2013-10-30 21:37:29 -0400] Four02: how does one populate a chef server from a git repo with cookbooks ?
[2013-10-30 21:37:30 -0400] teukka: crombar: I have not used chef-zero myself yet. knife-solo-like tooling is still missing, but of course you can build something up yourself. knife-solo is anyway working fine and is quite widely adopted
[2013-10-30 21:39:05 -0400] crombar: teukka: k, I guess I will stick with knife solo then for now. Every minute I don't have to spend getting my infrastructure running, is a minute more I have to write my actual application :)
[2013-10-30 21:40:57 -0400] teukka: jkeiser: for me knife-solo offers a way to install "one-shot" servers or images without the need for chef-server. vagrant 1.1+ does a lot of the same though
[2013-10-30 21:41:56 -0400] teukka: jkeiser: then I can bootstrap and provision a server with just one command
[2013-10-30 21:42:14 -0400] jkeiser: yep.  that's a niche chef-client --local-mode will serve too.  Still, you can bootstrap against a server with one command too :)
[2013-10-30 21:43:07 -0400] jkeiser: One way or another though, your cookbooks have to get to that node.  Even with a server involved.  Either you copy that stuff up, include it as part of your image, mount it, or you point at a server and let chef-client download them
[2013-10-30 21:43:35 -0400] teukka: yes. knife-solo uses rsync
[2013-10-30 21:44:08 -0400] jkeiser: An interesting bit about chef-client --local-mode is it supports writeback
[2013-10-30 21:44:37 -0400] jkeiser: So when the chef-client run saves stuff back, like the node data or like data bags, they go back to the repository on disk
[2013-10-30 21:45:08 -0400] jkeiser: This becomes even more interesting if you mount stuff instead of syncing
[2013-10-30 21:45:49 -0400] gchristensen: are all attribute loaded from attributes/ ie - I load cookbook::foo, is attributes/bar.rb loaded?
[2013-10-30 21:45:53 -0400] jkeiser: I know that's orthogonal to what you were saying, I'm just still in the "think about the possibilities" mode
[2013-10-30 21:46:40 -0400] teukka: jkeiser: yeah. Some time ago I already tested hacking a writeback functionality for knife-solo too :)
[2013-10-30 21:47:00 -0400] jkeiser: gchristensen: yes, all attributes files are loaded
[2013-10-30 21:47:21 -0400] gchristensen: k
[2013-10-30 21:47:39 -0400] jkeiser: gchristensen: http://docs.opscode.com/essentials_cookbook_attribute_files.html
[2013-10-30 21:48:41 -0400] teukka: jkeiser: mounting is hard to in a portable way. but you can of course run another rsync too. but also rsync seems to be hard with windows
[2013-10-30 21:49:33 -0400] Cope: bleurgh, yeah, rsync with windows is a pain; cwrsync is what I've used, and it has some odd path issues too
[2013-10-30 21:49:55 -0400] jkeiser: Funny that we still haven't solved the problem of copying files :(
[2013-10-30 21:50:11 -0400] Cope: jkeiser: yuno mount a shared drive?
[2013-10-30 21:50:34 -0400] jkeiser: tis true that smb works everywhere
[2013-10-30 21:50:58 -0400] Cope: C$ ftw
[2013-10-30 21:51:05 -0400] jkeiser: and please let's pretend nfs does not exist.
[2013-10-30 21:51:17 -0400] teukka: chef-client --local-mode --with-ftp-server
[2013-10-30 21:51:23 -0400] jkeiser: lol
[2013-10-30 21:51:27 -0400] Cope: :))
[2013-10-30 21:51:41 -0400] teukka: or with email api
[2013-10-30 21:51:57 -0400] teukka: cookbooks as attachments
[2013-10-30 21:52:34 -0400] Cope: chef-cient --local-mode --sneakernet
[2013-10-30 21:52:50 -0400] gchristensen: so with that in mind, I want to add a package to a list of packages to install (node['foo']['packages']['packagename'] = 'version') - should I just do node.default['foo']['package']['packagename'] = 'version' in that recipe?
[2013-10-30 21:52:55 -0400] teukka: jkeiser: to be clear, I'm totally exited about chef-zero and --local-mode. Also just thinking where to go
[2013-10-30 21:56:12 -0400] teukka: speaking of knife-solo:
[2013-10-30 21:56:24 -0400] teukka: [ANN] knife-solo 0.4.0 released: https://github.com/matschaffer/knife-solo/blob/master/CHANGELOG.md#040--2013-10-30
[2013-10-30 21:57:07 -0400] dmdeklerk: jkeiser: what you described "chef-client run saves stuff back" is roughly the way rubber works, how it keeps track of all your node data, ips roles etc.. it writes everything to a yml file in your local repository.
[2013-10-30 21:57:37 -0400] dmdeklerk: its capistrano based
[2013-10-30 21:57:51 -0400] miah: robocopy for windows is pretty good (when you cant use rsync)
[2013-10-30 22:02:54 -0400] jkeiser: dmdeklerk: cool :)  chef-client keeps track of everything in json files, in repository format.  One nice thing about that is, you can use your repo with chef-client --local-mode for a while, and when you're ready to put everything up on Hosted or on an OSS chef server, you just use knife upload (which understands that format)
[2013-10-30 22:02:58 -0400] jkeiser: bam, you're on a server
[2013-10-30 22:03:15 -0400] jkeiser: robocopy is the bees knees
[2013-10-30 22:03:20 -0400] jkeiser: it does some seriously crazy shit
[2013-10-30 22:03:49 -0400] jkeiser: invokes arcane (undocumented?) Windows APIs for copying that speed things up
[2013-10-30 22:03:54 -0400] miah: yup
[2013-10-30 22:04:54 -0400] dmdeklerk: and your chef-client --local-mode on your workstation? never heard of it
[2013-10-30 22:05:02 -0400] dmdeklerk: your = you run
[2013-10-30 22:06:54 -0400] dmdeklerk: what version is --local-mode in. i'm on 11.6.2 and it gives invalid option
[2013-10-30 22:12:50 -0400] teukka: dmdeklerk: 11.8.0. only as a pre-release yet
[2013-10-30 22:12:52 -0400] gchristensen: has anyone experienced this error; undefined method `with' for #<RSpec::Matchers::DSL::Matcher:0x007fd88c6b9718> when trying to run expect(chef_run).to install_package('php5').with(version: '123.foo') ?
[2013-10-30 22:13:08 -0400] dmdeklerk: teukka: ty
[2013-10-30 22:22:30 -0400] dmdeklerk: gchristensen: Weird to see RSpec::Matchers::DSL::Matcher. Instead of something like ChefSpec::**** since its definition should be in chefspec. Otherwise no idea
[2013-10-30 22:23:39 -0400] gchristensen: dmdeklerk: I was a fool :( I cargo-culted the gemfile requirement of 2.x . I upgraded to 3.x and it works fine now
[2013-10-30 22:24:49 -0400] dmdeklerk: its always in the details
[2013-10-30 22:27:10 -0400] dmdeklerk: Stupid passenger decided to use ruby 1.8. Oh really you have an error now...
[2013-10-30 22:27:37 -0400] gchristensen: I hate passengers :)
[2013-10-30 22:28:22 -0400] gchristensen: aah that is incredible. version = '123' package "foo" do version version end works
[2013-10-30 22:28:54 -0400] dgarstang: Can I do a ... knife search on a role rather than a node?
[2013-10-30 22:28:54 -0400] dmdeklerk: I'm a plane a plane I tell you. And if you dont believe me you can get the ### off!
[2013-10-30 22:28:59 -0400] dgarstang: Can I do a ... knife search on a role rather than a node?
[2013-10-30 22:29:06 -0400] dgarstang: Can I do a ... knife search on a role rather than a node?
[2013-10-30 22:29:24 -0400] dmdeklerk: YES YES YES... ;)
[2013-10-30 22:29:33 -0400] dgarstang: Can I do a ... knife search on a role rather than a node?
[2013-10-30 22:29:49 -0400] dmdeklerk: not sure though. felt an urge
[2013-10-30 22:32:14 -0400] dgarstang: So, if I can do 'knife search node' why does 'knife search' not show 'node' as an available option?
[2013-10-30 22:32:49 -0400] dmdeklerk: i'm sorry for my awnser. dont know why i did that?
[2013-10-30 22:33:48 -0400] dgarstang: http://docs.opscode.com/knife_search.html ... no docs on role searching beyond it being mention as an option
[2013-10-30 22:34:13 -0400] dmdeklerk: The database cookbook does a search on the database_master role
[2013-10-30 22:34:45 -0400] dmdeklerk: Isnt there like a special query syntax
[2013-10-30 22:35:00 -0400] dgarstang: got it. "knife search role "name:location_us4""
[2013-10-30 22:36:09 -0400] timsmith: is there a way to uninstall chef via the omnibus installers
[2013-10-30 22:36:12 -0400] timsmith: for freebsd / os x
[2013-10-30 22:42:00 -0400] dmdeklerk: This in passenger_apache2 is giving me troubles: default['passenger']['ruby_bin'] = languages['ruby']['ruby_bin']
[2013-10-30 22:42:24 -0400] dmdeklerk: I need to have ohai pickup the ruby version I just installed through the rbenv cookbook.
[2013-10-30 22:43:25 -0400] jtimberman: dmdeklerk: set passenger['ruby_bin'] in your role
[2013-10-30 22:43:29 -0400] jtimberman: or wrapper cookbook
[2013-10-30 22:43:32 -0400] jtimberman: or on the node
[2013-10-30 22:43:55 -0400] dmdeklerk: Here they use an ohai plugin but that seems like overkill indeed ... http://stackoverflow.com/questions/18834924/chef-ohai-doesnt-find-my-rbenv-ruby
[2013-10-30 22:44:14 -0400] dmdeklerk: The manual way. it is. Thanks
[2013-10-30 22:44:47 -0400] jtimberman: it's more "explicit" than "manual" :)
[2013-10-30 22:45:03 -0400] dmdeklerk: The *explicit* way. it is. Thanks
[2013-10-30 22:45:08 -0400] dmdeklerk: ;-)
[2013-10-30 22:45:28 -0400] jtimberman: ;)
[2013-10-30 22:45:41 -0400] dmdeklerk: ohhh concise
[2013-10-30 22:45:56 -0400] dmdeklerk: bet your on emacs
[2013-10-30 22:46:00 -0400] dgarstang: I need help with knife search. This... knife-us4 search role "name:location_us4" gets me everyting and this knife-us4 search role "name:location_us4" -a dns_domain shows me the KEY but not the data. How do I get the VALUE of dns_domain?
[2013-10-30 22:46:05 -0400] dmdeklerk: or vim even better ;)
[2013-10-30 22:46:51 -0400] gchristensen: is it obnoxious / horrible to do lazy {} when looping over a list of packages to install, so other recipes can add to the list? slash, is there a better way to implement i? I want cookbook::default to install a list of packages, and cookbook::foo to add foo, and cookbook::bar to add bar, while including both of those recipes will install both packages.
[2013-10-30 22:47:30 -0400] coderanger: gchristensen: Make an LWRP?
[2013-10-30 22:47:56 -0400] coderanger: Or, depending on the use case, use node attrs
[2013-10-30 22:48:50 -0400] gchristensen: coderanger: I'm using node attributes, but its unrolling my loop before the extra packages get tacked on
[2013-10-30 22:49:08 -0400] coderanger: All cookbooks' attr files are run before any recipe code
[2013-10-30 22:49:11 -0400] dgarstang: *sigh* I dunno why this is so hard. The knife docs say how to search for stuff, but not how to GET the data from the search
[2013-10-30 22:49:41 -0400] coderanger: dgarstang: What are you trying to do? Related, complaining rarely helps
[2013-10-30 22:50:40 -0400] dgarstang: coderanger: Return some data from a knife search. the documention seems to say how to return nodes matching given search criteria, not how to return data from those nodes
[2013-10-30 22:50:59 -0400] coderanger: dgarstang: -Fj
[2013-10-30 22:51:13 -0400] dgarstang: coderanger: I have a role. I'm trying to return a piece of data nested a few levels deep under default_attributes
[2013-10-30 22:51:21 -0400] coderanger: dgarstang: Related, don't use knife for scripting tasks
[2013-10-30 22:51:47 -0400] coderanger: dgarstang: Also if you know the name, don't use search, just use knife role show
[2013-10-30 22:51:56 -0400] coderanger: Or just use Python
[2013-10-30 22:52:32 -0400] dgarstang: coderanger: I'm creating a new node in chef. I need to inspect the location role to get the domain name. What's the better alterative?
[2013-10-30 22:53:10 -0400] dgarstang: coderanger: I can get the entire role. I could parse it out in the script. Seemed to make more sense to only retreive what I needed tho
[2013-10-30 22:53:10 -0400] coderanger: Why is it not automated by the recipe code itself?
[2013-10-30 22:53:22 -0400] dgarstang: coderanger: This is the script that builds a new instance
[2013-10-30 22:53:45 -0400] coderanger: And you need this because you are setting the FQDN based on it at creation time>
[2013-10-30 22:53:46 -0400] coderanger: ?
[2013-10-30 22:54:33 -0400] dgarstang: coderanger: No. the user passes a cluster to the script on the command line. The cluster is the key for what dns domain to use ... later
[2013-10-30 22:54:45 -0400] coderanger: Use for what?
[2013-10-30 22:54:54 -0400] coderanger: You haven't said what this domain name is used for
[2013-10-30 22:55:15 -0400] eponymi: How long should it take an expert to set up a chef repo, hosted chef, and some basic nrpes for a 5 node network which should be divided for serving the app, db, http cache, load balancer, and nagios
[2013-10-30 22:55:42 -0400] coderanger: eponymi: Depends on how complex the setup is, maybe a week or two given normal levels of env-specific stuff
[2013-10-30 22:55:50 -0400] dgarstang: coderanger: A number of things. One is it's passed to the startup script on the instance which sets the FQDN on the node, without which of course, the chef-client won't work when it runs
[2013-10-30 22:56:19 -0400] coderanger: dgarstang: Okay, so thats what I said before and you said no :P
[2013-10-30 22:56:28 -0400] dgarstang: coderanger: Many moving parts...
[2013-10-30 22:56:36 -0400] coderanger: dgarstang: What is this script written in?
[2013-10-30 22:56:51 -0400] dgarstang: coderanger: Python
[2013-10-30 22:56:53 -0400] gchristensen: dgarstang: are you using the FQDN to identify it as the node name to the chef-server?
[2013-10-30 22:57:17 -0400] coderanger: dgarstang: import chef; api = chef.autoconfigure(); chef.Role(name).default_attribtes['whatever']
[2013-10-30 22:57:18 -0400] dgarstang: gchristensen: not sure I understand that...
[2013-10-30 22:57:30 -0400] dgarstang: coderanger: This is before chef runs...
[2013-10-30 22:57:36 -0400] gchristensen: dgarstang: if you change the FQDN, it can't talk to chef anymore?
[2013-10-30 22:57:41 -0400] coderanger: dgarstang: That has nothing to do with Chef running
[2013-10-30 22:58:06 -0400] coderanger: dgarstang: That is using PyChef to grab the role data from the server
[2013-10-30 22:58:10 -0400] dgarstang: coderanger: 'import chef' ? there's a python lib?
[2013-10-30 22:58:14 -0400] coderanger: because using knife and subprocess is silly
[2013-10-30 22:58:16 -0400] coderanger: dgarstang: Indeed
[2013-10-30 22:58:22 -0400] dgarstang: coderanger: news to me
[2013-10-30 22:58:23 -0400] gchristensen: import antigravity;
[2013-10-30 22:58:28 -0400] coderanger: dgarstang: Look harder ;-)
[2013-10-30 22:58:49 -0400] coderanger: dgarstang: I've written an API client, a chef server, and a recipe dialect for Python
[2013-10-30 22:58:56 -0400] dgarstang: coderanger: there was a pychef earlier which was a git project to convert chef recipes to python code. I assume were not talking about that
[2013-10-30 22:59:07 -0400] coderanger: dgarstang: No, that isn't what pychef is
[2013-10-30 22:59:11 -0400] dgarstang: coderanger: Can it handle multiple chef config files?
[2013-10-30 22:59:15 -0400] coderanger: PyChef is just an API client
[2013-10-30 22:59:45 -0400] coderanger: dgarstang: Sure, autoconfigure() tries to follow the same behavior as knife, or just instantiate chef.API yourself with the info
[2013-10-30 23:00:37 -0400] dgarstang: I assume the docs at https://github.com/coderanger/pychef are as good as it's gonna get...
[2013-10-30 23:01:11 -0400] coderanger: dgarstang: If you mean the RTD docs, yes
[2013-10-30 23:01:48 -0400] dgarstang: coderanger: k. I'll give it a try. knife and subprocess aren't fun
[2013-10-30 23:02:15 -0400] coderanger: dgarstang: There are native API clients for Ruby, Python, Java, PHP, and Javascript (that I know of directly)
[2013-10-30 23:02:18 -0400] coderanger: oh, and Erlang
[2013-10-30 23:02:34 -0400] coderanger: I bet one exists in Go, I've just never looked
[2013-10-30 23:03:16 -0400] dgarstang: coderanger: yah but I really don't want to deal with that. I'm gonna go out on a limb and say the docs are bad, which means more stress. knife with subprocess might suck, but at least I'm spending all my time trying to reverse engineer someone's code
[2013-10-30 23:03:35 -0400] coderanger: dgarstang: Or you know, you can just ask questions
[2013-10-30 23:03:48 -0400] dgarstang: coderanger: ok, is there a role interface in pychef?
[2013-10-30 23:04:04 -0400] coderanger: dgarstang: http://pychef.readthedocs.org/en/latest/api.html#roles
[2013-10-30 23:04:15 -0400] coderanger: Pretty clearly there is
[2013-10-30 23:05:10 -0400] dgarstang: kk
[2013-10-30 23:08:11 -0400] mattupstate: is there a way to determine the linux user running chef-client in a recipe or LWRP?
[2013-10-30 23:08:29 -0400] miah: you can check the process user id
[2013-10-30 23:08:36 -0400] miah: but in gereral, chef is run as root
[2013-10-30 23:08:40 -0400] miah: general too
[2013-10-30 23:09:39 -0400] coderanger: Except on OS X
[2013-10-30 23:13:35 -0400] locomotive: How does one specify runlist for chef-solo? I know about the -o options, but there are docs that suggest the -j option can be used to specify attributes as well as a run_list.
[2013-10-30 23:15:00 -0400] coderanger: locomotive: Yeah, in the JSON attributes you just want a run_list
[2013-10-30 23:15:23 -0400] coderanger: locomotive: example https://github.com/coderanger/chef-dialects-testbed/blob/master/dna.json
[2013-10-30 23:15:36 -0400] coderanger: locomotive: also https://github.com/coderanger/chef-dialects-testbed/blob/master/solo.rb#L3
[2013-10-30 23:16:48 -0400] locomotive: So I can't specify -j dna.json? It has to be via solo.rb?
[2013-10-30 23:16:55 -0400] coderanger: No, you can do either
[2013-10-30 23:17:11 -0400] coderanger: Most people just don't know you can do it via solo.rb :)
[2013-10-30 23:19:10 -0400] locomotive: Hmm using -j node.json with the following: { "run_list": [ "recipe[myrecipe]" ] }
[2013-10-30 23:19:13 -0400] locomotive: It does nothing
[2013-10-30 23:19:17 -0400] locomotive: says no recipes
[2013-10-30 23:19:32 -0400] dgarstang: coderanger: err, is this ths right syntax? api = chef.autoconfigure().from_config_file('/home/doug/.chef/us4/knife.rb') ?
[2013-10-30 23:19:43 -0400] coderanger: No
[2013-10-30 23:19:47 -0400] pmde: hi chefs. can anyone tell me if a notify/subscribe in a resource can cross a node boundary?  i.e. can i have a resource on node A subscribe to a notification from a resource on node B? thanks
[2013-10-30 23:20:02 -0400] dgarstang: well darn
[2013-10-30 23:20:03 -0400] coderanger: dgarstang: from_config_file is a classmethod
[2013-10-30 23:20:26 -0400] coderanger: dgarstang: So chef.ChefAPI.from_config_file(...)
[2013-10-30 23:20:38 -0400] dgarstang: okiday
[2013-10-30 23:37:23 -0400] dgarstang: coderanger: what the heck is Role('foo') gonna get me? apart from an object.... is it an iterator or something?
[2013-10-30 23:38:24 -0400] dgarstang: actually it's a string. Err.
[2013-10-30 23:42:47 -0400] coderanger: dgarstang: That loads the role called foo from the server
[2013-10-30 23:43:01 -0400] dgarstang: coderanger: Well, I'm confused. This http://pastebin.com/Hu3ZNcQv ... just returns a string that's the name of the role... even if the role doesn't exist
[2013-10-30 23:43:43 -0400] coderanger: dgarstang: https://github.com/coderanger/pychef/blob/master/chef/base.py#L129
[2013-10-30 23:45:32 -0400] coderanger: dgarstang: print is not a good debugging tool ;-)
[2013-10-30 23:45:42 -0400] dgarstang: to_dict() I Guess
[2013-10-30 23:45:47 -0400] coderanger: Huh?
[2013-10-30 23:45:54 -0400] coderanger: No, just use .default_attributes
[2013-10-30 23:46:04 -0400] coderanger: That was, in fact, what I lead off with
[2013-10-30 23:46:06 -0400] locomotive: My bad it did work @coderanger thanks
[2013-10-30 23:46:27 -0400] dgarstang: coderanger: i need to use to_dict() to get the dictionary back. Btw, if I give it a bogus role, it doesn't seem to care
[2013-10-30 23:46:42 -0400] coderanger: Yes, if it doesn't exist you just get a blank object
[2013-10-30 23:46:42 -0400] locomotive: It seems to infer that you shouldnt name a cookbook 'run_list'
[2013-10-30 23:46:48 -0400] coderanger: And no, you dont need to_dict
[2013-10-30 23:47:11 -0400] coderanger: locomotive: Hah, yeah I could see that getting confusing
[2013-10-30 23:47:22 -0400] dgarstang: coderanger: I get this .. {'chef_type': 'role', 'default_attributes': {}, 'env_run_lists': {}, 'name': 'location_us4x', 'override_attributes': {}, 'run_list': [], 'json_class': 'Chef::Role', 'description': ''} which would seem to suggest I have a role called location_us4x with nothing in it
[2013-10-30 23:47:36 -0400] dgarstang: ... which I do not
[2013-10-30 23:47:42 -0400] coderanger: dgarstang: Isn't that what I just said
[2013-10-30 23:47:46 -0400] coderanger: "you get a blank object"
[2013-10-30 23:48:15 -0400] dgarstang: i'll just have to remember not to query roles that may not exist
[2013-10-30 23:48:43 -0400] coderanger: dgarstang: Use Role.list() to get the list that exist
[2013-10-30 23:48:50 -0400] coderanger: or 'foo' in Role.list()
[2013-10-30 23:48:54 -0400] dgarstang: k
[2013-10-30 23:49:14 -0400] coderanger: The API is designed to match most Python ORMs
[2013-10-30 23:49:33 -0400] coderanger: So downside is that there isn't a clear API difference between a query and create
[2013-10-30 23:51:45 -0400] gchristensen: is it possible to mock a service in chefspec? I want to test that it notifies A Thing, not that that thing should exist in this particular run (its configurable.)
[2013-10-30 23:51:52 -0400] locomotive: Are there any other top-level attribute in node.json other than run_list? If so, where are they documented?
