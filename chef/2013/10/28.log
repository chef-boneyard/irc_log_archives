[2013-10-28 01:10:17 -0400] judd7: So odd.. why would 'package "lxc-docker" do action :install end' fail, while  the command that chef logged worked just fine: apt-get -q -y install lxc-docker=0.6.4
[2013-10-28 01:11:11 -0400] judd7: of course, stacktrace is no where to be found.
[2013-10-28 01:11:12 -0400] judd7: :(
[2013-10-28 01:12:49 -0400] mveitas: I am trying to a run a job in Jenkins that gets clones my cookbook from Git (into a directory called cookbook) and then executes the following: knife cookbook test my_cookbook --cookbook-path
[2013-10-28 01:13:39 -0400] mveitas: --cookbook-path $WORKSPACE/cookbook
[2013-10-28 03:17:56 -0400] jgoulah: so, travis-ci started failing builds on ruby 1.8.7 because mime-types just put out a new release that isn't compatible
[2013-10-28 03:30:48 -0400] brucelee: hey in this nginx cookbook, there's this line that says include Chef::Mixin::LanguageIncludeRecipe
[2013-10-28 03:31:07 -0400] brucelee: I know Chef::Mixim::languageIncludeRecipe is a library
[2013-10-28 03:31:11 -0400] brucelee: but where does this library come from?
[2013-10-28 03:33:52 -0400] douglaswth: https://github.com/opscode/chef/blob/master/lib/chef/mixin/language_include_recipe.rb
[2013-10-28 03:35:33 -0400] brucelee: douglaswth: thanks
[2013-10-28 03:35:42 -0400] brucelee: douglaswth: where'd you find that? and what is that?
[2013-10-28 03:36:05 -0400] douglaswth: it's the source code of chef
[2013-10-28 03:36:22 -0400] brucelee: Ahh wow
[2013-10-28 03:36:25 -0400] brucelee: i didn't know chef was open source :p
[2013-10-28 03:36:39 -0400] brucelee: douglaswth: nice, thanks :P
[2013-10-28 03:37:17 -0400] brucelee: douglaswth: so one way to know which libraries come with chef is to look through the source, but are there opscode docs that details this information?
[2013-10-28 03:40:34 -0400] brucelee: for example, apparently there's a Chef::Recipe class
[2013-10-28 03:40:45 -0400] brucelee: how would i know there's a class like this?
[2013-10-28 03:50:22 -0400] slicknick: i think i understand what youre looking for, but also dont think its something so easily to capture in documentation that is, rather static content
[2013-10-28 03:50:44 -0400] brucelee: slicknick: ah ok
[2013-10-28 03:50:51 -0400] brucelee: slicknick: trying to understand this bit of code here:
[2013-10-28 03:50:52 -0400] brucelee: ill fpaste
[2013-10-28 03:50:56 -0400] slicknick: do keep in mind -- im still very new with this all, so i may be way off
[2013-10-28 03:51:14 -0400] brucelee: slicknick: dont worry :p
[2013-10-28 03:51:21 -0400] brucelee: just trying to learn
[2013-10-28 03:51:33 -0400] brucelee: slicknick: you think you can figure out what this code does
[2013-10-28 03:51:39 -0400] slicknick: but i think anyone can use a library in chef. the class is just a way to call it?  so if this assumption is correct, its hard to list the clases everyone useso n their own :P
[2013-10-28 03:51:59 -0400] coderanger: brucelee: Using stuff like that is super advanced mode Chef usage
[2013-10-28 03:52:42 -0400] coderanger: brucelee: The Opscode recipes are generally not great examples to follow when you are just starting out
[2013-10-28 03:52:59 -0400] coderanger: brucelee: They are far more complex than stuff you would write as a new user :)
[2013-10-28 03:53:28 -0400] brucelee: coderanger: thanks :
[2013-10-28 03:53:34 -0400] brucelee: http://www.fpaste.org/49836/93239013/
[2013-10-28 03:53:39 -0400] brucelee: here's the url
[2013-10-28 03:53:49 -0400] brucelee: two different examples of something does more orless the same thing
[2013-10-28 03:53:53 -0400] brucelee: what im confused about is:
[2013-10-28 03:54:28 -0400] brucelee: in the first part, it seems they are extending the built in class Chef:Recipe, and defines a new function in it called netmask
[2013-10-28 03:54:54 -0400] brucelee: the second block seems like they are creating a new class called IPTables
[2013-10-28 03:54:58 -0400] slicknick: i aint going there :o   bbiba
[2013-10-28 03:55:05 -0400] brucelee: :P
[2013-10-28 03:55:20 -0400] brucelee: coderanger: in the second part, they are creating a class called IPTables, and within that same block, they are also calling itself?
[2013-10-28 03:55:34 -0400] brucelee: coderanger: line 11, and line 13
[2013-10-28 03:56:00 -0400] brucelee: coderanger: seems line 11, it defines IPTables class, and line 13, it calls itself... or is it calling someting built into chef
[2013-10-28 03:57:52 -0400] brucelee: sorry, what i meant was IPAddress, not IPTables
[2013-10-28 04:08:02 -0400] brucelee: anyone have any clue?
[2013-10-28 04:08:33 -0400] coderanger: brucelee: Is this in a cookbook you wrote?
[2013-10-28 04:09:04 -0400] brucelee: coderanger: this is in a book that i bought, trying to go through it, but theres bits and peices i dont understand
[2013-10-28 04:09:14 -0400] brucelee: such as what i pasted
[2013-10-28 04:09:53 -0400] coderanger: So the first important different is self. in the function name
[2013-10-28 04:09:53 -0400] coderanger: that makes a classmethod
[2013-10-28 04:10:38 -0400] brucelee: important "different"?
[2013-10-28 04:10:46 -0400] coderanger: difference :P
[2013-10-28 04:10:48 -0400] brucelee: oh
[2013-10-28 04:10:54 -0400] brucelee: :P
[2013-10-28 04:10:56 -0400] coderanger: I've been on my feet cooking for almost 5 hours :P
[2013-10-28 04:11:03 -0400] brucelee: nice
[2013-10-28 04:11:05 -0400] brucelee: what are you making
[2013-10-28 04:11:20 -0400] brucelee: made crispy chicken last night off a gordan ramsay vid :
[2013-10-28 04:11:21 -0400] coderanger: pumpkin spice cake with a caramel glaze
[2013-10-28 04:11:44 -0400] brucelee: sounds good, but i dont have a sweet tooth :p
[2013-10-28 04:11:48 -0400] brucelee: im more into savory stuff
[2013-10-28 04:12:35 -0400] brucelee: anyway, so he listed two ways of accomplishing the same thing, first block and second block do the same thing, except the author said the second block is better because it doesn't "pollute the chef libraries"
[2013-10-28 04:12:45 -0400] brucelee: doesn't "pollute the namespace" i mean
[2013-10-28 04:12:56 -0400] brucelee: and he does so by simply creating his own class
[2013-10-28 04:12:56 -0400] coderanger: Right
[2013-10-28 04:12:58 -0400] coderanger: So the first
[2013-10-28 04:13:12 -0400] coderanger: Chef::Recipe is the object that recipe code is eval'd inside
[2013-10-28 04:13:31 -0400] coderanger: so any instance method on Chef::Recipe becomes a bare function in recipe code
[2013-10-28 04:13:57 -0400] coderanger: Like when you do node['foo'] in a recipe
[2013-10-28 04:14:06 -0400] coderanger: that actually is the method #node from here https://github.com/opscode/chef/blob/master/lib/chef/recipe.rb#L74
[2013-10-28 04:14:14 -0400] coderanger: So the first one makes a new function that works similarly
[2013-10-28 04:14:34 -0400] coderanger: but yeah, this can lead to confusing code so adding stuff in that namespace is generally frowned upon
[2013-10-28 04:14:51 -0400] coderanger: makes debugging harder since given a block of recipe code you have no idea where that function came from
[2013-10-28 04:15:03 -0400] brucelee: oh ok
[2013-10-28 04:15:09 -0400] coderanger: The latter is a little better, instead of just calling netmask('athing')
[2013-10-28 04:15:22 -0400] coderanger: you would do IPAddress.netmask('athing')
[2013-10-28 04:15:34 -0400] coderanger: but its still vomiting on chef namespaces for no great reason
[2013-10-28 04:15:35 -0400] brucelee: so heres what im confused about:
[2013-10-28 04:15:45 -0400] coderanger: better still would be to make it your own namespace based on the cookbook name
[2013-10-28 04:16:17 -0400] brucelee: in the first case you can call netmask('athing'), and what it calls is IPAddres(ipaddress).netmask
[2013-10-28 04:16:27 -0400] brucelee: is that something that exists in chef?
[2013-10-28 04:16:38 -0400] coderanger: No
[2013-10-28 04:16:46 -0400] brucelee: ohh ok
[2013-10-28 04:16:54 -0400] coderanger: http://www.ruby-doc.org/stdlib-2.0.0/libdoc/ipaddr/rdoc/IPAddr.html
[2013-10-28 04:16:55 -0400] brucelee: so its something fake that the author made up
[2013-10-28 04:17:00 -0400] coderanger: Thats probably what they meant
[2013-10-28 04:18:14 -0400] coderanger: or maybe https://github.com/bluemonk/ipaddress
[2013-10-28 04:19:14 -0400] brucelee: ahhhh
[2013-10-28 04:19:21 -0400] brucelee: yeah he doesnt explain that part, i see
[2013-10-28 04:19:29 -0400] brucelee: i also forgot it could be anything defined as part of ruby
[2013-10-28 04:19:30 -0400] brucelee: or chef
[2013-10-28 04:19:43 -0400] brucelee: and i just presumed it was part of chef, but couldnt find anything online about that :P
[2013-10-28 04:19:58 -0400] brucelee: which is even more confusing when he defined a class called 'IPAddress' within chef
[2013-10-28 04:20:07 -0400] brucelee: when doing that, doesnt that class name interfere with the function name?
[2013-10-28 04:20:08 -0400] coderanger: Yep, the nice thing about not being a custom DSL is that you have the full power of the whole Ruby universe to play with, but most of the time you probably don't need it and shouldn't go there :)
[2013-10-28 04:20:18 -0400] coderanger: Yeah, his code as written actually doesn't work at all
[2013-10-28 04:20:51 -0400] brucelee: oh wow
[2013-10-28 04:20:54 -0400] coderanger: The second one would fail with a "can't call class Module" or something
[2013-10-28 04:20:59 -0400] coderanger: I think anyway
[2013-10-28 04:21:42 -0400] coderanger: The first probably just means to be IPAddress.new(...).netmask
[2013-10-28 04:21:53 -0400] brucelee: he defined a class called IPAddress, and then called netmask which is a class function of 'IPAddress' right?
[2013-10-28 04:22:19 -0400] coderanger: Instance method, that looks like he is trying to make an instance of IPAddress
[2013-10-28 04:22:43 -0400] brucelee: oh
[2013-10-28 04:23:09 -0400] coderanger: But either the library is really weird, or just forget a .new
[2013-10-28 04:24:13 -0400] brucelee: so the code creates a class function called netmask(ipaddress), within the class IPAddress, and that class function is defined to execute the code "IPAddress(ipaddress).netmask"
[2013-10-28 04:24:21 -0400] brucelee: so this means the class function is not trying to execute itself right?
[2013-10-28 04:24:29 -0400] coderanger: I don't think thats the goal
[2013-10-28 04:24:34 -0400] coderanger: I think its just poorly written
[2013-10-28 04:25:15 -0400] brucelee: its actually trying to execute another member function called netmask within another class IPAddress
[2013-10-28 04:25:29 -0400] coderanger: Yes, that looks to be the intent
[2013-10-28 04:25:37 -0400] brucelee: wow thats really confusion
[2013-10-28 04:25:46 -0400] brucelee: im starting to realize more andmore that this book is really bad
[2013-10-28 04:25:57 -0400] coderanger: Which book is it?
[2013-10-28 04:27:22 -0400] brucelee: its called Chef infrastructure automation cookbook
[2013-10-28 04:27:43 -0400] brucelee: yeah i think its using https://github.com/bluemonk/ipaddress
[2013-10-28 04:27:48 -0400] brucelee: is this a ruby gem?
[2013-10-28 04:28:23 -0400] coderanger: Yeah, the API matches
[2013-10-28 04:28:28 -0400] brucelee: i see sample code within the documentation that can define variables via ip = IPAddress(1.2.3.4/23)
[2013-10-28 04:28:34 -0400] brucelee: and then ip.netmaks
[2013-10-28 04:28:38 -0400] brucelee: ip.netmask
[2013-10-28 04:28:41 -0400] coderanger: Just in that second example, pretend it is says ::IPAddress
[2013-10-28 04:28:44 -0400] coderanger: that would make it work
[2013-10-28 04:30:10 -0400] brucelee: pretend line 13 says that?
[2013-10-28 04:30:22 -0400] coderanger: Yeah
[2013-10-28 04:30:28 -0400] brucelee: ok, a lot more clear
[2013-10-28 04:30:32 -0400] brucelee: coderanger: thanks for clarifying :P
[2013-10-28 04:30:38 -0400] coderanger: I mean given how simple the code is, making this wrapper in general seems silly
[2013-10-28 04:30:39 -0400] MattMaker: That's an often overlooked step: pretend your recipe works
[2013-10-28 04:30:53 -0400] coderanger: I would just use the gem directly
[2013-10-28 04:31:21 -0400] brucelee: coderanger: do you work for opscode?
[2013-10-28 04:31:30 -0400] coderanger: Not anymore, used to
[2013-10-28 04:31:41 -0400] brucelee: coderanger: the author of this book is from germany
[2013-10-28 04:32:11 -0400] coderanger: Yeah, I don't think I've met him
[2013-10-28 04:33:19 -0400] brucelee: coderanger: so you mentioned the opscode cookbooks are all pretty advanced and not recommended as a guide for learning
[2013-10-28 04:33:25 -0400] coderanger: Indeed
[2013-10-28 04:33:27 -0400] brucelee: coderanger: so then what would you recommend as learning material
[2013-10-28 04:33:40 -0400] coderanger: Unfortunately I don't know of much
[2013-10-28 04:33:46 -0400] brucelee: coderanger: should i start coding my own cookbooks
[2013-10-28 04:33:52 -0400] brucelee: coderanger: and just go trial and error
[2013-10-28 04:34:08 -0400] coderanger: I mean using the opscode ones is fine and generally recommended
[2013-10-28 04:34:23 -0400] coderanger: just don't look at the code and assume thats how you should write your own custom ones
[2013-10-28 04:38:34 -0400] brucelee: coderanger: oh ok
[2013-10-28 04:38:41 -0400] brucelee: coderanger: but thats how the code is supposed to be written right?
[2013-10-28 04:38:49 -0400] brucelee: coderanger: its the most 'efficient' or best 'style'?
[2013-10-28 04:39:22 -0400] brucelee: or is it purposely written very efficiently in a way that abstract a lot of the logic in how a newb should 'think'
[2013-10-28 04:39:25 -0400] coderanger: Not always
[2013-10-28 04:39:42 -0400] coderanger: For example, the opscode cookbooks jump through a lot of hoops to support a wide range of OSes
[2013-10-28 04:39:50 -0400] brucelee: oh ok
[2013-10-28 04:39:59 -0400] coderanger: unless you need to support a similar range yourself, that would be extraneous
[2013-10-28 04:40:02 -0400] brucelee: coderanger: do you have any good cookbooks i can model off of :P
[2013-10-28 04:40:22 -0400] brucelee: coderanger: if you have any personal cookbooks for a standard nginx or apache setup, i'd be honored to check it out :p
[2013-10-28 04:40:30 -0400] coderanger: There really isn't a great core of training stuff unfortunately
[2013-10-28 04:40:44 -0400] coderanger: Oh god, my cookbooks are about an order of magnitude more complex
[2013-10-28 04:40:50 -0400] coderanger: don't ever look at them :P
[2013-10-28 04:41:48 -0400] brucelee: :(
[2013-10-28 04:42:17 -0400] coderanger: brucelee: Have you played with learnchef.com?
[2013-10-28 04:42:27 -0400] coderanger: Its probably the best resource right now for starting out
[2013-10-28 04:42:40 -0400] brucelee: coderanger: i havent, but ill check it out now
[2013-10-28 04:42:46 -0400] brucelee: i dont need to begin from the very start
[2013-10-28 04:42:58 -0400] brucelee: i already have it installed and set up, just at the part where im writing cookbooks
[2013-10-28 04:43:11 -0400] brucelee: the cookbooks from opscode are super details and elabarote, very professional
[2013-10-28 04:43:17 -0400] brucelee: when i write my cookbooks i feel like its just "yum install apache"
[2013-10-28 04:43:35 -0400] brucelee: mabye a litlte more :p
[2013-10-28 04:44:32 -0400] brucelee: im also just beginning to integrate chef into my infrastructure, im thinking the first thing may be to set up a databag of all the usernames and their private keys set up the SSH on them
[2013-10-28 04:44:41 -0400] brucelee: coderanger: what are your thoughts o that
[2013-10-28 04:45:24 -0400] coderanger: Yeah, check out fnichol's user cookbook
[2013-10-28 04:45:30 -0400] coderanger: it has a nice recipe that takes care of that
[2013-10-28 04:45:48 -0400] brucelee: coderanger: sweet
[2013-10-28 04:46:18 -0400] coderanger: And yeah, for basic stuff, install package && render config file template is usually all you need
[2013-10-28 04:49:33 -0400] brucelee: coderanger: are you still pretty heavily involved with chef
[2013-10-28 04:49:41 -0400] brucelee: as you dont work for opscode anymore
[2013-10-28 04:49:48 -0400] coderanger: I would say so
[2013-10-28 04:50:09 -0400] coderanger: Really need to finish up my dialects patch so jkeiser and I can take over the world with simplicity
[2013-10-28 04:51:53 -0400] brucelee: lol
[2013-10-28 04:51:58 -0400] brucelee: dialects patch?
[2013-10-28 04:52:08 -0400] brucelee: like a ruby dialect?
[2013-10-28 04:52:19 -0400] coderanger: Its a long story
[2013-10-28 04:52:33 -0400] coderanger: I'm adding stuff so you can write chef recipes and other stuff in languages other than Ruby
[2013-10-28 04:54:51 -0400] brucelee: oh nice
[2013-10-28 04:55:18 -0400] brucelee: hey im reading that users cookbook you recommended, and it says this:
[2013-10-28 04:55:19 -0400] brucelee: The data bag recipe will iterate through a list of usernames defined in node['users'] (by default) and attempt to pull in the user's information from the data bag item. In other words, having:
[2013-10-28 04:55:40 -0400] brucelee: node['users'] = ['hsolo', 'lando', 'luke.skywalker'] , will set up the hsolo user information and not use the lando user information.
[2013-10-28 04:56:13 -0400] brucelee: coderanger: do you know what that actually means? so i shouldn't list users like node['users'] = ['user1', 'user2', 'etc' ]
[2013-10-28 04:56:25 -0400] coderanger: Yes
[2013-10-28 04:56:33 -0400] brucelee: coderanger: if you could import it to java, that'd be awesome :p
[2013-10-28 04:56:34 -0400] coderanger: But usually you would do in your base role
[2013-10-28 04:56:52 -0400] coderanger: so default_attributes({'users' => ['user1', etc])
[2013-10-28 04:58:15 -0400] coderanger: Heh, Java is probably not impossible, but its not high on my list
[2013-10-28 04:58:35 -0400] coderanger: but the framework will be in place that someone with a much better understanding of the oracle JVM could add it
[2013-10-28 04:58:38 -0400] coderanger: or some other JVM
[2013-10-28 04:59:40 -0400] brucelee: what language will allow you to take over the world :p
[2013-10-28 04:59:42 -0400] brucelee: with simplicity
[2013-10-28 05:00:55 -0400] coderanger: Thats separate
[2013-10-28 05:01:09 -0400] coderanger: Also simplifying the cookbook layout for smaller cases
[2013-10-28 05:01:24 -0400] coderanger: and john has been hard at work on chef-client's new local mode
[2013-10-28 05:01:32 -0400] coderanger: which makes getting up and running with chef a lot easier
[2013-10-28 05:02:10 -0400] brucelee: thats probably one of chef's biggest drawbacks, the learning curve
[2013-10-28 05:02:30 -0400] coderanger: Indeed, slowly working on it :)
[2013-10-28 05:16:29 -0400] robawt: aloha chef people
[2013-10-28 05:16:35 -0400] robawt: nice project so far
[2013-10-28 05:24:43 -0400] Cope: ohai chums
[2013-10-28 05:51:30 -0400] Cope: wow ruby gems makes me want to stab things .. grrr
[2013-10-28 05:52:35 -0400] robawt: Cope: i was just thinking the opposite, but i'm new to chef
[2013-10-28 05:53:33 -0400] coderanger: Cope: Just remember, all packaging systems are terrible
[2013-10-28 05:53:50 -0400] coderanger: Cope: Not only is the grass not greener, the grass hates you and wants you to suffer!
[2013-10-28 05:53:51 -0400] coderanger: :)
[2013-10-28 05:54:29 -0400] robawt: I thought code, by its own nature, is made of suffering
[2013-10-28 05:55:28 -0400] packeteer: as is all software
[2013-10-28 05:55:56 -0400] coderanger: Dream a little bigger, darlings :)
[2013-10-28 06:00:56 -0400] Cope: I have identical bundles; one of which allows me to run chefspec
[2013-10-28 06:01:13 -0400] Cope: the other of which gives: home/kitchen/.gem/ruby/gems/json_pure-1.8.1/lib/json/pure/parser.rb:242:in `rescue in parse_string': Caught Encoding::CompatibilityError at '[{"content-type":"ap': incompatible encoding regexp match (ASCII-8BIT regexp with UTF-8 string) (JSON::ParserError)
[2013-10-28 06:04:50 -0400] Cope: So, I clear everything out; I create a new Gemfile; I insert the single line 'chefspec'; I run bundler. My bundle looks sane. I run rspec; I get: /usr/share/gems/gems/json-1.7.7/lib/json.rb:60:in `require': cannot load such file -- json/pure (LoadError)
[2013-10-28 06:05:05 -0400] Cope: ok... so let's add json_pure to the bundle...
[2013-10-28 06:05:57 -0400] Cope: (to be clear, I run bundle exec rspec)
[2013-10-28 06:06:36 -0400] Cope: so, now we have json_pure in the bundle; we run be rspec again: and now we get: /home/kitchen/.gem/ruby/gems/json_pure-1.8.1/lib/json/pure/parser.rb:242:in `rescue in parse_string': Caught Encoding::CompatibilityError at '[{"content-type":"ap': incompatible encoding regexp match (ASCII-8BIT regexp with UTF-8 string) (JSON::ParserError)
[2013-10-28 06:08:24 -0400] Cope: So, my conclusion is that this can't be a rubygems problem - it's irrational.
[2013-10-28 06:12:16 -0400] Cope: Only, with nothing other than require 'chefspec' in my spec... literally nothing else.... I get the error.
[2013-10-28 06:15:11 -0400] robawt: is there a good tutorial for setting up multiple users in chef?
[2013-10-28 06:16:31 -0400] robawt: currently reading https://github.com/opscode-cookbooks/users
[2013-10-28 06:16:46 -0400] coderanger: robawt: What kind of user?
[2013-10-28 06:17:48 -0400] robawt: coderanger: ideally both regular & system users
[2013-10-28 06:18:00 -0400] coderanger: robawt: Check out the user cookbook
[2013-10-28 06:18:08 -0400] coderanger: (distinct from "users")
[2013-10-28 06:18:20 -0400] robawt: as a self test as I pickup chef i'm trying to recreate my minecraft server saltstate i've already made for comparison
[2013-10-28 06:37:48 -0400] Cope: New machine; -identical- process; -identical- output of bundle list
[2013-10-28 06:37:55 -0400] Cope: identical test
[2013-10-28 06:38:17 -0400] Cope: one bitches about json_pure the other doesn't.
[2013-10-28 06:40:30 -0400] coderanger: Cope: Maybe something to do with what gems are installed?
[2013-10-28 06:45:51 -0400] Cope: I uninstall all the gems...
[2013-10-28 06:46:02 -0400] Cope: I have a sense I know the issue now
[2013-10-28 06:46:18 -0400] Cope: I'm using distro ruby (2.0 on Fedora 19)
[2013-10-28 06:46:51 -0400] Cope: which installs some gems to begin:
[2013-10-28 06:47:23 -0400] Cope: http://www.fpaste.org/49843/13829428/
[2013-10-28 06:47:30 -0400] Cope: so nothing else installed
[2013-10-28 06:48:04 -0400] Cope: so typically I just install bundler, and do everything else that way
[2013-10-28 08:05:01 -0400] GreatSUN: hi all
[2013-10-28 08:05:38 -0400] GreatSUN: I got a problem and was wondering if someone can tell me how to fix it properly...
[2013-10-28 08:06:01 -0400] GreatSUN: running chef-client 10.12
[2013-10-28 08:06:18 -0400] GreatSUN: recipe a including recipe b which includes recipe c
[2013-10-28 08:06:31 -0400] GreatSUN: within recipe c I am extending Chef::Recipe with a module
[2013-10-28 08:06:54 -0400] GreatSUN: calling methods from in there works properly from within recipe b, but not from recipe a
[2013-10-28 08:06:57 -0400] GreatSUN: any idea why?
[2013-10-28 08:16:09 -0400] GreatSUN: lol problem found...
[2013-10-28 08:16:23 -0400] GreatSUN: user misspelled method :D
[2013-10-28 08:19:44 -0400] seva_: Hi All
[2013-10-28 08:20:16 -0400] seva_: I have a problem after applying updates on some cookbook
[2013-10-28 08:21:05 -0400] seva_: ERROR: Server returned error for https://chef_server/environments/_default/cookbook_versions
[2013-10-28 08:21:32 -0400] seva_: Failed to authenticate to the chef server (http 401)
[2013-10-28 08:21:54 -0400] seva_: server and client have the same time and timezone
[2013-10-28 08:22:05 -0400] seva_: any ides
[2013-10-28 08:22:11 -0400] seva_: *ideas
[2013-10-28 08:22:20 -0400] seva_: ?
[2013-10-28 08:23:38 -0400] seva_: 2013-10-28T08:16:02Z erchef@127.0.0.1 INFO req_id=3Uf1guE/D/YDE1XaOcfy3g==; status=401; method=POST; path=/environments/_default/cookbook_versions; user=ip-10-36-155-201.eu-west-1.compute.internal; msg=bad_clock; req_time=266
[2013-10-28 09:35:45 -0400] nd__: Guys, I have a problem with opscode-cookbooks/mysql. I include mysql::server which sets up the server, starts it, then writes the my.cnf and tries to restart it, which always fails. So I have to reload the box (vagrant), then provisioning runs through without problems. https://gist.github.com/alappe/e6ab05aee66b9e8fcc05 Has anyone a clue on how to fix that? Or what exactly is the problem here?
[2013-10-28 09:42:09 -0400] arussel: I have a file default.rb in java_wrapper/resources/ with this line:
[2013-10-28 09:42:20 -0400] arussel: attribute :app_parameters, :kind_of => Array, :default => []
[2013-10-28 09:42:40 -0400] arussel: but when I run the lwrp, I get the following error:
[2013-10-28 09:42:53 -0400] arussel: undefined method `app_parameters' for Chef::Resource::JavaWrapper
[2013-10-28 09:42:57 -0400] arussel: what am I missing ?
[2013-10-28 12:56:18 -0400] helix_: hi guys, I have a web app I'm working on and I now want to use vagrant and chef to build a better dev env. But I don't quite understand how I have to setup my project to use my application cookbook. I'm really grateful for any hint!!!
[2013-10-28 12:59:47 -0400] arussel: I have this resource file: https://github.com/arussel/chef-java-wrapper/blob/master/resources/default.rb
[2013-10-28 13:00:13 -0400] arussel: but get undefined method `app_parameters' for Chef::Resource::JavaWrapper when running the lwrp
[2013-10-28 13:00:24 -0400] arussel: anyone could tell me what have done wrong ?
[2013-10-28 13:07:29 -0400] dmdeklerk: Guest49260: there are books on using chef
[2013-10-28 13:12:22 -0400] arussel: dmdeklerk: are there ?
[2013-10-28 13:12:40 -0400] Guest49260: I like reading books but chef isn't the real problem. I get how chef works and I love using chef-solo.
[2013-10-28 13:12:54 -0400] dmdeklerk: arussel: o yes my friend, do you want me to list them?
[2013-10-28 13:13:12 -0400] arussel: please do, I couldn't find any
[2013-10-28 13:13:21 -0400] dmdeklerk: hold on
[2013-10-28 13:13:31 -0400] arussel: I'd been waiting for the defnitive guide untill it got cancelled
[2013-10-28 13:14:02 -0400] dmdeklerk: Here's no 1. http://www.packtpub.com/chef-infrastructure-automation-cookbook/book
[2013-10-28 13:15:03 -0400] dmdeklerk: Here's no 2. http://shop.oreilly.com/product/0636920030973.do
[2013-10-28 13:15:48 -0400] arussel: 1. looks interesting
[2013-10-28 13:16:42 -0400] arussel: 2. the comment on amazon put me off buying it (and the fact that a definitive guide by the author was supposed to be in the pipeline)
[2013-10-28 13:17:19 -0400] dmdeklerk: No 2. is written by Cope, hi Cope! It has a really good intro to chef
[2013-10-28 13:17:36 -0400] dmdeklerk: Here's no 3. Vagrant: Up and Running - by Mitchell Hashimoto
[2013-10-28 13:17:41 -0400] arussel: I'm more looking for a definitive guide than an introduciton
[2013-10-28 13:17:52 -0400] arussel: I've go vagrant up and running, nice quick guide
[2013-10-28 13:17:58 -0400] arussel: s/go/got/
[2013-10-28 13:18:15 -0400] dmdeklerk: Here's no 4. Have not read this yet http://www.packtpub.com/chef-starter/book
[2013-10-28 13:18:34 -0400] arussel: I've got that one too, not very usefull
[2013-10-28 13:18:53 -0400] arussel: installing a chef server is super trivial and well explained on opscode site.
[2013-10-28 13:18:54 -0400] dmdeklerk: Here is Cope explaining the status of "The definitive guide" http://www.agilesysadmin.net/chef-definitive-guide
[2013-10-28 13:19:51 -0400] dmdeklerk: If your looking for a 'definitive guide' or something like that, there isn't one. ;(
[2013-10-28 13:21:09 -0400] arussel: I'll have a look at 1. , have you read it ?
[2013-10-28 13:21:27 -0400] dmdeklerk: arussel: about half way now
[2013-10-28 13:22:03 -0400] dmdeklerk: arussel: it has approx 300 pages i think. i'd get it if i where you
[2013-10-28 13:22:26 -0400] dmdeklerk: i believe there is a preview on books.google.com
[2013-10-28 13:22:45 -0400] arussel: I can buy it, it's ok, I'm a book junkie
[2013-10-28 13:23:35 -0400] dmdeklerk: oh no.. where you trying to quit? and now i'm offering more books.. the horror ;)
[2013-10-28 13:23:55 -0400] arussel: men, this is the last one, I swear
[2013-10-28 13:24:22 -0400] dmdeklerk: lol, what about that bug of yours. does only that one attribute give an error?
[2013-10-28 13:25:04 -0400] arussel: donno, I've check countless of other recipe, and I don't see any difference with mine. I'll check with another attribute
[2013-10-28 13:29:04 -0400] allaire: Can i use sub-directories under templates/default/ ?
[2013-10-28 13:29:05 -0400] dmdeklerk: arussel: isnt the attribute declaring a private method that you have to make public? there are some that use "attr_accessor :app_parameters"
[2013-10-28 13:29:40 -0400] arussel: dmdeklerk: I'm not seeing this here: https://github.com/opscode-cookbooks/maven/blob/master/resources/default.rb
[2013-10-28 13:29:54 -0400] arussel: (or in the java cookbook either)
[2013-10-28 13:30:11 -0400] dmdeklerk: mmmm, again havent done an lwrp yet.
[2013-10-28 13:30:35 -0400] dmdeklerk: arussel: it does say so here http://dougireton.com/blog/2012/12/31/creating-an-lwrp/
[2013-10-28 13:30:59 -0400] dmdeklerk: "Ill explain the attr_accessor :exists in more detail next week, but in short, it defines an exists property on the Resource"
[2013-10-28 13:31:11 -0400] dmdeklerk: would explain a missing method
[2013-10-28 13:33:44 -0400] arussel: but it just add an exists property, it doesn't make other attribute visible or anything
[2013-10-28 13:37:00 -0400] dmdeklerk: yes your right, 'ass'umed there was an :exists attribute. my bad
[2013-10-28 13:38:58 -0400] arussel: test-kitchen is for integration test, is there something for more 'unit' test, I'm pretty sure this would catch a mistake in the recipe for such a basic thing
[2013-10-28 13:40:12 -0400] dmdeklerk: arussel: *tip* I would pastebin my debug chef run log along side the post on the mailing list.
[2013-10-28 13:40:43 -0400] arussel: wise tip :-)
[2013-10-28 13:41:25 -0400] arussel: I'm trying to get a test that shows the error, this would simplify greatly the debugging
[2013-10-28 13:41:55 -0400] dmdeklerk: cant you load it in a shell. shef i believe its called
[2013-10-28 13:42:23 -0400] gchristensen: renamed to chef-shell b/c shef is an awful awful name
[2013-10-28 13:43:21 -0400] dmdeklerk: gchristensen: hi, kinda early in the lone star state ?
[2013-10-28 13:45:15 -0400] arussel: I probably could, but not sure what I can get out of it.
[2013-10-28 13:50:08 -0400] arussel: I'm going to try to get a test like this https://github.com/opscode-cookbooks/maven/blob/master/spec/unit/recipes/default_spec.rb working, this should be able to catch the error (hopefully)
[2013-10-28 13:52:48 -0400] dmdeklerk: arussel: i'm not sure it will
[2013-10-28 13:53:49 -0400] obstructioncall: I am noticing lots o recipes that are not idempotent on the windows side. Is the Linux side like this? Why is this not part of the metadata? Why isn't chef more forthcomming with this information?
[2013-10-28 13:55:48 -0400] arussel: obstructioncall: are you talking about recipe written and manage by opscode ?
[2013-10-28 13:56:07 -0400] obstructioncall: for example iis
[2013-10-28 13:57:05 -0400] obstructioncall: downloaded using cookbook site from opscode
[2013-10-28 13:57:17 -0400] tomduffield: obstructioncall: can you provide a specific recipe in iis that is giving you trouble?
[2013-10-28 13:58:15 -0400] obstructioncall: iis_config from https://github.com/opscode-cookbooks/iis
[2013-10-28 13:58:26 -0400] dmdeklerk: arussel: to test an lwrp you probably have to write a small recipe that uses that lwrp, that you can run in chef-shell and place a breakpoint before it. but before taking this route cant it be you forgot something trivial, cant you make the tiniest lwrp possible get that running first?
[2013-10-28 13:58:56 -0400] arussel: hmm, the classpath attribute doesn't throw an error ...
[2013-10-28 13:59:13 -0400] arussel: I had a trivial lwrp that was working (logging something)
[2013-10-28 13:59:27 -0400] tomduffield: obstructioncall: ah, okay. that is an LWRP. Do you have an example of how you are using it? an example resource declaration?
[2013-10-28 14:02:19 -0400] obstructioncall: iis_config "/section:system.webServer/isapiFilters /+"[name='jakarta',path='C:\\tomcat\\bin\\isapi_redirect.dll']"" do     action :config end
[2013-10-28 14:03:51 -0400] allaire: Is there anyway to point 'depends' in metadata to a cookbook on git?
[2013-10-28 14:04:24 -0400] tomduffield: allaire: no via chef. you can do something like that using Berkshelf though
[2013-10-28 14:04:25 -0400] stormerider: allaire: not that i know of, that's more berkshelf territory
[2013-10-28 14:04:30 -0400] arussel: allaire: you can do it with berks
[2013-10-28 14:04:43 -0400] allaire: ty!
[2013-10-28 14:05:02 -0400] arussel: with tag or even checksum
[2013-10-28 14:05:35 -0400] allaire: but does berks fetch other cookbooks' depends?
[2013-10-28 14:05:52 -0400] arussel: that its job
[2013-10-28 14:06:20 -0400] allaire: arussel: then, I'm creating a cookbook that uses: https://github.com/phlipper/chef-monit/blob/master/metadata.rb
[2013-10-28 14:06:38 -0400] allaire: its metadata name is "monit", but on the community site "monit" is a different cookbook
[2013-10-28 14:06:59 -0400] allaire: so if I depends "monit", I suppose berks will fetch the other "monit" cookbook on the community site...
[2013-10-28 14:07:06 -0400] tomduffield: obstructioncall: so it looks like the iss_config provider doesn't have any idempotence built in to it. I can't speak for why it doesn't have a guard though. If you know how to check idempotence for IIS config you could submit a PR or you could submit a ticket to tickets.opscode.com
[2013-10-28 14:07:17 -0400] mfridh: cookbook "monit", git: https://...
[2013-10-28 14:07:53 -0400] arussel: allaire: not sure, if you don't pu :opscode at the start of you Berksfile
[2013-10-28 14:08:06 -0400] allaire: mfridh: But then the user of my cookbook has to explicilty add the dependency, which is not ideal :P
[2013-10-28 14:08:07 -0400] dmdeklerk: allaire: the names in metadata are not referring to the community site, they point to your *local cookbook path*
[2013-10-28 14:08:20 -0400] arussel: allaire: their doc is well done, have look:
[2013-10-28 14:08:21 -0400] arussel: cookbook "mysql", git: "https://github.com/opscode-cookbooks/mysql.git", branch: "foodcritic"
[2013-10-28 14:08:30 -0400] arussel: you can give the full url
[2013-10-28 14:08:40 -0400] stormerider: allaire: if there's already a monit cookbook, you might want to use a different name, then
[2013-10-28 14:09:14 -0400] obstructioncall: Thanks tom
[2013-10-28 14:09:46 -0400] tomduffield: obstructioncall: you're welcome. best of luck!
[2013-10-28 14:22:35 -0400] arussel: this is exclusively the app_parameters that throws an error, not the other attributes
[2013-10-28 14:23:19 -0400] dmdeklerk: arussel: what if you name app_parameters2 or appparamaters?
[2013-10-28 14:25:42 -0400] spstarr_work: hmm
[2013-10-28 14:25:52 -0400] spstarr_work: is there something I need to do in a execute block when using sed?
[2013-10-28 14:26:04 -0400] spstarr_work: seems chef is ignoring the execution of these lines(?)
[2013-10-28 14:26:39 -0400] spstarr_work: aha
[2013-10-28 14:26:40 -0400] spstarr_work: http://lists.opscode.com/sympa/arc/chef/2013-04/msg00248.html
[2013-10-28 15:02:28 -0400] obstructioncall: Is there a way to get chef-solo to reset it node state (e.g. re-provision everything)
[2013-10-28 15:03:03 -0400] obstructioncall: granted guards may prevent things from being change
[2013-10-28 15:08:38 -0400] gchristensen:  anyone managing hostnames / fqdns in chef? what about NICs? are the cookbooks you use public or private / internal?
[2013-10-28 15:09:10 -0400] gchristensen: I'm considering writing a cookbook which searches a databag by the asset ID from the BIOS and applies the NIC configuration, as well as the desired hostname and fqdn
[2013-10-28 15:20:04 -0400] tomduffield: obstructioncall: are you looking to undo all of the changes that chef did?
[2013-10-28 15:26:16 -0400] obstructioncall: Not looking to undo, I have just changed some file locations and want to do a run, but it appears there is some state kept by chef-solo and it still thinks these files are in the old location.
[2013-10-28 15:26:35 -0400] obstructioncall: want to dump all state kept by chef and then do a run
[2013-10-28 15:27:12 -0400] gchristensen: I didn't think chef-solo maintained state?
[2013-10-28 15:27:21 -0400] gchristensen: and that's why node attributes don't work the same in chef-solo
[2013-10-28 15:28:10 -0400] tomduffield: thats correct, chef-solo doesn't keep node state from run-to-run like chef-client does
[2013-10-28 15:28:47 -0400] obstructioncall: hmmm
[2013-10-28 15:29:41 -0400] tomduffield: which file locations did you change? and how were they changed? via node attribute?
[2013-10-28 15:30:13 -0400] obstructioncall: I will boil it down I get you better info in few
[2013-10-28 15:33:27 -0400] goggins: If you update $PATH via a mod to /etc/profile.d, anyone know how to re-source it, so subsequent execute statements use the new $PATH?
[2013-10-28 15:34:58 -0400] tomduffield: goggins: you could use a notification to alert an execute resource to run a re-source command. otherwise you could use the environment attribute in your execute resource block.
[2013-10-28 15:36:43 -0400] goggins: tomduffield: nice. what does the re-source command look like?
[2013-10-28 15:37:05 -0400] tomduffield: source
[2013-10-28 15:37:28 -0400] tomduffield: source /etc/profile.d/your_file
[2013-10-28 15:37:37 -0400] goggins: yea, I think I tried that...gonna try again and see...
[2013-10-28 15:38:14 -0400] tomduffield: my recommendation is to set the path via the environment parameter
[2013-10-28 15:38:53 -0400] tomduffield: less room for edge case gotchas and os-specific environment variable voodoo
[2013-10-28 15:40:07 -0400] goggins: Right on. I'll go that route. Just confirmed that the "source" route does not work
[2013-10-28 15:40:24 -0400] goggins: (it doesn't update the $PATH for subsequent execute commands)
[2013-10-28 15:40:30 -0400] goggins: Thanks!
[2013-10-28 15:41:19 -0400] tomduffield: you're welcome!
[2013-10-28 15:43:02 -0400] techminer: my file resource with the delete action is not deleting the file, it just says "up to date" and moves onthis is not a symlink
[2013-10-28 15:44:21 -0400] tomduffield: techminer: can we get a copy of the resource + an ls command of the file that is still there?
[2013-10-28 15:44:32 -0400] tomduffield: you can send privately if you wish
[2013-10-28 15:45:31 -0400] techminer: one sec
[2013-10-28 15:48:34 -0400] techminer: tomduffield:  nevermind.found the problem  I had a list of files in a %w[] block.with quotes.  They should be unquoted when you do it that way.
[2013-10-28 15:48:56 -0400] tomduffield: techminer: glad you figured it out!
[2013-10-28 16:18:31 -0400] dgarstang: So... I need to find a way to get chef to return the instance type I'm on. Ohai isnt any use because it doesn't seem to collect info until the 2nd run. Options? Can I run a command in ruby and get it's output from the O/S?
[2013-10-28 16:20:10 -0400] tomduffield: dgarstang: you could try making an API call to your cloud provider
[2013-10-28 16:20:23 -0400] tomduffield: most cloud providers will have Ruby gems you could use
[2013-10-28 16:21:06 -0400] tomduffield: but ohai not getting that info until the second run is interesting. you might want to log a ticket
[2013-10-28 16:21:28 -0400] dgarstang: tomduffield: Doing that would be the same procedure as running a local company, and probably slower.
[2013-10-28 16:21:28 -0400] dgarstang: oops s/company/command/
[2013-10-28 16:21:39 -0400] dgarstang: tomduffield: That seems to be the norm. I was told to 'run it twice' as a solution.
[2013-10-28 16:22:13 -0400] gchristensen: miah: ping
[2013-10-28 16:22:22 -0400] dgarstang: tomduffield: Bring up a new node... do a knife search on it. Until you've run chef the first time, it will have no data
[2013-10-28 16:23:08 -0400] tomduffield: that is correct
[2013-10-28 16:23:23 -0400] dmdeklerk: dgarstang: from the top of my head, there is an internal api in aws you can wget to and it will return the info your after
[2013-10-28 16:23:55 -0400] dgarstang: dmdeklerk: This also needs to work in GCE. But, as I said, if I can call a command to execute a URL, I can call a command to run stuff locally.
[2013-10-28 16:24:24 -0400] dmdeklerk: dgarstang: what is GCE?
[2013-10-28 16:24:30 -0400] dgarstang: dmdeklerk: Google Compute Engine
[2013-10-28 16:24:35 -0400] dmdeklerk: ahhhh
[2013-10-28 16:24:46 -0400] dgarstang: dmdeklerk: The more important question, is can I run commands in ruby and get the output back into chef?
[2013-10-28 16:26:23 -0400] cpuguy83: dgarstang: You can use ohai directly, I'm sure.
[2013-10-28 16:26:36 -0400] tomduffield: dgarstang: you can, yes
[2013-10-28 16:26:42 -0400] dgarstang: cpuguy83: it's not workin' so well.
[2013-10-28 16:26:50 -0400] dgarstang: tomduffield: ok....good start...
[2013-10-28 16:27:01 -0400] cpuguy83: dgarstang: Heck, I'm calling ohai from my chef client.rb file
[2013-10-28 16:27:15 -0400] dgarstang: cpuguy83: are you collecting info and using it on the first chef run?
[2013-10-28 16:27:30 -0400] cpuguy83: dgarstang: I'm pulling the MAC address of the system and using that as the node name
[2013-10-28 16:27:38 -0400] dgarstang: cpuguy83: on the first run?
[2013-10-28 16:27:48 -0400] cpuguy83: before there is even a run
[2013-10-28 16:27:56 -0400] cpuguy83: Before the node is created
[2013-10-28 16:28:03 -0400] cpuguy83: Before the client is created
[2013-10-28 16:28:12 -0400] tomduffield: dgarstang: just be aware of the multiphase execution of chef
[2013-10-28 16:28:13 -0400] dgarstang: cpuguy83: Can't imagine how that could work.
[2013-10-28 16:28:18 -0400] cpuguy83: dgarstang: It's all just Ruby.  You can call whatever Ruby you want.
[2013-10-28 16:28:27 -0400] cpuguy83: Ohai is just a rubygem
[2013-10-28 16:28:33 -0400] dgarstang: Are there any docs to running external ruby commands in chef? Has to be a common thing to need to do
[2013-10-28 16:28:59 -0400] dgarstang: cpuguy83: I've been told her multople times that chef doesn't collect data from ohai until after ohai has run
[2013-10-28 16:29:07 -0400] cpuguy83: dgarstang: To load code you do 'require somefile'
[2013-10-28 16:29:23 -0400] cpuguy83: dgarstang: Sure, but you can tell ohai to collect data for your purposes
[2013-10-28 16:29:49 -0400] dgarstang: cpuguy83: chef doesn't know about it tho
[2013-10-28 16:30:11 -0400] cpuguy83: dgarstang: Chef is ruby, you just call it and pass it into whatever chef-thing you want
[2013-10-28 16:30:35 -0400] dgarstang: cpuguy83: Load code? I was gonna put it into a recipe.
[2013-10-28 16:31:12 -0400] dgarstang: cpuguy83: if it's in a recipe though, there's no "require". It's a lwrp right
[2013-10-28 16:31:17 -0400] cpuguy83: dgarstang: put 'require ohai' in your recipe
[2013-10-28 16:31:24 -0400] cpuguy83: require is part of Ruby
[2013-10-28 16:31:31 -0400] failshell: anyone knows the reason why chef-solo in 10.x does not supports environment?
[2013-10-28 16:32:15 -0400] tomduffield: failshell: no particular reason; it was just a feature that wasn't added yet
[2013-10-28 16:32:17 -0400] cpuguy83: Technically, ohai is probably already required and you don't even need to do that, you can just call Ohai::System.new
[2013-10-28 16:32:28 -0400] tomduffield: failshell: there are complex reasons about how chef works
[2013-10-28 16:32:28 -0400] gchristensen: I have a node attribute where the key has a space in it, what will thah show up as in search?
[2013-10-28 16:32:35 -0400] dgarstang: cpuguy83: Now you've lost me. I have "include_recipe bc-ohai" where bc-ohai is our wrapper around ohai. I had to write a wrapper because ohai doesn't work at all if you don't create /etc/chef/ohai/hints.ec2.json. Lame.
[2013-10-28 16:32:50 -0400] tomduffield: gchristensen: try to avoid spaces in node attributes
[2013-10-28 16:33:02 -0400] tomduffield: but it should work as expected
[2013-10-28 16:33:04 -0400] cpuguy83: dgarstang: I don't think that's true
[2013-10-28 16:33:08 -0400] failshell: tomduffield: well, it should raise a proper error instead of borking because 'it cant find the private key'
[2013-10-28 16:33:29 -0400] gchristensen: tomduffield: I can't, its from dmidecode (dmi.chassis.all_records.Serial Number ?)
[2013-10-28 16:33:38 -0400] dgarstang: cpuguy83: I've done it several times. It doesn't return ec2 data without that hint. The same applies to GCE. If the gce.json file isn't there you get no gce data
[2013-10-28 16:34:07 -0400] gchristensen: ahh it pull the all_records out into slugged out names.
[2013-10-28 16:34:15 -0400] tomduffield: failshell: hmm, i dont think it throws that error
[2013-10-28 16:34:24 -0400] cpuguy83: dgarstang: Well, I don't know about that... but you can force Oahi to collect data by doing 'ohai = Ohai::System.new; ohai.all_plugins'
[2013-10-28 16:34:27 -0400] gchristensen: .chassis.all_records.Serial Number -> .chassis.serial_number
[2013-10-28 16:34:30 -0400] tomduffield: failshell: also, recent versions of chef-solo can support environments
[2013-10-28 16:34:36 -0400] dgarstang: I can't work out why I can't find any references to executing external commands in chef. Bizarre.
[2013-10-28 16:34:44 -0400] cpuguy83: dgarstang: This will tell ohai to collect stuff and you'll have access to it from that 'ohai' variable
[2013-10-28 16:34:57 -0400] failshell: tomduffield: https://gist.github.com/failshell/c968453e083a9689d971 that's what im getting with Chef 10.28.2 and Vagrant 1.3.5
[2013-10-28 16:35:09 -0400] failshell: if i remove the environments config, the run converges
[2013-10-28 16:35:26 -0400] dgarstang: cpuguy83: Does that go in a recipe?
[2013-10-28 16:35:39 -0400] cpuguy83: dgarstang: If it's ruby, it's not external... you pull those commands in to your ruby environment
[2013-10-28 16:35:47 -0400] tomduffield: failshell: what does the chef portion of your vagrantfile look like?
[2013-10-28 16:35:53 -0400] cpuguy83: dgarstang: You can do it wherever you need it... wherever ruby code is run
[2013-10-28 16:36:04 -0400] cpuguy83: dgarstang: Here is a snippet from my client.rb, for example: https://gist.github.com/cpuguy83/7200165
[2013-10-28 16:36:06 -0400] tomduffield: failshell: the only reason it would try to use a private key is to talk to a chef-server
[2013-10-28 16:36:06 -0400] dgarstang: cpuguy83: Sorry, your losing me. I want to write ruby code in a manifest that runs a command and grabs the output.
[2013-10-28 16:36:13 -0400] rnewson: I'm getting ETXTBSY updating a binary with cookbook_file and atomic_update true. The docs imply that 'true' exists to make this possible. Oddly, not on all nodes, just some.
[2013-10-28 16:36:35 -0400] failshell: tomduffield: i only get that error with chef10, chef11 is fine
[2013-10-28 16:36:35 -0400] dgarstang: cpuguy83: lost. what's that? is it a plugin?
[2013-10-28 16:36:56 -0400] failshell: tomduffield: https://gist.github.com/failshell/c888154fca276911221e
[2013-10-28 16:37:16 -0400] cpuguy83: dgarstang: You can call ANY Ruby code from ANYWHERE in ANY other piece of ruby code
[2013-10-28 16:37:36 -0400] cpuguy83: dgarstang: If it's a gem then it's super easy, just 'chef_gem yourgem'
[2013-10-28 16:37:44 -0400] dgarstang: cpuguy83: Your talking about plugins. That's fine... I had issues getting plugins to work at all. I tried those earlier. More ohai issues I believe.
[2013-10-28 16:37:46 -0400] tomduffield: is your vagrantfile using chef_solo or chef_client in the definition?
[2013-10-28 16:37:50 -0400] dgarstang: cpuguy83: eek, gems, evil
[2013-10-28 16:37:55 -0400] Eduardo_: has anyone that have handled with copy of tomcat certificates? I need to copy and import in java cacerts
[2013-10-28 16:38:05 -0400] cpuguy83: dgarstang: gems are just ruby code... and it's an example.
[2013-10-28 16:38:08 -0400] cpuguy83: dgarstang: ohai is a gem
[2013-10-28 16:38:09 -0400] failshell: tomduffield: chef_solo
[2013-10-28 16:38:18 -0400] failshell: tomduffield: config.vm.provision :chef_solo do |chef|
[2013-10-28 16:38:23 -0400] dgarstang: cpuguy83: not sure how gems relate. :)
[2013-10-28 16:38:32 -0400] dgarstang: cpuguy83: but I can try plugins again
[2013-10-28 16:39:02 -0400] cpuguy83: dgarstang: My point is you can pull in whatever ruby code into your recipe, LWRP, HWRP, whatever
[2013-10-28 16:39:09 -0400] dgarstang: cpuguy83: Are you sure though that the result of plugins is available on the FIRST chef run? because, as I said, nothing seem to be available until the end of the first rin
[2013-10-28 16:39:10 -0400] cpuguy83: if it's in a file you require that file
[2013-10-28 16:39:29 -0400] dgarstang: cpuguy83: In plugins... not in the manifest. :)
[2013-10-28 16:39:34 -0400] dgarstang: sorry recipe
[2013-10-28 16:39:55 -0400] cpuguy83: dgarstang: With what I posted in that gist, it's telling Ohai to go run and gather the information.
[2013-10-28 16:40:30 -0400] cpuguy83: dgarstang: That info is not being stored anywhere except in that object stored in that variable.  So you can't query it as a node attr.
[2013-10-28 16:40:43 -0400] dgarstang: cpuguy83: Where does that file go? /etc/chef/ohai_plugins?
[2013-10-28 16:40:43 -0400] dgarstang: cpuguy83: is that information available on the first run, before it finishes?
[2013-10-28 16:40:52 -0400] cpuguy83: dgarstang: it's not a file
[2013-10-28 16:41:09 -0400] dgarstang: cpuguy83: I thought that for node['gce']['foo'] too but it wasn't there until the 2nd run...
[2013-10-28 16:41:28 -0400] dgarstang: cpuguy83: ok, now you've lost me, because it sounded like  you've been describing ohai plugins so far
[2013-10-28 16:41:32 -0400] cpuguy83: dgarstang: It's NOT going to be stored in your node data... you could push it to your node data manually if you wanted.
[2013-10-28 16:42:07 -0400] dgarstang: cpuguy83: Really lost. Are there docs on this?
[2013-10-28 16:42:25 -0400] tomduffield: failshell: the chef setting is environment_path, not environments_path (no s)
[2013-10-28 16:42:31 -0400] tomduffield: failshell: that might be part of the issue
[2013-10-28 16:43:20 -0400] cpuguy83: dgarstang: Ohai is just a Ruby module.  You can call the module yourself.
[2013-10-28 16:43:25 -0400] failshell: tomduffield: * When 'environment' is specified, you must provide 'environments_path'.
[2013-10-28 16:43:43 -0400] cpuguy83: dgarstang: The reason node attrs are populated is because Chef is calling Ohai itself and storing the results in the node attrs
[2013-10-28 16:43:53 -0400] dgarstang: cpuguy83: Oic.
[2013-10-28 16:44:04 -0400] tomduffield: failshell: where do you see that?
[2013-10-28 16:44:18 -0400] failshell: tomduffield: when i vagrant up, that's the error i get if i remove the s
[2013-10-28 16:44:24 -0400] cpuguy83: dgarstang: You can likewise call ohai at any point yourself and gather the same info for your own needs
[2013-10-28 16:44:27 -0400] dgarstang: cpuguy83: so using 'ohai = Ohai::System.new; ohai.all_plugins' would allow me to access the node data immediately?
[2013-10-28 16:45:12 -0400] failshell: tomduffield: im running vagrant 1.3.5 on osx mavricks. with chef 10.28.2 in solo mode. im about to open a ticket :)
[2013-10-28 16:45:26 -0400] cpuguy83: dgarstang: yes... that 'ohai' variable there will have it and behaves similar to a hash.  So for instance  I could then call 'ohai[:macaddress]'
[2013-10-28 16:46:02 -0400] dgarstang: cpuguy83: kk. Lemme try that. If it works, I owe you a kidney
[2013-10-28 16:47:14 -0400] cpuguy83: dgarstang: Keep in mind you can manually call whatever Ruby class/module you want at any time.... technically you could even call a chef run from within your chef run, it wouldn't make any sense, but you could do it.
[2013-10-28 16:47:38 -0400] dgarstang: cpuguy83: kk. stay tuned...
[2013-10-28 16:54:15 -0400] dgarstang: cpuguy83: how do I see the stuff in the ohai hash? ohai.inspect ?
[2013-10-28 16:54:36 -0400] dgarstang: yep
[2013-10-28 16:55:20 -0400] cpuguy83: dgarstang: you can call 'oahi.data' to get the actual hash
[2013-10-28 16:55:24 -0400] cpuguy83: *ohai
[2013-10-28 16:55:40 -0400] cpuguy83: It looks like there is also a way to load hints... not sure how that's done.
[2013-10-28 16:57:11 -0400] bobbyz: Hi guys.  If I want a chef server to manage itself, would I use 'knife bootstrap' as usual, or is there a different way for bootstrapping chef-client on a chef server?
[2013-10-28 16:58:06 -0400] MMehdi: Hello, this is the first time I am posting as I am still learning chef. Now has anyone been able to use chef 11 with kickstart as it uses the deafult port 80 and permanently redirects to 443. And this is not working for me.
[2013-10-28 16:58:29 -0400] dmdeklerk: Either my network or chef server is down....
[2013-10-28 16:58:42 -0400] dmdeklerk: hosted chef that is
[2013-10-28 16:59:27 -0400] Eduardo_: ?
[2013-10-28 16:59:50 -0400] MMehdi: I am using the open source chef 11 and building it on RHEL 6.4
[2013-10-28 17:00:03 -0400] workmad3: MMehdi: what about it isn't working? have your got port 443 blocked by your FW or something?
[2013-10-28 17:00:14 -0400] dmdeklerk: Nope, it was my network
[2013-10-28 17:00:35 -0400] MMehdi: no thast wide open and teh system is on the same network..but looks like the kickstart does not like the redirect
[2013-10-28 17:00:58 -0400] failshell: tomduffield: should i open a bug for that?
[2013-10-28 17:01:13 -0400] MMehdi: I am not sure what config needs to change in nginx to pick up the correct location of kickstart files
[2013-10-28 17:01:44 -0400] MMehdi: I tried copying it to the html directory but still does not pick up :(
[2013-10-28 17:03:09 -0400] MMehdi: If I install apache it works flawlessly but we cant have both apache and nginx up at the same time
[2013-10-28 17:05:02 -0400] workmad3: MMehdi: so it's just where to put nginx config that you're struggling with?
[2013-10-28 17:05:23 -0400] MMehdi: looks like that
[2013-10-28 17:05:56 -0400] workmad3: MMehdi: and it's a package installed nginx?
[2013-10-28 17:06:09 -0400] MMehdi: no came with chef
[2013-10-28 17:06:31 -0400] workmad3: hmm... I never needed to play with that, it 'just worked'
[2013-10-28 17:07:06 -0400] ggolin_: MMehdi, if this is a redhad box please make sure selinux is either off or the se policy for nginx is configured correctly
[2013-10-28 17:07:11 -0400] ggolin_: also, iptables.
[2013-10-28 17:07:32 -0400] MMehdi: hmmm...let me check
[2013-10-28 17:07:44 -0400] ggolin_: MMehdi, its most likely your selinux config
[2013-10-28 17:08:51 -0400] MMehdi: apart from that do you think the location of kickstart files matter? Or do I need modify anything in nginx config?
[2013-10-28 17:09:29 -0400] MMehdi: SELinux status:                 disabled
[2013-10-28 17:09:49 -0400] ggolin_: so ls /selinux comes up empty?
[2013-10-28 17:10:04 -0400] MMehdi: yes
[2013-10-28 17:10:07 -0400] ggolin_: okay.
[2013-10-28 17:10:15 -0400] ggolin_: gist your nginx config
[2013-10-28 17:10:54 -0400] ggolin_: oh wait.
[2013-10-28 17:11:16 -0400] MMehdi: BTW iptables is disabled too
[2013-10-28 17:11:24 -0400] tomduffield: failshell: one sec. still doing some research for you
[2013-10-28 17:11:30 -0400] ggolin_: what do you mean when you says kickstart does not like the redirect?
[2013-10-28 17:11:52 -0400] ggolin_: MMehdi, there could be a couple of issues there. ssl cert verification, for one.
[2013-10-28 17:12:38 -0400] MMehdi: So chef is permanently redirecting to 443, I tried changing the urls to https but still no luck...
[2013-10-28 17:12:56 -0400] ggolin_: changing urls where
[2013-10-28 17:13:00 -0400] ggolin_: and from what to what
[2013-10-28 17:14:12 -0400] MMehdi: hmm..the ssl certs...
[2013-10-28 17:14:25 -0400] tomduffield: failshell: looks like environments for chef-solo are only supported in 11.6+
[2013-10-28 17:14:31 -0400] MMehdi: in the kickstart conifg and tftp config
[2013-10-28 17:14:57 -0400] MMehdi: so it boots properly using tftp
[2013-10-28 17:15:09 -0400] MMehdi: but after that its not able to find the kickstart file
[2013-10-28 17:15:16 -0400] failshell: tomduffield: ok. that might be the incentive we were missing to finish our migration hehe. thanks. will work around it in Vagrant. thanks for your help. much appreciated
[2013-10-28 17:16:04 -0400] tomduffield: failshell: you're welcome. sorry for the unhelpful error message. have fun with your migration ;)
[2013-10-28 17:16:06 -0400] MMehdi: even if I put it under html folder I get denied message
[2013-10-28 17:16:17 -0400] MMehdi: or unauthorized message
[2013-10-28 17:16:20 -0400] failshell: tomduffield: will still open a bug for that error messasge though
[2013-10-28 17:16:32 -0400] tomduffield: failshell: sounds good.
[2013-10-28 17:16:33 -0400] adamjk-dev: jtimbermand: you there?
[2013-10-28 17:16:41 -0400] adamjk-dev: jtimberman: you there?
[2013-10-28 17:16:44 -0400] pabst^: can File.exists? take a wildcard? File.exists?('/dev/ipmi*') ?
[2013-10-28 17:17:25 -0400] justizin: pabst^: i doubt it, enumerate Directory.contents?('/dev') or somesuch, or use a shell cmd
[2013-10-28 17:17:51 -0400] pabst^: justizin: thanks. I think I can avoid the wildcard to be honest, I just worry it might cause problems later
[2013-10-28 17:18:00 -0400] zeroXten: hmm, if I connect to my chef server using the IP, then after getting the runlist it tries to connect using hostname.. any way around that so it continues to use IP?
[2013-10-28 17:18:22 -0400] workmad3: MMehdi: ah, are you trying to get a new TFTP boot to try and retrieve a kickstarter file from the chef server?
[2013-10-28 17:18:37 -0400] MMehdi: yes
[2013-10-28 17:18:43 -0400] tomduffield: pabst^: you might want to try Dir::glob
[2013-10-28 17:18:52 -0400] tomduffield: pabst^: http://stackoverflow.com/questions/13453287/check-if-a-file-exists-using-a-wildcard
[2013-10-28 17:18:57 -0400] justizin: pabst^: are you just trying to determine if the ipmi module is loaded or somesuch?
[2013-10-28 17:18:59 -0400] pabst^: tomduffield: Thanks. I will look at that
[2013-10-28 17:19:03 -0400] workmad3: MMehdi: well, that'll be the problem then...
[2013-10-28 17:19:07 -0400] justizin: if so, check what you're checking, not a side effect
[2013-10-28 17:19:09 -0400] workmad3: MMehdi: the chef server isn't a general file server
[2013-10-28 17:19:13 -0400] pabst^: justizin: yep, I don't want to load ipmitools if there is no ipmi interface
[2013-10-28 17:19:19 -0400] workmad3: MMehdi: and nothing in it is served without authorization afaik
[2013-10-28 17:20:13 -0400] justizin: i guess checking in /dev/ makes sense
[2013-10-28 17:20:13 -0400] MMehdi: do you think we can work around it?
[2013-10-28 17:20:25 -0400] workmad3: MMehdi: so yeah, you could hack the bundled nginx config with the chef server install (not something I'd personally recommend), but personally, I'd suggest putting the file somewhere else
[2013-10-28 17:20:29 -0400] justizin: tells if you have an actual device, though those nodes might exist in some cases where there is no device
[2013-10-28 17:20:44 -0400] pabst^: justizin: Yeah. I am thinking there is an Ohai plugin that mmight make it easier... *nudges gchristensen*
[2013-10-28 17:21:05 -0400] justizin: heh
[2013-10-28 17:21:07 -0400] gchristensen: pabst^: herro?
[2013-10-28 17:21:12 -0400] MMehdi: but how do I server this file if port 80 is being used by nginx?
[2013-10-28 17:21:16 -0400] pabst^: gchristensen: no, you're not my hero
[2013-10-28 17:21:18 -0400] MMehdi: I mean serve the file
[2013-10-28 17:21:22 -0400] pabst^: gchristensen: close, but not quite :):
[2013-10-28 17:21:41 -0400] gchristensen: pabst^: I have an ohai plugin which locates if ipmi is available
[2013-10-28 17:21:56 -0400] pabst^: gchristensen: is it one you wrote, or a public one?
[2013-10-28 17:22:01 -0400] gchristensen: both
[2013-10-28 17:22:01 -0400] timsmith: anyone know when Ohai code review is?
[2013-10-28 17:22:13 -0400] pabst^: gchristensen: ok
[2013-10-28 17:22:56 -0400] gchristensen: pabst^: its highly simple, but: https://github.com/zippykid/chef-ohai-ipmi/blob/master/files/default/plugins/ipmi.rb, https://github.com/zippykid/chef-ohai-ipmi/blob/master/recipes/freeipmi.rb vs https://github.com/zippykid/chef-ohai-ipmi/blob/master/recipes/ipmitool.rb
[2013-10-28 17:23:14 -0400] pabst^: gchristensen: thanks, ill stop making silly bitstrips about you now
[2013-10-28 17:23:20 -0400] gchristensen: <3
[2013-10-28 17:23:23 -0400] pabst^: :D
[2013-10-28 17:23:28 -0400] dgarstang: Okiday... what's the best way in chef to fail the client run? I want to abort if some node attributes aren't defined
[2013-10-28 17:24:19 -0400] gchristensen: dgarstang: check out how the omnibus_updater cookbook does it
[2013-10-28 17:25:50 -0400] dgarstang: gchristensen: keyword?
[2013-10-28 17:26:01 -0400] gchristensen: `raise`?
[2013-10-28 17:26:07 -0400] dgarstang: gchristensen: kk
[2013-10-28 17:26:30 -0400] workmad3: MMehdi: well, you could always have apache serving files on something like port 8080
[2013-10-28 17:26:38 -0400] tomduffield: dgarstang: uncle best practice is interested to know why node attributes wouldn't be defined
[2013-10-28 17:27:15 -0400] dgarstang: tomduffield: cuz I don't trust ohai?
[2013-10-28 17:27:34 -0400] dgarstang: gchristensen: no mention of 'raise' in any of the cookbooks at https://github.com/opscode-cookbooks/omnibus/tree/master/recipes
[2013-10-28 17:27:58 -0400] MMehdi: yep thats the other option I had, so looks like its not a good idea to hack the nginx config
[2013-10-28 17:27:58 -0400] miah: hi
[2013-10-28 17:28:07 -0400] gchristensen: dmdeklerk: omnibus_updater :)
[2013-10-28 17:28:48 -0400] workmad3: MMehdi: it's not something I'd recommend doing :) I'd get something working away from the chef server
[2013-10-28 17:28:55 -0400] gchristensen: dgarstang: omnibus_updateR* https://github.com/hw-cookbooks/omnibus_updater/blob/master/recipes/installer.rb#L23-L34
[2013-10-28 17:28:58 -0400] tomduffield: dgarstang: gotcha. is this still the instance type thing?
[2013-10-28 17:29:35 -0400] dgarstang: tomduffield: yah, but I think some magic fu from someone might have helped. Using 'ohai = Ohai::System.new ; ohai.all_plugins'
[2013-10-28 17:30:24 -0400] tomduffield: dgarstang: you could also instead of failing use a secondary method. if the node attribute is empty, pull from API call. but yeah, what you have should also work as well
[2013-10-28 17:30:32 -0400] MMehdi: cool, let me see what the my team says
[2013-10-28 17:31:22 -0400] tlr00: Folks, have a question - best bet to use LDAP and Chef-Server...Any blogs/docs anyone know about. My googles b0rked.
[2013-10-28 17:31:46 -0400] tomduffield: tlr00: open source chef server?
[2013-10-28 17:32:02 -0400] tlr00: yes @tomduffield
[2013-10-28 17:32:19 -0400] JuanFernandez: Hello all
[2013-10-28 17:32:47 -0400] tomduffield: i don't know if OS Chef Server supports LDAP out of the box
[2013-10-28 17:32:53 -0400] JuanFernandez: I have just installed Ubuntu 13.10 and found out that the included version of Apache is 2.4
[2013-10-28 17:33:03 -0400] JuanFernandez: which breaks the current apache2 official cookbook
[2013-10-28 17:33:35 -0400] JuanFernandez: Is there any way to check which version of Apache will the Package provider install?
[2013-10-28 17:34:24 -0400] JuanFernandez: This way I could version check in the recipe and avoid installing nonexisting modules or configuration directives
[2013-10-28 17:35:13 -0400] tomduffield: JuanFernandez: package will automatically install the latest. you should be able to provide version constraints though
[2013-10-28 17:35:31 -0400] JuanFernandez: I know
[2013-10-28 17:35:52 -0400] JuanFernandez: But then it means that we should create another apache2.4 official opscode cookbook ?
[2013-10-28 17:36:14 -0400] tomduffield: nah, just modify the existing one to address the problem
[2013-10-28 17:36:21 -0400] tomduffield: fix the bug :)
[2013-10-28 17:36:26 -0400] JuanFernandez: I got some success checking platform_version
[2013-10-28 17:37:07 -0400] JuanFernandez: But rather than checking if the platform is ubuntu-13.10 to assume that it will install apache2.4, I find it better to check if the going-to-be-installed apache version is 2.4 or not
[2013-10-28 17:37:40 -0400] tomduffield: what breaks with 2.4?
[2013-10-28 17:37:50 -0400] JuanFernandez: there are some non-existing modules
[2013-10-28 17:38:22 -0400] JuanFernandez: like, authz_default
[2013-10-28 17:39:00 -0400] JuanFernandez: Specifically, from the migration guide "These modules have been removed: mod_authn_default, mod_authz_default, mod_mem_cache."
[2013-10-28 17:39:53 -0400] JuanFernandez: I will remove them from the default_modules list, and check which was the config directive failing, just 2 minutes
[2013-10-28 17:40:26 -0400] tomduffield: so the package resource wont really know what version it will install until it talks to the underlying provider so you'd have to communicate with the package manager directly to see what version it would install
[2013-10-28 17:41:13 -0400] JuanFernandez: In the apache2.conf file, it triggers this error "Invalid command 'LockFile', perhaps misspelled or defined by a module not included in the server configuration"
[2013-10-28 17:42:06 -0400] JuanFernandez: Also, in the migration document, Directives AcceptMutex, LockFile, RewriteLock, SSLMutex, SSLStaplingMutex, and WatchdogMutexPath have been replaced with a single Mutex directive. You will need to evaluate any use of these removed directives in your 2.2 configuration to determine if they can just be deleted or will need to be replaced using Mutex.
[2013-10-28 17:42:15 -0400] Joel: Does anyone have an example of loading a schema using the database recipe?
[2013-10-28 17:42:16 -0400] cpuguy83: dgarstang: So that gave you the data you needed?
[2013-10-28 17:42:24 -0400] JuanFernandez: This is the guide I'm checking
[2013-10-28 17:42:25 -0400] JuanFernandez: http://httpd.apache.org/docs/trunk/upgrading.html
[2013-10-28 17:44:03 -0400] tomduffield: JuanFernandez: you should create a ticket for this if one doesn't already exist
[2013-10-28 17:44:08 -0400] JuanFernandez: I did
[2013-10-28 17:44:22 -0400] JuanFernandez: But rather than waiting, I tried to fix
[2013-10-28 17:44:24 -0400] JuanFernandez: :)
[2013-10-28 17:44:42 -0400] miah: this is why templates are awful
[2013-10-28 17:44:43 -0400] JuanFernandez: But no success checking the version. And talking to the underlying package provider directly will not be portable
[2013-10-28 17:44:54 -0400] miah: and why chef needs more singletons
[2013-10-28 17:45:01 -0400] JuanFernandez: and I guess that redhats will also migrate to 2.4 in short time
[2013-10-28 17:45:27 -0400] JuanFernandez: https://tickets.opscode.com/browse/COOK-3838
[2013-10-28 17:45:35 -0400] workmad3: miah: I've been writing resources around all my stuff, and all the ones that produce templates I've added a 'template_cookbook' attribute and the template as a source to allow overriding :)
[2013-10-28 17:45:46 -0400] allaire: hey guys, when you wrap a cookbook with your own cookbook or recipe, do you sometimes add more attributes under the wrapped cookbook name or you add it under your cookbook wrapper name? ie (default['myorg']['monit']['port'] vs default['monit']['port'])
[2013-10-28 17:46:26 -0400] tomduffield: allaire: I tend to keep my top-level attribute the name of the cookbook the attribute was defined in
[2013-10-28 17:47:43 -0400] miah: workmad3: ya, thats one way for sure
[2013-10-28 17:47:55 -0400] miah: im going the longer route and writing configuration generator classes
[2013-10-28 17:48:28 -0400] dgarstang: *sigh* more ohai issues.
[2013-10-28 17:48:59 -0400] dgarstang: bc-lvm includes bc-ohai. I'm running bc-lvm and it seems to be doing ohai, but not bc-ohai. *cry*
[2013-10-28 17:49:35 -0400] workmad3: miah: that can be v0.3 for me :)
[2013-10-28 17:51:39 -0400] miah: =)
[2013-10-28 17:52:17 -0400] dgarstang: If my run list has bc-lvm, and that does an include_recipe on bc-ohai, which in turn does and include_recipe on ohai, how on earth can my client be skipping bc-ohai?
[2013-10-28 17:52:43 -0400] Joel: source /tmp/sa-challenge-files/schema.sql; works in mysql, but http://pastebin.com/EE5isBQa doesn't work, thoughts?
[2013-10-28 17:52:46 -0400] dgarstang: i need some major prozac to deal with chef
[2013-10-28 17:54:13 -0400] dgarstang: If my run list has bc-lvm, and that does an include_recipe on bc-ohai, which in turn does and include_recipe on ohai, how on earth can my client be skipping bc-ohai?
[2013-10-28 17:54:57 -0400] dgarstang: include_recipe does work, right?
[2013-10-28 17:55:15 -0400] tomduffield: only on fridays dgarstang. its a feature!
[2013-10-28 17:55:35 -0400] dgarstang: tomduffield: *sigh*
[2013-10-28 17:55:42 -0400] dgarstang: tomduffield: wasn't working Friday either
[2013-10-28 17:56:05 -0400] dgarstang: tomduffield: it's as plain as day. Run list has a recipe. That works. The recipe that it includes isn't working correctly.
[2013-10-28 17:56:49 -0400] dgarstang: I'm starting to think the chef run list magic is approaching the puppet resource ordering magic
[2013-10-28 17:57:20 -0400] spox: dgarstang: not really. just just an array type thing that's loaded up as resources are discovered
[2013-10-28 17:57:32 -0400] spox: a run with debug enabled would probably be helpful
[2013-10-28 17:57:33 -0400] dgarstang: spox: except, it's not ..
[2013-10-28 17:58:11 -0400] someara: dgarstang you just have to remember that chef isn't doing things as the recipe is running
[2013-10-28 17:58:14 -0400] dgarstang: spox: I don't see any debug option with chef-client -h
[2013-10-28 17:58:14 -0400] car1: hi, what would be the best way to add an environment variable to a user's .bash_profile from a recipe? using the execute resource works along with the not_if parameter but I was wondering if there's a better way to do that than hardcoding bash
[2013-10-28 17:58:16 -0400] someara: its compiling a resource collection
[2013-10-28 17:58:26 -0400] spox: -l debug
[2013-10-28 17:58:29 -0400] dgarstang: someara: Ok... meaning?
[2013-10-28 17:58:34 -0400] someara: sec
[2013-10-28 17:58:59 -0400] miah: chef recipes are multi-pass
[2013-10-28 17:59:03 -0400] dgarstang: spox: k, no help though because there's log statements in the recipe being skipped over. Those still don't come out with debug increased.
[2013-10-28 17:59:08 -0400] miah: well, 2 phase really
[2013-10-28 17:59:15 -0400] dgarstang: miah: oook...
[2013-10-28 17:59:23 -0400] miah: load the recipe, and get attributes, and populate the resource collection
[2013-10-28 17:59:29 -0400] dgarstang: miah: it's running though....
[2013-10-28 17:59:33 -0400] miah: after that, the recipe doesnt matter at all
[2013-10-28 17:59:38 -0400] dgarstang: miah: it's obviously skipping an entire cookbook
[2013-10-28 17:59:47 -0400] miah: http://erik.hollensbe.org/2013/03/16/the-chef-resource-run-queue/
[2013-10-28 17:59:54 -0400] miah: read that until you understand it
[2013-10-28 18:01:12 -0400] dgarstang: miah: will it explain why certain recipes are skipped over, and values which they set, used later, are complained about not being defined?
[2013-10-28 18:02:44 -0400] dgarstang: Do I maybe have to put every single recipe that's used by a node into it's run list explicitly? Of course, that doesn't scale
[2013-10-28 18:03:56 -0400] troyready: Please read miah's linked page and stop complaining in here.
[2013-10-28 18:04:07 -0400] dgarstang: troyready; I'm asking questions.
[2013-10-28 18:05:05 -0400] dgarstang: There's no mention of include_recipe or including ordering on that page
[2013-10-28 18:05:21 -0400] tomduffield: hey dgarstang: is your code available for viewing on github or via gist?
[2013-10-28 18:06:32 -0400] dgarstang: miah: I really take offence to that.
[2013-10-28 18:06:46 -0400] someara: include_recipe evaluates a recipe and compiles the resources onto the collection when its encoutered
[2013-10-28 18:06:52 -0400] dgarstang: tomduffield: I'd have to post just the recipes I suppose.
[2013-10-28 18:07:01 -0400] dgarstang: someara: sounds great
[2013-10-28 18:07:07 -0400] ggolin_: i thnk that was the intent
[2013-10-28 18:07:25 -0400] miah: if your recipes require a specific order of execution, thats a problem in itself that most chef cookbooks haven't even thought about.
[2013-10-28 18:08:03 -0400] miah: programming via side-effects ftl.
[2013-10-28 18:08:03 -0400] dgarstang: miah: que? It was my understanding that cookbooks would be executed in the order specified in the run list.
[2013-10-28 18:08:59 -0400] someara: dgarstang: kitchen login client-ubuntu-1204
[2013-10-28 18:09:00 -0400] someara: Welcome to Ubuntu 12.04.3 LTS (GNU/Linux 3.8.0-29-generic x86_64)
[2013-10-28 18:09:00 -0400] someara:  * Documentation:  https://help.ubuntu.com/
[2013-10-28 18:09:00 -0400] someara: Last login: Mon Oct 28 17:59:01 2013 from 192.168.218.1
[2013-10-28 18:09:17 -0400] dgarstang: someara: c&p error?
[2013-10-28 18:09:23 -0400] dgarstang: miah: is that not true?
[2013-10-28 18:09:50 -0400] someara: gorram paste buffer
[2013-10-28 18:09:59 -0400] someara: what I meant to paste, was this: https://gist.github.com/someara/2175f4f2a41daa7d25c8
[2013-10-28 18:10:53 -0400] dgarstang: someara: chef shell?
[2013-10-28 18:11:25 -0400] someara: yea its a tool that lets me teach people about the resource collection
[2013-10-28 18:11:28 -0400] dgarstang: miah: is that not true?
[2013-10-28 18:11:58 -0400] gazarsgo: if my chef server is providing outdated cookbooks to my chef client what might be the problem ?
[2013-10-28 18:11:58 -0400] tomduffield: car1: the best practice is when you want Chef to manage a file you take ownership of it using a chef resource like cookbook_file or template. In this case you could use a template file to manage the .bash_profile file.
[2013-10-28 18:12:12 -0400] dgarstang: someara: looks like a much simpler implentation that what I'm tormented with
[2013-10-28 18:12:14 -0400] mattray: anyone have an example of referring to a library in 1 cookbook from a provider in another? is that supposed to be possible?
[2013-10-28 18:12:42 -0400] tomduffield: gazarsgo: cookbook constraints in your environment/run_list?
[2013-10-28 18:12:53 -0400] miah: mattray: standard ruby applies
[2013-10-28 18:12:55 -0400] gazarsgo: it's an existing working cookbook i'm updating
[2013-10-28 18:13:10 -0400] someara: @mattray that should "just work" since libraries are loaded before providers, right?
[2013-10-28 18:13:15 -0400] miah: yup
[2013-10-28 18:13:23 -0400] miah: you just have to call it via full namespace probably
[2013-10-28 18:13:43 -0400] miah: MyLib::Foo.new or MyLib::Foo.singleton ftw
[2013-10-28 18:13:55 -0400] mattray: miah: thanks, that's probably it
[2013-10-28 18:14:10 -0400] dgarstang: miah: got a link to docs that say that?
[2013-10-28 18:14:32 -0400] miah: gazarsgo: version pinning either via cookbook metadata or environments
[2013-10-28 18:14:34 -0400] dgarstang: so, i tried posting relevant bits. http://pastebin.com/RWBpL7PV Dunno how well that works. the stuff in bc-ohai is completely ignored.
[2013-10-28 18:14:50 -0400] gazarsgo: miah: we don't pin versions, and i'm uploading the same version on top...
[2013-10-28 18:15:01 -0400] someara: um
[2013-10-28 18:15:02 -0400] dgarstang: miah: you mean include_recipe I think
[2013-10-28 18:15:15 -0400] miah: bad practice 1 meet bad practice 2
[2013-10-28 18:16:01 -0400] gazarsgo: if versioning were useful, 'upload' would apply it automatically based on a SHA of the cookbook, and provide automatic change trackingand then it could just be a git repo
[2013-10-28 18:16:13 -0400] gazarsgo: that's a side topic :)
[2013-10-28 18:16:14 -0400] miah: nope. software development != knife
[2013-10-28 18:16:35 -0400] miah: sdlc is a tough thing, but youi'll get used to it
[2013-10-28 18:16:56 -0400] miah: you can ignore it. but enjoy the world of hurt and re-invention
[2013-10-28 18:17:11 -0400] gazarsgo: i would LOVE to see an example of a sane chef cookbook development workflow
[2013-10-28 18:17:16 -0400] gazarsgo: can you link me to a write up ?
[2013-10-28 18:17:16 -0400] dgarstang: miah: got a link to somewhere the docs say that chef cookbooks are executed in an arbitrary order?
[2013-10-28 18:17:25 -0400] miah: write a ruby gem that provides a resource provider
[2013-10-28 18:17:28 -0400] miah: write a cookbook that uses those resources
[2013-10-28 18:17:30 -0400] dgarstang: gazarsgo: I dont think such a thing exists
[2013-10-28 18:17:39 -0400] miah: dont write a cookbook as a recipe that creates an abstract resource
[2013-10-28 18:17:50 -0400] someara: cookbooks are executed in the order they appear in a node's run_list
[2013-10-28 18:17:52 -0400] miah: there you go
[2013-10-28 18:18:11 -0400] gazarsgo: dgarstang: a sane workflow for chef, or a writeup on one ?
[2013-10-28 18:18:25 -0400] dgarstang: someara: Okiday. That leaves me at a loss then why http://pastebin.com/RWBpL7PV skips bc-ohai and goes straight to ohai (included from bc-ohai)
[2013-10-28 18:18:32 -0400] gazarsgo: i don't really care what i need to do to get it working, i just want to know how to tell what's broken
[2013-10-28 18:18:34 -0400] dgarstang: gazarsgo: a writeup
[2013-10-28 18:18:39 -0400] miah: i think its funny how most chef users just flat out ignore the development communities history and ruby development
[2013-10-28 18:18:42 -0400] someara: why do you have a run_list in your environment definition
[2013-10-28 18:18:47 -0400] miah: and just insist that chef has to do it some magical way
[2013-10-28 18:19:10 -0400] gazarsgo: miah: tribal knowledge is the worst knowledge, how can you say someone is ignoring something when it doesn't exist except by word of mouth ?
[2013-10-28 18:19:19 -0400] dgarstang: miah: you dont have to know ruby to use chef. That's what the docs say.
[2013-10-28 18:19:25 -0400] miah: gazarsgo: uh. the ruby community has an endless amount of documentation
[2013-10-28 18:19:30 -0400] miah: chef is ruby
[2013-10-28 18:19:40 -0400] someara: chef is implemented in ruby ;)
[2013-10-28 18:19:41 -0400] dgarstang: miah: just quoting the literature
[2013-10-28 18:19:54 -0400] miah: i have a bookshelf full of great books that all apply to chef but none of them mention it directly
[2013-10-28 18:20:19 -0400] tomduffield: you don't need to know ruby to get started with Chef, but you should learn ruby if you want to be successful with Chef
[2013-10-28 18:20:40 -0400] dgarstang: someara: do I need to explicitly list ever single cookbook a node will use in his node definition?
[2013-10-28 18:20:49 -0400] ogg_: hello all, im running ubuntu 12.04 on aws using the ubuntu12.04-gems and im geting " mime-types requires Ruby version >= 1.9.2."
[2013-10-28 18:20:51 -0400] ggolin_: stop feeding the troll
[2013-10-28 18:20:54 -0400] miah: refactoring : ruby edition, metaprogramming in ruby, continuous development, continuous integration, practical object oriented design in ruby, smalltalk best practice patterns, etc etc
[2013-10-28 18:20:55 -0400] ogg_: anyone getting this message?
[2013-10-28 18:21:15 -0400] miah: tomduffield: exactly
[2013-10-28 18:21:34 -0400] miah: and Copes book is good too =)
[2013-10-28 18:21:36 -0400] mattray: miah: so if I'm trying to include this library: https://github.com/stackforge/cookbook-openstack-common/blob/master/libraries/endpoints.rb I should be able to call it how?
[2013-10-28 18:21:40 -0400] someara: @dgarstang no, you can group them in role definitions, then assign that to a node's run_list, or make a "wrapper" cookbook and include_recipe things
[2013-10-28 18:21:56 -0400] dgarstang: someara: yeah, we tried that. Didn't work. Two of us.
[2013-10-28 18:22:00 -0400] miah: mattray: you'd have to 'include Openstack' in something
[2013-10-28 18:22:02 -0400] miah: since its a module
[2013-10-28 18:22:10 -0400] someara: well you obviously did it wrong
[2013-10-28 18:22:21 -0400] dgarstang: someara: sure. love to see the docs that say how to do it right
[2013-10-28 18:22:24 -0400] miah: then 'endpoint' would be a local instance method
[2013-10-28 18:22:39 -0400] miah: if you make it a class you can create a new instance of that class and call its methods
[2013-10-28 18:22:46 -0400] miah: but what you probably want is a class full of singletons
[2013-10-28 18:23:05 -0400] miah: because those methods look like good candidates for becoming singletons
[2013-10-28 18:23:11 -0400] tomduffield: dgarstang: any chance we could see the output of your chef run?
[2013-10-28 18:23:17 -0400] someara: when you bootstrap a node (knife bootstrap, knife ec2 server create, whatever), you give it a -r flag.
[2013-10-28 18:23:19 -0400] dgarstang: tomduffield: sure
[2013-10-28 18:23:25 -0400] miah: you're not really interesting in creating a 'openstack' object, your just interested in passing some data to a method and getting an answer
[2013-10-28 18:23:26 -0400] someara: so knifebootstrap 1.2.3.4 -r 'recipe[mything]'
[2013-10-28 18:23:43 -0400] someara: or 'role[bananna]'
[2013-10-28 18:24:00 -0400] miah: fwiw. i stopped sharing with dgarstang because he doesn't share with us and is incapable of learning. if that makes me a bad member of the community i apologize.
[2013-10-28 18:24:39 -0400] dgarstang: tomduffield: http://pastebin.com/5wnKFsEP
[2013-10-28 18:24:51 -0400] someara: brb
[2013-10-28 18:24:52 -0400] dgarstang: miah: what would you like me to share?
[2013-10-28 18:25:40 -0400] dgarstang: miah: your really a rather offensive character. Tis a shame.
[2013-10-28 18:28:05 -0400] tomduffield: dgarstang: so your chef run is failing because this is empty: data["gce"]["machine_type"].split("/")[-1]
[2013-10-28 18:28:28 -0400] mattray: miah: thanks, that cleared things up
[2013-10-28 18:28:32 -0400] miah: =)
[2013-10-28 18:28:34 -0400] miah: glad to help
[2013-10-28 18:28:56 -0400] tomduffield: dgarstang: i'm pretty sure [-1] is not a valid array index
[2013-10-28 18:29:06 -0400] dgarstang: tomduffield: yah I know. that should have been set when bc-ohai ran
[2013-10-28 18:29:18 -0400] dgarstang: tomduffield: except bc-ohai was totally skipped over.
[2013-10-28 18:29:35 -0400] gazarsgo: tomduffield: [-1] is the last element
[2013-10-28 18:29:40 -0400] dgarstang: tomduffield: I woudln't need to do that, except without the hints file, ohai doesn't work
[2013-10-28 18:29:55 -0400] miah: rather than [-1], use .last
[2013-10-28 18:30:25 -0400] dgarstang: tomduffield: i know. typically that would contain 'projects/941197483242/machineTypes/n1-standard-2-d'
[2013-10-28 18:30:58 -0400] dgarstang: kk. I can use .last... except that var is empty
[2013-10-28 18:31:01 -0400] dgarstang: ... because bc-ohai was skipped over. I know this because it's log statements are never displayed
[2013-10-28 18:31:39 -0400] dgarstang: and therefore the /etc/chef/ohai/hints/gce.json file was never created, which means ohai doesn't return any GCE data.
[2013-10-28 18:31:43 -0400] miah: http://www.ruby-doc.org/core-2.0.0/Array.html#method-i-last
[2013-10-28 18:32:12 -0400] dgarstang: miah: data["gce"]["machine_type"] is unset
[2013-10-28 18:33:17 -0400] dgarstang: in fact, I's suspect that there is no data['gce']
[2013-10-28 18:33:21 -0400] cpuguy83: dgarstang: So force bc-ohai to run
[2013-10-28 18:33:40 -0400] dgarstang: cpuguy83: how?
[2013-10-28 18:34:46 -0400] cpuguy83: Best way would be to look at the code and see what it's doing.  I don't know what bc-ohai is and a rubygems search and a cookbook search didn't return anything
[2013-10-28 18:35:19 -0400] tomduffield: dgarstang: you are getting caught by the multi-phase execution, which is what miah was trying to tell you
[2013-10-28 18:35:50 -0400] tomduffield: the first phase of the chef-run is what creates the static resources which run during the second phase
[2013-10-28 18:36:06 -0400] dgarstang: cpuguy83: bc-ohai is a wrapper around ohai that basically just works out what hint file to create
[2013-10-28 18:36:07 -0400] miah: /ignore is your friend here.
[2013-10-28 18:36:17 -0400] miah: of course, maybe your better at dealing with the pain than i
[2013-10-28 18:36:34 -0400] jblack: Hi, I'm having trouble with php_pear.   Chef is working fine on vagrant, but bombs out on rightscale.  I have the following information here: http://pastebin.com/7eipi3Dn
[2013-10-28 18:36:47 -0400] dgarstang: tomduffield: yes, I'm afraid that http://erik.hollensbe.org/2013/03/16/the-chef-resource-run-queue/ wasn't much help and no matter how many times I read it, I don't think I can apply it to my specific situation.
[2013-10-28 18:36:56 -0400] tomduffield: it does though
[2013-10-28 18:37:07 -0400] dgarstang: miah: again, please stop with the negative comments.
[2013-10-28 18:37:19 -0400] mveitas: Do I need to call node.override['foo'] before calling a recipe that will use that attribute?
[2013-10-28 18:37:48 -0400] tomduffield: you are trying to reference something in the first phase that is only set in the second phase
[2013-10-28 18:38:30 -0400] dgarstang: tomduffield: ah, english. :) Well, ok, that makes sense
[2013-10-28 18:39:13 -0400] dgarstang: tomduffield: how I determine which phase each is in... well...
[2013-10-28 18:39:56 -0400] tomduffield: dgarstang put simply you can think of it like this. the first phase runs all the ruby code which figures out what chef resources to execute, the second phase executes your chef resource
[2013-10-28 18:40:13 -0400] tomduffield: this is what someara was talking about when he mentioned the resource collection
[2013-10-28 18:40:20 -0400] tomduffield: the first phase creates the resource collection
[2013-10-28 18:40:29 -0400] tomduffield: the second phase executes each item in that collection
[2013-10-28 18:40:44 -0400] gazarsgo: is there a way to only run the first phase and output the results ?
[2013-10-28 18:41:16 -0400] tomduffield: kind of. you can use --why-run which will set all of your actions to :nothing and just print out what it will do
[2013-10-28 18:41:21 -0400] tomduffield: otherwise you can use chef-shell
[2013-10-28 18:41:28 -0400] tomduffield: which is what someara was doing
[2013-10-28 18:41:30 -0400] miah: that depends on the resources your using to support why-run as well
[2013-10-28 18:41:40 -0400] gazarsgo: chef-client --why-run ?
[2013-10-28 18:42:03 -0400] miah: though most community cookbooks use the chef primitives so it will probably be a step in the right direction
[2013-10-28 18:42:06 -0400] gazarsgo: oh cool, that's very helpful
[2013-10-28 18:42:31 -0400] dgarstang: I can't even begin to imagine how to make the right things happen in the right phase, or how your supposed to know. I could sweet this under the carpet if the ohai hints weren't required.
[2013-10-28 18:43:19 -0400] tomduffield: dgarstang: hence why Ruby knowledge comes in handy
[2013-10-28 18:43:34 -0400] tomduffield: if you know how Chef is built, you can figure out how
[2013-10-28 18:43:48 -0400] tomduffield: you are trying to do something that not very many people need to do
[2013-10-28 18:43:53 -0400] tomduffield: this is very much an advanced thing
[2013-10-28 18:43:57 -0400] dgarstang: tomduffield: use ohai data?
[2013-10-28 18:44:08 -0400] wblair: New to chef.  - 10.18.2  - successfully ran knife bootstrap to Ubuntu host.  Fails on CentOS 6, gets permission errors. User on knife command can successfully ssh in and sudo.  I only find knife/bootstrap/centos5-gems.erb. Do I have to write my own centos6> I can't find an update anywhere I've looked.
[2013-10-28 18:44:32 -0400] tomduffield: dgarstang: but your not using ohai data. you are trying to force ohai to generate data in a specific way at a specific time
[2013-10-28 18:44:46 -0400] miah: ohai is for automatic attributes
[2013-10-28 18:44:52 -0400] miah: forcing it to do anything is hardly automatic
[2013-10-28 18:44:59 -0400] dgarstang: tomduffield: I wouldn't say that. I just want to access ohai data on the first chef run. That's it. No fancy requirements.
[2013-10-28 18:45:10 -0400] chris613: wblair: use chef-full instead of gems. The gems have been deprecated in favor of the "omnibus" package
[2013-10-28 18:45:16 -0400] miah: you can write a ohai extension to make it provide an attribute automatically
[2013-10-28 18:45:25 -0400] miah: but attributes from ohai are populated very very early in the chef run
[2013-10-28 18:45:38 -0400] dgarstang: miah: I'd call the instance type pretty automatic.
[2013-10-28 18:45:50 -0400] tomduffield: dgarstang: the point is for whatever reason ohai isn't populating the data that you need.
[2013-10-28 18:45:50 -0400] dgarstang: miah: but (apparently?) not available until the next run
[2013-10-28 18:46:04 -0400] dgarstang: tomduffield: not without a hint file, correct
[2013-10-28 18:46:08 -0400] tomduffield: dgarstang: this could be a legit bug or it could be something wonky
[2013-10-28 18:46:16 -0400] wblair: I'm fillowing the quick start and the only req is that a user can ssh in and sudo.  The knife bootstrap is support to do everything else on the target system.
[2013-10-28 18:46:28 -0400] tomduffield: but the point is that you are outside of the "typical" pattern
[2013-10-28 18:46:31 -0400] miah: i think the quick start is hella old
[2013-10-28 18:46:44 -0400] miah: wblair: https://learnchef.opscode.com/
[2013-10-28 18:46:48 -0400] dgarstang: tomduffield: cpguy gave me some magic fu to access the ohai data straight away. That's been useful. Now, the issue seems to be that if you create the hint file, I guess that, and using data ... are still in different phases. I dunno
[2013-10-28 18:46:57 -0400] miah: are you using that quick start or the one from the wiki?
[2013-10-28 18:47:05 -0400] tomduffield: cpguy gave you magic fu which was Ruby code
[2013-10-28 18:47:08 -0400] dgarstang: tomduffield: I still can't imagine why being able to query the instance type on the first run isn't typical.
[2013-10-28 18:47:45 -0400] tomduffield: dgarstang: and I am agreeing with you. like I said, the fact that it isn't available to you in the predicted pattern could very well be a bug with Ohai
[2013-10-28 18:48:16 -0400] tomduffield: dgarstang: but the intended use of Ohai is to never have to use the magic fu that you were given
[2013-10-28 18:48:16 -0400] wblair: Did the learnchef quickstart.  Got ubuntu working okay, want to do same with Centos6
[2013-10-28 18:48:29 -0400] tomduffield: once you started using that, you went into the "advanced" territory
[2013-10-28 18:48:52 -0400] chris613: wblair: "chef-full" instead of "centos5-gems"
[2013-10-28 18:49:02 -0400] tomduffield: and when you enter into the advanced territory, Ruby knowledge is key
[2013-10-28 18:49:29 -0400] dgarstang: tomduffield: well, without that magic fu, you can't access data until the next run, even on Amazon.
[2013-10-28 18:49:50 -0400] gazarsgo: how can i tell what version of a cookbook a client is getting ?
[2013-10-28 18:49:57 -0400] dgarstang: tomduffield: people have told me here multiple times you can't access chef data until the next run. 'Run it twice' was a common solution.
[2013-10-28 18:49:58 -0400] tomduffield: dgarstang: right. so you have two options
[2013-10-28 18:50:25 -0400] tomduffield: 1) you can submit a ticket to tickets.opscode.com for the ohai project and see if they can fix that problem
[2013-10-28 18:51:00 -0400] tomduffield: 2) you can try to create a workaround (which you did). but once you start that workaround, you are beyond "basic" chef and you start needing more and more Ruby knowledge
[2013-10-28 18:51:13 -0400] tomduffield: because what you were doing with the "magic fu" was Ruby code, not Chef code
[2013-10-28 18:52:03 -0400] wblair: SOrry but I am not specifying an platform. The command line is simply  "knife bootstrap 10.25.25.239 -x george" then I get perm denied when creeating the rpm lok file and creating /etc/chef
[2013-10-28 18:52:42 -0400] chris613: wblair: In that case, add "-d chef-full" to your commandline
[2013-10-28 18:53:18 -0400] chris613: By default Chef 10 used platform-version specific gemsets, but that became deprecated as the prep for Chef 11 was being done.
[2013-10-28 18:54:01 -0400] miah: wblair: pass --sudo
[2013-10-28 18:54:55 -0400] wblair: Same behavior...  time stamp in knife/bootstrap/chef-full.erb is Jan 18, 2013
[2013-10-28 18:55:04 -0400] wblair: Hang on ...
[2013-10-28 18:56:20 -0400] tomduffield: dgarstang: and you can access chef-data immediately. the second-run solution is a workaround to the problem I mentioned above where the value you are trying to use during the first phase isn't generated until the second. that means that the value would be available during the first phase of the second run, hence it working
[2013-10-28 18:57:07 -0400] wblair: Working. Thanks.  Why does it not work as documented in http://docs.opscode.com/install_bootstrap.html
[2013-10-28 19:01:18 -0400] dgarstang: tomduffield: this might be an issue with GCE then, cuz it was kinda working in Amazon
[2013-10-28 19:03:03 -0400] tomduffield: dgarstang: that is possible (and also very likely). once you become more familiar with Chef and how it works (another plug to learn ruby) it is a lot easier to identify whether the problem is with Chef or with an underlying technology that Chef is trying to use
[2013-10-28 19:03:48 -0400] dgarstang: tomduffield: in the meantime, I got deadlines
[2013-10-28 19:04:18 -0400] ssd7: CHEF Code Review: https://plus.google.com/hangouts/_/72cpjn8no9i1qdngtqs3ff0nj4
[2013-10-28 19:04:19 -0400] dgarstang: kinda hard when your the only GCE customer
[2013-10-28 19:04:42 -0400] tomduffield: can you use the API? i know its slower but it'll work more reliably probably
[2013-10-28 19:07:32 -0400] paulmooring: Beth85.Wlak86
[2013-10-28 19:09:56 -0400] dgarstang: tomduffield: can I access the data immediately? 'sides, then I gotta write ruby code to call curl
[2013-10-28 19:10:17 -0400] dgarstang: tomduffield: tried putting an ohai reload in there. same result.
[2013-10-28 19:10:33 -0400] gazarsgo: ruby code to call curl .. ?
[2013-10-28 19:10:51 -0400] dgarstang: gazarsgo: to access the GCE API...
[2013-10-28 19:10:57 -0400] tomduffield: output = `curl http://google.com/api`
[2013-10-28 19:10:58 -0400] gazarsgo: why wouldn't you just use a client gem ?
[2013-10-28 19:11:13 -0400] tomduffield: but yeah, I would also say use Geem
[2013-10-28 19:11:15 -0400] tomduffield: *gem
[2013-10-28 19:11:15 -0400] gazarsgo: https://code.google.com/p/google-api-ruby-client/
[2013-10-28 19:11:21 -0400] dgarstang: gazarsgo: a gem? why a gem?
[2013-10-28 19:11:34 -0400] gazarsgo: you can just telnet to port 80 too dude, that's cool too
[2013-10-28 19:11:39 -0400] gazarsgo: and automate it with expect
[2013-10-28 19:11:57 -0400] tomduffield: dgarstang: because they already wrote the code for you
[2013-10-28 19:12:00 -0400] gchristensen: so much sass, I love itc
[2013-10-28 19:12:03 -0400] dgarstang: gazarsgo: seems strange to use extra software to grab a URL
[2013-10-28 19:12:22 -0400] Cope: Sometimes shell out to curl is the simplest thing that could possibly work
[2013-10-28 19:12:30 -0400] jblack: So, what should I do about this?  I'm attempting to discover a php_pear channel, and on one system, it works, and on another it doesn't
[2013-10-28 19:12:31 -0400] Cope: actually more to go wrong with the gem
[2013-10-28 19:12:32 -0400] tomduffield: dgarstang: well, if you need to pass in credentials the gem can be easier
[2013-10-28 19:12:41 -0400] miah: net/http isn't very difficult to use honestly
[2013-10-28 19:13:08 -0400] miah: the problem with shell'ing out is different versions of software could have different arguments
[2013-10-28 19:13:10 -0400] Cope: once you get to more than a simple curl invocation, then sure, reach for a more powerful tool
[2013-10-28 19:13:12 -0400] tomduffield: Rule #1 of Ruby: There are as many different ways to solve a problem as there are problems
[2013-10-28 19:13:13 -0400] miah: the classic example is 'tar'
[2013-10-28 19:13:22 -0400] miah: tar on sysv != bsd tar != gnu tar
[2013-10-28 19:13:25 -0400] dgarstang: tomduffield: creds arent required. I dunno. Seems like I'm gonna hit the same issue. I'll try. Want to steer away from gems though, as it puts a dependancy on someone else to install our systems. That's bad
[2013-10-28 19:13:48 -0400] tomduffield: dgarstang: if it were me, I would start with curl
[2013-10-28 19:13:54 -0400] Cope: +1
[2013-10-28 19:13:55 -0400] tomduffield: if things get more complicated, maybe you can use the gem
[2013-10-28 19:13:59 -0400] Cope: +2
[2013-10-28 19:14:00 -0400] Cope: :)
[2013-10-28 19:14:02 -0400] miah: this is why i prefer to stay in ruby instead of using execute/bash/shell_out or `stuff`
[2013-10-28 19:14:05 -0400] dgarstang: tomduffield: I would too, if I could find an example of how to execute external code in chef and get the output
[2013-10-28 19:14:32 -0400] tomduffield: dgarstang: you are using Ruby to execute external code, not Chef ;)
[2013-10-28 19:14:35 -0400] Cope: miah: yep, tehre' totally a good argument for that
[2013-10-28 19:15:04 -0400] tomduffield: so the google query would be 'execute bash command with ruby' ;)
[2013-10-28 19:15:20 -0400] miah: ruby system()
[2013-10-28 19:15:28 -0400] dgarstang: tomduffield: well then, python has urllib... what's ruby got?
[2013-10-28 19:15:31 -0400] dgarstang: tomduffield: I'll look
[2013-10-28 19:15:56 -0400] gazarsgo: net/http, or lots of gems
[2013-10-28 19:16:11 -0400] tomduffield: python's urllib is probably close to the net/http miah mentioned
[2013-10-28 19:16:21 -0400] miah: http://rubyquicktips.com/post/5862861056/execute-shell-commands
[2013-10-28 19:16:28 -0400] miah: ruby isn't too difficult
[2013-10-28 19:16:43 -0400] dgarstang: miah: you know my opinion on that. :-\
[2013-10-28 19:17:14 -0400] troyready: dgarstang, you have so many people wrapped up in helping you in here. Please don't whine about ruby.
[2013-10-28 19:17:35 -0400] dgarstang: troyready: I didn't. I told miah he knows my opinion on it.
[2013-10-28 19:17:46 -0400] tomduffield: dgarstang: learning ruby is like learning how to swim. the challenge you are facing is that you are getting thrown into the deep end right away
[2013-10-28 19:18:14 -0400] tomduffield: you can try free ruby courses on codeschool or codeacademy and they make it much easier to digest
[2013-10-28 19:18:24 -0400] miah: the only reason he's in the deep end right away is because he's trying to implement a complex idea in a complex system
[2013-10-28 19:18:28 -0400] miah: so there are lots of things to understand
[2013-10-28 19:18:31 -0400] dgarstang: tomduffield nah it's not. I've picked up the ruby book several times. I put it down again after a few pages because of the syntax.
[2013-10-28 19:18:39 -0400] troyready: (*she) --- yeah, and we all know what that is. If you keep fighting it every day, you might as well go back to puppet
[2013-10-28 19:19:32 -0400] miah: oh. should i refer to dgarstang as she?
[2013-10-28 19:19:37 -0400] jtimberman: i'm not going to read al lthe backscroll :) but there's an http_request resource built into core chef.
[2013-10-28 19:20:01 -0400] tomduffield: troyready: lets make sure to be patient and inclusive :) we were all beginners here at one point
[2013-10-28 19:20:17 -0400] jtimberman: tomduffield: +1 :)
[2013-10-28 19:20:22 -0400] miah: tomduffield: indeed
[2013-10-28 19:20:35 -0400] miah: at some point though, helping people is a detriment to your own sanity
[2013-10-28 19:20:35 -0400] tomduffield: dgarstang: the interactive nature of the codeschool and code academy might make it a little easier then books
[2013-10-28 19:20:35 -0400] troyready: miah, sorry, I was referring to dgarstang calling you a he
[2013-10-28 19:20:41 -0400] miah: ah
[2013-10-28 19:20:48 -0400] miah: i ignore dgarstang so i have no idea what they say =)
[2013-10-28 19:20:51 -0400] dgarstang: tomduffield: Ive been doing this for 16 years. Ruby is unique.
[2013-10-28 19:21:04 -0400] miah: i tried and tried
[2013-10-28 19:21:13 -0400] miah: but i cant help those who refuse to help themselves
[2013-10-28 19:21:34 -0400] troyready: tomduffield, I don't want to come across as the jerk in here, but I think miah's point about support vampires is significant
[2013-10-28 19:21:35 -0400] dgarstang: miah: please refrain from the negative comments.
[2013-10-28 19:22:14 -0400] troyready: I'm not trying to be abrasive to newcomers, but I think letting it go unchecked is going to have a significantly negative effect on this support community in the longterm
[2013-10-28 19:22:16 -0400] dgarstang: troyready: I disagree. There's a distinct lack of best practices documentation. If you can suggest an alternative location for docs, I'd be happy to go there.
[2013-10-28 19:22:34 -0400] miah: ^^^^^^
[2013-10-28 19:22:39 -0400] Kzim: hi, anyone use PyChef here please
[2013-10-28 19:24:17 -0400] dgarstang: Kzim: hehe
[2013-10-28 19:24:26 -0400] adamjk-dev: jtimberman: hello sir, any thoughts on: https://github.com/jtimberman/vagrant-cookbook/pull/2
[2013-10-28 19:24:34 -0400] troyready: dgarstang, it has been done for you, plenty of times (i.e. berkshelf). And like any programming language, there are plenty of ways for handling problems so it's not invalid for people to respond to you with TMTOWTDI
[2013-10-28 19:24:46 -0400] Cope: Kzim: it's a busy channel with a lot going on; it'd be great if you'd help by asking a specific and informational question, rather than a meta-question, or conduct a poll....
[2013-10-28 19:25:05 -0400] dgarstang: jtimberman: I believe http_request is for sending data only.
[2013-10-28 19:25:05 -0400] Cope: Kzim: but.. coderanger is probably the person to ask
[2013-10-28 19:25:12 -0400] troyready: but again, I'm not trying to be abrasive. happy to still help with each issue that comes up. It's just not surprises that it devolves every time
[2013-10-28 19:25:21 -0400] coderanger: Kzim: Yo
[2013-10-28 19:25:22 -0400] Kzim: Cope,  thanks !
[2013-10-28 19:25:38 -0400] gazarsgo: troyready: do you know of a good writeup on berkshelf or test kitchen ?
[2013-10-28 19:25:54 -0400] Kzim: coderanger, how are you ? i have a pretty stupid question i can't seams to import pychef correctly :( like from chef import autoconfigure
[2013-10-28 19:26:05 -0400] Cope: gazarsgo: my book covers that in great detail
[2013-10-28 19:26:18 -0400] gazarsgo: Cope: your book being  ?
[2013-10-28 19:26:22 -0400] troyready: gazarsgo, No, sorry -- not using berkshelf yet
[2013-10-28 19:26:26 -0400] Kzim: coderanger, i get cannot import name autoconfigure i'm sure it worked before :(
[2013-10-28 19:26:32 -0400] Cope: gazarsgo: http://shop.oreilly.com/product/0636920030973.do
[2013-10-28 19:26:49 -0400] gazarsgo: doesn't cover docker ?
[2013-10-28 19:26:51 -0400] coderanger: Kzim: Can you pastebin the traceback?
[2013-10-28 19:27:00 -0400] dgarstang: Actually, there's an example of a GET request at http://docs.opscode.com/resource_http_request.html, but no mention of how to get the result
[2013-10-28 19:27:01 -0400] Cope: gazarsgo: nope, doesn't cover docker (yet!)
[2013-10-28 19:27:06 -0400] jtimberman: dgarstang: you can send different HTTP verbs as actions
[2013-10-28 19:27:15 -0400] dgarstang: jtimberman: Can I get the output?
[2013-10-28 19:28:00 -0400] Kzim: coderanger, http://pastebin.com/EbEwT13v
[2013-10-28 19:28:39 -0400] Kzim: coderanger, i use PyChef-0.2.2-py2.7
[2013-10-28 19:28:52 -0400] coderanger: Kzim: Local imports are biting you, you have a file next to the current file also called chef.py and that takes priority over the system library
[2013-10-28 19:29:04 -0400] coderanger: (most likely anyway)
[2013-10-28 19:29:09 -0400] Kzim: damn !
[2013-10-28 19:29:13 -0400] Kzim: thanks a lot ! so sorry !
[2013-10-28 19:29:16 -0400] coderanger: Try adding from __future__ import absolute_imports
[2013-10-28 19:29:18 -0400] coderanger: to the top
[2013-10-28 19:29:29 -0400] troyready: dgarstang, I might be reading too much into your question, but I don't think you want to use that http resource -- since you're trying to use its responses during the compile phase, you're just going to end up with empty data
[2013-10-28 19:29:48 -0400] Joel: I'm checking out of a hosted git enterprise, and I'm getting an ssl deal, press to accept the latest key, how do you guys work around that stuff in recipes?
[2013-10-28 19:29:49 -0400] bilbur: in regards to open source chef, what log file on the server is most useful for debugging clients that dont bootstrap properly. I am aware of /var/chef/cache/chef-stacktrace on the client, but want to see server side info. Thanks.
[2013-10-28 19:30:06 -0400] troyready: That is, I'm assuming your http calls are to the google api, and then you're going to use the response with if/not_ifs on your other resources
[2013-10-28 19:30:07 -0400] coderanger: Joel: -o HostKetVerification=no
[2013-10-28 19:30:30 -0400] Joel: coderanger: thanks, will find a way to specify that in my chef recipe.
[2013-10-28 19:30:45 -0400] dgarstang: troyready: somoene suggested I use that to get around that issue... was it you? :-\
[2013-10-28 19:30:48 -0400] coderanger: Joel: You need to make an ssh wrapper script and pass it to git
[2013-10-28 19:30:56 -0400] coderanger: Joel: Check out the application cookbook, it automates this
[2013-10-28 19:30:58 -0400] jtimberman: dgarstang: doesn't appear that the response is exposed.
[2013-10-28 19:31:26 -0400] coderanger: Kzim: Better fix, use Python 3 ;-)
[2013-10-28 19:31:33 -0400] dgarstang: jtimberman: k
[2013-10-28 19:31:33 -0400] dgarstang: troyready: something like that. the type is a key to a data bag item that says what the physical disks are for that instance type
[2013-10-28 19:31:49 -0400] troyready: it was the (way more knowledgeable than myself) jtimberman , but as he noted it wasn't in direct context to your previous questions
[2013-10-28 19:32:00 -0400] troyready: Just in context of the discussion on how to call out to curl/http via chef
[2013-10-28 19:32:03 -0400] tomduffield: dgarstang: http://ruby-doc.org/stdlib-2.0.0/libdoc/net/http/rdoc/Net/HTTP.html#label-GET+by+URI
[2013-10-28 19:32:12 -0400] Joel: coderanger: interesting. This just started cropping up from crap that was working all day, too, so I'm equally annoyed. someone must have changed something on our hosted enterprise git.
[2013-10-28 19:32:57 -0400] dgarstang: tomduffield: maybe it was you ... but yah that's not gonna work due to the multi execution phase thingy apparently
[2013-10-28 19:33:00 -0400] jtimberman: dgarstang: so i don't know how specifically to solve the problem you have.
[2013-10-28 19:33:11 -0400] tomduffield: not necessarily
[2013-10-28 19:33:15 -0400] troyready: dgarstang, tomduffield has pointed out a couple options that should work -- most recently net/http, and before that shelling out via "output = `curl blah`"
[2013-10-28 19:33:20 -0400] jtimberman: but using "pure ruby" would probably be done i na ruby_block resource.
[2013-10-28 19:33:29 -0400] tomduffield: what is it you are trying to do with the instance type dgarstang?
[2013-10-28 19:33:37 -0400] jtimberman: if what you want is the body of HTML or whatever, i'd probably use open-uri instead of net::http
[2013-10-28 19:33:59 -0400] dgarstang: troyready: you just said 'responses during the compile phase, you're just going to end up with empty data'... you said the API request wouldn't work just now
[2013-10-28 19:34:02 -0400] dgarstang: tomduffield: get it. :)
[2013-10-28 19:34:32 -0400] tomduffield: and do what with it? hug it? populate a file with it? use it to make some type of logical decision?
[2013-10-28 19:35:06 -0400] cpuguy83: anyone have any examples of using omnibus_ruby to build a full rails project... I'm sure chef-server is probably doing this.
[2013-10-28 19:35:09 -0400] troyready: dgarstang, I said that about the http Chef Resource, in the context of how you'll use its response
[2013-10-28 19:35:24 -0400] Kzim: coderanger, k :) thanks for your work !
[2013-10-28 19:35:28 -0400] dgarstang: tomduffield: its being used as the data to load physical disks list from a databag. if if this instance type, then physical disks are these, so that lvm can put them into a vg
[2013-10-28 19:35:32 -0400] troyready: errr, http_response Chef resource
[2013-10-28 19:35:58 -0400] dgarstang: troyready: right, I want to use the response, in the same chef run.
[2013-10-28 19:36:27 -0400] tomduffield: so the instance type is the name of the data bag item or a key in the data bag item?
[2013-10-28 19:36:28 -0400] dgarstang: If anyone here is using Google Compute Engine, that'd be handy to know
[2013-10-28 19:36:49 -0400] dgarstang: tomduffield: Correct. it's the data bag key
[2013-10-28 19:37:07 -0400] dgarstang: tomduffield: not perfect, but gotta get physical disk list from somewhere
[2013-10-28 19:37:49 -0400] tomduffield: okay. you should be fine then
[2013-10-28 19:37:56 -0400] dgarstang: tomduffield: apparently not. :)
[2013-10-28 19:38:09 -0400] tomduffield: its not working?
[2013-10-28 19:38:27 -0400] dgarstang: tomduffield: Nope. Works on Amazon. Behaviour is different on GCE.
[2013-10-28 19:38:51 -0400] tomduffield: the behavior of chef?
[2013-10-28 19:38:56 -0400] dgarstang: tomduffield: I create the hint file in one cookbook, and then try use data from it in another. Apparently I'm hitting a multi execution phase issue
[2013-10-28 19:39:19 -0400] tomduffield: you dont need a hint file here
[2013-10-28 19:39:44 -0400] tomduffield: if you are using the API you can ignore ohai for the time being
[2013-10-28 19:39:57 -0400] dgarstang: tomduffield: my observstions show that I do. Without the hint file, a 'ohai gce' returns nothing. I'd have to check again, but I think the same applies to Amazon
[2013-10-28 19:40:19 -0400] itisit_: anyone use chef to upgrade rabbitmq cluster?
[2013-10-28 19:40:35 -0400] tomduffield: dont use ohai anymore when dealing with your instance type
[2013-10-28 19:41:10 -0400] dgarstang: tomduffield: ok... so, I could grab the instance type from GCE metadata, but will I have access to it in the same chef run?
[2013-10-28 19:42:00 -0400] tomduffield: yes, if you make a call to the API using the ruby libraries we've mentioned it will be available to you in the same chef run
[2013-10-28 19:42:31 -0400] dgarstang: tomduffield: okiday then. Ill give it a shot. Seems like the logic is the same though as when it failed with ohai
[2013-10-28 19:44:34 -0400] dgarstang: tomduffield: I still need to use ohai to some degree anyway. I need to know whether i should be querying google or amazon API.
[2013-10-28 19:45:48 -0400] itisit_: anyone use chef to upgrade rabbitmq cluster?
[2013-10-28 19:55:53 -0400] tomduffield: itisit_ you may want to try the mailing list
[2013-10-28 19:57:09 -0400] cinen: does anyone know if its possible to modify the default retries value for all resources? Without modifying chef source
[2013-10-28 19:58:11 -0400] tomduffield: cinen: yes. but can I ask why you want to change them?
[2013-10-28 19:58:33 -0400] miah: declaring a specific state should do just that
[2013-10-28 19:58:36 -0400] miah: shouldn't have to retry.
[2013-10-28 19:58:46 -0400] cinen: to minimize failures
[2013-10-28 19:59:08 -0400] cinen: miah: I'm not sure I know what you mean
[2013-10-28 19:59:26 -0400] tomduffield: cinen: is there a specific resource that is giving you trouble?
[2013-10-28 19:59:32 -0400] tomduffield: (as an example)
[2013-10-28 19:59:46 -0400] cinen: no, not one specifically.  I want to change the global default value
[2013-10-28 20:00:26 -0400] tomduffield: are resources failing for you?
[2013-10-28 20:01:12 -0400] cinen: I will often have chef-client runs fail once for various reasons then be fine when run again
[2013-10-28 20:02:02 -0400] tomduffield: well, changing the default value for retries is a really big hammer for what seems to be a small nail
[2013-10-28 20:02:10 -0400] cinen: I'm also trying to figure out a way to possibly use an error handler to retry the entire chef-client run a set number of times before sending out the error report
[2013-10-28 20:03:39 -0400] cinen: that makes sense. but I think it would help for now until I have time to dig deeper and resolve some of the recurring issues
[2013-10-28 20:03:52 -0400] tomduffield: hold that thought
[2013-10-28 20:04:11 -0400] tomduffield: because the only real way to do a global change would be to monkeypatch Chef
[2013-10-28 20:04:36 -0400] tomduffield: if I were you, i'd just resolve the issues :) it'll be quicker
[2013-10-28 20:04:41 -0400] cpuguy83: cinen: It would be best to capture these exceptions and retry within the code
[2013-10-28 20:05:21 -0400] cpuguy83: so "begin; # some code that acts up; rescue SomeError; # do something to fix; retry; end"
[2013-10-28 20:05:54 -0400] cinen: certain things though are out of my control.  like sometimes it will randomly fail on syncing cookbooks, which is why I was thinking about an error handler that could restart the whole chef-client run
[2013-10-28 20:06:28 -0400] cinen: and its tough to debug things that just pop up every once in a while
[2013-10-28 20:07:40 -0400] tomduffield: cinen: we all feel your pain. right now though there isn't an easy way to do what you're asking. maybe try making a feature request?
[2013-10-28 20:08:51 -0400] cinen: I'm working on an api for spinning up servers and bootstrapping, so right now my only other option is to check the exit code on the bootstrap process and run it again if not 0
[2013-10-28 20:09:59 -0400] cinen: thanks for the advice
[2013-10-28 20:10:45 -0400] tomduffield: you're welcome. good luck!
[2013-10-28 20:12:55 -0400] ichilton: vagrant@vagrant-shell:~/chef_chruby_install$ knife cookbook site share chruby_install "Programming Languages"
[2013-10-28 20:12:58 -0400] ichilton: ERROR: Chef::Exceptions::CookbookNotFoundInRepo: Cannot find a cookbook named chruby_install; did you forget to add metadata to a cookbook? (http://wiki.opscode.com/display/chef/Metadata)
[2013-10-28 20:13:02 -0400] ichilton: Am I being daft?
[2013-10-28 20:13:32 -0400] ichilton: the metadata does contain chruby_install...
[2013-10-28 20:13:51 -0400] tomduffield: knife cookbook is going to look for a cookbooks directory specified in your knife.rb
[2013-10-28 20:14:00 -0400] Cope: -o ../
[2013-10-28 20:14:05 -0400] tomduffield: and its going to expect that the chruby_install folder be in there
[2013-10-28 20:14:14 -0400] tomduffield: so yeah, like Cope said
[2013-10-28 20:14:16 -0400] andrewdeandrade: so when working with chef environment files using the Ruby DSL, does chef ignore all the ruby that isn't part of the DSL when converting to JSON? i.e. can I go ahead and use ruby to dynamically define attributes?
[2013-10-28 20:14:36 -0400] ichilton: I tried creating a ~/.knife.rb with cookbook_path = /vargrant
[2013-10-28 20:14:39 -0400] ichilton: and tried -o .
[2013-10-28 20:14:55 -0400] tomduffield: -o ../
[2013-10-28 20:15:00 -0400] Cope: ichilton: you fail; get out of this channel - you're far too stupid.
[2013-10-28 20:15:05 -0400] ichilton: will -o ../ work when the dir name has chef_ prefixed?
[2013-10-28 20:15:16 -0400] Cope: ichilton: if you have name in the metadata
[2013-10-28 20:15:17 -0400] ichilton: Cope: bah!
[2013-10-28 20:15:24 -0400] jtimberman: Cope: O.o!
[2013-10-28 20:15:29 -0400] jtimberman: ichilton: command line -o overrides cookbook_path in the knife.rb
[2013-10-28 20:15:31 -0400] Cope: which you do :) because I looked today!
[2013-10-28 20:16:14 -0400] ichilton: hmm, same error
[2013-10-28 20:16:53 -0400] ichilton: yeah, I looked up -o but assumed it wanted the cookbook dir rather than a dir full of cookbooks. does it cycle round each dir in there and look at the metadata.rb ?
[2013-10-28 20:16:54 -0400] andrewdeandrade: and how do I set the chef environment from within a vagrantfile?
[2013-10-28 20:17:38 -0400] Cope: for  the avoidance of doubt, ichilton is my friend, and is very clever; I get to abuse him for fun.  Just in case anyone was wondering what happened to the friendly Cope.
[2013-10-28 20:18:15 -0400] ichilton: ok, I renamed chef_chruby_install to chruby_install and it seems happy now - complaining about authentication (which will because i've not given it any)
[2013-10-28 20:18:24 -0400] stkowski: Yay... more nit-picking documentation bugs
[2013-10-28 20:18:31 -0400] ichilton: Thankfully I took it as a joke Copey
[2013-10-28 20:18:37 -0400] ichilton: Cope: Your birthday??
[2013-10-28 20:18:52 -0400] tomduffield: andrewdeadrade chef.environment
[2013-10-28 20:19:00 -0400] tomduffield: https://github.com/mitchellh/vagrant/blob/master/plugins/provisioners/chef/config/chef_client.rb
[2013-10-28 20:20:40 -0400] ichilton: jtimberman: should it cope with a different directory name (chef_chruby_install vs chruby_install in the metadata.rb) - it doesn't seem to...worked when I renamed the dir
[2013-10-28 20:21:27 -0400] stkowski: Hahah... James Scott just closed a bug I posted within 4 minutes of me posting it. That has to be a record.
[2013-10-28 20:26:57 -0400] dgarstang: Can someone tell me what's up with this? http://pastebin.com/Q9mhR9Yb I'm trying to do simple recipe based roles.
[2013-10-28 20:27:35 -0400] dgarstang: It should be simple. Node includes recipe[rabbit]. That includes base and lvm. Well, when I run chef it says 'Cookbook bc-rabbitmq not found.'.
[2013-10-28 20:28:33 -0400] dgarstang: right?
[2013-10-28 20:29:06 -0400] opstrong: dgarstang: either bc-rabbitmq doesn't exist on the Chef server, or it's not listed as a dependency in the bc-role cookbook
[2013-10-28 20:30:38 -0400] dgarstang: opstrong: and you know, putting bc-rabbitmq in the metadata.rb of bc-role does make it work, but that seems wrong to me. Bc-role doesn't need rabbitmq to function, so why should it be dependancy?
[2013-10-28 20:31:09 -0400] Cope: ichilton: my mummy :)
[2013-10-28 20:31:40 -0400] opstrong: dgarstang: if you're including a recipe from cookbook A within a recipe in cookbook B, cookbook B most certainly depends on cookbook A
[2013-10-28 20:31:51 -0400] ichilton: Cope: ah, cool - enjoy!
[2013-10-28 20:32:13 -0400] opstrong: dgarstang: sounds like poor cookbook design to me
[2013-10-28 20:33:02 -0400] dgarstang: opstrong: i'm just following the recommended guidelines.
[2013-10-28 20:33:14 -0400] dgarstang: opstrong: or, trying to
[2013-10-28 20:34:37 -0400] kl4m: dgarstang: if the bc-rabbitmq cookbook is not a "depends" it will not be pulled to the local machine. That's what depends does
[2013-10-28 20:34:53 -0400] kl4m: you can't refer to it if it's not downloaded
[2013-10-28 20:36:20 -0400] dgarstang: kl4m: yes, but do you see the conceptual problem with that? bc-role doesn't need bc-rabbitmq to function. It's only a dependncy in as far as satisfying the requirements of the rabbit role, not the cookbook as a whole.
[2013-10-28 20:37:13 -0400] troyready: dgarstang, That not what depends in the context of metadata.rb means
[2013-10-28 20:37:22 -0400] tomduffield: dgarstang: this is a symptom of you using the roles cookbook pattern
[2013-10-28 20:37:39 -0400] ichilton: eh?
[2013-10-28 20:37:40 -0400] ichilton: ERROR: Error uploading cookbook chruby_install to the Opscode Cookbook Site: undefined method `strip' for nil:NilClass. Set log level to debug (-l debug) for more information.
[2013-10-28 20:37:45 -0400] dgarstang: tomduffield: I don't believe we are.
[2013-10-28 20:37:54 -0400] ichilton: knife doen't seem to have a -l option ?
[2013-10-28 20:38:04 -0400] dgarstang: troyready: Apparently.
[2013-10-28 20:38:07 -0400] tomduffield: dgarstang: from what you described, I think so. what is the function of the bc-role cookbook?
[2013-10-28 20:38:36 -0400] dgarstang: tomduffield: to group together runlists into roles, rather than using real roles/ or putting all cookbooks explicitly into node run list
[2013-10-28 20:39:00 -0400] tomduffield: dgarstang: right, that is the role cookbook pattern
[2013-10-28 20:39:14 -0400] dgarstang: tomduffield: i thought that involved using roles...
[2013-10-28 20:39:23 -0400] tomduffield: dgarstang: nope
[2013-10-28 20:39:54 -0400] tomduffield: you are treating each recipe in a cookbook as a role containing runlist information
[2013-10-28 20:40:02 -0400] tomduffield: while it can do this, that is not what they were intended to do
[2013-10-28 20:40:02 -0400] dgarstang: tomduffield: what's the right way?
[2013-10-28 20:40:08 -0400] kl4m: dgarstang: if bc-rabbitmq is not needed, "include_recipe bc-rabbitmq" should not run
[2013-10-28 20:40:30 -0400] ichilton: Cope / jtimberman: Any ideas? - http://pastebin.com/2xVnzqWC
[2013-10-28 20:40:31 -0400] kl4m: maybe it can be wrapped in a condition
[2013-10-28 20:40:56 -0400] ichilton: Cope / jtimberman: Upgraded from 11.4.4 to 11.6.2 and still does it. knife doesn't seem to have a -l option?
[2013-10-28 20:41:13 -0400] jaimef: command "echo \"create user 'repl'@'%' identified by 'd'; grant replication slave on . to 'repl'@'%'; flush privileges;\"|mysql -u root -p#{node["default"]["percona"]["root_password"]}" # is this invalid? specifically the double quotes used in the node var?
[2013-10-28 20:41:16 -0400] tomduffield: dgarstang: there is no "right" way per say. you can use Chef Roles or you can continue with a cookbook where each recipe is a role, you'll just need to either put a depends statement in the metadata or find a way around it
[2013-10-28 20:42:07 -0400] dgarstang: tomduffield: i'll just have to ignore the fact that rabbit is not really a requirement for the base role
[2013-10-28 20:42:35 -0400] kl4m: It's not a logical requirement, but chef-client still needs to download the cookbook
[2013-10-28 20:43:00 -0400] dgarstang: so the cost of having rabbitmq_server inside bc-role is that the rabbitmq_server deps will now have  to be shipped to clients using bc-role::*
[2013-10-28 20:43:18 -0400] troyready: Yeah
[2013-10-28 20:43:22 -0400] tomduffield: dgarstang: yeah
[2013-10-28 20:43:47 -0400] troyready: Start calculating those extra kilobytes in your gce/aws costs :)
[2013-10-28 20:44:03 -0400] dgarstang: or, we explictly list each cookbook in the node def. Seems like lesser of two weevils
[2013-10-28 20:44:28 -0400] dgarstang: troyready: and vagrant test time * several times per day
[2013-10-28 20:45:27 -0400] tomduffield: dgarstang: you could also use Chef Roles
[2013-10-28 20:46:01 -0400] dgarstang: tomduffield: Everyone says that's bad juju.
[2013-10-28 20:46:19 -0400] troyready: No, everyone doesn't say that
[2013-10-28 20:46:23 -0400] tomduffield: dgarstang: not really
[2013-10-28 20:46:39 -0400] tomduffield: dgarstang: it just doesn't fit some peoples workflow
[2013-10-28 20:46:43 -0400] troyready: The people that strongly advocate the role-based cookbooks say that, naturally
[2013-10-28 20:47:15 -0400] aslan: hey guys, what is the recommended way of installing chef-client if you want to daemonize it using runsv/runit?
[2013-10-28 20:47:32 -0400] dgarstang: grrr
[2013-10-28 20:47:46 -0400] tomduffield: aslan: check out the chef-client cookbook
[2013-10-28 20:48:03 -0400] tomduffield: aslan: http://community.opscode.com/cookbooks/chef-client
[2013-10-28 20:48:07 -0400] aslan: i used to install chef gem and then used the bootstrap method to install it with runsv and everything
[2013-10-28 20:48:10 -0400] dgarstang: Well, it's good to know I'm not totally crazy and this issue is due to a, err. design 'overlook' :)
[2013-10-28 20:48:42 -0400] troyready: I disagree. Chef is working as intended
[2013-10-28 20:49:08 -0400] troyready: It's original design was not to move roles down to the cookbook level, so listing dependencies in the metadata makes sense
[2013-10-28 20:49:09 -0400] aslan: tomduffield: thanks. is the this the omni something method?
[2013-10-28 20:49:20 -0400] tomduffield: dgarstang: what you'll quickly realize is that Ruby is remarkably flexible. and because of that, Chef is flexible
[2013-10-28 20:49:56 -0400] tomduffield: dgarstang: there are a lot of ways to do things. There will usually be an Opscode documented way and then there will be alternatives that the community has come up with
[2013-10-28 20:50:42 -0400] tomduffield: aslan: not really. this cookbook runs after you've bootstrapped Chef to do misc things like setup service/cron and cleanup your validation pem
[2013-10-28 20:51:18 -0400] aslan: tomduffield: awesome is this file http://s3.amazonaws.com/chef-solo/bootstrap-latest.tar.gz uptodate?
[2013-10-28 20:51:30 -0400] tomduffield: dgarstang: one way isn't inherently right and which way is better is open to debate. Just experiment until you find the way that works for you
[2013-10-28 20:52:17 -0400] tomduffield: um, not sure. maybe i'm misunderstanding your intentions. you are using `knife bootstrap` to bootstrap new nodes, correct?
[2013-10-28 20:52:30 -0400] tomduffield: aslan: ^^^
[2013-10-28 20:53:28 -0400] ichilton: jtimberman / Cope: Seems it's a dodgy error and it's -V -V
[2013-10-28 20:55:09 -0400] ichilton: hmm, this is odd
[2013-10-28 20:55:26 -0400] ichilton: anyone around who knows about sharing cookbooks to the community site?
[2013-10-28 20:55:40 -0400] Joel: coderanger: wouldn't valid ssh keys avoid the whole mess, or do I still need a wrapper/entry in known hosts?
[2013-10-28 20:56:34 -0400] aslan: tomduffield: no i am using chef solo and i use the cookbooks in the bootstrap cookbook to set the daemon
[2013-10-28 20:56:44 -0400] tomduffield: oh, gotcha
[2013-10-28 20:56:54 -0400] tomduffield: then chef-client wouldn't really help you
[2013-10-28 20:57:11 -0400] aslan: tomduffield: i dont mind trying something new :)
[2013-10-28 20:57:32 -0400] aslan: i am just not big fan of that omni thing method
[2013-10-28 20:58:06 -0400] tomduffield: aslan: may I ask why?
[2013-10-28 20:58:11 -0400] tomduffield: (just curious)
[2013-10-28 20:58:12 -0400] ichilton: Yay - http://community.opscode.com/cookbooks/chruby_install
[2013-10-28 20:58:33 -0400] Cope: \o/
[2013-10-28 20:58:54 -0400] ichilton: Process for getting it there is right buggy though!
[2013-10-28 20:59:44 -0400] aslan: tomduffield: when i did the bootsrap method everything was visible to me. i could see what i am installing and how things are working, with the omni method i just dont know what is going on. its hard to debug when things go wrong, basically i dont like when there are too many unknowns and most of the work is done under the hood,
[2013-10-28 21:02:45 -0400] tomduffield: aslan: all the omnibus installer does is find the right package for your system, download it and install it really. But if you are going to use knife bootstrap that is the out of the box behavior.
[2013-10-28 21:03:52 -0400] aslan: tomduffield: for instance i noticed omnibus has its own version of ruby that was different from system ruby
[2013-10-28 21:04:29 -0400] tomduffield: aslan: right, that is done to limit issues from Ruby.
[2013-10-28 21:04:32 -0400] Cope: aslan: most distros don't even have a system ruby
[2013-10-28 21:04:40 -0400] ggolin_: true
[2013-10-28 21:04:44 -0400] Cope: aslan: or if they do it is old or peculiar
[2013-10-28 21:04:54 -0400] ggolin_: if they do, its 1.8.4 :P
[2013-10-28 21:04:55 -0400] tomduffield: aslan: and typically full of unhappiness
[2013-10-28 21:05:15 -0400] Cope: eg, just today I was bitten by assuming distro ruby 2.0 in fedora would be sane
[2013-10-28 21:05:26 -0400] tomduffield: its meant to give you a common working environment across platforms
[2013-10-28 21:05:33 -0400] tomduffield: and by you, I mean Chef
[2013-10-28 21:05:44 -0400] tomduffield: so that your code works the same across all your machines
[2013-10-28 21:05:56 -0400] Cope: but had horrible json issues that vanished as soon as I went back to my standard centos + ruby-install/chruby stack
[2013-10-28 21:06:01 -0400] tomduffield: and isn't struck with peculiarities of one instance of Ruby
[2013-10-28 21:06:44 -0400] aslan: of course. i am not arguing. just prefer when things are more visible. :). That said i might give it another shot sometime in the future
[2013-10-28 21:06:57 -0400] Cope: aslan: start with omnibus. period.
[2013-10-28 21:07:18 -0400] gchristensen: mattray: it seems the redirect from the ip address to the hostname (in the pxe_dust cookbook) causes failures from not handling the redirect well... just  FYI.
[2013-10-28 21:07:19 -0400] Cope: when you outgrow it, you'll be ready to use your own ruby, and bundler etc... and you'll know you need it.
[2013-10-28 21:07:26 -0400] tomduffield: aslan: I would encourage it. there are a lot of features that chef-client gives you that make the minor handwaving that omnibus does worth it
[2013-10-28 21:07:39 -0400] aslan: Cope: its like teaching an old dog new tricks. lol i was with chef when they were at version 0.6. its been a long time now
[2013-10-28 21:08:25 -0400] Cope: keep the number of variables to a minimum; at least with a vendored ruby, everyone knows exactly what is happening, where and how.
[2013-10-28 21:08:31 -0400] Cope: makes troubleshooting much simpler
[2013-10-28 21:08:57 -0400] gchristensen: gosh, yeah, at this point I use omnibus to deploy all my ruby applications - ruby is too much of a PITA to get out the door
[2013-10-28 21:08:59 -0400] Cope: i hack on all sorts of peripheral tools, so i almost never use omnibus ruby any more
[2013-10-28 21:09:20 -0400] Cope: but for general chef use, omnibus all the wway
[2013-10-28 21:09:38 -0400] gchristensen: for local dev definitely, but when I'm packaging it for deployment
[2013-10-28 21:09:50 -0400] aslan: Cope: what kind stuff do you hack?
[2013-10-28 21:10:47 -0400] Cope: well, i wrote cucumber-chef (but don't use it any more), leibniz, hacking on chefspec and test-kitchen and plugins; of courae knife plugins; and chef itself.
[2013-10-28 21:10:56 -0400] aslan: the thing is we are a ruby shop. when i make a new AMI,(amazon image) one of the first things i do is to clean up the system and make sure a proper version of ruby is installed.
[2013-10-28 21:12:10 -0400] tomduffield: aslan: with chef-client and omnibus, you can have chef do that for you ;)
[2013-10-28 21:12:30 -0400] Cope: aslan: you make an AMI?
[2013-10-28 21:14:14 -0400] aslan: Cope: yes, once everything is ready, ruby and some other basic changes are done to the system i install chef-client and modify the client.rb to read my userdata then all of that is backed into an ami. I use that to ami for all of my servers
[2013-10-28 21:14:40 -0400] tomduffield: aslan: thats what I used to do
[2013-10-28 21:15:04 -0400] aslan: tomduffield: i need to learn more about omnibus before i start doing that
[2013-10-28 21:16:30 -0400] aslan: tomduffield: in my case i need to do it because spinup time is important for me. for instance when there is a scale up i can't wait for chef to install nodejs for me. the primary role of chef for me is to install a fresh copy of the code and start the services
[2013-10-28 21:17:52 -0400] tomduffield: aslan: in your case then, the chef-client cookbook will do what you are looking for
[2013-10-28 21:18:09 -0400] tomduffield: as for installing chef on your ami-to-be, you can just use gem install
[2013-10-28 21:18:41 -0400] aslan: tomduffield: all i need is install chef gem and setup the runsv/runit tool
[2013-10-28 21:18:45 -0400] aslan: thats all i need
[2013-10-28 21:19:27 -0400] tomduffield: you would need to install the chef gem separately. to get it working with runsv/runit there is a chef-client cookbook you can use but there is no installation procedure that will automatically set that up
[2013-10-28 21:20:26 -0400] aslan: tomduffield: yeah. i know. bootstrap with chef solo used to install that nicely
[2013-10-28 21:21:12 -0400] aslan: i was basically trying to find if there is a similar method
[2013-10-28 21:21:33 -0400] tomduffield: let me see if I can find out if that bootstrap link is up to date
[2013-10-28 21:21:41 -0400] aslan: tomduffield: thanks :)
[2013-10-28 21:25:01 -0400] tomduffield: aslan: preliminary results show the last time the boostrap file was updated was back in Feb
[2013-10-28 21:26:02 -0400] aslan: tomduffield: that should be good enough for me. i will give it a try
[2013-10-28 21:26:17 -0400] aslan: thanks again
[2013-10-28 21:29:56 -0400] tomduffield: you're welcome aslan
[2013-10-28 21:33:41 -0400] azret: is it possible to bootstrap a node sitting on a private network?
[2013-10-28 21:35:34 -0400] tomduffield: azret: as long as your workstation has access to the node and the node has access to the internet, you can use `knife bootstrap`
[2013-10-28 21:36:08 -0400] azret: i keep getting Errno::EADDRNOTAVAIL: Can't assign requested address - connect(2), which I can't understand, I just tested it with Irb, and I was able to open a socket to port 22
[2013-10-28 21:36:55 -0400] tomduffield: do you have any proxies or anything?
[2013-10-28 21:37:11 -0400] ichilton: There we go - shared my first 5 cookbooks :)  - http://community.opscode.com/users/ichilton?user_tab_string=cookbooks
[2013-10-28 21:37:19 -0400] azret: i shouldn't
[2013-10-28 21:37:27 -0400] azret: its direct connection to the server
[2013-10-28 21:37:55 -0400] tomduffield: can I get a gist of the full command + error message?
[2013-10-28 21:39:05 -0400] azret: http://pastebin.com/nHAsYLky
[2013-10-28 21:41:09 -0400] GreatSUN: hey guys
[2013-10-28 21:41:41 -0400] GreatSUN: if I am running chef solo
[2013-10-28 21:42:26 -0400] GreatSUN: and I want to edit/change the tags setup with key => value which are loaded by json file
[2013-10-28 21:42:42 -0400] GreatSUN: when the chef-solo is running
[2013-10-28 21:43:19 -0400] GreatSUN: is that possible?
[2013-10-28 21:45:39 -0400] tomduffield: azret: what does your knife.rb file look like? any gateways or specific ssh ports set up?
[2013-10-28 21:46:25 -0400] tomduffield: GreatSUN: does this help? http://docs.opscode.com/dsl_recipe_method_tag.html
[2013-10-28 21:47:04 -0400] azret: nothing at all, tomduffield the only additional items that were configured were the editor and the encrypted_data_bag_secret
[2013-10-28 21:48:05 -0400] tomduffield: azret: have you run into this type of failure before when trying to bootstrap nodes in the network?
[2013-10-28 21:48:21 -0400] azret: this is the first time I'm trying
[2013-10-28 21:49:08 -0400] azret: but I'm getting this same error on real addresses
[2013-10-28 21:49:13 -0400] azret: which makes me believe i might have another issue here
[2013-10-28 21:49:53 -0400] tomduffield: yeah...
[2013-10-28 21:51:46 -0400] azret: might be the mavericks upgrade
[2013-10-28 21:51:55 -0400] azret: but in retrospect i was able to upload my cookbooks today
[2013-10-28 21:52:25 -0400] tomduffield: is that server lxc or vagrant?
[2013-10-28 21:52:30 -0400] tomduffield: or something else?
[2013-10-28 21:52:54 -0400] azret: osx
[2013-10-28 21:53:02 -0400] azret: updated to 10.9
[2013-10-28 21:53:11 -0400] azret: but knife had no issues uploading cookbooks to opscode
[2013-10-28 21:53:14 -0400] azret: so the binary wasn't broken
[2013-10-28 21:55:16 -0400] tomduffield: are you trying to bootstrap yourself?
[2013-10-28 22:06:39 -0400] holms: hi maybe somebody can explain me java cookbook requires "aws" and "windows" cookbooks? and is there's any way to install those depedendencies automatically ?
[2013-10-28 22:07:08 -0400] holms: every launch i've got crash with stacktrace, and I've already downloaded 20 cookbooks manually...
[2013-10-28 22:07:11 -0400] holms: this is annoying
[2013-10-28 22:07:17 -0400] tomduffield: holms: berkshelf.com
[2013-10-28 22:07:22 -0400] spox: holms: librarian and berkshelf
[2013-10-28 22:07:25 -0400] spox: both do dep resolution
[2013-10-28 22:08:05 -0400] holms: thank you so much
[2013-10-28 22:08:39 -0400] azret: tomduffield, nope, I am trying to bootstrap a node on my network
[2013-10-28 22:09:21 -0400] coderanger: holms: Berkshelf ftw
[2013-10-28 22:09:25 -0400] coderanger: never leave home without it
[2013-10-28 22:09:49 -0400] holms: it's still more complicated then it should be
[2013-10-28 22:09:54 -0400] azret: it seems only when i specify the password flag does it whine
[2013-10-28 22:10:18 -0400] Cope: holms: erm... how so? this is package management for infrastructure code.  They have dependencies, and nested dependencies.
[2013-10-28 22:10:19 -0400] azret: yea it was the password flag, its bootstrapping now
[2013-10-28 22:10:42 -0400] holms: Cope: why i need something together with a chef?
[2013-10-28 22:10:54 -0400] holms: why it can't just handle deps automatigally
[2013-10-28 22:11:09 -0400] coderanger: holms: Thats like saying why do you need Chef, can't Ruby just do it all
[2013-10-28 22:11:17 -0400] holms: i've been working with puppet once, all i had to do is "puppet apply manifest.pp"
[2013-10-28 22:11:44 -0400] Cope: holms: right.. fair question; the answer is that Chef presents a powerful framework with a high degree of flexibility.
[2013-10-28 22:11:54 -0400] holms: hmz
[2013-10-28 22:11:59 -0400] coderanger: holms: The built in knife cookbook site install will also follow dependencies, but berkshelf is so far beyond it that its not even worth learning
[2013-10-28 22:12:15 -0400] Cope: community tools spring up, of which tehre are a few; I recommend berkshelf.
[2013-10-28 22:12:28 -0400] holms: it's probably even too high degree.. all this instead of 'puppet apply manifest.pp'? https://gist.github.com/holms/7205064
[2013-10-28 22:12:47 -0400] holms: k
[2013-10-28 22:12:47 -0400] Cope: holms: you can do the same, for a simple recipe
[2013-10-28 22:12:49 -0400] coderanger: holms: As to why the cookbooks are listed as deps, thats another thing that needs improvement, chef doesn't support optional dependencies right now, and deps are used for topographical ordering during load
[2013-10-28 22:13:08 -0400] coderanger: So a lot of the Opscode cookbooks which support a wide variety of platforms have a lot of deps
[2013-10-28 22:13:13 -0400] holms: maybe I should start from beginning
[2013-10-28 22:13:14 -0400] Cope: holms: but in puppet you also must solve dependencies for complex manifests
[2013-10-28 22:13:38 -0400] holms: it's any guide or turo which you started with..? where I could just take specific cookbook and install it with less fuss, with chef-solo
[2013-10-28 22:13:46 -0400] coderanger: holms: Check out learnchef.com
[2013-10-28 22:13:57 -0400] coderanger: its not perfect, but its something at least
[2013-10-28 22:14:07 -0400] holms: seems to be 2 lessons avialable?
[2013-10-28 22:14:39 -0400] coderanger: holms: Thats for the webinars
[2013-10-28 22:14:45 -0400] coderanger: There is also just some tutorial stuff in there
[2013-10-28 22:15:00 -0400] holms: ok will try sorry for bothering
[2013-10-28 22:15:08 -0400] coderanger: holms: https://learnchef.opscode.com/starter-use-cases/ntp/
[2013-10-28 22:15:15 -0400] ckwalsh: Couple simple questions: when I knife bootstrap a host, does it automatically configure chef-client to run occasionally, or do I have to add a recipe for it to do that? Secondly, where does it load the run list for the occasional runs?
[2013-10-28 22:15:30 -0400] coderanger: ckwalsh: No, you can use the chef-client cookbook for that
[2013-10-28 22:15:40 -0400] coderanger: ckwalsh: The run list comes from the chef server
[2013-10-28 22:15:50 -0400] Cope: holms: definitely not a bother :)
[2013-10-28 22:15:53 -0400] holms: coderanger: that one doesn't explain how to use somebody's cookbook:)
[2013-10-28 22:16:06 -0400] coderanger: holms: Indeed, thats currently a bit of a learning gap
[2013-10-28 22:16:11 -0400] coderanger: :-(
[2013-10-28 22:16:32 -0400] coderanger: Transitioning from basic chef user to intermediate, and then from intermediate to advanced are both massive step functions
[2013-10-28 22:16:36 -0400] holms: i mean for me for now it's a real suicide, although i'm really trying hard ))
[2013-10-28 22:16:48 -0400] Cope: holms: what problem are you trying to solve right now?
[2013-10-28 22:16:50 -0400] ckwalsh: Thanks coderanger
[2013-10-28 22:17:14 -0400] coderanger: ckwalsh: check the docs for the cookbook, it support a million and a half ways of periodic runs
[2013-10-28 22:17:16 -0400] holms: Cope: got a vm. got a cookbook called "logstash". i just want to execute that cookbook with chef-solo
[2013-10-28 22:17:32 -0400] coderanger: ckwalsh: If you just don't care, the default is runit every 30m I think, which is fine for most cases
[2013-10-28 22:18:14 -0400] Cope: holms: ok, so I've not used that exact cookbook, but most cookbooks have recipes to do various things.
[2013-10-28 22:18:28 -0400] Cope: you can usually start by reading the readme - it will tell you what they do
[2013-10-28 22:18:29 -0400] ckwalsh: I just want to make sure they stay in sync, I'm not super picky about how
[2013-10-28 22:18:30 -0400] ckwalsh: Thanks
[2013-10-28 22:19:03 -0400] Cope: holms: then you can use berkshelf to solve the dependencies for you; some cookbooks are fitted to use berkshelf already
[2013-10-28 22:19:27 -0400] coderanger: holms: Okay, to tl;dr tutorial
[2013-10-28 22:19:34 -0400] coderanger: holms: gem install berkshelf
[2013-10-28 22:19:45 -0400] Cope: once you habe all the cookbooks, you need to ship them to the server where you want to run them, and run chef-solo
[2013-10-28 22:19:49 -0400] coderanger: holms: echo "site :opscode\nmetadata" > Berksfile
[2013-10-28 22:19:56 -0400] coderanger: holms: berks export solo
[2013-10-28 22:20:24 -0400] coderanger: holms: Those three steps should give you a folder solo/ with all the cookbooks you need )
[2013-10-28 22:20:42 -0400] holms: ->> Cope: so i've got node.json in my chef-repo dir, which has "run_list" where I specified "java" "redis" and "logstash". trying to launch it with chef-solo -c solo.rb -j node.json, i've got to check stacktrace for missing deps.
[2013-10-28 22:20:42 -0400] Cope: so... chef-solo needs: 1) some json that describes your node
[2013-10-28 22:20:47 -0400] holms: now reading coderanger lines :D
[2013-10-28 22:20:48 -0400] coderanger: I think thats right anyway
[2013-10-28 22:20:52 -0400] coderanger: (working from memory)
[2013-10-28 22:21:15 -0400] coderanger: Yeah, I'm wrong
[2013-10-28 22:21:22 -0400] coderanger:  that last command should be berks install -p solo
[2013-10-28 22:21:28 -0400] Cope: holms: so depending how the logstash cookbook is written, you ideally want to just have logstash in your run list
[2013-10-28 22:21:38 -0400] Cope: assuming logstash has accurately defined its dependencies
[2013-10-28 22:21:57 -0400] Cope: that keeps it nice and simple
[2013-10-28 22:22:08 -0400] holms: okey
[2013-10-28 22:22:45 -0400] coderanger: yep, if the deps are correct, berkshelf will find all of them and unpack them for oyu
[2013-10-28 22:23:24 -0400] holms: ive installed chef from opscode shell script, so still have no ruby in here, one sec :)
[2013-10-28 22:23:42 -0400] coderanger: holms: /opt/chef/embedded/bin/gem install berkshelf
[2013-10-28 22:24:32 -0400] holms: oh that's how it
[2013-10-28 22:24:43 -0400] Cope: wow this is still silly tricky :(
[2013-10-28 22:24:51 -0400] Cope: I'm just so used to it, it seems simple to me.
[2013-10-28 22:25:00 -0400] coderanger: That will put berks in /opt/chef/embedded/bin too though, so make sure you alias it or something
[2013-10-28 22:25:02 -0400] coderanger: or type the full path
[2013-10-28 22:26:58 -0400] azret: how do you deal with version constraint messages? All of this worked on vagrant/berkshelf but now it won;t work with hosted chef
[2013-10-28 22:28:36 -0400] tomduffield: azret: can you be more specific, what kind of version constraint methods? are you getting this when using `knife cookbook upload`?
[2013-10-28 22:29:23 -0400] coderanger: azret: Check that your deps have a space between the operator and the number
[2013-10-28 22:29:32 -0400] azret: i have all that
[2013-10-28 22:29:33 -0400] coderanger: so '~> 1.0' instead of '~>1.0'
[2013-10-28 22:29:59 -0400] azret: yea it would have failed on a vagrant provision if that was incorrect, I'm checking my actual cookbooks for other dependences
[2013-10-28 22:30:12 -0400] azret: I'm seeing that yum might be lower than nginx depends on
[2013-10-28 22:31:18 -0400] holms: coderanger: produced error cause no make/gcc found. installing development tools
[2013-10-28 22:31:35 -0400] coderanger: holms: lolsoftware
[2013-10-28 22:32:18 -0400] Cope: holms: right, so really the logstash cookbook should include build_essential, or somesuch
[2013-10-28 22:32:45 -0400] holms: Cope: /opt/chef/embedded/bin/gem install berkshelf <-- i mean
[2013-10-28 22:32:54 -0400] coderanger: Cope: Nah
[2013-10-28 22:33:01 -0400] Cope: holms: oh right
[2013-10-28 22:33:04 -0400] coderanger: its to build the actor framework berkshelf uses
[2013-10-28 22:33:17 -0400] Cope: yeah i misread the context
[2013-10-28 22:33:18 -0400] coderanger: Jamie likes actor patterns :P
[2013-10-28 22:33:22 -0400] azret: yea i was right, it expected a higher yum version then what nginx was looking for
[2013-10-28 22:33:30 -0400] gansbrest: hi. Is there a way to define service without init scrips
[2013-10-28 22:33:42 -0400] coderanger: gansbrest: In general? Sure
[2013-10-28 22:33:43 -0400] gansbrest: I provided stop, start, status commands
[2013-10-28 22:33:48 -0400] coderanger: gansbrest: runit, monit, etc
[2013-10-28 22:33:57 -0400] gansbrest: but it still complains about  unable to locate the init.d script
[2013-10-28 22:34:03 -0400] Cope: holms: yeah, you'll need development tools; and ... I can't recall if it uses nokogiri, but possibly libxml2 and libxslt
[2013-10-28 22:34:03 -0400] coderanger: ahh, you mean with the service resource
[2013-10-28 22:34:09 -0400] gansbrest: yes
[2013-10-28 22:34:11 -0400] gansbrest: sorry
[2013-10-28 22:34:33 -0400] Cope: holms: i tend to have that shit on my machine anyway; and i have a workstation cookbook that sets it all up anyway
[2013-10-28 22:34:35 -0400] gansbrest: here is my service definition https://gist.github.com/gansbrest/7206018
[2013-10-28 22:35:27 -0400] gansbrest: what's the point of those commands if you still need a script.. ?
[2013-10-28 22:36:38 -0400] Cope: gansbrest: erm, well, if you use shit software with no native process/service management capabilites, what do you expect?
[2013-10-28 22:36:49 -0400] coderanger: gansbrest: Whats the specific error message?
[2013-10-28 22:36:59 -0400] coderanger: gansbrest: Trying to trace the code now
[2013-10-28 22:37:08 -0400] gansbrest: service[opscenter-agent]: unable to locate the init.d script!
[2013-10-28 22:37:31 -0400] Cope: gansbrest: appreciate you may not have a choice, but it's a common issue with prop. software - shipped with crappy old init scripts in korn shell or something
[2013-10-28 22:37:33 -0400] gansbrest: Cope: agreed on shitty software
[2013-10-28 22:37:53 -0400] Cope: fwiw i tend to find runit is a useful panacaea for this
[2013-10-28 22:38:02 -0400] coderanger: gansbrest: What version of chef?
[2013-10-28 22:38:20 -0400] gansbrest: yes, I tried to run it with runit service - but it endlessly spawns subprocesses
[2013-10-28 22:38:24 -0400] minotaur: _hi all, I'm having some trouble pushing out some ssh cookbooks. I wrote a wrapper around the opens opscode CB to add attributes but for some reason my nodes are getting attributes I didn't set in my wrapper CB.
[2013-10-28 22:38:26 -0400] gansbrest: going crazy with runit
[2013-10-28 22:38:35 -0400] coderanger: Cope: Runit is also terrible software and if you tell me "well it just works" I will hold you down and beat you with the non-existent documentation ;-)
[2013-10-28 22:38:54 -0400] coderanger: gansbrest: runit requires the program not daemonize itself
[2013-10-28 22:39:03 -0400] Cope: coderanger: use daemontools then  :P
[2013-10-28 22:39:27 -0400] coderanger: Cope: Remind me to buy you a drink in Seattle and make sure its something really bad ;-)
[2013-10-28 22:39:53 -0400] gansbrest: Chef: 11.4.4
[2013-10-28 22:40:09 -0400] minotaur: Anyone notice this weirdness when writing wrapper cookbooks?
[2013-10-28 22:40:37 -0400] coderanger: gansbrest: Okya, looking
[2013-10-28 22:40:51 -0400] gansbrest: coderanger: thanks a bunch
[2013-10-28 22:42:31 -0400] coderanger: gansbrest: Ahh, its part of the redhat-specific provider
[2013-10-28 22:42:36 -0400] gzc: what all makes runit terrible again?
[2013-10-28 22:42:36 -0400] coderanger: gansbrest: Add this to the resource
[2013-10-28 22:42:44 -0400] coderanger: provider Chef::Provider::Service::Simple
[2013-10-28 22:42:47 -0400] gansbrest: I like this line from service command doc: "There is no reason to use the execute resource to control a service because the service resource exposes the start_command attribute directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner."
[2013-10-28 22:42:57 -0400] coderanger: gzc: No docs, useless error messages, generally graybeard-only tech
[2013-10-28 22:43:33 -0400] gzc: ah, that's fair, I wind up using it just for the (typical but not ubiquitous) ease of quickly setting up a service
[2013-10-28 22:43:33 -0400] Cope: docs are terrible
[2013-10-28 22:43:34 -0400] coderanger: by-graybeards-for-graybeards
[2013-10-28 22:43:40 -0400] doomviking: I resemble that remark
[2013-10-28 22:43:46 -0400] Cope: <
[2013-10-28 22:44:00 -0400] gansbrest: omg, it worked!
[2013-10-28 22:44:01 -0400] gansbrest: )
[2013-10-28 22:44:04 -0400] coderanger: and just over usability is terrible
[2013-10-28 22:44:07 -0400] coderanger: er, overall
[2013-10-28 22:44:13 -0400] gansbrest: is there a way to update that doc?
[2013-10-28 22:44:16 -0400] coderanger: Like why are the magic files named things like control/t
[2013-10-28 22:44:22 -0400] coderanger: instead of actual words
[2013-10-28 22:44:53 -0400] coderanger: jtimberman ^^ talking shit about runit just fyi :)
[2013-10-28 22:44:57 -0400] doomviking: thats a DJBism, isnt it
[2013-10-28 22:45:06 -0400] gansbrest: codranger: you saved the day! thanks a lot - remind me to buy you a beer when I meet you somewhere in NYC
[2013-10-28 22:45:17 -0400] coderanger: gansbrest: You can send a pull request on the opscode-docs project
[2013-10-28 22:45:54 -0400] Cope: well runit is basically a thinly-veiled attempted to re-release djb-ware in a more digestable form
[2013-10-28 22:46:07 -0400] gzc: alright, so what should I be aspiring to use in the future? :)
[2013-10-28 22:46:21 -0400] Cope: depends what your platform is
[2013-10-28 22:46:30 -0400] Cope: systemd is actually well-implemented
[2013-10-28 22:46:33 -0400] coderanger: gzc: supervisor is probably my fav right now but it gets log management super wrong
[2013-10-28 22:46:41 -0400] coderanger: and yeah, systemd if you are on recent linux
[2013-10-28 22:46:45 -0400] Cope: supervisor is nice, for sure
[2013-10-28 22:46:50 -0400] cwj: does the runit documentation at http://smarden.org/runit/ which documents the meaning of magic files like control/t not count as documentation?
[2013-10-28 22:46:51 -0400] doomviking: I rather like runit, but I have the beard.
[2013-10-28 22:46:58 -0400] pmde1: hi chefs, i am looking for some insight into orchestration with chef - i want to be able to provision an 'application' which needs a bunch of nodes - some with database servers, some with application servers, some with load balancers, etc. - but i need to have version dependencies and ordering across the nodes.. e.g. my application, which is deployed on version x of the app server, will require version y of the database..  i hav
[2013-10-28 22:47:07 -0400] cwj: i use both supervisor and runit, and prefer runit
[2013-10-28 22:47:30 -0400] coderanger: cwj: The issue is discoverability, if you leave a new user with runit and say "do stuff" they are going to be seriously unhappy
[2013-10-28 22:47:38 -0400] coderanger: (unless its something trivial)
[2013-10-28 22:47:47 -0400] Cope: alas,i need to go to bed;
[2013-10-28 22:47:48 -0400] coderanger: even basic stuff like "run this service as user X"
[2013-10-28 22:47:56 -0400] gzc: yeah, on further inspection my beard is getting a nice little patch of grey in it, yikes
[2013-10-28 22:48:03 -0400] cwj: yes, you have to read the documentation
[2013-10-28 22:48:04 -0400] coderanger: (something upstart also bungles)
[2013-10-28 22:48:08 -0400] cwj: the assertion that there is no documentation is incorrect
[2013-10-28 22:48:13 -0400] Cope: upstart is a catastrophe
[2013-10-28 22:48:26 -0400] gzc: death to upstart
[2013-10-28 22:48:29 -0400] Cope: cwj: no-one said there's no docs
[2013-10-28 22:48:32 -0400] doomviking: the runit cookbook makes life even easier IMO :)
[2013-10-28 22:48:37 -0400] Cope: it's just badly and incompletely documented
[2013-10-28 22:48:50 -0400] cwj: Cope: coderanger flat out said no docs"
[2013-10-28 22:49:08 -0400] Cope: but for cross-platform usability; when wrapped with the chef cookbook, it's a good option.
[2013-10-28 22:49:13 -0400] Cope: and prolly the best right now.
[2013-10-28 22:49:15 -0400] coderanger: cwj: Oh come on, the runit docs are at best a reference for people that already know how to use
[2013-10-28 22:49:33 -0400] miah: they are for people who already know unix, definitely.
[2013-10-28 22:49:43 -0400] coderanger: cwj: There are man pages and a very almost useless FAQ
[2013-10-28 22:49:47 -0400] cwj: sure, they are for people who know unix
[2013-10-28 22:49:48 -0400] Cope: my view: you need to a) know unix and b) know daemontools
[2013-10-28 22:50:01 -0400] coderanger: Given that page, how do I learn how to run a service as a user
[2013-10-28 22:50:06 -0400] Cope: if you know both, runit is kinda logical
[2013-10-28 22:50:12 -0400] miah: written by, and for people who have already read 'http://www.goodreads.com/book/show/603263.Advanced_Programming_in_the_Unix_R_Environment'
[2013-10-28 22:50:15 -0400] coderanger: am I supposed to just click every page until I find something that mentions users?
[2013-10-28 22:50:17 -0400] gzc: hey, having never used daemontools, I found runit pretty intuitive
[2013-10-28 22:50:22 -0400] gzc: but then again, bearded
[2013-10-28 22:50:32 -0400] miah: i have no beard
[2013-10-28 22:50:39 -0400] gzc: and i must scream
[2013-10-28 22:50:41 -0400] miah: BEARD NOT REQUIRED (tm)
[2013-10-28 22:50:57 -0400] gzc: beards are more a state of mind
[2013-10-28 22:51:06 -0400] coderanger: "chpst - runs a program with a changed process state "
[2013-10-28 22:51:09 -0400] gzc: not just utility facewarmers
[2013-10-28 22:51:12 -0400] coderanger: Thats like the least helpful description ever
[2013-10-28 22:51:29 -0400] miah: if you dont know what a process state is
[2013-10-28 22:51:39 -0400] coderanger: miah: People don't, QED
[2013-10-28 22:51:44 -0400] cwj: im just calling out hyperbole
[2013-10-28 22:51:45 -0400] cwj: there are docs
[2013-10-28 22:51:56 -0400] cwj: youre right, they arent inutuitive
[2013-10-28 22:52:11 -0400] miah: coderanger: dont get me started on what sysadmins don't know. because i'd trash the community so badly.
[2013-10-28 22:52:26 -0400] Cope: I have a background project in mind to document runit nicely
[2013-10-28 22:52:30 -0400] gzc: ``system'' ``administrators''
[2013-10-28 22:52:43 -0400] Cope: doubtful i ever will
[2013-10-28 22:52:50 -0400] coderanger: miah: While I was packing this weekend I found my copy of the oreily "intro to the linux kernel" book
[2013-10-28 22:52:51 -0400] Cope: but the will is there :)
[2013-10-28 22:53:00 -0400] coderanger: proudly labeled as "now updated for 2.4"
[2013-10-28 22:53:14 -0400] miah: i have the most recent version =)
[2013-10-28 22:53:19 -0400] robawt: holy junk, i don't think Cope or coderanger actually sleep
[2013-10-28 22:53:21 -0400] Cope: I remember being very excited building my first 2.4 kernel
[2013-10-28 22:53:24 -0400] miah: but i also have a copy of Lion's
[2013-10-28 22:53:44 -0400] miah: http://www.goodreads.com/book/show/337375.Lions_Commentary_on_Unix
[2013-10-28 22:54:27 -0400] coderanger: Related: Manning just asked me to review some new chef book, they don;t know what hell they are unleashing :)
[2013-10-28 22:54:38 -0400] miah: heh
[2013-10-28 22:54:46 -0400] Cope: coderanger: orly - who is the author?
[2013-10-28 22:54:55 -0400] miah: ya, who who?
[2013-10-28 22:55:09 -0400] coderanger:  I have recently received a book proposal titled "Chef in Action" by Dimitri Aivaliotis
[2013-10-28 22:55:10 -0400] GreatSUN: hey ho coderanger
[2013-10-28 22:55:12 -0400] miah: i'd <3 to read something on par with Eloquent Ruby but about Chef
[2013-10-28 22:55:14 -0400] gzc: oh, is it the updated 'tdd with chef' thing?
[2013-10-28 22:55:21 -0400] miah: and not some piece of shit telling me how to write recipes
[2013-10-28 22:55:26 -0400] gzc: yeah :\
[2013-10-28 22:55:43 -0400] miah: i'm rewriting a resource provider as a ruby gem
[2013-10-28 22:56:04 -0400] coderanger: miah: https://gist.github.com/coderanger/876fd394e166398c0276#file-jenkins-rb-L218-L273 recipe code is totally in there!
[2013-10-28 22:56:18 -0400] miah: chef_gem, so much easier than dealing with metadata.rb's many shortcomings
[2013-10-28 22:56:19 -0400] gzc: nice, svargo's talk about the hostsfile cookbook convinced me to work towards that
[2013-10-28 22:56:40 -0400] GreatSUN: does someone of you guys know of a jenkins plugin which I can use for chef-client and chef-solo ?
[2013-10-28 22:56:49 -0400] Cope: gzc: it's finished! and out!
[2013-10-28 22:57:05 -0400] robawt: GreatSUN: it's linked from the cookbooks page
[2013-10-28 22:57:06 -0400] miah: if only suggests, obsoletes, etc was useful
[2013-10-28 22:57:22 -0400] GreatSUN: robawt: hm?
[2013-10-28 22:57:30 -0400] Cope: gzc: http://shop.oreilly.com/product/0636920030973.do
[2013-10-28 22:57:32 -0400] jtimberman: miah: if only!
[2013-10-28 22:57:43 -0400] Cope: right, night for now; back soonish :))
[2013-10-28 22:57:58 -0400] gzc: nice, might have to actually register my old copy and see about the new one
[2013-10-28 22:58:18 -0400] robawt: GreatSUN: trying to pull up a link now
[2013-10-28 22:58:23 -0400] gzc: i'm at a weird place where we have a pretty decent pipeline set up, but very little in the way of actual automated tests. argh.
[2013-10-28 22:59:28 -0400] GreatSUN: robawt: that would be nice, cause I didn't see/find any link
[2013-10-28 22:59:38 -0400] coderanger: GreatSUN: What kind of plugin do you mean?
[2013-10-28 23:00:05 -0400] robawt: GreatSUN: http://community.opscode.com/cookbooks/kitchen-jenkins is this what you're looking for?  testkitchen + jenkins?
[2013-10-28 23:00:09 -0400] GreatSUN: coderanger: some that issues a buildtest for chef-client, chef-solo or both
[2013-10-28 23:00:34 -0400] coderanger: GreatSUN: Still not sure what you mean, just call kitchen from a jenkins job
[2013-10-28 23:01:41 -0400] GreatSUN: robawt: nope, not the right one
[2013-10-28 23:02:52 -0400] GreatSUN: coderanger: what I want to do is to have one build-job driving both a chef-client execution and a chef-solo execution
[2013-10-28 23:02:59 -0400] GreatSUN: or one of both only
[2013-10-28 23:03:13 -0400] coderanger: Oh, you mean running them across your network
[2013-10-28 23:03:19 -0400] GreatSUN: not to have some virtual machine to be deployed
[2013-10-28 23:03:28 -0400] GreatSUN: neither a driver for that
[2013-10-28 23:03:38 -0400] coderanger: GreatSUN: Personally I would just get out fabric and pychef
[2013-10-28 23:03:40 -0400] GreatSUN: coderanger: also, yes
[2013-10-28 23:04:02 -0400] GreatSUN: coderanger: that plugins for jenkins?
[2013-10-28 23:04:10 -0400] coderanger: No, just command line tools
[2013-10-28 23:04:19 -0400] GreatSUN: ah, ok
[2013-10-28 23:04:35 -0400] coderanger: If you want something more service-y, grab rundeck and have jenkins just poke rundeck via curl
[2013-10-28 23:04:41 -0400] GreatSUN: do you have some url available for copy&paste? else I'll search myself
[2013-10-28 23:05:11 -0400] coderanger: GreatSUN: http://docs.fabfile.org/en/1.8/ and pychef is googleable
[2013-10-28 23:05:23 -0400] coderanger: GreatSUN: Fabric is just a Python-ish version of Capistrano
[2013-10-28 23:05:28 -0400] gzc: yeah, we just have jenkins use knife ssh to reach into nodes with a certain role and kick off a client run
[2013-10-28 23:05:30 -0400] coderanger: if you like Ruby better, then cap does the same thing
[2013-10-28 23:05:34 -0400] coderanger: or yeah, knife ssh works too
[2013-10-28 23:05:38 -0400] coderanger: or cssh
[2013-10-28 23:05:46 -0400] coderanger: or marionette
[2013-10-28 23:05:48 -0400] robawt: pychef?
[2013-10-28 23:05:49 -0400] gzc: i try to stick to command-line tools that we can trivially kick off
[2013-10-28 23:05:50 -0400] coderanger: or any of a million things
[2013-10-28 23:05:51 -0400] robawt: whaaaaa?
[2013-10-28 23:05:57 -0400] gzc: and then just build a dynamic kniferb or whatever
[2013-10-28 23:06:11 -0400] coderanger: robawt: Indeed, what about it?
[2013-10-28 23:06:31 -0400] robawt: coderanger: the name excites me, and the documentation is going to let me actually try it out
[2013-10-28 23:06:40 -0400] robawt: I'm *very* new to Chef and this is awesome coming from Python
[2013-10-28 23:07:07 -0400] coderanger: robawt: Its a pure-python API client for the Chef API
[2013-10-28 23:07:10 -0400] holms: i wish I could be happy like you
[2013-10-28 23:07:17 -0400] GreatSUN: coderanger: hehe, ok, so anyhow I will have to create an own jenkins plugin to automate those things
[2013-10-28 23:07:23 -0400] coderanger: GreatSUN: No?
[2013-10-28 23:07:32 -0400] coderanger: GreatSUN: I think you misunderstand what a jenkins plugin is
[2013-10-28 23:07:39 -0400] coderanger: GreatSUN: Or maybe you mean jenkins job?
[2013-10-28 23:07:50 -0400] GreatSUN: ehrm...
[2013-10-28 23:08:05 -0400] GreatSUN: there are plugins that you can use to configure a job with
[2013-10-28 23:08:16 -0400] GreatSUN: like shell command or such
[2013-10-28 23:08:37 -0400] gzc: it should be pretty trivial, essentially just wrap what you need in a little bash script
[2013-10-28 23:08:38 -0400] coderanger: GreatSUN: Thats a core piece of Jenkins, no plugin needed
[2013-10-28 23:08:57 -0400] coderanger: GreatSUN: Plugins are bits of java code that add new functionality to Jenkins
[2013-10-28 23:09:00 -0400] robawt: gzc++ on a bash script
[2013-10-28 23:09:02 -0400] gzc: use https://github.com/needle-cookbooks/chef-jenkins-job-builder to get ahead of the curve
[2013-10-28 23:09:05 -0400] GreatSUN: what I wanted is kind of a plugin where I can choose to run chef-client and/or chef-solo and also to add cookbooks/recipes to it
[2013-10-28 23:09:21 -0400] gzc: thank cwj for that one :) but right now all our stuff is templatized xml ( " now you have two problems! " )
[2013-10-28 23:09:38 -0400] GreatSUN: coderanger: that's what I thought about
[2013-10-28 23:09:47 -0400] GreatSUN: gzc: I will have a look on it, thanks
[2013-10-28 23:10:28 -0400] gzc: so to briefly summarize how we figure that out, we have data bags that describe pipeline projects (e.g. 'razor') that describe the role that we expect nodes to have - that way when changes get through each phase, jenkins uses knife ssh to find nodes in the right env (dev or whatever) for that role and forces a run
[2013-10-28 23:11:01 -0400] gzc: wrapper cookbooks update node data to reflect the current version and a watch script reports whether or not the run was successful
[2013-10-28 23:11:09 -0400] gzc: at which point our board turns green and we retire for ping pong
[2013-10-28 23:12:18 -0400] gzc: also a tip to make your life easier: any time you need to interact with the chef api, just use ridley and save yourself the days/weeks of pain
[2013-10-28 23:12:51 -0400] coderanger: gzc: Or PyChef ;-)
[2013-10-28 23:13:06 -0400] GreatSUN: gzc: hmmm... when I am running chef-solo, there is no knife search afaik
[2013-10-28 23:13:29 -0400] coderanger: GreatSUN: Protip, don't use chef-solo for Real Things
[2013-10-28 23:13:39 -0400] coderanger: At a minimum use chef-zero (soon via local mode)
[2013-10-28 23:14:06 -0400] gzc: true, you may have to figure out another strategy- e.g. maybe update pipeline project data bag items with fqdns of nodes to ssh to normally/without knife- then you just have to solve the problem of getting keys on there in the first place, but that shouldn't be too bad
[2013-10-28 23:14:06 -0400] GreatSUN: coderanger: again in this case I am not the decision driver :-(
[2013-10-28 23:14:21 -0400] otakup0pe: hey so what are the things to check when a custom knife plugin isn't showing up in --help
[2013-10-28 23:14:25 -0400] gzc: coderanger: local mode? go on
[2013-10-28 23:14:29 -0400] otakup0pe: i've confirmed it is in the right path and has valid ruby syntax. idk what else to check.
[2013-10-28 23:14:46 -0400] jtimberman: Ahem. local mode preview: http://jtimberman.housepub.org/blog/2013/10/10/preview-chef-client-local-mode/
[2013-10-28 23:14:49 -0400] coderanger: gzc: New thing in master, it will internally spawn a chef-zero server linked to the local folder and then run chef-client against it
[2013-10-28 23:14:51 -0400] jtimberman: gzc ^
[2013-10-28 23:15:04 -0400] gzc: beautiful!
[2013-10-28 23:15:09 -0400] jtimberman: i <3 it so much
[2013-10-28 23:15:26 -0400] jtimberman: coderanger: me too!
[2013-10-28 23:15:33 -0400] coderanger: Oy, time to do the things kallistec hates and make include_recipe work in an LWRP
[2013-10-28 23:15:39 -0400] otakup0pe: that's pretty cool. chef-zero is awesome.
[2013-10-28 23:15:50 -0400] coderanger: I think this will require at least three nested run contexts
[2013-10-28 23:15:55 -0400] kallistec: ugh
[2013-10-28 23:15:59 -0400] jtimberman: coderanger: lmao
[2013-10-28 23:16:17 -0400] kallistec: wrap a LWRP in a resource definition
[2013-10-28 23:16:19 -0400] coderanger: kallistec: If it makes you feel better this isn't technically an LWRP, its a library file
[2013-10-28 23:16:23 -0400] GreatSUN: codehey jtimberman :-)
[2013-10-28 23:16:29 -0400] spox: run_context.include_all_the_things
[2013-10-28 23:16:53 -0400] GreatSUN: coderanger: I think I will possibly make use of chef-zero for the testing environment
[2013-10-28 23:16:56 -0400] coderanger: kallistec: Nah, there are silly things being done with provider remapping for Jenkins to match existing behavior
[2013-10-28 23:17:23 -0400] ssd7: coderanger: It's run_contexts all the way down.
[2013-10-28 23:17:30 -0400] coderanger: kallistec: Don't worry, it will be cool when I'm done ;-)
[2013-10-28 23:18:06 -0400] coderanger: kallistec: While you are around, what would you say to supporting lazy in the default argument to set_or_return?
[2013-10-28 23:18:21 -0400] GreatSUN: anyhow... I am thinking about some central attribute store and search functionality which can be used by some library method, so that I can simply search for some node when using chef-solo
[2013-10-28 23:18:31 -0400] coderanger: kallistec: Having issues where I want to make the default based on node attrs, but those don't exist at library load time (or at least not completely)
[2013-10-28 23:19:02 -0400] kallistec: why not just write a method then?
[2013-10-28 23:19:04 -0400] coderanger: GreatSUN: That already exists, look up chef-solo-search
[2013-10-28 23:19:10 -0400] coderanger: kallistec: DSL just looks nicer
[2013-10-28 23:19:18 -0400] coderanger: kallistec: One line instead of three :)
[2013-10-28 23:19:25 -0400] otakup0pe: this is so wierd. i'm trying to add plugins to environment. and i can't see them when i do --help on envrionment. but when i just do --help they show up in a *second* environment section
[2013-10-28 23:19:33 -0400] otakup0pe: pretty sure i didn't spell environment with only unicode.
[2013-10-28 23:19:50 -0400] GreatSUN: coderanger: isn't that databag based stuff?
[2013-10-28 23:20:00 -0400] kallistec: coderanger: define_method(:name) { code }
[2013-10-28 23:20:02 -0400] kallistec: boom
[2013-10-28 23:20:12 -0400] otakup0pe: oh god i spelt the class wrong
[2013-10-28 23:20:22 -0400] kallistec: alias :d :define_method
[2013-10-28 23:20:22 -0400] coderanger: GreatSUN: Yeah, but you can just use JSON in and out as the API :)
[2013-10-28 23:20:37 -0400] coderanger: kallistec: I'm trying to make this less hard to read, not more ;-)
[2013-10-28 23:21:07 -0400] GreatSUN: coderanger: and then save the json stuff to some central database or what?
[2013-10-28 23:21:20 -0400] coderanger: GreatSUN: Yeah, though thats starting to sound dangerously like chef-server ;-)
[2013-10-28 23:21:42 -0400] GreatSUN: coderanger: kinda ;-)
[2013-10-28 23:22:07 -0400] GreatSUN: coderanger: but manually like on demand usable
[2013-10-28 23:22:20 -0400] jtimberman: "And how do we make sure that only certain cookbooks get distributed to the nodes that need them?" "How do we make sure that specific versions are used in those nodes?"
[2013-10-28 23:23:22 -0400] GreatSUN: coderanger: and also that would be secured by some encrypted databag containing user/pw for database and the database then gets project, node and wished data, which is then selectable
[2013-10-28 23:23:30 -0400] GreatSUN: at least that is what came up in my mind
[2013-10-28 23:23:47 -0400] jtimberman: fwiw, encrypted data bags are purely there to protect the data at rest on a chef server.
[2013-10-28 23:23:56 -0400] jtimberman: they really don't buy you a lot wrt solo
[2013-10-28 23:24:20 -0400] GreatSUN: jtimberman: what would you do with chef-solo though?
[2013-10-28 23:27:34 -0400] GreatSUN: jtimberman: I mean to securly save user/pw data when everyone can read the repo-data
[2013-10-28 23:40:37 -0400] sn0wb1rd: Has anybody successfully used the latest version of application (4.1.x) cookbook with the application_php (2.0.x) cookbook?
[2013-10-28 23:44:22 -0400] sn0wb1rd: This is the error I'm seeing BTW: No resource found for php. Tried application_php, application_php_php, php
[2013-10-28 23:59:02 -0400] allaire: anybody know why the only place I can overwrite this attribute is in the node file? https://github.com/opscode-cookbooks/postgresql/blob/master/attributes/default.rb#L31
[2013-10-28 23:59:13 -0400] allaire: the version one, it's the only one that I can't overwrite in my recipe
