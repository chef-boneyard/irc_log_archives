[2013-05-18 00:00:16 -0400] ermajn: coderanger, i do not have example.. I simply want to set/not set something in attributes based on variable value
[2013-05-18 00:00:44 -0400] coderanger: I mean you can use ruby code in a cookbook attrs file easily enough
[2013-05-18 00:00:51 -0400] coderanger: but where does that variable come from?
[2013-05-18 00:01:09 -0400] bluepojo: doing conditionals in attributes generally doesn't work as expected due to merge order... you will never be able to change that conditional via environment or role if you switch on an attribute in an attributes file. Usually logic like that has to go in a recipe.
[2013-05-18 00:01:12 -0400] coderanger: The important point is that attr files are compiled before recipe code is run, so you can't use state that isn't available until part way through the run
[2013-05-18 00:01:56 -0400] coderanger: Yeah, only thing I would recommend doing conditionals on in attr files is ohai data
[2013-05-18 01:40:58 -0400] countdigi: anyone have any good examples or pointers to best pracice to stubbing out search for a test kitchen run - i know of chef-searchef - just curious if thats still the de facto method?
[2013-05-18 02:05:05 -0400] jameson__: anyone use the rabbitmq cookbook?
[2013-05-18 02:05:12 -0400] basic`: has anyone seen Encoding::InvalidByteSequenceError: "\xC3" on US-ASCII
[2013-05-18 02:05:24 -0400] basic`: i'm getting this on 20% of my nodes all of sudden
[2013-05-18 02:05:30 -0400] basic`: if i run chef manually on them, it works fine
[2013-05-18 02:05:35 -0400] basic`: but via cron it is failing
[2013-05-18 02:08:01 -0400] basic`: http://community.opscode.com/chat/chef/2012-11-05 -- i see this but why on earth would it work without error on a manual run?
[2013-05-18 02:11:04 -0400] coderanger: basic`: If I had to guess, something about LOCALE settings for you user being different
[2013-05-18 02:11:33 -0400] coderanger: Specifics would depend on how you are running things though
[2013-05-18 02:11:42 -0400] coderanger: Ruby gets cranky without LC_ALL
[2013-05-18 02:11:48 -0400] basic`: hmm
[2013-05-18 02:12:07 -0400] basic`: i'm just using the chef-client::cron recipe
[2013-05-18 02:12:53 -0400] coderanger: So would depend on what the system environment looks like at bootup :)
[2013-05-18 02:13:03 -0400] coderanger: Easiest solution is to remove the non-ascii code
[2013-05-18 02:13:31 -0400] coderanger: but you could probably throw something like LC_ALL=en_US.utf-8 in the cron command line
[2013-05-18 02:14:02 -0400] basic`: i'll grep, i wonder what it is :)
[2013-05-18 02:16:17 -0400] coderanger: Or just tell Lance to fix the system locale settings/env vars, lord knows what kind of weird tweaks you guys have ;-0
[2013-05-18 02:16:28 -0400] basic`: hahah
[2013-05-18 02:16:42 -0400] basic`: i didn't think about that, i guess I am running whatever the CentOS 6 image has...
[2013-05-18 02:17:10 -0400] coderanger: I stand by my 'weird tweaks' comment :P
[2013-05-18 02:18:56 -0400] coderanger: (<3ramereth)
[2013-05-18 02:19:07 -0400] basic`: lol
[2013-05-18 02:19:16 -0400] basic`: he's not here, we're safe
[2013-05-18 02:20:53 -0400] basic`: coderanger: it would only matter in code, not comments?  I have things like recipe authors with unicode like 
[2013-05-18 02:21:43 -0400] coderanger: I suspect the answer is both
[2013-05-18 02:21:57 -0400] coderanger: because the Ruby lexer/parser is a fickle beast
[2013-05-18 04:17:47 -0400] SirFunk: Anyone know how I can install hstore support in postgresql with chef?
[2013-05-18 04:38:54 -0400] coderanger: SirFunk: CREATE EXTENSION IF NOT EXISTS hstore;
[2013-05-18 04:39:33 -0400] coderanger: You can use the resources in the database cookbook to run that SQL from Chef
[2013-05-18 04:40:16 -0400] SirFunk: yeah i know how to do it in postgresql I just wasn't sure if there was a more chefy way to do it
[2013-05-18 04:42:46 -0400] coderanger: I mean you could build a postgres_extension resource
[2013-05-18 04:42:55 -0400] coderanger: but there isn't much more you can do beyond that one line :)
[2013-05-18 04:43:01 -0400] coderanger: I guess dealing with upgrades or something
[2013-05-18 04:43:12 -0400] coderanger: extension upgrades always suck though
[2013-05-18 04:43:15 -0400] jameson1: jtimberman: was there a reason rabbitmq cookbook doesn't use the rabbitmq repo for debian?
[2013-05-18 10:54:24 -0400] matti: ;]
[2013-05-18 19:24:32 -0400] c4milo: somebody from opscode?
[2013-05-18 19:24:38 -0400] c4milo: there is a typo in http://docs.opscode.com/essentials_cookbook_lwrp_example.html
[2013-05-18 19:24:53 -0400] c4milo: I believe
[2013-05-18 19:24:59 -0400] c4milo: instead of opscode_database "database" do
[2013-05-18 19:25:06 -0400] c4milo: should it be opscode_mysql "database" do
[2013-05-18 19:25:07 -0400] c4milo: ?
[2013-05-18 19:25:29 -0400] gchristensen: c4milo: it seems to specify the provider is opscode_mysql,which should take care of it I think.
[2013-05-18 19:25:50 -0400] c4milo: ohh I see
[2013-05-18 19:25:56 -0400] gchristensen: but you may be right
[2013-05-18 19:28:22 -0400] coderanger: Yep, same resource
[2013-05-18 19:28:25 -0400] coderanger: different provider
[2013-05-18 19:28:26 -0400] coderanger: :)
[2013-05-18 19:28:58 -0400] coderanger: a resource is a more abstract representation of state, and then a provider is a concrete implementation for a single system
[2013-05-18 19:30:11 -0400] c4milo: got it
[2013-05-18 19:30:13 -0400] c4milo: in that example
[2013-05-18 19:30:20 -0400] c4milo: is new_resource created automagically by Chef?
[2013-05-18 19:30:33 -0400] c4milo: inside the provider
[2013-05-18 19:30:53 -0400] c4milo: coderanger: gchristensen?
[2013-05-18 19:31:19 -0400] coderanger: yes, thats part of the internal API of providers
[2013-05-18 19:31:54 -0400] c4milo: cool
[2013-05-18 19:31:56 -0400] c4milo: thanks guys
[2013-05-18 19:31:58 -0400] c4milo: for the help
[2013-05-18 19:33:27 -0400] c4milo: one last question, so I'm writing a definition to deploy nodejs apps and foodcritic is suggesting me to rewrite using LWRP
[2013-05-18 19:33:48 -0400] c4milo: should it pay attention? :|
[2013-05-18 19:34:49 -0400] c4milo: coderanger: ^
[2013-05-18 19:35:13 -0400] coderanger: Yes, there is almost no reason to use defs anymore
[2013-05-18 19:35:24 -0400] coderanger: They are largely deprecated, only useful in very very specific circumstances
[2013-05-18 19:35:34 -0400] c4milo: coderanger: I see, alright, I'll rewrite it then, thank you man
[2013-05-18 19:48:54 -0400] jasonsmr: hwllo anyone using Apache2 recip
[2013-05-18 19:49:36 -0400] jasonsmr: Im usint the Apache2 recipe, Question can I have two diffrent virtual apache servers (configurations) on the same node with chef?
[2013-05-18 19:49:56 -0400] jasonsmr: sorry sp/hwllo/hello sp/usint/using
[2013-05-18 19:50:51 -0400] jasonsmr: Working with two virtual server configurations in Apache in a standard install manualy I get it, but never tried it with chef configureations befor? any clues is appreaceated
[2013-05-18 19:58:36 -0400] knuckolls: jasonsmr: if you can do it by hand, you can do it with chef. :)
[2013-05-18 19:59:04 -0400] knuckolls: all you have to do is use the template resource in a recipe to put the virtual host configuration files in the right folders
[2013-05-18 21:36:57 -0400] ryker: hi everyone.  I'm wondering if the code in not_if and only_if statements of resources is executed at the time the resource is run or is it executed at compile time?
[2013-05-18 21:37:06 -0400] ryker: it seems like it's done at compile time.
[2013-05-18 21:38:49 -0400] lahwran: hi
[2013-05-18 21:59:30 -0400] ssd7: ryker: The code in the not_if or only_if is called at convergence
[2013-05-18 22:15:56 -0400] ryker: ssd7: so it's executed when that particular resource is evaluated?  I have a variable that is set in a previous ruby block resource and that variable is used in the not_if of the following resource.  it seems like the variable in that ruby block isn't being set before it's used in the not_if of the following resource.
[2013-05-18 22:16:20 -0400] coderanger: ryker: Yes, right before convergence
[2013-05-18 22:16:29 -0400] coderanger: ryker: Can you pastebin?
[2013-05-18 22:16:38 -0400] coderanger: might be hitting assignment scoping issues
[2013-05-18 22:16:50 -0400] ryker: coderanger: sure, just a sec
[2013-05-18 22:23:15 -0400] ryker: coderanger: http://pastebin.com/ni8wsTyx, devicetomount variable at line 95 always ends up being nil, which is what I initialize it to at the beginning of the loop.
[2013-05-18 22:23:53 -0400] ryker: it should never be nil.  line 49 always sets it to = raid_device
[2013-05-18 22:24:05 -0400] ryker: it might get changed later in the code, but it should never be nil
[2013-05-18 22:24:23 -0400] ryker: and I've confirmed raid_device is not nil
[2013-05-18 22:24:24 -0400] coderanger: ryker: So a few problems
[2013-05-18 22:24:42 -0400] coderanger: you are using devicetomount in a lot of places as a direct param to a resource
[2013-05-18 22:24:54 -0400] coderanger: that _is_ evaluated at compile time
[2013-05-18 22:25:12 -0400] coderanger: line 92 for example
[2013-05-18 22:26:03 -0400] coderanger: Also the more important issue is at line 49 and other similar assignments, you are creating a variable local to that block
[2013-05-18 22:26:13 -0400] ryker: it's an execute block. why is it evaluated at compile time?
[2013-05-18 22:26:47 -0400] coderanger: resource arguments are always evaluated at compile time
[2013-05-18 22:26:58 -0400] ryker: i thought if I created the variable outside the block, I could use it inside the ruby blocks, no?
[2013-05-18 22:27:14 -0400] coderanger: You can use it, but you can't assign out of a block like that
[2013-05-18 22:27:20 -0400] coderanger: unless you make it a global var (bad idea)
[2013-05-18 22:27:25 -0400] coderanger: Thats true in most languages
[2013-05-18 22:27:31 -0400] coderanger: except Python3's nonlocal keyword :)
[2013-05-18 22:28:06 -0400] coderanger: Remember the do ... end around things is a real Ruby scoping block
[2013-05-18 22:28:10 -0400] ryker: so what are my options for having a variable like that, that I can use in multiple blocks?  use a node attribute?
[2013-05-18 22:28:21 -0400] coderanger: But either use a node attr, or do something like this
[2013-05-18 22:28:26 -0400] coderanger: x = [nil]
[2013-05-18 22:28:42 -0400] coderanger: ruby_block ... x[0] = :bar
[2013-05-18 22:29:04 -0400] coderanger: That mutates the same object, as opposed to creating a new variable assignment
[2013-05-18 22:29:32 -0400] ryker: so, that defines x to be an array with one item set to nil?
[2013-05-18 22:29:55 -0400] ryker: and I can use that array elsewhere, including inside blocks?
[2013-05-18 22:29:56 -0400] coderanger: Yes, or you can use any other mutable type
[2013-05-18 22:30:24 -0400] coderanger: (arrays, hashes, technically strings are mutable in ruby but there be dragons)
[2013-05-18 22:31:20 -0400] ryker: hmm. guess I need to do some reading on mutable objects. :)
[2013-05-18 22:31:47 -0400] coderanger: PLT: The other other white meat
[2013-05-18 22:32:24 -0400] coderanger: The further you get from 'its a declarative DSL' the more you need to know about actual Ruby intricacies
[2013-05-18 22:32:34 -0400] ryker: seems like the simplest thing to do is just use a node attribute, but I have no need for that attribute to be saved to the node.  just seems like a hack to do that since I don't need it persisted across runs
[2013-05-18 22:32:49 -0400] coderanger: You can use the run context hash, sec
[2013-05-18 22:32:58 -0400] coderanger: I never remember the variable name, have to look it up :)
[2013-05-18 22:34:26 -0400] ryker: thx for the help.  guess I have some reading and refactoring to do. :)
[2013-05-18 22:40:43 -0400] ryker: opscode should have a training session in my area that teaches essential advanced topics for Ruby useful in Chef and advanced Chef topics.  I would totally make my company pay for that. :)
[2013-05-18 22:47:53 -0400] c4milo: quick question: how do I use my own providers directly?
[2013-05-18 22:50:15 -0400] countdigi: c4milo: you put them in a cookbook and include the cookbook
[2013-05-18 22:50:44 -0400] c4milo: countdigi: I have them in the same cookbook where i have the recipe that need to use them
[2013-05-18 22:50:54 -0400] countdigi: then u are good
[2013-05-18 22:51:16 -0400] c4milo: countdigi: if I named my provider foo, how do I invoke it?
[2013-05-18 22:51:18 -0400] countdigi: if your cookbook is foo and you have a provider bar - then u reference it as foo_bar
[2013-05-18 22:51:43 -0400] c4milo: countdigi: that's what I was assuming as well for what I read but it complains :/
[2013-05-18 22:51:57 -0400] countdigi: complains what? :-)
[2013-05-18 22:52:08 -0400] c4milo: countdigi: it sames that it cannot find the resource foo_bar
[2013-05-18 22:52:15 -0400] c4milo: says*
[2013-05-18 22:54:07 -0400] countdigi: gist your resource?
[2013-05-18 22:54:18 -0400] c4milo: countdigi: sure
[2013-05-18 22:54:38 -0400] countdigi: i don't have much experience but i know I've written a test one before so hopefully i can help :-)
[2013-05-18 22:56:18 -0400] c4milo: countdigi: https://gist.github.com/c4milo/bb3c4d7524cd75993734
[2013-05-18 22:56:37 -0400] c4milo: countdigi: 3 files, recipe, provider and resource
[2013-05-18 22:56:59 -0400] c4milo: the line where it complains is https://gist.github.com/c4milo/bb3c4d7524cd75993734#file-deploy-rb-L35
[2013-05-18 22:58:47 -0400] countdigi: think ur naming is off so here is what I'm looking at:
[2013-05-18 22:59:45 -0400] countdigi: http://docs.opscode.com/essentials_cookbook_lwrp_file_locations.html
[2013-05-18 22:59:47 -0400] c4milo: countdigi: sorry, the provider file name is not nodejs-provider.rb, it's actually nodejs.rb. I changed it in the gist to make it more clear
[2013-05-18 23:00:05 -0400] countdigi: ur resource should be named nodes.rb as well
[2013-05-18 23:01:09 -0400] c4milo: I see
[2013-05-18 23:01:17 -0400] countdigi: then it would be {cookbook}_nodejs.rb for the lwrp
[2013-05-18 23:01:34 -0400] countdigi: or if your cookbook is named nodes.rb then just do a default.rb for resource and default.rb for provider
[2013-05-18 23:01:39 -0400] countdigi: then it would just be nodejs
[2013-05-18 23:01:52 -0400] countdigi: I'm pretty sure thats right (and i have a bridge to sell ya too ;-)
[2013-05-18 23:02:09 -0400] countdigi: that tripped me up too when i wrote my first one :-)
[2013-05-18 23:02:17 -0400] countdigi: not as nice docs at the time either :-)
[2013-05-18 23:03:28 -0400] c4milo: countdigi: yes sir, that did it :D
[2013-05-18 23:03:31 -0400] c4milo: countdigi: nice, thank you man
[2013-05-18 23:03:32 -0400] countdigi: cool beans
[2013-05-18 23:03:34 -0400] countdigi: np
[2013-05-18 23:22:40 -0400] countdigi: i need to practice writing lwrps  now ya got me thinking ;-)
[2013-05-18 23:23:11 -0400] countdigi: working on "layer-1" right now getting our custom ipxe install system in shape
[2013-05-18 23:41:55 -0400] gzc: is the current chef-server cookbook up-to-date? it doesn't appear that way
