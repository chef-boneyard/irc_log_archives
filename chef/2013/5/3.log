[2013-05-03 00:01:58 -0400] jhunter: silly q, but can you set your node's runlist from within a recipe? like inside of a conditional?
[2013-05-03 00:02:12 -0400] jhunter: if my network is this /8, add this to my run_list..
[2013-05-03 00:02:20 -0400] jhunter: else, add this
[2013-05-03 00:02:33 -0400] maplebed: oh man.  Looking at the 1.0 branch of the test-kitchen github repo is *so* much more helpful than master.
[2013-05-03 00:05:01 -0400] qhartman: jhunter, yes, you can make run_list changes, but most people seem to think that's not a thing one generally wants to do. It's better to set attributes and change behavior based on that w/o messing with the run_list
[2013-05-03 00:05:21 -0400] jhunter: hm ok ty qhartman
[2013-05-03 00:06:08 -0400] qhartman: The pattern that is usually recommended is to have some logic that includes the recipe you want to add
[2013-05-03 00:06:36 -0400] jhunter: right
[2013-05-03 00:06:41 -0400] jhunter: makes sense
[2013-05-03 00:06:45 -0400] joenuspl: or in a recipe if /8 ;  include_recipe "slash_8";  else; include_recipe "slash_16";  end
[2013-05-03 00:06:53 -0400] qhartman: right
[2013-05-03 00:06:59 -0400] jhunter: got it
[2013-05-03 00:07:55 -0400] joenuspl: even if node.run_list.delete would work it would bad
[2013-05-03 00:14:41 -0400] justizin: trying to install knife-ec2 on a fresh mountain lion box, complains that libxml2 isn't here - is it possible this needs full Xcode rather than just Xcode command-line tools?
[2013-05-03 00:21:50 -0400] bixu: I'm using chef-client with the --forked/-f option, and I think that's causing me to not have any chef-client logs...
[2013-05-03 00:21:58 -0400] bixu: I see this error only: RuntimeError: Forked convergence run failed
[2013-05-03 00:25:54 -0400] jeremyolliver: Does anyone else here use mongodb, and if so, which cookbook are you using to install it?
[2013-05-03 00:26:17 -0400] maplebed: edelight, though we've forked it (temporarily)
[2013-05-03 00:26:46 -0400] justizin: hm, apparently no, libxml2 headers just aren't installed .. curious.
[2013-05-03 00:27:26 -0400] justizin: hm, they actually are, this gem just can't find them..
[2013-05-03 00:28:06 -0400] maplebed: jeremyolliver: http://www.youtube.com/watch?v=dBk5RyExsOE <-- chefconf presentation on our use of the mongodb cookbook. links at the end or I can PM you (to avoid channelspam)
[2013-05-03 00:28:31 -0400] jeremyolliver: maplebed: That's with the standard one on the community site?
[2013-05-03 00:28:41 -0400] jeremyolliver: I'm currently using that one, and having some issues
[2013-05-03 00:28:51 -0400] maplebed: there are a few features mentioned that are only in our fork.
[2013-05-03 00:29:02 -0400] maplebed: but most of them have been upstreamed to edelight.
[2013-05-03 00:30:46 -0400] jeremyolliver: Okay thanks maplebed, I'll watch that and see how I go.
[2013-05-03 00:31:16 -0400] maplebed: feel free to ping me with questions (though I'll probably be afk in ~30min; around again tomorrow.)
[2013-05-03 00:32:29 -0400] jtimberman: maplebed: oh, geez.
[2013-05-03 00:32:39 -0400] maplebed: :D
[2013-05-03 00:33:02 -0400] jtimberman: it's not a "typo" per se
[2013-05-03 00:33:04 -0400] jtimberman: just outdated :)
[2013-05-03 00:33:14 -0400] maplebed: but you'll be happy to know that I did get kitchen test to run successfully on the cookbook.
[2013-05-03 00:33:16 -0400] maplebed: so \o/
[2013-05-03 00:33:25 -0400] maplebed: now I'm trying to create a ktichen file for my own cookbook
[2013-05-03 00:33:38 -0400] maplebed: I've been unable to find a way to pass a data bag path to Vagrant via the kitchen file.
[2013-05-03 00:33:49 -0400] jtimberman: maplebed: sweet!
[2013-05-03 00:34:04 -0400] jtimberman: maplebed: that might not be supported (yet)?
[2013-05-03 00:34:10 -0400] jtimberman: i haven't played w/ that yet.
[2013-05-03 00:34:11 -0400] maplebed: :'(
[2013-05-03 00:34:47 -0400] maplebed: just yesterday I got my cookbook running under berkshelf and vagrant, but it needed chef-solo-search and a data_bags_path.
[2013-05-03 00:36:30 -0400] jtimberman: maplebed: merged your change thanks :)
[2013-05-03 00:36:37 -0400] maplebed: yw.
[2013-05-03 00:36:51 -0400] Majost: What is the correct way to do this: https://gist.github.com/rhass/5506482
[2013-05-03 00:37:01 -0400] Majost: if there is one
[2013-05-03 00:38:49 -0400] maplebed: ah hah! jtimberman https://github.com/opscode/kitchen-vagrant/blob/master/lib/kitchen/vagrant/vagrantfile_creator.rb#L77-L79
[2013-05-03 00:38:53 -0400] maplebed: looks like it's there!
[2013-05-03 00:39:06 -0400] jtimberman: nice
[2013-05-03 00:41:18 -0400] Majost: seems like knife is unhappy about my attempt to validate the chef version for the cookbook because it doesn't have a value for node['chef_packages']['chef']['version']
[2013-05-03 00:46:55 -0400] kindsol: just in case anyone is interested, I recently pushed a knife-rightscale plugin for provisioning chef clients
[2013-05-03 00:46:58 -0400] kindsol: http://lists.opscode.com/sympa/arc/chef/2013-05/msg00039.html
[2013-05-03 00:47:19 -0400] kindsol: feedback welcome!
[2013-05-03 00:52:31 -0400] Majost: so is there any way to depend on chef_gem only if the cookbook is on a chef 10.x client?
[2013-05-03 00:59:30 -0400] maplebed: grumble. can't get it to work.  I'm wondering if instance.suite.data_bags_path should be instance.data_bags_path (comparing to the other things there) (ref https://github.com/opscode/kitchen-vagrant/blob/master/lib/kitchen/vagrant/vagrantfile_creator.rb#L77-L79)
[2013-05-03 01:11:48 -0400] dysinger: what are you all using with test-kitchen 1.0 to do the actual testing ? the only example I can find is portertech's sensu with one 'bats' file
[2013-05-03 01:17:06 -0400] jtimberman: dysinger: post convergence testing?
[2013-05-03 01:17:12 -0400] jtimberman: dysinger: I use minitest-chef
[2013-05-03 01:17:35 -0400] dysinger: inside a cookbook ? or in tests/integration/XYZ ?
[2013-05-03 01:18:29 -0400] dysinger: I want to, for this first test kitchen project, install openjdk, then use the java cookbook & attributes to install oracle jdk 1.6 & then test to see that oracle did make it on there as the default java
[2013-05-03 01:18:42 -0400] jtimberman: dysinger: in the cookbook's files/default dir.
[2013-05-03 01:19:20 -0400] jtimberman: java cookbook has files/default/tests/minitest/oracle_test.rb
[2013-05-03 01:19:35 -0400] jtimberman: hm probably could be improved :)
[2013-05-03 01:32:57 -0400] monokrome: Hey. Is anyone in this channel available for a couple hours of consulting work? Our company has been working with chef for four weeks now, and we are at what feels like the last 1% - just tying things together and running into a lot of issues with chef. If anyone can help with this for a couple hours as a consultant, that could help us solve our problems here.
[2013-05-03 01:42:27 -0400] sascha_d: Hey chefs, I'm running through and updating a few hundred chef clients to 11.4.4-1 and getting a funky error on my first run-through. It seems fine on the followup run so I'm not too concerned, but it's still weird.  Basically all I see is
[2013-05-03 01:42:37 -0400] sascha_d: LoadError: cannot load such file -- highline
[2013-05-03 01:43:18 -0400] monokrome: kallistec: Do you know how I can manually set that log level thing?
[2013-05-03 01:43:23 -0400] monokrome: To fix that issue?
[2013-05-03 01:47:11 -0400] kallistec: monokrome: it's hard-coded here: https://github.com/opscode/chef/blob/master/lib/chef/knife/core/bootstrap_context.rb#L65
[2013-05-03 01:47:33 -0400] kallistec: monokrome: your best bet is to downgrade knife to 10.24.4 for now
[2013-05-03 01:57:29 -0400] dysinger: jtimberman: so I add minitest-handler and it runs this test https://github.com/opscode-cookbooks/maven/blob/master/files/default/tests/minitest/default_test.rb before mine & breaks.  ?
[2013-05-03 01:59:27 -0400] jtimberman: dysinger: you'reu sing maven too?
[2013-05-03 01:59:36 -0400] jtimberman: (silly question i guess, java stack)
[2013-05-03 02:00:05 -0400] dysinger: it's a decent size company. they have 100s of python & java repos.
[2013-05-03 02:00:48 -0400] jtimberman: :)
[2013-05-03 02:02:42 -0400] dysinger: so my question - I'm creating a wrapper cookbook for community java & maven. it just sets the attributes for oracle jdk 6 & where to grab it & has attributes for maven 3.0.5.  what I want is to test having openjdk packages in the way. so I thought test-kitchen & tests.  I created a minitest & turned on testing with btm's minitest-handler cookbook.  but it ends up running the maven cookbook tests that fails (looks like you are on the commits
[2013-05-03 02:02:43 -0400] dysinger: jtimberman)
[2013-05-03 02:03:44 -0400] jtimberman: dysinger: do you have a gist of failing test output?
[2013-05-03 02:03:58 -0400] jtimberman: what platform+platform version and chef version
[2013-05-03 02:04:32 -0400] dysinger: just chef solo 10.24 on ubuntu 12.04 vagrant (test-kitchen)
[2013-05-03 02:04:34 -0400] dysinger: one sec
[2013-05-03 02:05:49 -0400] dysinger: jtimberman: https://gist.github.com/dysinger/3e0702b372a1a2778de3 this is part of the output. enough to see that the maven test if a mysql jar is there or not doesn't work. why would I have a /usr/local/foodir/ filled with mysql jars ?
[2013-05-03 02:06:40 -0400] dysinger: this is the test suite https://github.com/opscode-cookbooks/maven/blob/master/files/default/tests/minitest/default_test.rb
[2013-05-03 02:10:46 -0400] jtimberman: dysinger: ah - maven::test sets that stuff up
[2013-05-03 02:12:36 -0400] jtimberman: i believe the default_test.rb should be test_test.rb
[2013-05-03 02:14:28 -0400] dysinger: I restricted the tests with a pattern match to just my local tests
[2013-05-03 02:26:03 -0400] elejia: did anyone make the Seattle devops meet this past tuesday?
[2013-05-03 02:26:56 -0400] dysinger: Is there a way to throw some chaos into the mix with test-kitchen by installing competing packages ahead of time in one of my suites to test the debian 'alternatives' priority ?
[2013-05-03 02:37:17 -0400] tomschlick: so i have chef 11.4.4 installed and i've installed the knife-github-cookbooks gem but when i try to run any command with that it says the command doesnt exist. any suggestions?
[2013-05-03 02:37:22 -0400] jeremyolliver: dysinger: you can setup a cookbook with the sole purpose of being used in the tests. Have that cookbook install whatever and be ahead in the runlist
[2013-05-03 02:38:33 -0400] tomschlick: also when i run just "knife cookbook" i get this message at the top "FATAL: Cannot find sub command for: 'cookbook'" that happens with any sub command of cookbook whether it exists or not
[2013-05-03 02:39:21 -0400] dysinger: jeremyolliver: that would work
[2013-05-03 02:40:06 -0400] jeremyolliver: tomschlick: can you run anything else successfully? like "knife --help"
[2013-05-03 02:41:25 -0400] tomschlick: jeremyolliver: yes, i can run for instance "knife cookbook site install graphite" just fine. its just that fatal warning appears for most commands at the top whether they succeed or not
[2013-05-03 02:41:36 -0400] tomschlick: im thinking that has something to do with the plugins not working
[2013-05-03 02:42:18 -0400] jeremyolliver: tomschlick: it could be that knife-github-cookbooks isn't compatible with that version of chef client. I don't use that plugin anymore, not sure
[2013-05-03 02:43:34 -0400] tomschlick: jeremyolliver: can you recommend any other plugin that lets you easily fetch a cookbook from github?
[2013-05-03 02:44:10 -0400] jeremyolliver: tomschlick: Many in the community are using either Berkshelf or librarian to manage their cookbooks
[2013-05-03 02:44:23 -0400] jeremyolliver: These take an approach similar to bundler for rubygems (if you are familiar)
[2013-05-03 02:45:05 -0400] tomschlick: ill take a look thanks
[2013-05-03 02:45:14 -0400] tomschlick: jeremyolliver: btw this was what i was talking about https://dl.dropboxusercontent.com/1/view/sqzkn7ffwbjfcns/Public/Screenshots/yFjVf.png
[2013-05-03 02:45:26 -0400] jeremyolliver: Specify all cookbooks used and where to get them in a file, then run a command to download them all. The advantage over using say: knife-github-cookbooks, is that months later, when you have cookbooks/foo you don't need to remember if foo was from the community site or someones random github repo
[2013-05-03 02:45:48 -0400] tomschlick: ive even nuked /opt/chef and reinstalled and the same thing, ive also uninstalled that plugin so im not sure if that was the case
[2013-05-03 02:50:12 -0400] kallistec: tomschlick: you have rvm/rbenv installed at the same time?
[2013-05-03 02:50:35 -0400] tomschlick: i dont believe so. any way to find out?
[2013-05-03 02:50:53 -0400] tomschlick: new to chef / ruby so not sure what conflicts etc
[2013-05-03 02:51:31 -0400] kallistec: tomschlick: `/opt/chef/embedded/bin/gem env`
[2013-05-03 02:51:48 -0400] kallistec: everything should point to inside the /opt/chef dir
[2013-05-03 02:52:34 -0400] tomschlick: kallistec: output https://dl.dropboxusercontent.com/1/view/58rz4rm13mgky1g/Public/Screenshots/cXJUZ.png
[2013-05-03 02:54:01 -0400] kallistec: tomschlick: that all looks good. what knife plugins do you have installed?
[2013-05-03 02:54:24 -0400] tomschlick: afaik just knife-github-cookbooks but thats removed right now
[2013-05-03 02:57:38 -0400] tomschlick: also i've completely nuked /opt/chef and reinstalled via the omnibus installer and the same thing
[2013-05-03 02:57:56 -0400] tomschlick: is there something stored elsewhere on the system that could cause it?
[2013-05-03 02:59:24 -0400] kallistec: tomschlick: nothing in ~/.chef/plugins/knife ? no other ruby on the system?
[2013-05-03 03:00:10 -0400] tomschlick: ~/.chef doesnt exist
[2013-05-03 03:00:32 -0400] spheromak: also could be in .chef
[2013-05-03 03:00:56 -0400] tomschlick: my .chef is in another directory specific to the project if that has any effect
[2013-05-03 03:01:21 -0400] kallistec: yeah, that can have a plugins/knife directory, too
[2013-05-03 03:02:13 -0400] tomschlick: kallistec: this is all thats in that dir https://dl.dropboxusercontent.com/1/view/v1s7jh8q74hu5cs/Public/Screenshots/dNUzX.png
[2013-05-03 03:02:38 -0400] kallistec: that seems okay
[2013-05-03 03:06:22 -0400] kallistec: tomschlick: hrm, I can't think of anything. looking at the code it should just print some help and exit every time it prints that message
[2013-05-03 03:06:35 -0400] kallistec: but you're saying it prints that message and runs anyway?
[2013-05-03 03:07:40 -0400] tomschlick: the github command wont show up anywhere in the command list when its installed. i just thought that may have something to do with it
[2013-05-03 03:11:04 -0400] kallistec: tomschlick: depends on whether it sets a banner or not
[2013-05-03 03:11:37 -0400] kallistec: the default banner is like `/usr/bin/knife ARGS` or something
[2013-05-03 03:12:03 -0400] tomschlick: did chef 10 store data elsewhere? i had that before 11, maybe a conflict?
[2013-05-03 03:12:30 -0400] kallistec: if you installed with omnibus the whole time then nothing's changed
[2013-05-03 03:17:52 -0400] tomschlick: kallistec: yeah im pretty sure i did. and the omnibus recognized the old version when i did so id assume it would take care of any conflicts between the two
[2013-05-03 03:18:38 -0400] kallistec: yeah, I'm out of ideas unless you want to get crazy and strace it or something
[2013-05-03 03:19:35 -0400] elejia: silly question: did you check your path?
[2013-05-03 03:21:00 -0400] tomschlick: output when running $PATH
[2013-05-03 03:21:02 -0400] tomschlick: -bash: /usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/Applications/Server.app/Contents/ServerRoot/usr/bin:/Applications/Server.app/Contents/ServerRoot/usr/sbin
[2013-05-03 03:23:42 -0400] elejia: i ran into an issue due to my own installation ignorance where i had path issues, my knife command in /usr/bin got injected with some stuff. that's why i ask
[2013-05-03 03:24:01 -0400] elejia: probably not the same, but worth a quick check
[2013-05-03 03:25:31 -0400] tomschlick: yeah /usr/bin/knife points to /opt/chef/bin/knife
[2013-05-03 03:25:54 -0400] jeremyolliver: and "which knife" is /usr/bin/knife?
[2013-05-03 03:26:00 -0400] tomschlick: yup
[2013-05-03 03:27:32 -0400] jeremyolliver: Hmm, that is odd
[2013-05-03 03:27:50 -0400] elejia: yeah sorry I've got nothing :(
[2013-05-03 03:28:08 -0400] tomschlick: yeah i mean i would love to nuke the install again if that would mean it would fix it but it didnt help is there an official uninstaller?
[2013-05-03 03:28:52 -0400] ryker: is it possible to capture stdout of the execute resource into a variable that I can then use in another resource
[2013-05-03 03:29:51 -0400] ryker: tomschlick: I just logged in. are you talking about uninstalling chef-client?
[2013-05-03 03:30:19 -0400] tomschlick: ryker: no the knife/workstation component from my mac
[2013-05-03 03:30:41 -0400] tomschlick: having weird issues with chef 11.4.4
[2013-05-03 03:32:02 -0400] ryker: tomschlick: hmm. sry, i've only installed it on linux.
[2013-05-03 03:32:09 -0400] ryker: not sure how they install it on the mac
[2013-05-03 03:32:20 -0400] ryker: since there is no package manager
[2013-05-03 03:32:25 -0400] kallistec: sharball
[2013-05-03 03:33:10 -0400] tomschlick: switching from my imac to mbp, gonna see if i have the same issues with the same plugins installed
[2013-05-03 03:33:11 -0400] kallistec: rm -rf /opt/chef should be good enough to uninstall
[2013-05-03 03:33:16 -0400] ryker: is that like baseball? ;)
[2013-05-03 03:33:34 -0400] jeremyolliver: Hmm, should I expect attributes from an included cookbook to be available already for use in a resource within a recipe?
[2013-05-03 03:35:32 -0400] ryker: jeremyolliver: yes, they should be
[2013-05-03 03:35:57 -0400] ryker: kallistec: since you're answering questions. :)  any idea about my questions about captuting stdout of an execute resource?
[2013-05-03 03:36:13 -0400] ryker: and my typing sux
[2013-05-03 03:36:39 -0400] jeremyolliver: Hmm. I've got within a recipe of mine include_recipe("haproxy::app_lb") then further down, setting up a template passing in node['haproxy']['admin']['port'] (which is set in the haproxy default attributes file), but it's not present :(
[2013-05-03 03:36:51 -0400] kallistec: ryker: can't really be done, it's the provider that runs the actual command
[2013-05-03 03:37:05 -0400] kallistec: and the provider goes away after it runs
[2013-05-03 03:37:06 -0400] jeremyolliver: No wait, my bad
[2013-05-03 03:37:28 -0400] jeremyolliver: I take that back, missed a level on the @params hash that I was passing into the template
[2013-05-03 03:37:54 -0400] ryker: kallistec: so how would i run a command and capture it in a variable to be used later in a resource?  i'm trying to get an md5sum of a file, and use it for comparison later
[2013-05-03 03:38:24 -0400] ryker: I know if I just use %x{} it will be executed during compile time, so that won't work
[2013-05-03 03:38:50 -0400] elejia: ryker: what are you using to run the command?
[2013-05-03 03:38:57 -0400] kallistec: ryker: you can use mixlib-shellout directly, but maybe need to use a ruby block and do some local variable dance to get the data back out of the block
[2013-05-03 03:39:55 -0400] ryker: ah, i forgot about shellout.  i'll take a look. thanks.
[2013-05-03 03:39:56 -0400] jeremyolliver: ryker: I might recommend setting up a helper module that defines a method which runs that command and returns the output, then calling that helper method when you need to use it
[2013-05-03 03:40:08 -0400] tomschlick: kallistec: looks like that gem installs the chef gem as well. that would conflict with omnibus right?
[2013-05-03 03:41:01 -0400] kallistec: tomschlick: how'd you install the gem? via /opt/chef/embedded/bin/gem ?
[2013-05-03 03:41:25 -0400] tomschlick: looks like its a dependency of knife-github-cookbooks
[2013-05-03 03:41:25 -0400] jeremyolliver: omnibus installs an isolated ruby, and installs the chef gem within that ruby install
[2013-05-03 03:42:29 -0400] |rt|: for a workstation install of chef and tools rvm is the best option in my opinion
[2013-05-03 03:42:30 -0400] ryker: jeremyolliver: i've never done that before.  that's will basically be a ruby method call and not inside a chef resource, right?  If so, will that be executed in the proper order along with the rest of the resources in the recipe?
[2013-05-03 03:43:04 -0400] tomschlick: i still get the same error at the top even after i removed all chef related gems...
[2013-05-03 03:43:20 -0400] kallistec: tomschlick: what gem command are you using?
[2013-05-03 03:43:26 -0400] jeremyolliver: ryker: what's the use case? Need to get a value before some point in the client run, or just need to provide the output value to a particular resource?
[2013-05-03 03:43:31 -0400] tomschlick: gem uninstall X
[2013-05-03 03:43:38 -0400] tomschlick: well sudo
[2013-05-03 03:44:06 -0400] kallistec: tomschlick: and does `which gem` point you at /usr/bin/gem which is -> ../../System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/gem
[2013-05-03 03:44:55 -0400] tomschlick: lrwxr-xr-x  1 root  wheel  71 Oct 15  2012 /usr/bin/gem -> ../../System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/gem
[2013-05-03 03:44:57 -0400] tomschlick: yup
[2013-05-03 03:45:00 -0400] jeremyolliver: bingo
[2013-05-03 03:45:51 -0400] jeremyolliver: the gem command for where chef is installed should be /opt/chef/embedded/bin/gem or something I believe
[2013-05-03 03:45:55 -0400] ryker: jeremyolliver: here's what I'm doing.  I get the md5sum of the current initrd and compare it to a value in the node attribs from the last run.  if it doesn't match, create a new initrd, then store the new md5sum in node attributes.
[2013-05-03 03:46:35 -0400] ryker: I just need to make sure that last md5sum I get of the new initrd is run after the initrd is created (which uses the execute resource)
[2013-05-03 03:46:58 -0400] jeremyolliver: ryker: Ah, well you probably don't need to do what I said, you can probably just call shellout straight in the recipe and set it via node.set
[2013-05-03 03:47:05 -0400] jeremyolliver: which will happen all in the compile phase
[2013-05-03 03:47:34 -0400] tomschlick: jeremyolliver: you got it. just ran /opt/chef/embedded/bin/gem install pluginname and now it works
[2013-05-03 03:47:44 -0400] jeremyolliver: tomschlick: great :)
[2013-05-03 03:47:50 -0400] ryker: jeremyolliver: and the compile phase is what happens at the beginning of the chef run before a recipe is run, right?
[2013-05-03 03:47:51 -0400] tomschlick: so should i add that to my path or always use the full path?
[2013-05-03 03:48:17 -0400] jeremyolliver: ryker: Yeah, it is
[2013-05-03 03:49:08 -0400] ryker: jeremyolliver: and that's the problem. I need to make sure the md5 is created AFTER the execute resource runs and creates the new initrd.  Otherwise, I'll be getting the md5 of the old initrd. :)
[2013-05-03 03:49:10 -0400] jeremyolliver: tomschlick: Well you said you don't really use ruby outside of chef right? I might recommend putting /opt/chef/embedded/bin at the start of your path so that you're always using the ruby/gem/knife commands from your omnibus install
[2013-05-03 03:49:26 -0400] kallistec: ryker: probably just ruby_block with node.set["md5_of_thing"] = `md5 path` would work?
[2013-05-03 03:49:48 -0400] jeremyolliver: yeah, I was just going to suggest a ruby_block resource too
[2013-05-03 03:49:56 -0400] tomschlick: jeremyolliver: thats what i was thinking. just didnt want to cause any conflicts within gems or anything
[2013-05-03 03:50:09 -0400] ryker: kallistec: really?  I thought the `md5 path` portion would be run in compile phase and then passed to the resource during the recipe execution?
[2013-05-03 03:50:22 -0400] tomschlick: thanks jeremyolliver and kallistec. you both helped way beyond the normal debug time on irc haha
[2013-05-03 03:51:25 -0400] kallistec: ryker: not in a ruby block, the block bit is evaluated at converge
[2013-05-03 03:52:08 -0400] ryker: ah, ok.  I just assumed, even if it was in a ruby block, any system calls (backticks, %x, etc) would still be evaluated at compile time
[2013-05-03 03:52:27 -0400] ryker: thanks.  I'll give it a try
[2013-05-03 03:52:45 -0400] kallistec: ryker: for bonus points, you could do `Digest::MD5.hexdigest(IO.read("file"))
[2013-05-03 03:52:57 -0400] jeremyolliver: Nah, the bit inside the block is at the end. You can even use notifications to trigger it's runs then if you want
[2013-05-03 03:53:55 -0400] ryker: kallistec: hah. thanks for that.  I was too lazy to search how to get the md5 in ruby and went the easy route with md5sum. :)
[2013-05-03 03:55:19 -0400] kallistec: also this: https://github.com/opscode/chef/blob/master/lib/chef/digester.rb
[2013-05-03 03:57:24 -0400] ryker: kallistec: cool. how would I call that?  md5 = Chef::Digester.generate_md5_checksum_for_file("myfile") ?
[2013-05-03 03:57:38 -0400] kallistec: ryker: yep
[2013-05-03 03:58:19 -0400] ryker: kallistec: any reason to pick one over the other?  I'm still very new to ruby.  only learning it as I use chef. :)
[2013-05-03 03:59:58 -0400] kallistec: the one in chef will stream data if the file is very large
[2013-05-03 04:00:23 -0400] kallistec: wheras IO.read reads a file into memory in one go
[2013-05-03 04:01:37 -0400] ryker: ah, ok.  I guess I'll try Digester.
[2013-05-03 04:01:46 -0400] ryker: thanks again jeremyolliver and kallistec
[2013-05-03 04:02:13 -0400] jeremyolliver: np :)
[2013-05-03 04:02:34 -0400] jeremyolliver: The great help I got in this IRC is part of what made me love chef when I tried it around a year ago
[2013-05-03 04:05:19 -0400] ryker: kallistec: I got, uninitialized constant Chef::Digester
[2013-05-03 04:05:35 -0400] ryker: do I need to include Chef::Digester at the top of the file?
[2013-05-03 04:05:59 -0400] ryker: or, instantiate the class with x = Chef::Digester.new?
[2013-05-03 04:07:50 -0400] ianselby: I'm running into a weird issue uploading cookbooks all my other knife commands work perfectly against my chef server, but for whatever reason the knife cookbook upload is doing the following:
[2013-05-03 04:08:04 -0400] ianselby: knife cookbook upload logrotate  -V                                                   ian@ichigo
[2013-05-03 04:08:04 -0400] ianselby: INFO: Uploading /Users/ian/code/chef/cookbooks/logrotate/recipes/default.rb (checksum hex = d4ae7a310317ea31e530607085795557) to https://localhost:443/bookshelf/organization-00000000000000000000000000000000/checksum-d4ae7a310317ea31e530607085795557?AWSAccessKeyId=fab6ce600bca8bf596f2ea37724aa1e59a694c56&Expires=1367554859&Signature=flnNW12shznOuol2NhCcJIpDJtE%3D
[2013-05-03 04:08:05 -0400] jeremyolliver: Syntax doesn't require .new, I would guess a require
[2013-05-03 04:08:11 -0400] ianselby: which results in a connection refused
[2013-05-03 04:08:15 -0400] ianselby: any thoughts / help?
[2013-05-03 04:11:52 -0400] ianselby: derp, I googled harder and found my answer (FQDN issue).
[2013-05-03 04:13:42 -0400] ryker: ianselby: how so?  because the ssl cert was self signed or something?
[2013-05-03 04:14:03 -0400] ianselby: no, when I set up chef server the first time, my server did not have a FQDN set
[2013-05-03 04:14:36 -0400] ianselby: so then everything will default to localhost
[2013-05-03 04:14:37 -0400] ryker: jeremyolliver: found my issue. digester is chef 11 only. :)  switched to using Digest::MD5 since that works no matter what and it's working great.  thanks again
[2013-05-03 04:14:48 -0400] ryker: ah, ok
[2013-05-03 04:14:52 -0400] kallistec: ryker: it'd be Chef::Digester. generate_md5_checksum_for_file
[2013-05-03 04:15:01 -0400] jeremyolliver: Note that AWS instances generally don't have an fqdn at all
[2013-05-03 04:15:14 -0400] ianselby: yeah, that's the rub
[2013-05-03 04:15:25 -0400] ianselby: it does have a proper FQDN with elastic IP & DNS now
[2013-05-03 04:15:41 -0400] ianselby: so I just gotta tweak /etc/hosts and reconfigure afaik
[2013-05-03 04:16:32 -0400] jeremyolliver: I've been bitten by calling node.fqdn in a cookbook before on AWS. calling .fqdn instead of node['fqdn'] raises an error if it doesn't exist instead of nil
[2013-05-03 04:19:14 -0400] ianselby: success!
[2013-05-03 05:13:26 -0400] ranjibd: dysinger, we use it to test the entire CI env
[2013-05-03 05:13:51 -0400] ranjibd: take a look ate the apt, bluepill etc community cookbooks, they have good examples too
[2013-05-03 07:44:25 -0400] total-cook: Hey, is the only difference between a "normal" resource and a lightweight resource that normal resources are built into Chef and lightweight ones are third party?
[2013-05-03 07:47:57 -0400] aruntomar: total-cook: yes
[2013-05-03 09:43:05 -0400] zaargy: is it possible to 'upload' a cookbook to a chef server by installing the cookbook on the chef server's filesystem rather than going through knife?
[2013-05-03 09:43:16 -0400] zaargy: whaat do you do if your chef server isn't directly knifable?
[2013-05-03 09:43:16 -0400] zaargy: thanks.
[2013-05-03 09:57:47 -0400] loa: zaargy, did you get an answer for your question?
[2013-05-03 10:11:27 -0400] zaargy: loa: no
[2013-05-03 10:11:39 -0400] zaargy: i can think of a few solutions
[2013-05-03 10:12:02 -0400] loa: you can always use knife on the server
[2013-05-03 10:16:37 -0400] zaargy: sure
[2013-05-03 10:45:23 -0400] jpluscplusm: http://docs.opscode.com/ctl_chef_solo.html: "This command has the following syntax: chef-client OPTION  ...."
[2013-05-03 10:45:26 -0400] jpluscplusm: O_o
[2013-05-03 10:49:53 -0400] russss: so er
[2013-05-03 10:50:17 -0400] russss: I just upgraded my runit recipe from $old_version to the latest, and it just went ahead and replaced /usr/bin/sv with an init script which called /usr/bin/sv
[2013-05-03 10:50:22 -0400] russss: needless to say, hilarity ensued
[2013-05-03 11:10:34 -0400] russss: hilarity: http://tickets.opscode.com/browse/COOK-2867
[2013-05-03 11:12:43 -0400] nyerup: russss: *snicker* :)
[2013-05-03 11:12:49 -0400] russss: not funny
[2013-05-03 11:13:12 -0400] russss: entirely metaphorical hilarity
[2013-05-03 11:13:14 -0400] nyerup: Right. That's.. er.. what I meant.
[2013-05-03 11:14:41 -0400] alexbst: lolrussss
[2013-05-03 12:04:38 -0400] masterkorp: hello everyone
[2013-05-03 12:19:41 -0400] MattJ: Hello masterkorp
[2013-05-03 12:20:59 -0400] masterkorp: sucks to be sick
[2013-05-03 13:33:01 -0400] AxonetBE: if I have this in my chef recipe, http://pastie.org/7757833 does chef wait till the gem is installed to go further?
[2013-05-03 13:33:28 -0400] AxonetBE: doesn't seems because the next task is failing because he can't find the folder but the folder is there after the recipe
[2013-05-03 13:56:07 -0400] pithagorians: hi all. newbie to chef. want to start with docs on off site. looking here http://docs.opscode.com/chef/install_workstation.html#download-pem-files-and-knife-rb . i have the chef open source server installed, but can't find Organizations. i could find it on chef provided by opscode. any clue?
[2013-05-03 13:59:43 -0400] chris613: pithagorians: I think that feature just doesn't exist in the open source version
[2013-05-03 14:00:19 -0400] pithagorians: <chris613> thx. understood it already ;)
[2013-05-03 14:00:58 -0400] atomic-penguin: AxonetBE, maybe set up a notifies/subscribes chain between the two resources? http://docs.opscode.com/resource_common_notifications.html
[2013-05-03 14:26:56 -0400] yfeldblum: AxonetBE, yes and no
[2013-05-03 14:36:21 -0400] zaargy: what's the workflow for testing roles in chef? since they are shared by all environments and not versioned in the chef server...
[2013-05-03 14:38:50 -0400] zaargy: i guess the first thing to do is keep roles simple and move runlists to an application cookbook
[2013-05-03 14:38:53 -0400] zaargy: or such
[2013-05-03 14:42:32 -0400] matti: zaargy: You and Chef?
[2013-05-03 14:43:35 -0400] zaargy: matti: i'm still a noob but yeah
[2013-05-03 14:43:54 -0400] matti: Interesting.
[2013-05-03 14:44:04 -0400] zaargy: heh
[2013-05-03 14:44:06 -0400] matti: I thought you were Puppet / MCollective fanboy.
[2013-05-03 14:44:24 -0400] zaargy: i am/was a consultant - i use what i'm told
[2013-05-03 14:44:32 -0400] matti: LOL
[2013-05-03 14:44:33 -0400] matti: OK ;]
[2013-05-03 14:44:36 -0400] matti: Fair enough ;]
[2013-05-03 14:44:37 -0400] gad0lin: :)
[2013-05-03 14:44:44 -0400] zaargy: i am liking chef though :)
[2013-05-03 14:44:59 -0400] matti: You will learn to hate it too.
[2013-05-03 14:45:01 -0400] matti: ;]
[2013-05-03 14:45:19 -0400] jpluscplusm: heya matti - where are you at now?
[2013-05-03 14:45:28 -0400] matti: ?
[2013-05-03 14:45:37 -0400] jpluscplusm: apres 7d
[2013-05-03 14:45:44 -0400] matti: Ah.
[2013-05-03 14:45:49 -0400] matti: I am remote for US company.
[2013-05-03 14:45:57 -0400] zaargy: heh nice
[2013-05-03 14:45:58 -0400] jpluscplusm: nice!
[2013-05-03 14:46:36 -0400] jpluscplusm: it was /marvellous/
[2013-05-03 14:46:40 -0400] matti: Yeah.
[2013-05-03 14:46:43 -0400] matti: I like it too.
[2013-05-03 14:47:25 -0400] yfeldblum: zaargy, if your roles are so complex that they require tests of their own, that means they're too complex
[2013-05-03 14:47:39 -0400] matti: jpluscplusm: :)
[2013-05-03 14:47:59 -0400] zaargy: yfeldblum: sure i can see that
[2013-05-03 14:48:51 -0400] yfeldblum: zaargy, as you mentioned, you can simplify them by moving stuff out of the role and into recipe
[2013-05-03 14:49:10 -0400] jforest: so... I inherited some crappy chef recipe
[2013-05-03 14:49:17 -0400] jpluscplusm: is that the current best practise then? I /like/ having roles as container objects, so to speak :-\
[2013-05-03 14:49:44 -0400] jforest: I need to run a ruby function as part of an "execute" resource.. is this possible?
[2013-05-03 14:49:48 -0400] matti: jforest: LOL
[2013-05-03 14:50:02 -0400] matti: jforest: Look at ruby_block
[2013-05-03 14:50:04 -0400] behemphi: Apologies up front but having met som many of you at ChefConf I think this is important if a bit off topic:
[2013-05-03 14:50:04 -0400] behemphi: http://www.gog.com/promo/ea_weekend_promo_030513?utm_source=newsletter&utm_medium=email&utm_content=game_subject&utm_campaign=ea_weekend_promo_030513
[2013-05-03 14:50:09 -0400] jforest: matti: will do :)
[2013-05-03 14:50:15 -0400] yfeldblum: zaargy, roles are static data; as programmers, we like to minimize the data in each role, making sure only what *must* be in a role is in a role
[2013-05-03 14:50:23 -0400] yfeldblum: jpluscplusm, containers of what?
[2013-05-03 14:50:30 -0400] behemphi: and its Friday :-)
[2013-05-03 14:50:49 -0400] matti: jforest: Remember that Chef DSL and its resources will be executed in different order to other native Ruby code surrounding them.
[2013-05-03 14:50:51 -0400] yfeldblum: jpluscplusm, hope you didn't interpret what i said  as "don't use roles" ...
[2013-05-03 14:50:53 -0400] matti: jforest: Hence the ruby_block.
[2013-05-03 14:50:59 -0400] jpluscplusm: yfeldblum: containers of recipes, attributes, and possibly hierarchical contains of other roles
[2013-05-03 14:51:03 -0400] matti: jforest: Unless you want to run something in compile time.
[2013-05-03 14:51:12 -0400] jpluscplusm: s/contains/containers
[2013-05-03 14:51:14 -0400] yfeldblum: jpluscplusm, why?
[2013-05-03 14:51:30 -0400] jpluscplusm: seperation of code and data
[2013-05-03 14:51:36 -0400] jforest: matti: nah, I need to pull down a remote_file first, then unzip it
[2013-05-03 14:51:41 -0400] jforest: that's the basic point
[2013-05-03 14:51:42 -0400] yfeldblum: jpluscplusm, why do you need so much data?
[2013-05-03 14:51:42 -0400] jpluscplusm: recipes == code (with sensible defaults attributes)
[2013-05-03 14:51:52 -0400] yfeldblum: jpluscplusm, and why is an implementation run-list "data"?
[2013-05-03 14:52:06 -0400] jpluscplusm: because I want everything my recipes do to be data-driven
[2013-05-03 14:52:26 -0400] jpluscplusm: and not to have hardcoded stuff in recipes
[2013-05-03 14:52:46 -0400] yfeldblum: jpluscplusm, https://github.com/opscode/chef/blob/11.4.0/lib/chef.rb#L19-L39
[2013-05-03 14:53:48 -0400] jpluscplusm: I don't quite get your point
[2013-05-03 14:54:06 -0400] yfeldblum: jpluscplusm, i'd call that a "top-level recipe"; and the role simply needs to "require 'chef'", not require each one of those things separately
[2013-05-03 14:54:16 -0400] matti: jforest: Grab FPM and make a package.
[2013-05-03 14:54:22 -0400] matti: jforest: And don't be an tarball-boy.
[2013-05-03 14:54:29 -0400] matti: jforest: Nothing worse than execute abuse.
[2013-05-03 14:54:33 -0400] jforest: matti: it's a package called liferay
[2013-05-03 14:54:38 -0400] jforest: stupid cms
[2013-05-03 14:54:45 -0400] zaargy: lol what matti said
[2013-05-03 14:54:49 -0400] matti: jforest: Still, grab FPM.
[2013-05-03 14:54:50 -0400] jpluscplusm: every execute is a sign UR DOIN IT RONG
[2013-05-03 14:54:57 -0400] jpluscplusm: ;-)
[2013-05-03 14:55:01 -0400] yfeldblum: false
[2013-05-03 14:55:16 -0400] zts: jforest: if you haven't seen it, you might want to take a look at the ark resource: http://ckbk.it/ark
[2013-05-03 14:55:26 -0400] zaargy: as long as it idempotent execute really
[2013-05-03 14:55:46 -0400] jforest: zts: I had not seen ark
[2013-05-03 14:55:50 -0400] zaargy: although to be regareded with suspicion :P
[2013-05-03 14:55:51 -0400] matti: zaargy: I've seen Puppet / Chef thigs being a big massive shell script, really.
[2013-05-03 14:55:58 -0400] zaargy: oh yeah i've seen that too
[2013-05-03 14:55:58 -0400] matti: zaargy: Induces IBS in me.
[2013-05-03 14:56:09 -0400] zaargy: exec { "./configure --prefix":
[2013-05-03 14:56:11 -0400] matti: LOL
[2013-05-03 14:56:12 -0400] jforest: yes, idempotency is important
[2013-05-03 14:56:14 -0400] matti: NO.
[2013-05-03 14:56:25 -0400] matti: zaargy: I will have nightmares now ;d
[2013-05-03 14:56:36 -0400] matti: zaargy: Bill for the shrink goes to you ;p
[2013-05-03 14:57:21 -0400] jforest: zts, it seems I need ark :put
[2013-05-03 14:57:28 -0400] jforest: that seems exactly like what I need :)
[2013-05-03 14:57:32 -0400] matti: ;]
[2013-05-03 14:57:34 -0400] matti: jforest: ;]
[2013-05-03 14:58:02 -0400] zaargy: matti: i would say it's pretty common in chef though (like you often see that stuff in opscode cookbooks even)
[2013-05-03 14:58:11 -0400] zaargy: that's why i think of chef as being more practical
[2013-05-03 14:58:23 -0400] jforest: oh wait, one last question
[2013-05-03 14:58:28 -0400] zaargy: it gets in your way less than puppet (but puppet is probably cleaner in some respects)
[2013-05-03 14:58:28 -0400] jforest: will this work with chef-solo :)
[2013-05-03 14:59:14 -0400] zts: jforest: yup, it sure will!
[2013-05-03 15:02:23 -0400] matti: zaargy: With all due respect to OpsCode.
[2013-05-03 15:02:29 -0400] matti: zaargy: Their community cookbooks are ...
[2013-05-03 15:02:32 -0400] matti: ;]
[2013-05-03 15:02:45 -0400] matti: zaargy: They are actually dangerous to run sometimes.
[2013-05-03 15:03:01 -0400] jforest: zts: how do use this in my other cookbooks?
[2013-05-03 15:03:09 -0400] jforest: is there a manual somehwere on this?
[2013-05-03 15:03:22 -0400] zaargy: matti: well pretty hard problem here - supporting everyone ever
[2013-05-03 15:03:48 -0400] zaargy: read them and test them not in prod and it's fine
[2013-05-03 15:03:52 -0400] zts: jforest: in any cookbook using it, you should have "depends 'ark'" in the metadata.rb
[2013-05-03 15:03:55 -0400] matti: zaargy: Puppet community things tend to be more sensible.
[2013-05-03 15:04:02 -0400] jforest: zts, cool.
[2013-05-03 15:04:03 -0400] matti: zaargy: More Ops people working on them.
[2013-05-03 15:04:07 -0400] jforest: zts: thanks!
[2013-05-03 15:04:13 -0400] zaargy: at least when you import a chef cookbook, it won't be barf because yu already have a resource defined in one of your existing cookbooks
[2013-05-03 15:04:15 -0400] zts: jforest: you'll probably also want to have "include_recipe 'ark'" in the recipe using it - ark's default recipe does some stuff to make sure its dependencies are installed
[2013-05-03 15:04:20 -0400] matti: zaargy: Chef is often a lot done by developers, who often have no fucking clue.
[2013-05-03 15:04:33 -0400] zaargy: matti: you know you're in #chef right? :)
[2013-05-03 15:04:38 -0400] zts: jforest: that's a good question which should be documented, although I'm not sure whether there's a good place to point to in the docs
[2013-05-03 15:04:39 -0400] matti: zaargy: Yes, but it will still fuck you up ;]
[2013-05-03 15:04:42 -0400] zaargy: haha
[2013-05-03 15:04:51 -0400] matti: zaargy: Try to name executes or something the same and then use notify ;]
[2013-05-03 15:04:58 -0400] zts: jforest: in general, those two steps are what you'll need when you're using a resource provided by another cookbook
[2013-05-03 15:05:15 -0400] matti: zaargy: I am speaking the truth.
[2013-05-03 15:05:23 -0400] aruntomar: anyone using haproxy cookbook?
[2013-05-03 15:05:29 -0400] jpluscplusm: matti's not wrong
[2013-05-03 15:05:50 -0400] matti: Thanks, jpluscplusm.
[2013-05-03 15:05:51 -0400] matti: ;]
[2013-05-03 15:05:53 -0400] zaargy: aruntomar: yup
[2013-05-03 15:05:59 -0400] jforest: zts: tahnks again
[2013-05-03 15:06:03 -0400] jforest: I will try this out :)
[2013-05-03 15:06:15 -0400] zaargy: matti: i dont disagree really - see above
[2013-05-03 15:06:15 -0400] zts: I'm still hanging out for examples of which opscode-maintained cookbooks are "dangerous", vs "do things that I'd prefer them not to do"
[2013-05-03 15:06:18 -0400] matti: zaargy: :)
[2013-05-03 15:06:21 -0400] matti: zaargy: I know ;]
[2013-05-03 15:07:17 -0400] jpluscplusm: zts: from a few hours ago? http://tickets.opscode.com/browse/COOK-2867
[2013-05-03 15:08:10 -0400] zts: jpluscplusm: hah!  I'll give you that one :)
[2013-05-03 15:08:23 -0400] zaargy: i love the punchline at the end lol
[2013-05-03 15:09:09 -0400] aruntomar: zaargy: i've a query. say, i had to bootup extra 10 web servers to handle sudden surge in the traffic. All the nodes will have a "webserver" role. so after the deployment of these new webservers, haproxy can find them and add them after say 30 min, but how do we tell haproxy node to run chef-client automatically immediately after these web servers are deployed.
[2013-05-03 15:09:55 -0400] yfeldblum: aruntomar, with `ssh $LB_NODE ; sudo chef-client`
[2013-05-03 15:10:02 -0400] jpluscplusm: aruntomar: you're trying to do orchestration, which is an mcollective/rundeck/etc/etc thing, not a chef thing
[2013-05-03 15:11:07 -0400] jpluscplusm: the simple answer is "whatever you told to instantiate the new boxes" and, as you're running HAProxy, it won't matter if you put them into its config too soon. Well, as long as you have a decent healthcheck setup.
[2013-05-03 15:11:08 -0400] zaargy: aruntomar: you need to receive an event when you provision new servers, which you can then act upon basically
[2013-05-03 15:12:17 -0400] aruntomar: jpluscplusm: k, i'll look into rundeck/mcollective. have heard of it, but haven't used it yet. looks like now is a good time to try it out.
[2013-05-03 15:13:11 -0400] zaargy: there are various solutions to this - none of which are particularly elegant
[2013-05-03 15:13:18 -0400] zaargy: for such dynamic data, i find that cm breaks down really
[2013-05-03 15:13:35 -0400] jpluscplusm: aruntomar: they're both non-trivial tools; if you're only solving this one problem in this one place, you can probably hack something in faster than getting going with the "right" way of doing it
[2013-05-03 15:13:35 -0400] zaargy: you want a lb with a good api that you can add and remove stuff from really quickly
[2013-05-03 15:13:39 -0400] zaargy: haproxy has a socket interface but even then
[2013-05-03 15:13:44 -0400] jpluscplusm: zaargy: agreed to the CM comment
[2013-05-03 15:13:55 -0400] jpluscplusm: zaargy: I don't /believe/ you can add new servers via the socket interface
[2013-05-03 15:14:00 -0400] jpluscplusm: only en/disable existing ones
[2013-05-03 15:14:01 -0400] jpluscplusm: IIRC
[2013-05-03 15:14:04 -0400] aruntomar: zaargy: so correct me if i'm wrong, maybe i'll have to have a say rabbitmq (pub/sub) listening to events and publish them, and then haproxy will subscribe and act on the event.
[2013-05-03 15:14:20 -0400] jpluscplusm: aruntomar: haproxy will definitely not do that ... /itself/ :-)
[2013-05-03 15:14:24 -0400] jpluscplusm: you'll end up writing something
[2013-05-03 15:14:34 -0400] zaargy: aruntomar: various ways to do it but yeah you could do that
[2013-05-03 15:14:49 -0400] zaargy: or you could have a nagios check and when it detects new servers then provision load balancer etc
[2013-05-03 15:15:27 -0400] behemphi: @zaargy, I have not myself, but have heard any number of folks talking about Zookeeper for that purpose
[2013-05-03 15:15:42 -0400] zaargy: yes but it's quite  heavyweight thing
[2013-05-03 15:15:45 -0400] jpluscplusm: I still maintain that a really solid healthcheck in HAProxy is all you need, so you can poke the new servers into the LB as soon as you have their IPs
[2013-05-03 15:15:46 -0400] zaargy: you have doozerd too
[2013-05-03 15:15:57 -0400] zaargy: but you're going to have to have something to interface between the two
[2013-05-03 15:16:00 -0400] aruntomar: zaargy: i've been using zabbix, but lately with all the dynamic infra involved, i'm more inclined to give sensu a try.
[2013-05-03 15:16:11 -0400] aruntomar: zaargy: but yes, i get the point.
[2013-05-03 15:16:40 -0400] jpluscplusm: OMG, yes, zabbix is almost less dynamic than nagios; at least nagios can be configured with plain text config files!
[2013-05-03 15:17:35 -0400] aruntomar: jpluscplusm: yes, it's becoming a pain to maintain things there ;)
[2013-05-03 15:18:23 -0400] jpluscplusm: it was a decent choice, N years ago when it filled the hole of monitoring+graphing+trending+alerting all in one relatively decent product
[2013-05-03 15:18:41 -0400] jpluscplusm: but with the drive to decompose those services, it's reached EOL IMHO
[2013-05-03 15:18:50 -0400] haylon: I am trying to start a service using chef's 'service' recipe resouce. Although, the binary for the daemon is not in '/sbin/' its in '/usr/sbin/'. When I start the service manually, it works with 'service zabbix-agent start/stop/restart' Is there something I'm missing from my service block? mhttp://pastebin.com/6x6B86ci
[2013-05-03 15:19:03 -0400] haylon: I am trying to start a service using chef's 'service' recipe resouce. Although, the binary for the daemon is not in '/sbin/' its in '/usr/sbin/'. When I start the service manually, it works with 'service zabbix-agent start/stop/restart' Is there something I'm missing from my service block? http://pastebin.com/6x6B86ci
[2013-05-03 15:20:13 -0400] aruntomar: jpluscplusm: so if one or more of the web servers drop out of the haproxy because of certain error, how are you getting notified (haproxy) or (monitoring) system.
[2013-05-03 15:23:33 -0400] qhartman: I'm using the config / library pattern to override some attributes in a cookbook, but I'm finding that nested attributes are coming through unset if I don't explicitly set them in the config cookbook. Is that expected? Do I need to duplicate all the attributes and then only change the ones I'm interested in?
[2013-05-03 15:24:13 -0400] jpluscplusm: aruntomar: you mean in normal operation, not during your provisioning cycle?
[2013-05-03 15:24:17 -0400] haylon: Is there some command to start or point the service command to the correct directory?
[2013-05-03 15:24:45 -0400] aruntomar: jpluscplusm: yes, normal operations
[2013-05-03 15:24:46 -0400] jforest: Recipe Compile Error in /var/chef-solo/cookbooks/ark/resources/default.rb
[2013-05-03 15:24:47 -0400] jforest: boooo
[2013-05-03 15:24:54 -0400] jpluscplusm: aruntomar: I'd expect whatever was monitoring the syslog output of the haproxy daemon to pick up the "server foobarbaz is DOWN!" message that it'll send
[2013-05-03 15:25:06 -0400] jforest: wrong number of arguments (2 for 1)
[2013-05-03 15:25:08 -0400] jforest: blar
[2013-05-03 15:25:51 -0400] aruntomar: jpluscplusm: ok
[2013-05-03 15:26:37 -0400] jpluscplusm: HAP's health checking is the main reason for running it in conjunction with, say, nginx, IMHO
[2013-05-03 15:26:50 -0400] jpluscplusm: if you're just using it to spread load, ngixn upstreams will suffice
[2013-05-03 15:27:07 -0400] jpluscplusm: check out HAP's "observe layer4" setting too
[2013-05-03 15:30:56 -0400] haylon: I am trying to start a service using chef's 'service' recipe resouce. Although, the binary for the daemon is not in '/sbin/' its in '/usr/sbin/'. When I start the service manually, it works with 'service zabbix-agent start/stop/restart' Is there something I'm missing from my service block? http://pastebin.com/6x6B86ci
[2013-05-03 15:36:01 -0400] crackmac: Good morning Chefs
[2013-05-03 15:36:21 -0400] crackmac: anyone know if the Jamie code has been merge into test-kitchen yet?
[2013-05-03 15:36:47 -0400] aruntomar: jpluscplusm: thanks for the info. will certainly try out the suggestions that you gave.
[2013-05-03 15:39:50 -0400] jforest: any idea when chef-11.4.4 will be updated to work properly on ruby 1.8.7?
[2013-05-03 15:40:00 -0400] jforest: https://github.com/opscode/chef/pull/734
[2013-05-03 15:40:37 -0400] jforest: looks like it's "fixed" but the version of chef I have installed via gems is 11.4.4...
[2013-05-03 15:40:47 -0400] jforest: and I just built that machine an hour ago?
[2013-05-03 15:41:05 -0400] haylon: I am trying to start a service using chef's 'service' recipe resouce. Although, the binary for the daemon is not in '/sbin/' its in '/usr/sbin/'. When I start the service manually, it works with 'service zabbix-agent start/stop/restart' Is there something I'm missing from my service block? http://pastebin.com/6x6B86ci
[2013-05-03 15:45:26 -0400] haylon: No love? I am trying to start a service using chef's 'service' recipe resouce. Although, the binary for the daemon is not in '/sbin/' its in '/usr/sbin/'. When I start the service manually, it works with 'service zabbix-agent start/stop/restart' Is there something I'm missing from my service block? http://pastebin.com/6x6B86ci
[2013-05-03 15:46:18 -0400] jforest: I guess I'll just install 11.4.0
[2013-05-03 15:46:19 -0400] jforest: for now
[2013-05-03 15:46:51 -0400] jpluscplusm: haylon: I think you'll have better luck by showing things like why you think it's not working; what a debug/verbose run looks like; etc etc
[2013-05-03 15:47:22 -0400] jforest: but that doesn't really help me as I'm using a bunch of userdata code to spin these instances up on aws
[2013-05-03 15:47:35 -0400] jforest: I can change the version of that install, but then newer versions will never be used
[2013-05-03 15:47:40 -0400] haylon: jpluscplusm: There is no error with teh cookbook run, it actaully finished with no errors
[2013-05-03 15:47:41 -0400] jpluscplusm: if it magically starts working when you temporarily symlink into the other location, then it's a problem with your init script, not with what chef's doing with it
[2013-05-03 15:48:11 -0400] jpluscplusm: on the node, what does "service zabbix-agent status" tell you?
[2013-05-03 15:48:53 -0400] haylon: jpluscplusm: Zabbix_agentd is stopped
[2013-05-03 15:49:22 -0400] jpluscplusm: pastebin a verbose & debug converge log
[2013-05-03 15:49:46 -0400] haylon: jpluscplusm: wehre woud I find that log?
[2013-05-03 15:50:27 -0400] jpluscplusm: wherever you told it to log to, after also turning up the logging verbosity ;-)
[2013-05-03 15:50:43 -0400] jpluscplusm: in /etc/chef/client.rb IIRC
[2013-05-03 15:53:25 -0400] haylon: jpluscplusm: http://pastebin.com/RmiHTtj4
[2013-05-03 15:54:18 -0400] jpluscplusm: yeah, I meant the chef client verbose&debug log :)
[2013-05-03 15:54:48 -0400] haylon: jpluscplusm: how would I get that?
[2013-05-03 15:55:20 -0400] jpluscplusm: by telling it to log verbosely in client.rb, and telling it to log to STDOUT. Or wherever, really, that's just easiest IME
[2013-05-03 15:57:56 -0400] prana: I'm poking around the opscode thrift cookbook and want to add support for 0.7.0; the 0.7.0 tarball (moronically) doesn't have +x set on its configure script. Would it be worth conditioning chmod +x on that somehow? Or just patch the install_thrift resource to always chmod +x?
[2013-05-03 15:58:36 -0400] tesmar: hi all, what is the best way to keep up with a YUM repo that releases new versions all the time and the official repo lags behind?
[2013-05-03 15:58:58 -0400] tesmar: for ex: the IUS repo is at version 11 and the official YUM package by opscode specifies 10
[2013-05-03 15:59:30 -0400] haylon: jpluscplusm: In the client.rb, the line log_level :info, chance :info to :verbose ?
[2013-05-03 15:59:37 -0400] jpluscplusm: debug, IIRC
[2013-05-03 16:00:36 -0400] jpluscplusm: and then if you run the client with -v, you'll see it on STDOUT as well as wherever you config'd in the file
[2013-05-03 16:00:50 -0400] jpluscplusm: sorry, -V
[2013-05-03 16:01:04 -0400] jpluscplusm: actually, just run chef-client <your normal params> -V -l debug
[2013-05-03 16:04:27 -0400] haylon: jpluscplusm: changed my log_level to :debug, reloaded my cookbook, and reran it, but i still got the same standard error. I shall paste what I have anyways
[2013-05-03 16:04:42 -0400] jpluscplusm: ok
[2013-05-03 16:05:00 -0400] jpluscplusm: then compare with stdout when you add "-V -l debug" to your normal params
[2013-05-03 16:06:55 -0400] haylon: jpluscplusm: so, it would be 'chef-client -V -l debug' ?
[2013-05-03 16:07:36 -0400] jpluscplusm: according to the docs I see here, yes
[2013-05-03 16:13:01 -0400] MrBIOS: I'm in SSL cert hell with the omnibus chef/knife install on OS X
[2013-05-03 16:13:04 -0400] MrBIOS: grr
[2013-05-03 16:13:25 -0400] MrBIOS: using knife-sl (Softlayer) plug-in, and it's failing to validate their SSL cert, which is in fact very much valid
[2013-05-03 16:14:16 -0400] jpluscplusm: MrBIOS: what URI?
[2013-05-03 16:14:35 -0400] MrBIOS: one sec
[2013-05-03 16:14:39 -0400] haylon: jpluscplusm: The verbose output is saying that the service has started [OK] but when I do a 'ps -e | grep zab' I see nothing.
[2013-05-03 16:14:39 -0400] MrBIOS: let me figure it out
[2013-05-03 16:15:06 -0400] Th0th: did an install of chef-server on debian stable recently, and all the ruby was to old, so now I'm installing rvm and updating, any recommendation should I use 2 or 1.9.3?
[2013-05-03 16:15:34 -0400] jpluscplusm: haylon: according to the zabbix agent log you posted, it's getting a sigterm at some point; if you can figure out what is giving it that, you'll move forward
[2013-05-03 16:16:38 -0400] MrBIOS: @jpluscplusm I'm not sure how to make it print the URL
[2013-05-03 16:16:42 -0400] MrBIOS: tcpdump, I guess
[2013-05-03 16:16:49 -0400] jpluscplusm: not behind ssl, no
[2013-05-03 16:17:54 -0400] MrBIOS: @jpluscplusm api.softlayer.com.https
[2013-05-03 16:18:01 -0400] jpluscplusm: wat?
[2013-05-03 16:19:07 -0400] jpluscplusm: making the obvious change to that, yeah it's valid according to my UA
[2013-05-03 16:19:16 -0400] jpluscplusm: do you have the correct root certs on the box you're using?
[2013-05-03 16:21:04 -0400] MrBIOS: jpluscplusm: I do but apparently there are issues with validating root certs on OS X when using the omnibus installer
[2013-05-03 16:21:32 -0400] MrBIOS: supposedly there was some workaround to set an explicit path to a cert
[2013-05-03 16:21:33 -0400] MrBIOS: but
[2013-05-03 16:21:59 -0400] MrBIOS: Something that Ruby's net/http honors
[2013-05-03 16:22:01 -0400] MrBIOS: I haven't had any luck in setting it.
[2013-05-03 16:22:23 -0400] MrBIOS: thanks for playing :D
[2013-05-03 16:23:10 -0400] jpluscplusm: np :)
[2013-05-03 16:23:47 -0400] haylon: jpluscplusm: waaayyyy at the bottom, there is the block about the service zabbix-agent start, but I'm either not seein gsomethign right, or I'm just not seeing it. http://pastebin.com/jwYU7WfN
[2013-05-03 16:25:42 -0400] jpluscplusm: haylon: what does "ps aux | grep -i zabbix" show, versus "service zabbix-agentd status" (or whatever the service is called)?
[2013-05-03 16:26:11 -0400] jpluscplusm: hang on hang on - are you sure you're not getting zabbix-agent mixed up with zabbix-agentd?
[2013-05-03 16:26:33 -0400] haylon: just shows the find command I used to find the binary, and the grep command
[2013-05-03 16:26:46 -0400] haylon: omfg
[2013-05-03 16:26:54 -0400] jpluscplusm: "agentd" is, IIRC, the long-lived agent; "agent" is the one suitable for inetd use
[2013-05-03 16:26:55 -0400] haylon: if thats it, i'm jumping out my window
[2013-05-03 16:27:30 -0400] jpluscplusm: I think it is tho :-D
[2013-05-03 16:28:06 -0400] Th0th: why doesn't chef server use the ruby from rvm in chef's home? (/var/lib/chef)
[2013-05-03 16:28:37 -0400] haylon: jpluscplusm: when I issued the service zabbix-agentd start, no dice. but the service zabbix-agent start does.
[2013-05-03 16:28:57 -0400] jpluscplusm: remember they look at different config files, named after themselves ...
[2013-05-03 16:29:10 -0400] haylon: what do you mean?
[2013-05-03 16:29:31 -0400] jpluscplusm: zabbix-agent looks at /etc/zabbix/(zabbix-?)agent.conf
[2013-05-03 16:29:36 -0400] jpluscplusm: zabbix-agentd looks at /etc/zabbix/(zabbix-?)agentd.conf
[2013-05-03 16:29:50 -0400] jpluscplusm: what *binary* does your zabbix-agent init script reference?
[2013-05-03 16:30:14 -0400] haylon: jpluscplusm: checking....
[2013-05-03 16:31:08 -0400] mml: how do i run an individual recipe on the client, but also have access to node attributes?
[2013-05-03 16:31:43 -0400] jpluscplusm: mml: chef-apply, I /think/
[2013-05-03 16:31:46 -0400] jpluscplusm: never used it tho
[2013-05-03 16:31:51 -0400] mml: hmm
[2013-05-03 16:32:45 -0400] djustin: mml node attributes can be use like    variable = node[:attributenameonnode]
[2013-05-03 16:33:19 -0400] mml: djustin: yah, but when i chef-client -s recipe[name], all the node data is unavailable
[2013-05-03 16:33:34 -0400] haylon: jpluscplusm: in my /etc/init.d/zabbix-agent script, there is a commented line saying wehre it looks for the config file. The zabbix_agentd.conf file is in the /etc/zabbix/ directory, but the file is -rw-r--r-- root root, should I change the permissions?
[2013-05-03 16:33:57 -0400] jpluscplusm: haylon: until you can get to the point where "service zabbix-WHATEVER start; sleep 10 ; ps uax | grep -i zabb[i]x" shows you a running agent/agentd, then none of your problems are chef-related
[2013-05-03 16:34:08 -0400] mml: er, -o not -s
[2013-05-03 16:34:15 -0400] haylon: blarg.
[2013-05-03 16:34:22 -0400] djustin: mml, maybe try a node search?
[2013-05-03 16:34:23 -0400] jpluscplusm: haylon: no, that file is not the problem; its readable by the agent process
[2013-05-03 16:34:31 -0400] haylon: ok, so i'll look at the zabbix program then.
[2013-05-03 16:34:33 -0400] jpluscplusm: you might want to tighten it up later, perhaps
[2013-05-03 16:35:00 -0400] jpluscplusm: haylon: start by killing the agent process and removing the pid file; that can be annoying IIRC
[2013-05-03 16:35:01 -0400] djustin: search(:node, "*:*") do |n|
[2013-05-03 16:35:03 -0400] haylon: for now, until i figure it out, I'll just run a execute block in my recipe so it runs that command
[2013-05-03 16:35:13 -0400] haylon: ok
[2013-05-03 16:35:53 -0400] mml: ah, derp, just needed to set -N
[2013-05-03 16:38:32 -0400] haylon: jpluscplusm: it is a permissions denied issue on the zabbix_agentd.conf
[2013-05-03 16:38:37 -0400] haylon: and that command you did
[2013-05-03 16:38:52 -0400] haylon: will it work on most processes to watch the start up processes?
[2013-05-03 16:39:23 -0400] jpluscplusm: I don't see why agent has a problem with privs on the file, given that it can read it O_o
[2013-05-03 16:39:46 -0400] haylon: # service zabbix-agent start; sleep 10; ps aux | grep -i zab Starting Zabbix agent: zabbix_agentd [7733]: cannot open [/etc/zabbix/zabbix_agentd.conf]: [13] Permission denied                                                            [  OK  ]
[2013-05-03 16:39:54 -0400] gleam: check perms on /etc/zabbix
[2013-05-03 16:39:59 -0400] jpluscplusm: gleam: +1
[2013-05-03 16:40:04 -0400] haylon: checking
[2013-05-03 16:40:05 -0400] gleam: make sure it's +x
[2013-05-03 16:40:17 -0400] haylon: the directory?
[2013-05-03 16:40:21 -0400] gleam: yeah
[2013-05-03 16:40:22 -0400] jpluscplusm: yep
[2013-05-03 16:40:32 -0400] gleam: and i'd also say group readable by the user zabbix drops to
[2013-05-03 16:40:45 -0400] gleam: probably zabbix/zabbix
[2013-05-03 16:41:03 -0400] haylon: # ll /etc/ | grep zab drwxr-xr-x  3 root root    4096 May  2 13:10 zabbix
[2013-05-03 16:41:17 -0400] gleam: well i got nothing
[2013-05-03 16:41:56 -0400] haylon: HOLD UP. woudl it be that I'm running this as root, and since zabbix is not to be ran as root, then...maybe that is causing something
[2013-05-03 16:42:04 -0400] gleam: the init script should drop privileges
[2013-05-03 16:42:09 -0400] haylon: damn.
[2013-05-03 16:42:28 -0400] jpluscplusm: and runs away; have a great weekend all :-)
[2013-05-03 16:42:31 -0400] gleam: also a possibility
[2013-05-03 16:42:32 -0400] haylon: How would I check that?
[2013-05-03 16:42:36 -0400] gleam: damned if i know
[2013-05-03 16:42:43 -0400] haylon: aldkfjagihq4tg
[2013-05-03 16:43:06 -0400] haylon: sparklefarts. k.
[2013-05-03 16:43:58 -0400] haylon: weird. It started before all of this. Now, its not starting at all.
[2013-05-03 16:49:18 -0400] haylon: jpluscplusm: we're sure that i shouldnt do any permissions for it in my chef run?
[2013-05-03 16:49:21 -0400] haylon: gleam:
[2013-05-03 16:51:16 -0400] gleam: my (working) ones are 755 root/root on the dir and 644 root/root on the zabbix_agentd.conf
[2013-05-03 16:51:24 -0400] gleam: what os?
[2013-05-03 16:51:33 -0400] gleam: or distro i should say
[2013-05-03 16:53:57 -0400] haylon: RHEL 5
[2013-05-03 16:55:24 -0400] haylon: the zabbix binaries are also 755 root root
[2013-05-03 17:22:20 -0400] maek: really stupid question but does anyone using private chef know how to start postgres?
[2013-05-03 17:41:04 -0400] jtimberman: maek: private-chef-ctl start postgresql ?
[2013-05-03 17:41:33 -0400] maek: jtimberman: yeah, I was doing pcc postgres[ql] stop/start like pcc keepalived stop/start
[2013-05-03 17:41:34 -0400] maek: ty
[2013-05-03 17:41:39 -0400] maek: but turns out still not my problem :(
[2013-05-03 17:42:27 -0400] deed02392: guys when I do a cookbook site install, it creates the directory, deletes it and then says cannot open or read its metadata.rb
[2013-05-03 17:42:45 -0400] deed02392: to update a cookbook i deleted it, and then tried to re-install it with site install
[2013-05-03 17:42:53 -0400] deed02392: now i can't get it to install
[2013-05-03 17:43:15 -0400] jtimberman: maek: email support@opscode.com and our fine support folks can help get you sorted :)
[2013-05-03 17:43:32 -0400] maek: jtimberman: ty, did :D
[2013-05-03 17:46:56 -0400] mml: is there an idiomatic way to fiugre out role/cluster membership w/ chef, for master-slave clusters of hosts?
[2013-05-03 17:47:08 -0400] mml: i.e. i need my slaves to tell the master who they are
[2013-05-03 17:47:15 -0400] mml: and the  master to reconfigure itself to allow them to be slaves
[2013-05-03 17:47:33 -0400] mml: for isntance, set up psql permissions
[2013-05-03 17:47:36 -0400] mml: for replication
[2013-05-03 17:47:52 -0400] mml: i've heard that tags are useful in such a config
[2013-05-03 18:03:49 -0400] jblaine: mml: Watch the Zookeeper episode of Hangops: http://foodfightshow.org/2013/03/episode-46-zookeeper1.html
[2013-05-03 18:04:19 -0400] jblaine: mml: Zookeeper is ideally the sort of thing you want, unless you run Chef every minute on your cluster notes
[2013-05-03 18:04:35 -0400] jblaine: mml: But you know, added complexity, etc.
[2013-05-03 18:05:12 -0400] jblaine: mml: Other than that, node tags are the way I'd go
[2013-05-03 18:05:29 -0400] jblaine: mml: With as frequent chef runs as allowable
[2013-05-03 18:06:35 -0400] mml: tks
[2013-05-03 18:24:58 -0400] jmickle: anyone in here know pychef module?
[2013-05-03 18:27:36 -0400] mattray: jmickle: coderanger is your man
[2013-05-03 18:27:50 -0400] jmickle: thank you :-)
[2013-05-03 18:41:26 -0400] maplebed: anybody know of a cookbook lying around that will install mediawiki >= 1.20?
[2013-05-03 18:52:32 -0400] jameson_: :( sort of feel good and bad that I will be spending my weekend watching all the missed talks from chefconf
[2013-05-03 18:53:42 -0400] miah: lol
[2013-05-03 18:53:46 -0400] miah: http://www.youtube.com/watch?v=4_Qc-DshHl0
[2013-05-03 18:53:49 -0400] miah: is really good. =)
[2013-05-03 18:55:09 -0400] jmickle: hey miah
[2013-05-03 18:55:15 -0400] jmickle: how are you
[2013-05-03 18:56:31 -0400] miah: hi
[2013-05-03 18:56:37 -0400] miah: im fine
[2013-05-03 18:57:09 -0400] jtimberman: miah: +12 on that talk
[2013-05-03 18:59:46 -0400] jmickle: yeah was an awesome talk
[2013-05-03 19:00:28 -0400] joonas: I need to watch jtimberman's Big Ruby talk
[2013-05-03 19:00:33 -0400] joonas: just noticed it was out
[2013-05-03 19:00:43 -0400] jameson_: they all came out last night I thinks
[2013-05-03 19:01:30 -0400] miah: sad that I didnt meet Joan during the conf either
[2013-05-03 19:01:42 -0400] jameson_: at least the talks.
[2013-05-03 19:01:58 -0400] jmickle: I at least got to say hi to Miah, I didn't find jtimberman
[2013-05-03 19:02:17 -0400] jmickle: was a really good conference
[2013-05-03 19:02:25 -0400] jmickle: i spent the first night in the ER though which sucked :(
[2013-05-03 19:21:09 -0400] miah: doh. why?
[2013-05-03 19:21:40 -0400] jmickle: on the flight into SFO i got some crazy sinus infection
[2013-05-03 19:21:43 -0400] jmickle: that just knocked me out
[2013-05-03 19:22:00 -0400] jmickle: had an excruciating headache that felt like i had head trauma or something
[2013-05-03 19:32:08 -0400] miah: wow
[2013-05-03 19:35:37 -0400] Wildahunden: Does anyone know where to find the "tuning" cookbook.  Trying to use zookeeper_cluster which needs hadoop_cluster which needs tuning.  It doesn't show up in a search of cookbooks on the community site.
[2013-05-03 19:36:32 -0400] dysinger: my maven minitest fails because the maven cookbook installs maven into /usr/local/maven-3.0.5 and adds that to the _end_ of the PATH in /etc/profile.d/  - If you accidentally have the debian/ubuntu maven2 package installed it takes over.
[2013-05-03 19:37:17 -0400] dysinger: jtimberman: couldn't we put our desired maven on the beginning of the path?
[2013-05-03 19:38:12 -0400] MattJ: Can anyone suggest what "412 Precondition Failed" might mean from chef-client?
[2013-05-03 19:38:15 -0400] maplebed: Wildahunden: which zookeeper cookbok are you using?
[2013-05-03 19:39:09 -0400] Wildahunden: zookeeper_cluster
[2013-05-03 19:39:21 -0400] maplebed: from the community site?
[2013-05-03 19:39:40 -0400] maplebed: it's old; you probably want to get the current version from the ironfan github repo.
[2013-05-03 19:40:08 -0400] maplebed: there's a copy of teh tuning cookbook there too: https://github.com/infochimps-labs/ironfan-pantry/tree/master/cookbooks/tuning
[2013-05-03 19:40:11 -0400] Wildahunden: started with solr_app then started downloading dependencies
[2013-05-03 19:40:26 -0400] maplebed: but there are a bunch of changes that make it messy if you don't get all new versions.
[2013-05-03 19:40:48 -0400] maplebed: IIRC metachef, silverware, and one other are a little odd.
[2013-05-03 19:41:24 -0400] Wildahunden: I'm new in the community and thought the latest would be there.
[2013-05-03 19:41:45 -0400] maplebed: sadly not in this case.
[2013-05-03 19:42:20 -0400] Wildahunden: ty.  I'll get latest from ironfan github.  Hopefully all the other cookbooks that are required are current ;)
[2013-05-03 19:42:31 -0400] maplebed: you'll have to get a slew from ironfan.
[2013-05-03 19:43:05 -0400] maplebed: one sec and I can get a list for you if you'd like.
[2013-05-03 19:43:15 -0400] Wildahunden: that would be very helpful
[2013-05-03 19:43:51 -0400] maplebed: volumes, silverware, zookeeper, tuning, metachef, hadoop_cluster, and minidash.  I think everything else can come from the community site.
[2013-05-03 19:45:05 -0400] maplebed: you'll also have to create a wrapper around the zookeeper cookbook and set some volume stuff in attributes.
[2013-05-03 19:46:06 -0400] Wildahunden: thx, great help!  I'll jump in have some fun :)
[2013-05-03 19:49:27 -0400] ianco: ++++++++777
[2013-05-03 19:49:41 -0400] ianco: 99999999999999999999999999999999999997
[2013-05-03 19:49:47 -0400] maplebed: cat-detector triggered.
[2013-05-03 19:50:24 -0400] ianco:  l/l;mm    ~99999999999999999999999999999999999997+
[2013-05-03 19:51:23 -0400] dysinger: I wonder if there's a way to get ark to PRE-pend the PATH entry because this https://github.com/opscode-cookbooks/maven/blob/master/recipes/default.rb#L33 isn't going to work if packaged ubuntu maven comes along and gets installed
[2013-05-03 19:51:28 -0400] dysinger: jtimberman: ^
[2013-05-03 19:56:40 -0400] HarvesterOfBeer: ohai! Is there a way to pass an attribute to a chef-client run WITHOUT having it be added to the node permanently?
[2013-05-03 19:56:57 -0400] basic`: how does one handle checking slave replication for nagios with mysql a recipe? a role?  I have the proper nagios plugins installed, but don't know how to manage adding the checks
[2013-05-03 19:57:16 -0400] basic`: er, for mysql with nagios
[2013-05-03 19:57:24 -0400] maplebed: basic`: data bags.
[2013-05-03 19:57:36 -0400] maplebed: then push the logic into the check.
[2013-05-03 19:58:33 -0400] basic`: maplebed: ya, that's easy enough but how do i add the server to the nagios check?
[2013-05-03 19:58:50 -0400] basic`: not all mysql hostgroup's are going to have replication
[2013-05-03 19:59:39 -0400] maplebed: ah. I have it check all of them and if slaving isn't configured (different from not working), it just returns OK.
[2013-05-03 19:59:49 -0400] maplebed: then the check just applies to the 'mysql' role (aka hostgroup)
[2013-05-03 20:00:02 -0400] basic`: ooh, i thougth the check would fail, let me try that
[2013-05-03 20:00:10 -0400] maplebed: you might need to adjust the check.
[2013-05-03 20:00:17 -0400] basic`: i'm using the percona checks
[2013-05-03 20:00:17 -0400] maplebed: I don't recall.
[2013-05-03 20:00:58 -0400] maplebed: also, the nagios cookbook creates one hostgroup per role, so if there's a replicated role vs. a non-replicated role, you can just apply it to the one.
[2013-05-03 20:01:20 -0400] maplebed: or you can create a custom hostgroup that performs a search through chef to determine membership and choose which hosts to check that way.
[2013-05-03 20:01:35 -0400] maplebed: (the nagios cookbook supports search-based hostgroups)
[2013-05-03 20:01:48 -0400] basic`: yeah, i just have one role right now and i'm manually starting the slaves where they should be started maybe that's a bad approach but we only have a couple mysql clusters
[2013-05-03 20:02:12 -0400] maplebed: afk for a bit.
[2013-05-03 20:02:13 -0400] basic`: i just dont know how i would start the slave through chef
[2013-05-03 20:02:22 -0400] basic`: so for now there is no role
[2013-05-03 20:16:49 -0400] CharlieSu: Anyone know if there is a LWRP or anything else for working with IAM Roles on EC2 instances?  Would be great to integrate w/ s3_file
[2013-05-03 20:18:46 -0400] jameson_: that would be nice, but you might have to roll your own :3
[2013-05-03 20:19:28 -0400] jameson_: CharlieSu: are you trying to do IAM roles for getting key, secret, token?
[2013-05-03 20:19:55 -0400] CharlieSu: jameson_: yes..
[2013-05-03 20:20:44 -0400] CharlieSu: jameson_: very easy to do from the instance..      iam_json = JSON.parse(URI("http://169.254.169.254/latest/meta-data/iam/security-credentials/production-sftp").open.read)
[2013-05-03 20:22:41 -0400] jameson_: CharlieSu: I think it's done..
[2013-05-03 20:22:45 -0400] jameson_: by Ohai
[2013-05-03 20:22:55 -0400] jameson_: so it should be in your node[] info
[2013-05-03 20:23:58 -0400] CharlieSu: jameson_: nice.. i'll take a look.. thanks
[2013-05-03 20:24:10 -0400] jameson_: CharlieSu: look for ec2_metadata
[2013-05-03 20:26:21 -0400] CharlieSu: jameson_: perfect, thanks!
[2013-05-03 20:26:39 -0400] jameson_: CharlieSu: I am doing the same thing ;)
[2013-05-03 20:27:00 -0400] CharlieSu: jameson_: I didn't realize it was baked into Ohai.  seems like the proper place for it anyways..
[2013-05-03 20:28:58 -0400] jameson_: It was baked in recently.
[2013-05-03 20:29:02 -0400] jameson_: "recently"
[2013-05-03 20:29:37 -0400] joshhertz: When authoring a recipe is it possible to have an OR when checking for a runlist entries? For example if node.run_list.include?("role[foo]" OR "role[bar]")
[2013-05-03 20:32:02 -0400] behemphi: I think I would do that by iterating the roles (there can be more than one) and setting flags in the attributes if I found those in the list.  Then I could perform the logic I wanted whenever I wanted.
[2013-05-03 20:32:25 -0400] behemphi: Like do this in default attributes file itself
[2013-05-03 20:33:12 -0400] joshhertz: I'm actually thinking there might be an easier way to get what I want. Rename the bar role to something like foo2 and use a wildcard in the statement.
[2013-05-03 20:33:20 -0400] joshhertz: if node.run_list.include?("role[foo*]")
[2013-05-03 20:33:31 -0400] joshhertz: will hit roles foo and foo2
[2013-05-03 20:33:33 -0400] jameson_: are you trying to do master/slave?
[2013-05-03 20:33:46 -0400] behemphi: Well @joshhertz then ask yourself if the roles have descriptive names
[2013-05-03 20:33:48 -0400] jessicab1: you could also probably just do if node.run_list.include?("role
[2013-05-03 20:33:54 -0400] behemphi: and if your code will read will for the person following you
[2013-05-03 20:34:04 -0400] jessicab1: you could also probably just do if node.run_list.include?("role") || node.run_list.include?("role2")
[2013-05-03 20:34:19 -0400] behemphi: s/will/well
[2013-05-03 20:35:07 -0400] behemphi: If you are only reading them once for a specific purpose I agree with @jessicab1
[2013-05-03 20:35:25 -0400] joshhertz: I'm applying a monitoring templates to similar roles. Instead of outlining the same monitoring templates for each role explicitly I'm looking for a way to catch roles that are similar.
[2013-05-03 20:35:45 -0400] behemphi: what about tags?
[2013-05-03 20:35:47 -0400] joshhertz: jessicab1 I'll try that. Since isn't more explicit than wildcards. Thanks
[2013-05-03 20:35:53 -0400] behemphi: a tag that says: MonitorMe
[2013-05-03 20:36:52 -0400] joshhertz: well, I have different roles that need different monitors. I have several roles that require JMX monitoring but are running different JVMs, hense the different roles.
[2013-05-03 20:37:09 -0400] joshhertz: I could tag "Monitor JVM' I suppose .
[2013-05-03 20:37:16 -0400] CharlieSu: jameson_: what s3_file resource are you using?
[2013-05-03 20:37:41 -0400] dysinger: I'm having to purge the maven package because of ark's choice to put everything at the end of the PATH in /etc/profile.d.  I would rather not have packages-maybe-installed as an issue. Totally not idempotent :/
[2013-05-03 20:38:16 -0400] behemphi: I am not a java guy but I am nearly certain oyu could query Ohai data to see what version of the JVM is on the machine
[2013-05-03 20:38:22 -0400] behemphi: and make a decision there
[2013-05-03 20:38:31 -0400] behemphi: that way if you upgrade the JVM the monitoring will follow
[2013-05-03 20:39:33 -0400] joshhertz: jessicab1: that worked outstanding. Thanks
[2013-05-03 20:39:45 -0400] jessicab1: nice! glad to hear
[2013-05-03 20:39:46 -0400] jameson_: CharlieSu: the one from gist by pepplin
[2013-05-03 20:40:00 -0400] jameson_: CharlieSu: I use it to load our deployment code package.
[2013-05-03 20:40:01 -0400] bixu: Is there a known issue with /var/log/chef/client.log and using the --fork option for the chef-client daemon?
[2013-05-03 20:40:31 -0400] joshhertz: behemphi I think using the roles to explicitly identify the JVMs makes it clearer to any other person that looks at the code.
[2013-05-03 20:40:49 -0400] dysinger: purging packages is grrr because it may not always work.
[2013-05-03 20:41:21 -0400] jameson_: CharlieSu: and I think we load the metadata into a config file for our application.. which I think is wrong, but doesn't break because we do CD so the credentials gets updated often enough.
[2013-05-03 20:41:31 -0400] jessicab1: joshhertz: i havent seen anything in ohai related to jvms, but we set attributes whenever we setup a jvm.. you could also just query for attributes if you do something similar, like using has_key? makes it a bit easier to get more specific info on the jvm if its needed
[2013-05-03 20:41:59 -0400] CharlieSu: jameson_: URL for the gist?
[2013-05-03 20:42:22 -0400] jameson_: CharlieSu: https://gist.github.com/peplin/470321
[2013-05-03 20:43:14 -0400] CharlieSu: thx
[2013-05-03 20:43:17 -0400] jameson_: http://tickets.opscode.com/browse/CHEF-1089
[2013-05-03 20:43:22 -0400] jameson_: for reference.
[2013-05-03 20:44:00 -0400] jameson_: I didn't realize that wasn't being added into the AWS cookbook..
[2013-05-03 20:50:41 -0400] kallan: I am looking for some help from anyone who might know a little something about Windows. Any takers?
[2013-05-03 20:57:03 -0400] troyready: kallan, I probably don't know  any helpful answers but we do a bit with Chef on Windows and I can try to assist
[2013-05-03 20:57:19 -0400] kallan: okay cool
[2013-05-03 20:57:37 -0400] kallan: its nothing terribly complicated ,I'm unfortunately just stuck without knowing what to do
[2013-05-03 20:59:14 -0400] kallan: What I have is a somewhat poorly managed executeable that runs on my Windows machine. I use an "execute" resource to trigger my exec to start, and what happens is that when the Chef run completes, the process that I started with my "execute" resource is immediately killed. looks a bit like this gist - https://gist.github.com/KAllan357/5513997
[2013-05-03 20:59:48 -0400] kallan: so the correct answer is that this should be managed as a Windows Service.....but lets take that off the table for a moment. Is there any way I can get Chef + Windows to start this process and have it not die when the chef-client / chef-solo process ends?
[2013-05-03 21:00:19 -0400] troyready: Ahhh
[2013-05-03 21:01:27 -0400] troyready: I don't think the built in "execute" resource has any support for forking off a process like that
[2013-05-03 21:01:42 -0400] kallan: at the moment, my batch file does a "cmd /C start /D@file 'path/to/MyThing.exe'" I guess that "start" is sorta a Windows equivalent to "nohup"
[2013-05-03 21:01:44 -0400] kallan: or soemthign like that
[2013-05-03 21:01:47 -0400] jessicab: kallan: ive seen a similar issue on linux and used setsid to solve it.. perhaps theres something similar for windows
[2013-05-03 21:03:04 -0400] troyready: It might not be the absolute right way to do it, but my first thought would be to try to find the right ruby method for forking off the mything.exe process and call that from a ruby_block resource
[2013-05-03 21:04:48 -0400] kallan: interesting
[2013-05-03 21:04:52 -0400] kallan: will have to look into thata bit
[2013-05-03 21:04:54 -0400] kallan: thanks
[2013-05-03 21:05:38 -0400] troyready: But yeah, a batch file that would do the same would work just as well. In any case, you're stuck putting your ideompotence checking (i.e. checking to see if the process is running before starting another) somewhere. Not sure if any particular place would be easier or harder
[2013-05-03 21:07:11 -0400] kallan: right
[2013-05-03 21:09:17 -0400] kallan: good point though. I think Chef brings in the Win32 gem or some part of it perhaps. I guess there might be something to be found in here - http://rubyforge.org/docman/view.php/85/1720/Process.html
[2013-05-03 21:10:33 -0400] ughani: http://tickets.opscode.com/browse/CHEF-2383
[2013-05-03 21:11:01 -0400] ughani: is this even been looked at?
[2013-05-03 21:12:12 -0400] jameson_: @_@
[2013-05-03 21:14:28 -0400] miah: try leaving the trailing slash off
[2013-05-03 21:14:50 -0400] miah: that ticket has no fix attached though
[2013-05-03 21:15:10 -0400] miah: and its not marked as resolved so it will probably sit for some more time until somebody WONTFIX's it
[2013-05-03 21:15:29 -0400] ehlerst: Ughani, why dont you submit a bugfix =)
[2013-05-03 21:16:22 -0400] gchristensen: I have in my code: aggregate_foo_list = node['foo_list']; aggregate_foo_list << node['individual_foo']. this is giving me the Chef::Exceptions::ImmutableAttributeModification exception. is there a way to get the raw array value out of the node which I CAN modify?
[2013-05-03 21:16:29 -0400] gchristensen: I don't want it to be reflected back in the node data.
[2013-05-03 21:19:52 -0400] jtimberman: gchristensen: node['individual_foo'].to_a
[2013-05-03 21:20:10 -0400] jtimberman: as in, aggregate_foo_list = node['foo_list'].to_a
[2013-05-03 21:20:20 -0400] c_t: ooh
[2013-05-03 21:20:38 -0400] gchristensen: ah! thank you, jtimberman
[2013-05-03 21:21:20 -0400] jtimberman: https://gist.github.com/jtimberman/60e8d242a691b0310e5b
[2013-05-03 21:21:37 -0400] jtimberman: chef-shell is the greatest thing ever... for playing around with this kind of thing :)
[2013-05-03 21:22:33 -0400] j00bar: let's say i've got a recipe that uses an include_recipe statement for a recipe in another cookbook. in my recipe, i want a file change to notify a service defined in that other recipe. how do i reference that other recipe's service?
[2013-05-03 21:27:40 -0400] jtimberman: j00bar: use the resources() method.
[2013-05-03 21:28:06 -0400] jtimberman: http://docs.opscode.com/dsl_recipe_method_resources.html
[2013-05-03 21:28:42 -0400] j00bar: so...
[2013-05-03 21:28:46 -0400] cwj: isnt that just if j00bar wants to modify the service resource? to notify it its just naming it the same way you would if the resource were part of the recipe thats including it
[2013-05-03 21:28:59 -0400] j00bar: notifies :restart, resources("service[redis-server]"), :delayed
[2013-05-03 21:29:26 -0400] cwj: notifies :restart, "serivce[redis-server]", :delayed
[2013-05-03 21:29:48 -0400] j00bar: cwj: FATAL: Chef::Exceptions::ResourceNotFound: resource cookbook_file[/etc/redis/redis.conf] is configured to notify resource service[redis-server] with action restart, but service[redis-server] cannot be found in the resource collection.
[2013-05-03 21:30:06 -0400] j00bar: oh.
[2013-05-03 21:30:07 -0400] j00bar: wait.
[2013-05-03 21:30:08 -0400] j00bar: duh.
[2013-05-03 21:30:14 -0400] j00bar: pebkak
[2013-05-03 21:30:15 -0400] j00bar: thx.
[2013-05-03 21:30:41 -0400] cwj: i can see how using resources("service[redis-server]") would work too, but shouldnt be necessary
[2013-05-03 21:36:27 -0400] jameson_: am I weird for saying "lwrp" as "lerp"?
[2013-05-03 21:36:39 -0400] gleam: it's weird that you say it
[2013-05-03 21:37:23 -0400] jameson_: but how does one refernce it?
[2013-05-03 21:37:35 -0400] jameson_: "that should be a lerp"
[2013-05-03 21:37:56 -0400] jameson_: "we should move that attribute into the lerp", "split up that lerp into X, Y"
[2013-05-03 21:40:01 -0400] cwj: i have heard other people say lerp
[2013-05-03 21:40:15 -0400] cwj: i over-pronounce it as el dubya are pee
[2013-05-03 21:40:55 -0400] gleam: you could probably say "provider"
[2013-05-03 21:41:00 -0400] gleam: and people woudln't get confused
[2013-05-03 21:43:52 -0400] jameson_: wouldn't that get confused between the heavy weight provider Chef::Provider::... and myface_thing ?
[2013-05-03 21:46:34 -0400] miah: jameson_: lots of people say 'lerps'
[2013-05-03 21:47:08 -0400] miah: and lwrp's are technically real resources and providers
[2013-05-03 21:50:42 -0400] jameson_: mm.
[2013-05-03 22:02:53 -0400] maplebed: question about the mysql cookbook (but really about any cookbook that installs packages). Should it force an apt-get update run? When doing an isntall in my vagrant box, it tried to install a specific old version that no longer existed in the repo so failed.
[2013-05-03 22:05:12 -0400] monokrome: How is it possible that I'm getting the following issue when trying to deploy to hosted chef?! The file /etc/chef/client.pem or :raw_key option does not contain a correctly formatted private key
[2013-05-03 22:05:25 -0400] monokrome: Hosted Chef didn't deploy a key properly?! >.<
[2013-05-03 22:10:09 -0400] rroblak: does the chef-server ubuntu package contain chef-client?  it looks like it created /etc/chef, which as I understand is a client directory
[2013-05-03 22:11:21 -0400] jhulten: rroblak: Unless you have constraints that prevent it, I would recommend you use the omnibus packages.
[2013-05-03 22:12:02 -0400] jhulten:  /etc/chef is the config directory for both client and server AFAIK
[2013-05-03 22:12:16 -0400] rroblak: jhulten: by ubuntu package I meant the chef-server .deb from "http://www.opscode.com/chef/install/"
[2013-05-03 22:12:42 -0400] rroblak: jhulten: gotcha
[2013-05-03 22:13:31 -0400] jhulten: Ah yes. The right thing then.
[2013-05-03 22:13:53 -0400] rroblak: so I should install both chef-server and chef-client on my server machine?  (from omnibus)
[2013-05-03 22:22:16 -0400] ponyofdeath: hi, I have my default runlist include ntp cookbook. is it possible to exclude only the ntp servers from getting their config overwritten. do I have to do that inside the runbook?
[2013-05-03 22:38:01 -0400] mlf4aiur: Hey all, How to search and download cookbooks on command line, like puppet module search, install
[2013-05-03 22:40:11 -0400] ssd7: mlf4aiur: knife cookbook site install COOKBOOK_NAME
[2013-05-03 22:40:45 -0400] mlf4aiur: How about chef solo?
[2013-05-03 22:42:40 -0400] cheeseplus: mlf4aiur: that just gets them to disk and you can then point chef-solo at that directory
[2013-05-03 22:43:24 -0400] mlf4aiur: thank you
[2013-05-03 22:43:35 -0400] monokrome: How is it possible that Hosted Chef isn't sending my new nodes the proper validation key?!
[2013-05-03 22:43:56 -0400] jkeiser: Hey all, I've just released a prerelease of knife-essentials (diff, upload, download, etc.) with HUGE performance win (3-6x faster), and would like some eyes on it.  gem install knife-essentials --pre if you are interested.
[2013-05-03 22:44:04 -0400] ssd7: monokrome: Can you create a gist or pastebin of what you are seeing?
[2013-05-03 22:44:33 -0400] monokrome: sure, ssd7
[2013-05-03 22:44:35 -0400] cheeseplus: jkeiser: yay
[2013-05-03 22:45:35 -0400] monokrome: ssd7: https://gist.github.com/monokrome/73abe9a29519cc3d9377
[2013-05-03 22:45:52 -0400] jkeiser: The pert, and the reason I want testing, is because I added parallelism :)  You can use the --concurrency=n to adjust the maximum number of simultaneous network requests.  It defaults to 10, beyond which I'm not seeing much benefit on hosted.
[2013-05-03 22:45:57 -0400] jkeiser: s/pert/perf
[2013-05-03 22:47:21 -0400] ssd7: monokrome: On your local chef workstation can you do the following
[2013-05-03 22:47:52 -0400] ssd7: knife client list -k .chef/rentlytics-inc-validator.pem -u rentlytics-inc-validator
[2013-05-03 22:48:02 -0400] jtimberman: maplebed: you should put 'apt' in your node's run list, not in specific cookbooks.
[2013-05-03 22:48:13 -0400] jtimberman: imo
[2013-05-03 22:48:21 -0400] monokrome: Failed to authenticate as rentlytics-inc-validator. Ensure that your node_name and client key are correct
[2013-05-03 22:48:31 -0400] maplebed: and for vagrant / test kitchen / etc., that would go in the :integration section?
[2013-05-03 22:48:57 -0400] jtimberman: maplebed: yeah, in the Berksfile, group :integration cookbook "apt"
[2013-05-03 22:49:01 -0400] monokrome: Is node name supposed to be my client name, ssd7?
[2013-05-03 22:49:02 -0400] ssd7: monokrome: So it definitely seems like the validation key that you have on your disk is wrong.  Might you have regenerated it recently accidently?
[2013-05-03 22:49:06 -0400] maplebed: jtimberman: excellent.  thanks.
[2013-05-03 22:49:11 -0400] jkeiser: This version also will let you view clients, nodes, and users without having to set the repo mode.  Much easier
[2013-05-03 22:49:17 -0400] monokrome: I regerated it, downloaded it, and replaced it
[2013-05-03 22:50:32 -0400] kallan: troyready: I seem to be having no luck. Process.fork is not a thing that exists in Ruby on Windows
[2013-05-03 22:50:34 -0400] ssd7: monokrome: Hrmm.
[2013-05-03 22:50:52 -0400] monokrome: Is node_name supposed to be 'rentlytics-inc-validator'?
[2013-05-03 22:50:53 -0400] kallan: and the win32/process library doesnt seem to be giving me what I need either
[2013-05-03 22:51:17 -0400] monokrome: yes
[2013-05-03 22:51:21 -0400] monokrome: I fixed it by changing node_name
[2013-05-03 22:51:34 -0400] ssd7: kallan: Yeah, as far as I know fork() isn't a system call on Windows
[2013-05-03 22:51:53 -0400] troyready: kallan, ah, bah, sorry for my bad advice
[2013-05-03 22:52:25 -0400] ssd7: kallan: I have no idea what you are doing, but you might want to dig around the mixlib-shellout library to see what it does on windows
[2013-05-03 22:52:25 -0400] kallan: nah its okay
[2013-05-03 22:54:01 -0400] kallan: the TLDR of my problem is that I have an executeable that I cannot turn into a service at the moment for a number of reasons.
[2013-05-03 22:54:28 -0400] kallan: and no matter what I try (like the "execute" resource or a "ruby_block" that uses Process.create()) my executeable stops running as soon as the Chef run ends
[2013-05-03 22:54:44 -0400] kallan: I suppose because the process is tied to Chef and when the Chef run completes, it kills off my process
[2013-05-03 22:57:50 -0400] monokrome: ssd7: Well, that fixed the issue and now I'm back to what I was trying to fix by changing the key :(
[2013-05-03 22:59:13 -0400] monokrome: https://gist.github.com/monokrome/38baab2237a520733eba
[2013-05-03 22:59:29 -0400] ssd7: kallan: Yeah, the unixy way would be the fork,setsid,fork dance (ie, the same things services/daemons do).  Unsure off hand the equivalent on windows
[2013-05-03 23:00:34 -0400] ssd7: monokrome: OK, so you shouldn't ever need to set your node_name to the validator name
[2013-05-03 23:00:41 -0400] monokrome: ssd7: I'm not
[2013-05-03 23:00:48 -0400] monokrome: That's what my bootstrap is doing
[2013-05-03 23:00:52 -0400] ssd7: monokrome: Have you peaked inside your validator pem file and ensured that it looks like a valid key
[2013-05-03 23:00:54 -0400] monokrome: no clue whhy
[2013-05-03 23:01:31 -0400] monokrome: ssd7: No, I don't even know where it's coming from. Shouldn't hosted chef set things up properly?
[2013-05-03 23:01:39 -0400] bjensen: is there a cookbook that allows me to set the private and public ssh keys? Im looking at https://github.com/fnichol/chef-user and it only allows me to set the authorized keys..
[2013-05-03 23:02:02 -0400] monokrome: My same cookbooks/roles/data bags were working on open source chef and now I'm on hosted and it's having a ton of problems
[2013-05-03 23:04:00 -0400] ssd7: monokrome: OK, let's back up.  You should have 2 keys in your .chef folder.  Your user key and your orgs validator key.
[2013-05-03 23:04:44 -0400] ssd7: And both of those should be in the same format
[2013-05-03 23:04:58 -0400] kallan: hm well maybe I just got it to work
[2013-05-03 23:07:42 -0400] monokrome: ssd7: My user key is my validator key
[2013-05-03 23:07:53 -0400] monokrome: oh no never mind
[2013-05-03 23:07:55 -0400] monokrome: I have a different user key
[2013-05-03 23:08:26 -0400] monokrome: That's my client's key right?
[2013-05-03 23:09:00 -0400] ssd7: Your user key is for use with knife.  You're validator key is sent to chef nodes and then is used to create a new client key on bootstrap
[2013-05-03 23:09:41 -0400] monokrome: ok
[2013-05-03 23:09:53 -0400] monokrome: I gave my validator key all permissions
[2013-05-03 23:09:56 -0400] monokrome: Should I have not done that?
[2013-05-03 23:10:40 -0400] ssd7: Well, the only permissions it needs is LIST and CREATE on clients
[2013-05-03 23:10:48 -0400] ssd7: extra permissions shouldn't hurt
[2013-05-03 23:10:50 -0400] monokrome: ok
[2013-05-03 23:11:11 -0400] monokrome: Read and Updaet?
[2013-05-03 23:11:29 -0400] kallan: ssd7: troyready: In case you were curious. I think it was the Process::CREATE_BREAKAWAY_FROM_JOB that got it to work - https://gist.github.com/KAllan357/5513997#comment-825824
[2013-05-03 23:11:31 -0400] ssd7: monokrome: This is unlikely a permissions problem, I wouldn't touch them too much
[2013-05-03 23:12:00 -0400] ssd7: kallan: Nice.
[2013-05-03 23:12:04 -0400] monokrome: ok
[2013-05-03 23:12:23 -0400] monokrome: I think it's because my client_key setting from the downloaded knife.rb is wrong
[2013-05-03 23:12:34 -0400] troyready: Nice, thanks
[2013-05-03 23:16:01 -0400] carllerche: If I change the version of a package resource, l will it upgrade it on servers? And if so, how i can i ensure the service gets restarted?
[2013-05-03 23:16:05 -0400] monokrome: ssd7: Hopefully I have fixed it now
[2013-05-03 23:16:31 -0400] ssd7: monokrome: Sweet!
[2013-05-03 23:19:03 -0400] miah: i've been spending the past two days converting chef cookbooks written to work on Chef 0.6 to Chef 10. =)
[2013-05-03 23:21:15 -0400] monokrome: ssd7: Nope. Still the same problem.
[2013-05-03 23:21:38 -0400] monokrome: I set client_key to the one I just downloaded for my client. I made node_name the name of my client. I kept validator key as the same as I downloaded which is my validator key
[2013-05-03 23:21:45 -0400] monokrome: but it still says the validator key is wrong
[2013-05-03 23:22:30 -0400] monokrome: I SSHd into the server and client.pem is an empty file
[2013-05-03 23:22:37 -0400] monokrome: I don't understand how that part happens
[2013-05-03 23:28:07 -0400] sascha_d: miah that sounds so awesome
[2013-05-03 23:28:25 -0400] sascha_d: I bet you're graveyarding all kinds of curls and bash blocks
[2013-05-03 23:32:39 -0400] monokrome: ssd7: Any idea why the node's /etc/chef/client.pem would be an empty file?
[2013-05-03 23:35:17 -0400] jtimberman: miah: why not chef 11? ;)
[2013-05-03 23:35:34 -0400] jtimberman: sascha_d: which would be totally weird, since chef could remote_file since 0.5.0 :)
[2013-05-03 23:35:44 -0400] sascha_d: doesn't matter
[2013-05-03 23:35:59 -0400] sascha_d: My last client was still curling everything because mod security hates chef
[2013-05-03 23:36:01 -0400] jtimberman: yeah. i know. people will still execute "curl"
[2013-05-03 23:36:39 -0400] sascha_d: or maybe remote file hated embedded auth
[2013-05-03 23:36:42 -0400] sascha_d: I can't remember
[2013-05-03 23:37:05 -0400] sascha_d: I had so many issues getting files out of our apache-fronted collection of stuff
[2013-05-03 23:37:09 -0400] ssd7: monokrome: Hrmm, that is pretty odd, is that happening on a fresh machine?
[2013-05-03 23:38:50 -0400] monokrome: ssd7: Yes, I have knife-rackspace creating a brand new VM and then it runs bootstrap and client.pem is empty on it
[2013-05-03 23:38:56 -0400] monokrome: This is all through hosted chef
[2013-05-03 23:39:26 -0400] carllerche: jtimberman: If I change the version of a package resource, l will it upgrade it on servers? And if so, how i can i ensure the service gets restarted?
[2013-05-03 23:41:31 -0400] ssd7: monokrome: Try blowing away client.pem and then running with debug logging: chef-client -ldebug -j /etc/chef/first-boot.json
[2013-05-03 23:41:41 -0400] ssd7: if it happens again that will hopefully provide some more insight
[2013-05-03 23:44:34 -0400] jtimberman: carllerche: it will upgrade, and whether it restarts the service depends on whether the postinst script of the package does that, or if you want to notify the service to restart when the package resource is updated.
[2013-05-03 23:46:13 -0400] carllerche: jtimberman: the postinst script doesn't seem to start or restart the service, i guess i should do it as a notification
[2013-05-03 23:47:22 -0400] jtimberman: probably
