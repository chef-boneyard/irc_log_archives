[2013-05-20 00:42:08 -0400] flaccid: i'm running into http://community.opscode.com/chat/chef/2012-07-08#id-155900 and http://community.opscode.com/chat/chef/2012-11-01#id-226115 "chpst: fatal: unable to run: unicorn: file does not exist" with application_ruby and unicorn. how to fix?
[2013-05-20 01:05:31 -0400] ssd7: OHai Chefs
[2013-05-20 01:09:12 -0400] flaccid: howdy ssd7
[2013-05-20 01:09:26 -0400] flaccid: you havnt used application_ruby with unicorn before yet heh
[2013-05-20 01:15:50 -0400] ssd7: flaccid: Unfortunately I haven't used it much.
[2013-05-20 01:16:53 -0400] ssd7: Unicorn definitely got installed?
[2013-05-20 01:17:05 -0400] flaccid: looking at the open pull requests it looks like it may be a bug one of those might fix
[2013-05-20 01:17:12 -0400] flaccid: yep its installed
[2013-05-20 01:17:52 -0400] flaccid: 11 open and some are very old https://github.com/opscode-cookbooks/application_ruby/pulls :(
[2013-05-20 01:20:46 -0400] ssd7: Where is unicorn installed to?
[2013-05-20 01:23:58 -0400] ssd7: The advice in your second link there is probably what I would try. Modify templates/default/sv-unicorn-run.erb to set the PATH to something that definitely includes unicorn
[2013-05-20 01:25:14 -0400] ssd7: Headed out for a bit but I should be back around later.
[2013-05-20 01:33:53 -0400] flaccid: right, /opt/vagrant_ruby/bin/unicorn
[2013-05-20 01:33:57 -0400] flaccid: by gem
[2013-05-20 01:34:08 -0400] flaccid: i guess that is the problem
[2013-05-20 01:35:11 -0400] flaccid: i will try a symlink to /usr/bin/unicorn i guess
[2013-05-20 01:40:16 -0400] flaccid: that appears to be the issue
[2013-05-20 01:51:28 -0400] hector: hi
[2013-05-20 01:52:27 -0400] hector: im having problem when i ran chef-client, i encounter error on cron cookbook
[2013-05-20 01:54:25 -0400] hector: i have this initialize_client.log
[2013-05-20 01:54:58 -0400] hector: it says Recipe Compile Error in /var/chef/cache/cookbooks/cron/resources/d.rb
[2013-05-20 04:59:13 -0400] BryanWB: ohai chefs!
[2013-05-20 04:59:41 -0400] BryanWB: is there a better way to mark somehting as deprecated than just using Chef::Log.info ?
[2013-05-20 04:59:49 -0400] BryanWB: or Chef::Log.warn?
[2013-05-20 05:00:28 -0400] flaccid_: warn sounds good
[2013-05-20 05:00:39 -0400] flaccid_: unless it is totally deprecated
[2013-05-20 05:15:12 -0400] BryanWB: flaccid_: good morning Oz :)
[2013-05-20 05:15:55 -0400] flaccid_: BryanWB: arv0!
[2013-05-20 05:42:00 -0400] cyclic: hey
[2013-05-20 06:16:49 -0400] cyclic: how do you write a conf file with chef?
[2013-05-20 06:17:03 -0400] cyclic: I want to write to /etc/mongodb.conf
[2013-05-20 06:17:28 -0400] n1ko: http://docs.opscode.com/essentials_cookbook_templates.html
[2013-05-20 06:19:21 -0400] cyclic: thanks n1ko
[2013-05-20 06:24:16 -0400] flaccid: cyclic: already mongodb cookbooks available too
[2013-05-20 06:24:23 -0400] flaccid: which i think i went over yesterday
[2013-05-20 06:24:52 -0400] n1ko: indeed, better to use cookbooks and configure it that way (if possible) than just doing package install and template copying
[2013-05-20 06:24:53 -0400] cyclic: flaccid: what was that url again?
[2013-05-20 06:25:14 -0400] n1ko: cyclic: you can find pretty much any cookbook by "<software> cookbook" in google :)
[2013-05-20 06:26:26 -0400] flaccid: cyclic: http://google.com/
[2013-05-20 06:26:36 -0400] cyclic: this is actually the one I have been using: http://community.opscode.com/cookbooks/mongodb
[2013-05-20 06:26:57 -0400] flaccid: that you copied and molested
[2013-05-20 06:27:35 -0400] cyclic: flaccid: like I said last night, I am using amazon opsworks, and that cookbook doesn't work as it is. I forked it and made it work, but it doesn't modify the /etc/mongod.conf, so after a reboot the mongo service is using the old conf.
[2013-05-20 06:27:52 -0400] cyclic: flaccid: I had to "molest" it, to get it to work on opsworks. sheesh!
[2013-05-20 06:28:04 -0400] flaccid: cyclic: like i said last night use a non discontinued chef version
[2013-05-20 06:28:25 -0400] flaccid: if a reboot on that service is causing that kind of behaviour i would consider not using such a service
[2013-05-20 06:28:28 -0400] cyclic: flaccid: "use" as in don't use opsworks?
[2013-05-20 06:28:48 -0400] cyclic: flaccid: it's not the service...
[2013-05-20 06:28:51 -0400] flaccid: cyclic: stock chef works fantastic
[2013-05-20 06:29:17 -0400] flaccid: hih
[2013-05-20 06:29:21 -0400] flaccid: err huh
[2013-05-20 06:29:42 -0400] cyclic: flaccid: are you talking about the mongo service or the opsworks service?
[2013-05-20 06:29:45 -0400] flaccid: what is it then?
[2013-05-20 06:31:34 -0400] cyclic: flaccid: if you're referring to the mongo service loading with a different configuration after reboot, then I suggest you take a look at the mongodb cookbook that you religiously profess is not the issue, and you'll see that it doesn't have a mongod.con.erb file. What do you have against OpsWorks or legacy versions of chef?
[2013-05-20 06:31:40 -0400] flaccid: whatever causes " but it doesn't modify the /etc/mongod.conf, so after a reboot the mongo service is using the old conf." cyclic
[2013-05-20 06:32:21 -0400] flaccid: if it doesn't have a template for it, how does it work on the first boot then?
[2013-05-20 06:32:33 -0400] cyclic: Yes, that's why I asked about a cookbook that has the conf file in it, which the one you pointed me to does not.
[2013-05-20 06:32:47 -0400] cyclic: Because the service is started with parameters on first boot.
[2013-05-20 06:33:07 -0400] flaccid: cyclic: i will test the cookbook
[2013-05-20 06:33:36 -0400] cyclic: Either that or it writes a config file to another place, and uses that once.
[2013-05-20 06:34:07 -0400] flaccid: i wouldn't assume at this point, but you are not being specific
[2013-05-20 06:34:56 -0400] flaccid: cyclic: so to confirm, you are using the current master of https://github.com/edelight/chef-mongodb ?
[2013-05-20 06:35:10 -0400] cyclic: yes
[2013-05-20 06:35:34 -0400] flaccid: cyclic: ok, first i'll test the version i published in http://www.rightscale.com/library/server_templates/MongoDB/lineage/2094 and then i'll test it in vagrant
[2013-05-20 06:36:11 -0400] cyclic: go ahead and change the path to the data folder and the log files to a different location, and then once it configures, create a new mongo test db, then reboot and see where the data folder is.
[2013-05-20 06:36:28 -0400] flaccid: cyclic: how about i just test it unmodified.
[2013-05-20 06:36:44 -0400] cyclic: what's the point of that?
[2013-05-20 06:37:02 -0400] cyclic: I am talking about changing the log and data paths. That's the whole issue.
[2013-05-20 06:37:04 -0400] flaccid: to see if it works, because thats what you are complaing about right
[2013-05-20 06:37:14 -0400] flaccid: cyclic: it is?
[2013-05-20 06:37:25 -0400] flaccid: man you don't give much info and we can't track your changes if its just copied to another repos
[2013-05-20 06:37:28 -0400] cyclic: No, I am talking about the data and log file paths not being set properly after a reboot. Yes.
[2013-05-20 06:37:34 -0400] flaccid: fork it and then change it, don't copy and paste
[2013-05-20 06:37:48 -0400] flaccid: cyclic: provide specifics about that, what you are saying is not enough
[2013-05-20 06:38:03 -0400] cyclic: flaccid, the way that forking works, the directory structure can't be maintained such that mongodb is a subdirectory.
[2013-05-20 06:38:21 -0400] flaccid: cyclic: huh
[2013-05-20 06:38:33 -0400] cyclic: lol
[2013-05-20 06:38:47 -0400] cyclic: ok let's try to not go off on a separate issue...
[2013-05-20 06:38:51 -0400] flaccid: mongodb is a db last time i checked
[2013-05-20 06:39:39 -0400] cyclic: flaccid: so go ahead and spin up that recipe with a different log and/or data directory. I'll wait while you try that and see how it works after a reboot.
[2013-05-20 06:40:38 -0400] flaccid: cyclic: ok
[2013-05-20 06:40:49 -0400] flaccid: cyclic: can you provide the error output>
[2013-05-20 06:41:44 -0400] cyclic: " . . . it doesn't modify the /etc/mongod.conf, so after a reboot the mongo service is using the old conf."
[2013-05-20 06:42:45 -0400] flaccid: cyclic: so no error?
[2013-05-20 06:45:30 -0400] cyclic: In other words, if you change the default attribute values (using JSON or modifying manually), to point them to a different location (like a volume), the first boot will put the mongo local db and journal folder in the correct location (the one specified in the attributes). But once you reboot the machine, the mongod service starts with the config file settings in /etc/mongod.conf. However, there is a file in /etc/sysconfig/ called mongo
[2013-05-20 06:46:01 -0400] flaccid: cyclic: distro?
[2013-05-20 06:46:05 -0400] cyclic: . . . chef, which has the correct paths coded in it, but it doesn't seem to be what the service is using after a reboot.
[2013-05-20 06:46:25 -0400] cyclic: amazon linux
[2013-05-20 06:46:35 -0400] cyclic: mongo 2.4.3
[2013-05-20 06:47:01 -0400] flaccid: ok
[2013-05-20 06:47:41 -0400] cyclic: cool! thanks... let me know what you find :)
[2013-05-20 06:48:55 -0400] cyclic: as a side note, it looks like the data drive/vol is totally cleared out after rebooting the EC2 host
[2013-05-20 06:49:10 -0400] cyclic: The /data vol that is.
[2013-05-20 06:51:58 -0400] cyclic: interesting
[2013-05-20 06:53:09 -0400] cyclic: I created a new host with the same exact setup, only I made the /data, /log, and /journal volumes non-raid (they were raid10 with 4 drives), and after rebooting, the data is still in the /data volume. Let me see if mongo is still pointing to the volume.
[2013-05-20 06:53:49 -0400] cyclic: doesn't look like it is
[2013-05-20 06:54:53 -0400] flaccid: cyclic: what is mounted on /data - ephemeral or ebs disk? i don't use amzn linux
[2013-05-20 06:55:03 -0400] flaccid: thus my comment on the cookbook not being the issue
[2013-05-20 06:55:07 -0400] cyclic: flaccid: it also looks like the service starting from the init script (maybe the wrong one or something) might be the issue: after rebooting, I do ps aux | grep mongo, and see that mongo service is running this way:  mongod    1441  1.9  2.0 446276 35312 ?        Sl   06:50   0:04 /usr/bin/mongod -f /etc/mongod.conf
[2013-05-20 06:55:23 -0400] flaccid: looks fine to me
[2013-05-20 06:55:26 -0400] cyclic: flaccid: ebs, see last message ^^
[2013-05-20 06:55:46 -0400] flaccid: cyclic: what do you mean by 'cleared out' ?
[2013-05-20 06:55:51 -0400] cyclic: ------------> /usr/bin/mongod -f /etc/mongod.conf
[2013-05-20 06:55:55 -0400] cyclic: that's not correct
[2013-05-20 06:56:05 -0400] flaccid: hih
[2013-05-20 06:56:10 -0400] flaccid: one thing at a time dude
[2013-05-20 06:56:13 -0400] cyclic: oh, it was totally empty.
[2013-05-20 06:56:23 -0400] flaccid: cyclic: was it even mounted?
[2013-05-20 06:56:41 -0400] flaccid: mount | grep /data
[2013-05-20 06:56:46 -0400] cyclic: flaccid: ok, let me recreate the machine and show you what the output of ps aux | grep mongo has the service running with.
[2013-05-20 06:56:54 -0400] cyclic: flaccid: yes, it was mounted
[2013-05-20 06:57:04 -0400] cyclic: That issue is resolved though
[2013-05-20 06:57:08 -0400] flaccid: well a reboot in ec2 does not clear data in a volume.
[2013-05-20 06:57:12 -0400] flaccid: huh
[2013-05-20 06:57:15 -0400] flaccid: 'resolved'
[2013-05-20 06:57:46 -0400] cyclic: well, I just changed it from Raid 10 to non-raid, so for now, I want to just focus on why mongo uses a different configuration after the first reboot.
[2013-05-20 06:58:46 -0400] flaccid: what provides the raid 10 functionality?
[2013-05-20 06:58:54 -0400] cyclic: Since changing from raid 10 to non-raid "resolves" the issue with the data missing from the /data vol. Maybe you're right, maybe it wasn't mounted, but there is still the same issue with mongo not using the correct /data path or /log path after the first reboot.
[2013-05-20 06:59:32 -0400] cyclic: the raid 10 feature is coded into the opsworks custom layer.
[2013-05-20 06:59:56 -0400] cyclic: They have a ui to specify volumes, you choose the raid option, and the size in GB for each volume.
[2013-05-20 07:00:25 -0400] cyclic: Instead of using raid, I just use none for the raid option, but create the same volumes.
[2013-05-20 07:01:36 -0400] cyclic: flaccid: starting a new instance now to compare the first boot's mongo service settings.
[2013-05-20 07:01:52 -0400] flaccid: ok so that basically backs up my assumption of opsworks being the issue
[2013-05-20 07:02:00 -0400] flaccid: i'm testing on vagrant/virtualbox not opworks
[2013-05-20 07:02:07 -0400] cyclic: which part?
[2013-05-20 07:02:31 -0400] cyclic: the raid 10 thing where the data was vanishing is no longer part of the issue... forget about that part.
[2013-05-20 07:03:25 -0400] flaccid: ok, will take a little while to test here just because all my LAN boxes are hogging the internet
[2013-05-20 07:03:45 -0400] cyclic: I am just talking about the original issue with mongo using a different config after restart -- namely, the /etc/mongodb.conf rather than the one that's generated by chef in /etc/sysconfig/mongodb.conf
[2013-05-20 07:04:49 -0400] flaccid: cyclic: which location is it for amzn linux?
[2013-05-20 07:05:44 -0400] cyclic: flaccid: so perhaps it's just the path that chef is outputting the correct conf file /etc/sysconfig/mongodb.conf. After reboot, it's loading the one in /etc/mongod.conf
[2013-05-20 07:06:18 -0400] flaccid: cyclic: thus my question
[2013-05-20 07:08:02 -0400] cyclic: This is the one that's loading after reboot: https://gist.github.com/Cyclic/5610805
[2013-05-20 07:10:25 -0400] cyclic: I added the sysconfig version there as well
[2013-05-20 07:10:53 -0400] flaccid: cyclic: you might wanna look through the cookbook like i am doing to work it out
[2013-05-20 07:11:49 -0400] cyclic: so here's the new machine I just created before rebooting:  [ec2-user@earth data]$ ps aux | grep mongo mongod    3106  0.3  1.8 444224 32732 ?        Sl   07:10   0:00 /usr/bin/mongod --port 27017 --dbpath /data --logpath /log/mongodb.log --fork
[2013-05-20 07:12:14 -0400] cyclic: So you can see, whatever created that process has the correct parameters
[2013-05-20 07:12:58 -0400] flaccid: cyclic: is this actually correct for amzn linux ? https://github.com/edelight/chef-mongodb/blob/master/attributes/default.rb#L53
[2013-05-20 07:13:01 -0400] cyclic: the chef section for the start service, after it installs mongo, I assume
[2013-05-20 07:13:34 -0400] flaccid: this is what does it https://github.com/edelight/chef-mongodb/blob/master/definitions/mongodb.rb#L88
[2013-05-20 07:13:40 -0400] flaccid: but i don't know amzn linux' init setup
[2013-05-20 07:13:54 -0400] cyclic: let me look at the init
[2013-05-20 07:13:59 -0400] cyclic: on amazon
[2013-05-20 07:14:12 -0400] flaccid: would be much easier if you supported a proper distro :)
[2013-05-20 07:14:28 -0400] cyclic: ubuntu had some issues too
[2013-05-20 07:14:34 -0400] flaccid: 'some issues'
[2013-05-20 07:14:39 -0400] cyclic: the same
[2013-05-20 07:14:42 -0400] flaccid: doesn't matter... thats where you contrib or submit bug
[2013-05-20 07:14:45 -0400] cyclic: but they were to do with old chef
[2013-05-20 07:14:57 -0400] flaccid: this thing works fine for me in ubuntu 12.04
[2013-05-20 07:14:58 -0400] cyclic: which was where this all started with debugging
[2013-05-20 07:15:07 -0400] cyclic: yeah but you're not using chef 9
[2013-05-20 07:15:20 -0400] flaccid: nor would i want to
[2013-05-20 07:15:29 -0400] cyclic: opinion
[2013-05-20 07:15:42 -0400] flaccid: you are not going to find support for 0.9 anywhere, certainly not here
[2013-05-20 07:15:54 -0400] flaccid: aws premium support perhaps
[2013-05-20 07:15:56 -0400] cyclic: why does amazon still use .9?
[2013-05-20 07:16:06 -0400] cyclic: or opsworks rather?
[2013-05-20 07:16:09 -0400] flaccid: because they simply acquired scalarium
[2013-05-20 07:16:20 -0400] cyclic: well, that's no excuse
[2013-05-20 07:16:25 -0400] flaccid: tell them that
[2013-05-20 07:16:42 -0400] cyclic: why didn't saclarium update?
[2013-05-20 07:16:59 -0400] flaccid: because they got bought by aws
[2013-05-20 07:17:05 -0400] flaccid: who knows before that..
[2013-05-20 07:17:08 -0400] cyclic: oh
[2013-05-20 07:17:14 -0400] cyclic: how long ago was that?
[2013-05-20 07:17:16 -0400] flaccid: welcome to the baggage :)
[2013-05-20 07:17:24 -0400] cyclic: haah true
[2013-05-20 07:17:43 -0400] cyclic: the opsworks UI is pretty fun though... super simple.
[2013-05-20 07:17:43 -0400] flaccid: cyclic: http://www.scalarium.com/
[2013-05-20 07:17:55 -0400] flaccid: nice UI, thats about it
[2013-05-20 07:18:24 -0400] cyclic: oh recently
[2013-05-20 07:18:38 -0400] cyclic: so they were already pretty dated when they were acquired
[2013-05-20 07:19:05 -0400] flaccid: yes
[2013-05-20 07:19:09 -0400] cyclic: crappy
[2013-05-20 07:19:18 -0400] cyclic: hrmf
[2013-05-20 07:19:28 -0400] flaccid: i don't think you'll find much support for this setup
[2013-05-20 07:19:54 -0400] flaccid: after some tests i am running and rebooting that cookbook on both ubuntu and centos in ec2
[2013-05-20 07:19:58 -0400] cyclic: I think I'm going to update the config file
[2013-05-20 07:20:21 -0400] cyclic: you changed the data and log folders?
[2013-05-20 07:20:22 -0400] flaccid: there may be a bug in the cookbook regarding amzn linux, i'm not sure. i've never used that pseudo distro so i can't help you sorry
[2013-05-20 07:20:32 -0400] flaccid: yes, it works fine
[2013-05-20 07:20:32 -0400] cyclic: hehe
[2013-05-20 07:20:41 -0400] cyclic: "pseudo distro"
[2013-05-20 07:20:50 -0400] flaccid: that it is
[2013-05-20 07:20:55 -0400] cyclic: It got better benchmark ratings than the others
[2013-05-20 07:20:58 -0400] flaccid: i prefer a real server distro such as Debian
[2013-05-20 07:21:07 -0400] flaccid: on the one cloud
[2013-05-20 07:21:13 -0400] flaccid: their custom cloud which is a closed fork
[2013-05-20 07:21:18 -0400] cyclic: oh
[2013-05-20 07:21:24 -0400] flaccid: go try other public clouds
[2013-05-20 07:21:34 -0400] flaccid: oh its not available in other clouds or anywhere else, sorry...
[2013-05-20 07:21:36 -0400] cyclic: I have nothing against ubuntu
[2013-05-20 07:21:41 -0400] cyclic: in fact, let me try it right now.
[2013-05-20 07:21:59 -0400] flaccid: cyclic: try Debian on GCE and let me know the benchmark comparison :)
[2013-05-20 07:22:26 -0400] cyclic: I'll take your word for it
[2013-05-20 07:22:30 -0400] cyclic: I like debian too
[2013-05-20 07:23:06 -0400] flaccid: cyclic: debian is also available on ec2. can you use that or ubuntu in your opsworks thing?
[2013-05-20 07:23:34 -0400] cyclic: It's lame, they only have 12.04 ubuntu or amazon linux :/
[2013-05-20 07:23:49 -0400] cyclic: I don't even know why I'm using this opsworks ui to be honest
[2013-05-20 07:23:51 -0400] flaccid: i'd be choosing ubuntu 12.04
[2013-05-20 07:23:57 -0400] flaccid: neither do i
[2013-05-20 07:24:00 -0400] flaccid: perhaps you should try chef
[2013-05-20 07:24:20 -0400] cyclic: try chef where?
[2013-05-20 07:24:25 -0400] cyclic: I thought I was?
[2013-05-20 07:24:32 -0400] flaccid: you were trying opsworks
[2013-05-20 07:24:53 -0400] cyclic: opsworks with chef scripts no?
[2013-05-20 07:25:15 -0400] flaccid: just chef
[2013-05-20 07:25:17 -0400] flaccid: cyclic: http://www.opscode.com/hosted-chef/
[2013-05-20 07:26:18 -0400] cyclic: signing up now
[2013-05-20 07:26:48 -0400] flaccid: coolio
[2013-05-20 07:28:42 -0400] cyclic: In the meantime, the ubuntu box is booting for testing that setup.
[2013-05-20 07:53:38 -0400] tolland: im having trouble setting the EDITOR on windows chef workstation
[2013-05-20 07:53:46 -0400] tolland: ive posted some details to the list
[2013-05-20 07:54:25 -0400] tolland: anyone managed to set vim as the EDITOR,  and have it respected when "knife data bag edit bag item"...?
[2013-05-20 08:29:55 -0400] tolland: ah! i see
[2013-05-20 08:30:38 -0400] tolland: so the git bash on windows returns a windows style path, so the editor in EDITOR has to understand C:/users/whatever/file rather than /c/users/whatever/file
[2013-05-20 08:59:29 -0400] lflux: ohai
[2013-05-20 09:06:35 -0400] lflux: how do people start chef-server 11 in Redhat/Centos? Can't find what looks like an init script, do people run chef-server-ctl start in rc.local?
[2013-05-20 09:41:52 -0400] stormerider: under ubuntu i know the chef startup is actually /etc/init/opscode-runsvdir.conf. not sure if there's a direct equivalent under RH/CentOS but it may not be named what you'd expect if you're looking vs. testing
[2013-05-20 09:49:35 -0400] fearoffish: anyone on hosted chef getting permission problems with users/clients that they didn't use to have permission problems with?
[2013-05-20 10:04:10 -0400] fearoffish: yup, I think hosted chef had a permission hiccup. :-/
[2013-05-20 10:04:58 -0400] fearoffish: permission denied, you are not allow to regenerate the validation key for this organisation.o rly? I could last week and we didn't change permissions :-/
[2013-05-20 10:05:20 -0400] fearoffish: clients no longer able to read a list of cookbooks when bootstrapping.??
[2013-05-20 10:05:26 -0400] fearoffish: ticket submitted. :-/
[2013-05-20 10:18:35 -0400] helllen: helllo
[2013-05-20 10:18:55 -0400] helllen: whats the difference between bookshelf and an S3 server storage ?
[2013-05-20 10:21:47 -0400] lflux: stormerider: that file is there, yes. no idea what uses it though.
[2013-05-20 10:27:24 -0400] lflux: stormerider: ah, discovered now that Centos uses upstart, so chef-server starts automatically on reboot from that file.
[2013-05-20 10:27:36 -0400] lflux: but it doesn't show up in chkconfig like i'm used to.
[2013-05-20 10:39:03 -0400] stormerider: *nods*
[2013-05-20 11:51:59 -0400] ptrf: so, I'm a bit confused as to how to use knife. I would like to programmatically provision hosts and services (elb etc) on AWS.
[2013-05-20 11:52:52 -0400] ptrf: right know i'm using the ruby aws-sdk, and I have a simple IO.popen call, that executes knife bootstrap [...] in my PoC script
[2013-05-20 11:53:31 -0400] ptrf: however, I've noticed that the gem 'chef' is on ruby-doc, but otherwise not mentioned anywhere
[2013-05-20 11:54:41 -0400] ptrf: is it discouraged to use Chef::Knife::Bootstrap rather than knife bootstrap (in a terminal)?
[2013-05-20 11:54:49 -0400] stormerider: knife bootstrap supports multiple methods of installation. i believe the preferred method at this point is the set of omnibus installers which you can google for more info.
[2013-05-20 11:55:49 -0400] ptrf: hmm okay
[2013-05-20 11:55:54 -0400] stormerider: if you want to program it, i dont see any reason not to, although you have to keep in mind that some of the AWS stuff takes time to set up, which can be a pain to provision around.
[2013-05-20 11:56:33 -0400] stormerider: if you're not finding the chef gem on your workstation but knife works, you may be using the omnibus install on your client. at which point, that's a separate entire ruby environment.
[2013-05-20 11:57:16 -0400] stormerider: so instead of doing something like "#!/usr/bin/env ruby" you might need to do "#!/opt/chef/embedded/bin/ruby"
[2013-05-20 11:57:21 -0400] ptrf: yea... i'm using the gem chef
[2013-05-20 11:57:37 -0400] stormerider: and if you need extra gems you'd install them via /opt/chef/embedded/bin/gem
[2013-05-20 11:57:44 -0400] ptrf: however, I'm just slightly annoyed that the ruby doc seems to be all the documentation available
[2013-05-20 11:58:28 -0400] stormerider: the wiki tends to alternate between showing you examples of knife from the CLI and inside ruby
[2013-05-20 11:58:29 -0400] ptrf: although it might be complete, it's definitely not easy to find your way around
[2013-05-20 11:59:05 -0400] ptrf: i will venture onto the wiki then. 'cause it seems docs.o.o only treats the CLI version of knife
[2013-05-20 11:59:05 -0400] stormerider: like, for example: http://docs.opscode.com/essentials_search.html
[2013-05-20 12:03:35 -0400] fearoffish: ptrf: we use knife-ec2 to provision our instances
[2013-05-20 12:04:17 -0400] stormerider: i ended up mostly using elasticbeanstalk+chef personally
[2013-05-20 12:04:35 -0400] stormerider: easier if you want to handle autoscaling, IMO
[2013-05-20 12:06:04 -0400] fearoffish: ptrf: example usage => https://gist.github.com/fearoffish/5f49fe920e29efebeed0
[2013-05-20 12:06:40 -0400] stormerider: jtimberman: i know you tend to do a bunch of the hacking on the nagios cookbook lately; i opened up COOK-3014. please let me know if there's anything i need to tweak with that. :)
[2013-05-20 12:21:18 -0400] flaccid: ptrf: knife doesn't support aws services such as elb unless you add such a plugin
[2013-05-20 12:30:14 -0400] imjustmatthew: Quick question, is there anyone using chef on IPv6 networks? I'm having trouble getting chef-server's web interface to bind to IPv6.
[2013-05-20 12:31:35 -0400] stormerider: flaccid: they mentioned they were using the aws sdk with the chef gem, and were trying to script it natively in Ruby vs. using knife.
[2013-05-20 12:31:57 -0400] stormerider: just not seeing a lot of helpful documentation for what they were looking for.
[2013-05-20 12:32:40 -0400] flaccid: stormerider: too vague to work with. thats obviously not knife
[2013-05-20 12:32:50 -0400] flaccid: what are they looking for?
[2013-05-20 12:33:20 -0400] stormerider: the chef gem equivalent of knife bootstrap.
[2013-05-20 12:33:47 -0400] flaccid: stormerider: huh knife is in the chef gem
[2013-05-20 12:34:19 -0400] stormerider: again, it seemed to be more an issue of documentation than technical limitations
[2013-05-20 12:34:32 -0400] flaccid: stormerider: again, like what?
[2013-05-20 12:36:34 -0400] stormerider: i believe Chef::Knife::Bootstrap, but im not the one running into the problems :) i chased down the rabbit-hole of the AWS gem in the omnibus ruby which was a non issue for them. i mentioned that a lot of the wiki pages show both knife CLI examples and pure ruby examples and they said they would keep digging in there; most of what they had found was just the chef gem rdocs which aren't necessarily the easiest
[2013-05-20 12:36:36 -0400] stormerider: way to find something at times.
[2013-05-20 12:38:19 -0400] flaccid: pretty vague stuff
[2013-05-20 12:38:47 -0400] flaccid: its important to use things as intended not what you want them to do
[2013-05-20 12:40:23 -0400] stormerider: i think that their responses in backscroll are actually fairly clear for the most part, however there's going to be a default signal drop in a third party such as myself relaying them along. *shrugs*
[2013-05-20 12:43:13 -0400] flaccid: knife is a cli tool, expecting much more than that in doc is unrealistic
[2013-05-20 12:44:31 -0400] flaccid: if you wanna hack it, then thats your prog!
[2013-05-20 12:45:03 -0400] stormerider: if it has a gemo or class inside a gem, then i dont really agree...
[2013-05-20 12:45:08 -0400] stormerider: gem*
[2013-05-20 12:46:28 -0400] flaccid: lets just document in detail every single object within our software so it can be extended in the wrong way
[2013-05-20 12:49:16 -0400] mark_en: Hi, I'm trying to start with chef, but chef won't find my template, although the template exists at the templates/default directory. here are my config files and the result of the deploy: https://gist.github.com/mren/623868448042be3ab245
[2013-05-20 13:01:24 -0400] stonevil: Any idea?
[2013-05-20 13:01:51 -0400] flaccid: stonevil: pastebin the chef run
[2013-05-20 13:03:03 -0400] mark_en: could somebody help me with chef not finding my template, although it should be in the correct folder (https://gist.github.com/mren/623868448042be3ab245) I appreciate every help :)
[2013-05-20 13:08:28 -0400] strictlyb: anyone here want to make some $ i need a crash course on chef (im a puppet user for a long time)
[2013-05-20 13:10:57 -0400] fearoffish: strictlyb: Opscode do training ;)
[2013-05-20 13:11:22 -0400] strictlyb: yeah i am going to do it but i dont have time for that today i plan to in the upcoming weeks,
[2013-05-20 13:12:25 -0400] jmartin: strictlyb: https://learnchef.opscode.com/
[2013-05-20 13:12:50 -0400] strictlyb: yah i ran therough this i got everything setup
[2013-05-20 13:12:59 -0400] strictlyb: more about best practices and things like that
[2013-05-20 13:13:01 -0400] stormerider: i really need to see if i can go to one of those sessions sometime
[2013-05-20 13:26:23 -0400] BryanWB: anybody mirroring a subset of rubygems on s3?
[2013-05-20 13:28:58 -0400] Guest78011: Ruby gems....
[2013-05-20 13:29:26 -0400] mjolk: Python modules....
[2013-05-20 13:30:09 -0400] erratic: Why is somebody trying to steal my handle
[2013-05-20 13:30:45 -0400] erratic: Thats just stupid who would do something like that
[2013-05-20 13:31:43 -0400] erratic: Moronic
[2013-05-20 13:32:23 -0400] erratic: http://www.urbandictionary.com/define.php?term=moronic
[2013-05-20 13:32:42 -0400] erratic: Wow those are some really good examples how delightful
[2013-05-20 13:55:01 -0400] BryanWB: anyone have experience w/ the lvm coookbook
[2013-05-20 13:55:02 -0400] BryanWB: ?
[2013-05-20 13:55:35 -0400] erratic: Trying to think how would someone use that
[2013-05-20 13:58:12 -0400] erratic: Bryan wb i have used lvm alot but never needed something like that whats wrong with it
[2013-05-20 13:59:34 -0400] erratic: Oh neat https://github.com/opscode-cookbooks/drbd
[2013-05-20 14:09:58 -0400] erratic: Yawn I dont wanna go do anything
[2013-05-20 14:11:19 -0400] erratic: I cant even come up with anything that sounds right in english ... so how do I get out of this commitment to doing work today
[2013-05-20 14:19:50 -0400] markxnelson: Hi Chefs, I want to use a node name in a recipe - I want to create a directory called something like /home/user/node/something  where node is the node name - I tried putting #{node["name"]} in the recipe - but i just got a null there and it tried to create /home/user//something.  Cant find any info on how to do this.  Appreciate any help.  Thanks!
[2013-05-20 14:20:58 -0400] markxnelson: directory "/home/user/#{node["name"]}/something" do    ....
[2013-05-20 14:21:46 -0400] juliancdunn: markxnelson: node['hostname'] ?
[2013-05-20 14:22:37 -0400] markxnelson: trying now ..
[2013-05-20 14:25:00 -0400] markxnelson: that seems to work. thanks!
[2013-05-20 14:25:07 -0400] juliancdunn: np
[2013-05-20 14:43:20 -0400] markxnelson: I am getting FATAL: Net::HTTPServerException: 413 "Request Entity Too Large"' when I run chef-client - I tried putting  client_max_body_size 2M; into my nginx.conf and restarting nginx, but same error.
[2013-05-20 14:52:25 -0400] helllen_: helllo
[2013-05-20 14:52:44 -0400] helllen_: could I use s3 cloud instead of bookshelf ?
[2013-05-20 14:53:25 -0400] flaccid: sure
[2013-05-20 14:55:10 -0400] Lumbendil: hey
[2013-05-20 14:56:24 -0400] helllen_: what do I have to change to do this ?
[2013-05-20 14:58:29 -0400] flaccid: helllen_: what is bookshelf?
[2013-05-20 14:59:04 -0400] helllen_: https://github.com/opscode/bookshelf
[2013-05-20 15:01:56 -0400] flaccid: helllen_: cool. looks like a clone. contact seth?
[2013-05-20 15:02:56 -0400] helllen_: I have tried
[2013-05-20 15:03:36 -0400] flaccid: helllen_: not everything is possible
[2013-05-20 15:04:02 -0400] flaccid: helllen_: feel free to contribute!
[2013-05-20 15:06:40 -0400] helllen_: are you chef developer ?
[2013-05-20 15:18:04 -0400] awgross: anyone have some good example code that shows how to call / mock out Chef Data Bag Item when testing library code (outside of a Chef run)
[2013-05-20 15:18:21 -0400] awgross: having a lot of issues figuring out how to even make the `data_bag_item` call without being in the middle of a chef run
[2013-05-20 15:27:06 -0400] hcastro: Has anyone attempted to replace the Bookshelf backend with an object store other than S3?
[2013-05-20 15:30:34 -0400] BryanWB: helllen: u can use s3 , i don't know the specifics
[2013-05-20 15:34:47 -0400] stormerider: is there a doc somewhere of what all the chef-related tools are, like berkshelf, test-kitchen, food critic, etc?
[2013-05-20 15:39:53 -0400] BryanWB: sascha_d: u had colleagues that set up a mirror of rubygems, correct?
[2013-05-20 15:40:21 -0400] sascha_d: @BryanWB yes
[2013-05-20 15:40:47 -0400] sascha_d: i think it was hacky?
[2013-05-20 15:41:01 -0400] BryanWB: sascha_d: were they able to serve it w/ a fast webserver rather than some slow ruby shtuff?
[2013-05-20 15:41:10 -0400] flaccid: helllen: no
[2013-05-20 15:42:29 -0400] sascha_d: @BryanWB It was created as a gem repo and then fronted by an apache server
[2013-05-20 15:42:36 -0400] sascha_d: and then synced with a cron job
[2013-05-20 15:42:51 -0400] BryanWB: sascha_d: nice, so i could probably just use s3 instead
[2013-05-20 15:43:11 -0400] sascha_d: yeah ours was on an AWS instances with our epel mirror
[2013-05-20 15:43:39 -0400] sascha_d: we still made it with the rubygems repo create proc
[2013-05-20 15:43:46 -0400] sascha_d: but no special app in front
[2013-05-20 15:44:25 -0400] sascha_d: then I think a mirrorsync job was cronned but I haven't looked at it closely in months
[2013-05-20 15:44:49 -0400] flaccid: epel, joy
[2013-05-20 15:56:08 -0400] imjustmatthew: Quick question, is there anyone using chef on IPv6 networks? I'm having trouble getting chef-server's web interface to bind to IPv6. It looks like nginx might not be building with "--with-ipv6".
[2013-05-20 16:02:44 -0400] trev_f_: I'm new to Chef and I'm trying to figure out how to run/install/setup a recipe that I found - https://github.com/hectcastro/chef-graphite Could someone break it down for me on what I would have to do on a clean Ubuntu install?
[2013-05-20 16:03:15 -0400] stormerider: do you have a chef server or are you using hosted chef?
[2013-05-20 16:03:21 -0400] gchristensen: or are you using chef-solo
[2013-05-20 16:03:38 -0400] stormerider: ah, yeah, i keep forgetting about solo.
[2013-05-20 16:04:06 -0400] gchristensen: I used to forget about it all the time until I started writing my recipes TDD-style with TestKitchen
[2013-05-20 16:05:26 -0400] trev_f_: well, I don't have chef server or hosted chef. I've been trying chef-solo but I don't know what I need to do to use it
[2013-05-20 16:06:16 -0400] stormerider: ah, i cant help with solo, hopefully someone else can. if that's too complicated, you can get up and running with hosted for free for 5 nodes, a good way to get feet wet while playing around.
[2013-05-20 16:06:42 -0400] bean__: trev_f_: you could sign up for a free hosted chef account
[2013-05-20 16:06:52 -0400] bean__: or use solo
[2013-05-20 16:06:56 -0400] bean__: or install your own chef server
[2013-05-20 16:10:08 -0400] HenrikSR: hi. I am trying to bootstrap a client from the chef server and the challenge is that the client does not have access to the internet. So any good suggestions on maybe using a special template to push the deb package from the chef server onto the ubuntu client is most welcome - or other great ideas offcourse
[2013-05-20 16:10:16 -0400] trev_f_: ok. I'll check it out. thanks
[2013-05-20 16:10:33 -0400] barefoot: trev_f_: can also try littlechef
[2013-05-20 16:10:39 -0400] barefoot: pretty easy to setup
[2013-05-20 16:11:37 -0400] bean__: there's also, apparently, knife-solo
[2013-05-20 16:15:50 -0400] gzc: HenrikSR: I'm soon to tackle a similar use case
[2013-05-20 16:15:52 -0400] trev_f_: would there be anything that breaks it down step by step on how to use either littlechef or knife-solo to run a specific cookbook like that?
[2013-05-20 16:16:06 -0400] gzc: so i'm thinking that maybe a debian mirror + rubygems mirror (at least partially) will be needed
[2013-05-20 16:16:25 -0400] trev_f_: I'm looking at the docs and trying to figure out how they work
[2013-05-20 16:18:42 -0400] HenrikSR: hi gzc: I would just have expected that you could include the distro in the chefserver some where and have it installed as part of bootstrapping the client - seems like a normal thing people would do when having to bootstrap X number of servers.
[2013-05-20 16:19:56 -0400] HenrikSR: hi trev_f_ : is your comment about knife-solo related to my questions?
[2013-05-20 16:20:30 -0400] gzc: HenrikSR: I haven't tried this install method for 11 yet, but I'd assume the omnibus package at http://www.opscode.com/chef/install/ includes 'everything'
[2013-05-20 16:21:28 -0400] gzc: this is old documentation but possibly still accurate http://wiki.opscode.com/display/chef/Installing+Omnibus+Chef+Client+on+Linux+and+Mac#InstallingOmnibusChefClientonLinuxandMac-Bootstrap
[2013-05-20 16:21:28 -0400] trev_f_: HenrikSR: no, I was asking advice on how to use chef for the first time
[2013-05-20 16:22:13 -0400] HenrikSR: yes it does. I have manually installed the deb package on the ubuntu xenserver template I am using. then bootstrapping with template that just assumes chef-client is installed. but still this is suboptimal.
[2013-05-20 16:22:40 -0400] gzc: trev_f_: give this a try: http://leopard.in.ua/2013/01/04/chef-solo-getting-started-part-1/
[2013-05-20 16:23:26 -0400] gzc: HenrikSR: yeesh, agreed- I'll have to give that a try. I'd have hoped that knife bootstrap just used omnibus and did the right thing.
[2013-05-20 16:23:52 -0400] gzc: trev_f_: actually, blah, that uses librarian and not berkshelf. you basically want to use vagrant to play with chef your first time
[2013-05-20 16:25:54 -0400] vingo: hello, can chef do patch management like installing IE version 9?
[2013-05-20 16:31:45 -0400] ssd7: Reminder for Hosted Chef users: Hosted Chef is going down in 30 minutes. The API will be completely unavailable for 1 hour.
[2013-05-20 16:35:32 -0400] Naji: hi there. i want to use a cookbook file files/default/php/timezone.ini
[2013-05-20 16:35:47 -0400] Naji: how would be the correct filename to use that file?
[2013-05-20 16:36:31 -0400] HenrikSR: gzc: Based on the doc you linked to it is not clear to me how the client is or can be embedded in the chef-server installation to facilitate ubuntu client bootstrapping in an offline environment. But thanks for you time.
[2013-05-20 16:36:53 -0400] ssd7: Naji: I believe source "php/timezone.ini" should do it
[2013-05-20 16:37:34 -0400] stormerider: i believe that the omnibus package of server does not include the client
[2013-05-20 16:37:35 -0400] miah: s/"his / her"/their
[2013-05-20 16:37:36 -0400] miah: :P
[2013-05-20 16:38:40 -0400] ssd7: geggam: :)
[2013-05-20 16:38:51 -0400] geggam: no worries ssd7 ... i know benP_
[2013-05-20 16:39:58 -0400] Naji: i'll try ssd7
[2013-05-20 16:42:35 -0400] geggam: btw... in case all you uber linux folks missed this
[2013-05-20 16:42:35 -0400] geggam: http://ostatic.com/blog/critical-linux-exploit-in-the-wild
[2013-05-20 16:43:47 -0400] _Spike_: ls
[2013-05-20 16:43:50 -0400] _Spike_: derp!
[2013-05-20 16:46:05 -0400] Naji: nope, does not work ssd7
[2013-05-20 16:47:40 -0400] Naji: chef is trying to find files/default/timezone.ini instead of files/default/php/timezone.ini
[2013-05-20 16:49:04 -0400] ssd7: Naji: Mind posting a gist of the recipe you are using?
[2013-05-20 16:49:29 -0400] Naji: ah, sorry. didn't read, that you mentioned "source"
[2013-05-20 16:49:39 -0400] Naji: now it is working fine, thanks :)
[2013-05-20 16:50:26 -0400] ssd7: Naji: great!
[2013-05-20 16:50:29 -0400] Naji: but just of interest: why wouldn't cookbook_file "php/timezone.ini" not work?
[2013-05-20 16:50:36 -0400] BryanWB: anybody have experience w/ the lvm cookbook?
[2013-05-20 16:51:54 -0400] ssd7: BryanWB: A bit
[2013-05-20 16:53:00 -0400] BryanWB: ssd7: if i spin up a new os image w/ old data disks, will that cookbook wipe out the data on disks or use something like lvscan to reassemble them?
[2013-05-20 16:59:07 -0400] ssd7: BryanWB: Hrm, I've only used it from a fresh state.  The chef side of the code definitely checks for existing lvs & pvs but it uses the LVM gem rather than command line tools so the answer lies somewhere in there.
[2013-05-20 17:01:10 -0400] techminer: Berkshelf question.  I have omnibus_updater 0.1.2 in my .berkshelf.  When I run berks install or berks update, it is not downloading the latest version from the opscode site (0.2.0).  My Berksfile doesn't specify any version info for omnibus_updater so I thought it would just get the latest version.
[2013-05-20 17:02:29 -0400] techminer: I can delete omnibus_updater 0.1.2 from the .berkshelf directory and that will force it to update I think.but I thought Berkshelf was supposed to handle versioning.....
[2013-05-20 17:04:47 -0400] bean__: it will use the version you have in your .berksfile if it matches the versions described in your metadata, i believe
[2013-05-20 17:04:54 -0400] bean__: /berksfile
[2013-05-20 17:05:42 -0400] ssd7: Hosted Chef Users: Hosted Chef API is now down for maintenance.  See status.opscode.com for details.
[2013-05-20 17:06:05 -0400] techminer: bean_:  I don't specify a version in the metadata either.
[2013-05-20 17:06:17 -0400] bean__: yep, then it'll use whats in your .berkshelf
[2013-05-20 17:06:17 -0400] techminer: just depends "omnibus_updater"
[2013-05-20 17:06:18 -0400] bean__: pretty sure
[2013-05-20 17:06:34 -0400] techminer: oh.so DON'T put it in the metadat file?
[2013-05-20 17:06:46 -0400] gkarekinian: You should specify the version in your Berksfile anyway
[2013-05-20 17:07:08 -0400] bean__: ^
[2013-05-20 17:07:37 -0400] techminer: ok, new to Berkshelf so not sure yet what all the best practices are...
[2013-05-20 17:08:05 -0400] tnarik: hi, I was just trying to use the 'mysql::server' recipe and the 'database' cookbook, to create some mysql databases
[2013-05-20 17:08:43 -0400] bean__: techminer: if you haven't watched this talk, i recommend it: http://www.youtube.com/watch?v=hYt0E84kYUI
[2013-05-20 17:08:57 -0400] tnarik: but it seems that the 'include_recipe "build-essential"' part of the mysql::ruby recipe doesn't get correctly executed
[2013-05-20 17:09:15 -0400] tnarik: and it runs without 'node.set['build_essential']['compiletime'] = true' taking place before
[2013-05-20 17:09:17 -0400] teukka: techminer: berkshelf has bugs with updating the cookbooks. v2.0 that is now beta should fix them
[2013-05-20 17:09:26 -0400] tnarik: although the code is in that order
[2013-05-20 17:09:56 -0400] tnarik: wasn't include_recipe meant to include recipes preserving the order?
[2013-05-20 17:10:48 -0400] bean__: tnarik: the build-essential recipe says :Set the compiletime attribute in roles where such recipes are required. This will ensure that the build tools are available to compile the RubyGems' extensions, as chef_gem happens during the compile phase, too.
[2013-05-20 17:11:03 -0400] bean__: so you may need it
[2013-05-20 17:11:15 -0400] tnarik: that's the workaround I used, setting it in the role (well, the node)
[2013-05-20 17:11:27 -0400] tnarik: but I was wondering if that's a bug or not
[2013-05-20 17:11:47 -0400] bean__: looks like that is set by default in the mysql::ruby cb
[2013-05-20 17:11:49 -0400] tnarik: as the documentation I read about include_recipe mentions that code will be injected in order
[2013-05-20 17:12:44 -0400] Naji: can i even organize recipes in subdiretories? i thought about that because of several webapps running on the same server
[2013-05-20 17:13:06 -0400] ssd7: Naji: Unfortunately that doesn't work for recipes
[2013-05-20 17:13:13 -0400] tnarik: thanks, bean__
[2013-05-20 17:13:26 -0400] Naji: thought so... but thanks for the answer ssd7
[2013-05-20 17:27:43 -0400] ssd7: Update for hosted users: Data migration for the deploy is still chugging along. A bit faster than in the preproduction runs according to the deploy team.
[2013-05-20 17:56:46 -0400] helllen_: how can I execute a command before changing the file and execute another command after changing the file ?
[2013-05-20 17:58:37 -0400] superbenk: What's the difference between using "role:foo" & "roles:foo" in searches?  The first works fine in production but not in vagrant, but the latter works in vagrant
[2013-05-20 17:58:53 -0400] ssd7: Heads up: We might go over the window by a bit. Data validation taking longer than expected at the moment
[2013-05-20 17:59:12 -0400] superbenk: Vagrant being a Chef server w/ a number of nodes registered.  Production being the same thing, but w/ real servers.
[2013-05-20 18:00:47 -0400] jtimberman: superbenk: role will match roles that are directly applied to the node's run list.
[2013-05-20 18:01:20 -0400] jtimberman: superbenk: roles is an attribute, and will include the expanded node's run list for all the roles it contains.
[2013-05-20 18:04:52 -0400] superbenk: Odd.  I have a query: "role:graphite-server" that can't find my Graphite host with the following run_list: Run List:    role[base], role[graphite-server]
[2013-05-20 18:05:08 -0400] superbenk: If I change the query to "roles:graphite-server" it finds the host & works
[2013-05-20 18:05:35 -0400] superbenk: I see "graphite-server" in both the run_list & roles attributes
[2013-05-20 18:06:47 -0400] superbenk: $ knife node show graphite.local.vm | egrep "^(Run List|Roles)"
[2013-05-20 18:06:48 -0400] superbenk: Run List:    role[base], role[graphite-server]
[2013-05-20 18:06:48 -0400] superbenk: Roles:       snmp-base, ntp-client, nagios-client, snmp-vagrant, rsyslog-client, diamond, base, graphite-server, dns-vagrant, openldap-client, dns-client, ossec-agent, chef-client
[2013-05-20 18:11:45 -0400] benP_: superbenk, try escaping 'graphite-server'
[2013-05-20 18:11:53 -0400] benP_: like 'graphite\-server'
[2013-05-20 18:12:02 -0400] benP_: I know that '-' is a reserved character.
[2013-05-20 18:12:33 -0400] superbenk: Ah, that worked (at least for the knife search command).  Odd
[2013-05-20 18:12:53 -0400] benP_: that's one reason why folks like to use underscores as delimiters
[2013-05-20 18:13:00 -0400] benP_: Well, that and it's more ruby-ish
[2013-05-20 18:15:21 -0400] superbenk: Curious why it seems to work in production.  Would that have changed between Ruby 1.8 & 1.9?
[2013-05-20 18:16:22 -0400] benP_: It's probably not an issue between ruby versions. You're really just handing that query off to the solr index, so the version of that is probably more related.
[2013-05-20 18:17:30 -0400] superbenk: escaping the '-' in the recipe didn't work even though it did fix the 'knife search node' command output
[2013-05-20 18:19:02 -0400] benP_: That's interesting. Can you paste the whole search line from your recipe?
[2013-05-20 18:19:40 -0400] superbenk: Sure:
[2013-05-20 18:19:41 -0400] superbenk:   query = "role:graphite-server AND chef_environment:#{node.chef_environment}"
[2013-05-20 18:19:41 -0400] superbenk:   graphite_hosts = search(:node, query).map {|n| n.fqdn}
[2013-05-20 18:20:06 -0400] superbenk: If I change 'role:' to 'roles:' it works fine
[2013-05-20 18:21:39 -0400] benP_: Ah, I betcha ruby is killing that backslash in the double quotes before it gets dropped into that search function. Try changing it to "role:graphite\\-server ..."
[2013-05-20 18:22:19 -0400] benP_: So ruby will kill the "\\" and give you "\" and then your search line will get "\-"
[2013-05-20 18:22:36 -0400] superbenk: Nope
[2013-05-20 18:22:44 -0400] benP_: Bummer, I'm outta' ideas then.
[2013-05-20 18:25:04 -0400] superbenk: Even more fun - both our Vagrant & production chef-solr versions are the same.  10.20.0 :P
[2013-05-20 18:25:25 -0400] benP_: I think I got it. When I ran it through irb, "role:graphite-server
[2013-05-20 18:25:57 -0400] benP_: " resolved to the same as "role:graphite\-server", but "role:graphite\\-server" stayed as "role:graphite\\-server"
[2013-05-20 18:26:22 -0400] benP_: so try concatenating a single quoted 'role:graphite\-server' with the rest of that line
[2013-05-20 18:27:48 -0400] superbenk: Like this?  query = 'role:graphite\-server' + " AND chef_environment:#{node.chef_environment}"
[2013-05-20 18:28:02 -0400] benP_: Yeah, that looks right.
[2013-05-20 18:28:10 -0400] paulmooring: superbenk: I sure you don't want roles rather than role
[2013-05-20 18:28:25 -0400] ZacharyBlank: Does anyone notice that Hosted Chef is down right now?
[2013-05-20 18:28:38 -0400] gchristensen: ZacharyBlank: they are undergoing maintenance
[2013-05-20 18:28:40 -0400] thom: ZacharyBlank: http://status.opscode.com/
[2013-05-20 18:28:44 -0400] ZacharyBlank: Thank you!
[2013-05-20 18:28:44 -0400] superbenk: benP_: didn't work
[2013-05-20 18:28:58 -0400] benP_: Bummer. I'm completely out of ideas now, then.
[2013-05-20 18:29:05 -0400] superbenk: hah, me too
[2013-05-20 18:29:33 -0400] superbenk: paulmooring: well, I'm trying to understand why role doesn't work when it seems like it should
[2013-05-20 18:29:44 -0400] paulmooring: it's not an indexed field name
[2013-05-20 18:29:53 -0400] superbenk: paulmooring: it's also working in production which is odd
[2013-05-20 18:30:07 -0400] paulmooring: try `knife search node "name:$SOME_NAME" --long |grep role`
[2013-05-20 18:30:13 -0400] allaire: Hey guys, how can I get rid of these warnings: https://gist.github.com/allaire/9a207afed7526b0081f3
[2013-05-20 18:30:21 -0400] paulmooring: or leave off the grep to see everything that's there
[2013-05-20 18:30:31 -0400] paulmooring: you'll see a roles field but no role field
[2013-05-20 18:30:51 -0400] allaire: is it because both package run the same resource?
[2013-05-20 18:33:18 -0400] benP_: superbenk: I think this problem will disappear if you refactor from graphite-server to graphite_server. If that's too much work, the escaping behavior for these strings seems kinda' weird to make it happen.
[2013-05-20 18:34:19 -0400] superbenk: I didn't think the '-' would be a problem within quotes.  I know it's a problem when using symbols
[2013-05-20 18:35:20 -0400] superbenk: Converting all our role naming from '-' to '_' would be a pain
[2013-05-20 18:38:05 -0400] LarsN: If I am using the Knife HP plugin, and set my knife.rb file to use environment variables.  Will those environment variables be read each time a knife command is issued?
[2013-05-20 18:38:54 -0400] miah: i tend to name roles, environments, and chef cookbooks as if they were class methods (snake_case).
[2013-05-20 18:39:12 -0400] coderanger: LarsN: your knife.rb file is eval'd, so if you put in ENV['foo'] = 'bar', yes it will end up set in the knife process environment
[2013-05-20 18:40:10 -0400] LarsN: coderanger: so if I then export bar=baz at the terminal foo = baz?
[2013-05-20 18:40:43 -0400] jmickle: Has anyone done redundant chef 11 servers yet?
[2013-05-20 18:41:00 -0400] coderanger: LarsN: 1) Environment variables don't work that way in shells 2) They will end up set in the knife process, not in your shell
[2013-05-20 18:41:08 -0400] coderanger: jmickle: We have, but that probably doesn't help you :)
[2013-05-20 18:41:23 -0400] jmickle: coderanger: ha i just need some advise
[2013-05-20 18:42:10 -0400] jmickle: coderanger: i am switching from hosted chef back to open source chef due to API issues. Essentially we need high redundant setup here, is it safe to assume that we could locate postgres on 1 server and install 2 chef front ends with a LB to communicate to that postgres?
[2013-05-20 18:42:12 -0400] LarsN: I'm just looking for an easy(ish) way to change the availability zone without necessarily using the -Z flag in line.
[2013-05-20 18:42:34 -0400] LarsN: If I don't find an answer before then I'll see if Matt Ray, or anyone else at the Cafe has an idea on Weds. :)
[2013-05-20 18:43:37 -0400] coderanger: jmickle: Yes, however that won't cover cookbook data
[2013-05-20 18:43:52 -0400] jmickle: coderanger: got it, so whats the best way to cover the cookbook data?
[2013-05-20 18:43:57 -0400] techminer: I'm running into this bug on some, not all oddly enough, of my 12.04 Ubuntu nodes.  http://tickets.opscode.com/browse/CHEF-3679
[2013-05-20 18:44:16 -0400] jmickle: coderanger: is cookbook data just stored on the file system?
[2013-05-20 18:44:17 -0400] techminer: Anyone else run into this and have a workaround?
[2013-05-20 18:44:30 -0400] coderanger: LarsN: knife[:hp_avl_zone] = 'asdf'
[2013-05-20 18:44:38 -0400] coderanger: LarsN: Include that in your knife.rb
[2013-05-20 18:44:47 -0400] LarsN: right, I see that
[2013-05-20 18:45:14 -0400] LarsN: what I'm getting at is if I set it to us AZ1, and then 10 minutes later want to start adding/modifying instances in az3
[2013-05-20 18:45:15 -0400] coderanger: jmickle: Sorry, thats basically what we are selling for OPC, if you are interested in an OPC eval version you can sign up at opscode.com
[2013-05-20 18:45:31 -0400] jmickle: coderanger: what is OPC
[2013-05-20 18:45:38 -0400] LarsN: I either need to edit the knife.rb (which I suppose I could do) or start passing command line args. also possible.  I'm trying to be lazy
[2013-05-20 18:45:52 -0400] jmickle: coderanger: sorry didn't realize private chef.
[2013-05-20 18:45:53 -0400] coderanger: jmickle: Opscode Private Chef, a support, HA Chef server turnkey product
[2013-05-20 18:46:23 -0400] coderanger: LarsN: I mean you could do something like knife[:hp_avl_zone] = ENV['AZ'] || 'AZ1'
[2013-05-20 18:46:32 -0400] jmickle: coderanger: got it, we don't mind paying. we just need stable as we are dealing with health care.
[2013-05-20 18:46:55 -0400] jmickle: coderanger: thanks i will check out OPC
[2013-05-20 18:47:08 -0400] LarsN: thanks coderanger :)
[2013-05-20 18:47:30 -0400] coderanger: jmickle: Totally understandable, http://www.opscode.com/private-chef/contact-sales/ if you fill that out we can get you an evaluation copy of OPC with all the automated HA goodness :)
[2013-05-20 18:47:55 -0400] jmickle: coderanger: awesome, yeah we actually have a sales rep, Brandon I will reach out to him as well
[2013-05-20 18:51:33 -0400] techminer: Is anyone else seeing this error in 12.04 trying to do an omnibus install?  http://tickets.opscode.com/browse/CHEF-3679
[2013-05-20 18:52:28 -0400] adamjk-dev: anyone have issues with minitest? I am trying to run it with chef client
[2013-05-20 18:52:30 -0400] adamjk-dev: https://github.com/btm/minitest-handler-cookbook/blob/master/recipes/default.rb#L63-L68
[2013-05-20 18:53:02 -0400] adamjk-dev: I believe minitest is not finding my test cases becuase the cookbook path is not what it expects (so minitest-handler never copies the tests on the VM being provisioned)
[2013-05-20 18:53:49 -0400] kgraham: /win 3
[2013-05-20 18:54:48 -0400] kgraham: hello, I am using chef-server 11.4 latest, on amazon linux, and am unable to create databags or roles, using knife it states that it was successful, but nothing appears
[2013-05-20 18:54:55 -0400] kgraham: tried using web interface as well
[2013-05-20 18:54:58 -0400] kgraham: same result
[2013-05-20 18:55:09 -0400] coderanger: techminer: Whats your output for lsb_release -a
[2013-05-20 18:55:36 -0400] coderanger: kgraham: Can you double check your server package version?
[2013-05-20 18:55:43 -0400] coderanger: Latest for the server is 11.0.8 I thin
[2013-05-20 18:55:49 -0400] coderanger: 11.4 is for chef-client
[2013-05-20 18:55:49 -0400] cassianoleal: anyone has used runit to start a bundler managed service?
[2013-05-20 18:56:04 -0400] kgraham: is there a work around "ERROR: No route matches {:action=>"new", :controller=>"databag_items", :databag_id=>nil}"
[2013-05-20 18:56:08 -0400] coderanger: cassianoleal: Yahr, all of opscode's ruby services :)
[2013-05-20 18:56:22 -0400] techminer: coderanger:  k# lsb_release -a
[2013-05-20 18:56:22 -0400] techminer: No LSB modules are available.
[2013-05-20 18:56:23 -0400] techminer: Distributor ID: Ubuntu
[2013-05-20 18:56:23 -0400] techminer: Description:    Ubuntu 12.04.2 LTS
[2013-05-20 18:56:23 -0400] techminer: Release:        12.04
[2013-05-20 18:56:23 -0400] techminer: Codename:       precise
[2013-05-20 18:56:24 -0400] coderanger: kgraham: You need to give it a bag ID
[2013-05-20 18:56:25 -0400] kgraham: @coderanger, sure
[2013-05-20 18:56:31 -0400] cassianoleal: coderanger: is there an example of a run script I can look at?
[2013-05-20 18:56:42 -0400] coderanger: cassianoleal: let me pastebin one, sec
[2013-05-20 18:56:50 -0400] cassianoleal: coderanger: I'm having difficulty starting a bundled passenger instance
[2013-05-20 18:56:52 -0400] cassianoleal: thanks!
[2013-05-20 18:57:14 -0400] kgraham: that's when i click on 'create item'
[2013-05-20 18:57:18 -0400] coderanger: cassianoleal: http://hastebin.com/ragegoyika.bash
[2013-05-20 18:57:33 -0400] coderanger: kgraham: What URL are you on when you click that link?
[2013-05-20 18:58:24 -0400] kgraham: https://chef.cloudwards.net/databags/users
[2013-05-20 18:58:45 -0400] kgraham: then 'create item', then that error
[2013-05-20 18:58:53 -0400] kgraham: i'm using latest install of chef server
[2013-05-20 18:59:42 -0400] coderanger: techminer: Hmm, sounds normal, as a workaround you can just grab the deb by hand for the interim
[2013-05-20 18:59:51 -0400] kgraham: uploading any json via knife fails silently too
[2013-05-20 19:00:01 -0400] coderanger: techminer: Can you comment on that ticket with your lsb data?
[2013-05-20 19:00:16 -0400] techminer: sure
[2013-05-20 19:00:18 -0400] coderanger: kgraham: Maybe try deleting and recreating the bag?
[2013-05-20 19:00:51 -0400] kgraham: same
[2013-05-20 19:00:54 -0400] kgraham: now i don't have any items
[2013-05-20 19:01:31 -0400] coderanger: kgraham: What server version are you using and how did you verify that?
[2013-05-20 19:03:24 -0400] btm: @opscode #opschef code review, join: https://plus.google.com/hangouts/_/70a8f5c0a495a3ccbd572c278b0e5e8be1020c9b, watch: http://youtu.be/kRYBhyWO_ZE
[2013-05-20 19:07:11 -0400] kgraham: how do i verify that
[2013-05-20 19:07:14 -0400] kgraham: it's 11.4
[2013-05-20 19:07:34 -0400] cassianoleal: coderanger: thanks man. quick q, though.. how do you manage the installed ruby and how do you template the bin path?
[2013-05-20 19:08:02 -0400] coderanger: kgraham: Again, that is a chef-client version number, not server
[2013-05-20 19:08:11 -0400] coderanger: kgraham: What OS is this on?
[2013-05-20 19:08:48 -0400] kgraham: amazon-linux, el6
[2013-05-20 19:08:50 -0400] coderanger: cassianoleal: Not actually sure how we do ruby, just part of our company-wide base cookbooks that Ruby 1.9.3 gets dumped in /opt
[2013-05-20 19:08:55 -0400] kgraham: how do i find the verison
[2013-05-20 19:09:00 -0400] kgraham: i don't see 'chef-server' anywhere
[2013-05-20 19:09:03 -0400] coderanger: kgraham: rpm -q I think then, my rpm skills are rusty
[2013-05-20 19:09:06 -0400] kgraham: just chef-server-ctl
[2013-05-20 19:09:32 -0400] blud: so, is there a location to obtain the private-chef version for chef11 server? :)
[2013-05-20 19:09:39 -0400] kgraham: i installed it via this curl -L https://www.opscode.com/chef/install.sh | bash
[2013-05-20 19:09:49 -0400] coderanger: kgraham: That only installs the client, not the server
[2013-05-20 19:09:51 -0400] cassianoleal: coderanger: I see. I'm guessing the bin path gets set to a node attribute by this base cookbook?
[2013-05-20 19:10:02 -0400] kgraham: oh ic
[2013-05-20 19:10:03 -0400] kgraham: $ rpm -qa|grep chef
[2013-05-20 19:10:03 -0400] coderanger: cassianoleal: Not sure what you mean
[2013-05-20 19:10:04 -0400] kgraham: chef-server-11.0.8-1.el6.x86_64
[2013-05-20 19:10:19 -0400] coderanger: blud: You can contact sales via our website for an evaluation copy
[2013-05-20 19:10:45 -0400] blud: We already have a license for it, but currently have chef10 installed. I guess they would also be able to give us the full version location?
[2013-05-20 19:11:15 -0400] blud: right now we're running private-chef-1.2.x
[2013-05-20 19:11:47 -0400] coderanger: blud: Please contact your sales rep, they can talk to you about the update process
[2013-05-20 19:11:57 -0400] blud: ok. Thanks :)
[2013-05-20 19:12:11 -0400] coderanger: blud: Not as simple as just upgrading the package since you need to migrate data, etc etc
[2013-05-20 19:12:20 -0400] cassianoleal: coderanger: I believe this runit run script is templated in a cookbook, right?
[2013-05-20 19:12:26 -0400] blud: right, that's expected. I'm just looking for the rpm :D
[2013-05-20 19:12:41 -0400] coderanger: cassianoleal: Yes, using the standard runit cookbook
[2013-05-20 19:12:55 -0400] blud: I'll get our guys to open a ticket, thanks :)
[2013-05-20 19:13:00 -0400] jmickle: coderanger: what is the recommended version of ruby for chef 11 server
[2013-05-20 19:13:12 -0400] coderanger: jmickle: It ships its own
[2013-05-20 19:13:26 -0400] jmickle: coderanger: ok ty
[2013-05-20 19:13:30 -0400] coderanger: jmickle: The only thing we use from the OS is libc and the kernel
[2013-05-20 19:13:52 -0400] jmickle: coderanger: got it, just building a base box right now to install so making sure i get all deps
[2013-05-20 19:14:09 -0400] coderanger: jmickle: Such are the joys of omnibus installers, no deps :)
[2013-05-20 19:14:16 -0400] jmickle: coderanger: hehehe
[2013-05-20 19:16:14 -0400] cassianoleal: coderanger: Yes, the same I'm using. you still have to create the script template in your own cookbook and pass parameters to it. :)
[2013-05-20 19:16:49 -0400] coderanger: cassianoleal: Yes, but I don't what params you are talking about
[2013-05-20 19:17:08 -0400] coderanger: cassianoleal: As you can see from the template, the only variable param I pass in that matters is the user to run as
[2013-05-20 19:18:29 -0400] cassianoleal: coderanger: hah, you're right that's the actual template. :-/ that means you have the path hardcoded, then
[2013-05-20 19:18:35 -0400] cassianoleal: thanks
[2013-05-20 19:18:36 -0400] cassianoleal: :)
[2013-05-20 19:18:55 -0400] coderanger: cassianoleal: Yep, they are all fixed
[2013-05-20 19:20:57 -0400] jmickle: omg chef 11 so much easier to install already
[2013-05-20 19:21:13 -0400] kgraham: i guess i'll try and rebuild this on ubuntu12.04
[2013-05-20 19:21:19 -0400] kgraham: i can't figure out what causes this bug
[2013-05-20 19:21:22 -0400] kgraham: just stops working
[2013-05-20 19:22:33 -0400] coderanger: kgraham: sorry, getting pulled back to $dayjob, sounds like something is sending weird data to the server
[2013-05-20 19:22:53 -0400] coderanger: If you set -l debug it should dump more info about what URLs knife is trying to hit
[2013-05-20 19:25:31 -0400] kgraham: np i'm sure it's because az linux is unsupported
[2013-05-20 19:26:58 -0400] coderanger: That seems unlikely, but technically true that we only support RHEL6
[2013-05-20 19:27:45 -0400] kgraham: yeah, did that it all seems legit, same results when i use the web interface
[2013-05-20 19:27:59 -0400] kgraham: np, i'll rebuild, and if i come across the bug again will let you know
[2013-05-20 19:28:20 -0400] coderanger: kgraham: One thing to check is that you aren't using odd unicode characters anywhere
[2013-05-20 19:29:32 -0400] UForgotten: can someone help me dry up some code?
[2013-05-20 19:29:54 -0400] UForgotten: I have four recipes that do the exact same thing just with different local attributes
[2013-05-20 19:30:38 -0400] UForgotten: is include_recipe smart enough to create new instances of each recipe if it is included in multiple places?
[2013-05-20 19:31:11 -0400] paulmooring: UForgotten: sounds like that's begging to be a lwrp or definition to me
[2013-05-20 19:31:51 -0400] UForgotten: paulmooring: can't just put the common code in another recipe and include it so the code is not duplicated?
[2013-05-20 19:33:17 -0400] paulmooring: UForgotten: no, even if the recipe would run multiple times you can't parameterize include_recipe for you're different attributes
[2013-05-20 19:34:07 -0400] paulmooring: a lwrp would be best for sure, but a definition comes pretty close to letting you copy/paste the recipe into a re-usable parameterized thing
[2013-05-20 19:35:45 -0400] UForgotten: hrm
[2013-05-20 19:36:32 -0400] UForgotten: are definitions going to be supported going forward?
[2013-05-20 19:37:16 -0400] adamjk-dev: any1 used minitest and chef client?
[2013-05-20 19:37:17 -0400] paulmooring: I can't garuntee anything, but they haven't been deprecated yet so you're fine for chef 11.x
[2013-05-20 19:37:33 -0400] adamjk-dev: minitest fails to find tests because the cookbook path is not correct: /srv/chef/file_store/cookbooks
[2013-05-20 19:37:41 -0400] adamjk-dev: so no tests are run after provisioning
[2013-05-20 19:37:49 -0400] spox: yeah, there has been mutterings about auto converting them to provides behind the scenes
[2013-05-20 19:38:06 -0400] spox: but i would imagine if that ever actually happened, there would be loads of unintended consequences :P
[2013-05-20 19:38:10 -0400] jtimberman: UForgotten: yes
[2013-05-20 19:38:46 -0400] jtimberman: there are currently no plans to change how definitions work. i don't think there's even a ticket about changing their behavior.
[2013-05-20 19:38:52 -0400] spox: adamjk-dev: how is the path incorrect?
[2013-05-20 19:39:19 -0400] adamjk-dev: spox: I should say, I would think the path would point to where vagrant was run from or something
[2013-05-20 19:39:36 -0400] spox: adamjk-dev: the tests are contained within the cookbook itself
[2013-05-20 19:39:39 -0400] adamjk-dev: spox: I am failing to get minitest to find my tests to store them on the machine
[2013-05-20 19:39:56 -0400] adamjk-dev: spox: /srv/chef/file_store/cookbooks doesn't exist on my machine
[2013-05-20 19:39:58 -0400] spox: after the run, the handlers pick out the files from the cookbook and runs them based on recipes in the run list
[2013-05-20 19:40:30 -0400] adamjk-dev: spox: makes sense, but the cookbook path that the minitest-handler cookbook looks in does not exist
[2013-05-20 19:41:42 -0400] adamjk-dev: spox: or, that is the cookbook path on the VM being provisioned?
[2013-05-20 19:41:49 -0400] spox: well it generates the path based on the cookbook store used in the client run, so there shouldn't be much of an issue
[2013-05-20 19:42:24 -0400] spox: adamjk-dev: just hop onto the node directly, and try running chef-client from there directly
[2013-05-20 19:42:45 -0400] spox: also, are your tests in the correct locations within the cookbook file structure?
[2013-05-20 19:42:48 -0400] adamjk-dev: spox: try running chef client from the VM being provisioned?
[2013-05-20 19:43:02 -0400] adamjk-dev: spox: on the file store on the VM, there are no tests showing up
[2013-05-20 19:43:21 -0400] spox: do you have tests in your cookbook locally?
[2013-05-20 19:43:56 -0400] adamjk-dev: spox: rundeck_test/files/default/tests/minitest/
[2013-05-20 19:44:18 -0400] adamjk-dev: spox: I see the tests on the Chef server under files
[2013-05-20 19:44:18 -0400] spox: adamjk-dev: okay. have you knife cookbook upload'ed that cookbook since you added the tests?
[2013-05-20 19:44:30 -0400] adamjk-dev: spox: yeah, I have, since I see them on the chef servefr
[2013-05-20 19:44:44 -0400] spox: okay, do you see the cookbooks attempting to sync during provision?
[2013-05-20 19:47:46 -0400] rava: there a good resource for writing ruby specifically around chef? like what abstractions and interfaces are commonly used, etc..
[2013-05-20 19:48:16 -0400] Iano: anyone use the subversion provider under Windows? I'm getting a return value of 42 vs 0. found an old ticket on the issue but no updates in the past year
[2013-05-20 20:01:44 -0400] Naji: did someone had problems with the nginx cookbook? undefined method `[]' for nil:NilClass isnt that helpful...
[2013-05-20 20:02:26 -0400] btm: @opscode #opschef cookbook code review: join: https://plus.google.com/hangouts/_/66094535ce27a4c197811b235d5af5f27a91122c, watch: http://youtu.be/P67Uj7g6HZg
[2013-05-20 20:10:51 -0400] timsmith: apparently code review using GoGo Inflight doesn't really work
[2013-05-20 20:12:13 -0400] egon: Has anyone figured out the download cookbook problem? ERROR: Yajl::ParseError: lexical error: invalid char in json text.
[2013-05-20 20:12:25 -0400] egon: There's some references online, but no solutions that I've found.
[2013-05-20 20:18:38 -0400] jmickle: hey coderanger you around?
[2013-05-20 20:18:45 -0400] coderanger: vaguely, whats up
[2013-05-20 20:19:07 -0400] jmickle: installing chef11 and trying to test my knife config doing knife list /users as per this doc http://www.opscode.com/blog/2013/03/12/5106/
[2013-05-20 20:19:15 -0400] jmickle: returning error /users: No such file or directory
[2013-05-20 20:19:36 -0400] UForgotten: the LWRP documentation is very... weak :)
[2013-05-20 20:20:38 -0400] UForgotten: can someone point me to an LWRP that basically runs a bunch of tasks using a set of attributes?
[2013-05-20 20:21:03 -0400] jmickle: UForgotten: what exactly are you looking for
[2013-05-20 20:22:15 -0400] UForgotten: jmickle: see my last. I want to dry up code. Have four different recipes that are identical except for some attributes.
[2013-05-20 20:22:49 -0400] kgraham: @coderanger , reinstalled using ubuntu 12.04, latest chef server, same result
[2013-05-20 20:22:54 -0400] kgraham: cannot update databag items or roles
[2013-05-20 20:23:53 -0400] coderanger: kgraham: Can you please pastebin the output of knife -vv data bag from file <bag> <item>
[2013-05-20 20:24:05 -0400] kgraham: http://pastebin.com/NLzHxaGM
[2013-05-20 20:24:07 -0400] kgraham: done
[2013-05-20 20:24:23 -0400] jmickle: UForgotten: you should read the docs on using environments roles and overrides and structure your recipes accordingly. I
[2013-05-20 20:24:34 -0400] coderanger: jmickle: I think that should be data_bags/users
[2013-05-20 20:24:45 -0400] UForgotten: jmickle: nope. its four recipes onthe same machine, not in different roles or environments
[2013-05-20 20:25:01 -0400] coderanger: jmickle: Oh, I see what it is doing
[2013-05-20 20:25:15 -0400] coderanger: jmickle: You have chef11 client installed on your workstation, right?
[2013-05-20 20:25:32 -0400] coderanger: UForgotten: Which docs are you looking at?
[2013-05-20 20:25:44 -0400] jmickle: coderanger: probably not, that literally just clicked to my mind i hadn't done that yet as i wanted to test chef 11 on 1 server first
[2013-05-20 20:26:04 -0400] UForgotten: coderanger: the opscode docs. paulmooring is PMing with me as well.
[2013-05-20 20:26:13 -0400] coderanger: kgraham: Thats the bag create, not the item create
[2013-05-20 20:27:56 -0400] UForgotten: I just want to re-execute the same recipes with different attributes... not write system level ruby.
[2013-05-20 20:28:12 -0400] coderanger: UForgotten: That is what an LRWP is
[2013-05-20 20:28:21 -0400] kgraham: hmm
[2013-05-20 20:28:22 -0400] kgraham: let me see
[2013-05-20 20:28:44 -0400] coderanger: kgraham: And the bag create seemed to work fine
[2013-05-20 20:29:46 -0400] coderanger: UForgotten: Make a resource with the relevant attributes, and paste the recipe code into a provider action block
[2013-05-20 20:29:52 -0400] coderanger: UForgotten: More or less thats it
[2013-05-20 20:30:10 -0400] coderanger: just reference new_resource.whatever instead of node['whatever']
[2013-05-20 20:30:18 -0400] UForgotten: coderanger: the documentation makes it far more convoluted than that
[2013-05-20 20:30:19 -0400] kgraham: ok, changing it to https, makes knife work, but i still get this in the webui
[2013-05-20 20:30:20 -0400] kgraham: ERROR: No route matches {:action=>"new", :controller=>"databag_items", :databag_id=>nil}
[2013-05-20 20:30:26 -0400] kgraham: tho i have a work around
[2013-05-20 20:30:32 -0400] kgraham: thanks for your help
[2013-05-20 20:31:04 -0400] coderanger: kgraham: The error there is :databag_id=nil, that should be the name of the bag from the URI
[2013-05-20 20:33:57 -0400] UForgotten: coderanger: yeah it doesn't work that way :)
[2013-05-20 20:34:14 -0400] UForgotten: coderanger: can you point me to a legit example?
[2013-05-20 20:34:30 -0400] coderanger: UForgotten: Hmm, let me look for a simple one
[2013-05-20 20:34:59 -0400] UForgotten: coderanger: the ones online are too simple.  I'm getting hung up because it wants both a resource code and provider code ?
[2013-05-20 20:35:15 -0400] coderanger: UForgotten: Yes, you need both halves
[2013-05-20 20:35:43 -0400] coderanger: Here is a relatively simple one https://github.com/coderanger/psf-chef/blob/master/site-cookbooks/haproxy/resources/default.rb https://github.com/coderanger/psf-chef/blob/master/site-cookbooks/haproxy/providers/default.rb
[2013-05-20 20:35:52 -0400] coderanger: just ignore the reload action
[2013-05-20 20:36:49 -0400] coderanger: but the install action should look pretty familiar as a normal bit of chef recipe code more or less
[2013-05-20 20:37:10 -0400] UForgotten: yeah its this defining functions that's throwing me
[2013-05-20 20:37:26 -0400] coderanger: Which functions?
[2013-05-20 20:37:50 -0400] coderanger: The only actual method I use is the resource_name one, which you can see is just for simplicity
[2013-05-20 20:40:30 -0400] tehlers__: hey, we are seeing a big problem with 11.4
[2013-05-20 20:40:43 -0400] tehlers__: chef-client is constantly reading form disk ~3mb/sec
[2013-05-20 20:40:47 -0400] tehlers__: on 10% of our vms
[2013-05-20 20:40:54 -0400] tehlers__: and consuming 3gb of ram
[2013-05-20 20:41:15 -0400] coderanger: tehlers__: Is this inside of a run or while quiescent?
[2013-05-20 20:41:29 -0400] tehlers__: im not sure what its doing how do i check?
[2013-05-20 20:41:39 -0400] coderanger: How do you run chef-client?
[2013-05-20 20:41:48 -0400] tehlers__: daemon
[2013-05-20 20:41:57 -0400] coderanger: Do you use the new fork mode?
[2013-05-20 20:42:01 -0400] tehlers__:  3850 be/4 root     1451.37 K/s    0.00 B/s  0.00 % 99.33 % ruby /usr/bin/chef-client -d -c /etc/chef/clien~t.log -P /var/run/chef/client.pid -i 1800 -s 300
[2013-05-20 20:42:03 -0400] UForgotten: coderanger: do you have the recipe that calls the provider?
[2013-05-20 20:42:19 -0400] coderanger: UForgotten: https://github.com/coderanger/psf-chef/blob/master/site-cookbooks/haproxy/recipes/default.rb
[2013-05-20 20:42:25 -0400] tehlers__: the regular client cookbook that came with 11.4
[2013-05-20 20:42:30 -0400] tehlers__: we did not modify it
[2013-05-20 20:42:44 -0400] coderanger: UForgotten: That part is a little more non-standard, I have a very ... peculiar style for reasons I'm happy to explain, but they get a bit technical :)
[2013-05-20 20:43:26 -0400] UForgotten: coderanger: k. i'm gonna keep hacking around with it.
[2013-05-20 20:43:26 -0400] gkra: bah, my google-fu is weak how do I check against my platform release version?
[2013-05-20 20:43:30 -0400] gkra: I thought it was:
[2013-05-20 20:43:34 -0400] coderanger: tehlers__: Let me check what the default is, sec
[2013-05-20 20:43:46 -0400] gkra: if platform.family?("rhel") and version >= 6
[2013-05-20 20:43:52 -0400] gkra: but that's apparently not right.
[2013-05-20 20:43:56 -0400] coderanger: tehlers__: What OS?
[2013-05-20 20:44:07 -0400] tehlers__: centos 5.9
[2013-05-20 20:44:12 -0400] coderanger: gkra: Try platform_family?
[2013-05-20 20:44:18 -0400] tehlers__: http://community.opscode.com/cookbooks/chef-client 2.2.2
[2013-05-20 20:44:45 -0400] rayrod2030: any good community aws s3 lwrp's?
[2013-05-20 20:45:06 -0400] coderanger: rayrod2030: Yeah, lamont wrote one, I think called s3-file
[2013-05-20 20:46:00 -0400] coderanger: tehlers__: Okay, so not forking mode by default, so that doesn't narrow it down
[2013-05-20 20:46:05 -0400] gkra: coderanger: well, if platform.family?("rhel")  does what it says on the tin, but I need to be able to differentiate between, say, CentOS 5 and CentOS 6...
[2013-05-20 20:46:15 -0400] coderanger: tehlers__: Can you take a strace of the process and see what file it is reading/writing?
[2013-05-20 20:46:40 -0400] jmickle: coderanger: so i made sure to install the latest chef client and knife -v now returns 11.4.4 it still says /users does not exist. is this the right path?
[2013-05-20 20:47:02 -0400] tehlers__: i will check lsof shows it has ~50 pipes open
[2013-05-20 20:48:04 -0400] coderanger: gkra: I don't think we have any special syntax for that, just have to check node['platform_version'] I think
[2013-05-20 20:48:17 -0400] tehlers__: chef-3432 shows this problem is fixed with 11.4.2
[2013-05-20 20:48:22 -0400] tehlers__: im on 11.4.0
[2013-05-20 20:48:39 -0400] coderanger: jmickle: Yeah, that should be looking for the users/ API endpoint on the server, which should exist
[2013-05-20 20:48:47 -0400] coderanger: tehlers__: Ahh, that would do it then :)
[2013-05-20 20:48:50 -0400] gkra: coderanger: oh, duh, thanks.
[2013-05-20 20:49:08 -0400] jmickle: coderanger: interesting. Also i notice on ubuntu12.04 the 11.4 installs hard set to ruby 1.8
[2013-05-20 20:49:17 -0400] coderanger: gkra: https://github.com/opscode/chef/blob/master/lib/chef/dsl/platform_introspection.rb Thats all the special stuffs for platform-fu
[2013-05-20 20:49:18 -0400] tehlers__: we will try and upgrade before digging further
[2013-05-20 20:49:20 -0400] tehlers__: thanks guys
[2013-05-20 20:49:35 -0400] coderanger: jmickle: What do you mean, set ruby 1.8?
[2013-05-20 20:49:53 -0400] jmickle: coderanger: #!/usr/bin/ruby1.8
[2013-05-20 20:50:11 -0400] coderanger: jmickle: Not what what that is relevant to though
[2013-05-20 20:50:37 -0400] coderanger: jmickle: We ship 1.9.2/3, not 1.8
[2013-05-20 20:50:42 -0400] jmickle: coderanger: chef-client and knife have these as their ruby stanza's this creates somewhat of a problem considering the installers ask for ruby1.9.2/3
[2013-05-20 20:50:55 -0400] jmickle: coderanger: i believe we've stumbled upon a bug then :-)
[2013-05-20 20:50:59 -0400] coderanger: jmickle: That sounds very wrong
[2013-05-20 20:51:15 -0400] coderanger: You sure you are looking at the right scripts and not detritus from an old gems install?
[2013-05-20 20:51:26 -0400] jmickle: coderanger: yeah this is a fresh install from the curl
[2013-05-20 20:51:40 -0400] jmickle: coderanger: sec let me pull up the github repo for this
[2013-05-20 20:51:45 -0400] coderanger: jmickle: Can you put a bug report into Jira?
[2013-05-20 20:51:55 -0400] jmickle: coderanger: will do
[2013-05-20 20:53:05 -0400] gkra: :(
[2013-05-20 20:53:06 -0400] gkra: [2013-05-20T20:51:20+00:00] FATAL: NameError: Cannot find a resource for platform on oracle version 6.4
[2013-05-20 20:53:17 -0400] gkra: if platform.family?("rhel") and node['platform_version'] >= 6
[2013-05-20 20:53:54 -0400] gkra: so what am I doing wrong?
[2013-05-20 20:54:01 -0400] gkra: aside from running OEL :)
[2013-05-20 20:54:17 -0400] coderanger: gkra: Use &&
[2013-05-20 20:54:46 -0400] gkra: ah. examples in platform? and platform_family? docs use "and"...
[2013-05-20 20:54:59 -0400] gkra: or is this my lack of familiarity with ruby rearing its head?
[2013-05-20 20:55:40 -0400] coderanger: Just general good ruby guidelines to always use &&/||
[2013-05-20 20:55:44 -0400] eherot: library question: If I create a library file called libraries/default.rb and put this in it:
[2013-05-20 20:55:45 -0400] eherot: class Chef::Recipe
[2013-05-20 20:55:45 -0400] eherot:   def some_method
[2013-05-20 20:55:45 -0400] eherot:     stuff...
[2013-05-20 20:55:45 -0400] eherot:   end
[2013-05-20 20:55:45 -0400] eherot: end
[2013-05-20 20:55:46 -0400] eherot: shouldn't I be able to access it from my recipe just by saying:
[2013-05-20 20:55:46 -0400] eherot: some_method
[2013-05-20 20:55:46 -0400] gkra: coderanger: same error with &&
[2013-05-20 20:55:47 -0400] eherot: ?
[2013-05-20 20:55:57 -0400] coderanger: eherot: Please use a pastebin
[2013-05-20 20:56:06 -0400] coderanger: gkra: Can you pastebin more of the code?
[2013-05-20 20:56:25 -0400] gkra: yeah, you want the chef-client output too?
[2013-05-20 20:57:03 -0400] coderanger: gkra: Sure
[2013-05-20 20:57:09 -0400] coderanger: Moar infos!
[2013-05-20 20:58:07 -0400] gchristensen: is there a way to tell berkshelf to follow my dependant cookbook's berkshelf?
[2013-05-20 20:58:31 -0400] gkra: coderanger: https://gist.github.com/gkra/429a0f3398c028bd4190
[2013-05-20 20:58:58 -0400] coderanger: gkra: platform_family?, not platform.family?
[2013-05-20 20:59:03 -0400] UForgotten: [Mon, 20 May 2013 16:58:37 -0400] FATAL: NoMethodError: undefined method `default_action' for #<Class:0x0000000170d888> :(
[2013-05-20 20:59:03 -0400] eherot: coderanger: the pastebin version, http://pastebin.com/MZ0dnrcN
[2013-05-20 20:59:18 -0400] coderanger: gkra: That is trying to find a resource named 'platform' and call #family? on it
[2013-05-20 20:59:29 -0400] gkra: see, i just needed more eyeballs.
[2013-05-20 20:59:36 -0400] coderanger: UForgotten: What version of chef are you using?
[2013-05-20 20:59:44 -0400] coderanger: UForgotten: or are you using opsworks?
[2013-05-20 21:00:15 -0400] UForgotten: coderanger: chef-solo 0.10.8
[2013-05-20 21:00:22 -0400] UForgotten: should I know what opsworks is? lol.
[2013-05-20 21:00:46 -0400] gkra: coderanger: okay, now I get:
[2013-05-20 21:00:49 -0400] gkra: [2013-05-20T20:59:56+00:00] FATAL: ArgumentError: comparison of String with 6 failed
[2013-05-20 21:00:58 -0400] gkra: if platform_family?("rhel") && node['platform_version'] >= 6
[2013-05-20 21:01:22 -0400] eherot: gkra: node['platform_version'].to_f
[2013-05-20 21:01:23 -0400] coderanger: gkra: you need a .to_i in there :)
[2013-05-20 21:01:28 -0400] gkra: okay
[2013-05-20 21:01:38 -0400] gkra: now *that* is squarely my unfamiliarity with ruby :)
[2013-05-20 21:01:40 -0400] gkra: thanks again
[2013-05-20 21:01:40 -0400] eherot: (is a string otherwise) ;-)
[2013-05-20 21:01:44 -0400] coderanger: UForgotten: No, but 10.8 is too old to use default_action
[2013-05-20 21:01:57 -0400] coderanger: UForgotten: And in general you will find the vast majority of docs to be out of date
[2013-05-20 21:02:12 -0400] coderanger: UForgotten: You can just use actions instead of default_action
[2013-05-20 21:02:28 -0400] UForgotten: coderanger: I'm ok with running action :whatever inside my recipes, just need it to work :)
[2013-05-20 21:02:28 -0400] coderanger: UForgotten: But make sure you add 'action :whatever' to the resource since the default will be :nothing
[2013-05-20 21:06:49 -0400] UForgotten: it didn't do the variable substitution the way I expected it to.
[2013-05-20 21:08:45 -0400] eherot: how does one access a node attribute from within a library?
[2013-05-20 21:10:21 -0400] scottbessler: where is the idiomatic place to store attributes that are specific to a combination of a role and an environment? or am i doing it all wrong :)
[2013-05-20 21:12:20 -0400] jaridmargolin: just discovering chef. setup a very basic vagrant setup that installs nodejs
[2013-05-20 21:12:29 -0400] jaridmargolin: there are a few other utils id like to bootstrap
[2013-05-20 21:12:36 -0400] jaridmargolin: mongo client
[2013-05-20 21:12:51 -0400] jaridmargolin: and a few global npm modules
[2013-05-20 21:13:53 -0400] jaridmargolin: the nodejs is complete using https://github.com/mdxp/nodejs-cookbook
[2013-05-20 21:14:22 -0400] jaridmargolin: wondering, should i create my own cookbook to install the client and global npm modules?
[2013-05-20 21:22:01 -0400] UForgotten:  FATAL: NoMethodError: undefined method `run_action' for "service[myserviceinsideanlwrp]":String
[2013-05-20 21:22:41 -0400] UForgotten: hmm. I wonder if I need to do some more explicit typing somewhere ?
[2013-05-20 21:26:25 -0400] CharlieSu: I'm reading up on migrating to Berkshelf but have a concern I'd like to run by a few Berkshelf users.  We've downloaded site cookbooks in the past that we've made modifications to without changing version numbers, etc..  Will this become a problem when migrating to Berkshelf?
[2013-05-20 21:26:37 -0400] ivey: yep
[2013-05-20 21:26:45 -0400] ivey: but you should stop doing that anyway
[2013-05-20 21:27:02 -0400] CharlieSu: ivey: wasn't me..  :)
[2013-05-20 21:27:08 -0400] ivey: in theory it might be fine, using :path locations
[2013-05-20 21:27:48 -0400] CharlieSu: ivey: any suggestions on how to handle this?
[2013-05-20 21:28:03 -0400] ivey: but you wouldn't take version 1.2.3 of a java library, hack on it, and then build jars w/ the same version as the upstream. so you shouldn't do that with cookbooks.
[2013-05-20 21:28:23 -0400] gkra: ugh, now I've got an error in my template?
[2013-05-20 21:28:51 -0400] gkra: Chef::Mixin::Template::TemplateError
[2013-05-20 21:28:52 -0400] gkra: ------------------------------------
[2013-05-20 21:28:52 -0400] gkra: can't convert String into Integer
[2013-05-20 21:28:54 -0400] ivey: CharlieSu: depends on your setup. if you have them in git, you could use :git paths to point to them
[2013-05-20 21:29:10 -0400] gkra: https://gist.github.com/gkra/f07343cf66a8b8e5c85c#file-gistfile1-txt-L24
[2013-05-20 21:29:20 -0400] CharlieSu: ivey: I inherited this problem.  And now that there is a small team of Chef devs I'd like to migrate to Berkshelf so that things are done right..  I'm almost afraid to thought because I'm not sure what site cookbooks had modifications done to them..  We do use git and I could look at history but it would be a pain..
[2013-05-20 21:30:12 -0400] cwj: CharlieSu: in the long run ensuring "things are done right" is going to require going through the pain of figuring out and unforking your changes
[2013-05-20 21:31:02 -0400] CharlieSu: cwj: yeah i figured..  :(  Not a fun task, but I'd rather do it now than later...
[2013-05-20 21:31:18 -0400] cwj: yep, gotta rip the bandaid off
[2013-05-20 21:31:33 -0400] cwj: i am still working on it myself
[2013-05-20 21:32:43 -0400] miah: CharlieSu: use berkshelf, but start off by doing git filter branch
[2013-05-20 21:32:44 -0400] miah: https://www.kernel.org/pub/software/scm/git/docs/git-filter-branch.html
[2013-05-20 21:32:56 -0400] miah: take your huge repo, and split it up into several smaller repo's
[2013-05-20 21:33:20 -0400] miah: then you can work through a smaller code base per cookbook and figure out what you can replace with upstream or what requires fixes upstream etc
[2013-05-20 21:33:29 -0400] miah: http://sethvargo.com/20130102/moving-to-individual-cookbooks/
[2013-05-20 21:33:31 -0400] miah: there you go
[2013-05-20 21:33:43 -0400] CharlieSu: miah: thanks.. i'll research that
[2013-05-20 21:33:46 -0400] ivey: seth is so awesomely helpful
[2013-05-20 21:34:15 -0400] miah: i think jtimberman has a similar blog post from ages ago
[2013-05-20 21:34:46 -0400] ivey: yeah it's linked in seth's
[2013-05-20 21:34:48 -0400] miah: i just hope you dont work with people like i had at a previous job who saw no benefit at all into splitting up chef-repo and using Berkshelf / Librarian
[2013-05-20 21:36:44 -0400] cwj: anyone tried using test-kitchen with two cookbooks that have data_bags dirs? seems like only one of them gets copied up the VM
[2013-05-20 21:37:00 -0400] miah: no.
[2013-05-20 21:37:10 -0400] CharlieSu: will Berkshelf have an issue if I've got a cookbook named the same as a site cookbook?  say 'hadoop' ?
[2013-05-20 21:37:22 -0400] miah: do you have two test cookbooks, or are you talking about two cookbook depenencies?
[2013-05-20 21:37:34 -0400] ivey: CharlieSu: not if you're always explicit about how you reference it, via :path or :git
[2013-05-20 21:37:34 -0400] miah: CharlieSu: possibly.
[2013-05-20 21:37:44 -0400] miah: right, it really depends on how you reference it
[2013-05-20 21:37:54 -0400] miah: just make sure to be EXPLICIT about all of your cookbooks in the Berksfile
[2013-05-20 21:38:07 -0400] ivey: but you could pretend we said YES and rename it, since that's a good idea anyway
[2013-05-20 21:38:08 -0400] cwj: miah: cookbook i am testing has a data_bags dir, as does a cookbook it depends on
[2013-05-20 21:38:08 -0400] miah: otherwise it will find it on the community site and it probably wont be what you wanted
[2013-05-20 21:38:16 -0400] CharlieSu: ok.  main..  sounds like i'm going to have ot migrate tons of these to company-cookbook
[2013-05-20 21:38:31 -0400] miah: well, i dont think data_bags directory is actually included in the chef upload stuff
[2013-05-20 21:38:42 -0400] ivey: CharlieSu: do you use any community cookbooks?
[2013-05-20 21:39:05 -0400] CharlieSu: ivey: yes..
[2013-05-20 21:39:17 -0400] cwj: miah: the data bag items from the cookbook i am depending on are there, the items from the cookbook i am testing are not
[2013-05-20 21:39:24 -0400] miah: https://github.com/opscode/chef/blob/master/lib/chef/cookbook/cookbook_version_loader.rb#L46
[2013-05-20 21:39:49 -0400] ivey: hmm. would be easier if you didn't.  you could always give it a try without renaming and then see what happens.
[2013-05-20 21:39:50 -0400] miah: er wait thats the cookbook loader, not necessarily the uploader.
[2013-05-20 21:40:06 -0400] miah: anyways, i tend to just not include data_bags in a cookbook because that is making an assumption about usage
[2013-05-20 21:40:25 -0400] cwj: i'm certain its something to do with tk and not chef itself, just wondering if i am missing something obvious
[2013-05-20 21:40:39 -0400] cwj: miah: yes that would be my preference as well, but thats not what i have to work with at the moment
[2013-05-20 21:42:19 -0400] miah: its likely something with tk or berkshelf as its not really being uploaded to a chef server
[2013-05-20 21:42:50 -0400] bean__: CharlieSu: the way that I accomplish that is by naming it companyname-cookbook (though this is often a wrapper to the community cb)
[2013-05-20 21:43:19 -0400] awgross: Is there any resolution for the JSON version conflict between the latest chef and berkshelf versions?
[2013-05-20 21:43:26 -0400] CharlieSu: bean__: yeah I was planning on doing that..  When I need a small change to a community cookbook
[2013-05-20 21:43:49 -0400] ivey: i try and make the change configurable and submit a PR to the community cookbook
[2013-05-20 21:44:02 -0400] awgross: chef 11.4.4 requires "1.4.4 to 1.7.7", Berkshelf 1.4.3 requires "1.8.0"
[2013-05-20 21:44:23 -0400] CharlieSu: ivey: obviously that is the best way, but when you need to just get something out the door you have to do the former..
[2013-05-20 21:44:51 -0400] awgross: so far my only solution is to roll back to Chef 10.18.2, which kinda old
[2013-05-20 21:45:21 -0400] miah: why not chef 11.4.3 ?
[2013-05-20 21:45:28 -0400] ivey: awgross: berkshelf requires >=1.5  wonder what's locking it higher?
[2013-05-20 21:45:36 -0400] miah: and why not omnibus chef :P
[2013-05-20 21:45:39 -0400] awgross: not sure
[2013-05-20 21:45:50 -0400] awgross: miah: this is not inside a VM for an actual run, but outside testing libraries
[2013-05-20 21:45:58 -0400] awgross: miah: otherwise yes, omnibus
[2013-05-20 21:46:08 -0400] miah: cool
[2013-05-20 21:46:11 -0400] awgross: ivey: unsure, checking the dependencies now
[2013-05-20 21:46:28 -0400] miah: i dont have 'Berkshelf' listed in my Gemfile at all, so it doesnt matter for testing =)
[2013-05-20 21:46:49 -0400] ivey: I have 1.7.7 on berkshelf masterish (4 days old)
[2013-05-20 21:46:55 -0400] miah: and im talking about minitest based testing (not tk)
[2013-05-20 21:47:18 -0400] awgross: ivey: interesting, i wonder where its picking up the 1.8 dependenct from
[2013-05-20 21:49:49 -0400] awgross: ivey: where are you pulling your dependencies from, rubygems?
[2013-05-20 21:50:15 -0400] ivey: let me pull and see if anything changed.
[2013-05-20 21:50:54 -0400] awgross: maybe i have a bad cached gem version
[2013-05-20 21:51:41 -0400] awgross: hmm nope
[2013-05-20 21:51:49 -0400] awgross: still getting the conflict
[2013-05-20 21:52:52 -0400] awgross: looks like an issue with bundler
[2013-05-20 21:53:06 -0400] awgross: it reads the berkshelf dependencies to get 1.5+
[2013-05-20 21:53:10 -0400] awgross: but install 1.8
[2013-05-20 21:53:13 -0400] awgross: installs*
[2013-05-20 21:53:23 -0400] awgross: then fails once it starts resolving the chef dependencies
[2013-05-20 21:53:29 -0400] awgross: even though there is no hard constraint
[2013-05-20 21:53:32 -0400] ivey: bundle update json
[2013-05-20 21:55:00 -0400] awgross: really strange, if I force json ~> 1.5.0 first, it works fine
[2013-05-20 21:55:07 -0400] awgross: bundlers resolver just seems to be bugged
[2013-05-20 21:55:54 -0400] awgross: maybe i have an old version
[2013-05-20 21:57:05 -0400] awgross: yep, that was the issue
[2013-05-20 22:06:56 -0400] shutchosx: hi all
[2013-05-20 22:08:06 -0400] shutchosx: i installed the opscode apache2 cookbook, if i want to change the settings for apache2, can i just do it via json in the Vagrantfile or should I create my own cookbook to do it?
[2013-05-20 22:11:33 -0400] log1kal: shutchosx: I use the json in the vagrant file for testing
[2013-05-20 22:11:41 -0400] log1kal: and either a databag or environment for production
[2013-05-20 22:13:51 -0400] UForgotten: I'm having this problem now http://tickets.opscode.com/browse/CHEF-2404
[2013-05-20 22:14:00 -0400] ivey: shutchosx: you could also make a cookbook for the thing you actually want to deploy (your app) and have it include and configure nginx
[2013-05-20 22:14:10 -0400] UForgotten: meh. bbl
[2013-05-20 22:14:23 -0400] ivey: since you don't actually want to deploy nginx, you really want to deploy your thing
[2013-05-20 22:14:58 -0400] shutchosx: ah ok
[2013-05-20 22:16:18 -0400] shutchosx: ivey log1kal: thanks. i want to install a lamp stack and create vhost
[2013-05-20 22:19:42 -0400] jmickle: chef api timing out again
[2013-05-20 22:20:09 -0400] bluekelp: when i remove 'recipe[chef-client::cron]' from a node's run_list, conceptually it would make sense to also remove the crontabs
[2013-05-20 22:20:28 -0400] bluekelp: other than a chef-client::delete-cron recipe, is there another way to achieve this
[2013-05-20 22:21:45 -0400] shutchosx: log1kal: to star apache simply with docroot of /var/www would i do http://pastebin.com/q1ugrDfi ?
[2013-05-20 22:21:58 -0400] bluekelp: having cookbooks/recipes do their own garbage-collection would help prevent confusing behavior b/c in this case the clients will keep running on schedule, which is not intuitive to ppl who don't know deeply how chef works
[2013-05-20 22:22:27 -0400] miah: ideally your library would be capable of detecting resources in the resource collection that define a crontab and then ensure they are all removed
[2013-05-20 22:22:38 -0400] log1kal: shutchosx: that looks fine to me
[2013-05-20 22:23:18 -0400] miah: just have to make sure that all of your cronjobs are actually defined as resources _and_ that they are in the resourcecollection (could be tricky with lwrps)
[2013-05-20 22:23:43 -0400] shutchosx: log1kal: strange because it uses default attributes from the opscode apache2 cookbook
[2013-05-20 22:23:57 -0400] bluekelp: in this case it's the opscode (chef-client) cookbook, but yeah.  are there concepts in chef to aid this sort of "memory" for undoing run_list actions?
[2013-05-20 22:24:17 -0400] miah: most lwrp's dont define use_inline_resources and well ya. those resources kind of end up in the nether
[2013-05-20 22:24:37 -0400] miah: the resource collection allows you to do it, but few people grok that =)
[2013-05-20 22:24:55 -0400] miah: i spoke about it at chefconf, library style cookbooks with uninstallation routines
[2013-05-20 22:24:57 -0400] bluekelp: miah: do you have a good link/url to read up on?
[2013-05-20 22:25:28 -0400] miah: you can watch my talk, thats about the only docs i have on it now
[2013-05-20 22:40:08 -0400] monokrome: Hi. I'm having trouble setting up Hosted Chef. I have an account that we are paying for, but I can't get nodes to deploy.
[2013-05-20 22:40:29 -0400] monokrome: It generates all of these config files - and they still don't work somehow.
[2013-05-20 22:42:32 -0400] Majost1: I am trying to write a simple json lint check for my roles, but the standard json gem seems to not like the syntax of the roles -- is there some trick I need to use to parse these?
[2013-05-20 22:43:43 -0400] coderanger: monokrome: Can you be more specific about what isn't working?
[2013-05-20 22:44:00 -0400] coderanger: Majost1: Can you pastebin the file?
[2013-05-20 22:44:46 -0400] miah: Majost1: are your roles in json or ruby dsl =)
[2013-05-20 22:46:23 -0400] monokrome: coderanger: Yeah. I try to deploy and it says client monokrome doesn't have access
[2013-05-20 22:46:37 -0400] monokrome: for some reason the new machine is trying to use the client from my workstation
[2013-05-20 22:47:37 -0400] coderanger: monokrome: Did you use knife bootstrap to install it?
[2013-05-20 22:47:46 -0400] monokrome: yeah
[2013-05-20 22:47:55 -0400] coderanger: monokrome: Did you set -N monokrome?
[2013-05-20 22:48:19 -0400] coderanger: Or rather, which process is erroring
[2013-05-20 22:48:20 -0400] monokrome: yes
[2013-05-20 22:48:34 -0400] coderanger: is it the knife bootstrap, or chef-client on the bootstrap'd node?
[2013-05-20 22:48:40 -0400] monokrome: I wonder if my client doesn't have permission to read the validation key
[2013-05-20 22:48:42 -0400] monokrome: Would that be an issue?
[2013-05-20 22:48:48 -0400] monokrome: knife bootstrap
[2013-05-20 22:48:48 -0400] coderanger: No, you just set the node name to be the same as your user
[2013-05-20 22:48:53 -0400] coderanger: which you can't do
[2013-05-20 22:48:59 -0400] monokrome: the node name is messaging
[2013-05-20 22:49:02 -0400] monokrome: my user is monokrome
[2013-05-20 22:49:24 -0400] coderanger: You said yes to 'did you add -N monokrome'
[2013-05-20 22:49:29 -0400] Majost1: miah: json
[2013-05-20 22:49:33 -0400] jmickle: coderanger: gettings 502's back from api.opscode.com
[2013-05-20 22:49:41 -0400] monokrome: In a few minutes, I can PM you deploy output
[2013-05-20 22:49:47 -0400] monokrome: oh
[2013-05-20 22:49:50 -0400] monokrome: I thought you were sayin
[2013-05-20 22:49:54 -0400] monokrome: Did you add -N, monokrome?
[2013-05-20 22:49:57 -0400] monokrome: sorry
[2013-05-20 22:50:00 -0400] monokrome: I added `-N messaging`
[2013-05-20 22:50:05 -0400] coderanger: Ahh, okay
[2013-05-20 22:50:22 -0400] coderanger: So yeah, run it with -vv and pastebin the output
[2013-05-20 22:50:34 -0400] Majost1: miah: Trying to do this --  parse = JSON.parse(File.read('myrole.json'))
[2013-05-20 22:50:50 -0400] Majost1: and the json parser barfs
[2013-05-20 22:51:21 -0400] coderanger: Majost1: Probably because it sees json_class:Chef::Role
[2013-05-20 22:51:25 -0400] coderanger: and then might go boom
[2013-05-20 22:51:30 -0400] Majost1: coderanger: yep
[2013-05-20 22:51:40 -0400] coderanger: lolrubby
[2013-05-20 22:51:50 -0400] monokrome: -vv doesn't do anything
[2013-05-20 22:52:04 -0400] coderanger: monokrome: Sorry. -VV
[2013-05-20 22:52:09 -0400] coderanger: extra verbose more :)
[2013-05-20 22:52:13 -0400] monokrome: ok
[2013-05-20 22:52:17 -0400] Majost1: coderanger: not that this helps -- but I can parse it with demjson in python though
[2013-05-20 22:52:19 -0400] Majost1: heh
[2013-05-20 22:52:40 -0400] coderanger: Majost1: Sure, not actually sure if there is a way to tell Ruby to not autovivify objects in the stream
[2013-05-20 22:53:04 -0400] kallistec: Majost1: /cc coderanger :create_additions => false
[2013-05-20 22:53:15 -0400] kallistec: or JSON.create_id = "stfu"
[2013-05-20 22:53:52 -0400] coderanger: kallistec: That is totally not in the docs :P
[2013-05-20 22:54:27 -0400] coderanger: Or rather, not in any way that makes sense
[2013-05-20 22:54:48 -0400] Majost1: The docs says it defautls to false
[2013-05-20 22:56:54 -0400] Majost1: the docs lie
[2013-05-20 22:56:58 -0400] Majost1: heh
[2013-05-20 22:57:05 -0400] coderanger: Majost1: If you want to be lazy, python -mjson.tool
[2013-05-20 22:57:06 -0400] Majost1: kallistec: thanks! =)
[2013-05-20 22:57:17 -0400] kallistec: Majost1: default was changed in json 1.7.8 or something
[2013-05-20 22:57:26 -0400] coderanger: That gives you a return code of 0/1 depending on valid
[2013-05-20 22:58:08 -0400] Majost1: oooh, that python trick is handy! =)
[2013-05-20 22:58:58 -0400] coderanger: Majost1: If you only know two python -m tricks, know that one and python -mSimpleHTTPServer
[2013-05-20 22:59:02 -0400] monokrome: coderanger: PM'd that gist
[2013-05-20 22:59:36 -0400] coderanger: monokrome: validation_client_name  "monokrome"
[2013-05-20 22:59:53 -0400] monokrome: coderanger: Right, but you can see the command which I ran at the bottom
[2013-05-20 22:59:59 -0400] coderanger: monokrome: That should be orgname-validator or something
[2013-05-20 23:00:19 -0400] coderanger: yes, you need to fix it in your local config
[2013-05-20 23:00:50 -0400] coderanger: bootstrap uses the validation client name and key from your workstation, copies them to the host as part of the bootstrap process
[2013-05-20 23:01:13 -0400] monokrome: Oh, I see!
[2013-05-20 23:01:16 -0400] monokrome: I will try that
[2013-05-20 23:01:17 -0400] monokrome: Thanks
[2013-05-20 23:01:36 -0400] coderanger: monokrome: Just grab the autogenerated knife config from manage.opscode.com
[2013-05-20 23:01:42 -0400] coderanger: monokrome: It has the right settings for that stuff
[2013-05-20 23:01:45 -0400] monokrome: That's what I'm using
[2013-05-20 23:02:14 -0400] monokrome: I just had to change one thing in it
[2013-05-20 23:02:17 -0400] monokrome: and changed that on accident
[2013-05-20 23:04:27 -0400] greyull: Hey - if I install chef-server from the RPM, do I still need to do the gem installs for non-hosted Chef?
[2013-05-20 23:06:03 -0400] Majost1: ls
[2013-05-20 23:06:05 -0400] Majost1: oops
[2013-05-20 23:06:06 -0400] Majost1: heh
[2013-05-20 23:07:20 -0400] coderanger: greyull: Don't do gem installs anywhere for anything
[2013-05-20 23:07:25 -0400] coderanger: omnibus is the one true way
[2013-05-20 23:08:01 -0400] greyull: coderanger: Guess the wiki entry on setting up the Chef server is outdated.
[2013-05-20 23:08:17 -0400] greyull: http://wiki.opscode.com/display/chef/Installing+Chef+Server+Manually#InstallingChefServerManually-InstallChefServer
[2013-05-20 23:08:23 -0400] greyull: That's what I've been following along with.
[2013-05-20 23:09:49 -0400] monokrome: coderanger: looks like that fixed that issue, but now I'm back to the issue I had before. This one is weird...
[2013-05-20 23:10:00 -0400] miah: the wiki is super out of date, you should check docs.opscode.com
[2013-05-20 23:10:12 -0400] monokrome: client.pem ends up an empty file on the new node
[2013-05-20 23:10:17 -0400] monokrome: so chef-client fails
[2013-05-20 23:10:52 -0400] coderanger: monokrome: Is the key intact and readable on your local workstation?
[2013-05-20 23:11:47 -0400] monokrome: It's organization-validator.pem right?
[2013-05-20 23:12:09 -0400] monokrome: If so then yes
[2013-05-20 23:13:36 -0400] coderanger: monokrome: It is whatever file validation_key points at
[2013-05-20 23:14:35 -0400] coderanger: greyull: I'll mark that as deprecated, thanks
[2013-05-20 23:14:40 -0400] coderanger: Its an eternal fight
[2013-05-20 23:14:54 -0400] coderanger: we have like 4000 slight variations on the install instructions all over the wiki
[2013-05-20 23:15:11 -0400] coderanger: Last Edited in 2011 is a good clue to ignore things though :)
[2013-05-20 23:15:26 -0400] miah: information older than ~3 months is out of date =)
[2013-05-20 23:15:30 -0400] greyull: That's what I get for not reading timestamps.
[2013-05-20 23:15:51 -0400] greyull: I think these should be up-to-date enough: http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo
[2013-05-20 23:16:08 -0400] coderanger: greyull: Yep, and note the pretty red warning :)
[2013-05-20 23:16:25 -0400] greyull: Oh yeah, that'd be good to pay attention to.
[2013-05-20 23:16:35 -0400] coderanger: ::thwap::
[2013-05-20 23:16:52 -0400] greyull: I should get some more caffeine in my bloodstream.
[2013-05-20 23:17:45 -0400] coderanger: I really have confluence
[2013-05-20 23:17:48 -0400] coderanger: er, hate
[2013-05-20 23:18:06 -0400] miah: everybody does, even the people who develop it at atlassian
[2013-05-20 23:18:54 -0400] greyull: Well then, that should actually answer my initial question. A side-attempt I tried ended up being the right process, I already installed the RPM. :V
[2013-05-20 23:19:17 -0400] monokrome: coderanger: That file is readable, and it's formatted correctly
[2013-05-20 23:19:28 -0400] monokrome: but on the new node it ends up as a blank file
[2013-05-20 23:19:38 -0400] greyull: Although I just got...
[2013-05-20 23:19:41 -0400] greyull: "Error executing action `run` on resource 'execute[/opt/chef-server/embedded/bin/chpst -u chef_server -U chef_server /opt/chef-server/embedded/bin/rabbitmqctl wait /var/opt/chef-server/rabbitmq/db/rabbit@localhost.pid]'
[2013-05-20 23:19:42 -0400] greyull: "
[2013-05-20 23:20:11 -0400] miah: you installed a rpm, and then expected runit to work...
[2013-05-20 23:20:21 -0400] miah: redhat + runit = lulz. hope you compiled it.
[2013-05-20 23:20:35 -0400] greyull: FORGOT TO INSTALL IT.
[2013-05-20 23:20:36 -0400] greyull: Oops.
[2013-05-20 23:20:36 -0400] coderanger: miah: Thats an omnibus installer, so yes, we did ;-)
[2013-05-20 23:20:46 -0400] greyull: Oh, the rpm should include runit?
[2013-05-20 23:20:48 -0400] coderanger: No, that should all be builtin
[2013-05-20 23:20:57 -0400] coderanger: Omnibus installers include all deps
[2013-05-20 23:21:08 -0400] coderanger: Hence why all those paths point to our /opt blob
[2013-05-20 23:21:13 -0400] coderanger: See what the error is
[2013-05-20 23:21:20 -0400] coderanger: Maybe rabbit died on startup or something
[2013-05-20 23:21:24 -0400] greyull: Possibly.
[2013-05-20 23:21:32 -0400] miah: on a fresh install. thats odd =)
[2013-05-20 23:21:43 -0400] greyull: The fact that I messed with a bunch of dependencies doing that manual setup might've done odd things.
[2013-05-20 23:21:54 -0400] greyull: Might just revert the VM to a previous snapshot
[2013-05-20 23:23:07 -0400] coderanger: Also possible you just crossed some streams
[2013-05-20 23:23:15 -0400] greyull: Possible.
[2013-05-20 23:23:23 -0400] coderanger: Like if you installed the omnibus RPM _and_ normal redhat rabbitmq
[2013-05-20 23:23:25 -0400] greyull: I had a yum install of rabbitmq-server
[2013-05-20 23:23:27 -0400] coderanger: that would make things sadpanda
[2013-05-20 23:23:27 -0400] greyull: Yeah
[2013-05-20 23:23:28 -0400] greyull: So
[2013-05-20 23:23:29 -0400] greyull: I removed tat
[2013-05-20 23:23:31 -0400] greyull: that*
[2013-05-20 23:23:36 -0400] greyull: Seems to be running better now
[2013-05-20 23:24:04 -0400] greyull: Chef-server reconfigured, hooray.
[2013-05-20 23:25:09 -0400] miah: awesome
[2013-05-20 23:25:24 -0400] cassianoleal: is it just me or is github highly unstable? I've been having random timeouts since yesterday afternoon...
[2013-05-20 23:25:59 -0400] greyull: Cassia: I just did a couple git clones myself and had no issue.
[2013-05-20 23:26:07 -0400] greyull: Perhaps ISP/DNS issues?
[2013-05-20 23:26:16 -0400] miah: cassianoleal: https://status.github.com/
[2013-05-20 23:26:59 -0400] greyull: Default web-ui port is 4000, right?
[2013-05-20 23:27:03 -0400] cassianoleal: miah: yeah, I saw that, but I'm having the same timeouts from 3 different networks -- home, work and friend's it's probably a local problem here, then
[2013-05-20 23:27:23 -0400] greyull: Oh wait nevermind
[2013-05-20 23:30:52 -0400] coderanger: greyull: https/443
[2013-05-20 23:31:09 -0400] greyull: coderanger: Yeah, just realized that. 4000 I'm assuming is the chef-server itself
[2013-05-20 23:31:40 -0400] coderanger: greyull: No, its all the same
[2013-05-20 23:31:50 -0400] greyull: Ah.
[2013-05-20 23:32:01 -0400] greyull: So if knife.rb points to server:4000?
[2013-05-20 23:32:08 -0400] coderanger: We hide the internal routing behind an nginx load balancer in chef 11
[2013-05-20 23:32:18 -0400] coderanger: greyull: Probably won't work, but I don't know
[2013-05-20 23:32:24 -0400] greyull: Ah, fancy magicks with nginx I never got into too far.
[2013-05-20 23:32:29 -0400] coderanger: I think erchef defaults to something new
[2013-05-20 23:32:35 -0400] coderanger: never looked though
[2013-05-20 23:32:42 -0400] coderanger: but the correct answer is https://server
[2013-05-20 23:34:08 -0400] miah: nginx is so bad at load balancing.. it makes me sad to hear that =)
[2013-05-20 23:34:14 -0400] jmickle: whats the best way to upgrade chef client on all the servers to chef client 11
[2013-05-20 23:34:19 -0400] jmickle: or will chef client 10 still work?
[2013-05-20 23:35:07 -0400] coderanger: miah: Yeah yeah, we could use something written Ruby and it wouldn't matter :P
[2013-05-20 23:35:14 -0400] coderanger: jmickle: 10 clients will work fine
[2013-05-20 23:35:20 -0400] jmickle: coderanger: ty
[2013-05-20 23:35:30 -0400] miah: lol
[2013-05-20 23:35:37 -0400] coderanger: jmickle: Of course you should still upgrade eventually because chef 11 is awesome
[2013-05-20 23:35:53 -0400] jmickle: coderanger: yeah the plan is to upgrade but id prefer to do the clients in phases
[2013-05-20 23:36:01 -0400] coderanger: Yep, thats the way to do it
[2013-05-20 23:36:23 -0400] jmickle: coderanger: i still can't get that users api query to work :(
[2013-05-20 23:49:28 -0400] bluekelp: i need to add a single line to the end of a template that's in an opscode community cookbook. is there a way to do this w/o forking the cookbook?  i'd really like to override somehow and not fork
[2013-05-20 23:49:29 -0400] greyull: coderanger: Is there a way to change the default bootstrap user instead of root?
[2013-05-20 23:50:25 -0400] coderanger: greyull: https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap.rb#L39 so knife[:ssh_user] = 'whatever'
[2013-05-20 23:50:41 -0400] greyull: Awesome.
[2013-05-20 23:50:44 -0400] greyull: Thanks for all the help!
[2013-05-20 23:50:47 -0400] coderanger: bluekelp: Check out chef-rewmind
[2013-05-20 23:50:51 -0400] coderanger: er, rewind
[2013-05-20 23:50:56 -0400] coderanger: I can type good
[2013-05-20 23:54:41 -0400] bluekelp: coderanger: do you know how i can get the rendered (or raw) contents of the template from the original cookbook w/o having to copy-pasta it?
[2013-05-20 23:54:58 -0400] coderanger: bluekelp: That part you just have to copy-pasta, sorry
[2013-05-20 23:59:02 -0400] greyull: " chmod: changing permissions of `/etc/chef/validation.pem': Operation not permitted
[2013-05-20 23:59:02 -0400] greyull: "
[2013-05-20 23:59:13 -0400] greyull: Keeps hanging on that. May just reconfigure the client if need be.
[2013-05-20 23:59:41 -0400] jmickle: ERROR: Network Error: Connection timed out - connect(2)/opt/chef/embedded/lib/ruby/1.9.1/net/http.rb:762:in `initialize': Connection timed out - connect(2) (Errno::ETIMEDOUT)
[2013-05-20 23:59:47 -0400] jmickle: getting this error trying to upload to chef 11
