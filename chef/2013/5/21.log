[2013-05-21 00:07:25 -0400] jmickle: seems to die on cookbook upload
[2013-05-21 00:11:24 -0400] jmickle: i think opscode has blocked our servers
[2013-05-21 00:11:28 -0400] jmickle: lol
[2013-05-21 00:28:51 -0400] monokrome: coderanger: Yeah. My config is set up right, and client.pem ends up an empty file on the remote server. What?!///
[2013-05-21 00:42:43 -0400] jameson__: anyone with a really really good memory can recall if there was a bug in chef9 with templates that would kill all slashes when passed as defaults via lwrp?
[2013-05-21 00:43:09 -0400] jameson__: e.g. :default => "/path/to/somewhere" ends up as "/somewhere" in the final template
[2013-05-21 00:46:10 -0400] gkra: anyone have any suggestions on how to go about debugging templates?
[2013-05-21 00:59:30 -0400] jameson__: ah found it.. i have a duplicate config file!
[2013-05-21 01:01:14 -0400] gkra: gah, why the hell is node['chef_environment'] coming back empty?
[2013-05-21 01:01:34 -0400] gkra: it's there when I look it up with: knife node show -F json -l <nodename>
[2013-05-21 01:06:50 -0400] jameson__: :\
[2013-05-21 01:07:22 -0400] jameson__: how do i force the template to be from a specific cookbook?
[2013-05-21 01:07:54 -0400] monokrome: On Hosted CHef, is the validation key for the validation client the same as the validation key for the organization?
[2013-05-21 01:08:03 -0400] jameson__: ah cb.
[2013-05-21 01:09:13 -0400] superbenk: jameson__: templates are relative to the cookbook that contains the recipe that's sourcing them
[2013-05-21 01:09:49 -0400] superbenk: In other words, the template belongs to the cookbook it's in
[2013-05-21 01:17:25 -0400] dpt89: Hello everyone
[2013-05-21 01:17:47 -0400] dpt89: I have a doubt about dependency management in chef server
[2013-05-21 01:18:06 -0400] dpt89: anyone available to help me understand what the best practice is
[2013-05-21 01:18:12 -0400] coderanger: dpt89: Use berkshelf
[2013-05-21 01:18:22 -0400] dpt89: ok, googling it right now
[2013-05-21 01:18:28 -0400] coderanger: (assuming you mean cookbooks dependencies)
[2013-05-21 01:19:23 -0400] dpt89: maybe
[2013-05-21 01:19:27 -0400] dpt89: I have a chef-repo clone
[2013-05-21 01:19:39 -0400] dpt89: and I tried for example oh-my-zsh community cookbook
[2013-05-21 01:19:44 -0400] dpt89: but this installs like 6 dependencies
[2013-05-21 01:19:47 -0400] dpt89: that I won't edit
[2013-05-21 01:19:51 -0400] dpt89: it feels strange
[2013-05-21 01:20:23 -0400] coderanger: When you say 'tried' you mean you used knife cookbook site install, right?
[2013-05-21 01:21:53 -0400] coderanger: If so, then yeah, just use berkshelf to manage those kinds of things
[2013-05-21 01:22:13 -0400] coderanger: dependent cookbooks just end up hidden away like with normal gem or other package installs
[2013-05-21 01:22:19 -0400] coderanger: You don't check them in to your repo
[2013-05-21 01:23:38 -0400] dpt89: yeap
[2013-05-21 01:23:41 -0400] dpt89: exactly, site install
[2013-05-21 01:23:53 -0400] coderanger: Yeah, don't use that anymore
[2013-05-21 01:23:54 -0400] dpt89: exactly, that's what I want
[2013-05-21 01:24:05 -0400] dpt89: http://berkshelf.com/
[2013-05-21 01:24:08 -0400] monokrome: On Hosted Chef, where do I find my organization's PEM file?
[2013-05-21 01:24:10 -0400] dpt89: I'm here but it's not crystal clear
[2013-05-21 01:24:17 -0400] dpt89: I'll google for some more details
[2013-05-21 01:24:19 -0400] coderanger: it was a good stopgap, but the community made berkshelf and librarian which are wolds better
[2013-05-21 01:24:31 -0400] coderanger: dpt89: Thats the site, have you worked with Ruby's bundler at all?
[2013-05-21 01:24:34 -0400] dpt89: but if you happened to know a good link to get the details, please let me know
[2013-05-21 01:24:36 -0400] dpt89: yeap
[2013-05-21 01:24:37 -0400] monokrome: It's crazy that there are better docs on setting up an open source chef server than using the hosted product :/
[2013-05-21 01:24:37 -0400] dpt89: I have
[2013-05-21 01:24:38 -0400] dpt89: a lot!
[2013-05-21 01:24:46 -0400] coderanger: dpt89: Works very similarly to that, but Berkfile instead of Gemfile
[2013-05-21 01:25:03 -0400] dpt89: but it works at repo level and cookbook level, right?
[2013-05-21 01:25:09 -0400] dpt89: that's what I find confusing
[2013-05-21 01:25:20 -0400] coderanger: monokrome: https://learnchef.opscode.com/screencasts/manage-pem-files/
[2013-05-21 01:25:30 -0400] coderanger: monokrome: Screencast and full transcript
[2013-05-21 01:25:38 -0400] monokrome: Thanks, coderanger
[2013-05-21 01:25:48 -0400] coderanger: dpt89: In the glorious berkshelf-y future, every cookbook is a single repo
[2013-05-21 01:26:01 -0400] coderanger: dpt89: Or at least every cookbook that you are pulling in
[2013-05-21 01:26:12 -0400] coderanger: dpt89: But you can use berkshelf for either level
[2013-05-21 01:26:18 -0400] dpt89: ok
[2013-05-21 01:26:22 -0400] dpt89: I think I will go try it
[2013-05-21 01:26:25 -0400] ivey: dpt89: but you can use it to manage your chef-repo in the meantime, if you mustbut the berkshelf folks will make sad faces
[2013-05-21 01:26:26 -0400] dpt89: and come back if I have some more questions
[2013-05-21 01:26:32 -0400] coderanger: dpt89: cookbook-level Berkfilles are for things like test-kitchen automation
[2013-05-21 01:26:42 -0400] coderanger: dpt89: while the repo-level one holds all the things
[2013-05-21 01:26:47 -0400] dpt89: I encountered this problem
[2013-05-21 01:26:57 -0400] dpt89: when trying to bootstrap a node with a cookbook hosted in a server
[2013-05-21 01:27:03 -0400] dpt89: will this work on the server?
[2013-05-21 01:27:20 -0400] coderanger: dpt89: Not sure I understand the question
[2013-05-21 01:27:35 -0400] coderanger: but berkshelf is all about client-side, it just assembles things and pushes cookbooks to the chef-server
[2013-05-21 01:27:46 -0400] coderanger: after that its all the same no matter how you manage things
[2013-05-21 01:29:00 -0400] dpt89: I want to use cookbook X, its dects will be intact, I won't edit those packaged code. I will edit X however (taken form the community) to fit my needs. I want to skip having all the extra cookbooks that I won't edit in my chef-repo. But the server seems to require this. How can I push the modified version of X to the server and when a client tries to install it let it have a way to find the deps?
[2013-05-21 01:29:20 -0400] dpt89: because I tried not installing the dependencies in my chef-repo. Then did, knife cookbook upload -a
[2013-05-21 01:29:46 -0400] dpt89: the modified X went to the server, and then bootstrapped a node using cookbook X, but it fails, because the server doesn't have the dependencies
[2013-05-21 01:30:15 -0400] coderanger: dpt89: Don't edit X
[2013-05-21 01:30:23 -0400] dpt89: if I 'site install' with reps it all works, but it begins to get messy
[2013-05-21 01:30:31 -0400] coderanger: Make a new cookbook, mycompany-X that wraps X with your customizations
[2013-05-21 01:30:47 -0400] coderanger: (and depends on X so it gets pulled in for you via berkshelf)
[2013-05-21 01:31:14 -0400] coderanger: and yeah, you have to upload the deps, but berkshelf will handle that for you
[2013-05-21 01:31:24 -0400] dpt89: when I upload company-X to the server, will berkshelf push the deps?
[2013-05-21 01:31:29 -0400] coderanger: Yes
[2013-05-21 01:31:29 -0400] dpt89: as well
[2013-05-21 01:31:50 -0400] coderanger: Just remember to use the berks upload command instead of the lower-level knife cookbook upload
[2013-05-21 01:31:53 -0400] dpt89: any special command for that? Or the regular knife cookbook upload will suffice?
[2013-05-21 01:31:58 -0400] dpt89: ok, roger that
[2013-05-21 01:32:07 -0400] dpt89: thanks a los coderanger
[2013-05-21 01:32:10 -0400] dpt89: *lot
[2013-05-21 01:32:42 -0400] dpt89: I'll go try it live
[2013-05-21 01:32:48 -0400] dpt89: and I will come back if I run into something
[2013-05-21 01:32:58 -0400] dpt89: thanks for being here. It makes such a difference!
[2013-05-21 01:33:37 -0400] monokrome: coderanger: following that exactly, I get an unauthorized error.
[2013-05-21 01:34:07 -0400] coderanger: monokrome: At which step
[2013-05-21 01:38:02 -0400] monokrome: After I add them to .chef, I am now back to the error that I showed you earlier
[2013-05-21 01:38:08 -0400] monokrome: I did every step
[2013-05-21 01:39:42 -0400] monokrome: knife commands work
[2013-05-21 01:39:46 -0400] monokrome: but bootstrap still fails
[2013-05-21 01:39:49 -0400] monokrome: and knife upload doesn't work?
[2013-05-21 01:52:35 -0400] dpt89: coderanger: berks upload will only upload the deeps from the berksfile, this is not equivalent to knife cookbook upload -a
[2013-05-21 01:52:40 -0400] dpt89: right?
[2013-05-21 01:53:03 -0400] ivey: it will load all the deps of the cookbook you upload, recursively
[2013-05-21 01:53:23 -0400] dpt89: but it doesn't receive deps
[2013-05-21 01:53:27 -0400] dpt89: params sorry
[2013-05-21 01:53:37 -0400] dpt89: I would expect to do berks upload cookbook-X
[2013-05-21 01:53:47 -0400] dpt89: I
[2013-05-21 01:54:07 -0400] ivey: yes
[2013-05-21 01:54:16 -0400] dpt89: it says in the webpage that you can use berkshelf with a repository for manny cookbooks or in a repository containing a single cookbook
[2013-05-21 01:54:21 -0400] ivey: yes
[2013-05-21 01:54:28 -0400] dpt89: but in the former case (e.g. with chef repo) there are no details
[2013-05-21 01:54:44 -0400] dpt89: should I have 1 berksfile on the top of the repo? or oner per cookbook folder?
[2013-05-21 02:02:55 -0400] flaccid: dpt89: #berkshelf
[2013-05-21 02:03:48 -0400] dpt89: thanks flaccid
[2013-05-21 02:05:01 -0400] gkra: so I'm confused now is the proper way to reference the environment node.chef_environment or node['chef_environment'] ?
[2013-05-21 02:08:54 -0400] flaccid: gkra: either but the quotes is better
[2013-05-21 02:09:20 -0400] gkra: flaccid: node['chef_environment'] was coming back empty, though
[2013-05-21 02:09:31 -0400] gkra: node.chef_environment seems to work...
[2013-05-21 02:10:43 -0400] flaccid: gkra: then in that case its probably a method only
[2013-05-21 02:10:52 -0400] sunil_: anyone using the postgresql cookbooks from opscode to also setup postgres replication?  in specifically streaming replication?
[2013-05-21 02:10:57 -0400] flaccid: why are you using that gkra?
[2013-05-21 02:11:41 -0400] gkra: because I need to key attributes based on environment? unless I'm misunderstanding your question...
[2013-05-21 02:12:27 -0400] flaccid: gkra: why would you do that?
[2013-05-21 02:17:32 -0400] coderanger: gkra: node.chef_environment, it isn't a node attr, its special metadata and its own method
[2013-05-21 02:17:40 -0400] gkra: okay
[2013-05-21 02:17:53 -0400] coderanger: This is one of the reasons we discourage node.attr.bar
[2013-05-21 02:17:54 -0400] gkra: coderanger: did I just miss the doc where those are listed out? :)
[2013-05-21 02:17:58 -0400] coderanger: since it confuses the two
[2013-05-21 02:18:13 -0400] flaccid: so why would you practically use that method?
[2013-05-21 02:18:37 -0400] c4milo: has anybody had problems with remote_file before?
[2013-05-21 02:18:43 -0400] coderanger: flaccid: Good example is embedding in Rails configs to set the RACK_ENV name
[2013-05-21 02:19:05 -0400] c4milo: I download the same file using wget and it downloads fine, using remote_file it downloads corrupted :/
[2013-05-21 02:19:09 -0400] flaccid: c4milo: i would assume yes
[2013-05-21 02:19:24 -0400] flaccid: coderanger: thanks for answering :)
[2013-05-21 02:20:17 -0400] coderanger: gkra: Looks like we don't have a good doc on that, we have a REST API description of nodes, but not the Ruby API used in recipe code
[2013-05-21 02:21:34 -0400] c4milo: it's so weird, remote_file is not even checking the checksum properly :/
[2013-05-21 02:21:47 -0400] c4milo: what am I doing wrong? :|
[2013-05-21 02:23:16 -0400] coderanger: c4milo: pastebin would probably help
[2013-05-21 02:24:09 -0400] c4milo: coderanger: https://gist.github.com/c4milo/5617134
[2013-05-21 02:25:40 -0400] coderanger: c4milo: Hmm, how big is the file?
[2013-05-21 02:25:45 -0400] c4milo: coderanger: 2mb
[2013-05-21 02:25:59 -0400] coderanger: okay, so not hitting some weird 2GB file limit or something
[2013-05-21 02:26:28 -0400] coderanger: But the file on disk doesn't match the sha256 you gave?
[2013-05-21 02:26:37 -0400] c4milo: coderanger: it doesn't
[2013-05-21 02:26:53 -0400] c4milo: coderanger: using wget or curl I downloaded another version under /opt
[2013-05-21 02:27:06 -0400] c4milo: that one is fine and has exactly the same size in bytes as the other
[2013-05-21 02:27:32 -0400] c4milo: and I'm able to run tar xvzf on that but not in the one downloaded through remote_file
[2013-05-21 02:27:53 -0400] gkra: coderanger: okay. thanks for the help. :)
[2013-05-21 02:28:07 -0400] coderanger: c4milo: Maybe less or file will help on the corrupted one to see what it is?
[2013-05-21 02:28:52 -0400] c4milo: coderanger: sorry, I'm not following there
[2013-05-21 02:29:22 -0400] coderanger: c4milo: /usr/bin/file or less on the 'corrupted' file to see whats in it
[2013-05-21 02:29:24 -0400] c4milo: ah
[2013-05-21 02:29:27 -0400] coderanger: All null bytes or something?
[2013-05-21 02:30:19 -0400] c4milo: coderanger: https://gist.github.com/c4milo/5617134#file-file-sh
[2013-05-21 02:31:06 -0400] coderanger: So the corrupted one is a valid tgz?
[2013-05-21 02:31:27 -0400] c4milo: coderanger: https://gist.github.com/c4milo/5617134#file-tar-sh
[2013-05-21 02:31:32 -0400] c4milo: doesn't seem like it coderanger
[2013-05-21 02:31:55 -0400] coderanger: c4milo: Is this coming from nodeload by any chance?
[2013-05-21 02:32:09 -0400] coderanger: (the github download builder)
[2013-05-21 02:32:20 -0400] c4milo: coderanger: I'm not sure
[2013-05-21 02:32:42 -0400] c4milo: coderanger: this is the url http://www.process-one.net/downloads/ejabberd/13.03-beta1/ejabberd-13.03-beta1.tgz
[2013-05-21 02:32:42 -0400] coderanger: Is the base url nodeload.github.com/....?
[2013-05-21 02:32:55 -0400] coderanger: Okay, so that rules out lolgithub
[2013-05-21 02:33:11 -0400] coderanger: If you chef-client -l debug, what does it say?
[2013-05-21 02:33:23 -0400] coderanger: It should show that it is trying to redownload since the checksums don't match
[2013-05-21 02:33:34 -0400] coderanger: (can also use whyrun mode to check)
[2013-05-21 02:34:05 -0400] c4milo: coderanger: I'm using chef solo
[2013-05-21 02:34:12 -0400] c4milo: coderanger: does it accept the same flag?
[2013-05-21 02:34:16 -0400] coderanger: It does
[2013-05-21 02:34:28 -0400] coderanger: Just short for --log-level
[2013-05-21 02:34:49 -0400] c4milo: coderanger: I'm using vagrant provision
[2013-05-21 02:35:04 -0400] c4milo: coderanger: looking into how to do that there..
[2013-05-21 02:37:13 -0400] coderanger: c4milo: chef.log_level = :debug
[2013-05-21 02:37:21 -0400] coderanger: in your provisioner config in the vagrantfile
[2013-05-21 02:38:57 -0400] bdha: Confused... I have a cookbook that's included at the end of the run_list, but it's executing first. Only thing I think is different is it's doing a File.open?
[2013-05-21 02:39:22 -0400] bdha: And the File.open is running before any of the other resources in the recipe.
[2013-05-21 02:39:39 -0400] c4milo: coderanger: looking at the output
[2013-05-21 02:40:22 -0400] coderanger: bdha: Is it inside a ruby_block?
[2013-05-21 02:40:35 -0400] coderanger: bdha: remember first all recipes are compiled, then all are executed
[2013-05-21 02:40:44 -0400] coderanger: Any ruby code outside of a resource runs at compile time
[2013-05-21 02:41:10 -0400] bdha: coderanger: derp!
[2013-05-21 02:41:19 -0400] c4milo: coderanger: https://gist.github.com/c4milo/40924f22e4f9d7c01dfc
[2013-05-21 02:42:05 -0400] c4milo: coderanger: it looks normal to me
[2013-05-21 02:42:10 -0400] c4milo: :/
[2013-05-21 02:42:20 -0400] coderanger: Yeah, looks like the download went fine
[2013-05-21 02:42:28 -0400] coderanger: moved on to the next resource that asloded
[2013-05-21 02:43:23 -0400] c4milo: coderanger: does remote_file support gzip?
[2013-05-21 02:43:54 -0400] c4milo: coderanger: I'm honestly clueless at this point
[2013-05-21 02:44:25 -0400] coderanger: c4milo: Oh hey, you're running 0.10.14
[2013-05-21 02:44:36 -0400] coderanger: Yes, there were a bunch of encoding bugs in that version
[2013-05-21 02:44:46 -0400] coderanger: Use something not ancient :)
[2013-05-21 02:45:07 -0400] coderanger: Opscode distributes baseboxes with the lastest chef installed
[2013-05-21 02:45:24 -0400] c4milo: coderanger: I have whatever vagrant uses :/
[2013-05-21 02:46:03 -0400] c4milo: vagrant 1.2.2
[2013-05-21 02:46:19 -0400] coderanger: It isn't a function of vagrant, but of your basebox
[2013-05-21 02:47:29 -0400] c4milo: coderanger: http://files.vagrantup.com/precise64.box
[2013-05-21 02:47:36 -0400] c4milo: that's my base box
[2013-05-21 02:48:12 -0400] coderanger: Yeah, use an opscode one :)
[2013-05-21 02:49:06 -0400] coderanger: Hmm, where did ours go
[2013-05-21 02:49:08 -0400] c4milo: root@precise64:/opt/vagrant_ruby/bin# chef-solo --version
[2013-05-21 02:49:08 -0400] c4milo: Chef: 10.14.2
[2013-05-21 02:49:13 -0400] c4milo: coderanger: gah,
[2013-05-21 02:49:28 -0400] coderanger: 'zactly
[2013-05-21 02:49:38 -0400] c4milo: coderanger: would I have the same issues with 0.9.x I'm using AWS Opswork
[2013-05-21 02:49:43 -0400] c4milo: and that's the version they use
[2013-05-21 02:50:00 -0400] coderanger: They upgraded to some random chef 10 release I thought
[2013-05-21 02:50:06 -0400] coderanger: but 'probably'
[2013-05-21 02:50:09 -0400] c4milo: oh really?
[2013-05-21 02:50:23 -0400] coderanger: Don't get too excited, its still ancient
[2013-05-21 02:50:28 -0400] c4milo: I think I'm just going to use bash or execute and do it through wget or culr
[2013-05-21 02:50:30 -0400] c4milo: curl
[2013-05-21 02:50:37 -0400] c4milo: coderanger: yeah I know :/
[2013-05-21 02:50:43 -0400] coderanger: Sounds good to me
[2013-05-21 02:51:56 -0400] c4milo: coderanger: "Thank you very much! We are currently preparing an update to Chef 11 in OpsWorks." from here https://forums.aws.amazon.com/thread.jspa?threadID=117400&tstart=0
[2013-05-21 02:52:57 -0400] coderanger: c4milo: I'm sure its been on the list since day -1
[2013-05-21 02:53:02 -0400] c4milo: ahaha
[2013-05-21 02:53:07 -0400] coderanger: but as with all things tech, I'll believe it when it ships
[2013-05-21 02:53:24 -0400] coderanger: Or more colloquially, ship it or gtfo
[2013-05-21 02:53:53 -0400] coderanger: How many servers do you have?
[2013-05-21 02:54:43 -0400] c4milo: coderanger: many, about 100
[2013-05-21 02:55:10 -0400] c4milo: well, not that many haha
[2013-05-21 02:55:20 -0400] coderanger: Ahh, well if you get tired of the knock off, hosted chef is always right around the corner ;-)
[2013-05-21 02:55:31 -0400] c4milo: coderanger: I prefer masterless to be honest
[2013-05-21 02:55:46 -0400] c4milo: we are currently using puppet masterless, and are planning on doing the same in Chef
[2013-05-21 02:55:53 -0400] coderanger: Thats a question of usage, not opsworks vs. OHC
[2013-05-21 02:56:17 -0400] coderanger: Opsworks is just a different control backplane, instead of the Chef REST API, it does its own thing
[2013-05-21 02:56:31 -0400] c4milo: coderanger: well, I bet once we start having more servers we will be doing eyes at chef server
[2013-05-21 02:57:05 -0400] coderanger: But if you are interested in stateless chef, be sure to check out Phil D's keynote from chefconf
[2013-05-21 02:57:22 -0400] coderanger: Super easy to setup, and the important bits are open-source :)
[2013-05-21 02:57:35 -0400] c4milo: coderanger: yeah, you are right, it's probably because I need to study more about the benefits of having a chef server
[2013-05-21 02:57:47 -0400] coderanger: Chef-server != stateful
[2013-05-21 02:57:58 -0400] coderanger: at least not necessarily
[2013-05-21 02:58:22 -0400] coderanger: At heart the server is just a way to get control data to the chef engine (name, run list, cookbook data, etc)
[2013-05-21 02:58:42 -0400] c4milo: coderanger: isn't it a single point of failure?
[2013-05-21 02:58:44 -0400] coderanger: I just think it is nicer to have that stuff on an open REST API than inside an Amazon tool
[2013-05-21 02:58:52 -0400] c4milo: coderanger: totally
[2013-05-21 02:59:01 -0400] coderanger: Nah, OHC is highly redundant
[2013-05-21 02:59:29 -0400] coderanger: So no more or less SPoFy than whatever CMDB you use
[2013-05-21 02:59:31 -0400] c4milo: coderanger: where do you guys have the vagrant boxes?
[2013-05-21 03:00:00 -0400] c4milo: I'm really curious about AWS decision of going with chef-solo
[2013-05-21 03:00:32 -0400] coderanger: c4milo: https://github.com/opscode/bento follow that guide with the basebox and then vagrant-omnibus
[2013-05-21 03:00:46 -0400] coderanger: c4milo: Means you don't need a new box when chef releases a new version
[2013-05-21 03:01:01 -0400] coderanger: Using solo makes a lot of sense if you want to reinvent the control backplane
[2013-05-21 03:01:21 -0400] coderanger: I mean if it was me I would write something to copy the REST API, but solo works too
[2013-05-21 03:04:06 -0400] dpt89: Hi
[2013-05-21 03:04:39 -0400] dpt89: I have a package that got reuploaded, with the same version because I'm learning on dev. When I do chef-client it's not redownloading the package
[2013-05-21 03:04:44 -0400] dpt89: how should this be done?
[2013-05-21 03:04:54 -0400] dpt89: so that chef-client get's the version from the server
[2013-05-21 03:05:07 -0400] coderanger: dpt89: Do you mean a cookbook or an actual package?
[2013-05-21 03:05:32 -0400] dpt89: a cookbook
[2013-05-21 03:05:40 -0400] dpt89: sorry, I still get confused with the jargon
[2013-05-21 03:06:24 -0400] coderanger: So it should update on the next chef client run
[2013-05-21 03:06:52 -0400] dpt89: I re upload to the server
[2013-05-21 03:07:06 -0400] coderanger: Cookbook data is stored using a content hash, so it will see that the hash changed and grab the new data from the chef server
[2013-05-21 03:07:08 -0400] dpt89: then when I do chef-client I don't see any indication that it's syncing that cookbook
[2013-05-21 03:07:29 -0400] coderanger: I think the cookbook download messages are hidden by default
[2013-05-21 03:07:38 -0400] coderanger: chef 11 uses the doc formatter by default I think
[2013-05-21 03:08:09 -0400] dpt89: if I want to debug if something's happening
[2013-05-21 03:08:18 -0400] dpt89: using puts form the recipe is the best way?
[2013-05-21 03:08:33 -0400] dpt89: just to generate output as things are running so that I can see how it's all going/
[2013-05-21 03:08:34 -0400] dpt89: ?
[2013-05-21 03:08:50 -0400] dpt89: or is there a more appropriate out to generate output on the chef-client run?
[2013-05-21 03:09:22 -0400] coderanger: dpt89: You can use the log resource, which just writes to the log (which is usually stdout unless you changed something)
[2013-05-21 03:09:32 -0400] coderanger: and you can either set a log_level in chef.rb
[2013-05-21 03:09:42 -0400] dpt89: ok, I will look for it
[2013-05-21 03:09:46 -0400] coderanger: or pass in -l debug on the command line
[2013-05-21 03:09:54 -0400] dpt89: thanks for pointing me at it
[2013-05-21 03:21:29 -0400] densone: Anyone ever run into this error with knife ec2? ERROR: Excon::Errors::Forbidden: Expected(200) <=> Actual(403 Forbidden)
[2013-05-21 03:23:11 -0400] c4milo: coderanger: I put this in my vagrantfile: https://opscode-vm.s3.amazonaws.com/vagrant/opscode_ubuntu-12.04_provisionerless.box
[2013-05-21 03:23:18 -0400] c4milo: and ran vagrant up
[2013-05-21 03:23:42 -0400] coderanger: c4milo: Did you setup vagrant-omnibus?
[2013-05-21 03:23:46 -0400] c4milo: would that be enough? or would I have to do something else?
[2013-05-21 03:23:49 -0400] c4milo: coderanger: nop
[2013-05-21 03:23:55 -0400] coderanger: Do that :)
[2013-05-21 03:24:27 -0400] c4milo: coderanger: installing it
[2013-05-21 03:24:38 -0400] c4milo: so much new info for my brain
[2013-05-21 03:24:41 -0400] c4milo: o.O
[2013-05-21 03:26:04 -0400] c4milo: coderanger: omnibus is pretty awesome
[2013-05-21 03:26:13 -0400] c4milo: coderanger: I can now use chef 0.9.x just liek Opswork
[2013-05-21 03:26:29 -0400] coderanger: c4milo: Well, not that old
[2013-05-21 03:26:42 -0400] coderanger: We started the omnibus installers for chef-client around 10.18 I think
[2013-05-21 03:27:16 -0400] c4milo: ah, I see
[2013-05-21 03:27:37 -0400] c4milo: I bet the opswork team is 3 people :|
[2013-05-21 03:28:04 -0400] dpt89: coderanger: how does chef-client know what packages to download again from the server?
[2013-05-21 03:28:13 -0400] dpt89: I'm pretty sure my cookbook
[2013-05-21 03:28:17 -0400] dpt89: is not getting downloaded again
[2013-05-21 03:28:34 -0400] dpt89: because the contents of the recipe in the machine don't have the updated code
[2013-05-21 03:28:36 -0400] coderanger: c4milo: Looks like 10.12.0 is the earliest omnibus installer we have
[2013-05-21 03:28:57 -0400] c4milo: coderanger: that's for that info
[2013-05-21 03:28:59 -0400] coderanger: dpt89: You can use knife cookbook show to check if the server is correct
[2013-05-21 03:29:30 -0400] coderanger: c4milo: But check your opsworks'd servers, I think opsworks is a few versions ahead of that
[2013-05-21 03:29:47 -0400] c4milo: coderanger: I'll
[2013-05-21 03:30:00 -0400] c4milo: I will
[2013-05-21 03:30:06 -0400] dpt89: yeah, but this only shows the version
[2013-05-21 03:30:12 -0400] dpt89: I'm rewriting it's contents
[2013-05-21 03:30:16 -0400] dpt89: so, how do I know?
[2013-05-21 03:30:35 -0400] dpt89: I'm in dev, every time I make a tiny change I can't change the version, it seems illogical to me
[2013-05-21 03:30:45 -0400] dpt89: what would be the right workflow to test a cookbook in dev?
[2013-05-21 03:31:11 -0400] dpt89: I'm editing, doing berks upload then on the machine chef-client
[2013-05-21 03:32:07 -0400] c4milo: root@apps1:/opt/aws/opsworks/current/bin# ./chef-solo --version
[2013-05-21 03:32:07 -0400] c4milo: Chef: 0.9.15.5
[2013-05-21 03:32:18 -0400] c4milo: coderanger:
[2013-05-21 03:32:18 -0400] c4milo: ^
[2013-05-21 03:32:22 -0400] coderanger: dpt89: knife cookbook show opscode-webui2 0.0.1 recipes default.rb
[2013-05-21 03:32:27 -0400] coderanger: c4milo: sadness
[2013-05-21 03:32:32 -0400] coderanger: dpt89: something like that
[2013-05-21 03:32:37 -0400] c4milo: coderanger: indeed
[2013-05-21 03:32:38 -0400] c4milo: ahahah
[2013-05-21 03:32:40 -0400] dpt89: hmm, ok, trying it
[2013-05-21 03:32:42 -0400] coderanger: dpt89: you can keep adding segment names to drill down
[2013-05-21 03:33:17 -0400] c4milo: coderanger: so, there is no way to make omnibus to install 0.9.15.5?
[2013-05-21 03:33:34 -0400] dpt89: very useful!
[2013-05-21 03:33:38 -0400] coderanger: c4milo: Nope, omnibus didn't exist back then :)
[2013-05-21 03:33:41 -0400] dpt89: It doesn't have the right version indeed
[2013-05-21 03:33:51 -0400] c4milo: coderanger: damn
[2013-05-21 03:33:52 -0400] c4milo: ok
[2013-05-21 03:33:58 -0400] c4milo: I'll use the earliest possible
[2013-05-21 03:33:59 -0400] c4milo: hen
[2013-05-21 03:35:54 -0400] c4milo: coderanger: your baseboxes are huge o.O
[2013-05-21 03:36:41 -0400] c4milo: coderanger: nevermind
[2013-05-21 03:36:46 -0400] c4milo: it's my damn crappy internet
[2013-05-21 03:37:00 -0400] c4milo: 400mb is a fair size
[2013-05-21 03:38:35 -0400] c4milo: coderanger: do you know if there is a way to use data-bags in opswork?
[2013-05-21 03:39:02 -0400] c4milo: coderanger: I keep abusing attributes :/
[2013-05-21 03:39:02 -0400] coderanger: c4milo: Sorry, outside of my realm of experience
[2013-05-21 03:39:37 -0400] c4milo: coderanger: any demo account to take a look at chef server?
[2013-05-21 03:40:02 -0400] c4milo: coderanger: I want to see what I'm loosing
[2013-05-21 03:40:07 -0400] c4milo: hehe
[2013-05-21 03:40:48 -0400] coderanger: c4milo: community.opscode.com/users/new, free tier is up to 5 servers
[2013-05-21 03:41:53 -0400] c4milo: coderanger: Chef organization?
[2013-05-21 03:42:16 -0400] c4milo: space robots working
[2013-05-21 03:50:05 -0400] dpt89: Is there a way to un-freeze a cookbook?
[2013-05-21 03:50:33 -0400] bluekelp: dpt89: you can --force when you upload.  i'm not sure how to unfreeze
[2013-05-21 03:50:43 -0400] dpt89: I have done that
[2013-05-21 03:50:59 -0400] dpt89: I want to stop doing that because I froze accidentally
[2013-05-21 03:51:06 -0400] dpt89: and I couldn't find anything about that online
[2013-05-21 03:51:10 -0400] bluekelp: dpt89: i also think subsequent versions will not be frozen, so maybe try uploading a new version (Can be same just w/diff metadata version)
[2013-05-21 03:51:25 -0400] dpt89: will try that! thanks for the tip
[2013-05-21 03:52:01 -0400] boris317: Has anyone experienced this. When you run "knife data bag show someBag someItem" you see the values you would expect but when you run the chef client from an instance it gets an incorrect value for that data bag
[2013-05-21 03:52:56 -0400] boris317: like someone its getting the wrong value from the chef server
[2013-05-21 03:56:05 -0400] boris317: perms are all fine
[2013-05-21 03:56:16 -0400] boris317: ^ miss tell
[2013-05-21 03:57:28 -0400] c4milo: coderanger: saldy to report that I'm still having the same issue in the latest version of vagrant :|
[2013-05-21 03:57:32 -0400] c4milo: sorry I mean chef
[2013-05-21 03:58:31 -0400] c4milo: coderanger: https://gist.github.com/c4milo/5f21f863bea28d79611a
[2013-05-21 03:58:40 -0400] jtnz: Hi there, just wondering if I have a ruby class in a cookbook library, how can I access the node variable from within the class?
[2013-05-21 04:01:44 -0400] dpt89: what is the exact difference between users & clients in chef-server?
[2013-05-21 04:01:54 -0400] dpt89: I see a recipe using search("users", "*:*")
[2013-05-21 04:02:01 -0400] dpt89: but I don't understand what it is
[2013-05-21 04:02:10 -0400] dpt89: I think it says, give me all users
[2013-05-21 04:02:13 -0400] juliancdunn: c4milo: tar can't unpack that file?
[2013-05-21 04:02:20 -0400] dpt89: but what users, it's form chef server, not the machine
[2013-05-21 04:02:32 -0400] juliancdunn: "tar: This does not look like a tar archive"
[2013-05-21 04:02:37 -0400] c4milo: juliancdunn: not through chef, I was able to unpack it directly from the terminal
[2013-05-21 04:03:06 -0400] c4milo: juliancdunn: it's werid
[2013-05-21 04:03:32 -0400] c4milo: juliancdunn: ah but the one I was able to unpack was one I downloaded using wget
[2013-05-21 04:03:43 -0400] c4milo: juliancdunn: this worked though, gzip -dc ejabberd-13.03-beta1.tgz | tar xzf - for the one chef downloads
[2013-05-21 04:03:46 -0400] dpt89: coderanger: any idea about the difference between a user & a client in chef-server?
[2013-05-21 04:04:15 -0400] coderanger: dpt89: They are similar, user is a client with extra "stuff"
[2013-05-21 04:04:29 -0400] coderanger: dpt89: Notably a username and password to login to the web interface
[2013-05-21 04:04:37 -0400] juliancdunn: c4milo: so the thing is doubly gzipped??
[2013-05-21 04:05:14 -0400] c4milo: juliancdunn: lol, maybe
[2013-05-21 04:05:36 -0400] c4milo: juliancdunn: this is the thing http://www.process-one.net/downloads/ejabberd/13.03-beta1/ejabberd-13.03-beta1.tgz
[2013-05-21 04:05:55 -0400] juliancdunn: btw c4milo, the ark cookbook does what you're doing, only with a nicer interface
[2013-05-21 04:05:58 -0400] dpt89: ok, thanks for clarifying
[2013-05-21 04:06:08 -0400] c4milo: juliancdunn: where?
[2013-05-21 04:06:16 -0400] dpt89: what would be then the appropriate way for listing all users in the current machine?
[2013-05-21 04:06:23 -0400] juliancdunn: c4milo: it's on the community site, but you can also browse its source code at https://github.com/opscode-cookbooks/ark
[2013-05-21 04:06:31 -0400] dpt89: a linux command or some platform resource or hack?
[2013-05-21 04:06:39 -0400] c4milo: juliancdunn: nice, thank you for pointing that out
[2013-05-21 04:09:37 -0400] juliancdunn: dpt89: it depends what you need it for
[2013-05-21 04:09:53 -0400] dpt89: I want to install zsh for every user
[2013-05-21 04:09:59 -0400] dpt89: but it doesn't make sense actually
[2013-05-21 04:10:06 -0400] juliancdunn: the ohai attribute node['etc']['passwd'] contains a hash of all the users in /etc/passwd
[2013-05-21 04:10:24 -0400] dpt89: I want users like ubuntu, vagrant ec2-user or root
[2013-05-21 04:10:28 -0400] dpt89: to have zsh by default
[2013-05-21 04:10:44 -0400] dpt89: but I don't know how to differentiate from other users
[2013-05-21 04:12:23 -0400] juliancdunn: dpt89: use the user resource with the :modify action and set their shells to be zsh?
[2013-05-21 04:13:18 -0400] dpt89: ok, that sound more elegant than what I had in mind
[2013-05-21 04:13:19 -0400] juliancdunn: or :manage if you don't care about errors if the users don't exist
[2013-05-21 04:13:23 -0400] dpt89: I'll go check the docs for users
[2013-05-21 04:13:26 -0400] dpt89: thanks for the hint
[2013-05-21 04:13:44 -0400] juliancdunn: np
[2013-05-21 04:26:55 -0400] dpt89: Goodbye everyone. This place is great to get things going much faster, me (& my company) appreciate a lot. Have a good night.
[2013-05-21 04:35:28 -0400] markxnelson: Hi Chefs, This is probably a stupid question - but here goes anyway.  So I have a recipe that installs some stuff, like a JDK on a node.  I put that in a role, and when I add that role to a node, it installs it perfectly.  Now, what if I want to remove it?  If I just take away the role from that node, it does not actually go and undo what it did.  How do I do this?  Do I need to write another recipe to 'remove' things?  Thanks
[2013-05-21 04:37:37 -0400] bluekelp: markxnelson: not a stupid question. i ran into this annoyance today.  unfortunately other than a "reverse recipe" there doesn't yet seem to be a way to garbage-collect a recipe's cruft when it's removed.
[2013-05-21 04:37:53 -0400] bluekelp: at least that i'm aware of yet.  still noodling this one myself
[2013-05-21 04:39:11 -0400] bluekelp: seems chef is aimed at getting stuff on a node (once, the first time) and less about ongoing ops tasks unless it's tweaking cfg files.  at least in my experience so far
[2013-05-21 04:41:31 -0400] markxnelson: hm ok thanks!
[2013-05-21 04:44:26 -0400] sprack: any recommendations on a vagrant box that's closest to an amazon linux setup?
[2013-05-21 04:58:44 -0400] pcn: ohai chefs
[2013-05-21 04:58:56 -0400] pcn: has anyone used the chef-mailman cookbook w/ chef 11?
[2013-05-21 04:59:47 -0400] pcn: It has an LWRP defined, but that is resulting in a chef-solo rin that says that the corresponding resource isn't defined
[2013-05-21 05:03:30 -0400] gkra: my google-fu is weak how do I add a role to a node from within a recipe?
[2013-05-21 05:04:39 -0400] pcn: gkra: do you mean for a subsequent run?
[2013-05-21 05:04:52 -0400] gkra: sure
[2013-05-21 05:05:51 -0400] gkra: pcn: worst case I can include_recipe for anything I need to run immediately, but then I want to add the role to manage it for subsequent runs.
[2013-05-21 05:07:23 -0400] pcn: There's some momentum in the community to avoid roles, and to manage collections of cookbooks from within "role cookbooks" so that they're versioned and a bit more composable.  have you considered doing something like that?
[2013-05-21 05:09:49 -0400] gkra: pcn: yeah, we're working in that direction, but roles are still useful...
[2013-05-21 05:10:26 -0400] gkra: we have maybe two roles where we're defining run_lists, depending on system function
[2013-05-21 05:12:40 -0400] gkra: we've got a very wide app stack, and currently we're using one role per app, which makes it simpler to come up with some configs where one thing needs to connect to all of another, so we can synthesize those configs via searches for nodes with those roles.
[2013-05-21 05:13:16 -0400] gkra: the other problem, though, is trying to figure out how to add the correct recipes for a node based on what that node is supposed to be
[2013-05-21 05:13:20 -0400] pcn: gkra: so you sould be able to modify the run_list and run node.save! IIRC
[2013-05-21 05:13:44 -0400] gkra: but i just realized we're naming the nodes per function, so I could key the run_list additions off the node name...
[2013-05-21 05:13:46 -0400] pcn: However that won't have an effect on the run that's already underway IIRC
[2013-05-21 05:14:05 -0400] gkra: hmm.
[2013-05-21 05:16:05 -0400] gkra: well, we've got a "base" role that we bootstrap all the nodes with, and I've created an "app" role (generically speaking) for our software platform In that "app" role, I'm specifying a rather limited app-specific runlist (app-base, app-component)
[2013-05-21 05:16:18 -0400] gkra: So, everything that's common to all our platform nodes goes in the app-base cookbook, and app-specifici thingsn would go in the app-component cookbook, both of which are effectively policy/role cookbooks
[2013-05-21 05:16:51 -0400] gkra: I suppose, then, I could use the app-component cookbook to programmatically determine which additional cookbooks need to be pulled in, and forget runlists alltogether.
[2013-05-21 05:17:50 -0400] pcn: That seems like it could be hard to observe what/why happened after a run?
[2013-05-21 05:18:05 -0400] gkra: then, for now, all the roles we've defined per component would just be applied as metadata, and remain functionally empty...
[2013-05-21 05:18:36 -0400] gkra: hmm.
[2013-05-21 05:18:41 -0400] gkra: I have some more thinking to do.
[2013-05-21 05:19:14 -0400] pcn: The biggest problem with roles is that the lack of versioning can make them blow up at bad times
[2013-05-21 05:19:27 -0400] coderanger: gkra: Self-mutating run lists is dicey at best
[2013-05-21 05:19:43 -0400] pcn: However, if you can accept how they work, you can use them.  When you get down to it, though, a cookbook can do what a role can for the most part, with versioning
[2013-05-21 05:19:45 -0400] coderanger: Mostly because it doesn't handle ordering or nested roles very well
[2013-05-21 05:19:48 -0400] gkra: yeah...
[2013-05-21 05:20:04 -0400] coderanger: Roles vs. role-ish cookbooks is mostly orthogonal
[2013-05-21 05:20:10 -0400] gkra: well, we've also been looking at having the roles define the run-lists, and the environment locking the cookbook versions...
[2013-05-21 05:20:54 -0400] coderanger: thats just a question of if your environment churn is high enough that you want more fine grained control on cookbook promotion
[2013-05-21 05:21:27 -0400] gkra: well, we're moving towards a continous integration environment, and we've got multiple environments on the march to production
[2013-05-21 05:21:43 -0400] coderanger: How many devs do you have?
[2013-05-21 05:21:53 -0400] coderanger: where "dev" is anyone touching chef code
[2013-05-21 05:22:03 -0400] gkra: working against chef, about 3-5 of us.
[2013-05-21 05:22:09 -0400] gkra: that number will remain small.
[2013-05-21 05:22:12 -0400] coderanger: Normal roles/envs are fine
[2013-05-21 05:22:37 -0400] coderanger: When you get up to the 20-30+ range, you start needing more complex stuff, but you can ignore that :)
[2013-05-21 05:22:48 -0400] gkra: I tend to like to overcomplicate things.  :)
[2013-05-21 05:25:13 -0400] coderanger: Hence my reiterance that you can sit this one out and not miss much ;-)
[2013-05-21 05:25:20 -0400] gkra: haha
[2013-05-21 05:26:01 -0400] gkra: current design is each node has a role attached for each platform component of ours it hosts
[2013-05-21 05:26:27 -0400] gkra: normally 1 role per node on top of base and platform-base (platform-<component>)
[2013-05-21 05:26:44 -0400] gkra: and if we need to add a cookbook for that role, we have the ability
[2013-05-21 05:26:47 -0400] coderanger: Thats pretty standard
[2013-05-21 05:27:01 -0400] coderanger: you'll often also see one role per data center and one role per rack
[2013-05-21 05:27:24 -0400] coderanger: (though if you are cloudy, 'rack' has no meaning any more and 'data center' == AZ)
[2013-05-21 05:27:47 -0400] gkra: yeah, we're limiting it to role per DC, as it's all vmware
[2013-05-21 05:28:04 -0400] gkra: so, DC role, "base" role, "platform-base" role, and then a "platform-component" role
[2013-05-21 05:28:23 -0400] gkra: that should keep the insanity down to a reasonable level
[2013-05-21 05:29:10 -0400] gkra: what we are doing is that wherever possible we're using a role or wrapper cookbook for any otherh cookbook we use, in order to enforce versioning and policy.
[2013-05-21 05:29:40 -0400] gkra: that should let us control behavior in case someone upgrades an important cookbook we rely on :)
[2013-05-21 05:32:43 -0400] coderanger: gkra: Upgrades should be impossible, pin all versions exactly in environment policy
[2013-05-21 05:38:26 -0400] gkra: coderanger: that's the plan. additionally, our role/policy cookbooks are depending on the exact version of the community cookbooks we're employing.
[2013-05-21 05:39:44 -0400] jtimberman: gkra: +1 for precise versions :)
[2013-05-21 06:47:24 -0400] LarsN: I suspect I'm doing something dumb, but after installing chef server 11.0.8 and connecting to the web ui, I'm not seeing an organizations page to get my organization-validator,pem or knife.rb
[2013-05-21 06:47:35 -0400] LarsN: any suggestions on how I can stop doing it wrong?
[2013-05-21 06:48:49 -0400] coderanger: LarsN: Open source doesn't have orgs
[2013-05-21 06:49:09 -0400] coderanger: Your server validator key should have been written to /etc/chef
[2013-05-21 06:49:17 -0400] LarsN: ok, that makes some sense.
[2013-05-21 06:49:20 -0400] coderanger: (generated automatically on first startup)
[2013-05-21 06:49:31 -0400] LarsN: I'll take a look, and appreciate it.
[2013-05-21 07:02:00 -0400] flaccid: hmm i'm using the application resource with passenger_apache2 sub resource which has an option, params which is a hash of params for the template
[2013-05-21 07:02:19 -0400] flaccid: so i give it something like { "document_root" => "#{node['rails_app']['path']}/current/public" }
[2013-05-21 07:02:34 -0400] flaccid: but how do i reference document_root in the template?
[2013-05-21 07:03:00 -0400] flaccid: i tried <%= @document_root %> and <%= @params['document_root'] %> but both come back blank
[2013-05-21 07:05:39 -0400] coderanger: flaccid: Looks like they go nowhere
[2013-05-21 07:05:53 -0400] coderanger: flaccid: I think someone was confused about the usage of the web_app def
[2013-05-21 07:06:02 -0400] coderanger: https://github.com/opscode-cookbooks/application_ruby/blob/master/providers/passenger_apache2.rb#L52
[2013-05-21 07:06:20 -0400] coderanger: but params[:extra] doesn't appear in https://github.com/opscode-cookbooks/apache2/blob/master/definitions/web_app.rb
[2013-05-21 07:06:41 -0400] coderanger: Ahh no, but params is passed in
[2013-05-21 07:06:45 -0400] coderanger: thats confusing
[2013-05-21 07:06:56 -0400] coderanger: so @params[:extra][:document_root]
[2013-05-21 07:07:41 -0400] coderanger: flaccid: As you can see, that is already populated for you as @params[:docroot] too
[2013-05-21 07:08:26 -0400] flaccid: oh sweet as, like the application_php i use @params[:docroot]
[2013-05-21 07:08:38 -0400] flaccid: so extra ones under extra, cheers coderanger!
[2013-05-21 07:09:26 -0400] flaccid: hehe, i think its working with apache2/passenger but i have to retest unicorn after this
[2013-05-21 07:11:36 -0400] flaccid: coderanger: a few more updates, but gives you an idea of what i'm doing https://github.com/flaccid/cookbooks/blob/master/cookbooks/rails_app/recipes/application.rb
[2013-05-21 07:12:42 -0400] flaccid: hmm <%= @params[:docroot] appears to come out blank
[2013-05-21 07:15:07 -0400] flaccid: maybe it didn't rewrite the template
[2013-05-21 07:24:22 -0400] dyu: is this the correct channel to ask questions questions about chef?
[2013-05-21 07:26:21 -0400] n1ko: yep
[2013-05-21 07:26:48 -0400] dyu: awesome
[2013-05-21 07:27:04 -0400] dyu: is it possible for a machine to be a client for two chef servers?
[2013-05-21 07:27:18 -0400] dyu: if it's possible, is it easy and practical?
[2013-05-21 07:30:20 -0400] flaccid: dyu: whats the use case?
[2013-05-21 07:31:25 -0400] dyu: i'm building out a second server right now and i'd like to keep my first server where i can play around and not worry about breaking stuff too much
[2013-05-21 07:31:38 -0400] dyu: first server == where i studied chef
[2013-05-21 07:31:50 -0400] dyu: 2nd server == the one we'll use for production
[2013-05-21 07:33:04 -0400] flaccid: wouldn't you juse have nodes use the desired server?
[2013-05-21 07:33:57 -0400] dyu: so the nodes become clients?
[2013-05-21 07:34:35 -0400] flaccid: i'm having a problem where deploy_revision is trying to touch a file from the checkout but it can't because the folder doesn't exist and for some reason there is no folders in the releases folder, http://dpaste.org/rYyUX/ coderanger :(
[2013-05-21 07:36:23 -0400] flaccid: dyu: nodes are chef clients yes
[2013-05-21 07:37:03 -0400] dyu: yup
[2013-05-21 07:37:11 -0400] dyu: sorry. i'm bad at explaining
[2013-05-21 07:37:14 -0400] dyu: let me explain some more
[2013-05-21 07:37:16 -0400] dyu: hehe
[2013-05-21 07:37:26 -0400] flaccid: hmm i appear to be hitting http://tickets.opscode.com/browse/COOK-2079
[2013-05-21 07:37:59 -0400] flaccid: but that doesn't explain why there is nothing in current :(
[2013-05-21 07:39:53 -0400] dyu: we don't want our staging and production servers to be able to use knife directly since all devs have access to them. we just want some people(mostly leads and infra guys) to be able to do that so we use their assigned machines instead as the chef clients
[2013-05-21 07:40:16 -0400] dyu: can we just go back to the original question
[2013-05-21 07:40:31 -0400] dyu: is it possible for a node to become a client for two chef servers?
[2013-05-21 07:49:10 -0400] s2r2: chef-client needs a client.rb -- you can tell it which one to use, so you could have one for staging and one for production, each including the pointers to the respective keys...
[2013-05-21 07:50:12 -0400] dyu: thanks s2r2! :-)
[2013-05-21 08:01:00 -0400] flaccid: dyu: i'm not sure i think its a great idea but per s2r2 yes it is possible in theory
[2013-05-21 08:02:15 -0400] flaccid: anyone wouldn't happen to have any ideas about my crazy issue? http://dpaste.org/rYyUX/
[2013-05-21 08:09:27 -0400] s2r2: flaccid: /usr/local/rails_app/current/tmp/ <= does that path exist
[2013-05-21 08:12:21 -0400] flaccid_: s2r2: negative
[2013-05-21 08:12:48 -0400] flaccid_: i don't think gets to the stage where it might create it
[2013-05-21 08:13:54 -0400] flaccid_: maybe its a bug in the application cookbook
[2013-05-21 08:14:21 -0400] flaccid_: i'm trying to work out how this worked before also
[2013-05-21 08:24:19 -0400] flaccid_: this is driving me insane :(
[2013-05-21 08:45:05 -0400] flaccid_: ok so this crazy issue does not happen with unicorn, wtf!
[2013-05-21 10:09:50 -0400] nd___: I'm trying to run an execute provider to install nodejs dependencies via npm (in vagrant so far). For this command I have a user and a group to execute this, but npm complains (rightly so) that it cannot write to /root/.npm. Is there a way to see the actual line chef executes? I cannot seem to find that even in the -l debug output
[2013-05-21 10:19:46 -0400] nd___: Doing it by hand like `sudo su -c "npm install" -l myuser` does work though
[2013-05-21 11:11:23 -0400] TotalEvil: hi2all
[2013-05-21 11:24:13 -0400] ahmed_: hi
[2013-05-21 11:24:29 -0400] ahmed_: 172.16.16.29 Starting Chef Client, version 11.4.4 172.16.16.29  172.16.16.29 resolving cookbooks for run list: ["", "apache2"] 172.16.16.29  172.16.16.29  172.16.16.29  172.16.16.29 ================================================================================ 172.16.16.29  172.16.16.29 Error Resolving Cookbooks for Run List: 172.16.16.29  172.16.16.29 ================================================================================ 172
[2013-05-21 11:24:40 -0400] ahmed_: [2013-05-21T11:20:45+00:00] ERROR: Running exception handlers 172.16.16.29 [2013-05-21T11:20:45+00:00] FATAL: Saving node information to /var/chef/cache/failed-run-data.json 172.16.16.29 [2013-05-21T11:20:45+00:00] ERROR: Exception handlers complete 172.16.16.29 Chef Client failed. 0 resources updated 172.16.16.29  172.16.16.29 [2013-05-21T11:20:45+00:00] FATAL: Stacktrace dumped to /var/chef/cache/chef-stacktrace.out 172.16.16.29 [2013-
[2013-05-21 11:24:47 -0400] ahmed_: what's  problem
[2013-05-21 11:24:47 -0400] ahmed_: ?
[2013-05-21 11:40:39 -0400] binamov: ahmed can i see your run list?
[2013-05-21 11:41:03 -0400] laurent\: he's gone, but i'd also say the run_list is wrong
[2013-05-21 11:41:20 -0400] binamov: too funny
[2013-05-21 11:44:25 -0400] binamov: puhrge
[2013-05-21 12:13:47 -0400] adamjk-dev: anyone use minitest and chef with chef client?
[2013-05-21 12:14:02 -0400] adamjk-dev: I am having issues with minitest finding my test cases  and loading them (no tests are being found)
[2013-05-21 12:21:09 -0400] spoof: hi all - I have a chef question and was wondering if anybody would be so kind as to assist
[2013-05-21 12:25:58 -0400] binamov: spoof ?
[2013-05-21 12:29:12 -0400] stormerider: no need to ask if you can ask, just ask ;)
[2013-05-21 12:37:18 -0400] stormerider: hm. for a chef handler like irc snitch, would you chef_gem[] that or gem[] that?
[2013-05-21 12:39:34 -0400] BryanWB: ohai chefs!
[2013-05-21 12:40:25 -0400] stormerider: ohai BryanWB
[2013-05-21 12:40:53 -0400] adamjk-dev: does anyone know how to have testkitchen recognize vagrant?
[2013-05-21 12:41:14 -0400] jwitrick: adamjk-dev: can you elaborate a little more ?
[2013-05-21 12:41:25 -0400] adamjk-dev: http://pastebin.com/meskshua
[2013-05-21 12:42:22 -0400] BryanWB: stormerider: supsup
[2013-05-21 12:42:53 -0400] stormerider: not much, im futzing with trying to get irc snitch set up
[2013-05-21 12:42:55 -0400] adamjk-dev: am I missing a vagrant plugin? kitchen-vagrant or something
[2013-05-21 12:43:08 -0400] jwitrick: what version of Vagrant is installed? do you have the vagrant-berkshelf plugin intalled ? and do you have the vagrant  driver 'kitchen-vagrant'
[2013-05-21 12:43:35 -0400] jwitrick: this file was written a little while ago for requirements: https://github.com/opscode-cookbooks/chef-client/blob/master/TESTING.md
[2013-05-21 12:44:01 -0400] adamjk-dev: vagrant version 1.2.2, and I have vagrant-berkshelf (1.2.0) and vagrant-butcher (1.0.1) installed
[2013-05-21 12:44:19 -0400] adamjk-dev: jwitrick: thanks, those requirements are what I was looking for
[2013-05-21 12:44:27 -0400] jwitrick: np
[2013-05-21 12:45:25 -0400] adamjk-dev: jwitrick: have you ever used minitest with chef client? I was having issues with minitest finding my tests
[2013-05-21 12:45:41 -0400] adamjk-dev: jwitrick: the test files were not being downloaded as needed from the chef server it seems
[2013-05-21 12:46:11 -0400] jwitrick: So I have laid my repo out like the yum cookbook: https://github.com/opscode-cookbooks/yum
[2013-05-21 12:46:31 -0400] jwitrick: with all my tests under files/default/tests/minitest
[2013-05-21 12:46:51 -0400] jwitrick: and then in my runlist i just add: recipe[minitest-handler]
[2013-05-21 12:47:09 -0400] Cope: jwitrick: check your version - newer versions keep tests in the TEST directory not TESTS
[2013-05-21 12:47:26 -0400] Cope: erm adamjk-dev even
[2013-05-21 12:47:48 -0400] jwitrick: Cope: thanks. I will double check that.
[2013-05-21 12:48:05 -0400] adamjk-dev: Cope: check my version of what?
[2013-05-21 12:48:17 -0400] Cope: minitest-handler
[2013-05-21 12:48:33 -0400] BryanWB: adamjk-dev: minitest-handler looks in the old path as well, i made it backward compatible
[2013-05-21 12:48:35 -0400] adamjk-dev: Cope: ll ~/source_control/private-cookbooks/rundeck_test/files/default/tests/minitest/
[2013-05-21 12:48:46 -0400] Cope: "Version 0.1.8 deprecated use of files/default/tests/minitest/*_test.rb and the location of support files. Test files should now be located in files/default/test/*_test.rb"
[2013-05-21 12:49:00 -0400] adamjk-dev: BryanWB: is it usable with chef client instead of just chef solo?
[2013-05-21 12:49:17 -0400] BryanWB: adamjk-dev: it should work w/ chef-client, ppl have told me it does
[2013-05-21 12:49:21 -0400] adamjk-dev: BryanWB: for instance, when you berks install, all of the tests are on the local machine, but templates and tests are not loaded until needed with chef client
[2013-05-21 12:49:38 -0400] adamjk-dev: BryanWB: can I send you a pastebin with a chef run log and my vagrantfile etc?
[2013-05-21 12:49:53 -0400] BryanWB: adamjk-dev: i would like to try but now is not good for me :(
[2013-05-21 12:50:17 -0400] adamjk-dev: BryanWB: understandable :), I just thought I was doing this all correctly and it is driving me crazy
[2013-05-21 12:50:22 -0400] BryanWB: adamjk-dev: if u log a bug report i will try to take a look today
[2013-05-21 12:50:42 -0400] adamjk-dev: BryanWB: arg, I hate logging bug reports if it isnt truly a bug, I could still be doing something wrong, just didn't think I was
[2013-05-21 12:51:02 -0400] jwitrick: adamjk-dev: can you send that pastebin ?
[2013-05-21 12:51:09 -0400] BryanWB: adamjk-dev: i appreciate those even if they don't turne out to be a problem
[2013-05-21 12:51:09 -0400] Cope: adamjk-dev: I'm happy to help - and try to reproduce your issue
[2013-05-21 12:51:16 -0400] siezer: moin
[2013-05-21 12:51:25 -0400] adamjk-dev: look at this! alright I will get a pastebin in a second
[2013-05-21 12:53:14 -0400] adamjk-dev: http://pastebin.com/jpUBr3A5
[2013-05-21 12:53:25 -0400] adamjk-dev: jwitrick: Cope:  http://pastebin.com/jpUBr3A5
[2013-05-21 12:53:56 -0400] Cope: thanks adamjk-dev
[2013-05-21 12:53:58 -0400] Cope: looking
[2013-05-21 12:54:01 -0400] jwitrick: what version of TK are you trying to use ?
[2013-05-21 12:54:16 -0400] adamjk-dev: Cope: awesome, let me know if you need more info
[2013-05-21 12:54:42 -0400] adamjk-dev: jwitrick: test kitchen? I am not for this, I was trying to just get minitest working at first, now I am looking at test kitchen on the side as well
[2013-05-21 12:54:57 -0400] jwitrick: sorry. nm. my confusion.
[2013-05-21 12:55:34 -0400] Cope: adamjk-dev: ok - so, where are your tests?
[2013-05-21 12:55:40 -0400] jwitrick: are you using Berkshelf ?
[2013-05-21 12:55:52 -0400] adamjk-dev: jwitrick: nope, chef client for this run
[2013-05-21 12:55:58 -0400] Cope: ah ok: ~/source_control/private-cookbooks/rundeck_test/files/default/tests/minitest/
[2013-05-21 12:56:07 -0400] adamjk-dev: Cope: I have two cookbooks, rundeck and rundeck_test
[2013-05-21 12:56:43 -0400] Cope: adamjk-dev: so minitest-handler should glob and find all tests under the files/default/test directory of each cookbook on the runlist
[2013-05-21 12:57:00 -0400] Cope: but it looks like you have your tests in the TESTS directory not the TEST directory
[2013-05-21 12:57:03 -0400] adamjk-dev: Cope: correct, but they aren't on the local machine at all times due to chef client right?
[2013-05-21 12:57:30 -0400] adamjk-dev: Cope: BryanWB mentioned it should work with both, but I can move to */test/ directory and try it if you would like
[2013-05-21 12:58:15 -0400] Cope: adamjk-dev: yeah, do try that.  I saw what looks like exactly the same problem on Friday, so if I can replicate it here, I think we can be confident it's a bug.
[2013-05-21 12:58:37 -0400] adamjk-dev: Cope: I will give it a go right now, I will let you know in a few minutes
[2013-05-21 12:58:46 -0400] Cope: also, be sure you're actually pushing the latest cookbook to teh server
[2013-05-21 12:58:58 -0400] adamjk-dev: Cope: will do
[2013-05-21 12:59:21 -0400] Cope: I think Berkshelf has an open ticket about berks upload not actually updating;
[2013-05-21 12:59:40 -0400] Cope: so you could find yourself thinking you're updating the cookbook, but not
[2013-05-21 13:00:12 -0400] adamjk-dev: Cope: I am just doing a knife cookbook upload for the time being
[2013-05-21 13:00:33 -0400] Cope: okay cool - that removes one variable
[2013-05-21 13:00:40 -0400] adamjk-dev: Cope: yep, hehe
[2013-05-21 13:07:06 -0400] spoof: Question : Is there a better method to get nodes up and running without the need to copy the server validation.pem file to the host? That seems odd that we would want to copy this private key all over the place and sometimes may even forget to delete it when we are done. I also do not entirely understand the destinction between the client and the node. I am forced to have both, yet only node seems to be of any use.
[2013-05-21 13:07:23 -0400] adamjk-dev: Cope: still no love .... http://pastebin.com/LYmFjZai
[2013-05-21 13:07:33 -0400] Cope: alas
[2013-05-21 13:07:55 -0400] jwitrick: spoof:  client is the authentication mechanism for communication between the node and chef-server
[2013-05-21 13:08:18 -0400] jwitrick: spoof: another way to do it is: knife bootstrap <ip> sudo -x root -P<pwd>
[2013-05-21 13:08:27 -0400] Cope: spoof: you can run the chef-client remove validation key recipe, to get rid of the validation key;
[2013-05-21 13:09:26 -0400] Cope: adamjk-dev: ok let me try something similar
[2013-05-21 13:09:51 -0400] jwitrick: spoof: while node is just the object representation of the server stored on the chef-server.
[2013-05-21 13:09:52 -0400] adamjk-dev: Cope: okay cool, or let me know if you need any more information .... not EVERYTHING shows up in the pastebin
[2013-05-21 13:09:59 -0400] spoof: thanks guys! (Cope + jwitrick) - I'll try the bootstrap method - seems simple enough
[2013-05-21 13:10:31 -0400] Cope: spoof: bootstrap simply renders the validation pem over ssh / winrm via a template
[2013-05-21 13:11:20 -0400] Cope: spoof: it's the same mechanism.  You could create the client key yourself, and ship that - the purpose of teh validation pem is to allow a node that is a member of an organization to be granted a client key to sign API calls
[2013-05-21 13:11:54 -0400] Cope: spoof: but if you ensure you have the recipe I mentioned on your run list, the validation key (which is only needed once) will be deleted.
[2013-05-21 13:13:22 -0400] spoof: thanks Cope
[2013-05-21 13:13:58 -0400] spoof: I don't entirely understand this though "You could create the client key yourself, and ship that - the purpose of teh validation pem is to allow a node that is a member of an organization to be granted a client key to sign API calls"
[2013-05-21 13:14:17 -0400] spoof: If security/trust is not an issue - could i use the same client key for all my clients?
[2013-05-21 13:14:52 -0400] Cope: spoof: every API request needs to be signed
[2013-05-21 13:15:08 -0400] Cope: spoof: for this you need a client key
[2013-05-21 13:15:26 -0400] Cope: you can't reuse client keys for each api client
[2013-05-21 13:15:32 -0400] Cope: you need one key per api client
[2013-05-21 13:15:45 -0400] spoof: We're trying very hard to make things as simple as we possibly can and we are more than willing to sacrifice security. Our environment operates on high trust between users and our network is secured from the outside world
[2013-05-21 13:16:00 -0400] Cope: right, there's nothing complex here
[2013-05-21 13:16:19 -0400] Cope: the validation key is a special key that allows api clients that don't yet have a key to get one
[2013-05-21 13:16:31 -0400] Cope: that's it's purpose
[2013-05-21 13:16:38 -0400] Cope: once it's done that, you can get rid of it
[2013-05-21 13:17:13 -0400] spoof: is there a way to get rid of the need for keys entirely?
[2013-05-21 13:17:27 -0400] spoof: as in - we're in an isolated network
[2013-05-21 13:17:37 -0400] Cope: spoof: use chef-solo?
[2013-05-21 13:17:48 -0400] spoof: everything that tries to run against the chef server is secure by default
[2013-05-21 13:18:46 -0400] spoof: I was hoping to configure my clients to run chef-client every few minutes - will i be able to do this with chef solo?
[2013-05-21 13:18:53 -0400] Cope: spoof: I'm not sure if you can remove the use of keys in open source chef - I've never tried.  I mean - of course it's possible in theory. But whether it's realistically achievable or not, I am not sure.
[2013-05-21 13:18:59 -0400] Cope: I'd suspect not.
[2013-05-21 13:19:06 -0400] Cope: spoof: chef-solo isn't chef-client
[2013-05-21 13:19:09 -0400] Cope: it doesn't use a server at all
[2013-05-21 13:19:21 -0400] Cope: it has a subset of chef's cababilities
[2013-05-21 13:19:31 -0400] Cope: it just runs locally on each node
[2013-05-21 13:19:53 -0400] Cope: so sure, you could run chef-solo as a scheduled job
[2013-05-21 13:20:01 -0400] spoof: yeah - I think i need chef-server because i need a central store for my content. Otherwise I would need to install and run git periodically on all the clients, to get updates
[2013-05-21 13:20:16 -0400] Cope: I prefer using "real" chef
[2013-05-21 13:20:30 -0400] Cope: but chef-solo is super useful in lots of cases
[2013-05-21 13:20:43 -0400] spoof: damn, the learning curve is quite steep...
[2013-05-21 13:20:45 -0400] stormerider: if you werent using solo, then your clients would get their updates from the server, not from git
[2013-05-21 13:20:55 -0400] Cope: spoof: realistically the key stuff is very very simple
[2013-05-21 13:21:01 -0400] stormerider: *nod*
[2013-05-21 13:21:18 -0400] spoof: okay thanks - I'm obviously trying to rush things.
[2013-05-21 13:21:30 -0400] spoof: let me just do this the right way..
[2013-05-21 13:21:33 -0400] Cope: spoof: you practically don't need to know anything about it - just run bootstrap, and inlcude that recipe I mentioned on your run list, and you're done
[2013-05-21 13:21:56 -0400] stormerider: if security isnt an issue, then just put the keyfile on an internal webserver and have the bootstrap procedure download it before running chef, or use knife bootstrap
[2013-05-21 13:22:07 -0400] stormerider: the validator keyfile, i should say
[2013-05-21 13:22:12 -0400] Cope: spoof: this one: https://github.com/opscode-cookbooks/chef-client/blob/master/recipes/delete_validation.rb
[2013-05-21 13:25:40 -0400] spoof: Jeez, thanks guys. Much appreciated! You guys have been very helpful!
[2013-05-21 13:25:46 -0400] stormerider: i ended up stopping using that; it gave me too many problems recreating AMIs because i forgot to shut down chef and it ran while i was about to rebuild the AMI, or I forgot to put the validator back in place before rebuilding it. if you're going for simple and security is not a concern, just ignore the validator once it's deployed
[2013-05-21 13:26:06 -0400] Cope: stormerider: good point
[2013-05-21 13:26:06 -0400] spoof: Ill defininately become a regular in this channel :)
[2013-05-21 13:26:13 -0400] Cope: spoof: you're very welcome :)
[2013-05-21 13:26:14 -0400] stormerider: spoof: the mailing list is also very helpful, too, i recommend subscribing to that as well
[2013-05-21 13:26:18 -0400] Cope: +1
[2013-05-21 13:27:04 -0400] spoof: the ones at lists.opscode.com ?
[2013-05-21 13:27:10 -0400] Cope: adamjk-dev: going to test with a cookbook that I know should work
[2013-05-21 13:27:19 -0400] stormerider: you can have more than one validator key, fyi, so if you decide down the road that you want to replace it you don't have to do it all at once.
[2013-05-21 13:27:29 -0400] adamjk-dev: Cope: great, I am still at a loss on this one hehe
[2013-05-21 13:27:38 -0400] adamjk-dev: Cope: are you using chef client etc.?
[2013-05-21 13:27:39 -0400] stormerider: spoof: i believe so, yes.
[2013-05-21 13:27:53 -0400] spoof: great
[2013-05-21 13:27:58 -0400] spoof: cheers guys :)
[2013-05-21 13:28:07 -0400] Cope: adamjk-dev: yep; so srsly - I was running an advanced training course on Friday - we saw exactly the same issue
[2013-05-21 13:28:15 -0400] UForgotten: good morning all.  I'm having a problem getting an LWRP notify service reload delayed to work. It doesn't fire properly.   When done outside of the lwrp it works fine.
[2013-05-21 13:28:29 -0400] stormerider: spoof: anytime :)
[2013-05-21 13:28:36 -0400] UForgotten: found this bug http://tickets.opscode.com/browse/CHEF-2404 which appears to be relevant, but the workaround doesn't work for me.
[2013-05-21 13:28:45 -0400] stormerider: (i have to say, i love how helpful the chef community is. :))
[2013-05-21 13:29:11 -0400] adamjk-dev: Cope: oh, I see.... yeah it would be great if you found the same issue I guess lol
[2013-05-21 13:29:49 -0400] Cope: adamjk-dev: right - so plan: 1) try with a cookbook that I know runs tests normally; 2) Try with a brand new one -> if both fail in the same way, raise bug
[2013-05-21 13:30:31 -0400] adamjk-dev: Cope: awesome, I appreciate it.... I will be here
[2013-05-21 13:45:09 -0400] stormerider: hm. question. I've got a small toolkit script that allows me to "kick" chef-client via knife ssh "role:*" ... "sudo chef-client". i then filter for the "Chef Client finished" / "Chef Client failed" and summarize it at the end. but something i'm seeing is that on a successful run it's usually saying something like "Chef Client finished, 5 resources updated" even when i dont think anything has really changed.
[2013-05-21 13:45:11 -0400] stormerider: what should i be looking for to see what it thinks it's updating?
[2013-05-21 13:46:11 -0400] stormerider: i know i had an issue with an outdated user cookbook that had the timestamp in the template for the ssh authorized_keys so it was constantly regenerating that every run, but i fixed that. i just grepped the chef run for update, but it didn't give me a clear idea of what it is flagging as having been updated.
[2013-05-21 13:46:32 -0400] stormerider: ideally i dont want to look over every line of the chef output to get this info :)
[2013-05-21 13:48:56 -0400] gchristensen: stormerider: I usually run sudo chef-client -F min -W to show roughly what is going to change. it gives a summary at the end.
[2013-05-21 13:50:04 -0400] stormerider: oooo.
[2013-05-21 13:50:07 -0400] stormerider: ty!
[2013-05-21 13:50:16 -0400] stormerider: that's exactly what i was looking for.
[2013-05-21 13:50:26 -0400] gchristensen: sure thing!
[2013-05-21 13:51:10 -0400] stormerider: specifically, looks like my nagios_nrpecheck LWRPs are triggering it, along with my set-env-java-home
[2013-05-21 13:51:47 -0400] stormerider: now to see if that's a false flag or something that needs to be tweaked so it isnt actually rewriting the same content over and over again
[2013-05-21 13:51:53 -0400] gchristensen: yeah. nagios' nrpecheck is bad about that... I keep eaning to fix it, but my days are packed :(
[2013-05-21 13:52:42 -0400] stormerider: hm. wonder if there's an open bug on that.
[2013-05-21 13:53:41 -0400] UForgotten: any thoughts on a different workaround for this bug with LWRP restart notifies? http://tickets.opscode.com/browse/CHEF-2404
[2013-05-21 13:55:46 -0400] adamjk-dev: does test kitchen only work with Chef solo?
[2013-05-21 14:01:05 -0400] Cope: adamjk-dev: yes, at present
[2013-05-21 14:01:07 -0400] stormerider: no existing bug for that, gchristensen, so i opened COOK-3021. ill look and see if i can find another cookbook doing something along similar lines and see if i can send another PR in. im just getting set up with nagios so im going to be poking around a bit in that cookbook :)
[2013-05-21 14:01:30 -0400] gchristensen: excellent :) I would appreciate that work a whole lot :P it makes my report handlers noisy.
[2013-05-21 14:01:45 -0400] adamjk-dev: Cope: Ah, yeah that appears so.... so no testing cookbooks that use search hehe. This is why I was trying to get minitest working alone without Test Kitchen and using chef client
[2013-05-21 14:02:41 -0400] stormerider: if you know of something that acts like it that works correctly, that might help me zero in on the solution. my first thought is to look and see what cookbook_file does, but that's probably going to be a bit dense to read, heh
[2013-05-21 14:06:04 -0400] Cope: adamjk-dev: you can mock out search
[2013-05-21 14:06:25 -0400] adamjk-dev: Cope: ?
[2013-05-21 14:06:27 -0400] Cope: see: https://github.com/fnichol/searchef
[2013-05-21 14:06:55 -0400] adamjk-dev: Cope: interesting
[2013-05-21 14:12:08 -0400] adamjk-dev: so can you still specify forwarded ports and bridged interfaces etc. when moving to Test Kitchen?
[2013-05-21 14:12:18 -0400] adamjk-dev: or do people just usually keep a Vagrantfile and a .kitchen.yml?
[2013-05-21 14:12:42 -0400] adamjk-dev: meaning, is the Kitchen YAML as expressive as the Vagrantfile
[2013-05-21 14:15:41 -0400] adamjk-dev: i guess it looks to be so
[2013-05-21 14:15:46 -0400] adamjk-dev: https://github.com/opscode-cookbooks/jenkins/blob/master/.kitchen.yml
[2013-05-21 14:25:59 -0400] jwitrick: adamjk-dev: so one thing to note about moving to TK. It can only spin up on server in an instance at a time. So if you are expecting it to spin up 3 servers(of different types) at hte same type and talk to each other it will not work.
[2013-05-21 14:26:53 -0400] adamjk-dev: jwitrick: right, you mean it is serialized
[2013-05-21 14:27:04 -0400] jwitrick: correct.
[2013-05-21 14:27:08 -0400] adamjk-dev: jwitrick: I am just investigating the whole testing world here... for cookbooks
[2013-05-21 14:27:27 -0400] adamjk-dev: jwitrick: and we have some cookbooks that need chef client (use search, data bags etc.)
[2013-05-21 14:27:40 -0400] adamjk-dev: so I was trying to get plain vanilla chef-minitest working with chef client at first
[2013-05-21 14:27:43 -0400] adamjk-dev: then looking at TK
[2013-05-21 14:27:56 -0400] adamjk-dev: but chef-minitest is giving me troubles
[2013-05-21 14:27:58 -0400] jwitrick: so I know with standard Vagrant file you can spin up x number of servers that each have there own run_list and act as a cluster.
[2013-05-21 14:28:05 -0400] jwitrick: check out chef-solo-search
[2013-05-21 14:28:34 -0400] jwitrick: chef-solo-search allowed me to mock out roles, node searches during a TK run
[2013-05-21 14:29:31 -0400] adamjk-dev: i see, I have run across that before, but can it handle node attribute search?
[2013-05-21 14:31:28 -0400] jwitrick: dynamically you can not. but you can create a .json file with the name of the node you want your cookbook to search for. and put all the revelent information in that .json file.
[2013-05-21 14:31:43 -0400] jwitrick: The Readme for chef-solo-search has a good example
[2013-05-21 14:34:43 -0400] adamjk-dev: I see, all interesting stuff.... thanks
[2013-05-21 14:37:50 -0400] adamjk-dev: i just need to get this chef-minitest stuff working with chef-client and I can evaluate from there
[2013-05-21 14:47:29 -0400] Cope: adamjk-dev: trying with the java cookbook, which has minittest tests
[2013-05-21 14:48:32 -0400] Kzim: Hi
[2013-05-21 14:48:45 -0400] adamjk-dev: Cope: okay great, chef solo, test kitchen, or chef client or what are you running?
[2013-05-21 14:48:46 -0400] Kzim: is there a probleme with Provider on cookbook with underscore ?
[2013-05-21 14:49:12 -0400] gleam: not that i'm aware of
[2013-05-21 14:49:15 -0400] Kzim: looks like  it is not possible to name a cookbook _nginx  ?
[2013-05-21 14:49:27 -0400] gleam: wait, with a leading underscore?
[2013-05-21 14:49:37 -0400] Kzim: so i tried lib_nginx with a vhost provider and it still doesn't work
[2013-05-21 14:49:42 -0400] Kzim: yes with a leading
[2013-05-21 14:49:47 -0400] Kzim: then without :)
[2013-05-21 14:50:25 -0400] adamjk-dev: is there a difference to how Chef 10 server vs. Chef 11 server stores files for a cookbook? I have the same cookbook uploaded to a Chef 10 and Chef 11 server, and under "files" the full path to the file is displayed on the Chef 11 server, but not the Chef 10 server
[2013-05-21 14:52:19 -0400] Cope: adamjk-dev: initial test - chef-solo + vagrant via berkshelf
[2013-05-21 14:53:04 -0400] Kzim: okay lib_nginx_vhost works, but not _nginx_vhost but i think it's not a big issue :)
[2013-05-21 14:54:05 -0400] adamjk-dev: Cope: ah gotcha, I have a feeling chef solo might work fine.... because then "every" cookbook file is local to the system (and likely gets copied over)
[2013-05-21 14:54:37 -0400] adamjk-dev: Cope: but, chef client does not copy "every" cookbook file (until it is needed maybe, like templates/ and files/?)
[2013-05-21 14:54:55 -0400] adamjk-dev: Cope: so, on my cookbook cache on the VM being provisioned, I do not see the test files for rundeck_test cookbooks
[2013-05-21 14:57:20 -0400] Cope: adamjk-dev: looking at the code
[2013-05-21 14:58:14 -0400] adamjk-dev: Cope: mind sending me a link?
[2013-05-21 14:59:41 -0400] Cope: https://github.com/btm/minitest-handler-cookbook/blob/master/recipes/default.rb
[2013-05-21 14:59:49 -0400] Cope: mahoosive ruby block
[2013-05-21 15:01:17 -0400] adamjk-dev: Cope: right, I have looked briefly at that code.....
[2013-05-21 15:01:47 -0400] adamjk-dev: Cope: so it will look at the cookbooks it has locally... to see if <blah>/tests/*_test.rb exists.
[2013-05-21 15:02:06 -0400] adamjk-dev: Cope: but, what if chef-client when it downloads a cookbook from the server, does not bring the files/*_test.rb files with it?
[2013-05-21 15:04:52 -0400] Cope: adamjk-dev: I don't see why that wold ever happen.
[2013-05-21 15:05:01 -0400] adamjk-dev: Cope: http://pastebin.com/46M6MvvR
[2013-05-21 15:05:22 -0400] adamjk-dev: Cope: on the cookbook file store on the VM being provisioned, I don't see the test files or anything
[2013-05-21 15:05:23 -0400] Cope: adamjk-dev: afaik chef-client synchronises the whole cookbook, and doesn't omit part of it
[2013-05-21 15:05:43 -0400] cassianoleal: adamjk-dev: have you checked the chefignore file?
[2013-05-21 15:05:53 -0400] adamjk-dev: Cope: yeah, I figured that was how it worked, but someone in here mentioned that templates and maybe other files aren't loaded until needed (on-demand)
[2013-05-21 15:05:55 -0400] cassianoleal: it might be filtering out your tests before uploading the cookbook to the server
[2013-05-21 15:06:19 -0400] adamjk-dev: cassianoleal: i dont have a chefignore file in my directory
[2013-05-21 15:06:27 -0400] cassianoleal: adamjk-dev: then no :)
[2013-05-21 15:06:33 -0400] adamjk-dev: adamjk-dev: my server shows them under files/
[2013-05-21 15:06:34 -0400] Cope: adamjk-dev: right, tests ran and passed
[2013-05-21 15:06:42 -0400] Cope: adamjk-dev: will now try with chef-client
[2013-05-21 15:06:49 -0400] adamjk-dev: Cope: awesome, thanks
[2013-05-21 15:07:01 -0400] adamjk-dev: cassianoleal: my chef server web ui shows them under files/  (my 3 tests)
[2013-05-21 15:07:25 -0400] adamjk-dev: cassianoleal: however, on Chef 10 server, they don't show the full path in the name (but on Chef 11 server, they do)
[2013-05-21 15:08:00 -0400] adamjk-dev: somehow, the tests are not being copied to the VM being provisioned
[2013-05-21 15:08:12 -0400] cassianoleal: adamjk-dev: strange no idea, sorry :/
[2013-05-21 15:08:34 -0400] adamjk-dev: cassianoleal: yeah, me neither hahah... I appreciate the help
[2013-05-21 15:08:51 -0400] adamjk-dev: I am like 99.9% positive this will work I guess if the test files were copied down
[2013-05-21 15:08:53 -0400] Cope: adamjk-dev: ok - running chef now on machine; chef-client, chef 11
[2013-05-21 15:09:01 -0400] adamjk-dev: (which is guaranteed to be the case when running chef solo)
[2013-05-21 15:10:24 -0400] cr1stobal: Hello, has anyone seen 'package "mod_ssl" do...' fail while executing on cmd line directly through yum fails?
[2013-05-21 15:10:41 -0400] cr1stobal: i'm getting this for all rpms httpd httpd-tools etc.
[2013-05-21 15:10:55 -0400] Cope: adamjk-dev: ok - so tests didn't get picked up
[2013-05-21 15:11:04 -0400] adamjk-dev: Cope: BAM!
[2013-05-21 15:11:12 -0400] adamjk-dev: Cope: you rock!
[2013-05-21 15:11:29 -0400] adamjk-dev: Cope: I knew I wasn't crazy.... hahaha
[2013-05-21 15:12:26 -0400] cr1stobal: Ugh... English is bad...
[2013-05-21 15:12:39 -0400] adamjk-dev: so what does this mean then? as design... a problem with chef-minitest cookbook?
[2013-05-21 15:13:22 -0400] cr1stobal: Has anyone seen 'package "mod_ssl" do...' fail in a chef-client run... but then if yum install mod_ssl is run directly from command line it works?
[2013-05-21 15:14:12 -0400] cr1stobal: i'm running the apache cookbook... and can repeat this... all package calls fail but if i execute the same yum install from command line directly they work
[2013-05-21 15:14:40 -0400] cr1stobal: nearly certain there is something weird on on the machine configuration... but not sure where to look
[2013-05-21 15:16:08 -0400] BryanWB: i kind of like definitions, are they really bad?
[2013-05-21 15:16:51 -0400] cassianoleal: BryanWB: haven't they been "replaced" by LWRPs?
[2013-05-21 15:17:18 -0400] BryanWB: cassianoleal: u can still use definitions, i don't know if they have been officially deprescated
[2013-05-21 15:17:45 -0400] jkeiser: I like definitions a lot
[2013-05-21 15:18:01 -0400] cassianoleal: BryanWB: yeah, I know I have one definition in a cookbook, but it always issues me a warning :)
[2013-05-21 15:18:02 -0400] UForgotten: I had this discussion with jtimberman yesterday, defintions are still in 11.x
[2013-05-21 15:18:05 -0400] Cope: they're not deprecated; but there are advantages to LWRPs.  Definitions are cool too though.
[2013-05-21 15:18:13 -0400] UForgotten: and I'm having a hell of a time getting a LWRP to work.
[2013-05-21 15:18:19 -0400] jkeiser: I want lwrps that you don't have to spread across 2 files
[2013-05-21 15:18:23 -0400] cassianoleal: I like their simplicyty compared to lwrps
[2013-05-21 15:18:26 -0400] UForgotten: it runs but the notifies don't properly fire.
[2013-05-21 15:18:27 -0400] jtimberman: Definitions aren't going anywhere anytime soon.
[2013-05-21 15:18:42 -0400] BryanWB: jkeiser: why don't u go to bestbuy and code it up? :)
[2013-05-21 15:18:52 -0400] jtimberman: There have been discussions about changing their behavior/functionality to be like actual resoruces, but nothing more than discussions.
[2013-05-21 15:20:34 -0400] Cope: adamjk-dev: so, because chef-client loads on demand, you're right - those tests won't appear.
[2013-05-21 15:21:14 -0400] adamjk-dev: Cope: I see, so the answer is taht it is working by design... and chef solo is the only way to go?
[2013-05-21 15:21:35 -0400] adamjk-dev: Cope: we have to use chef solo to test with minitest alone, or with Test Kitchen?
[2013-05-21 15:22:02 -0400] jkeiser: Yeah, I think definitions could be extended to do what lwrps do
[2013-05-21 15:22:18 -0400] BryanWB: adamjk-dev: u shouldn't have to, given time i could try to fix that
[2013-05-21 15:22:34 -0400] BryanWB: iirc i got reports that it worked
[2013-05-21 15:22:41 -0400] jtimberman: jkeiser: that's kind of the direction we've talked about in the past :)
[2013-05-21 15:22:47 -0400] adamjk-dev: BryanWB: I see, yeah to me it shouldn't be restrictive.... but I understand everyone is busy
[2013-05-21 15:23:05 -0400] adamjk-dev: BryanWB: do we open an issue or something for this?
[2013-05-21 15:23:22 -0400] Cope: adamjk-dev: on it
[2013-05-21 15:23:23 -0400] UForgotten: does it make sense to rewrite my LWRP into a definition to get around this notify bug?  hmm.
[2013-05-21 15:23:25 -0400] BryanWB: adamjk-dev: y, log an issue at github.com/btm/minitest-handler-cookbook
[2013-05-21 15:23:41 -0400] adamjk-dev: Cope: once again, you rock
[2013-05-21 15:23:48 -0400] adamjk-dev: BryanWB: looks like Cope is on it perhaps
[2013-05-21 15:24:10 -0400] adamjk-dev: I must admit I really do appreciate the community, people in here are awesome
[2013-05-21 15:24:13 -0400] Cope: adamjk-dev: TBH I am not sure I am keen on the whole way minitest-handler works
[2013-05-21 15:24:27 -0400] BryanWB: Cope: heh, it's pretty hacky
[2013-05-21 15:24:34 -0400] Cope: adamjk-dev: I am increasingly of the view that post-convergence tests outside the chef converge is the way to go.
[2013-05-21 15:24:39 -0400] BryanWB: not sure i am either
[2013-05-21 15:24:44 -0400] Cope: adamjk-dev: for which test kitchen is the right way
[2013-05-21 15:24:50 -0400] adamjk-dev: Cope: ?
[2013-05-21 15:24:59 -0400] adamjk-dev: Cope: minitest runs after convergence right
[2013-05-21 15:25:05 -0400] jtimberman: adamjk-dev: test-kitchen can run integration tests after convergence.
[2013-05-21 15:25:16 -0400] jtimberman: adamjk-dev: in the '1.0' version, it does this with a "busser"
[2013-05-21 15:25:22 -0400] adamjk-dev: jtimberman: I have noticed that, but once again chef solo only :(
[2013-05-21 15:25:27 -0400] jtimberman: if you want to run an example, grab the zsh cookbook source from github and do a kitchen test
[2013-05-21 15:25:34 -0400] siezer: HALP IM TRAPPED ON AN ENTERPRISE
[2013-05-21 15:25:54 -0400] adamjk-dev: jtimberman: yeah, my ultimate plan was to follow opscode usage for testing (using TK), but I was trying to quickly demonstrate using minitest for a chef-client run
[2013-05-21 15:25:58 -0400] Cope: adamjk-dev: minitest-handler runs tests within the context of a chef run; so yes, post-convergence, but still within the chef run
[2013-05-21 15:26:03 -0400] adamjk-dev: jtimberman: but as of right now, I can't test using chef client
[2013-05-21 15:26:11 -0400] adamjk-dev: Cope: I see your point
[2013-05-21 15:26:14 -0400] jtimberman: nope.
[2013-05-21 15:26:25 -0400] jtimberman: I kind of think that "testing" with chef-client is the wrong direction.
[2013-05-21 15:26:31 -0400] jtimberman: at least in the test kitchen sense.
[2013-05-21 15:26:41 -0400] adamjk-dev: perhaps.... just needed a means to an end
[2013-05-21 15:26:50 -0400] Cope: adamjk-dev: what do you actually want to test?
[2013-05-21 15:26:54 -0400] jtimberman: the kinds of tests that rely on multi-node interactions and a chef server and all that seem to fit better in an actual non-production environment.
[2013-05-21 15:26:54 -0400] adamjk-dev: without rewriting some private cookbooks to remove search and such
[2013-05-21 15:27:13 -0400] adamjk-dev: Cope: literally i just wanted to check that some services were running, config files were in place, who knows....
[2013-05-21 15:27:16 -0400] BryanWB: i think testing w/ chef-client could be quite useful and plan to do it
[2013-05-21 15:27:24 -0400] adamjk-dev: we have lacked on cookbook testing in the past, and I wanted to push us in the right direction
[2013-05-21 15:27:35 -0400] BryanWB: esp. when u use chef-server and push jobs to tie a clustered app together
[2013-05-21 15:27:35 -0400] adamjk-dev: jtimberman: that could be true
[2013-05-21 15:27:40 -0400] Cope: adamjk-dev: so - I have some pretty firm opinions on this
[2013-05-21 15:27:48 -0400] adamjk-dev: BryanWB: I still agree
[2013-05-21 15:27:52 -0400] adamjk-dev: I hate restrictions....
[2013-05-21 15:28:10 -0400] adamjk-dev: I think with 2 giant modes of chef running,  should be able to test with either
[2013-05-21 15:28:31 -0400] BryanWB: adamjk-dev: +1
[2013-05-21 15:28:40 -0400] Cope: the real issue is that people are still thinking at a node level
[2013-05-21 15:28:54 -0400] Cope: that's just not the right way to run integration tests
[2013-05-21 15:29:06 -0400] adamjk-dev: and this all could be.... perhaps I am evil for writing a rundeck cookbook that uses search to find a master to sync a slave up to....
[2013-05-21 15:29:12 -0400] Cope: running post-converge tests via test kitchen is super useful
[2013-05-21 15:29:15 -0400] adamjk-dev: but, that is how chef works
[2013-05-21 15:29:27 -0400] adamjk-dev: yeah....
[2013-05-21 15:29:28 -0400] Cope: adamjk-dev: kinda
[2013-05-21 15:29:33 -0400] adamjk-dev: I see everyones points
[2013-05-21 15:29:34 -0400] adamjk-dev: all valid
[2013-05-21 15:29:41 -0400] adamjk-dev: i mean.... unit testing vs. integration testing
[2013-05-21 15:29:45 -0400] Cope: I still favour external testing of the infrastructure you actually built
[2013-05-21 15:30:03 -0400] adamjk-dev: how do you mean?
[2013-05-21 15:30:04 -0400] Cope: "Nobody plays nginx or centos"
[2013-05-21 15:30:10 -0400] adamjk-dev: outside of these test suites?
[2013-05-21 15:30:34 -0400] adamjk-dev: I just want to know when someone checks into a private cookbook, that a few of my assumptions still hold true (before I let people use that new cookbook)
[2013-05-21 15:30:35 -0400] Cope: what I do is built  the infrastructure in a test location, and then run integration tests AGAINST it
[2013-05-21 15:30:43 -0400] Cope: from an external node
[2013-05-21 15:30:52 -0400] adamjk-dev: what are those tests in?
[2013-05-21 15:30:56 -0400] adamjk-dev: I am confused I must admit
[2013-05-21 15:31:15 -0400] Cope: i use cucumber, because I view this as classic BDD - requirements as executable specification
[2013-05-21 15:31:24 -0400] Cope: you could use anything
[2013-05-21 15:31:30 -0400] adamjk-dev: gotcha
[2013-05-21 15:31:40 -0400] Cope: but i think you need all levels
[2013-05-21 15:31:43 -0400] adamjk-dev: well........ I feel I should recap for documentation sake
[2013-05-21 15:32:00 -0400] adamjk-dev: TestKitchen only works with Chef solo, and minitest-chef-handler only works with Chef solo
[2013-05-21 15:32:05 -0400] stormerider: it's official. i love foodcritic :)
[2013-05-21 15:32:15 -0400] adamjk-dev: There is going to be an issue opened against minitest to allow for using Chef-client
[2013-05-21 15:32:25 -0400] adamjk-dev: (is that you Cope?)
[2013-05-21 15:33:22 -0400] Cope: https://github.com/btm/minitest-handler-cookbook/issues/42
[2013-05-21 15:34:28 -0400] adamjk-dev: Cope: I see, so it was already opened?
[2013-05-21 15:34:49 -0400] Cope: adamjk-dev: for an example; I've been setting up a jenkins machine to run food-critic and chefspec tests on all cookbooks on commit.
[2013-05-21 15:35:19 -0400] Cope: adamjk-dev: what I *actualy* care about is that I can see jobs, create jobs, run jobs.
[2013-05-21 15:35:23 -0400] adamjk-dev: Cope: yep! I currently run 'knife cookbook test', foodcritic, and tailor (against library code) on all commits of a cookbook
[2013-05-21 15:35:35 -0400] adamjk-dev: Cope: I need to incorporate chef-spec or something (for unit testing)
[2013-05-21 15:36:00 -0400] adamjk-dev: Cope: I had planned to use minitest (as integration testing) to cover the unit tests (by checking that services were running, files existed and matched, etc.)
[2013-05-21 15:36:52 -0400] Cope: adamjk-dev: java could be installed, jenkins running, but if I forgot to open the firewall, and didn't test that, or something changes subtly to make a problem, tests on the node won't help me as much as an external test that I can see jenkins and use it
[2013-05-21 15:37:10 -0400] Cope: note: this is not an either or - it's a both and
[2013-05-21 15:37:37 -0400] adamjk-dev: Cope: correct..... yeah we plan to use "smoketests" or deployment to development/stage environments to run larger tests
[2013-05-21 15:37:57 -0400] adamjk-dev: Cope: I just wanted some simple quick sanity checks on the cookbook itself (and planned to use minitest/chefspec for this)
[2013-05-21 15:37:58 -0400] Cope: classic case - I was working with 2 clients last week, both of whom have proxy servers and firewalls that make git pulls  problem
[2013-05-21 15:38:24 -0400] Cope: the point of chef is to build infrastructre that runs a business
[2013-05-21 15:38:37 -0400] Cope: the requirements are that it allows us to solve a given problem
[2013-05-21 15:38:46 -0400] Cope: testing that apache runs doesn't prove that the requirements are met
[2013-05-21 15:39:03 -0400] Cope: you need a test which actualy exercises the infrastructure
[2013-05-21 15:39:11 -0400] adamjk-dev: Cope: sure, I guess I was most interested in unit tests on the cookbooks themselves with these tests
[2013-05-21 15:39:14 -0400] Cope: because then you can be confident that the requirements are met
[2013-05-21 15:39:19 -0400] Cope: adamjk-dev: right totally
[2013-05-21 15:39:29 -0400] adamjk-dev: adamjk-dev: correct, and we will eventually have automated tests built around our products
[2013-05-21 15:39:42 -0400] Cope: adamjk-dev: in which case, what's wrong with running with chef-solo? that proves the logic of the test
[2013-05-21 15:39:46 -0400] Cope: and gives immediate value
[2013-05-21 15:39:52 -0400] Cope: fast, reliable feedback
[2013-05-21 15:40:04 -0400] adamjk-dev: Cope: nothing is wrong with that I guess, just requires more work (for me to undo chef-client behavior from existing cookbooks)
[2013-05-21 15:40:21 -0400] Cope: adamjk-dev: right
[2013-05-21 15:40:29 -0400] adamjk-dev: Cope: I was trying to follow the path of least resistance... and was hoping just running chef-client would function the same as chef solo
[2013-05-21 15:40:50 -0400] adamjk-dev: Cope: because, I am assuming that chefspec might have the same restriction right?
[2013-05-21 15:42:24 -0400] Cope: adamjk-dev: chefspec doesn't even converge the node
[2013-05-21 15:42:47 -0400] Cope: adamjk-dev: chefspec basically tests that the providers were handed the right stuff
[2013-05-21 15:43:02 -0400] adamjk-dev: Cope: right... like saying that some package "will" be installed....
[2013-05-21 15:43:11 -0400] Cope: adamjk-dev: very fast, and great for cases where you have a lot of different cases, platforms, attributes etc
[2013-05-21 15:43:12 -0400] adamjk-dev: Cope: or some attribute is set accordingly
[2013-05-21 15:43:30 -0400] adamjk-dev: Cope: right, I remember reading up on it... and I chose to try minitest because I wanted post-convergence testing
[2013-05-21 15:43:36 -0400] Cope: adamjk-dev: right
[2013-05-21 15:43:56 -0400] adamjk-dev: Cope: so chefspec would work with chef client or chef solo then I guess since it doesn't have to converge
[2013-05-21 15:44:27 -0400] Cope: adamjk-dev: yeah - it's kinda like saying: does my microwave work well with diesel fuel?
[2013-05-21 15:45:11 -0400] Cope: adamjk-dev: chef-client / chef-solo is a non-issue to chefspec - they are orthoganol concepts
[2013-05-21 15:46:30 -0400] adamjk-dev: Cope: awesome, I appreciate it... I may try my hand at chef spec then
[2013-05-21 15:46:48 -0400] adamjk-dev: Cope: I greatly appreciate your help today.
[2013-05-21 15:47:08 -0400] Cope: adamjk-dev: always a pleasure
[2013-05-21 15:48:05 -0400] adamjk-dev: Cope: indeed, nice to see someone dive right in and reproduce the problem
[2013-05-21 15:53:24 -0400] zaargy: is it possible to freeze previously uploaded cookbooks?
[2013-05-21 16:01:45 -0400] UForgotten: wow
[2013-05-21 16:02:34 -0400] UForgotten: I have the same problem both when using an lwrp and a definition to do a set of tasks with a delayed service restart.  When I had them in a standalone recipe, the delayed restart notify worked fine.
[2013-05-21 16:04:27 -0400] dmerrick_: hey masterchefs, i'm getting an SSL_connect error when i try to run chef-client
[2013-05-21 16:04:44 -0400] dmerrick_: "Error Syncing Cookbooks:" ... "Errno::ECONNRESET: Connection reset by peer - SSL_connect"
[2013-05-21 16:05:11 -0400] UForgotten: dmerrick_: firewall/network/routing issue?
[2013-05-21 16:05:32 -0400] dmerrick_: that was my first thought, but it seems to work. i can connect to the API via curl
[2013-05-21 16:06:22 -0400] dmerrick_: (tested via curl -I)
[2013-05-21 16:06:28 -0400] stormerider: dmerrick_: what chef version?
[2013-05-21 16:06:45 -0400] stormerider: istr running into that with 11.4.0 and 11.4.2 or 11.4.4 fixed it
[2013-05-21 16:06:59 -0400] dmerrick_: ohh interesting
[2013-05-21 16:07:02 -0400] dmerrick_: im on 11.4.0
[2013-05-21 16:07:15 -0400] stormerider: *nod* try upgrading.
[2013-05-21 16:07:58 -0400] dmerrick_: doing so...
[2013-05-21 16:08:18 -0400] stormerider: istr there was something in one of the release notes about fixing an ssl bug, but i dont rememeber the ticket offhand.
[2013-05-21 16:12:14 -0400] dmerrick_: stormerider: interesting, same issue on 11.4.4
[2013-05-21 16:12:28 -0400] dmerrick_: maybe i should update my chef-server too?
[2013-05-21 16:19:14 -0400] dmerrick_: is there any reason why i should be concerned about upgrading from chef-server 11.0.6 to 11.4.4
[2013-05-21 16:19:57 -0400] gchristensen: dmerrick_: have you read the upgrading documentation?
[2013-05-21 16:20:08 -0400] dmerrick_: im looking into it now
[2013-05-21 16:23:40 -0400] dmerrick_: having trouble finding docs about upgrades from 11.x to 11.y
[2013-05-21 16:24:17 -0400] dmerrick_: found this... http://adigitalnotepad.com/post/upgrade-chef-server-11-0-4-to-11-0-6
[2013-05-21 16:27:18 -0400] troyready: I'm not a RHEL expert, but I think that person's mistake was not doing a yum upgrade
[2013-05-21 16:27:34 -0400] troyready: 'cause it should be update in place
[2013-05-21 16:28:32 -0400] dmerrick_: yeah. my chef-server is running ubuntu anyway. is it any trickier than "apt-get upgrade chef-server"?
[2013-05-21 16:28:39 -0400] dmerrick_: with backups before, obs
[2013-05-21 16:29:18 -0400] gleam: install the new deb and run chef-server-ctl reconfigure, although i think it might run it as part of hte postinst
[2013-05-21 16:31:02 -0400] troyready: that's my understanding too
[2013-05-21 16:35:43 -0400] jtran: anyone seen this chefspec problem before? :   http://pastebin.com/2qghyaZR
[2013-05-21 16:37:28 -0400] bean__: jtran: i'd assume some attribute isn't getting set, or something like that
[2013-05-21 16:38:32 -0400] jtran: bean__:  right.  i'm not sure how to get around it so i tried stubbing the include_recipe and that didn't end well either.
[2013-05-21 16:44:55 -0400] stormerider: dmerrick_: huh, then it's a different one than i ran into.
[2013-05-21 16:45:11 -0400] stormerider: dmerrick_: server is 11.0.8, the client is the one that goes up to 11.4.4
[2013-05-21 16:45:21 -0400] stormerider: they're no longer in lock-step
[2013-05-21 16:46:11 -0400] dmerrick_: yeah i just figured that out
[2013-05-21 16:46:21 -0400] dmerrick_: i bumped the server to 11.0.8
[2013-05-21 16:46:24 -0400] dmerrick_: didnt fix it
[2013-05-21 16:46:31 -0400] dmerrick_: now im weeping softly
[2013-05-21 16:50:49 -0400] stormerider: very odd. id dig into the logs on the server and see if anything pops out at you.
[2013-05-21 16:54:00 -0400] stormerider: hm. i just installed rvm so that i could get foodcritic up and running on my mac, and now it seems to have broken knife.
[2013-05-21 16:54:19 -0400] stormerider: but im using the omnibus osx 11.4.4 package, so im confused...
[2013-05-21 16:54:59 -0400] stormerider: oh, i bet the environment variables are overriding things.
[2013-05-21 16:57:03 -0400] jtimberman: stormerider: rvm adds a number of functions, including 'gem', which get used instead of the existing commands.
[2013-05-21 16:57:40 -0400] stormerider: yeah, it's the environment variables. if you do a "rvm system" it clears them out and everything is fine for knife.
[2013-05-21 16:58:50 -0400] stormerider: since i need rvm for foodcritic on osx (at least, without doing a lot of hackery), im just going to create a knife shell script that will run higher in the $PATH and do rvm system and then call the real knife.
[2013-05-21 17:01:17 -0400] failshell: hey. with vagrant in chef-solo mode, is there a way to do a node.save? its complaining about a missing /etc/chef/client.pem
[2013-05-21 17:18:18 -0400] failshell: hey. with vagrant in chef-solo mode, is there a way to do a node.save? its complaining about a missing /etc/chef/client.pem
[2013-05-21 17:19:45 -0400] teukka: failshell: no, it tries to make a REST call to the chef server. where would you think it should save the node data? vagrant generates it based on Vagrantfile
[2013-05-21 17:20:38 -0400] failshell: so what's the best way to handle that then? add conditions in the recipe to not save if chef-solo?
[2013-05-21 17:22:05 -0400] teukka: why do you need to call the save method? normal node attributes are automatically saved in chef-client runs
[2013-05-21 17:22:25 -0400] failshell: because i set custom attributes during the run
[2013-05-21 17:22:43 -0400] failshell: node.set[:foo][:configured] = true
[2013-05-21 17:22:44 -0400] failshell: node.save
[2013-05-21 17:23:01 -0400] failshell: so i can check if part of the software is installed, and avoid running that part everytime chef runs
[2013-05-21 17:23:32 -0400] teukka: failshell: yeah, but it should be atomatically saved to chef-server. no need to call node.save
[2013-05-21 17:23:52 -0400] failshell: the doc says otherwise
[2013-05-21 17:26:24 -0400] teukka: link?
[2013-05-21 17:27:02 -0400] failshell: teukka: hmm i recall seeing that somewhere. but im wrong, no need to call node.save
[2013-05-21 17:27:04 -0400] failshell: live and learn
[2013-05-21 17:27:12 -0400] failshell: thanks for setting me on the right path :)
[2013-05-21 17:28:09 -0400] failshell: would be a nice test to add to foodcritic
[2013-05-21 17:28:35 -0400] teukka: failshell: np. I never called node.save and all have worked just fine. I still think it requires that the chef run completes successfully
[2013-05-21 17:29:11 -0400] josephholsten: has anyone got the opscode's nagios::client playing nice with test-kitchen? it's exploding in the search for me
[2013-05-21 17:29:34 -0400] josephholsten: timsmith: ^^
[2013-05-21 17:29:47 -0400] timsmith: nope
[2013-05-21 17:29:48 -0400] timsmith: sorry
[2013-05-21 17:29:59 -0400] timsmith: waiting for test kitchen 1.0 docs before I jump in
[2013-05-21 17:30:14 -0400] teukka: failshell: as a side note, I thought about hacking node.save to knife-solo and/or chef-solo-search. there it could be useful. but with Vagrant not so much imho
[2013-05-21 17:30:29 -0400] failshell: people still use Nagios?
[2013-05-21 17:30:34 -0400] failshell: wow
[2013-05-21 17:30:46 -0400] josephholsten: well I just need it to work on chef-solo. I'm thinking if I assign the monitoring role to the server under test, it should default to localhost
[2013-05-21 17:31:06 -0400] failshell: sensu ftw
[2013-05-21 17:37:23 -0400] timsmith: monitoring hipsters
[2013-05-21 17:37:48 -0400] gchristensen: nagios ftw
[2013-05-21 17:38:12 -0400] gchristensen: I don't like my monitoring to have secrets, and there are no secrets left in nagios for me anymore
[2013-05-21 17:41:50 -0400] stormerider: hm. if a chef handler fails, where would that info be stored? or are the handlers silent?
[2013-05-21 17:47:12 -0400] log1kal: stormerider: failed handler stuff still gets logged to /var/chef/cache/failed-run-data.json and /var/chef/cache/chef-stracktrace.out
[2013-05-21 17:47:31 -0400] gchristensen: test-kitchen seems to be skipping food-critic, but I don't remember it doing that previously. any time I google these things its taking me to america's test kitchen. any advice on making htese two work together? :P
[2013-05-21 17:47:54 -0400] log1kal: gchristensen: I always have to add opscode or opschef to my searches :(
[2013-05-21 17:48:02 -0400] log1kal: google's finally learning, though
[2013-05-21 17:48:17 -0400] log1kal: one of the benefits of tracking everything I do, I guess
[2013-05-21 17:48:39 -0400] stormerider: log1kal: hm, the only thing i see in the chef-stacktrace.out is the error im generating to test the handler.
[2013-05-21 17:49:34 -0400] log1kal: hrmm, I don't have anything I can check with at the moment. Sorry :(
[2013-05-21 17:50:19 -0400] stormerider: the json is pretty daunting, any idea what i might be able to look under to filter it with something like jq?
[2013-05-21 17:50:29 -0400] mconigliaro: log1kal: stop working. you're supposed to be on vacation. haha
[2013-05-21 17:51:15 -0400] log1kal: mconigliaro: I'm starting to get anxious to get back to work
[2013-05-21 17:51:18 -0400] log1kal: this is good for you, mconigliaro
[2013-05-21 17:51:28 -0400] mconigliaro: haha, that;s good
[2013-05-21 17:51:31 -0400] mconigliaro: that's
[2013-05-21 17:52:57 -0400] gchristensen: is there documentation on detecting if search is available, and falling back to attributes if it is not?
[2013-05-21 17:53:17 -0400] stormerider: you can check if you're using solo
[2013-05-21 17:53:23 -0400] stormerider: that's in foodcritic
[2013-05-21 17:53:56 -0400] stormerider: "if Chef::Config[:solo]"
[2013-05-21 17:54:20 -0400] gchristensen: awesome. thank you
[2013-05-21 17:54:25 -0400] stormerider: np!
[2013-05-21 17:54:54 -0400] ggolin: hi all.
[2013-05-21 17:55:13 -0400] xmltok: where has the chef-client service gone in the chef 11.x deb packages? i can't /etc/init.d/chef-client nor service chef-client
[2013-05-21 17:55:37 -0400] ggolin: has anyone used test-kitchen with chef-solo-search? wondering if there is a conventional way of specifying data_bag_path. looks like it defaults to /var/cheg/data_bags
[2013-05-21 17:55:57 -0400] stormerider: xmltok: /etc/init/opscode-runsvdir.conf
[2013-05-21 17:56:07 -0400] stormerider: oh, sorry, that's the server
[2013-05-21 17:56:45 -0400] stormerider: i dont think the omnibus installs the init script by default, but the chef-client cookbook will do so if asked
[2013-05-21 17:56:55 -0400] ggolin: im currently contemplating creation of said directory in the test cookbook
[2013-05-21 17:57:41 -0400] xmltok: ah ok, i will use the chef-client cookbook to configure it as a daemon
[2013-05-21 17:59:44 -0400] stormerider: that surprised me, too, but the cookbook manages it fine so wasnt a big deal.
[2013-05-21 18:05:47 -0400] xmltok: stormerider: do you use https://github.com/cookbooks/chef-client? just curious because it hasn't been updated in a while
[2013-05-21 18:06:15 -0400] josephholsten: https://github.com/cookbooks is kinda a wasteland
[2013-05-21 18:06:30 -0400] stormerider: http://community.opscode.com/cookbooks/chef-client
[2013-05-21 18:06:42 -0400] gleam: https://github.com/opscode-cookbooks/chef-client
[2013-05-21 18:06:46 -0400] gleam: ya
[2013-05-21 18:06:49 -0400] stormerider: yeah, it's under opscode-cookbooks now
[2013-05-21 18:06:53 -0400] sprack: has anyone found a good way to abstract some of the common attributes for roles in chef-solo? so that I don't have to keep the json's in sync?
[2013-05-21 18:07:00 -0400] xmltok: cool
[2013-05-21 18:07:04 -0400] sprack: can I do that with databags?
[2013-05-21 18:07:19 -0400] josephholsten: sprack: yes, also roles can have other roles in run lists
[2013-05-21 18:07:36 -0400] stormerider: but the website i linked to, you can also sign up to be notified when a new version of the cookbook is released, which is nice
[2013-05-21 18:07:45 -0400] jameson__: opsworks moving to chef 11 yay!
[2013-05-21 18:07:51 -0400] sprack: josephholsten: awesome, thank you
[2013-05-21 18:08:57 -0400] prometheanfire: linking to libs that are not updated on system updates? wat
[2013-05-21 18:11:01 -0400] juliancdunn: jameson__: link?
[2013-05-21 18:12:30 -0400] jameson__: juliancdunn: https://forums.aws.amazon.com/thread.jspa?threadID=117400&tstart=0
[2013-05-21 18:12:35 -0400] jameson__: 2nd to last post
[2013-05-21 18:12:39 -0400] jameson__: from amazon guy
[2013-05-21 18:13:10 -0400] juliancdunn: jameson__: ah, so no official announcement yet, just "we're working on it"
[2013-05-21 18:13:34 -0400] stormerider: i never did really understand what the advantage was to using the amazon version of chef over running your own chef server was
[2013-05-21 18:13:55 -0400] jameson__: yeah, not official yet, the first time they actually mentioned that the update was happeninng instead of "we are looking into it"
[2013-05-21 18:14:33 -0400] josephholsten: stormerider: a former boss of mine liked to call it "one throat to choke"
[2013-05-21 18:14:43 -0400] stormerider: eh
[2013-05-21 18:14:45 -0400] stormerider: er, heh
[2013-05-21 18:16:40 -0400] prometheanfire: so, how do people keep up to date on security issues in the linked libs?
[2013-05-21 18:16:48 -0400] prometheanfire: rerub the omnibus installer manually?
[2013-05-21 18:16:53 -0400] josephholsten: yep
[2013-05-21 18:16:59 -0400] prometheanfire: wat
[2013-05-21 18:17:17 -0400] prometheanfire: that is backwards...
[2013-05-21 18:17:36 -0400] josephholsten: how do you keep up to date on operating system security updates, run updates? yes.
[2013-05-21 18:17:57 -0400] cassianoleal: any chef out there with experience debugging runit run scripts? :)
[2013-05-21 18:17:59 -0400] prometheanfire: yes, but those updates are centrally managed
[2013-05-21 18:18:07 -0400] cassianoleal: I have a script that runs fine if I ./run as root
[2013-05-21 18:18:17 -0400] cassianoleal: but explodes with sv start <service>
[2013-05-21 18:18:23 -0400] prometheanfire: this is an entire way that's outside that
[2013-05-21 18:18:23 -0400] josephholsten: prometheanfire: you may not enjoy java. or ruby. or pretty much anything other than c derivs
[2013-05-21 18:18:33 -0400] prometheanfire: python seems to package correctly
[2013-05-21 18:18:53 -0400] josephholsten: so long as you never use pip, sure
[2013-05-21 18:19:00 -0400] josephholsten: or virtualenv
[2013-05-21 18:19:17 -0400] jameson__: and you don't mix pip variants with os variants
[2013-05-21 18:19:22 -0400] prometheanfire: packaging python packages is easy
[2013-05-21 18:19:33 -0400] prometheanfire: if you use pip and install to / as root I will shoot you
[2013-05-21 18:20:02 -0400] prometheanfire: no using system dirs for non-system packages (chef does this at least)
[2013-05-21 18:20:23 -0400] josephholsten: prometheanfire: there's a lot of people who are wrong on the internet, why is this particular fight at the top of your list?
[2013-05-21 18:20:45 -0400] prometheanfire: look at puppet they get it right :P http://docs.puppetlabs.com/guides/puppetlabs_package_repositories.html#for-debian-and-ubuntu
[2013-05-21 18:20:45 -0400] stormerider: +1
[2013-05-21 18:20:55 -0400] helllen__: helllo
[2013-05-21 18:21:08 -0400] helllen__: what is sandboxes used for?
[2013-05-21 18:21:08 -0400] stormerider: no thanks, i dont care to look at puppet. ever again if i can help it. *shudder*
[2013-05-21 18:21:14 -0400] prometheanfire: because I tend to package for distros
[2013-05-21 18:21:15 -0400] josephholsten: prometheanfire: puppet is a great tool. linking policy is not the only reason I choose a tool.
[2013-05-21 18:21:45 -0400] prometheanfire: helllen__: sandboxes are fine, as long as they can be updated easilly
[2013-05-21 18:22:07 -0400] josephholsten: prometheanfire: chef used to be packaged in a deb package policy compatible way. it was a nightmare.
[2013-05-21 18:22:11 -0400] prometheanfire: using an outside route simply bugs me, especially if it links against libs that are not auto-updated
[2013-05-21 18:22:37 -0400] josephholsten: helllen: are you talking about an error from a chef 10 server?
[2013-05-21 18:22:58 -0400] siezer: How do I tell chef-client to look in a different place for chef_gem sources?
[2013-05-21 18:23:22 -0400] helllen__: I am speaking about erchef
[2013-05-21 18:23:25 -0400] prometheanfire: anyway, think I'm done with my rant
[2013-05-21 18:23:26 -0400] helllen__: chef11
[2013-05-21 18:23:44 -0400] prometheanfire: ruby packaging bugs the hell out of me :(
[2013-05-21 18:29:01 -0400] josephholsten: prometheanfire: that must be a terrible source of stress in your life. Have you considered trying to build something better?
[2013-05-21 18:29:18 -0400] prometheanfire: nah, I'm happy to complain
[2013-05-21 18:29:20 -0400] prometheanfire: :D
[2013-05-21 18:31:53 -0400] josephholsten: helllen: I thought chef11 didn't use sandboxes, but used bookshelf instead
[2013-05-21 18:37:14 -0400] rracterr: hey guys, can anyone give me the 30 second elivator pitch on what the 'environment' level should be used for as opposed to the role... it feels like i could do my entire deployment without environment and perhaps end up with a cleaner layout
[2013-05-21 18:37:47 -0400] rracterr: my assumption has been environment = build, stage, qa, preprod, prod... etc
[2013-05-21 18:38:26 -0400] bean__: thats what we use it for, rracterr
[2013-05-21 18:38:33 -0400] rracterr: but with any big org you may have 50 products and all share those same 5 environments... so do most people end up with an environment named "myproductA-PreProd"
[2013-05-21 18:40:20 -0400] bean__: rracterr: no, we have prod env: defaults: orgname: product_name:
[2013-05-21 18:40:27 -0400] bmhatfield: Can someone more knowledgeable than me read this and tell me if there's anything else I need to do to make this be a thing: http://tickets.opscode.com/browse/CHEF-4206
[2013-05-21 19:00:43 -0400] failshell: im running this cookbook with chef-solo in vagrant. the cookbook exposes a LWRP. I get the following error: FATAL: NoMethodError: undefined method `who' for Chef::Resource::SudoManage
[2013-05-21 19:00:50 -0400] failshell: the cookbook works with server
[2013-05-21 19:01:03 -0400] failshell: anything different with vagrant/chef-solo that would prevent a LWRP to work?
[2013-05-21 19:02:32 -0400] failshell: https://github.com/failshell/chef-sudo/blob/master/providers/manage.rb
[2013-05-21 19:02:35 -0400] failshell: that's the code
[2013-05-21 19:04:04 -0400] ianco_: is using a lwrp inside a lwrp a no-no?
[2013-05-21 19:05:44 -0400] juliancdunn: ianco_: it should work...
[2013-05-21 19:08:05 -0400] skarufue: hello. is there a way to make my recipies interactive. i.e. i want them to ask for a secret.
[2013-05-21 19:09:53 -0400] adamjk-dev: does anyone know if chefspec can be run against a cookbook which has metadata dependencies on other cookbooks ?
[2013-05-21 19:09:58 -0400] failshell: skarufue: you could use an encrypted data bag for that
[2013-05-21 19:10:06 -0400] adamjk-dev: or can chefspec only be run on self-contained cookbooks?
[2013-05-21 19:10:42 -0400] adamjk-dev: i told chefspec to look for cookbooks in my berkshelf, but it is not finding the cookbook that the specs are contained within (the cookbook under test)
[2013-05-21 19:12:50 -0400] sabooky: Is it not possible to have a defintion attribute default to a value of the node object? ie:    define :test_definition, :first_param => node[:myapp][:first_param] do ....
[2013-05-21 19:20:56 -0400] bluekelp: sabooky: have you looked into attribute precedence? there are defaults and overrides
[2013-05-21 19:23:46 -0400] cjerdonek: what's the proper way to call data_bag_item within a module definition?
[2013-05-21 19:24:15 -0400] sprack: i have the apt recipe in my role runlist. how can I leave that in the runlist but bypass it based on platform_family rules? make a wrapper recipe my best bet?
[2013-05-21 19:25:36 -0400] troyready: sprack, Yeah, I think that's probably easiest
[2013-05-21 19:26:15 -0400] sprack: troyready: thanks. just making sure that wasn't a more elegant trick
[2013-05-21 19:28:29 -0400] skarufue: failshell: no i cannot since all nodes can decrypt all data nodes
[2013-05-21 19:28:42 -0400] thrillERboy: Hey guys, I'm going to launch my first rails product soon, Its kinda crazy, i've never done any of this before, Should I do it the hard way, like do everything manually and integrate chef later? Or am I better off starting with chef?
[2013-05-21 19:29:11 -0400] skarufue: failshell: err databags
[2013-05-21 19:29:30 -0400] stormerider: if you're not horribly pressed for time, start with chef and build up.
[2013-05-21 19:30:03 -0400] stormerider: if time is too pressing, you can go back and redo it later, but then you're incurring technical debt.
[2013-05-21 19:30:09 -0400] failshell: skarufue: you can use differnt keys for different data bags
[2013-05-21 19:30:19 -0400] sabooky: bluekelp: I get the following error: undefined local variable or method `node' for #<Chef::ResourceDefinitionList:0x000000055618c8 @defines={}>
[2013-05-21 19:30:22 -0400] failshell: we use special ones for different data bags
[2013-05-21 19:30:26 -0400] thrillERboy: stormerider: thanks. I'm not in a hurry :)
[2013-05-21 19:30:33 -0400] sabooky: when I try to use a node object as default value for a definition parameter
[2013-05-21 19:31:09 -0400] skarufue: failshell: yes an i am currently looking for a way to distribute those keys. ie ask for them interactiveley
[2013-05-21 19:32:33 -0400] thrillERboy: Could you guys suggest any easy to follow resources to learn chef?
[2013-05-21 19:32:46 -0400] thrillERboy: preferebly videos :/
[2013-05-21 19:33:02 -0400] stormerider: http://docs.opscode.com/
[2013-05-21 19:33:32 -0400] stormerider: also https://learnchef.opscode.com/quickstart/workstation-setup/
[2013-05-21 19:33:33 -0400] teukka: thrillERboy: check the first hit on google with "learn chef" =)
[2013-05-21 19:34:18 -0400] thrillERboy: stormerider: thanks. docs intimidate me most of the times though :|
[2013-05-21 19:34:28 -0400] thrillERboy: teukka: Thanks, running to google now :)
[2013-05-21 19:34:30 -0400] stormerider: go with the second link then :)
[2013-05-21 19:34:46 -0400] ughani: hey guys..is there a puppetrun like command in chef that i can use with knife?
[2013-05-21 19:34:56 -0400] jtimberman: thrillERboy: learnchef.com
[2013-05-21 19:35:01 -0400] gchristensen: ughani: what does puppetrun do?
[2013-05-21 19:35:18 -0400] ughani: http://linux.die.net/man/8/puppetrun
[2013-05-21 19:35:31 -0400] ughani: basically run all the recipes defined to a node
[2013-05-21 19:35:41 -0400] gchristensen: and is chef-client not what you want?
[2013-05-21 19:35:42 -0400] stormerider: knife ssh
[2013-05-21 19:35:52 -0400] jtimberman: knife ssh '*:*' 'sudo chef-client'
[2013-05-21 19:35:53 -0400] ughani: without loggin into the box
[2013-05-21 19:35:57 -0400] gchristensen: ^
[2013-05-21 19:36:00 -0400] ughani: :)
[2013-05-21 19:36:05 -0400] thrillERboy: jtimberman: Thanks :)
[2013-05-21 19:36:26 -0400] jtimberman: ughani: there isn't a thing like 'puppet run' in chef, because the server doesn't initiate a connection to the nodes.
[2013-05-21 19:37:20 -0400] stormerider: i would suggest that one of the advantages of chef over puppet (and this is personal opinion) is that chef focuses more on idempotence, so it should be safer to keep chef-client running regularly, via init/cron/whathaveyou, whereas i was never comfortable doing that with puppet.
[2013-05-21 19:37:25 -0400] ughani: ok..thanks alot
[2013-05-21 19:37:31 -0400] bluekelp: sabooky: i'd have to see your code but in an attr def file it's not node, it's default[foo][bar] or override[foo][bar] - and i'm not sure you can override in the attr files.  so perhaps no you cannot. why do you want to set it to node's value? just set the default and let nodes override if necessary
[2013-05-21 19:37:51 -0400] stormerider: things like environments being able to freeze cookbook versions and such make that a lot easier to isolate and test changes before rolling them out
[2013-05-21 19:37:53 -0400] jtimberman: ughani: there's a feature in development for Private Chef (initially) called Push Jobs, and there were two talks about it at ChefConf.
[2013-05-21 19:42:00 -0400] ughani: if we have security update to make right nowso i would do for servers in (knife node list);do echo $PASSWORD| knife ssh $i 'sudo chef-client';done ??
[2013-05-21 19:42:05 -0400] ughani: or is there an easier way for me do that ?
[2013-05-21 19:44:17 -0400] bean__: ughani: knife ssh to them?
[2013-05-21 19:44:23 -0400] bean__: http://docs.opscode.com/knife_ssh.html
[2013-05-21 19:44:52 -0400] jtimberman: ughani: knife ssh takes a search query as an argument
[2013-05-21 19:45:09 -0400] jtimberman: ughani: if you have a recipe in the nodes' run lists that applies the security update then yes, running chef-client would work.
[2013-05-21 19:45:23 -0400] jtimberman: ughani: or you can run an arbitrary command instead of 'sudo chef-client'
[2013-05-21 19:45:47 -0400] jtimberman: ughani: knife ssh 'platform:ubuntu' 'sudo apt-get update && sudo aptitude safe-upgrade -y'
[2013-05-21 19:46:38 -0400] jtimberman: the ssh connections are opened in parallel, but it's kind of still "ssh in a for loop" (which may be what you really want at the end of the day :))
[2013-05-21 19:47:37 -0400] ughani: thanks jtimberman
[2013-05-21 19:48:00 -0400] knuckolls: so i don't think i understand attribute precedence when overriding attributes from a wrapper cookbook.
[2013-05-21 19:48:58 -0400] knuckolls: if a cookbook has a line like this inside of it's attributes/default.rb:   default['postgresql']['dir'] = "/etc/postgresql/#{node['postgresql']['version']}/main" shouldn't i be able to override that version attribute in a wrapper?
[2013-05-21 19:49:37 -0400] knuckolls: the behavior i'm seeing right now is that overriding that attribute works fine, but the node['postgresql']['dir'] attribute doesn't pick up the overridden value
[2013-05-21 19:49:41 -0400] knuckolls: it pulls in the default value
[2013-05-21 19:50:14 -0400] knuckolls: so postgres 9.2 gets installed, but node['postgresql']['dir'] == "/etc/postgresql/8.4/main"
[2013-05-21 19:50:18 -0400] knuckolls: which... is beyond me.
[2013-05-21 19:50:29 -0400] rodneyo: Is it possible to restrict the usage of knife so that only authorized people can do stuff like add,modify delete nodes or create/modify a data bag etc
[2013-05-21 19:50:30 -0400] knuckolls: so i guess i just misunderstand how the attributes file is loaded.
[2013-05-21 19:51:53 -0400] knuckolls: any thoughts?
[2013-05-21 19:53:45 -0400] bluekelp: knuckolls: the default attr you're setting has to have a value when defined so it's pulling the current version attr from node to do so - which can't be overridden, is my guess
[2013-05-21 19:54:28 -0400] skarufue: ok so again. what is a good way to ask for input interaciveley during a chef-client run. (like git providere does)
[2013-05-21 19:54:54 -0400] knuckolls: bluekelp: agreed i think that's what i'm seeing. i'm just surprised by the behavior
[2013-05-21 19:55:10 -0400] knuckolls: i'm going to have to override every place that the version is referenced in the attributes file
[2013-05-21 19:55:27 -0400] knuckolls: which i don't mind to get the job done, it's just surprising behavior from chef.
[2013-05-21 19:55:41 -0400] knuckolls: didn't know if i was seeing a bug or if this is intended
[2013-05-21 19:55:53 -0400] bluekelp: knuckolls: if you can pull that dir attr out of attr and into the recipe/resource it should work - since it'll be resolved with the final node obj and version will be overridable that way
[2013-05-21 19:56:42 -0400] bluekelp: knuckolls: i don't think it can work any other way in an attr file. it's sort of a recursive loop in the logic to have the default attr honor overrided attrs from the node
[2013-05-21 19:57:43 -0400] knuckolls: hm
[2013-05-21 19:57:45 -0400] knuckolls: i see what you mean
[2013-05-21 19:58:02 -0400] knuckolls: trying to avoid altering the upstream postgresql cookbook
[2013-05-21 19:58:59 -0400] knuckolls: i wish i could tell chef to go back through the attributes file and reload everything that's contingent on another value
[2013-05-21 19:59:11 -0400] helllen_: helllo
[2013-05-21 19:59:17 -0400] helllen_: I am getting:   mode not changed: File.lchmod is unimplemented on this OS and Ruby version
[2013-05-21 19:59:21 -0400] helllen_: what can I do ?
[2013-05-21 19:59:31 -0400] helllen_: what is File.lchmod
[2013-05-21 19:59:42 -0400] bluekelp: helllen_: which os and ruby version?
[2013-05-21 19:59:57 -0400] helllen_: centos 6.4
[2013-05-21 20:00:20 -0400] helllen_: and Chef: 11.4.4
[2013-05-21 20:00:31 -0400] helllen_: ruby 1.9.3p392
[2013-05-21 20:02:22 -0400] bluekelp: lchmod = chmod but doesn't follow symlinks.
[2013-05-21 20:03:09 -0400] bluekelp: it could be the specific ruby wasn't compiled with it, or a centos issue (but that seems odd). don't know, sorry.
[2013-05-21 20:07:59 -0400] isotope: did something in chef 11 change where you can't set a node's environment?
[2013-05-21 20:08:18 -0400] isotope: or rather where it gets set back to default after a chef-client run?
[2013-05-21 20:08:28 -0400] josephholsten: isotope: are you using the webui?
[2013-05-21 20:08:35 -0400] isotope: yes
[2013-05-21 20:09:58 -0400] isotope: seems either chef-client or edting in the webui is resetting it to _default
[2013-05-21 20:10:43 -0400] josephholsten: http://tickets.opscode.com/browse/CHEF-4175
[2013-05-21 20:11:20 -0400] helllen_: how do I set default file backp
[2013-05-21 20:11:23 -0400] helllen_: count
[2013-05-21 20:11:40 -0400] helllen_: I would like it save at least 10 backups files for every template
[2013-05-21 20:11:44 -0400] helllen_: if possible
[2013-05-21 20:11:49 -0400] isotope: josephholsten, thanks, that is not a feature
[2013-05-21 20:12:01 -0400] helllen_: what do I have to specify into my recipie ?
[2013-05-21 20:12:17 -0400] josephholsten: it truly isn't. and there's  a bunch of dupes of that ticket. I'll merge them and annoy someone
[2013-05-21 20:23:57 -0400] isotope: josephholsten yeah that bug is a really dangerous one
[2013-05-21 20:24:09 -0400] helllen_: solved: backup directive
[2013-05-21 20:24:11 -0400] helllen_: thanks
[2013-05-21 20:25:53 -0400] helllen_: I would like chef configure service at the boot time
[2013-05-21 20:25:57 -0400] helllen_: is that possible
[2013-05-21 20:25:59 -0400] helllen_: ?
[2013-05-21 20:26:45 -0400] stormerider: i think that's a bit vague
[2013-05-21 20:33:22 -0400] _Spike_: absolutely positively... maybe!
[2013-05-21 20:33:26 -0400] a|i: how to deal with: NoMethodError: undefined method `default_action' for #<Class:0x7fce3a895fe8>
[2013-05-21 20:33:46 -0400] a|i: default_action :start
[2013-05-21 20:34:00 -0400] a|i: in /var/chef/cache/cookbooks/bluepill/resources/service.rb:21
[2013-05-21 20:34:24 -0400] a|i: using chef 10.2
[2013-05-21 20:38:38 -0400] adnichols: ali https://github.com/customink-webops/hostsfile/issues/7 - not the same cookbook but probably same issue
[2013-05-21 20:41:01 -0400] adnichols: err a|i
[2013-05-21 20:41:26 -0400] a|i: adnichols: I had to upgrade chef :)
[2013-05-21 20:41:43 -0400] a|i: and  ohai.
[2013-05-21 20:42:03 -0400] adnichols: ya, that's what it looks like - cool, glad you got it handled
[2013-05-21 21:03:32 -0400] miah: isotope: knife node edit <foo>
[2013-05-21 21:03:52 -0400] isotope: miah ummmm yeah heard of that
[2013-05-21 21:04:18 -0400] rracterr: Another question guys, if I have 30 boxes that are going to get kicked off with chef and the ec2 plugin, best way to have the 31st list receive a list of the first 30?  shove it in a databag or what?
[2013-05-21 21:05:54 -0400] rracterr: or just tag all my first 30 and use that reference from the 31st?
[2013-05-21 21:06:15 -0400] juliancdunn: rracterr: the latter idea seems more dynamic
[2013-05-21 21:06:28 -0400] rracterr: agreed, I just was unsure if it was possible
[2013-05-21 21:06:51 -0400] isotope: but its a bummer the webui is hosed, its really useful
[2013-05-21 21:06:58 -0400] juliancdunn: there's a "-T" to knife ec2 server create rracterr
[2013-05-21 21:07:24 -0400] juliancdunn: although I'm not sure if that's an EC2 tags, or a Chef tags
[2013-05-21 21:14:20 -0400] shanlar: i have a recipe that needs to include another cookbook, but i only want to include this cookbook IF this specific recipe is called
[2013-05-21 21:14:23 -0400] shanlar: is that possible?
[2013-05-21 21:21:42 -0400] cwj: shanlar: you can wrap "include_recipe" in a conditional, but you cannot do the same with the dependency stated in your cookbook's metadata
[2013-05-21 21:22:05 -0400] shanlar: yea the dependency in the cookbook metadata is whats killing me
[2013-05-21 21:22:46 -0400] cwj: out of curiosity, whats the trouble with having a cookbook around that may not be used?
[2013-05-21 21:22:48 -0400] jtimberman: cwj: what do you mean?
[2013-05-21 21:22:48 -0400] shanlar: i have 5 recipes, only 1 of them needs this dependency but because of it being in the metadata the cookbook is always synced
[2013-05-21 21:23:11 -0400] jtimberman: shanlar: dependencies are all or nothing.
[2013-05-21 21:23:19 -0400] josephholsten: shanlar: I know that's driving you nuts, but chef doesn't download templates or recipes or files unless your convergence requires them. and if library files are exploding, you've got other problems.
[2013-05-21 21:24:14 -0400] shanlar: ok so it wont download the cookbook, even with it being a depends in the metata, unless it is actually included/used in a recipe?
[2013-05-21 21:24:43 -0400] josephholsten: it'll download very little.
[2013-05-21 21:25:08 -0400] josephholsten: mostly just the metadata
[2013-05-21 21:25:23 -0400] jtimberman: shanlar: Chef will synchronize from the server the cookbooks that a) appear on the node's expanded run list , b) are dependencies of cookbooks in the node's expanded run list.
[2013-05-21 21:25:52 -0400] jtimberman: the only parts of the cookbook it doesn't download are the templates and files because you might have put a large file in a cookbook and we wouldn't want to always sync that unless it's needed.
[2013-05-21 21:28:12 -0400] ElderFain: is there something for rbenv like "rvm_shell" for my cookbook?
[2013-05-21 21:29:38 -0400] shanlar: thanks
[2013-05-21 21:30:04 -0400] gchristensen: ElderFain: I wrote a wrapper to make it simpler: https://gist.github.com/grahamc/8a61d2e3ffd0510aea83
[2013-05-21 21:30:45 -0400] ElderFain: gchristensen: not sure I follow..
[2013-05-21 21:30:56 -0400] jtimberman: shanlar: i get that it's totally annoying to download cokobooks you don't need.
[2013-05-21 21:31:01 -0400] ElderFain: i have a site cookbook that calls rvm_shell to bundle install from a few different paths
[2013-05-21 21:31:10 -0400] jtimberman: shanlar: our apache2 cookbook annoys me all the time because it has so many files :)
[2013-05-21 21:31:14 -0400] shanlar: lol yea
[2013-05-21 21:31:17 -0400] ElderFain: i was just looking for a way to do the same thin in rbenv
[2013-05-21 21:31:26 -0400] jtimberman: shanlar: but, the pain is temporary ;)
[2013-05-21 21:31:27 -0400] gchristensen: ElderFain: so you can run ./wrapper.sh bundle install, and it'll Do It.
[2013-05-21 21:31:44 -0400] shanlar: sweet, so you guys have something in the works :)
[2013-05-21 21:31:47 -0400] gchristensen: with the new path. this is mostly useful for my internal scripts...
[2013-05-21 21:32:20 -0400] ElderFain: hmm, then I've gotta cart your script around
[2013-05-21 21:32:26 -0400] ElderFain: install it into vagrant and such
[2013-05-21 21:32:31 -0400] gchristensen: I place it there with chef, but yes.
[2013-05-21 21:32:37 -0400] jtimberman: shanlar: not that we have something in the works, i mean that it downloads it just that first time :)
[2013-05-21 21:32:55 -0400] ElderFain: so there is nothing like rvm_shell for rbenv ?
[2013-05-21 21:33:51 -0400] shanlar: oh lol ok cool
[2013-05-21 21:34:24 -0400] jtimberman: shanlar: i know there are metadata-related CHEF tickets in jira, but i don't know if one that handles this use case is out there
[2013-05-21 21:35:43 -0400] ElderFain: gchristensen: right so cookbook_file "~/wrapper.sh" { source "wrapper.sh" } and then everywhere you are just calling execute "bundle_install" { user "myuser" command %{ ~/wrapper.sh bundle install}
[2013-05-21 21:36:53 -0400] gchristensen: ElderFain: that is one method. you can also pass in the environment variables (specifically: the PATH that /etc/profile.d/rbenv.sh sets) to the execute block
[2013-05-21 21:38:38 -0400] ElderFain: just working within the confines of what I know works, I barely have time to learn chef and vagrant and blah blah while trying to do other stuff too =)
[2013-05-21 21:44:23 -0400] programmerq: anyone know how to get 'knife configure -i' to talk to the chef server through a proxy? normally I just put my proxy configs in knife.rb, but I get a knife.rb by running knife configure -i
[2013-05-21 21:47:09 -0400] ElderFain: gchristensen: not sure I follow, the opscode wiki doesn't cover a lot of these topics
[2013-05-21 21:48:03 -0400] gchristensen: ElderFain: http://docs.opscode.com/resource_execute.html - look at the environment attribute
[2013-05-21 21:49:53 -0400] ElderFain: so why wouldn't you do that instead of carting the script aorund?
[2013-05-21 21:50:27 -0400] gchristensen: depends on what is easier to implement
[2013-05-21 21:50:59 -0400] gchristensen: like with https://github.com/opscode-cookbooks/application_ruby, I can pass in bundler_command /path/to/script.sh bundler and it Just Works
[2013-05-21 21:51:03 -0400] ElderFain: whatever let sme run bundle install inside rbenv =)
[2013-05-21 21:51:08 -0400] ElderFain: I'm pretty close to going back to rvm_shell =)
[2013-05-21 21:53:41 -0400] ElderFain: okay well thanks for the crash cource
[2013-05-21 21:53:46 -0400] ElderFain: will try it out this evening.. thanks..
[2013-05-21 21:53:55 -0400] jbz: cheers all.  Question:  I'm trying to pull key/value pairs from a data bag and stuff them into default attributes.  I just tried to do this by putting the requisite logic in the attributes/default.rb file (chef 11, btw) but I'm failing, and as far as I can tell I'm failing because the data_bag and data_bag_item methods aren't available in the attributes file processing.  Is that correct?  If so, what's a good way around this?
[2013-05-21 21:55:13 -0400] jbz: Should I stop trying to do this in the attributes file and just do it in the defaults recipe? I wanted the attributes this code creates to be available to other cookbooks and all recipes within its own cookbook, so I figured doing it in the attributes file would ensure it happened as early as possible.
[2013-05-21 21:57:07 -0400] gleam: you might consider putting them in a library
[2013-05-21 21:58:21 -0400] gleam: although i still don't know how you'd call it early
[2013-05-21 21:58:22 -0400] gleam: shrug
[2013-05-21 22:01:37 -0400] jbz: yeah
[2013-05-21 22:01:38 -0400] jbz: hm
[2013-05-21 22:02:09 -0400] jbz: My issue is that I want to populate default attributes
[2013-05-21 22:02:13 -0400] gyre007: guys can someone tell me why isnt chef-solo able to read in the data bag or otherwise I'll go nuts :) https://gist.github.com/milosgajdos83/5623638
[2013-05-21 22:02:31 -0400] jbz: so that they don't persist run-to-run and get saved up/down to server
[2013-05-21 22:02:59 -0400] jbz: but as I understand it, if I set something as default from a recipe, it will either be stepped on or step on something that got set in a role attribute.
[2013-05-21 22:04:56 -0400] miah: attributes shouldn't be performing logic
[2013-05-21 22:05:07 -0400] miah: dont put logic in attributes/*.rb
[2013-05-21 22:05:17 -0400] jbz: miah: OK
[2013-05-21 22:05:30 -0400] jbz: is my desired flow wrongheaded then?
[2013-05-21 22:05:37 -0400] jbz: Or am I mistaken in my assumptions?
[2013-05-21 22:06:27 -0400] jbz: I also saw specifically in some Chef 11 doc examples that they were doing stuff to allow logic and setting of attribs in attrib files, is why i got confused. :-)
[2013-05-21 22:06:38 -0400] miah: ya. well. there are lots of bad examples out th ere.
[2013-05-21 22:07:44 -0400] jbz: heh
[2013-05-21 22:07:59 -0400] jtimberman: jbz: i'd totally do that in a recipe.
[2013-05-21 22:08:00 -0400] gyre007: this is weird...the json validates just fine...yet chef-solo is simply crying about something...
[2013-05-21 22:08:02 -0400] jbz: ok.  Is it OK to set default-precedence attribs in a recipe then?
[2013-05-21 22:08:14 -0400] jtimberman: it's totally ok to use node.default in a recipe
[2013-05-21 22:08:18 -0400] jbz: ah ok.
[2013-05-21 22:08:30 -0400] jbz: Thanks.
[2013-05-21 22:08:45 -0400] jaimef: in an execute block with user: "foo" $HOME is still set to /root. Is there anyway to override a variable in an execute block?
[2013-05-21 22:09:48 -0400] jtimberman: jaimef: you can pass environment to an execute block with the 'environment' attribute.
[2013-05-21 22:10:17 -0400] jtimberman: http://docs.opscode.com/chef/resources.html#id69
[2013-05-21 22:10:33 -0400] jtimberman: environment({"HOME" => "/home/useryouwant"})
[2013-05-21 22:24:47 -0400] josephholsten: isotope: https://github.com/opscode/chef-server-webui/pull/13
[2013-05-21 22:24:58 -0400] josephholsten: happy birthday
[2013-05-21 22:28:34 -0400] ggolin: so - test-kitchen and roles?
[2013-05-21 22:31:09 -0400] ianco: hrm, could use some halp i think. im using a template resource inside a new generic definition I just made. im calling it from a lwrp in another cookbook
[2013-05-21 22:31:42 -0400] ianco: it tries to load the template erb from the cookbook containing the lwrp
[2013-05-21 22:32:06 -0400] ianco: and not the one with the defition, which is where both the template resource and template file live
[2013-05-21 22:32:13 -0400] ianco: da heck
[2013-05-21 22:35:25 -0400] jtimberman: ggolin: it doesn't feel like test kitchen should be "testing roles" since they're data.
[2013-05-21 22:35:53 -0400] jtimberman: ggolin: the idea is that you use test-kitchen to test all the cookbooks that you're going to compose in a role.
[2013-05-21 22:35:54 -0400] ggolin: jtimberman, right now im just trying to get my stuff to converge :)
[2013-05-21 22:36:22 -0400] jtimberman: and then you move up the stack in your infrastructure, so imo you'd put the roles on nodes that you're launching in a staging/preproduction environment.
[2013-05-21 22:37:10 -0400] ggolin: jtimberman, right. so. watdo in cases with cookbooks that deploy apps/databases using roles (application/database cookbooks)
[2013-05-21 22:38:29 -0400] jtimberman: ggolin: "knife ec2 server create -E staging -r 'role[dbmaster]'", "knife ec2 server create -E staging -r 'role[appserver]'"?
[2013-05-21 22:40:00 -0400] ggolin: i guess im trying to get too much out of this thing
[2013-05-21 22:40:12 -0400] ggolin: (which btw is amazing, thank you)
[2013-05-21 22:40:26 -0400] ggolin: (ant fletcher)
[2013-05-21 22:40:36 -0400] ggolin: (and, fletcher is not an ant)
[2013-05-21 22:43:59 -0400] jtimberman: ggolin: for a fully automated test setup/teardown environment, i think something like chef-workflow is a good fit.
[2013-05-21 22:44:07 -0400] jtimberman: at least, theoretically, as i've not used chef-workflow yet.
[2013-05-21 22:50:29 -0400] josephholsten: ggolin: did you get roles set up? I've been punting on getting a cookbook with a dependency on nagios::client setup on TK because it wants either search or a role
[2013-05-21 22:54:39 -0400] a|i: knife hangs when launching an en2 instance: Waiting for sshd
[2013-05-21 22:54:49 -0400] a|i: ec2*
[2013-05-21 22:55:13 -0400] a|i: is this a known issue?
[2013-05-21 22:56:28 -0400] jaimef: got rooted by the aws latest gem
[2013-05-21 22:56:38 -0400] jaimef: someone registered a trojan gem under the typoed name
[2013-05-21 22:56:43 -0400] ggolin: josephholsten, roles - no. search - yes.
[2013-05-21 22:56:45 -0400] ggolin: it seems.
[2013-05-21 22:57:03 -0400] josephholsten: search under solo?
[2013-05-21 22:57:07 -0400] ggolin: yessir
[2013-05-21 22:57:32 -0400] ggolin: now trying to figure out the syntax for nested attributes in .kitchen.yml
[2013-05-21 22:57:51 -0400] josephholsten: oh, should I be using https://github.com/edelight/chef-solo-search?
[2013-05-21 22:58:09 -0400] ggolin: josephholsten, thats what i am using
[2013-05-21 22:58:49 -0400] jtimberman: jaimef: what? what gem?
[2013-05-21 22:59:06 -0400] ggolin: ruhroh.
[2013-05-21 22:59:08 -0400] jaimef: aws 2.9.0
[2013-05-21 22:59:24 -0400] jaimef: it references uuidtoolds instead of uuidtools gem
[2013-05-21 22:59:25 -0400] josephholsten: can chef-solo-search stub out this? https://github.com/opscode-cookbooks/nagios/blob/master/recipes/client.rb#L32
[2013-05-21 22:59:57 -0400] ggolin: josephholsten, no idea man
[2013-05-21 23:02:35 -0400] jtimberman: jaimef: https://github.com/appoxy/aws/pull/126
[2013-05-21 23:02:42 -0400] a|i: knife ec2 server create keeps stuck at: waiting for sshd today.
[2013-05-21 23:03:41 -0400] jaimef: well uuidtoolds is now installed everywhere and rooting
[2013-05-21 23:05:28 -0400] josephholsten: aww, ggolin left. but chef-solo-search _does_ work with nodes: https://github.com/edelight/chef-solo-search#nodes
[2013-05-21 23:05:46 -0400] josephholsten: for y'all's info
[2013-05-21 23:13:09 -0400] a|i: what's the difference between knife and knife-ec?
[2013-05-21 23:13:45 -0400] ssd7: knife-ec2 is a plugin for knife that allows you to provision ec2 nodes and bootstrap them for use with chef
[2013-05-21 23:14:00 -0400] ssd7: knife is the core command line tool shipped in the Chef package that lets you interact with your chef server and nodes
[2013-05-21 23:14:08 -0400] a|i: I updated chef gem, but knife-ec2 was not updated
[2013-05-21 23:14:46 -0400] a|i: even after updating chef, ohai and knife-ec2, It still stuck at: Waiting for sshd
[2013-05-21 23:14:54 -0400] a|i: ssh port is open for the secutiry group.
[2013-05-21 23:29:33 -0400] a|i: is there a way to setup chef-client with opscode.com account after ssh-ing into an ec2 instance?
[2013-05-21 23:29:56 -0400] a|i: that is, can what knife-ec2 does be done manually?
[2013-05-21 23:32:49 -0400] cwj: a|i: yes, the 'knife ec2 server create' command is running a bootstrap script on the ec2 instance
[2013-05-21 23:33:14 -0400] cwj: here's the template of one of the bootstrap scripts which ships with chef https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb
[2013-05-21 23:33:15 -0400] a|i: cwj: but it keeps getting stuck at 'Waiting for sshd' for me.
[2013-05-21 23:33:56 -0400] cwj: so you could use that template as the basis for a list of steps to be taken manually, if needs be
[2013-05-21 23:34:13 -0400] cwj: but if you are having problems with knife ec2 it might be better to figure that out
[2013-05-21 23:34:26 -0400] a|i: cwj: any idea what could be wrong?
[2013-05-21 23:34:31 -0400] cwj: a|i: what version of chef/knife are you using?
[2013-05-21 23:34:44 -0400] cwj: knife -v should tell you
[2013-05-21 23:34:47 -0400] a|i: Chef: 11.4.4
[2013-05-21 23:35:49 -0400] a|i: cwj: ssh port is open, I can ssh into the instance manually.
[2013-05-21 23:36:16 -0400] a|i: cwj: can knife be more verbose to report what's blocking it?
[2013-05-21 23:36:25 -0400] cwj: when you ssh into the instance manually, you are using an ssh key already loaded via ssh-add/ssh-agent?
[2013-05-21 23:36:46 -0400] cwj: not sure what verbosity is available under 11.x, i am still on 10.x
[2013-05-21 23:37:04 -0400] cwj: i think -V is verbose mode
[2013-05-21 23:37:07 -0400] a|i: cwj: I pass the key by -i.
[2013-05-21 23:37:53 -0400] cwj: a|i: and you are passing the same key in your flags for 'knife ec2 server create' ? i think the flag for that is -I
[2013-05-21 23:38:25 -0400] cwj: nope, i'm wrong
[2013-05-21 23:38:28 -0400] cwj: its also -i
[2013-05-21 23:38:30 -0400] a|i: -i
[2013-05-21 23:38:39 -0400] a|i: yes, exactly the same key.
[2013-05-21 23:39:06 -0400] cwj: try with -VV for maximum verbosity i guess
[2013-05-21 23:39:53 -0400] a|i: I tried -VV, no difference in output.
[2013-05-21 23:42:07 -0400] a|i: cwj: how does chef-full.erb help this? doesn't it still have to ssh?
[2013-05-21 23:42:46 -0400] cwj: you asked "can what knife-ec2 does be done manually?"
[2013-05-21 23:43:12 -0400] cwj: you can use 'knife bootstrap' or use that template as the basis for a list of manual actions
[2013-05-21 23:43:54 -0400] cwj: does netstat show any outgoing connection to the new instance while knife is hung on waiting for ssh?
[2013-05-21 23:44:41 -0400] cwj: looks like historically some degree of heroics has been required to get access to the net-ssh debug logs e.g. http://tickets.opscode.com/browse/CHEF-1485
[2013-05-21 23:47:36 -0400] a|i: this sucks.
[2013-05-21 23:49:50 -0400] gzc: a|i: you can definitely ssh to that same box from the same machine that's provisioning with knife, right?
[2013-05-21 23:50:09 -0400] a|i: gzc: that's right.
[2013-05-21 23:50:20 -0400] gzc: so weird
[2013-05-21 23:50:44 -0400] cwj: a|i: try knife bootstrap ?
[2013-05-21 23:50:50 -0400] gzc: ^
[2013-05-21 23:51:35 -0400] cwj: although it would be even weirder if bootstrap works and ec2 server create doesn't
[2013-05-21 23:52:22 -0400] a|i: so I use: knife ec2 server create.. let it stuck, and then use knife bootstrap on that ip?
[2013-05-21 23:52:30 -0400] cwj: yeah
[2013-05-21 23:53:03 -0400] a|i: do I need to pass all of the options for knife ec2 create server to knife bootstrap, or is just the ip enough?
[2013-05-21 23:55:02 -0400] alisdair: i have a loop in a recipe with a task that does `not_if { FileTest.exists?("#{filepath}") }' that returns true despite `filepath' being altered in each iteration of the loop
[2013-05-21 23:55:07 -0400] alisdair: do i misunderstand how chef does things?
[2013-05-21 23:56:07 -0400] cwj: a|i: unless its loaded into ssh-agent, knife bootstrap will need the ssh key, and you'll probably need to tell it which user to connect as and to use sudo when running the template, etc
[2013-05-21 23:56:23 -0400] cwj: knife bootstrap --help
