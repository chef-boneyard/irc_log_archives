[2013-09-23 01:32:11 -0400] mmccarthy: Hi All. Is there way to do an if/then in an attributes file? I need to change an attribute based on OS version.
[2013-09-23 01:37:52 -0400] douglaswth: mmccarthy: yes, attributes files are just a ruby "DSL"
[2013-09-23 09:04:39 -0400] s2r2: is there a commonly used way to cache stuff in a provider?  (i.e. have an attribute store a connection to an API so it doesn't have to be built in each call to an action or load_current_resource)
[2013-09-23 10:03:46 -0400] zeroXten: is there a suggested way of checking whether a databag item exists?
[2013-09-23 10:04:52 -0400] zeroXten: i guess data_bag("the-name").include? "the-item"
[2013-09-23 12:12:26 -0400] ichilton: is there a way of removing attributes from a node? - the web interface can view but doesn't seem to have a way of deleting
[2013-09-23 12:13:05 -0400] ichilton: ah, knife node edit maybe?
[2013-09-23 12:13:38 -0400] adamjk-dev: ichilton: http://docs.opscode.com/knife_node.html#edit
[2013-09-23 12:14:06 -0400] ichilton: adamjk-dev: thanks - sorted now hopefully!
[2013-09-23 12:14:10 -0400] adamjk-dev: you may be able to just remove it that way.... but I am guessing that if chef runs again that node attribute will be populated again right?
[2013-09-23 12:14:48 -0400] ichilton: I bodged up on a simple_iptables rule and now it's stuck in there!
[2013-09-23 12:15:05 -0400] ichilton: obviously the recipes don't override the attributes it has cached :(
[2013-09-23 12:15:14 -0400] adamjk-dev: ichilton: ah, I see
[2013-09-23 13:42:39 -0400] broconne: Looking for input on how to achieve something with chef.  We are converting something was automated with PERL to be a chef recipe. So far so good. Replaced 1000 lines of PERL w/ about 15 lines of chef DSL.  However, I am struggling with one facet of the conversion.  We have something in the PERL code that is strictly computational.  In other words, we have a function, we pass in values, it does a computation on them and returns a result.  It in now way modifies 
[2013-09-23 13:46:28 -0400] daharon: broconne: You can just translate that code to Ruby and save the value as a variable.  Then use it in a Chef resource somewhere.
[2013-09-23 13:47:41 -0400] broconne: Yah, I saw that as an option daharon.. but I was arguing that it might not be the best use of resources this scrum.  Unless its our only option.
[2013-09-23 13:48:45 -0400] broconne: since it was purely computational, didn't need to worry about messing w/ idempotency by doing something outside the DSL.
[2013-09-23 13:49:47 -0400] phnz: hey guys !
[2013-09-23 13:53:33 -0400] phnz: Quick question, I have a deployment process setup with Chef, and when I generate my config file with app settings, I want to include the git describe -- https://gist.github.com/DavidLemarier/6670683 -- but the current_version is always empty -- any suggestion ?
[2013-09-23 13:53:33 -0400] broconne: daharon - that make sense?
[2013-09-23 14:03:47 -0400] zeroXten: ah classic. Trying to work out why my route resource isn't adding anything to the route-eth0 config file, so I monkey-patch chef to add some puts statements, and the act of monkey-patching seems to fix the issue
[2013-09-23 14:06:38 -0400] zeroXten: can i get drunk yet?
[2013-09-23 14:13:17 -0400] daharon: broconne: I think the tail end of your original message got cut off then.  I wasn't aware of that.
[2013-09-23 14:15:25 -0400] broconne: ok, let me repaste as multiple messages then.
[2013-09-23 14:15:36 -0400] broconne: Looking for input on how to achieve something with chef.  We are converting something was automated with PERL to be a chef recipe. So far so good. Replaced 1000 lines of PERL w/ about 15 lines of chef DSL.  However, I am struggling with one facet of the conversion.  We have something in the PERL code that is strictly computational.
[2013-09-23 14:15:42 -0400] broconne: In other words, we have a function, we pass in values, it does a computation on them and returns a result.  It in now way modifies the system.  I don't see a good reason to invest development cycles on converting that code to ruby.
[2013-09-23 14:15:47 -0400] broconne: However, I also don't see a great way of calling a function in another language (be it PERL, Python, etc) to get the result of that function.  In fact, the only way I see to use this function would be to call it using Mixlib:ShellOut.  Am I missing something?
[2013-09-23 14:16:00 -0400] asto: Hi to all.
[2013-09-23 14:16:25 -0400] gchristensen: broconne: you're righta bout he ShellOut, though it may in fact be worth the conistency to rewrite it as a ruby librarny.
[2013-09-23 14:16:58 -0400] zeroXten: right, so 11.4.4 was broken for route
[2013-09-23 14:17:52 -0400] broconne: gchristensen.  Ok thanks.  trying to invest development cycles where they make sense..  since that code doesn't actually touch anything, thought we coudl save it rather than rewrite it.  Appreciate the input.
[2013-09-23 14:21:00 -0400] pontiki: this would work for cookbooks, too: http://devopsreactions.tumblr.com/post/62048692029/converting-old-perl-scripts-to-puppet-manifests
[2013-09-23 14:24:06 -0400] asto: Could someone help me with templates name? I have template with such name template "#{node['etc']['passwd']['user']['dir']}/.config" do... How to change into like template "#{node['etc']['passwd'][{#node['user']}['dir']}/.config" do ?
[2013-09-23 14:24:06 -0400] zeroXten: dumb question. where is the documentation for upgrading from chef 11.4 to 11.6?
[2013-09-23 14:25:26 -0400] zeroXten: asto: can't you just do "#{node['etc']['passwd'][node['user']]['dir']}" ?
[2013-09-23 14:28:46 -0400] asto: zeroXten: greate it works, thank you:)
[2013-09-23 14:31:07 -0400] zeroXten: asto: np
[2013-09-23 14:31:35 -0400] zeroXten: you were trying to string extrapolation inside string extrapolation
[2013-09-23 14:31:39 -0400] zeroXten: +do
[2013-09-23 14:33:02 -0400] fooJBar: string interpolation*
[2013-09-23 14:33:45 -0400] zeroXten: haha yeah :(
[2013-09-23 14:34:39 -0400] kuba_ce: Hello everyone, I have chef recipe which i run on debian, but every cookbook depends on yum what is meaningless. Can I ignore yum dependency?
[2013-09-23 14:34:55 -0400] zeroXten: fooJBar: saw this recently https://bobbiblogger.files.wordpress.com/2012/03/extrapolate.jpg
[2013-09-23 14:35:13 -0400] fooJBar: zeroXten: XD
[2013-09-23 14:35:20 -0400] zeroXten: earlier today I think
[2013-09-23 14:35:50 -0400] zeroXten: scary how much the mind is influenced
[2013-09-23 14:36:08 -0400] fooJBar: subconscious takes control!
[2013-09-23 14:37:00 -0400] zeroXten: fooJBar: why does that remind me of a song?
[2013-09-23 14:39:53 -0400] davsharyan33: hola amigos, on every chef-client run I see "start service service[ossec]" even in case service is running. what's the problem ? should I add not_if w/ status check manually to stop sending start everytime ? kiitos
[2013-09-23 14:41:30 -0400] willejs: is anyone using the chef-rvm cookbook successfully?
[2013-09-23 14:41:34 -0400] willejs: with the lwrp?
[2013-09-23 14:41:42 -0400] davsharyan33: service has set : supports :status => true, :restart => true
[2013-09-23 14:45:13 -0400] davsharyan33: forget, echo $? != 0
[2013-09-23 14:46:12 -0400] stormerider: so i've got two windows nodes and they dont seem to be setting the fqdn in the nodename by default. do i need to explicitly set the nodename in client.rb or is there a trick i'm missing?
[2013-09-23 14:46:22 -0400] kuba_ce: Hello everyone, I have chef recipe which i run on debian, but every cookbook depends on yum what is meaningless. Can I ignore yum dependency?
[2013-09-23 14:46:32 -0400] awaxa: willejs: i was having trouble with the chef-rvm cookbook this weekend.  i assumed i was doing something wrong because my user global gemset was installed owned by root...
[2013-09-23 14:47:27 -0400] awaxa: also my chef client was a 10.8.4 mac / possibly relevant
[2013-09-23 14:51:31 -0400] aslaen: hello, I am trying to use RightScale for my server management and they are still using Chef 10. I am using the python cookbook, which is using converge_by but that doesn't work with Chef 10. How are people getting around this?
[2013-09-23 14:51:48 -0400] aslaen: Is it possible to use a python cookbook without converge_by that still does pip installs?
[2013-09-23 14:55:56 -0400] willejs: awaxa: were you using the LWRP? i havent delved deep into the code, but it doesn't look straight forward...
[2013-09-23 14:57:18 -0400] broconne: Is there a decent solution for keeping the layout of Berkshelf creates w/ GIT hating empty directories?  Wondering if there is a way to make berkshelf but the .gitignore files in empty directories..
[2013-09-23 14:58:07 -0400] awaxa: willejs: i was using the rvm::user recipe with attributes in my role
[2013-09-23 14:59:05 -0400] zeroXten: hmm, am I missing something? How do you do a minor upgrade of chef?
[2013-09-23 14:59:27 -0400] stormerider: zeroXten: if omnibus, just upgrade the package
[2013-09-23 14:59:29 -0400] awaxa: i did test an independent use of one of the LWRPs which seemed to work fine but i came up with a different solution
[2013-09-23 15:00:03 -0400] stormerider: zeroXten: if you want to do it inside chef, use the heavy water omnibus_updater cookbook
[2013-09-23 15:00:09 -0400] zeroXten: stormerider: ah nice thanks
[2013-09-23 15:00:15 -0400] zeroXten: na, yum is good enough for me
[2013-09-23 15:00:35 -0400] stormerider: not sure there's a yum repo
[2013-09-23 15:00:51 -0400] zeroXten: oh
[2013-09-23 15:18:00 -0400] Dzany: hi all
[2013-09-23 15:18:24 -0400] Dzany: is there a way that I could generate attribute from bash command output?
[2013-09-23 15:20:19 -0400] Dzany: of course, inside recipe, so I can generate configuration through template
[2013-09-23 15:21:27 -0400] broconne: Dzany - I think ShellOut (but I am no expert)
[2013-09-23 15:25:30 -0400] Dzany: it makes sense
[2013-09-23 15:27:37 -0400] Dzany: tnx
[2013-09-23 15:43:38 -0400] EricL: Does before_restart in the deploy resource automatically attempt to execute deploy/before_restart.rb that exists in the repo?
[2013-09-23 15:49:05 -0400] rwilcox: Good day everyone. I'm putting a deploy together with chef deploy and I want to render a template in a callback (deploy/before_symlink.rb). Where do I put the template source? deploy/templates/myfile.ext.erb ? I'm not sure what's on the template search path at this point
[2013-09-23 15:49:14 -0400] rwilcox: (I'm also somewhat new to chef)
[2013-09-23 15:50:55 -0400] broconne: well... I am new too..  but I think the search path for templates is the same as other items.. so it will start looking os specfic in tempaltes and then fall back to default
[2013-09-23 15:52:09 -0400] rwilcox: @broconne yes that makes sense. What worries me is that I'm not actually in a cookbook, you know what I mean?
[2013-09-23 15:54:48 -0400] broconne: nope not really, thought you had to be in a cookbook :-)
[2013-09-23 16:03:12 -0400] gchristensen: so is it bad form for an ohai plugin to use the hints system to cache highly expensive calculated attributes?
[2013-09-23 16:05:48 -0400] broconne: can an LWRP action, return a value?
[2013-09-23 16:06:01 -0400] gchristensen: no, it returns a resource
[2013-09-23 16:08:43 -0400] broconne: gchristensen -> can that resource have a value associated with it?  Perhaps I am approaching this wrong.  I am trying to create a small LWRP to resolve, download and install resources using the underlying DSL - but this pattern is unique to our infra and repeated across many cookbooks.. so i thougth good candidate for LWRP.  I was trying to make the actions seperate such that LWRP resolve, would give you just the URL you need to download, Download would download
[2013-09-23 16:08:49 -0400] broconne: not sure if that is clear.
[2013-09-23 16:10:28 -0400] gchristensen: broconne: might be better to create a ruby library you drop onto the ystem and call from chef
[2013-09-23 16:10:52 -0400] broconne: because not everything I am doing is an "action"?
[2013-09-23 16:13:21 -0400] philsturgeon1: trying to get a file into the user home directory, or /root/ if its the root user
[2013-09-23 16:13:31 -0400] philsturgeon1: but ubuntu runs as an ubuntu user, so its not going into root with this: home_dir = "#{ENV['PWD']}".empty? ? '/root' : ENV['PWD']
[2013-09-23 16:15:07 -0400] philsturgeon1: I guess I should be checking if the user is root, then trying to put it in their homedir if it can find one
[2013-09-23 16:17:57 -0400] gchristensen: philsturgeon1: I make sure to fail the chef-run if the executor is not root
[2013-09-23 16:18:04 -0400] gchristensen: but that is just me
[2013-09-23 16:19:04 -0400] philsturgeon1: gchristensen: on vagrant the user is vagrant
[2013-09-23 16:28:56 -0400] dgarstang2: Anyone aware of any guides re: setting jenkins up to deploy cookbooks?
[2013-09-23 16:30:58 -0400] mattjalexander: @dgarstang2 i just use a single Rakefile that basically runs foodcritic && chefspec && kitchen test && berks upload
[2013-09-23 16:32:16 -0400] mattjalexander: you'll need to make your jenkins client an "admin" of your chef server to allow it to upload
[2013-09-23 16:32:24 -0400] dgarstang2: mattjalexander: if only it was that simple... Do you have jenkins jobs for every cookbook or only the 'top level' ones?
[2013-09-23 16:33:02 -0400] mattjalexander: only the top level ones (generall $COMPANY-stuff). berks should upload the dependencies
[2013-09-23 16:33:09 -0400] dgarstang2: mattjalexander: right
[2013-09-23 16:33:41 -0400] mattjalexander: my main problem right now is trying to make our stuff that uses databags test-kitchen friendly
[2013-09-23 16:34:15 -0400] dgarstang2: mattjalexander: the other issue was ... well it was Friday, so it's murky. If someone does a git commit, and then there's a git hook to build the cookbook...
[2013-09-23 16:35:22 -0400] dgarstang2: mattjalexander: In the jenkins job do you pull dependancies in Berksfile from git or a chef server?
[2013-09-23 16:35:54 -0400] mattjalexander: Gemfile and Berksfile should handle that
[2013-09-23 16:36:06 -0400] mattjalexander: you may need to add in some initial setup of ruby/bundle install stuff
[2013-09-23 16:36:12 -0400] dgarstang2: mattjalexander: Yes, but you need to tell Berksfile where to get the dependant cookbooks from
[2013-09-23 16:36:34 -0400] dgarstang2: mattjalexander: yuck
[2013-09-23 16:36:56 -0400] mattjalexander: yeah, you can give it git repo like cookbook 'vagrant', git: "git@github.com:jtimberman/vagrant-cookbook.git"
[2013-09-23 16:37:31 -0400] dgarstang2: mattjalexander: so the jenkins job pulls dependancies from git then, rather than from a chef server. I know there was an issue iwth that on Friday. I just can't remember it now
[2013-09-23 16:39:18 -0400] mattjalexander: it depends on you have Berkshelf configured, but usually it pulls them from opscode's site
[2013-09-23 16:39:26 -0400] dgarstang2: mattjalexander: see, if your working on cookbook and you commit to git, that won't cause jenkins to update the higher level cookbooks
[2013-09-23 16:39:43 -0400] dgarstang2: mattjalexander: you'd need to run berks upload on the workstation
[2013-09-23 16:40:24 -0400] mattjalexander: or force a build of the higher level cookbook
[2013-09-23 16:40:56 -0400] dgarstang2: mattjalexander: This is the kinda stuff that just ain't blogged or documented anywhere
[2013-09-23 16:43:48 -0400] cap10morgan: What's the replacement for load_attribute_by_short_filename
[2013-09-23 16:43:58 -0400] cap10morgan: in Chef 11.6.0?
[2013-09-23 16:44:13 -0400] cap10morgan: it was a Chef::Node method in 10.x but now appears to be gone
[2013-09-23 16:45:49 -0400] pcn: ohai chefs, is there a way to get some parts of the chef DSL available in a ruby_block?
[2013-09-23 16:46:22 -0400] pcn: I'd like to be able to use the mount and the mdadm resources, but the syntax to do so escapes me
[2013-09-23 16:50:08 -0400] cwj: pcn: is there a reason you dont place your ruby code in the recipe directly? putting chef resources inside a ruby block seems like an anti-pattern to me
[2013-09-23 16:51:34 -0400] cwj: does anyone know if provision_command is something test-kitchen driver plugins support by default? it doesnt seem to be working for me with kitchen-ec2
[2013-09-23 16:52:15 -0400] pcn: cwj: I'm building raids and mounting them.   I don't want to do that until after the compile phase so I can understand enough about the state of the system that I can properly construct not_ifs around the entire process
[2013-09-23 16:52:55 -0400] makerbreaker: does anyone freelance writing chef code?
[2013-09-23 16:53:13 -0400] makerbreaker: (im looking to break into that, but was curious if there is demand)
[2013-09-23 16:55:47 -0400] cwj: pcn: have you considered writing a resource and provider to handle this? because it sounds like that is what you are trying to do
[2013-09-23 16:55:48 -0400] philsturgeon1: makerbreaker: there are a lot of companies that want to get going with chef but have NO idea how
[2013-09-23 16:56:04 -0400] philsturgeon1: makerbreaker: i do a lot of consulting on it. show what ive done, do some basic setup, help with specific problems, etc
[2013-09-23 16:56:11 -0400] makerbreaker: how do you reach them?
[2013-09-23 16:56:22 -0400] philsturgeon1: makerbreaker: i blogged about things a lot and they come to me
[2013-09-23 16:56:36 -0400] makerbreaker: ah, ok, that makes sense
[2013-09-23 16:57:04 -0400] makerbreaker: do you do that full time?
[2013-09-23 16:57:17 -0400] pcn: cwj that may be a next step, but I think I should be able to do this within a ruby_block in a recipe
[2013-09-23 16:57:43 -0400] philsturgeon1: makerbreaker: nah part time.
[2013-09-23 16:58:33 -0400] cwj: pcn: im sure its possible given enough include statements, but by the time youve figured it out i think youll be needing a resource+provider for it anyway
[2013-09-23 17:04:37 -0400] pcn: It looks like the needful is here:
[2013-09-23 17:04:39 -0400] pcn: https://tickets.opscode.com/browse/CHEF-2756
[2013-09-23 17:07:22 -0400] pcn: *sigh* but maybe not in chef 11
[2013-09-23 17:10:21 -0400] mattjalexander: is there a way to reference databags in attribute/* files?
[2013-09-23 17:11:40 -0400] christianvozar: Hello all. Have a question about Ohai and gem usage within cookbook libraries. I am trying to use the aws-sdk gem to interface with Route53. This requires settings the :ip_address when creating a health-check in route53. Everything works save this symbol which always gets produced as nil.
[2013-09-23 17:17:22 -0400] mmccarthy: douglaswth: Thanks. I had some problems trying it, but will keep at if I know it is possible.
[2013-09-23 17:19:53 -0400] douglaswth: mmccarthy: there should be examples in the opscode cookbooks
[2013-09-23 17:21:09 -0400] mmccarthy: douglaswth: I saw the example with "attribute?" http://docs.opscode.com/essentials_cookbook_attribute_files.html#attribute-method
[2013-09-23 17:25:58 -0400] dgarstang2: Trying to get berks to grab from local gitlab.... URL works in browswer, but berks complains about it
[2013-09-23 17:27:32 -0400] dgarstang2: What the heck is the URL gonna be?
[2013-09-23 17:28:12 -0400] dgarstang2: http://git.co.foo.com/chef/bc-apt/tree/master ? http://git.co.foo.com/bc-apt? http://git.co.foo.com/bc-apt.git ?
[2013-09-23 17:28:17 -0400] mattjalexander: what's the error berks is throwing?
[2013-09-23 17:29:05 -0400] mattjalexander: probably something like cookbook "mysql", git: "https://yourgitlab.com/opscode-cookbooks/mysql.git"
[2013-09-23 17:29:52 -0400] stormerider: dgarstang2: it should be whatever you'd use it "git clone"
[2013-09-23 17:30:11 -0400] stormerider: s/use it/use in/
[2013-09-23 17:30:46 -0400] dgarstang2: Well, that's git@git.co.foo.com:chef/bc-apt.git I don't think :chef is actually HTTP allowable tho
[2013-09-23 17:31:34 -0400] dgarstang2: oh wait, gitlab has a button to change to HTTP in the UI
[2013-09-23 17:32:22 -0400] dgarstang2: *sigh* asking for a password when I run berks. Works fine with a git clone tho
[2013-09-23 17:35:27 -0400] agarson: dgarstang2:  what is the line you have in your berksfile?
[2013-09-23 17:36:26 -0400] dgarstang2: agarson: so, it turns out that out gitlab doesn't allow pulling http without a username/password
[2013-09-23 17:36:49 -0400] dgarstang2: agarson: berks is either gonna have to let me pull the repo via ssh, or let me supply it with a user/pass
[2013-09-23 17:37:21 -0400] dgarstang2: Hmm.... git://
[2013-09-23 17:38:30 -0400] dgarstang2: agarson: so, trying with 'cookbook 'bc-apt', git: "git@git.co.foo.com:chef/bc-apt.git"' gets me a berksfile error
[2013-09-23 17:39:05 -0400] agarson: dgarstang2:  try this
[2013-09-23 17:39:05 -0400] dgarstang2: dangit
[2013-09-23 17:39:28 -0400] dgarstang2: wait, wait... user error I think.
[2013-09-23 17:39:36 -0400] agarson: https://user:password@gitlab/....
[2013-09-23 17:40:02 -0400] agarson: git: git@ should work fine as well
[2013-09-23 17:40:10 -0400] makerbreaker: you should be able to grab an oath too right?
[2013-09-23 17:40:39 -0400] agarson: we might not support that in berkshelf, i'd have to check
[2013-09-23 17:41:11 -0400] dgarstang2: agarson: combo of using git:// and actually giving the jenkins user access works. thanks
[2013-09-23 17:41:13 -0400] makerbreaker: havnet used gitlab, but github lets you do token:x-oauth-basic@github.com/user
[2013-09-23 17:41:49 -0400] agarson: makerbreaker:  if its just embeded in the uri then it should totally work with berkshelf
[2013-09-23 17:44:40 -0400] mmccarthy: I can't figure out how to access the platform version from within an attributes file. Can anyone give me a pointer?
[2013-09-23 17:44:55 -0400] fak3r: so while I had everything working with roles, I was told to do wrapper cookbooks, but now Berkshelf won't work, it can't see them
[2013-09-23 17:45:36 -0400] fak3r: whoa, looking above, I'm doing GITLAB with Berkshelf too - is there an issue? Cause it doesn't work like it should for me
[2013-09-23 17:47:13 -0400] fak3r: dgarstang2: yes, we have the same issue - I can git clone from from our gitlab server, but putting it in berksfile fails to get it
[2013-09-23 17:48:23 -0400] fak3r: hmm..how do you tell berks not to try to validate https? maybe that's it? error: SSL certificate problem, verify that the CA cert is OK. Details:
[2013-09-23 17:49:55 -0400] fak3r: na, I already have that set to falks
[2013-09-23 17:49:59 -0400] fak3r: *false
[2013-09-23 17:55:31 -0400] fak3r: but even if I don't put a URL, and I path: to it, it fails
[2013-09-23 17:55:32 -0400] agarson: fak3r:  you tell it not to validate in your ~/.berkshelf/config.json { "ssl": { "verify": false }}
[2013-09-23 17:55:50 -0400] agarson: fak3r:  use an absolute path
[2013-09-23 17:55:53 -0400] agarson: if you aren't
[2013-09-23 17:56:08 -0400] fak3r: yes
[2013-09-23 17:56:09 -0400] fak3r: "ssl":{"verify":false}}
[2013-09-23 17:56:24 -0400] agarson: whats in your berksfile?
[2013-09-23 17:57:08 -0400] fak3r: cookbook "base",  path: "my-cookbooks/base"
[2013-09-23 17:57:17 -0400] agarson: use an absolute path
[2013-09-23 17:57:56 -0400] fak3r: I get the same: /Users/phil/.rbenv/versions/1.9.3-p392/lib/ruby/1.9.1/net/http.rb:1859:in `initialize': no HTTP request path given (ArgumentError)
[2013-09-23 17:58:16 -0400] agarson: gist me the full output
[2013-09-23 17:58:20 -0400] fak3r: really confused here, git: "https: won't work, path to the dir doesn't work, full path doesn't work
[2013-09-23 17:58:21 -0400] fak3r: ok
[2013-09-23 17:58:22 -0400] fak3r: thanks
[2013-09-23 17:58:34 -0400] agarson: and the full berksfile if you can
[2013-09-23 18:00:20 -0400] fak3r: agarson:  https://gist.github.com/philcryer/6674453
[2013-09-23 18:01:26 -0400] fak3r: agarson:  so the thing I'm trying today is to get wrapper cookbooks to work, instead of putting everything into roles (which I had working, but everyone says not to do)
[2013-09-23 18:01:52 -0400] agarson: yeah, berkshelf is against roles, because they are not versioned with the cookbook
[2013-09-23 18:02:44 -0400] stormerider: fak3r: afaict it's processing that path fine, the error doesnt seem to be related to that cookbook.
[2013-09-23 18:02:51 -0400] agarson: yeah
[2013-09-23 18:02:59 -0400] stormerider: fak3r: if you comment out that cookbook i think you'll still see the same thing
[2013-09-23 18:03:11 -0400] agarson: fak3r:  run the install again with -d
[2013-09-23 18:03:45 -0400] agarson: Using base (0.1.0) at '../../../../dev/savvis/chef-repo/savvis-cookbooks/base'
[2013-09-23 18:03:51 -0400] agarson: fak3r:  its something else
[2013-09-23 18:03:56 -0400] agarson: you are pulling base properly
[2013-09-23 18:04:10 -0400] agarson: Installing chef-varnish (0.0.1) from git: 'https://github.com/inviqa/chef-varnish.git' with branch: 'master' at ref: 'f86b01adf04abb8412b6d2c7f19de6e9bbd6f81d'
[2013-09-23 18:04:13 -0400] agarson: chef-varnish too
[2013-09-23 18:04:46 -0400] fak3r: but it works https://gist.github.com/philcryer/6674453
[2013-09-23 18:04:52 -0400] fak3r: with it commented out :/
[2013-09-23 18:05:23 -0400] agarson: ok, so it could be a dependency of your base cookbook then
[2013-09-23 18:05:33 -0400] agarson: can you gist the metadata.rb for base
[2013-09-23 18:07:21 -0400] fak3r: agarson:  sure, I created this one from scratch (maybe that's it?) https://gist.github.com/philcryer/6674453
[2013-09-23 18:07:38 -0400] agarson: depends 'chef-client::runit_service'
[2013-09-23 18:07:45 -0400] agarson: depends lines should only be for cookbooks, not recipes
[2013-09-23 18:07:49 -0400] stormerider: you dont depend on recipes, yeah
[2013-09-23 18:07:58 -0400] agarson: take out those last 2 depens
[2013-09-23 18:09:28 -0400] stormerider: i'd also rewrite it as "%w{ timezone-ii ntp runit chef-client }.each do |cb|" "depends cb" "end"
[2013-09-23 18:11:27 -0400] fak3r: it uploaded - great, but ya, you might be right, from Chef server webui I get ERROR: undefinded method `close!` for nil:NilClass
[2013-09-23 18:13:12 -0400] broconne: Have a silly ruby/chef question.. But how do I define a variable?  I am doing an "unless defined?" on it and then I want to calculate a value.  but when I go to assign it to a variable, I get an error that the method is undefined.
[2013-09-23 18:13:47 -0400] fak3r: stormerider: ok, trying that too - what is cb?
[2013-09-23 18:14:03 -0400] stormerider: fak3r: short for cookbook
[2013-09-23 18:14:20 -0400] fak3r: ah, cool
[2013-09-23 18:14:42 -0400] stormerider: fak3r: that syntax basically lets you iterate across everything inside the %w{ } block and run "depends <xx>" on it
[2013-09-23 18:15:14 -0400] stormerider: foodcritic prefers that syntax vs repetitive statements
[2013-09-23 18:15:16 -0400] cwj: broconne: gist/pastebin your code?
[2013-09-23 18:15:22 -0400] fak3r: ok, got it
[2013-09-23 18:16:06 -0400] fak3r: so that seems fixed, but now, berks in; berks up runs w/o error - but then if I try to look at that cook book via chef webui it gives me that error
[2013-09-23 18:16:46 -0400] broconne: cwj:  http://pastebin.com/Tag6i7vF
[2013-09-23 18:16:53 -0400] broconne: error I get is "undefiend method 'filename='
[2013-09-23 18:19:39 -0400] fak3r: stormerider: agarson: so berks in/up works without error, I see base in the list, looks good, but it doesn't get to .berkshelf/cookbooks! https://gist.github.com/philcryer/6674453
[2013-09-23 18:20:23 -0400] stormerider: i dont think berks puts them there if you point to a file path?
[2013-09-23 18:20:54 -0400] cwj: broconne: oh when you are working with lwrps like this, i think you might need to do new_resource.filename("#{new_resource.installable}.#{extension})
[2013-09-23 18:21:11 -0400] cwj: because new_resource.filename is actually a method and not a variable
[2013-09-23 18:21:48 -0400] fak3r: stormerider: ok, but then if I try to view it on chef-server webui it's there, but if I try to look at the files in there it tells me ERROR: undefined method `close!` for nil:NilClass
[2013-09-23 18:21:55 -0400] cwj: also assuming you already explicitly defined the filename parameter for your resource
[2013-09-23 18:22:13 -0400] broconne: cwj - testing.
[2013-09-23 18:22:21 -0400] agarson: fak3r:  path specified cookbooks don't get put into the shelf
[2013-09-23 18:22:35 -0400] agarson: because they aren't real versions, so we have no way to uniquely identify them
[2013-09-23 18:23:03 -0400] fak3r: agarson: ok, and again, it made it to chef-server, but I can't view it in the webui, get an error - trying to bootstrap with it and see if it iinstalls ntp and other things....
[2013-09-23 18:23:07 -0400] broconne: cwj - same error (oddly)...
[2013-09-23 18:23:23 -0400] agarson: fak3r:  you shouldn't be uploading from a path: source
[2013-09-23 18:23:26 -0400] agarson: its bad form
[2013-09-23 18:23:35 -0400] cwj: broconne: and you have defined the filename parameter in your resource description? e.g. resources/mything.rb ?
[2013-09-23 18:24:01 -0400] agarson: path: sources are intended to make changes that span multiple cookbooks easier to develop, you still need to commit/version your dependency independently
[2013-09-23 18:24:13 -0400] broconne: meant to...........  sorry
[2013-09-23 18:24:18 -0400] broconne: testing :-)
[2013-09-23 18:24:27 -0400] tcate: does anyone know of something similar to 'ignore_failure true' but for an entire included recipe?
[2013-09-23 18:25:32 -0400] broconne: course, that throws off the whole defined thing... will try a nil check.. i guess
[2013-09-23 18:25:41 -0400] fak3r: agarson: ok, so I shouldn't use path, should I use - cookbook 'base', git: 'https://..' ?
[2013-09-23 18:26:24 -0400] phnz: Hey guy, quick question, in my "node[:deploy].each do |application, deploy|" how do I override deploy[:revision] ?? I tried with : node.deploy["revision"] = "develop" and deploy.revision = "develop" but i still getting Chef::Exceptions::ImmutableAttributeModification
[2013-09-23 18:26:44 -0400] agarson: fak3r:  you COULD, but i would actually just make my changes and then checkin base, cut a version and uploaded the versioned cookbook to my chef server
[2013-09-23 18:27:15 -0400] agarson: fak3r:  that way, everything is always versioned when it comes to deployments, only ever use unreleased code for local testing
[2013-09-23 18:28:10 -0400] fak3r: agarson: but I'd still have to call it out in the berkfile, and that's where it's failing, right?
[2013-09-23 18:28:35 -0400] agarson: what is failing? reading the Berksfile on the Chef UI?
[2013-09-23 18:28:58 -0400] fak3r: agarson: so far that's the only issue, yes
[2013-09-23 18:29:06 -0400] fak3r: agarson: doing a new bootstrap now to test
[2013-09-23 18:29:18 -0400] agarson: ok, chef server should completely ignore that file, it knows nothing of berkshelf
[2013-09-23 18:29:58 -0400] fak3r: sure, but I thought Berks would upload 'base' to chef-server? how else will knife know about recipe[base]?
[2013-09-23 18:30:12 -0400] agarson: it may not upload path: sources
[2013-09-23 18:30:18 -0400] agarson: fak3r:  i'll be back in a bit, meeting
[2013-09-23 18:30:24 -0400] fak3r: ag
[2013-09-23 18:30:29 -0400] fak3r: agarson: np, appreciate the help
[2013-09-23 18:32:21 -0400] dgarstang2: So... anyone got any links to anywhere that recommends best ways to have jenkins deploy cookbooks? Lots of issues. Eg.. you have cookbooks A,B,C. C depens  on A and B... you commit ot C first.. which means that the dependancies when building C aren't there yet, and so on and so on.
[2013-09-23 18:36:28 -0400] james_morrin: Are there any good sources for best practices for distributing secret keys for databags to clients?
[2013-09-23 18:38:01 -0400] chris613: How do I do a knife search to find nodes that run a particular cookbook even if it does so via include_recipe?
[2013-09-23 18:38:43 -0400] chris613: I swear I used to do this by searching on "recipes:" but I'm only seeing things that appear in the expanded run_list, not the entire include chain
[2013-09-23 18:40:32 -0400] ssd7: chris613: Unfortunately, I don't think you can currently search for recipes included via include_recipe
[2013-09-23 18:41:12 -0400] chris613: ssd7: Darn, I was afraid of that answer!
[2013-09-23 18:41:28 -0400] renchap: as they are not inserted into the runlist, i dont think you can
[2013-09-23 18:41:39 -0400] renchap: but you can have the recipe set an attribute, and search for this attribute ?
[2013-09-23 18:41:43 -0400] chris613: I'm realizing the only time I managed to do this was via inspecting run_context[:seen_recipes] on the current node
[2013-09-23 18:41:58 -0400] chris613: renchap: That's what we do in most cases. An override-level "HERE I AM!" attribute
[2013-09-23 18:42:41 -0400] ssd7: chris613: https://tickets.opscode.com/browse/CHEF-1977 <- bug on this issue.
[2013-09-23 18:43:49 -0400] agarson: dgarstang2:  when we build cookbooks, we don't have the build jobs link to each other, if you commit C, only C gets built, it pulls in the available version of A and BIf C is bumping a dependency of A or B, those should have already been committed and built
[2013-09-23 18:44:54 -0400] agarson: you have to handle ordering the first time around, but then you should be good
[2013-09-23 18:49:48 -0400] cap10morgan: Can someone remind what the difference is between `execute "foo" do command ""; action :run end` and `execute "foo" do command ""; action :nothing end.run_action(:run)` ?
[2013-09-23 19:01:51 -0400] btm: @opscode chef/ohai code review; join: https://plus.google.com/hangouts/_/bab309f34b54323bfa76aa9751a44937098d2c38, watch: http://youtu.be/UgRO23sLORc
[2013-09-23 19:09:34 -0400] heffergm: register heffergm
[2013-09-23 19:11:01 -0400] agarson: cap10morgan:  the first runs at runtime, the second runs at compile time
[2013-09-23 19:11:49 -0400] dgarstang2: agarson: so, the person doing the commits has to know what dependancies a cookbook has, and make sure to do those first?
[2013-09-23 19:12:11 -0400] agarson: dgarstang2:  only if they are bumping dependency versions, in which case they already know
[2013-09-23 19:14:43 -0400] dgarstang2: agarson: not sure it's so obvious. at the moment, we're only pinning version numbers on upstream cookbooks not our own
[2013-09-23 19:15:13 -0400] agarson: dgarstang2:  then how will you ever know what you are deploying?
[2013-09-23 19:15:51 -0400] dgarstang2: agarson: I make a change to bc-apt, bump the metadata, and in the base:role, he grabs latest version of bc-apt (which was just committed) to git.
[2013-09-23 19:16:14 -0400] mindlace: why do I want to use encrypted data bags? Is it just to keep plaintext credentials out of my chef-repo?
[2013-09-23 19:16:51 -0400] agarson: ok, that scales to about 3 developers working on cookbooks, after that, you risk somebody pushing in a breaking change to a cookbook right before a deploy, and then you pull the bad version into a live environment
[2013-09-23 19:17:36 -0400] dgarstang2: agarson: by developers, I assume you mean Ops people. Well, we got about 3 of those. :)
[2013-09-23 19:19:05 -0400] cap10morgan: agarson: OK, makes sense. thanks.
[2013-09-23 19:19:10 -0400] agarson: no, i mean developers, cookbooks are software, if you are developing a cookbook then you are a cookbook developer
[2013-09-23 19:19:19 -0400] agarson: it doesn't matter what your title says
[2013-09-23 19:19:49 -0400] phnz: Someone can give me a quick help about this ? https://gist.github.com/DavidLemarier/6a75d46898294d9741a8
[2013-09-23 19:23:09 -0400] jchauncey: dgarstang2: im a developer (i know nothing of sys admin duties) yet i write cookbooks
[2013-09-23 19:24:02 -0400] dgarstang2: jchauncey: I'm an ops person (i know nothing of software development) yet I write cookbooks :)
[2013-09-23 19:24:09 -0400] jchauncey: exactly which is a good thing =)
[2013-09-23 19:24:26 -0400] jchauncey: i think auto versioning cookbooks could be a bad thing though
[2013-09-23 19:24:31 -0400] dgarstang2: jchauncey: i'd never call myself a software developer tho
[2013-09-23 19:24:58 -0400] jesseadams: Anyone ever experience random 403 errors with open source chef-server? They seem to be thrown randomly when getting templates. After a number of runs, it finally gets through a full initial run.
[2013-09-23 19:25:00 -0400] adamjk-dev: lol
[2013-09-23 19:25:07 -0400] agarson: jchauncey:  why do you think its bad? we've had great success with auto-verioning cookbooks
[2013-09-23 19:25:25 -0400] adnichols: jesseadams I've seen it be less random - where this will happen after a long run, like 20 minutes or so
[2013-09-23 19:25:30 -0400] adnichols: jesseadams and then works on subsequent runs
[2013-09-23 19:25:41 -0400] jesseadams: adnichols: was there a fix?
[2013-09-23 19:25:52 -0400] adnichols: jesseadams There's an open issue on it - no fix afaik
[2013-09-23 19:26:04 -0400] jesseadams: ahh OK thanks :/
[2013-09-23 19:26:17 -0400] adnichols: jesseadams https://tickets.opscode.com/browse/CHEF-4253
[2013-09-23 19:26:39 -0400] adnichols: jesseadams the proposed "fix" that issue didn't fix it for me - but maybe you'll have better luck
[2013-09-23 19:27:30 -0400] jesseadams: adnichols: beautiful thank you.
[2013-09-23 19:29:04 -0400] jchauncey: agarson: i should back up, if you are not specifying versions in your metadata.rb you might have a bad time
[2013-09-23 19:29:30 -0400] jchauncey: other than that you probably would never have any issues
[2013-09-23 19:30:00 -0400] agarson: jchauncey:  yes, i agree 110%
[2013-09-23 19:30:12 -0400] jchauncey: but if cookbook development is happening across multiple teams then you could get in a state where you are not aware of what version of a cookbook is being run on a particular node (if its using cron to run chef-client on a specific interval)
[2013-09-23 19:31:27 -0400] dgarstang2: So, if I wanted berkshelf to get a specific git rev... aw man, does that mean I'd need to tag every single commit?
[2013-09-23 19:31:38 -0400] jchauncey: but then ive seen issues with hardcoding versions in the metadata.rb where an application cookbook did not specify a version but one of its dependent cookbooks did (an older one)
[2013-09-23 19:31:57 -0400] jchauncey: dgarstang2: cant use specify a git sha?
[2013-09-23 19:32:05 -0400] agarson: dgarstang2:  you can use a sha
[2013-09-23 19:32:07 -0400] dgarstang2: jchauncey: I dunno.
[2013-09-23 19:32:10 -0400] jchauncey: *cant you use a specific git sha*
[2013-09-23 19:32:14 -0400] dgarstang2: agarson: eg?
[2013-09-23 19:32:17 -0400] agarson: but, we actually wrote a tool for auto tagging with semver numbers
[2013-09-23 19:32:21 -0400] jchauncey: d3ag45 or whatever
[2013-09-23 19:32:32 -0400] dgarstang2: jchauncey: but, syntax?
[2013-09-23 19:32:39 -0400] jchauncey: oh =)
[2013-09-23 19:32:43 -0400] dgarstang2: don't see it documented at http://berkshelf.com
[2013-09-23 19:32:46 -0400] agarson: dgarstang2:  An optional ref key can be specified for the exact SHA-1 commit ID to use and exact revision of the desired cookbook.
[2013-09-23 19:32:48 -0400] agarson: from berkshelf.com
[2013-09-23 19:33:06 -0400] agarson: under Git Location
[2013-09-23 19:33:21 -0400] dgarstang2: agarson: that's gonna be terribly confusing.
[2013-09-23 19:33:24 -0400] agarson: but, we use this https://github.com/riotgames/thor-scmversion
[2013-09-23 19:33:25 -0400] jchauncey: cookbook mysql, git: https://github.com/opscode-cookbooks/mysql.git, ref: eef7e65806e7ff3bdbe148e27c447ef4a8bc3881
[2013-09-23 19:33:36 -0400] jchauncey: ref is the sha
[2013-09-23 19:33:45 -0400] agarson: we actually tag every single commit on our cookbooks
[2013-09-23 19:34:10 -0400] dgarstang2: agarson: unless I put that in a hook or something, it's gonne be painful to do that
[2013-09-23 19:34:22 -0400] agarson: it follows semver, default is to bump patch on a commit, but you can also bump minor/major
[2013-09-23 19:34:57 -0400] agarson: dgarstang2:  we use thor-scmversion on our build servers, all of our cookbook jobs are built off of the same build template, it handles the versioning
[2013-09-23 19:35:06 -0400] dgarstang2: *sigh*
[2013-09-23 19:35:15 -0400] agarson: you commit, jenkins pulls head, then pushes a tag against the ref
[2013-09-23 19:35:16 -0400] dgarstang2: neverending burrow of fu
[2013-09-23 19:35:20 -0400] agarson: :)
[2013-09-23 19:35:26 -0400] dgarstang2: fu on top of more fu
[2013-09-23 19:36:49 -0400] agarson: dgarstang2:  the trick is to figure out what works for you, i'm only telling you what we do at riot, if it doesn't make sense for you or it feels like too much abstraction, just do waht makes sense for your case
[2013-09-23 19:37:23 -0400] dgarstang2: agarson: I don't know what will work for us
[2013-09-23 19:38:26 -0400] bean: agarson: idk if you know any of the guys who were at the StrangeLoop party in St Louis from Riot on Thursday night, but having an area set up with LCS on TVs and computers to play league was an awesome touch
[2013-09-23 19:39:07 -0400] agarson: bean:  our event guys do an awesome job
[2013-09-23 19:39:13 -0400] bean: yeah, it was a sick party.
[2013-09-23 19:39:19 -0400] agarson: but i'll pass along the sentiment
[2013-09-23 19:41:27 -0400] dgarstang2: In my metadata.rb, I have 'cron', '1.2.6' and in the Berksfile site :opscode. How is cron being grabbed? What does 'site :opscode' mean?
[2013-09-23 19:41:57 -0400] agarson: site :opscode means to look at the opscode community site to find dependencies
[2013-09-23 19:42:19 -0400] dgarstang2: agarson: via what protocol? What I'm getting at is that the version number works there...
[2013-09-23 19:42:28 -0400] agarson: https i believe
[2013-09-23 19:42:44 -0400] dgarstang2: agarson: argh, which doesn't work for our gitlab imple
[2013-09-23 19:42:48 -0400] agarson: version # and the name get encoded into a url
[2013-09-23 19:42:55 -0400] agarson: no no
[2013-09-23 19:43:06 -0400] agarson: if you specify a git source, it will ignore the site: opscode
[2013-09-23 19:43:18 -0400] agarson: so, every single "cookbook" line gets a source
[2013-09-23 19:43:27 -0400] agarson: if you don't specify a source, it'll use the "sites" that you specify
[2013-09-23 19:43:31 -0400] bluepojo: sources are for cookbooks without an explicit source
[2013-09-23 19:43:35 -0400] agarson: path: git: github: are all sources
[2013-09-23 19:44:12 -0400] dgarstang2: lost
[2013-09-23 19:44:25 -0400] agarson: ok
[2013-09-23 19:44:40 -0400] agarson: berkshelf's purpose (amongst other things) is to collect all of your dependencies for you
[2013-09-23 19:44:51 -0400] dgarstang2: yep
[2013-09-23 19:44:56 -0400] agarson: when you call out a "cookbook" dependency in your berksfile, you are saying that you need a cookbook
[2013-09-23 19:45:03 -0400] agarson: you can also tell it where to get it from
[2013-09-23 19:45:12 -0400] agarson: actually, you MUST also tell it where to get it from
[2013-09-23 19:45:12 -0400] dgarstang2: got all that.
[2013-09-23 19:45:26 -0400] agarson: if you speficy "git", "github", "path" then you are giving it an explicit source
[2013-09-23 19:45:40 -0400] agarson: if you don't use one of those, then it will look at the "sites" and use those as default sources
[2013-09-23 19:45:53 -0400] dgarstang2: if I set a version number in cookbook A as 1.0, it should be as easy as specifying the same thing in the cookbook that requires it
[2013-09-23 19:46:04 -0400] agarson: so, if you say "site :opscode" at the top, then anything that isn't a "git", "path" or "github" will come from the opscode community site
[2013-09-23 19:46:12 -0400] dgarstang2: not a 32 digit sha
[2013-09-23 19:46:18 -0400] agarson: absolutely
[2013-09-23 19:46:25 -0400] dgarstang2: agarson: seems that's not possible
[2013-09-23 19:46:33 -0400] agarson: you only need the sha if you are trying to pull a SPECIFIC commit from github without a tag
[2013-09-23 19:46:42 -0400] agarson: so, you have a couple of choices
[2013-09-23 19:46:48 -0400] dgarstang2: agarson: or tagging every commit. :)
[2013-09-23 19:46:57 -0400] dgarstang2: there's enough process already involved here.
[2013-09-23 19:46:58 -0400] agarson: 1. build that particular SHA, give it a version, and upload it to an internal chef server
[2013-09-23 19:47:10 -0400] agarson: 2. give every commit a tag and pull from github
[2013-09-23 19:47:15 -0400] agarson: i would go with 1
[2013-09-23 19:47:19 -0400] dgarstang2: agarson: hang on... where 'getting cookbooks from git, not chef
[2013-09-23 19:47:25 -0400] agarson: actually, you have to do 1
[2013-09-23 19:47:32 -0400] agarson: because the chef server will only know what is inside it
[2013-09-23 19:48:02 -0400] dgarstang2: agarson: yes, but the cookbook requiring the new version number can't go 'bc-apt', '1.0.0' if I use git
[2013-09-23 19:48:05 -0400] agarson: berkshelf is a DEVELOPMENT tool,  it makes it easy to get cookbooks from multiple places, but in production they ALL have to come from the chef server that you node is bootstrapped into
[2013-09-23 19:48:32 -0400] agarson: dgarstang2:  correct, so you have to give it a unique version number and do a berks upload to get it into your server
[2013-09-23 19:48:47 -0400] dgarstang2: agarson: except I can't do 'bc-apt', '1.0.0'
[2013-09-23 19:48:53 -0400] agarson: why not?
[2013-09-23 19:49:07 -0400] dgarstang2: how does berksfile know that the specified git path is 1.0.0 ?
[2013-09-23 19:49:14 -0400] agarson: it doesn't
[2013-09-23 19:49:19 -0400] agarson: you are conflating 2 concepts
[2013-09-23 19:49:36 -0400] agarson: if you want to say "bc-apt", "1.0.0" then you MUST upload the cookbook to your chef server
[2013-09-23 19:49:41 -0400] josephholsten: dgarstang2: howdy! have you duplicated yourself?
[2013-09-23 19:49:58 -0400] agarson: otherwise, you MUST specify either a SHA or a Branch or a Tag
[2013-09-23 19:50:04 -0400] agarson: if you are pulling from git
[2013-09-23 19:50:10 -0400] bluepojo: you will get HEAD
[2013-09-23 19:50:12 -0400] bluepojo: if you don't
[2013-09-23 19:50:16 -0400] bluepojo: which is fine for some people
[2013-09-23 19:50:18 -0400] agarson: pulling from git is intended ONLY for development
[2013-09-23 19:50:34 -0400] agarson: you CAN'T do it when you go live
[2013-09-23 19:50:43 -0400] bluepojo: you can, it just subverts the concept of versioning
[2013-09-23 19:50:48 -0400] cwj: adnichols: lmao
[2013-09-23 19:51:14 -0400] dgarstang2: agarson: this is just for jenkins...
[2013-09-23 19:51:51 -0400] dgarstang2: agarson: jenkins will use berkshelf to upload the cookbooks to each chef server...
[2013-09-23 19:51:57 -0400] agarson: thats ok then
[2013-09-23 19:52:00 -0400] stormerider: adnichols: yeah, likewise
[2013-09-23 19:52:22 -0400] dgarstang2: agarson: but we still got the git issue. if berkshelf pulls from head, then the version number is irrelevant
[2013-09-23 19:52:27 -0400] agarson: the problem is that you need to specify versions in metadata.rb to get chef-client to respect them, and you can't do that with a SHA
[2013-09-23 19:52:29 -0400] bluepojo: pulling from git then pushing to a chef server is dangerous as the chef server will read the version number in the metadata.rb
[2013-09-23 19:52:34 -0400] bluepojo: and overwrite whatever is on the chef server
[2013-09-23 19:52:56 -0400] dgarstang2: bluepojo: lost me
[2013-09-23 19:53:08 -0400] bluepojo: say you have a cookbook at version 1.0.0
[2013-09-23 19:53:11 -0400] bluepojo: you push 3 commits to git
[2013-09-23 19:53:17 -0400] bluepojo: metadata.rb still says 1.0.0
[2013-09-23 19:53:23 -0400] josephholsten: bluepojo: berks does freeze when you run berks upload
[2013-09-23 19:53:31 -0400] dgarstang2: bluepojo: you gotta edit and commit metadata.rb. it's part of the process
[2013-09-23 19:53:39 -0400] bluepojo: ah right, we changed that in 2.0
[2013-09-23 19:53:56 -0400] bluepojo: forgot
[2013-09-23 19:54:05 -0400] bluepojo: ok, then
[2013-09-23 19:54:26 -0400] dgarstang2: if .... the git path is head... it's not gonna matter what version it says it needs.
[2013-09-23 19:54:35 -0400] dgarstang2: suppose I could test that
[2013-09-23 19:55:37 -0400] josephholsten: dgarstang2: that sentence has two different meanings depending on whether you're talking about berks or chef-client/server
[2013-09-23 19:55:43 -0400] bluepojo: which is why git source and versions don't really go together
[2013-09-23 19:55:53 -0400] bluepojo: you either pull from git
[2013-09-23 19:55:57 -0400] bluepojo: or you specify a version
[2013-09-23 19:56:16 -0400] bluepojo: by definition, git source specifies a revision level
[2013-09-23 19:56:52 -0400] dgarstang2: bluepojo: well there was a whole slew of similr limitations when I tried to use the chef server as the source
[2013-09-23 19:56:59 -0400] bluepojo: how is that?
[2013-09-23 19:57:06 -0400] josephholsten: while I enjoy dependency resolution theory as much as the next guy, is there a concrete problem?
[2013-09-23 19:57:16 -0400] dgarstang2: bluepojo: dont remember. it was Friday. I'm sure I'll remember soon enough
[2013-09-23 19:57:28 -0400] dgarstang2: josephholsten: best practise
[2013-09-23 19:57:51 -0400] bluepojo: best practice is to depend only on released versions of cookbooks
[2013-09-23 19:58:01 -0400] dgarstang2: bluepojo: defined 'released'
[2013-09-23 19:58:07 -0400] bluepojo: versioned and pushed to your chef server
[2013-09-23 19:58:14 -0400] bluepojo: or community site
[2013-09-23 19:58:19 -0400] bluepojo: or otherwise "released"
[2013-09-23 19:58:21 -0400] dgarstang2: bluepojo: that doesn't say what 'released' means.
[2013-09-23 19:58:33 -0400] bluepojo: that's the whole definition, not sure how else to explain it
[2013-09-23 19:58:43 -0400] dgarstang2: we don't 'release' anything. We're not Microsoft. We put change a cookbook 10 times a day until we get it right.
[2013-09-23 19:59:09 -0400] bluepojo: well... that's probably the root of your problems
[2013-09-23 19:59:12 -0400] jchauncey: dgarstang2: sounds like you need to test your cookbooks
[2013-09-23 19:59:25 -0400] bluepojo: if you aren't versioning releases, your trying to use depedency resolution is kinda silly
[2013-09-23 19:59:44 -0400] bluepojo: don't care if you're microsoft, versioning is critical for dependency resolution to work
[2013-09-23 19:59:51 -0400] dgarstang2: bluepojo/jchauncey: No amount of testing (within reason) is gonna uncover the types of problems that occur when users hit the systems.
[2013-09-23 20:00:14 -0400] dgarstang2: bluepojo: I didn't disagree. I wanted to know what you mean by 'released'.
[2013-09-23 20:00:14 -0400] bluepojo: my experience says that's not true in the general case.
[2013-09-23 20:00:27 -0400] bluepojo: staging environments uncover most issues
[2013-09-23 20:00:28 -0400] dgarstang2: bluepojo: my experience says that is true in the general case.
[2013-09-23 20:00:38 -0400] dgarstang2: anyway
[2013-09-23 20:00:40 -0400] jchauncey: ....
[2013-09-23 20:01:00 -0400] adnichols: jchauncey it's not worth you time
[2013-09-23 20:01:07 -0400] jchauncey: =)
[2013-09-23 20:01:33 -0400] bluepojo: lol
[2013-09-23 20:01:52 -0400] dgarstang2: I just wish someone would write a paper on this or something specifically as it relates to jenkins
[2013-09-23 20:02:34 -0400] josephholsten: dgarstang2: we really don't understand what you're asking
[2013-09-23 20:02:48 -0400] agarson: dgarstang2:  this stuff is all pretty new, the industry as a whole is trying to figure out the "best practices" right now, so there isn't really a paper to write yet
[2013-09-23 20:03:00 -0400] dgarstang2: josephholsten: neither do I. That's why I'd like to see how someone else did it
[2013-09-23 20:04:08 -0400] bluepojo: Don't use git sources when resolving cookbooks to push to a chef server.
[2013-09-23 20:04:09 -0400] bean: dgarstang2: have you looked at test-kitchen?
[2013-09-23 20:04:14 -0400] btm: @opscode cookbook code review, join: https://plus.google.com/hangouts/_/7c79a8c0fda7145584f5da7ea308c62132095bca, watch: http://youtu.be/oIqD4H6swHg
[2013-09-23 20:04:59 -0400] dgarstang2: bean: no, but not at at that stage yet
[2013-09-23 20:05:06 -0400] phnz: Someone can give me a quick help about this ? https://gist.github.com/DavidLemarier/6a75d46898294d9741a8
[2013-09-23 20:05:12 -0400] dgarstang2: bluepojo: so, use what, a chef server instead?
[2013-09-23 20:05:13 -0400] bean: Have you heard the phrase "Test driven development"
[2013-09-23 20:05:14 -0400] bean: heh
[2013-09-23 20:05:28 -0400] dgarstang2: bean: I said I'm not there yet.
[2013-09-23 20:05:45 -0400] adnichols: phnz node.deploy seems wrong
[2013-09-23 20:05:46 -0400] bean: TDD is a starting point imo
[2013-09-23 20:05:48 -0400] bluepojo: dgarstang2: yeah
[2013-09-23 20:05:58 -0400] adnichols: phnz do you mean node['deploy']['revision'] for example?
[2013-09-23 20:06:12 -0400] dgarstang2: bluepojo: you be here in 2 hours when I come back with new issues? :)
[2013-09-23 20:06:27 -0400] josephholsten: how I do it: use community cookbooks, at the most recently released version, as much as possible. if necessary, use a fork until a patch gets released upstream. for internal cookbooks, bump versions religiously (numbers are free). that means every pull request. that way they can always be pushed to the chef-server. then I can always control what environment uses what with cookbook versions.
[2013-09-23 20:06:34 -0400] bluepojo: maybe
[2013-09-23 20:07:02 -0400] phnz: By example i have node[:deploy].each do |application, deploy| --- so by example i want to overwrite deploy[:revision] = develop    where deploy = data of node[:deploy] active key
[2013-09-23 20:07:09 -0400] phnz: SO its not really linked to node this is what i miss
[2013-09-23 20:07:11 -0400] dgarstang2: josephholsten: slightly different context, but thanks. Already doing that
[2013-09-23 20:07:34 -0400] adnichols: phnz try node.override['deploy']['revision'] = ...
[2013-09-23 20:07:53 -0400] adnichols: phnz you have to use the default|normal|override methods to write to node attributes in a recipe
[2013-09-23 20:08:13 -0400] josephholsten: if I have to work on two cookbooks at once: first I yell at myself for introducing tight coupling. then I use berkshelf's path: source to work on both at the same time. but by the time I make my PR for my team to review, I should have removed any non-versionable sources.
[2013-09-23 20:08:30 -0400] bean: ^ +1
[2013-09-23 20:08:37 -0400] phnz: adnichols: but i'm in a loop so I have to update the node attribute anyways ?
[2013-09-23 20:08:47 -0400] josephholsten: dgarstang2: if you're doing that, then you have not concretely defined the context in which you need a best practice.
[2013-09-23 20:09:10 -0400] adnichols: phnz I'm just telling you why you are getting errors about immutable attributes
[2013-09-23 20:09:32 -0400] josephholsten: as far as jenkins is concerned, you always just push master to the chef-server (assuming it passes tests)
[2013-09-23 20:09:43 -0400] dgarstang2: josephholsten: Are you getting your cookbooks on jenkins from git or from a chef server? Do you have a seperate jenkins job for every cookbook?
[2013-09-23 20:09:44 -0400] adnichols: phnz That gist doesn't really tell me what you are trying to accomplish - maybe there's a nother way
[2013-09-23 20:10:15 -0400] dgarstang2: josephholsten: or you you only have jenkins jobs for say, roles, because running berkshelf on those anyway should draw in all the dependant cookbooks
[2013-09-23 20:10:27 -0400] bluepojo: josephholsten is echoing how we do things as well. It's worked well for us for a long time.
[2013-09-23 20:10:46 -0400] dgarstang2: josephholsten: Do you specify versions of your own cookbooks or skip that?
[2013-09-23 20:10:56 -0400] phnz: adnichols: there is the complete recipe https://gist.github.com/DavidLemarier/a3d71a162dd7bbf27c7c
[2013-09-23 20:11:22 -0400] dgarstang2: josephholsten: 'master' ? master for each cookbook? one? all? some subset? dependancies?
[2013-09-23 20:11:25 -0400] josephholsten: dgarstang2: most of our cookbooks are in the same repo, thus share the same job. but the ones we have pulled out get their own jobs
[2013-09-23 20:11:27 -0400] phnz: adnichols: and this is the sample JSON loaded in node https://gist.github.com/DavidLemarier/8e568bd29b2ea71b71a3
[2013-09-23 20:11:49 -0400] dgarstang2: josephholsten: k, cuz we put every cookbook into it's own repo
[2013-09-23 20:12:33 -0400] josephholsten: we only specify versions in our environments, most of the time it's not necessary for inter-cookbook dependencies
[2013-09-23 20:13:14 -0400] josephholsten: dgarstang2: that's good, we're working toward putting everything in its own
[2013-09-23 20:13:50 -0400] dgarstang2: Ok,... so if you don't source cookbooks from git, how do you source control? There's no guarantee anymore that whats on the chef server is what's in git
[2013-09-23 20:14:14 -0400] dgarstang2: josephholsten: agarson said that was bad juju
[2013-09-23 20:15:19 -0400] josephholsten: dgarstang2: what's bad juju?
[2013-09-23 20:15:35 -0400] dgarstang2: josephholsten: Putting dependancies in there without specific version numbers
[2013-09-23 20:15:38 -0400] josephholsten: having separate repos for your cookbooks?
[2013-09-23 20:17:21 -0400] josephholsten: oh, if you actually require specific versions, you should specify it. but having tight coupling between cookbooks will cause you pain.
[2013-09-23 20:17:29 -0400] mobilemike: I'm looking at the Opscode Bluepill cookbook
[2013-09-23 20:17:42 -0400] dgarstang2: josephholsten: That's what agarson said. :-\
[2013-09-23 20:17:54 -0400] mobilemike: There's nothing explicit, but it looks like it doesn't support debian/ubuntu.
[2013-09-23 20:18:03 -0400] mobilemike: Does anyone know if that's correct?
[2013-09-23 20:18:25 -0400] josephholsten: mobilemike: have you tried it?
[2013-09-23 20:18:59 -0400] mobilemike: Yea, or at least, I've tried.
[2013-09-23 20:19:08 -0400] jtimberman: mobilemike: "Bluepill is a pure Ruby service management tool/library, so this cookbook should work on any system. " from the readme
[2013-09-23 20:19:18 -0400] jtimberman: I developed it on ubuntu originally
[2013-09-23 20:19:21 -0400] josephholsten: mobilemike: got any particular errors you've hit?
[2013-09-23 20:19:34 -0400] jtimberman: the test kitchen support covers centos too
[2013-09-23 20:19:38 -0400] jtimberman: https://github.com/opscode-cookbooks/bluepill/blob/master/.kitchen.yml
[2013-09-23 20:19:49 -0400] mobilemike: Hmmm...
[2013-09-23 20:19:57 -0400] mobilemike: I must just be missing something then.
[2013-09-23 20:19:59 -0400] mobilemike: https://github.com/opscode-cookbooks/bluepill/blob/master/providers/service.rb#L40
[2013-09-23 20:20:22 -0400] mobilemike: Seems to only case for non-debian platforms with no fallback
[2013-09-23 20:21:09 -0400] mobilemike: The issues could also be related to bluepill acting as a system service, but I've also got RVM installing Ruby on this box.
[2013-09-23 20:21:13 -0400] mobilemike: So, it's complicated.
[2013-09-23 20:43:18 -0400] dgarstang2: I just ran food critic and got a FC007... but $? = 0... how am I gonna check for errors?
[2013-09-23 20:44:41 -0400] tomsthumb: is there a good cross platform way to detect 32 vs 64 bit machines?
[2013-09-23 20:45:19 -0400] bluepojo: dgarstang2: you can use -f to specify tags that you want to fail the build
[2013-09-23 20:45:41 -0400] bluepojo: not sure if there's a way to make it fail for all the warnings
[2013-09-23 20:46:23 -0400] dgarstang2: bluepojo: Is 'FC007' a tag?
[2013-09-23 20:47:32 -0400] piva: anyone can help me debugging why a recipe is not finding an 'execute' resource? just some tip of how can I find the current 'resource collection' status or other debugging instructions :/
[2013-09-23 20:48:16 -0400] bluepojo: dgarstang2: yeah, though by tag you can also specify things like "style"
[2013-09-23 20:48:28 -0400] bluepojo: FC007 and style are both "tags"
[2013-09-23 20:48:32 -0400] dgarstang2: kk
[2013-09-23 20:48:47 -0400] dgarstang2: bluepojo: tags are listed.... ?
[2013-09-23 20:49:01 -0400] bluepojo: not sure
[2013-09-23 20:49:08 -0400] dgarstang2: hm. I'd call that fu
[2013-09-23 20:49:34 -0400] bluepojo: lol
[2013-09-23 20:49:35 -0400] bluepojo: k
[2013-09-23 20:52:02 -0400] gchristensen: yfeldblum: thank you for the succinct answer to my actual question, instead of posting your dmidecode performance data :D
[2013-09-23 20:52:21 -0400] yfeldblum: gchristensen, :D
[2013-09-23 20:54:05 -0400] tomsthumb: piva: have you already run with `-l debug` ?
[2013-09-23 20:55:14 -0400] piva: tomsthumb: my problem is that I'm running under AWS OpsWorks, I've tried logging into the machine and running it manually with bundle exec only to have some problems with missing gems and JRuby (our stack runs under JRuby), so I'm trying to debug it from inside the recipes, it's a pain in the ass
[2013-09-23 20:56:05 -0400] piva: tomsthumb: what's really strange is that this recipe ran succesfully for weeks and started to get errors about 4 days ago, without us changing any code, so I think that OpsWorks made some changes and broke our deploy recipe :(
[2013-09-23 20:59:17 -0400] tomsthumb: piva: ah, I'm not at all familiar with jruby. i have experienced something similar though with updating gems and such breaking things. snapshotting your gems directory once a month or so is highly recommended
[2013-09-23 21:02:34 -0400] tomsthumb: piva: not that that helps much right now, sorry. I would say write a bunch of asserts about the conditions under which that should execute, and then if they all pass write a bunch of assertions about what should be able to happen once the resource does/would execute, and if they still all pass, then write some more :/
[2013-09-23 21:03:25 -0400] piva: tomsthumb: yup, my problem really is that the execution happens on OpsWorks and I can't find a way to replicate their environment
[2013-09-23 21:17:54 -0400] dgarstang2: I can't get my head around this. One jenkins job per cookbook, or one job per jenkins cookbook that defines a role?
[2013-09-23 21:18:40 -0400] tomsthumb: dgarstang2: why would you define a role inside of a cookbook?
[2013-09-23 21:19:34 -0400] dgarstang2: tomsthumb: so that it can be independantly version controlled.
[2013-09-23 21:20:11 -0400] mingo: Hi, how do I find out the version number of each cookbook that gets loaded during a chef run (assuming I don't have access to the cookbooks source right now)?
[2013-09-23 21:20:54 -0400] mingo: Running `chef-client -ldebug` gives out too much information and fishing for versions in that is not working out.
[2013-09-23 21:24:51 -0400] dgarstang2: meh, no clear direction on the jenkins cookybook thing
[2013-09-23 21:29:42 -0400] mingo: Any thoughts on version numbers
[2013-09-23 21:46:23 -0400] jbz: Can anyone point me to a chef-y method of adding a line to a config file that doesn't just do a blind append?  I swear I saw something recently that let you add config lines with some intelligence :-P
[2013-09-23 21:48:10 -0400] bean: jbz: I tend to use a template
[2013-09-23 21:48:17 -0400] mattjalexander: @jbz was it Chef::Util::FileEdit ?
[2013-09-23 21:48:25 -0400] jbz: mattjalexander: YES I think so
[2013-09-23 21:48:32 -0400] bean: oh man
[2013-09-23 21:48:33 -0400] jbz: bean:  Yeah but I don't have control over what's already there
[2013-09-23 21:48:35 -0400] bean: i hadn't seen that before.
[2013-09-23 21:49:01 -0400] jbz: does that still work in 11.x?
[2013-09-23 21:49:53 -0400] mattjalexander: yep
[2013-09-23 21:50:04 -0400] jbz: ahhh
[2013-09-23 21:50:05 -0400] jbz: thanks
[2013-09-23 21:50:17 -0400] mattjalexander: i've really only used it temporarily while untill prs got merged in
[2013-09-23 21:54:59 -0400] mingo: @jbz you can also use the execute resource with a not_if "grep does_this_exist in_this_file"
[2013-09-23 21:55:17 -0400] jbz: mingo Yep thanks that was what I was trying to avoid lol
[2013-09-23 21:57:33 -0400] mingo: @jbz i think if you cannot use a template in this situation might as well be expressive with the echo >> and grep. I find the FileEdit resource clunky and buggy on the version run.
[2013-09-23 21:57:44 -0400] jbz: mingo: thanks :-)
[2013-09-23 22:03:37 -0400] neh: I'm having a strange problem with the simple iptables cookbook loading old rules that are no longer present in any cookbooks. Is there some way data from the old versions of the cookbook could be cached somewhere? I've deleted all the old versions of the cookbook in question from the server.
[2013-09-23 22:03:45 -0400] dgarstang2: how do I use the tags with foodcritic? What IS a tag in this context?
[2013-09-23 22:07:00 -0400] cob: can I submodule other cookbook repos?
[2013-09-23 22:07:04 -0400] dgarstang2: The foodcritic docs at http://acrmp.github.io/foodcritic/ says this will fail the build if not 'correct'. 'foodcritic -f correctness .'. It shows FC002, but $? =0. That's not gonna fail the build. is FC002 incorrect or correct?
[2013-09-23 22:13:48 -0400] gkarekinian: neh: Check your node's attributes, they probably got saved by some version of the cookbook
[2013-09-23 22:21:25 -0400] dgarstang2: I can't get my head around this. One jenkins job per cookbook, or one job per jenkins cookbook that defines a role?
[2013-09-23 22:21:33 -0400] neh: gkarekinian: you are correct... thank you for the pointer
[2013-09-23 22:21:57 -0400] gkarekinian: No problem, glad to help
[2013-09-23 22:24:16 -0400] bend_: I'm working on an LWRP and having some issues using resources from inside the load_current_resource method. that is, I want to use some other cookbook's resources/providers to do something to check to see the current state of my resource
[2013-09-23 22:30:32 -0400] bend_: it seems to not even run the providers for the resource in load_current_resource, not until after the end of the load_current_resource method.
[2013-09-23 22:34:21 -0400] bend_: def load_current_resource; Chef::Log.info('start of load_current_resource'); ruby_block('stupid example') do; block { Chef::Log.info('why is this after?') }; action(:nothing); end.run_action(:create); Chef::Log.info('end of load_current_resource'); end
[2013-09-23 22:39:14 -0400] bend_: I'll ask again tomorrow. time to go home
[2013-09-23 22:51:21 -0400] dgarstang2: I can't get my head around this. One jenkins job per cookbook, or one job per jenkins cookbook that defines a role?
[2013-09-23 22:55:03 -0400] bluepojo: one per cookbook
[2013-09-23 22:55:09 -0400] bluepojo: cookbooks and roles are not coupled
[2013-09-23 23:12:10 -0400] dgarstang2: My chef log is showing the following but it still mounted. What's up with that? '* mount[/mnt] action umount[2013-09-23T23:10:55+00:00] INFO: Processing mount[/mnt] action umount (bc-lvm::default line 25)'
[2013-09-23 23:49:19 -0400] dgarstang2: I can't get my head around this. One jenkins job per cookbook, or one job per jenkins cookbook that defines a role?
