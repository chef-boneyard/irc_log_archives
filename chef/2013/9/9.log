[2013-09-09 07:20:22 -0400] ribo: Guest who lingers too long becomes stale like unused fish. - Charlie Chan
[2013-09-09 07:24:37 -0400] ocholetras: You mean  a null guest
[2013-09-09 07:25:01 -0400] ocholetras: i.e.  not an expert one
[2013-09-09 07:25:03 -0400] ocholetras: ^^
[2013-09-09 07:59:50 -0400] remil: has the --fork option been removed from newer release of chef 10.12 ?
[2013-09-09 08:01:58 -0400] remil: my bad, introduced in 10.14, sorry for the dumb question
[2013-09-09 08:02:09 -0400] ocholetras: ^^
[2013-09-09 08:53:19 -0400] s2r2: good morning
[2013-09-09 09:20:04 -0400] arussel: I know how to provision a vbox  using knife bootstrap localhost. How do I do this with 2 vbox running on my machine ?
[2013-09-09 09:21:15 -0400] s2r2: arussel: knife bootstrap will login via SSH... so if you can access your vboxen using SSH you should be ready to go.
[2013-09-09 09:21:34 -0400] s2r2: the "localhost" in "knife bootstrap localhost" means "SSH to the machine localhost", nothing more specific
[2013-09-09 09:22:18 -0400] arussel: nice, so I just need to setup vagrant to use different ssh port.
[2013-09-09 09:22:21 -0400] arussel: s2r2: thanks
[2013-09-09 09:22:47 -0400] s2r2: if you use vagrant, just using its provisioner support is probably the smoothest way
[2013-09-09 09:27:15 -0400] arussel: sure, I'm just trying to figure out how everythign is working. knife ... --ssh-port 2222 is working, but I don't see config.ssh.guest_port in the vagrant file downloaded with the starter kit.
[2013-09-09 09:28:09 -0400] arussel: why the vbox acccept ssh connections via port 2222 ? in the doc, it says 4567 (http://docs.vagrantup.com/v2/vagrantfile/ssh_settings.html)
[2013-09-09 09:28:55 -0400] s2r2: arussel: probably the Vagrantfile overrode that? search for 2222 in it
[2013-09-09 09:35:54 -0400] irr: Ohai Chefs. What's the current best practice to define environment-specific attributes? For example I have an myapp-cookbook(rails, nginx, mysql, etc.) and myapp-role with run_list[:myapp-cookbook] in production. And I need to re-define some attributes for testing env (for example mysql[: innodb_buffer_pool_size] and nginx[:max_file_size]). Where should I do it: roles, envs, recipes?
[2013-09-09 09:36:29 -0400] arussel: vagrant do port collision detection and move from 22 to 2222 if 22 is already taken.
[2013-09-09 09:37:34 -0400] irr: They say we should not put any attributes in roles, only run_list. So should I create per-env recipe?
[2013-09-09 10:23:59 -0400] s2r2: hmm. changing the chef-server recipe's tunables (such as rabbitmq's node_port) doesn't restart the services (rabbitmq).  hmmm..
[2013-09-09 10:27:37 -0400] s2r2: oh, it's chef-server-ctl reconfigure that doesn't restart rabbitmq
[2013-09-09 11:45:45 -0400] ocholetras: hey guys
[2013-09-09 11:46:04 -0400] ocholetras: is there any way to execute chef-client in some like "ask before apply" mode?
[2013-09-09 11:46:30 -0400] flaccid: ask before applying what?
[2013-09-09 11:46:42 -0400] ocholetras: a template to a config file for example
[2013-09-09 11:47:07 -0400] ocholetras: in order to see if it is rendering the template in the right way for the node
[2013-09-09 11:47:26 -0400] flaccid: what do you mean by 'rednering the template in the right way'?
[2013-09-09 11:47:57 -0400] ocholetras: for example a shorewall rules file
[2013-09-09 11:48:16 -0400] ocholetras: just in order to review the changes that are going to be happen before they actually happens
[2013-09-09 11:48:30 -0400] flaccid: oh, no chef isn't interactive
[2013-09-09 11:49:01 -0400] ocholetras: so you better do the right changes, before you run the client
[2013-09-09 11:49:04 -0400] ocholetras: or use whyrun
[2013-09-09 11:49:13 -0400] ocholetras: right?
[2013-09-09 11:49:24 -0400] flaccid: pretty much
[2013-09-09 11:49:46 -0400] mveitas: or have an additional environment that mirrors your production if it is that important
[2013-09-09 11:50:00 -0400] flaccid: that would be staging
[2013-09-09 12:00:27 -0400] arussel: how can I know the ip of a node inside a cookbook ?
[2013-09-09 12:01:55 -0400] cpasmoi: arussel, node[:ipaddress]
[2013-09-09 12:02:12 -0400] cpasmoi: use ohai on the node when not sure
[2013-09-09 12:02:39 -0400] arussel: cpasmoi: thanks
[2013-09-09 12:04:16 -0400] ocholetras: We are coming from bcfg2 where you define exactly what packages should be on the machine, with a common base install plus the ones on the services etc..
[2013-09-09 12:04:57 -0400] ocholetras: afaik chef only cares about what you say it to install and nothing about what is insatlled allready, am i right?
[2013-09-09 12:06:49 -0400] s2r2: yes.  However, you may state that you want packages not to be installed.
[2013-09-09 12:07:02 -0400] ocholetras: okay
[2013-09-09 12:07:16 -0400] ocholetras: so i have to say what packages i dont want to be insatlled on the node
[2013-09-09 12:07:37 -0400] s2r2: you don't have to... but you may
[2013-09-09 12:07:42 -0400] ocholetras: Yea
[2013-09-09 12:08:04 -0400] ocholetras: im thinking if it is necesary to have such a control over the packages on the system.. or not..
[2013-09-09 12:08:13 -0400] s2r2: chef will bring the machine in the state you specify, but only those resources you do indeed specify.
[2013-09-09 12:10:47 -0400] sefakoc: hi everyone
[2013-09-09 12:10:58 -0400] sefakoc: I am new in chef
[2013-09-09 12:11:29 -0400] sefakoc: I installed chef server and workstation, however I couldn't connect to webui
[2013-09-09 12:11:52 -0400] sefakoc: I have tested the chef server, nothing is wrong
[2013-09-09 12:12:09 -0400] sefakoc: what may it be the rpbolem
[2013-09-09 12:30:05 -0400] arussel: I'm using bash to download a file with curl, passing username/password to it. How can I externalise username/password ?
[2013-09-09 12:37:03 -0400] cpasmoi: arussel, why don't you use a file block ?
[2013-09-09 12:38:14 -0400] cpasmoi: http://docs.opscode.com/resource_remote_file.html
[2013-09-09 12:39:48 -0400] arussel: I don't see how to pass header and username/password to the get request
[2013-09-09 12:40:13 -0400] arussel: cpasmoi: ^
[2013-09-09 12:44:39 -0400] cpasmoi: indeed. I guess you can template your bash script and use variable with @params for the user / password
[2013-09-09 12:45:33 -0400] cpasmoi: the user / passwd should be attributes, from role or cookbook for instance
[2013-09-09 12:48:02 -0400] arussel: is this still valid: http://jtimberman.housepub.org/blog/2011/08/06/encrypted-data-bag-for-postfix-sasl-authentication/ , it would be nice to not have clear text password.
[2013-09-09 13:00:39 -0400] xhae: Hi! I'm using the opscode postfix cookbook, which claims auto-configuration of clients using search, but it doesn't seem to use the value it finds. Am I missing something?
[2013-09-09 13:06:00 -0400] ribo: Ancient ancestor once say, "As mind is fed with silent thought, so should body absorb its food." - Charlie Chan
[2013-09-09 13:10:15 -0400] xhae: atomic-penguin: https://github.com/opscode-cookbooks/postfix/pull/41 - I don't have a CLA so my pullreq won't be merged, I guess, but I fixed a thing
[2013-09-09 13:12:38 -0400] arussel: if i understand, the data bag secret file (the random stuff) needs to be put on all the host that need to decrypted the items. What is the 'normal' way to do this ?
[2013-09-09 13:12:52 -0400] atomic-penguin: xhae, if you can't get a CLA signed just close your PR and I'll submit one
[2013-09-09 13:13:14 -0400] xhae: atomic-penguin: thanks
[2013-09-09 13:21:01 -0400] adnichols: arussel normally you place your data bag secrets file on the box during bootstrap or do it manually at some point - the bootstrap command supports putting it in place
[2013-09-09 13:35:43 -0400] Nadaron: anyone know how to insert a newline into the content of a file resource?
[2013-09-09 14:00:33 -0400] railsraider: anyone knows why or how to change application_ruby to deploy using timestamp instead of revision number ?
[2013-09-09 14:22:46 -0400] MugsyMalone: hello
[2013-09-09 14:23:01 -0400] MugsyMalone: having a bizarre test kitchen issue, if anyone feels like helping :)
[2013-09-09 14:26:48 -0400] nicgrayson:  MugsyMalone what's going on?
[2013-09-09 14:29:52 -0400] eherot: How do I completely disable a resource from inside a wrapper cookbook?
[2013-09-09 14:30:35 -0400] eherot: t = resources(:template => "my_template"); t.action :nothing # doesn't seem to work
[2013-09-09 14:34:38 -0400] tabolario: eherot: i'm also interested in the answer to that :)
[2013-09-09 14:35:19 -0400] eherot: tabolario: doh!  the logstash agent and server recipes both try to run their own logrotate_app resources, and they conflict.
[2013-09-09 14:35:49 -0400] eherot: i'm thinking I might just try to override the name or the source so as to make them useless.
[2013-09-09 14:35:54 -0400] simonvc: Hey quick question to you guys, is there anyway from with-in a recipe to get the differences from this node as compared to the node before chef ran? its for a reporting script that notifies on a run..
[2013-09-09 14:36:59 -0400] tabolario: eherot: which logstash cookbook are you using?
[2013-09-09 14:37:28 -0400] eherot: simonvc: you might want to take a look at this: https://github.com/kisoku/chef-handler-mail it will send emails with reports about what's changed (if you ask it to do so)
[2013-09-09 14:37:32 -0400] eherot: tabolario: lusis'
[2013-09-09 14:37:42 -0400] tabolario: ah ok me too
[2013-09-09 14:37:52 -0400] simonvc: eherot: Thanks
[2013-09-09 14:39:50 -0400] tabolario: eherot: i'm trying to figure out a good way to inject the correct logstash rules on each host. i think i'm going to do something similar to logstash where each node gets its roles added as subscribers, which will then loop over the logstash_agent_{inputs|outputs|filters|} data bags and pick the items that have a :subscriber key that matches one of the node's roles
[2013-09-09 14:40:08 -0400] ichilton: If I disable the nginx service using chef, it's creating /etc/rc2.d/K80nginx - any way to stop that?
[2013-09-09 14:40:17 -0400] ichilton: I want to disable it with init so I can enable it with upstart....
[2013-09-09 14:42:49 -0400] bkvanmeter: Anyone here have experience with the  "knife server bootstrap ec2" commands?
[2013-09-09 14:42:56 -0400] eherot: bkvanmeter: much
[2013-09-09 14:43:06 -0400] eherot: tabolario: the age-old question of the right way to build a cluster with chef
[2013-09-09 14:44:23 -0400] bkvanmeter: eherot: From my understanding I can use the commands provided by this knife plugin to bootstrap an ec2 chefserver instance without having a chefserver already configured, is this correct?
[2013-09-09 14:45:02 -0400] eherot: bkvanmeter: only if you want to bootstrap chef solo
[2013-09-09 14:45:20 -0400] eherot: you might be able to do it otherwise but I've never tried it
[2013-09-09 14:46:03 -0400] eherot: bkvanmeter: also are you actually talking about "knife bootstrap?"
[2013-09-09 14:46:09 -0400] eherot: or "knife ec2 server create" ?
[2013-09-09 14:46:33 -0400] bkvanmeter: eherot: The plugin provided within this repo: https://github.com/fnichol/knife-server
[2013-09-09 14:46:56 -0400] eherot: ohhhhh
[2013-09-09 14:46:59 -0400] eherot: just kidding I haven't used it ;-
[2013-09-09 14:47:00 -0400] eherot: )
[2013-09-09 14:47:31 -0400] eherot: yet another set of bootstrap commands for ec2 eh?
[2013-09-09 14:47:52 -0400] bkvanmeter: I suppose ha
[2013-09-09 14:48:25 -0400] eherot: I'm using the knife-ec2 plugin which does pretty much the same thing
[2013-09-09 14:48:44 -0400] eherot: looks like that is a dependency of this gem
[2013-09-09 14:49:38 -0400] bkvanmeter: So what method would you recommend to create an ec2 instance running chef open source server?
[2013-09-09 14:51:09 -0400] eherot: bkvanmeter: what platform?
[2013-09-09 14:51:21 -0400] bkvanmeter: ubuntu 12.04 lts
[2013-09-09 14:51:43 -0400] eherot: use the deb package: http://www.opscode.com/chef/install/
[2013-09-09 14:52:08 -0400] bkvanmeter: Okay thanks
[2013-09-09 14:52:23 -0400] tabolario: i still like using chef-solo for that with the chef-server cookbook (which uses the deb package eherot mentioned)
[2013-09-09 14:52:49 -0400] eherot: tabolario/bkvanmeter: yeah I've heard that method is pretty good too
[2013-09-09 14:53:08 -0400] tabolario: especially since you want chef server to manage chef server with chef ;)
[2013-09-09 14:53:27 -0400] bkvanmeter: Haha exactly, I would like to automate as much as possible
[2013-09-09 14:53:27 -0400] eherot: tabolario: you'd think the deb package would set that up automagically ;-)
[2013-09-09 14:54:09 -0400] tabolario: using chef solo to set up chef server is pretty meta since the deb package uses chef solo internally to configure itself
[2013-09-09 14:54:39 -0400] eherot: that's a bit mind-blowing.
[2013-09-09 14:55:00 -0400] bkvanmeter: That's why I headed to irc lol
[2013-09-09 14:55:09 -0400] tabolario: i love omnibus
[2013-09-09 14:57:26 -0400] ichilton: Have a recipe which is installing the nginx package, then checking /etc/rc2.d/S??nginx to see if it exists - it doesn't, but then if I run the provision again, it does - any ideas why?
[2013-09-09 14:57:40 -0400] ichilton: It's as if the package is installed in the background while the chef run continues or something ??
[2013-09-09 14:58:06 -0400] eherot: tabolario: yeah it's pretty hard to go wrong with that.  Also made it really easy to script an update to like 100 servers.
[2013-09-09 14:58:06 -0400] eherot: and it does downgrades too
[2013-09-09 14:58:26 -0400] adnichols: ichilton are you sure the package install completes before that check occurs?
[2013-09-09 14:58:40 -0400] ichilton: adnichols: how do I do that?
[2013-09-09 14:58:51 -0400] adnichols: Assuming the /etc/rc2.d check comes after the package install in the recipe?
[2013-09-09 14:58:53 -0400] tabolario: eherot: i still need to get on 11.6
[2013-09-09 14:58:57 -0400] ichilton: adnichols: yes
[2013-09-09 14:59:17 -0400] adnichols: ichilton you should be able to look at the output from the run to see what order things are occurring in
[2013-09-09 15:00:03 -0400] eherot: tabolario: what are you on now?
[2013-09-09 15:00:03 -0400] railsraider: hi anyone was able to change deploy strategy on application coobook?
[2013-09-09 15:00:09 -0400] railsraider: i need timestamp deploy
[2013-09-09 15:00:49 -0400] ichilton: adnichols: This is what I have: https://github.com/ichilton/chef-nginx-web-server
[2013-09-09 15:01:01 -0400] tabolario: eherot: the server is on 11.4, new instances are coming up with 11.6, older ones are still on 11.4
[2013-09-09 15:01:19 -0400] ichilton: adnichols: i'm trying to stop the service and remove the init stuff so I can start it with upstart
[2013-09-09 15:01:35 -0400] ichilton: adnichols: can you see anything obvious?
[2013-09-09 15:02:53 -0400] adnichols: yeah, that if block is ruby and will be executed earlier than any of your resources
[2013-09-09 15:03:02 -0400] ichilton: aha!
[2013-09-09 15:03:14 -0400] eherot: tabolario: that doesn't seem like it would be that big of a shift
[2013-09-09 15:03:18 -0400] ichilton: ruby is executed at compile time?
[2013-09-09 15:03:23 -0400] tabolario: nah shouldn't be
[2013-09-09 15:03:40 -0400] ichilton: adnichols: how do I fix that then? :)
[2013-09-09 15:03:42 -0400] adnichols: You could add an only_if to the service resource
[2013-09-09 15:04:03 -0400] ichilton: adnichols: and the same to the execute?
[2013-09-09 15:04:11 -0400] adnichols: yeah
[2013-09-09 15:04:23 -0400] ichilton: and can that only_if be ruby?
[2013-09-09 15:04:27 -0400] ichilton: i.e only_if Dir.glob('/etc/rc2.d/S??nginx').count > 0
[2013-09-09 15:04:35 -0400] adnichols: think so
[2013-09-09 15:05:15 -0400] ichilton: adnichols: thanks - running that now :)
[2013-09-09 15:05:18 -0400] adnichols: you may still get an error tho because that ruby may still get evaluated early
[2013-09-09 15:05:33 -0400] adnichols: not sure if it's diff in an only_if / not_if
[2013-09-09 15:05:59 -0400] adnichols: in which case you may need to use a ruby_block & set an attribute to use in the only_if
[2013-09-09 15:06:16 -0400] ichilton: what's a pig is I could do it with action :stop, :disable, but it creates K20nginx links in runlevels 2,3,4 - grr!
[2013-09-09 15:06:37 -0400] adnichols: ah
[2013-09-09 15:07:17 -0400] ichilton: adnichols: yay, that worked
[2013-09-09 15:07:24 -0400] adnichols: cool
[2013-09-09 15:08:09 -0400] ichilton: adnichols: So this is what i've got: https://github.com/ichilton/chef-nginx-web-server/blob/master/recipes/default.rb
[2013-09-09 15:08:24 -0400] ichilton: adnichols: is that the easiest way to move from init to upstart do you think?
[2013-09-09 15:08:31 -0400] ichilton: (incl the part in comments)
[2013-09-09 15:08:54 -0400] adnichols: looking
[2013-09-09 15:09:03 -0400] ichilton: ta
[2013-09-09 15:09:56 -0400] adnichols: really feels like the service resource should be able to do this
[2013-09-09 15:10:26 -0400] ichilton: yeah, but I can't see how
[2013-09-09 15:10:40 -0400] ichilton: as the nginx package install installs init scripts and starts it :(
[2013-09-09 15:12:15 -0400] adnichols: well, instead of service w/ action [ :stop, :disable ] have you tried just :disable?
[2013-09-09 15:12:31 -0400] adnichols: because :stop implies putting in place links to actually stop it :)
[2013-09-09 15:12:41 -0400] adnichols: or maybe that's what :disable does I gues
[2013-09-09 15:12:58 -0400] tabolario: ichilton/adnichols: how about https://gist.github.com/tabolario/64bb480a805d185b085f
[2013-09-09 15:13:23 -0400] adnichols: tabolario yeah, that's what I would think would work
[2013-09-09 15:13:26 -0400] cap10morgan: What do folks use for uploading cookbooks to community.turbovote.org? Every time I have to do it, it's painful (generate metadata, look up tar env vars to exclude hidden OS X files, exclude .git, deal with random errors on the site anyway).
[2013-09-09 15:14:00 -0400] ichilton: adnichols: hmm, that only_if isn't working - it's running that every time...
[2013-09-09 15:14:40 -0400] adnichols: ichilton it's running it even when those init links are missing?
[2013-09-09 15:14:53 -0400] ichilton: adnichols: seems to be...
[2013-09-09 15:15:14 -0400] ichilton: let's try tabolario's way
[2013-09-09 15:15:57 -0400] ichilton: tabolario: would the template have a notifies?
[2013-09-09 15:16:04 -0400] ichilton: tabolario: as that's then before the upstart start/enable
[2013-09-09 15:17:00 -0400] adnichols: ichilton that kinda depends on whether you want nginx automatically reloading changes
[2013-09-09 15:17:54 -0400] ichilton: I do, but will that fail the initial run as it doesn't know what service 'nginx' is yet?
[2013-09-09 15:18:09 -0400] adnichols: no
[2013-09-09 15:19:04 -0400] mpasternacki: Can somebody help me with a WTF situation?
[2013-09-09 15:19:18 -0400] ichilton: adnichols: unfortunately it does - Cannot find a resource matching service[nginx] (did you define it first?)
[2013-09-09 15:19:18 -0400] mpasternacki: Chef-client treats two resources of different kind as clones:
[2013-09-09 15:19:22 -0400] mpasternacki: [2013-09-09T15:10:23+00:00] WARN: Cloning resource attributes for package[curl] from prior resource (CHEF-3694)
[2013-09-09 15:19:22 -0400] mpasternacki: [2013-09-09T15:10:23+00:00] WARN: Previous template[/etc/iptables.d/all_icmp]: /var/chef/cache/cookbooks/iptables/definitions/iptables_rule.rb:23:in `block in from_file'
[2013-09-09 15:19:22 -0400] mpasternacki: [2013-09-09T15:10:23+00:00] WARN: Current  package[curl]: /var/chef/cache/cookbooks/lxc/recipes/install_dependencies.rb:4:in `block in from_file'
[2013-09-09 15:20:08 -0400] ichilton: adnichols: so I need a service with provider and action nothing, then drop the template in and then start/enable ?
[2013-09-09 15:20:18 -0400] mpasternacki: Then it mixes them up, tries to install a template, and fails: Error executing action `install` on resource 'template[/etc/iptables.d/all_icmp]'
[2013-09-09 15:20:20 -0400] mpasternacki: any ideas?
[2013-09-09 15:21:00 -0400] adnichols: ichilton you could do it that way - I would have expected that order of execution is separate from evaluating whether something is defined or not
[2013-09-09 15:21:48 -0400] ichilton: adnichols: indeed!
[2013-09-09 15:22:36 -0400] ichilton: adnichols: alas that doesn't work anyway - end up with 2x running :(
[2013-09-09 15:22:56 -0400] tabolario: subscribe the service to the template instead of notifying from it then ichilton :)
[2013-09-09 15:23:12 -0400] ichilton: tabolario: looks like that disable thing isn't working :(
[2013-09-09 15:23:19 -0400] tabolario: hmm
[2013-09-09 15:23:21 -0400] ichilton: tabolario: I end up with 2x nginx - one from init and one from upstart
[2013-09-09 15:23:23 -0400] tabolario: try [:stop, :disable]
[2013-09-09 15:23:29 -0400] adnichols: ichilton it's probably not stopping it first - yeah
[2013-09-09 15:23:56 -0400] adnichols:  which creates the K links you were mentioning
[2013-09-09 15:24:03 -0400] ichilton: actually no
[2013-09-09 15:24:07 -0400] ichilton: it's the disable which is doing that
[2013-09-09 15:24:08 -0400] ichilton:  ls -la /etc/rc2.d/*nginx*
[2013-09-09 15:24:08 -0400] ichilton: lrwxrwxrwx 1 root root 15 Sep  9 15:22 /etc/rc2.d/K80nginx -> ../init.d/nginx
[2013-09-09 15:24:13 -0400] ichilton: :(
[2013-09-09 15:25:13 -0400] ichilton: so the only_if way is nearer and works on the first provision, but for some reason each provision after that is restarting nginx...
[2013-09-09 15:25:35 -0400] adnichols: restarting? or starting again?
[2013-09-09 15:26:00 -0400] ichilton: let me re-run
[2013-09-09 15:26:04 -0400] adnichols: ie. running a :restart or a :start ?
[2013-09-09 15:27:48 -0400] adnichols: you are also going to want to put your upstart script before the service call if you haven't already
[2013-09-09 15:28:35 -0400] ichilton: yep, done that
[2013-09-09 15:29:17 -0400] lewiz: Does anybody have the knife-windows gem installed?  If so, what OS/release did you manage to install it with?  All attempts on Ubuntu 13.04, Mint 14 & CentOS 6.4 have so far failed
[2013-09-09 15:29:33 -0400] ichilton: adnichols: https://gist.github.com/ichilton/bd1ed97416446d42b8a4
[2013-09-09 15:29:56 -0400] ichilton: adnichols: so that's the initial run and then subsequent runs...
[2013-09-09 15:30:05 -0400] adnichols: ichilton it's restarting due to a notifies
[2013-09-09 15:30:22 -0400] adnichols: do you have a notifies on the nginx-upstart.conf?
[2013-09-09 15:30:43 -0400] ichilton: No, I think it's the only_if thing?
[2013-09-09 15:30:43 -0400] ichilton: [2013-09-09T15:29:20+00:00] INFO: service[nginx] stopped
[2013-09-09 15:30:44 -0400] ichilton: [2013-09-09T15:29:20+00:00] INFO: execute[disable-nginx] ran successfully
[2013-09-09 15:30:53 -0400] ichilton: Those are the only_if service calls....
[2013-09-09 15:31:03 -0400] tabolario: ichilton: what does your recipe look like now?
[2013-09-09 15:31:14 -0400] adnichols: correct - yeah, I guess I need to see the code again
[2013-09-09 15:31:44 -0400] ichilton: https://github.com/ichilton/chef-nginx-web-server/blob/master/recipes/default.rb
[2013-09-09 15:32:26 -0400] ichilton: So the first run seems fine - it stops, disables, sets up the upstart service and the upstart template (and then the notifies causes nginx to start)
[2013-09-09 15:32:35 -0400] ichilton: but then subsequent runs still seem to run the only_if
[2013-09-09 15:32:43 -0400] tabolario: ichilton you have the resource for the systemv service named the same as the upstart one
[2013-09-09 15:32:55 -0400] tabolario: er init service i mean
[2013-09-09 15:33:01 -0400] ichilton: and the file doesnt exist:
[2013-09-09 15:33:02 -0400] ichilton: ls: cannot access /etc/rc2.d/*nginx: No such file or directory
[2013-09-09 15:33:25 -0400] ichilton: tabolario: ah yes, I doo!
[2013-09-09 15:33:33 -0400] ichilton: I thought the different provider would sort that
[2013-09-09 15:33:43 -0400] tabolario: that would lead to strange results :)
[2013-09-09 15:33:46 -0400] ichilton: so if I rename that init-nginx
[2013-09-09 15:33:57 -0400] tabolario: make sure you add service_name 'nginx' to that resource
[2013-09-09 15:34:07 -0400] adnichols: yeah, tabolario had nginx-disable in his example or something like that
[2013-09-09 15:34:16 -0400] ichilton: yep, got that
[2013-09-09 15:35:12 -0400] ichilton: hmm, that seemed to fix that service stop
[2013-09-09 15:35:22 -0400] ichilton: but the disable-nginx one is still running each time?
[2013-09-09 15:35:56 -0400] tabolario: well it should be running just to verify the state
[2013-09-09 15:36:04 -0400] ichilton: ahh
[2013-09-09 15:36:08 -0400] ichilton: but it won't actually do the execute?
[2013-09-09 15:36:22 -0400] tabolario: not if that state is already what it expects (that the service is stopped and disabled)
[2013-09-09 15:36:43 -0400] ichilton: Sorry, that one is working fine now.
[2013-09-09 15:36:46 -0400] ichilton: It's this one:
[2013-09-09 15:36:47 -0400] ichilton: execute 'disable-nginx' do command "update-rc.d -f nginx remove" only_if Dir.glob('/etc/rc2.d/S??nginx').count > 0
[2013-09-09 15:36:50 -0400] ichilton: end
[2013-09-09 15:37:07 -0400] ichilton: obviously with some line breaks :)
[2013-09-09 15:37:20 -0400] tabolario: does it actually need that?
[2013-09-09 15:37:47 -0400] ichilton: yeah - I need that to remove the rcX.d symlinks so it doesn't start on boot
[2013-09-09 15:37:49 -0400] adnichols: assuming the disable works you could just remove that
[2013-09-09 15:37:57 -0400] ichilton: but disable ads K links which will stop nginx on boot
[2013-09-09 15:38:08 -0400] adnichols: ah right
[2013-09-09 15:38:18 -0400] tabolario: i would try it al fresh without that now that you have the two service resources named differently
[2013-09-09 15:38:35 -0400] ichilton: I need a :dontstart action instead of :disable !
[2013-09-09 15:38:43 -0400] ichilton: ok
[2013-09-09 15:38:45 -0400] adnichols: tabolario the problem is still the same - the init script for nginx is in both places doing two different things - independent of chef
[2013-09-09 15:38:54 -0400] tabolario: ah i see
[2013-09-09 15:39:34 -0400] ichilton: it's the execute thing - it seems to be running the command each time and ignoring the only_if
[2013-09-09 15:40:54 -0400] ichilton: ah no, changing the name of that service has broken the stop part now :(
[2013-09-09 15:41:10 -0400] ichilton: what a nightmare!
[2013-09-09 15:41:26 -0400] michaelhart: I need to put this raw string in an erb file, but ruby doesn't like it no matter what i've tried. Any suggestions? String: "<%{stuff}>%{more_stuff}"
[2013-09-09 15:41:31 -0400] tabolario: did you add service_name?
[2013-09-09 15:41:44 -0400] bean: michaelhart: <%= ?
[2013-09-09 15:41:53 -0400] michaelhart: the string is a logstash filter line
[2013-09-09 15:42:09 -0400] adnichols: michaelhart <%%
[2013-09-09 15:42:12 -0400] yruss972: Hi- when using a git resource, is there any way to convince it to actually clone the reference branch and not create the local deploy branch?
[2013-09-09 15:42:24 -0400] michaelhart: I tried that doesn't appear to work.
[2013-09-09 15:42:50 -0400] ichilton: adnichols: Even if I put only_if false - it still seems to execute every time ?
[2013-09-09 15:42:54 -0400] adnichols: ok - yeah, I actually ran into this this weekend - it causes var replacements further down in the file to fail?
[2013-09-09 15:43:17 -0400] adnichols: ichilton are you sure it's running your new recipe :)
[2013-09-09 15:43:18 -0400] tabolario: ichilton: if you're using ruby code and not a shell command for only_if, wrap it in a block
[2013-09-09 15:43:50 -0400] ichilton: ohhh
[2013-09-09 15:43:54 -0400] ichilton: this example on the wiki:
[2013-09-09 15:43:55 -0400] tabolario: otherwise your condition isn't going to get executed when you expect it will
[2013-09-09 15:43:57 -0400] ichilton: not_if { ::File.exists?("/tmp/#{pet_name}")}
[2013-09-09 15:44:02 -0400] ichilton: what does that :: do?
[2013-09-09 15:44:20 -0400] tabolario: ensures your using the File constant from the global namespace in Ruby
[2013-09-09 15:44:33 -0400] ichilton: as opposed to?
[2013-09-09 15:45:23 -0400] tabolario: a closer File constant in the binding
[2013-09-09 15:45:31 -0400] tabolario: (e.g. there might be a Chef::File constant)
[2013-09-09 15:45:35 -0400] ichilton: ah, ok
[2013-09-09 15:45:40 -0400] ichilton: so is it best practise to use that?
[2013-09-09 15:45:50 -0400] bean: in this case, yes.
[2013-09-09 15:46:03 -0400] ichilton: ok, ta
[2013-09-09 15:46:34 -0400] ichilton: ok, let's try this again! :)
[2013-09-09 15:46:40 -0400] gleam_:  /nick gleam
[2013-09-09 15:47:00 -0400] ichilton: gleam: echo off :)
[2013-09-09 15:57:08 -0400] gleam: yes yes :P
[2013-09-09 15:57:34 -0400] ichilton: adnichols: tabolario: yay, that all works now :)
[2013-09-09 15:57:45 -0400] ichilton: adnichols: tabolario: thanks for all your help!
[2013-09-09 15:57:57 -0400] ichilton: only slight problem is warnings:
[2013-09-09 15:57:57 -0400] ichilton: [2013-09-09T15:55:19+00:00] WARN: Cloning resource attributes for service[nginx] from prior resource (CHEF-3694)
[2013-09-09 15:58:01 -0400] ichilton: [2013-09-09T15:55:19+00:00] WARN: Previous service[nginx]: /tmp/vagrant-chef-1/chef-solo-1/cookbooks/nginx_web_server/recipes/default.rb:67:in `from_file'
[2013-09-09 15:58:04 -0400] ichilton: [2013-09-09T15:55:19+00:00] WARN: Current  service[nginx]: /tmp/vagrant-chef-1/chef-solo-1/cookbooks/nginx_web_server/recipes/default.rb:80:in `from_file'
[2013-09-09 15:58:06 -0400] tabolario: ichilton great :)
[2013-09-09 15:58:12 -0400] ichilton: Is that because i'm using service 'nginx' twice in the same recipe?
[2013-09-09 15:58:15 -0400] adnichols: ichilton that first warn is gonna happen
[2013-09-09 15:58:38 -0400] ichilton: adnichols: because of 2 lots of service 'nginx' ?
[2013-09-09 15:58:53 -0400] adnichols: yeah
[2013-09-09 15:58:56 -0400] ichilton: k
[2013-09-09 15:59:02 -0400] ichilton: but even if I rename that first one and put [2013-09-09T15:55:19+00:00] WARN: Cloning resource attributes for service[nginx] from prior resource (CHEF-3694)
[2013-09-09 15:59:05 -0400] ichilton: [2013-09-09T15:55:19+00:00] WARN: Previous service[nginx]: /tmp/vagrant-chef-1/chef-solo-1/cookbooks/nginx_web_server/recipes/default.rb:67:in `from_file'
[2013-09-09 15:59:08 -0400] ichilton: sorry!
[2013-09-09 15:59:11 -0400] ichilton: oops
[2013-09-09 15:59:25 -0400] fishGoM00: michaelhart: epically dirty but.... perhaps put the string in files in the recipe so it gets copied to the server
[2013-09-09 15:59:30 -0400] ichilton: but even if I rename that first one and put service_name 'nginx' in, it stops working...
[2013-09-09 15:59:33 -0400] fishGoM00: then use a bash command to >> it to a file
[2013-09-09 15:59:37 -0400] ichilton: any ideas why?
[2013-09-09 16:00:04 -0400] ichilton: is it because the process is: nginx: master process ?
[2013-09-09 16:00:28 -0400] ichilton: i.e:
[2013-09-09 16:00:28 -0400] ichilton: root      1880     1  0 15:52 ?        00:00:00 nginx: master process /usr/sbin/nginx
[2013-09-09 16:02:34 -0400] michaelhart: fishGoM00 that is actually a reasonable idea given the horrendous mix of syntax I have to do here. I did get it working in one the erb file itself using a line like this:  '<%= "<%{POSINT:syslog_pri}>%{blah}" %>'
[2013-09-09 16:02:54 -0400] michaelhart: the resulting line in the file is then '<%{POSINT:syslog_pri>%{blah}...'
[2013-09-09 16:02:54 -0400] eherot: tabolario: just figured out that I can override the template resource but not the logrotate_app resource...weird.
[2013-09-09 16:02:54 -0400] eherot: tabolario: the underlying template resource inside the logrotate_app resource that is.
[2013-09-09 16:03:01 -0400] michaelhart: wow that's ugly.
[2013-09-09 16:03:20 -0400] adnichols: michaelhart hah, interesting
[2013-09-09 16:09:24 -0400] psykidel_: Hello, I am having an issue where my nginx template references a certificate which is part of my application deployment (which is a capistrano task). Thus on the initial setup, nginx fails on starup. Whats the canonical way to solve this?
[2013-09-09 16:11:15 -0400] tabolario: psukidel_ have chef manage the cert instead of capistrano :)
[2013-09-09 16:11:21 -0400] tabolario: psykidel_ *
[2013-09-09 16:12:28 -0400] psykidel_: tabolario Any cookbooks?
[2013-09-09 16:12:47 -0400] tabolario: psykidel_ well i put my certs in an encrypted data bag
[2013-09-09 16:12:56 -0400] bean: ^
[2013-09-09 16:12:59 -0400] psykidel_: tabolario Aha. I was reading upon it just now.
[2013-09-09 16:13:02 -0400] tabolario: i also allow them to be set through non-encrypted data bags or attributes for my vagrant boxes
[2013-09-09 16:13:46 -0400] psykidel_: Okay, I will now read upon it.
[2013-09-09 16:14:09 -0400] psykidel_: Looks like data bag/encrypted data bag is the way to go.
[2013-09-09 16:14:36 -0400] tabolario: this needs to be refactored a bit still but: https://gist.github.com/tabolario/5550d052e75b8aec7532
[2013-09-09 16:16:01 -0400] psykidel_: Thanks.
[2013-09-09 16:17:43 -0400] tabolario: psykidel_ can probably ignore the separate redirect cert thing I'm doing there
[2013-09-09 16:30:21 -0400] fishGoM00: michaelhart: hehehe, I find escaping long complicated string in ruby a PITA tbh :)
[2013-09-09 16:33:30 -0400] MugsyMalone: Anyone got any ideas why test kitchen throws errors trying to find the busser gem on kitchen setup?
[2013-09-09 16:34:36 -0400] MugsyMalone: it almost seems like my kitchen vm's cannot see the outside internet
[2013-09-09 16:44:35 -0400] geggam_: favorite ruby ide for windows is ?
[2013-09-09 16:49:09 -0400] tabolario: geggam_ a VM :)
[2013-09-09 16:50:00 -0400] geggam_: im forced to do this on windows... was hoping there was at least one other lost soul stuck in that situation
[2013-09-09 16:50:50 -0400] tabolario: Well I think there's RubyMine in the windows space
[2013-09-09 16:56:21 -0400] cubed: quick question: trying to use migration_command in the application cookbook.. but i don't actually see it appear when chef-client is running through. it should show up, correct?
[2013-09-09 16:57:33 -0400] cubed: i've done something simple like "migration_command "echo testing migration_command" but it doesn't appear
[2013-09-09 16:58:02 -0400] mattupstate: probably depends on the log level
[2013-09-09 17:02:48 -0400] wdilly: Hello everyone, please help me with a noob question. I want a chunk of code only to be run on the initial chef-client run, not on subsequent check-ins, what is the best strategy for this: the code in question is http://paste.ubuntu.com/6084270/ as follows:
[2013-09-09 17:06:31 -0400] cubed: mattupstate: cool, i'll see if i can tweak the log level and maybe that'll help out
[2013-09-09 17:06:34 -0400] cubed: thanks
[2013-09-09 17:10:01 -0400] michaelhart: wdilly have your execute touch a file and then add an 'not_if {File:exists?('/path/to/file')}
[2013-09-09 17:11:19 -0400] wdilly: michaelhart, sweet, i like it
[2013-09-09 17:12:42 -0400] MugsyMalone: huh. I did a kitchen destroy and then kitchen setup, and then busser was able to be installed
[2013-09-09 17:19:17 -0400] dcrosby: Is there a way of finding out the date you bootstrapped a node with knife? Haven't found anything in the docs yet
[2013-09-09 17:20:13 -0400] arussel: adnichols: thanks (bit late)
[2013-09-09 17:22:32 -0400] mathewpeterson: Does anyone have a workaround for https://tickets.opscode.com/browse/CHEF-4399?
[2013-09-09 17:25:32 -0400] douglaswth: mathewpeterson: use the line endings that you want to deploy with?
[2013-09-09 17:28:02 -0400] mathewpeterson: douglaswth: I'm trying to provision a linux vagrant box on Windows. So, I'm not sure that will work.
[2013-09-09 17:28:19 -0400] douglaswth: why not?
[2013-09-09 17:29:03 -0400] douglaswth: you can't make your editor output unix line endings?
[2013-09-09 17:29:04 -0400] arussel: adnichols: "the bootstrap command supports putting it in place" => knife help bootstrap doesn't show anything about secret file.
[2013-09-09 17:29:21 -0400] douglaswth: you can always run dos2unix
[2013-09-09 17:31:44 -0400] mathewpeterson: douglaswth: Because when I checkout the repository, it checks everything out as windows line endings, and then when vagrant runs, it creates a shared folder with the chef-repo, which are windows line endings
[2013-09-09 17:35:17 -0400] douglaswth: mathewpeterson: are you using git? I think you can change how it checks out text files
[2013-09-09 17:36:37 -0400] douglaswth: mathewpeterson: I just use cygwin to do local chef dev in windows which also helps avoid that problem
[2013-09-09 17:37:28 -0400] mathewpeterson: douglaswth: Do you know if github for windows works with Cygwin?
[2013-09-09 17:40:28 -0400] douglaswth: mathewpeterson: I wouldn't touch github for windows, but you could use it along with cygwin, but it's still going to checkout with the windows line endings unless you change git settings
[2013-09-09 17:41:23 -0400] mathewpeterson: douglaswth: Yeah, I'm not sure if I can get the developer off of the gui.
[2013-09-09 17:41:57 -0400] rracterr: set your .gitattributes file to have the file extension and the attribute you want... so perhaps *.rb -crlf
[2013-09-09 17:48:38 -0400] geggam_: tabolario, if someone asks for a ruby ide for windows aptana is free and seems to be decent
[2013-09-09 17:49:10 -0400] tabolario: ah aptana! i remember that
[2013-09-09 17:50:32 -0400] adnichols: arussel my knife bootstrap --help shows this: --secret-file SECRET_FILE    A file containing the secret key to use to encrypt data bag item values
[2013-09-09 17:53:22 -0400] fak3r: what is the preferred way of setting the timezone? script a quick ln -s during bootstrap, or a recipe?
[2013-09-09 17:53:36 -0400] rracterr: recipe
[2013-09-09 17:54:00 -0400] arussel: adnichols: thanks again (knife help bootstrap shows much less than knife bootstrap --help)
[2013-09-09 17:55:05 -0400] rracterr: using the recipe (assuming its well developed) is going to abstract you from the platform specifics so you can have one 'timezone' recipe and run it on windows, centos, ubuntu, etc and have it just work... gives you flexibility, expandability and some level of abstraction
[2013-09-09 17:55:45 -0400] rracterr: just as soon as you finish some adhoc solution someone will spring something on you like 'oh, and we want you to support X,Y,Z platforms next week too' and you'll have done all that work for nothing.
[2013-09-09 18:00:41 -0400] fak3r: rracterr: good points, ok will work on that, thanks
[2013-09-09 18:32:27 -0400] jmickle: what is the best way to install gem packages with the new omnibus embedded gem?
[2013-09-09 18:32:45 -0400] jmickle: the system seems to want to use /usr/bin/gem vs using /opt/chef/embedded/bin/gem
[2013-09-09 18:34:27 -0400] sevensoft: just going thru the getting started stuff..  i was able to bootstrap my node into hosted chef.. i can see it on my dashboard..   when i try to run chef-client i get this: getaddrinfo: Temporary failure in name resolution
[2013-09-09 18:39:02 -0400] sevensoft: any thoughts?  seems pretty basic.. but i'm such a noob that i'm not sure where to poke around..
[2013-09-09 18:45:29 -0400] subway: jmickle: I've been using the chef_gem resource
[2013-09-09 18:46:07 -0400] jmickle: ahhh subway i forgot about that
[2013-09-09 18:46:11 -0400] jmickle: i was using gem_install
[2013-09-09 18:46:21 -0400] aslan: hey guys...i am trying to upgrade my rsyslogd package and it looks like chef is actually ignoring the new version : https://gist.github.com/Aslan/6499797
[2013-09-09 18:46:57 -0400] subway: aslan: use :upgrade or :version
[2013-09-09 18:47:15 -0400] subway: depending on whether you want to trust the latest in your package repo, or use a specific version
[2013-09-09 18:48:03 -0400] subway: err not :version. version.
[2013-09-09 18:48:14 -0400] aslan: subway: so this is the expected behavior of ubuntu provider?
[2013-09-09 18:48:43 -0400] aslan: subway: because with apt-get install the latest version will be installed
[2013-09-09 18:48:52 -0400] subway: aslan: yes. action :install without specifying a version means you don't care what version is installed, just that the package is installed
[2013-09-09 18:49:05 -0400] subway: If you want it to be the latest provided in your apt repo, use :upgrade
[2013-09-09 18:49:17 -0400] aslan: subway: thanks :)
[2013-09-09 18:49:28 -0400] jmickle: subway thanks that worked
[2013-09-09 18:49:43 -0400] subway: sure thing
[2013-09-09 18:53:49 -0400] mjcdiggity: I'm unable to get node.name when running chef solo... any insights?
[2013-09-09 19:00:58 -0400] bixu: mjcdiggity: I'm not sure that chef-solo has a conception of node.name?  I could be wrong though.
[2013-09-09 19:01:51 -0400] rracterr: mjcdiggity: what do you get when you run hostname?
[2013-09-09 19:02:41 -0400] mjcdiggity: i get nil... if chef-solo doesnt have an idea of node.name, is there still a way to retrieve that value
[2013-09-09 19:03:21 -0400] prana: Is there any automated way to upload a cookbook from GitHub into the community site?
[2013-09-09 19:03:29 -0400] rracterr: mjcdiggity: ohai just uses hostname to define node name...while I'm no expert on solo I imagine if your hostname isnt set right, your going to have trouble finding your nodename
[2013-09-09 19:03:56 -0400] prana: the upload mechanism on the community site only takes zip files and it's sort of picky about it.
[2013-09-09 19:04:26 -0400] rracterr: so fix your hosts file
[2013-09-09 19:05:55 -0400] subway: mjcdiggity: I think you can set a node name when you call chef-solo
[2013-09-09 19:05:58 -0400] subway: -N maybe?
[2013-09-09 19:06:14 -0400] mjcdiggity: well im using test kitchen which seems to be setting a node name when i cat the solo.rb file created, just not sure how to get that data in the recipe
[2013-09-09 19:06:20 -0400] rracterr: subway: yes he can, but the proper way would be to fix his hosts file
[2013-09-09 19:06:33 -0400] rracterr: doh, ok, well then
[2013-09-09 19:07:03 -0400] subway: rracterr: Ehhhh. That depends on intent. It is entirely possible he is looking for node name, and not hostname.
[2013-09-09 19:07:22 -0400] subway: They don't have to be the same.
[2013-09-09 19:07:34 -0400] rracterr: true... I've yet to find a good reason to ever let those two diverge in my world... heck I think life would suck if they ever did.
[2013-09-09 19:08:08 -0400] subway: I'm not crazy about the situation, but for reasons I don't care to explain, they've diverged in my environment.
[2013-09-09 19:10:00 -0400] mindlace: so all of the "best practice" stuff I'm seeing is "do your cookbooks outside the chef repo" but knife seems to expect you to do everything in your chef repo
[2013-09-09 19:10:19 -0400] mindlace: do y'all just symlink them in or what?
[2013-09-09 19:10:25 -0400] prana: mindlace: http://berkshelf.com/
[2013-09-09 19:10:38 -0400] mindlace: yes, i'm using berkshelf
[2013-09-09 19:10:43 -0400] prana: (Though, that is not, in fairness, a complete answer to your question.)
[2013-09-09 19:10:53 -0400] prana: i just berks upload from the individual cookbook directories.
[2013-09-09 19:11:00 -0400] prana: instead of using knife cookbook upload.
[2013-09-09 19:11:32 -0400] mindlace: well, i'm starting with something "simple" that creates the admin users needed on each node. This relies on information in a data_bag .
[2013-09-09 19:11:59 -0400] mindlace: so it would make sense (to me, at least) for this data bag info to live with the cookbook that uses it.
[2013-09-09 19:12:36 -0400] mindlace: But of course then chef complains (when I try to do knife data bag commands) because I'm not in the 'root' chef repo.
[2013-09-09 19:12:48 -0400] gkra: Ugh so our open-source chef server filled its disk over the weekend, and now, post-expansion, it's giving 500 errors to any chef-client request...
[2013-09-09 19:12:51 -0400] subway: coming from using puppet extensively, it kind of annoys me that my chef repo isn't a direct representation of what's going on with my chef server
[2013-09-09 19:13:00 -0400] gkra: is there a "I killed my chef server, now what?" doc? :)
[2013-09-09 19:13:14 -0400] prana: subway: that is kind of annoying, I agree.
[2013-09-09 19:13:20 -0400] subway: I get all stabby when somebody modifies a role/databag via knife without ever checking it in
[2013-09-09 19:13:32 -0400] prana: mindlace: I think the riot games guys (who wrote berkshelf) would argue that the data is in fact separate from the cookbook.
[2013-09-09 19:14:36 -0400] prana: subway: how does puppet keep it in sync?
[2013-09-09 19:14:55 -0400] mindlace: hm. well maybe, so when I'm making a test I just pass in fake data to test that the user gets created?
[2013-09-09 19:14:58 -0400] rracterr: subway: I'm with ya on that... your git repo should be the source of truth... checked in, then deployed to chef... not the other way around
[2013-09-09 19:15:21 -0400] subway: prana: Puppet itself doesn't, but because it uses files on disk, it is trivial to set up git hooks that keep /etc/puppet/environment/production at the head of master
[2013-09-09 19:15:34 -0400] subway: and /etc/puppet/environment/foo at the head of branch foo
[2013-09-09 19:15:35 -0400] subway: etc
[2013-09-09 19:15:57 -0400] subway: that workflow is something I really miss, and have been trying to figure out how to recreate with chef.
[2013-09-09 19:16:08 -0400] prana: you could imagine a workflow where your CI server is the only one with admin access to the chef server
[2013-09-09 19:16:09 -0400] subway: I could probably put together some pretty extensive git hooks
[2013-09-09 19:16:26 -0400] prana: or the only one with functional chef admin access, for uploading cookbooks and updating data bags etc.
[2013-09-09 19:16:46 -0400] subway: nod
[2013-09-09 19:16:51 -0400] prana: you git push, the CI server validates something and then does the knife/berks upload
[2013-09-09 19:17:26 -0400] prana: gkra: are you using 10 or 11?
[2013-09-09 19:21:21 -0400] gkra: prana: 11
[2013-09-09 19:31:10 -0400] prana: gkra: of course I have no real advice for you; other than to check the logs to see if it something you can fix and you know, wish you had recent backups or that the whole state of your server is in fact captured by your chef-repo and you can just upload it.
[2013-09-09 19:35:04 -0400] prana: anyone around who can fix a mistake I made to a cookbook on community.opscode.com?
[2013-09-09 19:36:53 -0400] xhae: subway: I've been wondering about that myself, since the whole git repo/attribute+databag lark seems very roundabout way of doing things
[2013-09-09 19:37:45 -0400] xhae: it's either untracked changes or dealing with the achingly slow cookbook upload process
[2013-09-09 19:37:47 -0400] rracterr: roundabout?  its basically MVC without the V... seems straight forward to me
[2013-09-09 19:38:18 -0400] subway: xhae: nod.
[2013-09-09 19:38:36 -0400] subway: rracterr: It is damn near impossible to guarantee you have a full history of your infrastructure in vcs
[2013-09-09 19:38:42 -0400] xhae: rracterr: attributes are models, resources are views and the recipe is the controller.
[2013-09-09 19:39:12 -0400] rracterr: seems like some minor changes could make it easier... perhaps a system wide setting that will disable knife edit, along with a knife cookbook upload that is idempotent and sparse so you could kick it off on cron or something
[2013-09-09 19:39:43 -0400] rracterr: xhae: stretching the definition of view a bit but I"ll go with it
[2013-09-09 19:39:46 -0400] xhae: I want to separate the data and the code.
[2013-09-09 19:39:50 -0400] gkra: prana: I can re-upload all the cookbooks and policy, I'm more worried about all the user accounts, ssh keys, validator keys, etc...
[2013-09-09 19:40:03 -0400] xhae: I am thinking of a separate audited RDBMS-backed attribute service
[2013-09-09 19:40:08 -0400] gkra: prana: of course, nobody ever set up backups on this, because it was supposed to be replaced by a private chef server months ago. :(
[2013-09-09 19:40:13 -0400] subway: oh I've given up on handling user accounts with chef
[2013-09-09 19:40:18 -0400] subway: the users cookbook is just absurd
[2013-09-09 19:40:30 -0400] prana: gkra: yeah. Sorry. Backups. :-/
[2013-09-09 19:40:31 -0400] rracterr: amen
[2013-09-09 19:40:33 -0400] subway: I'm more of a fan of centralized auth anyway
[2013-09-09 19:40:39 -0400] rracterr: thats what ldap servers are for
[2013-09-09 19:40:41 -0400] xhae: word.
[2013-09-09 19:40:44 -0400] subway: nod
[2013-09-09 19:41:13 -0400] prana: I'm using the user cookbook, which I'm not a huge fan of either.
[2013-09-09 19:41:33 -0400] prana: But I like the idea of users being able to login without having to touch an LDAP/NIS server.
[2013-09-09 19:41:45 -0400] subway: eh, that's when you bust out sssd
[2013-09-09 19:42:02 -0400] subway: they have to log in once to cache their credentials
[2013-09-09 19:42:02 -0400] gkra: I meant chef-server user accounts (for knife, etc...)
[2013-09-09 19:42:04 -0400] gkra: :)
[2013-09-09 19:42:21 -0400] subway: oh, heh.
[2013-09-09 19:46:35 -0400] prana: subway: oh, interesting. thanks for the pointer.
[2013-09-09 20:04:02 -0400] sc0: if i had a cookbook that only contained LWRPs but also required additional packages to be installed, where would be the best place to install those packages? As a separate recipe or as part of the definition of each action in the provider?
[2013-09-09 20:04:15 -0400] sc0: i hope that makes sense, i'm new to Chef
[2013-09-09 20:04:46 -0400] subway: If the LWRPs depend on packages, wouldn't you want to just put those packages in the default recipe?
[2013-09-09 20:05:01 -0400] subway: (I'm also fairly green to chef)
[2013-09-09 20:05:12 -0400] sc0: i've been digging though other cookbooks and i've seen it done both ways
[2013-09-09 20:06:20 -0400] sc0: for example this https://github.com/hw-cookbooks/backup/blob/master/providers/install.rb
[2013-09-09 20:06:44 -0400] sc0: i have no idea if this is good practice or not, which is kind of why i'm asking
[2013-09-09 20:06:59 -0400] subway: Interesting. Doesn't that result in some noisy output on a chef run?
[2013-09-09 20:07:21 -0400] subway: (not that it isn't already absurdly fscking noisy)
[2013-09-09 20:11:22 -0400] sc0: actually thinking about it, I'm pretty sure I just want to stick it in the default recipe. I don't need LWRPs for installing/removing.
[2013-09-09 20:12:03 -0400] adnichols: sc0 I would generally put in in default
[2013-09-09 20:12:22 -0400] adnichols: that way you get the lwrp's and install dependencies in the same shot
[2013-09-09 20:12:41 -0400] sc0: yup, makes sense
[2013-09-09 20:12:57 -0400] sc0: just wanted to make sure i was going down the right route.
[2013-09-09 20:13:01 -0400] sc0: thanks guys
[2013-09-09 20:15:28 -0400] adnichols: The aws cookbook is a good pattern to follow for this - that's how it works - there are some other gotchas w/ gem dependencies in LWRP's installed by the same cookbook
[2013-09-09 20:16:47 -0400] sc0: cool, i'll take a look at the aws cookbook.
[2013-09-09 20:26:57 -0400] btm: @opscode cookbook code review, join: https://plus.google.com/hangouts/_/507db4a38cfa4c0eccb4fdf9ef0a14c7987d997c, watch: http://youtu.be/iaiJfZD9Eq8
[2013-09-09 20:39:22 -0400] dmerrick: is it possible to use the opscode users cookbook with an encrypted data bag?
[2013-09-09 21:03:18 -0400] bkvanmeter: When I run "knife cookbook upload apt" I receive the following error "ERROR: Errno::EACCES: Permission denied - /var/chef". Has anyone encountered this before?
[2013-09-09 21:06:24 -0400] subway: I'm guessing /var/chef's permissions forbid chef-server's user (likely "chef") from writing there...
[2013-09-09 21:07:47 -0400] stormerider: istr the chef-server user is chef-server
[2013-09-09 21:15:22 -0400] sevensoft: ok.. i blew away the server.. rebootstrapped it.. i can run chef-client on it..   have a slightly different problem..   I can run "knife search node name:*" and I get my machine returned..
[2013-09-09 21:15:49 -0400] sevensoft: when i run "knife ssh "name:*" "uptime"" I get WARNING: Failed to connect to  -- SocketError: getaddrinfo: nodename nor servname provided, or not known
[2013-09-09 21:16:08 -0400] sevensoft: i'm assuming it is trying to resolve my hostname.. which isn't a real dns entry?
[2013-09-09 21:17:48 -0400] bkvanmeter: subway: There does not seem to be a chef user on the the chef-server, I changed the permissions to 777 for /var/cache/chef and the issue continues to persist. Any other ideas? :)
[2013-09-09 21:18:24 -0400] subway: no clue
[2013-09-09 21:20:16 -0400] sevensoft: any thoughts?
[2013-09-09 21:20:55 -0400] sevensoft: also.. where can I see what the default time is for the client to check in with the server?.. when I look @ my dashboard is says the client last checked in 2 hours ago..
[2013-09-09 21:21:18 -0400] jbz: sevensoft: Unless you've configured chef-client to run as a service, it won't.
[2013-09-09 21:21:55 -0400] sevensoft: jbz: thanks..   yeah. this is just on a vagrant box.. working thru the getting started stuff
[2013-09-09 21:22:20 -0400] jbz: sevensoft: as for your connect problem, it sounds like the default attribute which knife-ssh uses to reach the box isn't set properly
[2013-09-09 21:22:36 -0400] sevensoft: like -a ipaddress ?
[2013-09-09 21:22:40 -0400] jbz: knife ssh defaults to using the FQDN
[2013-09-09 21:22:43 -0400] jbz: so if that doesn't work, it won't work
[2013-09-09 21:22:52 -0400] jbz: yes, -a ipaddress is the way to resolve that
[2013-09-09 21:22:58 -0400] sevensoft: i tried.. let me try again..
[2013-09-09 21:23:37 -0400] sevensoft: FATAL: 1 node found, but does not have the required attribute to establish the connection. Try setting another attribute to open the connection using --attribute.
[2013-09-09 21:23:42 -0400] jbz: hmm
[2013-09-09 21:23:46 -0400] jbz: doesn't have ipaddress?
[2013-09-09 21:24:13 -0400] jbz: oh
[2013-09-09 21:24:14 -0400] jbz: hm
[2013-09-09 21:24:20 -0400] sevensoft: the node does when i run "knife search node name:*"
[2013-09-09 21:24:24 -0400] sevensoft: i get an IP
[2013-09-09 21:24:41 -0400] sevensoft: hold on
[2013-09-09 21:24:47 -0400] jbz: Is it in node[:ipaddress] or some other attribute?
[2013-09-09 21:28:42 -0400] sevensoft: should -a use the actual IP address.. or just the term "ipaddress"..     when i see examples. they are just passing in the FQDN..
[2013-09-09 21:29:56 -0400] sevensoft: shoot.. getting pulled into a meeting..  i'll have to pick this up later..  i'll stay connected in case anyone has a suggestion ;)
[2013-09-09 21:32:12 -0400] doomviking: sevensoft: the term "ipaddress"
[2013-09-09 21:58:42 -0400] mburns: Should I be able to speficy File/Templates based on platform_family, not just platform? http://docs.opscode.com/essentials_cookbook_files.html#file-specificity
[2013-09-09 22:05:45 -0400] ryanisnan: I'm using chef-solo to provision my vagrant environments, and I'm trying to figure out why recipes don't seem to be installing in the order they are defined in my Vagrantfile (http://dpaste.com/1372649/) Here is the output of provisioning: http://dpaste.com/1372655/
[2013-09-09 22:06:13 -0400] mburns: ryanisnan: do you use includes in your cookbooks?
[2013-09-09 22:09:19 -0400] ryanisnan: mburns: Yes. I use the postgresql & database cookbook; a cursory glance shows that they do use includes.
[2013-09-09 22:11:48 -0400] ryanisnan: mburns: The output paste I showed seems to be failing because build-essential doesn't seem to be installed yet `sh: 1: make: not found`, but it *should* be installed in baseconfig::default, which *should* run before the postgresql recipes.
[2013-09-09 22:13:23 -0400] dgarstang: Any better docs out there than http://berkshelf.com ?
[2013-09-09 22:15:10 -0400] mburns: ryanisnan: gotcha. Have you tried commenting out all the recipe's after baseconfig::default, and ssh'ing to the vagrant vm to ensure the package is being installed as expected?
[2013-09-09 22:15:44 -0400] mburns: I've had Vagrant issues that required running dhclient or apt-get update, to jostle them back into shape, but not sure the underlying cause.
[2013-09-09 22:19:08 -0400] opter: with this recipe  https://github.com/opscode-cookbooks/ark/blob/master/recipes/default.rb, I get lock errors and I would like to implement a retries 5 +  retry_delay 10 in case I get a yum lock timeout issues on Amazon Linux.
[2013-09-09 22:19:23 -0400] ryanisnan: mburns: I haven't tried that yet (this setup fails on 1 computer, but works on another).
[2013-09-09 22:19:30 -0400] opter: What is the best way to get this updated in the cookbook?
[2013-09-09 22:19:37 -0400] dgarstang: Don't suppose the docs get any better than what's at http://berkshelf.com then
[2013-09-09 22:20:19 -0400] ryanisnan: mburns: The recipe by itself seems to work, though.
[2013-09-09 22:23:57 -0400] dgarstang: docs on berkshelf.... wondering if the exist
[2013-09-09 22:24:09 -0400] behemphi: berkshelf.com
[2013-09-09 22:24:17 -0400] behemphi: Its pretty darn good
[2013-09-09 22:24:23 -0400] dgarstang: behemphi: seriously?
[2013-09-09 22:24:26 -0400] behemphi: yep
[2013-09-09 22:25:03 -0400] dgarstang: behemphi: how about some context? it doesnt't even tell you to cd to the cookbook directory before running berks install. It also doesn't tell you it's gonna try and talk to your chef server
[2013-09-09 22:25:06 -0400] behemphi: I ain't smart, but it got me most of the way.  The rest was Ruby
[2013-09-09 22:25:40 -0400] dgarstang: 'f youre familiar with Bundler, then Berkshelf is a breeze.' ... how about if you aren't familar with bundler?
[2013-09-09 22:25:49 -0400] behemphi: LOL, had the same question!
[2013-09-09 22:26:01 -0400] dgarstang: typical... docs suck ass.
[2013-09-09 22:26:02 -0400] behemphi: There is defn an assumption of Ruby knowledge
[2013-09-09 22:26:22 -0400] dgarstang: behemphi: which contradicst the assertion on the opscode page that you don't have to know ruby to use chef
[2013-09-09 22:26:34 -0400] behemphi: So #berkshelf has helped me some too when I was stuck
[2013-09-09 22:26:42 -0400] behemphi: berkshelf is defn not a requirment to use chef
[2013-09-09 22:26:47 -0400] dgarstang: behemphi: ah there's a channel..
[2013-09-09 22:27:10 -0400] behemphi: All, I have am relearning knife XXX server create
[2013-09-09 22:27:13 -0400] behemphi: this time with ec2
[2013-09-09 22:27:18 -0400] behemphi: and I am getting this issue:
[2013-09-09 22:27:27 -0400] behemphi: Failed to authenticate ubuntu - trying password auth
[2013-09-09 22:27:43 -0400] behemphi: I have put the .pem in ~/.ssh
[2013-09-09 22:28:08 -0400] ryanisnan: dgarstang: "docs suck ass" is probably a bit harsh. If you think so, improve them as you learn new things, I'm sure the riot guys would appreciate it.
[2013-09-09 22:28:13 -0400] behemphi: Am I missing a step or something.  I did not realize that ssh would read a .pem
[2013-09-09 22:28:55 -0400] mburns: opter https://github.com/mburns/ark/compare/opscode-cookbooks:master...patch-1?quick_pull=1
[2013-09-09 22:29:02 -0400] mburns: awh, didn't even bother to get the answer :(
[2013-09-09 22:29:06 -0400] ryanisnan: side note: I would appreciate it as well, as Berkshelf is largely black magic.
[2013-09-09 22:30:25 -0400] dgarstang: well, berkshef was dead. back here again.
[2013-09-09 22:30:31 -0400] behemphi: IMO if you are just learning chef, skip Berkshelf and make sure you have grasp of how Chef itself works.  That takes some of the black magic out.  I do tend to think of BS as gem,pip or apt for the most part though
[2013-09-09 22:30:57 -0400] dgarstang: ryanisnan: sure, gotta learn them first tho, and without docs, that takes a helluava long time.
[2013-09-09 22:31:10 -0400] dgarstang: behemphi: got chef
[2013-09-09 22:31:32 -0400] dgarstang: the fact I don't know what berkshelf is doing makes me very uncomfy
[2013-09-09 22:31:55 -0400] behemphi: You know this might help @dgarstang http://www.opscode.com/blog/chefconf-talks/the-berkshelf-way-jamie-winsor/
[2013-09-09 22:32:05 -0400] behemphi: The language is not work safe
[2013-09-09 22:32:13 -0400] behemphi: if you are in a buttoned up place
[2013-09-09 22:32:26 -0400] dgarstang: behemphi: I watched that. i have to admit that I stopped watching after about 15min... he was talking about generic revision control priciples etc.
[2013-09-09 22:32:26 -0400] behemphi: That talk was what got me moving to BS
[2013-09-09 22:32:48 -0400] dgarstang: behemphi: ie nothing berkshelf specific
[2013-09-09 22:33:02 -0400] behemphi: It gets there
[2013-09-09 22:33:21 -0400] behemphi: but it might be too high level for where you are at this point
[2013-09-09 22:33:47 -0400] dgarstang: behemphi: yes... like why is it trying to talk to a chef server, where did it pull the address from etc
[2013-09-09 22:34:01 -0400] behemphi: It gets it from the config
[2013-09-09 22:34:24 -0400] behemphi: if it is trying to talk to the chef server then likely a cmd was issued to upload the cookbooks
[2013-09-09 22:34:34 -0400] dgarstang: behemphi: what config?
[2013-09-09 22:34:40 -0400] behemphi: berks config
[2013-09-09 22:34:46 -0400] dgarstang: behemphi: stored where?
[2013-09-09 22:34:48 -0400] behemphi: that is on berkshelf.com
[2013-09-09 22:34:59 -0400] behemphi: ~/.berkshelf/config.json I think
[2013-09-09 22:35:22 -0400] behemphi: but you can issue `berks config` to get the "most traveled"
[2013-09-09 22:35:27 -0400] dgarstang: behemphi: kk
[2013-09-09 22:35:29 -0400] behemphi: (love that phrase :-))
[2013-09-09 22:36:08 -0400] dgarstang: oh this is gonna be messy. We already have three chef servers... each with it's own config file. Now I'm gonna have to have three berkshelf config files as well.
[2013-09-09 22:36:09 -0400] behemphi: So anyone around can help me with knife ec2 server create?  I am totally stopped at this point and would sure appreciate an 'unsticking'
[2013-09-09 22:49:45 -0400] opter: Oops, I got disconnected.. I'm back..
[2013-09-09 22:50:09 -0400] opter: with this recipe  https://github.com/opscode-cookbooks/ark/blob/master/recipes/default.rb, I get lock errors and I would like to implement a retries 5 +  retry_delay 10 in case I get a yum lock timeout issues on Amazon Linux.  What is the best way to go about that?
[2013-09-09 22:59:21 -0400] dgarstang: berkshef keeps giving me 'certificate verify failed'
[2013-09-09 22:59:45 -0400] behemphi: OK, so I did discover using knife ec2 server create that once I download the PEM I have to run ssh-add locally (e.g. > ssh-add ~/.ssh/mykey.pem)
[2013-09-09 23:00:19 -0400] behemphi: And even more exciting if I say:  ssh ubuntu@myserver.com it actually connects
[2013-09-09 23:00:26 -0400] behemphi: But I am still stuck
[2013-09-09 23:00:32 -0400] behemphi: when I run this command:
[2013-09-09 23:00:47 -0400] behemphi: knife ec2 server create -r 'role[sigma_stream_memcached]' -I ami-fbb2fc92 -f m1.small -S boyd-test -N boyd-test -g sg-4f138324 -i devops -x ubuntu
[2013-09-09 23:01:04 -0400] behemphi: the stupid thing does not connect via ssh
[2013-09-09 23:01:11 -0400] behemphi: and asks me for a password
[2013-09-09 23:01:19 -0400] behemphi: so I get no Chef joy
[2013-09-09 23:01:25 -0400] behemphi: People I _need_ my Chef Joy
[2013-09-09 23:01:30 -0400] behemphi: I am soooo sad
[2013-09-09 23:02:00 -0400] behemphi: any hint would be appreciated
[2013-09-09 23:02:11 -0400] opter: did you set your knife file?
[2013-09-09 23:02:32 -0400] mburns: opter https://github.com/mburns/ark/compare/opscode-cookbooks:master...patch-1?quick_pull=1
[2013-09-09 23:02:33 -0400] behemphi: opter not sure what to set in the knife file
[2013-09-09 23:02:42 -0400] behemphi: I did set the AWS secret and id
[2013-09-09 23:02:51 -0400] behemphi: and knife ec2 _launches_ the instance
[2013-09-09 23:02:57 -0400] behemphi: So I think knife.rb is OK
[2013-09-09 23:03:11 -0400] behemphi: when sshd comes up is where the bummer is
[2013-09-09 23:03:32 -0400] behemphi: Well hot snot!!!
[2013-09-09 23:04:00 -0400] behemphi: the `-i devops` was getting in the way after the ssh-add on the pem
[2013-09-09 23:04:02 -0400] ryanisnan: Can someone show me how to specify my chef version when using the omnibus installer (fetched via curl)? http://dpaste.com/1372724/
[2013-09-09 23:04:06 -0400] behemphi: I am all set now!
[2013-09-09 23:04:27 -0400] behemphi: @opter you are my lucky handle :-)
[2013-09-09 23:04:39 -0400] opter: mburns: thank you!
[2013-09-09 23:04:43 -0400] behemphi: behemphi.calepin.com @ryanisnan
[2013-09-09 23:05:04 -0400] behemphi: You might even be like my 5th hit :-)
[2013-09-09 23:05:15 -0400] cstewart: Is there any way to delete an organization in private/enterprise chef?
[2013-09-09 23:06:02 -0400] ryanisnan: http://www.downforeveryoneorjustme.com/http://behemphi.calepin.com/ @ behemphi
[2013-09-09 23:06:43 -0400] mburns: private chef has organizations?
