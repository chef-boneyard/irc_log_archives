[2013-04-12 19:18:21 -0400] msmoyer: jkyle: I tried to go down that route .. keeping nodes in source control and loading them with "knife node from file" but it removes all of the ohai attributes on the chef server..
[2013-04-12 19:21:49 -0400] miah: because ohai attributes are _automatic_ and dynamically defined by the node when it runs
[2013-04-12 19:22:05 -0400] miah: stop making nodes unique snowflakes =)
[2013-04-12 19:22:09 -0400] jkyle: msmoyer: aren't they updated on the first chef-client run
[2013-04-12 19:23:32 -0400] dkador: is there a way to conditionally include one recipe from another?  i.e. I'm authoring a recipe and I want to SOMETIMES include another recipe, but not always?
[2013-04-12 19:24:19 -0400] miah: you can use if/case statements. its ruby.
[2013-04-12 19:25:11 -0400] dkador: fair enough. was wondering if there was a "more appropriate" way to do it in chef.
[2013-04-12 19:25:13 -0400] dkador: thanks.
[2013-04-12 19:25:43 -0400] miah: write actual resource providers and create new classes and call their methods when approrpiate?
[2013-04-12 19:26:41 -0400] crazysim: does chef's notifies not work with vagrant?
[2013-04-12 19:26:48 -0400] crazysim: am i doing something really, really stupid here?
[2013-04-12 19:26:49 -0400] crazysim: https://gist.github.com/5374450
[2013-04-12 19:27:04 -0400] crazysim: bundler doesn't execute after the sync
[2013-04-12 19:29:06 -0400] crazysim: I'm just doing 'vagrant provision'
[2013-04-12 19:33:27 -0400] yfeldblum: dkador, the RIGHT way to do it in chef is: include_recipe "some_recipe" if something > something_else
[2013-04-12 19:34:00 -0400] yfeldblum: dkador, make sure to add a corresponding entry into the metadata
[2013-04-12 19:34:13 -0400] dkador: yfeldblum: for the dependency?  yeah.  thanks!
[2013-04-12 19:34:21 -0400] yfeldblum: dkador, right
[2013-04-12 19:35:10 -0400] yfeldblum: keeping nodes in source-control sounds like an odd idea to me
[2013-04-12 19:36:00 -0400] yfeldblum: certainly appropriate for some cases, but not one i'd usually leap to
[2013-04-12 19:37:04 -0400] adamjk-dev: do people usually use vagrant-butcher to delete clients and nodes from a chef-client run?
[2013-04-12 19:37:04 -0400] adamjk-dev: https://github.com/cassianoleal/vagrant-butcher
[2013-04-12 19:37:10 -0400] adamjk-dev: or, do they do something else?
[2013-04-12 19:48:26 -0400] thasmo: Hello! Could anybody help me with writing a simple shell provisioning script (for vagrant) for upgrading chef-client on a Ubuntu VM? I've figured out to upgrade it by hand on th shell, but I'd like to 'convert' it into solid shell provisioning.
[2013-04-12 19:49:52 -0400] qhartman: thasmo, I just do this: https://gist.github.com/qhartman/5374616
[2013-04-12 19:51:26 -0400] thasmo: qhartman, I've no experience with omnibus and even dunno what it is. My Ubuntu VM has already a chef-client installation installed via apt-get. Would this conflict with the omnibus installation somehow?
[2013-04-12 19:52:32 -0400] qhartman: thasmo, yes, it would. If you want to just upgrade the apt-installed version, just replace my little script snippet with yours (everything between the EOFs) and you should be good
[2013-04-12 19:53:31 -0400] thasmo: qhartman, ye. I was wondering how to ensure that chef *only* gets upgraded, if it's not the latest available version?
[2013-04-12 19:54:04 -0400] qhartman: apt will take care of that for you. if there's nothing to do when you invoke it, it will just exit
[2013-04-12 19:54:43 -0400] thasmo: qhartman, the problem I have with upgrading is that Ubuntu only has an old version available. So I include the opscode repository, but when using the normal "apt-get install" command, there will be errors.
[2013-04-12 19:55:28 -0400] thasmo: so the only way I found is to "apt-get remove" chef and then "apt-get install" it again.
[2013-04-12 19:55:37 -0400] qhartman: sure
[2013-04-12 19:55:41 -0400] thasmo: But I don't want to have this run for every provisioning
[2013-04-12 19:55:55 -0400] aalbertson: I'm sure you guys have received the alert, but cookbook searching on the opscode.com site is broken. an example: http://community.opscode.com/search?query=category%3A%22Monitoring+%26+Trending%22
[2013-04-12 19:56:24 -0400] qhartman: just wrap that in an if block that tests the output of "chef-client --version"
[2013-04-12 19:57:41 -0400] thasmo: qhartman, would you be so kind to paste that for me? Not so fond of shell scripting.
[2013-04-12 20:00:26 -0400] qhartman: really? This is pretty simple, it would be a good thing to learn some scripting on, but, since I'm in a good mood: https://gist.github.com/qhartman/5374679
[2013-04-12 20:01:07 -0400] qhartman: I haven't tested that at all, and it's just off the top of my head, but it should work
[2013-04-12 20:01:32 -0400] thasmo: qhartman, :D ye I guess I should invest some energy in learning some shell scripting after all. :l
[2013-04-12 20:01:38 -0400] thasmo: qhartman, thanks a lot!
[2013-04-12 20:02:05 -0400] qhartman: sure
[2013-04-12 20:02:44 -0400] btm: @opscode cookbook code review, join: http://bit.ly/115ws43,  watch: http://youtu.be/eSufKjGiziw
[2013-04-12 20:06:40 -0400] javmorin: btm: yt?
[2013-04-12 20:21:50 -0400] Wynn: Hi, I'm getting a 500 error when I try to restart chef-server
[2013-04-12 20:22:00 -0400] Wynn: has anyone had a similar problem?
[2013-04-12 20:24:23 -0400] anveo: Any advice on how to deal with auto creating/mounting/formatting ebs volumes?
[2013-04-12 20:25:03 -0400] knuckolls: anveo: https://github.com/opscode-cookbooks/aws/ has ebs lwrps
[2013-04-12 20:25:51 -0400] knuckolls: anveo: you should likely figure out how to use the new IAM roles stuff so you don't have to worry about getting IAM keys deployed to the box. that should let you have access to them via the metadata service
[2013-04-12 20:26:05 -0400] knuckolls: i haven't done it yet, so i can't provide much guidance there :)
[2013-04-12 20:26:09 -0400] Wynn: I'm having this 500 error: Loading init file from /usr/share/chef-server-api/config/init.rb
[2013-04-12 20:26:09 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error
[2013-04-12 20:26:09 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] ERROR: Server returned error for http://localhost:5984/chef/_design/id_map/_view/name_to_id?key=[%22client%22,%22chef-validator%22]&include_docs=true, retrying 1/5 in 3s
[2013-04-12 20:26:10 -0400] Wynn: [Fri, 12 Apr 2013 13:21:31 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error
[2013-04-12 20:28:22 -0400] anveo: knuckolls thanks. I have the IAM stuff setup and have been trying https://github.com/titanous/chef-ebs which uses the aws cookbook
[2013-04-12 20:28:39 -0400] anveo: but it creates a new volume each run so I wasn't sure the proper way to use it
[2013-04-12 20:29:18 -0400] anveo: I guess I'll try more 'manually' with just the aws stuff
[2013-04-12 20:29:34 -0400] knuckolls: anveo: looks to me like the aws cookbook has had a lot of work done to it since i last looked. this chef-ebs cookbook looks like it was filling a gap for deficiencies of the aws cookbook at the time. it used to be pretty sparce.
[2013-04-12 20:30:30 -0400] anveo: chef-ebs deals with filesystems and raiding which is kinda nice
[2013-04-12 20:32:51 -0400] javmorin: btm: are you available to talk about OHAI-434 I just want to clarify things and the email turnaround just takes too long
[2013-04-12 20:34:11 -0400] knuckolls: anveo: an ebs_raid resource is available in the aws cookbook now, with a filesystem flag, with the ec2 consistent snapshot tool
[2013-04-12 20:37:51 -0400] anveo: knuckolls awesome, I was using an 'official' release, I'll use master instead
[2013-04-12 20:40:13 -0400] Wynn: Anyone get this error before?
[2013-04-12 20:40:15 -0400] Wynn: Loading init file from /usr/share/chef-server-api/config/init.rb
[2013-04-12 20:40:15 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error
[2013-04-12 20:40:15 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] ERROR: Server returned error for http://localhost:5984/chef/_design/id_map/_view/name_to_id?key=%5B%22client%22,%22chef-validator%22%5D&include_docs=true,retrying 1/5 in 3s
[2013-04-12 20:40:15 -0400] Wynn: [Fri, 12 Apr 2013 13:21:31 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error;
[2013-04-12 21:00:47 -0400] j^2: that's what i ment
[2013-04-12 21:05:28 -0400] emperorcezar: I'm running a the python cookbook under vagrant, it's not picking up a default attribute
[2013-04-12 21:05:31 -0400] emperorcezar: ?
[2013-04-12 21:06:32 -0400] emperorcezar: I read somewhere that chef-solo doesn't support default attributes?
[2013-04-12 21:09:17 -0400] yfeldblum: emperorcezar, chef-solo supports default attributes
[2013-04-12 21:09:34 -0400] emperorcezar: yfeldblum: That's what I thought
[2013-04-12 21:09:37 -0400] btm: javmorin: here
[2013-04-12 21:10:04 -0400] thasmo: Hey there! When installing chef via "apt-get install chef" it prompts me to enter the Chef Server address. I want to install chef-client without asking me to enter the chef server address. Can I prevent the configuration window somehow? Thanks!
[2013-04-12 21:10:16 -0400] javmorin: btm: I added some bits to the pull request which hopefully resolve your concerns
[2013-04-12 21:10:35 -0400] jameson_: can I not use node's attributes from a provider/resource if I am calling the lwrp from another recipe?
[2013-04-12 21:11:04 -0400] jameson_: (I want to use a node's default attribute as default in a lwrp)
[2013-04-12 21:11:12 -0400] nlloyds: thasmo: try "DEBIAN_FRONTEND=noninteractive apt-get install chef"
[2013-04-12 21:11:33 -0400] thasmo: nlloyds, does that also fit for Ubuntu?
[2013-04-12 21:11:46 -0400] yfeldblum: thasmo, do you have to use apt-get to install chef? there are other ways of installing chef
[2013-04-12 21:11:47 -0400] nlloyds: thasmo: Yes it should
[2013-04-12 21:11:48 -0400] emperorcezar: So then the question is, why would a recipe be getting a blank set of default attributes?
[2013-04-12 21:11:48 -0400] gleam: you can also use a responses file
[2013-04-12 21:11:52 -0400] javmorin: basically now if anything goes wrong it retuns an empty hash
[2013-04-12 21:12:07 -0400] thasmo: nlloyds, k ill try. thx.
[2013-04-12 21:12:23 -0400] gleam: http://wiki.debian.org/DebianInstaller/Preseed
[2013-04-12 21:12:26 -0400] nlloyds: thasmo: I prefer using the omnibus installer. Any reason you need to install it with apt-get?
[2013-04-12 21:12:27 -0400] javmorin: I am not sure I like that, but it's not going to break the ohai run if something goes wrong
[2013-04-12 21:12:44 -0400] thasmo: yfeldblum, maybe. :D chef was/is preinstalled via apt-get so that's why I try to upgrade it via apt-get.
[2013-04-12 21:12:57 -0400] thasmo: nlloyds, see one line above.
[2013-04-12 21:13:07 -0400] nlloyds: makes sense
[2013-04-12 21:13:37 -0400] yfeldblum: thasmo, the way people are typically installing chef now is via the full-stack/isolated installer
[2013-04-12 21:13:45 -0400] thasmo: nlloyds, yfeldblum, but it's only a test/development VM, so I could probably do "apt-get remove chef" and use omnibus to install it?
[2013-04-12 21:14:00 -0400] thasmo: yfeldblum, that is? omnibus?
[2013-04-12 21:14:26 -0400] yfeldblum: thasmo, "omnibus" is a build system; the things it builds are called "full-stack installers" or "isolated installers" or something like that
[2013-04-12 21:14:28 -0400] gleam: omnibus will probably just download a debian package anyway
[2013-04-12 21:14:35 -0400] gleam: or ubuntu package
[2013-04-12 21:15:40 -0400] behemphi: @thasmo, I upgraded from 10.16 to 10.24 (finally) this morning with this command
[2013-04-12 21:15:40 -0400] behemphi: sudo true && curl -L https://www.opscode.com/chef/install.sh | sudo bash -s -- -v 10.24.0
[2013-04-12 21:15:43 -0400] btm: javmorin: looking...
[2013-04-12 21:15:49 -0400] thasmo: i trying to install chef-client 10.18.0 on Ubuntu Raring - so would omnibus also install this version from the opscode repository or jus the "old" available package from the ubuntu repo?
[2013-04-12 21:16:19 -0400] gleam: omnibus would install whatever the latest client version is for that ubuntu release
[2013-04-12 21:16:27 -0400] yfeldblum: thasmo, the installer script at https://www.opscode.com/chef/install.sh simply computes a package URL to download; you don't need to use that script since you can instead just look at it and get the package URL yourself, download it, and `dpkg -i` it
[2013-04-12 21:16:50 -0400] yfeldblum: thasmo, so opscode distributes a .deb of chef, but not via any repository
[2013-04-12 21:16:56 -0400] gleam: i'm not sure that omnibus handles 13.04
[2013-04-12 21:18:38 -0400] thasmo: yfeldblum, I understand. Btw. what is version 10.24.0? Is that the chef server version?
[2013-04-12 21:19:02 -0400] behemphi: @thasmo it is the latest version of the 10.x series
[2013-04-12 21:19:19 -0400] behemphi: and deals with some security issues around json and rubygems if I understand correctly
[2013-04-12 21:19:23 -0400] jtimberman: as of Chef 11, the server and client versions are decoupled as they are maintained totally separately.
[2013-04-12 21:19:23 -0400] thasmo: behemphi, ah I thought 10.18.0 is the latest
[2013-04-12 21:19:32 -0400] behemphi: Nope
[2013-04-12 21:19:34 -0400] behemphi: promise
[2013-04-12 21:20:14 -0400] behemphi: the cmd above is what I used to get the version I wanted b/c I am not quite ready for all the goodness of 11
[2013-04-12 21:20:23 -0400] thasmo: behemphi, is that one outdated then? http://wiki.opscode.com/display/chef/Release+Notes
[2013-04-12 21:20:48 -0400] behemphi: Yes @thasmo the wiki is dying slowly and being replaced by docs.opscode.com
[2013-04-12 21:21:19 -0400] thasmo: behemphi I see. Is there any overview of the versions?
[2013-04-12 21:21:38 -0400] behemphi: if you have the choice (i.e. if you are just getting started" I strongly recommend going straight to 11 @thasmo
[2013-04-12 21:21:41 -0400] jameson_: can I do node["app"]["dir"] in resources/ ?
[2013-04-12 21:21:57 -0400] jameson_: to define default
[2013-04-12 21:22:05 -0400] jameson_: for a lwrp
[2013-04-12 21:22:11 -0400] thasmo: behemphi, I just need it for vagrant provisioning with the available opscode cookbooks.
[2013-04-12 21:22:29 -0400] jtimberman: behemphi: it's okay, we'll offer hugs anyway :)
[2013-04-12 21:23:15 -0400] jtimberman: thasmo: be aware that for cookbooks, we generally move forward, and don't make a lot of effort to maintain compatibility with older chef versions, for a couple reasons.
[2013-04-12 21:23:17 -0400] behemphi: uh oh @jtimberman did I lie?
[2013-04-12 21:23:30 -0400] behemphi: @thasmo here is where I check versions
[2013-04-12 21:23:31 -0400] behemphi: http://rubygems.org/gems/chef
[2013-04-12 21:23:36 -0400] jtimberman: 1. you can use older cookbook versions that work with the older chef versions and modify them locally (since you're not keeping up with "upstream" anyway)
[2013-04-12 21:23:49 -0400] jtimberman: 2. there are bug fixes and features in newer versions of chef that we want to take advantage of.
[2013-04-12 21:23:58 -0400] jtimberman: behemphi: i mean about not using chef 1.
[2013-04-12 21:24:01 -0400] jtimberman: er, chef 11.
[2013-04-12 21:24:28 -0400] jtimberman: jameson_: "not really" because the attribute may not exist at the time the resource file is loaded by chef.
[2013-04-12 21:24:28 -0400] nlloyds: jameson_: I don't think you can and would strongly discourage you from doing so
[2013-04-12 21:24:33 -0400] thasmo: Bit confused now. That means I should use 11 and will have no problems using the opscode cookbooks on github?
[2013-04-12 21:24:46 -0400] jtimberman: don't use the cookbooks directly from the github repositories.
[2013-04-12 21:24:49 -0400] jtimberman: please. do not.
[2013-04-12 21:24:54 -0400] jtimberman: download them from the community site.
[2013-04-12 21:25:06 -0400] jtimberman: this is exactly like getting your rubygems from github instead of rubygems.org.
[2013-04-12 21:25:07 -0400] thasmo: jtimberman, they wont be used in production.
[2013-04-12 21:25:22 -0400] behemphi: y, @jtimberman my cookbook foo is not quite up to snuff yet, but I cannot wait to get there in a couple of months.  I did the new output format, etc.  Its  a great upgrade!
[2013-04-12 21:25:45 -0400] jameson_: @jtimberman should I try to lead it via load_current_resource then?
[2013-04-12 21:25:48 -0400] jameson_: *load
[2013-04-12 21:26:06 -0400] thasmo: jtimberman, but can I use chef-solo 11 with the opscode community cookbooks straight away?
[2013-04-12 21:26:45 -0400] jtimberman: thasmo: yes.
[2013-04-12 21:26:56 -0400] Wynn: Hi, has anyone gotten this error before?
[2013-04-12 21:26:56 -0400] Wynn: Loading init file from /usr/share/chef-server-api/config/init.rb
[2013-04-12 21:26:56 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error
[2013-04-12 21:26:56 -0400] Wynn: [Fri, 12 Apr 2013 13:21:26 -0700] ERROR: Server returned error for http://localhost:5984/chef/_design/id_map/_view/name_to_id?key=%5B%22client%22,%22chef-validator%22%5D&include_docs=true,retrying 1/5 in 3s
[2013-04-12 21:26:56 -0400] Wynn: [Fri, 12 Apr 2013 13:21:31 -0700] INFO: HTTP Request Returned 500 Internal Server Error: os_process_error;
[2013-04-12 21:26:57 -0400] jtimberman: i'm not aware at this time of any breaking issues w/ chef 11 and our cookbooks.
[2013-04-12 21:27:05 -0400] thasmo: jtimberman, okay. And then way to go is installation via omnibus?
[2013-04-12 21:27:12 -0400] jtimberman: thasmo: absolutely yes.
[2013-04-12 21:27:27 -0400] thasmo: jtimberman, alright.
[2013-04-12 21:27:39 -0400] nlloyds: thasmo: If you're using vagrant, check out berkshelf and its vagrant plugin. I'm using with the chef solo provisioner and it works really well.
[2013-04-12 21:27:50 -0400] jtimberman: using distribution packages, while seemingly great, is fraught with "how did you install ruby? which version do you have?" etc, that we don't have when using omnibus :)
[2013-04-12 21:28:02 -0400] jtimberman: nlloyds: and the vagrant-omnibus plugin by schisamo
[2013-04-12 21:28:15 -0400] jtimberman: automatically makes sure the omnibus package is installed.
[2013-04-12 21:28:17 -0400] jtimberman: :)
[2013-04-12 21:28:26 -0400] nlloyds: ahh
[2013-04-12 21:28:41 -0400] jtimberman: jameson_: load_current_resource is there to determine the state of the resource on the system (like, is a package installed or a service running)
[2013-04-12 21:28:57 -0400] thasmo: jtimberman, nlloyds nice - the vagrant base box im using has chef preinstalled. is there a way of replacing it using a ... cookbook or something?
[2013-04-12 21:29:09 -0400] jtimberman: jameson_: i'd use a static value and then use the node attribute on the parameter for the resource in your recipe.
[2013-04-12 21:29:26 -0400] jtimberman: thasmo: uh, depends on the basebox.
[2013-04-12 21:29:30 -0400] thasmo: jtimberman, nlloyds - as I said, the preinstalled one was installed via apt-get.
[2013-04-12 21:29:30 -0400] nlloyds: jtimberman: I've been using bento for my vagrant base boxes. Should I be using something those or something else along with the omnibus plugin?
[2013-04-12 21:30:15 -0400] jameson_: I was hoping to make the resource default not static, but I guess it wouldn't hurt..
[2013-04-12 21:30:15 -0400] jtimberman: nlloyds: i wanted to use the canonical ubuntu baseboxes, e.g., but now they're pre-installing chef (and puppet and juju), with a ruby I don't want to use (ruby 1.8.7)
[2013-04-12 21:30:37 -0400] jtimberman: jameson_: you can also make it default nil and thus make it required :)
[2013-04-12 21:31:09 -0400] thasmo: jtimberman, I'm using those base boxes too. is there any better choice?
[2013-04-12 21:32:03 -0400] jameson_: yeah, that was the other option, but I wanted to isolate the monitoring app settings out from the app
[2013-04-12 21:32:28 -0400] btm: javmorin: if we've run this plugin this far, we should be on EC2. Not having the metadata does evil things to a lot of runs, so we should fail with an explanation if something comes up that we don't know how to handle. I think the code was fine, we just needed a regression test or two. That test isn't actually testing anything and fails if I add a should: https://gist.github.com/btm/136e6082eed1d96a9eb0. Stand by for another gist.
[2013-04-12 21:32:31 -0400] jameson_: (doing uwsgi emperor that watches a directory to launch applications that get registered via uwsgi_add, uwsgi_remove)
[2013-04-12 21:32:55 -0400] jtimberman: thasmo: opscode publishes baseboxes with chef 11.2 installed, but i don't know how much longer we're going to continue. hopefully we can convince upstream distros that provide baseboxes to stop putting any provisioners at all on them, and let vagrant plugins / provisioners handle that.
[2013-04-12 21:33:34 -0400] thasmo: jtimberman, ah k. Guess they do it because the vagrant docs say base boxes should have this installed from the start.
[2013-04-12 21:34:04 -0400] nlloyds: thasmo: These are the ones with 11.2: https://github.com/opscode/bento#current-baseboxes
[2013-04-12 21:34:41 -0400] thasmo: nlloyds, jtimberman - are there any with 13.04 ? :>
[2013-04-12 21:34:49 -0400] thasmo: I mean, Ubuntu
[2013-04-12 21:34:52 -0400] jtimberman: thasmo: they totally do.
[2013-04-12 21:34:54 -0400] javmorin: btm: it actually does test the specific thing being tested which is that the correct version is queried
[2013-04-12 21:35:01 -0400] jtimberman: that is, the docs say that.
[2013-04-12 21:35:18 -0400] jtimberman: but the problem is, everyone paints the "how do i install shit" bikeshed a different color.
[2013-04-12 21:36:02 -0400] c_t: I went with yak colored
[2013-04-12 21:36:12 -0400] javmorin: btm: it's just confirming the url.. that whole test could be removed/skipped because effectively it is also tested in every other test, but I was trying to add a specific test for the version since that was what you were asking for
[2013-04-12 21:36:30 -0400] thasmo: jtimberman, the fun thing is I wrote Ben Howard from Ubuntu an email asking him to preinstall those stuff on the vagrant boxes. Didn't know there's a better way. Doh.
[2013-04-12 21:37:03 -0400] jtimberman: ah ha!
[2013-04-12 21:37:04 -0400] jtimberman: :)
[2013-04-12 21:37:17 -0400] jtimberman: thasmo: at least for chef, vagrant-omnibus is the best thing to use.
[2013-04-12 21:37:46 -0400] javmorin: as to the metadata concern, what would be the appropriate response if there was a failure retrieving the metadata? The existing code had no such mechanism so I didn't have anything to go on
[2013-04-12 21:37:59 -0400] thasmo: jtimberman, are there any raring base boxes with chef 11 preinstalled?
[2013-04-12 21:38:05 -0400] jtimberman: the problem with having puppet on there too, is that puppet will bring in ruby. what if i want to test a ruby app, but i want to use ruby1.9.1? Now I have to work around a 1.8.7 package that wouldn't be there e.g. on a blank server install, or on an EC2 AMI from Caoninical
[2013-04-12 21:38:11 -0400] c_t: if you hadn't noticed, there's also some stuff in bento for firing up what I assume are baseboxes locally
[2013-04-12 21:38:13 -0400] jtimberman: thasmo: don't know
[2013-04-12 21:38:28 -0400] c_t: although *ahem* the debian one is broken
[2013-04-12 21:38:34 -0400] thasmo: jtimberman, but vagrant needs ruby anyway, no?
[2013-04-12 21:38:40 -0400] thasmo: ah wait :D
[2013-04-12 21:38:44 -0400] nlloyds: jtimberman: So, do you have a cookbook to install vagrant and all the plugins you need on your dev machine?
[2013-04-12 21:38:52 -0400] thasmo: not on the VM I guess
[2013-04-12 21:39:34 -0400] dmerrick: what's the general consensus of the best cassandra cookbook to use?
[2013-04-12 21:40:00 -0400] bensix2: so many bens arround, there should be a quota on those things ;)
[2013-04-12 21:40:48 -0400] thasmo: jtimberman, any idea why the opscode baseboxes are 400 MiB big?
[2013-04-12 21:40:56 -0400] monokrome: Does anyone know how to solve this issue? "NameError: Cannot find a resource for mysql_database"
[2013-04-12 21:41:13 -0400] KarlHungus: can i dump the resulting role.json from the role.rb file locally?
[2013-04-12 21:41:14 -0400] jtimberman: thasmo: vagrant does not need ruby in the basebox. and it has its own self-contained installer.
[2013-04-12 21:41:21 -0400] gchristensen: monokrome: have you added depends "mysql" to your cookbook, and updated the metadata?
[2013-04-12 21:41:22 -0400] monokrome: I am trying to create a mysql_database. I have the mysql, database, application cookbooks
[2013-04-12 21:41:23 -0400] nlloyds: monokrome: Do you have the "database" cookbook in your metadata dependencies
[2013-04-12 21:41:25 -0400] KarlHungus: without uploading it?
[2013-04-12 21:41:32 -0400] thasmo: jtimberman, I mean because the ubuntu cloud base boxes are 300 MiB
[2013-04-12 21:41:34 -0400] yfeldblum: dmerrick, s/to use/to learn from/ <--- FIFY
[2013-04-12 21:42:13 -0400] jtimberman: thasmo: the omnibus installer is 140M installed.
[2013-04-12 21:42:19 -0400] monokrome: gchristensen: Nope. Only that specific recipe depends on MySQL, not the entire cookbook...
[2013-04-12 21:42:26 -0400] thasmo: jtimberman, yay.
[2013-04-12 21:42:31 -0400] dmerrick: yfeldblum: so the consensus is to adapt other cookbooks to your needs?
[2013-04-12 21:42:50 -0400] thasmo: jtimberman, thats a lot?!
[2013-04-12 21:43:26 -0400] yfeldblum: dmerrick, it's unlikely that one cookbook will solve all your needs when it comes to installing and configuring a database
[2013-04-12 21:44:37 -0400] dmerrick: :(
[2013-04-12 21:44:39 -0400] thasmo: jtimberman, I never made an own vagrant base box. do you have any idea how long it would take if one knows what he does?
[2013-04-12 21:45:13 -0400] KarlHungus: thasmo: depends entirely on hardware
[2013-04-12 21:45:20 -0400] jtimberman: thasmo: keep in mind that omnibus is everything you need above libc.
[2013-04-12 21:45:27 -0400] KarlHungus: thasmo: 30m to an hour
[2013-04-12 21:45:30 -0400] jtimberman: so yeah, it's a "lot", but is 140 megs really that much in 2013?
[2013-04-12 21:45:39 -0400] yfeldblum: dmerrick, what often happens is at least one of the cookbooks gets you 90% of the way there, but there's a couple important details it doesn't take care of that probably don't matter in the general case anyway, but really matter to you
[2013-04-12 21:45:45 -0400] thasmo: jtimberman, I thought the base box needs to have some things pre confgured? the user "vagrant" etc?
[2013-04-12 21:45:55 -0400] jtimberman: thasmo: that it does.
[2013-04-12 21:46:02 -0400] jtimberman: have you seen veewee?
[2013-04-12 21:46:02 -0400] yfeldblum: jtimberman, why not bundle libc? and an OS while you're at it?
[2013-04-12 21:46:06 -0400] jtimberman: yfeldblum: :P
[2013-04-12 21:46:13 -0400] thasmo: jtimberman, omnibus does that?
[2013-04-12 21:46:42 -0400] jtimberman: yes.
[2013-04-12 21:46:45 -0400] jtimberman: thats its whole point.
[2013-04-12 21:47:00 -0400] jtimberman: gives you ruby, ssl, zlib, gems, and all that happiness.
[2013-04-12 21:47:04 -0400] c_t: yfeldblum: Don't be ridiculous. It's chef, not emacs.
[2013-04-12 21:47:09 -0400] KarlHungus: omnibus installs the full chef stack. bento (or veewee) build vagrant baseboxes and configure the vagrant requirements
[2013-04-12 21:47:17 -0400] thasmo: KarlHungus, I meant more like the process of glueing all together, not the build process itself. I mean I have no experience with veevee etc.
[2013-04-12 21:48:15 -0400] KarlHungus: thasmo: its not hard to grok. its just a dsl for the boot keystrokes, etc. and some shell scripts that are executed as hooks during the install process
[2013-04-12 21:50:00 -0400] thasmo: KarlHungus, jtimberman, what would I need to build a Ubuntu Raring base box using omnibus. I'm on windows here. Any chance? How long would it take me to grasp it? A day? A week?
[2013-04-12 21:50:23 -0400] thasmo: How many hears will I lose? :>
[2013-04-12 21:50:26 -0400] thasmo: hairs
[2013-04-12 21:50:44 -0400] KarlHungus: thasmo: less than an hour
[2013-04-12 21:50:55 -0400] KarlHungus: thasmo: download an existing raring basebox
[2013-04-12 21:51:08 -0400] KarlHungus: run it, install chef 11 omnibus, stop it, export it
[2013-04-12 21:51:19 -0400] KarlHungus: you dont need the full build chain to just modify an existing box
[2013-04-12 21:51:41 -0400] thasmo: KarlHungus, but I wanted to make one on my own, not using an exiting one. because the exiting ones have everything installed already, no?
[2013-04-12 21:51:58 -0400] KarlHungus: you can modify a basebox and export it as a new basebox
[2013-04-12 21:52:14 -0400] spox: yeah, but a lot of times they have extra junk installed on them
[2013-04-12 21:52:36 -0400] spox: which can be annoying when you run thing else where and realize you are missing things that the basebox was providing
[2013-04-12 21:52:37 -0400] thasmo: KarlHungus, ye I know, but I'd have to figure out what to uninstall.
[2013-04-12 21:52:48 -0400] KarlHungus: thasmo: i have no idea how long it will take you to figure out veewee. how long do i spend in the shower each day?
[2013-04-12 21:52:50 -0400] spox: thasmo: have you checked out veewee?
[2013-04-12 21:53:03 -0400] thasmo: KarlHungus, lol :>
[2013-04-12 21:53:08 -0400] spox: it's pretty straightforward, and you just fire it off and mostly wait
[2013-04-12 21:53:13 -0400] thasmo: spox, not yet. Does it run on Windows?
[2013-04-12 21:53:36 -0400] spox: maybe?
[2013-04-12 21:53:44 -0400] KarlHungus: maybe check it out and ask #veewee?
[2013-04-12 21:53:48 -0400] thasmo: spox, is it ruby based?
[2013-04-12 21:53:54 -0400] spox: yep
[2013-04-12 21:54:39 -0400] thasmo: KarlHungus, lets go. You take a shower now and I build a base box with veevee - lets see who's finished faster. ;)
[2013-04-12 21:55:20 -0400] KarlHungus: i'd win because i have bento in jenkins continuously building a half dozen OS's with omnibus on a 400G ramdisk :P
[2013-04-12 21:55:41 -0400] nlloyds: I'd win because I work in the shower
[2013-04-12 21:55:42 -0400] jameson_: that sounds like cheating
[2013-04-12 21:55:46 -0400] thasmo: :D
[2013-04-12 21:56:02 -0400] jameson_: i run my builds on aws because of opsworks :(
[2013-04-12 21:56:02 -0400] KarlHungus: jameson_: we use it as part of our dev workflow
[2013-04-12 21:56:21 -0400] thasmo: KarlHungus, 400G ramdisk. sounds insane. :>
[2013-04-12 21:56:32 -0400] jameson_: but 400G ramdisk is... large.
[2013-04-12 21:56:38 -0400] KarlHungus: just a lower end fusion-io card
[2013-04-12 21:56:49 -0400] thasmo: maybe he means G in sense of Gramm? :>
[2013-04-12 21:57:02 -0400] jtimberman: 400G should be enough ram for anyone
[2013-04-12 21:57:04 -0400] KarlHungus: the next box will just be zpools of ssd's
[2013-04-12 21:57:12 -0400] KarlHungus: jtimberman: its the FS
[2013-04-12 21:57:16 -0400] jameson_: jtimberman, one day someone is going to quote you on that
[2013-04-12 21:57:29 -0400] jtimberman: jameson_: if only i were that famous
[2013-04-12 21:57:48 -0400] behemphi: @jtimberman don't you mean 640gb of memory?
[2013-04-12 21:57:51 -0400] behemphi: :-)
[2013-04-12 21:58:02 -0400] thasmo: so, KarlHungus, jtimberman, to build my own Ubuntu Raring basebox, veevee is the way to go?
[2013-04-12 21:58:04 -0400] KarlHungus: jtimberman: i'll come in for a week and help yall set up the freebsd build system ;)
[2013-04-12 21:58:13 -0400] jtimberman: KarlHungus: ha :)
[2013-04-12 21:58:27 -0400] jtimberman: behemphi: i have to differentiate
[2013-04-12 21:58:44 -0400] KarlHungus: you can send an engineer down to help us button up our chef stuff. it'll be an engineer exchange
[2013-04-12 21:58:44 -0400] behemphi: < wonders if he as "poked the bear"
[2013-04-12 21:59:04 -0400] monokrome: gchristensen: I added depends "mysql" - same issue
[2013-04-12 22:00:42 -0400] jtimberman: KarlHungus: hah. sales@opscode.com ;)
[2013-04-12 22:02:17 -0400] thasmo: guys, thanks for the awesome help/feedback - I'll have a look at veevee/omnibus and stuff. Hopefully I grasp all that. :>
[2013-04-12 22:03:51 -0400] jtimberman: :D
[2013-04-12 22:09:27 -0400] jameson_: btw, was there a betting pool on when Amazon gets OpsWorks to a recent version fo chef?
[2013-04-12 22:11:09 -0400] qhartman: Out of seemingly no where today I'm getting this error when trying to run chef on my centos boxes: https://gist.github.com/qhartman/5375575
[2013-04-12 22:11:26 -0400] qhartman: re-isntalling the chef gem seems to fix it, but it seems weird to me
[2013-04-12 22:12:09 -0400] qhartman: any ideas?
[2013-04-12 22:12:31 -0400] nlloyds: qhartman: How did you install chef? The omnibus installer or a gem?
[2013-04-12 22:13:01 -0400] qhartman: gem
[2013-04-12 22:14:13 -0400] qhartman: these are isntalls that have been working fine for awhile too
[2013-04-12 22:14:28 -0400] nlloyds: hmm what does `gem list chef` give you?
[2013-04-12 22:14:33 -0400] qhartman: the only commonality I've found is that the error message appears after a failed chef-run
[2013-04-12 22:14:55 -0400] qhartman: I've already re-installed on the last one I've found that had the problem
[2013-04-12 22:15:19 -0400] qhartman: let me see if I cn find another one...
[2013-04-12 22:15:52 -0400] qhartman: found one, no local gems matching chef
[2013-04-12 22:15:57 -0400] qhartman: freakin weird....
[2013-04-12 22:16:43 -0400] nlloyds: qhartman: That could happen if ruby had been updated on the machine maybe.
[2013-04-12 22:16:55 -0400] qhartman: hm, that's possible
[2013-04-12 22:17:43 -0400] nlloyds: qhartman: I found switching from gems to the omnibus installer was easy to do and eliminated problems like this, since it uses its own embedded ruby
[2013-04-12 22:18:06 -0400] qhartman: yeah, I've already started doing that on new isntalls
[2013-04-12 22:18:18 -0400] qhartman: notably, I have only seen this on my legacy boxes
[2013-04-12 22:47:16 -0400] blueben: jtimberman: I'm not sure it counts when you replicate a bug without the package that triggers it ;)
[2013-04-12 22:49:31 -0400] jtimberman: blueben: indeed :)
[2013-04-12 22:49:36 -0400] jtimberman: blueben: why is that package installed?
[2013-04-12 22:49:55 -0400] blueben: jtimberman: part of our (and other's, apparently) default image
[2013-04-12 22:50:04 -0400] blueben: lots of things end up depending on lsb
[2013-04-12 22:50:39 -0400] blueben: but more importantly, if omnibus tries to support lsb then it should probably do so properly :D
[2013-04-12 22:51:23 -0400] jtimberman: probably
[2013-04-12 22:51:31 -0400] jtimberman: but is it a problem with the install.sh script?
[2013-04-12 22:52:39 -0400] blueben: yup
[2013-04-12 22:53:18 -0400] blueben: install.sh tries to read a variable out of /etc/lsb-release that is optional, not mandatory
[2013-04-12 22:53:30 -0400] blueben: then fails when it doesn't find it
[2013-04-12 22:53:42 -0400] blueben: see my comment earlier in the ticket
[2013-04-12 22:54:41 -0400] blueben: safest is probably to try using lsb_release, then try reading /etc/distrib-release, then reading /etc/lsb-release
[2013-04-12 22:55:02 -0400] blueben: that should work across all LSB capable operating systems
[2013-04-12 23:02:34 -0400] ranjibd: friday 4, beer time, isn't it ?
[2013-04-12 23:03:31 -0400] monokrome: I'm trying to drop the MySQL 'test' database, create my own, and then create a user - but I get the error that "a resource for mysql_database on ubuntu version 12.04" isn't available
[2013-04-12 23:03:34 -0400] monokrome: https://gist.github.com/monokrome/1e697f00a1b2cc9c5e77
[2013-04-12 23:03:36 -0400] monokrome: Any ideas?
[2013-04-12 23:04:57 -0400] tomdzk: chef server api question, is there a way to access the APIs with just webui credentials, maybe only the read-only parts ?
[2013-04-12 23:06:18 -0400] ranjibd: monokrome:  you have include the database/mysql cookbook?
[2013-04-12 23:06:29 -0400] tomdzk: at least in 10.24, there seem to be no json response handlers in the web ui, but maybe I'm missing something ?
[2013-04-12 23:07:18 -0400] ranjibd: tomdzk: chef server wont do it, you have to use chef-server webui, which will internally use the webui client key to do the rest of the stuff
[2013-04-12 23:07:41 -0400] monokrome: ranjibd: I have inclueded opscode-cookbooks/database and opscode-cookbooks/mysql
[2013-04-12 23:08:35 -0400] ranjibd: you are using the community mysql cookbook>
[2013-04-12 23:08:36 -0400] ranjibd: ?
[2013-04-12 23:08:57 -0400] monokrome: Whatever one opscode-cookbooks/mysql is
[2013-04-12 23:09:14 -0400] monokrome: https://github.com/opscode-cookbooks/mysql
[2013-04-12 23:09:56 -0400] jtimberman: I repeat myself. Please do not use the github repository directly. Download the released cookbook from the community site (knife cookbook site download, berkshelf, librarian, can all do this for you).
[2013-04-12 23:10:58 -0400] ranjibd: monokrome: the mysql_database is provided by the database cookbook
[2013-04-12 23:11:27 -0400] monokrome: ranjibd: I have the database cookbook installed
[2013-04-12 23:11:45 -0400] ranjibd: and included ?
[2013-04-12 23:11:55 -0400] tomdzk: ranjibd: sure, and the controllers in the webui claim to provide json, but I can't figure out how to actually request it
[2013-04-12 23:12:11 -0400] monokrome: jtimberman: knife doesn't work because it requires that I use it on something configured as a chef client
[2013-04-12 23:12:31 -0400] ranjibd: tomdzk: try with the restclient gem and basic http auth..
[2013-04-12 23:12:53 -0400] ranjibd: i have not tried it myself.. so i cant say this will work,, but it might
[2013-04-12 23:12:56 -0400] tomdzk: ranjibd: using httpie, doesn't work, I always get a redirect
[2013-04-12 23:13:36 -0400] ranjibd: tomdzk: what end point you are trying?
[2013-04-12 23:13:54 -0400] tomdzk: getting nodes
[2013-04-12 23:13:57 -0400] tomdzk:  /nodes
[2013-04-12 23:14:15 -0400] tomdzk: but doesn't really matter
[2013-04-12 23:16:38 -0400] monokrome: How can librarian do this?
[2013-04-12 23:16:43 -0400] monokrome: It's documentation is nonexistant
[2013-04-12 23:17:02 -0400] jtimberman: monokrome: not sure what you mean by requiring something configured as a chef client: https://gist.github.com/jtimberman/5375950
[2013-04-12 23:17:13 -0400] jtimberman: unless you were using 'knife cookbook download' vs 'knife cookbook site download'
[2013-04-12 23:18:29 -0400] joemiller: anyone using chef on windows 2012? thoughts?
[2013-04-12 23:18:46 -0400] monokrome: jtimberman: It gives me a bunch of tar.gz file
[2013-04-12 23:18:55 -0400] monokrome: are these able to be used as cookbooks or do I also need to extract them?
[2013-04-12 23:18:59 -0400] thasmo: jtimberman, for now I just apt-get remove chef and reinstall it with the omnibus installer, works well. I was just wondering which would be the best way to check in a shell script IF the "old" apt-get version of chef is installed and THEN install the new version. any idea? thx!
[2013-04-12 23:19:34 -0400] jtimberman: cookbooks are merely directories.
[2013-04-12 23:19:43 -0400] ranjibd: monokrome: yeah.. and you have to unzip them, you can do a knife cookbook site install, which will do a git checkout -b 'vendor-<cookbook>' and then merge it back
[2013-04-12 23:19:47 -0400] jtimberman: we distribute them via the community site via tar.gz
[2013-04-12 23:20:21 -0400] jtimberman: thasmo: sure, you could probably use a vagrant shell provsioner for that
[2013-04-12 23:20:24 -0400] jtimberman: in your vagrantfile
[2013-04-12 23:20:31 -0400] monokrome: jtimberman: I just was wondering why you recommended knife download instead of install
[2013-04-12 23:20:59 -0400] monokrome: oh because /var/chef/cookbooks isn't a directory
[2013-04-12 23:21:08 -0400] monokrome: knife assumes I'm a chef client/master again
[2013-04-12 23:21:35 -0400] thasmo: jtimberman, yes doing that already. but what would be the best way to check if the "apt-get version" of chef is currently installed? if [ ? ] then ...
[2013-04-12 23:23:08 -0400] thasmo: jtimberman, I could probably check for the existence of a file, and after the new installation create that file.
[2013-04-12 23:25:09 -0400] jtimberman: monokrome: no, it assumes that you have a config file.
[2013-04-12 23:25:28 -0400] jtimberman: it needs to know what directory to put your cookbooks in
[2013-04-12 23:25:44 -0400] jtimberman: by default with nothing set, it falls back to the general chef config value for cookbooks, which is /var/chef/cookbooks
[2013-04-12 23:26:20 -0400] monokrome: jtimberman: You'd think that it could just assume .
[2013-04-12 23:26:39 -0400] monokrome: That way it could have consistent behavior with the download command
[2013-04-12 23:28:51 -0400] jtimberman: maybe?
[2013-04-12 23:31:26 -0400] monokrome: jtimberman: That'd make more sense than requiring some unnecessary config file in /etc/ where I potentially don't even have access to
[2013-04-12 23:34:06 -0400] monokrome: I converted all of our cookbooks to using those tar files
[2013-04-12 23:34:10 -0400] monokrome: I'll see if that fixes the issue
[2013-04-12 23:35:38 -0400] jtimberman: You also need to ensure that the cookbooks your cookbooks use (like database or mysql) depend on those in the metadata. So the cookbook that the recipe you gisted above needs to have dependencies defined in the metadata on database and mysql
[2013-04-12 23:35:49 -0400] jtimberman: and any other cookbooks you're using.
[2013-04-12 23:36:23 -0400] monokrome: same issue
[2013-04-12 23:37:34 -0400] monokrome: Cannot find a resource for mysql_database on ubuntu version 12.04
[2013-04-12 23:38:30 -0400] jtimberman: Did you declare a dependency on the database cookbook in your cookbook's metadata?
[2013-04-12 23:38:36 -0400] emperorcezar1: If I call a recipe direction in my vagrantfile, E.g. The python one, it picks up it's default attributes. If I use include_recipe, it does not?
[2013-04-12 23:40:10 -0400] emperorcezar1: I didn't realize that chef was this buggy
[2013-04-12 23:40:29 -0400] monokrome: jtimberman: There is a dependency decalared on mysql and database
[2013-04-12 23:41:35 -0400] holoway: emperorcezar1: I don't understand the question - chef will run all the attribute files for all the cookbooks that might be needed at the beginning of the run
[2013-04-12 23:41:48 -0400] holoway: how is vagrant injecting the cookbooks?
[2013-04-12 23:41:50 -0400] thasmo: jtimberman, btw. I noticed chef 11.4 *knows* the "depends" declaration inside the metadata files, while 10.12.0 e.g. just ignored it. Did I get that correctly?
[2013-04-12 23:42:39 -0400] jtimberman: thasmo: in 11, the dependencies need to be declared in solo in order to ensure that the cookbooks are loaded in the correct (deterministic) order
[2013-04-12 23:42:55 -0400] thasmo: jtimberman, k
[2013-04-12 23:42:57 -0400] emperorcezar1: holoway: If I do, chef.add_recipe "python", it runs fine. If I do chef.add_recipe "my_recipe", in which is a single recipes/default.rb file, which only has in it "include_recipe "python"" it will crash out.
[2013-04-12 23:43:18 -0400] jtimberman: emperorcezar1: does my_recipe's metadata depend on python?
[2013-04-12 23:43:22 -0400] jtimberman: it must.
[2013-04-12 23:43:46 -0400] emperorcezar1: jtimberman: I'll have to check. If that's it, then you are the awesomest
[2013-04-12 23:46:01 -0400] jtimberman: http://docs.opscode.com/breaking_changes_chef_11.html#non-recipe-file-evaluation-includes-dependencies
[2013-04-12 23:46:11 -0400] jtimberman: monokrome: ^
[2013-04-12 23:46:16 -0400] jtimberman: related to your issue, i believe.
[2013-04-12 23:46:48 -0400] holoway: emperorcezar1: yeah, the issue is you aren't dependent on python in my_recipes cookbook metadata
[2013-04-12 23:47:18 -0400] emperorcezar1: holoway: Thanks, that appears to be it.
[2013-04-12 23:48:02 -0400] monokrome: jtimberman: I'm in 10.14.2
[2013-04-12 23:48:05 -0400] monokrome: Is that issue still current?
[2013-04-12 23:48:18 -0400] jtimberman: that is a chef 11 change.
[2013-04-12 23:48:38 -0400] jtimberman: i missed if you said the version you're using earlier.
[2013-04-12 23:49:24 -0400] ranjibd: this point should go to learnchef, everyweek some one will stuck in this same issue, `depends` download the cookbook , makes it available for inclusion, while `include_recipe` actually executes the recipe, also making all the resource/providers available
[2013-04-12 23:51:13 -0400] monokrome: jtimberman: I'm in 10.x
[2013-04-12 23:51:16 -0400] monokrome: I never said the version earlier
[2013-04-12 23:52:40 -0400] log1kal: ranjibd: can you clarify that? if I don't include_recipe a cookbook, it's lwrps and defintions won't be available?
[2013-04-12 23:54:45 -0400] jtimberman: log1kal: no, if you don't declare the dependencies on a cookbook when you use parts of it (like include_recipe, resources, etc)
[2013-04-12 23:55:07 -0400] log1kal: OK, that's what I expected
[2013-04-12 23:55:34 -0400] log1kal: so if I declare 'depends "foo"' the foo cookbook's lwrps et. al. will be available
[2013-04-12 23:55:47 -0400] log1kal: but it won't actually run any recipes from foo
[2013-04-12 23:56:23 -0400] monokrome: jtimberman: 10.x is current "stable" release, right?
