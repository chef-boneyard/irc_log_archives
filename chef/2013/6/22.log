[2013-06-22 00:01:09 -0400] awayne: aspnet/resources/app.rb: attribute :source, :kind_of => String
[2013-06-22 00:01:11 -0400] awayne: myapp/recipes/default.rb: aspnet_app "myapp" do
[2013-06-22 00:01:12 -0400] awayne:  source "somefiles"
[2013-06-22 00:01:14 -0400] awayne:  action :add
[2013-06-22 00:01:15 -0400] awayne: end
[2013-06-22 00:05:42 -0400] cwj: awayne: gist your lwrp resource and provider?
[2013-06-22 00:12:18 -0400] awayne: https://gist.github.com/anonymous/eb061d3824af91a1857b
[2013-06-22 00:15:14 -0400] cwj: hrm
[2013-06-22 00:15:34 -0400] cwj: nothing's jumping out at me
[2013-06-22 00:15:35 -0400] cwj: have you tried changing the name of the source parameter to something else?
[2013-06-22 00:16:00 -0400] cwj: er actually i dont think thats it
[2013-06-22 00:16:10 -0400] cwj: it sounds like @new_resource is nil
[2013-06-22 00:16:18 -0400] cwj: try dropping the @
[2013-06-22 00:18:12 -0400] miah: http://docs.opscode.com/chef/lwrps_custom.html#new-resource
[2013-06-22 00:18:52 -0400] awayne: gosh
[2013-06-22 00:19:01 -0400] awayne: total brain fart
[2013-06-22 00:23:54 -0400] awayne: cwj: thanks a million
[2013-06-22 01:07:03 -0400] vaq: dsds
[2013-06-22 02:02:49 -0400] ningu: say I want to recursively manage permissions in a directory /foo, so that all files are chmod 644 or whatever, but there is one file /foo/bar that I want to always be 600. is there a way to do this with chef and be sure that /foo/bar will not be set to 644 temporarily?
[2013-06-22 04:55:27 -0400] mw__: Hey everyone, which java cookbook do you normally use, the opscode community java cookbook has issues with Ubuntu 12.04, for both openjdk and oracle java?
[2013-06-22 05:31:58 -0400] flaccid: mw__: issues?
[2013-06-22 05:35:50 -0400] mw__: flaccid: for openjdk I get  apt-get -q -y install openjdk-6-jdk=6b24-1.11.4-1ubuntu0.12.04.1 returned 100, expected 0
[2013-06-22 05:41:18 -0400] jtimberman: mw__: apt-get update?
[2013-06-22 05:42:47 -0400] jtimberman: 6b27-1.12.5-1 is the current version.
[2013-06-22 05:42:58 -0400] jtimberman: er wait thats debian 7 :)
[2013-06-22 05:43:45 -0400] jtimberman: 6b27-1.12.5-0ubuntu0.12.04.1
[2013-06-22 05:44:06 -0400] jtimberman: so, basically the same version but whatever ubuntu has changed from Debian's version.
[2013-06-22 05:45:44 -0400] mw__: jtimberman: thanks, let me get chef to run an apt-get update, is this usual making chef run an update for the platform specific package managers, I somehow assumed that would be default, sorry I'm new
[2013-06-22 05:46:23 -0400] jtimberman: mw__: you have to update the apt caches for probably anything you'll want to install at some point. whether you do it with chef (e.g., using opscode's apt cookbook), or during your bootstrap/provisioning process is up to you.
[2013-06-22 05:46:42 -0400] jtimberman: this isn't a problem unique to chef, as far as systems that use apt go.
[2013-06-22 05:46:59 -0400] mw__: got it, thanks
[2013-06-22 05:48:11 -0400] flaccid: jtimberman: apt cookbook can do just an apt-get update only?
[2013-06-22 05:49:43 -0400] mw__: for oracle java, I see that the curl command times out before it can finish the download, any suggestion on how to handle that?
[2013-06-22 05:50:48 -0400] flaccid: jtimberman, mw__ i also made this to upgrade packages, but i wouldn't mind separating the pkg list update https://github.com/flaccid/cookbooks/blob/master/cookbooks/system/recipes/upgrade_packages.rb
[2013-06-22 05:51:23 -0400] flaccid: sounds more like a server side issue mw__
[2013-06-22 05:53:54 -0400] jtimberman: flaccid: you can stick execute "apt-get update" anywhere.
[2013-06-22 05:54:06 -0400] jtimberman: flaccid: the apt cookbook just makes it convenient to do so.
[2013-06-22 05:54:42 -0400] mw__: flaccid: from the output it looks like half of the download is done, maybe the oracle server is just slow, so I'm wondering if I can increase the timeout somehow
[2013-06-22 05:55:13 -0400] jtimberman: mw__: I don't know to be honest. Oracle seems to change the things you have to do in order to download Java from their site on a regular basis. Last I knew it just worked, but they've made a cookie (presuming EULA/ToS acceptance) required (hence the attribute)
[2013-06-22 05:55:58 -0400] jtimberman: mw__: you can download the java package you want directly, stick it on your own HTTP server, and point at that with the right attribute (i don't remember off hand and would have to check the readme)
[2013-06-22 05:57:20 -0400] mw__: for now I'm working in vagrant, wonder if a file:// url will work
[2013-06-22 06:03:58 -0400] mw__: flaccid, jtimberman: thanks for the help :)
[2013-06-22 06:05:16 -0400] jtimberman: sleep time :)
[2013-06-22 06:09:13 -0400] flaccid: jtimberman: i'm wanting to use an existing recipe to do it instead of creating one if thats possible. how does the apt cookbook make it convenient to do so sorry?
[2013-06-22 07:26:58 -0400] mw__: flaccid: just including apt::default in the run list should work, see https://github.com/opscode-cookbooks/apt#default
[2013-06-22 07:28:11 -0400] flaccid: mw__: oh sweet. somehow i had overlooked that, thanks + jtimberman
[2013-06-22 07:36:29 -0400] mw__: flaccid: unfortunately the yum cookbook doesn't do the same thing
[2013-06-22 08:17:43 -0400] flaccid: mw__: i don't think you need to do update pkg list with yum update
[2013-06-22 10:07:31 -0400] flyingbuddha: Hi. I'm trying to install php on a CentrOS 6.4 image (vagrant), I want a specific version 5.3.23 but when I provision, php 5.3.3 is always being installed. I need some help as I'm totally new and can't see what I'm doing wrong. This is my chef-solo provisioning code so far: https://gist.github.com/flyingbuddha/78d902a7326bba3b8ada
[2013-06-22 10:08:01 -0400] flyingbuddha: I'm using this cookbook: http://community.opscode.com/cookbooks/php
[2013-06-22 10:11:06 -0400] flyingbuddha: Is there anyone that could help me debug?
[2013-06-22 11:31:35 -0400] boris66: Hi.
[2013-06-22 11:32:12 -0400] boris66: Whats the best way to manage a bookshelf of cookbooks, when some projects you might need some of them and not others?
[2013-06-22 11:40:23 -0400] MerlinDMC: boris66, berkshelf?
[2013-06-22 11:42:22 -0400] boris66: Isn't that more for managing them for a given project (which might be a subset) ?
[2013-06-22 14:41:31 -0400] njero: Hi all, I am using the built in cron provider. In my chef output I see it run, but the crontab is not updated when I ssh and look at the server. The relevant recipe is here: https://gist.github.com/jeffrafter/8250c3edb9a796583368
[2013-06-22 14:41:56 -0400] njero: anyone know why?
[2013-06-22 14:45:00 -0400] njero: It seems like if the entry is already there is doesn't overwrite
[2013-06-22 14:45:15 -0400] njero: If I manually empty the crontab -e then it runs correctly
[2013-06-22 14:46:26 -0400] cwj: and you're using 'crontab -l -u <user>' to look at the crontab?
[2013-06-22 14:47:01 -0400] cwj: i would start by running chef-client/chef-solo with '-l debug'
[2013-06-22 14:47:10 -0400] cwj: which will give very verbose output
[2013-06-22 14:47:11 -0400] njero: thanks cwj I will try
[2013-06-22 14:48:37 -0400] njero: cwj, I think I figured it out
[2013-06-22 14:48:44 -0400] cwj: nice
[2013-06-22 14:49:50 -0400] njero: I misunderstood... chef wants me to list out *all* of the possible tasks (even ones that are supposed to be removed)... then mark them as removed to action :delete them. But I was thinking whatever I specified would just replace the current crontab
[2013-06-22 14:50:05 -0400] cwj: ah i see
[2013-06-22 14:50:19 -0400] njero: i.e., if I had 10 tasks... then removed a couple, I expected to only have 5 at the end :)
[2013-06-22 14:50:36 -0400] cwj: yeah it wants to manage crontab entries, not the entire crontab
[2013-06-22 14:50:44 -0400] cwj: same thing happens with users
[2013-06-22 14:50:49 -0400] cwj: etc
[2013-06-22 14:50:50 -0400] njero: my approach seems easier, but more dangerous which makes for a good default
[2013-06-22 14:50:54 -0400] njero: yeah makes sense
[2013-06-22 14:51:11 -0400] njero: (I mean the current default, makes more sense than my thinking)
[2013-06-22 14:52:00 -0400] njero: cwj: it is insane to empty the crontab each run and rebuild right?
[2013-06-22 14:53:05 -0400] cwj: i dont think i would take that approach myself
[2013-06-22 14:53:27 -0400] cwj: the chef way favors idempotency, and that would not be idempotent
[2013-06-22 14:54:51 -0400] cwj: is there some other application modifying your crontabs?
[2013-06-22 14:54:55 -0400] njero: what about a task that looks at listed tasks, actual existing tasks, and removes the ones not listed (so it leaves the ones that are there intact)
[2013-06-22 14:55:08 -0400] njero: nothing else manages crontabs... just chef
[2013-06-22 14:56:54 -0400] cwj: so your concern is that other humans will add crontabs outside of chef?
[2013-06-22 14:58:02 -0400] njero: no... I will add tasks (say 10) via chef. Decide that I no longer want one... and then need to :delete it. I would prefer to just remove it from the list and have cron know it should be gone
[2013-06-22 14:58:13 -0400] njero: er *chef know it should be gone
[2013-06-22 14:59:09 -0400] njero: I really only have 3 machines that even use cron... all of the tasks just queue workers that operate on all servers... so I can manage that myself. Or mark them deleted run provisioning, then remove them from the list
[2013-06-22 15:05:02 -0400] cwj: i see what you mean
[2013-06-22 15:05:32 -0400] cwj: it is a little more cumbersome to change the action to  :delete and then later remove the resources entirely
[2013-06-22 15:05:54 -0400] cwj: i see it as a byproduct of the declarative approach
[2013-06-22 15:06:37 -0400] njero: yeah... it is one of those cases where I think chef's approach is right... but it works against my own expectations.
[2013-06-22 15:11:07 -0400] njero: thanks for all of the help and for being around cwj :)
[2013-06-22 15:11:18 -0400] njero: that helped me tons to talk through
[2013-06-22 15:11:19 -0400] cwj: it might be possible to write a cookbook which looks into the chef resource collection and removes any crontabs that dont match cron resources in the collection
[2013-06-22 15:11:30 -0400] cwj: but you'd have to run it last i think
[2013-06-22 15:11:37 -0400] cwj: no problem, happy to help :)
[2013-06-22 15:11:58 -0400] njero: cwj, yeah I think that would be cool... it seems like a general pattern you could apply to certain resources
[2013-06-22 15:30:47 -0400] digitalcake: I'm new to chef and I'm trying to learn it using berkshelf.  I"m stuck that the point of where you make the cookbook for your app chef.run_list = [  "recipe[deployapp::default]" ]
[2013-06-22 15:31:30 -0400] digitalcake: from what I understand you make a book for your app that lists out all the cookbooks you need
[2013-06-22 15:31:58 -0400] digitalcake: is this a correct assumption?
[2013-06-22 16:34:30 -0400] awayne: Is there any guidance on using chef to manage release management? I.e., after the initial chef role deployment, what are the best practices for pushing a custom application update.
[2013-06-22 16:35:19 -0400] awayne: Especially in a multi-node environment. Is anyone using chef to manage removing the node from a load balancer, etc. Or is anyone using another tool along with chef for that?
[2013-06-22 16:36:26 -0400] drrk: awayne: I have seen a writeup of someone doing it with an F5 load balancer
[2013-06-22 16:36:31 -0400] drrk: as they have nice apis
[2013-06-22 16:36:52 -0400] awayne: Yeah, I was reading that earlier. They had written a cookbook for having each node add itself to the pool.
[2013-06-22 16:36:55 -0400] drrk: http://www.opscode.com/blog/2011/07/08/f5/
[2013-06-22 16:36:56 -0400] gchristensen: awayne: release management: I build rpms / debs, have an internal apt repository, and run the update command each release.
[2013-06-22 16:39:21 -0400] awayne: gchristensen: Is your application data-driven?
[2013-06-22 16:44:09 -0400] gchristensen: awayne: some parts of it are
[2013-06-22 16:44:36 -0400] awayne: gchristensen: how do you manage the database upgrade in concert with the app upgrade?
[2013-06-22 16:45:12 -0400] awayne: i guess i'm trying to picture a rolling deployment using chef
[2013-06-22 16:45:59 -0400] awayne: i noticed hulu had an interesting approach
[2013-06-22 16:46:50 -0400] awayne: using deploy_revision and managing symbolic links
[2013-06-22 16:47:01 -0400] awayne: unfortunately, we're in .net on windows
[2013-06-22 16:47:27 -0400] gchristensen: awayne: each deb is shipped with a upgrade utility. on deployment, the utility is run. it prevents multiple upgrades from running at the same time via: 1) open transaction, 2) read latest version in the db_schema table, 3) update the schema, 4) commit - now no other servers will attempt to make he upgrade. 5) the schema gets updated. in hte application code, nothing destructive is done in the same migration.
[2013-06-22 16:47:29 -0400] gchristensen: ie: it'll add columns in one migration and start filling those columns, but not read from those columns. in the next deployment, it'll delete the old columns and use the new ones.
[2013-06-22 16:48:29 -0400] awayne: ahh, yeah, makes sense. you can package that within your deb.
[2013-06-22 16:48:39 -0400] gchristensen: exactly
[2013-06-22 16:48:51 -0400] awayne: i wonder what the windows version of that would be.... :)
[2013-06-22 16:49:16 -0400] gchristensen: deploy_revision is an acceptable way to go :)
[2013-06-22 16:49:39 -0400] gchristensen: I have strict requirements for managing what gets deployed, which is why we use the packages.
[2013-06-22 16:51:02 -0400] awayne: gchristensen: that makes sense
[2013-06-22 16:51:36 -0400] awayne: im desperately trying to avoid building MSI installers or having to choose another deployment engine (octopus, etc) in concert with chef
[2013-06-22 16:51:38 -0400] gchristensen: awayne: note, however, if you use chef for deployments, you have to be safe about your database migrations because it is a rolling release.
[2013-06-22 16:52:24 -0400] awayne: gchristensen: do you have your application load balanced?
[2013-06-22 16:52:27 -0400] gchristensen: yes
[2013-06-22 16:52:48 -0400] awayne: how do you manage disabling the node, doing the upgrade, reenabling?
[2013-06-22 16:53:10 -0400] awayne: within chef? custom script? some outside tool?
[2013-06-22 16:53:19 -0400] awayne: or just let the LB figure it out?
[2013-06-22 16:53:20 -0400] gchristensen: stopping the server causes the load balancer to take it out of rotation for a few minutes, without causing a disruption of service
[2013-06-22 16:53:42 -0400] gchristensen: so stop the server, upgrade the package, start the server, the LB comes back in a moment or two to see if its back up yet
[2013-06-22 16:54:02 -0400] gchristensen: depending on the server you use, you can have it stop gracefully so it finishes existing requests before exiting
[2013-06-22 16:54:20 -0400] awayne: gchristensen: i was hoping you wouldn't say that :) i can't find a graceful way to have IIS shut down without immediately killing any currently processing request
[2013-06-22 16:54:54 -0400] gchristensen: awayne: you may be able to configure your loadbalancer to see the killed connection and forward it to another machine, but that could get real hairy.
[2013-06-22 16:55:23 -0400] gchristensen: but without that being an option, I'd probably use a script on the machine which removes itself from rotation, and then puts itself back in.
[2013-06-22 16:55:54 -0400] gchristensen: awayne: for making MSIs, you could look into how opscode builds their MSIs: https://github.com/opscode/omnibus-chef/blob/master/config/projects/chef-windows.rb / https://github.com/opscode/omnibus-chef / https://github.com/opscode/omnibus-ruby
[2013-06-22 16:56:16 -0400] gchristensen: ^ this is how I make RPMs and debs
[2013-06-22 17:13:49 -0400] gchristensen: has anyone using chef had to deal with setting the default IP to a private network IP in the bootstrap process?
[2013-06-22 17:54:55 -0400] tlr00: Had a question: I am trying to create a not_if condition in my recipe's execute block: I want to NOT run the command if rvm already created 'my-site'. I can't seem to find the library to check against that.
[2013-06-22 18:00:29 -0400] stoked: trying to run the community nginx recipe with chef-solo on centos64
[2013-06-22 18:01:38 -0400] stoked: it errors out on trying find apt cook
[2013-06-22 18:10:34 -0400] jtimberman: stoked: nginx cookbook has a dependency on apt because the nginx upstream repository is managed with the apt cookbook's "apt_repository" resource. fwiw, debian/ubuntu users will encounter the exact same issue for the "yum" dependency as the upstream repo for RHEL platforms is managed with the "yum_repository" resource :).
[2013-06-22 18:11:04 -0400] stoked: just realized that thanks
[2013-06-22 18:11:20 -0400] stoked: i thought the os detection wasnt working
[2013-06-22 18:11:25 -0400] jtimberman: there are numerous tickets and mailing list threads about the issue
[2013-06-22 18:12:12 -0400] jtimberman: nope, metadata dependencies are just data, there's no logic inherent in them. there is specifically a ticket for per-platform support
[2013-06-22 18:12:16 -0400] stoked: ah, was reading the docs on the community page
[2013-06-22 18:13:52 -0400] stoked: I'll submit a pull request to make it clearer in the readme
[2013-06-22 18:22:25 -0400] gregf: using the apt_repository lwrp if I set distribution node['lsb']['codename'] my sources list is missing the code name. If I set to manually to 'squeeze' it works. I logged in and ran ohai and the codename is properly set there. Anyone have ideas what might cause this to happen?
[2013-06-22 18:37:08 -0400] Otterley: gregf, what does "lsb_release -a" output?
[2013-06-22 18:45:29 -0400] gregf: Otterley: http://dpaste.com/1262076/plain/
[2013-06-22 18:45:52 -0400] Otterley: well, you did say that running ohai manually yields the correct data
[2013-06-22 18:46:37 -0400] Otterley: honestly I'm not sure.  we're doing what you are and it works
[2013-06-22 18:47:38 -0400] Otterley: is it possible you're running a cookbook that's writing to that key or its parent key?
[2013-06-22 18:48:08 -0400] gregf: yeah it's making me flip tables at this point. :)
[2013-06-22 18:49:53 -0400] gregf: was running my tests using the kitchen-docker driver. it's the only cookbook add that apt repository for sure. I might need to play with chef-shell and try adding some breakpoints I guess
[2013-06-22 19:03:36 -0400] Otterley: it would be kinda cool if Chef had some way to attach subscribers to mutations so that we could more easily debug who's changing things
[2013-06-22 19:10:18 -0400] cjs226: being that data bags (and roles) aren't versioned, we're looking at expanding to 2 chef servers (prod/non-prod).  is there any possibility of a 'federated' search across multiple chef servers?  how are others dealing with this?
[2013-06-22 19:47:02 -0400] gregf: Otterley: hey gotta run for now, but thanks for the help
[2013-06-22 20:49:40 -0400] orangeroo: My chef server is running, but doesn't appear to be listening on port 4000.  Anything I should look for?
[2013-06-22 20:52:20 -0400] Otterley: how did you install chef-server?  from a gem?  using the installer?
[2013-06-22 20:54:08 -0400] orangeroo: This probably doesn't help, but I didn't install it.
[2013-06-22 20:55:49 -0400] Otterley: well, if it you're running chef-server 11 and it was installed via the omnibus installer, then it's listening on port 443/HTTPS
[2013-06-22 20:56:49 -0400] orangeroo: I know this may seem rediculous, but how do I check my chef server version.  I suspect we're still using some late version of 10.
[2013-06-22 20:58:10 -0400] Otterley: do you have access to the server?
[2013-06-22 20:58:49 -0400] orangeroo: Absolutely.
[2013-06-22 20:59:05 -0400] Otterley: what OS is it running?
[2013-06-22 20:59:29 -0400] orangeroo: Ubuntu.  I'd expect it to be listening on port 4000 which I assume is default.
[2013-06-22 21:00:10 -0400] sniperd: Hi all, I was using node.run_state in chef 10 to store credentials loaded from a databag to get away from loading a databag everywhere and it would give me an "ephemeral" place to store things just for that single run w/o the risk of them getting saved into the node metadata, anything like that for Chef 11?
[2013-06-22 21:00:24 -0400] Otterley: orangeroo: dpkg -l chef-server
[2013-06-22 21:00:39 -0400] Otterley: sniperd, still works in Chef 11
[2013-06-22 21:00:58 -0400] orangeroo: 10.16.6-1
[2013-06-22 21:01:45 -0400] Otterley: orangeroo, is anything listening to port 4000: sudo netstat -nltp | grep 4000
[2013-06-22 21:01:55 -0400] sniperd: Otterley: Oh..... Yep, I was getting FATAL: NoMethodError: undefined method `run_state' for nil:NilClass, so.. that means node. is missing. Gotcha thanks
[2013-06-22 21:02:31 -0400] orangeroo: Otterley:  Nothing on 4000.  That's what has me stumped.
[2013-06-22 21:02:55 -0400] sniperd: Why node is nil is beyond me
[2013-06-22 21:03:00 -0400] Otterley: are any of the chef-server processes running, orangeroo ?
[2013-06-22 21:03:37 -0400] orangeroo: Yeah.  a spawner and a bunch of worker api processes
[2013-06-22 21:03:41 -0400] stormerider: orangeroo: try "sudo netstat -nltp | grep chef" and see if it shows up there
[2013-06-22 21:05:09 -0400] orangeroo: I get a bunch of ports but not 4000.
[2013-06-22 21:05:42 -0400] stormerider: is it possible the person who installed it set it to a different port?
[2013-06-22 21:06:13 -0400] orangeroo: Anything is possible there.  :)
[2013-06-22 21:06:28 -0400] orangeroo: I see that 4000 is defined in the server.rb
[2013-06-22 21:06:43 -0400] orangeroo: but there may be something odd going on.
[2013-06-22 21:06:58 -0400] orangeroo: My server core dumped and died recently.
[2013-06-22 21:07:14 -0400] stormerider: odd. sounds like maybe one of the processes that should be running isnt then. i dont remember 10 enough to remember what the web worker was.
[2013-06-22 21:07:31 -0400] Otterley: me neither :(
[2013-06-22 21:07:46 -0400] Otterley: Chef 10 was a bad memory to me
[2013-06-22 21:11:55 -0400] orangeroo: heh.
[2013-06-22 21:12:12 -0400] orangeroo: Thanks for the input folks.
[2013-06-22 21:20:07 -0400] stormerider: c10 was fine until i went to 12.10, and then solr broke on me. never did get it working again. ended up switching to 11 as a result :)
[2013-06-22 23:06:44 -0400] jtimberman: orospakr: chef 11 does not listen on port 4000
[2013-06-22 23:07:07 -0400] jtimberman: uh, not sure how i ended up putting orospakr on that, but hey. :)
[2013-06-22 23:17:25 -0400] thom: jtimberman: senility?
[2013-06-22 23:17:28 -0400] thom: :P
