[2013-06-08 00:00:32 -0400] timsmith: other than checking chef cache
[2013-06-08 00:32:45 -0400] coderanger: timsmith: You need to check the API
[2013-06-08 00:33:00 -0400] coderanger: timsmith: Checking the cache isn't actually viable, since they are pulled down on demand
[2013-06-08 00:33:19 -0400] timsmith: on execution wouldn't all templates be on the local system?
[2013-06-08 00:33:24 -0400] coderanger: Nope
[2013-06-08 00:33:32 -0400] timsmith: how about this then
[2013-06-08 00:33:46 -0400] timsmith: how would I rescue the resource in a way that I don't get a giant exception in the log
[2013-06-08 00:33:53 -0400] timsmith: like a ignore failure true does
[2013-06-08 00:34:27 -0400] coderanger: You don't :)
[2013-06-08 00:34:30 -0400] atrius`: short of modifying every recipe before i use it, is there a way to set gem_binary globally?
[2013-06-08 00:34:40 -0400] timsmith: I guess I'll stick with ignore_failure then
[2013-06-08 00:34:52 -0400] coderanger: The presence or absence of a file in a cookbook is not something considered to be config data to Chef
[2013-06-08 00:35:04 -0400] coderanger: Use a node attribute or something with the name of the template source to use
[2013-06-08 00:35:12 -0400] timsmith: I might just do that
[2013-06-08 00:35:41 -0400] coderanger: Or go full-out and just make a request to the cookbook API during the compile phase, that will give you a nice list of all known template files :)
[2013-06-08 00:36:08 -0400] alxism: hello.
[2013-06-08 00:36:08 -0400] alxism: I'm getting this error when loading an encrypted data bag item. I double checked the key on the node, also tryed to be explicit about the key file. Knife can decrypt the bag jsut fine.
[2013-06-08 00:36:08 -0400] alxism: "Error decrypting data bag value: 'bad decrypt'. Most likely the provided key is incorrect"
[2013-06-08 00:36:34 -0400] alxism: I'm using chef 11.0.0
[2013-06-08 00:36:40 -0400] coderanger: alxism: are you running the same version of chef everywhere?
[2013-06-08 00:36:53 -0400] coderanger: (we changed the encryption format at one point)
[2013-06-08 00:37:17 -0400] alxism: "knife -v" is v11. Initially my node was running 11.4.4. I downgraded to 11.0.0
[2013-06-08 00:37:31 -0400] alxism: but same issue.
[2013-06-08 00:39:04 -0400] alxism: initially I let knife copied the encryption key to the default location. I also scp'd the key myself.
[2013-06-08 00:39:14 -0400] alxism: same
[2013-06-08 00:45:05 -0400] Liquid--: whats the best way to make every single one of your nodes in chef converge?
[2013-06-08 00:46:31 -0400] coderanger: Liquid--: knife ssh '*:*' sudo chef-client
[2013-06-08 00:48:57 -0400] alxism: still no luck, even with a new node, a new data bag. chef 11.0.0
[2013-06-08 00:56:28 -0400] Liquid--: thank you alxism:
[2013-06-08 01:00:46 -0400] alxism: is it the recommended way of accessing encrypted items:
[2013-06-08 01:00:46 -0400] alxism: info = Chef::EncryptedDataBagItem.load("bag", "item", Chef::EncryptedDataBagItem.load_secret("/etc/chef/encrypted_data_bag_secret"))
[2013-06-08 01:03:13 -0400] alxism: the error occurs when I then do: info['my_attr']
[2013-06-08 01:16:33 -0400] atrius`: well... created a new VM.. made some changes so that the system gem command could be found by sudo (verified with sudo which gem).. and... chef-client is still broken (couldn't find gem) when you try and run it post bootstrap :(
[2013-06-08 01:19:22 -0400] atrius`: this is supposed to work, right?
[2013-06-08 01:59:04 -0400] axsuul: I'm using knife to create a node. Gives me message Created node[test] however with knife node list doesn't show it. The client I'm using has admin privileges (I'm using open source chef server)
[2013-06-08 02:25:14 -0400] axsuul: Nm fixed, wrong API url
[2013-06-08 06:39:38 -0400] gzc: is the postgres::ruby recipe having Issues for anyone else on precise64?
[2013-06-08 08:00:26 -0400] asdf`: hi! The nginx opscode cookbook (and a few others) list things like 'yum' (others list 'dmg' or 'windows') as their dependencies. I'm on debian, so i don't actually need those. How can i use the nginx cookbook? (i'd like to use it to setup its nxensite thing and the nginx_site directive, basically i'm only doing `include_recipe "nginx::commons_script"`)
[2013-06-08 08:01:17 -0400] asdf`: as i see it now, i can either install the yum-and-stuff dependency cookbooks or copy-and-paste code from the opscode nginx cookbook to my own one, both of which i'd like to avoid
[2013-06-08 08:41:24 -0400] jtimberman: asdf`: chef doesn't support per-platform or otherwise conditional dependencies at this time.
[2013-06-08 08:42:09 -0400] jtimberman: asdf`: while it's mildly annoying to have code you don't need/want/use/care about, it's not really doing any harm. the effort to avoid it is far more than the effort (which is nothing) of letting it "just work"
[2013-06-08 08:44:24 -0400] jtimberman: asdf`: there's numerous threads on the mailing list about this topic. two this week in fact: http://lists.opscode.com/sympa/arc/chef/2013-06/msg00042.html and http://lists.opscode.com/sympa/arc/chef/2013-06/msg00074.html - the latter has links to various tickets about the topic.
[2013-06-08 09:42:39 -0400] axyelp1: can i execute a chef-run on a node using a chef-shell script?
[2013-06-08 09:57:03 -0400] axyelp: ummm,. is there any way i can execute a chef-run on a node from my workstation using a chef-shell script?
[2013-06-08 12:47:34 -0400] gianarb: hi! sorry where is a standard log of chef?
[2013-06-08 12:47:34 -0400] gianarb: thanks :)
[2013-06-08 13:20:16 -0400] renchap: :win 55
[2013-06-08 14:07:24 -0400] atrius`: is chef client automatically set up to run every so often or is that a post install step?
[2013-06-08 14:42:12 -0400] stormerider: atrius`: if you use the chef-client cookbook you can manage that. if it runs via init, i believe it runs every 30m by default.
[2013-06-08 14:47:54 -0400] pikesley: atrius: https://github.com/theodi/cuke-chef/blob/master/roles/certificate.rb#L10 for ex.
[2013-06-08 14:48:20 -0400] pikesley: so that runs it every 5 minutes out of cron
[2013-06-08 17:05:24 -0400] three18ti_: hello, I'm having trouble with the ohai "hostname" plugin for solaris2.  When I run `hostname` my hostname shows up as "abc123", however, when I run sudo chef-client my node_name is listed as "abc123." since this is not a host name in chef the node is failing to authenticate.
[2013-06-08 17:06:13 -0400] three18ti_: how can I fix that?
[2013-06-08 17:06:17 -0400] siezer: hrm?
[2013-06-08 17:06:57 -0400] three18ti_: at least, I think it's the ohai "hostname" plugin for solaris2
[2013-06-08 17:06:58 -0400] siezer: what does ohai fqdn say
[2013-06-08 17:07:28 -0400] three18ti_: "abc123."
[2013-06-08 17:07:40 -0400] siezer: with the dot
[2013-06-08 17:07:42 -0400] three18ti_: note the period at the end of the hostname.
[2013-06-08 17:07:45 -0400] three18ti_: yes.
[2013-06-08 17:08:07 -0400] siezer: so
[2013-06-08 17:08:47 -0400] siezer: when you bootstrap a node, and do not specify a node_name (knife bootstrap 1.2.3.4 -N i_set_the_node_name), it will use the fqdn attribute as the node_name
[2013-06-08 17:08:54 -0400] siezer: the hostname is irrelevant
[2013-06-08 17:09:20 -0400] siezer: this will use /etc/chef/validation.pem to register a new node/client in chef-server
[2013-06-08 17:09:25 -0400] siezer: knife node list ; knife client list
[2013-06-08 17:09:41 -0400] siezer: the public half of the "client" key is what's in "knife client list"
[2013-06-08 17:09:50 -0400] siezer: and the secret half is now in /etc/chef/client.pem
[2013-06-08 17:10:33 -0400] three18ti_: my node is listed as "abc123" if I do a 'knife node list | grep `hostname`' are you saying that's irrelevant?
[2013-06-08 17:10:41 -0400] siezer: so, it will try to authenticate to chef-server as the value if node_name in /etc/chef/client.rb, using the contents of /etc/chef/client.pem to sign the requests
[2013-06-08 17:11:04 -0400] siezer: maybe its different on solaris
[2013-06-08 17:11:19 -0400] siezer: but on line, it defaults to the fqdn attribute
[2013-06-08 17:11:26 -0400] three18ti_: so, can I just set 'node_name abc123' in /etc/chef/client.rb?
[2013-06-08 17:11:34 -0400] siezer: is there an "abc123." node?
[2013-06-08 17:11:36 -0400] three18ti_: (that variable is not currently set)
[2013-06-08 17:11:44 -0400] three18ti_: no there is not an abc123. node.
[2013-06-08 17:12:01 -0400] siezer: try this
[2013-06-08 17:12:29 -0400] siezer: for i in client node ; do knife $i delete -y abc123 ; done
[2013-06-08 17:12:42 -0400] siezer: then on your solaris node, rm /etc/chef/client.pem
[2013-06-08 17:12:54 -0400] siezer: then do chef-client -j /etc/chef/first-boot.json
[2013-06-08 17:13:08 -0400] siezer: that'll usually fix it
[2013-06-08 17:14:01 -0400] three18ti_: does that expect there to be an /etc/chef/first-boot.json or will that create it?
[2013-06-08 17:15:08 -0400] siezer: yea
[2013-06-08 17:15:13 -0400] siezer: how was the node bootstrapped in the first place?
[2013-06-08 17:15:28 -0400] three18ti_: unknown.
[2013-06-08 17:15:32 -0400] siezer: okay
[2013-06-08 17:15:50 -0400] three18ti_: I'm new here and was tasked with "updating" or "fixing" a few servers.
[2013-06-08 17:15:57 -0400] siezer: o i c
[2013-06-08 17:16:00 -0400] three18ti_: :)
[2013-06-08 17:16:09 -0400] siezer: and chef-client is just broken
[2013-06-08 17:16:31 -0400] three18ti_: not my first rodeo with chef but they kinda threw me in the deep end.
[2013-06-08 17:16:34 -0400] three18ti_: yea, exactly.
[2013-06-08 17:16:40 -0400] siezer: okay well in that case
[2013-06-08 17:16:42 -0400] siezer: do this
[2013-06-08 17:17:07 -0400] siezer: knife node show "abc123." -L -Fjson > abc123.node.json
[2013-06-08 17:17:27 -0400] siezer: to back up the node object "just in case"
[2013-06-08 17:17:59 -0400] siezer: there should be a run_list in there
[2013-06-08 17:18:20 -0400] siezer: normally, when you bootstrap a node, you do it with knife
[2013-06-08 17:18:24 -0400] three18ti_: gotcha. then do `chef-client -j abc123.node.json`
[2013-06-08 17:18:34 -0400] siezer: knife node boostrap 1.2.3.4 -r 'recipe[whatever]'
[2013-06-08 17:18:52 -0400] siezer: 'recipe[whatever]' ends up in /etc/chef/first-boot.json
[2013-06-08 17:19:09 -0400] siezer: and at the end of the bootstrap script, it calls chef-client -j /etc/chef/first-boot.json
[2013-06-08 17:19:33 -0400] siezer: it sounds like somewhere along the line, somebody was doing weird manual things with the keys and got their wires crossed
[2013-06-08 17:19:51 -0400] three18ti_: would not surprise me.
[2013-06-08 17:20:33 -0400] three18ti_: there's an effort to migrate from cfengine to chef so most (if not all) the servers in the DC are running both...
[2013-06-08 17:20:47 -0400] siezer: also, just as a protip in general, set your nodes' hostnames to something.fqdn.com like god intended. then always use fqdns everywhere, all the time, always
[2013-06-08 17:20:57 -0400] siezer: ooOoh
[2013-06-08 17:21:37 -0400] siezer: in that case I'd strongly recommend reverse engineering nodes into fresh chef policy that can be applied just after a jumpstart
[2013-06-08 17:21:55 -0400] siezer: for all nodes that are ephemeral (aka don't contain datasets you want to keep)
[2013-06-08 17:23:20 -0400] siezer: you can sell the work as "verification of a DR strategy" ;)
[2013-06-08 17:24:41 -0400] three18ti_: well... unfortunately, I don't think that's within the scope of my task...  this is my first "corporate" datacenter and I'm finding my hands a bit... tied...  you're probably right though, that likely would make my life easier...
[2013-06-08 17:25:32 -0400] siezer: well be careful then
[2013-06-08 17:25:49 -0400] siezer: use --why-run before applying policy to a system in an unknown state
[2013-06-08 17:26:06 -0400] siezer: but don't trust it %100, especially if there is a lot of output
[2013-06-08 17:27:50 -0400] three18ti_: use --why-run as a flag to knife or chef-client?
[2013-06-08 17:30:02 -0400] siezer: chef-client
[2013-06-08 17:30:21 -0400] siezer: it's chef's "dry-run"
[2013-06-08 17:30:41 -0400] three18ti_: gotcha.  awesome!  Thanks siezer!  you've atleast given me a direction to go.
[2013-06-08 17:30:51 -0400] siezer: no problem
[2013-06-08 17:30:53 -0400] siezer: good luck!
[2013-06-08 17:31:55 -0400] three18ti_: hey, when i do 'knffe node show `hostname` -Fjson > node.json' that will include all of the current recipies, yea?
[2013-06-08 17:32:25 -0400] siezer: yep
[2013-06-08 17:32:46 -0400] three18ti_: can I drop the "-r Recipie['foo']" from the bootstrap stage then?
[2013-06-08 17:33:04 -0400] siezer: well youd want -r 'recipe[foo]' but yea
[2013-06-08 17:33:05 -0400] three18ti_: just do a `knife bootstrap node`
[2013-06-08 17:33:16 -0400] siezer: bash will expand double quotes and get confused by the brackets
[2013-06-08 17:33:26 -0400] siezer: s/bash/yourshellhere/
[2013-06-08 17:33:42 -0400] three18ti_: (don't even get me started... on yourshellhere...)
[2013-06-08 17:34:58 -0400] three18ti_: hehe... I'm buying!
[2013-06-08 17:35:07 -0400] three18ti_: or rather:
[2013-06-08 17:35:12 -0400] three18ti_: i I'm buying
[2013-06-08 17:43:53 -0400] three18ti_: siezer: can I do `knife bootstrap abc123 -j abc123.node.json or should I copy abc123.node.json to /etc/chef/first-boot.json?
[2013-06-08 17:45:21 -0400] three18ti_: or maybe "knife bootstrap abc123 -j `cat abc123.node.json`"
[2013-06-08 17:49:27 -0400] siezer: no
[2013-06-08 17:49:37 -0400] siezer: manually example the node.json
[2013-06-08 17:49:45 -0400] siezer: and see what's in the run_list entry
[2013-06-08 17:50:06 -0400] three18ti_: role[base]
[2013-06-08 17:50:08 -0400] three18ti_: is all
[2013-06-08 17:50:19 -0400] siezer: then, from a workstation that is NOT the machine you're trying to manage with chef
[2013-06-08 17:50:20 -0400] siezer: do
[2013-06-08 17:50:41 -0400] siezer: knife node bootstrap ip.of.ma.chine -r 'role[base]'
[2013-06-08 17:50:54 -0400] siezer: you may have to do
[2013-06-08 17:51:00 -0400] siezer: -x root -Prootpass
[2013-06-08 17:51:16 -0400] siezer: or -x someuser --sudo
[2013-06-08 17:51:19 -0400] three18ti_: no root pass...
[2013-06-08 17:51:23 -0400] three18ti_: sudo
[2013-06-08 17:51:25 -0400] three18ti_: cool.
[2013-06-08 17:51:33 -0400] three18ti_: -x root --sudo
[2013-06-08 17:51:49 -0400] siezer: -x == "ssh into the machine as this user"
[2013-06-08 17:52:05 -0400] three18ti_: ok, so -x myuser --sudo
[2013-06-08 17:52:09 -0400] siezer: yea
[2013-06-08 17:52:09 -0400] three18ti_: 10-4
[2013-06-08 17:52:28 -0400] siezer: if you don't have myuser's ssh key in your keychain you'll need to give it a password
[2013-06-08 18:03:38 -0400] three18ti_: grr... here's a good one, I don't have the validator.pem...  where can I download that?  I would think "Organlizations -> manage account" but that takes me to a "page not found"
[2013-06-08 18:08:56 -0400] three18ti_: actually, I found one...
[2013-06-08 18:10:07 -0400] siezer: word. afkforabit
[2013-06-08 18:16:42 -0400] three18ti_: is there a way to tell chef where sudo is?
[2013-06-08 18:16:57 -0400] three18ti_: e.g. sudo is in /usr/local/bin/sudo
[2013-06-08 18:18:05 -0400] three18ti_: so when I say knife bootstrap node -x myuser --sudo there isn't one...
[2013-06-08 18:20:02 -0400] three18ti_: shit. back to hostname = 'abc123.'
[2013-06-08 18:24:53 -0400] NIMESH: hi...
[2013-06-08 18:27:46 -0400] coderanger: NIMESH: haldo
[2013-06-08 18:40:14 -0400] three18ti_: so... when I do my bootstrap, chef is creating an empty /etc/chef/validator.pem , even if I copy the key from another location, every time I run the bootstrap it overwrites my validator then bails out saying it's an invalid key...
[2013-06-08 18:46:30 -0400] siezer: reset your org's validation key in the chef-server webui
[2013-06-08 18:47:16 -0400] siezer: here's the bootstrap script
[2013-06-08 18:47:16 -0400] siezer: https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb
[2013-06-08 18:47:32 -0400] siezer: that's rendered locally on your workstation and shoved down the ssh pipe that knife bootstrap sets up
[2013-06-08 18:48:35 -0400] three18ti_: that would invalidate the orgs validation key for everyone though...  that would mean everyone has to download a new copy....  I dunno that I could organize that (read: I don't want to make a lot of people mad at me )
[2013-06-08 18:48:58 -0400] siezer: well sneakernet it from somebody who has a working copy
[2013-06-08 18:49:13 -0400] siezer: its the moral equivelent of a shared wifi password
[2013-06-08 18:50:29 -0400] coderanger: three18ti_: You need to have the validation key setup on your workstation
[2013-06-08 18:50:38 -0400] coderanger: with the correct path to it setup in knife.rb
[2013-06-08 18:50:38 -0400] coderanger: the bootstrap copies it from your machine to the target
[2013-06-08 18:50:48 -0400] three18ti_: hehe... have you ever changed a wifi password in a big organization?
[2013-06-08 18:50:59 -0400] three18ti_: coderanger: it is.
[2013-06-08 18:51:09 -0400] three18ti_: could the perms be wrong on my validation key?
[2013-06-08 18:51:30 -0400] three18ti_: e.g. I have ~/.chef/org-validator.pem set to 600
[2013-06-08 18:51:31 -0400] siezer: the wpa2-enterprise version of validator.pem is being worked on iirc ;)
[2013-06-08 18:54:17 -0400] three18ti_: yes. that appears to be exactly the problem...
[2013-06-08 18:54:24 -0400] coderanger: three18ti_: As long as the user running knife can read it ...
[2013-06-08 18:54:55 -0400] three18ti_: changing perms to 666 allowed the bootstrap to run
[2013-06-08 19:04:54 -0400] three18ti_: I dunno... boogey men.
[2013-06-08 19:05:09 -0400] three18ti_: you guys rock though! Thanks so much for your help siezer and coderanger
[2013-06-08 20:08:42 -0400] gianarb_: hi sorry can you help me? i have problem with vagrant + chef
[2013-06-08 20:08:43 -0400] gianarb_: https://gist.github.com/GianArb/5736395
[2013-06-08 20:08:49 -0400] gianarb_: chef solo provisioner:
[2013-06-08 20:08:50 -0400] gianarb_: * The following settings don't exist: add_repice
[2013-06-08 20:09:00 -0400] gianarb_: but i don't understand why this error
[2013-06-08 20:28:27 -0400] miah: well, repice isn't how you spell recipe. but also where are you defining that?
[2013-06-08 21:23:22 -0400] atrius`: earlier i asked about chef-client running automatically.. i'm a little surprised that the bootstrap doesn't set that up
[2013-06-08 21:30:02 -0400] coderanger: atrius`: Such things are too variable
[2013-06-08 21:30:10 -0400] coderanger: use the chef-client cookbook
[2013-06-08 21:30:53 -0400] atrius`: coderanger: okay, i was just looking at that :)
[2013-06-08 21:31:12 -0400] atrius`: so in general, i should probably bootstrap a system with at least chef-client in the run list?
[2013-06-08 21:33:03 -0400] ssd7: atrius`: Depends on your use case.  For me the end goal usually looks something like: knife bootstrap IPADDR -r 'role[base], role[appserver]'
[2013-06-08 21:33:31 -0400] ssd7: so after bootstrap the machine is fully configured
[2013-06-08 21:33:44 -0400] atrius`: would not role[base] include chef-client for future changes?
[2013-06-08 21:33:56 -0400] ssd7: atrius`: Yup, it would
[2013-06-08 21:34:00 -0400] coderanger: atrius`: Some people prefer to run chef-client manually via something like rundeck, fabric, or capistrano
[2013-06-08 21:34:05 -0400] atrius`: okay, that makes sense
[2013-06-08 21:34:20 -0400] atrius`: coderanger: for application deployments andw hat not?
[2013-06-08 21:34:25 -0400] atrius`: what not*
[2013-06-08 21:34:39 -0400] coderanger: Or just for very tight control over rolling out changes
[2013-06-08 21:34:56 -0400] coderanger: If you have an internal package repo, 10k servers upgrading that package at the same time would be ... bad
[2013-06-08 21:35:22 -0400] atrius`: true
[2013-06-08 21:35:34 -0400] coderanger: and we have our new pushy orchestration system on the horizon :)
[2013-06-08 21:35:44 -0400] coderanger: sorry, "Opscode Push Jobs"
[2013-06-08 21:35:55 -0400] coderanger: because marketing doesn't let us have fun with silly puns anymore :P
[2013-06-08 21:36:39 -0400] atrius`: lol... we have a guy in our company that keeps wanting to use 'enterprise' sounding hostnames.. i think it really bugs him that when we moved to our new environment we based the names on GoT :D
[2013-06-08 22:01:48 -0400] robertkowalski: hi
[2013-06-08 22:02:43 -0400] robertkowalski: i am trying test-kitchen and get an error when it tries to install busser on the vm
[2013-06-08 22:03:57 -0400] robertkowalski: https://gist.github.com/robertkowalski/024ed55a0e48be6b2e2e
[2013-06-08 22:04:46 -0400] robertkowalski: anyone has an idea?
