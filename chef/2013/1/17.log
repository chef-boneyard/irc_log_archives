[2013-01-17 00:11:13 -0500] koblas: trying to get Chef + CloudFormation + Hosted working - it looks like my .rb files are not getting copied into the cache or are getting removed during the run.
[2013-01-17 00:17:32 -0500] WPsites: If I need to store things like specific settings for apache and nginx for one of my clients, should that info be stored in a role or should I use an environment?
[2013-01-17 00:17:58 -0500] WPsites: a role doesn't seem to cut it due to attribute order
[2013-01-17 00:20:09 -0500] kreedy: i'm having issues with the application and application_ruby cookbooks. I'm trying to run some things in the before_migrate, before_symlink, etc blocks, which the application cookbook states you can do.
[2013-01-17 00:20:24 -0500] kreedy: They never run. I'm wondering if that is because application_ruby overrides them
[2013-01-17 00:20:41 -0500] kreedy: aka, is this a bug or expected behavior?
[2013-01-17 00:28:42 -0500] josephholsten: ugh. why does rhel require nrpe be installed via source?
[2013-01-17 00:31:04 -0500] miah: because they don't package it?
[2013-01-17 00:31:16 -0500] josephholsten: it's in epel
[2013-01-17 00:31:28 -0500] miah: im not sure the nagios cookbook uses epel
[2013-01-17 00:31:42 -0500] josephholsten: I'm checking the version, but it's nagios. does anyone expect it to not be ancient?
[2013-01-17 00:33:13 -0500] josephholsten: epel: 1.4.16. precise: 1.4.15
[2013-01-17 00:33:25 -0500] josephholsten: hmm
[2013-01-17 00:34:36 -0500] josephholsten: I was really wanting to use nagios plugin checks in my minitests
[2013-01-17 00:40:36 -0500] miah: nrpe is basically deprecated. no code updates for > 5 years
[2013-01-17 00:40:47 -0500] miah: look at sensu
[2013-01-17 00:40:59 -0500] josephholsten: yes. so +1.
[2013-01-17 00:53:43 -0500] timsmith: josephholsten: I have a bug open in my bucket to add the EPEL packages to RHEL for Nagios and make it the default
[2013-01-17 00:54:04 -0500] timsmith: josephholsten: I ran that in an environment of mine and it worked fine
[2013-01-17 00:54:30 -0500] timsmith: josephholsten:  There are a few changes that have been merged that allow for RHEL
[2013-01-17 00:55:10 -0500] timsmith: josephholsten:  Debian and RHEL call NRPE different things.  Debian uses the wrong name (nagios-nrpe-server vs. nrpe)
[2013-01-17 01:04:55 -0500] abetterlie_: does anyone know how to specify a cookbook source other than the opscode repo with test-kitchen?
[2013-01-17 01:05:03 -0500] abetterlie_: or know where berkshelf support is?
[2013-01-17 01:05:19 -0500] pwelch: does anyone know of a project that uses vagrant to spin up a chef-serve and client to test cookbooks? I know I have heard people talk about it but wanted to know if there are any projects out there before I go building my own
[2013-01-17 01:05:37 -0500] abetterlie_: I tried site in Cheffile but it doesn't seem to do anything
[2013-01-17 01:11:23 -0500] miah: win 9
[2013-01-17 01:12:04 -0500] miah: pwelch: https://github.com/chef-workflow
[2013-01-17 01:13:25 -0500] pwelch: miah: which repo should I take a look at?
[2013-01-17 01:13:43 -0500] miah: the top one
[2013-01-17 01:13:52 -0500] miah: chef-workflow
[2013-01-17 01:16:38 -0500] pwelch: miah: thanks, I'll take a look at it
[2013-01-17 01:24:45 -0500] josephholsten: timsmith: do you have a ticket/pull req for that?
[2013-01-17 01:27:04 -0500] timsmith: josephholsten:  I have a ticket.  I'll try to get to it in the next week or so.
[2013-01-17 01:27:27 -0500] timsmith: josephholsten:  It's more than just the EPEL part.  The init script is debian specific and the entire cookbook assumes nagios-nrpe-server not nrpe
[2013-01-17 01:29:32 -0500] josephholsten: sure. it needs to be rewritten to encourage nsca as well.
[2013-01-17 01:29:55 -0500] josephholsten: and have all the default checks removed (and documented as examples)
[2013-01-17 01:32:57 -0500] TheDeveloper___: n00b question here - if I've got a recipe which loops over node[:arrayProperty].each { |hash| bash "doSomething" do .. end } how can I make it so it binds the hash variable scope when the script comes to execute? At the moment it just uses the same value for each iteration of the loop
[2013-01-17 01:33:02 -0500] timsmith: I'd really like to just take our the NRPE client functionality from the Nagios server.  They're not the same and they shouldn't be in one cookbook
[2013-01-17 01:38:43 -0500] miah: i agree. hopefully lwrp's will be built out too
[2013-01-17 01:42:27 -0500] timsmith: well the NRPE LWRP already exists.  That's why including every check under the sun out of the box is really silly.  Prior to today the README still told people to go modify the ERBs to add their checks.  It should come with just the Nagios server monitored and everything else should be added via the LWRP on the client side and the nagios_services databag on the server side
[2013-01-17 01:44:22 -0500] miah: exactly
[2013-01-17 01:47:54 -0500] jtran: using chef, for a recipe i designated a 'service' resource which just has a start_command and a stop_command specified because it doesn't have upstart/init scripts.  Using knife, is there a way to initiate the stop-command or start command across all nodes that have that recipe installed?
[2013-01-17 01:47:57 -0500] jtran: other than using ssh
[2013-01-17 01:49:00 -0500] timsmith: ssh is really your only option.  Chef really isn't a command/control system
[2013-01-17 01:49:29 -0500] jtran: that's what i figured. thx for clarifying
[2013-01-17 02:15:47 -0500] djwonk: when I try 'knife cookbook upload erlang' it says erlang depends on 'yum'. but I'm on Ubuntu.
[2013-01-17 02:16:10 -0500] djwonk: should I specify the architecture somehow? what did I overlook reading?
[2013-01-17 02:18:48 -0500] djwonk: and 'java' wants 'windows'. that's not cool
[2013-01-17 02:20:33 -0500] djwonk: based on http://tickets.opscode.com/browse/COOK-1629 I think erlang needing yum is a cookbook problem, not something I did wrong
[2013-01-17 02:27:21 -0500] djwonk: why does 'nginx' require 'ohai'? doesn't every recipe, more or less, use ohai?
[2013-01-17 02:27:46 -0500] djwonk: I mean, why is nginx the first cookbook to ask for it specifically?
[2013-01-17 02:30:51 -0500] tomdzk: djwonk: the cookbook includes an ohai plugin (https://github.com/opscode-cookbooks/nginx/blob/master/recipes/ohai_plugin.rb)
[2013-01-17 02:31:55 -0500] djwonk: tomdzk: thanks, I see know that chef has ohai by default. the 'ohai' recipe provides ohai plugins. perhaps its name is confusing to beginners.
[2013-01-17 02:32:14 -0500] djwonk: know->now
[2013-01-17 02:46:23 -0500] cphrmky: hello all, wondering if someone could clear up for me the best way to extend a library method that's in another cookbook
[2013-01-17 02:46:44 -0500] cphrmky: not sure if there's a way to load the lib from the other cookbook and I can just make the change there?
[2013-01-17 02:47:08 -0500] cphrmky: or if I can extend it somehow in the library files in the cookbook that i'd like to call it from
[2013-01-17 02:55:22 -0500] timsmith: djwonk:  Chef doesn't support platform specific dependencies for cookbooks so you'll get cookbook dependencies being pulled in for RHEL and Windows a lot.  They never actually execute, but the rb files cache on your system.  You can always just comment out those lines in the metdata.rb file
[2013-01-17 02:59:02 -0500] jtran: timsmith:  back to the subject of service resource's stop_command and start_command,   when does the stop_command come into play?
[2013-01-17 03:00:31 -0500] cphrmky: wondering if someone could point me to the best way to use library method that's in another cookbook
[2013-01-17 03:00:41 -0500] cphrmky: not sure if there's a way to load the lib from the other cookbook
[2013-01-17 03:02:21 -0500] cphrmky: I've been looking through the docs and I can't find anything that's helping me.
[2013-01-17 03:02:58 -0500] cphrmky: Or maybe this isn't something I should be doing ?  I'm a ruby n00b, so please excuse me if I'm missing something obvious
[2013-01-17 03:03:41 -0500] tomdzk: cphrmky: you'll need to add a dependency to the cookbook in your metadata.rb, and then you should be able to use the function using the qualified name of the class/module it's in
[2013-01-17 03:07:12 -0500] cphrmky: tomdzk can you give me an example of "the qualified name" ?
[2013-01-17 03:07:32 -0500] tomdzk: cphrmky: well, assume your libray ruby file looks like this:
[2013-01-17 03:07:34 -0500] cphrmky: tomdzk: do you mean something like Foo::Bar::method(param) ?
[2013-01-17 03:07:50 -0500] tomdzk: module Foo { def doStuff ... end }
[2013-01-17 03:08:09 -0500] tomdzk: then you'd use Foo.doStuff (or maybe Foo::doStuff, I can never remember)
[2013-01-17 03:08:23 -0500] cphrmky: tomdzk: ah, perhaps Foo.doStuff
[2013-01-17 03:08:59 -0500] cphrmky: tomdzk: I need to include Foo first i'm thinking
[2013-01-17 03:09:58 -0500] tomdzk: cphrmky: possibly, that would be require 'foo'
[2013-01-17 03:11:56 -0500] timsmith: jtran:  That would be if you had a service with a custom command to stop it vs an init script.  /opt/myapp -stop
[2013-01-17 03:12:24 -0500] jtran: right, but how would the recipe use it?  or when would the recipe ever use it?
[2013-01-17 03:19:01 -0500] timsmith: jtran: If you did a notify from some resource in your recipe to say restart and you wanted a custom restart command it would use it
[2013-01-17 03:19:38 -0500] jtran: timsmith: interesting.  i dunno much about the notify cmds will have to read up on that.  would you use that from knife?  or only from another recipe?
[2013-01-17 03:21:33 -0500] ranjib_: jtran, only from recipe
[2013-01-17 03:21:42 -0500] jtran: understood.  thanks
[2013-01-17 03:21:47 -0500] djwonk: 'knife bootstrap' has a --server-url option. how is this different from my chef_server_url in my knife.rb, if at all?
[2013-01-17 03:22:47 -0500] djwonk: looking at the source code, it appears to be the same
[2013-01-17 03:23:30 -0500] ranjib_: djwonk,  the command line flag will override the knife.rb one, if you specify, otherwise the tool will default into knife.rb
[2013-01-17 03:23:39 -0500] djwonk: ranjib_: thank you
[2013-01-17 03:24:49 -0500] djwonk: i'm about to do trial and error, if necessary, but thought I would ask first: does the --linode-datacenter flag (for knife-linode) expect an ID or string?
[2013-01-17 03:25:36 -0500] djwonk: sorry, asked too soon. looked at source. looks like an id is expected
[2013-01-17 04:07:45 -0500] freezey: so i followed this here: https://github.com/bigbosst/ohaiplugins and it seems that even though i have custombook/files/default/ohai_plugins/ohai_plugins.rb & plugin.rb it finds it but never runs
[2013-01-17 04:44:36 -0500] freezey: so i guess the question is.. can you distribute custom ohai plugins from different site-cookbooks
[2013-01-17 04:44:43 -0500] freezey: instaed of adding it in cookbooks/ohai
[2013-01-17 04:46:13 -0500] tomdzk: freezey: the nginx cookbooks seems to be able to do it, though I haven't tested the ohai plugin
[2013-01-17 04:46:25 -0500] freezey: which cookbook?
[2013-01-17 04:46:27 -0500] freezey: link?
[2013-01-17 04:46:41 -0500] tomdzk: https://github.com/opscode-cookbooks/nginx
[2013-01-17 04:46:42 -0500] freezey: because
[2013-01-17 04:46:43 -0500] freezey: this doesnt work
[2013-01-17 04:46:43 -0500] freezey: https://github.com/bigbosst/ohaiplugins
[2013-01-17 04:47:25 -0500] tomdzk: the nginx cookbook has an ohai plugin: https://github.com/opscode-cookbooks/nginx/blob/master/recipes/ohai_plugin.rb
[2013-01-17 04:48:52 -0500] freezey: yeah
[2013-01-17 04:48:53 -0500] freezey: i see that
[2013-01-17 04:48:54 -0500] freezey: hm
[2013-01-17 04:57:36 -0500] djwonk: is the 'base' role special, or is it just a string
[2013-01-17 04:58:03 -0500] djwonk: i think i want to assign a role to a node, but I'm not sure how
[2013-01-17 05:00:08 -0500] tomdzk: djwonk: base is not special, but most people use that to indicate a set of common recipes for their nodes
[2013-01-17 05:00:14 -0500] tomdzk: use that name, I meant
[2013-01-17 05:00:38 -0500] tomdzk: you assign a role the same way you assign a recipe, via the run list
[2013-01-17 05:02:25 -0500] djwonk: tomdzk: thanks. re: the last part ("you assign a role the same way you assign a recipe, via the run list")  is there an example on that? my run list only has "recipe[]" in it
[2013-01-17 05:03:50 -0500] tomdzk: djwonk: just use the word 'role' instead of 'recipe'; see also the run_list paragraph here: http://wiki.opscode.com/display/chef/Roles
[2013-01-17 05:05:30 -0500] djwonk: tomdzk: ah ha!
[2013-01-17 05:06:10 -0500] djwonk: but it seems like I would get into recursive territory if "role[base]" was inside role.rb
[2013-01-17 05:06:38 -0500] djwonk: I want to be able to run `knife ssh "role:base" "sudo chef-client"` without getting `FATAL: No nodes returned from search!`
[2013-01-17 05:07:56 -0500] djwonk: I guess what I need is an example first run for chef-client after a `knife linode server create ` command
[2013-01-17 05:09:59 -0500] tomdzk: djwonk: you should be able to give a run list when you create the instance
[2013-01-17 05:10:16 -0500] tomdzk: and also a node name that you can use to search for
[2013-01-17 05:10:26 -0500] djwonk: tomdzk: ok, in there I should have assigned the base node
[2013-01-17 05:10:37 -0500] djwonk: er, not base node. base *role*
[2013-01-17 05:10:50 -0500] djwonk: I did assign the node name
[2013-01-17 05:11:23 -0500] djwonk: thanks!
[2013-01-17 05:12:20 -0500] freezey: tomdzk: yeah i see so what it does is create a directory on the nodes
[2013-01-17 05:15:26 -0500] djwonk: tomdzk: I see now that the `knife bootstrap` command is a good way to provide a run list too
[2013-01-17 05:30:37 -0500] djwonk: I'm getting "WARNING: Failed to connect to node[my-node] -- Errno::ECONNREFUSED: Connection refused - connect(2)". I am able to SSH in manually. I need to turn up verbosity and debugging
[2013-01-17 05:35:17 -0500] djwonk: I added -VV. For some reason: knife ssh is trying this "establishing connection to localhost:22" localhost? why?
[2013-01-17 05:38:55 -0500] djwonk: ok, figured it out. I mistakenly bootstrapped it with localhost as the FQDN
[2013-01-17 05:39:34 -0500] ranjib_: djwonk, pass -a ipaddress
[2013-01-17 05:40:43 -0500] djwonk: ranjib_: thanks
[2013-01-17 05:41:07 -0500] djwonk: Maybe the FQDN wasn't my fault. `knife linode server create` ideally would have figured it out on its own
[2013-01-17 05:54:23 -0500] cphrmky: ohai all
[2013-01-17 05:55:04 -0500] cphrmky: what's the preferred means of shuttling data between a provider and a recipe?
[2013-01-17 05:55:40 -0500] cphrmky: as in, I need a piece of data that a provider has after a run_action, but i need to access it from the recipe that called that run_action
[2013-01-17 05:55:50 -0500] cphrmky: should I just set a throw-away node attribute?
[2013-01-17 06:11:40 -0500] djwonk: cphrmky I have no idea but I read some of the code in Chef's provider/file.rb source. what other options are there?
[2013-01-17 06:18:59 -0500] ranjib_: cphrmky, providers are more like functions/methods
[2013-01-17 06:19:20 -0500] ranjib_: you can pass additional attributes/parameters to them
[2013-01-17 06:19:31 -0500] ranjib_: take a look at the lwrp documentation
[2013-01-17 06:20:03 -0500] ranjib_: the resource declaration syntax lets you describe parameters, their types, defaults etc
[2013-01-17 06:20:18 -0500] cphrmky: ranjib_: i have been, it doesn't address this particular need, which leads me to believe I'm probably doing it wrong on a higher-level
[2013-01-17 06:20:41 -0500] ranjib_: cphrmky, what you want to pass from recipe to resource?
[2013-01-17 06:20:48 -0500] cphrmky: it's not a big deal, what I'm doing works, i'm just trying to stick with best practices if possible
[2013-01-17 06:21:05 -0500] cphrmky: other way around, i want to pass from resource to recipe
[2013-01-17 06:22:14 -0500] ranjib_: cphrmky, a resource can set an attribute against the node, which the recipes can use
[2013-01-17 08:22:46 -0500] kesor: is there a way to patch providers/manage.rb of another cookbook similar to chef-rewind?
[2013-01-17 08:48:31 -0500] odyssey4me: I'm trying to upload the sudo cookbook on a new chef server installation and am getting this error - http://pastebin.com/YN517bP6
[2013-01-17 08:50:04 -0500] odyssey4me: Any ideas what may be causing it? I've used this cookbook before without this error.
[2013-01-17 08:55:08 -0500] odyssey4me: not sure what the issue was - but it's a test spec file anyway, so I just deleted the spec directory with all files and redid the upload and it worked
[2013-01-17 09:04:51 -0500] matti: odyssey4me: Your Ruby is wrong.
[2013-01-17 09:04:59 -0500] matti: odyssey4me: This is not a valid syntax.
[2013-01-17 10:06:41 -0500] user9910: Hi guys. I am getting a strange error in one of my recipes:
[2013-01-17 10:07:31 -0500] user9910: rpm_package fails with "PAckage X not found: /vagrant_data/X-2-6.el6.rpm"
[2013-01-17 10:07:58 -0500] user9910: But the file is there, and accessible and with the correct package name!
[2013-01-17 10:18:25 -0500] odyssey4me: matti - thanks... I figure there may be a ruby syntax error there, although I didn't spend too much time trying to fix it as a simple removal of the files in question resolved my immediate need
[2013-01-17 10:32:53 -0500] poseid: hmm.. I am writing a small application cookbook for Ruby based on this library cookbook https://github.com/fnichol/chef-ruby_build
[2013-01-17 10:33:14 -0500] poseid: now, I get a Cannot find a resource for ruby_build_ruby on ubuntu version 12.04
[2013-01-17 10:33:33 -0500] poseid: however, in my application cookbook, I have depends on this cookbook above
[2013-01-17 10:33:50 -0500] poseid: any ideas what might be missin?
[2013-01-17 10:36:49 -0500] poseid: basically, how to use a resource from another cookbook?
[2013-01-17 10:36:52 -0500] matti: poseid: What error do you have?
[2013-01-17 10:37:13 -0500] poseid: srv/chef/file_store/cookbooks/fidor_rubies/recipes/default.rb:14:in `from_file'
[2013-01-17 10:37:24 -0500] poseid: 14>> ruby_build_ruby "ruby-1.9.3-p362" do
[2013-01-17 10:37:39 -0500] poseid: can not find resource ruby_build_ruby
[2013-01-17 10:38:31 -0500] matti: How did you install this cookbook? ;]
[2013-01-17 10:38:54 -0500] poseid: I cloned the repo's from github, uploaded it to hosted chef
[2013-01-17 10:39:15 -0500] poseid: and included depends "..." in the metadata.json of my application cookbook
[2013-01-17 10:39:30 -0500] matti: Hm, for whatever reason it cannot be found.
[2013-01-17 10:39:52 -0500] poseid: I see... can it help to check logs on the node?
[2013-01-17 10:42:34 -0500] poseid:  `recipe[ruby_build]`
[2013-01-17 10:42:51 -0500] poseid: should be in the runlist... I have chef-ruby_build..
[2013-01-17 10:42:56 -0500] poseid: ok, I'll check
[2013-01-17 10:44:01 -0500] poseid: "recipe[ruby_build]",
[2013-01-17 10:44:08 -0500] poseid: can I write this somehow in the medata ?
[2013-01-17 10:44:20 -0500] matti: ?
[2013-01-17 10:44:30 -0500] poseid: now, I have:
[2013-01-17 10:44:31 -0500] poseid: depends          "chef-ruby_build" depends          "chef-rbenv"
[2013-01-17 10:44:55 -0500] poseid: I am a bit confused, since the repo is called chef-ruby_build
[2013-01-17 10:45:06 -0500] poseid: but the recipe seems to be ruby_build
[2013-01-17 10:45:54 -0500] matti: Make everything consistent.
[2013-01-17 10:46:31 -0500] gkarekinian: The repo names are often prefixed with chef, what matters is the name from the metadata file: https://github.com/fnichol/chef-ruby_build/blob/master/metadata.rb#L1
[2013-01-17 10:49:47 -0500] poseid: ok, thanks, I see... one sec... I am trying
[2013-01-17 10:53:13 -0500] mting923: I have issue on vagrant provision... sometime if complain my cookbook can not found, but sometime it can run through. And I barely make any changes sometime. Any clue?
[2013-01-17 10:53:44 -0500] mting923: I am using Windows Server 2008 R2 virtual box.
[2013-01-17 10:53:58 -0500] poseid: hmmm... you need to isolate the problem then...
[2013-01-17 10:54:20 -0500] poseid: without having a clear error message, debugging is difficult in my experience
[2013-01-17 10:54:35 -0500] mting923: http://stackoverflow.com/questions/14248295/vagrant-provision-shows-spontaneous-error
[2013-01-17 10:54:47 -0500] mting923: I have a log appended there..
[2013-01-17 10:54:51 -0500] mting923: at the stackoverflow
[2013-01-17 10:55:00 -0500] mting923: but seems no one able to help me out too
[2013-01-17 10:55:44 -0500] mting923: I have the same issue on both of my different development machine (one MBP and one Win 7 PC)
[2013-01-17 10:55:50 -0500] mting923: Both encountering the same issue
[2013-01-17 10:57:46 -0500] poseid: you could add log level to debug to vagrant output
[2013-01-17 10:58:00 -0500] poseid: but, are you sure, you have a cookbook base, and not a role base ?
[2013-01-17 10:58:21 -0500] poseid: matti, gkarekinian: provisioning looks good now
[2013-01-17 10:58:54 -0500] poseid: matti, gkarekinian: thanks for the help!  now, it makes sense: repo -> cookbook -> recipes -> application recipe
[2013-01-17 10:59:02 -0500] gkarekinian: So yeah if you clone cookbooks by hand, don't forget to remote the "chef-" prefix
[2013-01-17 11:00:10 -0500] mting923: yup.. my cookbook name is base
[2013-01-17 11:06:28 -0500] mting923: I have another question would like to ask...
[2013-01-17 11:06:37 -0500] mting923: it is about windows_feature
[2013-01-17 11:06:44 -0500] mting923: I read the README
[2013-01-17 11:06:48 -0500] mting923: tried TFTP
[2013-01-17 11:06:50 -0500] mting923: it works
[2013-01-17 11:07:04 -0500] mting923: but when I try the Telnet Client and Telnet Server one
[2013-01-17 11:07:10 -0500] mting923: it fails
[2013-01-17 11:07:14 -0500] mting923: anyone tried that?
[2013-01-17 11:07:41 -0500] mting923: I wasn't do exactly like the example as 'remove' but I was trying to 'install'
[2013-01-17 11:07:59 -0500] mting923: but it return me : uninitialized constant Chef::Recipe::TelnetClient
[2013-01-17 11:37:28 -0500] cpasmoi: Hi ! Is there a way with apt LWRP to set repos policy (like Package: *      ;;;  Pin: release o=Debian,a=unstable,l=Debian  ;;;; Pin-Priority: 990) ? I can set a policy for a single package, but not for every
[2013-01-17 11:47:05 -0500] stPundit: hey guys
[2013-01-17 11:48:00 -0500] stPundit: a quick question , how stable chef (server) is with ubuntu 12+
[2013-01-17 11:56:39 -0500] bubu: Hi guys - I have a template and I want to see how far chef is getting through I have added something to the end which is not being written to the cfg file, how can I put logging on so that I can see how far through the template it is getting in the log?
[2013-01-17 11:57:20 -0500] jwcarman: What is the "community standard" for cookbook names?
[2013-01-17 11:57:30 -0500] jwcarman: For naming convention on the cookbook names
[2013-01-17 11:57:51 -0500] bubu: why not have a look at some of the cookbooks on opscode?
[2013-01-17 11:58:08 -0500] bubu: they are normally the name of what you are writing the cookbook for
[2013-01-17 11:58:20 -0500] bubu: i.e. im currently working on a nagios cookbook, called nagios
[2013-01-17 11:58:59 -0500] jwcarman: I see that.  Some of them use "-" between words, but some of them use "_"
[2013-01-17 11:59:35 -0500] jwcarman: Is there also a helper method somewhere that can take a cookbook name and give you the generated class' name for the cookbook?
[2013-01-17 12:00:08 -0500] bubu: underscore is normally preferred I think
[2013-01-17 12:00:24 -0500] bubu: not sure about your 2nd q
[2013-01-17 12:00:43 -0500] jwcarman: bubu: thanks!  I think underscores looks better, too
[2013-01-17 12:00:59 -0500] jwcarman: Chef will generate a class at runtime to represent your cookbook, right?
[2013-01-17 12:04:42 -0500] jwcarman: sorry, that was resource class, not cookbook class
[2013-01-17 12:05:00 -0500] jwcarman: It will generate a class for your resources, based on your cookbook's name
[2013-01-17 12:05:28 -0500] zts: I wouldn't imagine so, but I've also never needed to know
[2013-01-17 12:05:52 -0500] zts: Chef assembles a collection of resources, they're not scoped to the cookbook
[2013-01-17 12:06:13 -0500] zts: are you just curious about the internals, or is there something in particular you're trying to achieve?
[2013-01-17 12:07:44 -0500] jwcarman: For some reason, we've got a team member doing an is_a? check on a resource
[2013-01-17 12:09:00 -0500] jwcarman: was wondering if there's an easy way to map from the cookbook/resource name to the class name that will be used
[2013-01-17 12:09:08 -0500] jwcarman: Is there something exposed?
[2013-01-17 12:09:27 -0500] jwcarman: I don't know if it's something they're doing or if it's something done inside test-kitchen
[2013-01-17 12:09:55 -0500] zts: that sounds like a smell to me... - but unfortunately, I don't know the answer to your question
[2013-01-17 12:09:56 -0500] bubu: anyone know how I can put logging into an erb chef template so see if its even getting to end of the erb file..
[2013-01-17 12:10:00 -0500] jwcarman: but, they claim that our cookbook names cause a bug.
[2013-01-17 12:15:23 -0500] zts: jwcarman: what's the bug, in particular?
[2013-01-17 12:15:43 -0500] jwcarman: Something about an "is_a?" check on a resource's class name
[2013-01-17 12:16:17 -0500] jwcarman: apparently if we use our class names as is, it causes a bug of some sort.
[2013-01-17 12:16:53 -0500] jwcarman: regardless, you need to know the name generation algorithm to understand what name to ask for given a cookbook name
[2013-01-17 12:16:55 -0500] zts: jwcarman: yeah, that just sounds wacky.  I believe that resources should all be instances of Chef::Resource::<something>, and the recipe they're in doesn't affect that at all
[2013-01-17 12:17:13 -0500] jwcarman: What if it's the default resource?
[2013-01-17 12:17:23 -0500] jwcarman: Does it take the Cookbook's name?
[2013-01-17 12:17:53 -0500] zts: jwcarman: hrm, perhaps we are referring to different things.  When you say 'default resource', what do you mean?
[2013-01-17 12:17:54 -0500] jwcarman: And, yes they're asking resource.is_a? Chef::Resource::<cookbook name>
[2013-01-17 12:18:02 -0500] jwcarman: cookbook/resources/default.rb
[2013-01-17 12:18:26 -0500] zts: OH, LWRPs, sorry
[2013-01-17 12:18:53 -0500] zts: http://wiki.opscode.com/pages/viewpage.action?pageId=7274964 <- has a section telling you how things are mapped
[2013-01-17 12:19:50 -0500] zts: and yes, dashes vs underscores is relevant there - I believe dashes in cookbook names will be switched to underscores
[2013-01-17 12:20:09 -0500] jwcarman: Yeah, it gives examples.  I was hoping to maybe have a handle on the actual method used to generate the class name.  If we have a cookbook named "fooBar", then the resource is Chef::Resource::Foobar
[2013-01-17 12:20:16 -0500] zts: so a resource "baz" in cookbook "foo-bar" would be referred to as "foo_bar_baz", not "foo-bar_baz"
[2013-01-17 12:20:34 -0500] jwcarman: So, underscores is preferred, basically?
[2013-01-17 12:21:04 -0500] zts: underscores is certainly less surprising
[2013-01-17 12:22:02 -0500] jwcarman: Within the community, are underscores the typical convention for cookbook names?
[2013-01-17 12:22:12 -0500] jwcarman: or "snake case"
[2013-01-17 12:23:05 -0500] zts: I think calling it a convention would probably be too strong, but underscores seem fairly typical.  Though I may be biased due to settling on that in the past
[2013-01-17 12:23:23 -0500] zts: that's a good question, re: what method is responsible for that.  I'm having a poke through the code now
[2013-01-17 12:23:37 -0500] jwcarman: well, since "-" is problematic in symbol names, I'd think underscores is a preference throughout ruby
[2013-01-17 12:25:26 -0500] jwcarman: I see a call to "convert_to_class_name(rname)" in the lwrp_base.rb code
[2013-01-17 12:25:29 -0500] jwcarman: Perhaps that's it
[2013-01-17 12:27:48 -0500] jwcarman: Found it
[2013-01-17 12:27:49 -0500] jwcarman: https://github.com/opscode/chef/blob/master/lib/chef/mixin/convert_to_class_name.rb
[2013-01-17 12:27:56 -0500] jwcarman: zts: I found it
[2013-01-17 12:28:06 -0500] zts: jwcarman: yeah, I just landed at the same place
[2013-01-17 12:28:11 -0500] zts: cool
[2013-01-17 12:28:20 -0500] jwcarman: :) I'm picking up this ruby stuff, man!
[2013-01-17 12:28:40 -0500] jwcarman: Us Java guys can learn new tricks! :)
[2013-01-17 12:29:20 -0500] zts: I find Java much easier to navigate, and I'm not a java guy :)
[2013-01-17 12:31:47 -0500] jwcarman: zts: well, I think it's definitely easier to find out where a piece of code comes from in Java, especially with an IDE
[2013-01-17 12:32:10 -0500] jwcarman: zts: then again, I've been doing it for 15 years, so that would make sense for me :)
[2013-01-17 12:32:35 -0500] jwcarman: zts: thanks for your help, man.  I appreciate it.  Gotta go take care of the kids.  Breakfast time
[2013-01-17 12:32:46 -0500] zts: jwcarman: no problem, take care :)
[2013-01-17 12:45:40 -0500] user9910: Hi All. A newbie question - What tools are usually used to debug cookbooks?
[2013-01-17 12:45:59 -0500] whirred: shef?
[2013-01-17 12:46:13 -0500] gyre008: pry
[2013-01-17 12:46:53 -0500] teukka: vagrant (maybe with berkshelf)
[2013-01-17 12:47:29 -0500] user9910: shef and pry aren't the same thing basically ?
[2013-01-17 12:47:57 -0500] user9910: teukka: do you use something special with vagrant? because elseware it is just an easy VM wrapper :)
[2013-01-17 12:49:19 -0500] zts: I think test-kitchen currently depends on vagrant
[2013-01-17 12:49:22 -0500] teukka: user9910: well, it is really easy to debug provisionin with it as it comes with chef support bundled. and berkshelf makes the integration even better
[2013-01-17 12:53:08 -0500] user9910: teukka: thanks. How berkshelf helps ?
[2013-01-17 12:53:58 -0500] teukka: it can automatically load the dendencies specified in the cookbook metadata
[2013-01-17 12:55:49 -0500] rcovarru: Hello everyone! Someone has had problems with "knife ssh" concurrency option ??
[2013-01-17 12:58:59 -0500] justincampbell: are there any good resources for deploying rails/unicorn with chef?
[2013-01-17 13:12:27 -0500] alesguzik: Hi
[2013-01-17 13:12:40 -0500] alesguzik: Does anyone use chef with corosync/pacemaker?
[2013-01-17 13:32:09 -0500] user9910: How I can read a chef-solo debug log... I see no logic. It loads resources, when it executes them in some order....
[2013-01-17 13:32:31 -0500] user9910: someone help!!! :(
[2013-01-17 13:36:46 -0500] poseid: in the chef cookbook for ruby_build, where would I include this node.default['rbenv']['rubies'] = [ "1.9.3-p0", "jruby-1.6.5" ]
[2013-01-17 13:36:49 -0500] poseid: ?
[2013-01-17 13:39:50 -0500] poseid: hmm attributes of a cookbook looks like a good place
[2013-01-17 13:41:30 -0500] poseid: hmm.. still the ruby seems not to be installed
[2013-01-17 13:41:32 -0500] poseid: http://pastie.org/5705156
[2013-01-17 13:41:47 -0500] poseid: but when I login on the VM... there is no command rbenv
[2013-01-17 13:43:27 -0500] zts: user9910: this says nothing about the logs themselves, but might help you understand them - http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2013-01-17 13:43:53 -0500] user9910: zts: I already learned it by heart :)
[2013-01-17 13:44:31 -0500] user9910: zts: As you ones said, learning chef is like climbing a cliff
[2013-01-17 13:50:59 -0500] kesor: where can I find an example on extending LWRP that another cookbook defined?
[2013-01-17 13:57:03 -0500] cwj: kesor: i dont think you can do that right now/yet
[2013-01-17 13:57:24 -0500] cwj: theres a proposed change to make it possible to subclass a LWRP, but it hasn't been merged
[2013-01-17 13:57:30 -0500] kesor: no way to "require" and extend it? its a ruby class somewhere .. no?
[2013-01-17 13:57:44 -0500] kesor: meh
[2013-01-17 13:59:58 -0500] cwj: kesor: https://github.com/opscode/chef/pull/584
[2013-01-17 14:00:02 -0500] cwj: http://tickets.opscode.com/browse/CHEF-3762
[2013-01-17 14:00:20 -0500] kesor: cwj: thanks
[2013-01-17 14:00:34 -0500] cwj: np
[2013-01-17 14:03:07 -0500] kesor: cwj: is there no way to monkey patch a defined provider using method chaining?
[2013-01-17 14:03:36 -0500] cwj: ive never tried, but i'm under the impression it doesn't work
[2013-01-17 14:22:53 -0500] cnf: could anyone help me find the cause of http://pastie.org/5705923 ?
[2013-01-17 14:34:16 -0500] cwj: cnf: that error appears to be related to the content of the template, can you pastebin that?
[2013-01-17 14:35:28 -0500] cnf: the template? sure
[2013-01-17 14:35:34 -0500] cnf: it has no } in it though
[2013-01-17 14:37:04 -0500] jtimberman: kesor: the discussion in code review about the subclass LWRP is that you might end up having to know more about Ruby to make it work properly, and it might be easier to just make a regular Ruby class.
[2013-01-17 14:37:29 -0500] cnf: cwj: http://pastie.org/5706261
[2013-01-17 14:37:53 -0500] kesor: jtimberman: the purpose for my question was to know how I can use regular opscode cookbooks, but modify them so they actually work without forking them.
[2013-01-17 14:37:58 -0500] jtimberman: this branch of our runit cookbook has resource and provider that subclass Service: https://github.com/opscode-cookbooks/runit/tree/CHEF-154/libraries
[2013-01-17 14:38:12 -0500] jtimberman: "actually work"?
[2013-01-17 14:38:18 -0500] jtimberman: Or "work in my environment"?
[2013-01-17 14:38:29 -0500] kesor: jtimberman: well, work without the idiocies of the author.
[2013-01-17 14:38:34 -0500] zts: sigh
[2013-01-17 14:38:47 -0500] jtimberman: i wrote a good many of our cookbooks :)
[2013-01-17 14:38:51 -0500] zts: a little niceness goes a long way...
[2013-01-17 14:38:56 -0500] kesor: jtimberman: for example, if Chef::Config[:solo] Chef::Log.warn("This recipe uses search. Chef Solo does not support search.") else do stuff...
[2013-01-17 14:39:45 -0500] cnf: cwj: does that look off to you?
[2013-01-17 14:40:41 -0500] jtimberman: i gotta run, bcak in a bit
[2013-01-17 14:40:49 -0500] jtimberman: there's reasons for that i'm happy to explain when i return
[2013-01-17 14:41:11 -0500] kesor: but I want to use chef-solo-search  and chef-solo  and it actually works.
[2013-01-17 14:41:25 -0500] cwj: cnf: well theres no line 73 in that template, so i think we're looking at the wrong template
[2013-01-17 14:41:30 -0500] zts: cnf: on line 26, you have "<%- endif %>" which I think should be "<%- end %>"
[2013-01-17 14:41:54 -0500] cwj: ah, maybe line 73 is in your recipe
[2013-01-17 14:42:25 -0500] cwj: good catch zts
[2013-01-17 14:42:42 -0500] cnf: that doesn't change anything, it seems
[2013-01-17 14:43:19 -0500] cnf: but i changed it none the less
[2013-01-17 14:43:38 -0500] cnf: oh wait
[2013-01-17 14:43:49 -0500] cnf: no, that fixed it i think
[2013-01-17 14:43:53 -0500] cnf: i got a new error now
[2013-01-17 14:44:00 -0500] cnf: can't convert String into Integer >,<
[2013-01-17 14:44:04 -0500] cnf: zts: thanks
[2013-01-17 14:45:18 -0500] cnf: http://pastie.org/5706487 i have now
[2013-01-17 14:46:52 -0500] cnf: can i do var == true in ruby?
[2013-01-17 14:48:00 -0500] cnf: hmz
[2013-01-17 14:48:26 -0500] cnf: damn confusing error messages
[2013-01-17 14:50:49 -0500] cwj: <%- if node['logstash']['server']['debug'] == true %><%= -v %><%- end %>
[2013-01-17 14:50:51 -0500] cwj: that is wrong
[2013-01-17 14:50:59 -0500] cwj: <%- if node['logstash']['server']['debug'] == true %>-v<%- end %>
[2013-01-17 14:51:06 -0500] zts: aha
[2013-01-17 14:51:26 -0500] cwj: could be more simply stated as <%- if node['logstash']['server']['debug'] %>-v<%- endif %>
[2013-01-17 14:51:35 -0500] cwj: er <%- if node['logstash']['server']['debug'] %>-v<%- end %>
[2013-01-17 14:51:46 -0500] cnf: hmm, ok
[2013-01-17 14:52:42 -0500] cnf: still get can't convert String into Integer with that edit
[2013-01-17 14:53:50 -0500] benjaminws: 1
[2013-01-17 14:53:58 -0500] benjaminws: oh hey, whoops.
[2013-01-17 14:54:11 -0500] cwj: ok, you aren't really pastebinning the truly relevant parts from (what should be present in) the stacktrace
[2013-01-17 14:54:39 -0500] cnf: cwj: i see no tracrback
[2013-01-17 14:55:06 -0500] cwj: try adding -l debug ?
[2013-01-17 14:55:26 -0500] cwj: there is more to the stacktrace than what you are pasting, even in info level logging
[2013-01-17 14:55:41 -0500] cnf: oh, vagrant is redirecting it
[2013-01-17 14:56:09 -0500] cnf: the log says it's on logstash_bin= that line
[2013-01-17 14:57:10 -0500] teukka: cnf, cwj: the ejb tags should be "<% ... -%>", not "<%- ... %>"
[2013-01-17 14:57:21 -0500] cnf: oh?
[2013-01-17 14:57:27 -0500] cnf: teukka: that suppresses newlines?
[2013-01-17 14:57:27 -0500] cwj: teukka: yeah you're right
[2013-01-17 14:57:33 -0500] cwj: cnf yeah
[2013-01-17 14:58:14 -0500] cwj: but the logstash_bin line doesn't have a <%-
[2013-01-17 14:58:31 -0500] cwj: and i think you can do <%- if @foo -%>
[2013-01-17 14:59:23 -0500] cwj: cnf: what are the supposed values for the node attributes used on that line?
[2013-01-17 15:00:07 -0500] cnf: cwj: http://pastie.org/5706809
[2013-01-17 15:02:16 -0500] cnf: http://pastie.org/5706962 is what my log says atm
[2013-01-17 15:04:37 -0500] zts: cnf: I wonder if it's the space between 'node' and '['
[2013-01-17 15:04:47 -0500] cnf: yep
[2013-01-17 15:04:48 -0500] user9910: Does vagrant chef.json overrides attributes set using set[] in default.rb of a cookbook ?
[2013-01-17 15:04:54 -0500] cnf: zts: just found that myself
[2013-01-17 15:05:13 -0500] zts: cnf: cool, I'll have to remember that one (I apparently still don't know ruby well enough to reason about it)
[2013-01-17 15:05:31 -0500] cnf: zts: no kidding!
[2013-01-17 15:05:35 -0500] cnf: also, next error :/
[2013-01-17 15:07:31 -0500] cnf: hmz
[2013-01-17 15:07:44 -0500] cnf: apparently, i suck at this
[2013-01-17 15:08:31 -0500] zts: nah, I've had similar experiences with templates (and beating my head against the wall)
[2013-01-17 15:08:39 -0500] zts: what's it stuck on now?
[2013-01-17 15:09:05 -0500] cnf: [2013-01-17T15:08:26+00:00] FATAL: Chef::Exceptions::ResourceNotFound: resource link[/opt/logstash/logstash-server.jar] is configured to notify resource service[logstash_server] with action restart, but service[logstash_server] cannot be found in the resource collection. link[/opt/logstash/logstash-server.jar] is defined in /tmp/vagrant-chef-1/chef-solo-1/cookbooks/logstash_tester/recipes/server.rb:13:in `from_file'
[2013-01-17 15:09:09 -0500] cnf: ie, something stupid i did
[2013-01-17 15:09:11 -0500] cwj: user9910: i think vagrant writes the attributes to a json file and they loaded by chef using the -j flag,
[2013-01-17 15:09:23 -0500] cnf: but i'm gonna take a little break o,O
[2013-01-17 15:09:27 -0500] cnf: cwj: it does, indeed
[2013-01-17 15:10:00 -0500] user9910: ok, I get it. Does it overrides the set[] of a default.rb attribute of a cookbook ?
[2013-01-17 15:10:10 -0500] cwj: user9910: when i think about it, i think that attributes set in the cookbook should win
[2013-01-17 15:10:32 -0500] cwj: i think you can test it easily in shef
[2013-01-17 15:11:00 -0500] cwj: shef -j /path/to/the.json
[2013-01-17 15:11:21 -0500] cwj: node.set['foo'] = 'a different value than present in the json'
[2013-01-17 15:11:30 -0500] cwj: puts node['foo']
[2013-01-17 15:12:31 -0500] user9910: interesting. So what is the usual way you override the default cookbook values ?
[2013-01-17 15:12:41 -0500] user9910: In the role files ?
[2013-01-17 15:13:19 -0500] zts: user9910: http://wiki.opscode.com/display/chef/Attributes <- says that the attributes in your json file are treated as node attributes at 'normal' precedence (level 6)
[2013-01-17 15:13:40 -0500] zts: so they should override default and normal attributes in a cookbook
[2013-01-17 15:14:07 -0500] zts: ('override' might be a bad choice of word there)
[2013-01-17 15:14:33 -0500] user9910: if I use set directive in a default.rb, is it counted as normal attribute ?
[2013-01-17 15:16:05 -0500] zts: user9910: default.rb's can be in many places :)  but yes, I understand that "set" and "normal" are the same thing
[2013-01-17 15:16:31 -0500] zts: (there might be new advice for Chef 11, but I haven't been paying attention)
[2013-01-17 15:16:40 -0500] user9910: strange... I see a different behaviour... I will continue checking
[2013-01-17 15:17:38 -0500] cnf: OMG!!!!
[2013-01-17 15:17:42 -0500] cnf: IT WORKS!!! \o/
[2013-01-17 15:17:42 -0500] user9910: thx zts & cwj
[2013-01-17 15:17:52 -0500] cnf: cwj and zts thanks!
[2013-01-17 15:17:58 -0500] zts: no problem :)
[2013-01-17 15:18:13 -0500] cnf: now i can get back to my logstash testing
[2013-01-17 15:30:24 -0500] TheHairyWoodsman: Is there a way to make a git-centric workflow (where what's in git is the only authority to what a chef server should think), i.e, can I commit into git, and know that the next chef pull will use that
[2013-01-17 15:30:48 -0500] TheHairyWoodsman: this means no knifing cookbooks/environments/roles around, and purposefully not using versioninig of cookbook
[2013-01-17 15:31:44 -0500] TheHairyWoodsman: I  came from using puppet and decidely liked a 'only' git based workflow, instead of what I currently do, which is using both git and knife to maintain the state of git sources and the server
[2013-01-17 15:32:01 -0500] TheHairyWoodsman: it's the only thing I miss about puppet
[2013-01-17 15:32:06 -0500] TheHairyWoodsman: just to be clear =P
[2013-01-17 15:33:31 -0500] rocket: TheHairyWoodsman: you could do something like a jenkins process.  The jenkins server monitors the git repo and then runs the knife commands if the repo changed.  You could make sure it is the only thing that has access to the keys.  I havent done it myself but it might be a way to tackle it
[2013-01-17 15:33:59 -0500] whilp: we do something along the lines of what rocket describes here at Simple; it works well
[2013-01-17 15:34:03 -0500] whilp: i haven't used knife in ages
[2013-01-17 15:34:19 -0500] whirred: you can use a post-commit hook inside Git
[2013-01-17 15:34:21 -0500] TheHairyWoodsman: @rocket @whilp I'd thought of that too
[2013-01-17 15:34:25 -0500] TheHairyWoodsman: yeah
[2013-01-17 15:34:39 -0500] TheHairyWoodsman: so you just 'knife the crap out of the repo'
[2013-01-17 15:34:49 -0500] TheHairyWoodsman: after a hook (whether it's jenkins or a git hook'
[2013-01-17 15:35:01 -0500] TheHairyWoodsman: ok, that's fair
[2013-01-17 15:35:08 -0500] TheHairyWoodsman: I was looking for something even more canned
[2013-01-17 15:35:14 -0500] rocket: TheHairyWoodsman: it might be better to do it that way anyway
[2013-01-17 15:35:15 -0500] TheHairyWoodsman: but that's what it is, np
[2013-01-17 15:35:31 -0500] rocket: you can setup a set of test suites that have to pass before it moves further etc
[2013-01-17 15:35:34 -0500] TheHairyWoodsman: yeah
[2013-01-17 15:35:39 -0500] TheHairyWoodsman: well, there are two phases
[2013-01-17 15:35:45 -0500] TheHairyWoodsman: one where ur working against a vm or throwaway env
[2013-01-17 15:35:53 -0500] TheHairyWoodsman: but i guess in that case u can just chef/solo
[2013-01-17 15:35:56 -0500] TheHairyWoodsman: chef-solo
[2013-01-17 15:36:12 -0500] TheHairyWoodsman: but when you are sure, 'ok this is good'
[2013-01-17 15:36:14 -0500] TheHairyWoodsman: then u want to commit
[2013-01-17 15:36:17 -0500] TheHairyWoodsman: and then u want jenkins in the mix, true
[2013-01-17 15:36:53 -0500] TheHairyWoodsman: well, thanks for your feedback on how to do it.  It's not hard to set that up obviously so I can deal
[2013-01-17 15:37:11 -0500] cwj: i think there are some blog posts out there with specific pointers
[2013-01-17 15:38:14 -0500] TheHairyWoodsman: @cwj rgr i'll look shortly
[2013-01-17 15:38:20 -0500] whilp: TheHairyWoodsman: yes, chef-solo in Vagrant, then push to git and let kenkins do the rest
[2013-01-17 15:38:25 -0500] TheHairyWoodsman: yeah
[2013-01-17 15:38:30 -0500] whilp: uh, jenkins
[2013-01-17 15:38:36 -0500] TheHairyWoodsman: i think I like this new kenkins
[2013-01-17 15:39:06 -0500] cwj: kenny, to his friends
[2013-01-17 15:41:58 -0500] TheHairyWoodsman: from henceforth jenkins shall be known as kenny
[2013-01-17 15:42:11 -0500] TheHairyWoodsman: and all communication surrounding kenny will be rife with confusion
[2013-01-17 15:44:02 -0500] benlangfeld: Hello gents. I'm a little lost, and half an hour of googling hasn't helped. I'm trying to use the application cookbook to pull a private git repo, and I've set config.ssh.forward_agent = true in my Vagrantfile. I can run git ls-remote manually via vagrant ssh, and it works, but it fails when Chef runs it. Do I have to do something specific to chef to make it respect the key forwarding?
[2013-01-17 15:45:22 -0500] kryptek: good morning all
[2013-01-17 15:48:50 -0500] cwj: benlangfeld: vagrant usually runs chef as root, so i doubt that root is getting the ssh environment needed for your private repo
[2013-01-17 15:49:22 -0500] benlangfeld: cwj: Do you have any idea how I might get around that
[2013-01-17 15:50:28 -0500] cwj: benlangfeld: i've never used key forwarding with chef, if it were me i would drop off the key file and an ssh wrapper script.
[2013-01-17 15:50:36 -0500] cwj: and i'd do it using http://cookbooks.opscode.com/cookbooks/deploy_wrapper
[2013-01-17 15:50:39 -0500] cwj: since i wrote it :)
[2013-01-17 15:51:00 -0500] cwj: although i think the application cookbook makes that unnecessary
[2013-01-17 15:51:26 -0500] cwj: you should be able to stuff the key into a node attribute and tell your application resource to use that key for the deploy
[2013-01-17 15:51:35 -0500] benlangfeld: I'm using the application cookbook, and that doesn't allow specifying a wrapper, though I'm not sure why I would need to. When you say "drop off the key file", you mean placing a private key on the box itself? How would you do that?
[2013-01-17 15:52:33 -0500] cwj: application resource has a deploy_key attribute
[2013-01-17 15:52:35 -0500] cwj: deploy_key: the private key to use to access the repository via SSH
[2013-01-17 15:53:13 -0500] cwj: application lwrp installs the wrapper script for you: https://github.com/opscode-cookbooks/application/blob/master/templates/default/deploy-ssh-wrapper.erb and https://github.com/opscode-cookbooks/application/blob/master/providers/default.rb#L97
[2013-01-17 15:53:47 -0500] lflux: ohai
[2013-01-17 15:53:48 -0500] benlangfeld: I was hoping not to have to place a key on the box itself. Is there any way to get the forwarding working, or is it a lost cause?
[2013-01-17 15:54:00 -0500] lflux: suppose nobody has omnibus packages for OpenBSD?
[2013-01-17 15:55:25 -0500] cwj: benlangfeld: like i said, i have no experience doing that. i am under the impression that most people issue a key which is to be used only for deployment and let chef install it for them
[2013-01-17 15:55:36 -0500] zts: benlangfeld: if vagrant is starting chef using sudo, then you may need to edit /etc/sudoers to allow the SSH_AUTH_SOCK environment variable
[2013-01-17 15:56:51 -0500] zts: that having been said, I don't know for sure that Chef will do the right thing if it does have that in its environment
[2013-01-17 15:58:50 -0500] cnf: can i install gems from chef?
[2013-01-17 15:59:15 -0500] zts: cnf: yup, use the chef_gem resource if you want to use it from within chef, otherwise gem_package
[2013-01-17 15:59:57 -0500] cnf: hmm
[2013-01-17 16:00:03 -0500] cnf: it's not working...
[2013-01-17 16:00:21 -0500] benlangfeld: Ok, I'll try the sudoers change and see how that goes. Thanks guys, most helpful :)
[2013-01-17 16:00:41 -0500] cnf: oh, typos ftw
[2013-01-17 16:00:46 -0500] cnf: lets try that again
[2013-01-17 16:01:00 -0500] simonmcc: is it possible to populate override_attributes in a role from the result of a search or with data from another recipe?
[2013-01-17 16:01:21 -0500] cnf: aha
[2013-01-17 16:03:22 -0500] zts: simonmcc: not really - if you're using the ruby DSL for roles, you could jump through some hoops to pull in data (from a search, or somewhere else), but that only happens at the point you upload the role to the server
[2013-01-17 16:03:39 -0500] eka: hi, is there a way to make execute wait N  secs before ending or starting? I have 2 commands to run, but the 2nd should be after a few seconds the first was run
[2013-01-17 16:03:46 -0500] simonmcc: zts: ok, thanks
[2013-01-17 16:04:01 -0500] simonmcc: eka: sleep?
[2013-01-17 16:04:02 -0500] cwj: eka: gist your recipe?
[2013-01-17 16:04:21 -0500] eka: to recipe yet using execute that's all
[2013-01-17 16:05:09 -0500] cwj: then use sleep
[2013-01-17 16:05:20 -0500] eka: simonmcc: you mean something like sleep 5 && "some command here"
[2013-01-17 16:05:22 -0500] cwj: if the first command blocks until it is complete, you can put the two commands in separate execute resources and have the first one notify the second
[2013-01-17 16:05:28 -0500] cwj: but it sounds like it doesn't
[2013-01-17 16:05:48 -0500] eka: cwj: simonmcc : thanks
[2013-01-17 16:08:55 -0500] jwcarman: Is there a way to convert a data bag to a JSON object (or even a json string)?
[2013-01-17 16:09:12 -0500] jwcarman: I see the to_json method, but that doesn't look like it copies the "guts" of the data bag
[2013-01-17 16:09:25 -0500] jwcarman: sorry, I guess I mean data bag item
[2013-01-17 16:09:33 -0500] makerbreakr: how would you guys go about transferring regularly updated files (largish, 10-30M), from a server, to a cilent running chef?
[2013-01-17 16:09:40 -0500] jwcarman: looking there
[2013-01-17 16:09:53 -0500] cwj: jwcarman: theres a raw method for data bag items i think
[2013-01-17 16:10:02 -0500] eka: makerbreakr: rsync? git?
[2013-01-17 16:10:04 -0500] jwcarman: raw_data
[2013-01-17 16:10:08 -0500] jwcarman: cwj: raw_data?
[2013-01-17 16:10:12 -0500] cwj: that sounds right
[2013-01-17 16:10:17 -0500] makerbreakr: git wont delete the old files
[2013-01-17 16:10:21 -0500] jwcarman: cwj: is that a string?
[2013-01-17 16:10:21 -0500] makerbreakr: it would grow large quickly
[2013-01-17 16:10:29 -0500] makerbreakr: and Id like to use a web-only solution
[2013-01-17 16:10:33 -0500] cwj: dunno, try foo.class.name
[2013-01-17 16:10:45 -0500] jwcarman: cwj: looks like it's a Mash
[2013-01-17 16:11:01 -0500] cwj: foo.to_json.to_s
[2013-01-17 16:11:03 -0500] cwj: ?
[2013-01-17 16:11:11 -0500] jwcarman: cwj: that looks like what I want to_json
[2013-01-17 16:11:30 -0500] jwcarman: then, ask for the to_json["raw_data"]
[2013-01-17 16:11:46 -0500] cwj: cool
[2013-01-17 16:11:53 -0500] jwcarman: let's see what that gives me
[2013-01-17 16:11:59 -0500] jwcarman: I need a JSON string
[2013-01-17 16:12:34 -0500] TheHairyWoodsman: ok, another 'how to use chef better problem'  ok so you have deployed some software.  You need to crank up debug logs.  You are actually on the machine of interest. You know you can mess with the right config file, but you know you have 0-30 minutes before you get disrupted by the next chef pull ok any one have a workflow they like for that scenario?
[2013-01-17 16:12:48 -0500] TheHairyWoodsman: I don't =P
[2013-01-17 16:13:20 -0500] jwcarman: kill chef-client daemon?
[2013-01-17 16:13:31 -0500] jwcarman: :)
[2013-01-17 16:13:31 -0500] gchristensen: TheHairyWoodsman: I store the debug level as a node attribute and turn it up if I have to
[2013-01-17 16:14:26 -0500] cwj: TheHairyWoodsman: if you are using the chef-client cookbook to manage chef's config you can manage the log level, but i dont think that would help you until you get to next_chef_run+1
[2013-01-17 16:14:57 -0500] TheHairyWoodsman: right yeah
[2013-01-17 16:15:15 -0500] cwj: sometimes when you are in a time crunch you just have to get your hands dirty
[2013-01-17 16:15:16 -0500] TheHairyWoodsman: oh, che's configno I'm trying to mess with some other package.  say nginx or somethnig
[2013-01-17 16:15:29 -0500] cwj: oh i see
[2013-01-17 16:16:18 -0500] cwj: well like jwcarman suggested, it might make sense to halt whatever mechanism is running chef on an interval
[2013-01-17 16:16:52 -0500] cwj: i think you could pretty easily configure chef to abort the run if a lockfile is present
[2013-01-17 16:23:15 -0500] TheHairyWoodsman: @cwj yeah that's not so bad.  The only thing u want then is a guard mechanism that freaks out if the lock is older than X amount of time. probably 1 hour.  by freak out i mean send an email
[2013-01-17 16:23:37 -0500] cwj: sure
[2013-01-17 16:27:30 -0500] graphex: I'm trying to get chef server installed on quantal ubuntu, but keep running in to the libyajl-ruby vs ruby-yajl problem in conflicting apt dependencies.
[2013-01-17 16:27:50 -0500] graphex: The following packages have unmet dependencies:
[2013-01-17 16:27:51 -0500] graphex:  chef-expander : Depends: libyajl-ruby but it is not going to be installed
[2013-01-17 16:27:51 -0500] graphex:  ohai : Depends: ruby-yajl but it is not going to be installed
[2013-01-17 16:28:17 -0500] graphex: anyone know how to get both those dependencies met?
[2013-01-17 16:30:21 -0500] cwj: graphex: using distro packages or opscode's?
[2013-01-17 16:30:34 -0500] graphex: opscodes
[2013-01-17 16:31:26 -0500] cwj: looks like there is a ticket for it http://tickets.opscode.com/browse/CHEF-3668
[2013-01-17 16:31:57 -0500] graphex: i tried to follow the suggestions in http://tickets.opscode.com/browse/CHEF-3298 but am not doing it right
[2013-01-17 16:34:18 -0500] johnK_: Which URI class does chef use? I tried finding the method read() in the normal URI class api but couldn't. I found a library with list = URI.join(url).read
[2013-01-17 16:43:00 -0500] abc333: can sombody here help me out? I want to check whether a recipe exists before including it with include_recipe. How can I achieve that?
[2013-01-17 16:43:37 -0500] matschaffer: abc333: tried begin/rescue?
[2013-01-17 16:43:41 -0500] spox: you can just catch the exception if it's not found
[2013-01-17 16:43:42 -0500] spox: yeah, that
[2013-01-17 16:43:45 -0500] jtimberman: abc333: chef does that automatically. it won't include a recipe if it has already seen it.
[2013-01-17 16:44:04 -0500] jtimberman: abc333: or do you mean a *different* recipe should be included unless one exists?
[2013-01-17 16:44:22 -0500] abc333: my setup fails with "Cookbook abc not found"
[2013-01-17 16:44:24 -0500] jtimberman: node.run_state[:seen_recipes] is an array of the recipes that chef has already included.
[2013-01-17 16:44:29 -0500] abc333: I have several services I deploy
[2013-01-17 16:44:32 -0500] spox: begin; include_recipe 'fubar::foobar'; rescue RecipeNotFound; Chef::Log.warn "Did not load recipe fubar::foobar"; end;
[2013-01-17 16:44:36 -0500] abc333: some have recipes for setup some not
[2013-01-17 16:44:57 -0500] abc333: oh i see
[2013-01-17 16:44:59 -0500] spox: or, probably Exceptions::RecipeNotFound
[2013-01-17 16:45:04 -0500] abc333: thank you spox
[2013-01-17 16:45:36 -0500] abc333: I am new to Chef and I think the wiki is - for beginners - among the worst documentations I have ever seen
[2013-01-17 16:45:45 -0500] abc333: I will try that
[2013-01-17 16:45:46 -0500] jtimberman: docs.opscode.com
[2013-01-17 16:45:48 -0500] spox: well, nice to meet you too!
[2013-01-17 16:45:49 -0500] spox: :P
[2013-01-17 16:46:02 -0500] zts: abc333: to be fair, what you're describing there sounds like a bit of a "code smell"
[2013-01-17 16:46:06 -0500] spox: and yeah, docs.opscode is really really nice
[2013-01-17 16:46:15 -0500] zts: abc333: but yeah, the wiki documentation is not great for beginners :)
[2013-01-17 16:46:19 -0500] jtimberman: the documentation on the wiki is being moved
[2013-01-17 16:46:23 -0500] jtimberman: to docs.opscode.com
[2013-01-17 16:46:29 -0500] jtimberman: much of it is
[2013-01-17 16:46:50 -0500] abc333: I see thank you
[2013-01-17 16:47:31 -0500] abc333: zts I understand what you mean but other solutions would be even worse
[2013-01-17 16:48:06 -0500] abc333: to me, it would make a lot of sense to have a function to check whether a recipe exists, but as I said I am new to Chef ;-)
[2013-01-17 16:50:52 -0500] queso: Will the cookbook_file resource overwrite a file by default?
[2013-01-17 16:50:55 -0500] zts: abc333: taking a step back, what's the problem you're solving?  What are the other solutions you've considered?
[2013-01-17 16:52:23 -0500] abc333: zts, I have a list of services that are deployed during server setup. Some of them have recipes, some not. I call one "master" recipe that - amongst many other things - also checks for the specific sub services
[2013-01-17 16:53:52 -0500] abc333: I and the name "Chef" makes it very problematic to search for solutions ....
[2013-01-17 16:53:56 -0500] jtimberman: graphex: looks like quantal includes 'ruby-yajl' package
[2013-01-17 16:54:18 -0500] zts: abc333: "opschef" or "opscode chef" helps
[2013-01-17 16:55:11 -0500] abc333: yes I do that but it's still cumbersome^^ It reminds me of FCKEditor they had a similar problem :-)
[2013-01-17 16:56:52 -0500] zts: abc333: the other thing I would suggest is that if it's particularly difficult to do something in Chef the way you'd like, there's probably some other way of approaching the problem
[2013-01-17 16:57:40 -0500] zts: abc333: sometimes you have to do something a way that isn't a great fit for Chef (particularly when you're automating some existing process), but I've usually had a better time of things by changing a little myself
[2013-01-17 16:58:06 -0500] abc333: My main problem is the documentation. It explains nothing.
[2013-01-17 16:58:22 -0500] abc333: I did not choose chef, it is used by Scalarium that is why I am using it.
[2013-01-17 16:58:27 -0500] abc333: but i love the idea
[2013-01-17 16:58:35 -0500] abc333: it's just the documentation
[2013-01-17 16:59:15 -0500] abc333: when I got it to work everything is awesome but to get there without proper documentation ....
[2013-01-17 17:00:20 -0500] zts: My criticism of the (older) documentation is that it explains almost everything, but it can be difficult to navigate.  Once I'd understood the overview documentation (eg, 'Anatomy of a chef run', and 'A Condensed Can of Chef Documentation'), I found it much easier to find the answers I was looking for
[2013-01-17 17:00:45 -0500] zts: I really should spend some more time looking at docs.opscode.com - I know there's been some good work there, but it doesn't really have the google juice, so I don't see it
[2013-01-17 17:01:40 -0500] abc333: I am looking at docs.opscode wjhile waiting for the reboot, I do not want to offend anyone but it is - right now - not very helpful, just like the wiki
[2013-01-17 17:01:46 -0500] abc333: what i personally like
[2013-01-17 17:01:48 -0500] abc333: are code examples
[2013-01-17 17:02:04 -0500] abc333: of course i need explanation like in the wiki etc
[2013-01-17 17:02:19 -0500] abc333: but forme a few code examples do more
[2013-01-17 17:02:24 -0500] abc333: than pages of text
[2013-01-17 17:02:59 -0500] zts: abc333: coming back to your problem specifically, the Chef approach tends to specify what should be running on the node - so it seems odd (to me) to be trying to include a bunch of recipes, without knowing whether they exist
[2013-01-17 17:03:10 -0500] justincampbell: is this normal when using rbenv/chef? https://gist.github.com/e0601d788ffb354e6f30
[2013-01-17 17:03:34 -0500] justincampbell: i could easily write a helper to wrap the repetition
[2013-01-17 17:03:41 -0500] justincampbell: but i dont know if im using the rbenv cookbook wrong
[2013-01-17 17:03:48 -0500] zts: abc333: the way I'd do it would be to have roles for each of my applications (which include the recipes that are required), and then put those roles onto the run list of my node
[2013-01-17 17:04:26 -0500] abc333: zts i understand, but that would be so much work for such a little thing in my case
[2013-01-17 17:04:27 -0500] zts: abc333: but that's quite static, and I realise some people want/need to be more dynamic about figuring out what should be on a particular node
[2013-01-17 17:04:37 -0500] abc333: yes
[2013-01-17 17:04:46 -0500] abc333: I am adding new services constantly
[2013-01-17 17:05:02 -0500] abc333: and only some of them need custom setup
[2013-01-17 17:05:52 -0500] ryduh: Can roles be in recipes?
[2013-01-17 17:05:56 -0500] ryduh: err, cookbooks
[2013-01-17 17:06:11 -0500] timsmith: ryduh:  Roles include cookbooks/recipes
[2013-01-17 17:06:18 -0500] justincampbell: jtimberman: ^^ https://gist.github.com/e0601d788ffb354e6f30
[2013-01-17 17:06:34 -0500] justincampbell: whoops
[2013-01-17 17:06:43 -0500] justincampbell: meant fnichol but he's not here ;)
[2013-01-17 17:07:09 -0500] zts: abc333: I'm a little confused about why Chef needs to know about some of the services, if it doesn't need to do anything to configure them?
[2013-01-17 17:07:40 -0500] abc333: zts, because the services are given to it from Scalarium
[2013-01-17 17:07:42 -0500] ryduh: timsmith: I had chef/site-cookbooks/customcook/roles/*.rb but i realized chef was looking for roles in chef/roles. is it against best practices to have roles in a cookbook?
[2013-01-17 17:08:03 -0500] abc333: I manage the services, deploys, etc. from Scalarium
[2013-01-17 17:09:47 -0500] zts: abc333: fair enough - I'm completely ignorant of Scalarium, and perhaps their approach to organising Chef is at odds with my own
[2013-01-17 17:12:01 -0500] abc333: oh my
[2013-01-17 17:12:04 -0500] abc333: uninitialized constant Chef::Exceptions::RecipeNotFound
[2013-01-17 17:12:06 -0500] abc333: :-(
[2013-01-17 17:13:04 -0500] spox: old version of chef i'm guessing
[2013-01-17 17:13:04 -0500] timsmith: ryduh:  Most people seem to stick to the simple folder structure and include their roles in the roles directory.  Some people do other stuff though. There's options
[2013-01-17 17:13:57 -0500] abc333: version 0.9.15.3
[2013-01-17 17:14:39 -0500] abc333: is there any way to do it with version 0.9.15.3?
[2013-01-17 17:15:09 -0500] spox: just see what exception it is kicking out. i don't remember what it was back then. that will be what you want to rescue
[2013-01-17 17:15:21 -0500] spox: maybe a loaderror or something
[2013-01-17 17:16:59 -0500] abc333: it does not say what exception
[2013-01-17 17:17:01 -0500] abc333: just
[2013-01-17 17:17:02 -0500] abc333: ERROR: Caught exception during execution of custom recipe: *cookbookname1*: Cookbook *cookbookname2* not found
[2013-01-17 17:17:41 -0500] spox: begin; include_recipe 'fubar::foobar'; rescue => e; puts "#{e.class}: #{e}"; raise; end
[2013-01-17 17:17:56 -0500] abc333: found it
[2013-01-17 17:18:00 -0500] abc333: Chef::Exceptions::CookbookNotFound
[2013-01-17 17:18:13 -0500] abc333: that was my mistake
[2013-01-17 17:18:18 -0500] abc333: I am very sorry
[2013-01-17 17:18:25 -0500] abc333: it was the cookbook not the recipe
[2013-01-17 17:18:29 -0500] abc333: I will try again
[2013-01-17 17:22:00 -0500] queso: It is silly for Chef to assume one is by default deploying a rails application.
[2013-01-17 17:22:33 -0500] eka: queso: where it assumes that?
[2013-01-17 17:22:45 -0500] queso: eka: http://docs.opscode.com/resource_deploy.html#layout-modifiers
[2013-01-17 17:23:17 -0500] ryduh: thanks timsmith
[2013-01-17 17:23:30 -0500] queso: eka: I have to *add* code to tell it to not do things because I'm not using rails.
[2013-01-17 17:23:50 -0500] kallistec: queso: you don't really need to use the deploy resource if you don't want, just use the git resource and some notifications
[2013-01-17 17:24:31 -0500] queso: kallistec: Right. But I do want it to symlink to current/ and preserve previous deployment revisions. That's a useful feature.
[2013-01-17 17:24:51 -0500] eka: queso: I used it for python and never had to change anything
[2013-01-17 17:25:26 -0500] queso: eka: It just failed because it couldn't find a config/database.yml file.
[2013-01-17 17:25:31 -0500] cwj: i use it for C apps and didnt find it too cumbersome to say symlink_before_migrate.clear
[2013-01-17 17:26:07 -0500] eka: queso: don't know what are you doing but I never needed that and I set up mongo flask python supervisor memcached etc...
[2013-01-17 17:26:10 -0500] queso: I don't think it will be difficult to tweak. I just don't see the point of assuming someone is using it for Rails.
[2013-01-17 17:27:09 -0500] kallistec: queso: well, the code originates from capistrano, and at the time I wrote it, it was intended to replace a rails-specific add-on developed by engine yard.
[2013-01-17 17:27:17 -0500] queso: eka: Okay, I'm glad to hear that. :)
[2013-01-17 17:27:44 -0500] kallistec: In reality, they never were comfortable with it and they still run Chef 0.6 something so
[2013-01-17 17:28:00 -0500] ryduh: has anyone seen this come up "no such file to load -- mysql"
[2013-01-17 17:28:28 -0500] queso: kallistec: I understand. Glad to hear the developer of the resource is in this channel. ;)
[2013-01-17 17:28:52 -0500] queso: kallistec: Or, copier/tweaker. ;)
[2013-01-17 17:29:24 -0500] kallistec: I did modify it substantially, especially to support idempotence
[2013-01-17 17:29:43 -0500] kallistec: and to extract the git and svn code as separate resources
[2013-01-17 17:30:07 -0500] kallistec: personally, I don't find the symlink stuff all that useful unless you're stuck with svn
[2013-01-17 17:30:20 -0500] jtimberman: benjaminws: 2
[2013-01-17 17:30:28 -0500] queso: kallistec: Is that because you can just git reset, etc.?
[2013-01-17 17:30:40 -0500] kallistec: but then again, we deploy from tags that we keep in a databag so our deploy history is there
[2013-01-17 17:31:22 -0500] kallistec: queso: yeah, as a *D*VCS, git will have all the files necessary for your old revision right there
[2013-01-17 17:31:36 -0500] kallistec: with SVN it can take a long time to get the old version
[2013-01-17 17:31:46 -0500] kallistec: which is the original motivation behind the symlink stuff
[2013-01-17 17:32:09 -0500] queso: kallistec: What benefits do you see to the deploy resource then, if one is using git? (if any)  Because I already have my cookbook working nicely with the scm resource.
[2013-01-17 17:33:07 -0500] kallistec: queso: then I'd just leave it. Whenever I deploy a new thing nowadays I just use the git resource and some notifications
[2013-01-17 17:33:28 -0500] queso: kallistec: Notifications to, say, restart a service?
[2013-01-17 17:33:50 -0500] kallistec: yeah, bundle install for a ruby app, restart a service, etc.
[2013-01-17 17:35:17 -0500] kallistec: I think that's another benefit to putting the pieces together yourself, you can more easily just make Chef do whatever you'd do by hand
[2013-01-17 17:35:30 -0500] cwj: i am rewriting one of our big cookbooks to use the application_python provider because it will obsolete all the complexity of my celery cookbook, and handles gunicorn etc
[2013-01-17 17:35:37 -0500] cwj: i learned a lot putting it together myself though
[2013-01-17 17:36:04 -0500] queso: kallistec: Okay, cool. I think I'll forget about using the deploy resource. Thanks for your tips.
[2013-01-17 17:36:24 -0500] kallistec: no problem
[2013-01-17 17:41:40 -0500] queso: kallistec: Oh, one more question: How do you handle upgrading an app?
[2013-01-17 17:42:38 -0500] abc333: ok server finally rebooted, it worked! a big thank you to all of you!
[2013-01-17 17:47:04 -0500] kallistec: queso: for a simple code upgrade, the git resource takes care of it. If the code changes, it triggers notifications and services get restarted, etc. If the code doesn't change, then it doesn't.
[2013-01-17 17:48:45 -0500] kallistec: for stuff like database migrations, we manage that a bit more manually since there might be before/after code changes and such
[2013-01-17 17:49:20 -0500] queso: kallistec: How does Chef detect a code change and conditionally do things?
[2013-01-17 17:51:07 -0500] queso: kallistec: Nevermind, I probably just need to spend some time with the Chef notification docs.
[2013-01-17 17:54:06 -0500] ranjib_: queso, check deploy_revision resource
[2013-01-17 18:01:37 -0500] kallistec: queso: it compares `git ls-remote` to `git rev-parse`
[2013-01-17 18:03:40 -0500] queso: I've written a cookbook that installs an app.  This cookbook requires other cookbooks that do things like installing apache and setting up firewall rules.  If someone goes into the server and modifies the firewall rules, should I have my cookbook (when run again) restore the firewall rules?  My guess is yes, but that means all such administration has to be done entirely through Chef.  Please help me understand best Chef practices. :)
[2013-01-17 18:03:46 -0500] queso: kallistec: Ahh, okay.
[2013-01-17 18:04:18 -0500] gchristensen: queso: correct, if Chef does everything, replacing your servers is much easier
[2013-01-17 18:05:58 -0500] queso: gchristensen: Makes sense.
[2013-01-17 18:06:31 -0500] gchristensen: queso: http://martinfowler.com/bliki/SnowflakeServer.html
[2013-01-17 18:07:25 -0500] queso: gchristensen: http://vialstudios.com/guide-authoring-cookbooks.html  I'm reading at the "Idempotent recipes" part because his example is exactly what I'm doing..
[2013-01-17 18:08:11 -0500] gchristensen: yeah, I can imagine :)
[2013-01-17 18:11:13 -0500] queso: gchristensen: That was a helpful link you gave, thank you.
[2013-01-17 18:11:24 -0500] gchristensen: you're welcome
[2013-01-17 18:11:51 -0500] ryduh: I'm including database::mysql which runs chef_gem[mysql] but i'm getting a "make not found". i've got apt in my run list (which installs build-essential). what could i be doing wrong?
[2013-01-17 18:11:58 -0500] programmerq: so, we're using the opscode nginx cookbook. Is there a way to ensure that of all the potential sites-available choices, that only the one(s) I want are enabled?
[2013-01-17 18:15:19 -0500] gchristensen: queso: http://martinfowler.com/bliki/PhoenixServer.html too
[2013-01-17 18:15:22 -0500] timsmith: ryduh: I believe the latest version of the database cookbook no longer installs that gem.  I could be wrong though.  Are you using the latest?
[2013-01-17 18:15:35 -0500] ryduh: i started with chef last week
[2013-01-17 18:15:42 -0500] ryduh: how latest is latest?
[2013-01-17 18:16:30 -0500] ryduh: 1.3.10
[2013-01-17 18:17:06 -0500] timsmith: ryduh: That' pretty latest.  How did you install chef on your system?  deb?  gem?  shell script intaller?
[2013-01-17 18:17:29 -0500] ryduh: I'm using vagrant?
[2013-01-17 18:17:50 -0500] ryduh: probably the shell script installer though. i'm on osx
[2013-01-17 18:18:16 -0500] ryduh: timsmith: ^
[2013-01-17 18:18:37 -0500] ryduh: and my mysql cookbook is 2.1.0
[2013-01-17 18:19:15 -0500] timsmith: ryduh: That sounds like a bug to me
[2013-01-17 18:19:41 -0500] timsmith: ryduh: The omnibus shell script installer does some magic with the libraries
[2013-01-17 18:20:48 -0500] ryduh: timsmith: i used "sudo true && curl -L https://www.opscode.com/chef/install.sh | sudo bash". found it in my zsh_history
[2013-01-17 18:21:28 -0500] queso: gchristensen: yeah, followed that one.  "Drift is the name of a street that leads to SnowflakeServers, and you don't want to go there without a big plough."  lol
[2013-01-17 18:21:34 -0500] gchristensen: yeah
[2013-01-17 18:22:19 -0500] queso: These links should be included in Chef noob documentation so people like me can get the philosophy down early on. ;)
[2013-01-17 18:24:14 -0500] ryduh: timsmith: any ideas on getting around this bug?
[2013-01-17 18:24:35 -0500] ryduh: timsmith: Run List expands to [apt, build-essential, php, git, vim, sudo, mysql::client, mysql::server, database::mysql, php::module_mysql, apache2, apache2::mod_php5, apache2::mod_rewrite,
[2013-01-17 18:24:37 -0500] timsmith: Not really.  Sorry
[2013-01-17 18:24:52 -0500] ryduh: see anything weird there?
[2013-01-17 18:24:59 -0500] timsmith: if you don't need that gem you could just comment that out
[2013-01-17 18:25:28 -0500] ryduh: well, i'm trying to add a mysql database and user
[2013-01-17 18:25:34 -0500] ryduh: then import mysql using execute
[2013-01-17 18:27:29 -0500] timsmith: what version of the mysql cookbook?
[2013-01-17 18:27:40 -0500] josephholsten: anyone used the users cookbook to remove a user?
[2013-01-17 18:27:54 -0500] ryduh: 2.1.0
[2013-01-17 18:29:09 -0500] gchristensen: josephholsten: yes
[2013-01-17 18:29:26 -0500] gchristensen: wait, no
[2013-01-17 18:29:29 -0500] gchristensen: :)
[2013-01-17 18:29:43 -0500] timsmith: ryduh: Looking at that cookbook my guess would be it's an issue with the omnibus installed version of chef-client.  I'd throw it up on the mailing list and see if anyone has an idea.  I've never used that particular cookbook.
[2013-01-17 18:29:58 -0500] josephholsten: is see  that users::sysadmins runs both the remove and create actions on the users_manage lwrp
[2013-01-17 18:30:16 -0500] josephholsten: just trying to verify what will happen when I remove the user's databag
[2013-01-17 18:31:51 -0500] bugoff: is there a way to rebuild my index? I have a server which i can see trough the chef web interface
[2013-01-17 18:32:02 -0500] bugoff: but when i do a search using knife search fqdn:hostname
[2013-01-17 18:32:06 -0500] bugoff: i get 0 results
[2013-01-17 18:33:03 -0500] cwj: knife index rebuild
[2013-01-17 18:34:00 -0500] josephholsten: ah. add action:remove to the databag
[2013-01-17 18:34:48 -0500] fabio: 2 bugs in the last 2 release :P
[2013-01-17 18:34:50 -0500] fabio: http://tickets.opscode.com/browse/CHEF-3694
[2013-01-17 18:34:57 -0500] fabio: http://tickets.opscode.com/browse/CHEF-3774
[2013-01-17 18:35:01 -0500] fabio: :(
[2013-01-17 18:35:05 -0500] wonko_be: cwj: no other method (i'm working with bugoff on the same issue)? reindexing doesn't add the node to the index
[2013-01-17 18:35:17 -0500] poolpog: hi chef folks
[2013-01-17 18:35:24 -0500] doomviking: no kidding. 3694 is loud
[2013-01-17 18:35:31 -0500] poolpog: quick question, could not find answer in the Fine Manual
[2013-01-17 18:35:33 -0500] fabio: opscode need more QA
[2013-01-17 18:35:34 -0500] cwj: wonko_be: that is the extent of my knowledge on the issue
[2013-01-17 18:35:36 -0500] josephholsten: ohai poolpog
[2013-01-17 18:35:59 -0500] poolpog: cron resource: does it accept "vixie cron" style values for minute, month, etc
[2013-01-17 18:36:08 -0500] poolpog: e.g. */15 for every 15 mins
[2013-01-17 18:36:15 -0500] tesmar: hi all, how do I get rpm_package to run with --nodeps?
[2013-01-17 18:36:34 -0500] poolpog: cron "thing" do { */15 minute; adtion "runme" }
[2013-01-17 18:36:40 -0500] poolpog: action*
[2013-01-17 18:37:12 -0500] tesmar: nevermind
[2013-01-17 18:37:14 -0500] tesmar: just found --options
[2013-01-17 18:37:37 -0500] josephholsten: poolpog: I think so, lemme check
[2013-01-17 18:38:02 -0500] cwj: poolpog: it looks like it would work https://github.com/opscode/chef/blob/master/lib/chef/provider/cron.rb
[2013-01-17 18:38:11 -0500] cwj: newcron << "#{@new_resource.minute} #{@new_resource.hour} #{@new_resource.day} #{@new_resource.month} #{@new_resource.weekday} #{@new_resource.command}\n"
[2013-01-17 18:38:53 -0500] cwj: i dont care to mentally unpack the CRON_PATTERN regex, but it looks like it would match vixie cron syntax
[2013-01-17 18:39:14 -0500] cwj: i know it doesnt like @boot etc
[2013-01-17 18:40:13 -0500] poolpog: are you getting that from the Regex?
[2013-01-17 18:40:27 -0500] josephholsten: cwj: ever used rubular.com?
[2013-01-17 18:40:30 -0500] poolpog: I love regex, but that one is a bit long to parse
[2013-01-17 18:40:36 -0500] poolpog: easily
[2013-01-17 18:40:55 -0500] josephholsten: it says '*/15 * * * * foo' matches CRON_PATTERN
[2013-01-17 18:41:04 -0500] poolpog: ah
[2013-01-17 18:41:07 -0500] cwj: josephholsten: yes i have, i also have this 'patterns' app on my mac that is handy
[2013-01-17 18:41:16 -0500] poolpog: ok, "no, I've never used rubular.com"
[2013-01-17 18:41:24 -0500] josephholsten: don't port perl to ruby without rubular.
[2013-01-17 18:41:31 -0500] poolpog: sweeeeeeeeet
[2013-01-17 18:41:34 -0500] poolpog: um
[2013-01-17 18:41:39 -0500] josephholsten: ;-)
[2013-01-17 18:41:43 -0500] poolpog: pretty much won't ever do that
[2013-01-17 18:41:47 -0500] poolpog: but thanks
[2013-01-17 18:42:13 -0500] cwj: rubular is great :)
[2013-01-17 18:46:16 -0500] poolpog: you guys so helpful
[2013-01-17 18:46:24 -0500] poolpog: thanks
[2013-01-17 18:47:22 -0500] freezey: hey quick question.. in recipes can i call something like if platform?(whatever) directly or do i have to require_plugin for platform? otherwise having to use if node[:platform]?(whatever)
[2013-01-17 18:52:07 -0500] ranjib_: freeformz, you can check for node.platform  == "something"
[2013-01-17 18:53:16 -0500] freezey: ranjib_: ah
[2013-01-17 18:53:30 -0500] freezey: ranjib_: but in order to call platform directly you will have to require_plugin?
[2013-01-17 18:54:29 -0500] ranjib_: freezey, no. everything that ohai gathers (called as automatic attributes) are available as node.<attribute>  inside recipe
[2013-01-17 18:54:47 -0500] ranjib_: freezey,  inside attribute file, node is optional.
[2013-01-17 18:55:14 -0500] freezey: ranjib_: yeah but what i am wondering is calling plugin directly inside a recipe. so if you have if plugin?(something)
[2013-01-17 18:55:21 -0500] ranjib_: freezey, chef needs those information before hand, cause they decide what provider will be used
[2013-01-17 18:55:21 -0500] freezey: i have to use node.plugin?
[2013-01-17 18:55:37 -0500] ranjib_: freezey, no.
[2013-01-17 18:55:47 -0500] ranjib_: freezey, do you mean ohai plugin?
[2013-01-17 18:55:55 -0500] freezey: yeah what comes from ohai
[2013-01-17 18:56:27 -0500] freezey: so let me give you an example
[2013-01-17 18:57:20 -0500] freezey: in a recipe i originally had a case statement that said case platform when "this" include this and so on.. that failed to work so i had to do case node[:platform]
[2013-01-17 18:57:31 -0500] freezey: and it worked perfectly
[2013-01-17 18:58:15 -0500] freezey: so i have another recipe where i was going to try if platform?(something) would work
[2013-01-17 18:58:29 -0500] freezey: in another recipe for me to call fqdn directly i had to require_plugin
[2013-01-17 19:00:57 -0500] tomdzk: freezey: i might be wrong about that but I thought accessing node attributes via node.<attribute name> or node[:<attribute name>] was deprecated in favor of node["<attribute name>"]
[2013-01-17 19:01:56 -0500] josephholsten: tomdzk: it's a not a hard deprecation. just a community style guide.
[2013-01-17 19:02:20 -0500] freezey: ahhhh
[2013-01-17 19:02:24 -0500] freezey: so
[2013-01-17 19:02:39 -0500] freezey: if node["attrib"]?(whatever,whatever) do this
[2013-01-17 19:02:53 -0500] josephholsten: but yes, you want node['platform']. though perhaps you should want node['platform_family']
[2013-01-17 19:03:45 -0500] josephholsten: oh, I think the platform? and platform_family? helpers are still there. and much better than writing your own case statement
[2013-01-17 19:03:55 -0500] tomdzk: freezey: the node["platform"] case statement seems to be pretty much standard from what I can see in community cookbooks
[2013-01-17 19:04:13 -0500] freezey: fair enough
[2013-01-17 19:04:14 -0500] freezey: thanks guys
[2013-01-17 19:04:41 -0500] tomdzk: or package_family as josephholsten points out, see e.g. https://github.com/opscode-cookbooks/apache2/blob/master/recipes/default.rb
[2013-01-17 19:05:07 -0500] tomdzk: though that one is not consistent, heh :)
[2013-01-17 19:05:53 -0500] josephholsten: oh, I'm thinking of value_for_platform and value_for_platform_family
[2013-01-17 19:06:02 -0500] freezey: lol
[2013-01-17 19:06:14 -0500] josephholsten: finding an example
[2013-01-17 19:06:33 -0500] freezey: so tomdzk
[2013-01-17 19:06:42 -0500] freezey: right here this calls if platform_family?("rhel", "fedora", "arch", "suse", "freebsd")
[2013-01-17 19:06:50 -0500] freezey: when i would call something similar like if platform?
[2013-01-17 19:06:53 -0500] freezey: it would just fail
[2013-01-17 19:06:54 -0500] freezey: heh
[2013-01-17 19:06:57 -0500] tomdzk: freezey: yeah, that's what I mean with not consistent
[2013-01-17 19:07:14 -0500] tomdzk: I'd stick with the case statement at the beginning :)
[2013-01-17 19:07:32 -0500] freezey: i think its more curiosity  than anything else
[2013-01-17 19:08:08 -0500] josephholsten: you'd use the platform attribute if you've got to do different things on, say ubuntu vs debian, or redhat vs centos vs scientific vs amazon vs oracle
[2013-01-17 19:08:16 -0500] freezey: yeah nah that i know
[2013-01-17 19:08:39 -0500] freezey: but what i am saying is my recipe would fail when i used just straight up "if platform?(centos,rhel)
[2013-01-17 19:08:41 -0500] tomdzk: freezey: yeah, I prefer to stick to node["<attribute name>"] because it's explicit and I dislike magic ;)
[2013-01-17 19:08:47 -0500] freezey: lol
[2013-01-17 19:08:52 -0500] benlangfeld: Hello gents. I asked earlier about key forwarding with vagrant + chef, and I thought I got somewhere, but it seems not. I'm trying to use the 'application' cookbook to pull a private git repo using a key from the vagrant host using ssh forwarding. If I do vagrant ssh -c "sudo git clone " it works just fine, but not from within chef. I'm using https://github.com/dergachev/chef_root_ssh_agent to try and fix it, but that doesn't seem to help. If 
[2013-01-17 19:08:54 -0500] wonko_be: nobody an idea why a node will show up in the web-interface, and exists in couchdb, but solr doesn't has the info on the node?
[2013-01-17 19:09:15 -0500] freezey: ok so node["attrib"] it is
[2013-01-17 19:09:19 -0500] josephholsten: wonko_be: I know I've seen that problem before.
[2013-01-17 19:09:43 -0500] tomdzk: benlangfeld: you have config.ssh.forward_agent = true ?
[2013-01-17 19:09:47 -0500] benlangfeld: yes
[2013-01-17 19:09:51 -0500] josephholsten: it think it was especially an issue for windows machines. I think I needed to tweak solr config to allow larger index keys
[2013-01-17 19:10:04 -0500] benlangfeld: If I execute git clone manually it works great, but not within a chef recipe
[2013-01-17 19:10:09 -0500] wonko_be: hm, it runs on a linux (debian, lenny)
[2013-01-17 19:10:16 -0500] wonko_be: but I'll have a look at that
[2013-01-17 19:10:40 -0500] tomdzk: benlangfeld: did you try become root (sudo su - root) and then do git clone, within the VM ?
[2013-01-17 19:11:58 -0500] benlangfeld: The - would clear my environment, so that would not work. It needs to preserve SSH_AUTH_SOCK, which is why I added Defaults env_keep="SSH_AUTH_SOCK" to sudoers
[2013-01-17 19:12:17 -0500] cassianoleal: how do I get a xen guest's IP address?
[2013-01-17 19:12:27 -0500] cassianoleal: the guest itself is a node
[2013-01-17 19:12:32 -0500] tomdzk: benlangfeld: I think that might be your problem - the chef stuff might be run with root's environent, not just as sudo
[2013-01-17 19:12:54 -0500] cassianoleal: from within a recipe I mean
[2013-01-17 19:13:03 -0500] benlangfeld: tomdzk: How would I get chef to preserve that environment?
[2013-01-17 19:13:17 -0500] timsmith: cassianoleal: Look at the output of ohai.  you can just run "sudo ohai | less".  It's all in there
[2013-01-17 19:13:36 -0500] tomdzk: benlangfeld: I fought that for a little bit, but in the end gave up and simply installed the ssh key with chef
[2013-01-17 19:14:05 -0500] benlangfeld: Any idea why chef clears the environment?
[2013-01-17 19:14:23 -0500] cassianoleal: timsmith: thanks, I'll try to find it in there
[2013-01-17 19:14:24 -0500] tomdzk: benlangfeld: this might be vagrant running chef as the root user (not just sudo)
[2013-01-17 19:14:47 -0500] tomdzk: benlangfeld: but might be worthwhile asking on the vagrant mailing list (or IRC channel if they have one)
[2013-01-17 19:14:55 -0500] benlangfeld: Right, but puts env['SSH_AUTH_SOCK'] in the recipe gives me the correct value
[2013-01-17 19:15:13 -0500] benlangfeld: So it's getting that far, it's the point at which chef executes git ls-remote that it fails
[2013-01-17 19:15:14 -0500] tomdzk: benlangfeld: check that the root user can actually read that file
[2013-01-17 19:15:53 -0500] cassianoleal: timsmith: node['ipaddress']  couldn't be easier :)
[2013-01-17 19:16:41 -0500] benlangfeld: tomdzk: Which file?
[2013-01-17 19:16:49 -0500] timsmith: cassianoleal:  I thought you were trying to do something with multiple IPs.
[2013-01-17 19:16:50 -0500] tomdzk: SSH_AUTH_SOCK points to a file
[2013-01-17 19:17:01 -0500] benlangfeld: ah, I see what you mean
[2013-01-17 19:17:02 -0500] benlangfeld: checking
[2013-01-17 19:17:30 -0500] cassianoleal: timsmith: I'm doing the simplest case, actually. but the ohai | less tip will work for other situations, so thanks!
[2013-01-17 19:17:43 -0500] wonko_be: josephholsten: found "maxFieldLength", which pointed me to http://tickets.opscode.com/browse/CHEF-2346
[2013-01-17 19:17:47 -0500] wonko_be: victory!
[2013-01-17 19:17:55 -0500] wonko_be: now, that's a nasty one
[2013-01-17 19:19:06 -0500] josephholsten: woo
[2013-01-17 19:19:15 -0500] josephholsten: I knew I'd seen that before
[2013-01-17 19:19:33 -0500] benlangfeld: tomdzk:
[2013-01-17 19:19:33 -0500] benlangfeld: execute "less #{ENV['SSH_AUTH_SOCK']}"
[2013-01-17 19:19:33 -0500] benlangfeld: [2013-01-17T19:18:55+00:00] INFO: Processing execute[less /tmp/ssh-hnzkIn5092/agent.5092] action run (adam::default line 60)
[2013-01-17 19:19:34 -0500] benlangfeld: [2013-01-17T19:18:55+00:00] INFO: execute[less /tmp/ssh-hnzkIn5092/agent.5092] ran successfully
[2013-01-17 19:19:40 -0500] josephholsten: someone should figure out what we'd need to do to switch to elasticsearch
[2013-01-17 19:19:51 -0500] wonko_be: amen to that
[2013-01-17 19:20:31 -0500] tomdzk: benlangfeld: as I said, I fought that for a bit, but in the end gave up
[2013-01-17 19:21:00 -0500] tomdzk: benlangfeld: you could check one of the many "how to make a base box for vagrant" articles for inspiration on the SSH_AUTH_SOCK situation
[2013-01-17 19:21:32 -0500] benlangfeld: tomdzk: Hmm, ok. I'll keep fighting a little more, but I'm contemplating giving in also.
[2013-01-17 19:21:47 -0500] benlangfeld: tomdzk: Thanks for your help :)
[2013-01-17 19:21:54 -0500] tomdzk: benlangfeld: let me know if you figure it out though ;)
[2013-01-17 19:24:49 -0500] wonko_be: another one... just installed the 10.18 server, and we still get a 'HTTP Request Returned 404 Not Found: No routes match the request: /reports/nodes/.../runs' on clients
[2013-01-17 19:25:02 -0500] wonko_be: any pointers on that one?
[2013-01-17 19:25:18 -0500] josephholsten: does that crash the run?
[2013-01-17 19:26:04 -0500] wonko_be: no
[2013-01-17 19:26:41 -0500] wonko_be: popped up when chef 10.16 or 10.14 was on the clients, but our server was still 10.ancient, so we thought we missed functionality on the server
[2013-01-17 19:26:52 -0500] wonko_be: just updated now, and this is still there
[2013-01-17 19:27:23 -0500] teukka_: ping ops, the channel title has an ancient release version ;)
[2013-01-17 19:27:26 -0500] wonko_be: wondered if this is something that I needed to care about (would be handy to get some info on the last runs...
[2013-01-17 19:27:31 -0500] kallistec: wonko_be: that's expected
[2013-01-17 19:27:53 -0500] kallistec: experimental feature that relies on 404 to turn itself off
[2013-01-17 19:28:07 -0500] wonko_be: kallistec: okay, i'll ignore it for now
[2013-01-17 19:31:27 -0500] wonko_be: and a last question - would I be considered crazy to hook chef-client to some queue (rabbit?), and have it wait for a "go" message, including maybe some attributes, instead of having it run every X seconds chef-client -i ... (yes, I know this needs to be programmed), having the "go" message queued through jenkins, or some other trigger to force a run
[2013-01-17 19:31:59 -0500] mjolk: are LWRP not supposed to take parameters as argument
[2013-01-17 19:32:10 -0500] wonko_be: i had a quick look in the chef-client code, and implementing it didn't seem that crazy
[2013-01-17 19:35:03 -0500] kallistec: wonko_be: getting the basic implementation of that kind of thing working is pretty easy but in practice there's a lot more to consider, such as presence (is a box dead), quorum (are at least X% of my boxes alive and responding), etc. For now if you're looking for that kind of thing, look at rundeck or mcollective
[2013-01-17 19:35:32 -0500] josephholsten: wonko_be: if you want that, see mcollective
[2013-01-17 19:36:02 -0500] josephholsten: or just +1 to kallistec
[2013-01-17 19:36:38 -0500] josephholsten: has someone built a run deck plugin that works through a queue? i've only used ssh in it.
[2013-01-17 19:39:17 -0500] wonko_be: it is not so much as to run everything on all boxes, it is mainly to trigger a run on a couple of boxes when a tiny thing changes
[2013-01-17 19:39:48 -0500] seanhorn: wonko_be: lusis had a really naive implementation of what you are after in one of his talks. Now, if I could just find the links to give to you. Obviously, we couldn't officially support his hackery :) But it was a great POC effort.
[2013-01-17 19:39:52 -0500] wonko_be: thing about adding a single domain to a vhost - which goes through some proxy boxes, some caching boxes, and a couple of web boxes
[2013-01-17 19:40:16 -0500] wonko_be: it should only trigger a run on the webservers, proxys, ... that are needed to run
[2013-01-17 19:40:51 -0500] seanhorn: wonko_be: referring to the externally triggered runs of chef-client question you had a little earlier.
[2013-01-17 19:42:03 -0500] josephholsten: ugh. 250 nodes connecting to chef at the same time is not teh snappy
[2013-01-17 19:42:38 -0500] wonko_be: actually, we now trigger a chef run on the needed boxes through some ssh-hackery, which do a rest-call to our backend, and with the reply, some lwrps are triggered
[2013-01-17 19:42:50 -0500] josephholsten: anyone got any advice for adding teh snap besides http://blog.jonliv.es/2012/03/13/scaling-chef-with-more-api-workers/ ?
[2013-01-17 19:43:12 -0500] wonko_be: it would be nice to trigger the run from the queue itself (which actually triggers the ssh-hackery), and provide the needed data in one go
[2013-01-17 19:43:14 -0500] mjolk: yeah, so doing something like :my_lwrp(param1, param2) doesn't work, right?
[2013-01-17 19:48:16 -0500] josephholsten: wonko_be: you might also look into https://github.com/lusis/Noah
[2013-01-17 19:48:34 -0500] r3vamp: Anyone having success using knife-essentials with chef 10.18?
[2013-01-17 19:49:02 -0500] r3vamp: I'm running into the same on my vanilla Ubuntu and vanilla Centos
[2013-01-17 19:49:49 -0500] wonko_be: josephholsten: seanhorn: thx for the pointers, i know what to read and try the comming days
[2013-01-17 19:50:54 -0500] seanhorn: wonko_be: Oh yeah, there it is. https://www.speakerdeck.com/u/lusis/p/cross-node-orchestration-with-chef-and-noah . But I can't find his daemon code that listens to Noah and then pokes the chef-client. But that's it.
[2013-01-17 19:51:12 -0500] seanhorn: josephholsten: Thanks for the noah link.
[2013-01-17 19:54:31 -0500] r3vamp: It appears that knife-essentials 0.8.4 is not working with chef 10.18, I installed knife essentials 0.7.6 and now it's working properly. So yea..for anyone interested, there yah go.
[2013-01-17 20:02:26 -0500] jkeiser: @r3vamp what issue were you hitting?  I've been developing against chef-11, but I'll go back and check against 10.18 when I get a moment
[2013-01-17 20:03:50 -0500] r3vamp: I'll send you the error one sec
[2013-01-17 20:03:52 -0500] jkeiser: Er, gotta switch between HipChat and IRC addressing :)
[2013-01-17 20:03:59 -0500] jkeiser: cool, thanks
[2013-01-17 20:04:06 -0500] jkeiser: I'm switching up and re-running the tests now to see what's up
[2013-01-17 20:05:30 -0500] benlangfeld: tomdzk: I gave in
[2013-01-17 20:07:01 -0500] r3vamp: jkeiser:  https://gist.github.com/9315ac4fc4428a67a230
[2013-01-17 20:07:17 -0500] r3vamp: I'm iterating through and seeing which version breaks for me
[2013-01-17 20:08:27 -0500] tomdzk: benlangfeld: welcome to the club ;)
[2013-01-17 20:08:50 -0500] r3vamp: jkeiser: Version 0.8.3 is where it breaks for me, I get that same error
[2013-01-17 20:09:04 -0500] jkeiser: r3vamp: what Ruby version?  I suspect that's where the issue is
[2013-01-17 20:09:14 -0500] r3vamp: 1.8.7 =(
[2013-01-17 20:09:32 -0500] jkeiser: Cool.  Don't worry, I intend to get it running on 1.8.7 too :)  Wherever chef runs
[2013-01-17 20:09:48 -0500] r3vamp: awesome
[2013-01-17 20:09:59 -0500] r3vamp: The "knife upload" is going to be embedded in chef 11 right?
[2013-01-17 20:09:59 -0500] jkeiser: In 0.8.3 I made some improvements to cwd detection that used realpath to figure stuff out
[2013-01-17 20:10:07 -0500] r3vamp: Gotcha
[2013-01-17 20:10:31 -0500] jkeiser: r3vamp: yep.  Though knife-essentials will still live, so that I can iterate on it for a while until it's got every feature it oughta
[2013-01-17 20:10:42 -0500] jkeiser: Will periodically merge to chef
[2013-01-17 20:11:30 -0500] jkeiser: I'll file a bug, and take a look at this soon
[2013-01-17 20:11:36 -0500] r3vamp: jkeiser: awesome, thanks for your input and your work
[2013-01-17 20:11:37 -0500] tesmar: hi all, how do I shell out a command? IE "mysql DB < DB.sql" ?
[2013-01-17 20:11:50 -0500] tesmar: I also want it delayed, perhaps in a block
[2013-01-17 20:12:13 -0500] jkeiser: FYI it looks like it does work against chef 10 with a ruby 1.9.3, so hopefully fixing 1.8.7 incompatibility is all I need to do
[2013-01-17 20:12:25 -0500] tesmar: agh I found ruby_block
[2013-01-17 20:12:28 -0500] r3vamp: Hopefully!
[2013-01-17 20:12:29 -0500] tesmar: that solves the delaty
[2013-01-17 20:12:32 -0500] tesmar: delay
[2013-01-17 20:12:41 -0500] tesmar: but what about shelling out that mysql restore command?
[2013-01-17 20:13:28 -0500] josephholsten: tesmar: bash/powershell/execute resource. what do you mean delayed?
[2013-01-17 20:14:02 -0500] tesmar: josephholsten:  I already figured out delayed I can use the "execute" command?
[2013-01-17 20:14:06 -0500] josephholsten: http://docs.opscode.com/resource_execute.html
[2013-01-17 20:14:19 -0500] mjolk: going to try one more time
[2013-01-17 20:14:32 -0500] mjolk: is there a way to accomplish something like :my_lwrp(param1, param2)
[2013-01-17 20:14:32 -0500] tesmar: thank you sir
[2013-01-17 20:14:38 -0500] mjolk: i want to pass parameters to a lwrp that i wrote
[2013-01-17 20:14:57 -0500] josephholsten: you'll need the cookbook name
[2013-01-17 20:15:01 -0500] mjolk: sure
[2013-01-17 20:15:12 -0500] mjolk: Chef::my_cookbook::
[2013-01-17 20:15:25 -0500] josephholsten: some thing like myapp_resource(foo) do; bar 'quux'; end
[2013-01-17 20:15:40 -0500] cwj: mjolk: why would you not pass the parameters as attributes of the resource?
[2013-01-17 20:16:10 -0500] mjolk: cwj: to enumerate multiple instances of the lwrp's result
[2013-01-17 20:16:19 -0500] mjolk: e.g. :git_clone(my_repo, my_host)
[2013-01-17 20:16:25 -0500] mjolk: :git_clone(my_repo2, my_host)
[2013-01-17 20:16:32 -0500] josephholsten: can you do
[2013-01-17 20:17:15 -0500] mjolk: won't myapp_resource(foo) just call a function defined in providers/ ?
[2013-01-17 20:19:29 -0500] josephholsten: not exactly
[2013-01-17 20:19:57 -0500] josephholsten: if you put an lwrp in mycookbook/providers/myresource.rb
[2013-01-17 20:20:29 -0500] josephholsten: then you can access it from a recipe as mycookbook_myresource 'name' do; attribute 'value'; end
[2013-01-17 20:20:32 -0500] mjolk: Which I have - my `action :do_thing do` does logic and then calls singletons
[2013-01-17 20:26:09 -0500] mjolk: i'll try that, thanks josephholsten
[2013-01-17 20:26:20 -0500] cassianoleal: what could be the reason for a user created using the users_manager recipe from the users cookbook have its shell wrong?
[2013-01-17 20:26:36 -0500] cassianoleal: anything else I change in the databag is correctly updated on the chef-client run
[2013-01-17 20:27:02 -0500] cassianoleal: the shell always gets changed to /bin/false, even though the data bag item says /bin/bash
[2013-01-17 20:27:33 -0500] mjolk: grep /bin/false in your recipe
[2013-01-17 20:28:00 -0500] ev0ldave: and any other recipes applied
[2013-01-17 20:28:10 -0500] mjolk: ^^
[2013-01-17 20:29:01 -0500] cassianoleal: thanks, guys! found the problem easy to overlook, specially since it's 6:30PM here :D
[2013-01-17 20:29:29 -0500] ev0ldave: yeah, that's way early
[2013-01-17 20:30:36 -0500] cassianoleal: late actually :) I've been on top of these recipes for about 8 hours now
[2013-01-17 20:31:15 -0500] mjolk: cassianoleal did grep solve it?
[2013-01-17 20:31:18 -0500] mjolk: don't leave us hanging
[2013-01-17 20:31:28 -0500] cassianoleal: mjolk: yes, it did! :)
[2013-01-17 20:31:51 -0500] mjolk: cool *glances meaningfully at tip jar*
[2013-01-17 20:35:37 -0500] ev0ldave: what i mean is that the problem is that it is not midnight and you are not drunk.  The optimal settings for good code
[2013-01-17 20:41:50 -0500] mjolk: drunk code explains 50% of what's wrong with code
[2013-01-17 20:42:07 -0500] mjolk: sobriety and c^c,c^v explains the other 60%
[2013-01-17 20:42:44 -0500] ev0ldave: haha
[2013-01-17 20:47:51 -0500] fly9: i need to install a large number of python packages with pip - is there any way I can use python_pip to read a requirements.txt?
[2013-01-17 20:48:57 -0500] fly9: or is it advisable to just run the shell command through execute?
[2013-01-17 20:49:10 -0500] mjolk: pip install -r requirements.txt
[2013-01-17 20:49:23 -0500] mjolk: literally within 1st page of google links, i'm sure
[2013-01-17 20:49:35 -0500] mjolk: or pip install -someflag does it too
[2013-01-17 20:49:36 -0500] mjolk: -e?
[2013-01-17 20:54:25 -0500] fly9: yeah
[2013-01-17 20:54:46 -0500] fly9: just wondering about the chef best practice for multiple modules
[2013-01-17 20:56:19 -0500] josephholsten: well that's a new one. a template resource failing due the a net:httpserverexception of 404 "not found"
[2013-01-17 21:06:24 -0500] queso: Should include_recipe declarations be at the top of recipes? Is it bad practice to put it later in a recipe if something else has to be done first?
[2013-01-17 21:08:02 -0500] cwj: queso: it should go whereever it needs to go
[2013-01-17 21:08:17 -0500] cwj: like you said, sometimes you have to wait until other bits are in place
[2013-01-17 21:08:28 -0500] tomdzk: queso: most people prefer it at the top to make it easy to see, but that's not a hard-and-fast rule
[2013-01-17 21:10:02 -0500] queso: cwj, tomdzk: Great, thanks. :)
[2013-01-17 21:11:34 -0500] justincampbell: queso: i like putting it right before where it's needed
[2013-01-17 21:11:41 -0500] justincampbell: but i often find myself going back and forth
[2013-01-17 21:13:07 -0500] mjolk: no no no
[2013-01-17 21:13:09 -0500] mjolk: put it at the top
[2013-01-17 21:13:11 -0500] mjolk: way top
[2013-01-17 21:13:19 -0500] mjolk: so other people know what the hell you're trying to do
[2013-01-17 21:13:45 -0500] cwj: sometimes you cant
[2013-01-17 21:14:00 -0500] mjolk: what, put a rational require block?
[2013-01-17 21:15:09 -0500] cwj: include_recipe "foo" will cause the resources for foo to run before any resources that follow the include_recipe statement
[2013-01-17 21:15:24 -0500] cwj: so sometimes you have a bunch of stuff you want to do before foo runs
[2013-01-17 21:15:27 -0500] mjolk: but chef is going to process it anyway
[2013-01-17 21:15:32 -0500] mjolk: action :nothing
[2013-01-17 21:16:25 -0500] cwj: are you implying that you can send action :nothing to include_recipe?
[2013-01-17 21:16:28 -0500] cwj: i've never tried that
[2013-01-17 21:16:32 -0500] queso: mjolk: Could you explain what you mean?
[2013-01-17 21:16:33 -0500] mjolk: what, no
[2013-01-17 21:16:45 -0500] mjolk: queso: put your requires and include cookbooks at the top of your code
[2013-01-17 21:16:52 -0500] mjolk: don't be a sociopath for maintainers
[2013-01-17 21:17:14 -0500] mjolk: if you can't include a recipe without it making a mess of your day, you're using low quality recipes and doing it wrong()
[2013-01-17 21:17:19 -0500] cwj: i still dont understand how you think that makes life easier
[2013-01-17 21:17:39 -0500] cwj: i should write recipe foo to do nothing until notified by resources in recipe bar?
[2013-01-17 21:17:52 -0500] mjolk: I don't understand your question
[2013-01-17 21:18:09 -0500] mjolk: How it makes life easier: when you open the .rb, you see what it requires immediately
[2013-01-17 21:18:21 -0500] cwj: yes, in ideal terms that would be great
[2013-01-17 21:18:24 -0500] mjolk: as opposed to just sprinkling includes/requires throughout your codebase
[2013-01-17 21:18:43 -0500] cwj: but require/include in ruby are not the same thing as include_recipe in chef
[2013-01-17 21:18:44 -0500] mjolk: in what scenario would include_recipe or require break functionality?
[2013-01-17 21:19:13 -0500] mjolk: the actions should be idempotent anyway
[2013-01-17 21:19:48 -0500] cwj: idempotency does not negate the need for things to happen in a particular order
[2013-01-17 21:19:53 -0500] queso: How can I have a default recipe include another recipe in the same cookbook?  Something like self::other_recipe, that would help me get around this.
[2013-01-17 21:20:22 -0500] cwj: queso: include_recipe "cookbookname::recipename"
[2013-01-17 21:20:49 -0500] queso: cwj: Okay, I figured that would work, I didn't know if you could reference the current cookbook with a metaname.
[2013-01-17 21:21:03 -0500] cwj: i'm not aware of a metaname for that purpose
[2013-01-17 21:21:30 -0500] mjolk: cwj: what cookbook are you using that can't deal with being run out of order?
[2013-01-17 21:22:41 -0500] mjolk: [ not trying to just be cross, i want to compare my custom recipes with ones that i see as poor in design to ensure that i'm not making the same mistakes ]
[2013-01-17 21:22:51 -0500] cwj: mjolk: in any given project i might have a default recipe which includes other recipes in the same cookbook
[2013-01-17 21:22:53 -0500] cwj: for example
[2013-01-17 21:23:01 -0500] cwj: i have a cookbook which deploys a django app
[2013-01-17 21:23:19 -0500] mjolk: so you're not checking if it's already deployed?
[2013-01-17 21:23:27 -0500] cwj: it has a recipe which is only executed when the recipe runs in a vagrant box
[2013-01-17 21:23:42 -0500] cwj: the recipe fakes db migrations etc so i can have a box to develop on
[2013-01-17 21:23:43 -0500] queso: Unrelated question: What user(s) do you use for your deployed apps?
[2013-01-17 21:23:53 -0500] mjolk: environments?
[2013-01-17 21:24:07 -0500] mjolk: it sounds like you've coupled together recipes in a bad way
[2013-01-17 21:24:07 -0500] cwj: if that recipe runs before my database is installed or the data base is created or database users are configured, then it will fail
[2013-01-17 21:24:27 -0500] cwj: it sounds like you have strong opinions about what is best for other people
[2013-01-17 21:24:41 -0500] mjolk: sounds like i'm having a discussion and you're stuck in doing it your way
[2013-01-17 21:25:21 -0500] queso: Too many cooks in the kitchen.
[2013-01-17 21:25:24 -0500] mjolk: ugh
[2013-01-17 21:25:32 -0500] mjolk: don't do that
[2013-01-17 21:25:39 -0500] cwj: i'm interested in other ways of doing things, you joined the discussion by saying "no no no"
[2013-01-17 21:25:51 -0500] mjolk: Why not have it do a notifies :restart,"service[whatever-your-djangon-relies-on]"
[2013-01-17 21:26:01 -0500] mjolk: No, I didn't
[2013-01-17 21:26:22 -0500] mjolk: I joined it by saying "you should be able to do things the right way"
[2013-01-17 21:26:44 -0500] cwj: seriously, that is literally what you said
[2013-01-17 21:26:50 -0500] cwj: <mjolk> no no no
[2013-01-17 21:26:56 -0500] mjolk: and then...?
[2013-01-17 21:26:57 -0500] mjolk: anyway
[2013-01-17 21:27:00 -0500] cwj: i am not interested in having an internet argument
[2013-01-17 21:27:08 -0500] mjolk: i'm not having one
[2013-01-17 21:27:10 -0500] mjolk: enjoy your setup
[2013-01-17 21:27:20 -0500] mjolk: if it's good enough for you, then cool
[2013-01-17 21:27:38 -0500] cwj: its something to build on
[2013-01-17 21:29:53 -0500] heathsnow: Anyone heard of an issue with the sql_server cookbook?  Just running a basic install (ie Express Edition) does not install and then fails to find the service  :S
[2013-01-17 21:33:01 -0500] cwj: heathsnow: does this look relevant? http://tickets.opscode.com/browse/COOK-1172
[2013-01-17 21:35:35 -0500] queso: Will include_recipe "name" only run once if multiple cookbooks that are in a run_list include it?
[2013-01-17 21:36:02 -0500] ev0ldave: no
[2013-01-17 21:36:10 -0500] ev0ldave: queso: no
[2013-01-17 21:36:20 -0500] queso: ev0ldave: It's re-run every time it's included?
[2013-01-17 21:36:39 -0500] mikeroth: does anyone know what the knife command is to list all nodes associated with a cookbook?
[2013-01-17 21:36:59 -0500] ev0ldave: yes, chef runs top down, it is not aware outside of what it is doing
[2013-01-17 21:37:07 -0500] queso: ev0ldave: Okay, thank you.
[2013-01-17 21:37:35 -0500] josephholsten: what's the least insane way to query for nodes that haven't been chef'd in a while?
[2013-01-17 21:37:52 -0500] mjolk: knife status ?
[2013-01-17 21:37:58 -0500] cwj: mikeroth: if you want to see all the nodes with foo in their run list `knife search node 'recipes:foo'`
[2013-01-17 21:38:07 -0500] cwj: is that what you are asking?
[2013-01-17 21:38:16 -0500] mikeroth: cwj: yes, cheers
[2013-01-17 21:38:52 -0500] mjolk: my comment was @ josephholsten
[2013-01-17 21:39:14 -0500] josephholsten: was looking for query that works with knife ssh
[2013-01-17 21:39:50 -0500] josephholsten: maybe ohai_time?
[2013-01-17 21:40:01 -0500] Eulipion: are there any docs on debugging chef-solr, or does anyone know why solr would stop returning any results?
[2013-01-17 21:40:02 -0500] cwj: yes ohai_time would be the attribute to query on
[2013-01-17 21:41:48 -0500] josephholsten: and my solr is rusty. is this equiv to less than? ohai_time:[* TO 1358450000 ]
[2013-01-17 21:42:11 -0500] mjolk: not ohai_time
[2013-01-17 21:42:16 -0500] mjolk: that's not since last chef run
[2013-01-17 21:43:12 -0500] mjolk: or rather, it might not be a good indicator - i've never had a successful chef run on my workstation (intentionally) and i still have an ohai time
[2013-01-17 21:44:03 -0500] cwj: that happens to be the same attribute that 'knife status' looks at
[2013-01-17 21:44:10 -0500] cwj: https://github.com/opscode/chef/blob/master/lib/chef/knife/status.rb#L59-L63
[2013-01-17 21:44:11 -0500] mjolk: Interesting
[2013-01-17 21:44:17 -0500] mjolk: So what does that return?
[2013-01-17 21:44:18 -0500] josephholsten: was just looking for taht
[2013-01-17 21:44:34 -0500] mjolk: It's in the same format as Time.now.to_i
[2013-01-17 21:44:42 -0500] cwj: its epoch time i believe
[2013-01-17 21:44:56 -0500] dougireton: Can I have attributes in another file besides attributes/default.rb, e.g. attributes/my_recipe.rb?
[2013-01-17 21:45:00 -0500] mjolk: so you could do a last_checkin = Time.now.to_i - node[:ohai_time].to_i
[2013-01-17 21:45:23 -0500] cwj: dougireton: yes you can but until chef11 you wont be guaranteed as to what order those attributes are applied in
[2013-01-17 21:45:30 -0500] josephholsten: hmm, it would be nice to order by that (and limit too)
[2013-01-17 21:46:11 -0500] ev0ldave: josephholsten:  off the top of my head, a knife ssh command to grep /var/log/chef/client.log for time stamp
[2013-01-17 21:46:11 -0500] dougireton: cwj: as long as the attribute file is loaded, it should work right, even in chef 10? I'm not trying to override any attributes in default.rb
[2013-01-17 21:46:34 -0500] cwj: dougireton: yeah as long as you have no overlap between the two you should be fine i think
[2013-01-17 21:47:09 -0500] cwj: some people try to set dat_attribute in default.rb and then have some_other_attribute = dat_attribute in another attribute file
[2013-01-17 21:47:15 -0500] cwj: and it generally doesnt work
[2013-01-17 21:48:11 -0500] dougireton: cwj: no, I'm just trying to avoid having all my attributes in one giant junk drawer
[2013-01-17 21:48:27 -0500] cwj: go for it :)
[2013-01-17 21:48:31 -0500] dougireton: thanks
[2013-01-17 21:50:40 -0500] heathsnow: cwj: thanks for the link.  Unfortunately, it fails even when I run chef-client from the node (where in the ticket if doesn't fail).  I'll keep hacking at it.....may need to run windows_batch if I can get it to install via CMD
[2013-01-17 21:51:13 -0500] cwj: heathsnow: sure thing, maybe adding your voice to that ticket can help it get some attention
[2013-01-17 21:55:25 -0500] josephholsten: ev0ldave: that's kinda the opposite of what I want. I want to run a command only on machines that haven't been updated in a while
[2013-01-17 22:02:19 -0500] serge_: Has anyone attended the Chef Intro workshops? I have been using Chef since November, and I feel fairly comfortable writing simple recipes but haven't touched on Definitions or Templates just yet. I'm wondering if it's worth spending the $450 to get taught straight from the Ops Code guys.
[2013-01-17 22:02:58 -0500] serge_: Although my employer would cover the costs, it's still an all-day affair so I'd lose a day from work.
[2013-01-17 22:05:58 -0500] cwj: serge_: the chef fundamentals training material is on github
[2013-01-17 22:05:59 -0500] cwj: https://github.com/opscode/chef-fundamentals
[2013-01-17 22:06:10 -0500] cwj: might give you a taste for what would be covered
[2013-01-17 22:06:47 -0500] cwj: i attended the first chef fundamentals class opscode offered, i found it worthwhile (but like you said, employer paid)
[2013-01-17 22:07:16 -0500] mattt: cwj: how many days was that ?
[2013-01-17 22:07:31 -0500] cwj: it was a two day course at that time
[2013-01-17 22:07:39 -0500] cwj: im sure it has changed somewhat since then
[2013-01-17 22:08:01 -0500] serge_: cwj: Awesome. Thanks for the link.
[2013-01-17 22:08:33 -0500] cwj: you bet, hope it helps
[2013-01-17 22:15:55 -0500] jtimberman: fwiw, the chef-fundamentals git repository content is pretty old now.
[2013-01-17 22:16:28 -0500] jtimberman: the current fundamentals course is 3 days, and has a lot more direct hands on work. it's more "type a lot of things in your editor and then make chef do stuff" than before :)
[2013-01-17 22:21:42 -0500] chip-: serge_: It sounds like you're maybe too advanced for the 1-day intro course, but would benefit from the 3-day course.
[2013-01-17 22:22:03 -0500] chip-: The 3-day curriculum doesn't really delve into definitions either, but it does cover LWRPs.
[2013-01-17 22:25:03 -0500] serge_: chip-: Yeah, I figured as much. The only thing in the Eventbrite description that sounded appealing was setting up the Nagios server, but there's an older screencast online somewhere that shows you how to do just that
[2013-01-17 22:28:54 -0500] queso: Does a cookbook's attributes/default.rb automatically get loaded when the cookbook is run?
[2013-01-17 22:29:33 -0500] josephholsten: yes. to my knowledge, everything in attributes/ is loaded
[2013-01-17 22:29:44 -0500] serge_: Yep
[2013-01-17 22:29:53 -0500] queso: josephholsten, serge_: Okay, thank you.
[2013-01-17 22:29:54 -0500] josephholsten: anyone know the knife command to set a node's environment?
[2013-01-17 22:30:12 -0500] serge_: To create a new node with X environment ?
[2013-01-17 22:30:39 -0500] josephholsten: no, I've got one that I screwed up, so it's got environment _default. I need it to have production.
[2013-01-17 22:30:55 -0500] josephholsten: and knife node edit/from file is a pain
[2013-01-17 22:31:39 -0500] mattt: josephholsten: can't you flip it in the web ui?  :X
[2013-01-17 22:32:04 -0500] josephholsten: yes, and I already have. just thought I ought to learn my tools better.
[2013-01-17 22:32:28 -0500] cwj: josephholsten:  http://wiki.opscode.com/display/chef/Community+Plugins
[2013-01-17 22:32:39 -0500] cwj: knife-bulk-change-environment
[2013-01-17 22:32:51 -0500] cwj: knife-set-environment
[2013-01-17 22:33:01 -0500] cwj: may be relevant to your interests
[2013-01-17 22:33:03 -0500] josephholsten: yeah, I've noticed a couple of those. was hoping it might be built in.
[2013-01-17 22:34:02 -0500] josephholsten: i've played with knife-flip in the past
[2013-01-17 22:34:35 -0500] josephholsten: and knife spark sounds neat, but I haven't modified our workflow to work with it
[2013-01-17 22:34:40 -0500] josephholsten: *spork
[2013-01-17 22:36:01 -0500] mmorris: is the cookbook_path set in solo.rb for the cookbooks in the solo vm or on the host?
[2013-01-17 22:36:48 -0500] cwj: mmorris: the local dir where solo can find cookbooks
[2013-01-17 22:37:33 -0500] timsmith: Any change any Opscoders can explain the background on logging all of the CHEF-3694 messages on chef runs now.  I have 195 of them on each run
[2013-01-17 22:37:36 -0500] mmorris: as in the cookbooks that have been loaded into the instance?
[2013-01-17 22:37:54 -0500] mmorris: lie, i'm running it in vagrant. Would I point it to the cookbooks on my host machine?
[2013-01-17 22:38:14 -0500] cwj: mmorris: vagrant has chef integration that drops the cookbooks into the vm for you
[2013-01-17 22:38:25 -0500] jtimberman: josephholsten: knife exec -E 'nodes.transform("name:www.example.com") {|n| n.chef_environment = "staging"}'
[2013-01-17 22:38:37 -0500] cwj: if your vagrantfile is set up to use it, 'vagrant provision' should do all the heavy lifting for you
[2013-01-17 22:38:56 -0500] josephholsten: oh my. so much /power/
[2013-01-17 22:39:39 -0500] josephholsten: coderanger isn't around SEA, right?
[2013-01-17 22:39:44 -0500] mmorris: right now I have the provisioner doing something like "gem install chef --version 10.16.4 --no-ri --no-rdoc"
[2013-01-17 22:39:55 -0500] coderanger: Nope, I live down near SF
[2013-01-17 22:40:00 -0500] mmorris: should it be chef-solo -c ~/solo.rb -j ~/node.json for solo?
[2013-01-17 22:40:15 -0500] mmorris: "chef-solo -c ~/solo.rb -j ~/node.json"
[2013-01-17 22:40:46 -0500] josephholsten: coderanger: damn. was wanting to finish my spike of the json web-ui this weekend and run it by you.
[2013-01-17 22:42:52 -0500] josephholsten: we just lost one of our ops team and have a new hire coming soon. I need tools with a gentler learning curve than knife.
[2013-01-17 22:45:52 -0500] queso: You can reference attributes from any cookbook in any other cookbook as long as the cookbook is loaded during a chef run?
[2013-01-17 22:49:30 -0500] serge_: mmorris: What exactly are you trying to accomplish?  If you're using Vagrant, then you shouldn't need to call chef-solo
[2013-01-17 22:49:51 -0500] cwj: queso: yeah you can, but whether or not you should do that is a different question
[2013-01-17 22:50:38 -0500] queso: cwj: What if I want to define a "deploy" user and group that's shared by a bunch of cookbooks? This deploy user is being defined in a base-server cookbook that I made.
[2013-01-17 22:50:48 -0500] queso: cwj: I suppose there could be a better way.
[2013-01-17 22:52:07 -0500] josephholsten: queso: that's how we do it. I strongly encourage you to set a uid and gid.
[2013-01-17 22:52:15 -0500] cwj: theres just a pain point when your recipe depends on that attribute to be set by another cookbook
[2013-01-17 22:52:36 -0500] josephholsten: i set those attributes in roles.
[2013-01-17 22:52:54 -0500] cwj: yes you might set them in a role or environment instead
[2013-01-17 22:53:18 -0500] josephholsten: even if roles are unpopular in some circles, they're a great place to stick attributes like that
[2013-01-17 22:53:20 -0500] cwj: but when one looks at the cookbook without context of the role of environment you might say "where does this come from?"
[2013-01-17 22:53:24 -0500] queso: Why in a role?  The user is called "chef-deploy" and is used by all the other cookbooks I've made.
[2013-01-17 22:53:41 -0500] josephholsten: then why is it an attribute?
[2013-01-17 22:54:25 -0500] serge_: queso: http://wiki.opscode.com/display/chef/Attributes#Attributes-CookbookAttributeFileOrdering
[2013-01-17 22:54:41 -0500] queso: josephholsten: I don't know. :)
[2013-01-17 22:54:53 -0500] mmorris: serge_: I'm running into a problem where I can run chef-solo inside the vm, I can only reload using vagrant. It says the run list is empty which I assume has something to do with cookbooks not being on the vm or not knowing where to find them. Am I looking at this the wrong way?
[2013-01-17 22:55:02 -0500] queso: serge_: Thank you
[2013-01-17 22:55:10 -0500] serge_: queso: but josephholsten has a point, if it's to be available everywhere, you don't want to have to add an "include_attribute" line EVERYWHERE
[2013-01-17 22:55:12 -0500] mmorris: *can't run chef-solo inside
[2013-01-17 22:55:13 -0500] queso: cwj, josephholsten: I will read about roles to see if that's what I should be using.
[2013-01-17 22:55:37 -0500] queso: serge_: Right. Okay, I'll set this up different then.
[2013-01-17 22:55:39 -0500] queso: Thanks guys.
[2013-01-17 22:56:05 -0500] josephholsten: i'm continually torn about how much to hard code stuff for internal cookbooks
[2013-01-17 22:57:23 -0500] cwj: mmorris: is there a reason you cant use 'vagrant provision' from outside the VM? vagrant constructs a chef-solo command line for you which usually points to files under /tmp/vagrant-chef-1/
[2013-01-17 22:57:39 -0500] serge_: mmorris: chef-solo says the run list is empty?
[2013-01-17 22:58:14 -0500] cwj: chef-solo -j /tmp/vagrant-chef-1/dna.json -c /tmp/vagrant-chef-1/solo.rb
[2013-01-17 22:58:17 -0500] cwj: something like that
[2013-01-17 22:58:24 -0500] cwj: depending on how vagrant sets up your mount points
[2013-01-17 23:00:08 -0500] mmorris: cwj: I have this line in my Vagrantfile already: config.vm.provision :shell, :inline => "gem install chef --version 10.16.4 --no-ri --no-rdoc"
[2013-01-17 23:01:01 -0500] mmorris: serge_: yea, I can do a full run using vagrant up with "config.vm.provision :chef_solo do |chef|" in the Vagrantfile, but when I ssh in and run "chef-solo" it tells me the run lis tis empty
[2013-01-17 23:02:06 -0500] mmorris: do I not need both? config.vm.provision :shell, :inline => "gem install chef --version 10.16.4 --no-ri --no-rdoc"
[2013-01-17 23:02:06 -0500] mmorris:   config.vm.provision :chef_solo do |chef|
[2013-01-17 23:02:09 -0500] cwj: mmorris: when you use dist_config.vm.provision :chef_solo it is not simply running 'chef-solo'
[2013-01-17 23:02:38 -0500] cwj: i use vagrant baseboxes that already have chef installed, so im afraid i dont know if you can use both provisioners
[2013-01-17 23:02:44 -0500] mmorris: cwj: how should my vagrant file look for chef-olo?
[2013-01-17 23:03:18 -0500] cwj: mmorris: the logstash cookbook has a pretty interesting example
[2013-01-17 23:03:19 -0500] cwj: https://github.com/lusis/chef-logstash/blob/master/Vagrantfile
[2013-01-17 23:03:39 -0500] cwj: it is also using berkshelf integration, which i love
[2013-01-17 23:03:46 -0500] serge_: Yeah, I was going to make a gist of mine, but that's a good example.
[2013-01-17 23:05:05 -0500] mmorris: so it knows to use solo buy this?: dist_config.vm.provision :chef_solo do |chef|
[2013-01-17 23:05:16 -0500] cwj: yes
[2013-01-17 23:05:45 -0500] cwj: but it doesn't intrinsically know how to install chef
[2013-01-17 23:05:51 -0500] cwj: what platform is your current box?
[2013-01-17 23:05:56 -0500] josephholsten: wow, the logging on this chef server is obscenely voluminous
[2013-01-17 23:06:35 -0500] mmorris: lucid64
[2013-01-17 23:07:17 -0500] josephholsten: is there a way to short circuit the /reports/nodes/.../run 404 so it doesn't throw an exception? seems like a waste
[2013-01-17 23:07:23 -0500] cwj: mmorris: this box has chef preinstalled  https://opscode-vm.s3.amazonaws.com/vagrant/boxes/opscode-ubuntu-10.04.box
[2013-01-17 23:07:57 -0500] mmorris: cwj: is there a different install for chef and chef-solo? or can that be used for both?
[2013-01-17 23:08:42 -0500] cwj: the chef gem, packages and installs done via omnibus include  chef-client and chef-solo
[2013-01-17 23:08:57 -0500] cwj: i think that box has omnibus chef-client
[2013-01-17 23:09:26 -0500] josephholsten: cwj: is there a plan to update the bentos to something newer than 10.14?
[2013-01-17 23:09:28 -0500] cwj: you can also use opscode's bento project to automate building your own baseboxes https://github.com/opscode/bento
[2013-01-17 23:09:59 -0500] cwj: josephholsten: bento project readme has links to a handfull of boxes
[2013-01-17 23:10:14 -0500] cwj: oh you mean newer chef-client
[2013-01-17 23:10:27 -0500] cwj: i dont know what opscodes plans are there
[2013-01-17 23:10:29 -0500] mmorris: cwj: awesome, I'll try that box out. Thanks a lot!
[2013-01-17 23:10:32 -0500] cwj: youc an build your own though
[2013-01-17 23:10:42 -0500] mmorris: serge_: thank you as well
[2013-01-17 23:10:43 -0500] xmltok: i just built out a new node and all of the sudden ohai doesnt load with chef 10.18.0-1, am i the only one? it looks like ohai is on 6.16.0-1
[2013-01-17 23:11:01 -0500] cwj: i havent found the older version annoying enough to build my own box
[2013-01-17 23:11:39 -0500] josephholsten: cwj: but they all had chef 10.14.4 last I checked
[2013-01-17 23:11:49 -0500] cwj: yeah you're right
[2013-01-17 23:11:54 -0500] cwj: i misunderstood your question
[2013-01-17 23:12:01 -0500] josephholsten: i was vague
[2013-01-17 23:12:15 -0500] timsmith: xmltok: Ohai 6.16 works for me on Ubuntu
[2013-01-17 23:12:19 -0500] cwj: 10.14 looks a lot like 10.04 :)
[2013-01-17 23:12:30 -0500] josephholsten: yes indeedy
[2013-01-17 23:13:15 -0500] serge_: mmorris: np
[2013-01-17 23:13:51 -0500] jtimberman: cwj, josephholsten: i haven't had a day to sit down and rebuild boxes and we haven't put it into CI yet :)
[2013-01-17 23:14:11 -0500] cwj: so it goes
[2013-01-17 23:14:41 -0500] jtimberman: https://gist.github.com/3088517
[2013-01-17 23:15:28 -0500] cwj: cool
[2013-01-17 23:19:18 -0500] dougireton: here's a shortcut way if you wan't want to or can't repackage a box. You'll have to adapt for Linux, but should be easy: http://dougireton.com/blog/2012/12/23/automatically-upgrading-chef-client-on-vagrant-up/
[2013-01-17 23:21:42 -0500] jtimberman: :)
[2013-01-17 23:22:35 -0500] jtimberman: you can also use the shell provisioner :) http://jtimberman.housepub.org/blog/2012/08/10/vagrant-multiple-provisioners/
[2013-01-17 23:22:42 -0500] jtimberman: TIMTOWTDI
[2013-01-17 23:23:18 -0500] cwj: so very many WTDI
[2013-01-17 23:30:17 -0500] xmltok: timsmith: you must be using 6.16.0-2, i just updated/upgraded and chef is working now
[2013-01-17 23:36:36 -0500] w6fu: using the dhcp cookbook, receiving an unintialized error "uninitialized constant Chef::DSL"
[2013-01-17 23:37:12 -0500] w6fu: i don't understand what this means, can anyone decipher?
[2013-01-17 23:38:31 -0500] w6fu: chef client 10.18.0, if that matters
[2013-01-17 23:47:28 -0500] kallistec: w6fu: odd, that appears to be written for Chef 11 which isn't even out yet
[2013-01-17 23:48:05 -0500] w6fu: Nice, i'm traveling forward in time
[2013-01-17 23:48:57 -0500] w6fu: readme states chef10+
[2013-01-17 23:49:41 -0500] w6fu: chef-server is 10.14.2 by the way
[2013-01-17 23:50:07 -0500] josephholsten: anyone seen a
[2013-01-17 23:50:09 -0500] josephholsten: Connection initiation failed - (Bunny::ProtocolError)
[2013-01-17 23:50:20 -0500] josephholsten: in /var/log/chef/server.log?
[2013-01-17 23:51:10 -0500] josephholsten: oh my. 10.12.
[2013-01-17 23:51:12 -0500] whack: I'm reading over the chef search docs, but not finding an obvious way to search for a node by tag with knife search. Keeps telling me 'invalid search query' for 'tags:"cluster:alc"' (which is valid lucene query syntax)
[2013-01-17 23:51:25 -0500] whack: is there a way to search for a node by tag?
[2013-01-17 23:51:47 -0500] whack: oh, I see, I have to escape the : in the string even if quoted.
[2013-01-17 23:52:13 -0500] josephholsten: whack: that's the ticket
[2013-01-17 23:52:20 -0500] whack: lame :\
[2013-01-17 23:53:47 -0500] josephholsten: when the world ends, the only things left will be cockroaches, rats, Keith Richards, and mangled text that has been escaped one-too-many or one-too-few times  Dave Walker
[2013-01-17 23:54:26 -0500] whack: would be useful to have a list of non-alphanumerics that didn't upset chef/solr
[2013-01-17 23:54:49 -0500] josephholsten: I know ':', '[' and ']'
[2013-01-17 23:55:19 -0500] whack: josephholsten: elasticsearch doesn't complain about the same query. blah
[2013-01-17 23:56:12 -0500] whack: ahh well
[2013-01-17 23:56:18 -0500] josephholsten: yes, you've converted me to elastic search. unfortunately that's doesn't magically port chef. and I don't know erlang well.
[2013-01-17 23:57:00 -0500] whack: josephholsten: I haven't suggested porting, just expressing confusion over the situation.
[2013-01-17 23:57:50 -0500] josephholsten: I've suggested porting. because setting up a nice cluster for logstash was easy.
[2013-01-17 23:58:22 -0500] kallistec: xmltok: did you get everything working with Chef 10.18 and Ohai 6.16?
[2013-01-17 23:59:29 -0500] josephholsten: that's odd. when did chef roll back from bunny 0.8.0 to 0.7.9?
