[2013-01-28 01:11:18 -0500] deed02392: under attributes in this cookbook: http://community.opscode.com/cookbooks/php-fpm it says about setting the configuration. but it only consists of a recipe for installing php-fpm from source. What am I missing?
[2013-01-28 01:25:25 -0500] maek: deed02392: seems like its only from packages. docs dont match the code. Id say you arent missing anything :)
[2013-01-28 01:26:21 -0500] deed02392: is it referring to this? http://community.opscode.com/cookbooks/application
[2013-01-28 01:26:48 -0500] deed02392: should I just modify the default recipe of php-fpm to generate the config file?
[2013-01-28 01:27:01 -0500] maek: deed02392: that is the application or 'deploy' cookbook
[2013-01-28 01:27:06 -0500] maek: I dont think its referencing that
[2013-01-28 01:27:20 -0500] maek: deed02392: if you have your own config file
[2013-01-28 01:27:28 -0500] maek: you can provide it as a template
[2013-01-28 01:27:39 -0500] maek: or take the TODO and make the lwrps that generate the fpm config
[2013-01-28 01:27:42 -0500] maek: or
[2013-01-28 01:28:11 -0500] maek: write a "my_php_fpm" cookbook that includes_recipe 'php-fpm' and then uses the template resource
[2013-01-28 01:28:15 -0500] maek: to push out your config
[2013-01-28 01:28:29 -0500] deed02392: i don't really understand what an lwrp is etc
[2013-01-28 01:28:34 -0500] maek: seems easier then maintaing a fork of php-fpm if you dont want to shave the yak of the lwrp
[2013-01-28 01:28:38 -0500] deed02392: but I think i'm capable of reading the conf the package generates and making a template for it
[2013-01-28 01:28:43 -0500] maek: yeah
[2013-01-28 01:28:43 -0500] maek: so
[2013-01-28 01:29:30 -0500] maek: deed02392: https://gist.github.com/4652030
[2013-01-28 01:29:32 -0500] maek: something like that
[2013-01-28 01:29:34 -0500] deed02392: a my_php_fpm cookbook?
[2013-01-28 01:29:34 -0500] deed02392: i've just been doing knife cookbook site install
[2013-01-28 01:29:36 -0500] maek: as a stand alone cookbook
[2013-01-28 01:29:37 -0500] deed02392: and then editing the source of what downloaded
[2013-01-28 01:29:51 -0500] maek: thats also fine
[2013-01-28 01:29:59 -0500] maek: but it makes you have forks that deviate from the community cookbooks
[2013-01-28 01:30:04 -0500] maek: so less easy to maintain
[2013-01-28 01:30:10 -0500] deed02392: should I be renaming the cookbooks if I edit them from what is on the community?
[2013-01-28 01:30:16 -0500] maek: up to you
[2013-01-28 01:30:38 -0500] maek: the method I suggested makes the my_php_fpm cookbook act as a wrapper
[2013-01-28 01:30:44 -0500] deed02392: ah that's pretty much what i've been doing maek
[2013-01-28 01:30:48 -0500] deed02392: except i am editing directly the recipe
[2013-01-28 01:30:53 -0500] deed02392: that's true
[2013-01-28 01:30:54 -0500] maek: so you use the existing community cookbook to install, and then your cookbook to dump the template in
[2013-01-28 01:31:19 -0500] deed02392: right
[2013-01-28 01:31:30 -0500] deed02392: i guess it makes no difference really
[2013-01-28 01:31:54 -0500] deed02392: it's just weird no one else has done it
[2013-01-28 01:32:29 -0500] deed02392: well actually the only reason i need to change the conf is cos i want to use a unix socket instead of tcp
[2013-01-28 01:32:31 -0500] lazyPower: correct me if i'm wrong, but using knife ssh 'sudo chef-client' should pull cookbook updates every time correct?
[2013-01-28 01:32:33 -0500] deed02392: but because i need to change even one thing, i automatically need to write a complete template
[2013-01-28 01:33:04 -0500] deed02392: it should lazyPower
[2013-01-28 01:34:56 -0500] maek: lazyPower: yes, if there is an updated cookbook and its in that nodes runlist it should get pulled down
[2013-01-28 01:35:22 -0500] chip-: deed02392: Combine the idea of "deed_php-fpm" that first includes community php-fpm with this: https://github.com/bryanwb/chef-rewind
[2013-01-28 01:35:59 -0500] maek: chip-: WOW!
[2013-01-28 01:36:09 -0500] maek: lazyPower: you could delete your cookbook cache if you are having issues
[2013-01-28 01:36:26 -0500] maek: and every once in a blue moon a cookbook says it got uploaded but I have to re upload.
[2013-01-28 01:36:30 -0500] maek: could be user error
[2013-01-28 01:36:33 -0500] lazyPower: i'm doing ok, save for a really odd issue i'm having from a node in a vps
[2013-01-28 01:37:19 -0500] lazyPower: its reporting its FQDN as another machine, and i dont have an account on the parent box, how would i override its address?
[2013-01-28 03:01:20 -0500] kylejaster: anybody around? i'm running into an issue where when installing apache or other basic cookbooks i get an error: NameError: wrong constant name PlatformFamily?
[2013-01-28 03:01:39 -0500] kylejaster: running vagrant
[2013-01-28 03:01:57 -0500] kylejaster: using vagrantly script: https://gist.github.com/1985059
[2013-01-28 03:15:35 -0500] lazyPower: ermahgerd i'm lovin me some chef-server
[2013-01-28 03:15:46 -0500] lazyPower: thank you, opscode and every community maintainer/helper
[2013-01-28 03:16:00 -0500] lazyPower: recipe[brown-nosing] complete
[2013-01-28 03:16:54 -0500] kylejaster: lol lazyPower - wish i was there with you!
[2013-01-28 03:17:23 -0500] lazyPower: i made curry tonight for dinner in honor of chef
[2013-01-28 03:17:29 -0500] kylejaster: hahaha
[2013-01-28 03:19:40 -0500] kylejaster: srsly though - anyone around here who can help a n00b?
[2013-01-28 03:27:28 -0500] chef_0: While uploading cookbook I get this : Response:  Failed to authenticate as [my_user_name]. Ensure that your node_name and client key are correct. (What's the node_name its refering to ?)
[2013-01-28 03:45:24 -0500] toobulkeh1: Is there a way to test if a method exists in another cookbook before trying to execute it? For example, I'm using the chef-rvm cookbook provided by fnichol, but I want to try "if defined? rvm_gem" to see if it exists before just calling "rvm_gem", in my own cookbook
[2013-01-28 03:47:22 -0500] toobulkeh1: Most cases I've seen of defined? include referencing an object that they belong to but I'm not sure of that case with Chef I'm also a bit confused as to the Order of Operations these recipes are running in (it seems my if statement is run way before, even though I add the recipe afterwards)
[2013-01-28 03:48:27 -0500] zpatten: en
[2013-01-28 03:52:55 -0500] toobulkeh1: Here is the specific code I was talking about: https://github.com/toobulkeh/chef-rails/blob/rbenv/recipes/default.rb
[2013-01-28 04:05:59 -0500] huy: How do I write helper method for recipe?
[2013-01-28 04:08:32 -0500] huy: Hi guys, does anyone know how to write helper ruby function for recipe?
[2013-01-28 04:08:50 -0500] pabst_: Is it possible to have a node in more than one environment?
[2013-01-28 07:08:28 -0500] grey_wulf: hello
[2013-01-28 08:39:44 -0500] carldanley: how can I force a reload on nginx? is it just
[2013-01-28 08:39:45 -0500] carldanley: service "nginx" do
[2013-01-28 08:39:53 -0500] carldanley: action :reload
[2013-01-28 08:39:54 -0500] carldanley: end
[2013-01-28 08:39:55 -0500] carldanley: ?
[2013-01-28 10:52:13 -0500] perfabio: hi all!
[2013-01-28 10:53:17 -0500] perfabio: is there any way to update the public key of chef server using knife?
[2013-01-28 10:53:48 -0500] perfabio: sorry, upload my public key on chef server
[2013-01-28 11:05:48 -0500] perfabio: I tried to execute knife client edit mynode and update the public key field but I can't log on my chef server...any idea?
[2013-01-28 13:16:13 -0500] benregn: hi, I'm pretty new at the whole server management stuff (and servers in general). I'm using chef-solo and I was trying to install Postgres 9.2 by using the pitti-postgresql-ppa recipe included in Opscode postgres Git repo. But I got this error: https://gist.github.com/4655415
[2013-01-28 13:35:58 -0500] datadevil: Hi. Can I just run one recipe directly from chef-solo?
[2013-01-28 13:40:54 -0500] a_a_g: datadevil: look at the node.json example at http://wiki.opscode.com/display/chef/Chef+Solo
[2013-01-28 13:41:02 -0500] a_a_g: thats probably what you need?
[2013-01-28 13:41:33 -0500] AikiLinux: Hello, Has anyone ever encounter an issue where a chef controlled file (template) added a new content to existing file but not remove lines that were removed in the template ?
[2013-01-28 13:44:10 -0500] datadevil: a_a_g: mm..so pass the recipe as a json argument to chef-solo?
[2013-01-28 13:45:14 -0500] a_a_g: set the runlist as just the recipe
[2013-01-28 13:45:39 -0500] datadevil: ok..was hoping I would just be able to pass it directly to chef-solo but this can work too
[2013-01-28 13:51:27 -0500] datadevil: a_a_g: where would I store such a file in the normal Chef directory structure..?
[2013-01-28 13:52:19 -0500] a_a_g: i would put it in solo/nodes/nodetype.json
[2013-01-28 13:52:50 -0500] datadevil: ok, thanks for the suggestions, very useful
[2013-01-28 14:10:27 -0500] samwierema: I'm having some trouble with the "knife ssh" command. In particular, it won't connect to the node, even though I think everything is set up right. Where do I start troubleshooting?
[2013-01-28 14:11:58 -0500] perfabio: anyone can help me disabling osops-utils/autoetchosts recips on rackspace private cloud?
[2013-01-28 14:12:12 -0500] AikiLinux: how come chef template does not overwrite an existing file ?
[2013-01-28 14:15:30 -0500] mattt: AikiLinux: maybe you have create_if_missing set ?
[2013-01-28 14:20:46 -0500] AikiLinux: checked that -nope
[2013-01-28 14:34:14 -0500] maxaw: hello. I have thousand of instances running but chef server is very slow. When I run chef-expanderctl queue-status it says Total messages: 0, is it normal?
[2013-01-28 14:57:35 -0500] perfabio: a quick question: how can I avoid the execution of autoetchosts.rb recipes ?
[2013-01-28 14:58:46 -0500] paigeadele: chef-client uses too much memory on my boxes
[2013-01-28 14:58:48 -0500] paigeadele: what should I do
[2013-01-28 14:59:32 -0500] paigeadele: I just turned it off on all of them
[2013-01-28 14:59:38 -0500] paigeadele: I have knife ssh
[2013-01-28 14:59:41 -0500] paigeadele: should suffice for now
[2013-01-28 14:59:48 -0500] paigeadele: and nothing will really be changing for a while yet
[2013-01-28 15:00:17 -0500] paigeadele: finally went public btw, http://www.connectxyz.com
[2013-01-28 15:02:13 -0500] geekbri: paigeadele: I noticed i would periodically have to restart the chef service as there was some sort of memory leak.  Adding the -f option helped if you are on a newer version of chef, it doesn't solve the problem though.
[2013-01-28 15:02:27 -0500] btm: paigeadele: chef-client daemonized? if so, use --fork. too much memory generally, examine you're use of search and make sure you're not stuffing lots of huge node objects into variables often.
[2013-01-28 15:02:48 -0500] paigeadele: I've been running it under the runit supervisor because Ilke runit
[2013-01-28 15:02:51 -0500] mattt: paigeadele: run it through cron ?
[2013-01-28 15:02:55 -0500] paigeadele: I'll check the settings real quick
[2013-01-28 15:03:25 -0500] mattt: anyone know why the chef-client cookbook only enables the chef-client service, rather than enable and start it ?
[2013-01-28 15:03:51 -0500] paigeadele: btm, geekbri good looking out guys I'll investigate this more when I arrive at work
[2013-01-28 15:03:54 -0500] paigeadele: it seems like:
[2013-01-28 15:04:14 -0500] paigeadele: http://pastie.org/5908517 this is what I got
[2013-01-28 15:04:36 -0500] paigeadele: another thing to consider
[2013-01-28 15:04:39 -0500] paigeadele: Im running it on rvm
[2013-01-28 15:04:42 -0500] paigeadele: so
[2013-01-28 15:04:50 -0500] paigeadele: I'll give it some more going over when I get in
[2013-01-28 15:05:21 -0500] paigeadele: talk to you guys soo
[2013-01-28 15:05:22 -0500] paigeadele: n
[2013-01-28 15:12:22 -0500] w3s_8ths_: did anyone ever face a conditional execution going wrong ? I have a not_if "ps aux | grep httpd" conditional statement. It returns 1 (checked with echo $?) but still the recipe gets executed.
[2013-01-28 15:14:04 -0500] w3s_8ths_: sorry, I have a only_if "ps aux | grep httpd". And the shell command return code is 1.
[2013-01-28 15:14:52 -0500] mattt: grep returns 1
[2013-01-28 15:15:04 -0500] mattt: only_if looks for 0
[2013-01-28 15:15:09 -0500] mattt: (grep returns 1 if lines found)
[2013-01-28 15:17:52 -0500] w3s_8ths_: mattt: ok, I see. Should find another guard that makes more sense.
[2013-01-28 15:18:28 -0500] mattt: w3s_8ths_: or use not_if like you originally stated :)
[2013-01-28 15:18:47 -0500] zts: mattt: which grep is that?
[2013-01-28 15:18:56 -0500] mattt: zts: the shiny one
[2013-01-28 15:18:57 -0500] zts: mattt: man page for grep on Centos 6.2 says "Normally, the exit status is 0 if selected lines are found and 1 otherwise."
[2013-01-28 15:19:31 -0500] mattt: zts: yeah, looked again, got it wrong :(
[2013-01-28 15:19:55 -0500] laurent\: w3s_8ths: the problem with "ps aux | grep httpd" is that it might always return 0
[2013-01-28 15:20:31 -0500] laurent\: run it by hand, you'll see the "grep httpd" command in the process list
[2013-01-28 15:21:18 -0500] Litex: Try 'ps aux | grep [h]ttpd'
[2013-01-28 15:21:30 -0500] laurent\: or pgrep httpd
[2013-01-28 15:21:42 -0500] Litex: even nicer.
[2013-01-28 15:22:32 -0500] w3s_8ths_: OK, I'm gonna check with pgrep.
[2013-01-28 15:23:02 -0500] mattt: not explaining why you see an exit code of 1 tho, unless it's in fact not running :)
[2013-01-28 15:24:37 -0500] w3s_8ths_: ps aux | pgrep httpd returns 1 when httpd not running
[2013-01-28 15:25:15 -0500] mattt: k
[2013-01-28 15:25:23 -0500] mattt: zts: thanks for correcting me there btw
[2013-01-28 15:25:57 -0500] zts: mattt: no problem, just stood out in my mind (returning something other than 0 for success) and thought I'd double check
[2013-01-28 15:27:51 -0500] w3s_8ths_: ps aux | pgrep httpd returns 0 when running. So that should make it.
[2013-01-28 15:28:42 -0500] gondoi: anyone know how to tell knife-openstack not to check the auth certificate
[2013-01-28 15:28:56 -0500] gondoi: we are a self signed and it keeps bombing out due to bad cert
[2013-01-28 15:29:39 -0500] mshilling_: anyone awake yet?
[2013-01-28 15:30:01 -0500] mshilling_: i have what is probably a simple question
[2013-01-28 15:30:26 -0500] mshilling_: how do I initialize a variable on existing nodes who dont already have it applied to them?
[2013-01-28 15:31:10 -0500] mshilling_: if I add a new default attribute to a recipe, then apply that recipe to a node I get "undefined nil class []"
[2013-01-28 15:31:27 -0500] btm: mshilling_: node[:some_variable] = String.new ?
[2013-01-28 15:31:48 -0500] mshilling_: but if I add it to the attributes via knife node edit, it works fine.  I just dont want to knife node edit 356 nodes
[2013-01-28 15:32:19 -0500] btm: mshilling_: how exactly are you setting the default attribute?
[2013-01-28 15:32:31 -0500] mshilling_: cookbooks/attributes/default.rb
[2013-01-28 15:32:37 -0500] mshilling_: adding it there
[2013-01-28 15:32:41 -0500] btm: mshilling_: what does the line look like?
[2013-01-28 15:33:02 -0500] mshilling_: default["appdata"]["owner"] = "prodcon"
[2013-01-28 15:34:03 -0500] mshilling_: but the node knows nothing about the appdata:owner variable, until I make it aware with knife node edit
[2013-01-28 15:34:04 -0500] btm: mshilling_: perhaps above that you need a line that says: node.default["appdata"] = Hash.new
[2013-01-28 15:34:14 -0500] mshilling_: hmm
[2013-01-28 15:34:16 -0500] mshilling_: I can try that
[2013-01-28 15:34:30 -0500] btm: mshilling_: you can't set node["appdata"]["owner"] until node["appdata"] exists.
[2013-01-28 15:35:29 -0500] gondoi: btm: but if you were to run that on a new node, it would not complain right?
[2013-01-28 15:36:15 -0500] btm: gondoi: if node["appdata"] does not exist and you try to set node["appdata"]["owner" you should get an error like: "undefined nil class []"
[2013-01-28 15:36:52 -0500] mshilling_: new question for testing, how can I get rid of the nodes knowledge of ["appdata"] now?
[2013-01-28 15:37:08 -0500] gondoi: even as default["appdata"]["owner"] on a first run in the attributes? could have swore I've run something like that before
[2013-01-28 15:37:31 -0500] magoo: i've been using chef quite a long time now but I still don't see the advantage of using a databag to an environment file ... I think I'm just missing some perspective. Can someone enlighten me? :)
[2013-01-28 15:37:50 -0500] btm: gondoi: here's a plain ruby equivalent to that error: https://gist.github.com/8d99339ca4f6760cb63a
[2013-01-28 15:39:07 -0500] gondoi: yeah i've run into that  alot just don't remember running into it with attributes :D
[2013-01-28 15:40:25 -0500] gondoi: btm: I'm honestly not trying to troll, but what about this https://github.com/opscode-cookbooks/apache2/blob/master/attributes/default.rb#L20
[2013-01-28 15:40:57 -0500] mshilling_: node.default["appdata"] = Hash.new :  failed - same error
[2013-01-28 15:41:00 -0500] gondoi: if that runs on a brand new node, it won't error
[2013-01-28 15:44:13 -0500] btm: mshilling_: putting your errors in a gist (gist.github.com) would help.
[2013-01-28 15:45:59 -0500] mshilling_: https://gist.github.com/e3a95ecec3b76c0072c2
[2013-01-28 15:46:05 -0500] mshilling_: thanks, appreciate you looking at it
[2013-01-28 15:47:29 -0500] gondoi: mshilling_: can you add your stacktrace to the gist?
[2013-01-28 15:49:46 -0500] mshilling_: cant figure out how to edit:
[2013-01-28 15:49:47 -0500] mshilling_: https://gist.github.com/4656625
[2013-01-28 15:51:17 -0500] gondoi: and this line is an "appdata" reference?
[2013-01-28 15:51:18 -0500] gondoi: disk_prep_new/attributes/default.rb:12
[2013-01-28 15:52:08 -0500] btm: gondoi: yeah, attributes are a special magical class, but if you lean too hard on their magic you can get into trouble when your data is no longer in a Chef::Node::Attribute class.
[2013-01-28 15:52:38 -0500] mshilling_: no but its a reference to a variable that the node is aware of
[2013-01-28 15:53:01 -0500] mshilling_: let me check closer
[2013-01-28 15:53:03 -0500] btm: mshilling_: can you gist disk_prep_new/attributes/default.rb ?
[2013-01-28 15:55:18 -0500] kryptek: What's the 'proper' way of accessing node attributes from either recipe or template files?  I'm asking because I know I read that a change was coming in regards to how to access node attributes, and I'm confused as to whether or not I should be using "node.key.subkey" or "node['key']['subkey']"  Does it matter which form you use in recipes or templates?
[2013-01-28 15:55:38 -0500] mshilling_: I will in a sec, I think you're pointing me in the right direction.  let me test some things
[2013-01-28 15:59:30 -0500] CharlieSu: Does chef/knife boostrap support spot instances yet?
[2013-01-28 16:00:55 -0500] magoo: kryptek: both are proper ruby so I can't imagine not being able to do either
[2013-01-28 16:01:09 -0500] magoo: i rarely see node.key.subkey though
[2013-01-28 16:01:25 -0500] kryptek: magoo,  I figured using the . accessor methods would make it look cleaner
[2013-01-28 16:02:26 -0500] benregn: hi, I'm pretty new at the whole server management stuff (and servers in general). I'm using chef-solo and I was trying to install Postgres 9.2 by using the pitti-postgresql-ppa recipe included in Opscode postgres Git repo. But I got this error: https://gist.github.com/4655415
[2013-01-28 16:02:41 -0500] magoo: i think the community agrees on node['key']['subkey'] though... in the future, if you decide to use something like perl critic, you'll want to keep to the standard
[2013-01-28 16:02:53 -0500] magoo: haha
[2013-01-28 16:02:57 -0500] magoo: s/perl/food/
[2013-01-28 16:03:56 -0500] magoo: i'm only speaking form the recipe perspective though
[2013-01-28 16:04:31 -0500] magoo: inside of templates is a different story
[2013-01-28 16:04:35 -0500] kryptek: cool, good to know -- just want to make sure I'm sticking to some sort of a standard.  I'll be refactoring as I work along to follow the more common use cases
[2013-01-28 16:07:26 -0500] opyate: hello, why does Open Source Chef server not have "organizations"? http://serverfault.com/questions/473042/what-is-the-point-of-an-organization-on-hosted-chef
[2013-01-28 16:09:51 -0500] btm: magoo: using node['foo'] is better than node.foo. You can set node['default'] = "foo", but you can't set node.default = "foo" https://gist.github.com/05f50341d5b0a8d3f152
[2013-01-28 16:11:03 -0500] btm: opyate: Organizations are a feature of Opscode's paid Chef server products, Opscode Hosted Chef and Opscode Private Chef.
[2013-01-28 16:12:41 -0500] opyate: btm: thanks for that
[2013-01-28 16:13:46 -0500] btm: gondoi: apparently our internal openstack cluster doesn't have https configured so I couldn't test it, but I think if you edit knife/openstack_server_create.rb and add this to the hash passed to Fog::Compute.new it will work for you: :connection_options => { :ssl_verify_peer => false }
[2013-01-28 16:13:59 -0500] laurent\: just wondering, what about acl in opensource chef ? is that a feature that going to be include in chef 11 ?
[2013-01-28 16:18:53 -0500] btm: laurent\: Role based access control (RBAC) is not being open sourced at this time. OSS Chef Server 11 is Erchef, without the authorization component, and with the existing OSS Webui (except some work to move it to rails 3).
[2013-01-28 16:29:29 -0500] gondoi: btm: thanks, I'll give it a shot
[2013-01-28 16:31:24 -0500] laurent\: btm: ok
[2013-01-28 16:31:26 -0500] ortho_stice: laurent\: Yeah, I'd love ACL in open-source chef server, too.
[2013-01-28 16:31:58 -0500] ortho_stice: For now, we're running it multi-tenant by having multiple server instances in various silos
[2013-01-28 16:32:24 -0500] ortho_stice: and having some special sauce upload shared cookbooks into each instance
[2013-01-28 16:32:36 -0500] ortho_stice: which is a brittle PITA
[2013-01-28 16:32:56 -0500] ortho_stice: but, well,that's the value-add of hosted/private chef
[2013-01-28 16:33:04 -0500] ortho_stice: (or one of them)
[2013-01-28 16:33:10 -0500] laurent\: i wouldn't use it for multi-tenant, i would use it to give users some specific access without granting them admin
[2013-01-28 16:33:21 -0500] ortho_stice: ahh, I see.
[2013-01-28 16:33:38 -0500] ortho_stice: well, if you fork it and develop that feature, I'd be grateful :)
[2013-01-28 16:33:57 -0500] jtimberman: opyate: closed as not constructive by SvenW, Dave M, Khaled, Ward, Scott Pack 7 mins ago :-|
[2013-01-28 16:33:59 -0500] gondoi: btm: sorry, which file is that? .chef/knife/openstack_server_create.rb or in the actual git repo for knife-openstack and reinstall a custom built gem?
[2013-01-28 16:34:46 -0500] btm: gondoi: inside the gem itself, i.e. that is not currently a feature (you could file a bug to add it if you test it and it works).
[2013-01-28 16:34:55 -0500] gondoi: cool
[2013-01-28 16:35:22 -0500] laurent\: ortho_stice: i think i'll hack the webui to achieve something similar (i've been saying that for the past 18months tho, no time to play with it right now :))
[2013-01-28 16:39:53 -0500] pcn: ohai chefs
[2013-01-28 16:40:11 -0500] pcn: is there any reason that Socket.gethostbyname would behave differenting in irb than in a ruby_block resource?
[2013-01-28 16:40:29 -0500] MattStratton: Dumb question - how do I add users to my hosted chef environment? It seems like they have to already have a user account?
[2013-01-28 16:40:45 -0500] awgross: anyone have a good pattern for installing 10-15 packages w/ explicit versions?  The standard style of `[].each do` wont suffice in this case.
[2013-01-28 16:41:43 -0500] pcn: awgross map lists of lists
[2013-01-28 16:42:12 -0500] pcn: [].each do |pkg, version|
[2013-01-28 16:42:20 -0500] awgross: ah, thanks
[2013-01-28 16:44:06 -0500] opyate: jtimberman: oh, well. Google will index this IRC log for us and future generations will find the answer that way :)
[2013-01-28 16:44:46 -0500] jtimberman: opyate: http://community.opscode.com/chat/chef
[2013-01-28 16:45:17 -0500] jtimberman: opyate: i left a comment on the question, tho, since i couldn't leave an answer
[2013-01-28 16:45:28 -0500] opyate: jtimberman: thanks, I saw
[2013-01-28 16:45:43 -0500] MartinCleaver: Hi - we are doing a knife upload to hosted chef, of the java recipe. It seems to depend on the windows cookbook. So are we supposed to upload the windows cookbook and of it's dependencies, when actually we'll be provisioning a Linux box?
[2013-01-28 16:46:19 -0500] opyate: jtimberman: that question underlies another question I actually have: as a freelancer, how to manage my client installations cleanly
[2013-01-28 16:47:39 -0500] opyate: s#installations#webapps/sites/etc#
[2013-01-28 16:47:48 -0500] awgross: MartinCleaver: check the cookbook to see how it uses Windows, but if it is done right you can just upload a dummy Windows cookbook in its place
[2013-01-28 16:48:09 -0500] MartinCleaver: awgross
[2013-01-28 16:48:43 -0500] MartinCleaver: is there no better way?
[2013-01-28 16:48:43 -0500] awgross: haha
[2013-01-28 16:49:17 -0500] awgross: unsure, I havent had a really big dependency like that which I could get out some other way, but I know i have used modified versions of cookbook dependencies
[2013-01-28 16:49:51 -0500] jtimberman: opyate: indeed. i know there's a number of folks here that do consulting for various customers of their own and use hosted chef.
[2013-01-28 16:49:52 -0500] MartinCleaver: It'd seem more sensible to just tell the configuration that this is just not going to need to work on Windows
[2013-01-28 16:50:22 -0500] awgross: MartinCleaver: the main issue is that Chef will make sure the dependency tree is satisfied somehow.  Alternatively if you are ok with modifying the Java cookbook, remove the windows dependency, thought that makes pulling from upstream harder
[2013-01-28 16:51:04 -0500] awgross: MartinCleaver: it is reading the metadata.rb, unsure how much finagling you can do with that at runtime
[2013-01-28 16:51:07 -0500] jtimberman: MartinCleaver: yeah so, the dependency mechanism for cookbooks is all or nothing, there isn't platform-specific support for dependencies.
[2013-01-28 16:51:19 -0500] MartinCleaver: well, if we depend on the real windows cookbook that's going to try to pull tons of stuff, I'd think
[2013-01-28 16:51:33 -0500] jtimberman: depending on the cookbook in question, it may just need to download *a* windows cookbook
[2013-01-28 16:51:54 -0500] jtimberman: but you can also just remove 'windows' from the metadata.
[2013-01-28 16:52:13 -0500] jtimberman: if the cookbook breaks during chef run time, then the cookbook is broken )
[2013-01-28 16:52:50 -0500] MartinCleaver: I'd rather not edit the cookbook, but rather specify an override somewhere, to keep it clean. Not possible?
[2013-01-28 16:54:24 -0500] jtimberman: not at this time
[2013-01-28 16:54:49 -0500] MartinCleaver: ok, thanks jtimberman, awgross
[2013-01-28 16:56:17 -0500] pixie79: hi all - i am new to chef but am trying to convert from puppet, I am starting with a test on the hosted platform, and want to setup a basic RHEL6 box with SSSD, I have found the authconfig cookbook and I believe I am correct that I put the config in the attributes/default file. Then i should push the cookbook to the server before i try and use it on my new guest?
[2013-01-28 16:57:34 -0500] awgross: jtimberman: there wouldnt happen to be a way to easily set defaults for chef standard resources, like always make my package providers use X retries with Y retry_delay?  Feels annoying to have to specify it each time
[2013-01-28 16:57:39 -0500] pixie79: my question is ideally i want to keep my bindpw secure, so i figure that needs to go in a databag, where should i create the databag? and do i then just reference that from the attributes/default file or do i update the recipie and call it there ?
[2013-01-28 16:58:11 -0500] jtimberman: awgross: There isn't anything built in
[2013-01-28 16:58:24 -0500] awgross: jtimberman: so I would have to create my own LWRP to wrap it eh? hmmm
[2013-01-28 16:58:26 -0500] jtimberman: awgross: you'd have to open the resource class
[2013-01-28 16:58:31 -0500] jtimberman: and override the defaults
[2013-01-28 16:58:36 -0500] jtimberman: or use a definition/lwrp to wrap it
[2013-01-28 16:58:41 -0500] awgross: ok, thanks
[2013-01-28 16:58:45 -0500] jtimberman: I'd probably go with a definition
[2013-01-28 16:58:48 -0500] awgross: something to ponder
[2013-01-28 16:59:19 -0500] awgross: my various package installation blocks are getting larger and larger as I add more boilerplate around them, getting silly
[2013-01-28 17:07:04 -0500] pcn: OK, using resolv instead of socket.
[2013-01-28 17:34:30 -0500] a_a_g: is there a known delay between setting the runlist via knife and it being picked up by chef-client?
[2013-01-28 17:45:27 -0500] bluepojo: I'm trying to come up with a way to assign port numbers that won't have race conditions. I believe updating a databag or doing a node search and reading attributes both have race condition issues if nodes in 2 environments are bootstrapping at the same time.
[2013-01-28 17:45:32 -0500] bluepojo: anyone solve this sort of problem before?
[2013-01-28 17:46:01 -0500] bluepojo: coherence has this quirk where any node on the network that has coherence on it must belong to a cluster with a unique port.
[2013-01-28 17:46:11 -0500] bluepojo: which makes multiple QA environments on the same network a hassle to deploy
[2013-01-28 17:46:27 -0500] bluepojo: cause #2 will fail due to coherence port clash
[2013-01-28 17:49:28 -0500] justincampbell: bluepojo: zookeeper?
[2013-01-28 17:50:02 -0500] bluepojo: hm. good point.
[2013-01-28 17:50:12 -0500] bluepojo: they are using zookeeper for other things.
[2013-01-28 17:50:22 -0500] bluepojo: maybe I will wait till they finish implementing it
[2013-01-28 17:50:25 -0500] bluepojo: and just manually configure for now
[2013-01-28 17:51:04 -0500] justincampbell: i know trotter's been complaining about using databags and search for setting master nodes/etc for HA systems
[2013-01-28 17:51:12 -0500] justincampbell: and preaching something like zookeeper instead
[2013-01-28 17:55:08 -0500] magoo: btm, i wasn't recommending against using node['foo'], quite the opposite
[2013-01-28 17:55:09 -0500] mshilling_: ok ive been banging my head against the wall for a while here
[2013-01-28 17:55:25 -0500] mshilling_: can someone look at this code?  Im trying to put an if statement into a default attributes
[2013-01-28 17:55:31 -0500] mshilling_: https://gist.github.com/4657611
[2013-01-28 17:56:15 -0500] mshilling_: no matter what I do, the if/elseif does not ever get applied, every time the "else" is what gets applied
[2013-01-28 17:57:19 -0500] gondoi: mshilling_: do you not want to do: if node["OCLC_env"]["environ"] = "QA"?
[2013-01-28 17:57:22 -0500] gondoi: erm
[2013-01-28 17:57:23 -0500] gondoi: ==
[2013-01-28 17:57:31 -0500] mshilling_: ive tried it that way
[2013-01-28 17:57:35 -0500] gondoi: oh
[2013-01-28 17:57:36 -0500] gondoi: :(
[2013-01-28 17:57:44 -0500] mshilling_: no difference.  ive used this code before successfully
[2013-01-28 17:58:05 -0500] cwj: i dont think the node object is available for comparison at the point that the cookbook attribute files are being evaluated
[2013-01-28 17:58:31 -0500] gondoi: good point cwj
[2013-01-28 17:58:42 -0500] mshilling_: ^ thats what I was thinking cwj, so I took the logic out of the attributes, and put it in the recipe, and still had crap results
[2013-01-28 17:58:48 -0500] gondoi: mshilling_: have you only successfully used it in a recipe before?
[2013-01-28 17:58:48 -0500] mshilling_: I can revert back again and try again
[2013-01-28 17:58:52 -0500] gondoi: oh
[2013-01-28 17:58:56 -0500] mshilling_: yes gondoi
[2013-01-28 17:59:11 -0500] cwj: mshilling_: when you put it in the recipe you need to do node.set['foo']['bar'] instead of default['foo']['bar']
[2013-01-28 17:59:12 -0500] cwj: fwiw
[2013-01-28 17:59:20 -0500] gondoi: why not just override the attributes with environments directly?
[2013-01-28 17:59:32 -0500] cwj: yes thats another way to do it
[2013-01-28 17:59:39 -0500] gondoi: then place the node in teh appropriate env
[2013-01-28 18:00:00 -0500] mshilling_: I inherited this system, and we're not really using environments the way I'd like.  that would require lots of changes
[2013-01-28 18:00:10 -0500] gondoi: fair enough :D
[2013-01-28 18:00:32 -0500] mshilling_: maybe now is the time to learn and make the change though
[2013-01-28 18:01:52 -0500] mshilling_: can someone give me the syntax for evaluating the environments if I were to create one?
[2013-01-28 18:02:50 -0500] cwj: mshilling_: compare against the node.chef_environment method
[2013-01-28 18:03:02 -0500] cwj: important to note it is a method and not an attribute
[2013-01-28 18:05:03 -0500] mshilling_: so :  if { node.chef_environment == "Development"}
[2013-01-28 18:05:19 -0500] mshilling_: in the recipe?  (or would that work in the attribute file)
[2013-01-28 18:05:43 -0500] heathsnow: Anyone know the cmd to execute knife bootstrap on all machines w/a specific role..and here's the kicker....while maintaining roles and environment for each machine??  (or adding roles/env for machines)
[2013-01-28 18:05:56 -0500] mshilling_: obviously assuming I create an environment called Development, and stick my node in there
[2013-01-28 18:06:07 -0500] mshilling_: guess I can test...instead of fishing for clues :)
[2013-01-28 18:08:09 -0500] cwj: mshilling_: it would work in recipe, dont think it works in your attributes file
[2013-01-28 18:08:16 -0500] cwj: same problem, node object is not available
[2013-01-28 18:09:36 -0500] zts: cookbook attributes files are evaluated in the context of the node object, so I'd expect plain old "chef_environment" to work...
[2013-01-28 18:09:48 -0500] mshilling_: ok, thanks.  only thing that sucks about it is I have to have 6 attributes instead of 2.  owner/group for each environment.  If I could do it in the attributes file, i could define it once based on the condition.  but life goes on.
[2013-01-28 18:10:09 -0500] mshilling_: ill try it both ways
[2013-01-28 18:15:55 -0500] jkeiser: r3vamp: you were hitting an error with knife diff on a cookbook like a week ago  someone else hit the same error you did (or similar), and fyi it was due to them having run knife cookbook delete --purge on another version of the cookbook (which deleted the file in s3)
[2013-01-28 18:16:18 -0500] jkeiser: r3vamp: at any rate, there is a new version of knife-essential with better error reporting that should tell you what actually went wrong
[2013-01-28 18:17:01 -0500] cwj: mshilling_: if you make the move to chef environments then you can set reasonable defaults in the cookbook attributes file and specify the environment-specific attribute values at the environment level and
[2013-01-28 18:17:17 -0500] cwj: er ignore superfluous "and" at the end there :)
[2013-01-28 18:26:48 -0500] k0rupted: I have a problem with the tomcat cook book and specifically the tomcat:users recpie... I'm trying to load the encrypted_secrete via another cookbook higher up the runlist, but no matter what it seems that it processes everything in the runlist before it starts to execute. http://pastebin.com/B8fj1shh
[2013-01-28 18:27:43 -0500] k0rupted: should I be doing it differently?
[2013-01-28 18:28:13 -0500] mshilling_: OK now I want to tear my hair out
[2013-01-28 18:28:14 -0500] mshilling_: https://gist.github.com/4657856
[2013-01-28 18:28:39 -0500] mshilling_: changed it to use environments, added my node, put the logic into the recipe, it STILL wont follow the logic
[2013-01-28 18:30:55 -0500] tomdzk: mshilling_: shouldn't that be an elseif for QA as well ?
[2013-01-28 18:30:55 -0500] cwj: i guess i never use elseif in ruby, i would use a case statement there instead
[2013-01-28 18:31:46 -0500] mshilling_: ive never used case
[2013-01-28 18:32:00 -0500] mshilling_: I can look it up (or you can give me an example)
[2013-01-28 18:32:21 -0500] rshade98: I am working on an lwrp. How do i access attributes set in the recipe
[2013-01-28 18:32:42 -0500] mshilling_: if thats all it is domdzk, I'll...I dunno what.
[2013-01-28 18:32:54 -0500] tomdzk: mshilling_: though they seem to differ only on the key into node[:appdata] (:prod vs. :dev vs. :qa) which you could do with a simpler if/case statement
[2013-01-28 18:32:56 -0500] rshade98: I have tried :name, and it seems to print :name
[2013-01-28 18:33:10 -0500] carldanley: anyone know whats causing this: http://d.pr/i/QRK8 ?
[2013-01-28 18:33:16 -0500] cwj: mshilling_: https://gist.github.com/4657890
[2013-01-28 18:33:16 -0500] rshade98: do I need new_resource.name?
[2013-01-28 18:33:40 -0500] bluepojo: carldanley: need more of the stack trace. Can you gist your log?
[2013-01-28 18:33:50 -0500] bluepojo: or I mean
[2013-01-28 18:33:52 -0500] mshilling_: cwj: thanks, I'll try that
[2013-01-28 18:33:55 -0500] bluepojo: more of the context
[2013-01-28 18:33:57 -0500] carldanley: sure, sec bluepojo
[2013-01-28 18:34:24 -0500] bluepojo: gist the recipe as well
[2013-01-28 18:34:39 -0500] bluepojo: or at least the relevant bit
[2013-01-28 18:34:41 -0500] carldanley: http://d.pr/n/ncBv
[2013-01-28 18:35:03 -0500] carldanley: http://d.pr/i/VFxm
[2013-01-28 18:35:30 -0500] wassy121: Hey there fellow chefs.  Is there a way to, upon a failed run of an execute resource, run a command to "clean up" post-failure?
[2013-01-28 18:36:00 -0500] mshilling_: cwj: holy crap, thanks.  that works great.  its been a long day
[2013-01-28 18:36:19 -0500] cwj: mshilling_: cool
[2013-01-28 18:36:35 -0500] carldanley: bluepojo: relevant info above ^
[2013-01-28 18:36:50 -0500] cwj: if you can get around to using real chef environments you can eliminate all the redundancy in that recipe
[2013-01-28 18:37:16 -0500] bluepojo: carldanley: this doesn't immediately solve your issue, but did you know there is a database cookbook? https://github.com/opscode-cookbooks/database
[2013-01-28 18:37:38 -0500] carldanley: bluepojo: i didnt know that
[2013-01-28 18:38:25 -0500] carldanley: bluepojo: thats awesome, will add that instead - much easier than writing provisioning stuff for it
[2013-01-28 18:38:46 -0500] bluepojo: :D
[2013-01-28 18:39:44 -0500] bluepojo: carldanley: your problem in the code you pasted is that you are missing a quote at the end of the first execute line
[2013-01-28 18:40:02 -0500] bluepojo: cause there's an escaped quote
[2013-01-28 18:40:11 -0500] bluepojo: so it's easy to miss
[2013-01-28 18:42:10 -0500] carldanley: bluepojo: i would be missing it :( thnx for spotting that
[2013-01-28 18:42:17 -0500] carldanley: gonna checkout the database cookbook in the mean time
[2013-01-28 18:42:27 -0500] carldanley: looks like exactly what I needed
[2013-01-28 18:50:43 -0500] doomviking: This cookbook makes your favorite breakfast sandwhich.
[2013-01-28 18:54:20 -0500] hippiehacker: https://github.com/RiotGames/berkshelf/commit/39c08ab71c11c50b5b0f85916af0f9565422b9a4#commitcomment-2513723 # I feel like I'm missing something obvious here
[2013-01-28 18:57:02 -0500] bluepojo: hippiehacker: I think your comment is correct I suppose we need to extend Vagrant UI if we want to use deprecated like that.
[2013-01-28 18:57:21 -0500] josephholsten: +1
[2013-01-28 18:57:23 -0500] bluepojo: appears to be an oversight in the vagrant plugin
[2013-01-28 18:58:06 -0500] amccloud: Should I be doing <%= @node[:hostname] %> or <%= node[:hostname] %>  in my templates?
[2013-01-28 18:58:43 -0500] bluepojo: amccloud: I do without @, but I also generally try not to use node in templates preferring to pass the values in via variables
[2013-01-28 18:58:44 -0500] carldanley: i think @ amccloud
[2013-01-28 18:58:51 -0500] carldanley: nvmd me
[2013-01-28 18:58:56 -0500] makerbreakr: the latter is standard
[2013-01-28 18:59:05 -0500] makerbreakr: unless its from a var, then @
[2013-01-28 18:59:17 -0500] makerbreakr: (from what I have seen)
[2013-01-28 18:59:34 -0500] carldanley: oh like var from template?
[2013-01-28 18:59:38 -0500] bluepojo: eg: @hostname via variables(hostname: node[:hostname])
[2013-01-28 18:59:38 -0500] carldanley: and not a node setting?
[2013-01-28 18:59:45 -0500] josephholsten: definitely don't use @node, keep @instance_vars for the ones passed from the template
[2013-01-28 18:59:51 -0500] carldanley: ok cool
[2013-01-28 18:59:54 -0500] makerbreakr: in the template directive, variables()
[2013-01-28 18:59:56 -0500] amccloud: okay thanks
[2013-01-28 19:00:49 -0500] josephholsten: and I strongly recommend you only let yourself access node['fqdn'] &/ node['hostname'], anything else should be passed in via a variable
[2013-01-28 19:01:21 -0500] josephholsten: makes it much easier to refactor to a resource/provider later
[2013-01-28 19:07:37 -0500] btm: @opscode Chef Code Review, join: http://bit.ly/14phZkw, watch: http://youtu.be/FmYFC37YAaM #opschef
[2013-01-28 19:14:27 -0500] dougireton: Anyone from Opscode know what the agenda for the workshop day at Chefconf is? I'm trying to decide if I should go to it. Will it just be Chef 101 classes?
[2013-01-28 19:22:22 -0500] paigeadele_: thank god for that taco truck
[2013-01-28 19:27:00 -0500] carldanley: bluepojo: so for the database cookbook, this line here "::File.open"...
[2013-01-28 19:27:04 -0500] carldanley: is that the cookbook file
[2013-01-28 19:27:09 -0500] carldanley: or the file found on the VM ?
[2013-01-28 19:29:36 -0500] bluepojo: It's using the Ruby core File class, so that means it's opening a file on the box where the recipe is running.
[2013-01-28 19:29:49 -0500] bluepojo: carldanley:
[2013-01-28 19:30:39 -0500] carldanley: ahhh ty bluepojo
[2013-01-28 19:38:26 -0500] carldanley: bluepojo: tried the path to it, still doesnt work
[2013-01-28 19:38:26 -0500] carldanley: http://d.pr/n/Q7kl
[2013-01-28 19:38:28 -0500] carldanley: chef solo
[2013-01-28 19:38:46 -0500] carldanley: verified that the path is both: correct and actually exists
[2013-01-28 19:39:01 -0500] bluepojo: are you running chef solo on a server?
[2013-01-28 19:39:04 -0500] bluepojo: or a vagrant box
[2013-01-28 19:39:04 -0500] bluepojo: ?
[2013-01-28 19:39:15 -0500] bluepojo: carldanley:
[2013-01-28 19:40:28 -0500] bluepojo: cause that is a path to your local box
[2013-01-28 19:40:39 -0500] bluepojo: if you are running chef solo on a server, that path is not going to exist
[2013-01-28 19:40:48 -0500] bluepojo: the recipe is run on the server, not on your box
[2013-01-28 19:40:56 -0500] bluepojo: even though the logs are piped back to your shell
[2013-01-28 19:45:04 -0500] jtimberman: carldanley: we use ::File because there's a Chef::Resource::File that chef would attempt to use instead.
[2013-01-28 19:46:50 -0500] jstump: Does anyone know how to grab an environment from a recipe? I need to grab my staging environment's MySQL config from it's environment JSON payload.
[2013-01-28 19:48:11 -0500] jtimberman: jstump: node.chef_environment
[2013-01-28 19:48:33 -0500] jtimberman: jstump: the environment is not stored as an attribute, but the #chef_environment method will return the environment of the Chef::Node object.
[2013-01-28 19:48:41 -0500] jstump: jtimberman: Not *quite* what I need. I need to grab attributes from Environment A in a server in Environment B.
[2013-01-28 19:48:59 -0500] bluepojo: that sounds slightly misguided
[2013-01-28 19:49:24 -0500] jtimberman: jstump: you can search for the node, say by a role, and retrieve its environment
[2013-01-28 19:49:31 -0500] jstump: bluepojo: Yeah, I figured someone would say that. My CI server, which is in the production environment, needs to know my staging server's MySQL configuration, which is in my staging environment.
[2013-01-28 19:49:47 -0500] jtimberman: jstump: other_node = search(:node, "role:mysql_server AND environment:staging")
[2013-01-28 19:49:56 -0500] jtimberman: other_node[0].chef_environment
[2013-01-28 19:50:08 -0500] jtimberman: (search results are an array of matching objects, so that would be the first one.
[2013-01-28 19:50:17 -0500] jtimberman: if you had multiple you could use map, or iterate over them.
[2013-01-28 19:50:48 -0500] jstump: jtimberman: And node.chef_environment is the full hash of the environment? The docs would indicate it's a string (e.g. "node.chef_environment == 'staging'")
[2013-01-28 19:50:58 -0500] bluepojo: jstump: what if you used knife in CI to read the other environment and update it's own environment with the values?
[2013-01-28 19:51:03 -0500] bluepojo: I think that would be more straight forward
[2013-01-28 19:51:46 -0500] nathenharvey: dougireton:  we're still finalizing the workshop day for #ChefConf.  There will definitely be some Chef 101 workshops.  Looking to lock-in one or two "advanced" workshops, too
[2013-01-28 19:51:49 -0500] jstump: bluepojo: I was hoping to write a my.cnf file with a template. I suppose extracting that information on every single build is an option too.
[2013-01-28 19:52:09 -0500] josephholsten: and the code review died?
[2013-01-28 19:52:11 -0500] bluepojo: oh, that's a lot of values
[2013-01-28 19:52:13 -0500] bluepojo: lol
[2013-01-28 19:52:27 -0500] bluepojo: I think I'd still fetch the values
[2013-01-28 19:52:33 -0500] bluepojo: then you don't need special things in your cookbook for CI
[2013-01-28 19:52:57 -0500] jstump: bluepojo: You're right. Now I just need special things in my CI configurations. ;)
[2013-01-28 19:53:11 -0500] bluepojo: which makes sense cause those special things are for CI, right?
[2013-01-28 19:53:36 -0500] jstump: bluepojo: So is this recipe I'm writing so I don't really see the huge win there.
[2013-01-28 19:53:43 -0500] bluepojo: fair enough
[2013-01-28 19:53:53 -0500] jstump: bluepojo: In fact, my Jenkins config.xml's are in Chef sooooo .
[2013-01-28 19:54:17 -0500] nathenharvey: dougireton: and a workshop on incident management, too.  not chef related but would probably be run by Ron Vidal who spoke at last year's #ChefConf - http://www.youtube.com/watch?v=4d38Ena1Abo
[2013-01-28 19:54:49 -0500] nathenharvey: dougireton:  what are you interested in for the workshops?
[2013-01-28 19:55:45 -0500] jstump: bluepojo: I think the most correct thing to do here is to move my Jenkins from production -> staging.
[2013-01-28 19:56:17 -0500] bluepojo: that would make things simpler
[2013-01-28 19:57:15 -0500] CharlieSu: Hi all.  I'm looking at how the Postgres cookbook handled config for the pg_hba.conf files and I'd like to do something similar, but I'd like to do variable substitution for certain attributes.  Is this possible?  https://gist.github.com/183163c5f72d81fd8330
[2013-01-28 19:58:19 -0500] CharlieSu: For example.  Could I change one of the 'type' values into something like 'type' => node[:key][:type]
[2013-01-28 19:59:00 -0500] makerbreakr: charliesu, yes you can, but you need to pass it to the template as a variable
[2013-01-28 20:00:43 -0500] CharlieSu: makerbreakr: ahh..  that makes sense..  let me try that.. thanks!
[2013-01-28 20:01:05 -0500] makerbreakr: and depending on what you are doing, you may not want to make it a default
[2013-01-28 20:01:05 -0500] makerbreakr: etc
[2013-01-28 20:01:25 -0500] CharlieSu: makerbreakr: hum.. so what would the attribute file look like if I was going to pass it in as a variable template?
[2013-01-28 20:01:50 -0500] CharlieSu: makerbreakr: how do i reference the variable i'm going to pass into the template?
[2013-01-28 20:02:00 -0500] makerbreakr: in the template block
[2013-01-28 20:02:01 -0500] makerbreakr: 1 sec
[2013-01-28 20:03:01 -0500] makerbreakr: https://gist.github.com/4658540
[2013-01-28 20:03:26 -0500] makerbreakr: thats an example of a template block, from one of my recipes, node_databag,  is just a databag
[2013-01-28 20:03:32 -0500] makerbreakr: that I set up earlier in the recipe
[2013-01-28 20:04:37 -0500] r3vamp: jkeiser: ahh, I had done a knife cookbook delete --purge as well. Once again, thanks for your work!
[2013-01-28 20:05:27 -0500] CharlieSu: makerbreakr: ya.. i get that..  but i don't think you see what i'm doing all the way.. i use variables in templates all the time..   The problem is that I'm trying to do.  Look at this GIST  https://gist.github.com/4658555#file-default-rb-L2
[2013-01-28 20:06:15 -0500] CharlieSu: makerbreakr: I want to be able to set node[:attribute][:key]  and have it change what node['postgresql']['pg_hba'] evaluates to
[2013-01-28 20:06:58 -0500] dotslash: Is chef-client 10.x compatible with chef-server 11.x?
[2013-01-28 20:07:27 -0500] btm: dotslash: yes
[2013-01-28 20:08:16 -0500] kallistec: dotslash: there are some quirks with `knife client reregister` and what's essentially the same operation on chef-client (use admin key for validator, delete client.pem, run chef-client)
[2013-01-28 20:08:25 -0500] kallistec: those are fixed in 10.18
[2013-01-28 20:09:26 -0500] kallistec: dotslash: `knife client delete` and create work so you could work around those if you're on an older version and won't upgrade
[2013-01-28 20:09:43 -0500] CharlieSu: kallistec: chef-server 11.x much faster?
[2013-01-28 20:09:46 -0500] dotslash: Ok great. Thanks.
[2013-01-28 20:10:05 -0500] kallistec: CharlieSu: yes, much much faster
[2013-01-28 20:10:12 -0500] carldanley: bluepojo, jtimberman: http://d.pr/i/srdW and http://d.pr/n/bJXx
[2013-01-28 20:10:16 -0500] carldanley: still doesnt work
[2013-01-28 20:10:22 -0500] carldanley: verified that the file was copied over
[2013-01-28 20:10:27 -0500] dotslash: Am I also correct that chef-server 11 only needs port 443 open? You don't need 4000 any more because it is routed based on HTTP headers?
[2013-01-28 20:10:56 -0500] CharlieSu: kallistec: Is there an official release yet or should I wait?
[2013-01-28 20:11:10 -0500] makerbreakr: charliesu, sorry, phone call
[2013-01-28 20:11:25 -0500] makerbreakr: where are you wanting that attribute data to come from?
[2013-01-28 20:11:55 -0500] CharlieSu: makerbreakr: an override in an environment or a default value before that attribute in the attributes file..
[2013-01-28 20:12:04 -0500] kallistec: CharlieSu: there's a prerelease, no known open bugs
[2013-01-28 20:12:23 -0500] kallistec: but not officially released and no migration tools published yet either
[2013-01-28 20:12:46 -0500] btm: @opscode cookbook code review, join: http://bit.ly/X9AEfV, watch: http://youtu.be/lcAfQJNKiJ4 #opschef
[2013-01-28 20:13:04 -0500] CharlieSu: kallistec: i've got tons of old versions of cookbooks in my couchDB that I don't have readily available to push to a new server..  how would that work?
[2013-01-28 20:14:07 -0500] kallistec: CharlieSu: you can knife cookbook download (then git init .; git add .; git commit -m "oops" :P ) and knife cookbook upload
[2013-01-28 20:14:49 -0500] CharlieSu: kallistec: good idea
[2013-01-28 20:15:26 -0500] kallistec: should be able to do that in ye olde for loop
[2013-01-28 20:15:46 -0500] CharlieSu: for loop?  jk..
[2013-01-28 20:16:00 -0500] dotslash: So chef-server 11 only needs port 443 open right? You don't need 4000 any more because it is routed based on HTTP headers?
[2013-01-28 20:16:11 -0500] patcon: patcon
[2013-01-28 20:16:15 -0500] patcon: oops :/
[2013-01-28 20:16:23 -0500] carldanley: bluepojo, jtimberman: http://d.pr/i/srdW and http://d.pr/n/bJXx - wait is this because of the period in the db name ?
[2013-01-28 20:16:32 -0500] carldanley: was assuming it could handle it
[2013-01-28 20:17:36 -0500] carldanley: anyone? stuck without my dev environment :(
[2013-01-28 20:18:25 -0500] aboudreault: Hi!
[2013-01-28 20:19:21 -0500] aboudreault: ah. good, got my answer in the topic.
[2013-01-28 20:19:34 -0500] kovyrin: hey guys
[2013-01-28 20:19:53 -0500] kovyrin: what's the official recommended way of installing chef-server on ubuntu 12.04?
[2013-01-28 20:20:36 -0500] CharlieSu: kovyrin: install Chef w/ Chef :)
[2013-01-28 20:21:30 -0500] kovyrin: CharlieSu: you mean bootstrap?
[2013-01-28 20:22:17 -0500] makerbreakr: kovyrin, there is a write up on opscode
[2013-01-28 20:22:47 -0500] kovyrin: the thing is, I've been using chef for many years now and using ruby gems was my favourite way of managing chef deployments, but now I see that chef-expander depends on an ancient eventmachine gem version that does not work on ruby 1.9.3
[2013-01-28 20:23:16 -0500] gchristensen: kovyrin: generall using the omnibus installer is highly recommended
[2013-01-28 20:23:19 -0500] CharlieSu: kovyrin: use the omnibus installer to get a version of chef onto the box..  then point it to a chef-server cookbook to install
[2013-01-28 20:24:28 -0500] kovyrin: so I'm stuck and not sure if I should keep pushing forward trying to make gem-based deployment (not sure it is important for opscode because it's been broken for many months now) or find THE supported way of installing the thing...
[2013-01-28 20:26:00 -0500] kaerast: has anybody got experience with the supervisord cookbook (http://community.opscode.com/cookbooks/supervisord)?  I can't work out how I'm supposed to pass in variables to the individual jobs
[2013-01-28 20:26:39 -0500] dotslash: Sorry to keep asking, but someone is wanting to know for a meeting in 5 minutes: Chef 11 only requires port 443 to work correct? The gui and the client connection all work over this?
[2013-01-28 20:27:52 -0500] joel: http://wiki.opscode.com/display/chef/Deploy+Resource - Is it possible to pass svn_info_args from a role? {"default_attributes": { "subversion": { "svn_info_args": "--trust-server-sert" } } } isn't working for me.
[2013-01-28 20:31:33 -0500] griffindy: is there any way to access the chef API using jRuby?
[2013-01-28 20:32:34 -0500] griffindy: as the gem still has a C extension (yajl)
[2013-01-28 20:33:00 -0500] josephholsten: griffindy: there's a gem that's just an api client, let me look
[2013-01-28 20:33:09 -0500] griffindy: that would be perfect
[2013-01-28 20:33:17 -0500] makerbreakr: Spice
[2013-01-28 20:33:28 -0500] makerbreakr: spice gem rather
[2013-01-28 20:33:51 -0500] griffindy: thanks guys!
[2013-01-28 20:33:59 -0500] josephholsten: +1
[2013-01-28 20:34:04 -0500] bluepojo: griffindy: we use https://github.com/reset/ridley
[2013-01-28 20:34:39 -0500] bluepojo: cause spice was problematic/annoying
[2013-01-28 20:34:44 -0500] josephholsten: oh, that one explicitly supports jruby
[2013-01-28 20:34:53 -0500] griffindy: bluepojo what problems did you have?
[2013-01-28 20:36:00 -0500] bluepojo: hm, this was a while ago, I'm trying to remember the concerns
[2013-01-28 20:36:10 -0500] bluepojo: been using ridley for a long time
[2013-01-28 20:36:16 -0500] griffindy: no problem if you can't, I'm going to try ridley first
[2013-01-28 20:43:27 -0500] zooz: hi guys
[2013-01-28 20:43:32 -0500] zooz: I am a long-time puppet user
[2013-01-28 20:43:45 -0500] bluepojo: hi
[2013-01-28 20:43:50 -0500] zooz: have decided (almost had no choice) to move to chef
[2013-01-28 20:44:17 -0500] CharlieSu: Any tomcat7 cookbooks out there?
[2013-01-28 20:44:43 -0500] zooz: is there an easy way to deploy chef on Fedora distributions?
[2013-01-28 20:44:47 -0500] gondoi: mattray: I'm at a loss on my knife-openstack plugin :( keeps telling me invalid URI, but I can use it with supernova just fine
[2013-01-28 20:45:00 -0500] mattray: gondoi: supernova?
[2013-01-28 20:45:09 -0500] mattray: gondoi: which version of fog?
[2013-01-28 20:45:17 -0500] mattray: 1.9.0 broke rackspcae and hp
[2013-01-28 20:45:23 -0500] mattray: openstack is probably broken too
[2013-01-28 20:45:24 -0500] gondoi: mattray: https://github.com/rackerhacker/supernova
[2013-01-28 20:45:37 -0500] gondoi: i'm using 1.8.0 cause I knew 1.9 was busted
[2013-01-28 20:45:57 -0500] mattray: you have a stack trace?
[2013-01-28 20:46:03 -0500] mattray: -VV showing anything?
[2013-01-28 20:46:04 -0500] gondoi: sure do
[2013-01-28 20:46:12 -0500] mattray: or even connecting with irb?
[2013-01-28 20:46:18 -0500] timsmith1: zooz: You can deploy using ruby gems or the chef omnibus installer on the opscode site.  Most of the community cookbooks have some level of Fedora support as well
[2013-01-28 20:46:22 -0500] gondoi: it gets all the way to URI parse in common.rb
[2013-01-28 20:46:35 -0500] gondoi: give me a min to move it to a gist
[2013-01-28 20:47:10 -0500] mattray: working on updates to hp/rackspace/openstack now
[2013-01-28 20:47:15 -0500] zooz: timsmith1, right, I see. I meant native fedora packages.. I guess I will have to spend some time on it, build them and host it somewhere
[2013-01-28 20:47:33 -0500] zooz: and maybe push upstream
[2013-01-28 20:50:15 -0500] gondoi: mattray: note, we don't have the key extension enabled, so I removed that as a requirement, and we don't have a valid cert so passed that as an ignore here
[2013-01-28 20:50:17 -0500] gondoi: https://gist.github.com/97b1b207a6e8e55a8880
[2013-01-28 20:50:36 -0500] gondoi: the url is not really example.com.. just took it out ;-)
[2013-01-28 20:51:58 -0500] mattray: gondoi: my guess is you have a typo in your knife.rb that is masking the real error
[2013-01-28 20:52:03 -0500] aboudreault: what's the recipe to install ubuntu packages with chef? trying to search for package but doesn't seem to be right
[2013-01-28 20:53:25 -0500] gondoi: hmm someone else asked if I had a special character in there somewhere.. but it's the same knife.rb I used to build on rackspace, just added options to build on openstack
[2013-01-28 20:53:38 -0500] gondoi: i'll look through it some more though
[2013-01-28 20:54:41 -0500] tomdzk: aboudreault: the package resource (http://wiki.opscode.com/display/chef/Resources#Resources-Package) should choose the apt provider automatically when run on debian/ubuntu
[2013-01-28 20:54:47 -0500] mattray: gondoi: that just seems really weird, to be complaining about the URI
[2013-01-28 20:54:53 -0500] aboudreault: tomdzk, thanks.
[2013-01-28 20:55:01 -0500] gondoi: i thought so too :(
[2013-01-28 21:03:56 -0500] evxd: gondoi: did you remove the gist?
[2013-01-28 21:04:12 -0500] gondoi: yes :D
[2013-01-28 21:04:21 -0500] gondoi: i noticed something in there I didn't want in there
[2013-01-28 21:04:26 -0500] gondoi: i can put it back up though
[2013-01-28 21:04:55 -0500] evxd: go for it. all your passwords just show up as asterisks to everyone else anyway. ;)
[2013-01-28 21:05:06 -0500] gondoi: lol
[2013-01-28 21:05:11 -0500] gondoi: it's cool, my password is 12345
[2013-01-28 21:07:20 -0500] evxd: that's the kind of thing an idiot would have on his luggage
[2013-01-28 21:08:09 -0500] gondoi: evxd: https://gist.github.com/e4724bcf5f8e372aa83a
[2013-01-28 21:10:34 -0500] evxd: ty, i'll see if i can reproduce it
[2013-01-28 21:15:58 -0500] jmazzi: what are the consequences, if any, of creating and use a new validation key? does it affect existing clients? Would they all need new keys?
[2013-01-28 21:16:48 -0500] cwj: jmazzi: existing clients would need the new key if they were to lose their existing key
[2013-01-28 21:17:16 -0500] evxd: jmazzi: http://wiki.opscode.com/download/attachments/19071693/authn-flow.png?version=1&modificationDate=1319579899000
[2013-01-28 21:17:34 -0500] cwj: excellent diagram
[2013-01-28 21:17:39 -0500] cwj: \m/
[2013-01-28 21:17:49 -0500] jmazzi: ty
[2013-01-28 21:51:35 -0500] dotslash: It sounds like the _default environment can't be assigned a run list. Is there another way to assign a run list to be automatically run when the client is installed using knife bootstrap?
[2013-01-28 21:53:40 -0500] timsmith1: dotslash: You would want to apply a role with a runlist to your nodes at bootstrap
[2013-01-28 21:54:16 -0500] cheflevelramen: Hi everyone. I'm trying to design some basic topology infrastructure for my environment and I'd like to see if any of you have some tips on the matter. It's a pretty basic MySQL, Master/Slave set up with some Rsync crons going from master to slave.
[2013-01-28 21:55:09 -0500] cheflevelramen: Any suggestions on how to tell nodes whether they are master or slave, and be able to look up the cooresponding server?
[2013-01-28 21:55:34 -0500] cheflevelramen: I'd rather not set up seperate roles for master and slave if it can be avoided.
[2013-01-28 21:55:43 -0500] dotslash: timsmith1: I thought knife bootstrap actually created the node on the server when it installs chef on the client. Oh I see. There is an option to give it a role in the bootstrap process. Thanks!
[2013-01-28 21:55:49 -0500] cheflevelramen: Anyway, just curious if others have run into this and how you may have solved it
[2013-01-28 21:57:17 -0500] dotslash: cheflevelramen: so you want a machine to be able to say "I'm a slave and my master is x" or vice versa?
[2013-01-28 21:57:42 -0500] cheflevelramen: dotslash: yep, that's about it.
[2013-01-28 21:58:24 -0500] cheflevelramen: dotslash: sorry, vice versa as well. I'd like to be able to find out both what the master is, and what the slave is
[2013-01-28 21:58:55 -0500] dotslash: cheflevelramen: So from the slave find the master and from the master find the slave? Or are you wanting to find this from outside the servers?
[2013-01-28 21:58:59 -0500] ctracey: cheflevelramen: we do the same and there are some flags that we look for - there is nothing definitive though.  seemed odd to me as well.
[2013-01-28 22:00:13 -0500] ctracey: although we have successfully automated it.
[2013-01-28 22:00:46 -0500] cheflevelramen: dotslash: Yea, when I boot a new DB instance, I'd like it to know whether its going to be a slave, and configure it accordingly, or if it's a master, and configure it. The obviously way is to set up seperate roles, but just seems a bit silly.
[2013-01-28 22:01:34 -0500] cheflevelramen: ctracey: Good to know it can be done. Any more on which flags gave you enough insight to properly assign the server as master or slave?
[2013-01-28 22:01:47 -0500] c_t: cheflevelramen: you could assign the values directly to the node
[2013-01-28 22:02:06 -0500] c_t: or, I suppose, have subsidiary roles for the specific master/slave differences
[2013-01-28 22:02:38 -0500] ctracey: cheflevelramen: its probably not that silly to be honest.  we built ours as one role and there are times where I wish it would be separate.\
[2013-01-28 22:02:55 -0500] ctracey: cheflevelramen: i would actually have to look - did this a long time ago,.
[2013-01-28 22:03:11 -0500] cheflevelramen: c_t: yea, subsidiary roles would work. As for assign the values directly to the node, that would also work if there was some way to dynamically identify it as a master as a slave.
[2013-01-28 22:03:37 -0500] cheflevelramen: ctracey: That's interesting. So maybe it is better to have two roles for master/slave then?
[2013-01-28 22:03:50 -0500] ctracey: we actually have it configured to the point where we can recreate slaves within a few minutes.  this has saved our asses countless time.
[2013-01-28 22:03:56 -0500] ctracey: times*
[2013-01-28 22:04:56 -0500] cheflevelramen: ctracey: Yea, that's what I'm implementing now. I have the server being rebuilt from the latest backup, so it's pretty close. Just a few things like Rsync and MySQL replication that depend on a node to node relationship that I'm trying to get sorted out now
[2013-01-28 22:05:16 -0500] ctracey: we dont use rsync
[2013-01-28 22:05:24 -0500] c_t: the subsidiary role thing might be most straightforward, then
[2013-01-28 22:05:32 -0500] ctracey: we are on EBS (bleh!) and use snapshots
[2013-01-28 22:05:45 -0500] c_t: I *think* roles don't have to have run lists, but I could be wrong
[2013-01-28 22:06:21 -0500] c_t: lately I've been consolidating our roles, because I was getting tired of having two separate roles for, say, staging & production webheads
[2013-01-28 22:06:31 -0500] c_t: (environments to the rescue there)
[2013-01-28 22:06:51 -0500] cheflevelramen: Cool, well thanks for the advice guys. I think I will just go with multiple roles. That was my initial thought, but I wanted to try to keep it to as few roles as possible.
[2013-01-28 22:07:05 -0500] ctracey: cheflevelramen: turns out we flag on metadata that we add during provisioning.
[2013-01-28 22:07:13 -0500] ctracey: we also use master.info as a hint.
[2013-01-28 22:07:17 -0500] cheflevelramen: c_t: yep, been making good use of environments so far. Hopefully when all is said and done I only have 6 or so roles
[2013-01-28 22:08:17 -0500] dotslash: cheflevelramen: If there is a way to tell it what to do programmatically you could have a recipe figure it out on the machine and set it when it runs.
[2013-01-28 22:09:22 -0500] ctracey: cheflevelramen: another hint we give ourselves is that we dump a bunch of replication data into the snapshot
[2013-01-28 22:09:29 -0500] cheflevelramen: dotslash: Yea, like ctracey just mentioned above, you could use metadata on provisioning, maybe even use an aws tag or something. From there doing what you said wouldn't be too hard.
[2013-01-28 22:09:44 -0500] ctracey: that tells us who the master is, what the log status is, etc.
[2013-01-28 22:09:59 -0500] ctracey: imagine you could do that same with rsync
[2013-01-28 22:10:17 -0500] ctracey: how are you maintaining consistency?
[2013-01-28 22:11:14 -0500] dotslash: cheflevelramen: are you using chef to do the actual provisioning?
[2013-01-28 22:11:15 -0500] cheflevelramen: ctracey: That could work. I do the same thing as well, but with the mysql replication log information, the master might have changed by the time we are restoring. For instance, if us-east were to go down and we were spinning up in west, there would be both a new master and slave
[2013-01-28 22:11:28 -0500] cheflevelramen: dotslash: using knife
[2013-01-28 22:13:23 -0500] cheflevelramen: The other reason I wanted to stay away from multiple roles is if a master mysql server goes down, and we promote a slave to a master, the roles would be wrong.
[2013-01-28 22:14:40 -0500] cheflevelramen: Can a node change it's own roles?
[2013-01-28 22:14:45 -0500] dotslash: cheflevelramen: If you named your servers something like: pair01.slave, pair01.master, pair02.slave, pair02.master, each pair should be able to tell what it was by looking at its name and it should be able to find the name of the other one just by looking at its name.
[2013-01-28 22:15:24 -0500] dotslash: cheflevelramen: You'd just need a way for a recipe to find the dns for a machine if it knows its chef node name.
[2013-01-28 22:15:29 -0500] cheflevelramen: dotslash: that's a good idea. Still, naming your servers is a bit inflexible, and might be an issue during server promotion
[2013-01-28 22:17:10 -0500] cheflevelramen: when using chef with MySQL master/slave set ups, do you still take advantage of server promotion during master failure? Or do you simply spin up a new master server?
[2013-01-28 22:19:12 -0500] ctracey: cheflevelramen: we promote and then respin a slave
[2013-01-28 22:19:48 -0500] ctracey: there is a ton of orchestration that you need to do in order to repoint things
[2013-01-28 22:20:11 -0500] ctracey: so we simply promote and then backfill behind
[2013-01-28 22:20:26 -0500] cheflevelramen: ctracey: cool. And you are able to do that because you have a single role for the two servers I suppose. Could be hard to automate promotion in chef if there were two roles.
[2013-01-28 22:22:37 -0500] ctracey: cheflevelramen: yes, that is true.
[2013-01-28 22:22:55 -0500] cheflevelramen: ctracey: I'm thinking now that this might be solved easy enough with a combination of ec2 tags and server/node names. Tags are easy to manage with cookbooks, and so could be dynamically changed. The server with the 'master' tag for example could be the master server, and a slave could be promoted by applying the 'master' tag to it and deleting it from the other server.
[2013-01-28 22:23:01 -0500] ctracey: the reason i want them separate is that i would rather only snapshot on slaves
[2013-01-28 22:23:13 -0500] ctracey: right now we do so on both masters and slaves
[2013-01-28 22:23:32 -0500] gondoi: mattray: found it
[2013-01-28 22:23:35 -0500] gondoi: it's a fog bug
[2013-01-28 22:23:35 -0500] gondoi: :D
[2013-01-28 22:23:49 -0500] cheflevelramen: ctracey: makes sense. By using aws tags, you could see that it's a slave or master server and snapshot accordingly
[2013-01-28 22:24:04 -0500] gondoi: our implementation of openstack does not have a public endpoint uri so it was coming back as nil
[2013-01-28 22:24:05 -0500] ctracey: cheflevelramen: just be careful of a split brain scenario
[2013-01-28 22:24:13 -0500] gondoi: thus URI could not be parsed :D
[2013-01-28 22:24:37 -0500] gondoi: i swapped it with the manament url that is return and boom goes the dynamite
[2013-01-28 22:24:42 -0500] cheflevelramen: ctracey: true, if chef runs aren't coordinated, two servers could potentially have 'master' tags
[2013-01-28 22:25:53 -0500] mattray: gondoi: fixed in > 1.9?
[2013-01-28 22:26:04 -0500] gondoi: working on a pull request :D
[2013-01-28 22:26:05 -0500] mattray: gondoi: because that's where I'm testing right now
[2013-01-28 22:26:10 -0500] cheflevelramen: ctracey: Thanks for your help, I think I can get this working. Probably could just as easily set up a topology database or use data bags even
[2013-01-28 22:26:20 -0500] jubilo: Can anyone help me figure out if I'm on the right track with a cookbook I'm trying to write?
[2013-01-28 22:26:32 -0500] gondoi: mattray: https://github.com/fog/fog/blob/master/lib/fog/openstack/compute.rb#L410
[2013-01-28 22:26:36 -0500] mattray: gondoi: I want to rev hp/rackspace/openstack for the next Fog release. Lemme know about your PR and I'll test it
[2013-01-28 22:26:54 -0500] gondoi: I am doing this instead: `@openstack_identity_public_endpoint || @openstack_management_url`
[2013-01-28 22:27:21 -0500] gondoi: probably not the best way.. gonna talk to some more involved contributors
[2013-01-28 22:27:28 -0500] jubilo: Dev wants to tag a branch in github, ssh out to a remote server, make a directory based on the tag, check out into that directory, then symlink it.
[2013-01-28 22:27:30 -0500] gondoi: but that works for me ^
[2013-01-28 22:27:38 -0500] mattray: gondoi: ok, keep me in the loop if you need any knife-openstack changes
[2013-01-28 22:27:46 -0500] saywhat: #q
[2013-01-28 22:27:59 -0500] jubilo: I'm trying to figure out if the deploy resource is the best way, but I'm having trouble figuring out how to get the git tag passed in so Chef can work with it.
[2013-01-28 22:28:10 -0500] gondoi: mattray: okay, I actually do gonna get my code cleaned up and probably have a pull request there as well :D
[2013-01-28 22:29:12 -0500] cwj: jubilo: if you gist/pastebin your recipe its easier to provide input
[2013-01-28 22:29:27 -0500] cwj: jubilo: we put the revision we want to deploy into a data bag
[2013-01-28 22:29:42 -0500] cwj: and let the recipe retrieve the desired revision from there
[2013-01-28 22:30:17 -0500] jubilo: cwj: interesting. So it can grab the latest revision from the databag and not worry about trying to pass in that variable to chef.
[2013-01-28 22:30:41 -0500] ctracey: cheflevelramen: yvw.  was considering a blog post on how we did this.  if i get to it, i will try to get it to you.
[2013-01-28 22:30:58 -0500] jubilo: so maybe the developer can make the tag, commit the changes, and then run a little wrapper script that will drop the revision number into the databag?
[2013-01-28 22:31:04 -0500] cwj: jubilo: yep
[2013-01-28 22:31:06 -0500] jubilo: and chef can take it from there?
[2013-01-28 22:31:39 -0500] cwj: jubilo: we use a deploy tool called dreadnot, which stores the revision in the data bag and then uses knife to initiate chef run on the affected nodes
[2013-01-28 22:31:47 -0500] jubilo: cwj: that may work. thanks. any tips on getting the change replicated to the servers? perhaps using roles?
[2013-01-28 22:32:11 -0500] jubilo: cwj: as in, your role is a webserver, therefore you get these changes?
[2013-01-28 22:32:17 -0500] cwj: yeah thats waht we do
[2013-01-28 22:32:21 -0500] cwj: roles and environments
[2013-01-28 22:32:50 -0500] jubilo: cwj: that's fantastic, thanks.
[2013-01-28 22:33:36 -0500] cwj: jubilo: if you want to look at dreadnot https://github.com/racker/dreadnot
[2013-01-28 22:33:45 -0500] jubilo: cwj: I will, thanks
[2013-01-28 22:34:02 -0500] cwj: i wrote a command line wrapper script for the dreadnot api, but it is rather particular to our own dreadnot stacks
[2013-01-28 22:34:28 -0500] cwj: https://github.com/needle/jenknot if you want to check that out
[2013-01-28 22:34:30 -0500] jubilo: right
[2013-01-28 22:34:58 -0500] jubilo: cwj, nice
[2013-01-28 22:35:26 -0500] cwj: mostly wrote that for jenkins to be able to deploy tested revisions to our QA environment
[2013-01-28 22:35:37 -0500] cwj: but others on the team get a fair bit of use from it
[2013-01-28 22:37:23 -0500] jubilo: cwj, it does look handy.
[2013-01-28 22:41:52 -0500] mattupstate: curious if anyone has experience with the nginx cookbook...
[2013-01-28 22:42:08 -0500] mattupstate: at times i would try and manually restart nginx or reboot the machine
[2013-01-28 22:42:19 -0500] mattupstate: and nginx would not come back up
[2013-01-28 22:42:31 -0500] mattupstate: anyone have a clue?
[2013-01-28 22:44:38 -0500] cwj: mattupstate: are you using runit to manage nginx process? (e.g. nginx is built from source via cookbook)
[2013-01-28 22:45:08 -0500] r3vamp: if I set splay/interval => nil, will that disable chef-client from auto-running?
[2013-01-28 22:45:58 -0500] mattupstate: cwj: i believe its using runit
[2013-01-28 22:46:06 -0500] mattupstate: it was installed via source
[2013-01-28 22:46:30 -0500] r3vamp: or a better question: how do I disable chef-client from running periodically? I only want it to run when I manually do it
[2013-01-28 22:46:34 -0500] cwj: mattupstate: maybe runit itself isn't being started by your system at boot
[2013-01-28 22:47:07 -0500] mattupstate: cwj: ah, good point
[2013-01-28 22:47:35 -0500] mattupstate: suppose i could change the init_style
[2013-01-28 22:47:53 -0500] cwj: mattupstate: which platform are you on?
[2013-01-28 22:48:26 -0500] mattupstate: ubuntu
[2013-01-28 22:48:36 -0500] gondoi: mattray: https://github.com/fog/fog/pull/1523
[2013-01-28 22:50:13 -0500] mattray: gondoi: knife-openstack currently only has openstack_auth_url
[2013-01-28 22:50:39 -0500] gondoi: yeah, but once you auth, it will return your management endpoints public and private
[2013-01-28 22:50:55 -0500] gondoi: the bug I found is that we dont' have a public one, and that's all that's being passed to the connector
[2013-01-28 22:51:05 -0500] mattray: gotcha
[2013-01-28 22:51:20 -0500] gondoi: so the options in the knife-openstack are fine :D
[2013-01-28 22:51:24 -0500] cwj: mattupstate: from my experience it seems that the runit packages on ubuntu do configure runit to start at boot, but you may want to verify that manually
[2013-01-28 22:52:00 -0500] mattupstate: cwj: thanks for the tip
[2013-01-28 22:55:27 -0500] miah: ubuntu's runit package sets upstart to start runsvdir by default
[2013-01-28 23:03:50 -0500] jblaine: Someone remind me how to completely abort the whole chef run from a recipe?
[2013-01-28 23:04:14 -0500] maplebed: exit with an error?
[2013-01-28 23:04:22 -0500] jblaine: Sure
[2013-01-28 23:04:40 -0500] jblaine: I want chef-client to stop in its tracks and exit
[2013-01-28 23:05:06 -0500] jblaine: oh, just raise an exception, right? I think that is what someone said last time I asked
[2013-01-28 23:05:11 -0500] jblaine: I keep forgetting. Sound right?
[2013-01-28 23:05:27 -0500] maplebed: yup.
[2013-01-28 23:07:43 -0500] jblaine: Thanks. I promise to never ask this again.
[2013-01-28 23:07:49 -0500] maplebed: :P
[2013-01-28 23:08:11 -0500] maplebed: that's only allowed if you also blog about it so you can reference prior experience.
[2013-01-28 23:08:42 -0500] jtimberman: jblaine: ya
[2013-01-28 23:08:50 -0500] jtimberman: jblaine: raise "zombie apocalypse"
[2013-01-28 23:09:59 -0500] bluepojo: or if you want to be super cool, you make custom errors, for example: https://github.com/RiotGames/artifact-cookbook/blob/master/libraries/chef_artifact_errors.rb
[2013-01-28 23:12:03 -0500] kderr: Does a template resource *always* trigger notifies that you chain on top of it? How can I make it so that it only triggers its notifies when it actually writes out a file that's different than the one that was already there.
[2013-01-28 23:17:54 -0500] chip-: kderr: Notifications fire when the resource is updated. If there's no change to the resource (in this case, no template is rendered), then there should be no triggering of the notification.
[2013-01-28 23:18:28 -0500] kderr: chip-: I think my mode was bad. When the file got loaded, the owner of the file changed its permission. Then my chef run changed it back. So fourth and so on. argh.
[2013-01-28 23:19:13 -0500] chip-: kderr: That'd do it!
[2013-01-28 23:31:49 -0500] jubilo: is there a way to see what knife is looking at when I try to list a data bag?
[2013-01-28 23:31:57 -0500] jubilo: I mean, where it's looking, path-wise
[2013-01-28 23:31:58 -0500] jubilo: ?
[2013-01-28 23:32:16 -0500] cwj: jubilo: in terms of where its getting your knife config from?
[2013-01-28 23:32:27 -0500] jubilo: sure
[2013-01-28 23:32:48 -0500] jubilo: I'm creating data bags, but they're not showing up where I expect them to be and I can't find them.
[2013-01-28 23:33:01 -0500] jubilo: it's Chef Server and I'm using the server itself as a management workstation.
[2013-01-28 23:33:22 -0500] cwj: oh you are looking for files on disk after 'knife data bag create foo bar' ?
[2013-01-28 23:33:30 -0500] cwj: doesn't really work that way
[2013-01-28 23:33:54 -0500] jubilo: kind of
[2013-01-28 23:34:05 -0500] cwj: you can write json to disk and do 'knife data bag from file foo path/to/bar.json'
[2013-01-28 23:34:10 -0500] jubilo: ok
[2013-01-28 23:34:20 -0500] cwj: or knife data bag show foo bar -Fj > bar.json
[2013-01-28 23:34:22 -0500] jubilo: does it store data bags on disk as flat files, or...?
[2013-01-28 23:34:50 -0500] jubilo: I was under the impression there was a data_bags directory somewhere I could access.
[2013-01-28 23:35:00 -0500] cwj: with open source chef server i believe its inside couchdb
[2013-01-28 23:35:19 -0500] jubilo: ah
[2013-01-28 23:36:15 -0500] jubilo: Okay, that makes a lot more sense.
[2013-01-28 23:36:19 -0500] jubilo: thanks again, cwj
[2013-01-28 23:36:28 -0500] cwj: np
[2013-01-28 23:44:10 -0500] miah: its generally a bad practice to add/change attributes, roles, data bags, from the web interface
[2013-01-28 23:44:20 -0500] miah: because things will get out of sync with your source repository
[2013-01-28 23:44:36 -0500] miah: definitely go the file route
[2013-01-28 23:46:49 -0500] jubilo: hm, is it possible to reference an environment variable from within a data bag? like: git-tag: $TAG
[2013-01-28 23:47:11 -0500] miah: not really
[2013-01-28 23:47:24 -0500] jubilo: alas, that would have been kind of cool ;)
[2013-01-28 23:47:57 -0500] miah: you could certainly write some code in a chef recipe or provider that does "derp =  ENV['FOO']" though
[2013-01-28 23:48:48 -0500] jubilo: nod, thanks
[2013-01-28 23:49:19 -0500] jubilo: just trying to figure out the best way to munge some dynamically changing data into a data bag.
[2013-01-28 23:49:37 -0500] jubilo: dev wants to be able to tag a branch from github and make a bunch of things happen based on the tag.
[2013-01-28 23:51:04 -0500] Toger: Is there a way to configure knife ec2 to use a different bootstrap by default (in my case, a modified chef-full) ?
[2013-01-28 23:55:36 -0500] tomdzk: Toger: knife-ec2 supports a -d (--distro) command which seems to be passed to the bootstrap process as is, maybe that helps (in combination with http://wiki.opscode.com/display/chef/Custom+Knife+Bootstrap+Script)
[2013-01-28 23:55:45 -0500] tomdzk: Toger: -d argument, rather
[2013-01-28 23:56:38 -0500] Toger: yeah, that'll let me override it, I was hoping to configure the default so I don't have to revise a bunch of documentation.
[2013-01-28 23:59:08 -0500] tomdzk: Toger: it uses Chef::Config[:knife][:distro], e.g. you might be ablto to define in your knife.rb: distro = ...
[2013-01-28 23:59:33 -0500] Toger: tomdzk: aha, I'll check on that, thank you.
