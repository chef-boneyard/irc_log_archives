[2013-03-26 00:00:10 -0400] drgonzo65: I am having a problem with apt packages and upstart. When I install an apt package, say Nginx, it installs it into /etc/init.d, starts the process, and sets it to run at boot. I want to use upstart to run this process, so I need to do a service { action [:stop, :disable] } then setup the upstart config, but unless I then remove this block from the recipe, it will stoop the upstart service each time chef-client runs. Has anyone figured out how to properly do 
[2013-03-26 00:18:23 -0400] mh`: that's just because of how the package is setup
[2013-03-26 00:18:56 -0400] mh`: or are you asking how to avoid your service stop+disable running each tiem?
[2013-03-26 00:19:05 -0400] drgonzo65: the latter
[2013-03-26 00:19:22 -0400] log1kal_: I had to deal with this, and did it in the hackiest way I could find
[2013-03-26 00:19:27 -0400] log1kal_: sec, I'll grab a girst
[2013-03-26 00:19:30 -0400] log1kal_: er, girst.
[2013-03-26 00:19:32 -0400] drgonzo65: awesome, thanks
[2013-03-26 00:19:36 -0400] mh`: why not be more specific with your service block?
[2013-03-26 00:19:38 -0400] log1kal_: gist.
[2013-03-26 00:19:46 -0400] mh`: like specify init and upstart
[2013-03-26 00:19:56 -0400] mh`: http://docs.opscode.com/resource_service.html#providers
[2013-03-26 00:20:23 -0400] drgonzo65: i am doing that and it still stops the upstart service
[2013-03-26 00:20:37 -0400] mh`: paste?
[2013-03-26 00:20:42 -0400] drgonzo65: one sec
[2013-03-26 00:22:18 -0400] log1kal_: I had a slightly different issue, in that I needed to install a service without starting it: https://gist.github.com/logikal/5242115
[2013-03-26 00:22:27 -0400] mh`: lol
[2013-03-26 00:22:32 -0400] mh`: that is terrible :(
[2013-03-26 00:22:37 -0400] TripleDES: hi
[2013-03-26 00:22:43 -0400] log1kal_: I'm not proud of it.
[2013-03-26 00:22:46 -0400] log1kal_: but it works.
[2013-03-26 00:23:04 -0400] log1kal_: a flag for apt-get/dpkg would be better, but I couldn't find anything appropriate
[2013-03-26 00:23:28 -0400] drgonzo65: https://gist.github.com/DrGonzo65/bf2ede29bd52d6223111
[2013-03-26 00:23:42 -0400] jmickle: hi has anyone seen this error when trying to use knife : /var/lib/gems/1.8/gems/chef-11.4.0/lib/chef/knife/diff.rb:6: superclass mismatch for class Diff (TypeError)
[2013-03-26 00:24:14 -0400] benkay: i have pointed knife at a directory full of cookbooks
[2013-03-26 00:24:15 -0400] mh`: log1kal_: i don't think dpkg can know, really.. that stuff is usually run from the postinst
[2013-03-26 00:24:30 -0400] mh`: and it doesn't know what's setting up a skeleton vs what's launching a service
[2013-03-26 00:24:38 -0400] drgonzo65: every time I run chef client, it stops the upstart service, and then starts it up again
[2013-03-26 00:24:39 -0400] benkay: and when i ask it to `knife cookbook list`
[2013-03-26 00:24:41 -0400] benkay: it sez
[2013-03-26 00:24:44 -0400] benkay: empty list
[2013-03-26 00:25:06 -0400] benkay: so: how do I tell knife that that directory is full of cookbooks?
[2013-03-26 00:26:17 -0400] nlopez: drgonzo65: try this out https://gist.github.com/thalweg/8daf96ffd883cb70cd9c
[2013-03-26 00:26:25 -0400] mh`: drgonzo65: try setting pattern?
[2013-03-26 00:26:36 -0400] jmickle: anyone have an idea what that error is?
[2013-03-26 00:26:52 -0400] drgonzo65: nlopez: let me try.  thanks
[2013-03-26 00:27:16 -0400] log1kal_: mh`: then some way to tell a package to not start after install would be nice (I don't care how)
[2013-03-26 00:27:25 -0400] mh`: i agree
[2013-03-26 00:28:14 -0400] nlopez: log1kal_: this is another hack no one can be proud of, but a popular method.. http://askubuntu.com/questions/74061/install-packages-without-starting-background-processes-and-services
[2013-03-26 00:29:03 -0400] devx: has anyone had to bootstrap via su before?  I have inherited a couple of machines that don't use sudo, and I have to su to root..  any ideas?
[2013-03-26 00:29:04 -0400] tomdzk: there is also the policy-rc.d hack http://lifeonubuntu.com/how-to-prevent-server-daemons-from-starting-during-apt-get-install/
[2013-03-26 00:29:52 -0400] mh`: log1kal_: dpkg --no-triggers
[2013-03-26 00:30:31 -0400] cwj: devx: turn on remote root login for as long as required to bootstrap it?
[2013-03-26 00:30:33 -0400] log1kal_: nlopez: that's..... even dirtier
[2013-03-26 00:30:37 -0400] benkay: question: how do I tell knife about the local cookbook repository?
[2013-03-26 00:30:53 -0400] log1kal_: benkay: is you knife.rb configured correctly?
[2013-03-26 00:30:55 -0400] benkay: i have the cookbook dir in knife.rb, and it still returns an empty list on `knife cookbook list
[2013-03-26 00:31:10 -0400] tomdzk: benkay: cookbook_path in knife.rb http://docs.opscode.com/config_rb_knife.html
[2013-03-26 00:31:13 -0400] cwj: benkay: knife cookbook list is showing you whats on the server
[2013-03-26 00:31:15 -0400] drgonzo65: nlopez: no dice
[2013-03-26 00:31:17 -0400] drgonzo65: [2013-03-26T00:30:53+00:00] INFO: Processing service[pgbouncer] action stop (pgbouncer::default line 15)
[2013-03-26 00:31:17 -0400] drgonzo65: [2013-03-26T00:30:53+00:00] INFO: service[pgbouncer] stopped
[2013-03-26 00:31:18 -0400] |rt|: benkay: knife is querying the server
[2013-03-26 00:31:44 -0400] devx: cwj: I thought about it, I aslso looked in to possibly adding an option to knife to handle su but not really sure if net-ssh would support that
[2013-03-26 00:32:02 -0400] tomdzk: devx: how many machines ? maybe you could just setup sudo ?
[2013-03-26 00:32:05 -0400] benkay: ah excellent. thanks all. so if I have a bunch of cookbooks on my workstation, how do I point knife at them for uploading to the chef-server?
[2013-03-26 00:32:17 -0400] cwj: devx: my other suggestion is to step through the bootstrap script manually, so turning on remote root is easier at least
[2013-03-26 00:32:56 -0400] devx: yeah, but for 200+ machines not sure if it's the right approach
[2013-03-26 00:33:16 -0400] nlopez: drgonzo65: still stops the service per chef run? you probably need to remove the /etc/init.d/pgbouncer script between the first service and template block so that subsequent debian-init-style stop/disables can't do anything
[2013-03-26 00:33:36 -0400] drgonzo65: well, i don't want the template block to notify anything
[2013-03-26 00:33:45 -0400] drgonzo65: so i left that part out
[2013-03-26 00:34:04 -0400] cwj: devx: well then its at least a little misleading to say 'a couple of machines' :)
[2013-03-26 00:34:17 -0400] drgonzo65: and yes, it still stops then starts the service on each chef run
[2013-03-26 00:34:22 -0400] benkay: cwj, tomdzk, |rt|: do any of you have any pointers on taking cookbooks on my workstation and uploading them to my chef-server with knife?
[2013-03-26 00:34:29 -0400] drgonzo65: i'll try to remove the script and re-run
[2013-03-26 00:34:42 -0400] devx: cwj: lol, yeah i use the term loosely
[2013-03-26 00:34:58 -0400] cwj: benkay: assuming they arent already in the cookbook_path directory you specified in your knife.rb, you probably want to use something like berkshelf or librarian to help you wrangle your cookbooks
[2013-03-26 00:35:06 -0400] tomdzk: benkay: http://agiletesting.blogspot.com/2010/07/working-with-chef-cookbooks-and-roles.html
[2013-03-26 00:35:25 -0400] tomdzk: benkay: specificaly, knife cookbook upload
[2013-03-26 00:35:44 -0400] benkay: thanks cwj, tomdzk.
[2013-03-26 00:36:00 -0400] log1kal_: benkay: `knife cookbook upload -a` will upload all local cookbooks: http://docs.opscode.com/knife_cookbook.html#upload
[2013-03-26 00:36:02 -0400] |rt|: benkay: 'knife cookbook upload --all' will upload them all
[2013-03-26 00:36:11 -0400] devx: Thanks cwj,
[2013-03-26 00:36:53 -0400] benkay: awesome awesome awesome
[2013-03-26 00:37:07 -0400] benkay: thanks log1kal_, log1kal, |rt|
[2013-03-26 00:37:21 -0400] log1kal: weird.
[2013-03-26 00:37:27 -0400] benkay: hpns.
[2013-03-26 00:37:30 -0400] log1kal: yw, benkay!
[2013-03-26 00:51:58 -0400] cwj: have the 'vagrant' node attributes gone missing when running chef under vagrant 1.1.x?
[2013-03-26 00:52:04 -0400] cwj: i was using them :(
[2013-03-26 00:54:23 -0400] drakythe: So I've just installed chef on a brand new Debian VM, it all seemed to go smoothly however I cannot use the knife command, bash tells me "command not found" --- am I missing something? I thought knife just came with chef
[2013-03-26 00:56:45 -0400] log1kal: drakythe: did you use the omnibus installer?
[2013-03-26 00:56:56 -0400] log1kal: in any case, I'd make sure that knife was somewhere in your PATH correctly
[2013-03-26 00:58:14 -0400] drakythe: log1kal: No omnibus installer, I had trouble with that one previously, so I did it straight with the gem. I'm using rbenv, could that be borking my path and not allowing Knife to be registered?
[2013-03-26 01:00:52 -0400] drakythe: log1kal: hmmm... point of clarification for the newb here: Knife is not its own gem, correct? It should be included in the chef 11.4.0 gem?
[2013-03-26 01:02:09 -0400] spicy: yeah
[2013-03-26 01:02:17 -0400] spicy: it should be included
[2013-03-26 01:03:34 -0400] drakythe: spicy: thanks
[2013-03-26 01:04:10 -0400] drakythe: I'm really thinking rbenv might be the problem here. I was able to install knife-xenserver, and gem list prints out all the expected gems... hmmm...
[2013-03-26 01:04:26 -0400] spicy: drakythe: are you able to call chef-client?
[2013-03-26 01:04:46 -0400] drakythe: spicy: nope, command not found
[2013-03-26 01:04:52 -0400] spicy: yeah, path issues then
[2013-03-26 01:05:59 -0400] tomdzk: drakythe: 'which gem' ...
[2013-03-26 01:06:30 -0400] drakythe: .rbenv/shims/gem
[2013-03-26 01:06:34 -0400] drakythe: tomdzk: ^
[2013-03-26 01:07:50 -0400] tomdzk: and 'which ruby' ?
[2013-03-26 01:10:02 -0400] drakythe: tomdzk: .rbenv/shims/ruby. ruby -v returns ruby 1.9.3p327 (2012-11-10 revision 37606) [i686-linux]
[2013-03-26 01:10:43 -0400] tomdzk: drakythe: that looks alright; .rbenv/shims/gem list shows chef ?
[2013-03-26 01:11:24 -0400] drakythe: tomdzk: yup
[2013-03-26 01:11:43 -0400] drakythe: tomdzk: returns the same list as just "gem list"
[2013-03-26 01:12:40 -0400] tomdzk: drakythe: is there a 'knife' in .rbenv/shims ?
[2013-03-26 01:14:10 -0400] drakythe: tomdzk: like if I do an ls? all I get with this is "erb gem irb rake rdoc ri ruby testrb"
[2013-03-26 01:15:57 -0400] drakythe: ahhh!
[2013-03-26 01:15:57 -0400] tomdzk: drakythe: it might not have installed successfully, you could try reinstalling it (gem uninstall chef; gem install chef)
[2013-03-26 01:16:01 -0400] drakythe: tomdzk: that was it
[2013-03-26 01:16:41 -0400] drakythe: tomdzk: no shims, means it wasn't getting my commands, then I remember "rbenv rehash" rebuilds your list of commands
[2013-03-26 01:17:15 -0400] drakythe: So note: when using rbenv, there is an extra step after installing a gem that gives you new commands
[2013-03-26 01:53:34 -0400] dcrosta: TIL by accident that you can store custom classes in node attributes. however, it's not clear to me how they are serialized or stored on the chef server. is this a good idea? bad idea? is there a way to give my class some extra methods to serialize/deserialize gracefully?
[2013-03-26 01:59:16 -0400] bluekelp: dcrosta: http://stackoverflow.com/questions/410186/how-does-ruby-serialization-marshaling-work
[2013-03-26 01:59:39 -0400] bluekelp: you'll probably want to research json libs to keep things semi-normal
[2013-03-26 02:04:07 -0400] dcrosta: bluekelp you mean i should manually serialize it. i was wondering if Chef does something -- anything -- automatically when it attempts to save the node. looks from what i can see like it calls to_s on the object?
[2013-03-26 02:06:54 -0400] bluekelp: yeah you're probably stumbling on undefined territory.  you'd have to override to_s when but i'm not certain it'll work when pulling the attr back in
[2013-03-26 02:14:47 -0400] dcrosta: bluekelp yeah, that's what i figured. thanks though
[2013-03-26 02:56:18 -0400] sprack: how can I snarf output from command inside an execute in a recipe to find out why a compile failed?
[2013-03-26 03:04:05 -0400] bluekelp: sprack: redirect it to /tmp/foo - i've done that before
[2013-03-26 03:06:46 -0400] sprack: bluekelp: I was going to leave that as last resort. Does command not automatically take that into a var? How are you supposed to parse for errors?
[2013-03-26 03:07:30 -0400] bluekelp: not sure if/where it stores logs.  i wasn't able to find them quickly so i redirected until i got it working
[2013-03-26 03:07:56 -0400] bluekelp: logged output from exec resources*
[2013-03-26 03:19:48 -0400] sprack: have tried using shef?
[2013-03-26 03:21:33 -0400] bluekelp: i did but i wasn't on a node and so couldn't fully test.  like i said, i was impatient so redirected, figured it out and then removed the redirection
[2013-03-26 03:36:27 -0400] bluekelp: i'm getting a SyntaxError on client node when trying to use opscode AWS cookbook - complains about |val=nil| in a block - is this a ruby 1.9.x or 2.x ism?
[2013-03-26 03:37:30 -0400] bluekelp: error is in the metachef cookbook
[2013-03-26 03:44:06 -0400] eliklein: hmm, anyone aware of an ohai plugin that allows you to get at a list of currently attached ebs volumes?
[2013-03-26 03:44:19 -0400] eliklein: or just a mapping from device or mountpoint to volume id
[2013-03-26 03:48:42 -0400] sprack: would it be 'correct' to wrap it in a ruby_block to snarf the output?
[2013-03-26 04:37:15 -0400] sprack: does remote_file only handle http paths? it appears to be messing up ftp paths
[2013-03-26 08:21:38 -0400] chef772: any idea about  ....knife command not working without provied  -p password opction .....gives error net authentication fails
[2013-03-26 08:22:05 -0400] Sgoettschkes: it's -P
[2013-03-26 08:22:11 -0400] Sgoettschkes: the small p is the port
[2013-03-26 08:24:55 -0400] chef772: yes
[2013-03-26 08:25:12 -0400] chef772: but how to solve this
[2013-03-26 08:25:20 -0400] chef772: any idea
[2013-03-26 08:25:22 -0400] Sgoettschkes: chef772: Sorry, I misread your question
[2013-03-26 08:25:49 -0400] Sgoettschkes: chef772: Which knife command are you trying to execute?
[2013-03-26 08:26:35 -0400] chef772:  knife ssh name:nodename  "sudo chef-client"
[2013-03-26 08:27:24 -0400] chef772: it gives error  Net::SSH::AuthenticationFailed:
[2013-03-26 08:28:05 -0400] chef772: when i provide opction -P password it working fine
[2013-03-26 08:40:29 -0400] Sgoettschkes: chef772: And on your node there is rsa authentification enabled?
[2013-03-26 08:42:45 -0400] chef772: no
[2013-03-26 08:44:40 -0400] Sgoettschkes: well, than that's the answer. knife ssh only does a normal ssh connection like you would manually - If you want to use your public/private key for authentication, than you need to provision your node to support this
[2013-03-26 08:48:25 -0400] chef772: i m traing to do that ...but dont know how to do that ....any doc releated that ..?
[2013-03-26 08:50:12 -0400] Sgoettschkes: A very basic one: http://plusbryan.com/my-first-5-minutes-on-a-server-or-essential-security-for-linux-servers
[2013-03-26 08:50:47 -0400] Sgoettschkes: actually, the only thing you need to do is put a public key inside the ~/.ssh/authorized_keys file
[2013-03-26 08:50:58 -0400] Sgoettschkes: and then use the private key to ssh
[2013-03-26 08:51:13 -0400] Sgoettschkes: at least on debian/ubuntu
[2013-03-26 08:51:46 -0400] chef772: Sgoettschkes :thanks man
[2013-03-26 08:53:59 -0400] Sgoettschkes: chef772: No problem. Just keep in mind that the article is really only the basic stuff. If your server is accessable from the internet or have sensitive information, you should really dive a little deeper into security ;)
[2013-03-26 08:54:48 -0400] chef772: ok thanks again
[2013-03-26 09:53:21 -0400] nforgerit: Hey fellows! I got an issue using chef-solo via Vagrant. It involves the mysql::server recipe. I assume this to be some stupid mistake but i need an educated guess. Here's my config: Vagrantfile (http://pastebin.com/rNDjzVDY), Vagrant Shell Output (http://pastebin.com/Wc4SXaia), Exec. Role (http://pastebin.com/PwPHstrj)
[2013-03-26 09:53:59 -0400] nforgerit: box is debian squeeze
[2013-03-26 09:55:45 -0400] Sgoettschkes: nforgerit: Which mysql cookbook are you using?
[2013-03-26 09:56:29 -0400] nforgerit: Sgoettschkes: official opscode github-repo
[2013-03-26 09:59:21 -0400] Sgoettschkes: nforgerit: I remember that problem, but I don't remember the solution
[2013-03-26 09:59:33 -0400] nforgerit: :)
[2013-03-26 10:00:24 -0400] nforgerit: Sgoettschkes: another hint may be, that `vagrant reload` seems to execute w/o any error
[2013-03-26 10:00:45 -0400] nforgerit: but loading the box for the first time always results in this error
[2013-03-26 10:02:17 -0400] Sgoettschkes: funny
[2013-03-26 10:02:38 -0400] nforgerit: i already tried several un-/official boxes
[2013-03-26 10:03:47 -0400] nforgerit: could not find anything within bug lists of vagrant nor opscode-cookbooks
[2013-03-26 10:09:31 -0400] Sgoettschkes: nforgerit: Did you check http://community.opscode.com/cookbooks/mysql/comments
[2013-03-26 10:09:42 -0400] Sgoettschkes: "vintem" seems to have the same problem
[2013-03-26 10:09:52 -0400] Sgoettschkes: And "jeremyq" posted a solution
[2013-03-26 10:13:20 -0400] nforgerit: i guess i've already tried this one. but i'll try again
[2013-03-26 10:21:47 -0400] nforgerit: still no success w/ override_attributes
[2013-03-26 10:38:42 -0400] threesome: When I do 'knife node list' I see an entry which doesn't appear in 'knife client list', what does that mean? I thought the 2 commands should always list the same, except client list would also have the organization
[2013-03-26 10:39:13 -0400] vegardx_: You can have more nodes on one client.
[2013-03-26 10:42:07 -0400] threesome: vegardx_, a node is a machine you want to configure, right? Then what is a client?
[2013-03-26 10:49:32 -0400] vegardx_: threesome: A client is what the node connects to chef with
[2013-03-26 10:51:57 -0400] threesome: vegardx_, I see, so when I do 'knife client list' I see 'myorg-validator' and a few other entries that correspond to the output of 'knife node list'. So I could have 'myorg-validator' as my only client but 10 nodes which all use it?
[2013-03-26 10:55:37 -0400] vegardx_: threesome: I guess, but you don't want to
[2013-03-26 10:57:15 -0400] threesome: vegardx_, why not? (I'm beginner, sorry)
[2013-03-26 11:49:17 -0400] zts: unless it's changed recently, chef-client makes assumptions about the node name and client name being the same
[2013-03-26 11:49:42 -0400] zts: but that does come up for discussion now and then, there's no conceptual reason why it wouldn't be permitted
[2013-03-26 11:50:54 -0400] zts: threesome: you might not want both nodes to have access to the same information - in Hosted/Private chef, you could have different ACLs for different clients
[2013-03-26 11:51:23 -0400] zts: threesome: with the open-source server, you might want one node to be an 'admin' (able to update data-bags, etc), while other nodes shouldn't be allowed to do that
[2013-03-26 11:54:41 -0400] threesome: zts, in open-source server the extra permissions for the admin node would be specified where?
[2013-03-26 11:56:17 -0400] zts: threesome: I believe there's a tick box in the webui, or there's an "admin" variable you can set to true if you do "knife client edit"
[2013-03-26 11:57:00 -0400] zts: threesome: but in open-source server, you're either granting permissions to everything (admin: true), or you're not.  You can't restrict it any more than that
[2013-03-26 11:57:37 -0400] threesome: zts, there's a web ui with open source server you install on your own server? I thought that was just for hosted/private chef
[2013-03-26 11:59:18 -0400] zts: threesome: yes, there's a webui with open source server - it's disabled by default in chef 11, but you can enable it
[2013-03-26 11:59:24 -0400] zts: (it's already there, nothing extra to install)
[2013-03-26 12:00:15 -0400] pikesley: It's not disabled by default
[2013-03-26 12:00:27 -0400] pikesley: at least, it worked out-the-box for me
[2013-03-26 12:02:41 -0400] zts: it was disabled by default in 11.4, I believe it was enabled by default earlier than that, not sure about 11.6
[2013-03-26 12:03:09 -0400] pikesley: shiny :)
[2013-03-26 12:03:26 -0400] zts: cool :)
[2013-03-26 12:04:24 -0400] threesome: zts, thanks
[2013-03-26 12:05:06 -0400] zts: you're welcome
[2013-03-26 12:05:53 -0400] threesome: Why might the packages on my node not be getting updated with 'recipe[apt]'? I just created a new Vagrant instance, did a knife bootstrap specifying the runlist, but it doesn't actually update. When I do a 'vagrant ssh' and 'sudo apt-get dist-upgrade', it still shows many packages as needing updates
[2013-03-26 12:08:50 -0400] threesome: Shouldn't there be a -y flag to the 'apt-get update' recipe in https://github.com/opscode-cookbooks/apt/blob/master/recipes/default.rb
[2013-03-26 12:15:43 -0400] matti: threesome: No?
[2013-03-26 12:15:56 -0400] matti: threesome: I think you are misunderstanding what update does.
[2013-03-26 12:16:41 -0400] threesome: matti, ah you're right. Is there a pre-built recipe for doing upgrades (not updates)?
[2013-03-26 12:16:51 -0400] matti: I have not seen one.
[2013-03-26 12:17:01 -0400] matti: But, it is rather unsafe to do it automatically.
[2013-03-26 12:17:11 -0400] matti: It will backfire on you hard one day.
[2013-03-26 12:17:35 -0400] matti: Especially on Debian, where a lot of pre/post scripts shipped in packages tends to restart services.
[2013-03-26 12:17:49 -0400] threesome: matti, I agree that it shouldn't be done once a system is already running. But how about when getting a system started the first time?
[2013-03-26 12:17:56 -0400] matti: If you need to do this, then it is better to have simple execute in a bootstrap cookbook.
[2013-03-26 12:18:30 -0400] matti: threesome: If you have bootstrap cookbook then put it in there ;]
[2013-03-26 12:18:51 -0400] matti: threesome: You could also, if you really want.
[2013-03-26 12:19:49 -0400] matti: threesome: Add ruby_block to your existing code, so it will execute dist-upgrade (or whatnot) and then drop a tag-file somewhere e.g. /var/lib/apt/dist-upgrade-stamp (or something).
[2013-03-26 12:19:58 -0400] matti: threesome: So next time when the file exists it won't do it.
[2013-03-26 12:20:12 -0400] matti: threesome: Similar-ish to what apt cookbok does to update.
[2013-03-26 12:20:38 -0400] threesome: matti, for Ubuntu where after a release comes out, the only updates are security updates, isn't it best practice to keep the system packages upgraded? (Because they'll mostly be security updates or bugs the Ubuntu team has decided are worthy enough for inclusion)
[2013-03-26 12:21:11 -0400] matti: threesome: Do you have like a week worth of Ops experience?
[2013-03-26 12:21:17 -0400] matti: threesome: Or what?
[2013-03-26 12:21:31 -0400] matti: threesome: Do as you want / whatever works for you :)
[2013-03-26 12:21:59 -0400] threesome: matti, I'm trying to learn best practices :)
[2013-03-26 12:22:16 -0400] matti: threesome: Automatic updates from upstream are not the best practice ;p
[2013-03-26 12:22:56 -0400] threesome: matti, how should updates be managed?
[2013-03-26 12:23:28 -0400] threesome: Or what is one example of how it could be managed well?
[2013-03-26 12:23:57 -0400] fghm: chef client leaks memory (when running as daemon), any official solution for that?
[2013-03-26 12:24:25 -0400] matti: fghm: Leaks?
[2013-03-26 12:24:36 -0400] matti: fghm: You means, grows a lot.
[2013-03-26 12:24:39 -0400] matti: mean*
[2013-03-26 12:26:31 -0400] matti: threesome: There is probably more then one approach. I usually mirror packages I want for multiple reasons. And then use my own Apt server and cache. When update is needed I start with one machine to have it in a controlled manner. Once that is proven to be safe, then I kick off rolling update everywhere.
[2013-03-26 12:28:43 -0400] matti: threesome: For instance, I would really not like my Cassandra or ZooKeeper nodes go into a flaky state due to an upgrade kick off on ALL the nodes IN THE SAME time by Chef.
[2013-03-26 12:29:02 -0400] threesome: matti, interesting approach. By any chance would that be what the cacher-client and cacher-ng recipes in apt cookbook allow you to do?
[2013-03-26 12:29:06 -0400] matti: threesome: Not to mention what if it will break something? It will fuck up all of them.
[2013-03-26 12:30:13 -0400] matti: threesome: I have no idea what cacher-client and cacher-ng allows you to do.
[2013-03-26 12:32:22 -0400] threesome: matti, once you decide on your local apt cache that it has proven safe, how do you manage the rolling update itself? Am I correct in thinking Chef won't notify the services it manages to restart automatically because you're doing it outside of Chef? (like running 'apt-get upgrade' on the command line, or even as an 'execute' resource in a recipe)
[2013-03-26 12:33:41 -0400] matti: threesome: I have instrumentation in place.
[2013-03-26 12:33:49 -0400] matti: threesome: Like MCollective and Nanite.
[2013-03-26 12:37:23 -0400] threesome: matti, thanks
[2013-03-26 12:38:38 -0400] fghm: matti, yes, grows a lot
[2013-03-26 12:40:25 -0400] matti: fghm: The solution would be to have something else kicking off chef-client.
[2013-03-26 12:40:40 -0400] matti: fghm: This is the same problem that Puppet has when running as daemon.
[2013-03-26 12:40:57 -0400] Mez: So, I'm wanting to setup a basic chef-server - but using v11. Is there a nice howto anywhere ?
[2013-03-26 12:41:03 -0400] Mez: also, hey matti
[2013-03-26 12:41:12 -0400] matti: fghm: Alternatively, you'd have to complain to OpsCode and make them logic so it fork()s for doing its job.
[2013-03-26 12:41:17 -0400] zts: fghm: you could try out the fork (-f) option for chef-client
[2013-03-26 12:41:20 -0400] matti: Hey Mez
[2013-03-26 12:41:21 -0400] zts: matti: ^^
[2013-03-26 12:41:42 -0400] matti: zts: +1
[2013-03-26 12:41:51 -0400] matti: zts: Didn't knew about it :)
[2013-03-26 12:41:58 -0400] zts: I haven't used it, so YMMV :)
[2013-03-26 12:42:07 -0400] zts: but I understand it was created for exactly that reason
[2013-03-26 12:42:27 -0400] matti: Mez: There are two blog posts by jtimberman
[2013-03-26 12:42:39 -0400] matti: Mez: Using the Omnibus package it is straight-forward.
[2013-03-26 12:43:01 -0400] matti: Mez: Getting it to be highly-available it a little it of a challenge with Omnibus.
[2013-03-26 12:43:14 -0400] fghm: are you sure that fork option helps?
[2013-03-26 12:43:24 -0400] matti: fghm: Ruby VM is greedy ;]
[2013-03-26 12:43:53 -0400] Mez: matti: I'm happy for HA to not be there atm - I can boot a new one as needed.
[2013-03-26 12:43:55 -0400] fghm: basically, when chef-client does its daily restart, then it will run obsolete chef-client process
[2013-03-26 12:43:59 -0400] matti: fghm: It will grow... as Ruby re-uses / re-cycles memory within its heap for new objects.
[2013-03-26 12:44:11 -0400] Mez: (trying to use the .deb - slightly annoyed that there's not an apt.opscode.com repo for it!)
[2013-03-26 12:44:20 -0400] matti: fghm: But it is rather bad at releasing it back to the OS.
[2013-03-26 12:44:40 -0400] zts: fghm: what do you mean, "does its daily restart" ?
[2013-03-26 12:44:42 -0400] matti: fghm: With fork you will have another process, with another virtual address space etc.
[2013-03-26 12:44:52 -0400] matti: fghm: Hence it will release memory back when it finishes.
[2013-03-26 12:45:11 -0400] matti: Mez: True, true.
[2013-03-26 12:45:19 -0400] matti: Mez: Only HTTP download thing.
[2013-03-26 12:45:43 -0400] matti: Mez: Make sure that for knife you use https:// without any extra ports for 11.
[2013-03-26 12:46:07 -0400] matti: fghm: Daily restarts?
[2013-03-26 12:46:25 -0400] fghm: chef-client logrotate has daily restart included
[2013-03-26 12:46:31 -0400] fghm: logrotate conf *
[2013-03-26 12:46:56 -0400] Mez: matti: I think I need to work out what ports to open up forst :)
[2013-03-26 12:46:57 -0400] fghm: should I remove it from cron?
[2013-03-26 12:47:18 -0400] matti: Mez: With Omnibus it talks over lo to itself.
[2013-03-26 12:47:30 -0400] zts: fghm: is this a separate problem to chef-client growing in size?
[2013-03-26 12:47:40 -0400] matti: Mez: And IIRC 11 only should have 80 / 443 open (well, plus 22).
[2013-03-26 12:47:57 -0400] Mez: well, trying to get to 80 gives me nothing :)
[2013-03-26 12:48:16 -0400] matti: Mez: Oh, there is a gotcha.
[2013-03-26 12:48:26 -0400] matti: Mez: Make sure that your hosts resolves correctly.
[2013-03-26 12:48:49 -0400] matti: Mez: Cookbook that Omnibus uses to configures itself sets FQDNs everywhere.
[2013-03-26 12:48:53 -0400] Mez: matti: Currently trying to run it on EC2
[2013-03-26 12:49:06 -0400] fghm: when I run chef-client with --fork daemon and restart it  ...it won't kill the last --fork process
[2013-03-26 12:49:25 -0400] matti: Mez: netstat -ntlp ... probably sits on a internal IP.
[2013-03-26 12:49:53 -0400] matti: Mez: BTW, don't like Puppet any more? ;d
[2013-03-26 12:50:06 -0400] matti: [ /me just curious ]
[2013-03-26 12:50:26 -0400] Mez: matti: Er... I never really got into puppet.  Just glanced at it a bit.
[2013-03-26 12:50:40 -0400] Mez: tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -
[2013-03-26 12:50:46 -0400] Mez: seems to be listening on 80
[2013-03-26 12:50:52 -0400] zts: fghm: perhaps that's a bug... I would certainly expect that if you kill the parent process, it would kill the forked client too.  (But I haven't used the --fork feature)
[2013-03-26 12:51:05 -0400] Mez: ah, it's redirected it to the aws internal
[2013-03-26 12:51:10 -0400] Mez: https://ip-10-48-78-84.eu-west-1.compute.internal/
[2013-03-26 12:51:26 -0400] matti: Mez: Yeah, the calamity with it configuring itself.
[2013-03-26 12:51:48 -0400] Mez: matti: /etc/hosts to the rescue
[2013-03-26 12:51:49 -0400] matti: Mez: You can override some of the settings and put IP / domain name there.
[2013-03-26 12:52:00 -0400] matti: Mez: Well ;p
[2013-03-26 12:52:04 -0400] matti: Mez: That works too ;p
[2013-03-26 12:52:14 -0400] matti: He he
[2013-03-26 12:53:46 -0400] Mez: matti: well - that worked enough for nginx to give me a bad gateway
[2013-03-26 12:57:41 -0400] matti: Mez: I am trying to find a page which describes how to re-configure Chef 11.
[2013-03-26 12:58:15 -0400] Mez: matti: well the webserver's not even working :(
[2013-03-26 12:58:28 -0400] matti: ;/
[2013-03-26 12:58:46 -0400] matti: Mez: You did do the reconfigure?
[2013-03-26 12:58:58 -0400] Mez: yep - otherwise it wouldn't have ran at all.
[2013-03-26 12:59:09 -0400] Mez: Looking at the logs, possibly an OOM?
[2013-03-26 12:59:25 -0400] matti: Oh.
[2013-03-26 12:59:29 -0400] matti: Mez: http://docs.opscode.com/config_rb_chef_server.html
[2013-03-26 12:59:30 -0400] Mez: (micro instance)
[2013-03-26 13:00:16 -0400] Mez: yeah. looks like the oom-killer is killing off the webui.
[2013-03-26 13:01:10 -0400] matti: It is the small instance?
[2013-03-26 13:01:31 -0400] matti: Omnibus might be setting unreasonable things for Solr etc.
[2013-03-26 13:01:51 -0400] matti: node.default['chef_server']['chef-solr']['java_opts'] = " -Djava.net.preferIPv4Stack=true -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:+UseFastAccessorMethods -XX:+OptimizeStringConcat -XX:+DisableExplicitGC -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=1 -XX:MaxGCPauseMillis=2000 -XX:GCTimeRatio=10 -XX:ParallelGCThreads=8 -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:+CMSParallelRemarkEnabled -XX:+CMSClassUnloadingEnabled -XX:+
[2013-03-26 13:02:08 -0400] matti: I also have -Xmx et al somewhere.
[2013-03-26 13:02:08 -0400] matti: ;]
[2013-03-26 13:02:33 -0400] Mez: lol - no - it was the micro instance.
[2013-03-26 13:02:51 -0400] Mez: 495/500Mb Memory used while idele.
[2013-03-26 13:02:54 -0400] Mez: idle *
[2013-03-26 13:03:02 -0400] matti: LOL
[2013-03-26 13:03:27 -0400] Mez: now lets try it with 1.7 GB
[2013-03-26 13:03:51 -0400] matti: I have a KVM VM with it and it has 4 GB allocated to it, from which 60% is in use.
[2013-03-26 13:04:22 -0400] Mez: ok, I'll give it 3.7 then.
[2013-03-26 13:04:28 -0400] Mez: Surprised it's such a memory hog.
[2013-03-26 13:08:16 -0400] Mez: I'd also prefer it if chef-server used the system packages rather than it's own in-built ones :(
[2013-03-26 13:08:24 -0400] Mez: (nginx for example).
[2013-03-26 13:08:32 -0400] Mez: Really goes against the debian philosophy
[2013-03-26 13:10:56 -0400] matti: Mez: OpsCode system packages are horrible.
[2013-03-26 13:11:09 -0400] matti: Mez: Omnibus sucks a bit less, but makes everything else harder.
[2013-03-26 13:11:29 -0400] matti: Mez: None of the software companies get it right, shame.
[2013-03-26 13:11:39 -0400] erthad: hiall
[2013-03-26 13:12:12 -0400] Mez: matti: If I knew enough about how to setup the server side of things - I'd create a decent package for chef-server
[2013-03-26 13:12:49 -0400] matti: Mez: You'd have to start with decent Ruby 1.9.3 packages for Debian.
[2013-03-26 13:13:17 -0400] pikesley: for Chef 10: https://github.com/pikesley/catering-college
[2013-03-26 13:13:20 -0400] Mez: ok, now to work out what the default username/password is :)
[2013-03-26 13:13:48 -0400] matti: Mez: If you haven't changed it, then its on the UI.
[2013-03-26 13:14:08 -0400] Mez: matti: good point :)
[2013-03-26 13:14:53 -0400] matti: ;p
[2013-03-26 13:15:09 -0400] matti: pikesley: Add chruby or rbenv ;p
[2013-03-26 13:15:17 -0400] matti: pikesley: rvm is so 2010 ;p
[2013-03-26 13:15:23 -0400] matti: pikesley: :)
[2013-03-26 13:15:31 -0400] Mez: rvm was the only way I could get veewee working
[2013-03-26 13:16:23 -0400] matti: Mez: I use rbenv at the moment. No problem with it.
[2013-03-26 13:16:32 -0400] Mez: oh, ffs.
[2013-03-26 13:16:39 -0400] matti: At least it does not try to bork my entire shell like rvm.
[2013-03-26 13:16:40 -0400] Mez: The chef client package is broken
[2013-03-26 13:16:40 -0400] matti: Mez: ?
[2013-03-26 13:16:50 -0400] matti: Mez: gem install ...
[2013-03-26 13:17:00 -0400] matti: Mez: Forget about packages form OpsCode, they suck.
[2013-03-26 13:17:31 -0400] matti: Mez: If you need package, get custom control and FPM gem chef gem file.
[2013-03-26 13:17:39 -0400] Mez: matti: might have to go back to 0.10 then ... where the packages actually work.
[2013-03-26 13:23:59 -0400] Mez: knife cookbook upload -a
[2013-03-26 13:24:05 -0400] Mez: gah :(
[2013-03-26 13:28:12 -0400] threesome: When using chef-client rather than chef-solo, is there a way to have a quicker turnaround when doing cookbook development and wanting to see changes on your managed Vagrant node? Right now if I make a small change to the cookbook I have to do 'knife cookbook upload cookbookname' then 'ssh vagrant@localhost -p 2222 sudo chef-client'
[2013-03-26 13:32:22 -0400] tolland_: threesome: i use an inotify script to auto-push the upload based on the change, which saves the 2-step
[2013-03-26 13:33:05 -0400] tolland_: incron would work just as well I think
[2013-03-26 13:35:29 -0400] threesome: tolland_, is there some kind of way to maybe specify to a particular node not to look to the Chef server but rather look locally for cookbooks?
[2013-03-26 13:37:54 -0400] tolland_: chef-solo?
[2013-03-26 13:39:36 -0400] threesome: tolland_, can the 2 work together somehow? I'm still using chef-client for non-development nodes
[2013-03-26 13:41:17 -0400] tolland_: because I am developing for chef-client, I find wrapping the 2 commands in incron.d works well
[2013-03-26 13:41:27 -0400] tolland_: chef-solo is broken for searches
[2013-03-26 13:41:29 -0400] tolland_: ;-)
[2013-03-26 13:42:29 -0400] tolland_: echo "$HOME/chef-repo/cookbooks/XXX-cookbook IN_CLOSE_WRITE  knife upload XXX-cookbook" > /etc/incron.d/XXX-watcher
[2013-03-26 13:42:33 -0400] tolland_: or something similar to that
[2013-03-26 13:42:54 -0400] tolland_: echo "$HOME/chef-repo/cookbooks/XXX-cookbook IN_CLOSE_WRITE  knife upload XXX-cookbook && ssh someserver sudo chef-client" > /etc/incron.d/XXX-watcher
[2013-03-26 13:42:57 -0400] tolland_: maybe
[2013-03-26 13:45:11 -0400] eherot: So which one is the "latest stable" chef?  11.4.0?  10.24.0?  10.18.2?
[2013-03-26 13:46:14 -0400] threesome: tolland_, thanks I will try this
[2013-03-26 13:53:18 -0400] marlonb: Hello everyone.
[2013-03-26 13:53:44 -0400] marlonb: I am getting this error when trying to upload a cookbook to my chef server.  ERROR: Server returned error for https://[OUR_CHEF_DOMAIN]/sandboxes/000000000000919d6f494d376caf1cc8, retrying 5/5 in 54s
[2013-03-26 13:53:45 -0400] marlonb: ERROR: internal server error
[2013-03-26 13:54:01 -0400] geekbri: eherot: the latest 11 series and the latest 10 series should be the stables.  So 11.4 and 10.24
[2013-03-26 13:54:22 -0400] marlonb: Where can I go on the chef server to find the log for this error?  I honestly can't seem to find the log for it
[2013-03-26 13:54:58 -0400] eherot: geekbri: is there a web site where the current "stable release" is kept up to date?  The release notes page only goes up to 10.18.0
[2013-03-26 13:55:21 -0400] marlonb: eherot: http://www.opscode.com/chef/install/ ?
[2013-03-26 13:56:00 -0400] eherot: marlonb: left to its own devices, that will always install 1
[2013-03-26 13:56:02 -0400] eherot: *11
[2013-03-26 13:56:05 -0400] geekbri: eherot: Well the current stable release is generally whatever the newest release is.  This just happens to be a transition period with breaking changes
[2013-03-26 13:56:49 -0400] marlonb: eherot:  There is a chef version dropdown at the bottom of the page, does it ignore it..?  That would suck if it did. = /
[2013-03-26 13:57:49 -0400] eherot: marlonb: If you pull that down it gives you the deb package for manual install
[2013-03-26 13:58:10 -0400] eherot: marlonb: but also it lets you pick allllll kinds of versions, going back to 10.12
[2013-03-26 13:58:51 -0400] eherot: marlonb: weird that they should do it that way since you can actually pass a version argument to the install.sh script
[2013-03-26 13:59:19 -0400] eherot: also: http://wiki.opscode.com/display/chef/Installation ("The current release of Chef is 10.18.0")
[2013-03-26 13:59:36 -0400] marlonb: eherot:  yeah...  You wouldn't have any info on my problem though would you?  I'm running Chef 11
[2013-03-26 13:59:38 -0400] marlonb: =/
[2013-03-26 14:00:12 -0400] geekbri: beware the wiki, its been known to have outdated information
[2013-03-26 14:00:18 -0400] geekbri: just like every other wiki thats ever existed :)
[2013-03-26 14:00:26 -0400] eherot: marlonb: I might, as I did try to install the 11 client once (and held back because of the lack this feature: https://github.com/opscode/chef/pull/670)
[2013-03-26 14:00:57 -0400] eherot: geekbri: That seems like a pretty important page not to update!
[2013-03-26 14:01:05 -0400] geekbri: eherot: docs.opscode.com
[2013-03-26 14:01:17 -0400] geekbri: eherot: another thing in transition :)
[2013-03-26 14:01:56 -0400] eherot: geekbri: that open source feel ;-)
[2013-03-26 14:02:16 -0400] geekbri: Don't be silly, they actually make progress during their transitions :-P
[2013-03-26 14:02:34 -0400] eherot: marlonb: the actual error for that would most likely be in the chef server log /var/log/chef/server.log (on the server of course)
[2013-03-26 14:02:50 -0400] eherot: assuming you're using the open source server and not hosted chef
[2013-03-26 14:02:56 -0400] marlonb: yeah open source
[2013-03-26 14:04:32 -0400] eherot: knife cookbook upload -VV COOKBOOK
[2013-03-26 14:05:09 -0400] eherot: probably it's just going to say "Internal server error" but it *might* say more.
[2013-03-26 14:05:15 -0400] marlonb: yeah I'll try
[2013-03-26 14:05:17 -0400] marlonb: the new Chef 11
[2013-03-26 14:05:26 -0400] marlonb: doesn't just have server.log
[2013-03-26 14:05:33 -0400] marlonb: it's nine different directories
[2013-03-26 14:05:58 -0400] marlonb: bookshelf, chef-expander, chef-server-webui, chef-pedant, chef-solr, nginx, erchef, postgresql and rabbitmq
[2013-03-26 14:06:10 -0400] blitzrage: morning all
[2013-03-26 14:06:43 -0400] blitzrage: I set a couple of values in a ruby_block, but I want to be able to access those values outside of the ruby_block. How should I approach that? Can I do a node.set inside the ruby_block?
[2013-03-26 14:11:21 -0400] blitzrage: nevermind, I can just do node.set as found in testing :)
[2013-03-26 14:22:16 -0400] threesome: How can I update system ruby on my Ubuntu nodes from 1.8 to 1.9.3? If I do 'sudo apt-get install ruby1.9.3' it actually points to 1.8.7
[2013-03-26 14:23:36 -0400] drrk: read the documentation
[2013-03-26 14:23:46 -0400] drrk: the ruby evrsion numbering is weird
[2013-03-26 14:24:59 -0400] pikesley: you need rvm or something
[2013-03-26 14:25:08 -0400] drrk: 1.9.3 referes to the API version, as apposed to the program version
[2013-03-26 14:25:32 -0400] pikesley: you cannot get 1.9.3 as system ruby
[2013-03-26 14:27:17 -0400] drrk: http://packages.debian.org/wheezy/ruby1.9.3 explains
[2013-03-26 14:27:57 -0400] drrk: not sure about getting 1.8.7 though
[2013-03-26 14:28:21 -0400] drrk: mine is definatly 1.9
[2013-03-26 14:29:17 -0400] pikesley: 1.9.1 possibly
[2013-03-26 14:31:29 -0400] threesome: I see, so the latest I'll see for system ruby when doing 'ruby --version' would be 1.9.1 on Ubuntu?
[2013-03-26 14:33:08 -0400] zts: threesome: what's the problem with doing 'ruby1.9.3 --version' instead?
[2013-03-26 14:34:33 -0400] zts: I'm given to understand you can use update-alternatives to change what plain old "ruby" points to, but that's probably an awful idea.  Good seldom comes of changing a distro's interpreters underneath it
[2013-03-26 14:34:45 -0400] pikesley: just rvm
[2013-03-26 14:34:51 -0400] pikesley: rvm solves everything
[2013-03-26 14:35:00 -0400] marlonb: finally found the log for tossing the error
[2013-03-26 14:35:06 -0400] marlonb: it's erchef.. = /
[2013-03-26 14:35:43 -0400] threesome: zts, I didn't know doing ruby1.9.3 command was possible. But if scripts are expecting to call ruby and not ruby1.9.3 they'd still get the old version
[2013-03-26 14:36:23 -0400] threesome: I heard RVM doesn't play nicely with Chef omnibus, where it resets environment variables and confuses Chef not to use its bundled Ruby or something like that
[2013-03-26 14:37:03 -0400] pikesley: I suspect the Omnibus Chef is best left alone in its black box
[2013-03-26 14:37:12 -0400] zts: threesome: indeed.  But Chef omnibus bundles its own ruby interpreter...
[2013-03-26 14:39:04 -0400] zts: I don't like RVM on the server, but clearly differ on that - I gather it works okay for pikesley :)  rbenv is meant to be less intrusive, but I haven't used that at all
[2013-03-26 14:39:23 -0400] zts: I've always packaged newer interpreters to run alongside the ones provided by the operating system, but that's (often) more up-front work
[2013-03-26 14:39:33 -0400] zts: what is the problem you're actually trying to solve here?
[2013-03-26 14:40:16 -0400] eherot: marlonb: heh, oh, yeah I haven't done the server upgrade yet.  But probably this is the ticket: tail -f /var/log/*chef*/*.log
[2013-03-26 14:41:46 -0400] threesome: zts, I'm trying to provision a Redmine issue tracking system node, which is based on Ruby. If I want to use Ruby that's newer than 1.8 I use RVM, but doing so confuses Chef omnibus doesn't it? It's the reason why I had to switch from using Omnibus Chef to gem Chef on my workstation. Since omnibus is recommended by Opscode, I'd like to use that in production and not gem instlal
[2013-03-26 14:42:25 -0400] BryanWB__: sup sup chefs!
[2013-03-26 14:42:53 -0400] zts: threesome: and you're trying to install redmine using ubuntu packages, or some other way?
[2013-03-26 14:43:04 -0400] threesome: zts, manually installing it
[2013-03-26 14:44:19 -0400] threesome: zts, that leaves me the option of on that node running either omnibus Chef (recommneded by Opscode) + old system ruby (1.8) for Redmine, or gem Chef + new system Ruby (both over RVM). I thought the first option is better because of the 'right' way to install Chef using omnibus, but then I have to use old Ruby for Redmine
[2013-03-26 14:44:49 -0400] threesome: That's why I'm wondering whether there's a way to use newest system ruby with Ubuntu packages
[2013-03-26 14:45:46 -0400] ProfFalken: pikesley: redmine is a project management tool, it's actually pretty neat
[2013-03-26 14:45:50 -0400] zts: threesome: if you're manually installing it, I'd use ubuntu's ruby1.9.3 packages, then run "gem1.9.3" whenever the instructions said to use "gem", and so on.  But really, I think we're far out of scope for #chef at this point
[2013-03-26 14:46:06 -0400] ProfFalken: pikesley: http://www.redmine.org/
[2013-03-26 14:46:26 -0400] zts: and I have to get ready for a meeting, so I'll have to wish you luck and leave it there - sorry!
[2013-03-26 14:46:37 -0400] pikesley: right, are you trying to run it on the same box as your chef server or something?
[2013-03-26 14:46:44 -0400] threesome: zts, thanks
[2013-03-26 14:47:14 -0400] threesome: pikesley, on the same server as latest Chef client (currently a Vagrant box that comes with an old Chef client which I update using the Omnibus script)
[2013-03-26 14:48:19 -0400] threesome: pikesley, how so?
[2013-03-26 14:48:31 -0400] yfeldblum: threesome, RVM is fine with chef-client, whether it's installed as a gem or with the omnibus-built installer, so long as you don't specify a default ruby and so long as you don't use it to change the system ruby
[2013-03-26 14:49:21 -0400] pikesley: are you running some sort of production infrastructure on a Vagrant box?
[2013-03-26 14:50:11 -0400] threesome: yfeldblum, I remember reading on Opscode website that Omnibus is the supported install method
[2013-03-26 14:50:29 -0400] threesome: yfeldblum, how would setting a default Ruby in RVM cause potential problems?
[2013-03-26 14:50:48 -0400] yfeldblum: threesome, because it breaks assumptions
[2013-03-26 14:50:49 -0400] threesome: pikesley, no I'm setting it up on Vagrant before moving it to production environment
[2013-03-26 14:51:17 -0400] yfeldblum: threesome, so long as you use RVM as an opt-in-only sort of thing, it's fine
[2013-03-26 14:51:27 -0400] pikesley: so you need a Redmine server?
[2013-03-26 14:51:31 -0400] pikesley: which needs ruby?
[2013-03-26 14:52:16 -0400] pikesley: make a 'redmine' user, give him RVM, install 1.9.3-wtf for him
[2013-03-26 14:52:24 -0400] pikesley: run Redmine as him?
[2013-03-26 14:54:18 -0400] yfeldblum: threesome, if you need to change the version of ruby used to run chef, when chef is installed as a gem in the system ruby, you could write a bootstrap script template that installs that version of ruby and uses update-alternatives to make that the default, and then installs/configures/runs chef
[2013-03-26 14:56:04 -0400] threesome: pikesley, WOW you may have just solved my problem! So if chef-client is run as any user other than the new redmine user you suggest creating (and RVM would only be installed in /home/redmine/.rvm), then I can install Chef with omnibus and RVM won't interfere with it? (The main issue was that Chef would have to be installed as a gem rather than omnibus because the omnibus install would conflict with RVM)
[2013-03-26 14:56:26 -0400] pikesley: THIS IS WHY RVM IS MAGIC
[2013-03-26 14:57:18 -0400] threesome: yfeldblum, I heard that changing the update-alternatives thing could subtly break other things in the operating system if they were expecting a different version of the underlying library, but I'm really not sure too much about it
[2013-03-26 14:57:42 -0400] threesome: pikesley, well problem solved then. Thank you
[2013-03-26 14:58:22 -0400] yfeldblum: threesome, i doubt running chef-client as a the redmine user will work ...
[2013-03-26 14:58:32 -0400] pikesley: right, but you don't need to
[2013-03-26 14:58:38 -0400] pikesley: see the rvm cookbook
[2013-03-26 14:59:01 -0400] AskSteve: Is it possible to have multiple items in a single data bag?
[2013-03-26 14:59:09 -0400] yfeldblum: threesome, why do you need to change the system ruby at all?
[2013-03-26 14:59:26 -0400] yfeldblum: AskSteve, think of a data-bag as a table and a data-bag-item as a record in that table
[2013-03-26 15:00:05 -0400] AskSteve: so
[2013-03-26 15:00:30 -0400] AskSteve: { "id": "name1"} {"id":"name2"}?
[2013-03-26 15:00:56 -0400] yfeldblum: AskSteve, yes
[2013-03-26 15:00:58 -0400] threesome: yfeldblum, I'd like to install Chef using omnibus, that's the main requirement. The second requirement is to use Redmine with a more recent Ruby than the default Ubuntu Ruby of 1.8. I needed to update system ruby for Redmine
[2013-03-26 15:01:30 -0400] yfeldblum: AskSteve, but not in the same json file
[2013-03-26 15:01:35 -0400] pikesley: threesome: YOU DON'T
[2013-03-26 15:01:43 -0400] pikesley: or if you do, Redmine is broken
[2013-03-26 15:01:56 -0400] yfeldblum: threesome, why does redmine need the system ruby? will redmine break with rvm?
[2013-03-26 15:02:06 -0400] AskSteve: I get a parse error when I try to "from file" the databag: Yajl::ParseError: Found multiple JSON objects in the stream but no block or the on_parse_complete callback was assigned to handle them.
[2013-03-26 15:02:35 -0400] yfeldblum: AskSteve, of course - that's not a valid JSON document to have multiple data-bag-items in a single JSON document
[2013-03-26 15:02:36 -0400] eherot: Has anyone else had a problem with the chef-client just randomly stopping writing to its log after running fine for quite some time?
[2013-03-26 15:03:17 -0400] yfeldblum: AskSteve, if you're using `from file`, then each data-bag-item must be in its own file
[2013-03-26 15:03:21 -0400] threesome: yfeldblum, Redmine won't break with RVM. My mistaken assumption was that RVM on your system means everything will see the environment variables changes that RVM makes -> conflicts with omnibus Chef install -> I have to install Chef using gems rather than the supported omnibus method
[2013-03-26 15:03:31 -0400] pikesley: nope
[2013-03-26 15:03:48 -0400] threesome: pikesley, yes now I understand :)
[2013-03-26 15:03:54 -0400] pikesley: threesome: try it on yer vagrant
[2013-03-26 15:04:26 -0400] threesome: pikesley, but if chef-client binary were owned by a user that has .rvm in its home directory, then the problems would happen right?
[2013-03-26 15:04:35 -0400] yfeldblum: threesome, NO
[2013-03-26 15:04:52 -0400] AskSteve: is there a way to do it with one file?
[2013-03-26 15:05:15 -0400] pikesley: rvm does voodoo with your path
[2013-03-26 15:05:28 -0400] pikesley: chef-client will run as root
[2013-03-26 15:05:35 -0400] pikesley: I think these issues are orthogonal
[2013-03-26 15:05:39 -0400] pikesley: try it
[2013-03-26 15:05:44 -0400] pikesley: the shit will just work
[2013-03-26 15:05:57 -0400] yfeldblum: threesome, here's what you do: 1) use omnibus chef-client; 2) use RVM but don't set any default ruby; 3) install an RVM ruby but don't make it default; 4) install redmine into that RVM ruby
[2013-03-26 15:06:14 -0400] gmcinnes: guys. I'm trying to copy a yml file to a remote system using "cookbook_file" resource, then use it later in a "bash" resource. Can't seem to make it work. Is that not something I should expect to work?
[2013-03-26 15:06:39 -0400] yfeldblum: gmcinnes, use it later - how?
[2013-03-26 15:06:55 -0400] gmcinnes: basically I"m trying to avoid encrypted data bags when using chef-solo
[2013-03-26 15:07:27 -0400] gmcinnes: So I want to copy "secrets.yml" from my local machine to /tmp/secrets.yml.  Then later read that secrets.yml and use the variables in a bash resource.
[2013-03-26 15:07:40 -0400] gmcinnes: to config one or two services on the remote machine.
[2013-03-26 15:08:10 -0400] yfeldblum: gmcinnes, that ... requires more explanation ... anyway, what do you mean by "use the variables in a bash resource"?
[2013-03-26 15:08:19 -0400] gmcinnes: yfeldblum: Like this: http://pastie.org/7125253
[2013-03-26 15:08:44 -0400] threesome: yfeldblum, for which Linux user account should I install RVM for? Would the setup you propose work if I didn't create a 'redmine' user account in Linux, and Chef and Redmine run as the same user?
[2013-03-26 15:08:57 -0400] jonlives: gmcinnes: it's trying to evaluate secrets = YAML::load(File.open("/tmp/secrets.yml")) as bash....
[2013-03-26 15:09:02 -0400] jonlives: which won't work.
[2013-03-26 15:09:28 -0400] yfeldblum: gmcinnes, of *course* that won't work
[2013-03-26 15:09:49 -0400] AskSteve: yfeldblum: what would be the best way to have a disk based backup for the data bag?
[2013-03-26 15:09:59 -0400] yfeldblum: gmcinnes, *all* of your ruby code is run *before* any of the resources are converged
[2013-03-26 15:10:07 -0400] jonlives: gmcinnes: check out http://docs.opscode.com/resource_script.html for the supported params to that resource type
[2013-03-26 15:10:42 -0400] yfeldblum: threesome, *always* run chef-client as root; you can make a user for redmine and install a per-user version of RVM for that redmine user if you like
[2013-03-26 15:10:44 -0400] jonlives: also, ignore my first statement, that was crap
[2013-03-26 15:11:26 -0400] yfeldblum: AskSteve, some people like to have their data-bag items in git; other people like to treat them as real database records, and take backups of their chef-server database using the knife-server gem
[2013-03-26 15:12:12 -0400] gmcinnes: yfeldblum: it is? I thought it only executed the stuff inside the _code_ parameter as bash.  We're just inside a normal ruby block aren't we?
[2013-03-26 15:12:24 -0400] yfeldblum: gmcinnes, the part *inside* the block is run during recipe execution (aka "compilation")
[2013-03-26 15:12:35 -0400] yfeldblum: gmcinnes, this is true for all resources
[2013-03-26 15:12:41 -0400] AskSteve: so if I want to put them in git, they need to be in separate files?  there isn't a way to do it with one .rb file instead of many .json files?
[2013-03-26 15:13:11 -0400] yfeldblum: AskSteve, you can always write your own custom knife plugin that can do that ... but ... why?
[2013-03-26 15:13:27 -0400] yfeldblum: AskSteve, if they're Ruby files, then why are they data-bag items?
[2013-03-26 15:13:34 -0400] gmcinnes: yfeldblum: ok. understood. so, is there any way to do what I'm trying to achieve?
[2013-03-26 15:13:45 -0400] AskSteve: I using nagios to monitor my servers, seems like I'll have hundreds of 3 line .json files on disk
[2013-03-26 15:13:48 -0400] threesome: yfeldblum, ok. Out of curiosity, if I do as you just said (and Chef was installed with Omnibus), but when I installed RVM as the redmine user I set a default Ruby, would that stil fail? If so, why? Because I thought Chef wouldn't even see the default Ruby that has been set by another user
[2013-03-26 15:14:01 -0400] yfeldblum: gmcinnes, why not use a data-bag item?
[2013-03-26 15:14:52 -0400] yfeldblum: threesome, if you install RVM system-wide, do not set a default ruby; if you install RVM in single-user mode, then you may set a default ruby
[2013-03-26 15:14:54 -0400] gmcinnes: yfeldblum: I guess as long as that data-bag item is not checked into source it's the same thing. ok.
[2013-03-26 15:15:10 -0400] pikesley: threesome: do a per-user install
[2013-03-26 15:16:04 -0400] threesome: pikesley, yfeldblum: understood. Btw would rbenv have the same problems of incompatibility with omnibus Chef as RVM does?
[2013-03-26 15:16:11 -0400] BryanWB__: is there a way to set up a list of http mirrors for the remote_file resource w/ chef 11?
[2013-03-26 15:16:22 -0400] yfeldblum: gmcinnes, you can also fetch the file *at recipe execution time* (aka "compilation") rather than declaring a resource instructing chef to fetch the file later
[2013-03-26 15:16:30 -0400] pikesley: threesome: IT'S NOT INCOMPATIBLE
[2013-03-26 15:16:44 -0400] Kzim: hello, can i call the  :name_attribute in a resource to concat it to another attribute ?
[2013-03-26 15:17:04 -0400] yfeldblum: threesome, yes
[2013-03-26 15:17:23 -0400] gmcinnes: yfeldblum: yeah, but I can't fetch it from my localhost, can I? It would need to be a well-known 3rd location, such as s3 or similar?
[2013-03-26 15:17:31 -0400] yfeldblum: gmcinnes, of course
[2013-03-26 15:17:39 -0400] Mez: Seriously, where are the chef docs for 11.x ?
[2013-03-26 15:17:50 -0400] pikesley: threesome: see the system ruby? forget that. pretend it's not ruby. call it something else. leave it alone. never touch it.
[2013-03-26 15:17:56 -0400] threesome: yfeldblum, so whether I go with rbenv or RVM, the thing is the same: if doing a (RECOMMENDED) user install, you can set a default Ruby. But if doing a (NOT recommended) system install, do NOT set a system ruby
[2013-03-26 15:17:57 -0400] yfeldblum: gmcinnes, you couldn't fetch it from your localhost anyway with cookbook_file either
[2013-03-26 15:18:27 -0400] gmcinnes: yfeldblum: right. There's no way to "inject" it at runtime into the compilation phase. See that makes sense since now that I think about it, and the work I've done with chef_server. For some reason I thought I'd get away with it with chef_solo
[2013-03-26 15:18:47 -0400] gmcinnes: yfeldblum: since all my cookbooks end up on the target machine etc.
[2013-03-26 15:18:52 -0400] yfeldblum: threesome, overall, just know WTF you're doing, and how it works; feel free to try things out and do experiments - that's what cloud servers are for
[2013-03-26 15:20:11 -0400] threesome: yfeldblum, will do, thanks
[2013-03-26 15:20:28 -0400] threesome: pikesley, thanks
[2013-03-26 15:23:36 -0400] Kzim: perhaps is there a way to access an attribute within the resource ?
[2013-03-26 15:25:26 -0400] yfeldblum: Kzim, you can define additional methods on your resource class, if you lik
[2013-03-26 15:26:27 -0400] Kzim: yfeldblum, but i have "attribute :name" for example how can i access the name var in the resource file please ?
[2013-03-26 15:28:08 -0400] yfeldblum: Kzim, how familiar are you with writing modules and classes in ruby?
[2013-03-26 15:35:16 -0400] Kzim: yfeldblum, noob :)
[2013-03-26 15:36:18 -0400] Illusioneer: So for reasons of ease of use I am going with chef-solo, however to help with updates to cookbooks/recipes it occurred to me that git would be a good way to maintain it and easily update all my servers with nodes and templates.  Good idea, bad idea, common practice?
[2013-03-26 15:39:13 -0400] basic`: so i'm trying to use databags and some logic in a recipe to read from them, but it seems to be reading blank
[2013-03-26 15:39:26 -0400] basic`: is there a way to print the databag output from the recipe so i can see what it's grabbing?
[2013-03-26 15:42:44 -0400] leifmadsen: can I set a node attribute in a recipe that is persistent across chef runs?
[2013-03-26 15:46:02 -0400] X-Jester: say, in the Chef::Environment class, there is a 'destroy' method as well as a 'cdb_destroy' method - are these just two different ways of accomplishing the same task?  one which requires the chef server rest api (destroy) and one which just does it directly in couchdb (cdb_destroy) ?
[2013-03-26 15:46:11 -0400] yfeldblum: Kzim, http://pastie.org/private/y1ztuif0crqoqumep27ha
[2013-03-26 15:46:15 -0400] X-Jester: Or would both be required in order to delete, say, a chef environment?
[2013-03-26 15:46:36 -0400] yfeldblum: basic`, show a gist/pastie of what you're trying to do?
[2013-03-26 15:46:48 -0400] yfeldblum: X-Jester, the cdb_destroy method isn't for you
[2013-03-26 15:47:17 -0400] yfeldblum: X-Jester, that's an internal method that the chef-server-api uses, as you've noted
[2013-03-26 15:47:50 -0400] yfeldblum: X-Jester, the destroy method is for you, if you want to interact with the chef-server-api from your own ruby script or from a custom knife plugin
[2013-03-26 15:49:29 -0400] basic`: yfeldblum: http://pastie.org/7125772
[2013-03-26 15:50:52 -0400] basic`: yfeldblum: is intf reserved?
[2013-03-26 15:51:17 -0400] Kzim: yfeldblum, thanks a lot !
[2013-03-26 15:52:25 -0400] t0x: Hi, every time I try to use knife I keep getting a 406 error and I don't know why ...  knife node list -s https://my_server -u testuser
[2013-03-26 15:52:57 -0400] t0x: the private key was generated using the webUI and I copied the private key from the server to the same folder.
[2013-03-26 15:53:02 -0400] yfeldblum: Kzim, no problem
[2013-03-26 15:53:09 -0400] t0x: am I forgetting something?
[2013-03-26 15:53:11 -0400] X-Jester: yfeldblum: awesome, thanks. :)
[2013-03-26 15:53:23 -0400] twkief: Hi, I have deleted a cookbook version on my server, and now the server is not responding to requests, hitting 100% cpu
[2013-03-26 15:53:54 -0400] basic`: yfeldblum: that strange thing is that the output during a chef client run is this:
[2013-03-26 15:53:58 -0400] basic`:   * ifconfig[] action add
[2013-03-26 15:53:59 -0400] basic`:     - run ifconfig   to add ifconfig[]
[2013-03-26 15:54:00 -0400] basic`:     - generate configuration file : /etc/sysconfig/network-scripts/ifcfg-
[2013-03-26 15:54:23 -0400] basic`: but the route works and writes  to /etc/sysconfig/network-scripts/route-eth0
[2013-03-26 15:54:44 -0400] yfeldblum: basic`, no, it's not reserved; it's fine to use it as a local variable or block parameter name
[2013-03-26 15:55:47 -0400] yfeldblum: basic`, but that code doesn't seem to do what you want ...
[2013-03-26 15:55:52 -0400] yfeldblum: basic`, why are you using each_value?
[2013-03-26 15:56:10 -0400] basic`: yfeldblum: i copied this from a mailing list entry.. let me see if i can find it
[2013-03-26 15:56:31 -0400] basic`: http://lists.opscode.com/sympa/arc/chef/2010-07/msg00124.html
[2013-03-26 15:57:42 -0400] leifmadsen: essentially I'm trying to generate a uniqueid for the server-id field in my.cnf, and I've done that with Time.now.to_i, however, I need to keep this value persistent across chef runs obviously. The only thing I can think of is to write it to a file on the system, and read it each time, but that just kind of sucks.
[2013-03-26 15:57:55 -0400] leifmadsen: Ideally I'd be able to write a value and have it stored on the chef server in a node attribute
[2013-03-26 15:58:24 -0400] basic`: yfeldblum: easier to do a different way?
[2013-03-26 15:59:05 -0400] yfeldblum: basic`, in the mailing-list example, the "interfaces" key has a value which is a set of interfaces, not just a single interface
[2013-03-26 15:59:24 -0400] yfeldblum: basic`, in your pastie, the "interfaces" key has the properties for a single interface only
[2013-03-26 15:59:33 -0400] basic`: oh!
[2013-03-26 16:00:27 -0400] sprack: leifmadsen: MAC address?
[2013-03-26 16:00:41 -0400] leifmadsen: sprack: I think the server-id value only takes numbers
[2013-03-26 16:01:22 -0400] sprack: leifmadsen: ip-address without the periods?
[2013-03-26 16:01:46 -0400] leifmadsen: sprack: that was what we did originally, but in some cases the value can be larger than 2^32-1 which is the max allowed by mysql
[2013-03-26 16:03:08 -0400] basic`: leifmadsen: it only needs to be unique for nodes being replicated to
[2013-03-26 16:03:14 -0400] basic`: how many do you have?
[2013-03-26 16:03:16 -0400] leifmadsen: basic`: lots
[2013-03-26 16:03:19 -0400] basic`: hmm
[2013-03-26 16:03:42 -0400] leifmadsen: it still has to be something that can be autogenerated and unique
[2013-03-26 16:03:53 -0400] leifmadsen: it's enough that manually dealing with it in a data bag is unreasonable
[2013-03-26 16:04:03 -0400] basic`: more than the last two octets of the ip?
[2013-03-26 16:04:18 -0400] leifmadsen: we have several networks, so that would conflict potentially
[2013-03-26 16:04:22 -0400] basic`: ah
[2013-03-26 16:04:28 -0400] yfeldblum: leifmadsen, it doesn't suck
[2013-03-26 16:04:32 -0400] yfeldblum: leifmadsen, why would that suck?
[2013-03-26 16:04:49 -0400] leifmadsen: yfeldblum: it would be nice to have access to that information across a search or something
[2013-03-26 16:04:53 -0400] sprack: leifmadsen: last reboot | head -1, parse the time into a useable form for Time?
[2013-03-26 16:04:58 -0400] leifmadsen: and not have a local file to read each time
[2013-03-26 16:05:09 -0400] leifmadsen: sprack: that data would be dynamic and changing
[2013-03-26 16:05:16 -0400] sprack: you reboot often?
[2013-03-26 16:05:38 -0400] leifmadsen: I can't guarantee we won't reboot and cause a conflict
[2013-03-26 16:05:48 -0400] leifmadsen: I'll just write to a file and read from it then
[2013-03-26 16:06:04 -0400] masterkorp: sprack: this is UNIX, we dont rebooy
[2013-03-26 16:07:11 -0400] sprack: only fixed thing I could thing of in your case would be a MAC to int or processor serial number
[2013-03-26 16:08:05 -0400] yfeldblum: leifmadsen, http://pastie.org/private/pcvnqp433aruqv3ixivuw
[2013-03-26 16:09:21 -0400] leifmadsen: yfeldblum: I guess the 2nd line checks if the file exists, and if it doesn't, write a value to it using SecureRandom.hex? (I'm not familiar with that method)
[2013-03-26 16:09:28 -0400] leifmadsen: method/format
[2013-03-26 16:09:56 -0400] devx: I'm trying to add support to knife so i can su -  to become user, what is the better place to put it? under the knife/ssh.rb or knife/bootstrap.rb ? ( sorry if this is not the place for this question)
[2013-03-26 16:10:35 -0400] yfeldblum: leifmadsen, no, that line checks if the file exists; if the file exists, it reads the value; otherwise, it makes one up; the value is stored in a local variable only
[2013-03-26 16:11:15 -0400] yfeldblum: leifmadsen, the file resource later on is where the value is stored to the filesystem
[2013-03-26 16:11:29 -0400] leifmadsen: gotcha
[2013-03-26 16:11:40 -0400] leifmadsen: thanks, I'll just go with that approach since it is the least dynamic :)
[2013-03-26 16:12:41 -0400] Kzim: yfeldblum, i can't do that right ? http://pastie.org/7126127
[2013-03-26 16:13:25 -0400] sprack: remote_file is screwing up the url for ftp links, but not http. anyone else hit that? Sending HTTP Request via GET to ftp.csx.cam.ac.uk:21pub/software/programming/pcre/pcre-8.32.tar.gz/ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.32.tar.gz
[2013-03-26 16:15:15 -0400] basic`: yfeldblum: so that worked, thanks!  now i'm trying to set the default gateway, is there a way to do that?
[2013-03-26 16:15:32 -0400] basic`: with the ifconfig resource? it doesn't seem to like 'gateway'
[2013-03-26 16:17:33 -0400] basic`: or am i doing this completely wrong? is there a better way to manage static networking config?
[2013-03-26 16:17:56 -0400] basic`: i have about 5 days of chef experience
[2013-03-26 16:18:22 -0400] sprack: route add 0.0.0.0/0 gw 1.1.1.1
[2013-03-26 16:19:37 -0400] basic`: thanks sprack
[2013-03-26 16:20:49 -0400] yfeldblum: basic`, why are you even using a data-bag item?
[2013-03-26 16:21:25 -0400] basic`: yfeldblum: what is the alternative? the first hit when i searched for this was that mailing list entry
[2013-03-26 16:21:43 -0400] yfeldblum: Kzim, you can only call `attribute` from the top-level, not from inside a method
[2013-03-26 16:22:24 -0400] yfeldblum: basic`, just configuring the interfaces without fetching the data from a data-bag item ...
[2013-03-26 16:22:44 -0400] basic`: yfeldblum: would i have to create a recipe for every single host though?
[2013-03-26 16:23:11 -0400] yfeldblum: basic`, it depends - why are you using a data-bag item?
[2013-03-26 16:23:35 -0400] basic`: yfeldblum: because the first example in google used a data bag item
[2013-03-26 16:23:47 -0400] basic`: and it was the only one that i found that did what i wanted it to do
[2013-03-26 16:24:23 -0400] yfeldblum: basic`, what do you want to do?
[2013-03-26 16:25:04 -0400] basic`: yfeldblum: configure static networking on hosts that are using static networking (currently most of our infrastructure)
[2013-03-26 16:25:43 -0400] yfeldblum: basic`, can the information you need be discovered from ohai?
[2013-03-26 16:26:09 -0400] yfeldblum: basic`, if you ssh into a host as root and run `ohai`, does it show all the information you would need to configure the host?
[2013-03-26 16:26:10 -0400] bdot: anyone knows  is there any good documents on how to access lwrp's attribute in recipe?
[2013-03-26 16:26:38 -0400] yfeldblum: bdot, i don't know what that means ...
[2013-03-26 16:27:08 -0400] bdot: say I have lwrp, and it has an attribute of id
[2013-03-26 16:27:37 -0400] siezer: attributes are global to the chef run
[2013-03-26 16:27:38 -0400] bdot: inside this lwrp, I want to update the id to be id + 1
[2013-03-26 16:27:38 -0400] Kzim: yfeldblum, i can't append an attributes with another in the resource then ?
[2013-03-26 16:27:42 -0400] siezer: you mean a local method used in the LWRP?
[2013-03-26 16:28:03 -0400] bdot: is attribute updatable?
[2013-03-26 16:28:11 -0400] siezer: yep
[2013-03-26 16:28:27 -0400] bdot: how do I increase the value inside the provider?
[2013-03-26 16:28:46 -0400] siezer: lts back up a second
[2013-03-26 16:28:50 -0400] siezer: what exactly are you trying to do
[2013-03-26 16:29:17 -0400] yfeldblum: Kzim, you probably also also can't use `node` directly from the top-level of the resource file
[2013-03-26 16:29:47 -0400] bdot: ok, I want to use a lwrp to run some command, and get the result, and assign the result to an attribute so I can access the command output by accessing the lwrp's attribute
[2013-03-26 16:29:57 -0400] yfeldblum: bdot, no ... the recipe must assign the correct id to the resource
[2013-03-26 16:30:30 -0400] Kzim: yfeldblum, arg thanks
[2013-03-26 16:31:27 -0400] bdot: so there is no way that I can update the attribute in provider, and access it by accessing the instance's attribute?
[2013-03-26 16:32:10 -0400] bdot: then what is attr_accessor for?
[2013-03-26 16:32:40 -0400] siezer: bdot you're thinking waaaay too rubyish
[2013-03-26 16:32:43 -0400] siezer: do this
[2013-03-26 16:32:52 -0400] siezer: yourcookbook/attributes/default.rb
[2013-03-26 16:33:25 -0400] basic`: yfeldblum: yes all of the information is in ohai
[2013-03-26 16:33:30 -0400] siezer: default['cookbook-name']['yourattribute']['maybe_a_sub']['up_to_you']
[2013-03-26 16:33:46 -0400] siezer: that attribute will now be available everywhere in your chef run
[2013-03-26 16:33:57 -0400] yfeldblum: Kzim, try something like http://pastie.org/private/qwnuzaxiigdqfattc8hdq
[2013-03-26 16:34:00 -0400] siezer: as node['cookbook-name']['blah']
[2013-03-26 16:34:29 -0400] basic`: yfeldblum: i'm assuming that opens up some other options?
[2013-03-26 16:34:34 -0400] siezer: you can update it from the compile phase of a vanilla recipe, or from the compile phase of your LWRPs, or from ruby_blocks in compiled resources
[2013-03-26 16:34:38 -0400] yfeldblum: bdot, the way you're thinking about it is not the way chef thinks about it; chef wants you to fully specify every attribute up-front
[2013-03-26 16:35:06 -0400] yfeldblum: basic`, this is from a node that was just handed to you fresh (maybe configured by a prior step, but before chef ever touches this node)?
[2013-03-26 16:35:39 -0400] siezer: think of attributes as global variables across all chef recipes that are created as the very first thing chef-client does, and saved back to the server as the very last thing it does
[2013-03-26 16:35:40 -0400] basic`: yfeldblum: we can assume that, since we have to configure at least one interface to build out a node
[2013-03-26 16:36:07 -0400] basic`: yfeldblum: sometimes we add interfaces though, which could get tricky
[2013-03-26 16:37:07 -0400] yfeldblum: basic`, are you intending to add these interfaces purely through chef alone?
[2013-03-26 16:37:22 -0400] basic`: yfeldblum: if that's possible, then that's preferred
[2013-03-26 16:38:18 -0400] twkief: I have a node that is downloading an old version of a cookbook from the server, and I can't figure out why
[2013-03-26 16:38:25 -0400] twkief: How can I tell what the dependency chain is?
[2013-03-26 16:38:40 -0400] twkief: The metadata.rb of another cookbook refers to it, but isn't locked to any particular version
[2013-03-26 16:43:37 -0400] yfeldblum: basic`, you *can* use custom normal-level node-attributes; normal-level node attributes are "sticky" in the sense that chef-client doesn't clear them out at the beginning of each run, but keeps them from run to run, so you can set them with `knife node edit` and they'll be there when chef-client runs next time
[2013-03-26 16:44:50 -0400] bdot: siezer: that's one way, but the problem is that the value set to the node attribute won't be valid until next chef run.
[2013-03-26 16:45:49 -0400] bdot: if I can two lwrp in the recipe, one sets the value in node attribute, if the other one tries to access the node attribute to get the value, it fails.
[2013-03-26 16:49:25 -0400] binjured: sigh... i keep getting told there's a `recipe compile error` because `can't find user for <name>` where <name> is a username i'm creating earlier in the recipe. why is it "compiling" other blocks before creating the user?
[2013-03-26 16:49:51 -0400] basic`: yfeldblum: what about using a template that just writes the ohai attributes into files? or would that not survive?
[2013-03-26 16:51:03 -0400] yfeldblum: basic`, i don't know what that means
[2013-03-26 16:51:44 -0400] yfeldblum: basic`, the ohai attributes are merged into the node attributes at the beginning of every chef-client run; all you have are node attributes, not ohai attributes, by the time your recipes are running
[2013-03-26 16:52:12 -0400] siezer: bdot the changed value should be available between resources on the collection
[2013-03-26 16:56:17 -0400] gamafranco: hi
[2013-03-26 16:56:47 -0400] gamafranco: I'm creating a recipe for a service, and would like the service to restart on boot. How do I add the start-stop file to boot on init?
[2013-03-26 16:57:08 -0400] basic`: ah, thanks for clarifying ohai output has 'eth0', '10.20.0.201', netmask, broadcast, etc so maybe i can just use the node attributes for that with ifconfig do
[2013-03-26 16:57:14 -0400] gamafranco: *feel free to provide a link on the right direction - google didn't help :)
[2013-03-26 16:57:24 -0400] narcisp: I've been trying to get the application and application_ruby cookbooks working. I keep getting a failure during the passenger_apache2 restart because it can't find the tmp/restart.txt file. I've checked cached-copy and there is no tmp/ in the app dir. I thought ./tmp was supposed to be created and symlinked to the shared dir as part of the install... ? Is there something obvious I'm missing?
[2013-03-26 16:57:55 -0400] basic`: since the device would need the network to work before it can be bootstrapped with chef, i think i can safely assume it will work
[2013-03-26 16:58:09 -0400] yfeldblum: basic`, if those interfaces are already configured, you may not need to configure them again from chef; chef would be for configuring new interfaces
[2013-03-26 16:59:50 -0400] basic`: excellent, i'll play around with this
[2013-03-26 16:59:51 -0400] basic`: thanks yfeldblum
[2013-03-26 17:00:46 -0400] sprack: is remote_file the only definition assigned for downloading? nothing that natively uses curl or wget?
[2013-03-26 17:04:02 -0400] gamafranco: pong
[2013-03-26 17:04:03 -0400] gamafranco: :)
[2013-03-26 17:08:04 -0400] gamafranco: how do I add a file on a cookbook to be called on boot (i.e. start on boot)?
[2013-03-26 17:09:24 -0400] dialt0ne: i seem to have a problem installing the chef server 11 rpm on centos6 on ec2
[2013-03-26 17:09:43 -0400] dialt0ne: it looks like it's choking on figuring out the hostname in vpc
[2013-03-26 17:09:49 -0400] ranjibd: gamafranco: is it a service ? action :enable will do it
[2013-03-26 17:10:05 -0400] gamafranco: ranjibd - thanks
[2013-03-26 17:10:24 -0400] ranjibd: if its a service and chkconfig or update-rc.d can understand it
[2013-03-26 17:10:27 -0400] dialt0ne: the nginx conf has empty server_name fields and /var/opt/chef-server/nginx/ca/ has just files .crt, .key and -ssl.conf
[2013-03-26 17:10:31 -0400] ranjibd: but this is only for service
[2013-03-26 17:11:39 -0400] ranjibd: if its not a service, just a one off script.. just drop it in rc2/3.d .. and linux should invoke it upon reboot
[2013-03-26 17:11:57 -0400] siezer: dialt0ne you'll need to set the hostname to something valid before installing it
[2013-03-26 17:12:03 -0400] Kzim: yfeldblum, thanks !
[2013-03-26 17:12:09 -0400] jwilf: hey guys, i'm getting this error - FATAL: NameError: Cannot find a resource for secure_password on centos version 6.3
[2013-03-26 17:12:12 -0400] dialt0ne: i see
[2013-03-26 17:12:13 -0400] siezer: I recommend setting hostname to a DNS resolvable FQDN
[2013-03-26 17:12:30 -0400] siezer: hostname dnsworks.example.com
[2013-03-26 17:12:34 -0400] jwilf: now i know secure_password comes from openssl so i put that in metadata.rb but that didn't help
[2013-03-26 17:12:54 -0400] ranjibd: jwilf: can you pastebin the stacktrace ? .. did you include that recipe?
[2013-03-26 17:13:10 -0400] jwilf: secure_password is being used in the wordpress recipe which is included by the recipe i'm running
[2013-03-26 17:13:18 -0400] jwilf: ranjibd: sure, thanks
[2013-03-26 17:13:20 -0400] ranjibd: metadata will ensure its downloaded and available for inclusion
[2013-03-26 17:15:33 -0400] jwilf: ranjibd: http://pastebin.com/1U3kk3J0
[2013-03-26 17:15:47 -0400] jwilf: the strange thing is this works fine in chef-solo
[2013-03-26 17:16:02 -0400] jwilf: but when i try to deploy on the real server using chef-client, it fails
[2013-03-26 17:23:26 -0400] Kzim: if i make a provider and use node attribute in it. if this provider is call from another cookbook will it have the default attribute of his home-cookbook ?
[2013-03-26 17:23:56 -0400] jwilf: ranjibd: ah i thing i've fixed it
[2013-03-26 17:23:58 -0400] jwilf: think
[2013-03-26 17:24:06 -0400] jwilf: i added to my recipe
[2013-03-26 17:24:16 -0400] jwilf: class Chef::Recipe
[2013-03-26 17:24:17 -0400] jwilf:   include Opscode::OpenSSL::Password
[2013-03-26 17:24:17 -0400] jwilf: end
[2013-03-26 17:24:25 -0400] tabolario: i see a few EBS cookbooks out there.. any suggestions on the best one to use/fork?
[2013-03-26 17:24:30 -0400] jwilf: just before including the wordpress recipe
[2013-03-26 17:24:49 -0400] ranjibd: jwilf: i think the other recipe where it was included was coming after this one in the run list
[2013-03-26 17:25:07 -0400] ranjibd: always include your dependencies as rule of thumb..
[2013-03-26 17:25:23 -0400] ranjibd: tabolario: opscode aws cookbook
[2013-03-26 17:25:46 -0400] jwilf: ranjibd: you mean the order my dependencies are listed in metadata.rb?
[2013-03-26 17:26:01 -0400] doomviking: oh github. thank you for rate limiting the bandwidth. wake me in 4 hours.
[2013-03-26 17:26:15 -0400] tabolario: i suppose there's not a good way to test roles that use ebs volumes in my local vagrant boxes :)
[2013-03-26 17:26:37 -0400] ranjibd: jwilf: whatever library you are using, specify depends in the metadata and include the default recipe in your consumer recipe
[2013-03-26 17:27:48 -0400] ranjibd: tabolario: nah....:-) , you can mock though and do some unit tests .. but thats not really a feature test
[2013-03-26 17:28:05 -0400] jwilf: well my consumer recipe includes the wordpress recipe, which has this dependency on the openssl cookbook
[2013-03-26 17:29:26 -0400] jwilf: tabolario: i made a recipe which calls aws_ebs_volume from the aws cookbook - seems to work well
[2013-03-26 17:31:00 -0400] smkhan: I will appreciate help. When i run multiple knife bootstrap separated by & in bash script, some of them succeed, rest fails with "Can authenticate, Validation.pem is corrupt". Any idea ?
[2013-03-26 17:49:24 -0400] gad0lin: Aloha
[2013-03-26 17:49:32 -0400] Kzim: hey, is there a wait to put a recipe on hold until something on another machine is done ? i mean if the node can connect to the 2 other mongo then if continue de recipe ?
[2013-03-26 17:50:41 -0400] Illusioneer: So for reasons of ease of use I am going with chef-solo, however to help with updates to cookbooks/recipes it occurred to me that git would be a good way to maintain it and easily update all my servers with nodes and templates.  Good idea, bad idea, common practice?
[2013-03-26 17:52:18 -0400] gad0lin: I have thor wrapper for knife, and everything works on my machine, but doesnt on others, could you advise is it right way - http://pastebin.com/fv7BpZFE ?
[2013-03-26 17:52:45 -0400] spheromak: Kzim: you can use attributes and search to sit and wait. i.e. node1 waits on node2 (which should set some node attribute when its done). It's a hack but you can do it.
[2013-03-26 17:52:59 -0400] gad0lin: I want to get Node objects from knife results
[2013-03-26 17:53:00 -0400] spheromak: Kzim: if your on hosted chef you can use writeable databags to create a lock
[2013-03-26 17:53:18 -0400] spheromak: gad0lin: use knife execute
[2013-03-26 17:53:43 -0400] jgoulah: sooo, chef 11 breaks compatibility with knife json output... (basically this: http://community.opscode.com/questions/263)
[2013-03-26 17:53:55 -0400] jgoulah: i suppose this should be added here? http://docs.opscode.com/breaking_changes_chef_11.html
[2013-03-26 17:55:07 -0400] gad0lin: spheromak: I need to do more fancy stuff, I do use knife execute normally. I am on 11.04, just I wonder I am using ruby magic as it should be used (.creating object from json)
[2013-03-26 17:55:12 -0400] jgoulah: jtimberman: ^
[2013-03-26 17:55:53 -0400] spheromak: jgoulah: you can use ridley to just execut ethe search in ruby
[2013-03-26 17:56:02 -0400] spheromak: sorry gad0lin
[2013-03-26 17:56:09 -0400] spheromak: jgoulah: that wasn't for you :D
[2013-03-26 17:56:17 -0400] jgoulah: spheromak: k
[2013-03-26 17:56:42 -0400] spheromak: gad0lin: i would just use ridley to make a search in my thor task instead of going out to knife.
[2013-03-26 17:56:54 -0400] zts: Illusioneer: I'd be interested to hear more about the ease of use argument, if you wouldn't mind elaborating?
[2013-03-26 17:57:04 -0400] Kzim: spheromak, can't use search because we want to stay open to solo. yes for the attributs but i just have to chef if the connect to the others is ok. my probleme is how do i hold ? i mean just chef every chef-client run isn't very sexy :(
[2013-03-26 17:57:17 -0400] jperry2: ohai folks
[2013-03-26 17:57:33 -0400] jperry2: Anyone know that if the chef server is restarted that a new validation key is generated?
[2013-03-26 17:57:35 -0400] siezer: chef-server ends up being easier that solo because you have to reinvent all the wheels that server provides you.
[2013-03-26 17:58:05 -0400] spheromak: Kzim: then theres not a way to do it witouth something external to the run.  you can use Zmq or something else to do the blocking. there was the pylon stuff fujin was doing a while back.
[2013-03-26 17:58:22 -0400] Illusioneer: zts: well all the servers would be able to do a triggered or cron'd git-pull to update the recipes, templates and cookbooks, that way there would be less of a problem with some server becoming outo f date
[2013-03-26 17:58:27 -0400] jperry2: we were having issues with our chef server which required a restart, after the restart we had to use a new validation key
[2013-03-26 17:59:13 -0400] Kzim: spheromak, i see thanks a lot !
[2013-03-26 17:59:42 -0400] spheromak: 0mq.. jeeze
[2013-03-26 18:00:10 -0400] zts: Illusioneer: In the client/server model, all the nodes could do a triggered or cron'd chef-client to update everything - doesn't sound that different?
[2013-03-26 18:00:16 -0400] spheromak: jperry2: probably someone deleted the servers on disk validation key.
[2013-03-26 18:00:20 -0400] gad0lin: spheromak: Ridley looks good, thx!
[2013-03-26 18:00:33 -0400] spheromak: jperry2: when server restarts it checks for the key, if it doesn't exist it generates a new one.
[2013-03-26 18:00:45 -0400] jperry2: ah interesting
[2013-03-26 18:00:50 -0400] jperry2: maybe a data corruption
[2013-03-26 18:01:02 -0400] spheromak: or you ran the delete validation on a chef-server
[2013-03-26 18:01:10 -0400] Illusioneer: zts: yeah, the server version presents problems on our CentOS machine that's delegated for this
[2013-03-26 18:01:12 -0400] jperry2: what command is that?
[2013-03-26 18:01:20 -0400] spheromak: in chef11 server its storing the validation key in /etc/chef-server/ instead of /etc/chef :D
[2013-03-26 18:01:27 -0400] Illusioneer: by problems, I mean the numerous migraines involved in getting server to install on it
[2013-03-26 18:01:32 -0400] jperry2: we are on chef 10
[2013-03-26 18:01:34 -0400] spheromak: jperry2: its part of the chef-client cookbook
[2013-03-26 18:01:41 -0400] jperry2: I'll check the cookbook though
[2013-03-26 18:02:07 -0400] zts: Illusioneer: ah, understood.  Thanks - I would have imagined that to be much better with the Chef 11 omnibus packages, but it definitely was a pain on Chef 10
[2013-03-26 18:02:12 -0400] jperry2: @spheromak - thanks for letting me know, I just wanted to confirm that a restart didn't cause this
[2013-03-26 18:02:25 -0400] spheromak: yea in chef10 the servers validation is in /etc/chef (same place you put it on client).. and the client "chef-client::delete-validation" iirc will nuke it on the server. Tho i think the newer versions of that cookbook has guards against deleting when its ran on a chef-server.
[2013-03-26 18:02:47 -0400] jperry2: okay
[2013-03-26 18:03:05 -0400] jperry2: thanks I'll investigate further, hopefully we can track down why the original key was wiped out
[2013-03-26 18:03:47 -0400] zts: Illusioneer: anyway, your idea doesn't sound bad to me.  I'm also interested to hear how chef-solo users are distributing their chef-repo's to the nodes, as git is probably the approach I'd take too
[2013-03-26 18:04:04 -0400] Illusioneer: zts: i don't think this is so much an issue with chef as the giant PITA that centos can be
[2013-03-26 18:04:57 -0400] zts: Illusioneer: yeah, at a previous shop, we ended up packaging Chef ourselves (for Centos 6, with Ruby 1.9, and the other odds and ends) - it wasn't ideal
[2013-03-26 18:05:54 -0400] spheromak: zts: do the same thing here. package our own ruby for centos5/6
[2013-03-26 18:05:56 -0400] zts: Illusioneer: though I saw that there are omnibus packages for Chef 11 server for RHEL, so I imagined that was a happier place now.  Is that the install method you were using, or something else?
[2013-03-26 18:06:25 -0400] zts: spheromak: that much is pretty much a necessity, given how ropey the system one is :)
[2013-03-26 18:06:32 -0400] spheromak: yea
[2013-03-26 18:07:04 -0400] Illusioneer: zts: i'd tried initially a custom repo (that borked) and then tried the 'from scratch' method which led to a endless maze of dependency hell
[2013-03-26 18:07:18 -0400] Illusioneer: same reason why I gave up on installing Go on that machine
[2013-03-26 18:07:22 -0400] spheromak: Illusioneer: wouldjust use the omni builds where you can
[2013-03-26 18:07:33 -0400] zts: I second that
[2013-03-26 18:07:42 -0400] Illusioneer: on the upside, it gave me more leverage in evicting Centos from our network
[2013-03-26 18:08:24 -0400] spheromak: centos is ok. mostly stable. We run both cent/ubuntu. and I've had more prod issues with ubuntu. more up front issues with centos :D they both suck IMO.
[2013-03-26 18:08:42 -0400] binjured: 2 hours later and still can't get the `users` LWRP to actually create a user...
[2013-03-26 18:08:48 -0400] zts: spheromak: that's a given, they're all made of linux, which itself is made of software
[2013-03-26 18:09:04 -0400] Illusioneer: spheromak: same here, i wouldn't mind the up front problems with Centos if they'd stop using such stupidly antiquated packages
[2013-03-26 18:09:18 -0400] spheromak: zts: i have a bigger rant re: distros and the way were managing systems atm. so im a bit of a curmudgeon in this sense
[2013-03-26 18:09:32 -0400] zts: Illusioneer: if you're using the omnibus packages, you don't have any dependencies apart from the base systems - is there a reason you can't use those packages?
[2013-03-26 18:09:49 -0400] binjured: is there some magic to it? if it says `processing users_manage[foo]` and there is no error, why can't i use 'foo' in a `directory` block later? why is the user never created?
[2013-03-26 18:09:53 -0400] spheromak: Illusioneer: yea the omni chef-server and client are the way to go .
[2013-03-26 18:09:57 -0400] spheromak: no fuss
[2013-03-26 18:10:17 -0400] zts: Illusioneer: anyway, there are things you'll miss out on from not using Chef server.  Maybe those things don't matter, but you'll definitely be making more work for yourself until you have a handle on it.
[2013-03-26 18:10:17 -0400] Illusioneer: zts: i don't recall what the problem was off hand
[2013-03-26 18:10:37 -0400] Illusioneer: zts: i'll give omnibus another look
[2013-03-26 18:10:43 -0400] spheromak: binjured: you got a gist of the run and the cookbook ?
[2013-03-26 18:10:46 -0400] zts: Illusioneer: going for solo might be the right choice for you, but I'd be really wary of going down that road purely because of server install issues
[2013-03-26 18:11:01 -0400] zts: Illusioneer: if you _do_ though, please report back, I'd love to hear about more experience in that direction :)
[2013-03-26 18:11:09 -0400] Illusioneer: not nearly the nightmare that installing Puppet was
[2013-03-26 18:11:26 -0400] Illusioneer: zts: if i run into any problems i'll log the console output for ya :)
[2013-03-26 18:11:42 -0400] zts: Illusioneer: please do, I'm always happy to try to help (when I'm here!)
[2013-03-26 18:12:00 -0400] binjured: spheromak: https://gist.github.com/eaf1616678f0dd659017
[2013-03-26 18:12:45 -0400] spheromak: and it never takes action ?
[2013-03-26 18:12:54 -0400] spheromak: you run your run with -ldebug ?
[2013-03-26 18:12:59 -0400] Kzim: is there a way to get the result or exit code of and execute ?
[2013-03-26 18:13:12 -0400] binjured: spheromak: no, it just says "processing" and does nothing else.
[2013-03-26 18:13:29 -0400] binjured: [2013-03-26T18:07:46+00:00] INFO: Processing users_manage[cl] action create (platform::kitchen_sink line 15)
[2013-03-26 18:14:02 -0400] spheromak: binjured: run with -ldebug ?
[2013-03-26 18:14:07 -0400] binjured: will try
[2013-03-26 18:15:16 -0400] mattray: ugh, Chef::CookbookLoader against my openstack-repo inside of pry 10 minutes later it's still loading cookbooks
[2013-03-26 18:16:27 -0400] spheromak: binjured: what does that users data bag look like ?
[2013-03-26 18:17:15 -0400] spheromak: the users cook is all bag based. If you just want to create/remove a user without using that use the builtin user resource.
[2013-03-26 18:17:43 -0400] spheromak: mattray: yea theres a beast of a set of deps.
[2013-03-26 18:17:51 -0400] spheromak: my Berks for our ostack build is giant
[2013-03-26 18:18:11 -0400] binjured: spheromak: i have a users data bag with a cl.json file.
[2013-03-26 18:18:13 -0400] mattray: yeah, I'm testing spiceweasel 2.1 and the extract is broken
[2013-03-26 18:18:43 -0400] spheromak: binjured: add it to the gist. it wont remove if the action isn't remove and it wont add if the action in the bag isnt add. so you have conflicting things.
[2013-03-26 18:18:56 -0400] mattray: Chef::CookbookLoader lazy loads the names, so it was failing
[2013-03-26 18:19:50 -0400] spheromak: binjured: possibly. I odn't use the users cook, im just reading the provider code
[2013-03-26 18:20:59 -0400] spheromak: binjured: my _gut_ is that the   "action": "remove",
[2013-03-26 18:21:03 -0400] spheromak: is in your json
[2013-03-26 18:21:07 -0400] spheromak: so its never adding
[2013-03-26 18:21:08 -0400] spheromak: :D
[2013-03-26 18:21:21 -0400] binjured: spheromak: i have no action in my json at all... adding action: create does nothing.
[2013-03-26 18:21:36 -0400] spheromak: weird whats the state of the user ?
[2013-03-26 18:21:39 -0400] binjured: what is a less absurd way to create a user on the goddamn machine, please? :P
[2013-03-26 18:21:40 -0400] spheromak: i.e. it doesn't exist ?
[2013-03-26 18:21:44 -0400] binjured: yes
[2013-03-26 18:21:49 -0400] spheromak: user "cl"
[2013-03-26 18:21:56 -0400] spheromak: use the base resource
[2013-03-26 18:22:25 -0400] zts: other possible reasons: your data bag has a user "cl", but they're not in the group "cl" (which is what users_manage[cl] is talking about); that you haven't uploaded the data bag to the server; that search is broken; probably some other things
[2013-03-26 18:22:36 -0400] spheromak: http://docs.opscode.com/resource_user.html http://docs.opscode.com/resource_group.html
[2013-03-26 18:22:55 -0400] zts: ^^ much simpler to just use those resources when you're getting started :)
[2013-03-26 18:22:56 -0400] spheromak: zts: yea was just htinking about that. tho debug should return the attempt
[2013-03-26 18:23:54 -0400] binjured: spheromak: well, that's closer. now chef just says `user[cl] had an error; useradd returned 9`
[2013-03-26 18:24:10 -0400] spheromak: binjured: use -ldebug
[2013-03-26 18:24:15 -0400] spheromak: should put the actual command
[2013-03-26 18:24:19 -0400] spheromak: that was run and the return
[2013-03-26 18:24:26 -0400] spheromak: you can run the command by hand and see whats going on
[2013-03-26 18:24:42 -0400] spheromak: binjured: i imagine zts is right. its cause the group doesn't exist. need to make the group before you make the user
[2013-03-26 18:31:02 -0400] binjured: okay, that was only the most frustrating thing ever. thanks, zts.
[2013-03-26 18:32:37 -0400] Kzim: is there a way to parse the result of an execute in the recipe ?
[2013-03-26 18:34:32 -0400] timops: @Kzim - the execute resource only allows you to check return codes
[2013-03-26 18:34:38 -0400] timops: did you look at ruby_block ?
[2013-03-26 18:36:45 -0400] siezer: Kzim nope, there isn't, nor can there be. the "compilation phase" of the recipe compiles a resource collection, on which your execute resource would be.
[2013-03-26 18:36:51 -0400] threesome: From the rbenv cookbook, I see the following way to configure it. However, is it possible to specify this in the recipe itself rather than having to create a Chef repo, and if it's possible can I just put it at the top of the recipe? node.default['rbenv']['user_installs'] = [
[2013-03-26 18:36:51 -0400] threesome:   { 'user'    => 'tflowers',
[2013-03-26 18:36:51 -0400] threesome:     'rubies'  => ['1.9.3-p0', 'jruby-1.6.5'],
[2013-03-26 18:36:52 -0400] threesome:     'global'  => '1.9.3-p0',
[2013-03-26 18:37:22 -0400] siezer: if you need to do that kind of thing, create an LWRP that uses mixlib shell_out
[2013-03-26 18:37:36 -0400] siezer: then refer to your custom resource from a recipe
[2013-03-26 18:38:25 -0400] Kzim: siezer, timops even with Chef::Shellout ?
[2013-03-26 18:38:56 -0400] timops: @Kzim i believe that's what @siezer is talking about
[2013-03-26 18:39:31 -0400] siezer: Kzim yes... thats the deprecated version
[2013-03-26 18:40:06 -0400] Kzim: i'm not sure i understand
[2013-03-26 18:40:33 -0400] siezer: okay first thing to understand
[2013-03-26 18:40:38 -0400] siezer: chef is NOT "just scripting"
[2013-03-26 18:40:49 -0400] siezer: there are two (main) phases
[2013-03-26 18:41:10 -0400] siezer: 1) compilation phase, where chef parses recipes, building a thing called a "resource collection"
[2013-03-26 18:41:26 -0400] Kzim: k
[2013-03-26 18:41:27 -0400] siezer: every time it sees file, cron, user, directory, package, etc
[2013-03-26 18:41:33 -0400] siezer: those go on the resource collection
[2013-03-26 18:41:36 -0400] siezer: sec lemme dig up a gist
[2013-03-26 18:41:59 -0400] zts: Kzim: what is it that you want to do differently, based on the result of the thing being executed?
[2013-03-26 18:42:31 -0400] siezer: https://gist.github.com/someara/096d095ba8b4247dcaef
[2013-03-26 18:42:52 -0400] Kzim: zts, i want setup a mongo cluster without the mongogem
[2013-03-26 18:43:10 -0400] siezer: ^ compilation phase vs convergence phase
[2013-03-26 18:43:58 -0400] siezer: what you CAN do, is run commands and use their exit code to decide whether to fire the resource on the collection
[2013-03-26 18:44:36 -0400] zts: Kzim: okay, but what is the thing you're executing, and what would you then do differently based on its result?
[2013-03-26 18:44:50 -0400] siezer: https://gist.github.com/someara/5248007
[2013-03-26 18:44:57 -0400] Kzim: siezer, i think i see. but mongo return 0 even if the query return ok:0
[2013-03-26 18:45:40 -0400] siezer: parse the output?
[2013-03-26 18:45:43 -0400] zts: return code 0 does mean success, so that doesn't sound so bad
[2013-03-26 18:46:03 -0400] MoreTea: Hi guy's
[2013-03-26 18:46:05 -0400] Kzim: zts, i execute something like mongo localhost:' + inst["port"].to_s + ' -eval "printjson(rs.status())"' to see if the replicat is ok
[2013-03-26 18:46:34 -0400] Kzim: zts, the query has been executed successfully but the result of the query is an error
[2013-03-26 18:46:57 -0400] MoreTea: I've been hacking on some extra features for chef-solo-search
[2013-03-26 18:47:14 -0400] Kzim: perhaps i could make a templated script and execute it but ... it's ugly
[2013-03-26 18:47:18 -0400] MoreTea: I noticed that a lot of code (like loading environments) just expects there to be a chef server
[2013-03-26 18:47:18 -0400] zts: Kzim: well, going along with siezer's suggestions, if you wanted to use this in not_if/only_if I would pipe my mongo command to grep - which will give different result codes if it matches or not
[2013-03-26 18:48:34 -0400] Kzim: zts, i see, let me check that thanks !
[2013-03-26 18:52:39 -0400] Kzim: zts, i just can't grep mongo output but it's not a chef issue, i'll figure it out thanks
[2013-03-26 19:00:26 -0400] jedsmith: I left chef-client 11.4.0 running overnight, and when I went home ruby had 40 MB RSS, this morning 193 MB RSS
[2013-03-26 19:00:28 -0400] dillyjay: trying to provision using chef-solo and vagrant, and getting `The chef binary (either `chef-solo` or `chef-client`) was not found on the VM. my Vagrantfile: http://pastebin.com/NcWxdZdj
[2013-03-26 19:00:29 -0400] miah: programming is hard and most sysadmins have never programmed
[2013-03-26 19:00:45 -0400] jedsmith: does this jive with folks' experiences?
[2013-03-26 19:00:56 -0400] jedsmith: that's on a node with an empty runlist
[2013-03-26 19:01:04 -0400] miah: jedsmith: chef-client has a --fork option. you should probably use it.
[2013-03-26 19:01:24 -0400] dillyjay: sysadmin is hard and i'm a programmer; hence the issue i'm having
[2013-03-26 19:02:00 -0400] miah: unless your vagrant image explicitly adverstises having chef installed, you'll have to do that.
[2013-03-26 19:02:05 -0400] jedsmith: miah: elaborate? we're talking about an empty husk of ruby waiting around for -i seconds and then forking the bit that converges? that's not the default?
[2013-03-26 19:02:05 -0400] miah: or you can build your own image with chef pre-baked
[2013-03-26 19:02:37 -0400] miah: jedsmith: chef-client by default just executes its run on a interval. with the --fork option it will fork a new client and run on each interval.
[2013-03-26 19:02:50 -0400] jedsmith: interesting, that not being the default
[2013-03-26 19:02:51 -0400] jedsmith: me gusta
[2013-03-26 19:03:05 -0400] dillyjay: miah: within the vagrant file? but if i'm using chef to install things, how can i install chef if i haven't installed my thing that installs things?
[2013-03-26 19:03:16 -0400] benkay: does anyone have any idea why knife is wiping my node roles during a bootstrap run?
[2013-03-26 19:03:43 -0400] yfeldblum: Kzim, http://pastie.org/private/ykyxyx6xpbqjxvm7opq
[2013-03-26 19:04:01 -0400] dillyjay: shell script?
[2013-03-26 19:04:14 -0400] jedsmith: miah: thanks
[2013-03-26 19:04:52 -0400] Kzim: yfeldblum, i try that right away thanks
[2013-03-26 19:05:06 -0400] cwj: benkay: is your chef run completing successfully during the bootstrap? if you hit an error the node object wont be saved to the server, so the run list you gave in your bootstrap command will not be persisted
[2013-03-26 19:06:34 -0400] benkay: cwj: i added the node role to the run list and then bootstrapped. it returned that it successfully bootstrapped on an empty run list.
[2013-03-26 19:06:49 -0400] benkay: cwj: when I run with -r, it seems to be provisioning just fine
[2013-03-26 19:06:53 -0400] benkay: key: seems
[2013-03-26 19:06:59 -0400] Kzim: yfeldblum, Cannot find a resource for shell_out!  is it Chef::shell_out ?
[2013-03-26 19:07:31 -0400] yfeldblum: Kzim, where are you doing this from?
[2013-03-26 19:07:45 -0400] Kzim: recipe
[2013-03-26 19:07:51 -0400] yfeldblum: Kzim, what part of a recipe?
[2013-03-26 19:08:06 -0400] yfeldblum: Kzim, top-level? inside a resource block? inside a resource's guard block?
[2013-03-26 19:08:28 -0400] Kzim: yfeldblum, just a .each
[2013-03-26 19:08:41 -0400] cwj: benkay: generally when you use bootstrap it writes out a first-boot.json which includes the run list specified in the bootstrap command
[2013-03-26 19:08:41 -0400] Kzim: nothing fency
[2013-03-26 19:09:14 -0400] cwj: benkay: so it sounds like you are manually creating a node and adding items to its run list, in advance of actually running the bootstrap on the node?
[2013-03-26 19:09:47 -0400] benkay: i tried that to no avail :( what actually worked was to pass the role into the run list with -r role[therole]
[2013-03-26 19:10:23 -0400] cwj: you're using the -r role[therole] with what knife subcommand?
[2013-03-26 19:10:44 -0400] benkay: knife bootstrap -r role[therole]
[2013-03-26 19:11:03 -0400] benkay: cwj: now that I have a role applied to the node, and the node provisioned, when the run list in the role changes, how do I provision that node according to the updated role list?
[2013-03-26 19:11:05 -0400] cwj: you said 'i added the node role to the run list and then bootstrapped'
[2013-03-26 19:11:11 -0400] benkay: and that didn't work
[2013-03-26 19:11:15 -0400] cwj: so i am kind of confused
[2013-03-26 19:11:37 -0400] benkay: what I ultimately did was to run knife bootstrap node -r role[therole]
[2013-03-26 19:11:47 -0400] benkay: and that seems to have worked.
[2013-03-26 19:12:06 -0400] threesome: I can't seem to install a package on a Vagrant instance from my recipe. The output freezes at "INFO: Processing package[build-essential] action install" and when I run the 'top' command from within the Vagrant instance it doesn't seem to be doing anything related to installing a package. How can I troubleshoot this?
[2013-03-26 19:12:42 -0400] benkay: the follow on question that I have is, once my node is up and provisioned, when I change the run list associated with the role I've assigned that node, what's the recommended way to update that node's provisioning?
[2013-03-26 19:12:43 -0400] jensnorr: Is it possible to have a conditional in a role to vary the run list depending on the environment?
[2013-03-26 19:12:48 -0400] cwj: threesome: in your vagrantfile you can set the chef provisioner log level to debug
[2013-03-26 19:13:50 -0400] cwj: benkay: some people have chef run as a daemon which kicks off chef runs on an interval, some people use knife ssh queries to initiate chef-client runs
[2013-03-26 19:14:00 -0400] lazyPower: You know, I really dont understand where the ruby style node configuration should be placed thaty ou often see in github code samples for chef recipe's -- I've been translating them by hand to json for the run list attributes.... is there a better way?
[2013-03-26 19:14:05 -0400] cwj: benkay: some people use some other orchestration tool etc
[2013-03-26 19:14:20 -0400] benkay: thanks cwj. i think i get it.
[2013-03-26 19:15:02 -0400] cwj: jensnorr: thats what env_run_lists are for in roles http://docs.opscode.com/essentials_roles_formats.html
[2013-03-26 19:15:34 -0400] jensnorr: cwj: Ohh. Haven't seen that before! Very nice! Thank you
[2013-03-26 19:16:14 -0400] cwj: lazyPower: can you gist/pastebin an example of what you are talking about?
[2013-03-26 19:16:36 -0400] lazyPower: Certainly - one moment
[2013-03-26 19:18:23 -0400] lazyPower: https://gist.github.com/chuckbutler/5248311
[2013-03-26 19:18:45 -0400] dillyjay: so opscode doesn't have any AMIs with chef 11 and/or ubuntu newer than 10?
[2013-03-26 19:19:33 -0400] dillyjay: or any 64bit boxes?
[2013-03-26 19:20:14 -0400] cwj: lazyPower: so you're asking if there is an easier way to create the node json?
[2013-03-26 19:20:17 -0400] lazyPower: I can attest that Chef-OpenSource runs fine on a Ubuntu 12.04 server 64 bit instance.  It may not be utilizing all of the resources but its my preferred server stack.
[2013-03-26 19:20:49 -0400] lazyPower: cwj: Pretty much - like the ruby example i followed - i see this everywhere. And I cant help but feel like i'm missing the obvious shortcut to write your node config in ruby instead of hand-coding the json.
[2013-03-26 19:21:00 -0400] threesome: cwj, actually 'vagrant provision' wasn't doing anything for me, I have to run it manually as chef-client. When I do 'VAGRANT_LOG=debug vagrant provision' I get lots of output but no sign of error (at least as far as my newbie eyes can see). The output ends with: GuestAdditionsFacility_VirtualBox Base Driver=50,1364325488476
[2013-03-26 19:21:00 -0400] threesome: GuestAdditionsFacility_VirtualBox System Service=50,1364325489323
[2013-03-26 19:21:01 -0400] threesome: GuestAdditionsFacility_Seamless Mode=0,1364325488476
[2013-03-26 19:21:01 -0400] threesome: GuestAdditionsFacility_Graphics Mode=0,1364325488476
[2013-03-26 19:21:01 -0400] threesome: DEBUG subprocess: Waiting for process to exit. Remaining to timeout: 32000
[2013-03-26 19:21:05 -0400] threesome: DEBUG subprocess: Exit status: 0
[2013-03-26 19:21:07 -0400] threesome:  INFO warden: Calling action: #<Vagrant::Action::Builtin::Provision:0x00000002a95040>
[2013-03-26 19:21:09 -0400] threesome:  INFO environment: Running hook: environment_unload
[2013-03-26 19:21:11 -0400] threesome:  INFO runner: Running action: #<Vagrant::Action::Builder:0x0000000277d380>
[2013-03-26 19:21:12 -0400] dillyjay: lazyPower: i don't even want chef open source, i'm just trying to learn with chef-solo. but i was hoping to avoid having to do any shell script provisioning, and ubuntu 12.04 is a must bc of LTS
[2013-03-26 19:21:18 -0400] threesome: 'vagrant provision' returns immediately, without output
[2013-03-26 19:21:47 -0400] lazyPower: dillyjay: You can use Chef-Solo on a ubuntu 12.04 instance - it wont be preloaded, but its a pretty simple process to get it bootstrapped.
[2013-03-26 19:22:11 -0400] dillyjay: but it does require provisioning the vagrant box with a shell script?
[2013-03-26 19:22:12 -0400] cwj: lazyPower: you can write roles in ruby, they are turned into json when uploaded to the server via knife. i think generally its best to avoid writing node json
[2013-03-26 19:22:22 -0400] lazyPower: let me verify i dont have any sensitive information in my bootstrap script and i'll send it your way -- we use it to isntall chef-client on workstations here in the office. Its only af ew mods away from bootstrapping you with chef-solo.
[2013-03-26 19:22:37 -0400] dillyjay: that would be awesome
[2013-03-26 19:22:41 -0400] cwj: threesome: then use -l debug when running chef manually. if vagrant provision does nothing then you probably dont have a valid provisioner config in your vagrantfile
[2013-03-26 19:22:59 -0400] geewiz: Hi! I've got a problem that I can't create a node after having to restore last night's couchdb.
[2013-03-26 19:22:59 -0400] lazyPower: cwj: I agree - I'll keep looking into roles and make sure i'm not skipping a major step to provisioning that would save me some headache.
[2013-03-26 19:23:58 -0400] geewiz: I had a corrupted chef.couchdb and had to restore last night's backup. After re-uploading today's changes, everything seems to work fine.
[2013-03-26 19:24:09 -0400] geewiz: Only a node that I created over the day can't be recreated.
[2013-03-26 19:24:30 -0400] geewiz: Is there something outside CouchDB that could prevent the node from being created?
[2013-03-26 19:26:07 -0400] threesome: cwj, you were right, I hadn't defined a provisioner. I thought that Vagrant would take what I've added to 'knife node run_list add mynode myrecipe'? Do I need to repeat my runlists in 2 places?
[2013-03-26 19:29:38 -0400] lazyPower: dillyjay: I cant send over our internal script but there is a github project that looks like it was created for what you're doing
[2013-03-26 19:29:40 -0400] lazyPower: https://github.com/conormullen/chef-bootstrap
[2013-03-26 19:30:03 -0400] chip-: check the knife-solo gem
[2013-03-26 19:34:39 -0400] xtristan: Big question, but can someone review my cookbook and let me know if I'm following best practices on the recipe?
[2013-03-26 19:35:16 -0400] xtristan: specifically: https://github.com/tristanfisher/charybdis/blob/master/recipes/default.rb
[2013-03-26 19:35:48 -0400] teukka: dillyjay: you can also just take an official ubuntu ami, install the wanted chef version and create your own ami from it. installing from the omnibus package is a one-liner
[2013-03-26 19:36:33 -0400] geewiz: xtristan: Have you already tried the foodcritic gem?
[2013-03-26 19:36:45 -0400] leifmadsen: foodcritic ftw
[2013-03-26 19:37:31 -0400] xtristan: geewiz: I haven't, but I have it working - tested many times with different role combinations
[2013-03-26 19:37:38 -0400] xtristan: Will do foodcritic this weekend
[2013-03-26 19:38:10 -0400] gleam: instead of passing all of those sub-ircd attributes individually to the template, why not just pass :ircd => node[:charybdis][:conf][:ircd] and then do ircd[:whatever] in your template?
[2013-03-26 19:39:21 -0400] xtristan: @gleam : i thought about that, but i went this way because i think it makes it more explicit
[2013-03-26 19:39:27 -0400] dillyjay: teukka: doesn't it cost money to store an ami?
[2013-03-26 19:39:45 -0400] lazyPower: yeah, standard S3 storage costs
[2013-03-26 19:39:47 -0400] lazyPower: 10 cents / gb
[2013-03-26 19:40:43 -0400] xtristan: i might stub it out to node[:charybdis][:conf] = conf though
[2013-03-26 19:40:50 -0400] xtristan: or attr
[2013-03-26 19:41:48 -0400] dillyjay: lazyPower: thanks very much for the bootstrap, it looks like it will get me started.
[2013-03-26 19:43:12 -0400] teukka: dillyjay: that bootstrap seems to use gem installation. I would also recommend knife-solo as chip- already did. disclaimer: I'm biased on this topic :)
[2013-03-26 19:51:26 -0400] bluekelp: yfeldblum: found a bug in librarian-chef - how/where do you want it detailed?
[2013-03-26 19:51:42 -0400] bluekelp: awesome tool still.  thx :)
[2013-03-26 19:52:13 -0400] yfeldblum: bluekelp, github
[2013-03-26 19:53:08 -0400] bluekelp: do you want it in librarian or librarian-chef? technically this is librarian b/c -chef wasn't gem-able
[2013-03-26 19:53:23 -0400] yfeldblum: bluekelp, what do you mean by "gem-able"?
[2013-03-26 19:54:03 -0400] bluekelp: i wasn't able to get librarian-chef via gem install b/c it wasn't split off yet
[2013-03-26 19:54:15 -0400] wdilly: can I add a role to a client from the chef-client command ie "chef-client --role webserver" or something to that affect? Thanks!
[2013-03-26 19:54:20 -0400] yfeldblum: bluekelp, `gem install librarian-chef --pre` ?
[2013-03-26 19:55:04 -0400] bluekelp: per the readme. you said to use librarian.  k i'll uninstall and try that
[2013-03-26 19:55:28 -0400] bluekelp: err - i tried the readme, but you (?) said to just use librarian
[2013-03-26 19:55:39 -0400] stompyj: whats the preferred way of keeping cookbooks up to date?
[2013-03-26 19:55:52 -0400] bluekelp: wdilly: knife node run_list add <node-name> 'role[foo]'
[2013-03-26 19:56:21 -0400] bluekelp: stompyj: try librarian. i've been quite happy with it
[2013-03-26 19:56:45 -0400] yfeldblum: bluekelp, ah i see what you mean
[2013-03-26 19:56:54 -0400] stompyj: cool, so the idea is just to git clone the cookbooks, then update them as necessary
[2013-03-26 19:57:04 -0400] stompyj: and rely on git to not overwrite any of our custom changes?
[2013-03-26 19:57:04 -0400] yfeldblum: bluekelp, you're using the latest released version of librarian, right?
[2013-03-26 19:57:16 -0400] wdilly: thanks bluekelp, im aware of how to do it via knife, but i want to do it with the chef-client itself
[2013-03-26 19:57:26 -0400] bluekelp: stompyj: no, you don't need to do that.  librarian *can* pull from github but it can also get from the opscode repo
[2013-03-26 19:57:28 -0400] denken_: in chef 11, chef-server-ctl stop doesnt appear to kill all the logging processes... is that normal?
[2013-03-26 19:57:48 -0400] stompyj: bluekelp: aha.  got it. then how do you deal with your local changes after you update?
[2013-03-26 19:57:48 -0400] bluekelp: wdilly: sry, didn't understand. i don't know how to do it on the node itself other than knife
[2013-03-26 19:57:49 -0400] denken_: runsvdir and its child processes are never killed
[2013-03-26 19:58:30 -0400] bluekelp: stompyj: if you do have local changes then yes, i fork.  you can also do "gangnam style cookbooks" (google it) but i haven't
[2013-03-26 19:58:44 -0400] yfeldblum: bluekelp, you can add the issue to the librarian repo
[2013-03-26 19:59:03 -0400] bluekelp: ok. i'll upgrade and verify it's not fixed in the -chef etc
[2013-03-26 19:59:10 -0400] stompyj: bluekelp: haha.  got it.  is opscode's official answer to fork?
[2013-03-26 20:00:03 -0400] bluekelp: stompyj: i don't really know. i've forked three cbs i've needed to tweak and when i have time i'll try and push them back upstream
[2013-03-26 20:00:12 -0400] stompyj: that makes sense
[2013-03-26 20:00:29 -0400] stompyj: its weird cause I can't find their take on how to do it in the docs
[2013-03-26 20:01:57 -0400] drgonzo65: how can i correctly specify a provider for a service name in a notifies statement?
[2013-03-26 20:08:15 -0400] yfeldblum: drgonzo65, each resource gets only one provider
[2013-03-26 20:08:55 -0400] drgonzo65: what if i have two service resources, each with a different provider?
[2013-03-26 20:09:02 -0400] yfeldblum: drgonzo65, that's set at the time the resource is declared
[2013-03-26 20:09:07 -0400] drgonzo65: do i have to make sure they are named different?
[2013-03-26 20:09:11 -0400] drgonzo65: *differently
[2013-03-26 20:20:03 -0400] bluekelp: yfeldblum: issue 140
[2013-03-26 20:25:04 -0400] yfeldblum: bluekelp, sorry!
[2013-03-26 20:25:36 -0400] geewiz: Anyone have any idea what could keep me from creating a client name that actually isn't in the database?
[2013-03-26 20:26:18 -0400] knuckolls: anyone know how i can determine whether or not i'm within vagrant from within a recipe
[2013-03-26 20:27:14 -0400] bluekelp: yfeldblum: no worries.  took me a lot of head scratching to figure it out.  i thought git was to blame which scared me. but then i noticed the branch switch and it started to fall into place.  am glad i was able to repro down to a simple (late night, tired) mistake so hopefully easy to fix. would dive in and try to help but am swamped and unable to even manage to try pull requests on my forked cbs, atm
[2013-03-26 20:27:20 -0400] knuckolls: aws has the cloud => provider attribute
[2013-03-26 20:27:44 -0400] bluekelp: geewiz: any weird chars in the name?  what error do you get when you try bootstrapping?
[2013-03-26 20:29:01 -0400] geewiz: bluekelp: I bootstrapped the node earlier today. But then, my CouchDB got corrupted and I had to restore last night's backup of chef.couchdb.
[2013-03-26 20:29:44 -0400] geewiz: bluekelp: Now I can't recreate the client and node. It's not in the database (it didn't exist last night, after all). "knife client list" doesn't display it either.
[2013-03-26 20:30:12 -0400] geewiz: bluekelp: But when I try to reregister or "knife client create", I get the error message that the client already exists.
[2013-03-26 20:30:20 -0400] bluekelp: geewiz: is the client key mismatched?  if you delete /etc/chef/client.pem on node and try re-bootstrapping?
[2013-03-26 20:30:40 -0400] bluekelp: i don't know much of the innards but that's "crazy enough it might just work"
[2013-03-26 20:31:39 -0400] geewiz: bluekelp: That normally works for a lost client key. But there's no client of that name in the database at all, so there should not be a conflict.
[2013-03-26 20:33:06 -0400] geewiz: bluekelp: I already deleted the client.pem but I can't reregister because "the client already exists". Something's severely inconsistent here.
[2013-03-26 20:33:07 -0400] jrclouda: Hey all, what's the best way to handle mysql master/slave failover via chef standpoint?
[2013-03-26 20:33:14 -0400] jrclouda: any good reads that I can look at?
[2013-03-26 20:34:06 -0400] bluekelp: geewiz: just b/c couch crashed maybe other components like search/indexing aren't and that's there the conflict is
[2013-03-26 20:34:29 -0400] bluekelp: iirc "knife index rebuild" might being the two back in sync
[2013-03-26 20:35:08 -0400] jedsmith: miah: --fork seemed to introduce random chef-client failures, bummer
[2013-03-26 20:35:26 -0400] geewiz: bluekelp: I will probably try that.
[2013-03-26 20:35:28 -0400] jedsmith: [2013-03-26T20:06:24+00:00] FATAL: SIGTERM received, stopping   (x7), then silence, no chef-client running
[2013-03-26 20:35:31 -0400] jedsmith: thank you for the tip, though
[2013-03-26 20:35:51 -0400] geewiz: bluekelp: I should prevent my clients from connecting while the reindex is running, shouldn't it?
[2013-03-26 20:35:51 -0400] jedsmith: wasn't OOM killed
[2013-03-26 20:36:24 -0400] Kzim: hello anyone know why i have this : NameError: Cannot find a resource for shell_out!  please
[2013-03-26 20:36:46 -0400] jedsmith: miah: actually, I take that back, --fork made chef-client fork bomb the system, and another administrator killed it while I was out
[2013-03-26 20:36:54 -0400] jedsmith: is that behavior you've observed?
[2013-03-26 20:36:57 -0400] miah: nope
[2013-03-26 20:37:07 -0400] jrclouda: Or is this just not a good idea to handle with chef
[2013-03-26 20:38:09 -0400] miah: jrclouda: its a tough subject. many people do db replication slightly differently. i dont think anybody has been brave enough to do it =)
[2013-03-26 20:38:40 -0400] jrclouda: ah ha! Well thanks for the validation because I have searched like a mad man and I'm trying to roll it now It's a bit on the tough side
[2013-03-26 20:38:42 -0400] jrclouda: I'll keep chugging!
[2013-03-26 20:38:43 -0400] jrclouda: Thanks!
[2013-03-26 20:38:50 -0400] jedsmith: miah: https://gist.github.com/jedsmith/2cd570ea8a3b57348b82
[2013-03-26 20:39:01 -0400] geekbri: jedsmith: i had the same problem
[2013-03-26 20:39:09 -0400] jedsmith: so, looks like we're swimming toward bug report territory
[2013-03-26 20:39:47 -0400] Kzim: anyone know how install mixlib-shellout ? :(
[2013-03-26 20:39:51 -0400] Kzim: i don"t see any doc
[2013-03-26 20:40:21 -0400] geekbri: Kzim: it should be a dependency when you install chef
[2013-03-26 20:40:38 -0400] geekbri: the old chef shellout was just a thin wrapper around it if i remember correctly
[2013-03-26 20:41:06 -0400] jmickle: Does anyone know of the path parameter in template is deprecated?
[2013-03-26 20:41:51 -0400] jmickle: I'm having a weird problem were if i do template "x.conf" with path "/" in the block it doesn't process at all but if i do template "/x.conf" it works
[2013-03-26 20:43:23 -0400] marlonb: Hello everyone.
[2013-03-26 20:44:13 -0400] marlonb: does anyone know of a way to set the environment you want a node to be in on instantiation?
[2013-03-26 20:44:26 -0400] jedsmith: -E <env> if you're using knife bootstrap
[2013-03-26 20:45:13 -0400] marlonb: thank you
[2013-03-26 20:45:29 -0400] marlonb: sorry I'm so used to using knife with plugins like aws/rackspace etc..
[2013-03-26 20:45:39 -0400] marlonb: my use with bootstrap is limited, but at least I have an idea of where to look
[2013-03-26 20:45:50 -0400] marlonb: well bootstrap directly
[2013-03-26 20:46:16 -0400] behemphi: I am missing something here and would appreciate any help:  In my atribute file I have node['bam']  = 'plain stuff', then I have recipe foo & recipe bar that run in that order.  IN recipe foo I say node.set['bam'] = 'cool stuff' .  I expect the value of node.bam to now be 'cool stuff' in the bar recipe, but it is still the default value 'plain stuff' from the attribute file.
[2013-03-26 20:47:06 -0400] gaffneyc: Using vagrant I have a cookbook installing ruby into /usr/bin (think it's using omnibus in /opt/ruby/bin). The first run installs all calls to gem_package into the version of ruby in /opt/ruby/bin instead of /usr/bin. Any suggestions for how to get around this?
[2013-03-26 20:47:08 -0400] behemphi: What is wrong in my expectation that node.bam is now  set to the new value for the rest of the chef run (and certainly within the same cookbook)
[2013-03-26 20:47:16 -0400] j^2: i'm having trouble with the nagios cookbook, whenever i add a new node, it doesnt show up in the UI. I can n gett notifications but he webui doesnt show anythnig, has anyone had an issue like that before?
[2013-03-26 20:47:17 -0400] gaffneyc: I would like to avoid setting gem_binary on every call to gem_package
[2013-03-26 20:48:49 -0400] jessicab: behemphi: if youre setting it inside of a chef block.. that would get executed after any code outside of ruby blocks.. maybe an issue with that?
[2013-03-26 20:49:01 -0400] gleam: gaffneyc: if you look at the chef-rvm cookbook on github, there's a recipe that does a dirty hack
[2013-03-26 20:49:09 -0400] bluekelp: behemphi: is there an error in the recipe run? the node will be reset if so
[2013-03-26 20:49:14 -0400] behemphi: Thanks Jessicab (and hello), but that is not the case
[2013-03-26 20:49:19 -0400] behemphi: it is just inside an if block
[2013-03-26 20:49:35 -0400] gleam: https://github.com/fnichol/chef-rvm/blob/master/recipes/gem_package.rb
[2013-03-26 20:49:36 -0400] gleam: https://github.com/fnichol/chef-rvm/blob/master/libraries/gem_package_monkeypatch.rb
[2013-03-26 20:49:56 -0400] gleam: https://github.com/fnichol/chef-rvm/blob/master/libraries/rvm_rubygems_package.rb
[2013-03-26 20:50:19 -0400] gaffneyc: gleam: Wow that is nasty
[2013-03-26 20:50:25 -0400] blueben: afternoon folks
[2013-03-26 20:50:48 -0400] behemphi: Jessicab I am using log statements to see the value of the node.  It gets set to "cool stuff" in the foo recipe, but when logging it out in the bar recipe it is still "plain stuff"
[2013-03-26 20:51:36 -0400] gaffneyc: gleam: And thanks pointing me in that direction
[2013-03-26 20:52:16 -0400] behemphi: I realise I should have typed "using log statements to see the value of the attribute"
[2013-03-26 20:52:19 -0400] bluekelp: behemphi: you could try "node.save" immediately after setting. also i assume the recipes are ordered with B after A, correctly
[2013-03-26 20:52:53 -0400] leifmadsen: so I thought this was working before, but doing a node.set in a ruby_block seems to not seem to make the attributes available outside the ruby block?  I want to evaluate using ruby some information after another resource has executed (a remote_file), so I used a ruby_block, but then parsing and setting the node attributes seem to not be available to other resources
[2013-03-26 20:52:57 -0400] leifmadsen: am I missing something here?
[2013-03-26 20:53:22 -0400] gaffneyc: Would think you could just get the new gem_binary from doing an ohai reload but not having any luck with that
[2013-03-26 20:53:34 -0400] jessicab: behemphi: weird.. i do something pretty similar and ive never seen that behavior, perhaps if you use include_recipe to force bar to run after it might fix something? sometimes chef loads in an unpredictable order.. pretty sure i saw that on the fix list for chef 11
[2013-03-26 20:54:37 -0400] behemphi: There is a global recipe default.rb where both that specs the order.  the truth is when the foo recipe is done and it moves back to default.rb, the value of the attr is 'plain stuff'
[2013-03-26 20:55:47 -0400] behemphi: Jessicab, this is the first time I have ever used node.save and it gives me a 403 Forbidden
[2013-03-26 20:55:54 -0400] behemphi: (really werid right?)
[2013-03-26 20:56:25 -0400] threesome: Hi, what's the syntax for specify node attributes in a recipe?
[2013-03-26 20:56:34 -0400] jessicab: i kind of avoid doing node.saves, but thats really weird its giving you a 403.. it should do a node save on its own at the end of a run
[2013-03-26 20:56:36 -0400] threesome: node.attribute(..... doesn't seem to work
[2013-03-26 20:56:48 -0400] threesome: Sorry I mean "node.default(........
[2013-03-26 20:57:09 -0400] behemphi: @threesome  node.set['foo']['bar']
[2013-03-26 20:57:28 -0400] behemphi: I am pretty sure that would be "normal" precedence
[2013-03-26 20:58:11 -0400] threesome: behemphi, thanks, would you happen to know the syntax for specifying the other levels of precedence at http://docs.opscode.com/essentials_cookbook_recipes_attribute_precedence.html?
[2013-03-26 20:58:18 -0400] threesome: As it relates to recipes
[2013-03-26 20:58:33 -0400] behemphi: I would like to know that myself
[2013-03-26 20:58:45 -0400] behemphi: glad to know the docs stumped me too!
[2013-03-26 20:59:39 -0400] behemphi: @jessicab, I moved the include_recipe statement for the foo recipe to the stop of the bar recipe to force the order as you suggested and I am getting the same behavior
[2013-03-26 20:59:52 -0400] behemphi: I should say that I am on 10.16 at this point Ithink
[2013-03-26 20:59:56 -0400] wdilly: so for packages if i have it set as action:install will it or wont it update the package if it sees there is a later one available? I suppose it doesnt as their is an action:update ....
[2013-03-26 21:00:36 -0400] jessicab: behemphi: maybe the default recipe is setting the attribute again somehow? you could also try overrides, like node.override['foo']['bar']
[2013-03-26 21:01:06 -0400] behemphi: @threesome see Jessica above
[2013-03-26 21:01:50 -0400] behemphi: I am sure the default.rb is not doing that (it is 4 lines of include_recipe) and I am pretty sure it is not getting subsequently overwritten, but your suggestion should prove that.  so LMC!
[2013-03-26 21:03:57 -0400] charity: hm.  I'm writing an LWRP, and in the providers it populates a template
[2013-03-26 21:04:30 -0400] charity: when i'm calling this LWRP from another cookbook, it looks inside that cookbook's template directory for the template instead of under the LWRP cookbook's template directory
[2013-03-26 21:04:49 -0400] charity: how can i get it to use a template from the original cookbook?
[2013-03-26 21:08:00 -0400] behemphi: Well phooey @jessicab same problem.  I do this sort of thing all the time.  The recipe really is called "find_friends.rb" and looks up other machines in the cluster.  Nothing special.  The nodes are named node.feedmagnet.* so there is no way a community recipe is overwriting them.  But I did apply Occam's razor and put a log statemetn after my loop.  the value is not what I set!  So I suspect some tomfoolery on my part.
[2013-03-26 21:08:10 -0400] gleam: i think you can pass cookbook 'whatever' in the template block
[2013-03-26 21:08:45 -0400] geewiz: bluekelp: I've been able to solve the problem. I had not restored all relevant directories. Seems there are some files referencing the database, after all.
[2013-03-26 21:09:44 -0400] tabolario: is anyone using the opscode chef-client cookbook with some mechanism to add encrypted_data_bag_secret to the client.rb?
[2013-03-26 21:12:03 -0400] alop: question about override_attributes
[2013-03-26 21:12:15 -0400] alop: I have override_attributes in my environment
[2013-03-26 21:12:21 -0400] charity: @gleam thanks!  totally worked
[2013-03-26 21:12:29 -0400] alop: will overriding those in a role take precedence?
[2013-03-26 21:18:52 -0400] benkay: how would I run chef-client on all of my nodes at the same time?
[2013-03-26 21:19:51 -0400] jrclouda: dsh
[2013-03-26 21:23:17 -0400] rava: is there anyway to have the link lwrp force create the link?
[2013-03-26 21:23:57 -0400] awgross: benkay: if you just want it happening at a specific time, you can have cron run it, else you will need something like dsh, rundeck etc
[2013-03-26 21:24:12 -0400] benkay: thanks.
[2013-03-26 21:25:12 -0400] awgross: benkay: careful if running across a lot of nodes (50+) simultaneously, possible to overload your chef server. http://engineering.voxer.com/post/45944103472/chef-part-2-performance
[2013-03-26 21:28:26 -0400] Majost1: I have an template/erb which is an xml file -- and chef/ruby is complaining about some of the xml tags... eg:
[2013-03-26 21:28:36 -0400] Majost1: templates/default/config.xml.erb:1: syntax error, unexpected '<' <?xml version="1.0" encoding="UTF-8"?>
[2013-03-26 21:29:11 -0400] Majost1: is there any way to escape this from the erb point of view?
[2013-03-26 21:30:43 -0400] bluekelp: benkay: you can also "knife ssh 'name:*' 'chef-client'"
[2013-03-26 21:31:11 -0400] benkay: that sounds like a clever
[2013-03-26 21:31:18 -0400] awgross: Majost1: it can be tricky to use ERB with certain filetypes due to parsing, may be better to generate the XML from scratch in ruby
[2013-03-26 21:31:41 -0400] bluekelp: i just set them up with the chef-client recipe and let them randomly converge
[2013-03-26 21:31:45 -0400] awgross: Majost1: I am not aware of a way to get it to play nice with those files, though something may exist
[2013-03-26 21:31:56 -0400] Majost1: the weird part about this, it that it was working fine for the past few days
[2013-03-26 21:34:13 -0400] Majost1: oh weird
[2013-03-26 21:34:21 -0400] Majost1: there was a syntax error at the bottom of the file
[2013-03-26 21:40:16 -0400] behemphi: OK @jessicab I have been hacking (and swearing and considering taking up smoking) and came up with this:
[2013-03-26 21:40:17 -0400] behemphi: https://gist.github.com/behemphi/5249555
[2013-03-26 21:40:52 -0400] behemphi: I _think_ this might be a bug in the way chef deals with ruby blocks, or a lack of understanding of the same on my part
[2013-03-26 21:43:28 -0400] yfeldblum: behemphi, why are you using the log resource, instead of logging directly?
[2013-03-26 21:43:49 -0400] zts: behemphi: I suspect it's that "node" refers to different objects on those two lines
[2013-03-26 21:44:00 -0400] Chris_Woods: What is the proper syntax for 'knife data bag from file'?  http://docs.opscode.com/knife_data_bag.html indicated it's
[2013-03-26 21:44:01 -0400] Chris_Woods: knife data bag from file "path to JSON file"
[2013-03-26 21:44:17 -0400] Chris_Woods: but when I try that, I just get the help message from knife.  It doesn't actually parse the file or upload a data bag.
[2013-03-26 21:44:49 -0400] spheromak: Chris_Woods: knife data bag from file BAG file
[2013-03-26 21:45:03 -0400] spheromak: gotta tell it what bag the item goes in
[2013-03-26 21:45:13 -0400] spheromak: file can be a directory, but the bag has to exist
[2013-03-26 21:45:14 -0400] behemphi: @yfelblum thx for looking.  I am using the log resource so that it prints in the output at execution time in the expected order.
[2013-03-26 21:45:37 -0400] behemphi: before asking I thought I might be missing something about compile vs exec time
[2013-03-26 21:45:49 -0400] Chris_Woods: spheromak, Ahh, gotcha.  Thanks.  I see that in the -h, but it wasn't super clear.
[2013-03-26 21:45:50 -0400] zts: behemphi: try using something other than 'node' as your loop variable on line 12
[2013-03-26 21:46:10 -0400] gmiranda23: anyone here familiar with diving deep into chef-solr and search indexes?  i have a bizarre issue where my node index is unsearchable (but other indexes work).  rebuilding the index doesn't seem to work either.  this is for open source server.
[2013-03-26 21:46:12 -0400] Chris_Woods: spheromak, do you mean I have to create an empty databag on the server before I can from file contents to it?
[2013-03-26 21:46:19 -0400] spheromak: Chris_Woods: yes
[2013-03-26 21:46:31 -0400] Chris_Woods: spheromak: Will do; thanks!
[2013-03-26 21:46:33 -0400] behemphi: arg  seriously man!  I cannot believe I did not see that!
[2013-03-26 21:46:45 -0400] behemphi: @yfeldblum you gonna be at chef conf?
[2013-03-26 21:46:58 -0400] behemphi: I believe there is an adult beverage owed to you
[2013-03-26 21:47:29 -0400] yfeldblum: behemphi, i won't be, alas
[2013-03-26 21:47:38 -0400] behemphi: well poo
[2013-03-26 21:47:44 -0400] yfeldblum: behemphi, heh yeah
[2013-03-26 21:48:02 -0400] behemphi: you don't live in Austin do you?
[2013-03-26 21:48:31 -0400] patcon: jtimberman: don't suppose you know if anyone is running test-kichen v1.0 using travis and kitchen-ec2, huh?
[2013-03-26 21:49:08 -0400] awgross: is it possible to call methods from Chef library files inside ruby_block resources?
[2013-03-26 21:51:43 -0400] patcon: awgross: this leads me to believe "yes": http://docs.opscode.com/resource_ruby_block.html#examples
[2013-03-26 21:53:17 -0400] awgross: patcon: you can certainly call chef libraries, i guess the namespace should include my own custom library functions if I have sent them to chef
[2013-03-26 21:53:53 -0400] awgross: thanks patcon
[2013-03-26 21:58:30 -0400] awgross: we shall find out shortly if it does
[2013-03-26 21:58:57 -0400] spheromak: they nexr/cloudware
[2013-03-26 21:58:59 -0400] spheromak: mt
[2013-03-26 21:59:50 -0400] awgross: patcon: when I have self.class.send(:include, MyModule::MySubModule) in my library, I can call methods in my ruby blocks
[2013-03-26 22:02:39 -0400] Kzim: no rubygem RPM for mongo lib ? :(
[2013-03-26 22:03:45 -0400] zts: Kzim: if your distro doesn't provide one, consider using fpm - https://github.com/jordansissel/fpm
[2013-03-26 22:04:20 -0400] yfeldblum: behemphi, nah
[2013-03-26 22:04:52 -0400] yfeldblum: Kzim, if you're using chef-full, you can use the mongo gem without any rpm
[2013-03-26 22:06:59 -0400] Kzim: yfeldblum, chef full ?
[2013-03-26 22:07:05 -0400] Kzim: i use the chef11 server rpm
[2013-03-26 22:07:25 -0400] yfeldblum: Kzim, chef-client installed from the installer, rather than as a gem or package
[2013-03-26 22:09:06 -0400] Kzim: i use the chef-client rpm from opscodes
[2013-03-26 22:09:15 -0400] gmiranda23: interesting edge case of the day  if your searches against a node index fail on windows servers, up the character limit on your solr config  http://tickets.opscode.com/browse/CHEF-3351  </psa>  just ran into this and fixed by doing this + a knife index rebuild
[2013-03-26 22:09:44 -0400] gmiranda23: pasted for the sake of that poor soul banging their head on a desk that will eventually search irc logs ;-)
[2013-03-26 22:10:07 -0400] Kzim: yfeldblum, do you know where the rpm put the libs :( ?
[2013-03-26 22:10:27 -0400] yfeldblum: Kzim, i don't know
[2013-03-26 22:11:05 -0400] spheromak: gmiranda23: maxfieldlength has been an issue for a long while. :D
[2013-03-26 22:11:21 -0400] awgross: gmiranda23: you are preventing http://xkcd.com/979/, make others share in your pain
[2013-03-26 22:15:01 -0400] gmiranda23: lol
[2013-03-26 22:17:30 -0400] awgross: has anyone else experimented with using node attributes as defaults for LWRPs, merging in the resource parameters and setting the node attributes after the merge?
[2013-03-26 22:20:48 -0400] spheromak: awgross: i've only done this via recipe code. I.e. set the defaults in the resource, but the recipe itself runs the resource with the node attribs pased in.  IIRC  I couldn't get node attribs into the resource def.
[2013-03-26 22:21:16 -0400] awgross: spheromak: I managed to node attribs in the resource definition, though it took some doing.  I can show you how
[2013-03-26 22:21:17 -0400] spheromak: also seems a bit like shoving too much into your resource. breaking some sepparation that should be there IMO
[2013-03-26 22:21:41 -0400] awgross: spheromak: at the moment I more debating the merits of setting the node attributes based on what is passed in to the LWRP
[2013-03-26 22:21:49 -0400] spheromak: I do that
[2013-03-26 22:21:56 -0400] spheromak: with sysctl if you ask it too
[2013-03-26 22:22:01 -0400] awgross: hmm
[2013-03-26 22:22:08 -0400] spheromak: mainly so you can search against set values
[2013-03-26 22:22:13 -0400] awgross: yeah that was my idea
[2013-03-26 22:22:30 -0400] spheromak: just makesure your using resource name as the key for some namespace in your attribs.
[2013-03-26 22:22:32 -0400] awgross: however, I am creating a LWRP partly so that peopel can create multiple instances on one machine (redis server in this case)
[2013-03-26 22:22:38 -0400] awgross: spheromak: ahh, good idea
[2013-03-26 22:22:50 -0400] miah: redis already has a lwrp :P
[2013-03-26 22:23:00 -0400] miah: https://github.com/miah/chef-redis
[2013-03-26 22:23:01 -0400] spheromak: since yea.. your resource will be called many times  and your unique constraint is on resource name
[2013-03-26 22:23:16 -0400] spheromak: ohai miah
[2013-03-26 22:23:20 -0400] miah: hi
[2013-03-26 22:23:25 -0400] spheromak: indeed there is an lwrp for that..
[2013-03-26 22:23:32 -0400] miah: i'd love to see a lwrp for haproxy
[2013-03-26 22:23:40 -0400] awgross: hehe yeah ive been examining that
[2013-03-26 22:23:45 -0400] miah: or a hwrp for that matter
[2013-03-26 22:23:55 -0400] spheromak: heh
[2013-03-26 22:24:01 -0400] spheromak: "provider" would suffice yea ?
[2013-03-26 22:24:09 -0400] spheromak: hwrp.. lolz
[2013-03-26 22:24:09 -0400] miah: sure iu suppose
[2013-03-26 22:24:18 -0400] miah: well, if one is light weight surely the other is heavy :P
[2013-03-26 22:24:19 -0400] spheromak: had to think about it for a second
[2013-03-26 22:24:35 -0400] spheromak: I prefer the term full figured
[2013-03-26 22:24:40 -0400] spheromak: :P
[2013-03-26 22:24:47 -0400] miah: heh
[2013-03-26 22:24:52 -0400] spheromak: Husky Provider
[2013-03-26 22:24:57 -0400] awgross: miah: my main issue is that I would like to set org wide defaults in the node attributes, but then allow individual instances of redis-server to deviate from that by setting attributes in the LWRP without forcing them to pass in a ton of node information any time they want to call the LWRP
[2013-03-26 22:25:09 -0400] miah: ok
[2013-03-26 22:25:18 -0400] gad0lin: spheromak: I have refactored everything to use ridley and it works like a charm :)
[2013-03-26 22:25:38 -0400] spheromak: gad0lin: nice
[2013-03-26 22:25:50 -0400] spheromak: gad0lin: i use it in some thor tasks here as well
[2013-03-26 22:26:05 -0400] miah: awgross: how is that not possible with the current architecture of the cookbook? my assumption is that people will write a wrapper cookbook anyways that implements their business logic before building the resources provided by the redis cookbook
[2013-03-26 22:26:33 -0400] spheromak: miah: indeed its how things _should_ happen :D
[2013-03-26 22:26:47 -0400] miah: yes
[2013-03-26 22:27:19 -0400] miah: write / use cookbooks like libraries. write recipes ontop of those libraries that implement your required logic
[2013-03-26 22:29:29 -0400] awgross: miah: i agree that I will be wrapping it with a org specific cookbook, certainly the right way to do things.  Atm chef-redis has some defaults set in attribute files, some in resource definitions, and some defaulted inside the provider itself in the load_resource method
[2013-03-26 22:30:00 -0400] tabolario: anyone here used the ebs_raid resource in the opscode aws cookbook?
[2013-03-26 22:32:06 -0400] miah: the attributes included with the chef-redis cookbook are only used if you add the cookbook (and one of its recipes) to your runlist though.
[2013-03-26 22:33:04 -0400] miah: you certainly need to provide defaults to the resource when instantiating it. but they aren't based on 'node' attributes.
[2013-03-26 22:33:20 -0400] awgross: miah: i see
[2013-03-26 22:33:26 -0400] miah: everything is vary overridable
[2013-03-26 22:33:37 -0400] miah: we provide defaults simply in the case of a user not specifying their own options
[2013-03-26 22:33:42 -0400] awgross: og course
[2013-03-26 22:33:54 -0400] miah: but if you write a wrapper cookbook and 'depend' on chef-redis its attributes shouldn't be loaded
[2013-03-26 22:34:06 -0400] miah: or, afaik they wont be. i could be wrong :P
[2013-03-26 22:34:45 -0400] awgross: unsure too, anything that provides a LWRP i try to stick with running some sort of "default" recipe to install dependencies / get attributes
[2013-03-26 22:34:47 -0400] miah: but please certainly file a issue with anything you've found that is causing you issues
[2013-03-26 22:35:04 -0400] awgross: ill have to play with it more
[2013-03-26 22:35:10 -0400] miah: https://github.com/miah/chef-redis/blob/master/recipes/default.rb
[2013-03-26 22:35:11 -0400] miah: :P
[2013-03-26 22:35:24 -0400] awgross: pretty much
[2013-03-26 22:35:29 -0400] miah: the provider installs what it needs
[2013-03-26 22:35:52 -0400] miah: actually. i lie. it doesnt.
[2013-03-26 22:36:04 -0400] miah: installing redis is left up to you (unless you use one of the recipes bundled with the cookbook)
[2013-03-26 22:36:17 -0400] awgross: yeah i saw that, with the _recipes
[2013-03-26 22:36:21 -0400] miah: yup
[2013-03-26 22:36:22 -0400] awgross: i do like that pattern
[2013-03-26 22:36:35 -0400] miah: http://blog.nistu.de/2012/03/04/reusability-in-configuration-management-systems
[2013-03-26 22:36:40 -0400] awgross: yep
[2013-03-26 22:36:41 -0400] miah: is a great article about it
[2013-03-26 22:36:56 -0400] miah: anyways. i need to head home. i can't think at the office today :/
[2013-03-26 22:37:03 -0400] awgross: read that based off your recommendations before
[2013-03-26 22:37:09 -0400] miah: cool
[2013-03-26 22:37:15 -0400] awgross: ok, ill try to compare what chef-redis does to what ive implemented
[2013-03-26 22:37:20 -0400] awgross: see if I cant find some middle ground
[2013-03-26 22:37:29 -0400] awgross:  / properly explain any differences
[2013-03-26 22:37:35 -0400] awgross: thanks miah
[2013-03-26 22:40:01 -0400] jessicab: hm.. so is there some way to set a default lwrp attribute that depends on another lwrp attribute in the resource? i want it so the user can override it too.. i thought i could do that in the provider with a new_resource.params['attribute'] or something but it doesnt seem to be working for me
[2013-03-26 22:41:20 -0400] awgross: jessicab: you may need to dip your toe into using HWRP for that part
[2013-03-26 22:41:26 -0400] awgross: not super tricky though
[2013-03-26 22:42:02 -0400] jessicab: hm.. ive heard of the term, but i dont think ive seen any docs for hwrps? how are they different?
[2013-03-26 22:42:13 -0400] awgross: jessicab: they are just more pure ruby
[2013-03-26 22:42:20 -0400] awgross: instead of one line, you are defining a method
[2013-03-26 22:42:28 -0400] awgross: they can be interchanged with LWRP though
[2013-03-26 22:42:42 -0400] jessicab: ah, the method as the attribute name?
[2013-03-26 22:42:52 -0400] Kzim: i have require 'mongo' that do not find mongo but i have the lib in /usr/lib/ruby/1.8....
[2013-03-26 22:43:07 -0400] awgross: jessicab: correct
[2013-03-26 22:43:35 -0400] jessicab: awgross: hm.. ill give that a try, i did see some notes about that but i was hoping there was an easier way i guess.. thanks!
[2013-03-26 22:44:03 -0400] Javin: Is there a way to easily tell chef 11 that it's public hostname is different from it's local hostname (i.e. if it is behind a NAT)? I am seeing a few errors during my migration from 10 to 11, that I can skirt around, but they mostly seem to be because the server sees itself as chef.data.example.com, but the rest of the world accesses  it as chef.example.com
[2013-03-26 22:48:37 -0400] spheromak: Javin theres a few options that controll this https://gist.github.com/spheromak/5017833
[2013-03-26 22:49:29 -0400] Javin: spheromak: Thanks. That should get me in the right direction
[2013-03-26 22:53:07 -0400] threesome: How can I delete a cookbook from the cache on a node?
[2013-03-26 22:54:42 -0400] Kzim: anyone know why require mongo work on a script and not on chef ?
[2013-03-26 22:56:47 -0400] Javin: Kzim: If you are using the embedded ruby that comes with the chef omnibus installer then you need to make sure and install the gem in that ruby instance. (i.e. /opt/chef/embedded/bin/gem install mongo )
[2013-03-26 22:57:04 -0400] jrclouda: I'm having that same issue.
[2013-03-26 22:57:13 -0400] jrclouda: Javin:  just run an execute statement?
[2013-03-26 22:57:18 -0400] denken: so a clients knife.rb absolutlely must use a chef_server_url that matches the hostname of the chef server?
[2013-03-26 22:57:23 -0400] jrclouda: and give the full path to gem in that case?
[2013-03-26 22:57:37 -0400] denken: because DRBD requires each host have a unique name... which makes seamless failover (to the client), well, impossible.
[2013-03-26 22:57:47 -0400] Kzim: Javin, damnit so all the RPM an't compatible with chef ?
[2013-03-26 22:58:20 -0400] Javin: Kzim: Well, yes and no, but basically yes.
[2013-03-26 22:58:45 -0400] Javin: The chef omnibus installed installs a completely separate stack to ensure stability, etc.
[2013-03-26 22:59:12 -0400] Javin: This ensures you are using a compatible version of Ruby, amoung many other things
[2013-03-26 22:59:25 -0400] Kzim: Javin, so in an environment without internet and gem mirror how get the mongo lib ? :(
[2013-03-26 22:59:27 -0400] awgross: Kzim: you can install mongo with "chef_gem" instead of "gem_package"
[2013-03-26 22:59:30 -0400] Javin: It also ensure that installing one of those RPMs, doesn't break your whole config management system
[2013-03-26 22:59:35 -0400] awgross: Kzim: then you can use it
[2013-03-26 23:00:22 -0400] Javin: Kzim: You'd need to download the gem binary file and get it onto that system along with the chef-client, and then install it
[2013-03-26 23:00:23 -0400] Kzim: awgross, i don't have internet access or gem mirror. even if i have one does chef_gem allow us to specify a mirror ?
[2013-03-26 23:01:06 -0400] jrclouda: Javin:
[2013-03-26 23:01:36 -0400] jrclouda: I'm having the same issue , I use chef_gem to install mysql gem and it fails w/ compile errors When i run it from the CLI it works fine...
[2013-03-26 23:01:43 -0400] jrclouda: in ./opt/.
[2013-03-26 23:01:46 -0400] jrclouda: ever seen that?
[2013-03-26 23:02:45 -0400] Javin: jrclouda: No, can't say that I have. I install ruby-ldap and ruby-mysql from the cli in my environment, before chef-client gets run for the first time.
[2013-03-26 23:02:59 -0400] awgross: Kzim: probably?, it is mostly a wrapper around gem_package, check out the chef code to be sure
[2013-03-26 23:03:43 -0400] jrclouda: Ah I see
[2013-03-26 23:03:46 -0400] jrclouda: This is madness
[2013-03-26 23:03:47 -0400] Javin: Kzim: I believe that chem_gem support everything gem_package does except for the ability to point to another gem executable, as that would defeat the purpose
[2013-03-26 23:05:16 -0400] Javin: jrclouda: It it simply part of my process for bootstrapping a new system or VM. I use the ldap gem in chef libraries, so I need it loaded right away basically
[2013-03-26 23:06:23 -0400] jrclouda: Ah I see
[2013-03-26 23:06:33 -0400] jrclouda: Is there no way to do that in the cookbook itself?
[2013-03-26 23:08:07 -0400] Javin: chef_gem should work. Not sure why you are seeing compile issues. If it works from the cli and not the chef-run it is most likely some environment issue. I'd run "chef-client -l debug" to see what is happening in detail, and compare it to what you are doing on the cli.
[2013-03-26 23:08:21 -0400] jrclouda: kk i'll dig on it
[2013-03-26 23:08:27 -0400] jrclouda: Thanks for the info though, much appreciated
[2013-03-26 23:08:51 -0400] Javin: jrclouda: glad to help. Hopefully, it gets you somewhere useful
[2013-03-26 23:12:18 -0400] Kzim: Javin, can i set an attribute for a rubygem server ? i only see that as an option
[2013-03-26 23:15:42 -0400] Javin: Kzim: I don't think you can by default. You should be able to create one for your use case however, that you could use in your recipes
[2013-03-26 23:16:11 -0400] Javin: Set an attribute in your base role, and then use that in the recipes
[2013-03-26 23:17:19 -0400] Kzim: Javin, i'll have to remind everyone in the company to specify the option :( but ok
[2013-03-26 23:19:39 -0400] Javin: Kzim: You can create your own lightweight resource (internal_chef_gem or whatever) that specifies that option and then just tell people to use that resource instead of the standard chef_gem one.
[2013-03-26 23:20:11 -0400] Javin: http://docs.opscode.com/lwrp.html
[2013-03-26 23:21:16 -0400] Kzim: hum yes thank you !
[2013-03-26 23:22:16 -0400] Javin: np
[2013-03-26 23:23:45 -0400] jclark_: Hey Guys - we're looking a completely automating our QA Lab.  We have Jenkins as our CI now, and an ESXi license, but really have no idea how this whole picture works   Any advice would be greatly appreciated.
[2013-03-26 23:31:43 -0400] drgonzo65: is there any way to log the output of a command before and after a resource block is run?
[2013-03-26 23:32:06 -0400] blueben: jclark_: well, what do you need?
[2013-03-26 23:33:35 -0400] jclark_: We're a windows shop, so I was able to fire up a windows box with vagrant/virtual box, but apparently our QA team hates virtual box
[2013-03-26 23:34:05 -0400] jclark_: so I'm not sure how to actually automatically get a chef client on a clean windows box.
[2013-03-26 23:34:19 -0400] jclark_: i see there is a knife esxi plugin, but haven't had a chance to play with it
[2013-03-26 23:34:47 -0400] ranjibd: jclark_: winrm based bootstrap?
[2013-03-26 23:34:58 -0400] Kzim: Javin, i don't see the doc on chef_gem :(
[2013-03-26 23:36:28 -0400] jclark_: i'll look into winrm and jump back on when I have more specfic questions - thank you!
[2013-03-26 23:41:46 -0400] spheromak: yea
[2013-03-26 23:44:29 -0400] miah: herp
[2013-03-26 23:44:36 -0400] Axsuul: Any of you guys littlechef? Do the nodes always depend on your ssh_config?
[2013-03-26 23:44:51 -0400] spheromak: miah: yea i have a real probvlem with typing in the wrong window
[2013-03-26 23:44:56 -0400] flaccid: maybe littlechef has a chat chan
[2013-03-26 23:45:18 -0400] flaccid: part of the thing why i don't like littlechef is ssh requirement and chef solo works fine
[2013-03-26 23:45:24 -0400] miah: =)
[2013-03-26 23:45:50 -0400] miah: chef server works fine too
[2013-03-26 23:46:25 -0400] blueben: hmm. littlechef looks interesting for the radio network I'm building
[2013-03-26 23:47:07 -0400] flaccid: you could just use fabric and chef solo native
[2013-03-26 23:47:17 -0400] flaccid: with berkshelf or librarian and avoid the forkign
[2013-03-26 23:50:06 -0400] Axsuul: What do you guys think about knife-solo then?
[2013-03-26 23:51:43 -0400] flaccid: i have not used it yet, but it sounds nice
[2013-03-26 23:52:18 -0400] mikeg: we have an lwrp we wrote that grabs files from our various repos.  When I try to use notifications with it the notification is happening before the file finishes downloading.  I believe it's due to this line:  new_resource.updated_by_last_action(true)
[2013-03-26 23:52:39 -0400] mikeg: does anyone have experience with this.  is that the line that triggers the notifications?
[2013-03-26 23:53:00 -0400] mikeg: and if so do you have any tips about making sure it doesn't get triggered until previous actions are complete?
[2013-03-26 23:54:33 -0400] GreatSUN: re
