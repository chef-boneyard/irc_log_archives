[2013-07-07 00:16:01 -0400] nate`: Good evening.
[2013-07-07 00:16:44 -0400] nate`: Random question, something I haven't been able to find through the documentation.  I have to do a chef-solo thing for an interview.  I'm used to having databags and being able to encrypt passwords.  How does one do this with chef-solo?
[2013-07-07 00:17:49 -0400] gchristensen: nate`: encrypted databags are usually so you don't have to trust the server, not so you can avoid trusting the VCS
[2013-07-07 00:20:54 -0400] nate`: alright, off to figure that out.  I really was hoping that wasn't the only option as I really don't enjoy the implementation of that.
[2013-07-07 00:20:57 -0400] nate`: Thanks a ton.
[2013-07-07 00:21:57 -0400] stormerider: gchristensen: i thought it was the exact opposite
[2013-07-07 00:23:28 -0400] stormerider: gchristensen: btw, i revamped that nagios code the other day, still playing with it a bit but feel free to poke at it... https://github.com/stormerider/nagios/tree/3262-test
[2013-07-07 00:28:26 -0400] coderanger: stormerider: 99% of the use case is so that you can store passwords in Hosted Chef without worrying about data disclosure from our side
[2013-07-07 00:29:27 -0400] stormerider: coderanger: but being able to commit the encrypted json into an SCM is possible and would avoid the "passwords in plaintext in git" issue, correct?
[2013-07-07 00:30:24 -0400] coderanger: But then either 1) you commit the decryption key into git and no point or 2) you are managing the keys externally from chef and you might as well manage the passwords that way too
[2013-07-07 00:31:43 -0400] coderanger: Encrypted data bags just move the trust problem off the chef server, it doesn't actually solve anything
[2013-07-07 00:34:08 -0400] stormerider: hm. touche, i guess.
[2013-07-07 01:02:48 -0400] dpt89: Hi everyone
[2013-07-07 01:03:02 -0400] dpt89: I'm having problem uploading with berkshelf
[2013-07-07 01:03:17 -0400] dpt89: is someone around familiar with it?
[2013-07-07 01:06:55 -0400] coderanger: Somewhat
[2013-07-07 01:07:04 -0400] coderanger: Asking the actual question would help though
[2013-07-07 01:08:17 -0400] dpt89: I have this error: "Faraday::Error::ConnectionFailed: getaddrinfo: nodename nor servname provided, or not known"
[2013-07-07 01:08:21 -0400] dpt89: it just can't upload
[2013-07-07 01:08:36 -0400] dpt89: it says "Ridley::SandboxUploader crashed!" then the error above.
[2013-07-07 01:09:06 -0400] dpt89: it's happening when trying to upload to a chef-server via https
[2013-07-07 01:09:19 -0400] dpt89: the servers certificate is correct and knife commands work as expected
[2013-07-07 01:10:06 -0400] dpt89: any ideas coderanger?
[2013-07-07 01:10:18 -0400] dpt89: or should I just disable https on the chef server?
[2013-07-07 01:10:21 -0400] coderanger: That error means the hostname it is trying to resolve doesn't exist
[2013-07-07 01:10:24 -0400] coderanger: DNS version of 404
[2013-07-07 01:10:33 -0400] coderanger: Whats your chef_server_url set to?
[2013-07-07 01:12:08 -0400] dpt89: https://infrachef.vlipco.co
[2013-07-07 01:12:17 -0400] dpt89: I have been working with the domain recently
[2013-07-07 01:12:23 -0400] dpt89: but resolving via dig works
[2013-07-07 01:12:47 -0400] coderanger: I would turn on debug logging and see what URL it is trying to upload to
[2013-07-07 01:12:51 -0400] coderanger: might be an FQDN issue somewhere
[2013-07-07 01:13:09 -0400] dpt89: ok, I will go try that
[2013-07-07 01:13:49 -0400] dpt89: one sec, I'll let you know if there's anything new interesting
[2013-07-07 01:14:26 -0400] coderanger: Gut feeling says that when the server hands out the URL to upload to, it is using a bad hostname there
[2013-07-07 01:16:00 -0400] dpt89: I have in chef-server.rb
[2013-07-07 01:16:01 -0400] dpt89: nginx['server_name'] = "infrachef.vlipco.co"
[2013-07-07 01:16:07 -0400] dpt89: does it need the protocol there?
[2013-07-07 01:18:12 -0400] dpt89: good gut coderanger
[2013-07-07 01:18:17 -0400] dpt89: https://ip-10-39-97-54.ec2.internal/bookshelf/.....
[2013-07-07 01:18:28 -0400] dpt89: which of course can't be used outside ec2
[2013-07-07 01:18:45 -0400] coderanger: Check the docs, I don't know off hand, but I'm sure there is an option somewhere
[2013-07-07 01:18:54 -0400] dpt89: ok, checking out
[2013-07-07 01:19:16 -0400] coderanger: Also I will note that running a chef server in EC2 is basically always going to be more expensive than Hosted Chef :)
[2013-07-07 01:21:13 -0400] dpt89: really
[2013-07-07 01:21:14 -0400] dpt89: why?
[2013-07-07 01:21:27 -0400] dpt89: I'm actually doing it because hosted chef seems very expensive for us
[2013-07-07 01:21:40 -0400] dpt89: right now I have 7 tiny micro instances
[2013-07-07 01:22:21 -0400] dpt89: I would have to pay almost 2x what I pay for the instance to manage it on hosted chef. About 6USD per instance while the instance is like 3.60
[2013-07-07 01:22:32 -0400] stormerider: bookshelf['url'] and bookshelf['vip'] are the ones you want, dpt89
[2013-07-07 01:22:50 -0400] dpt89: but I would really like you to tell me if I'm missing important points
[2013-07-07 01:23:04 -0400] dpt89: or if indeed the hosted version is suited for larger services and not my case
[2013-07-07 01:23:21 -0400] dpt89: stormrider thanks, running reconfigure in a sec!
[2013-07-07 01:23:51 -0400] coderanger: dpt89: Running chef-server on anything less than a medium instance is likely to suck
[2013-07-07 01:23:55 -0400] coderanger: Solr loves RAM
[2013-07-07 01:23:57 -0400] stormerider: especially if you're getting micro instances in the free tier, yeah, i doubt it will work out cheaper at the "entry level" HC price
[2013-07-07 01:24:41 -0400] stormerider: but yeah, a micro OHC is going to be laggy.
[2013-07-07 01:24:47 -0400] stormerider: er OSC
[2013-07-07 01:25:09 -0400] dpt89: the server runs on a m1.small
[2013-07-07 01:25:13 -0400] dpt89: the micro instances are the clients
[2013-07-07 01:25:28 -0400] coderanger: Well more likely as soon as you through much load at it, solr will just die as it hits the java heap limit
[2013-07-07 01:25:52 -0400] dpt89: but that'll be seen as a CPU/memory exhaustion, right?
[2013-07-07 01:26:03 -0400] coderanger: Granted chef 11 is going to be worlds better than chef 10, but still pushing it
[2013-07-07 01:26:23 -0400] coderanger: You would see RAM spike and then be free'd as the JVM dies and gets restarted by runit
[2013-07-07 01:27:47 -0400] dpt89: hmmm
[2013-07-07 01:28:19 -0400] dpt89: any stats or approximations on how much it could handle?
[2013-07-07 01:28:31 -0400] dpt89: like, how would I determine when it's not working anymore in that instance size?
[2013-07-07 01:28:34 -0400] coderanger: Also you would need to be using EBS for data persistence, and we all know that EBS is losing the game
[2013-07-07 01:28:46 -0400] coderanger: Um, watch for restart logs from solr?
[2013-07-07 01:29:09 -0400] coderanger: or set nagios to watch service uptime in runit, thats how we do most things
[2013-07-07 01:30:56 -0400] dpt89: bookshelf['url'] = "infrachef.vlipco.co:443"
[2013-07-07 01:31:01 -0400] dpt89: do you think that's right?
[2013-07-07 01:31:06 -0400] dpt89: or without the port number?
[2013-07-07 01:31:14 -0400] coderanger: Shouldn't matter either way
[2013-07-07 01:31:32 -0400] dpt89: I'm assuming its like that because of how the default is formed. Via the docs "This value will default to the value of the URL for Nginx, which is built from the configured api_fqdn and the SSL port for Nginx."
[2013-07-07 01:32:01 -0400] coderanger: yeah, but 443 is the default :)
[2013-07-07 01:32:37 -0400] dpt89: I'm having a very strange thing
[2013-07-07 01:32:44 -0400] dpt89: "location"=>"http://co.vlipco.infrachef:443/sandboxes/0000000000006d33874f8780f0093bc0"
[2013-07-07 01:32:53 -0400] dpt89: it's changing the TLD and the subdomain
[2013-07-07 01:33:45 -0400] coderanger: No idea, sounds like a Java identifier thing? except we don't use java for that stuff anywhere
[2013-07-07 01:34:03 -0400] stormerider: dpt89: the url field should have https:// in it
[2013-07-07 01:34:06 -0400] coderanger: unless maybe you got the reverse lookup mapped wrong?
[2013-07-07 01:34:28 -0400] dpt89: stormerider changing it now then, one sec.
[2013-07-07 01:36:52 -0400] dpt89: stormerider do you know what 'vip' stands for there?
[2013-07-07 01:37:18 -0400] dpt89: code ranger & stormerider all fixed! Adding the https:// to the URL solved it.
[2013-07-07 01:37:21 -0400] dpt89: it's working again.
[2013-07-07 01:38:40 -0400] stormerider: i would guess virtual ip, but it takes a hostname
[2013-07-07 01:39:03 -0400] coderanger: yeah, virt ip
[2013-07-07 01:39:07 -0400] dpt89: ok, virtual ip makes sense
[2013-07-07 01:39:14 -0400] stormerider: i fiddled with settings until they worked, basically. dont necessarily know why :)
[2013-07-07 01:39:16 -0400] dpt89: the name
[2013-07-07 01:39:32 -0400] coderanger: just flotsam left over from the fact that chef-server is based on private-chef which has all the plumbing for HA
[2013-07-07 01:40:15 -0400] dpt89: well
[2013-07-07 01:40:20 -0400] dpt89: I think I'll go back to the cooking
[2013-07-07 01:40:29 -0400] dpt89: thanks for all the help
[2013-07-07 01:40:33 -0400] dpt89: I was totally lost
[2013-07-07 01:40:36 -0400] dpt89: and stuck
[2013-07-07 01:40:57 -0400] dpt89: goodbye!
[2013-07-07 01:41:54 -0400] stormerider: peace
[2013-07-07 02:07:00 -0400] jameson1: woo, fedora and debian all up in opscode/bento
[2013-07-07 02:32:06 -0400] jeffgoldschrafe: Quick workflow question from a newish Chef user
[2013-07-07 02:32:17 -0400] gchristensen: k
[2013-07-07 02:32:59 -0400] MrHeavy: I'm trying to follow the recommendations in the Berkshelf Way and I'm hitting one snag related to interdependent modules
[2013-07-07 02:33:20 -0400] gchristensen: ask your question :0
[2013-07-07 02:33:22 -0400] MrHeavy: When doing the test provision via Vagrant it's basically assumed that all the dependent modules will be available somewhere like Opscode Community
[2013-07-07 02:33:22 -0400] gchristensen: :)
[2013-07-07 02:33:44 -0400] tabolario: Anyone around who works on omnibus?
[2013-07-07 02:33:46 -0400] MrHeavy: Is there a better way to host those than setting up a full-blown Chef server on my dev system?
[2013-07-07 02:33:55 -0400] gchristensen: tabolario: I work *with* omnibus ,but not on it.
[2013-07-07 02:33:58 -0400] coderanger: MrHeavy: Thats only the default if no override is given in the berksfile
[2013-07-07 02:34:07 -0400] gchristensen: MrHeavy:you can point them to a git repo in the Berksfile
[2013-07-07 02:34:36 -0400] tabolario: I'm just curious why the the JSON file that omnibus-ctl runs chef-solo with for the reconfigure command is named dna.json :)
[2013-07-07 02:34:50 -0400] MrHeavy: I believe that solves my problem, then. Awesome! :)
[2013-07-07 02:34:56 -0400] MrHeavy: Thanks
[2013-07-07 02:34:58 -0400] gchristensen: *phew* totally out of my league. I meant the packaging tool, not omnibus chef :P
[2013-07-07 02:35:16 -0400] tabolario: oh hehe
[2013-07-07 02:35:24 -0400] coderanger: tabolario: Actually not sure
[2013-07-07 02:35:36 -0400] gchristensen: its ... the DNA of the server? O.o
[2013-07-07 02:35:38 -0400] coderanger: Thats been the common thing to call the JSON file that powers solo since before I started using chef
[2013-07-07 02:35:50 -0400] tabolario: yeah i finally took the time to figure out how omnibus works this weekend, i'm all excited now to create some distributable rails apps :D
[2013-07-07 02:35:59 -0400] coderanger: If I had to guess, kallistec thought it was a funny name and everyone else copied him
[2013-07-07 02:36:00 -0400] tabolario: coderanger: ah i'm sure that's it then
[2013-07-07 02:36:51 -0400] coderanger: But possibly lost to the mists of time
[2013-07-07 02:37:14 -0400] tabolario: seems like most of the way omnibus-chef-server is set up makes sense for any rails app?
[2013-07-07 02:38:05 -0400] tabolario: one thing i'm trying to figure out is how to do migrations for release upgrades would you just call rake db:migrate as an execute resource in the solo cookbooks for omnibus-ctl reconfigure?
[2013-07-07 02:38:28 -0400] coderanger: You can look at how chef-webui is setup, yeah, not sure thats best for a purely standalone rails app though
[2013-07-07 02:38:36 -0400] coderanger: Since you just don't need 99% of the goo in there
[2013-07-07 02:38:47 -0400] coderanger: Just look at plain omnibus as a starting point
[2013-07-07 02:39:37 -0400] tabolario: how would chef-server itself make schema changes?
[2013-07-07 02:40:10 -0400] gchristensen: tabolario: I package using omnibus / debs, and post
[2013-07-07 02:40:23 -0400] gchristensen: install it runs upgrade.sh which migrates the DB automatically. just like any other migration tool.
[2013-07-07 02:40:48 -0400] gchristensen: every server runs it on every deploy, in a transaction to prevent multiple servers upgrading the DB
[2013-07-07 02:41:09 -0400] tabolario: aha
[2013-07-07 02:41:42 -0400] gchristensen: its worth it to package with omnibus just so I don't have to deploy a damn ruby version to every server and deal with that mess.
[2013-07-07 02:41:42 -0400] coderanger: tabolario: We have a thing outside of omnibus to manage upgrades
[2013-07-07 02:42:25 -0400] tabolario: gchristensen: is that upgrade.sh something you could let me take a look at?
[2013-07-07 02:43:12 -0400] gchristensen: tabolario: heh... `rake db:migrate' - but custom. opens a transaction, checks the latest version in the table, inserts the new version, updates tables, commits new version.
[2013-07-07 02:43:22 -0400] tabolario: oh gotcha :)
[2013-07-07 02:43:26 -0400] tabolario: well that's simple enough then
[2013-07-07 02:44:01 -0400] gchristensen: you have to make sure your code can run on varrying DB versions though, in case server A updates the DB, and server B doesn't update the code for 20min. unless you're careful about that.
[2013-07-07 02:44:41 -0400] tabolario: yeah i've been trying to get us in the habit of doing that at work more
[2013-07-07 02:45:00 -0400] coderanger: zero-downtime upgrades are definitely the way to go :-)
[2013-07-07 02:45:08 -0400] gchristensen: yup :)
[2013-07-07 02:45:17 -0400] gchristensen: it can be a sharp stick sometimes though. gotta be careful.
[2013-07-07 02:45:33 -0400] coderanger: you also have to be very careful about what kinds of ALTER calls you make though
[2013-07-07 02:45:33 -0400] tabolario: so your deploy just syncs the deb to all the app servers and dpkg -i's it?
[2013-07-07 02:45:42 -0400] coderanger: And also never ever use mysql
[2013-07-07 02:46:05 -0400] tabolario: oh yeah i suppose you'd need something with transactional ddl for what you're talking about
[2013-07-07 02:47:02 -0400] coderanger: Well you caaaan do without transactional DDL, but if anything goes wrong with the migration there is a good chance of your server getting very sad in a hurry
[2013-07-07 02:47:19 -0400] jtimberman: coderanger: seems a bit extreme to say one should never ever use mysql :)
[2013-07-07 02:47:36 -0400] coderanger: jtimberman: Also never use runit</neckbeard>
[2013-07-07 02:47:46 -0400] coderanger: But seriously, never use MySQL, ever, for any reason
[2013-07-07 02:48:40 -0400] jtimberman: coderanger: yeah, SMF is better than runit ;)
[2013-07-07 02:48:51 -0400] gchristensen: <3 mysql
[2013-07-07 02:49:09 -0400] jtimberman: gchristensen: right on :). coderanger is cranky.
[2013-07-07 02:49:14 -0400] jtimberman: #trolololol
[2013-07-07 02:49:47 -0400] coderanger: This is why we don't let jtimberman write app code anymore :)
[2013-07-07 02:50:50 -0400] coderanger: jtimberman: Does our BATS stuff in test-kitchen have any chance of working on windows ever?
[2013-07-07 02:51:14 -0400] gchristensen: my favorite quote on the topic says "'Codd is still right. "Eventual consistency" is a farce in which half the audience don't understand the jokes.'"
[2013-07-07 02:51:24 -0400] jtimberman: coderanger: if you install bash on windows, maybe?
[2013-07-07 02:51:41 -0400] jtimberman: coderanger: i don't, and have never written app code :)
[2013-07-07 02:51:47 -0400] jtimberman: so to speak
[2013-07-07 02:51:58 -0400] coderanger: I've seen you commit patches to chef-client :)
[2013-07-07 02:52:01 -0400] jtimberman: I do, and have, written "deploy the living crap out of apps" code thouhg.
[2013-07-07 02:52:10 -0400] jtimberman: coderanger: nah, btm usually rejects them "needs tests"
[2013-07-07 02:52:12 -0400] gchristensen: I used to... thank goodness I don't anymore.
[2013-07-07 02:52:42 -0400] tabolario: i'm slowly transitioning away from writing app code
[2013-07-07 02:52:47 -0400] coderanger: jtimberman: https://github.com/coderanger/python-cookbook/blob/master/libraries/python.rb
[2013-07-07 02:52:49 -0400] gchristensen: I once dropped to shell to call out to awk from within PHP. that was when I learned I shouldn't be an app developer.
[2013-07-07 02:52:58 -0400] coderanger: Also  y'all are wimps, /me gets out his full-stack hat
[2013-07-07 02:53:17 -0400] gchristensen: I used to do that. I haven't learned anything about HTML  since 1997
[2013-07-07 02:53:41 -0400] jtimberman: coderanger: oh, very nice.
[2013-07-07 02:54:59 -0400] coderanger: Now this just needs tests for every OS evar
[2013-07-07 02:55:33 -0400] coderanger: How do I test for failure with test-kitchen?
[2013-07-07 02:55:38 -0400] coderanger: As in runs that should fail
[2013-07-07 02:55:50 -0400] jtimberman: refute? :)
[2013-07-07 02:56:38 -0400] coderanger: What is that and where do I put it?
[2013-07-07 02:57:27 -0400] gchristensen: aren't you an app developer?
[2013-07-07 02:57:33 -0400] gchristensen: :O
[2013-07-07 02:58:14 -0400] jtimberman: lol
[2013-07-07 02:58:44 -0400] jtimberman: coderanger: so, i wouldn't write the tests w/ BATS, because as you mention, they'll not work "by default" on Windows.
[2013-07-07 02:59:11 -0400] coderanger: All of these tests are platform specific anyway, so its pretty moot
[2013-07-07 02:59:11 -0400] jtimberman: coderanger: i *think* there's a kitchen busser for minitest, or at least someone was talking about that on [twitter? irc? forgot?]
[2013-07-07 02:59:25 -0400] jtimberman: there's an rspec one too
[2013-07-07 02:59:29 -0400] jtimberman: if you <3 rspec
[2013-07-07 02:59:39 -0400] jtimberman: e.g., i wrote the runit_service tests w/ rspec.
[2013-07-07 02:59:53 -0400] coderanger: BATS is easy for the bulk of the tests since its all checking for files and process output
[2013-07-07 03:00:11 -0400] jameson1: which tester is the 'preferred' method for testing?
[2013-07-07 03:00:37 -0400] jameson1: or should I be more concerned about testing before thinking about 'preferred'
[2013-07-07 03:00:46 -0400] jtimberman: jameson1: up to you.
[2013-07-07 03:01:02 -0400] jtimberman: jameson1: what do you, as a cookbook author/maintainer want to write your tests in?
[2013-07-07 03:02:58 -0400] jameson1: well, right now I'm using bats
[2013-07-07 03:03:25 -0400] jameson1: I wanted to do more introspection into the configurations, and I heard chefspec had more of that
[2013-07-07 03:03:39 -0400] coderanger: bats is the listed default, so I go with that unless I have reason not to (like testing windows, eventually)
[2013-07-07 03:05:11 -0400] jtimberman: jameson1: chefspec is "pre-convergence" - doesn't do, or require, a converged node
[2013-07-07 03:06:12 -0400] jameson1: bats is after everything is done right?
[2013-07-07 03:06:29 -0400] jameson1: because I've been using it to do 'is this process there, can i run this command, is this tool here, is this file there'
[2013-07-07 03:06:48 -0400] coderanger: Yep
[2013-07-07 03:07:05 -0400] coderanger: run chef-solo, fail test is run fails, run bats
[2013-07-07 03:07:38 -0400] jameson1: I was looking for a way to run tests without having to rerun kitchen test
[2013-07-07 03:08:35 -0400] coderanger: Boo, no way to set a suite to only run on a single platform
[2013-07-07 03:08:41 -0400] coderanger: other than excluding all the others
[2013-07-07 03:08:43 -0400] coderanger: but thats lame
[2013-07-07 03:08:44 -0400] coderanger: :(
[2013-07-07 03:08:52 -0400] jameson1: or am I not understanding test-kitchen properly...?
[2013-07-07 03:09:06 -0400] jameson1: my test is running on at least 4 base boxes :(
[2013-07-07 03:09:32 -0400] coderanger: That sounds correct (well except for my latest complaining)
[2013-07-07 03:09:53 -0400] coderanger: I'm just writing highly OS-coupled tests :)
[2013-07-07 03:10:18 -0400] jameson1: :\ my upstream package is highly OS-coupled and it hurts so, so, much
[2013-07-07 03:10:31 -0400] jtimberman: jameson1: kitchen verify
[2013-07-07 03:10:40 -0400] jtimberman: will run the tests that are in the busser.
[2013-07-07 03:11:40 -0400] jameson1: would that mean, kitchen test -d never, and then kitchen verify, repeatedly?
[2013-07-07 03:12:23 -0400] jtimberman: jameson1: you can do kitchen converge
[2013-07-07 03:14:07 -0400] jameson1: jtimberman: last question, what's the difference between kitchen converge vs kitchen verify..? is converge just letting chef-solo run and verify runs the tests as well?
[2013-07-07 03:17:12 -0400] jtimberman: jameson1: verify just runs the tests
[2013-07-07 03:17:22 -0400] jtimberman: jameson1: but it has to have a node in the Converged state
[2013-07-07 03:17:47 -0400] jtimberman: jameson1: so, kitchen test itself does a bunch of stuff, create, setup, converge, verify - all commands for kitchen.
[2013-07-07 03:17:58 -0400] jtimberman: you can do anyone of those individually
[2013-07-07 03:18:03 -0400] jtimberman: and it will do all the steps up to that one.
[2013-07-07 03:18:15 -0400] jtimberman: er - test also does destroy
[2013-07-07 03:18:19 -0400] jtimberman: converge doesn't do destroy :)
[2013-07-07 03:20:00 -0400] coderanger: Do we have fedora images anywhere?
[2013-07-07 03:20:37 -0400] coderanger: the boxes site has 18, but not 19 :-(
[2013-07-07 03:21:02 -0400] jameson1: coo~
[2013-07-07 03:22:11 -0400] coderanger: oh, because 19 was only released last week
[2013-07-07 03:22:15 -0400] coderanger: that would be a good reason
[2013-07-07 03:24:21 -0400] jtimberman: coderanger: yeah
[2013-07-07 03:24:30 -0400] jtimberman: coderanger: julian made the fedora 18 box on friday
[2013-07-07 03:24:38 -0400] jtimberman: coderanger: ping him monday - he might make a 19 box too.
[2013-07-07 03:24:44 -0400] coderanger: Ooh, will do
[2013-07-07 03:25:04 -0400] coderanger: Would be good to test python3 stuff on there since centos still doesn't ship packages yet
[2013-07-07 03:25:14 -0400] coderanger: can at least have some level of non-debian testing
[2013-07-07 03:25:17 -0400] jtimberman: hahahahahaha
[2013-07-07 03:26:06 -0400] coderanger: Oh joy, haven't re-downloaded my images for vagrant 1.2 :-(
[2013-07-07 03:26:11 -0400] coderanger: Guess I'm not running this tonight
[2013-07-07 03:26:34 -0400] jtimberman: heh, i'm still using 1.1.4
[2013-07-07 03:27:04 -0400] coderanger: If I start a download now, my gf will kill me for lagging out her game
[2013-07-07 03:27:16 -0400] jtimberman: lol
[2013-07-07 03:29:13 -0400] jtimberman: okay and with that, i'm out: chef-client::smf_service#test_0001_enables and starts the service with SMF = 0.17 s = .
[2013-07-07 03:29:21 -0400] jameson1: @_@ chef omnibus is broken for debian
[2013-07-07 03:29:24 -0400] jameson1: 7.1.0 that is
[2013-07-07 03:29:28 -0400] jtimberman: debian 7
[2013-07-07 03:29:41 -0400] jtimberman: yeah
[2013-07-07 03:29:58 -0400] jtimberman: install.sh doesn't know hoabout debian 7 and we're not building on 7 yet
[2013-07-07 03:30:46 -0400] jtimberman: the package built on 6.0.7 works great though
[2013-07-07 03:31:18 -0400] jtimberman: there might be a CHEF ticket about it.
[2013-07-07 03:31:59 -0400] jameson1: wait, where is squeeezeee
[2013-07-07 03:32:25 -0400] coderanger: Yeah, I think there is an official freeze on "supporting" new platforms until we improve testing on the current plethora
[2013-07-07 03:33:27 -0400] jameson1: i found the ticket, but looks like I will need to build debian squeeze using bento myself?
[2013-07-07 03:33:39 -0400] coderanger: Just use the deb6 packages
[2013-07-07 03:33:41 -0400] coderanger: They work fine
[2013-07-07 03:50:10 -0400] stormerider: is there a list of bento boxes kicking around, by chance?
[2013-07-07 03:50:29 -0400] stormerider: ive been planning on looking into that so i can do more testing myself
[2013-07-07 03:54:31 -0400] stormerider: also, is there any downside of just stopping chef-server and taking /opt/chef-server, /etc/chef-server, and the upstart script, tarring them up, and moving it a new machine? since everything is embedded im thinking that should work ok...
[2013-07-07 04:09:15 -0400] tabolario: stormerider: there's also everything in /var/opt/chef
[2013-07-07 04:09:20 -0400] tabolario: er /var/opt/chef-server
[2013-07-07 04:09:42 -0400] tabolario: everything that the chef-solo cookbooks generate when you run chef-server-ctl reconfigure
[2013-07-07 04:09:47 -0400] stormerider: tabolario: ooh, yes, i'd forgotten about that.
[2013-07-07 04:10:00 -0400] tabolario: although i think most if not all of that is probably portable too
[2013-07-07 04:10:18 -0400] stormerider: ah, i didn't actually realize that chef-server-ctl was using chef-solo... that's pretty cool.
[2013-07-07 04:10:48 -0400] tabolario: yeah, it was a delight this weekend taking a deep dive into omnibus-chef-server to see how all that works :)
[2013-07-07 04:11:15 -0400] stormerider: :)
[2013-07-07 04:12:12 -0400] tabolario: every time you run chef-server-ctl reconfigure it basically takes your config you have in /etc/chef-server and uses that with chef-solo to run a cookbook that's embedded with the omnibus
[2013-07-07 04:12:54 -0400] stormerider: i was wondering why it was showing chef-client 11.4.0 when i ran that... that makes sense now.
[2013-07-07 04:12:55 -0400] tabolario: and that cookbook is what actually configures nginx, rabbitmq, postgresql, chef server, etc.
[2013-07-07 04:13:14 -0400] stormerider: talk about eating your own dog food :)
[2013-07-07 04:13:15 -0400] tabolario: the omnibus package itself just has all the binaries
[2013-07-07 04:13:24 -0400] tabolario: yeah :)
[2013-07-07 04:15:08 -0400] tabolario: it's neat to see the whole thing run if you just clone the omnibus-chef-server repo and vagrant up ubuntu-12.04
[2013-07-07 04:15:34 -0400] tabolario: takes quite awhile though because of all the source compiling
[2013-07-07 04:16:24 -0400] gchristensen: that is the lame part about omnibus. distcc helps some.
[2013-07-07 04:16:42 -0400] gchristensen: and ccache :)
[2013-07-07 04:17:29 -0400] tabolario: ah not familiar with those
[2013-07-07 04:17:40 -0400] stormerider: >.< i dont see how that's mobility related...
[2013-07-07 04:18:01 -0400] gchristensen: distcc lets you distribute gcc builds to other machines. ccache lets you cache the input to output of gcc
[2013-07-07 04:18:08 -0400] gchristensen: paired, you get a pretty damn nice build environment.
[2013-07-07 04:18:21 -0400] tabolario: i will have to get those running
[2013-07-07 04:19:18 -0400] gchristensen: setting up gentoo, you learn a *lot*. whether its feasible as a day-to-day wasn't the point to me
[2013-07-07 04:19:33 -0400] tabolario: i have not taken up that challenge yet :)
[2013-07-07 04:20:16 -0400] gchristensen: you learn about things like ccache :)
[2013-07-07 04:22:19 -0400] jameson1: someone should write a test-kitchen plugin that will pull or build base boxes using bento :3
[2013-07-07 04:22:29 -0400] tabolario: how fast do your omnibus builds run for your rails app?
[2013-07-07 04:22:58 -0400] tabolario: i suppose they'd be really quick if you're not embedding any dependencies
[2013-07-07 04:23:15 -0400] gchristensen: I don't have any rails apps
[2013-07-07 04:23:21 -0400] gchristensen: :o
[2013-07-07 04:23:25 -0400] jameson1: i remember running gentoo for my personal box,
[2013-07-07 04:23:31 -0400] gchristensen: sinatra and Commander
[2013-07-07 04:23:35 -0400] tabolario: ah
[2013-07-07 04:24:01 -0400] gchristensen: mostly Commander
[2013-07-07 04:24:42 -0400] jameson1: stormerider: https://github.com/opscode/bento
[2013-07-07 04:24:56 -0400] stormerider: jameson1: just found that, thanks :)
[2013-07-07 04:25:03 -0400] jameson1: list of boxes there, also if you run the getting started, you can build your own (say debian 6)
[2013-07-07 04:25:05 -0400] tabolario: i'm not familiar with commander unless your talking about that CLI gem
[2013-07-07 04:25:05 -0400] stormerider: it's running bundle atm :)
[2013-07-07 04:25:09 -0400] gchristensen: yep
[2013-07-07 04:25:14 -0400] gchristensen: 99% of my stuff is CLI
[2013-07-07 04:26:30 -0400] stormerider: any suggestions on improving berkshelf performance, btw? running berks update takes a long time :-/ right now i think it's the biggest time-suck of my cycle at the moment
[2013-07-07 04:27:29 -0400] jameson1: the upload?
[2013-07-07 04:28:27 -0400] stormerider: update. upload runs pretty quick.
[2013-07-07 04:28:34 -0400] gchristensen: checking all the deps for updates
[2013-07-07 04:28:53 -0400] stormerider: yeah. and skip-dependencies is broken at the moment.
[2013-07-07 04:30:14 -0400] jameson1: anyone know kitchen-vagrant is flakes with fedora?
[2013-07-07 04:30:17 -0400] jameson1: *why
[2013-07-07 04:50:22 -0400] stormerider: ah. looks like chef-server creates some user accounts, so i'll install the deb and then overwrite it with my tarball.
[2013-07-07 04:52:31 -0400] jameson1: any one here using the fedora-18 bento with test-kitchen? mine complains about vagrant not being in the Gemfile, while ubuntu runs fine without
[2013-07-07 04:52:43 -0400] jameson1: ubuntu-12.04 to be precise ;)
[2013-07-07 04:58:03 -0400] jameson1: oh wait nvm, it was a rogue veewee/vagrant gem install from somewhere :\
[2013-07-07 05:09:55 -0400] jameson1: oo watching bento create a basebox is quiet interesting.
[2013-07-07 05:19:41 -0400] tabolario: have you played around with packer yet?
[2013-07-07 05:23:49 -0400] jameson1: no?
[2013-07-07 05:26:22 -0400] tabolario: box building tool from vagrant author (http://packer.io)
[2013-07-07 05:40:37 -0400] jameson1: tabolario: can packer do whatever bento is doing to create my minimal box?
[2013-07-07 05:41:22 -0400] tabolario: most likely, there's even a conversion tool to convert veewee definitions to packer templates
[2013-07-07 05:42:41 -0400] jameson1: hrm
[2013-07-07 05:58:18 -0400] jameson1: if I can't get bento to do this clean install, I'll look at packer to do that job :|
[2013-07-07 05:58:27 -0400] jameson1: veewee-to-packer, how convenient
[2013-07-07 06:01:58 -0400] juliancdunn: jameson1: jtimberman reported that my F18 bento box has /tmp too small, so I'll fix that tomorrow
[2013-07-07 06:02:34 -0400] juliancdunn: at some point I'll have to try out packer as well and maybe we'll convert our bento defs to packer defs :)
[2013-07-07 06:03:54 -0400] jameson1: I think bento(?) is doing something weird with the gem environment
[2013-07-07 06:04:28 -0400] jameson1: or maybe it's just ruby
[2013-07-07 06:04:34 -0400] jameson1: I can't run both bento and test-kitchen
[2013-07-07 06:05:53 -0400] jameson1: or rvm is..
[2013-07-07 18:49:47 -0400] stormerider: so, what's the normal process for adding a new cookbook to your Berksfile? I've been removing the lock file and re-running upload, but it seems like there should be a less disruptive way to go about things....
[2013-07-07 18:53:28 -0400] coderanger: add it to the file and just berks update?
[2013-07-07 18:54:15 -0400] stormerider: berks update says <newcookbook> does not exist in this lockfile
[2013-07-07 18:56:07 -0400] trobrock: stormerider: add it to the berksfile then just berks install should do it
[2013-07-07 18:57:38 -0400] stormerider: thanks trying that
[2013-07-07 18:59:56 -0400] stormerider: sweet, that does the trick.
[2013-07-07 19:02:07 -0400] coderanger: Ahh yeah, always install first, then update :)
[2013-07-07 19:15:58 -0400] stormerider: blah. the link resource should treat "soft" as a valid option equilavent to "symbolic"
[2013-07-07 21:15:31 -0400] goldenarchie: Background: first day with knife solo, only experience has been with vagrant. Question: where do i physically put my rbenv rubies json?
[2013-07-07 21:16:07 -0400] hakunin: goldenarchie: what do you mean by "rbenv rubies json"?
[2013-07-07 21:17:15 -0400] goldenarchie: hakunin: this specifically https://gist.github.com/anonymous/983dc66771b72cc53a8a
[2013-07-07 21:18:00 -0400] hakunin: goldenarchie: you have a few options, these are just chef attributes
[2013-07-07 21:18:18 -0400] hakunin: goldenarchie: you can put them in vagrantfile directly
[2013-07-07 21:18:27 -0400] hakunin: goldenarchie: or a wrapper cookbook
[2013-07-07 21:19:25 -0400] goldenarchie: hakunin: i'm ditching vagrant, this is a fresh knife-solo repo, so I'm having a hard time getting my bearings
[2013-07-07 21:20:28 -0400] goldenarchie: hakunin: can you point me to a working example of this by chance?
[2013-07-07 21:20:38 -0400] hakunin: goldenarchie: there are multiple places where attributes can be set in chef: in wrapper cookbook attributes, in roles, in nodes
[2013-07-07 21:21:21 -0400] hakunin: goldenarchie: this depends how you'd structure your setup. if you go with the so-called "Application Cookbook" approach, then you'd probably set all of these in cookbook's attributes
[2013-07-07 21:22:25 -0400] hakunin: goldenarchie: http://alluvium.com/blog/2013/05/03/the-application-cookbook-pattern-berkshelf-and-team-chef-workflow/
[2013-07-07 21:23:29 -0400] hakunin: goldenarchie: the problem with chef, and the reason my answer sounds vague, is because there is literally not a single accepted way to do anything, there are just places in which you can put things, and you have to wrap your mind around their significance
[2013-07-07 21:23:58 -0400] hakunin: goldenarchie: the application cookbook patterns tries to remedy that, so i suggest learning about it
[2013-07-07 21:24:43 -0400] goldenarchie: hakunin: i'm picking up on this... :/ i just wish init gave me more to work with
[2013-07-07 21:25:22 -0400] hakunin: goldenarchie: Jamie's video linked in that blog is very helpful
[2013-07-07 21:30:52 -0400] goldenarchie: hakunin: i've got jamie's video running, t-46:00
[2013-07-07 22:07:40 -0400] willejs: anyone had an issue with the python cookbook not installing setuptools?
[2013-07-07 22:08:49 -0400] cwj: willejs: yeah, see https://github.com/pypa/pip/issues/1033 and http://tickets.opscode.com/browse/COOK-3284
[2013-07-07 22:09:06 -0400] willejs: cheers! just what i was looking for
[2013-07-07 22:09:22 -0400] willejs: browsed the pull requests on the cookbook but nightmare looking for issues
[2013-07-07 22:09:33 -0400] cwj: its a hard one to search on i bet
[2013-07-07 22:09:39 -0400] cwj: i just started seeing this yesterday
[2013-07-07 22:10:00 -0400] cwj: i think the new version of distribute went up on july 5th, which has kind of set this stuff in motion
[2013-07-07 22:11:28 -0400] willejs: yeah i think its going to bork a lot of stuff
[2013-07-07 22:11:44 -0400] willejs: i hate the fact that supervisor calls upgrade every time chef runs
[2013-07-07 22:11:54 -0400] cwj: i dont like that either
[2013-07-07 22:12:11 -0400] llakey: I'm using `ssh_known_hosts_entry 'github.com'` and when I run `vagrant up` my `git clone` fails with `Permission denied (publickey)` but a 2nd run of the same cookbook with `vagrant provision` clones the private github repo without issue. Why does this work the 2nd run and not the first run?
[2013-07-07 22:12:12 -0400] cwj: but otherwise i guess you cant upgrade the version by changing the associated attribute
[2013-07-07 22:12:26 -0400] willejs: adds an extra ~5 sec to a run
[2013-07-07 22:13:07 -0400] willejs: yeah, exactly
[2013-07-07 22:13:14 -0400] willejs: did you fix it then cwj?
[2013-07-07 22:13:25 -0400] trobrock: llakey: are you specifying the github.com key? I was having trouble the other day when specifying the key, went away when I let the cookbook generate it
[2013-07-07 22:14:16 -0400] cwj: willejs: the suggestion from coderanger is to wait it out until the new version of pip is released
[2013-07-07 22:14:42 -0400] cwj: in the meantime i had to clone the supervisor cookbook and change the action to :install
[2013-07-07 22:14:47 -0400] llakey: trobrock: no. i'm not specifying the key. i'm seeing that the key is being added to known_hosts or ssh_known_hosts depending on how i set up the attributes. so the key is there.
[2013-07-07 22:15:05 -0400] cwj: you could also manually do the distribute upgrade without specifying any other dependencies
[2013-07-07 22:15:07 -0400] willejs: yeah, i think i will make a wrapper cookbook and use chef rewind
[2013-07-07 22:15:08 -0400] willejs: sucks.
[2013-07-07 22:15:46 -0400] coderanger: willejs: you mean install vs upgrade?
[2013-07-07 22:15:47 -0400] cwj: my slightly out-of-date pypi mirror is the only thing keeping my deploys going
[2013-07-07 22:15:59 -0400] coderanger: willejs: Just deploy devpi locally
[2013-07-07 22:16:01 -0400] coderanger: It is super easy
[2013-07-07 22:17:00 -0400] coderanger: Make sure you aren't setting --use-mirrors since that can be a substantial slowdown too
[2013-07-07 22:17:22 -0400] willejs: yeah, i think i might do that
[2013-07-07 22:21:11 -0400] willejs: hmm probably just go for the install route, seems like an easier fix?
[2013-07-07 22:21:36 -0400] coderanger: You then need to specify a version instead of relying on the latest
[2013-07-07 22:21:37 -0400] willejs: i don't really want the overhead of running a couple of caching servers...
[2013-07-07 22:21:49 -0400] coderanger: or deal with your chef runs no longer being truly convergent
[2013-07-07 22:22:07 -0400] coderanger: I am highly opposed to the :install action existing at all though, and never use it :)
[2013-07-07 22:22:18 -0400] cwj: oh yeah i guess if you just set the version attribute you'd be set
[2013-07-07 22:22:22 -0400] cwj: maybe?
[2013-07-07 22:22:35 -0400] cwj: i think you'd still get --upgrade in the command line though
[2013-07-07 22:22:35 -0400] willejs: yeah, id rather specify a version, than it do upgrade and not know what it will install a bug ridden new version ;)
[2013-07-07 22:22:51 -0400] cwj: so it might still botch the pip upgrade
[2013-07-07 22:23:24 -0400] coderanger: cwj: The issue in your ticket is 100% unrelated to all of this btw
[2013-07-07 22:23:54 -0400] coderanger: as mentioned in the pypa ticket, you just need to either use pip 1.4, or with pip 1.3 and lower you need to do the distribute upgrade as its own thing
[2013-07-07 22:26:26 -0400] cwj: yep
[2013-07-07 22:26:46 -0400] cwj: but near as i can tell, off-the-shelf shit is still busted for the time being
[2013-07-07 22:28:08 -0400] coderanger: only for upgrades, new installs shouls work fine
[2013-07-07 22:28:16 -0400] cwj: thats not my experience
[2013-07-07 22:28:21 -0400] cwj: repeatedly in vagrant
[2013-07-07 22:31:35 -0400] willejs: yeah, i just tried to install supervisor on a ubuntu base ami on ec2 and it was borked
[2013-07-07 22:32:03 -0400] willejs: I'm pretty tired and can't make sense of much of this, so going to fix it tomorrow am.
[2013-07-07 22:32:08 -0400] willejs: cheers for the help guys
[2013-07-07 22:32:12 -0400] willejs: night
[2013-07-07 22:35:12 -0400] willejs: ah wait a second...
[2013-07-07 22:37:18 -0400] willejs: if the supervisor cookbook passed in --no-deps to pip_install LWRP it wouldent upgrade the dependencies?
[2013-07-07 22:37:25 -0400] willejs: or do we want it to?
[2013-07-07 22:38:19 -0400] ssd7: Ohai Chefs
[2013-07-07 22:39:13 -0400] cwj: ohai
[2013-07-07 22:39:19 -0400] cwj: willejs: not sure
[2013-07-07 22:39:35 -0400] willejs: coderanger: would my above suggestion work?
[2013-07-07 22:39:40 -0400] patcon_: anyone know if there's any possible way to load a recipe from a cookbook without loading all the attribute files?
[2013-07-07 22:40:04 -0400] willejs: pretty sure it isn't. override them in the cookbook you are loading from?
[2013-07-07 22:40:29 -0400] patcon_: I'm trying to install a package_repo.rb recipe without including the other attrs that set the package names to install
[2013-07-07 22:40:36 -0400] patcon_: ah thanks man
[2013-07-07 22:40:43 -0400] coderanger: willejs: No, then your deps would just be out of date and supervisor might just fail entirely
[2013-07-07 22:40:50 -0400] patcon_: even if i get it working, it gonna be hacky and a layer of indirection, which kinda sucks'
[2013-07-07 22:41:35 -0400] coderanger: The fix is as mentioned in the pypa ticket, either wait for pip 1.4, don't upgrade to things that need setuptools 0.8, or do the distribrute upgrade by hand
[2013-07-07 22:46:37 -0400] cwj: unfortunately  if you use the supervisor cookbook somewhere in your stack "dont upgrade" == dont run chef
[2013-07-07 22:47:43 -0400] willejs: yeah I realised this. think I've got an idea whats going on and how to fix it but can't keep eyes open, need sleep
[2013-07-07 22:47:45 -0400] willejs: nigth guys
[2013-07-07 22:47:46 -0400] willejs: cheers again
[2013-07-07 23:08:40 -0400] coderanger: cwj: or set the version :)
