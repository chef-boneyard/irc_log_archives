[2013-08-13 00:00:04 -0400] ssd7: So are you still having problems installing or with something else?
[2013-08-13 00:00:51 -0400] dgarstang: ssd7: trying to install knife-ec2. It requires knife-windows (god knows why). That requires em-winrm, which in turn requires eventmachine. I've installed eventmachine tho
[2013-08-13 00:01:17 -0400] dgarstang: ssd7: every time I run 'sudo /opt/chef/embedded/bin/gem install --local eventmachine-1.0.3.gem' it keeps saying installed 1 gem, which is a bit weord
[2013-08-13 00:02:39 -0400] ssd7: If you do `gem list knife-ec2`, what version do you see?
[2013-08-13 00:03:11 -0400] ssd7: sorry, add --remote to the above command
[2013-08-13 00:03:30 -0400] dgarstang: ssd7: i think i need the one from github...
[2013-08-13 00:04:07 -0400] dgarstang: /opt/chef/embedded/bin/gem list knife-ec2 == 0.6.4
[2013-08-13 00:05:13 -0400] dgarstang: ssd7: oh that sucks. 0.6.4 is what I have, and what a git clone gets me. However, the help output for the version I have says -A is one thing, while the github seems to have what i need.
[2013-08-13 00:06:21 -0400] ssd7: dgarstang: I just built from source and it was able to install.  The version is only bumped on releases which is why if you build from master it still gets that version.  We usually bump them after a release, I'm not sure why we didn't there
[2013-08-13 00:07:01 -0400] dgarstang: ssd7: Bit confused by that, but ... I'm looking for the version that has -A as ssh agent forwarding. The -w option is kinda useless without it.
[2013-08-13 00:08:05 -0400] ssd7: dgarstang: You might try just adding "ForwardAgent yes" to your ~/.ssh/config file
[2013-08-13 00:08:30 -0400] dgarstang: ssd7: It seems that whatever knife is doing, it's ignoring my .ssh/config.
[2013-08-13 00:09:10 -0400] dgarstang: ssd7: although it's kind of hard to tell, because -V isn't logging anything
[2013-08-13 00:09:17 -0400] dgarstang: neither is -VV
[2013-08-13 00:10:31 -0400] dgarstang: ssd7: I also don't know if it's ssh-ing to the internal IP, external IP, internal fqdn or external fqdn. It needs to be a fqdn for a start (so that I can match against it in .ssh/config). If it's using the IP address, I'm screwed.
[2013-08-13 00:10:44 -0400] halfamind: Hey folks. Question: I have a few recipes that "notify" the same "execute" resource to "run." They seem to cause it to run multiple times. Any way to avoid that?
[2013-08-13 00:11:03 -0400] ssd7: dgarstang: It uses fqdn by default
[2013-08-13 00:11:07 -0400] _ci: trying to provision an ec2 server via chef
[2013-08-13 00:11:13 -0400] dgarstang: ssd7: Internal or external?
[2013-08-13 00:11:42 -0400] _ci: Receiving this error: Failed to authenticate ubuntu - trying password auth
[2013-08-13 00:11:57 -0400] _ci: According to the documentation that means there is a problem with my ssh credentials
[2013-08-13 00:12:06 -0400] _ci: However I can ssh into the created instance just fine
[2013-08-13 00:12:10 -0400] _ci: Any thoughts?
[2013-08-13 00:12:18 -0400] ssd7: dgarstang: You can do a 'knife node show NODENAME' to see what got picked up as the main fqdn.  if you need another one, you should be able to do -a cloud.public_hostname or -a cloud.private_hostname
[2013-08-13 00:12:53 -0400] ssd7: _ci: Can you post somewhere the example command you are runnig?
[2013-08-13 00:13:59 -0400] _ci: knife ec2 server create -x ubuntu -d ubuntu12.04-gems -E prod -I ami-3d4ff254 -f t1.micro -r "role[base],role[webserver]" -G default -i /path/to/.ssh/pemfilename.pem -S "pemfilename" --verbose
[2013-08-13 00:14:25 -0400] ssd7: dgarstang: So what are you trying when installing knife-ec2 from source?.  You should be able to do: rake build; gem install pkg/knife-ec2-0.6.4.gem from your sourcecode checkout.  Is that not working?
[2013-08-13 00:14:46 -0400] ssd7: _ci: and what command are you running when you ssh into the machine?
[2013-08-13 00:15:04 -0400] dgarstang: ssd7: No, I was getting all those dependancies.
[2013-08-13 00:15:12 -0400] _ci: ssh ubuntu@new-ec2-ip-address
[2013-08-13 00:15:29 -0400] dgarstang: ssd7: But, if knife doesn't support agent forwarding then I'm better off using ssh config.... it that works
[2013-08-13 00:16:07 -0400] ssd7: _ci: I would run ssh with -vv and see what key is being used there.  My guess is that your argument to -i is a bit off or a different key is being used.
[2013-08-13 00:16:20 -0400] dgarstang: ssd7: Well I dunno. I passed -N test50 to my knife command it's sitting there 'Waiting for sshd'. Running a 'knife node show test50' in another window gets me 'ERROR: The object you are looking for could not be found'
[2013-08-13 00:16:37 -0400] _ci: sorry, i did have -vvv and the keys matched
[2013-08-13 00:16:40 -0400] dgarstang: AND... I have an entry in my .ssh/config
[2013-08-13 00:17:00 -0400] dgarstang: and .... -VV ain't workin'
[2013-08-13 00:17:48 -0400] ssd7: dgarstang: So, the pull request you linked to above is actually in core chef
[2013-08-13 00:18:15 -0400] dgarstang: ssd7: meaning -A should be agent forwarding?
[2013-08-13 00:19:21 -0400] dgarstang: The chef bootstrap is hung on waiting for sshd. It's got 'Public DNS Name: foo.us-west-1.compute.amazonaws.com'. If I log into that box and do a 'ssh user@foo.us-west-1.compute.amazonaws.com' it works.
[2013-08-13 00:19:24 -0400] _ci: i am having a hard time understanding which ssh key knife ec2 server create is actually using.  it shows the pemfilename without the path and without the extension.  the path used in the -i is complete and correct
[2013-08-13 00:20:12 -0400] dgarstang: the fact that chef is sitting there waiting for ssh on a host, while it works manually from the command line, would heavily imply to me that chef ignores my .ssh/config file.
[2013-08-13 00:20:44 -0400] dgarstang: but again, I can't tell.... because neither -V or -VV log anything at this point.
[2013-08-13 00:20:55 -0400] ssd7: dgarstang: yeah, so teh forwarding patch is in 11.6.0
[2013-08-13 00:21:19 -0400] dgarstang: ssd7: that's a chef-client version number tho...
[2013-08-13 00:21:35 -0400] ssd7: dgarstang: knife and Chef share the same version numbers
[2013-08-13 00:21:50 -0400] ssd7: `knife ssh` and `knife bootstrap` are part of core chef
[2013-08-13 00:22:20 -0400] dgarstang: ssd7: why does my knife-ec2 return 0.6.4 then?
[2013-08-13 00:23:07 -0400] dgarstang: ssd7: so, basically upgrae my chef-client to 11.6?
[2013-08-13 00:23:18 -0400] ssd7: dgarstang: knife-ec2 is a seperate plugin that is numbered differently since it lives in a different gem
[2013-08-13 00:24:45 -0400] ssd7: dgarstang: OK. So Chef ships both knife and the chef-client executable in the same package.  This package include a number of built in commands for knife.  Additional commands are available via plugins which are shipped seperately and have seperate version numbers.
[2013-08-13 00:25:11 -0400] dgarstang: how... do I get the version of knife-ec2 that supports agent forwarding so that -w is usable?
[2013-08-13 00:25:11 -0400] ssd7: the knife-ec2 gem provides the `knife ec2 server create` and other `knife ec2 ...` commands.
[2013-08-13 00:26:17 -0400] ssd7: dgarstang: I'm currently looking into wither knife-ec2 was ever updated to take advantage of that agent forwarding behavior.
[2013-08-13 00:26:49 -0400] dgarstang: ssd7: kk. If it's supposed to work with .ssh/config that's fine too. I just don't know.
[2013-08-13 00:28:09 -0400] _ci: can anyone help?
[2013-08-13 00:28:17 -0400] ssd7: dgarstang: So, I use .ssh/config with plain `knfie ssh` and that definitely works for me.
[2013-08-13 00:28:26 -0400] ssd7: I've never tried it with knife-ec2 and -w though
[2013-08-13 00:28:46 -0400] dgarstang: ssd7: lemme try again without -w and see if it uses .ssh/config
[2013-08-13 00:28:47 -0400] _ci: ec2 server create fails and returns "Failed to authenticate ubuntu - trying password auth"
[2013-08-13 00:29:14 -0400] _ci: If I immediately ssh into that newly created instance using ssh ubuntu@new-ip-address -vvv
[2013-08-13 00:29:17 -0400] _ci: I can access
[2013-08-13 00:29:47 -0400] dgarstang: _ci: from the same source host?
[2013-08-13 00:30:28 -0400] _ci: So I copy the public key path given in the  "Offering RSA public key: /path/to/.ssh/pemfilename.pem" when ssh succeeds
[2013-08-13 00:30:54 -0400] _ci: And try using in my ec2 server create -i /path/to/.ssh/pemfilename.pem but it still fails
[2013-08-13 00:31:48 -0400] _ci: dgarstang: if you mean from the same workstation, yes
[2013-08-13 00:38:36 -0400] apes: Can you have a variable declaration inside a resource? eg file "foo" do x =1 end
[2013-08-13 00:44:37 -0400] dgarstang: ssd7: Seems like knife-ec2 completely ignores .ssh/config.... based on what tcpdump is telling me.
[2013-08-13 00:47:41 -0400] _ci: I resolved the previous issue by removing the -i and -S commands from the ec2 server create command
[2013-08-13 00:47:51 -0400] _ci: Instead they were in the knife.rb configuration file
[2013-08-13 00:47:56 -0400] _ci: In turn, it worked
[2013-08-13 00:47:59 -0400] _ci: New issue
[2013-08-13 01:13:28 -0400] iverson0881: hi, was taking a look at this article by voxer, http://engineering.voxer.com/2013/03/22/chef-part-2-performance/
[2013-08-13 01:13:39 -0400] iverson0881: but i wasn't sure how to access the variables they defined within machine_classes
[2013-08-13 01:13:50 -0400] iverson0881: that i would like to use within a chef template
[2013-08-13 01:57:56 -0400] coderanger: iverson0881: I would avoid doing that at all costs, unless you really want to see Chef using 16GB of RAM
[2013-08-13 01:58:24 -0400] coderanger: (unless you have like 10 servers or something)
[2013-08-13 02:00:02 -0400] coderanger: iverson0881: First off use partial search if you care about perf (or, really, always)
[2013-08-13 02:01:19 -0400] coderanger: iverson0881: Second, what they included what an example of recipe code, you would have to pass that variable in to your template context just like normal
[2013-08-13 02:02:49 -0400] coderanger: iverson0881: Even with partial search though, anything that needs data on all nodes is going to be pretty slow unfortunately. it will always scale O(N) with your number of servers kind of by definition
[2013-08-13 02:47:09 -0400] ohlol: any test-kitchen ninjas around? need some help with it on jenkins
[2013-08-13 03:59:24 -0400] iverson0881: coderanger: understood, i've converted to using partial_search since all we need is the fqdn, however i'm not too sure how to use say 'dev' as a variable within a template
[2013-08-13 03:59:47 -0400] coderanger: iverson0881: variables :dev => dev
[2013-08-13 04:11:24 -0400] iverson0881: coderanger: this is what i have now: http://pastebin.com/T2wfbNtq however i get the following error
[2013-08-13 04:11:51 -0400] iverson0881: coderanger: FATAL: NoMethodError: undefined method `dev' for Chef::Resource::Template on :dev => dev.sort_by { |f| f['fqdn'] }
[2013-08-13 04:12:14 -0400] coderanger: Because dev itself isn't a variable
[2013-08-13 04:12:19 -0400] coderanger: its a key in a hash
[2013-08-13 04:12:21 -0400] coderanger: machine_classes['dev']
[2013-08-13 04:12:30 -0400] iverson0881: oh...
[2013-08-13 04:16:25 -0400] iverson0881: coderanger: thank you sir!
[2013-08-13 04:16:34 -0400] coderanger: No problem
[2013-08-13 07:09:26 -0400] tugce: Hi, I want to install chef-server. aptitude, gems or knife? Which one is the best way to do it? (Because I had problems with aptitude and they told me it's not recommended)
[2013-08-13 07:41:02 -0400] kisoku: tugce: use the chef omnibus installer
[2013-08-13 07:41:11 -0400] kisoku: http://opscode.com/chef/install
[2013-08-13 07:42:13 -0400] tugce: kisoku: thanks for recommendation!
[2013-08-13 07:46:35 -0400] kisoku: np
[2013-08-13 08:10:52 -0400] mosez: can i use search within resource provider definitions?
[2013-08-13 08:15:18 -0400] chaos: mosez, yes
[2013-08-13 08:16:22 -0400] chaos: https://github.com/edelight/chef-mongodb/blob/master/definitions/mongodb.rb
[2013-08-13 08:16:25 -0400] chaos: line 189 for example
[2013-08-13 08:16:42 -0400] mosez: chaos: thx
[2013-08-13 09:22:42 -0400] jds_: The recommended way of installing the mysql gem & ensuring the mysql libraries are also installed seems to be this - https://gist.github.com/jdelStrother/6d3cb0296d62c1d25f5b
[2013-08-13 09:23:04 -0400] jds_: Why doesn't a simple "include_recipe 'mysql::client'; chef_gem 'mysql'" work ?
[2013-08-13 09:24:52 -0400] paul--: ids, I'm not entirely sure on this as I'm only a noob at chef, but I'm pretty sure chef_gem only installs to the instance of ruby that the chef run runs on
[2013-08-13 09:25:12 -0400] paul--: which is separate from any ruby install you may do on the machine
[2013-08-13 09:25:34 -0400] paul--: jds* even :)
[2013-08-13 09:25:37 -0400] paul--: ugh
[2013-08-13 09:25:42 -0400] paul--: jds_ :)
[2013-08-13 09:26:24 -0400] jds: better :)
[2013-08-13 09:26:51 -0400] jds: paul--: The problem I'm running into is that "include_recipe 'mysql::client'; chef_gem 'mysql'" isn't actually installing the mysql libs before trying to install the mysql gem
[2013-08-13 09:26:59 -0400] jds: so the gem compilation fails with missing library errors
[2013-08-13 09:28:16 -0400] paul--: Weird.. Yeah not sure sorry :(
[2013-08-13 09:36:55 -0400] sparr: with a default install of chef in /opt/chef-server, where do recipes live?
[2013-08-13 09:37:47 -0400] sparr: err, cookbooks
[2013-08-13 09:42:31 -0400] sparr: sorry, I'll ask in #learnchef
[2013-08-13 09:48:02 -0400] aberrios: I'm attempting to start a service after an init script has been installed but I'm getting an error like txt file busy. what am I doing wrong?
[2013-08-13 10:04:10 -0400] admin0: ohai all
[2013-08-13 10:04:42 -0400] admin0: gems install knife-solo is broken  ..  it install fine .. but when I do a knife solo init Kitchen .. it breaks .
[2013-08-13 10:30:46 -0400] mosez: how can i install gems into chefs builtin ruby? i need a mysql gem within the chef context to check for specific mysql stuff -.-
[2013-08-13 10:34:02 -0400] mosez: ah, chef_gem
[2013-08-13 10:37:38 -0400] aberrios: I'm attempting to start a service after an init script has been installed but I'm getting an error like txt file busy. what am I doing wrong?
[2013-08-13 10:39:13 -0400] yruss972: When using ignore_failures, will the resource still trigger the notifications on failure?
[2013-08-13 12:12:52 -0400] lewiz: Should my chef server be a chef client of itself?  e.g. for a base linux role that configures some user accounts, etc.
[2013-08-13 12:17:24 -0400] bigbigbang: ohai chefs ! Expert question ( I hope..) : yesterday i asked some help about nginx compilation option and gchristensen answered me by pointing me to omnibus-package where we can found "the nginx compilation" .. but can we access these options when installing via rpm ? I don't know omnibus at all .. and if there is a different way to install OSC and having more "install options" I 'm verry interested ..
[2013-08-13 12:20:12 -0400] bigbigbang: I need these compilation option in order to be able to supervise nginx, and apparently (?) the nginx compiled in OSC did'nt get this option .. (nginx -V doesn't show me this option)
[2013-08-13 12:43:31 -0400] joaojeronimo: Hi guys, does anyone have a clue one why a "knife solo cook" command is deleting all my cookbooks ?
[2013-08-13 12:43:39 -0400] joaojeronimo: knife 0.3
[2013-08-13 12:43:47 -0400] joaojeronimo: it's driving me nuts
[2013-08-13 12:53:40 -0400] yfeldblum: joaojeronimo, i think you should use a separate directory for *your* cookbooks (most people use "./site-cookbooks") so knife-solo can copy the cookbooks listed in Cheffile.lock into your cookbooks directory
[2013-08-13 12:54:36 -0400] tugce: Last 2 days I've been trying to install Chef / Chef-Server on Debian Squeeze. Yet no matter how much I try chef just doesnt work. Does chef installation problematic or do I suck?
[2013-08-13 12:56:25 -0400] mosez: i'm getting quite often apt-get package installs return status 100. but that seems to be not a big problem, is it possible to restart that recipe or the full chef run in that case?
[2013-08-13 13:08:58 -0400] mosez: tugce: wth do you still use squeeze? oO
[2013-08-13 13:09:19 -0400] mosez: tugce: since wheezy you can use the chef omnibus installer.
[2013-08-13 13:10:26 -0400] tugce: our company will switch from puppet to chef and I'll be the one who convert puppet classes into chef cookbooks. Bur I can't start it because I don't have an chef enviroment to try cookbooks I write (I'm intern)
[2013-08-13 13:11:17 -0400] mosez: tugce: you should upgrade to wheezy first... squeeze is oldstable since may.
[2013-08-13 13:12:02 -0400] tugce: mosez: well i just can't say let's upgrade all servers
[2013-08-13 13:13:49 -0400] mosez: tugce: than you should install the chef gem, maybe.
[2013-08-13 13:14:32 -0400] tugce: mosez, i already tried it. But there is always a problem about configuration files, keys, commands etc.
[2013-08-13 13:14:45 -0400] mosez: tugce: on squeeze base boxes for varagtn everything worked with the gem -> https://github.com/jedi4ever/veewee/blob/master/templates/Debian-6.0.7-amd64-netboot/chef.sh
[2013-08-13 13:15:04 -0400] mosez: tugce: and for simple testing you should go the path with vagrant.
[2013-08-13 13:15:39 -0400] mosez: tugce: vagrant is a commandline wrapper and helper for virtualbox. that way you can test around in a virtual environment
[2013-08-13 13:16:51 -0400] tugce: mosez, okay i'll give it a try. Thank you!
[2013-08-13 13:17:16 -0400] mosez: tugce: yw
[2013-08-13 13:17:54 -0400] mosez: tugce: http://www.vagrantup.com/ and http://www.vagrantbox.es/ :)
[2013-08-13 13:18:29 -0400] tugce: mosez, thanks again :)
[2013-08-13 13:18:33 -0400] mosez: np
[2013-08-13 13:41:45 -0400] mosez: wth did that not work? i want to install the pg gem. for mysql gem everything works fine... but on pg this wont work: http://pastie.org/8232695
[2013-08-13 13:49:47 -0400] zts: mosez: you have to jump through hoops to get it to build with chef - easiest to just use the "ruby" recipe in the postgresql cookbook
[2013-08-13 13:50:03 -0400] zts: mosez: or you can see the detail here: https://github.com/opscode-cookbooks/postgresql/blob/master/recipes/ruby.rb
[2013-08-13 13:51:26 -0400] failshell: supporting 3 distro families in a cookbook is such a PITA.
[2013-08-13 13:51:43 -0400] jjeffers: any know if there is a problem with opscode's API this morning?
[2013-08-13 14:07:15 -0400] isaac_: I'm having an issue with `knife upload` when trying to migrate from Chef 10 to 11 following the guide on the Opscode blog (http://www.opscode.com/blog/2013/03/12/5106/)
[2013-08-13 14:08:26 -0400] isaacb: no matter what I've tried, it always fails when trying to upload the data from the Chef 10 server. `knife upload` fails with a Rest error initially and then just "Internal server error" subsequently
[2013-08-13 14:11:40 -0400] phessler: hi guys.  I have a patch for chef that I want to add to a trouble ticket I filed.  but I can't figure out which button to press to say "here is the fix, please commit"
[2013-08-13 14:11:58 -0400] phessler: (I have attached the file already)
[2013-08-13 14:13:24 -0400] gchristensen: phessler: which ticket?
[2013-08-13 14:13:50 -0400] phessler: CHEF-4446 the attachement is called 'f' (sorry, not very creative on file names)
[2013-08-13 14:17:38 -0400] isaacb: I think my issue may be related to CHEF-4339, though I'm using `knife upload` and not `knife cookbook upload`
[2013-08-13 14:19:08 -0400] gchristensen: phessler: I'd add a comment saying you added the patch as the file named `f` and maybe rename that to chef-4446.patch. that said, the only real thingy ou need to do is make sure you signed the CLA, and click Fix Provided.
[2013-08-13 14:19:56 -0400] gchristensen: phessler: have you signed the CLA?
[2013-08-13 14:19:57 -0400] phessler: gchristensen: where is "fix provided"?
[2013-08-13 14:20:09 -0400] phessler: no, it's my first time submitting anything
[2013-08-13 14:20:56 -0400] gchristensen: phessler: read this: http://wiki.opscode.com/display/chef/How+to+Contribute and make sure to submit the Contributor License Agreement
[2013-08-13 14:21:32 -0400] gchristensen: phessler: at that point, you'll be able to click this button :) http://gsc.io/s/%5B%23CHEF-4446%5D_add_cookbook_version_numbers_to_chef-client_output_-_Opscode_Open_Source_Ticket_Tracking-20130813-092022.png which will get it included into next week's code review, and perhaps merged
[2013-08-13 14:21:43 -0400] phessler: god dammmit.  Hrmf, ok.
[2013-08-13 14:22:11 -0400] gchristensen: phessler: if you submit the CLA (its easy) you get stickers at the endof the year thankingyou for your support! also, its less painful than you think after the first few times you do it.
[2013-08-13 14:22:28 -0400] phessler: no, it's more that I have a moral objection to filling these things out
[2013-08-13 14:22:41 -0400] gchristensen: what about it is objectionable to you?
[2013-08-13 14:22:42 -0400] phessler: I'll read the agreement, and see what happens
[2013-08-13 14:24:02 -0400] gzill: if I accidentally did a knife node/client delete on a group of systems, is there an easy way to get them re-added to chef? (they all have the same role)
[2013-08-13 14:24:16 -0400] gchristensen: phessler: my understanding  is its just to ensure you don't claim that you have copyright over chef code.
[2013-08-13 14:25:33 -0400] phessler: nope
[2013-08-13 14:25:36 -0400] yfeldblum: phessler, i'm curious what the moral objection might be
[2013-08-13 14:25:49 -0400] gchristensen: me too
[2013-08-13 14:25:54 -0400] phessler: this one says that I maintain copyright, but that I issue Opscode a license to use the code
[2013-08-13 14:25:59 -0400] gchristensen: it seemed fairly agreeable to me
[2013-08-13 14:26:16 -0400] phessler: yfeldblum / gchristensen netbsd and fsf often require a copyright assignment, which means they are the official copyright holders of record
[2013-08-13 14:26:26 -0400] gchristensen: ah
[2013-08-13 14:26:31 -0400] phessler: which is *really* obscene
[2013-08-13 14:26:57 -0400] phessler: I do open source development as well (for openbsd), which does not require any sort of signatures
[2013-08-13 14:27:51 -0400] phessler: this agreement makes sense, although I wonder how enforcable it is in Switzerland
[2013-08-13 14:28:00 -0400] kreisys: Hey all I'm having a weird problem when I mass launch a dozen of instances on ec2 that are bootstrapped via a user-data script, I end up having an ever increasing number of chef-clients running in parallel. the weird thing is that it only happens on some of the instances while the rest look fine. they are all automatically bootstrapped exactly the same way client version is 11.6. Has anyone seen such a thing?
[2013-08-13 14:28:07 -0400] gchristensen: phessler: that isn't your problem to deal with :P
[2013-08-13 14:28:17 -0400] phessler: gchristensen: no, but it is still entertaining
[2013-08-13 14:28:46 -0400] yfeldblum: gchristensen, i too wonder how enforceable it is on the moon or on Mars
[2013-08-13 14:29:05 -0400] gchristensen: yfeldblum: all I know is I wrote my own deed to own the moon, and thusly its alll mine!
[2013-08-13 14:29:21 -0400] ismell: i'm using the application cookbook and I defined a before_restart callback, but when I run the callback never gets called
[2013-08-13 14:29:25 -0400] phessler: uh, why does the form need my telephone number?
[2013-08-13 14:29:28 -0400] ismell: is there somethign I'm missing?
[2013-08-13 14:29:41 -0400] gchristensen: I secretly hope Opscode will call me and hire me
[2013-08-13 14:29:47 -0400] yfeldblum: gchristensen, those must be some hefty property taxes you pay on title to the moon
[2013-08-13 14:29:53 -0400] spox: phessler: late night prank calls
[2013-08-13 14:30:22 -0400] gchristensen: yfeldblum: I declared it its own country, so its cool.
[2013-08-13 14:30:33 -0400] phessler: heh.  if opscode called me, there would be quite a bit of bitching about the portability of chef-server
[2013-08-13 14:31:01 -0400] yfeldblum: gchristensen, i suspect NKorea's ICBM nukes next year will miss the US and hit your country by accident
[2013-08-13 14:31:39 -0400] yfeldblum: gchristensen, might want to take out a policy covering damage induced by accidental war
[2013-08-13 14:32:17 -0400] gchristensen: yfeldblum: I find that horribly likely
[2013-08-13 14:32:29 -0400] phessler: CLA signed and submitted
[2013-08-13 14:32:31 -0400] cpuguy83: phessler: http://fnichol.github.io/knife-server/
[2013-08-13 14:32:54 -0400] phessler: cpuguy83: it doesn't even build on openbsd
[2013-08-13 14:33:18 -0400] cpuguy83: phessler: What, chef-server?
[2013-08-13 14:33:20 -0400] phessler: yes
[2013-08-13 14:33:45 -0400] gchristensen: phessler: cool. soon someone will add you to this list: http://wiki.opscode.com/display/chef/Approved+Contributors and you'll be updated to a Developer in JIRA, at which point you'll be allowed to mark it as fix-provided and it'll be applyable.
[2013-08-13 14:33:57 -0400] ankits: hey guys...has anyone run into a problem on chef "Error executing action `create` on resource 'user[jenkins]'"
[2013-08-13 14:34:09 -0400] phessler: the omnibus is adorable, because half of the bits in it are in openbsd base.
[2013-08-13 14:34:37 -0400] cpuguy83: Keep in mind it's using MANY components not Ruby, RabbitMQ, Postgres, nginx,
[2013-08-13 14:34:56 -0400] cpuguy83: PG and Nginx, shouldn't be a problem at all, but...
[2013-08-13 14:35:00 -0400] phessler: I know, we have all of the other componants in ports already
[2013-08-13 14:35:26 -0400] phessler: the dependency chain is gigantish, and building it to use system pieces is horrendous
[2013-08-13 14:35:52 -0400] cpuguy83: phessler: Yeah, it's built for HA in mind, so it uses a LOT
[2013-08-13 14:36:10 -0400] cpuguy83: phessler: Did you check out knife-server?
[2013-08-13 14:36:32 -0400] phessler: cpuguy83: if the omnibus installer won't build, how will knife-server fix my problem?
[2013-08-13 14:37:22 -0400] cpuguy83: phessler: Is this a known issue?  Do you have any info on what problems you are having?
[2013-08-13 14:37:31 -0400] cpuguy83: Chef itself is just Ruby, so there should be no issue there.
[2013-08-13 14:37:43 -0400] spox: chef server isn't just ruby
[2013-08-13 14:37:47 -0400] phessler: this is for chef-server
[2013-08-13 14:38:01 -0400] phessler: it is ruby, erlang, java and I'm waiting for the next hipster language
[2013-08-13 14:38:02 -0400] spox: and i know there has been a bunch of activity around freebsd over the last couple months
[2013-08-13 14:38:07 -0400] ismell: anyone have an example of an application cookbook recipe using callbacks?
[2013-08-13 14:38:42 -0400] phessler: cpuguy83: I haven't reported any issues (I really should, I know)
[2013-08-13 14:38:45 -0400] cpuguy83: phessler: Is it a known issue?  Do you have an error to show?
[2013-08-13 14:39:00 -0400] yfeldblum: phessler, in what sense is java a hipster language?
[2013-08-13 14:39:09 -0400] phessler: yfeldblum: I'm just being a dick
[2013-08-13 14:39:35 -0400] yfeldblum: phessler, it seems like a tossup though between nodejs and go
[2013-08-13 14:42:21 -0400] ankits: Can anyone shed any light on http://tickets.opscode.com/browse/COOK-3434?
[2013-08-13 14:42:49 -0400] ankits: I would like to submit a patch but don't have any idea on what's causing this problem.
[2013-08-13 14:44:42 -0400] phessler: cpuguy83: it fails to build ncurses.  openbsd has a copy with local patches, which may or may not be causing the problem.
[2013-08-13 14:47:24 -0400] adamjk-dev: hrm, so to contribute to the opscode jenkins community cookbook, do I need to follow this: http://wiki.opscode.com/display/chef/How+to+Contribute+to+Opscode+Cookbooks
[2013-08-13 14:47:36 -0400] adamjk-dev: or, can I just fork the repo, make my own changes and attempt a pull request?
[2013-08-13 14:48:13 -0400] phessler: adamjk-dev: you need to sign the CLA
[2013-08-13 14:48:26 -0400] adamjk-dev: phessler: ok, I will dig around
[2013-08-13 14:49:57 -0400] gchristensen: is there a way I can see a list of released chef-client? versions?
[2013-08-13 14:50:22 -0400] phessler: gchristensen: is parsing the output of git an option?
[2013-08-13 14:50:32 -0400] gchristensen: adamjk-dev: yes - you need to follow http://wiki.opscode.com/display/chef/How+to+Contribute
[2013-08-13 14:50:42 -0400] adamjk-dev: gchristensen: ok thanks, I am on it
[2013-08-13 14:50:46 -0400] gchristensen: phessler: no, because a tag might be released without being released for install
[2013-08-13 14:51:23 -0400] phessler: gchristensen: then you probabaly want to parse the usual place updates are released
[2013-08-13 14:51:51 -0400] adamjk-dev: gchristensen: man, the CLA wants full name and address
[2013-08-13 14:52:01 -0400] gchristensen: I want to parse it with my eyes so I can look and determine it
[2013-08-13 14:52:37 -0400] phessler: adamjk-dev: full name is mandatory for legal purposes.  address is for ?stickers?
[2013-08-13 14:53:29 -0400] adamjk-dev: phessler: gah......
[2013-08-13 14:53:43 -0400] adamjk-dev: i dont mind full name
[2013-08-13 14:53:45 -0400] adamjk-dev: but address....
[2013-08-13 14:53:57 -0400] adamjk-dev: sigh.... whine... moan
[2013-08-13 14:53:58 -0400] phessler: afaik, only the lawyers get your address
[2013-08-13 14:55:48 -0400] adamjk-dev: lame
[2013-08-13 14:57:34 -0400] joefitzgerald: what's the best way to submit a cookbook to http://community.opscode.com/cookbooks
[2013-08-13 14:57:49 -0400] cpuguy83: knife cookbook upload
[2013-08-13 14:57:51 -0400] atomic-penguin: joefitzgerald, with knife
[2013-08-13 14:57:54 -0400] cpuguy83: ... sorry, not upload.
[2013-08-13 14:57:56 -0400] joefitzgerald: ok, thanks
[2013-08-13 14:58:13 -0400] atomic-penguin: I think its `knife cookbook site share`
[2013-08-13 14:58:22 -0400] cpuguy83: Something like that
[2013-08-13 14:58:28 -0400] atomic-penguin: There is also a knife-community plugin which looks pretty interesting
[2013-08-13 15:00:17 -0400] gzill: if I accidentally did a knife node/client delete on a group of systems, is there an easy way to get them re-added to chef? (they all have the same role)
[2013-08-13 15:02:35 -0400] atomic-penguin: gzill, probably not, because you would have deleted one-half of the key pair.  Recreate your nodes, scp your validation key to each node, run chef-client
[2013-08-13 15:02:56 -0400] atomic-penguin: gzill, ...and delete the client.pem
[2013-08-13 15:03:15 -0400] phessler: gzill: delete client:/etc/chef/*, and re-run knife bootstrap :(
[2013-08-13 15:03:26 -0400] atomic-penguin: or that
[2013-08-13 15:05:32 -0400] gzill: thanks all.  thats what I figured.  oh well.
[2013-08-13 15:06:10 -0400] gchristensen: so folks using omnibus_updater - do you pin to a version, or do you let it go with the latest release? I find both have down sides :)
[2013-08-13 15:14:55 -0400] adamjk-dev: gchristensen: do you know how I can change the ticket status?
[2013-08-13 15:15:08 -0400] adamjk-dev: gchristensen: http://tickets.opscode.com/browse/COOK-3443
[2013-08-13 15:16:04 -0400] gchristensen: adamjk-dev: once you become updated on JIRA as signed the CLA, you'll be permitted to make that change
[2013-08-13 15:16:29 -0400] adamjk-dev: gchristensen: oh ok, I submitted it all and such... must just be still updating Opscode systems
[2013-08-13 15:16:38 -0400] gchristensen: adamjk-dev: IIRC it has to be manually approved
[2013-08-13 15:16:55 -0400] gchristensen: adamjk-dev: and you'll get added here: http://wiki.opscode.com/display/chef/Approved+Contributors
[2013-08-13 15:16:58 -0400] adamjk-dev: gchristensen: oh gotcha
[2013-08-13 15:17:03 -0400] adamjk-dev: yeah i kept checking there, no love yet :)
[2013-08-13 15:28:58 -0400] joefitzgerald: when uploading to https://cookbooks.opscode.com, how do i generate a validation clientname?
[2013-08-13 15:30:38 -0400] joefitzgerald: do i need one?
[2013-08-13 15:31:07 -0400] cpuguy83: You setup a community login, then you get a private key for uploding your cookbooks
[2013-08-13 15:33:03 -0400] joefitzgerald: k done all that
[2013-08-13 15:33:07 -0400] joefitzgerald: then knife cookbook share ?
[2013-08-13 15:35:37 -0400] cpuguy83: knife cookbook site share -k YOUR_KEY_PATH -u YOUR_USERNAME
[2013-08-13 15:35:38 -0400] cpuguy83: I believe
[2013-08-13 15:36:02 -0400] joefitzgerald: knife cookbook share seems to be looking in /var/chef instead of my cookbook directory
[2013-08-13 15:36:10 -0400] cpuguy83: Took me a bit to figure it out as well... unfortunately I've only done it once, and it's not in my bash_history anymore.
[2013-08-13 15:36:21 -0400] joefitzgerald: built my cookbook using berkshelf
[2013-08-13 15:36:28 -0400] cpuguy83: joefitzgerald: knife cookbook site share --help
[2013-08-13 15:36:39 -0400] joefitzgerald: -o ?
[2013-08-13 15:36:44 -0400] cpuguy83: I believe s
[2013-08-13 15:36:48 -0400] cpuguy83: *so
[2013-08-13 15:36:53 -0400] joefitzgerald: seems weird it wouldnt look in the current directory ;)
[2013-08-13 15:37:30 -0400] cpuguy83: joefitzgerald: chef does a lot of things weird... it's still new and rough around the edges
[2013-08-13 15:38:32 -0400] joefitzgerald: $ knife cookbook site share sqlce Databases -VV -u joefitzgerald -o sqlce -k ~/.chef/joefitzgerald.pem
[2013-08-13 15:38:46 -0400] joefitzgerald:   /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-11.6.0/lib/chef/cookbook_loader.rb:106:in `[]': Cannot find a cookbook named sqlce; did you forget to add metadata to a cookbook? (http://wiki.opscode.com/display/chef/Metadata) (Chef::Exceptions::CookbookNotFoundInRepo)
[2013-08-13 15:40:09 -0400] joefitzgerald: >> from metadata.rb: name             'sqlce'
[2013-08-13 15:54:58 -0400] joefitzgerald: it seems as though the community cookbooks api has moved or gone away?
[2013-08-13 15:55:13 -0400] joefitzgerald: https://cookbooks.opscode.com/api/v1/
[2013-08-13 15:55:18 -0400] joefitzgerald: = page not found
[2013-08-13 15:56:17 -0400] joefitzgerald: https://cookbooks.opscode.com = 301 Moved Permanently
[2013-08-13 15:57:29 -0400] stormerider: likely a problem due to the recent hack?
[2013-08-13 15:57:57 -0400] Volcane: joefitzgerald: https://cookbooks.opscode.com/api/v1/cookbooks etc still works for me
[2013-08-13 15:58:10 -0400] Volcane: https://cookbooks.opscode.com/api/v1/ sanely gives a 404 yes, cos why wouldnt it
[2013-08-13 15:58:16 -0400] joefitzgerald: i gave up on knife and am now trying to use berkshelf upload <cookbookname>
[2013-08-13 15:59:01 -0400] joefitzgerald: just trying to share my cookbook on the community site, and failing
[2013-08-13 16:00:43 -0400] sparr: I have a client registering itself with my chef server via chef-client. How can it specify what role(s) it should have?
[2013-08-13 16:01:36 -0400] stormerider: bootstrap json indicating a run_list?
[2013-08-13 16:02:31 -0400] sparr: stormerider: can't use knife bootstrap
[2013-08-13 16:02:50 -0400] jbz: sparr: No, you can specify an attributes.json file to load if you're running chef-client
[2013-08-13 16:03:13 -0400] stormerider: yeah, chef-client -j file.json
[2013-08-13 16:03:24 -0400] jbz: sparr: when running in daemon mode, it loads that for first run so you can set the role etc.; after that it loads node state from teh server
[2013-08-13 16:03:59 -0400] stormerider: first _successful_ run, i should note
[2013-08-13 16:04:17 -0400] sparr: how do I specify the role in the attribute json?
[2013-08-13 16:09:47 -0400] sparr: {"run_list": ["role[sma_node]"]}
[2013-08-13 16:17:42 -0400] sparr: I'm getting a "no route to host" trying to run chef-client for the first time. How can I find out what host is producing that error? full error output: https://gist.github.com/sparr/28a5a2a518874cd6c143
[2013-08-13 16:18:22 -0400] jbz: sparr:  That is most likely whatever chef_url you have set in your client.rb
[2013-08-13 16:18:45 -0400] jbz: er, chef_server_url
[2013-08-13 16:18:56 -0400] jbz: it looks like the client is having trouble trying to contact the server to register itself.
[2013-08-13 16:19:33 -0400] sparr: hmm
[2013-08-13 16:19:49 -0400] sparr: so, the server appears to not be listening on the port I specified in my client.rb
[2013-08-13 16:19:52 -0400] sparr: which explains a failure
[2013-08-13 16:20:03 -0400] sparr: but that error message seems way off base if that's the problem
[2013-08-13 16:20:25 -0400] jbz: well, the error message comes from a library, not from chef
[2013-08-13 16:20:55 -0400] jbz: but hm, yeah
[2013-08-13 16:20:55 -0400] sparr: yep, that was the problem
[2013-08-13 16:21:01 -0400] sparr: fixed the port, fixed the issue
[2013-08-13 16:21:03 -0400] jbz: sweet
[2013-08-13 16:21:13 -0400] sparr: tempted to track down that library error and report a bug with wherever it's from
[2013-08-13 16:21:50 -0400] volker-: how can I make chef-solo more quiet? even when using "log_level :info" it still makes a lot of noise and shows diffs of the files etc.
[2013-08-13 16:22:02 -0400] gleam: pipe it to something
[2013-08-13 16:22:27 -0400] joefitzgerald: cpuguy83: got it to work: http://community.opscode.com/cookbooks/sqlce
[2013-08-13 16:22:38 -0400] jbz: volker- - 'info' is chatty.  Make it log_level :warn.
[2013-08-13 16:22:45 -0400] joefitzgerald: needed to use -o <directory above my cookbook dir>
[2013-08-13 16:23:15 -0400] sparr: volker-: debug, info, warn, error, fatal (in that order) get progressively quieter
[2013-08-13 16:27:49 -0400] dgarstang: Anyone know if knife supports using .ssh/config file?
[2013-08-13 16:28:29 -0400] phessler: knife should connect with whatever is configured in .ssh/config
[2013-08-13 16:28:48 -0400] dgarstang: phessler: Yah, pretty sure I wasn't seeing that behaviour last night.
[2013-08-13 16:29:14 -0400] volker-: sparr: the issue I run into with warn is that it doesn't show me any steps it is doing. If I use info I see every block _and_ the details like the file diff
[2013-08-13 16:29:17 -0400] phessler: for sure knife obeys .ssh/known_hosts
[2013-08-13 16:29:51 -0400] stormerider: i dont believe it follows .ssh/config, though.
[2013-08-13 16:29:53 -0400] dgarstang: phessler: Darn. Dunno what's up then. Works on the same box when I ssh to the new system. Knife ec2 server create just hangs waiting for ssh.
[2013-08-13 16:30:04 -0400] dgarstang: stormerider: No? phessler says it does.
[2013-08-13 16:30:23 -0400] phessler: I haven't looked at the code, I'm making assumptions here
[2013-08-13 16:30:26 -0400] volker-: dgarstang: check your  -G flags of 'knife ec2', that are the access groups
[2013-08-13 16:30:36 -0400] phessler: however if it *doesn't* obey .ssh/config, that is incredibly stupid
[2013-08-13 16:30:43 -0400] stormerider: i might be wrong, but istr needing to always specify -x <username> even when it's in my ssh config
[2013-08-13 16:31:23 -0400] dgarstang: volker-: Works when I ssh from the same box, so I doubt it's -G.
[2013-08-13 16:31:34 -0400] sparr: I want to search a data bag for items with an id matching the current node's first network adapter's first MAC address. This produces an error 400 Bad Request: search(:the_bag, "id:" + node['network']['interfaces']['eth0']['addresses'].keys[0].gsub('.','')) do |config|
[2013-08-13 16:31:38 -0400] dgarstang: stormerider: I'm passing -x.
[2013-08-13 16:31:47 -0400] sparr: err, first MAC address without the ...
[2013-08-13 16:31:50 -0400] sparr: damnit
[2013-08-13 16:31:57 -0400] sparr: now I see it. I replaced dots instead of colons
[2013-08-13 16:32:14 -0400] sparr: http://hwrnmnbsol.livejournal.com/148664.html
[2013-08-13 16:32:19 -0400] dgarstang: I tried several variations of what I had in .ssh/config, since I don't know if knife is ssh-ing to the public or private IP. knife ec2 server create would hang evvery time, yet sshing to the same system from the ssame host would work.
[2013-08-13 16:32:45 -0400] sparr: I envy you folks using chef on virtual machines
[2013-08-13 16:32:54 -0400] sparr: knife ec2 and knife vsphere make things so easy
[2013-08-13 16:33:03 -0400] phessler: if it looks like a duck, and quacks like a duck, then it probably tastes good with orange sauce
[2013-08-13 16:33:19 -0400] dgarstang: Then... I ran tcpdump in the background... got the IP address that knife was sshing to, and put THAT in .ssh/config. Still didn't work. This HEAVIY implies that knife ignores .ssh/config
[2013-08-13 16:34:16 -0400] phessler: mv /usr/sbin/ssh /usr/sbin/ssh.orig; echo 'echo $@; exec /usr/sbin/ssh.orig $@' >> /usr/sbin/ssh; chmod a+x /usr/sbin/ssh;
[2013-08-13 16:34:25 -0400] phessler: that will tell you exactly how knife is attempting to run it
[2013-08-13 16:34:33 -0400] phessler: (adjust as necessary)
[2013-08-13 16:34:55 -0400] phessler: actually, only one '>' is best in that
[2013-08-13 16:35:08 -0400] sparr: "syntax is left as an exercise for the reader" :)
[2013-08-13 16:35:17 -0400] phessler: >> will work, but it will append to the end of the file
[2013-08-13 16:35:22 -0400] phessler: if it doesn't exist, then it will be created
[2013-08-13 16:35:27 -0400] phessler: but in this case, appending is bad juju ;)
[2013-08-13 16:35:56 -0400] stormerider: well, you just moved it so :)
[2013-08-13 16:36:03 -0400] dgarstang: phessler: but is knife calling the ssh binary or using an ssh library?
[2013-08-13 16:36:06 -0400] phessler: sigh.  and my own ssh is in /usr/bin, not /usr/sbin
[2013-08-13 16:36:14 -0400] phessler: dgarstang: according to the docs, it is using the ssh binary
[2013-08-13 16:36:23 -0400] phessler: (that I read a month or two ago)
[2013-08-13 16:36:51 -0400] dgarstang: phessler: chef docs are .... bad... I'll give it a try
[2013-08-13 16:36:58 -0400] stormerider: i thought it used net-ssh-multi (unless that uses ssh bin under the gem hood)
[2013-08-13 16:40:21 -0400] phessler: oh my god
[2013-08-13 16:40:25 -0400] dgarstang: phessler: no output. Docs are wrong again.
[2013-08-13 16:40:26 -0400] phessler: it uses it's own implementation
[2013-08-13 16:40:32 -0400] phessler: *shudder*
[2013-08-13 16:40:57 -0400] phessler: dgarstang: no, the docs are correct.  I just mis-read them.
[2013-08-13 16:41:06 -0400] phessler: it doesn't use the ssh binary
[2013-08-13 16:41:10 -0400] phessler: (so, put it back now ;) )
[2013-08-13 16:41:11 -0400] dgarstang: phessler: Apparently so
[2013-08-13 16:44:07 -0400] mkirk_: larf5521
[2013-08-13 16:44:42 -0400] dgarstang: So, apparently knife completely ignores .ssh/config AND the -w option is useless without agent forwarding.
[2013-08-13 16:45:38 -0400] sanguisdex: what do I have to add to my runlist goe get my "users" data bags to run? I hhave created the databags and add the recipee but still no users get created
[2013-08-13 16:46:38 -0400] phessler: sanguisdex: is it added to the role *AND* the role updated on the server?
[2013-08-13 16:47:22 -0400] sanguisdex: phessler: yes I added the cookbok to the role and updated it in the server
[2013-08-13 16:48:13 -0400] dgarstang: So, since chef ignores .ssh/config.... next option is the ssh gateway, -w option, but that doesn't support agent forwarding...
[2013-08-13 16:48:34 -0400] sanguisdex: phessler: is there a place to add the databags to the role?
[2013-08-13 16:49:44 -0400] dgarstang: No one here uses knife across ssh hosts that have to go through an ssh proxy? Everyone's network is that perfectly designed?
[2013-08-13 16:50:25 -0400] phessler: dgarstang: yes ;)
[2013-08-13 16:50:34 -0400] dgarstang: phessler: *squinty eye*
[2013-08-13 16:52:04 -0400] zts: dgarstang: I tend to use mcollective, but that does sound annoying.  You could always use knife search to get a list of hosts, and feed that into some other parallel-ssh tool
[2013-08-13 16:52:45 -0400] dgarstang: zts: ugh, mcollective. Been there. Not pleasant. I'm trying to bootstrap hosts, so I dont think chef even knows about them yet.
[2013-08-13 16:52:48 -0400] Gomez_: I try to do a simple get request with chef: http://pastebin.com/QuZkRYzu
[2013-08-13 16:53:05 -0400] Gomez_: but get this errror: bad URI(is not URI?): http://127.0.0.1/?message={}
[2013-08-13 16:53:09 -0400] Gomez_: some idea?
[2013-08-13 16:53:34 -0400] zts: dgarstang: I don't tend to bootstrap hosts over ssh, either :)
[2013-08-13 16:53:56 -0400] zts: dgarstang: though if you haven't bootstrapped the host yet, I wouldn't have thought you could use knife ssh to connect to it?
[2013-08-13 16:54:04 -0400] dgarstang: zts: seemed like the simplest approach for us since we're in Amazon and now Google cloud too.
[2013-08-13 16:54:39 -0400] dgarstang: zts: the bootstrap process sshes into the box to download the chef client and configure it
[2013-08-13 16:55:55 -0400] zts: dgarstang: on AWS, I ended up using cloudinit to install the client when the instance is created (which seemed the best fit for autoscaling).  That's less of a concern if you're already orchestrating instance creation though
[2013-08-13 16:57:23 -0400] zts: ah right, I misunderstood - I thought you were talking about "knife ssh" rather than the bootstrap process (all the same ssh code though)
[2013-08-13 16:57:30 -0400] dgarstang: zts: Was trying to keep it as agnostic as possible given our multiple clouds.
[2013-08-13 16:57:45 -0400] zts: yeah, also wise
[2013-08-13 16:58:15 -0400] sparr: I don't want to have to do "chef-client -j foo.json" every time to specify its run list. Is there a way for the client to get that data stored on the server, without also being a workstation?
[2013-08-13 16:58:29 -0400] miah: you can use knife ssh to connect to any host so long as you have a ssh key and a username
[2013-08-13 16:58:43 -0400] miah: it is not reliant at all on chef-client being installed
[2013-08-13 16:59:05 -0400] miah: and fwiw. you can bootstrap machines already bootstrapped
[2013-08-13 16:59:38 -0400] zts: miah: but it is reliant on node data being in the chef server (unless, I suppose, you use fqdns for node names)
[2013-08-13 17:00:12 -0400] miah: you can specify fqdn rather than node name
[2013-08-13 17:00:50 -0400] miah: knife ssh is handy in that you can connect to many nodes as returned by a enumerated list of search results
[2013-08-13 17:00:52 -0400] sparr: if a chef recipe creates a directory and then I delete the directory, how can I get chef to recreate it?
[2013-08-13 17:00:53 -0400] miah: but you dont have to =)
[2013-08-13 17:01:06 -0400] miah: sparr: when chef-client re-runs it should create the directory
[2013-08-13 17:01:14 -0400] sparr: miah: it is not doing that
[2013-08-13 17:01:37 -0400] miah: what actions are you passing to the resource?
[2013-08-13 17:01:45 -0400] zts: indeed, but that fqdn needs to be recorded on the chef server, which will typically happen at the end of the node's first successful run.
[2013-08-13 17:01:56 -0400] miah: zts: no, it doesnt.
[2013-08-13 17:02:02 -0400] sparr: no action, so I'm hoping for the default of create
[2013-08-13 17:02:03 -0400] zts: though I guess if you're creating nodes in the server yourself, you could set that too
[2013-08-13 17:02:56 -0400] miah: actually. i just looked and i think im wrong. so ya it looks like it does need to be passed a search query
[2013-08-13 17:03:37 -0400] miah: sparr: check your logs. the directory resource should be idempotent
[2013-08-13 17:04:20 -0400] sparr: aha
[2013-08-13 17:04:27 -0400] sparr: it wasn't getting to the directory resource before bailing out
[2013-08-13 17:09:02 -0400] dgarstang: where does the knife ec2 code live locally?
[2013-08-13 17:12:05 -0400] dgarstang: *sigh* The docs for Net:SSH say the start method accepts a value which sets if .ssh/config is used. I'm in /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/knife-ec2-0.6.4 and a recursive grep of 'start' finds nothing.
[2013-08-13 17:12:59 -0400] sparr: when I expect chef to get an OS package for the package resource, how does it search?
[2013-08-13 17:13:08 -0400] sparr: that is, how do I know what to call the package
[2013-08-13 17:13:49 -0400] bean__: dgarstang: are you still having the SSH key issue
[2013-08-13 17:13:51 -0400] btm: dgarstang: knife ssh code is in core chef, see lib/chef/knife/ssh.rb
[2013-08-13 17:14:06 -0400] dgarstang: bean__: Yep
[2013-08-13 17:16:22 -0400] dgarstang: btm: found where it calls the start method. Docs say that the :config option sets if it uses .ssh/config... it's not passed, and the docs say the default is to use it... so it should work...
[2013-08-13 17:17:13 -0400] dgarstang: btm: oh I don't know. it passes concurrent_connections which isn't even in the net:ssh docs
[2013-08-13 17:19:07 -0400] mattupstate: is it possible to use the mercurial LWRP with deploy_revision?
[2013-08-13 17:19:07 -0400] btm: dgarstang: Net::SSH and Net:SSH:Multi are not the same thing.
[2013-08-13 17:19:18 -0400] dgarstang: btm: k. *regoogles*
[2013-08-13 17:19:51 -0400] btm: dgarstang: Do you have a bug filed for your issue? I've dug around this code a lot. Net::SSH::Multi wraps Net::SSH.
[2013-08-13 17:20:15 -0400] dgarstang: btm: no bug. Was trying to work around it so I could move forward.
[2013-08-13 17:20:25 -0400] btm: dgarstang: can you sum up your issue?
[2013-08-13 17:20:29 -0400] joelnn: setting "supports :manage_home => true" on a user resource does not lead to the home directory being created. I must be missing something obvious?
[2013-08-13 17:20:38 -0400] dgarstang: btm: knife ec2 server create ignores .ssh/config file.
[2013-08-13 17:20:53 -0400] btm: dgarstang: what setting in particular?
[2013-08-13 17:21:15 -0400] dgarstang: btm: the whole file, but the target is behind a ProxyHost hop
[2013-08-13 17:21:34 -0400] btm: joelnn: does the user already exist? e.g. did you create the user, then set manage_home to true, then run Chef again?
[2013-08-13 17:21:53 -0400] joelnn: btm: initially I did, but I started over since then. also deluser'd and it didn't help
[2013-08-13 17:22:06 -0400] joelnn: started over = new VM
[2013-08-13 17:22:06 -0400] miah: also pass the :manage action =)
[2013-08-13 17:22:18 -0400] miah: so that the user will be updated on further runs
[2013-08-13 17:22:31 -0400] joelnn: hm so how would I do this in one shot, action [:create, :manage] ?
[2013-08-13 17:22:42 -0400] miah: yes
[2013-08-13 17:23:21 -0400] dgarstang: no docs on how to get Net:SSH:Multi to read .ssh/config that I can find.
[2013-08-13 17:23:29 -0400] volker-: chef is used for system configuration/management. How do you deploy your software? Chef? Ruby/Python/Shellscripts?
[2013-08-13 17:23:31 -0400] joelnn: alright thanks. I don't expect that to fix my current problem though, right
[2013-08-13 17:23:59 -0400] btm: dgarstang: you're not using an ancient version of Chef are you? I fixed up loading per host settings from .ssh/config in CHEF-3577 in 10.16.4.
[2013-08-13 17:24:01 -0400] joelnn: I tried "-l debug" to see what useradd command chef is running
[2013-08-13 17:24:04 -0400] joelnn: doesn't show
[2013-08-13 17:24:05 -0400] cpuguy83: volker-: Chef has a Deloy resource, it is similar to Capistrano
[2013-08-13 17:24:17 -0400] dgarstang: btm: I grabbed the newest 11.6 client about an hour ago.
[2013-08-13 17:24:21 -0400] volker-: cpuguy83: does it work with chef solo?
[2013-08-13 17:24:38 -0400] cpuguy83: volker-: I haven't used it, but I'd imagine it just gets pulled into a cookbook, so yes.
[2013-08-13 17:24:56 -0400] btm: dgarstang: you can how I loaded config settings on this line: https://github.com/opscode/chef/blob/master/lib/chef/knife/ssh.rb#L184
[2013-08-13 17:25:14 -0400] dgarstang: btm: i ran tcpdump, got the ip of the host that knife is connecting to, put that in the ProxyHost, and still no dice. When I do the ssh command to that host from the same box, works
[2013-08-13 17:25:45 -0400] dgarstang: btm: github a little slow today
[2013-08-13 17:26:49 -0400] volker-: cpuguy83: so how do you deploy your stuff?
[2013-08-13 17:27:03 -0400] cpuguy83: volker-: I haven't gotten that far yet.  Today I use capistrano
[2013-08-13 17:27:48 -0400] dgarstang: btm: So... is the default to use .ssh/config ?
[2013-08-13 17:28:48 -0400] joelnn: if "chef-solo -l debug" doesn't show the shell command(s) that are creating a user, is there a way to get even more verbose output?
[2013-08-13 17:29:22 -0400] volker-: cpuguy83: be lucky, capistrano is kinda automated :)
[2013-08-13 17:30:04 -0400] cpuguy83: volker-: Chef::Deploy is basically the same.
[2013-08-13 17:32:21 -0400] btm: dgarstang: so I suspect you need to read your configuration value out of ssh_config there and place it in the corresponding value in session_opts, as is the pattern in #session_from_list. I also gather you need to create a Net::SSH:Proxy object there and pass that object to Net::SSH in session_opts[:proxy]
[2013-08-13 17:32:55 -0400] dgarstang: btm: sounds like your talking about modifying the code.
[2013-08-13 17:33:32 -0400] btm: joelnn: -l debug should do it. some providers still use older methods for running commands that don't capture output well.
[2013-08-13 17:34:08 -0400] btm: dgarstang: yes. in fact, I just found the ticket: http://tickets.opscode.com/browse/CHEF-2447
[2013-08-13 17:34:39 -0400] dgarstang: btm: oh darn. Ok.
[2013-08-13 17:36:09 -0400] dgarstang: btm: plan B... know if agent forwarding is an option? -w (as an alternative to using .ssh/config) is kinda useless without it.
[2013-08-13 17:42:57 -0400] joelnn: https://gist.github.com/joelnn/0003a6e546e6b6fc536d am I crazy? @manage_home attribute is set to false, though I said 'supports :manage_home => true' ?
[2013-08-13 17:43:07 -0400] btm: dgarstang: yeah, knife ssh takes '-A' and passes it to Net::SSH.
[2013-08-13 17:44:32 -0400] dsteen: hi all.  I'm bootstrapping a rhel5 box, but the ohai data for networks doesn't seem to be being populated
[2013-08-13 17:44:45 -0400] dsteen: it shows up on the chef server, but when I run ohai on the client
[2013-08-13 17:44:58 -0400] dsteen: or when I run chef-shell it shows up as empty
[2013-08-13 17:45:02 -0400] dsteen: anyone seen this before?
[2013-08-13 17:45:18 -0400] dgarstang: btm: I have the latest chef and the latest knife ec2 and my -A is '-A, --aws-access-key-id KEY      Your AWS Access Key ID'
[2013-08-13 17:47:56 -0400] sparr: a bash script is failing to have the desired output during one of my recipes
[2013-08-13 17:48:41 -0400] bdha: Bit surprised that ohai doesn't contain the nodes environment. Or am I missing something?
[2013-08-13 17:50:18 -0400] btm: dgarstang: unfortunate overlap probably that mixlib-cli ( the library that handles the command line options) can't handle. knife ssh -A is new in 11.6.0. (http://tickets.opscode.com/browse/CHEF-3779)
[2013-08-13 17:50:41 -0400] joelnn: hm, figured out my issue. if you don't specify a 'home' attribute value, then the home directory is not created. though the user is still added to /etc/passwd with a home directory that then does not exist
[2013-08-13 17:51:13 -0400] btm: dsteen: are you running ohai as root?
[2013-08-13 17:51:14 -0400] joelnn: would be nice if the useradd provider gave a warning in this case. I expected it to just take the default of /home/#{user}
[2013-08-13 17:53:13 -0400] sanguisdex: how do I create a DataBagItemID?
[2013-08-13 17:53:53 -0400] dgarstang: btm: ok, but I downloaded chef 11.6.0-1 today, and my knife ec2 server create -h shows -A as aws-access-key-id, not agent forwarding.
[2013-08-13 17:54:10 -0400] dsteen: @btm no.  I'll try that.
[2013-08-13 17:54:27 -0400] sparr: joelnn: that mirrors the behavior of unix useradd. adduser is the one that creates home directories by default :)
[2013-08-13 17:54:27 -0400] dsteen: @btm same result unfortunately
[2013-08-13 17:55:16 -0400] joelnn: sparr: good point. though I think a warning would still be nice, since I've indicated that I want the provider to create the home dir
[2013-08-13 17:55:32 -0400] btm: dsteen: oh. it could be your path and ohai can't find the binaries (ohai -l debug and comb through the output) try: PATH=/bin:/sbin:/usr/bin:/usr/sbin ohai
[2013-08-13 17:55:56 -0400] btm: joelnn: be sure to file a bug if you think so.
[2013-08-13 17:56:06 -0400] dsteen: @btm. I'll check that thanks!
[2013-08-13 17:56:10 -0400] jbz: Anyone here knowledgeable about new chef server versions and their availability?
[2013-08-13 17:56:14 -0400] sparr: joelnn: how did you indicate that without specifying a location?
[2013-08-13 17:56:25 -0400] dsteen: @btm yep. that was it.
[2013-08-13 17:56:31 -0400] dsteen: thanks!
[2013-08-13 17:56:35 -0400] lawnchair: btm, you are #1
[2013-08-13 17:56:43 -0400] joelnn: sparr: supports :manage_home => true
[2013-08-13 17:56:58 -0400] joelnn: btm: ok thanks I will
[2013-08-13 17:57:07 -0400] btm: jbz: new chef server versions, like what?
[2013-08-13 17:57:58 -0400] jbz: @btm: We got hit hard by http://tickets.opscode.com/browse/CHEF-3975 - we're on 11.0.6 - wondering if I need to wait for 11.0.10, or should I try to downgrade to 11.0.4, etc.
[2013-08-13 17:59:05 -0400] dgarstang: btm: I downloaded chef 11.6.0-1 today, and my knife ec2 server create -h shows -A as aws-access-key-id, not agent forwarding.
[2013-08-13 17:59:09 -0400] jbz: @btm not knowing when 11.0.10 is due, I'm having trouble deciding which is a better plan - wait or try to downgrade (actually don't know for sure if that bug *doesn't* hit lower 11.x versions anyway).
[2013-08-13 17:59:50 -0400] btm: dgarstang: right. it is -A in knife, but the knife plugins inherit knife's options and then put theirs over the top, silently overwriting them.
[2013-08-13 18:00:05 -0400] btm: jbz: I know when all things are due, hold on a sec. ;)
[2013-08-13 18:00:20 -0400] jbz: @btm woohoo! :-)  Holding at your convenience.
[2013-08-13 18:00:56 -0400] dgarstang: btw: i think your saying I'm SOL.
[2013-08-13 18:03:27 -0400] dgarstang: btm: i think your saying I'm SOL.
[2013-08-13 18:03:30 -0400] btm: dgarstang: it doesn't sound like you're into hacking the code, so it'd be best to file a bug against knife-ec2 and wait for someone else to fix it.
[2013-08-13 18:04:03 -0400] dgarstang: btm: K. Can't get my head around ruby.
[2013-08-13 18:04:36 -0400] dgarstang: btm: actually  I think there's already a bug http://tickets.opscode.com/browse/CHEF-2447
[2013-08-13 18:05:55 -0400] mattupstate: anyone know if its possible to use mercurial with deploy_revision?
[2013-08-13 18:06:22 -0400] btm: dgarstang: CHEF-2447 is for passing proxy settings ; we could use another bug against knife-ec2 for not being able to use ssh forwarding due to the -A config flag overlap.
[2013-08-13 18:06:49 -0400] joelnn: btm: fyi I filed http://tickets.opscode.com/browse/CHEF-4454, thanks for the encouragement
[2013-08-13 18:06:49 -0400] btm: dgarstang: (try knife ec2 server create --forward-agent ....)
[2013-08-13 18:07:48 -0400] btm: jbz: We're on schedule for OSC Server 11.0.10 in September. It's a small release, as server releases are, so we haven't done any work yet. So on schedule just means, "yup, still planning on doing it."
[2013-08-13 18:07:51 -0400] dgarstang: btm: nah it throws up the help when I pass --forward-agent
[2013-08-13 18:08:03 -0400] btm: dgarstang: mixlib-cli is evil.
[2013-08-13 18:08:11 -0400] jbz: @btm hm OK thanks.
[2013-08-13 18:09:17 -0400] btm: dgarstang: you might try editing lib/chef/knife/ec2_base.rb and removing  line 102: :short => "-A ID",
[2013-08-13 18:09:47 -0400] btm: jbz: so I'll be super grumpy with people for everyone if OSC 11.0.10 doesn't come out next month. :)
[2013-08-13 18:10:04 -0400] jbz: @btm Heh I happily delegate my proxy grump to you.
[2013-08-13 18:10:31 -0400] jbz: Now I just gotta find out from folks here if that bug can wait until end of September to be resolved here
[2013-08-13 18:11:39 -0400] elliottt: hi all, i'm trying to use chef-solo with vagrant to deploy a git repo to a vm, and am running into some fun problems :)
[2013-08-13 18:11:47 -0400] elliottt: i think they're all related to me
[2013-08-13 18:12:08 -0400] elliottt: i'm trying to deploy from a git submodule, but it looks like the vm needs to be able to address the repo, is this correct?
[2013-08-13 18:17:53 -0400] elliottt: an easier question might be, how can i use remote_directory with a local path that's not relative to the cookbook invoking it?
[2013-08-13 18:18:18 -0400] sanguisdex: I am a t a complete loss how do I create system users in a bootstrap process do I have to create a custom cookbook or should the users cookbook do it?
[2013-08-13 18:19:10 -0400] sanguisdex: am I not asking the question right? is the above not understandable? is the ablve not what chef does?
[2013-08-13 18:19:42 -0400] jessicab: sanguisdex: you could also just use the user resource
[2013-08-13 18:20:55 -0400] jessicab: sanguisdex: youd just add this resource to your own cookbook - http://docs.opscode.com/resource_user.html
[2013-08-13 18:22:25 -0400] sanguisdex: jessicab: thanks
[2013-08-13 18:22:52 -0400] elliottt: jessicab: is there a way to use an absolute path for the source of a remote_directory?
[2013-08-13 18:23:00 -0400] elliottt: (say, from an attribute)
[2013-08-13 18:23:44 -0400] jessicab: elliottt: what are you trying to do with it? it sounds like you might be using it oddly? remote_directory is really just cookbook_directory.. takes a dir from within files and copies it
[2013-08-13 18:24:02 -0400] dgarstang:  Errr... did a forgot username thing on the opscode side, it emailed me the username and now when I try and login I get 'The user cannot be found'.
[2013-08-13 18:24:15 -0400] elliottt: jessicab: i'm probably using it oddly :)
[2013-08-13 18:24:28 -0400] elliottt: i have a cookbook that will deploy a web app, and just wanted to copy everything over
[2013-08-13 18:24:58 -0400] elliottt: the reason being, the cookbook and web app source are in the same repo, and the repo won't be accessible once deployment is happening
[2013-08-13 18:25:14 -0400] elliottt: it's a weird environment -_-
[2013-08-13 18:25:49 -0400] jessicab: elliottt: ah yea, ive never found an easy way to copy.. i usually just execute a cp command.. in one script i do a file read with ruby to edit some values before pasting it somewhere with the file resource, but thats way too much work for more than one file
[2013-08-13 18:26:09 -0400] elliottt: jessicab: ok, so i could shell out to scp, or something?
[2013-08-13 18:26:19 -0400] elliottt: maybe i should just write a makefile to finish the whole thing off
[2013-08-13 18:26:37 -0400] jessicab: or set it up as a file share, then you should just be able to use cp
[2013-08-13 18:26:50 -0400] jbz: Lazyquestion:  Do folks here have a preferred cookbook for managing CentOS virtual network interfaces? A troll through the cookbook site came up with some deb/ubu only solutions.
[2013-08-13 18:27:01 -0400] jessicab: elliottt: i doubt scp would work actually, since it has a password prompt
[2013-08-13 18:27:17 -0400] elliottt: could do it with a key
[2013-08-13 18:29:58 -0400] elliottt: ok, thanks for the help jessicab :)
[2013-08-13 18:32:34 -0400] gchristensen: jessicab: couldn't elliottt have used an SSH key?
[2013-08-13 18:35:51 -0400] sparr: is there a way to capture/output stdout from a bash script being run by Chef::Provider::Script::Bash ?
[2013-08-13 18:37:02 -0400] ziviani: hi everyone, I tried to bootstrap a PPC64 node but the install.sh couldn't find the package (https://www.opscode.com/chef/download?v=11.6.0&prerelease=false&p=el&pv=6&m=ppc64). Does chef client support PPC64?
[2013-08-13 18:42:45 -0400] jessicab: gchristensen: yea, but then youd be downloading it with cookbook_file, and specifying the path in the scp command.. just seems messy to me? but if he couldnt just turn it into a file share it isnt that bad i guess.. ive never tried scp that way though.. just my guess
[2013-08-13 18:42:57 -0400] gchristensen: aye
[2013-08-13 18:44:27 -0400] MrBIOS: hi there, I'm running the latest version of Chef server (11.0.8-1) from the omnibus deb package, and am having a problem in the WebUI whereby the environment for a node seems to keep resetting to default any time it gets edited
[2013-08-13 18:44:54 -0400] geekbri: Is there a good write up anywhere on what the "converge_by" method does?
[2013-08-13 18:44:58 -0400] geekbri: or should I just go read the source
[2013-08-13 18:45:19 -0400] miah: read the source luke
[2013-08-13 18:45:33 -0400] jessicab: sparr: ive done that with ruby before.. like system() will give you return codes, and %x[] will give you the output
[2013-08-13 18:45:57 -0400] sparr: %x[] ?
[2013-08-13 18:46:15 -0400] miah: its a percent literal for executing things via system()
[2013-08-13 18:46:30 -0400] jessicab: sparr: its the same as backticks, but i think it looks better - http://rubyquicktips.com/post/5862861056/execute-shell-commands
[2013-08-13 18:46:34 -0400] miah: http://chillibear.org/2012/03/ruby-percent-syntax-percent-functions.html
[2013-08-13 18:46:51 -0400] miah: its certainly more readable than ``
[2013-08-13 18:46:59 -0400] sparr: ahh
[2013-08-13 18:47:11 -0400] sparr: I am using a bash resource
[2013-08-13 18:47:20 -0400] sparr: you're suggesting I use a ruby script resource, and run the bash inside the ruby?
[2013-08-13 18:47:44 -0400] miah: i personally using the bash/script resource as much as possible.
[2013-08-13 18:47:50 -0400] miah: +avoid
[2013-08-13 18:47:59 -0400] miah: parsing command output is a good way to get into trouble
[2013-08-13 18:48:08 -0400] jessicab: sparr: yea, i dont think you can get output with chef though? theres two ways you can use that.. within an only_if or not_if to guard a resource.. or external to the chef entirely
[2013-08-13 18:48:25 -0400] sparr: ahh, ok
[2013-08-13 18:48:29 -0400] sparr: miah: not doing any parsing
[2013-08-13 18:48:35 -0400] sparr: I just want to *see* it
[2013-08-13 18:48:39 -0400] sparr: in the log/output
[2013-08-13 18:48:45 -0400] miah: ah
[2013-08-13 18:48:45 -0400] jessicab: well, still within the cookbook.. but its separate from the chef resource
[2013-08-13 18:48:48 -0400] sparr: the bash script takes like a half hour to run
[2013-08-13 18:49:01 -0400] miah: wow
[2013-08-13 18:49:02 -0400] sparr: some progress feedback would be nice :)
[2013-08-13 18:49:14 -0400] miah: most programs use exit status =)
[2013-08-13 18:49:25 -0400] miah: https://en.wikipedia.org/wiki/Exit_status#POSIX
[2013-08-13 18:49:57 -0400] sparr: progress
[2013-08-13 18:49:59 -0400] sparr: not finishing
[2013-08-13 18:50:01 -0400] jessicab: hm.. %x[] might not work for that btw, those commands wait for the command to complete before doing output normally.. and a lot of them timeout around 5 minutes
[2013-08-13 18:50:04 -0400] sparr: I want to know how fast it's downloading, etc
[2013-08-13 18:50:14 -0400] sparr: if I run the script manually, it tells me stuff on stdout
[2013-08-13 18:50:20 -0400] sparr: what it's downloading, unzipping, etc
[2013-08-13 18:50:39 -0400] miah: ya. i'd just rewrite the bash script in ruby/chef personally =)
[2013-08-13 18:51:08 -0400] miah: but i dont know what i could recommend to help you out there
[2013-08-13 18:51:16 -0400] miah: hopefully you dont have to watch chef run on every server
[2013-08-13 18:51:22 -0400] jessicab: yea, miahs advice sounds a lot better for that problem.. pretty sure then chef would print that output to the logs
[2013-08-13 18:51:35 -0400] miah: ya, and you can just use Chef::Log.info
[2013-08-13 18:51:49 -0400] sparr: it's a crazy amount of code
[2013-08-13 18:51:58 -0400] sparr: it's actually a little bit of bash that calls an ant script
[2013-08-13 18:52:07 -0400] miah: oh. ant.
[2013-08-13 18:52:07 -0400] sparr: http://ant.apache.org/
[2013-08-13 18:52:18 -0400] sparr: the ant script is some thousands of lines
[2013-08-13 18:52:35 -0400] miah: ya. so im basically dealing with something similar. in that. elasticsearch includes a 'plugin' installer. but it has numerous problems.
[2013-08-13 18:52:45 -0400] sparr: it fetches a bunch of metadata about available files in a network repository, builds a desired local directory tree based on that metadata and downloads it all
[2013-08-13 18:53:03 -0400] sparr: non-trivial to reimplement
[2013-08-13 18:53:10 -0400] sparr: and if i did that, then we would have two implementations of the same process
[2013-08-13 18:53:11 -0400] miah: to solve your problem, i'd probably setup a build for that on jenkins and just distribute the build
[2013-08-13 18:53:15 -0400] sparr: maintenance headache
[2013-08-13 18:53:27 -0400] miah: rather than rebuilding it on each system
[2013-08-13 18:53:42 -0400] sparr: that's in the works, but getting stuff into jenkins around here takes a long time
[2013-08-13 18:53:45 -0400] sparr: (months)
[2013-08-13 18:53:47 -0400] miah: doing the same for rbenv type stuff. no need to build ruby on each server
[2013-08-13 18:54:15 -0400] miah: 'sorry i cant do my job as im being blocked by (jenkins team)'
[2013-08-13 18:54:27 -0400] sparr: everyone up the chain and back down to that team knows
[2013-08-13 18:54:31 -0400] sparr: I've still got a deadline
[2013-08-13 18:54:34 -0400] sparr: I'm glad I got the ant script at all
[2013-08-13 18:54:36 -0400] miah: ya. sorry dude.
[2013-08-13 18:54:39 -0400] sparr: I was going to have to implement it myself
[2013-08-13 18:54:46 -0400] sparr: which I'd have done in ruby :)
[2013-08-13 18:54:49 -0400] miah: haha ya
[2013-08-13 18:54:55 -0400] sparr: threatening to do that is what got me the ant script
[2013-08-13 18:55:09 -0400] sparr: there's already a jenkins build to run it
[2013-08-13 18:55:11 -0400] miah: mixlib-cli might have the right juice for you
[2013-08-13 18:55:16 -0400] sparr: but it targets a remote file store for the destination
[2013-08-13 18:55:23 -0400] sparr: the files I want are in the building I'm in
[2013-08-13 18:55:30 -0400] sparr: jenkins assembles them onto a server a thousand miles away
[2013-08-13 18:55:44 -0400] sparr: assembling them myself, here, is faster than downloading the assembled version from that server :(
[2013-08-13 18:55:50 -0400] miah: ah yes. im familiar with this problem. 'large corporation syndrome'
[2013-08-13 18:56:08 -0400] miah: too big to actually be agile
[2013-08-13 18:56:58 -0400] dgarstang: Darn. Would have liked to use knife ec2 server create to provision boxes, but since knife ssh is broken, I've got to bake the chef client (and the validator.pem) into the images.
[2013-08-13 18:57:34 -0400] nicgrayson: dgarstang: knife ec2 server create should auto bootstrap once the instance is up
[2013-08-13 18:58:33 -0400] dgarstang: nicgrayson: Nope.... knife ec2 server create ignores .ssh/config. Using -w also doesn't work as agent forwarding is not enabled yet
[2013-08-13 18:59:19 -0400] nicgrayson: dgarstang: i used it this morning to bootstrap
[2013-08-13 18:59:40 -0400] dgarstang: nicgrayson: Was your target behind a ProxyHost?
[2013-08-13 18:59:57 -0400] bean__: nicgrayson: he's doing a weird setup -- he has a ssh gateway box he has to use.
[2013-08-13 19:00:06 -0400] dgarstang: bean__: not that weird...
[2013-08-13 19:00:39 -0400] bean__: dgarstang: I only say weird because it's not how nicgrayson or I do it. :)
[2013-08-13 19:01:17 -0400] dgarstang: bean__: *squinty eye* We have hosts in seperate amazon regions. Some regions are tunnelled into a single ip space, and some are not.
[2013-08-13 19:02:36 -0400] sparr: how do I get the chef server to remember the role/runlist/etc a client uses when run with "chef-client -j foo.json"
[2013-08-13 19:02:37 -0400] sparr: ?
[2013-08-13 19:06:06 -0400] sparr: dgarstang: I'm trying to get cobbler to serve client.rb and validator.pem to my freshly imaged systems
[2013-08-13 19:06:13 -0400] sparr: so you're in good company :)
[2013-08-13 19:06:46 -0400] miah: how are you liking cobbler? i havent used it, read about it, but could never get anyplace i worked to implement it. now i mostly deal with ami's, and virtualbox's
[2013-08-13 19:07:48 -0400] dgarstang: sparr: lucky you... your on real hardware. :)
[2013-08-13 19:08:07 -0400] sparr: miah: better than anything else I've used. light on documentation, though
[2013-08-13 19:08:19 -0400] sparr: dgarstang: I'd trade it for knife vsphere or knife ec2 in a heartbeat
[2013-08-13 19:12:39 -0400] dgarstang: Argh. I really wanted to use knife to bootstrap boxes. I don't like creating and maintaining images with the chef client and validator pem baked in
[2013-08-13 19:13:11 -0400] adnichols: dgarstang enable agent forwarding on your gateway?
[2013-08-13 19:13:30 -0400] dgarstang: adnichols: knife needs to support it, and it does not.
[2013-08-13 19:13:50 -0400] dgarstang: adnichols: I could put the private key on the gateway... :-O
[2013-08-13 19:14:09 -0400] bean__: depends on how much you trust the gateway server ;)
[2013-08-13 19:14:25 -0400] adnichols: dgarstang does it support using an agent if you run knife on the gateway host vs. using the --gateway option?
[2013-08-13 19:15:03 -0400] adnichols: I use knife ssh in the former scenario all the time
[2013-08-13 19:16:17 -0400] dgarstang: adnichols: haven't tried that because I'd have to install the extra stuff on the gateway host.
[2013-08-13 19:16:35 -0400] adnichols: dgarstang understood - you would
[2013-08-13 19:16:40 -0400] dgarstang: adnichols: ssh works though
[2013-08-13 19:21:55 -0400] adnichols: dgarstang interestingly knife ssh works fine for me using an agent via a gateway
[2013-08-13 19:22:08 -0400] adnichols: and it appears to even look at the ssh config for the gateway entry since I use an alias name for it
[2013-08-13 19:22:33 -0400] dgarstang: adnichols: What does your -A option have?
[2013-08-13 19:22:51 -0400] dgarstang: adnichols: btm said earlier that knife didn't use .ssh/config and there's also open bugs on that
[2013-08-13 19:23:13 -0400] j^2: yo
[2013-08-13 19:23:15 -0400] adnichols: dgarstang I don't pass -A - have ForwardAgent yes in my .ssh/config
[2013-08-13 19:23:32 -0400] adnichols: dgarstang perhaps knife ssh & knife bootstrap have different limitations
[2013-08-13 19:23:36 -0400] dgarstang: adnichols: grr, but it's not reading .ssh/config. It was was reading that, i'd use ProxyHost instead.
[2013-08-13 19:23:58 -0400] dgarstang: adnichols: I also have ForwardAgent in my .ssh/config anyway
[2013-08-13 19:25:42 -0400] adnichols: does knife ssh work for you through your gateway?
[2013-08-13 19:25:52 -0400] adnichols: .. not trying to bootstrap
[2013-08-13 19:26:12 -0400] dgarstang: adnichols: lemme see
[2013-08-13 19:32:06 -0400] dgarstang: adnichols: knife ssh keeps giving me ... FATAL: No nodes returned from search!
[2013-08-13 19:33:01 -0400] adnichols: sounds like a query problem - just use a hostname: knife ssh 'name:hostname'...
[2013-08-13 19:33:16 -0400] adnichols: where hostname is replaced by an actual hostname
[2013-08-13 19:33:31 -0400] adnichols: assuming you use hostnames to name your nodes :)
[2013-08-13 19:33:39 -0400] jessicab: dgarstang: you can also test the search string with knife search node 'string'
[2013-08-13 19:34:05 -0400] dgarstang: adnichols: This is really frustrating. Does it want a valid fqdn or a chef node name?
[2013-08-13 19:34:15 -0400] adnichols: node name for name:
[2013-08-13 19:34:25 -0400] adnichols: and you can use wildcards - name:something*
[2013-08-13 19:34:39 -0400] dgarstang: Well it looks like it's trying to use a fqdn... cuz 'knife ssh -A 'name:test51'' gets me 'WARNING: Failed to connect to  -- SocketError: getaddrinfo: Name or service not known'
[2013-08-13 19:35:09 -0400] adnichols: yep
[2013-08-13 19:35:12 -0400] adnichols: so add -a fqdn to that
[2013-08-13 19:35:19 -0400] adnichols: or -a ipaddress
[2013-08-13 19:35:33 -0400] dgarstang: knife ssh -A 'name:test51' -a fqdn ???
[2013-08-13 19:35:48 -0400] adnichols: yeah -a means use this attribute as the hostname to connect to
[2013-08-13 19:36:03 -0400] jessicab: doesnt it use fqdn by default?
[2013-08-13 19:36:05 -0400] dgarstang: sorry, Im lost.
[2013-08-13 19:36:26 -0400] dgarstang: nodename is test51. fqdn is ec2-54-219-1-109.us-west-1.compute.amazonaws.com
[2013-08-13 19:36:51 -0400] adnichols: knife ssh 'name:test51' 'uptime' -a ipaddress
[2013-08-13 19:37:07 -0400] jessicab: hes not saying to put -a your fqdn btw, its litterally '-a fqdn' -a is just the attribute chef uses to connect
[2013-08-13 19:37:13 -0400] adnichols: but you're testing through a gateway so really you want to add --ssh-gateway <gateway> to that command
[2013-08-13 19:37:39 -0400] dgarstang: knife ssh 'name:test51' 'uptime' -a fqdn == 'WARNING: Failed to connect to  -- SocketError: getaddrinfo: Name or service not known'
[2013-08-13 19:37:43 -0400] adnichols: yeah, literaly the command I have above - do not replace 'ipaddress' with anything
[2013-08-13 19:37:58 -0400] adnichols: right, because your client can't resolve the hostname - but your gateway can?
[2013-08-13 19:38:08 -0400] dgarstang: adnichols: dns resolves just fine
[2013-08-13 19:38:16 -0400] adnichols: or use ipaddress instead of fqdn then
[2013-08-13 19:39:07 -0400] dgarstang: knife ssh 'name:test51' 'uptime' -a ipaddress == 'FATAL: 1 node found, but does not have the required attribute to establish the connection. Try setting another attribute to open the connection using --attribute.'
[2013-08-13 19:39:29 -0400] jessicab: personally, id take a step back and try 'knife search node 'name:test51' and make sure the fqdn or ipaddress there is one you could actually ssh to
[2013-08-13 19:39:44 -0400] jessicab: its possible that nothing could be there, if the run didnt finish or something
[2013-08-13 19:39:45 -0400] adnichols: jessicab fair - good to check
[2013-08-13 19:39:56 -0400] adnichols: or knife node show test51 -l
[2013-08-13 19:40:06 -0400] jessicab: yea, or that :P
[2013-08-13 19:40:26 -0400] dgarstang: knife node search shows the FQDN as 'test51.c.bitcasa-inc.internal'. Well, that's not gonna work. WAT!?
[2013-08-13 19:40:30 -0400] dgarstang: oops
[2013-08-13 19:40:52 -0400] adnichols: is this a node you can ssh to directly from the host you are running knife ssh on?
[2013-08-13 19:41:07 -0400] adnichols: if not, add the --ssh-gateway option, that's what I was suggesting you test anyhow
[2013-08-13 19:41:11 -0400] dgarstang: adnichols: yep... via the ProxyHost in .ssh/config
[2013-08-13 19:41:23 -0400] adnichols: I'm not talking about proxyhost in the config :)
[2013-08-13 19:41:31 -0400] adnichols: I'm talking about the --ssh-gateway option
[2013-08-13 19:41:39 -0400] adnichols: I realize they do the same thing for ssh
[2013-08-13 19:41:45 -0400] adnichols: I suspect they do not for knife ssh
[2013-08-13 19:41:50 -0400] freerobby: Is there a best practice for putting a secret key for encrypted data bags on a server when bootstrapping it?
[2013-08-13 19:41:51 -0400] dgarstang: does it matter that chef has the wrong, unusable value for FQDN?
[2013-08-13 19:42:06 -0400] adnichols: dgarstang not if you use the ip - but you have to find the right attribute name
[2013-08-13 19:42:31 -0400] adnichols: my hosts have an ipaddress attribute that works - see above for command to see all attributes & review what has an entry for the IP
[2013-08-13 19:42:47 -0400] freerobby: dgarstang: This might be helpful for ya. https://github.com/freerobby/chef-ohai-public_ip
[2013-08-13 19:43:15 -0400] dgarstang: knife ssh 'name:test51' 'uptime' -a ipaddress -G 10.36.0.2 -x bcadmin == 'FATAL: 1 node found, but does not have the required attribute to establish the connection. Try setting another attribute to open the connection using --attribute.'
[2013-08-13 19:43:59 -0400] adnichols: knife node show test51 -l | less
[2013-08-13 19:44:03 -0400] adnichols: find ipaddress
[2013-08-13 19:44:09 -0400] adnichols: .. or confirm it's lacking
[2013-08-13 19:44:36 -0400] dgarstang: adnichols: knife node show test51 -l | grep ipaddress .... nuthin
[2013-08-13 19:44:47 -0400] adnichols: well that's a problem :)
[2013-08-13 19:44:57 -0400] adnichols: is this a node that has successfully bootstrapped?
[2013-08-13 19:45:01 -0400] adnichols: or do you have a node that has?
[2013-08-13 19:45:08 -0400] dgarstang: adnichols: well the bootstrap never completed, because it couldn't ssh in. box is up
[2013-08-13 19:45:14 -0400] adnichols: yeah, ok
[2013-08-13 19:45:25 -0400] adnichols: is there one you've already bootstrapped you can use to test this?
[2013-08-13 19:45:46 -0400] dgarstang: adnichols: that chef is aware of? No... chicken and egg problem.
[2013-08-13 19:46:32 -0400] iverson0881: hi, is it possible to create a chef template file without the new line at the end of the file?
[2013-08-13 19:46:58 -0400] adnichols: iverson0881 if you don't put a newline at the end of your template it wont be in the file
[2013-08-13 19:47:09 -0400] iverson0881: yeah i just realized that as i typed that out
[2013-08-13 19:47:11 -0400] iverson0881: lol
[2013-08-13 19:47:12 -0400] jessicab: dgarstang: what about ec2.public_hostname? got that attribute on the node?
[2013-08-13 19:47:17 -0400] adnichols: dgarstang well then we can't test knife ssh :)
[2013-08-13 19:48:01 -0400] dgarstang: i dunno, taking a step back, This is a giant mess.
[2013-08-13 19:48:26 -0400] adnichols: dgarstang haha can't be that giant :)
[2013-08-13 19:48:29 -0400] jessicab: dgarstang: this page makes it sounds like thats the solution.. has lots of info on this problem - http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide#EC2BootstrapFastStartGuide-Step6:Runchef-clientonthenewclientnode
[2013-08-13 19:48:31 -0400] dgarstang: Shouldn't be this hard.
[2013-08-13 19:49:28 -0400] dgarstang: jessicab: Yeah that don't work....
[2013-08-13 19:49:50 -0400] adnichols: dgarstang I'd guess knife node show for that node doesn't show much
[2013-08-13 19:49:56 -0400] dgarstang: jessicab: chef doesn't run on the node, because it isn't ssh-ing into it.
[2013-08-13 19:49:59 -0400] adnichols: meaning no useful attributes
[2013-08-13 19:50:11 -0400] jessicab: yea, just weird that fqdn was saved
[2013-08-13 19:50:17 -0400] dgarstang: if it would just use .ssh/config
[2013-08-13 19:50:23 -0400] dgarstang: jessicab: that's the internal IP...
[2013-08-13 19:50:33 -0400] dgarstang: jessicab: should happen to everyone running on Amazon.
[2013-08-13 19:50:58 -0400] adnichols: dgarstang is this a VPC instance in ec2?
[2013-08-13 19:51:16 -0400] jessicab: yea, but normally chef saves all of that at the end of a run together
[2013-08-13 19:51:20 -0400] dgarstang: adnichols: no... the VPC ones are easier because the IP space is common.
[2013-08-13 19:51:30 -0400] dgarstang: jessicab: chef never ran
[2013-08-13 19:51:45 -0400] cpuguy83: Ok, chef server registration over extremely low bandwidth is not good
[2013-08-13 19:51:51 -0400] adnichols: dgarstang I think what's confusing to jessicab is that it ran enough to store an fqdn - otherwise it would have said that attribute wasn't found
[2013-08-13 19:52:39 -0400] jessicab: yea, sorry, just odd.. really, if chef cant ssh in it shouldnt of even created the client/node
[2013-08-13 19:53:03 -0400] jessicab: er if knife cant ssh in i mean heh
[2013-08-13 19:53:05 -0400] adnichols: I think knife does that before it bootstraps
[2013-08-13 19:53:28 -0400] adnichols: it has to generate the client pem it has to install
[2013-08-13 19:53:41 -0400] jessicab: nah, first it connects.. then transfers the validator and installs chef, then when chef runs for the first time it creates the client, then the node
[2013-08-13 19:54:01 -0400] dgarstang: jessicab: not true... every time I do this I have to use a new node name
[2013-08-13 19:54:03 -0400] adnichols: ah right
[2013-08-13 19:54:33 -0400] castro1688: Hey guys! Quick question.. i'm updating my cookbook version in the environment, then going to the node ( which is in said environment ) and running chef-client and nothing is changing. it still has the previous version
[2013-08-13 19:54:40 -0400] dgarstang: still not reading .ssh/config
[2013-08-13 19:54:44 -0400] troyready: jessicab's description is consistent for knife bootstrap & the plugins I use (namely vsphere vm clone). Not sure how ec2 does it
[2013-08-13 19:54:49 -0400] troyready: Weird that it'd be different
[2013-08-13 19:54:50 -0400] jessicab: dgarstang: are you deleting the client and the node when you try again? knife ec2 server delete NAME purge will delete all three btw
[2013-08-13 19:54:52 -0400] chris613: Does it drive anyone else crazy that the only persistent attribute level is 'normal', but it's not the highest precedence? Why should any code anywhere be allowed to override things I deliberateyl and permanently set on the node?
[2013-08-13 19:55:22 -0400] dgarstang: jessicab: no, the point was that it's creating the node even though it never gets to ssh in and run chef
[2013-08-13 19:55:35 -0400] gchristensen: awesome: rackspace VMs on RackConnect have ohai return null public_ipv4'ss
[2013-08-13 19:55:46 -0400] jessicab: but, thats just not possible honestly, not with knife-ec2
[2013-08-13 19:56:01 -0400] dgarstang: jessicab: possible for me. :)
[2013-08-13 19:56:10 -0400] jessicab: maybe double check those logs? or gist them for us?
[2013-08-13 19:56:22 -0400] adnichols: jessicab why not? knife node create -h ?
[2013-08-13 19:56:26 -0400] freerobby: Is there a best practice for putting a secret key for encrypted data bags on a server when bootstrapping it?
[2013-08-13 19:56:41 -0400] freerobby: gchristensen: That's correct, it's a huge PITA.
[2013-08-13 19:56:49 -0400] dgarstang: freerobby: chef doesn't have any best practices.
[2013-08-13 19:56:56 -0400] freerobby: dgarstang: Haha, thanks.
[2013-08-13 19:57:04 -0400] jessicab: adnichols: i never create nodes with knife, it creates a mess since they wont have the right perms
[2013-08-13 19:57:24 -0400] adnichols: jessicab I'm not arguing you shouldn't - I'm arguing it's possible that knife will create the node independent of whether ssh works
[2013-08-13 19:57:27 -0400] gchristensen: freerobby: do yo uhave a workaround for it?
[2013-08-13 19:57:30 -0400] dgarstang: *sigh* .... "Waiting for sshd..."
[2013-08-13 19:57:50 -0400] JackAubrey: Howdy, Attempting to configure a Chef workstation. Got this far because my private key does not exist. How do I go about creating (and probably uploading) it?
[2013-08-13 19:57:50 -0400] JackAubrey: [root@oc8058340137 repository]# pwd
[2013-08-13 19:57:50 -0400] JackAubrey: [root@oc8058340137 repository]# knife node list
[2013-08-13 19:57:51 -0400] JackAubrey: ERROR: Your private key could not be loaded from /etc/chef/repository/.chef/jaubrey.pem
[2013-08-13 19:57:52 -0400] JackAubrey: Check your configuration file and ensure that your private key is readable
[2013-08-13 19:57:57 -0400] freerobby: gchristensen: I wrote this to get it going with a public_ip attribute: https://github.com/freerobby/chef-ohai-public_ip
[2013-08-13 19:58:00 -0400] jessicab: im fairly certain it doesnt, but im off for lunch :P
[2013-08-13 19:58:06 -0400] dgarstang: Is knife ec2 server create gonna use the internal or the external IP?
[2013-08-13 19:58:06 -0400] gchristensen: freerobby: awesome! thank you :D
[2013-08-13 19:58:25 -0400] freerobby: gchristensen: One other problem you will likely hit if you create servers with the knife command...
[2013-08-13 19:58:32 -0400] freerobby: rackspace boots up and then changes the public IP on you.
[2013-08-13 19:58:40 -0400] freerobby: So midway through your chef run, your connection will hang.
[2013-08-13 19:59:09 -0400] gchristensen: freerobby: at this point, I'm migrating away from rackconnect and rackspace in general. also, lots of services pick up the cloud attribute as set, and then the public_ip is null, and then your services can't talk to eachother. at least, that is how I found it.
[2013-08-13 19:59:10 -0400] freerobby: What I do is bring up the server, wait for it to hang, then kill the connection, query the API to get the new IP, and bootstrap it against the new IP
[2013-08-13 19:59:22 -0400] gchristensen: ah good to know
[2013-08-13 19:59:28 -0400] freerobby: gchristensen: Yes, rackconnect has been a huge PITA for us.
[2013-08-13 19:59:48 -0400] gchristensen: us too! it completely goes away at least. twice a month
[2013-08-13 19:59:54 -0400] freerobby: You can work around it as I mentioned above, but just be aware of it so you don't pull your teeth out wondering why your connections are hanging.
[2013-08-13 20:00:04 -0400] dgarstang: Is knife ec2 server create gonna use the internal or the external IP?
[2013-08-13 20:00:13 -0400] gchristensen: my understanding is my co is one of the top users of it, and they tend to deploy beta tests to us
[2013-08-13 20:00:16 -0400] freerobby: dgarstang: To connect to the box? Exteranl.
[2013-08-13 20:00:19 -0400] freerobby: *External.
[2013-08-13 20:00:27 -0400] dgarstang: freerobby: well that's not gonna help....
[2013-08-13 20:00:43 -0400] dgarstang: freerobby: might be part of my issue. Can't I specify to use the internal IP?
[2013-08-13 20:00:46 -0400] freerobby: dgarstang: How else would you connect to the box unless you're running the command from within your cloud?
[2013-08-13 20:00:56 -0400] dgarstang: freerobby: Err, I am.
[2013-08-13 20:00:59 -0400] freerobby: Hmm.
[2013-08-13 20:01:22 -0400] freerobby: dgarstang: I'm not sure whether the ec2 subcommand provides that as an option or whether it just takes the public IP from the ec2 api payload.
[2013-08-13 20:01:26 -0400] freerobby: But I imagine there is a way to configure it.
[2013-08-13 20:01:56 -0400] dgarstang: oh boy.
[2013-08-13 20:02:06 -0400] adnichols: knife ec2 server create does support he use of -a
[2013-08-13 20:02:13 -0400] adnichols: but as with ssh, not sure which attribute to use :)
[2013-08-13 20:02:33 -0400] freerobby: adnichols: It definitely won't support -a because it runs before the node has any attributes.
[2013-08-13 20:02:55 -0400] adnichols: freerobby I would think - tho it's there in the help
[2013-08-13 20:03:12 -0400] adnichols: freerobby but it makes sense that there's be no info for the node yet
[2013-08-13 20:06:31 -0400] gchristensen: freerobby: it isn't a work of art, but: https://gist.github.com/grahamc/e622ddfab2969b5c3a82
[2013-08-13 20:07:42 -0400] dgarstang: ok, giving up on knife ec2. too many requirements missing.
[2013-08-13 20:08:13 -0400] dgarstang: no ability to speficy public/private IP. doesn't read .ssh/config, doesn't seem to support agent forwarding and so on.
[2013-08-13 20:09:09 -0400] sparr: how do I get the chef server to remember the role/runlist/etc a client uses when run with "chef-client -j foo.json"
[2013-08-13 20:09:32 -0400] freerobby: gchristensen: ha
[2013-08-13 20:09:50 -0400] gchristensen: freerobby: can you think of a case where that would stop working? because it seems well across my deployment
[2013-08-13 20:09:58 -0400] freerobby: dgarstang: I believe it uses fog under the covers - might be easy to patch
[2013-08-13 20:10:22 -0400] dgarstang: freerobby: easy if ruby wasn't the hardest thing to learn in my 16 year career
[2013-08-13 20:14:09 -0400] gchristensen: freerobby: http://tickets.opscode.com/browse/OHAI-344 maybe this ticket is what broke us :)
[2013-08-13 20:14:27 -0400] gchristensen: oh, this is pretty old
[2013-08-13 20:14:55 -0400] dgarstang: So, if I don't use knife ece/google server create, and I don't want to bake images, AND I don't want to use fabric... am I screwed?
[2013-08-13 20:15:20 -0400] freerobby: dgarstang: You could always boot the instances from the AWS API and then bootstrap them with knife bootstrap
[2013-08-13 20:15:57 -0400] dgarstang: freerobby: i think that'd require knife ssh still, and that's where the problem lies.
[2013-08-13 20:16:11 -0400] freerobby: It requires using knife ssh but not knife ec2
[2013-08-13 20:16:16 -0400] freerobby: you can specify the ip address manually.
[2013-08-13 20:16:25 -0400] dgarstang: freerobby: knife ssh is the broken bit
[2013-08-13 20:16:38 -0400] freerobby: dgarstang: Ah, I must have misunderstood.
[2013-08-13 20:17:16 -0400] dgarstang: freerobby: target is behind a gateway. knife ssh ignores .ssh/config and -w doesn't support agent forwarding.
[2013-08-13 20:17:17 -0400] gpatmore: hi all, I have a custom LWRP question. this the right place to ask?
[2013-08-13 20:17:36 -0400] freerobby: gpatmore: yws
[2013-08-13 20:17:36 -0400] freerobby: yes
[2013-08-13 20:17:40 -0400] adnichols: dgarstang when it has gotten to "waiting for sshd" do you break out of knife ec2 or let it timeout when you get a chef node entry even if ssh doesn't work?
[2013-08-13 20:17:40 -0400] gpatmore: inside an action handler I have: unless tagged?("avamar_intialized")
[2013-08-13 20:18:01 -0400] gpatmore: error I get is:NameError: Cannot find a resource for tagged?
[2013-08-13 20:18:03 -0400] adnichols: dgarstang I figured I'd try to repro - curious at this point
[2013-08-13 20:18:18 -0400] dgarstang: adnichols: it never seems to time out, and I've waited quite a while.
[2013-08-13 20:18:27 -0400] gpatmore: do I need to include a library or something in provider file?
[2013-08-13 20:19:57 -0400] adnichols: interesting - I don't seem to get a node created when ssh fails
[2013-08-13 20:20:17 -0400] dgarstang: adnichols: yeah, i went back and tested that. Me too. :) I misspoke earlier.
[2013-08-13 20:21:14 -0400] dgarstang: Well, I'll be going to the next one of these... http://www.meetup.com/The-Bay-Area-Chef-User-Group/
[2013-08-13 20:21:26 -0400] dgarstang: 'fix knife ec2 please!'
[2013-08-13 20:22:09 -0400] castro1688:  Hey guys! Quick question.. i'm updating my cookbook version in the environment, then going to the node ( which is in said environment ) and running chef-client and nothing is changing. it still has the previous version
[2013-08-13 20:22:51 -0400] gchristensen: castro1688: did you upload the environment file?
[2013-08-13 20:23:13 -0400] gpatmore: are the recipes attached to the target env?
[2013-08-13 20:23:34 -0400] cpuguy83: Painstakingly got my own custom Windows bootstrap going, because the knife-windows bootstrap doesn't work.  And now just major major bandwidth issues. Chef seems to be using a ridiculous amount of bandwidth for client runs.  Especially client registration.
[2013-08-13 20:23:56 -0400] gpatmore: anyone know why the tagged? function would be not found inside a provider file?
[2013-08-13 20:24:36 -0400] dgarstang: oh shit. progress. I changed -w from -w 10.36.0.2 to -w user@10.36.0.2. Now I'm getting 'Can not find bootstrap definition for chef-full'.
[2013-08-13 20:26:02 -0400] castro1688: gchristensen: i did a knife enviornment edit xxx
[2013-08-13 20:28:05 -0400] eherot: Does anyone know of a tool (or one-liner scriptlet) that would decrypt a data bag FILE as opposed to only being able to decrypt what's currently on the server?
[2013-08-13 20:28:07 -0400] castro1688: then on the node did a chef-client as that node exists in that enviornment
[2013-08-13 20:32:00 -0400] JackAubrey: Hello,
[2013-08-13 20:32:00 -0400] JackAubrey: knife configure --initial
[2013-08-13 20:32:00 -0400] JackAubrey: returns with
[2013-08-13 20:32:00 -0400] JackAubrey: ERROR: Errno::ECONNRESET: Connection reset by peer - SSL_connect
[2013-08-13 20:32:01 -0400] JackAubrey: Both the admin.pem and validation.pem are valid. Any ideas?
[2013-08-13 20:33:03 -0400] dgarstang: So, I finally got knife ec2 server create to ssh in. However, I'm being disconnected again. Any ideas? http://pastebin.com/5vzQxjtk
[2013-08-13 20:33:45 -0400] maruq: cpuguy83: knife-windows bootstrap should work, you need WinRM port open though
[2013-08-13 20:34:41 -0400] cpuguy83: maruq: It's actually failing mid-way through, same way every time.  But that's ok, I've at least got that working
[2013-08-13 20:35:09 -0400] maruq: cpuguy83: ah, that's strange...
[2013-08-13 20:35:44 -0400] cpuguy83: The chef run is just sending too much data for my cellular lines, though.  I guess ohai data is being send every time regardless of any changes?
[2013-08-13 20:35:49 -0400] maruq: cpuguy83: is it a cookbook failing, or the run itseld?
[2013-08-13 20:36:42 -0400] cpuguy83: maruq: For the bootstrap failing?  It sends the chunked data, then complains about a few commands and exits.  I saw someone else reported the same thing, both of us from OSX workstations... not that it should matter.
[2013-08-13 20:37:17 -0400] zts: cpuguy83: yeah, automatic attributes are reported on every succesful run.  If you don't need some of them recorded on the server, take a look at https://github.com/opscode-cookbooks/whitelist-node-attrs
[2013-08-13 20:37:34 -0400] maruq: cpuguy83: hmm... kind of weird. I was running from OS X against vagrant, azure, aws & it was running fine a couple of weeks ago
[2013-08-13 20:37:53 -0400] maruq: I was on WLAN though
[2013-08-13 20:38:00 -0400] cpuguy83: zts: What I'd really like to do is have the server the server send a hash of it's current attributes and let the client compare and update if different
[2013-08-13 20:38:45 -0400] cpuguy83: maruq: So, we are talking about two different issues... knife bootstrap windows failing, vs after I've manually installed chef and getting the chef-client run to go through successfully on low bandwidth connection.
[2013-08-13 20:38:59 -0400] bean__: dgarstang: i'd check SSH logs on the remote host? it could have been killed due to inactivity? not sure.
[2013-08-13 20:39:05 -0400] maruq: cpuguy83: yeah, sounds like it
[2013-08-13 20:39:17 -0400] cpuguy83: and automatic client registration outright failing on the low bandwidth line
[2013-08-13 20:39:47 -0400] cpuguy83: I wonder if it's just because WinRM is terrible.... I have no experience with it.
[2013-08-13 20:40:09 -0400] sparr: I have a cookbook_file resource that failed with `Net::HTTPServerException 403 "Forbidden"` and then worked fine when I ran chef-client immediately afterwards. Would there be logs on the chef server about that http request and why it failed?
[2013-08-13 20:41:18 -0400] adnichols: sparr I've had that experience - didn't find much, was it during an initial (ie long) chef-client run?
[2013-08-13 20:41:24 -0400] sparr: yes
[2013-08-13 20:41:27 -0400] sparr: 20+ minutes
[2013-08-13 20:41:33 -0400] sparr: http://tickets.opscode.com/browse/CHEF-3045
[2013-08-13 20:41:34 -0400] sparr: aha
[2013-08-13 20:41:48 -0400] adnichols: yeah, I saw a ticket around it
[2013-08-13 20:42:11 -0400] jessicab: dgarstang: have you tried it in us-east? i think i saw a friend get that error when he was using west, and i remember him fixing it that way.. most of us are using east too, so we might not know of bugs specific to that region.. although i swear ive also seen east work
[2013-08-13 20:42:27 -0400] jessicab: er i swear ive also seen west work i mean
[2013-08-13 20:42:48 -0400] adnichols: sparr the suggested timeout change didn't fix it for me
[2013-08-13 20:42:59 -0400] sparr: ugh
[2013-08-13 20:43:10 -0400] sparr: I'm going to move the very long thing to the end of my recipe
[2013-08-13 20:43:15 -0400] sparr: hopefully that will resolve it
[2013-08-13 20:43:24 -0400] sparr: really not eager to need to have chef-client run twice during deployment
[2013-08-13 20:45:04 -0400] dgarstang: jessicab: not what I wanted to hear...
[2013-08-13 20:46:26 -0400] jessicab: dgarstang: heh sorry, but im fairly certain it was the exact same error.. easy to test too
[2013-08-13 20:46:49 -0400] dgarstang: jessicab: not really. our us-east systems are in a VPC.
[2013-08-13 20:46:49 -0400] adnichols: dgarstang easy to test - would at least shift the insanity in a different direction for a bit :)
[2013-08-13 20:48:31 -0400] adnichols: also jessicab you're right - tested knife ec2 w/ a broken ssh config and no node got created - so the ssh connection is a dependency, my misunderstanding
[2013-08-13 20:50:01 -0400] jessicab: adnichols: no worries, sorry for being so insistent.. its just a question i get really frequently
[2013-08-13 20:50:25 -0400] dgarstang: Why would chef bootstrap be running 'DEBUG: establishing connection to 127.0.0.1:65535'
[2013-08-13 20:50:38 -0400] adnichols: dgarstang are you using an ssh gateway?
[2013-08-13 20:51:00 -0400] dgarstang: adnichols: yep, got that to work by specifying user@gateway
[2013-08-13 20:51:14 -0400] adnichols: yeah, so that's the 2nd ssh connection forwarded via the gateway
[2013-08-13 20:51:46 -0400] dgarstang: adnichols: via it's ssh config?
[2013-08-13 20:52:29 -0400] dgarstang: adnichols: cuz, all user@gateway has in .ssh/config is StrictHostKeyChecking no
[2013-08-13 20:52:31 -0400] adnichols: no, when you tell knife bootstrap to use an ssh gateway I'm guessing it sets up a prot forward to the destination machine via the ssh connection to the gateway, then connects to the remote machine via that port forward
[2013-08-13 20:52:55 -0400] adnichols: hence the localhost connection (to use the forwarded port)
[2013-08-13 20:53:22 -0400] dgarstang: adnichols: nasty
[2013-08-13 20:53:30 -0400] adnichols: dgarstang very typical
[2013-08-13 20:53:46 -0400] dgarstang: adnichols: so... who's connecting to who here?
[2013-08-13 20:54:18 -0400] adnichols: it's no different than forwarding an http connection over ssh
[2013-08-13 20:54:24 -0400] adnichols: except you are just forwarding another ssh connection
[2013-08-13 20:54:45 -0400] adnichols: and in this case the port selection is automatic
[2013-08-13 20:54:46 -0400] dgarstang: adnichols: always has troubles with ssh port forwarding
[2013-08-13 20:55:02 -0400] adnichols: dgarstang then don't worry about the details and just accept that it should work :)
[2013-08-13 20:55:04 -0400] dgarstang: so... what port does the gateway box connect to the endpoint on?
[2013-08-13 20:55:15 -0400] dgarstang: adnichols: except... there's firewalls n stuff in the middle
[2013-08-13 20:55:19 -0400] adnichols: dgarstang I'd guess port 22 unless you tell it otherwise
[2013-08-13 20:55:42 -0400] aramus_: Hello, if knife configure initial returns a "ERROR: Errno::ECONNRESET: Connection reset by peer - SSL_connect", what would you troubleshoot first?
[2013-08-13 20:55:53 -0400] dgarstang: adnichols: Well, I'm gonna guess something went wrong with that port forwarding
[2013-08-13 20:55:54 -0400] adnichols: this should be the equivalent of ssh <gateway> -L 65535:<target machine>:22
[2013-08-13 20:56:24 -0400] adnichols: Then a 2nd ssh connection to localhost:65535
[2013-08-13 20:57:35 -0400] dgarstang: adnichols: never have any luck with that. just ran that...it sshes to gateway machine... nothing listening on port 65535
[2013-08-13 20:58:08 -0400] adnichols: nothing listening on which machine? it should be listening on the machine which initiated the ssh connection
[2013-08-13 20:58:18 -0400] jessicab: dgarstang: seen this yet? theres an old irc log from someone else with this error.. mentions some port forwarding tips - http://community.opscode.com/chat/chef/2013-07-08#id-392896
[2013-08-13 20:59:56 -0400] dgarstang: adnichols: yep, but a ssh localhost -p 65535 on that box goes nowhere
[2013-08-13 21:01:40 -0400] jessicab: yea, its odd because thats also in his output.. the exact same port
[2013-08-13 21:01:57 -0400] dgarstang: jessicab: don't see a solution in there
[2013-08-13 21:02:06 -0400] dgarstang: to my coworkers.... SILENCE!!!!
[2013-08-13 21:03:22 -0400] jessicab: dgarstang: yea, the only solution i see is turn off port forwarding.. i also noticed he saw that error in west too though, shrugs
[2013-08-13 21:03:39 -0400] gpatmore: can anyone tell me how to call chef native tagged? function from inside a provider action :init do ...end block
[2013-08-13 21:03:58 -0400] dgarstang: jessicab: wihout the port forwarding, I'm screwed
[2013-08-13 21:05:40 -0400] dgarstang: so, if I run a ssh root@10.36.0.2 -L 65535:ec2-54-219-19-121.us-west-1.compute.amazonaws.com:22 on the intiial box, and then do a 'ssh localhost -p 65535' on the same box, it just hangs
[2013-08-13 21:05:41 -0400] jessicab: dgarstang: might be useful to turn it off for a test though, to confirm what the problem is? im not certain that even fixed him really
[2013-08-13 21:06:00 -0400] dgarstang: jessicab: without the agent forwarding, I can't reach the target systems
[2013-08-13 21:06:28 -0400] jessicab: ah, ive never messed with vpc.. just regular ec2 nodes, but with those you dont need forwarding
[2013-08-13 21:06:39 -0400] jessicab: well, for a simple test at least heh
[2013-08-13 21:07:29 -0400] dgarstang: jessicab: i'm still in us-west. No VPC there, but for various firewall/region reasons, the command and control box, which is running knife, cant reach the newly built systems without going through an intermediary
[2013-08-13 21:09:00 -0400] jessicab: ah, well you might want to try out knife bootstrap without ec2? im pretty sure knife bootstrap can handle that situation fine.. it seems to read the ssh config at least
[2013-08-13 21:11:01 -0400] dgarstang: grrr "channel 3: open failed: connect failed: Connection timed out"
[2013-08-13 21:12:31 -0400] jessicab: dgarstang: want to throw the logs on pastebin? i actually bootstrap nodes in a private cloud with a similar setup.. they all have to go through a proxy thats in my ssh config, and knife bootstrap worked fine for it, i think thats a pretty common workflow actually
[2013-08-13 21:12:54 -0400] jessicab: but no clue on knife ec2 there, kind of more complicated than any setup ive played with in aws
[2013-08-13 21:12:56 -0400] dgarstang: jessicab: There's not really any logs to paste
[2013-08-13 21:13:04 -0400] jessicab: weird, thats all it said?
[2013-08-13 21:13:28 -0400] dgarstang: on the client side with -VV, yes
[2013-08-13 21:15:13 -0400] dgarstang: i must be doing something wrong with the way I ran that ssh proxy command too. The knife bootstrap fails immediately, whereas my attempt to ssh to localhost -P 65535 times out
[2013-08-13 21:16:25 -0400] dgarstang: s/-P/-p/
[2013-08-13 21:17:44 -0400] jessicab: i dont think thats a port knife normally uses btw, just 22
[2013-08-13 21:29:52 -0400] adnichols: dgarstang can you ssh from your gateway host to the destination host on port 22? You don't have any ssh/config entries on the gateway which tell it to use a diff port on the destination node do you?
[2013-08-13 21:30:06 -0400] dgarstang: adnichols: correct, and correct
[2013-08-13 21:30:49 -0400] dgarstang: be nice if knife actually logged what it was doing
[2013-08-13 21:31:10 -0400] adnichols: dgarstang it is - it's just timing out when trying to ssh over the forwarded port, there's not much more detail to show I don't htink
[2013-08-13 21:31:31 -0400] dgarstang: adnichols: it's not timing out. it fails immediately
[2013-08-13 21:31:46 -0400] adnichols: ah, I misunderstood
[2013-08-13 21:31:49 -0400] jessicab: its also a different error than you see during a timeout
[2013-08-13 21:32:23 -0400] adnichols: dgarstang when you test the ssh connection from gateway -> remote host, are you doing it as user root?
[2013-08-13 21:32:31 -0400] dgarstang: i'd like to know what it's running... I've running ssh root@gateway -L 65535:target:22 ... dunno if that's right or not.
[2013-08-13 21:33:00 -0400] dgarstang: adnichols: no.. local user is badmin, root on gateway and then bcadmin on dest host
[2013-08-13 21:33:05 -0400] adnichols: that looks right - do you get a shell on the gateway host?
[2013-08-13 21:33:34 -0400] adnichols: ic - now I see that in your pastebin
[2013-08-13 21:33:45 -0400] dgarstang: adnichols: No... i'm running ssh localhost -p 65535 -vvvv on the first host and it times out
[2013-08-13 21:35:52 -0400] adnichols: dunno - I'm afraid this is beyond my ability to troubleshoot via irc
[2013-08-13 21:37:33 -0400] mattray: One last full Test Kitchen run, then releasing https://github.com/opscode-cookbooks/apt as 2.1 of the apt cookbook
[2013-08-13 21:39:34 -0400] dgarstang: Ran tcpdump on first box localhost.... bupkiss
[2013-08-13 21:45:00 -0400] denken_: re: nagios cookbook 4.1.4 - so what does one do when you want to do an http check against two separate hosts that have no roles in common? do you really have to make two data bags with unique service names?
[2013-08-13 21:45:04 -0400] denken_: surely there is a better way
[2013-08-13 21:45:20 -0400] dgarstang: effin knife
[2013-08-13 21:45:32 -0400] dgarstang: gateway don't work
[2013-08-13 21:49:55 -0400] coderanger: Whee, https://preview.opscode.com/changelog is up, tell your friends, tip your waiter
[2013-08-13 21:51:04 -0400] cpuguy83: coderanger: Does Opscode have a UI designer?
[2013-08-13 21:51:26 -0400] coderanger: cpuguy83: We do, though that page is all my fault so don't blame him :)
[2013-08-13 21:52:30 -0400] jtimberman: dgarstang: re: knife logging what it's doing - it's similar to a lot of standard unix utilities in that regard ;). you can use -VV for extra verbosity though.
[2013-08-13 21:53:00 -0400] dgarstang: jtimberman: -VV isn't telling me bupkiss
[2013-08-13 21:53:31 -0400] cpuguy83: I guess the preview UI does look better full screen than on a smaller window
[2013-08-13 21:53:42 -0400] dgarstang: jtimberman: http://pastebin.com/RviDLhq1
[2013-08-13 21:54:32 -0400] coderanger: cpuguy83: We've gone 1280+ as the optimal width, with some work on fallback down to 1024, below that is just not common enough to mention
[2013-08-13 21:55:41 -0400] djstunami: what, no mobile version? *grin*
[2013-08-13 21:56:15 -0400] oneness: chef-client run is hanging and debug last line is: [2013-08-13T21:42:20+00:00] DEBUG: Loading plugin linux::filesystem. I am running it on Vagrant (ubuntu 12.04). Any clue what is going on?
[2013-08-13 21:57:06 -0400] Brad_K: anyone around who might be able to help me with some data bag questions?
[2013-08-13 21:57:12 -0400] coderanger: djstunami: We've checked on some tablets for the use case of "It is 4AM and I just got paged and need to know WTF is going on", not much beyond that though
[2013-08-13 21:58:11 -0400] djstunami: I was joking, but that makes sense
[2013-08-13 21:58:28 -0400] dgarstang: i normally have access to a computer at 4am. :) Dunno where you lot are sleeping. :)
[2013-08-13 21:58:44 -0400] ggolin_: hello
[2013-08-13 21:58:48 -0400] coderanger: Brad_K: Wasap?
[2013-08-13 21:58:50 -0400] Brad_K: i've used my ipad that way.  you can even do ssh on it.  heck, in an emergency, i can do that on my iphone, too.
[2013-08-13 21:59:11 -0400] Brad_K: so, i'm trying to create a data bag, and getting an error when trying to do a db.save.
[2013-08-13 21:59:12 -0400] ggolin_: getting a cannot find a resource with my lwrp
[2013-08-13 21:59:24 -0400] ggolin_: calling it cbname_resourcename
[2013-08-13 21:59:25 -0400] adnichols: dgarstang I'm pretty sure this is not knife - I've tested both of those scenarios (with knife ssh & just ssh) and they work in my env
[2013-08-13 21:59:44 -0400] ggolin_: providers and resources dirs have the correct files. what am i doing wrong?
[2013-08-13 21:59:49 -0400] coderanger: Brad_K: Pastebin error? :)
[2013-08-13 21:59:59 -0400] Brad_K: coderanger: specifically, i get "HTTP Request Returned 404 Not Found: Action 'update' was not found in DataBags" and then "HTTP Request Returned 403 Forbidden: You are not allowed to take this action.", but I don't know if they're caused by the same problem or are two different problems.
[2013-08-13 22:00:09 -0400] coderanger: ggolin_: Whats the path to the resource file look like?
[2013-08-13 22:00:18 -0400] Brad_K: lemme do a quick gist.
[2013-08-13 22:00:44 -0400] coderanger: Brad_K: Is this from inside recipe code or just a random script using the Chef gem API?
[2013-08-13 22:01:05 -0400] Brad_K: coderanger: inside a recipe.
[2013-08-13 22:01:15 -0400] ggolin_: coderanger, /tmp/kitchen-chef-solo/cookbooks/tracker/resources
[2013-08-13 22:01:21 -0400] coderanger: Brad_K: Open source server or enterprise (hosted/private)?
[2013-08-13 22:01:31 -0400] coderanger: ggolin_: and the file inside that?
[2013-08-13 22:01:40 -0400] Brad_K: open source, 10.18.2.
[2013-08-13 22:01:41 -0400] ggolin_: redmine_plugin.rb
[2013-08-13 22:02:05 -0400] ggolin_: calling it tracker_redmine_plugin 'foo' do
[2013-08-13 22:02:07 -0400] ggolin_: etc
[2013-08-13 22:02:17 -0400] coderanger: ggolin_: Sounds correct to me
[2013-08-13 22:02:21 -0400] ggolin_: i know!
[2013-08-13 22:02:26 -0400] coderanger: ggolin_: Are you sure the cookbook is loading?
[2013-08-13 22:02:41 -0400] ggolin_: oh thats an interesting approach coderanger :)
[2013-08-13 22:02:50 -0400] ggolin_: damnitall
[2013-08-13 22:03:06 -0400] coderanger: Either you need recipe[tracker] in the run list (possibly via roles) or a cookbook that is in the run list needs to list it as a dependency in the metadata.rb)
[2013-08-13 22:03:29 -0400] coderanger: Brad_K: Hmm, so aside from the 404 error, normal clients in OSC don't have access to upload stuff
[2013-08-13 22:04:23 -0400] Brad_K: coderanger: so, how would a normal client run a recipe to create a data bag?  or to store data in a data bag?  or does that only have to be done from an admin client?
[2013-08-13 22:04:46 -0400] coderanger: Yeah, normally all write operations are done from an admin client
[2013-08-13 22:05:04 -0400] Brad_K: alright, i can try that.
[2013-08-13 22:05:10 -0400] ggolin_: coderanger, added as a dependency in the test cookbook
[2013-08-13 22:05:14 -0400] ggolin_: _should_ work
[2013-08-13 22:05:14 -0400] coderanger: The only thing a non-admin is allowed to write to is a node object that matches the name of the client
[2013-08-13 22:05:21 -0400] dgarstang: AHA. I think I know whats wrong with knife.
[2013-08-13 22:06:14 -0400] coderanger: ggolin_: Roger, guessing you are using berkshelf, so just remember that adding to a berksfile just downloads the cookbook, berkshelf isn't involved in execution :)
[2013-08-13 22:06:26 -0400] dgarstang: So... knife ec2 server creating is connecting and then disconnecting. If I go to a second terminal and try and connect to the host, I can't ssh in yet either. Ssh is not fully up. I get a 'connection refused'. Knife has alrady failed... it's not waiting until ssh is fully up!
[2013-08-13 22:06:34 -0400] jtimberman: dgarstang: the error: ERROR: Net::SSH::Disconnect: connection closed by remote host
[2013-08-13 22:06:46 -0400] jtimberman: is coming from Net::SSH, not knife, specifically.
[2013-08-13 22:06:53 -0400] ggolin_: coderanger, yep, thank you. loading. getting a diff error now, but at least its loading.
[2013-08-13 22:06:58 -0400] dgarstang: jtimberman: ^
[2013-08-13 22:07:06 -0400] jtimberman: It's really hard to get the error out of Net::SSH.
[2013-08-13 22:07:19 -0400] coderanger: Brad_K: Ahh yeah, I didn't read your message carefully enough
[2013-08-13 22:07:21 -0400] Brad_K: hmm.  coderanger  do you have an example of the correct way to test to see if a particular object inside of a data bag has been created yet, and if not then to create it?
[2013-08-13 22:07:22 -0400] dgarstang: jtimberman: as I said, knife is not waiting long enough.
[2013-08-13 22:07:22 -0400] jtimberman: So it could be timing out
[2013-08-13 22:07:26 -0400] jtimberman: Sure
[2013-08-13 22:07:35 -0400] coderanger: Brad_K: That 403 is the auth error
[2013-08-13 22:07:35 -0400] jtimberman: It already sits and waits quite a long time.
[2013-08-13 22:07:44 -0400] jtimberman: Like, we have a heaping pile of sleep 2 retries in there.
[2013-08-13 22:07:48 -0400] theCzar: Can I make and use encrypted data_bags without Knife?
[2013-08-13 22:07:55 -0400] ggolin_: (<3 test kitchen )
[2013-08-13 22:07:55 -0400] dgarstang: So why isn't anyone else having this issue with knife? it must be polling like every 1s or something
[2013-08-13 22:08:12 -0400] coderanger: Brad_K: https://github.com/opscode/chef/blob/10.18.2/chef/lib/chef/data_bag_item.rb#L224-L237 calling DataBagItem#save is roughly idempotent for those cases
[2013-08-13 22:08:29 -0400] coderanger: theCzar: Technically yes, you can use Chef Ruby API directly :)
[2013-08-13 22:08:58 -0400] coderanger: theCzar: If your next question is "how do I do that?" I'm afraid I don't have an example handy though
[2013-08-13 22:09:11 -0400] dgarstang: So why isn't anyone else having this issue with knife? it must be polling like every 1s or something
[2013-08-13 22:10:13 -0400] theCzar: coderanger: hmm, I am intrigued.  I suppose I could dig through the API, would you by any chance have a link handy?
[2013-08-13 22:10:18 -0400] jtimberman: dgarstang: i think it polls every 2s, and then pauses for a few seconds when it gets a response, but there's a delay between sshd startup where the socket is open and hwen you can actually connect.
[2013-08-13 22:10:57 -0400] theCzar: We're a Caterer only shop and we'd like secure our data_bags without having to use knife.
[2013-08-13 22:10:58 -0400] coderanger: theCzar: https://github.com/opscode/chef/blob/master/lib/chef/encrypted_data_bag_item.rb
[2013-08-13 22:11:01 -0400] dgarstang: jtimberman: yes, and that's when it tries to connect. I have two windows open. Knife has already given up, and I was able to, at least one more time, fail to connect on a second window
[2013-08-13 22:11:11 -0400] jessicab: dgarstang: didnt you say you were port forwarding earlier? isn't it possible that forward is up and thats why it responds? could be why only you see it.. most people dont use proxies or port forwarding on ec2, not for ssh at least
[2013-08-13 22:11:44 -0400] dgarstang: jessicab: if port forwarding is up, it's because knife set it up
[2013-08-13 22:11:45 -0400] coderanger: theCzar: Not heard of Caterer, what is?
[2013-08-13 22:12:07 -0400] dgarstang: jessicab: most people must be in a single amazion region then, not all of them.
[2013-08-13 22:12:31 -0400] jtimberman: e.g., https://github.com/opscode/knife-ec2/blob/master/lib/chef/knife/ec2_server_create.rb#L254-L275 and https://github.com/opscode/knife-ec2/blob/master/lib/chef/knife/ec2_server_create.rb#L658-L664 (for VPC)
[2013-08-13 22:13:05 -0400] jtimberman: anyway, we're doing the best we can, but sometimes it will fail and you either: launch a new instance, or use knife bootstrap directly.
[2013-08-13 22:13:10 -0400] Brad_K: coderanger: so, i'm checking for the existence of a data bag with a line that looks like this:
[2013-08-13 22:13:11 -0400] Brad_K: if (!Chef::DataBag.list.key?(data_bag_name))
[2013-08-13 22:13:15 -0400] jessicab: dgarstang: ah sorry, i must of misheard.. yea, i only use east, personally
[2013-08-13 22:13:28 -0400] Brad_K: coderanger: so, would the same kind of check work for DataBagItem?
[2013-08-13 22:14:11 -0400] Brad_K: i ask, because now chef-client is bombing on:
[2013-08-13 22:14:11 -0400] Brad_K: unless data_bag_item(data_bag_name, pkg)
[2013-08-13 22:14:33 -0400] Brad_K: of course, that data bag item hasn't been created yet, which is why i was trying to use an unless.
[2013-08-13 22:15:06 -0400] theCzar: coderanger: https://github.com/tylerflint/caterer  it's a tool we wrote here at PagodaBox as an alternative to the chef-server workflow.  Sort of, Kife-solo meets Vagrant.  I originally prototyped it in Python but primary development has since been ported to Ruby.
[2013-08-13 22:15:37 -0400] Brad_K: theCzar: so, there is this section at http://bit.ly/19QtXtg where it talks about how to create data bags manually.  dunno if that actually works though.
[2013-08-13 22:15:57 -0400] coderanger: theCzar: If you aren't using a chef server, and specifically Hosted Chef, there is a roughly 90% chance encrypted data bags are not what you want
[2013-08-13 22:16:40 -0400] coderanger: theCzar: They exist mostly to allow using a chef server that you don't entirely trust re: data leakage.
[2013-08-13 22:16:50 -0400] Brad_K: and if you do want a Python-based implementation of a minimal Chef server, I think that Noah might be able to help you out there.  i can't remember what it's called, but he did write something.
[2013-08-13 22:17:21 -0400] coderanger: You can do more with them if you drop down to the low-level API in your recipes too, but I would recommend looking in to something actually geared towards secret management
[2013-08-13 22:17:54 -0400] coderanger: Brad_K: I would just do: data_bag_item('asdf', 'asdf') rescue return
[2013-08-13 22:18:47 -0400] Brad_K: coderanger: how would you test to see if that had executed successfully, or if you'd been rescued?
[2013-08-13 22:19:17 -0400] coderanger: Brad_K: That will bypass the recipe if the bag isn't found
[2013-08-13 22:19:28 -0400] coderanger: well, if the bag or item isn't found :)
[2013-08-13 22:19:30 -0400] theCzar: coderanger: yeah since we aren't using chef-server we haven't really dealt with them.  I'm just trying to seen ways we might add some data_bag security to caterer
[2013-08-13 22:20:02 -0400] coderanger: theCzar: I can try and explain the issues with the security model, but it can be a long rant :)
[2013-08-13 22:20:07 -0400] Brad_K: coderanger: i don't want to bypass the recipe in that case  instead, i want to put stuff into the data bag as a starting point.
[2013-08-13 22:20:23 -0400] coderanger: Brad_K: k, sec :)
[2013-08-13 22:20:49 -0400] theCzar: Brad_K: well we don't really need a chef-server, caterer does everything we need.  I'm just looking at ways to add data_bag security.
[2013-08-13 22:20:58 -0400] theCzar: Brad_K: thanks though
[2013-08-13 22:21:17 -0400] zts: theCzar: you could check out how 'knife solo data bag' does it - https://github.com/thbishop/knife-solo_data_bag/blob/master/lib/chef/knife/solo_data_bag_create.rb
[2013-08-13 22:21:47 -0400] Brad_K: zts: that's a cool idea.
[2013-08-13 22:21:49 -0400] theCzar: coderanger: haha, yes security always seems to get the short end of the stick in design :P
[2013-08-13 22:22:10 -0400] coderanger: Brad_K: http://hastebin.com/hebihelafa.rb
[2013-08-13 22:22:31 -0400] Brad_K: if security isn't an integral part of the process from day one, then i don't see how you can be successful by attempting to bolt it on after the fact.
[2013-08-13 22:22:40 -0400] coderanger: theCzar: I mean what encrypted bags do, they do well, but people seem to misunderstand that they don't make _your side_ any more secure
[2013-08-13 22:22:46 -0400] coderanger: It is to secure Hosted Chef :)
[2013-08-13 22:23:13 -0400] Brad_K: coderanger: thanks!
[2013-08-13 22:23:22 -0400] theCzar: zts: cool, I may look into that
[2013-08-13 22:23:47 -0400] coderanger: You can use them to improve local security by creating isolated secret domains, but by default that isn't how chef-client is setup
[2013-08-13 22:24:52 -0400] theCzar: coderanger: yes that is for sure.  The main idea for adding encrypted data_bag support to caterer is the case where people may use github to store their databags along with cookbooks.  Even with a private repo that puts them back into the same boat as if they are using hosted chef.
[2013-08-13 22:25:48 -0400] theCzar: either way it's probably not the best use case.  Maybe we shouldn't encourage it.
[2013-08-13 22:25:58 -0400] coderanger: theCzar: Yeah, that falls in the 10%, but because encrypted bags require you to have your own scheme for distributing decryption keys it can often be easier to just use that scheme to distribute the secrets directly
[2013-08-13 22:26:44 -0400] coderanger: I just get ansty, a lot of people see "encrypted" and assume they should be using it without understanding what the tradeoffs and actual security gains are
[2013-08-13 22:27:15 -0400] coderanger: "Just rub a little AES on it" \o/
[2013-08-13 22:27:52 -0400] theCzar: coderanger: haha, bingo \m/
[2013-08-13 22:28:45 -0400] coderanger: Fast forward a year and someone complains about how they got hacked and the attacker stole their mysql password which should be impossible because ENCRYPTION and I need to go find a quiet place to hide the body
[2013-08-13 22:28:51 -0400] tabolario: so is there much of a point in using them if you're self-hosting oss chef server?
[2013-08-13 22:28:53 -0400] Brad_K: coderanger: thanks, my code is at least much further down the line!
[2013-08-13 22:29:16 -0400] coderanger: tabolario: Not nearly as much, depending on how you want to setup failure domains, it might be
[2013-08-13 22:29:46 -0400] coderanger: tabolario: If you view open-source server as potentially more vulnerable than your own apps either because its big and complex or just because you didn't write it, that might be a good reason :)
[2013-08-13 22:29:53 -0400] coderanger: (even if behind a firewall)
[2013-08-13 22:31:51 -0400] tabolario: yeah, i guess isolated failure domains is essentially what i'm getting out of it right now
[2013-08-13 22:32:33 -0400] coderanger: tabolario: Then you have the blessing of the encryption fairies
[2013-08-13 22:32:37 -0400] tabolario: different keys for different environments etc, and break into just my chef server and you don't get anything
[2013-08-13 22:33:15 -0400] tabolario: now escalate to root on a server that has the data bag key and then break into the chef server...
[2013-08-13 22:33:21 -0400] ggolin_: sigh now my new_resource.attribute ends up empty. how do i get into these woods evey time
[2013-08-13 22:33:40 -0400] jtnz: Hi, did I read somewhere that knife-essentials is effectively deprecated by new features in chef11?
[2013-08-13 22:33:44 -0400] coderanger: ggolin_: Pastebin code?
[2013-08-13 22:33:55 -0400] coderanger: jtnz: No, it is just included by default in chef 11
[2013-08-13 22:34:06 -0400] coderanger: jtnz: The standalone gem will generally be newer though :)
[2013-08-13 22:34:10 -0400] jtnz: coderanger, ah cool
[2013-08-13 22:34:24 -0400] tabolario: oh also.. (unrelated), i have a couple ec2 instances that i manually bootstrapped for chef and they don't seem to be getting the ec2.* attributes populated
[2013-08-13 22:34:27 -0400] coderanger: and you can install the gem over chef-11 if you want the new stuffs sooner
[2013-08-13 22:34:35 -0400] coderanger: tabolario: Are they on VPC?
[2013-08-13 22:34:40 -0400] tabolario: indeed they are
[2013-08-13 22:34:46 -0400] jtnz: coderanger, oh so if you want the cutting edge (pun intended), then use chef with knife-essentials?
[2013-08-13 22:34:49 -0400] coderanger: tabolario: You need to touch the hint file
[2013-08-13 22:34:55 -0400] tabolario: aha
[2013-08-13 22:35:07 -0400] coderanger: tabolario: VPC doesn't support any obvious way of autodetection
[2013-08-13 22:35:10 -0400] coderanger: jtnz: Yep
[2013-08-13 22:35:20 -0400] tabolario: did i miss that somewhere in the readme for knife-ec2...
[2013-08-13 22:35:21 -0400] jtnz: coderanger, cool, ta
[2013-08-13 22:36:34 -0400] jtnz: One more question: when using 'knife upload /' to migrate from chef10 to chef11, I'm getting lots of errors during the upload. e.g. ERROR: Failed to upload  : 500 Internal Server Error/n internal service error. Anyone had that?
[2013-08-13 22:36:41 -0400] coderanger: tabolario: I think knife ec2 server create does it for you now
[2013-08-13 22:38:04 -0400] coderanger: tabolario: So if you bootstrap'd yourself, you just have to touch the file :)
[2013-08-13 22:38:14 -0400] tabolario: excellent
[2013-08-13 22:42:36 -0400] tabolario: i was also unaware of the cloud attributes until just now
[2013-08-13 22:43:49 -0400] coderanger: tabolario: Sec, I can find it
[2013-08-13 22:44:20 -0400] coderanger: tabolario: touch /etc/chef/ohai/hints/ec2.json
[2013-08-13 22:44:32 -0400] tabolario: oh sorry haha just found it too :)
[2013-08-13 22:44:41 -0400] tabolario: thank you though
[2013-08-13 22:46:03 -0400] tabolario: ah so 'cloud' must get populated from the ec2 attributes
[2013-08-13 22:46:29 -0400] coderanger: tabolario: Yeah, node['cloud'] is just an alias for whatever cloud provider you are on
[2013-08-13 22:47:01 -0400] coderanger: Useful for stuff like node['cloud'] ? node['cloud']['public_ipv4'] : node['ipaddress']
[2013-08-13 22:47:41 -0400] tabolario: ah yeah i use a conditional like that in my little connect script that figures out which bastion host to use and forks an ssh connection for me by node name
[2013-08-13 22:48:04 -0400] tabolario: but i was just using ['ec2']['local_ipv4']
[2013-08-13 22:52:16 -0400] Guest39445: Hi, I have a question regarding chef-repo, I have few devops, using their workstations, but I want to keep chef-repo in centralized location, currently it on chef-server, and I want all of them to work and create cookbooks in one chef-repo on that server and not on their workstations
[2013-08-13 22:52:52 -0400] Guest39445: anyone has any suggestion on how to go about that, just starting out with chef, love it but need to get more experienced
[2013-08-13 22:56:47 -0400] coderanger: Guest39445: Generally the chef repo lives in source control
[2013-08-13 22:58:11 -0400] Guest39445: yes I am in the process of planing that, I want to use the same SC as our Developers, and not git, but with workstation you create a repo and if I have 4 workstations with 4 devops guys, I don't want to have 4 chef-repos
[2013-08-13 22:58:37 -0400] Guest39445: I can create CS with check-ins and check-outs, how is it done usually
[2013-08-13 22:59:01 -0400] coderanger: Guest39445: Not sure what you mean, what source control do you use generally?
[2013-08-13 22:59:11 -0400] Guest39445: subversion
[2013-08-13 22:59:26 -0400] coderanger: So just make a repo and each person has a checkout and commits back to the repo
[2013-08-13 23:00:35 -0400] coderanger: Works just like any other code
[2013-08-13 23:18:10 -0400] joefitzgerald: can i set node run_state values for chef solo via chef.json?
[2013-08-13 23:18:22 -0400] joefitzgerald: (i'm using vagrant's chef solo provisioner)
[2013-08-13 23:18:53 -0400] coderanger: joefitzgerald: You can't, the run state is just transient data tracking and isn't exposed anywhere
[2013-08-13 23:19:27 -0400] joefitzgerald: @coderanger: so i can't do something equivalent to this: https://github.com/opscode-cookbooks/windows/blob/master/providers/reboot.rb#L23
[2013-08-13 23:19:45 -0400] joefitzgerald: i would need to provide an attribute instead
[2013-08-13 23:20:03 -0400] coderanger: Yeah, but attributes don't work in that case because they persist
[2013-08-13 23:20:10 -0400] coderanger: well, for solo I guess it could work
[2013-08-13 23:20:10 -0400] joefitzgerald: hmm
[2013-08-13 23:20:22 -0400] coderanger: What are you trying to do?
[2013-08-13 23:20:31 -0400] joefitzgerald: what i want is to change the default reboot timeout for the windows reboot handler from 60 seconds to 5 seconds
[2013-08-13 23:20:40 -0400] joefitzgerald: if i am notifying, then i can set a timeout
[2013-08-13 23:20:53 -0400] joefitzgerald: but if i am relying on the handler to detect reboot scenarios, then i cannot
[2013-08-13 23:20:56 -0400] coderanger: I mean thats just an attribute on the resource, just set that
[2013-08-13 23:21:23 -0400] joefitzgerald: i can't because it's happening in a way that i cannot control
[2013-08-13 23:21:36 -0400] coderanger: What is triggering the reboot?
[2013-08-13 23:22:56 -0400] joefitzgerald: @coderanger: https://github.com/opscode-cookbooks/windows/blob/master/files/default/handlers/windows_reboot_handler.rb#L56
[2013-08-13 23:23:14 -0400] joefitzgerald: i.e. at the end of the run, this check occurs, and it'll reboot
[2013-08-13 23:23:21 -0400] joefitzgerald: but it'll always happen 60 seconds later
[2013-08-13 23:23:32 -0400] joefitzgerald: by that time my chef run has already started the next (dependent on reboot) step
[2013-08-13 23:23:39 -0400] joefitzgerald: causing that chef run to be interrupted
[2013-08-13 23:24:12 -0400] joefitzgerald: (rebooting wasn't working at all until i made these changes: https://github.com/opscode-cookbooks/windows/pull/44)
[2013-08-13 23:24:15 -0400] coderanger: joefitzgerald: How are you setting up that handler? It takes the timeout as an arg
[2013-08-13 23:24:44 -0400] coderanger: https://github.com/opscode-cookbooks/windows/blob/master/recipes/reboot_handler.rb#L29
[2013-08-13 23:24:57 -0400] coderanger: Thats the part you need to change :)
[2013-08-13 23:25:28 -0400] joefitzgerald: @coderanger: config.vm.provision :chef_solo do |chef|
[2013-08-13 23:25:28 -0400] joefitzgerald:     chef.log_level = :debug
[2013-08-13 23:25:28 -0400] joefitzgerald:     chef.file_cache_path = "c:/chef/cache"
[2013-08-13 23:25:29 -0400] joefitzgerald:     chef.file_backup_path = "c:/chef/backup"
[2013-08-13 23:25:29 -0400] joefitzgerald:     chef.add_recipe "windows::default"
[2013-08-13 23:25:29 -0400] joefitzgerald:     chef.add_recipe "windows::reboot_handler"
[2013-08-13 23:26:08 -0400] coderanger: Yeah, either use chef-rewind to alter that resource directly or don't use windows::reboot_handler and copy-pasta that recipe and edit it
[2013-08-13 23:30:46 -0400] coderanger: joefitzgerald: Or write a little recipe that just does node.run_state[:whatever]=10000
[2013-08-13 23:32:55 -0400] _ci: is it possible to use chef to configure bastille?  i don't believe so but was looking for confirmation
[2013-08-13 23:34:10 -0400] joefitzgerald: @coderanger: i might try the latter option
[2013-08-13 23:34:26 -0400] coderanger: _ci: If a human can do it, Chef can do it
[2013-08-13 23:34:48 -0400] coderanger: _ci: In the end it is just running commands, you just have to tell it the right ones
[2013-08-13 23:37:55 -0400] _ci: @coderanger suggestions on where to start?  i am struggling to figure out how chef would go through the prompts
[2013-08-13 23:38:14 -0400] coderanger: _ci: Got a link on how a human would set it up?
[2013-08-13 23:39:17 -0400] _ci: coderanger http://joshrendek.com/2013/01/securing-ubuntu/#bastille
[2013-08-13 23:39:21 -0400] _ci: Installation is easy
[2013-08-13 23:39:28 -0400] _ci: Executing the first time is easy
[2013-08-13 23:39:37 -0400] _ci: Answering the prompts... I'm lost
[2013-08-13 23:40:39 -0400] toneec: anyone a regular user of berkshelf?
[2013-08-13 23:41:27 -0400] coderanger: _ci: Ahh, don't use the tk thang, http://pwet.fr/man/linux/administration_systeme/automatedbastille
[2013-08-13 23:41:31 -0400] toneec: i'm not sure if I'm supposed to use this like librarian-chef with one Berkfile with all the cookbooks I want to manage, or have an individual Berkfile in each cookbook. Looks like the latter but I've read of people doing both....
[2013-08-13 23:41:42 -0400] coderanger: _ci: Thats just an interactive frontend to the bastille core :)
[2013-08-13 23:42:36 -0400] _ci: coderanger  thanks.  Should have known that there was another way to access
[2013-08-13 23:44:14 -0400] _ci: coderanger: lol, guess that is why there is google.  should have dug deeper.  THANKS!
[2013-08-13 23:44:42 -0400] joefitzgerald: @coderanger: this would work too, wouldn't it? https://github.com/joefitzgerald/windows/commit/f3238b502fa31d405c5a47e670294bfc390429c4
[2013-08-13 23:45:07 -0400] toneec: if i use one berkshelf file, I get the beauty of having multiple versions stored on my local disk, but since all my cookbooks are in individual public repos in Github, I get the commit ID, and not the version number
[2013-08-13 23:45:32 -0400] coderanger: joefitzgerald: I think so, might get a bit funky because of load ordering, but I think that is correct
[2013-08-13 23:45:48 -0400] joefitzgerald: at least it gives me a chance :)
