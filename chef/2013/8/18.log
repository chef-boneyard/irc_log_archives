[2013-08-18 01:19:19 -0400] schuckles: hi, i'm wondering if i coul possibly get some advice
[2013-08-18 01:19:30 -0400] schuckles: im having some major issues with the jenkins cookbook
[2013-08-18 03:22:32 -0400] garnertb: Hi all.  I'm running a private Chef instance on a VM on my local network and I think I have all of the hostnames working correctly.  Commands like knife client list work fine from my workstation, but when I attempt to upload cookbooks to the server I get an "Operation timed out error."  Any ideas?
[2013-08-18 03:32:19 -0400] adnichols: garnertb cookbook uploads talk to the bookshelf URL - run knife with -VV to see if you can tell what URL it's trying to use and whether that's correct
[2013-08-18 03:37:18 -0400] garnertb: Thanks adnichols. The address is right and its getting a 201 back from /sandboxes but the upload requests seem to be timing out.  Any ideas?
[2013-08-18 03:39:28 -0400] adnichols: I'm only familiar w/ OSS chef - but in that environment the server actually tells the client (knife) what URL to use for cookbook uploads rather than using the hostname in knife.rb - hence why I suggested looking at the URL it's trying to use
[2013-08-18 03:40:13 -0400] adnichols: Other than that, not sure - assuming this is chef 11?
[2013-08-18 03:43:27 -0400] garnertb: Yes, I'm running chef 11.
[2013-08-18 04:29:09 -0400] schuckles: i'm on opensource
[2013-08-18 04:30:08 -0400] schuckles: have to agree with adnichols wrt knife.rb
[2013-08-18 04:31:04 -0400] schuckles: also make sure that the /etc/chef/*blah* is all ka-jiggered correctly along with the low hanging fruit, i.e. firewall bs
[2013-08-18 04:32:08 -0400] schuckles: do a telnet *your chefserver* 4000 and see if you get a reply
[2013-08-18 09:30:25 -0400] rudd-o_: hello guys.  there is a six GB file cluster called .chef_design/* in /var/lib/ that is created by chef through couchdb, and compaction won't shrink it.  help!
[2013-08-18 09:41:59 -0400] schuckles: logging?
[2013-08-18 13:05:26 -0400] nate`: Say there's a value in a file, it happens to be an integer.  I want to read that value and then incriment by 1 should the recipe run again.
[2013-08-18 13:05:29 -0400] nate`: How would I go about that?
[2013-08-18 13:40:15 -0400] rovar: hello, all.  I am building a template which uses partials
[2013-08-18 13:40:48 -0400] rovar: in defining the data, I realize that I need to define a reference to variable in my environment in my attributes.. how can I evaluate that from a template?
[2013-08-18 13:41:16 -0400] nebrera2: helllo
[2013-08-18 13:41:38 -0400] rovar: e.g.   the environment has   [:cluster1][:management][:ip1]  and [:cluster1][:management][:ip2]  or somesuch
[2013-08-18 13:42:02 -0400] rovar: and I need to tell my template to evaluate  ...[:ip2]
[2013-08-18 13:59:55 -0400] nebrera2: hello, can I change values of the node in my server while this node has chef-client running ?
[2013-08-18 14:05:29 -0400] svanharmelen: sure you can when a chef-client run starts all attributes are resolved and used in the remainder of the run. so when you change a attribute value of a node it will just be picked up at the very next run...
[2013-08-18 14:06:32 -0400] nebrera2: I have tried this but I get different results
[2013-08-18 14:06:52 -0400] svanharmelen: such as?
[2013-08-18 14:06:59 -0400] nebrera2: do you have some time to help me please?
[2013-08-18 14:07:06 -0400] nebrera2: I will show you the template
[2013-08-18 14:07:50 -0400] nebrera2: on my recipe I have this
[2013-08-18 14:07:51 -0400] nebrera2: http://pastebin.com/hWH56QDu
[2013-08-18 14:08:34 -0400] nebrera2: if this script works it execute the following script
[2013-08-18 14:10:04 -0400] nebrera2: I will copy just the main part
[2013-08-18 14:10:11 -0400] nebrera2: node.set["redBorder"]["riak"]["joined"] = true
[2013-08-18 14:10:18 -0400] nebrera2: and node.save
[2013-08-18 14:10:51 -0400] nebrera2: I do see how it change the value but after the recipe finish the value has again the last value
[2013-08-18 14:12:08 -0400] svanharmelen: so your problem is that you are trying to update a node attribute from within a coobook/recipe which doesn't seem to work, right?
[2013-08-18 14:14:15 -0400] nebrera2: yes
[2013-08-18 14:14:19 -0400] nebrera2: does
[2013-08-18 14:14:29 -0400] nebrera2: doesn't
[2013-08-18 14:14:50 -0400] nebrera2: how could I do that ?
[2013-08-18 14:23:35 -0400] svanharmelen: just to be sure You are using a Chef server in your env right?
[2013-08-18 14:23:44 -0400] svanharmelen: not just Chef-solo?
[2013-08-18 14:25:23 -0400] nebrera2: erchef
[2013-08-18 14:26:02 -0400] svanharmelen: and I don't see you node.set and node.save commands in the snipped you send. you mention they are called from a script, so do you mean the node.set and node.save commands are called from the /opt/rb/bin/rb_join_riak.sh script?
[2013-08-18 14:27:29 -0400] nebrera2: yes
[2013-08-18 14:27:57 -0400] nebrera2: actually this script call other ruby script call this methods
[2013-08-18 14:28:23 -0400] svanharmelen: that will never work..
[2013-08-18 14:28:42 -0400] nebrera2: :-(
[2013-08-18 14:28:56 -0400] nebrera2: if I run the script locally it works
[2013-08-18 14:29:16 -0400] svanharmelen: you call this script as an external script which is executed by the OS outside your recipe context
[2013-08-18 14:29:16 -0400] nebrera2: I mean at the node no with the cookbook
[2013-08-18 14:30:05 -0400] svanharmelen: how do you mean? If you call the external .rb script manually on the console of the node it changes the node attibute?
[2013-08-18 14:30:21 -0400] svanharmelen: that would be extremely strange
[2013-08-18 14:30:28 -0400] svanharmelen: if not impossible
[2013-08-18 14:30:48 -0400] nebrera2: I will give you more details :-D
[2013-08-18 14:31:01 -0400] nebrera2: I have a erchef on node A
[2013-08-18 14:31:18 -0400] nebrera2: on node B I have chef-client connected to node A
[2013-08-18 14:31:40 -0400] nebrera2: I have on node B a pen can manage chef data with its api
[2013-08-18 14:31:56 -0400] nebrera2: and the node B can modify attributes
[2013-08-18 14:32:28 -0400] nebrera2: I have a script called /opt/rb/bin/rb_join_riak.sh on node B
[2013-08-18 14:33:35 -0400] nebrera2: and this script calls another script (if everything goes successfully to modify a concrete param
[2013-08-18 14:33:48 -0400] nebrera2: if I run on node B /opt/rb/bin/rb_join_riak.sh
[2013-08-18 14:34:00 -0400] nebrera2: it works and modify even the parameter value
[2013-08-18 14:34:20 -0400] nebrera2: do you understand me ?
[2013-08-18 14:34:34 -0400] svanharmelen: a little I think ;-)
[2013-08-18 14:36:12 -0400] nebrera2: :-D
[2013-08-18 14:36:23 -0400] nebrera2: it is wuite complicated actually explain it
[2013-08-18 14:36:28 -0400] nebrera2: *quite
[2013-08-18 14:36:40 -0400] nebrera2: the thing is the node.save return true
[2013-08-18 14:36:51 -0400] svanharmelen: I don't have a setup like that, so I cannot test/verify what you say but I still think it's a strange way of doing stuff and I even doubt that it is meant to work is such a way. but I must admit I think I still miss a lot of details to be exactly sure...
[2013-08-18 14:37:19 -0400] nebrera2: but after the chef-client finish precessing the recipe the value of this attribute doesn't change
[2013-08-18 14:37:52 -0400] nebrera2: I would like to mark a node with a flag
[2013-08-18 14:37:52 -0400] svanharmelen: what I would suggest is to move these node related calls to your recipe, instead of calling them in an external script
[2013-08-18 14:37:58 -0400] nebrera2: if this script works
[2013-08-18 14:38:04 -0400] nebrera2: how would you do it ?
[2013-08-18 14:38:18 -0400] nebrera2: ahm
[2013-08-18 14:38:21 -0400] nebrera2: interesting
[2013-08-18 14:38:44 -0400] nebrera2: how could I know if a execute returns 0 as exit ?
[2013-08-18 14:39:56 -0400] svanharmelen: if you remove the 'ignore_failure true', it will fail if it did not execute with 0
[2013-08-18 14:40:39 -0400] visof: hello
[2013-08-18 14:41:19 -0400] nebrera2: ahm
[2013-08-18 14:41:40 -0400] nebrera2: and how do I do something in case of success ?
[2013-08-18 14:41:49 -0400] svanharmelen: check this out http://docs.opscode.com/resource_execute.html
[2013-08-18 14:42:03 -0400] nebrera2: I would like to modify an attribute within the recipe
[2013-08-18 14:42:15 -0400] nebrera2: ok reading
[2013-08-18 14:42:24 -0400] visof: how can i set dependencies for cookbooks, if i have cookbook1 and cookbook2, and both are related and i'm running cookbook1 and it's depending on cookbook2 so i want to install cookbook2 before i install cookbook1
[2013-08-18 14:42:43 -0400] svanharmelen: and then look at the return attribute for the execute resource it defaults to 0 and gives you the possibility to change the default
[2013-08-18 14:42:57 -0400] visof: i'm using chef-solo
[2013-08-18 14:43:09 -0400] svanharmelen: so if the script does not return 0 it will fail your run
[2013-08-18 14:43:17 -0400] visof: is the .json installed in order?
[2013-08-18 14:47:50 -0400] svanharmelen: if it does return 0 it succeeds. so you could just add a notify to a ruby_block for example and in the ruby_block you could then make the calls
[2013-08-18 14:52:45 -0400] svanharmelen: even better would be to do some kind of actual check (if possible) to actively check if the node is a member of the cluster already, and if not execute the script. in that way you are always checking against the live state of your environment instead of against a (pre)written attribute but that a whole other story/question :)
[2013-08-18 14:56:00 -0400] nebrera2: thats what I do on the script
[2013-08-18 14:56:47 -0400] nebrera2: can I modify an attribute on the recipe ?  same maner ?
[2013-08-18 14:57:55 -0400] svanharmelen: what do you mean by 'on the recipe'?
[2013-08-18 14:58:12 -0400] nebrera2: cookbok
[2013-08-18 14:58:32 -0400] nebrera2: recipes/default.rb
[2013-08-18 14:59:12 -0400] svanharmelen: a recipe (should) only have some default values, if you need to overwrite them you should do that on the node (or role or environment) atributes
[2013-08-18 15:04:32 -0400] nebrera2: I have checked modify parameters and it works
[2013-08-18 15:04:57 -0400] nebrera2: now I will check how to control escecution exits code from the url you has passed to me
[2013-08-18 15:05:01 -0400] nebrera2: 5 minutes
[2013-08-18 15:05:02 -0400] nebrera2: :-D
[2013-08-18 15:05:49 -0400] svanharmelen: nice...
[2013-08-18 15:07:33 -0400] nebrera2: are you chef developer ?
[2013-08-18 15:09:37 -0400] svanharmelen: Well not from opscode if that's what you mean, but I do commit some stuff from time to time
[2013-08-18 15:10:05 -0400] nebrera2: nice
[2013-08-18 15:14:48 -0400] nebrera2: svanharmelen, I do not find anything about controlling the exit of the execute script in the recipe
[2013-08-18 15:14:59 -0400] nebrera2: at the url you provided to me
[2013-08-18 15:15:33 -0400] nebrera2: is it with notifies ??
[2013-08-18 15:17:08 -0400] svanharmelen: when you use the execute resource you are executing an external command or script. the exit code from that command or script is checked by the resource and matched against the returns attribute which by default only holds 0
[2013-08-18 15:17:43 -0400] nebrera2: yes
[2013-08-18 15:18:15 -0400] nebrera2: but how do I execute some code if it returns is 0
[2013-08-18 15:18:44 -0400] svanharmelen: that you will need to do by the notifies action
[2013-08-18 15:19:31 -0400] svanharmelen: and it will only notify if the execute resource is executed and the external command returned a valid exit code
[2013-08-18 15:19:53 -0400] nebrera2: ok
[2013-08-18 15:22:36 -0400] nebrera2: normally I have notify like
[2013-08-18 15:22:39 -0400] nebrera2: notifies :restart, "service[iptables]"
[2013-08-18 15:22:50 -0400] nebrera2: or an run
[2013-08-18 15:23:07 -0400] nebrera2: but how do I specify a block of code to execute ?
[2013-08-18 15:24:31 -0400] jbz: nebrera2:  You can use a 'script' resource and notify it.
[2013-08-18 15:24:39 -0400] jbz: (ruby, bash, etc. etc.)
[2013-08-18 15:24:44 -0400] svanharmelen: by using the ruby block resource and then
[2013-08-18 15:24:53 -0400] jbz: Er,right, ruby block
[2013-08-18 15:24:55 -0400] jbz: heh.
[2013-08-18 15:25:33 -0400] svanharmelen: http://docs.opscode.com/resource_ruby_block.html
[2013-08-18 15:26:38 -0400] nebrera2: thanks
[2013-08-18 15:34:36 -0400] svanharmelen: yw
[2013-08-18 15:50:05 -0400] nebrera2: worked!!!!
[2013-08-18 15:50:07 -0400] nebrera2: thanks
[2013-08-18 15:50:18 -0400] nebrera2: much cleaner now
[2013-08-18 15:52:01 -0400] svanharmelen: cool :)
[2013-08-18 15:54:36 -0400] yoshie902a: what type of response does this return    search("node", "role:#{node['haproxy']['app_server_role']} AND chef_environment:#{node.chef_environment}")
[2013-08-18 15:55:28 -0400] yoshie902a: does it return an array? hash?
[2013-08-18 15:55:43 -0400] yoshie902a: Is there a way to test it locally to see the response?
[2013-08-18 15:56:05 -0400] nebrera2: another question about the api
[2013-08-18 15:56:27 -0400] nebrera2: I have a node attribute with this path:   node["redBorder"]["manager"]["services"]
[2013-08-18 15:56:40 -0400] nebrera2: this is a has with many key => value fields
[2013-08-18 15:56:47 -0400] yoshie902a: can I test the api with knife?
[2013-08-18 15:56:48 -0400] nebrera2: I would like to delete a field
[2013-08-18 15:56:55 -0400] nebrera2: how can I delete it ?
[2013-08-18 15:57:23 -0400] yoshie902a: I'm assuming search is an api call by your response?
[2013-08-18 15:57:25 -0400] nebrera2: node["redBorder"]["manager"]["services"].delete("key1")    -> doesn't work
[2013-08-18 15:59:19 -0400] yoshie902a: solved. I found this that helps me  http://docs.opscode.com/essentials_search.html
[2013-08-18 15:59:23 -0400] yoshie902a: thanks
[2013-08-18 16:19:40 -0400] nebrera2: any help about how to delete an attribute key ?
[2013-08-18 16:22:11 -0400] jbz: nebrera2: I've never had to do that, and it makes me slightly nervous, but maybe node.delete['foo']['bar']?
[2013-08-18 16:22:23 -0400] jbz: But I don't actually *know*, not having done it...
[2013-08-18 16:22:41 -0400] nebrera2: I have tried too and doesn't work
[2013-08-18 16:22:47 -0400] jbz: Why delete?
[2013-08-18 16:22:51 -0400] jbz: Why not just set to nil?
[2013-08-18 16:23:13 -0400] nebrera2: I do that
[2013-08-18 16:23:26 -0400] nebrera2: but actually I see a key I don't like too much
[2013-08-18 16:23:36 -0400] nebrera2: but anyway it works for me too
[2013-08-18 16:23:53 -0400] nebrera2: just wonder if someone had needed it before
[2013-08-18 16:27:28 -0400] nebrera2: another issue I need is: someone logs chef-client to syslog ?
[2013-08-18 16:29:59 -0400] nebrera2: I have added: http://pastebin.com/jKVAFQjY  into chef-client.rb file
[2013-08-18 16:30:04 -0400] nebrera2: and it works
[2013-08-18 16:30:23 -0400] nebrera2: but sometimes it says me this:  LoadError: cannot load such file -- syslog_logger
[2013-08-18 16:30:28 -0400] nebrera2: but the gem is there
[2013-08-18 16:30:37 -0400] nebrera2: what it could be ?
[2013-08-18 16:30:57 -0400] nebrera2: I even log out and log in again and works again
[2013-08-18 16:52:24 -0400] nebrera2: if not, what log gin do you use ?
[2013-08-18 16:52:33 -0400] nebrera2: *logging
[2013-08-18 16:55:15 -0400] nebrera2: maniacal must review its connection :-D
[2013-08-18 20:32:35 -0400] nate`: hrm, I can't figure out how to obtain local IP address in a template, any pointers?
[2013-08-18 20:33:26 -0400] EricL: nate`: EC2?
[2013-08-18 20:33:43 -0400] nate`: Yes
[2013-08-18 20:34:07 -0400] nate`: I basically have to recreate r53 to get this task done, because the stupid job interview won't set up r53 for me
[2013-08-18 20:34:33 -0400] EricL: knife search 'name:$host' -a ec2.local_ipv4
[2013-08-18 20:34:45 -0400] nate`: Hrm, no knife allowed oddly enough either :P
[2013-08-18 20:35:19 -0400] nate`: I've basically been tasked to take a bolt out of my engine block with a screw driver.
[2013-08-18 20:35:21 -0400] EricL: The point is that it's available.
[2013-08-18 20:35:32 -0400] EricL: node['ec2']['local_ipv4']
[2013-08-18 20:35:44 -0400] EricL: -a is just showing you attribute.
[2013-08-18 20:37:04 -0400] nate`: so in theory for a zone file this should work: aws.cloud.       IN      A <%= node['ec2']['local_ipv4'] %>
[2013-08-18 20:37:33 -0400] nate`: Did I also mention I have to develop this in vagrant with no access to ec2?
[2013-08-18 20:37:38 -0400] nate`: err AWs
[2013-08-18 20:38:09 -0400] EricL: If you get a response from a knife search with a -a, then it also exists as a node attribute which you can retrieve from within a template.
[2013-08-18 20:38:54 -0400] EricL: I would be pissed at whomever is interviewing me.  I have a personal pet peeve against completely unrealisitic hiring scenarios.
[2013-08-18 20:38:59 -0400] nate`: Have no AWS, also not allowed to utilize knife for this code challenge.
[2013-08-18 20:39:12 -0400] EricL: I am a hiring manager and I would never ask someone to do shit that isn't likely to happen.
[2013-08-18 20:39:16 -0400] nate`: I just need some stupid damn crap to update my damn zone then get to work on chicken and egg scenario.
[2013-08-18 20:39:31 -0400] EricL: Yes, you can do what you suggested above.
[2013-08-18 20:39:42 -0400] EricL: Though I would use CNAME's instead.
[2013-08-18 20:39:46 -0400] nate`: that actually dumps out errors.
[2013-08-18 20:40:09 -0400] nate`: I have a fog script that worked with mock! that handles creation of the other records based upon tags that can be created through opsworks hopefully
[2013-08-18 20:40:13 -0400] EricL: and use node['ec2']['local_hostname']
[2013-08-18 20:40:14 -0400] nate`: If I read the damn documentation properly.
[2013-08-18 20:41:11 -0400] nate`: the line I pasted is where the error is in the template
[2013-08-18 20:42:04 -0400] nate`: Is there some aws cookbook I need to include for that to actually operate?  Or will I always get an error because I only have vagrant on hand?
[2013-08-18 20:44:12 -0400] EricL: I don't know.  I've never used Vagrant.
[2013-08-18 20:44:16 -0400] jbz: nate`: If you try to run that on a node that isn't an EC2 node, it will error out because the ['ec2'] namespace doesn't exist
[2013-08-18 20:44:25 -0400] jbz: Including a vagrant VM.
[2013-08-18 20:44:33 -0400] nate`: great, no way of validly testing.
[2013-08-18 20:44:36 -0400] nate`: <3 life.
[2013-08-18 20:44:39 -0400] jbz: Not without mocking it
[2013-08-18 20:44:54 -0400] jbz: I'd comment on that fact.  It might be a metaquestion. :-P
[2013-08-18 20:45:24 -0400] jbz: alternately
[2013-08-18 20:45:33 -0400] jbz: you could use the more generic ohai attribute
[2013-08-18 20:45:35 -0400] jbz: they did say 'local ip'
[2013-08-18 20:45:48 -0400] jbz: so you just have to get the one off the interface, not the 'magic' one that's the external EC2 address
[2013-08-18 20:46:02 -0400] nate`: I have a task to launch a three node zookeeper cluster fully automated from one command line script.
[2013-08-18 20:46:11 -0400] nate`: Task much launch in AWS
[2013-08-18 20:46:30 -0400] nate`: Issue #1 with AWS is I do not ever know IP addresses of machines.  Generally I would use r53 for that issue.
[2013-08-18 20:46:34 -0400] nate`: No r53 is given to me.
[2013-08-18 20:46:46 -0400] nate`: Therefore must create something similar.  I chose bind rather than djbdns.
[2013-08-18 20:47:17 -0400] nate`: Can automate all of that fairly simply.  I have a script that pulls based upon tags to create variables to append a zone file then do an rndc reload on a zone.
[2013-08-18 20:47:44 -0400] nate`: I cannot have a valid RFC compliant zone without getting local IP of said bind server, and not adhering to RFCs annoys the hell out of me.
[2013-08-18 20:48:13 -0400] nate`: Though I do have a chicken and egg scenario right now.  BIND server comes up first, then cannot update based upon tags of zookeeper servers.
[2013-08-18 20:48:33 -0400] nate`: zookeeper servers cannot figure out who the others are because there's no easy way to assign a random IP address into anything.
[2013-08-18 20:48:56 -0400] jbz: nate` node['ipaddress'] should just give you the ip of the primary local interface, and that should run within vagrant.
[2013-08-18 20:48:56 -0400] nate`: much should be must.
[2013-08-18 20:50:03 -0400] jbz: I'm fairly sure it ohai uses the ipaddr of the interface with the default route.
[2013-08-18 20:50:12 -0400] jbz: but not positive.
[2013-08-18 20:50:13 -0400] nate`: that actually did work in vagrant
[2013-08-18 20:50:25 -0400] jbz: yeh that doesn't rely on AWS hinting magic.
[2013-08-18 20:50:34 -0400] nate`: alright, now time to figure out my chicken and egg scenario.
[2013-08-18 20:50:45 -0400] jbz: so
[2013-08-18 20:50:57 -0400] jbz: if you don't have to do it all in one converge, that problem goes away, right?
[2013-08-18 20:51:14 -0400] jbz: BIND server comes up, searches for valid zookeeper nodes, doesn't find any, stands pat
[2013-08-18 20:51:24 -0400] nate`: BIND server does not know IPs of other machines that have been brought up.  Machines that have been brought up do not know about BIND server.
[2013-08-18 20:51:37 -0400] jbz: nate`:  If they're all on chef, they can search for each other.
[2013-08-18 20:51:40 -0400] nate`: I tell one group or the other about them, then one group doesn't know fully about the other.
[2013-08-18 20:51:55 -0400] nate`: jbz: chef-solo, no knife, no chef-server
[2013-08-18 20:52:00 -0400] jbz: oh derp.  My bad.
[2013-08-18 20:52:02 -0400] jbz: :-/
[2013-08-18 20:52:24 -0400] nate`: I just might say "screw this stupid requirement" and make a chef-server vagrant and figure it all out that way.
[2013-08-18 20:52:45 -0400] nate`: Though if I do that, I break the requirements of challenge for job.  Then do not obtain said job.
