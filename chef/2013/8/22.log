[2013-08-22 00:46:08 -0400] yoshie902a: I noticed that most recipes are written for Chef hosted/enterprise, from a big picture stand point, will most of these recipes have to modified if using them with Chef solo?
[2013-08-22 00:49:21 -0400] cpuguy83: yoshie902a: Only if they are implementing things like search, require roles, etc... stuff provided by chef-server
[2013-08-22 00:49:28 -0400] cpuguy83: Most should actually not depend on this.
[2013-08-22 00:52:30 -0400] yoshie902a: Is there a list of "stuff" that is provided by chef server that I can read?  I know about search, but did not know if there were other items I should look for.  It would be nice to have a quick reference sheet for it.
[2013-08-22 01:53:44 -0400] quanqued: Hi - new to chef, ran into a problem with chef-client cookbook failing to load the helper library correctly.  Haven't been able to find anything via google on opscode docs/tickets. What's the best place to post questions?
[2013-08-22 02:50:26 -0400] pcn: In chef 11, what is the right way to merge 2 bits of node attributes?
[2013-08-22 02:51:00 -0400] pcn: I'd like to take node["foo"]["1.0"] and merge its attributes into node["foo"]["current"] for instance, but not override those things that are set in current and not in 1.0
[2013-08-22 04:30:19 -0400] iverson0881: hi
[2013-08-22 04:30:37 -0400] iverson0881: setup a new box where i do my chef dev and started seeing this
[2013-08-22 04:30:59 -0400] iverson0881: FATAL: 5 nodes found, but does not have the required attribute to establish the connection. Try setting another attribute to open the connection using --attribute.
[2013-08-22 04:31:20 -0400] iverson0881: when running a knife ssh command
[2013-08-22 04:31:41 -0400] iverson0881: the servers i'm trying to connect to do have fqdn and ipaddress set and are not any cloud or vm type servers, just raw dedicated bare metal machines
[2013-08-22 04:34:09 -0400] iverson0881: command used: knife ssh name:thehost* -x ops uptime
[2013-08-22 04:36:31 -0400] jbz: iverson0881 Did you try specifying the attribute used to connect?
[2013-08-22 04:38:12 -0400] jbz: i.e. knife ssh name:thehost* -a ipaddress -x ops uptime
[2013-08-22 04:38:45 -0400] jbz: remember that the "name:thehost*" is the *search query* and not necessarily the attribute of the returned node records which will be passed to ssh to make the connection
[2013-08-22 04:38:49 -0400] jbz: that's what -a is for
[2013-08-22 04:43:11 -0400] iverson0881: jbz: hmm still no go. it works on box and not the other
[2013-08-22 04:43:34 -0400] iverson0881: jbz: don't even need the -a on the old box actually, both are running 10.20.0 package version
[2013-08-22 04:43:47 -0400] jbz: iverson0881: You can set the knife attribute in the knife.rb, is it being set on the old box?
[2013-08-22 04:43:57 -0400] jbz: er, the ssh_attribute
[2013-08-22 04:45:06 -0400] iverson0881: knife.rb on both servers are identical
[2013-08-22 04:45:09 -0400] jbz: hm
[2013-08-22 04:45:31 -0400] jbz: Can the second server search for nodes?
[2013-08-22 04:45:45 -0400] jbz: i.e. does "knife search node "name:NODENAME" -F json" work?
[2013-08-22 04:46:30 -0400] iverson0881: hmm
[2013-08-22 04:46:36 -0400] iverson0881: i probably have a borked chef install
[2013-08-22 04:46:45 -0400] iverson0881:    /var/lib/gems/1.9.1/gems/chef-10.20.0/lib/chef/knife/search.rb:113:in `block in run': undefined method `name' for #<Hash:0x00000001f4c030> (NoMethodError)
[2013-08-22 04:46:52 -0400] jbz: Urk.
[2013-08-22 04:47:13 -0400] jbz: oh hm
[2013-08-22 04:47:18 -0400] jbz: that might be 11.x format...
[2013-08-22 04:47:22 -0400] jbz: can't remember...
[2013-08-22 04:47:41 -0400] jbz: Does it work on the first server?
[2013-08-22 04:48:29 -0400] iverson0881: yeah things work just fine there as expected, was just workign on making sure my dev environment was in a role and then this propped up on the new test box
[2013-08-22 04:48:35 -0400] jbz: ah
[2013-08-22 04:48:41 -0400] jbz: ok then, you have a defined problem to fix :-)
[2013-08-22 06:01:56 -0400] SplasPood: 'lo, I'm trying to bring up a host using chef and as part of this process I need to drop off a config file (template) with certain contents, run a script to initialize a database, then regenerate that same template with slightly different values and restart the service.. not sure how to handle that dual template run...  any thoughts?
[2013-08-22 07:46:56 -0400] linuxboy: can someone look at this and merge it: https://github.com/opscode-cookbooks/jenkins/pull/59
[2013-08-22 07:54:49 -0400] Garo_: Hello. I'm developing a chef recipe, which contains a provider, which requires the usage of a gem. However if I try to "require 'mygem'" in the beginning of the provider, I get an "no such file to load" exception. What is the correct way to require (and install if needed) a gem within a provider?
[2013-08-22 07:55:43 -0400] spheromak: Garo_, https://github.com/spheromak/github_cookbook/blob/master/providers/hook.rb#L8-L25
[2013-08-22 07:56:06 -0400] Garo_: spheromak: thank you, I'll try to copy that! =)
[2013-08-22 07:56:28 -0400] spheromak: ignore the bad comment was from an earlier version where I installed some packages in there too
[2013-08-22 07:57:18 -0400] linuxboy: can someone comment on this? https://github.com/opscode-cookbooks/jenkins/blob/master/providers/job.rb#L86
[2013-08-22 07:57:28 -0400] linuxboy: if I have a URL with a space, that breaks
[2013-08-22 07:57:32 -0400] linuxboy: how do i fix this?
[2013-08-22 07:57:56 -0400] linuxboy: adding URI.escape fails, because it needs gsub
[2013-08-22 07:59:28 -0400] spheromak: linuxboy, thats just using ruby URI./escape it before you pass it to the provider ?
[2013-08-22 08:00:01 -0400] spheromak: er the reesource in thiss case ?
[2013-08-22 08:00:16 -0400] linuxboy: spheromak: what?
[2013-08-22 08:00:26 -0400] linuxboy: spheromak: I added a URL.escape in there
[2013-08-22 08:00:30 -0400] linuxboy: to fix the provider
[2013-08-22 08:00:37 -0400] linuxboy: but then it failed, it needs gsub
[2013-08-22 08:00:43 -0400] linuxboy: I'm not sure what the correct way to fix it is
[2013-08-22 08:01:29 -0400] spheromak: [4] pry(main)> a = URI.escape "http://some.com/foo/bar baz"
[2013-08-22 08:01:30 -0400] spheromak: => "http://some.com/foo/bar%20baz"
[2013-08-22 08:01:36 -0400] spheromak: doesn't require a sub
[2013-08-22 08:01:41 -0400] spheromak: don't edit the provider
[2013-08-22 08:01:51 -0400] spheromak: escape your string/url before you pass it in
[2013-08-22 08:08:30 -0400] linuxboy: spheromak: like this? https://gist.github.com/adrianmoisey/9b33d02bff4d18bde59b
[2013-08-22 08:08:40 -0400] linuxboy: ugh
[2013-08-22 08:08:41 -0400] linuxboy: URI
[2013-08-22 08:09:06 -0400] spheromak: yea
[2013-08-22 08:09:50 -0400] linuxboy: so the issue
[2013-08-22 08:10:02 -0400] linuxboy: actually
[2013-08-22 08:10:04 -0400] linuxboy: let me do this right
[2013-08-22 08:13:06 -0400] linuxboy: this feels like a hack
[2013-08-22 08:13:12 -0400] linuxboy: surely the provider should handle this for me?
[2013-08-22 08:21:37 -0400] linuxboy: spheromak: that doesn't work
[2013-08-22 08:22:20 -0400] linuxboy: when I do an enable-job, it chokes on the %20
[2013-08-22 08:22:26 -0400] linuxboy: the provider needs to handle this correctly
[2013-08-22 08:22:28 -0400] linuxboy: it's a bug
[2013-08-22 08:31:00 -0400] mburns: How would I iterate over the network interfaces of a node?
[2013-08-22 08:34:27 -0400] maniac: node.network.interfaces.each do |interface|
[2013-08-22 08:34:33 -0400] maniac: something like that i guess
[2013-08-22 08:35:45 -0400] linuxboy: spheromak: https://github.com/opscode-cookbooks/jenkins/pull/60
[2013-08-22 09:00:26 -0400] mburns: maniac: Sorry, I have that work. I'm trying to reference just the interface name 'eth0', 'eth1'. I'm sure how ruby work with hash tables like that.
[2013-08-22 09:00:50 -0400] mburns: erp, working*
[2013-08-22 09:02:28 -0400] maniac:     ifaces = node.network.interfaces
[2013-08-22 09:02:28 -0400] maniac:       ifaces.keys.grep(/^\w+\d+$/).each do |iface|
[2013-08-22 09:02:33 -0400] maniac: then try something like this =)
[2013-08-22 09:03:05 -0400] mburns: maniac++ :D
[2013-08-22 09:03:34 -0400] maniac: i guess this syntax will suite more to reality : (/^(\w+\d+|\w+\d+:\d+)$/)
[2013-08-22 09:03:50 -0400] maniac: t will match both eth0,eth0:1 etc
[2013-08-22 09:17:29 -0400] stevemac: evening all
[2013-08-22 09:18:05 -0400] stevemac: is there any way to switch the actions performed based on the ubuntu version running on?
[2013-08-22 09:52:51 -0400] ichilton: Anyone around familiar with "The Berkshelf Way" ?
[2013-08-22 10:58:47 -0400] mtpereira: ichilton: I'm really new to chef but that's how I've been trying to learn and use chef
[2013-08-22 11:08:27 -0400] micxer: anyone around using test kitchen a lot? i have a problem test a cookbook that's using a data bag
[2013-08-22 11:49:40 -0400] shredder12: hi everyone. I'm running into cookbook not found error while trying to run dynamically created resource in ruby_block. https://gist.github.com/shredder12/ce4e21996d289eab851d
[2013-08-22 12:03:07 -0400] shredder12: hi everyone, I need some help with dynamically created resources.
[2013-08-22 12:03:40 -0400] tralamazza: shredder12: that's inside a resource?
[2013-08-22 12:04:02 -0400] shredder12: tralamazza: here is my attempt https://gist.github.com/shredder12/ce4e21996d289eab851d
[2013-08-22 12:04:19 -0400] zts: shredder12: I'd guess you need to tell the template which cookbook contains the template (ie, I guess it can't work it out automatically)
[2013-08-22 12:04:22 -0400] tralamazza: shredder12: but that code is a resource? or a recipe?
[2013-08-22 12:04:31 -0400] shredder12: a recipe
[2013-08-22 12:04:42 -0400] zts: shredder12: but the fact that you are doing that at all seems pretty wrong to me - why do you need to do it that way?
[2013-08-22 12:05:10 -0400] tralamazza: shredder12: why can't you simply use template?
[2013-08-22 12:05:19 -0400] shredder12: zts: i wanted the contents of '/tmp/file' to be used as a variable for user_config.bash.erb file.
[2013-08-22 12:05:46 -0400] shredder12: but apparently, template was alwasy running before the "script" resource could create '/tmp/file'
[2013-08-22 12:05:52 -0400] shredder12: tralamazza: ^
[2013-08-22 12:06:15 -0400] tralamazza: shredder12: use notifications to order it?
[2013-08-22 12:06:54 -0400] tralamazza: with run :immediately
[2013-08-22 12:06:57 -0400] shredder12: zts: tralamazza i came to this conclusion because on every run with template resource, I got either empty or older value in /tmp/file(if I didn't delete it before rerunning chef-client)
[2013-08-22 12:07:36 -0400] shredder12: tralamazza: I used it and even chef-client showed the resources being executed in right order but it didn't work
[2013-08-22 12:08:55 -0400] tralamazza: put action :nothing on the template and notify it
[2013-08-22 12:09:03 -0400] zts: tralamazza: that wouldn't work
[2013-08-22 12:09:26 -0400] zts: that issue is that the `cat /tmp/file` runs at compile time (except if it's in a ruby_block)
[2013-08-22 12:09:56 -0400] zts: shredder12: one option is to run your script block at compile time, so that the file is already present before the template resource is compiled
[2013-08-22 12:10:12 -0400] shredder12: zts: how do I do it?
[2013-08-22 12:10:46 -0400] shredder12: zts: btw should all the contents in ruby_block run during 'execute' phase?
[2013-08-22 12:10:49 -0400] zts: shredder12: change the "end" (on line 8) to "end.run_action(:run)"
[2013-08-22 12:10:54 -0400] shredder12: *shouldn't
[2013-08-22 12:11:04 -0400] shredder12: zts: I'll try it
[2013-08-22 12:11:22 -0400] zts: shredder12: correct, the "block" code in your ruby_block will only run when the resource is converged/executed
[2013-08-22 12:12:47 -0400] tralamazza: ah script is compile time, I've never used that
[2013-08-22 12:13:10 -0400] jacobat: Is there some way to get the IP address of the node from within the nodes configuration (eg. knife node edit host)?
[2013-08-22 12:13:20 -0400] jacobat: I need to assign it to a configuration variable on the node
[2013-08-22 12:13:40 -0400] jacobat: Like: redis['bind'] = ip_of_node
[2013-08-22 12:14:07 -0400] tralamazza: node['ipaddress'] ?
[2013-08-22 12:14:32 -0400] gchristensen: that isn't present at knife node edit time
[2013-08-22 12:16:20 -0400] jacobat: So I'll have to hardcode it I guess
[2013-08-22 12:16:42 -0400] shredder12: zts:  tralamazza got it :)
[2013-08-22 12:16:59 -0400] shredder12: zts: what's the difference between end.run_action() and "action" attribute?
[2013-08-22 12:18:25 -0400] zts: shredder12: http://wiki.opscode.com/display/chef/Evaluate+and+Run+Resources+at+Compile+Time
[2013-08-22 12:19:17 -0400] shredder12: zts: it redirects to 404. I believe you meant http://docs.opscode.com/resource_common.html
[2013-08-22 12:19:31 -0400] zts: hm, it works for me
[2013-08-22 12:19:40 -0400] zts: ...oh wait, no it doesn't
[2013-08-22 12:19:55 -0400] zts: http://wiki.opscode.com/display/chef/Evaluate+and+Run+Resources+at+Compile+Time;jsessionid=996B67A5129809DDFF8915B72D6A018F <- that one does
[2013-08-22 12:20:13 -0400] shredder12: weird :-/
[2013-08-22 12:20:36 -0400] shredder12: thanks zts tralamazza :)
[2013-08-22 12:20:45 -0400] zts: shredder12: for a much longer explanation about what is happening, this blog is good too - http://erik.hollensbe.org/2013/03/16/the-chef-resource-run-queue/
[2013-08-22 12:22:46 -0400] shredder12: zts: wow! this is great. thanks :0
[2013-08-22 12:22:49 -0400] shredder12: :)
[2013-08-22 12:31:09 -0400] ichilton:  /window 21
[2013-08-22 12:31:11 -0400] ichilton: oops
[2013-08-22 12:31:12 -0400] ichilton: :)
[2013-08-22 12:36:31 -0400] jwitrick: is there a way to determine if a resource is already set to be executed laster in a chef run?
[2013-08-22 13:24:54 -0400] dendazen: hi guys I am trying to provision machine via vagrant behind proxy using chef_solo  and use in my vagrant file "install_method" => "package", but  I get  an error "Errno::ENETUNREACH
[2013-08-22 13:24:55 -0400] dendazen: ------------------
[2013-08-22 13:24:56 -0400] dendazen: Network is unreachable - connect(2)
[2013-08-22 13:25:16 -0400] dendazen: Did anyone had similar issue?
[2013-08-22 13:33:36 -0400] mehlah: Hey guys
[2013-08-22 13:34:24 -0400] mehlah: when runnung a execute command as a user "foo", what should be $HOME env variable ? I guess foo's home path
[2013-08-22 13:34:38 -0400] mehlah: someone has an idea why this issue happens: https://github.com/bower/bower/issues/810#issuecomment-23089521
[2013-08-22 13:34:58 -0400] mehlah: bower reads root home instead of the user executing the command 'bower install' home
[2013-08-22 14:29:07 -0400] Crashthatch: So I've created a resource, and I'm trying to save the values with JSON.pretty_generate( new_resource ), but I get a whole bunch of other properties also being output: noop, before, provider, allowed_actions etc. How do I just get the fields I defined?
[2013-08-22 14:30:36 -0400] fly9: hey if I have a cookbook that relies on roles but I'm using the app-cookbook pattern instead, how can I refer to the current or default role?
[2013-08-22 14:31:06 -0400] xhae: cookbooks shouldn't rely on roles
[2013-08-22 14:31:20 -0400] xhae: only other cookbooks
[2013-08-22 14:32:10 -0400] fly9: agreed
[2013-08-22 14:32:48 -0400] fly9: but if the best community cookbook available says it relies heavily on roles, can I still use it with a berkshelf pattern?
[2013-08-22 14:33:10 -0400] fly9: e.g. https://github.com/lusis/chef-logstash
[2013-08-22 14:33:34 -0400] fly9: I suspect its causing me problems now that I'm no longer using roles
[2013-08-22 14:33:39 -0400] jmartin: fly9: check out miah's cookbook as well, https://github.com/miah/chef_logstash
[2013-08-22 14:34:03 -0400] fly9: oh
[2013-08-22 14:34:42 -0400] fly9: jmartin: are you using this?
[2013-08-22 14:35:27 -0400] jmartin: fly9: im not, i just know that miah's cookbooks are usually high quality LWRP style
[2013-08-22 14:35:35 -0400] fly9: very cool
[2013-08-22 14:38:08 -0400] fly9: in any case, if I have a cookbook I suspect may be failing because a role hasn't been defined, is there a way I can refer to the current or default role?
[2013-08-22 14:46:20 -0400] Crashthatch: Is there a way to only get the attributes I specifically defined on my resource?
[2013-08-22 14:47:03 -0400] Crashthatch: ie. ignoring "allowed_actions", "source_line" etc?
[2013-08-22 14:47:21 -0400] tabolario: fly9: the cookbook might have an attribute where you can specify what role you want it to look for
[2013-08-22 14:47:51 -0400] fly9: It actually has an IP override, I was able to use that
[2013-08-22 14:48:12 -0400] tabolario: referring to this? https://github.com/lusis/chef-logstash/blob/master/attributes/default.rb#L15
[2013-08-22 14:52:17 -0400] ichilton: Anyone around familiar with "The Berkshelf Way" ?
[2013-08-22 14:55:34 -0400] bean: ichilton: yes.
[2013-08-22 14:56:33 -0400] ichilton: Hi bean
[2013-08-22 14:56:48 -0400] bean: ichilton: hi, whats you're question
[2013-08-22 14:56:50 -0400] ichilton: In "The Berkshelf Way" talk, Jamie says attributes can be configured on an environment level - is he referring to putting those in the environment file, or having them in the attributes files under the application cookbook?
[2013-08-22 14:57:21 -0400] ichilton: because having them in the environment goes against his argument about keeping everything in the application cookbook like not using roles
[2013-08-22 14:57:29 -0400] bean: The way I see it -- have sane defaults in the attributes file, but override them in the env
[2013-08-22 14:57:32 -0400] ichilton: but how would you do environment stuff in the cookbook
[2013-08-22 14:57:42 -0400] bean: are you using chef server
[2013-08-22 14:57:42 -0400] bean: ?
[2013-08-22 14:57:45 -0400] bean: or hosted chef?
[2013-08-22 14:57:47 -0400] ichilton: ah right, ok
[2013-08-22 14:57:50 -0400] ichilton: chef server
[2013-08-22 14:58:06 -0400] bean: yeah, sane defaults in the CB, then override in the env
[2013-08-22 14:58:13 -0400] ichilton: so the cookbook would work alone, but you can override in an environment which is optional
[2013-08-22 14:58:16 -0400] siezer: sane defaults in cookbook, override with normal level in recipes, overrite_attribtes when you have to via environments
[2013-08-22 14:58:23 -0400] ichilton: ok, gotcha
[2013-08-22 14:58:34 -0400] siezer: programatically drive the creation of environments with the API
[2013-08-22 14:58:44 -0400] siezer: (or manually manage with environment files)
[2013-08-22 14:59:00 -0400] ichilton: nod
[2013-08-22 14:59:28 -0400] ichilton: so, with that app cookbook pattern he describes...
[2013-08-22 15:00:05 -0400] ichilton: what if you have multiple apps - isn't there a lot of duplication if you create a cookbook for each, and each has myapp::webserver, myapp::database_server etc?
[2013-08-22 15:00:27 -0400] ichilton: or is that just deamed the lesser of two evils? - not DRY, but managable?
[2013-08-22 15:02:30 -0400] sparr: I am currently using a validation.pem and the chef-validator client, configured as validation_client_name in my client.rb. I want to, instead, pre-supply the client.pem and specify the name of the client to use. What is the syntax for that?
[2013-08-22 15:02:38 -0400] irr: Ohai Chefs. How to remove 'frozen?' flag from an uploaded cookbook?
[2013-08-22 15:04:05 -0400] adnichols: irr typicaly you just increment the cookbook version
[2013-08-22 15:04:32 -0400] adnichols: it doesn't "unfreeze" the older version of the cookbook - but allows you to upload changes
[2013-08-22 15:05:07 -0400] irr: adnichols: yeah and what if I don't want to do it? (we're not using '--freeze' at all and I don't want any version to be frozen)
[2013-08-22 15:05:23 -0400] bean: then don't freeze them :)
[2013-08-22 15:05:30 -0400] adnichols: ^^
[2013-08-22 15:05:45 -0400] bean: ichilton: i'd call it the lesser of the 2 evils
[2013-08-22 15:06:08 -0400] adnichols: irr perhaps someone is playing with spork? Dunno - you have to intentionally freeze cookbook versions afaik
[2013-08-22 15:06:27 -0400] ichilton: bean: ok, so that's the done way then - app cookbook for each app, and each has recipes for each service the app requires to run?
[2013-08-22 15:06:39 -0400] irr: adnichols: yeah thanks, I'll check it...
[2013-08-22 15:07:29 -0400] chris613: irr: you can override it with --force
[2013-08-22 15:08:01 -0400] bean: that seems likely ichilton
[2013-08-22 15:08:06 -0400] bean: ichilton: in reality its "up to you"
[2013-08-22 15:08:17 -0400] ichilton: nod
[2013-08-22 15:08:34 -0400] ichilton: so if you have multiple cookbooks, do you have to go round each and berks install?
[2013-08-22 15:08:55 -0400] ichilton: or is there a rake task or something which will go through them all in one go?
[2013-08-22 15:11:11 -0400] sparr: is there a community cookbook that can configure/manage /etc/resolv.conf on centos?
[2013-08-22 15:11:24 -0400] jtimberman: sparr: ckbk.it/resolver ?
[2013-08-22 15:11:25 -0400] yruss972: Hi- can someone explain under what circumstances does the resource retry the action?
[2013-08-22 15:12:08 -0400] jtimberman: yruss972: when you have defined a "retries" metaparameter on a resource.
[2013-08-22 15:12:12 -0400] ichilton: jtimberman: morning joshua
[2013-08-22 15:12:14 -0400] jtimberman: yruss972: retries 3 or something
[2013-08-22 15:12:29 -0400] jtimberman: yruss972: http://docs.opscode.com/resource_common.html#attributes
[2013-08-22 15:12:40 -0400] ichilton: jtimberman: what's your opinion on the whole berkshelf way thing? - is it the way forward?
[2013-08-22 15:13:01 -0400] yruss972: jtimberman: yes- if you have retries defined but how does it know that it failed/needs to retry?
[2013-08-22 15:13:34 -0400] jtimberman: ichilton: i like roles :)
[2013-08-22 15:13:45 -0400] ichilton: jtimberman: ah!
[2013-08-22 15:13:54 -0400] jtimberman: yruss972: any circumstance in which the resource fails will trigger a retry
[2013-08-22 15:14:15 -0400] ichilton: jtimberman: what about grouping things inside an application cookbook with recipes for each service?
[2013-08-22 15:14:21 -0400] sparr: jtimberman: how would that interact with something overwriting resolv.conf when getting dhcp info?
[2013-08-22 15:14:35 -0400] jtimberman: for example if you have a package resource, and the package installation failed say due to a transient connectivity error, it would fail and exit under normal circumstances. if you set retries, it would then try installing the package again
[2013-08-22 15:15:09 -0400] ichilton: jtimberman: you could still have roles which point to those recipes...
[2013-08-22 15:15:19 -0400] suffix: how would I use chef's log resource inside of a "ruby_block" resource?
[2013-08-22 15:15:51 -0400] yruss972: We have a provider which thinks it has failed and keeps retrying- how can we tell it that it has succeeded?
[2013-08-22 15:16:00 -0400] jtimberman: ichilton: sure :)
[2013-08-22 15:16:27 -0400] jtimberman: ichilton: i mean, I am *literally* right now working on a wrapper cookbook that modifies a community cookbook, and will put things in a role for this. :)
[2013-08-22 15:16:48 -0400] ichilton: :)
[2013-08-22 15:17:20 -0400] ichilton: In his example, he has a myface::common_system which does stuff like ntpd and users - which he includes in the other recipes like app_server, web_server, db_server etc
[2013-08-22 15:17:34 -0400] ichilton: is Chef clever enough to only do that include_recipe the first time?
[2013-08-22 15:17:39 -0400] jtimberman: it is.
[2013-08-22 15:17:47 -0400] ichilton: or will it try and process it on each recipe and rely on idempotance to stop it doing anything?
[2013-08-22 15:17:59 -0400] jtimberman: when it encounters include_recipe again, it says "not including it because i've seen it"
[2013-08-22 15:18:05 -0400] ichilton: brill
[2013-08-22 15:18:22 -0400] ichilton: so it's not bad practise to do that and have multiple include a common one?
[2013-08-22 15:20:06 -0400] ashish: I get uninitialized constant Chef::Resource::ApplicationBase with chef-client 11.4.4 and 11.6.0
[2013-08-22 15:21:20 -0400] Guest37925: I get uninitialized constant Chef::Resource::ApplicationBase with chef-client 11.4.4 and 11.6.0. Tthis is using the application_java cookbook
[2013-08-22 15:22:08 -0400] kisoku: do you have the application cookbook as well ?
[2013-08-22 15:22:22 -0400] Guest37925: yes
[2013-08-22 15:22:40 -0400] Guest37925: yes I do have the application cookbook
[2013-08-22 15:23:31 -0400] kisoku: do you have it listed as a dependency in your application cookbooks metadata.rb ?
[2013-08-22 15:23:54 -0400] kisoku: can you verify that the cookbook is being downloaded to the client's cookbook cache ?
[2013-08-22 15:24:03 -0400] Guest37925: yes. These cookbooks worked with chef server 11.x
[2013-08-22 15:24:19 -0400] Guest37925: am getting this error with chef server 10.18.2-1
[2013-08-22 15:24:26 -0400] ichilton: If people are following the application cookbook pattern - I assume you keep stuff like monitoring servers, gw/shell/vpn servers, chef server etc in separate cookbooks so they are generic and not tied to the application?
[2013-08-22 15:25:16 -0400] jtimberman: ichilton: it's totally fine to use include_recipe liberally, just be aware of ordering.
[2013-08-22 15:25:20 -0400] bean: ichilton: my monitoring server is a hand rolled monstrosity :)
[2013-08-22 15:25:29 -0400] ichilton: bean: doh ;)
[2013-08-22 15:25:32 -0400] ichilton: jtimberman: ta
[2013-08-22 15:25:44 -0400] bean: (it was made pre-chef /here/
[2013-08-22 15:25:45 -0400] bean: )
[2013-08-22 15:26:04 -0400] Guest37925: kisoku: would server version being 10 cause this. I do not see why
[2013-08-22 15:27:20 -0400] Guest37925: kisoku: I used berks to fetch and upload the dependencies to the server
[2013-08-22 15:27:25 -0400] ichilton: How do people deal with things like monitoring - because you don't want them in development? - do you have a flag attribute which default to false and the production environment sets it to true? do you check for vagrant? do you (can you?) check the environment in the recipe?
[2013-08-22 15:27:29 -0400] kisoku: jtimberman: are you guys ever going to fix include_recipe so that any included by that shows up in recipes ?
[2013-08-22 15:27:36 -0400] kl4m: bean: I started using sensu simply because the monitoring cookbook is clean and simple... :)
[2013-08-22 15:27:43 -0400] bean: :)
[2013-08-22 15:28:08 -0400] ichilton: Similarly with users - normally i'd had an ichilton user on the box - but on vagrant I just use the vagrant user - would people have checks in for vagrant to do that or use environments?
[2013-08-22 15:28:23 -0400] kisoku: Guest37925: just because you have the dependencies on the server doesn't mean that the client will know what to fetch
[2013-08-22 15:28:46 -0400] kisoku: I am assuming you have an application cookbook that depends on application_java ?
[2013-08-22 15:29:15 -0400] Guest37925: kisoku: the client has fetched the application cookbook. Actually I application_java cookbook throws this error. The client has indeed fetched the application cookbook
[2013-08-22 15:30:18 -0400] Guest37925: On the client I can see the cookbook in /var/cache/chef/cookbooks/
[2013-08-22 15:30:28 -0400] ichilton: kl4m: is sensu a nagios replacement or more graphs like munin?
[2013-08-22 15:30:49 -0400] kisoku: any chance you can use a slightly newer chef client ?
[2013-08-22 15:30:53 -0400] kisoku: like 10.26.0 ?
[2013-08-22 15:31:10 -0400] Guest37925: kisoku: yes I have my own application cookbook that depends in application_java
[2013-08-22 15:31:18 -0400] kl4m: ichilton: I use it for alerting with pagerduty only. I don't think it has any graphing or such, I send everything to graphite instead.
[2013-08-22 15:31:38 -0400] kisoku: can you try making your cookbook depend on application as well  /
[2013-08-22 15:32:37 -0400] Guest37925: kisoku: my application's metadata.rb file included both application and application_java dependencies
[2013-08-22 15:32:56 -0400] ichilton: kl4m: ah, ok - so more nagios like?
[2013-08-22 15:33:42 -0400] Guest37925: kisoku: these recipies worked and I remember chef-client using ruby 1.8. The fresh install is using ruby 1.9 could that be the issue ?
[2013-08-22 15:33:46 -0400] kl4m: ichilton: yes, and it's actually compatible with most(all?) nagios plugins, with the exit statuses
[2013-08-22 15:34:06 -0400] ichilton: kl4m: cool - will have to check it out,
[2013-08-22 15:39:37 -0400] kisoku: Guest37925: sorry. I don't know. try a newer version of the chef client
[2013-08-22 15:40:19 -0400] sparr: I have an attribute that is an array. I need to join it into a comma delimited list as part of a template. How might I do that?
[2013-08-22 15:43:07 -0400] sparr: https://gist.github.com/sparr/5ee394e27289a4ab95a2
[2013-08-22 15:43:10 -0400] sparr: I think that might work?
[2013-08-22 15:44:38 -0400] sparr: err, forgot a @, and a dash instead of a comma
[2013-08-22 15:47:56 -0400] fooJBar: sparr: something like http://pastebin.com/uEfGfum0
[2013-08-22 15:49:10 -0400] sparr: can I specify a template inside a conditional in a recipe?
[2013-08-22 15:49:35 -0400] fooJBar: yes you can define a template resource inside a conditional
[2013-08-22 15:55:13 -0400] Guest37925: kisoku: thanks
[2013-08-22 15:56:34 -0400] Guest37925: jtimberman: I get this  uninitialized constant Chef::Resource::ApplicationBase with chef-client 11.4.4 and 11.6.0. Any help
[2013-08-22 15:57:03 -0400] Guest37925: jtimberman: these recipies worked and I remember chef-client using ruby 1.8. The fresh install is using ruby 1.9 could that be the issue ?
[2013-08-22 15:57:56 -0400] eherot: What do y'all use to test a recipe that depends on node search or partial node search?
[2013-08-22 16:02:10 -0400] fooJBar: temporarily override the search method with my own mock implementation that returns something static.
[2013-08-22 16:03:31 -0400] eherot: fooJBar: heh, that's what I was going to do if no one answered :-)
[2013-08-22 16:03:44 -0400] fooJBar: eherot: great minds!
[2013-08-22 16:04:19 -0400] eherot: fooJBar: maybe I should write a 'mock_search' cookbook
[2013-08-22 16:04:48 -0400] zaargy: there are many already
[2013-08-22 16:04:48 -0400] fooJBar: eherot: write it as a library (Module) so that other people can mix it in their tests
[2013-08-22 16:04:51 -0400] zaargy: or just use chef zero
[2013-08-22 16:04:59 -0400] eherot: fooJBar: yeah that's what I had in mind
[2013-08-22 16:05:11 -0400] sparr: my chef logs different stuff to stdout when it's going to a console vs when it's being piped to a file
[2013-08-22 16:05:13 -0400] sparr: how can I fix that?
[2013-08-22 16:05:21 -0400] eherot: zaargy: aahhh yes I was trying to remember that thing's name
[2013-08-22 16:07:43 -0400] fooJBar: sparr: I have the same issue... It's mostly intentional, the output to stdout is much more verbose, we wouldn't want that in a log file, would we? I would :D
[2013-08-22 16:08:12 -0400] sparr: fooJBar: sure, but that can be handled by log_location
[2013-08-22 16:08:17 -0400] sparr: I'm just redirecting stdout
[2013-08-22 16:09:05 -0400] fooJBar: sparr: then Chef thinks it's not stdout anymore. Same when I run chef-client via an ssh command, I get the reduced output, annoying
[2013-08-22 16:10:03 -0400] fooJBar: sparr: same when running chef-client | tee chef.log
[2013-08-22 16:11:18 -0400] sparr: grr
[2013-08-22 16:11:52 -0400] fooJBar: sparr: there was some doc about forcing formatters output but never got it to work, havent tried since 11.6
[2013-08-22 16:12:40 -0400] fooJBar: sparr: --force-formatter seems to work now
[2013-08-22 16:12:56 -0400] fooJBar: sparr: try chef-client --force-formatter
[2013-08-22 16:22:13 -0400] scheuk: is there a way in chef11 to reload an attribute during the chef-client run?
[2013-08-22 16:22:33 -0400] scheuk: This is the system ruby/ohai/passenger-apache2 problem
[2013-08-22 16:23:06 -0400] scheuk: in chef10 I could do an ohai reload after installing system ruby and update the ohai attributes
[2013-08-22 16:23:15 -0400] scheuk: then perform a ruby block with
[2013-08-22 16:23:26 -0400] scheuk: node.load_attribute_by_short_filename('default', 'passenger_apache2')
[2013-08-22 16:23:57 -0400] scheuk: to update the passenger_apache2 attributes with the updated ohai attributes
[2013-08-22 16:24:13 -0400] d```: scheuk: I think the ohai recipe does that exact thing
[2013-08-22 16:24:29 -0400] scheuk: but with chef11 node.load_attribute_by_short_filename has been removed
[2013-08-22 16:24:54 -0400] scheuk: d```: do you mean an oahi cookbook?
[2013-08-22 16:25:05 -0400] scheuk: ahai
[2013-08-22 16:25:09 -0400] scheuk: ohai
[2013-08-22 16:25:18 -0400] scheuk: can't type today :)
[2013-08-22 16:25:20 -0400] dgarstang: Is anyone using -j with knife ec2 server create? It seems to have stopped working.
[2013-08-22 16:25:41 -0400] d```: scheuk: yes, sorry. the ohai cookbook default recipe
[2013-08-22 16:25:53 -0400] d```: or maybe some lwrp w/in the cookbook
[2013-08-22 16:26:37 -0400] sparr: https://github.com/opscode/chef/blob/master/lib/chef/provider/ifconfig.rb gives an example including a gateway, but the provider does not seem to provide functionality for configuring a gateway
[2013-08-22 16:33:05 -0400] sparr: am I missing something?
[2013-08-22 16:40:55 -0400] sparr: If I need to modify a default provider on my chef server (for future contribution as a patch to chef), should I be looking at /opt/chef-server/embedded/lib/ruby/gems/1.9.1/gems/chef-11.4.0/lib/chef/provider/
[2013-08-22 16:40:56 -0400] sparr: or /opt/chef-server/embedded/lib/ruby/gems/1.9.1/gems/chef-11.4.0/lib/chef/resource/ or /opt/chef-server/embedded/service/gem/ruby/1.9.1/gems/chef-11.4.0/lib/chef/provider/ or /opt/chef-server/embedded/service/gem/ruby/1.9.1/gems/chef-11.4.0/lib/chef/resource/ifconfig.rb?
[2013-08-22 16:41:01 -0400] gleam: holyspam
[2013-08-22 16:41:09 -0400] gleam: oh nevermind
[2013-08-22 16:41:26 -0400] sparr: (they all end in ifconfig.rb, sorry I forgot to remove one of those)
[2013-08-22 16:43:15 -0400] sparr: and I didn't trim the list well enough. sorry, a crappy way to ask
[2013-08-22 16:43:48 -0400] sparr: basically, it looks like I have duplicate files in embedded/service and embedded/lib
[2013-08-22 16:44:51 -0400] mahmoudi_: I'm curious about a pattern that I want to apply in my cookbooks - let's sya I have an application cookbook and I want to add some monit alerts to it -- only if the monit cookbook is enabled
[2013-08-22 16:45:08 -0400] mahmoudi_: is there an existing pattern to follow here?
[2013-08-22 16:45:57 -0400] cpuguy83: mahmoudi_: incldue the monit cookbook in your application's cookbook to ensure it's there.
[2013-08-22 16:47:06 -0400] mahmoudi_: cpuguy83, yep that's one way
[2013-08-22 16:47:09 -0400] xhae: mahmoudi_: if the monit cookbook sets any attributes, you can use those to test for its presence
[2013-08-22 16:47:27 -0400] cpuguy83: Honestly what I would do is created a common_system cookbook, put your monit configuring in a recipe in there, and then just include common_system::monit into whatever application cookbook that needs it
[2013-08-22 16:47:39 -0400] cpuguy83: *configuration
[2013-08-22 16:47:51 -0400] mahmoudi_: cpuguy83, so elasticsearch cookbook has a very interesting pattern
[2013-08-22 16:47:53 -0400] mahmoudi_: cpuguy83: https://github.com/elasticsearch/cookbook-elasticsearch/blob/master/metadata.rb#L15
[2013-08-22 16:47:57 -0400] mahmoudi_: recommends 'monit'
[2013-08-22 16:48:05 -0400] dgarstang: Is anyone using -j with knife ec2 server create? It seems to have stopped working.
[2013-08-22 16:48:14 -0400] mahmoudi_: cpuguy83, then they do: https://github.com/elasticsearch/cookbook-elasticsearch/blob/master/recipes/monit.rb
[2013-08-22 16:48:28 -0400] dgarstang: I mean, it won't even accept -j '{ "y": "x" }'
[2013-08-22 16:49:15 -0400] cpuguy83: mahmoudi_: This works if you are writing your cookbook to be used by the community and you want to provide a monit config
[2013-08-22 16:49:32 -0400] mahmoudi_: xhae, would that mean that the monit cookbook should run before any other cookbooks right?
[2013-08-22 16:50:14 -0400] mahmoudi_: cpuguy83, sure, but when you mean "used by the community" are you generally saying distributable cookbook?
[2013-08-22 16:50:16 -0400] xhae: mahmoudi_: it should precede elasticsearch::monit
[2013-08-22 16:50:38 -0400] cpuguy83: mahmoudi_: I'm saying outside your company, essentially.
[2013-08-22 16:51:23 -0400] cpuguy83: But you are in control of your servers, and you know you want monit to run for your application, so make it run, don't ask to see if it exists, know it exists.
[2013-08-22 16:51:59 -0400] m10n: dgarstang: which version of chef / knife-ec2 are you using? It's working fine for me but I'm on 11.4.4 chef / 0.6.4 knife-ec2
[2013-08-22 16:52:23 -0400] pcn: Hey all, how does one merge attributes in 11?  I'd like to merge in version-specific attributes and just use a base set of common attributes for those that aren't different.
[2013-08-22 16:52:31 -0400] pcn: I think that merge! may not work in 11.x
[2013-08-22 16:52:38 -0400] pcn: Or am I wrong about that?
[2013-08-22 16:53:00 -0400] dgarstang: m10n: chef 11.6.0-1 and knife-ec2 0.6.4
[2013-08-22 16:53:16 -0400] dgarstang: m10n: it was working fine for me too....
[2013-08-22 16:53:56 -0400] cpuguy83: pcn: Not familiar with previous attribute merging... but attributes are just a Ruby hash.  You can merge or reverse_merge hashes
[2013-08-22 16:54:22 -0400] cpuguy83: Or even set default values for a hash when the key is called (Hash#fetch)
[2013-08-22 16:55:54 -0400] dgarstang: *sigh* -j is kinda important
[2013-08-22 16:56:04 -0400] sparr: modifying a resource in /opt/chef-server/embedded/service/gem/ruby/1.9.1/gems/chef-11.4.0/lib/chef/resource doesn't seem to take immediate effect. is there something I need to do to get the chef server or a chef client to re-read / re-cache it?
[2013-08-22 16:59:07 -0400] scheuk: d```: the ohai cookbook is basically doing the same thing I am doing: ohai "reload" do; action :reload; end
[2013-08-22 17:01:12 -0400] dgarstang: Ugh, i know it's not chef... but someone here has to be an Amazon user. I have a iam user who's creds work for a describe on one system. on a different system, amazon gives me a 403 forbidden. same creds...
[2013-08-22 17:01:16 -0400] scheuk: my question is,  with chef11, can you set an attribute during a run and after performing an ohai reload, this attribute needs to use the updated attributes of oahi after the reload?
[2013-08-22 17:04:11 -0400] jshsu: how do i tell chef to install a gem from a private gem server? (using chef_gem resource)
[2013-08-22 17:05:41 -0400] cpuguy83: jshsu: with the "source" option"
[2013-08-22 17:06:26 -0400] jshsu: cpuguy83: hm ok, let me give it a try again, i thought i tried that one already
[2013-08-22 17:06:57 -0400] sparr: ok, I simply deleted the file from the gem that's giving me trouble, and it STILL gives me trouble, so I am obviously missing some detail about caching
[2013-08-22 17:07:27 -0400] m10n: dgarstang: not sure then.  Is your chef run completing? Anything ending up in "first-boot.json" ?
[2013-08-22 17:08:08 -0400] jshsu: cpuguy83: ah ok, nvm I was getting a gem dependency conflict =_=;;, thanks
[2013-08-22 17:18:28 -0400] sparr: is there a way to make chef "reinstall" one of the gems in its embedded ruby distribution (from the omnibus installer)?
[2013-08-22 17:22:54 -0400] cpuguy83: sparr: call the gem binary directly in /opt/chef/embedded/bin/gem
[2013-08-22 17:23:13 -0400] cpuguy83: sparr: Do a gem remove and a gem install... make sure you get the correct version.
[2013-08-22 17:23:23 -0400] sparr: hmm
[2013-08-22 17:23:26 -0400] sparr: not quite what I mean
[2013-08-22 17:23:31 -0400] sparr: I'm not sure the right terms to use
[2013-08-22 17:23:52 -0400] sparr: I am modifying/deleting files in /opt/chef-server/embedded/service/gem/ruby/1.9.1/gems/chef-11.4.0/lib/chef/provider/
[2013-08-22 17:23:56 -0400] sparr: and I want those changes to take effect
[2013-08-22 17:24:20 -0400] cpuguy83: Then just restart chef and they will have taken effect
[2013-08-22 17:24:25 -0400] sparr: ahh
[2013-08-22 17:24:28 -0400] sparr: that's the step I was missing
[2013-08-22 17:24:50 -0400] cpuguy83: FYI, this is a BAD idea.  Monkey patching (while still a bad idea) would be better.
[2013-08-22 17:25:10 -0400] sparr: also, what's up with duplicated files in /opt/chef-server/embedded/service/gem/ruby/1.9.1/gems/chef-11.4.0/lib/chef/provider/ and /opt/chef-server/embedded/lib/ruby/gems/1.9.1/gems/chef-11.4.0/lib/chef/provider/ifconfig.rb ?
[2013-08-22 17:25:21 -0400] sparr: err, ignore the ifconfig.rb on the end of that
[2013-08-22 17:25:49 -0400] sparr: I'd like to get this patch into chef officially if it works, but I just want to use it and make sure it works now
[2013-08-22 17:27:01 -0400] mveitas: What is the best way to capture metrics for chef-client run times?
[2013-08-22 17:27:44 -0400] spheromak: chef-handler
[2013-08-22 17:28:26 -0400] sparr: uhm, so, stupid question
[2013-08-22 17:28:42 -0400] sparr: how do I restart chef? "restart chef service" produces predictably unrelated search results
[2013-08-22 17:28:47 -0400] spheromak: sparr, you can rewrite any provider in a recipe. don't have to edit chef-internals
[2013-08-22 17:29:01 -0400] sparr: spheromak: yes, but I plan to submit this as a patch to chef internals
[2013-08-22 17:29:05 -0400] mveitas: spheromak... perfect as I can also hook in HipChat notifications in there as well! :)
[2013-08-22 17:29:05 -0400] spheromak: yea
[2013-08-22 17:29:24 -0400] sparr: someone got lazy and didn't finish implementing the functionality that they documented...
[2013-08-22 17:29:42 -0400] spheromak: sparr, I usually write the HWRP  in a cook for testing it out.  makes it much quicker.
[2013-08-22 17:29:53 -0400] spheromak: sparr, was it me ?
[2013-08-22 17:29:54 -0400] spheromak: :D
[2013-08-22 17:29:59 -0400] sparr: the resource is ifconfig
[2013-08-22 17:30:12 -0400] sparr: Chef::Resource::Ifconfig
[2013-08-22 17:30:45 -0400] spheromak: lol
[2013-08-22 17:30:55 -0400] spheromak: yea was some of the first ruby i ever hacked :\
[2013-08-22 17:30:59 -0400] sparr: dear god
[2013-08-22 17:31:04 -0400] spheromak: sorry :D
[2013-08-22 17:31:05 -0400] sparr: how can it be this hard to find out how to restart chef
[2013-08-22 17:31:10 -0400] sparr: no, not dear god for you
[2013-08-22 17:31:14 -0400] sparr: I'm just googling like crazh
[2013-08-22 17:31:16 -0400] sparr: crazy
[2013-08-22 17:31:23 -0400] spheromak: sparr, look @ the ohai cookbook
[2013-08-22 17:31:33 -0400] msmoyer: chef 10 or chef 11?
[2013-08-22 17:31:36 -0400] sparr: chef 11
[2013-08-22 17:32:02 -0400] msmoyer: chef-server-ctl restart
[2013-08-22 17:32:22 -0400] sparr: thanks
[2013-08-22 17:32:39 -0400] msmoyer: np
[2013-08-22 17:32:45 -0400] yields: is it me or there are a lot of bugs, in a lot of cookbooks ?
[2013-08-22 17:32:47 -0400] spheromak: oh chef-server
[2013-08-22 17:32:54 -0400] spheromak: thought you were trying to restart the run from a run
[2013-08-22 17:32:55 -0400] yields: maybe i'm just not used to ruby..
[2013-08-22 17:33:15 -0400] dgarstang: m10n: not getting that far
[2013-08-22 17:33:33 -0400] spheromak: yields, there are, and in general it seems that not coding defensive is a ruby  standard. Tho that might be a bit of a troll
[2013-08-22 17:33:34 -0400] sparr: so, I might have done `bin/gem install chef` and gotten a new version of the chef gem
[2013-08-22 17:33:39 -0400] sparr: and now I'm a lot more fucked than I was before
[2013-08-22 17:34:50 -0400] yields: spheromak: i thought there was something wrong with my setup.
[2013-08-22 17:35:28 -0400] eherot: Hmm.  What is the "right" way to call "search" from inside a custom chef library?
[2013-08-22 17:35:43 -0400] oddover__: hi all. Is there a way to see the old docs for installing chef solo? I followed an old doc, and I want to see what I did.
[2013-08-22 17:36:16 -0400] oddover__: I think the page I want is:http://wiki.opscode.com/display/chef/Installing+Chef+Client+on+CentOS, but it keeps redirecting me
[2013-08-22 17:36:27 -0400] yields: spheromak: in my berksfile i install `apt` using a direct git commit ref, that's really annoying.
[2013-08-22 17:36:29 -0400] oddover__: http://wiki.opscode.com/display/chef/Installing+Chef+Client+on+CentOS *
[2013-08-22 17:36:42 -0400] sparr: cpuguy83: restarting chef does not cause my changes to take effect
[2013-08-22 17:36:58 -0400] cpuguy83: sparr: Then you aren't doing something right :)
[2013-08-22 17:37:14 -0400] yields: spheromak: i'm currently looking for / trying other build tools.
[2013-08-22 17:37:25 -0400] sparr: specifically, I can delete /opt/chef-server/embedded/lib/ruby/gems/1.9.1/gems/chef-11.4.0/lib/chef/resource/ifconfig.rb and this does not affect the error I'm getting in the middle of using that resource
[2013-08-22 17:37:41 -0400] spheromak: yields, they all have their warts.
[2013-08-22 17:38:20 -0400] sparr: I can still use the resource, but if I spcify an undefined method in my recipe then I get an undefined method error when compiling the recipe
[2013-08-22 17:38:32 -0400] yields: how come ? isn't puppet based on manifest thing ?
[2013-08-22 17:38:37 -0400] yields: cc spheromak
[2013-08-22 17:39:11 -0400] sparr: cpuguy83: I have the strong suspicion that there is caching taking place somewhere along the way that I don't know about, and don't know how to clear/prevent
[2013-08-22 17:39:54 -0400] spheromak: sparr, would need to see the recipe in question and the error output in a gist.
[2013-08-22 17:41:02 -0400] cpuguy83: sparr: That is unlikely.  Are you modifying this on your workstation or on the node?
[2013-08-22 17:41:18 -0400] sparr: I am modifying it on the chef server
[2013-08-22 17:41:21 -0400] sparr: spheromak: https://gist.github.com/sparr/0976d3304233709912be
[2013-08-22 17:41:38 -0400] cpuguy83: sparr: Did you delete the cookbook from the node/
[2013-08-22 17:41:38 -0400] sparr: cpuguy83: I am modifying it on the chef server
[2013-08-22 17:41:39 -0400] spheromak: sparr, the client has its own set of providers
[2013-08-22 17:41:40 -0400] cpuguy83: ?
[2013-08-22 17:41:47 -0400] sparr: cpuguy83: which cookbook?
[2013-08-22 17:42:05 -0400] sparr: spheromak: where does it get them, and how do I modify them?
[2013-08-22 17:42:07 -0400] cpuguy83: Sorry... brain fart for a second.
[2013-08-22 17:42:25 -0400] cpuguy83: sparr: Chef server has a completely different installation of chef than your node
[2013-08-22 17:42:51 -0400] sparr: :|
[2013-08-22 17:42:55 -0400] sparr: I am, then, confused
[2013-08-22 17:43:15 -0400] spheromak: sparr,  client runs chef.  Chef server is a repository for cookbooks and does version solving.  Client runs its own chef.  the client chef is package or geem or omnipackage (omni being the recomended)
[2013-08-22 17:43:17 -0400] sparr: when do resources in /opt/chef-server/embedded/lib/ruby/gems/1.9.1/gems/chef-11.4.0/lib/chef/resource/ ever get used?
[2013-08-22 17:43:23 -0400] cpuguy83: sparr: If you want that code to run on your node then you'd have to edit the code on that node.
[2013-08-22 17:43:26 -0400] sparr: on the server
[2013-08-22 17:43:35 -0400] spheromak: sparr, almost neveer
[2013-08-22 17:43:41 -0400] sparr: spheromak: "almost"?
[2013-08-22 17:43:50 -0400] spheromak: sparr, chef server has the chef gem.
[2013-08-22 17:43:57 -0400] spheromak: but it is not a client.
[2013-08-22 17:43:58 -0400] sparr: I had the naive assumption that the server would provide those those resources to the client
[2013-08-22 17:44:26 -0400] spheromak: sparr, you could bee nutty and instantiate a run from the chef-server gem. cause there is the chef bits in there. but you would not ever really want to do that.
[2013-08-22 17:44:30 -0400] sparr: I guess I'm going to be forced to put a copy of my changed HWRP in my cookbook, then
[2013-08-22 17:44:32 -0400] spheromak: sparr, so never, but it is possible
[2013-08-22 17:44:54 -0400] spheromak: sparr, you change the provider on the client. not the server. The server does not ship chef to clients.
[2013-08-22 17:45:02 -0400] sparr: so, slightly more evil eye at omitting functionality from the resource in the first place :|
[2013-08-22 17:45:06 -0400] cpuguy83: sparr: The client has it's own installation. The chef bits don't get transferred, just cookbooks and such.
[2013-08-22 17:45:24 -0400] sparr: cpuguy83: yeah, that was confusing. the existence of the resources on the server made me expect them to be used for something
[2013-08-22 17:45:35 -0400] sparr: ok, so, entirely new track
[2013-08-22 17:45:47 -0400] cpuguy83: sparr: The server is really just an information store.
[2013-08-22 17:45:50 -0400] cjs226: I'm using the elasticsearch cookbook as a "library" cookbook and wrapping it with one specific for our use.  What's the best way to deal with a buggy library in the "library" cookbook? (https://github.com/elasticsearch/cookbook-elasticsearch/issues/122)  I created the fixed library to my wrapper cookbook and it works, but is that the best method?
[2013-08-22 17:46:09 -0400] sparr: cpuguy83: yes, and I thought resources were part of that information, like cookbooks and lwrps and...
[2013-08-22 17:46:34 -0400] sparr: I have a cookbook that I'm working with. My cookbook needs to use the ifconfig resource, but it needs to use a version of that resource modified by me. How can I override that resource in my cookbook with a modified copy?
[2013-08-22 17:46:35 -0400] spheromak: sparr, yes doing this stuff as a cook is generally the best way to go about it. If you are working on chef-internals then building and installing your own gem for client testing is a good aproach.  but a HWRP  in libraries is effectively the same thing in a cookbook or in lib/chef/providers
[2013-08-22 17:47:15 -0400] sparr: spheromak: now that I know how client resources work, I can't install my own gem. the client gets chef from an OS package, and nowhere else
[2013-08-22 17:47:37 -0400] spheromak: sparr, cookbooks, roles, environments are what the server knows. and manages to send to the clients.
[2013-08-22 17:47:43 -0400] sparr: ok
[2013-08-22 17:47:44 -0400] sparr: so
[2013-08-22 17:47:53 -0400] sparr: I've got provider/ifconfig.rb and resource/ifconfig.rb from the chef gem
[2013-08-22 17:47:58 -0400] spheromak: yeep
[2013-08-22 17:48:01 -0400] sparr: and I've made a modification
[2013-08-22 17:48:06 -0400] cpuguy83: cjs226: Yah, looks like you submitted the pull request that fixes the code... From there you can either wait for it to be merged or use Berkshelf to point to your fork with the changes
[2013-08-22 17:48:08 -0400] sparr: how do I get those into my cookbook?
[2013-08-22 17:48:11 -0400] spheromak: you can throw it in a cookbook  in librariees
[2013-08-22 17:48:14 -0400] spheromak: both of them
[2013-08-22 17:48:17 -0400] spheromak: exactly as-is
[2013-08-22 17:48:24 -0400] spheromak: and add that to the run list of a client
[2013-08-22 17:48:33 -0400] spheromak: and the functionality will be available
[2013-08-22 17:48:49 -0400] spheromak: http://docs.opscode.com/essentials_nodes_chef_run.html
[2013-08-22 17:49:14 -0400] sparr: so cookbooks/mycookbook/libraries/provider/ifconfig.rb and resource/ifconfig.rb ?
[2013-08-22 17:49:15 -0400] spheromak: Chef-client runs a compile phase  first.  where all of the ruby code is parsed
[2013-08-22 17:49:41 -0400] spheromak: nope
[2013-08-22 17:49:56 -0400] spheromak:  cookbooks/mycookbook/libraries/ifconfig_provider.rb is what I would do
[2013-08-22 17:50:25 -0400] sparr: why does this go in libraries/ instead of providers/ ?
[2013-08-22 17:50:26 -0400] spheromak: Cant recall if they fixed the non recursive load of libraries :P
[2013-08-22 17:50:36 -0400] spheromak: you could do it there as well, really
[2013-08-22 17:50:53 -0400] spheromak: the common practice is that LWRP's use  providers and resources directories
[2013-08-22 17:51:03 -0400] spheromak: and "pure" ruby classes in libraries/
[2013-08-22 17:51:30 -0400] sparr: ok
[2013-08-22 17:51:30 -0400] spheromak: i think, and I would need to go look @ code, but the LWRP loader might slurp anything in providers and resources.. could be wrong tho
[2013-08-22 17:51:41 -0400] zuazo: #!ohai
[2013-08-22 17:51:44 -0400] sparr: so I'll have libraries/ifconfig_provider.rb and libraries/ifconfig_resource.rb ?
[2013-08-22 17:51:49 -0400] spheromak: yep
[2013-08-22 17:52:30 -0400] dgarstang: Anyone using the now broken -j option to knife ec2 server create?
[2013-08-22 17:53:18 -0400] josephholsten: ok, how do I get the user resource to actually create the user's home on ubuntu?
[2013-08-22 17:53:41 -0400] josephholsten: `supports manage_home: true` isn't doing what I'd expect
[2013-08-22 17:54:25 -0400] sparr: spheromak: so, as to why I'm doing this... the usage example in the comments for the ifconfig provider says it supports a gateway option
[2013-08-22 17:54:29 -0400] sparr: but it doesn't :(
[2013-08-22 17:54:42 -0400] spheromak: it did at one point.
[2013-08-22 17:55:10 -0400] sparr: the commented usage example is the only instance of the word "gateway" in any of the relevant files in 11.4
[2013-08-22 17:55:31 -0400] spheromak: sparr, that might have been @ old job where I ran a different verion of that thing.
[2013-08-22 17:56:03 -0400] spheromak: sparr, yea pretty easy to add
[2013-08-22 17:56:13 -0400] sparr: easy to add to the creation part
[2013-08-22 17:56:20 -0400] sparr: not to the part for getting status of existing interface
[2013-08-22 17:56:25 -0400] spheromak: yea
[2013-08-22 17:56:33 -0400] sparr: because it's in `route`, not in `ifconfig`
[2013-08-22 17:56:40 -0400] spheromak:  /proc/net/route should have the if and info
[2013-08-22 17:58:02 -0400] spheromak: https://github.com/opscode/chef/blob/master/lib/chef/provider/route.rb
[2013-08-22 17:58:33 -0400] ignatz: chef cookbooks, y u no have changelogs?
[2013-08-22 17:59:01 -0400] zuazo: ifconfig doesn't support gateway because is not so simple to implement inside those providers
[2013-08-22 17:59:05 -0400] spheromak: sparr, so you can get away with using route and ifconfig vs just trying to do it in ifconfig.
[2013-08-22 17:59:26 -0400] spheromak: sparr, In the end I think thats what I did. I havn't used that stuff in like 2 years, but thats what i did @ oldjob
[2013-08-22 17:59:43 -0400] zuazo: the problem with the route resource is that doesn't manage the system config files
[2013-08-22 17:59:44 -0400] sparr: zuazo: I think I saw your comment to that effect on a patch to add persistent ifconfig support for debian systems
[2013-08-22 18:00:05 -0400] zuazo: sparr: yep
[2013-08-22 18:00:41 -0400] sparr: so, for now, I'm not caring enough to read existing routes
[2013-08-22 18:00:45 -0400] spheromak: zuazo, only worked on rhat
[2013-08-22 18:00:54 -0400] sparr: I'm just adding the GATEWAY line to my ifcfg or networks file
[2013-08-22 18:00:57 -0400] spheromak: back then thats what I was paid to make
[2013-08-22 18:00:59 -0400] zuazo: the gateway configuration in CentOS vs. Debian is quite different
[2013-08-22 18:01:39 -0400] zuazo: spheromak: you are right
[2013-08-22 18:01:42 -0400] spheromak: zuazo, it should not be difficult to add config file outtput for other platforms. Just no one did. I think most people just manage those files with templates
[2013-08-22 18:02:03 -0400] zuazo: for CentOS, gateway config should go inside route resource, for Debian systems inside ifconfig resource
[2013-08-22 18:02:16 -0400] zuazo: and this is would be confusing
[2013-08-22 18:02:28 -0400] sparr: spheromak: I don't mind that it's not there... I mind that the comments say it's there, and I based my plans on those comments
[2013-08-22 18:02:41 -0400] spheromak: I hada neeed at that job to manage a lot of interfaces and routes.  So i wrote this. I don't think either of those providers would/should be in core chef at this point. They should be LWRP/HWRP in a "network" cookbook IMO.
[2013-08-22 18:02:54 -0400] sparr: zuazo: why can't gateway go in ifconfig on centos? it can be set in the same place as other ifconfig items
[2013-08-22 18:03:15 -0400] spheromak: sparr, yea thats holdover. There was a version that did have that in the ifconfig. IIRC. but it was 0.7 chef
[2013-08-22 18:03:16 -0400] spheromak: :D
[2013-08-22 18:03:24 -0400] cpuguy83: ignatz: Let me help you with that: http://cdn.meme.li/i/oad3p.jpg
[2013-08-22 18:03:33 -0400] sparr: so, at minimum, I'm going to submit a one line patch to fix that comment
[2013-08-22 18:03:40 -0400] spheromak: zuazo, route.ifname in /etc/sysconfig/networking is the "redhat" way
[2013-08-22 18:03:45 -0400] spheromak: *routes.
[2013-08-22 18:04:06 -0400] spheromak: netowrking-scripts ..  again .. rusty on all that  :D
[2013-08-22 18:04:13 -0400] zuazo: sparr: because in centos you cannot put the gateway inside /etc/sysconfig/network-scripts/ifcfg-* (AFAIK)
[2013-08-22 18:04:16 -0400] spheromak: sparr, indeed!
[2013-08-22 18:04:24 -0400] jpterry: Can I ask a question about chef search syntax?
[2013-08-22 18:04:28 -0400] zuazo: so this provider should handle 2 config files
[2013-08-22 18:04:35 -0400] sparr: zuazo: you can
[2013-08-22 18:05:06 -0400] spheromak: zuazo, thats why I wrote route provide :P
[2013-08-22 18:06:44 -0400] jpterry: Is there a way to search top-level attributes only? Or a way to specify you mean a top level attribute. e.g. knife search node 'name:my-node-name' matches nodes with a node[:special_attrs][:name] = 'my-node-name', and I only want it to match the node who's actual chef node name is that.
[2013-08-22 18:08:33 -0400] zuazo: oh, spheromak and sparr, you are right
[2013-08-22 18:09:32 -0400] zuazo: the only reason that it is not implemented is to not add complexity to the executed command
[2013-08-22 18:10:16 -0400] zuazo: i will review this resources
[2013-08-22 18:11:54 -0400] zuazo: do you have any working example of an ifconfig resource/library supporting gateways?
[2013-08-22 18:12:12 -0400] sparr: ask me again in an hour :)
[2013-08-22 18:12:20 -0400] sparr: it's just a few lines of code, but I can't test it quite yet
[2013-08-22 18:12:32 -0400] zuazo: ok, sparr :-D
[2013-08-22 18:12:49 -0400] zuazo: no problem, I will try to test your code carefully
[2013-08-22 18:13:13 -0400] sparr: I just went through provider/ifconfig.rb and resource/ifconfig.rb and duplicated every bit of functionality for the "onparent" option
[2013-08-22 18:14:41 -0400] zuazo: sparr: chef 11.6?
[2013-08-22 18:14:53 -0400] coldboot|laptop: Can you look at old revisions of the knife data bag?
[2013-08-22 18:15:34 -0400] spheromak: coldboot|laptop, no bags aren't inherently versioned
[2013-08-22 18:16:37 -0400] spheromak: jpterry, thats interesting I thought that the top level key would be what you got. but you are seeing differently? search is solr underneath there might be some syntax you can use, but I am not sure. sorry
[2013-08-22 18:17:07 -0400] jpterry: Yeah it seems like nested attributes are also matched.
[2013-08-22 18:17:08 -0400] spheromak: jpterry, to say it another way. I've not seen that behavior before.
[2013-08-22 18:17:25 -0400] spheromak: jpterry, tho im firing up a chef-shell to test right now :D
[2013-08-22 18:17:47 -0400] RayS: any way to render a partial into a bootstrap erb? I'm getting "NoMethodError: undefined method `render'"
[2013-08-22 18:23:45 -0400] sparr: zuazo: 11.4
[2013-08-22 18:23:59 -0400] sparr: zuazo: I think some things changed in that provider in 11.6
[2013-08-22 18:25:27 -0400] zuazo: sparr: yes, there have been several changes in 11.6 in this provider
[2013-08-22 18:25:48 -0400] zuazo: but no problem
[2013-08-22 18:26:12 -0400] sparr: without knowing what they are, I still expect that I said above would work :)
[2013-08-22 18:26:28 -0400] sparr: one new method, one new option, one new optional line in the ifcfg file output
[2013-08-22 18:26:36 -0400] sparr: all mirroring the functionality for "onparent"
[2013-08-22 18:26:52 -0400] zuazo: sparr: http://tickets.opscode.com/browse/CHEF-3029
[2013-08-22 18:28:02 -0400] zuazo: but don't worry too much about that
[2013-08-22 18:28:12 -0400] sparr: yep, that's where I saw your name before :)
[2013-08-22 18:28:31 -0400] sparr: complete change of topic
[2013-08-22 18:28:47 -0400] sparr: I had a client.rb and validation.pem set up for my chef-client to register a new node and new client with the server.
[2013-08-22 18:29:02 -0400] sparr: I want, instead, to provide a pre-existing client.pem, but still have the node get registered
[2013-08-22 18:29:46 -0400] sparr: [how] can I do that? I tried providing client.pem, removing validation.pem, and removing validation_client_name from client.rb, but now I get an authentication error
[2013-08-22 18:30:56 -0400] jbz: sparr:  Clients are usually contexted per node
[2013-08-22 18:31:06 -0400] jbz: sparr: Why do you want to share a client?
[2013-08-22 18:31:07 -0400] sparr: jbz: I know. I can't handle that.
[2013-08-22 18:31:40 -0400] sparr: I am re-imaging nodes without backing up their client.pem and then giving them the same hostname they had before
[2013-08-22 18:32:04 -0400] sparr: which leads to them failing to be able to register, because the client they want to create already exists
[2013-08-22 18:34:14 -0400] jbz: sparr: right, um.  If you didn't back up their client.pemyou could get on the server and regenerate each of their private keys
[2013-08-22 18:34:24 -0400] jbz: that would give you a new, working client.pem for each of them
[2013-08-22 18:34:44 -0400] jbz: (sorry, regen the private keys of the various node clients)
[2013-08-22 18:34:48 -0400] sparr: I am trying to remove manual steps from this provisioning process
[2013-08-22 18:34:54 -0400] pcn: 10
[2013-08-22 18:34:59 -0400] pcn: oops
[2013-08-22 18:35:06 -0400] jbz: well, if you didn't save the private key, then there's no way to have them auth as those clients.
[2013-08-22 18:35:10 -0400] sparr: right
[2013-08-22 18:35:14 -0400] sparr: so I don't want them to try
[2013-08-22 18:35:14 -0400] jbz: That's the whole point of the keypair.
[2013-08-22 18:35:23 -0400] sparr: I'm going to generate one key pair ahead of time
[2013-08-22 18:35:30 -0400] sparr: and always give that key to the freshly imaged clients
[2013-08-22 18:35:34 -0400] sparr: nodes
[2013-08-22 18:35:50 -0400] sparr: but this seems to break node validation/registration
[2013-08-22 18:36:03 -0400] jbz: oh I see you're trying to register a new node with an existing client
[2013-08-22 18:36:05 -0400] sparr: so I'm hoping there's some configuration quirk I'm overlooking
[2013-08-22 18:36:06 -0400] sparr: yes
[2013-08-22 18:36:09 -0400] jbz: hm yeah ok, no, never seen that work
[2013-08-22 18:36:12 -0400] sparr: :|
[2013-08-22 18:36:17 -0400] jbz: haven't tried though
[2013-08-22 18:37:58 -0400] sparr: http://docs.opscode.com/config_rb_client.html
[2013-08-22 18:38:04 -0400] sparr: mentions that node_name is used to set client_name
[2013-08-22 18:38:13 -0400] sparr: but client_name doesn't appear to be a separate setting :(
[2013-08-22 18:40:44 -0400] dgarstang: If anyone cares, -j is broken in latest chef/knife ec2... works in knife google tho...
[2013-08-22 18:41:21 -0400] sparr: this is... unfortunate
[2013-08-22 18:41:22 -0400] sparr: if I've painted myself into a corner here then I've wasted a whole lot of time with chef :(
[2013-08-22 18:41:52 -0400] dgarstang: sparr: I had similar issues with node/client name
[2013-08-22 18:42:01 -0400] sparr: were you able to resolve them?
[2013-08-22 18:46:10 -0400] cpuguy83: sparr: Why do you want to have it separate?
[2013-08-22 18:47:33 -0400] josephholsten: ohai & knife reviews are thursdays, right?
[2013-08-22 18:53:20 -0400] zuazo: josephholsten: ohai reviews are mondays and wednesdays AFAIK
[2013-08-22 18:53:30 -0400] zuazo: josephholsten: http://wiki.opscode.com/display/chef/Code+Review
[2013-08-22 19:09:49 -0400] cpuguy83: Make Chef's documentation a little less dry: http://www.gizoogle.net/xfer.php?link=http://docs.opscode.com
[2013-08-22 19:11:19 -0400] dgarstang: Damn Damn Damn. I really wish knife ec2 would support agent forwarding OR honor reading .ssh/config. Not everyone is in a perfect world where all systems are directly reachable.
[2013-08-22 19:11:23 -0400] josephholsten: is the user resource supposed to create a home dir when manage_home is supported, is true, but no explicit home is provided?
[2013-08-22 19:13:19 -0400] m10n: dgarstang: -j working fine for me in Chef 11.6 / knife-ec2 0.6.4
[2013-08-22 19:15:05 -0400] dgarstang: m10n: not fer me... I can't even pass it -j '{ "x": "y" }'
[2013-08-22 19:15:23 -0400] dgarstang: m10n: What's your knife ec2 server create got for -A ?
[2013-08-22 19:17:04 -0400] m10n: I setup my knife.rb with my AWS creds
[2013-08-22 19:17:15 -0400] zuazo: josephholsten: i think you should set the home to use manage_home, yes
[2013-08-22 19:17:24 -0400] dgarstang: m10n: can you run 'knife ec2 server create -h' for me? What's -A say?
[2013-08-22 19:17:33 -0400] josephholsten: seems like the code requires it
[2013-08-22 19:17:56 -0400] m10n: dgarstang:    -A, --aws-access-key-id KEY      Your AWS Access Key ID
[2013-08-22 19:18:27 -0400] m10n: Also, this has bitten me before... make sure you're passing the options at the end of your command
[2013-08-22 19:18:38 -0400] dgarstang: m10n: hm. k. thought it might have said agent forwarding. seems the newest version is supposed to have that. Mine doesn't, thought maybe I still had an older version somehow
[2013-08-22 19:18:51 -0400] dgarstang: m10n: -j at the end?
[2013-08-22 19:19:33 -0400] dgarstang: m10n: yours look like this? http://pastebin.com/LfWq21LR
[2013-08-22 19:20:30 -0400] dgarstang: m10n: 'knife ec2 server create (options)' ... they all go at the end. :)
[2013-08-22 19:20:54 -0400] m10n: pretty much, it was a long long time ago but I had problems with ordering of options
[2013-08-22 19:21:04 -0400] m10n: and yes, my command looks a lot like that
[2013-08-22 19:22:50 -0400] dgarstang: m10n: darn it
[2013-08-22 19:23:48 -0400] dgarstang: thought it might have been my magical cli combo, but apparently not. Even this fails 'knife-hub ec2 server create -j '{ "node_env": "production" }''.... with 'A JSON text must at least contain two octets! (JSON::ParserError)'
[2013-08-22 19:35:53 -0400] dgarstang: *sigh* Why isn't my -A agent forwarding?!?!
[2013-08-22 19:36:15 -0400] adnichols: because it's a different command?
[2013-08-22 19:36:34 -0400] zuazo: ssh-agent not running?
[2013-08-22 19:36:40 -0400] dgarstang: adnichols: oh, it's just knife ssh?
[2013-08-22 19:36:57 -0400] dgarstang: zuazo: not the issue. -A shows --aws-access-key-id for me
[2013-08-22 19:37:00 -0400] sparr: cpuguy83: I don't have a good way to preserve client.pem when wiping and re-imaging a node
[2013-08-22 19:37:43 -0400] dgarstang: adnichols: nope. 'knife ssh -h' for me doesn't have a -A.
[2013-08-22 19:37:46 -0400] adnichols: dgarstang well yeah, -A is an ssh option
[2013-08-22 19:37:59 -0400] sparr: when I wipe and re-image and run chef again, I want it to be able to either use the old node or re-register
[2013-08-22 19:37:59 -0400] adnichols: as far as agent forwarding goes
[2013-08-22 19:38:14 -0400] adnichols: if you expect it to enable agent forwarding under the knife ec2 command  it wont
[2013-08-22 19:38:20 -0400] dgarstang: adnichols: yes, but people were saying it was a new option in knife ec2 server create, or maybe they meant ssh. If they meant ssh, they didn't follow my issue
[2013-08-22 19:38:21 -0400] zuazo: dgarstang: using knife try with --forward-agent
[2013-08-22 19:38:33 -0400] dgarstang: zuazo: I did. Doesn't work. Does it work for you?
[2013-08-22 19:38:51 -0400] sparr: let me try attacking this from a different direction... why are nodes and clients distinct entities in chef if they are required to have a 1:1 mapping? (I can think if at least one example where that's not true, but it's very close to accurate in my current situation)
[2013-08-22 19:39:02 -0400] zuazo: dgarstang: sorry, i have not tried
[2013-08-22 19:39:18 -0400] dgarstang: ok, so maybe -A HASN'T been added to knife
[2013-08-22 19:39:32 -0400] bean: sparr, i've heard (i think) that they will be be unifiying those concepts at some pt
[2013-08-22 19:39:47 -0400] chance: when deploying a custom app, do people typically name the root attribute "app" or the name of their project?
[2013-08-22 19:39:49 -0400] cpuguy83: Berksfile says "cookbook 'chef-solo-search', git: 'git://github.com/edelight/chef-solo-search.git'", berks install says 'Installing chef-solo-search (0.4.0) from site: 'http://cookbooks.opscode.com/api/v1/cookbooks''
[2013-08-22 19:40:11 -0400] chance: ex: node.app.someattr or node.mycoolbutlongername.someattr
[2013-08-22 19:40:26 -0400] sparr: maybe I can try describing my environment more thoroughly and someone can point out a better approach
[2013-08-22 19:41:30 -0400] zuazo: dgarstang: the forward agent is managed by the net-ssh gem
[2013-08-22 19:41:44 -0400] sparr: I have physical devices. I put CentOS and the chef client and some configuration for the chef client (client.rb, validation.pem, etc) on them using Cobbler. The Cobbler server is on an isolated network. I then plug the freshly cobbled device into my un-isolated network (or the internet) and it boots and can reach my chef server, which provides all the remaining setup and configuration.
[2013-08-22 19:41:58 -0400] dgarstang: zuazo: I think your referring to .ssh/config and that's net:mulissh or something
[2013-08-22 19:42:18 -0400] sparr: I want to have as few manual steps as possible involved in this process. Currently the first time I image a box everything works fine, but if I ever re-image it then its client.pem is lost and its subsequent attempt to register with the chef server fails.
[2013-08-22 19:45:52 -0400] dgarstang: chef, y u no provide way to ssh across proxy
[2013-08-22 19:45:53 -0400] sparr: since it seems I can't use a single client.pem for all those nodes, can someone recommend a different approach?
[2013-08-22 19:46:31 -0400] cpuguy83: sparr: Nothing that's secure.
[2013-08-22 19:47:49 -0400] sparr: cpuguy83: I'm already putting validation.pem on all the clients, are your ideas any less secure than that?
[2013-08-22 19:48:11 -0400] cpuguy83: sparr: validation.pem is OK since a node can only auth with that once.
[2013-08-22 19:49:05 -0400] cpuguy83: sparr: I was thinking somewhere along the lines of a 2nd service that you could call out to that has the private key for that client stored (or let chef create one if there isn't one already in storage).... but as I said, this isn't exactly secure.
[2013-08-22 19:49:20 -0400] sparr: I might need to write that service
[2013-08-22 19:49:24 -0400] sparr: that idea had occurred to me
[2013-08-22 19:50:08 -0400] sparr: another option I considered was putting an admin key on the fresh box
[2013-08-22 19:50:19 -0400] sparr: then if it fails to register, allow it to delete the client that it's conflicting with
[2013-08-22 19:50:24 -0400] sparr: then delete the admin key
[2013-08-22 19:51:23 -0400] zaargy: some treating your servers like pets and giving them names etc
[2013-08-22 19:51:28 -0400] zaargy: s/some/stop/
[2013-08-22 19:51:35 -0400] zaargy: and savign their state
[2013-08-22 19:51:55 -0400] adnichols: but I like my fluffy
[2013-08-22 19:53:00 -0400] sparr: ?
[2013-08-22 19:53:20 -0400] sparr: incidentally, the hostname for each server is FOO_MACADDRESS
[2013-08-22 19:53:24 -0400] sparr: FOO being the same for all of them
[2013-08-22 19:53:43 -0400] dgarstang: Anyone using -w option with knife ec2 server create?
[2013-08-22 19:53:43 -0400] sparr: this was done to simplify a lot of bookkeeping and manual processes elsewhere
[2013-08-22 19:54:03 -0400] zaargy: i don't know why you don't just delete the client before you reimage the box anyway
[2013-08-22 19:54:14 -0400] sparr: because I don't want the person reimaging the box to need to take that step
[2013-08-22 19:54:23 -0400] zaargy: you atuomate that step..
[2013-08-22 19:54:27 -0400] sparr: how?
[2013-08-22 19:54:35 -0400] zaargy: depending what reimaging means
[2013-08-22 19:54:43 -0400] sparr: running the centos installer
[2013-08-22 19:54:53 -0400] sparr: repartition, reformat, anaconda, kickstart
[2013-08-22 19:55:18 -0400] sparr: or, in a past iteration of this project, just cloning a template hard drive and sticking it back in the machine
[2013-08-22 19:55:48 -0400] mveitas: sparr, why not use something like Packer.io to help you out and build images
[2013-08-22 19:56:32 -0400] sparr: mveitas: I very briefly encountered packer while searching for an imaging/installing tool
[2013-08-22 19:56:38 -0400] sparr: it seems very slanted towards virtual environments
[2013-08-22 19:56:52 -0400] dgarstang: err, yeah, packer.io is for cloudy stuff, no bare metal
[2013-08-22 19:56:54 -0400] zaargy: so you provision with kickstart?
[2013-08-22 19:57:19 -0400] sparr: zaargy: yes, and the kickstart is generated by cobbler
[2013-08-22 19:58:16 -0400] zaargy: well at some point in the process you just need to run knife client delete somewhere if that node you are provisoning already exists
[2013-08-22 19:58:30 -0400] sparr: right
[2013-08-22 19:58:34 -0400] sparr: I don't want to do that
[2013-08-22 19:58:46 -0400] sparr: that would, at the very least, require creation of a new chef workstation somewhere
[2013-08-22 19:58:57 -0400] sparr: and either writing a front end for it, or teaching someone to use knife
[2013-08-22 19:59:05 -0400] sparr: and, most important of all, someone would have to *do something manually* to make that happen
[2013-08-22 19:59:21 -0400] zaargy: why would htey have to do it manually?!
[2013-08-22 19:59:32 -0400] sparr: when/how do you propose it gets done non-manually?
[2013-08-22 19:59:43 -0400] zaargy: as described above
[2013-08-22 19:59:55 -0400] sparr: humor me and describe it again?
[2013-08-22 20:01:48 -0400] zaargy: not sure hwat more i can say
[2013-08-22 20:01:56 -0400] sparr: can you say the part you're referring to again?
[2013-08-22 20:02:02 -0400] sparr: I'm really not sure which "above" you meant
[2013-08-22 20:02:14 -0400] sparr: you've said a few different things, and I think I've already replied to all of them
[2013-08-22 20:02:31 -0400] sparr: but if there was a way in there to delete the client without someone having to trigger that happening manually, I missed it
[2013-08-22 20:03:12 -0400] adnichols: sparr you can run knife node/client delete from anywhere - including inside a script
[2013-08-22 20:03:20 -0400] sparr: adnichols: yes, and what runs that script?
[2013-08-22 20:03:28 -0400] sparr: (and what runs that, and so on and so forth)
[2013-08-22 20:03:35 -0400] zaargy: you're right
[2013-08-22 20:03:37 -0400] zaargy: it's an impossible problem
[2013-08-22 20:03:42 -0400] zaargy: literally no one has solved htis ever
[2013-08-22 20:04:07 -0400] zaargy: everyone saves their client.pems and pretends machines and every bit of state generated by their machines
[2013-08-22 20:04:08 -0400] adnichols: that depends on your environment - you'll have to sort that out. The assumption here is that there's some way for someone to run a command
[2013-08-22 20:04:42 -0400] sparr: adnichols: there are plenty of ways for someone to run a command. they can 'knife client delete' or use the webui or do it some other way
[2013-08-22 20:04:47 -0400] adnichols: sparr you want to avoid that, which I get, so there's not really a solution I have for you
[2013-08-22 20:04:57 -0400] sparr: I was SO CLOSE to a solution
[2013-08-22 20:05:08 -0400] sparr: until I discovered node_name and client_name can't be separated in the client config :(
[2013-08-22 20:06:04 -0400] adnichols: yeah, with sufficient constraints any problems can be made impossible to solve
[2013-08-22 20:06:05 -0400] sparr: zaargy: I actually don't care about state at all during this part of the process. I'm wiping the machine and starting over. All I expect to preserve is a few settings that I've put in a data bag ahead of time.
[2013-08-22 20:09:13 -0400] gchristensen: jtimberman: so I really don't want to be irritating, but this ticket has gone 9 days without me hearing about any OHAI code review. is there one planned? pretty big bug that we've hit: http://tickets.opscode.com/browse/OHAI-499
[2013-08-22 20:11:45 -0400] dgarstang: Sew... anyone using knife ec2 server create with the -w option?
[2013-08-22 20:12:27 -0400] sparr: dgarstang: I envy you having knife ec2 so hard right now...
[2013-08-22 20:12:34 -0400] sparr: (knife vsphere is pretty awesome, too)
[2013-08-22 20:12:46 -0400] dgarstang: sparr: y?
[2013-08-22 20:13:15 -0400] sparr: none of the problems I'm having would be problems if I was working with virtual machines, or with machines with internet access during OS installation
[2013-08-22 20:13:23 -0400] sparr: or chef access
[2013-08-22 20:14:00 -0400] dgarstang: sparr: I suppose. bare metal sucks. end result is the same tho.... no progress and lots of frustration
[2013-08-22 20:14:16 -0400] gchristensen: man, bare metal is amaaazing. I love my metal.
[2013-08-22 20:14:19 -0400] sparr: bare metal without network access sucks even more
[2013-08-22 20:14:46 -0400] gchristensen: after going back to metal, the cloud feels like a scam :P
[2013-08-22 20:14:54 -0400] sparr: I occasionally want to strangle the network admin who decided it was unsafe to have my cobbler server on the real network (because "PXE uses DHCP and we can't have another DHCP server on our network")
[2013-08-22 20:15:07 -0400] cpuguy83: sparr: Why not just work with a VM?  Run KVM on your server, even if you only run one OS on it.
[2013-08-22 20:15:20 -0400] gchristensen: you get like 60% degredation in performance
[2013-08-22 20:15:34 -0400] gchristensen: depending ):
[2013-08-22 20:15:36 -0400] cpuguy83: gchristensen: I don't believe it's that much
[2013-08-22 20:15:43 -0400] cpuguy83: Can't be anywhere near that
[2013-08-22 20:15:52 -0400] gchristensen: I'm going to keep trucking on my metal
[2013-08-22 20:16:26 -0400] sparr: cpuguy83: the physical device goes in a physical location somewhere else
[2013-08-22 20:16:27 -0400] sparr: (many of them)
[2013-08-22 20:16:27 -0400] sparr: I'm turning set top boxes into little web servers, in a nutshell
[2013-08-22 20:16:29 -0400] sparr: gchristensen: performance is entirely not an issue for my use case, I could be running these on raspberry pis
[2013-08-22 20:16:38 -0400] gchristensen: that sounds cheaper
[2013-08-22 20:16:51 -0400] cpuguy83: chance: Also, there's always docker
[2013-08-22 20:16:52 -0400] zaargy: i don't see what makes baremetal any different really
[2013-08-22 20:18:43 -0400] gchristensen: for me its performance to cost
[2013-08-22 20:19:41 -0400] cpuguy83: gchristensen: There is really a very small performance cost with VM's, unless you are running a bunch of them on your server.  But running your actual operations on a VM instead of directly on bare is a lot safer
[2013-08-22 20:19:59 -0400] m10n: sparr: I solve this problem by randomizing hostnames and periodically trashing nodes that haven't checked in.  Alternatively, you could install knife on the client and allow it to delete itself as part of your bootstrapping process.
[2013-08-22 20:20:01 -0400] cpuguy83: And of course, with docker there is 0 performance hit and pretty much all the benefits of a VM
[2013-08-22 20:20:13 -0400] gchristensen: safer?
[2013-08-22 20:20:28 -0400] cpuguy83: gchristensen: If something goes wrong with the OS or whatever... it's not a trip to the DC
[2013-08-22 20:20:42 -0400] sparr: m10n: non-random hostnames have significant other utility to me. and it is very likely the node will have checked in shortly before being reimaged.
[2013-08-22 20:20:53 -0400] gchristensen: cpuguy83: KVMoIP and all, no trip to the DC ever
[2013-08-22 20:20:55 -0400] zaargy: what m10n said too +1
[2013-08-22 20:21:01 -0400] cpuguy83: Or, perhaps this has only happened to me... "Crap... I did ifdown and now have no access"
[2013-08-22 20:21:03 -0400] zaargy: that's my preferred approach too
[2013-08-22 20:21:04 -0400] sparr: m10n: installing knife, and appropriate user credentials, on the client seems functionally similar to providing an admin client key
[2013-08-22 20:21:12 -0400] dgarstang: cpuguy83: no console...
[2013-08-22 20:21:13 -0400] gchristensen: cpuguy83: you should grab yourself an IP KVM :)
[2013-08-22 20:21:49 -0400] dgarstang: gchristensen: those things never work very well. Integgrated lights out management on a sep network works better
[2013-08-22 20:22:01 -0400] sparr: I have a recipe that is modifying dhclient.conf after eth0 has already been configured with dhcp. I would like that recipe to trigger a re-dhcp-ing of that interface. How might I do that?
[2013-08-22 20:22:18 -0400] cpuguy83: gchristensen: Yeah... the last company I was at our IT manager (who, btw, had nothing to do with the servers we were managing) insisted on getting this KVM installed (not an IP one)... he could never remember how to actually use it.  IP KVM would have been the same price.
[2013-08-22 20:22:30 -0400] zaargy: although i just delete clients when they go away rather than do it on periodic interval
[2013-08-22 20:22:44 -0400] cpuguy83: We're talking something like $2k for the damn KVM
[2013-08-22 20:22:54 -0400] zaargy: you basically want something that emits all the events in your infra that you can hook into and there are various ways to do this
[2013-08-22 20:23:11 -0400] sparr: zaargy: if you delete a client, what happens to its matching node?
[2013-08-22 20:23:11 -0400] dgarstang: Any amazon guru's here?
[2013-08-22 20:23:37 -0400] cpuguy83: sparr: You have to delete the node too
[2013-08-22 20:23:44 -0400] sparr: hmm
[2013-08-22 20:23:45 -0400] gchristensen: cpuguy83: I believe that, mine work fine though.
[2013-08-22 20:23:51 -0400] sparr: this would not be a completely intractable solution for me
[2013-08-22 20:23:54 -0400] gchristensen: and I have them on all my servers, including networked power switches
[2013-08-22 20:24:00 -0400] sparr: my only persistent configuration goes in a data bag
[2013-08-22 20:24:01 -0400] mveitas: dgarstang, what's your question about amazon?
[2013-08-22 20:24:03 -0400] zaargy: delete the node too
[2013-08-22 20:24:41 -0400] cpuguy83: gchristensen: Where I am now, no KVM, but don't need one because vmware provides a soft-kvm
[2013-08-22 20:24:55 -0400] gchristensen: what happens if your hosts go away?
[2013-08-22 20:25:10 -0400] cpuguy83: My VM host?  Trip to the DC.
[2013-08-22 20:25:22 -0400] zaargy: and don't edit nodes objects on an adhoc basis obviously
[2013-08-22 20:25:23 -0400] cpuguy83: I don't have a KVM because the company is cheap, not because I wouldn't want one
[2013-08-22 20:25:41 -0400] gchristensen: gotcha.
[2013-08-22 20:25:46 -0400] dgarstang: mveitas: So.. I'm trying to get a list of canonical ami's. i have a script that works on an ec2 node... if I take that script and copy it locally (ie to a host outside amazon), the same script gets a 403 from amazon. it's using the same IAM credentials. AFAIK IAM credentials have no IP ACL's, so I can't work out why it's failing. One option is that I can't run a describe on canonical images from OUTSIDE amazon
[2013-08-22 20:25:52 -0400] gchristensen: well, I like my bare metal, and I like my KVMs :) it works pretty well.
[2013-08-22 20:25:57 -0400] gchristensen: but live and let live, brotha!
[2013-08-22 20:26:29 -0400] dgarstang: mveitas: nah wait, that can't be it. Because, I can run an ec2-describe-images on canonicals account
[2013-08-22 20:27:34 -0400] mveitas: dgarstang: Are you using the cli in your script?
[2013-08-22 20:27:58 -0400] dgarstang: mveitas: nope, boto
[2013-08-22 20:29:10 -0400] mveitas: I assume you've turned on debugging for boto to see what is being sent across the wire? Maybe it is some strange issue with the filter that is being sent
[2013-08-22 20:29:17 -0400] dgarstang: mveitas: one sec...
[2013-08-22 20:29:31 -0400] dgarstang: mveitas (didn't know boto had native debug)
[2013-08-22 20:30:59 -0400] RayS: any way to render a partial into a bootstrap erb? I'm getting "NoMethodError: undefined method `render'"
[2013-08-22 20:31:29 -0400] mveitas: dgarstang: http://boto.readthedocs.org/en/latest/boto_config_tut.html
[2013-08-22 20:44:50 -0400] dgarstang: mveitas: DUnno where that log output goes?
[2013-08-22 20:59:30 -0400] tubbo: hey guys, having a real weird issue on the postgresql cookbook:
[2013-08-22 20:59:32 -0400] tubbo: "apt-get -q -y install postgresql-client=9.1+129 returned 100, expected 0"
[2013-08-22 21:00:04 -0400] tubbo: in my role, `"postgresql": { "version": "9.3" }`
[2013-08-22 21:00:10 -0400] tubbo: which it doesn't seem to be respecting :(
[2013-08-22 21:00:25 -0400] dgarstang: Anyone know if packer.io is available as an .deb?
[2013-08-22 21:14:55 -0400] zaargy: dgarstang: shouldn't be much work to fpm it
[2013-08-22 21:16:57 -0400] ranjib: isnt it already using omnibus?
[2013-08-22 21:23:29 -0400] dgarstang: zaargy: fakeroot it. :-\
[2013-08-22 22:45:11 -0400] mtpereira: hello! I'm trying to use vagrant-cookbook to install vagrant-berkshelf plugin. in order to do that, I'm using a wrapper cookbook where I've set ["vagrant-omnibus", {"name" => "vagrant-berkshelf", "version" => "1.2.0"}] in node.set[:vagrant][:plugins]. vagrant-omnibus install just fine but vagrant-berkshelf doesn't, although chef(-solo) outputs that is installed and up-to-date
[2013-08-22 22:45:18 -0400] mtpereira: any guesses why this might be?
[2013-08-22 23:06:46 -0400] jeremyolliver: Hey, I've got a question. I'm having trouble including some helper libraries in a wrapper cookbook
[2013-08-22 23:07:26 -0400] jeremyolliver: I've got one 'config' cookbook which is just for giving a few helper methods to be used in multiple other wrapper cookbooks
[2013-08-22 23:07:51 -0400] jeremyolliver: the helper methods just read config out of a data bag, and provide specific methods on that data
[2013-08-22 23:08:35 -0400] jeremyolliver: But when I try and include the module that contains those methods in the wrapper cookbook via ::Chef::Recipe.send(:include, MyConfig) etc it doesn't seem to find it
[2013-08-22 23:09:06 -0400] jeremyolliver: even when I have that include in the same cookbook that defines that module (within it's libraries dir)
[2013-08-22 23:09:09 -0400] ranjib: are you including that cookbook?
[2013-08-22 23:09:12 -0400] jeremyolliver: anyone have any ideas?
[2013-08-22 23:09:17 -0400] ranjib: or declared it as dependency ?
[2013-08-22 23:09:18 -0400] jeremyolliver: yeah, I am including that cookbook
[2013-08-22 23:09:37 -0400] jeremyolliver: Ooh
[2013-08-22 23:09:53 -0400] jeremyolliver: actually, had include_recipe, doesn't look like I remembered the depends in metadata
[2013-08-22 23:10:12 -0400] ranjib: btw, you should be able use extend, instead of .send(:include)
[2013-08-22 23:10:12 -0400] jeremyolliver: odd, I would have thought I'd get an error there, but I'm running tests on Vagrant with chef-solo
[2013-08-22 23:10:15 -0400] ranjib: thats bad
[2013-08-22 23:10:29 -0400] jeremyolliver: cargo-culted from some opscode books ;)
[2013-08-22 23:12:19 -0400] jeremyolliver: Aha, it looks like that was the problem, running fine now that I've got the dependency declared correctly thanks :)
[2013-08-22 23:15:03 -0400] ranjib: awesome..
[2013-08-22 23:15:31 -0400] ranjib: include is a private methods provided my Module class, we should not use it in class context
[2013-08-22 23:16:42 -0400] jeremyolliver: instead of send I'm doing the same as many opscode cookbooks
[2013-08-22 23:16:51 -0400] jeremyolliver: class ::Chef::Recipe
[2013-08-22 23:16:52 -0400] jeremyolliver:   include ::Opscode::ChefClient::Helpers
[2013-08-22 23:16:52 -0400] jeremyolliver: end
[2013-08-22 23:19:17 -0400] ranjib: yeah
[2013-08-22 23:19:35 -0400] ranjib: dont do that.. thats like monkey patching,, all recipes will include those method
[2013-08-22 23:20:35 -0400] temujin9: anybody using spiceweasel with the --delete flag? It seems (from code) that it should be able to delete VMs, but my attempts only produce commands for the Chef portions (roles, databags, etc.)
[2013-08-22 23:20:42 -0400] ranjib: what you want is that particular recipe to mixin those methods. Now, recipes instance_eval, ed , every method you right (all resources) is a class method
[2013-08-22 23:21:02 -0400] ranjib: just do `extend Foo::Bar` on top of the recipe, thats it
[2013-08-22 23:21:03 -0400] temujin9: wondering if that's happening elsewhere, before I file a bug
[2013-08-22 23:22:52 -0400] jeremyolliver: ranjib: I'm aware it exposes it to every recipe. In this instance, I want it exposed to other recipes, without them having to do much. I'm making sure to choose method names that will avoid conflict
[2013-08-22 23:23:43 -0400] ranjib: oh.. then go for it.. if that what you want, +1 .
[2013-08-22 23:50:21 -0400] jmickle: anyone else have a lot of problems with the ark cookbook and finishing make
