[2013-11-22 00:25:29 -0500] kallistec: carmstrong, rsmitty all files other than recipes are always evaluated if the cookbook is present and in the run_list or depended on by a cookbook in the run_list
[2013-11-22 00:26:24 -0500] rsmitty: kallistec: so you would only need the depends in metadata.rb to get access to the attributes?
[2013-11-22 00:26:55 -0500] kallistec: rsmitty: yeah. You used to have to use include_attribute a lot to get things to load in a sane order, but now the order is mostly sane by default
[2013-11-22 00:26:59 -0500] carmstrong: kallistec: aren't the cookbooks loaded in alphabetical order, though? I was always told to explicitly include_attribute to make sure a cookbook has been parsed before mine
[2013-11-22 00:26:59 -0500] kallistec: as of 11.0
[2013-11-22 00:27:14 -0500] carmstrong: kallistec: good to know
[2013-11-22 00:27:22 -0500] rsmitty: yup. thanks for that.
[2013-11-22 00:27:44 -0500] kallistec: carmstrong: no, it's a simple dependency graph sort kinda thing, but it respects run_list order
[2013-11-22 00:27:44 -0500] fveillette: Hi how i can be sure that my nothifies resource working as expected?
[2013-11-22 00:28:06 -0500] carmstrong: kallistec: cool. you learn something new every day
[2013-11-22 00:28:13 -0500] kallistec: carmstrong: within a cookbook, default.rb is loaded first, then others are alphabetical
[2013-11-22 00:28:43 -0500] kallistec: carmstrong: so apache2/attributes/a.rb loads before apache2/attributes/z.rb
[2013-11-22 00:29:17 -0500] carmstrong: kallistec: gotcha. are they loaded if apache2 doesn't exist in any of my run lists, but is listed as a depends in my carmstrong-apache2 cookbook?
[2013-11-22 00:29:32 -0500] kallistec: carmstrong: yeah
[2013-11-22 00:29:36 -0500] carmstrong: k
[2013-11-22 00:29:56 -0500] kallistec: carmstrong: code for all that is here: https://github.com/opscode/chef/blob/master/lib/chef/run_context/cookbook_compiler.rb I tried to make it readable as best I could
[2013-11-22 00:30:26 -0500] carmstrong: kallistec: thanks. I really need to dig into chef internals to learn it. I've contributed patches to various cookbooks, but haven't dived into the beast itself
[2013-11-22 00:31:13 -0500] fveillette: Hi how i can be sure that my nothifies resource working as expected?
[2013-11-22 00:32:05 -0500] kallistec: fveillette: you need to run your cookbook in both the positive and negative cases to be sure
[2013-11-22 00:32:37 -0500] kallistec: fveillette: chef does verify that your notifies statement could be right, that is it points at a resource that exists
[2013-11-22 00:34:06 -0500] fveillette: i'm not sure i understand
[2013-11-22 00:34:17 -0500] fveillette: i have 2 ruby block
[2013-11-22 00:34:43 -0500] fveillette: i do logic to notifies 1 or the other depending of the case
[2013-11-22 00:34:51 -0500] fveillette: but it'ss aleays to be the same one notifies...
[2013-11-22 00:37:19 -0500] rsmitty: has anyone run into this issue? I'm writing a cookbook, upload it and add it to runlist. then when I 'sudo chef-client' it syncs and compiles the cookbook, but doesn't converge it
[2013-11-22 00:37:24 -0500] rsmitty: no error is thrown
[2013-11-22 00:37:38 -0500] kallistec: fveillette: notifies are unconditional, if a given resource modifed the system, then it fires all of its notifications
[2013-11-22 00:38:17 -0500] rsmitty: it also happened earlier with the community virtualbox recipe that i did a site install on
[2013-11-22 00:48:31 -0500] fveillette: if i a have a chef library that have function define to call zabbix api
[2013-11-22 00:48:44 -0500] fveillette: and my provider user that library
[2013-11-22 00:48:52 -0500] fveillette: to get some value into variable
[2013-11-22 00:49:10 -0500] fveillette: i understand when chef converge that that il will evaluate those variable
[2013-11-22 00:49:15 -0500] fveillette: so it does my call to the api
[2013-11-22 00:49:26 -0500] fveillette: since i call the provider 3 time in my recipe
[2013-11-22 00:49:51 -0500] fveillette: does at the second provider call i can keed value or data of the first provider call?
[2013-11-22 01:00:25 -0500] antonio_: \join #centos
[2013-11-22 01:42:55 -0500] lpb: ive noticed that the indexing of the array returned from a search within a recipe changes seemingly at random?  whats the logic behind building that array and is there a good strategy for consistency/predictability in terms of ordering when dealing with search results in a recipe?
[2013-11-22 01:45:18 -0500] vigith: any easy way to create UUID in chef?
[2013-11-22 01:48:32 -0500] mmzyk: lpb given that search result can potentially change you probably don't want to rely on array indexing being the same.
[2013-11-22 01:48:45 -0500] mmzyk: That said, it's all ruby, so you can always sort it.
[2013-11-22 01:49:38 -0500] lpb: mmzyk: well the search results should stay fairly consistent for this use case, ie building a set of backends for pgpool
[2013-11-22 01:50:22 -0500] lpb: mmzyk: i considered sorting by ip but that would constrain me in the sense that i cant add slaves with lower addresses than the master
[2013-11-22 01:50:42 -0500] lpb: mmzyk: sort by node age perhaps? assuming that my master will be the oldest and my slaves should all be younger?
[2013-11-22 01:51:28 -0500] mmzyk: I don't know what would be a good answer to sort on. I'm also not certain how that array is being built, so you could also dig into the source and find out.
[2013-11-22 01:51:51 -0500] mmzyk: vigith: for a uuid, the chef reporting system makes use of uuids, so you can probably piggyback off what it is doing. https://github.com/opscode/chef/blob/master/lib/chef/resource_reporter.rb#L110
[2013-11-22 01:51:59 -0500] lpb: mmzyk: thanks
[2013-11-22 01:52:26 -0500] mmzyk: np, lpb, hope it helps for what it's worth.
[2013-11-22 01:53:54 -0500] vigith: mmzyk: checking
[2013-11-22 01:54:27 -0500] vigith: mmzyk: thank you
[2013-11-22 01:54:58 -0500] mmzyk: vigith np. It's a new system, so it hasn't been there long.
[2013-11-22 02:03:54 -0500] lpb: mmzyk: very helpful thanks
[2013-11-22 02:04:10 -0500] lpb: it kind of turned me on to a solution that i should have already considered :)
[2013-11-22 02:05:39 -0500] mmzyk: Glad it helped then.
[2013-11-22 02:07:10 -0500] mpechner: Is anyone using chef to configure linux containers? Not talking about using chef to intall the container. But configure containers once created.
[2013-11-22 02:15:28 -0500] adnichols: mpechner: I've been experimenting testing recipes inside docker - but we aren't actually using containers outside the context of testing
[2013-11-22 02:16:17 -0500] mpechner: ok thanks.  I am just reading about lcx today. Trying to figure it out.
[2013-11-22 02:16:51 -0500] ericReeves: We just started playing with vagrant-lxc inside of a big Ubuntu VBox VM for standing up multi-node dev/test environments.
[2013-11-22 02:16:52 -0500] mpechner: In a simplistic perspective,  If I run from a container,  I can treat it as a machine?
[2013-11-22 02:16:57 -0500] adnichols: what are you trying to figure out? I've used lxc a bit
[2013-11-22 02:17:08 -0500] ericReeves: And we treat the LXC's like standard systems.
[2013-11-22 02:17:09 -0500] adnichols: mpechner: mostly, there are some caveats
[2013-11-22 02:17:31 -0500] adnichols: mpechner: lxc has fewer caveats than docker
[2013-11-22 02:17:40 -0500] mpechner: I am moving from using cloudformation to baremetal servers
[2013-11-22 02:18:03 -0500] mpechner: Our current philosophy is to drain on stack rom cloud formation and bring up another
[2013-11-22 02:18:17 -0500] mpechner: On bare metal figure have 2 containers.
[2013-11-22 02:18:34 -0500] mpechner: One running the current release and the second ready to run the next.
[2013-11-22 02:18:51 -0500] adnichols: mpechner: sounds reasonable
[2013-11-22 02:18:51 -0500] mpechner: fuzzy enough?
[2013-11-22 02:19:29 -0500] adnichols: mpechner: each lxc container can have it's own IP and such - so you can pretty much treat them like individual machines
[2013-11-22 02:19:41 -0500] mpechner: So, if I boostrap the'host machine' using chef, should I then be able to bootstrap the 2 containers?
[2013-11-22 02:19:59 -0500] mpechner: excellent
[2013-11-22 02:20:05 -0500] mpechner: I'll start playing.
[2013-11-22 02:20:06 -0500] adnichols: mpechner: Those two are independent really - you can bootstrap the containers as long as they have connectivity and you can login to them
[2013-11-22 02:20:15 -0500] mpechner: Happy I'm barking up the correct tree this time
[2013-11-22 02:20:17 -0500] adnichols: mpechner: bootstrapping the host isn't a requirement
[2013-11-22 02:20:22 -0500] mpechner: thank you for your feedback
[2013-11-22 02:20:35 -0500] adnichols: sure
[2013-11-22 02:20:55 -0500] mpechner: I'll boot strap to get lcx installed and the containers created
[2013-11-22 02:21:03 -0500] adnichols: makes sense
[2013-11-22 02:21:12 -0500] mpechner: then bootstrap the containers.  Yep I will be giving each an IP address
[2013-11-22 02:21:30 -0500] adnichols: yeah, so each is its own node/client and you just bootstrap it - works fine
[2013-11-22 02:21:43 -0500] mpechner: excellent
[2013-11-22 02:21:44 -0500] adnichols: have done that for jenkins build slaves
[2013-11-22 02:22:40 -0500] mpechner: still getting a handle on chef.  in my first month of using it
[2013-11-22 02:22:40 -0500] adnichols: I have run into weird issues when I started cloning containers and such - but if you build off a template it seems to be fine
[2013-11-22 02:23:11 -0500] mpechner: Yes. No clone, just build from a template
[2013-11-22 03:49:38 -0500] maniacal: I'm trying to get the environment name into my client.rb at bootstrap time.  Ive tried the following in my boostrap erb file and hasn't worked:  "<%= @config[:bootstrap_environment] %>"   and   "<%= @chef_config[:environment] %>"
[2013-11-22 03:49:51 -0500] maniacal: both ended up with an empty string in client.rb
[2013-11-22 03:57:17 -0500] maniacal: sometimes I feel like I'm the only guy who cooks at night :)
[2013-11-22 04:03:23 -0500] adnichols: you aren't - but I'm usually too worn to focus on stuff like that :)
[2013-11-22 04:05:15 -0500] adnichols: fwiw I'm not sure the environment is part of a nodes config - in recipes you access it w/ node[:chef_environment]
[2013-11-22 04:05:27 -0500] adnichols: but during bootstrap I'm not sure what's accessible
[2013-11-22 04:12:21 -0500] maniacal: I would think it's available because it's passed to the knife command.  And it looks like it here:  https://github.com/opscode/chef/blob/master/lib/chef/knife/core/bootstrap_context.rb
[2013-11-22 04:12:45 -0500] maniacal: as well as some rdocs I found on it earlier that I can't find now
[2013-11-22 04:15:57 -0500] maniacal: And there's other parts of that hash available at the time: https://gist.github.com/Maniacal/7594788
[2013-11-22 04:24:47 -0500] adnichols: environment being the only one that doesn't work?
[2013-11-22 04:39:56 -0500] maniacal: adnichols: yes
[2013-11-22 04:55:51 -0500] maniacal: found it.  It was "<%= @config[:environment] %>"
[2013-11-22 04:57:09 -0500] maniacal: I tried everything but that one.  duh.  I should have know because the 'chef_node_name' is in that one.  and that's another option passed via the command line
[2013-11-22 04:57:16 -0500] maniacal: thanks for trying to help
[2013-11-22 05:02:49 -0500] jchauncey: adnichols: you there?
[2013-11-22 05:35:50 -0500] robawt: ello!
[2013-11-22 05:36:10 -0500] robawt: bummed to find out chef conf is going on during the same weekend as PyCon
[2013-11-22 05:38:15 -0500] jchauncey:  so not sure if converting this lwrp to an hwrp is going to make my life any easier
[2013-11-22 05:38:25 -0500] jchauncey: testing providers really suck
[2013-11-22 08:52:12 -0500] Zauberfisch23: good day gents
[2013-11-22 08:52:30 -0500] divad: hi there
[2013-11-22 08:53:35 -0500] Zauberfisch23: I am currently looking for bare metal provisioning, before I continue with learning more chef. what setups would you recommend?
[2013-11-22 08:54:22 -0500] Zauberfisch23: I hear razor now supports chef. razor does look intresting, but I am not sure if it matches my usecase that well
[2013-11-22 08:54:51 -0500] Zauberfisch23: pxe_dust cookbook looks intresting, anyone used that?
[2013-11-22 08:55:29 -0500] divad: never used razor
[2013-11-22 08:56:00 -0500] Zauberfisch23: also, most servers are actually VMs on a VMware esxi, so a system that uses the VMware api and is able to spawn new VMs would be the most ideal solution
[2013-11-22 08:58:34 -0500] Zauberfisch23: I am sure someone somewhere has already compared different approaches, I am hoping someone can point me to an article or talk on that topic
[2013-11-22 09:01:26 -0500] s2r2: Zauberfisch23: razor's usecase is creating VMs or bare-metal machines from nothing
[2013-11-22 09:01:36 -0500] divad: we're currently moving from a vcenter to an openstack based envmnt so I didn't put much effort in auto-provisioning on vmware
[2013-11-22 09:01:46 -0500] s2r2: So, it's PXE-booting -> install -> voila, working VM
[2013-11-22 09:02:20 -0500] s2r2: If you don't start from scratch when creating a VM (e.g. in openstack, ec2, ), you'd want some other chef integration...
[2013-11-22 09:02:42 -0500] s2r2: razor is really neat, just be sure to use the latest incarnation, razor-server, razor-client on github
[2013-11-22 09:02:51 -0500] s2r2: (there was a rewrite recently)
[2013-11-22 09:03:14 -0500] s2r2: just read the backlog.  razor is perfect for bare metal provisioning
[2013-11-22 09:03:47 -0500] s2r2: the last time I checked though, the rewrite didn't have a chef broker (that's what they call the intregration with config mgmt) yet
[2013-11-22 09:04:07 -0500] s2r2: hmm still true https://github.com/puppetlabs/razor-server/tree/master/brokers
[2013-11-22 09:04:55 -0500] s2r2: that said, my favorite approach would be to use razor to install cloudinit and a local-datasource yaml file that takes care of the rest (talking to any of the cfg mgmt frameworks supported by cloudinit) on reboot.
[2013-11-22 09:08:17 -0500] s2r2: there's also theforeman.org btw
[2013-11-22 10:03:24 -0500] polysics: Is there a way to know the current status of a merge request?
[2013-11-22 10:03:25 -0500] polysics: https://tickets.opscode.com/browse/COOK-3254
[2013-11-22 10:03:32 -0500] polysics: aside from the JIRA page :)
[2013-11-22 10:04:20 -0500] Zauberfisch23: s2r2: thanks for the input!
[2013-11-22 10:05:43 -0500] Zauberfisch23: s2r2: does Foreman have chef support?
[2013-11-22 10:05:55 -0500] Zauberfisch23: I only read puppet there
[2013-11-22 10:05:57 -0500] s2r2: Zauberfisch23: WIP as far as I know
[2013-11-22 10:06:40 -0500] s2r2: but this piece of knowledge has a certain age, too, so better ask them. there's an IRC channel right next door ;)
[2013-11-22 10:08:44 -0500] s2r2: has anyone fought a proxy with chef/berkshelf recently? I'm in the situation that I need a proxy to reach e.g. https github cookbooks, but need the connection to my chef-server to not go throught the proxy
[2013-11-22 10:09:03 -0500] s2r2: It seems like ENV['no_proxy'] wasn't honored at all
[2013-11-22 10:09:14 -0500] s2r2: (by "berks upload")
[2013-11-22 10:16:08 -0500] joshmyers: Hey, I want to I have included a recipe in another recipe, I want to be able to use a variable from there. I thought that as I have included it, the variables would be available from the other recipe. Is this incorrect?
[2013-11-22 10:16:46 -0500] joshmyers: a = 1 in recipe foo, if foo is included in recipe bar, I should be able to call a from recipe bar no? o_0
[2013-11-22 10:31:00 -0500] maxmanders: I have set dependencies in a cookbook appropriately, and then attempt to use the Powershell ShellOut mixin...
[2013-11-22 10:31:09 -0500] maxmanders: include Chef::Mixin::PowershellOut fails but
[2013-11-22 10:31:10 -0500] maxmanders: ::Chef::Recipe.send(:include, Chef::Mixin::PowershellOut) works
[2013-11-22 10:31:47 -0500] maxmanders: Why do I need to call the include function of Chef::Recipe rather than the standard include?
[2013-11-22 11:24:58 -0500] pac-man: hi folks
[2013-11-22 11:25:22 -0500] pac-man: does anyone know how to provision the performance nodes with knife-rackspace? I've tried all thinkable combinations of flavor names without any luck.. it just keep spitting out "[HTTP 400 | ] Invalid flavorRef provided"
[2013-11-22 11:59:05 -0500] WPsites: Since upgrading to chef 11 and upgrading a few cookbooks I seem to be having problems. The chef run goes through without any visible issue (log even on :debug has no issues I can see) and all recipes included yet when I look through the log I see none of the stuff in my custom recipe being actioned. it's like it's forgotten about but it use to work without issue. If I then go on the server and do another chef run everything is set up OK. Any ideas?
[2013-11-22 12:03:48 -0500] ptrf: hmm
[2013-11-22 12:04:10 -0500] ptrf: during bootstrapping, I get an exception while rendering a template
[2013-11-22 12:04:25 -0500] ptrf: specifically, it says node.lsb.description isn't a valid key name
[2013-11-22 12:04:31 -0500] ptrf: s/key/attribute/
[2013-11-22 12:04:58 -0500] ptrf: Chef::Mixin::Template::TemplateError (Undefined method or attribute `description' on `node') on line #5:
[2013-11-22 12:05:15 -0500] ptrf: 5: linux version: <%= node.lsb.description %>
[2013-11-22 12:05:57 -0500] ptrf: however, if I run ohai on the node (yes, the chef embedded version), I get a nice node.lsb.description field in the json output
[2013-11-22 12:15:49 -0500] Zauberfisch23: s2r2: I took a look at theforeman and had a little chat with them
[2013-11-22 12:16:02 -0500] ptrf: hmm, it seemed it was fixed by reloading ohai with plugin lsb
[2013-11-22 12:16:10 -0500] ptrf: bueno
[2013-11-22 12:16:14 -0500] Zauberfisch23: chef support is in arely stages. they are currently considering at what scope they want to support it and are collecting usecases
[2013-11-22 12:16:22 -0500] Zauberfisch23: *in early stages
[2013-11-22 12:17:05 -0500] Zauberfisch23: however, they told me that getting foreman to install chef client and start it after the VM is ready should already be possible and should be rather easy to do
[2013-11-22 12:17:15 -0500] Zauberfisch23: so I guess I'll try that out
[2013-11-22 13:01:16 -0500] joshmyers: ey guys, am trying to template this but it's causing my next bit of ERB not to be templated correctly: [ "<%%{POSINT:syslog_pri}>%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{PROG:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}" ]
[2013-11-22 13:11:24 -0500] fiebre: hey *
[2013-11-22 13:11:48 -0500] fiebre: i got a weird knife behavior on bootstraping a node
[2013-11-22 13:12:01 -0500] fiebre: knife bootstrap localhost --ssh-user vagrant --ssh-password vagrant --ssh-port 2222 --run-list "role[platform-syslog-server]" --sudo
[2013-11-22 13:12:08 -0500] fiebre: Bootstrapping Chef on localhost
[2013-11-22 13:12:08 -0500] fiebre: ERROR: Errno::EISDIR: Is a directory - /home/dsa/work/test/platform-chef-repo
[2013-11-22 13:12:24 -0500] fiebre: everything else works fine listing node or cookbooks
[2013-11-22 13:12:31 -0500] fiebre: uploading editing roles
[2013-11-22 13:12:46 -0500] fiebre: so i have no realy clue currently on this
[2013-11-22 13:34:58 -0500] fiebre: ok fixed it :) thanks anyhow for partipcating in my problem :D
[2013-11-22 13:37:07 -0500] polysics: does chef override is_a? or something?
[2013-11-22 13:40:56 -0500] polysics: https://github.com/polysics/application_nginx/blob/chef-solo/providers/nginx_load_balancer.rb#L75 fails with
[2013-11-22 13:41:15 -0500] polysics: undefined method `attribute?' for "127.0.0.1":String
[2013-11-22 13:41:26 -0500] polysics: whole lot of nonsense :)
[2013-11-22 13:46:55 -0500] Cope: polysics: erm, String doesn't have an attribute? method
[2013-11-22 13:47:02 -0500] Cope: seems pretty sensible to me
[2013-11-22 13:47:27 -0500] polysics: Cope: but I passed in a string
[2013-11-22 13:47:38 -0500] polysics: array of strings
[2013-11-22 13:47:39 -0500] Cope: yes, and String doesn't have an attribute method
[2013-11-22 13:47:54 -0500] polysics: shouldn't that fall in the first case?
[2013-11-22 13:48:18 -0500] polysics: if n.is_a? String
[2013-11-22 13:48:35 -0500] Cope: yes, and if it is you return is
[2013-11-22 13:48:36 -0500] Cope: *it
[2013-11-22 13:48:50 -0500] Cope: and then try to call the attribute? method on it
[2013-11-22 13:48:57 -0500] Cope: String doesn't have that method
[2013-11-22 13:49:02 -0500] Cope: so you get your error
[2013-11-22 13:49:15 -0500] Cope: oh sorry.. hm i see what you mean
[2013-11-22 13:49:18 -0500] polysics: should I be doing "return n" on line 78?
[2013-11-22 13:49:21 -0500] Cope: so you passed in an array
[2013-11-22 13:49:34 -0500] polysics: yes
[2013-11-22 13:49:39 -0500] polysics: ['127.0.0.1']
[2013-11-22 13:50:51 -0500] Cope: right; hmm... I think I'd break out pry and inspect what you're getting there
[2013-11-22 13:51:00 -0500] Cope: sorry for misunderstanding at first
[2013-11-22 13:51:21 -0500] polysics: how would I do that, please? I am not very familiar with Chef debugging :)
[2013-11-22 13:51:35 -0500] polysics: binding.pry works in a Chef run?
[2013-11-22 13:52:09 -0500] polysics: running solo on Vagrant here
[2013-11-22 13:52:25 -0500] Cope: https://github.com/mattray/chef-pry-cookbook
[2013-11-22 13:52:58 -0500] Cope: you can also use pry from within chef-shell
[2013-11-22 13:53:27 -0500] polysics: well that's handy
[2013-11-22 13:53:36 -0500] polysics: many thanks!
[2013-11-22 13:53:37 -0500] Cope: but to be super dumb, just log what you have
[2013-11-22 13:53:58 -0500] polysics: inspect lies some times :)
[2013-11-22 13:54:03 -0500] Cope: :)
[2013-11-22 14:00:03 -0500] ttgb: How does everyone deal with key distribution for encrypted databags after bootstrapping new nodes?
[2013-11-22 14:00:55 -0500] Cope: you might get 1000 answers
[2013-11-22 14:01:08 -0500] ichilton: Afternoon Cope
[2013-11-22 14:01:28 -0500] Cope: ttgb: but you could check out chef-vault
[2013-11-22 14:01:45 -0500] Cope: ichilton: ohai
[2013-11-22 14:01:53 -0500] ichilton: Cope: you well?
[2013-11-22 14:02:04 -0500] Cope: ichilton: fine and dandy, thank you
[2013-11-22 14:02:11 -0500] ichilton: Cope: excellent
[2013-11-22 14:02:14 -0500] ttgb: I've been playing with chef-vault, problem is it doesn't really solve the bootstrapping problem as I'd need to re-encrypt with the new nodes keys before I can actually do anything
[2013-11-22 14:04:46 -0500] Skeletor1: Morning all, whats the best place to submit a ticket on a opscode cookbook that needs an update
[2013-11-22 14:05:35 -0500] gregkare: Skeletor1: https://tickets.opscode.com/browse/COOK#selectedTab=com.atlassian.jira.plugin.system.project%3Acomponents-panel
[2013-11-22 14:05:46 -0500] Skeletor1: thank you
[2013-11-22 14:26:47 -0500] gyre007: is there ANY way I can override an attribute in chef-solo ? so far this is proving to me Mission Impossible ;)
[2013-11-22 14:28:11 -0500] gyre007: this is what I have https://gist.github.com/milosgajdos83/7600703
[2013-11-22 14:28:21 -0500] gyre007: basically Im setting postgres version in wrapper cookbook attributes
[2013-11-22 14:29:03 -0500] gyre007: the LOG statmenet in that gist DOES PRINT OUT correct version , however postgres 9.1 (ie default one) is installed...completely ignoring the wrapper cookbook attribute
[2013-11-22 14:29:47 -0500] wassy121: So, I feel like I'm missing something obvious.  During the runthrough of a chef bootstrap, one of the things we include is the chef-client recipe.  One of the things in that recipe is a service definition that calls for action [:enable, :start] .  If this isn't late-enough in the process, it starts the chef-client before the bootstrap has completed, finds the stored run_list as nil, and removes all my cached files out from underneath me
[2013-11-22 14:32:41 -0500] wassy121: gyre007: So, I think your wrapper cookbook is setting the version attribute as a default in the attributes file, right?  Then it calls the postgresql cookbook, who also defines a version as a default attribute in the attributes file
[2013-11-22 14:32:46 -0500] wassy121: The latter overrides the former
[2013-11-22 14:33:02 -0500] wassy121: Try using node.set['postgresql']['version'] in the recipe
[2013-11-22 14:33:08 -0500] wassy121: in the wrapper recipe that is
[2013-11-22 14:33:17 -0500] gyre007: wassy121: that might just be the case...override should get me what I want...
[2013-11-22 14:33:34 -0500] gyre007: override[][]
[2013-11-22 14:33:44 -0500] wassy121: override will trump anything you put in environment or roles if you care too much about that
[2013-11-22 14:33:55 -0500] gyre007: no we dont do any roles/envs
[2013-11-22 14:34:16 -0500] wassy121: but I think the level being default in both is making it act unexpectedly
[2013-11-22 14:34:22 -0500] gyre007: we only use envs for freezing cookbook versions...no attributes settings
[2013-11-22 14:34:28 -0500] gyre007: yeah
[2013-11-22 14:34:30 -0500] gyre007: could be...
[2013-11-22 14:34:33 -0500] gyre007: lets see....
[2013-11-22 14:35:10 -0500] gyre007: ill run the tests shortly/...
[2013-11-22 14:35:24 -0500] gyre007: Id like to avoid setting NORMAL attrinbutes which get set with node.set
[2013-11-22 14:35:36 -0500] gyre007: those are then not reset on every chef run...
[2013-11-22 14:36:23 -0500] wassy121: anyone with ideas about my chef bootstrap starting chef-client and stomping on my cached files would be amazing
[2013-11-22 14:38:27 -0500] gyre007: what is really annoying is that a lot of people adopted lib/wrapper cookbook workflow yet there doesnt seem to be any resource which would shed some light on this :)
[2013-11-22 14:39:19 -0500] gyre007: wassy121: nope...override in attributes file didnt help...
[2013-11-22 14:39:38 -0500] gyre007: looks like the wrapper attributes make no sense....you simply must override this stuff in recipes..oh boy
[2013-11-22 14:39:44 -0500] wassy121: try setting in recipe, rather than attributes file (unsure why that would matter)
[2013-11-22 14:39:53 -0500] gyre007: but this is weird
[2013-11-22 14:40:21 -0500] gyre007: that means that overriding attributes in Wrapper cookbooks makes attributes as such totally useless...imho
[2013-11-22 14:40:41 -0500] gyre007: this attributes madness is driving me towards huge love for containers...
[2013-11-22 14:41:09 -0500] gyre007: people have been trying to "fix" it for like 5 versions...yet we are where we are....polluting recipes with attribute overrides...
[2013-11-22 14:45:46 -0500] Cope: gyre007: node.set in the wrapper will do what you need
[2013-11-22 14:46:20 -0500] gyre007: Cope: btu taht sets NORMAL attribute right ? those are not reset on every run
[2013-11-22 14:46:44 -0500] gyre007: basically once you set them they are saved on the server and wil ALWAYS override your attrs set in recipes/cookbooks
[2013-11-22 14:46:52 -0500] gyre007: do you really want to do that ?
[2013-11-22 14:46:58 -0500] svparijs: Can anyone point me to the chef-server.rb in the version 11.0.8-1 its not located at: /etc/chef-server/chef-server.rb
[2013-11-22 14:47:05 -0500] gyre007: I know it does make sense for some things...
[2013-11-22 14:47:07 -0500] gyre007: fair enough
[2013-11-22 14:47:13 -0500] gyre007: but not for everything...
[2013-11-22 14:47:19 -0500] Cope: gyre007: I think you're misunderstanding
[2013-11-22 14:48:02 -0500] Cope: Have a look at: http://docs.opscode.com/chef_overview_attributes.html
[2013-11-22 14:49:11 -0500] svparijs: Im assuming that link was for me Cope
[2013-11-22 14:49:16 -0500] gyre007: Cope: yeah I read that
[2013-11-22 14:49:42 -0500] Cope: svparijs: nope sorry!
[2013-11-22 14:49:58 -0500] gyre007: doesnt mention anything about lib/wrapper cookbooks....so it works with the assumption that you are using ONE cookbook and not wrapper one...then life is easy indeed
[2013-11-22 14:50:02 -0500] svparijs: Oops
[2013-11-22 14:50:03 -0500] wassy121: svparijs: if installed via rpm, you can use rpm -ql to see the files installed by the chef-server package
[2013-11-22 14:50:09 -0500] Cope: gyre007: no that has no impact at all
[2013-11-22 14:50:48 -0500] gyre007: I think it does...apparently
[2013-11-22 14:51:02 -0500] Cope: gyre007: attribute precendence is not difficult.  You can set attributes in various places, and you can set it a various levels.  Depending on where you set it, depends on the overall precendence
[2013-11-22 14:51:28 -0500] Cope: gyre007: I'm telling you that if you want to 'override' the attributes of a cookbook you include in a wrapper cookbook, use node.set
[2013-11-22 14:51:31 -0500] wassy121: but shouldn't an override specified in a wrapper cookbook's attribute file override the default value specified in the wrapped cookbook?
[2013-11-22 14:51:42 -0500] gyre007: and also if you're including recipes which are setting same attributes as the cookbook where you're including them
[2013-11-22 14:51:43 -0500] svparijs: its installed with dpkg -i wassy121
[2013-11-22 14:51:50 -0500] gyre007: wassy121: it SHOULD
[2013-11-22 14:51:57 -0500] gyre007: but it is not the case...
[2013-11-22 14:52:02 -0500] wassy121: svparijs: then you can use dpkg -L chef-server
[2013-11-22 14:52:07 -0500] gyre007: I mean it should in normal world...
[2013-11-22 14:52:24 -0500] svparijs: wassy121: thanks
[2013-11-22 14:52:59 -0500] gyre007: Cope: .set sets automatic attribute...
[2013-11-22 14:53:00 -0500] juliancdunn: Cope: you don't need node.set
[2013-11-22 14:53:08 -0500] gyre007: juliancdunn: exactly
[2013-11-22 14:53:12 -0500] gyre007: uyou shouldnt need it!
[2013-11-22 14:53:12 -0500] juliancdunn: what gyre007 did in his gist is fine
[2013-11-22 14:53:26 -0500] juliancdunn: gyre007: what platform are you on?
[2013-11-22 14:53:28 -0500] gyre007: juliancdunn: well it's not apparently because Chef no like :)
[2013-11-22 14:53:30 -0500] DeadZen: why the hell does mime-types want ruby 1.9.2
[2013-11-22 14:53:39 -0500] Cope: gyre007: more detail here: http://docs.opscode.com/essentials_cookbook_attribute_files.html
[2013-11-22 14:53:41 -0500] juliancdunn: gyre007: I don't think it's an attribute problem -- at least not with the one you're setting
[2013-11-22 14:53:43 -0500] wassy121: DeadZen: because mime-types was updated recently
[2013-11-22 14:53:45 -0500] juliancdunn: since the log statement worked properly
[2013-11-22 14:53:53 -0500] juliancdunn: s/worked properly/printed out the right attribute/
[2013-11-22 14:54:00 -0500] gyre007: I think its also a question of loading recipes imho
[2013-11-22 14:54:08 -0500] Cope: juliancdunn: i didn't say you needed node.set
[2013-11-22 14:54:09 -0500] gyre007: maybe chef_solo is loading them dfifferently
[2013-11-22 14:54:13 -0500] wassy121: DeadZen: Try mime-types 1.25 or below
[2013-11-22 14:54:18 -0500] Cope: juliancdunn: I said it would work as gyre007 requested
[2013-11-22 14:54:31 -0500] DeadZen: wassy121: yah I see that, thx, ruby is the weakest link in chef for me
[2013-11-22 14:54:42 -0500] gyre007: Cope: sure I could hack pretty much anything into my liking...but I want to do this righ...no hack-way :)
[2013-11-22 14:54:47 -0500] juliancdunn: Cope: you said "if you want to override the attributes using a wrapper cookbook, use node.set"
[2013-11-22 14:54:57 -0500] adnichols: Cope: node.set has persistence side effects that folks almost always don't want
[2013-11-22 14:54:59 -0500] DeadZen: always something breaking where I have to point fix the versions
[2013-11-22 14:55:00 -0500] juliancdunn: that will "work" but that level of precedence is not *required*
[2013-11-22 14:55:10 -0500] Cope: juliancdunn: yes; I dind't say it was required.
[2013-11-22 14:55:10 -0500] gyre007: adnichols: exactly!
[2013-11-22 14:55:33 -0500] gyre007: so my question is....HOW do I do what I want to do...
[2013-11-22 14:55:45 -0500] wassy121: so, now that people are awake a bit.  I will politely re-ask my question :)
[2013-11-22 14:55:53 -0500] wassy121: So, I feel like I'm missing something obvious. During the runthrough of a chef bootstrap, one of the things we include is the chef-client recipe. One of the things in that recipe is a service definition that calls for action [:enable, :start] . If this isn't late-enough in the process, it starts the chef-client before the bootstrap has completed, finds the stored run_list as nil, and removes all my cached files out from underneath me
[2013-11-22 14:55:54 -0500] juliancdunn: gyre007: what you're doing is correct. can you add an additional log statement to log node['postgresql']['server']['packages'] ?
[2013-11-22 14:56:05 -0500] gyre007: juliancdunn: sure
[2013-11-22 14:56:42 -0500] Cope: adnichols: what side effects are you thinking of?
[2013-11-22 14:56:44 -0500] juliancdunn: wassy121: there's supposed to be a mutex so chef doesn't run more than once
[2013-11-22 14:56:58 -0500] wassy121: juliancdunn: I'm on ancient chef version 1.potato
[2013-11-22 14:57:02 -0500] juliancdunn: wassy121: what version of ... oh.
[2013-11-22 14:57:17 -0500] juliancdunn: wassy121: the mutex was fixed in Chef 11
[2013-11-22 14:57:31 -0500] wassy121: (10.16).  The update to Chef 11 is in the pipe, but a ways out still
[2013-11-22 14:57:42 -0500] juliancdunn: yeah, that was pre-mutex
[2013-11-22 14:57:49 -0500] Cope: adnichols: bear in mind gyre007 is using chef-solo, so there is no persistence...
[2013-11-22 14:57:52 -0500] adnichols: Cope: http://docs.opscode.com/essentials_node_object.html#attribute-persistence - note the behavior of "normal" attributes, which is what node.set sets
[2013-11-22 14:58:01 -0500] Cope: adnichols: yes
[2013-11-22 14:58:02 -0500] adnichols: Cope: ok, didn't know that :)
[2013-11-22 14:58:38 -0500] adnichols: This is what I get for commenting on a discussion 1/2 way in
[2013-11-22 14:58:39 -0500] gyre007: yeah Im guessing chef-solo is a bit crazy with this attributes stuff...
[2013-11-22 14:58:49 -0500] gyre007: behaves totally randomly
[2013-11-22 14:59:08 -0500] adnichols: probably not random, perhaps not completely understood :)
[2013-11-22 14:59:19 -0500] Cope: juliancdunn: I may be missing something but my experience has been that on chef-solo, the simplest way to get override behavior of the sort gyre007 desires is to use node.set
[2013-11-22 14:59:26 -0500] Cope: it will always work, and it has no side-effects
[2013-11-22 14:59:30 -0500] gyre007: also looks like include_recipe s are included totally randomly and NOT in the order they are in the wrapper cookbook recipe...
[2013-11-22 15:00:11 -0500] juliancdunn: gyre007: wdym "totally randomly"
[2013-11-22 15:00:58 -0500] juliancdunn: in a Chef run, all attributes files from all cookbooks are loaded *first*, in order, before any recipes are evaluated
[2013-11-22 15:02:06 -0500] gyre007: juliancdunn: https://gist.github.com/milosgajdos83/7601278
[2013-11-22 15:02:18 -0500] gyre007: looks like even the recipe execution is totally WHACKED
[2013-11-22 15:02:22 -0500] gyre007: like...there is no order
[2013-11-22 15:02:41 -0500] gyre007: attributes being ignored...include_recipes executed in a random way...
[2013-11-22 15:03:35 -0500] juliancdunn: gyre007: so those are two different things
[2013-11-22 15:03:48 -0500] gyre007: yeah
[2013-11-22 15:03:49 -0500] juliancdunn: first, to your attribute problem:
[2013-11-22 15:03:52 -0500] gyre007: both out of whack imho
[2013-11-22 15:04:03 -0500] juliancdunn: https://github.com/hw-cookbooks/postgresql/blob/master/attributes/default.rb#L109
[2013-11-22 15:04:04 -0500] Cope: juliancdunn: right, and if gyre007 sets a default attribute in 2 places, the order in the runlist dictates that
[2013-11-22 15:04:54 -0500] juliancdunn: the issue is that the attribute for packages is computed from the original value
[2013-11-22 15:05:06 -0500] Cope: oh that cookies
[2013-11-22 15:05:24 -0500] juliancdunn: so you can default['postgresql']['server']['packages'] in your wrapper to recompute
[2013-11-22 15:05:33 -0500] gyre007: oh boy
[2013-11-22 15:05:39 -0500] juliancdunn: second thing... postgresql::ruby is a recipe that runs at compile time, not execute time
[2013-11-22 15:05:48 -0500] juliancdunn: which I don't happen to like, but there you go
[2013-11-22 15:05:52 -0500] juliancdunn: which is why it runs "first"
[2013-11-22 15:05:53 -0500] gyre007: I need to do it for all....client, server AND contrib
[2013-11-22 15:06:03 -0500] juliancdunn: gyre007: yes
[2013-11-22 15:06:39 -0500] gyre007: ah
[2013-11-22 15:07:25 -0500] gyre007: juliancdunn: ok I'll give this a shot
[2013-11-22 15:07:28 -0500] gyre007: thanks for the help
[2013-11-22 15:07:36 -0500] juliancdunn: and anything else that uses the attribute... like default['postgresql']['dir'], etc.
[2013-11-22 15:07:41 -0500] juliancdunn: gyre007: no worries
[2013-11-22 15:11:06 -0500] gyre007: that also means for the ruby recipe...that whatever I set in the attrib file will be ignored....which is the case atm...version is set to 9.1....and packages list has not effect on that juliancdunn
[2013-11-22 15:11:24 -0500] juliancdunn: gyre007: yes, and that is why I despise doing garbage in the compile phase
[2013-11-22 15:11:29 -0500] gyre007: https://github.com/hw-cookbooks/postgresql/blob/master/recipes/ruby.rb#L37
[2013-11-22 15:11:30 -0500] polfilm55: would anyone here know how to execute a windows batch single command from a recipe as chef-client reporting out of memory? command runs fine on node itself
[2013-11-22 15:12:07 -0500] gyre007: damn....so....Im wondering how do I get around it :)
[2013-11-22 15:12:23 -0500] gyre007: actually...
[2013-11-22 15:12:33 -0500] gyre007: i thnk i might know
[2013-11-22 15:13:28 -0500] juliancdunn: generally when running PostgreSQL I don't bother with the ruby gems
[2013-11-22 15:13:41 -0500] juliancdunn: since you need to compile against the C extensions for that version of Postgres, and that's a whole world of hurt
[2013-11-22 15:14:23 -0500] juliancdunn: instead, I interact with the DB using something like realityforge's psql cookbook: https://github.com/realityforge/chef-psql
[2013-11-22 15:14:36 -0500] Cope: useful stuff, juliancdunn
[2013-11-22 15:15:01 -0500] juliancdunn: also, who the hell has gcc on their production servers -- another reason the Ruby gems are painful
[2013-11-22 15:15:08 -0500] Cope: :D
[2013-11-22 15:15:18 -0500] Cope: juliancdunn: people who run varnish :)
[2013-11-22 15:15:24 -0500] juliancdunn: lol.
[2013-11-22 15:15:59 -0500] juliancdunn: crazy poul-henning... everything looks like a kernel module to a kernel developer
[2013-11-22 15:23:33 -0500] tanathos: Hi there, I am looking for someone that can help me write some chef recipes for a rails application, I pay by the hour or project based.
[2013-11-22 15:30:57 -0500] dev1x: hey guys
[2013-11-22 15:31:01 -0500] dev1x: i'm curious about something
[2013-11-22 15:31:13 -0500] dev1x: is there any good way to default all files in a directory ?
[2013-11-22 15:31:21 -0500] dev1x: i mean, i have x files under files\blahblah
[2013-11-22 15:31:35 -0500] dev1x: I'm sending them to the right directories when the recipe is run
[2013-11-22 15:31:47 -0500] dev1x: with remote_file "blahblah"
[2013-11-22 15:31:49 -0500] dev1x: for each file
[2013-11-22 15:32:05 -0500] dev1x: but this doesnt seem the optimal way to be done..
[2013-11-22 15:32:10 -0500] dev1x: it should be made with an iteration
[2013-11-22 15:44:19 -0500] dev1x: remote_directory
[2013-11-22 15:44:21 -0500] dev1x: should do the job
[2013-11-22 16:02:34 -0500] wassy121: dev1x: put them in a tar, and untar that file from the cache directory?
[2013-11-22 16:03:01 -0500] dev1x: that's an option, but still I'll try with remote directory first
[2013-11-22 16:12:15 -0500] tanathos: Hi there, I am looking for someone that can help me write some chef recipes for a rails application, I pay by the hour or project based.
[2013-11-22 16:14:20 -0500] prometheanfire: how do I check if an attribute exists
[2013-11-22 16:15:03 -0500] prometheanfire: I wanted "if node['foo']['bar'].exists?", but that fails
[2013-11-22 16:15:27 -0500] pravka: prometheanfire: you tried testing it with shef --client?
[2013-11-22 16:15:38 -0500] pravka: 'cause that should work.
[2013-11-22 16:15:55 -0500] prometheanfire: this is during a bootstrap
[2013-11-22 16:16:10 -0500] prometheanfire: 10.241.0.4 [2013-11-22T16:12:41+00:00] ERROR: undefined method `exists?' for nil:NilClass
[2013-11-22 16:16:28 -0500] pravka: so, that attribute doesn't exist.
[2013-11-22 16:17:06 -0500] prometheanfire: exactly :D
[2013-11-22 16:19:58 -0500] juliancdunn: you don't need .exists?
[2013-11-22 16:20:05 -0500] juliancdunn: just "if node['foo']['bar']"
[2013-11-22 16:20:10 -0500] prometheanfire: oh, ok
[2013-11-22 16:20:11 -0500] prometheanfire: thanks
[2013-11-22 16:22:25 -0500] juliancdunn: when asked if it's boolean, nil is false :)
[2013-11-22 16:33:17 -0500] prometheanfire: thanks :D (worked)
[2013-11-22 16:39:38 -0500] spheromak: .fetch for the win
[2013-11-22 16:47:29 -0500] gchristensen: jtimberman: do you have any experience with berkshelf depending on private cookbooks under jenkins, and how to let berkshelf authenticate to get them?
[2013-11-22 16:56:17 -0500] kallistec: prometheanfire: attributes are based on a subclass of Hash so generally the things here work: http://ruby-doc.org/core-1.9.3/Hash.html
[2013-11-22 16:56:45 -0500] kallistec: prometheanfire: for example, node["foo"].key?("bar") also does what you want
[2013-11-22 16:58:25 -0500] prometheanfire: cool
[2013-11-22 17:17:49 -0500] spheromak: gchristensen: you can use deploy keys if its github private repos. in the berkshelf you used to have to supply a git url and git: source for private repos. I am not sure it is still this way.
[2013-11-22 17:18:01 -0500] iamchrisf: Is there a reason why chef-client can't recognize there is already a chef-client running? I'm running 11.6.0 and i've run install 2 different issues this causes.  1 - I've had a few instances where they lock up after several dozen chef-clients are spawned. 2. Bootstrapping instances with knife fails due to a background chef-client grabbing the yum lock.
[2013-11-22 17:18:05 -0500] spheromak: iirc the github: source was http only
[2013-11-22 17:24:13 -0500] workmad3: iamchrisf: weird... my chef client does detect that
[2013-11-22 17:24:39 -0500] workmad3: iamchrisf: if I try to spawn a second chef-client run, it tells me that one is already running and that this run is waiting for that one to finish...
[2013-11-22 17:25:02 -0500] iamchrisf: workmad3: I've seen that as well.  But they pile up and eventually take down the system.
[2013-11-22 17:25:27 -0500] workmad3: iamchrisf: maybe you should increase the time between chef-client runs? :)
[2013-11-22 17:25:37 -0500] iamchrisf: workmad3: But that doesn't happen that often.  What's really annoying is chef-client in the background breaking the bootstrap chef run.
[2013-11-22 17:25:44 -0500] iamchrisf: I think 30 mins is enough :)
[2013-11-22 17:25:49 -0500] workmad3: heh :) fair enough...
[2013-11-22 17:28:04 -0500] kallistec: iamchrisf: the run_lock is designed to accomodate a handful of different use cases, including one where chef runs are daemonized but an administrator launches another run "manually" (ssh or orchestration tool) in which case the stacking behavior is what you want
[2013-11-22 17:28:45 -0500] iamchrisf: kallistec: Makes sense and I'm not too worried about that as it's infrequent and caught by monitoring.
[2013-11-22 17:29:20 -0500] kallistec: iamchrisf: if you want, you can check for flock on the chef-client-running.pid file
[2013-11-22 17:29:24 -0500] iamchrisf: kallistec:  I'm more concerned with bootstrapping breaking as the background client and the foreground bootstrap run fight over the yum lock and the bootstrap run fails out
[2013-11-22 17:29:28 -0500] kallistec: or read it and see if that process exists
[2013-11-22 17:30:20 -0500] kallistec: iamchrisf: So, the bootstrapping client launches the daemonized client?
[2013-11-22 17:30:43 -0500] kallistec: iamchrisf: also, what version of chef?
[2013-11-22 17:30:53 -0500] iamchrisf: 11.6.0
[2013-11-22 17:31:26 -0500] iamchrisf: the bootstrapping client runs my base-linux role which includes the chef-client recipe.  So down the line chef-client is started up.
[2013-11-22 17:32:06 -0500] iamchrisf: I would think it would hold off and recognize the bootstrap run, but It seems to kickoff and eventually grabs the yum lock and bootstrap inevitably fails
[2013-11-22 17:33:43 -0500] kallistec: iamchrisf: hrm. the only thing that makes sense is the 2nd chef client is inheriting the file handle of the lock. We added some code to avoid that though, thought it was 11.6, possibly it was 11.8
[2013-11-22 17:34:27 -0500] iamchrisf: Ahh..  I will upgrade and see if the issue reappears.  Thanks!
[2013-11-22 17:37:03 -0500] workmad3: heh :) the 'advantage' of just bootstrapping the lastest client at the moment :)
[2013-11-22 18:14:19 -0500] MrBIOS: good morning
[2013-11-22 18:14:48 -0500] MrBIOS: I'm trying to use the 'heartbeat' opscode community cookbook, and need to set some attributes up for a role, but am unsure of the JSON syntax needed to do that
[2013-11-22 18:15:09 -0500] MrBIOS: The attribute I need to set is node['heartbeat']['config']['authkeys']
[2013-11-22 18:38:08 -0500] AskSteve: anybody here use the wordpress cookbook/mysql?
[2013-11-22 18:46:20 -0500] cassianoleal: hey guys, anyone with experience using the Ridley gem?
[2013-11-22 18:48:39 -0500] juliancdunn: { "heartbeat": { "config": {"authkeys": ...  }}} MrBIOS
[2013-11-22 18:50:24 -0500] cpuguy83: cassianoleal: A minimal amount
[2013-11-22 18:51:03 -0500] cassianoleal: cpuguy83: It seems like my problem is not very complicated, but I'm failing to locate the issue
[2013-11-22 18:51:34 -0500] cassianoleal: cpuguy83: Basically, Ridley crashes when I try to instantiate it, complaining about " KeyError: key not found: :retries"
[2013-11-22 18:51:57 -0500] cassianoleal: but if I instantiate it in IRB, I don't need that key
[2013-11-22 18:53:38 -0500] cpuguy83: cassianoleal: Do you have some code you can show?
[2013-11-22 18:53:55 -0500] cassianoleal: It's very messy, but I'll commit what I have in a branch -- hang on
[2013-11-22 18:55:31 -0500] cassianoleal: cpuguy83: here: https://github.com/cassianoleal/vagrant-butcher/blob/feature/ridley/lib/vagrant-butcher/env_helpers.rb#L12
[2013-11-22 18:56:26 -0500] cassianoleal: cpuguy83: and it gets called here -- https://github.com/cassianoleal/vagrant-butcher/blob/feature/ridley/lib/vagrant-butcher/action/cleanup.rb#L14
[2013-11-22 19:03:33 -0500] cpuguy83: cassianoleal: I see the ssl option in the documentation but don't see where it's actually doing something with it....
[2013-11-22 19:03:41 -0500] cpuguy83: What's the stack trace for the KeyError
[2013-11-22 19:04:28 -0500] cassianoleal: cpuguy83: that key shouldn't be there -- as I said, it's messy :) -- but it doesn't make a difference
[2013-11-22 19:04:52 -0500] cassianoleal: hang on, I'll gist the trace
[2013-11-22 19:07:09 -0500] cassianoleal: cpuguy83: https://gist.github.com/cassianoleal/7605163
[2013-11-22 19:11:04 -0500] cpuguy83: cassianoleal: You shouldn't have to put it in there, but throw in a retries... I'm expecting it to crash on retry_interval missing
[2013-11-22 19:11:31 -0500] cassianoleal: cpuguy83: yes, I went down this path and it ends up crashing somewhere else after a few keys are added
[2013-11-22 19:12:35 -0500] cpuguy83: Weird
[2013-11-22 19:16:41 -0500] cpuguy83: cassianoleal: Verifed your versions are good?
[2013-11-22 19:16:45 -0500] cpuguy83: *verified
[2013-11-22 19:17:21 -0500] cassianoleal: cpuguy83: the only ridley version I have installed is 2.0.0 (latest)
[2013-11-22 19:17:24 -0500] cassianoleal: same for vagrant
[2013-11-22 19:18:00 -0500] cassianoleal: cpuguy83: If I add :retries, :retry_interval and :proxy it does this: https://gist.github.com/cassianoleal/7605163
[2013-11-22 19:18:35 -0500] cassianoleal: which looks ok in a way, but the proxy is set to example.com (I don't use one...)
[2013-11-22 19:20:04 -0500] jperry: hi guys, any way to force a resource to run during the compile phase?
[2013-11-22 19:20:09 -0500] cpuguy83: cassianoleal: Those warnings are fine
[2013-11-22 19:20:21 -0500] cpuguy83: cassianoleal: It's just from a framework Ridley is using (Celluloid)
[2013-11-22 19:20:26 -0500] jperry: I have a cookbook that fetches encrypted data bag keys but it's using the remote_file resource
[2013-11-22 19:20:34 -0500] jperry: and it's the first in the run list
[2013-11-22 19:21:02 -0500] jperry: should this not be part of a recipe?
[2013-11-22 19:21:32 -0500] cassianoleal: cpuguy83: I see... Anyway, I'm still unable to perform operations in the Chef server (probably due to the proxy config)
[2013-11-22 19:29:35 -0500] maplebed: Hi Folks! Can I use variables like node.hostname in a resources file? or only in the provider file? (writing a LWRP)
[2013-11-22 19:29:48 -0500] cpuguy83: cassianoleal: Sorry, not much help here.
[2013-11-22 19:30:13 -0500] cassianoleal: cpuguy83: that's ok, I'll keep banging my head :) -- thanks for looking into it!
[2013-11-22 19:30:50 -0500] cwj: maplebed: imo one should avoid using node attributes in lwrps all together
[2013-11-22 19:31:53 -0500] maplebed: hm. perhaps you can suggest what I should do then - I'm trying to launch a command that requires a few variables passed in from the calling cookbook, but one of the things the command needs is to know the name of the host on which it's running.
[2013-11-22 19:32:33 -0500] maplebed: so I've got 'command --flag-from-lwrp --#{node.hostname} --etc.
[2013-11-22 19:32:46 -0500] jbz: maplebed can you pass that is as part of the call?
[2013-11-22 19:32:57 -0500] maplebed: no, because the cookbooks apply to multiple hosts.
[2013-11-22 19:33:32 -0500] jbz: right, but if you had the recipe which calls the LWRP check for its hostname and then pass that in to the LWRP you'd be good, right?
[2013-11-22 19:33:41 -0500] maplebed: oh!
[2013-11-22 19:33:44 -0500] maplebed: yeah. that could work.
[2013-11-22 19:33:49 -0500] cwj: yeah, that is what i would do
[2013-11-22 19:34:16 -0500] cwj: have a hostname parameter for the resource
[2013-11-22 19:34:22 -0500] cwj: and pass it node.hostname
[2013-11-22 19:34:27 -0500] maplebed: I was hoping to use the default value of the flag as #{node.hostname} to make it optional
[2013-11-22 19:34:37 -0500] maplebed: but I suppose I can make the default nil and require it to be passed in.
[2013-11-22 19:35:02 -0500] cwj: it might not be unreasonable to set node.hostname as the default value, but more often than not i think using node attributes as default values is not a very good approach
[2013-11-22 19:35:47 -0500] maplebed: alrigh.t  Thanks!
[2013-11-22 19:36:16 -0500] cwj: np
[2013-11-22 19:43:43 -0500] cassianoleal: cpuguy83: Just to let you know, if I set :proxy to nil it works... I guess I'll make those keys plugin options and set sane defaults
[2013-11-22 19:53:22 -0500] azretd: are tar ball installs in chef finicky or is it just me?
[2013-11-22 19:54:15 -0500] carmstrong: azretd: depends entirely on what the tarball is
[2013-11-22 19:54:21 -0500] azretd: a tomcat tarball
[2013-11-22 19:54:30 -0500] azretd: tar.gz
[2013-11-22 19:54:31 -0500] carmstrong: then maybe ;)
[2013-11-22 19:54:53 -0500] azretd: I'm sitting here trying to understand why this has become so hard
[2013-11-22 19:55:00 -0500] azretd: and i have zero clue
[2013-11-22 19:55:37 -0500] azretd: I've inherently had issues with tarball installs, but this one just doesn't make sense because it always worked,
[2013-11-22 19:55:45 -0500] allaire: was just wondering, is there a difference of using reload in that case vs not using it? https://gist.github.com/allaire/ee10a4275bb2c467934e
[2013-11-22 19:56:53 -0500] cparedes: just curious, is anyone using berkshelf with opsworks? trying to figure out a good workflow for managing a central repository that opsworks expects, but with berkshelf
[2013-11-22 20:12:08 -0500] supercom32: I know there are some special variables like 'node[:platform-version]' which can get some information about the system it is on. is there a list of these variables someplace? Specifically, I want to get the host name.
[2013-11-22 20:12:29 -0500] adnichols: allaire: not really, your execute will always fire & always notify
[2013-11-22 20:12:48 -0500] allaire: adnichols: thx
[2013-11-22 20:12:59 -0500] cwj: supercom32: http://docs.opscode.com/ohai.html
[2013-11-22 20:13:16 -0500] cwj: supercom32: ohai is the tool which chef uses to detect the values for automatic attributes
[2013-11-22 20:13:39 -0500] supercom32: Ah I see. Do I need to put a depends on or something for my cookbook to use it?
[2013-11-22 20:13:57 -0500] cwj: supercom32: no, ohai is run to populate those attributes as part of the chef run
[2013-11-22 20:14:09 -0500] cwj: you can run ohai manually and see a list of all the things it detects
[2013-11-22 20:14:25 -0500] cwj: you can also write and install your own ohai plugins for things that you need ohai to detect
[2013-11-22 20:14:46 -0500] adnichols: supercom32: note that it's 'platform_version' not 'platform-version'
[2013-11-22 20:15:15 -0500] supercom32: Ah right
[2013-11-22 20:15:20 -0500] supercom32: Thanks for the hint.
[2013-11-22 20:16:45 -0500] cwj: true dat
[2013-11-22 20:16:55 -0500] adnichols: supercom32: you can also just type 'ohai' on a box you have converged once to see what ohai picked up
[2013-11-22 20:22:52 -0500] drywheat: can i use chef-solo-search to test node searching in vagrant during development?
[2013-11-22 20:23:53 -0500] drywheat: i'm trying to figure the best way to mock results for search(:node, '...')
[2013-11-22 20:36:20 -0500] adnichols: drywheat: I'm not sure about "best" but I believe you can load mock node data into chef-zero
[2013-11-22 20:45:28 -0500] cannonball: Hi, I made an rsync_files resource, located in cookbooks/common/resources/rsync.rb.  I'm trying to access it from a recipe in cookbooks/www/recipes/rp.rb, but it can't find it.
[2013-11-22 20:46:08 -0500] cannonball: I can't quite find the right combination of include to make recipe www::rp see the resource provided by common::rsync (if you even "name" resources in that way).
[2013-11-22 20:46:16 -0500] adnichols: cannonball: did you include the common cookbook as a dependency in metadata.rb?
[2013-11-22 20:46:34 -0500] cannonball: No I didn't.  I have to include the whole cookbook?
[2013-11-22 20:46:38 -0500] adnichols: yep
[2013-11-22 20:46:44 -0500] cannonball: ok, testing.  Thanks.
[2013-11-22 20:48:43 -0500] rsmitty: Anyone know how to accept agreements that pop up during a deb package install? I'm trying to write a cookbook to install steam via apt-get on ubuntu
[2013-11-22 20:48:57 -0500] rsmitty: but it asks to agree to some terms
[2013-11-22 20:49:53 -0500] adnichols: rsmitty: I think the java cookbook might do something like this for the oracle java install - not sure it's the same as what you are running into but may be worth a look. I'm not sure exactly how they solved that
[2013-11-22 20:50:16 -0500] rsmitty: yeah i thought about the java install. it's the same graphical type agreement.
[2013-11-22 20:50:24 -0500] rsmitty: i'll look into the cookbook. thanks.
[2013-11-22 20:50:31 -0500] cwj: it involves using debconf-set-selections to preseed answers
[2013-11-22 20:50:32 -0500] cwj: iirc
[2013-11-22 20:51:19 -0500] rsmitty: thanks
[2013-11-22 21:21:35 -0500] dgarstang3: darn it. the redis package starts the service when the package is installed (i really hate that), which means configuring it first. However, when the package is installed, it complains because /etc/redis/redis.conf already exists. The apt_package seems to have no facility to pass a force option
[2013-11-22 21:24:33 -0500] cpuguy83: dgarstang3: Check the options that can be set with debconf
[2013-11-22 21:24:48 -0500] cpuguy83: dgarstang3: You may be able to tell it to not place a config, then you can tell the package install to ignore failures
[2013-11-22 21:25:11 -0500] cpuguy83: (if required)
[2013-11-22 21:25:22 -0500] cpuguy83: I had the same issue with slapd
[2013-11-22 21:27:49 -0500] dgarstang3: cpuguy83: debconf via chef?
[2013-11-22 21:29:05 -0500] cpuguy83: dgarstang3: You'll want to run that manually to see what options are available, if any
[2013-11-22 21:29:17 -0500] cpuguy83: Theny ou can provide a response_file to the package handler
[2013-11-22 21:29:44 -0500] dgarstang3: cpuguy83: oic
[2013-11-22 21:29:46 -0500] cpuguy83: dgarstang3: https://github.com/cpuguy83/chef-openldap-server/blob/master/recipes/install.rb#L1-L6
[2013-11-22 21:32:39 -0500] dgarstang3: cpuguy83: Thanks. Not sure what magic-fu-option is used to say 'yes, overwrite existing config files.'
[2013-11-22 21:36:02 -0500] cpuguy83: dgarstang3: Install redis somewhere. install debconf-utils, do debconf-get-selections
[2013-11-22 21:36:23 -0500] cpuguy83: Those are the options you can pass into a response file
[2013-11-22 21:44:24 -0500] dgarstang3: cpuguy83: I think  options 'Dpkg::Options::="--force-confold"' should work better
[2013-11-22 21:45:06 -0500] dgarstang3: cpuguy83: already did that too. debconf-get-selections shows nothing for redis
[2013-11-22 21:45:24 -0500] cpuguy83: Really, I've got tons
[2013-11-22 21:45:30 -0500] cpuguy83: debget-get-selections redis-server
[2013-11-22 21:46:00 -0500] cpuguy83: May not be anything in there to help, but still a ton!
[2013-11-22 21:47:03 -0500] dgarstang3: cpuguy83: Noting for me.
[2013-11-22 21:47:16 -0500] dgarstang3: cpuguy83: options 'Dpkg::Options::="--force-confold"' should work in theory
[2013-11-22 21:47:34 -0500] dgarstang3: oh, i have to give it -o as well.
[2013-11-22 21:47:36 -0500] dgarstang3: jees
[2013-11-22 21:48:23 -0500] dgarstang3: cpuguy83: That works. :) easier than yours. :)
[2013-11-22 21:48:44 -0500] dgarstang3: package "redis-server" do options 'Dpkg::Options::="--force-confold"' end
[2013-11-22 21:48:54 -0500] dgarstang3: dammit it... with the -o
[2013-11-22 22:19:04 -0500] Tuatara: Hi... I am having trouble when working with nil in a LWRP that I am making. I have this: file install_path do ... not_if { @current_resource.artifact_dir.nil? } end. The error is that "undefined method `artifact_dir' for nil:NilClass".
[2013-11-22 22:19:57 -0500] Tuatara: I am reading that error that the current_resource doesn't have an artifact_dir. Within load_current_resource I am working with it as @current_resource.artifact_dir(@new_resource.artifact_dir)
[2013-11-22 22:20:29 -0500] Tuatara: I am not providing an artifact_dir attribute to the provider when working with it. Which is why I want to check for the nil state on that attribute.
[2013-11-22 22:20:32 -0500] Tuatara: What am I doing wrong?
[2013-11-22 22:29:12 -0500] Tuatara: Further testing by providing the artifact_dir to the provider as an attribute still has the same nil error. Checked for any spelling mistakes and nothing.
[2013-11-22 22:35:16 -0500] dgarstang3: I wonder what the point of Chef::Application.fatal!(foo) is when it doesn't even print foo?
[2013-11-22 23:15:07 -0500] josephholsten: sonofa
[2013-11-22 23:17:58 -0500] josephholsten: coderanger: any idea why this user resource embedded in an application block would explode? https://github.com/jssjr/chef-descartes/blob/master/recipes/default.rb#L54
[2013-11-22 23:19:17 -0500] josephholsten: also holy crap you adopted a bunch of cookbooks
[2013-11-22 23:21:24 -0500] josephholsten: oh. oh I see. it's using an entirely custom variant of application_ruby (with user, ruby and sinatra resources)
[2013-11-22 23:45:44 -0500] Tuatara: Why can't I get a reference to @current_resource from within a do ... end block?
