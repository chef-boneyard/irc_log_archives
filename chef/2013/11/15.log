[2013-11-15 00:07:37 -0500] fak3r: I'm running hosted chef, tried to reset my key, it failed with 'Organization not found. (Error 32033)' and now I'm locked out. Thoughts?
[2013-11-15 00:10:26 -0500] carmstrong: fak3r: sounds like it's time to contact opscode
[2013-11-15 00:38:03 -0500] ryker: anyone here know if riotgames has an irc channel? can't seem to find one. figured it's the best place to ask a question about using ridley.
[2013-11-15 00:39:16 -0500] douglaswth: there's a #berkshelf, it might be relevant there?
[2013-11-15 00:40:15 -0500] ryker: douglaswth: ah yeah. didn't think about that. thx
[2013-11-15 01:24:55 -0500] fak3r: carmstrong: yep, I will contact them again, never heard back on my 1st support request so was wondering if others had the same issue
[2013-11-15 01:30:29 -0500] jaredonline: Hey all, I'm having some issues with Chef 10.18 (can't update because of a bunch of old recipes we rely on) and the embedded versions of ruby. I'm using RVM to install REE, but the bundle command has #!/opt/chef/embedded/ruby at the top which is forcing it to Ruby 1.9.2 causing lots of issues
[2013-11-15 01:45:25 -0500] coderanger: jaredonline: You need to install bundler via REE
[2013-11-15 01:46:17 -0500] holms: hey coderanger :)
[2013-11-15 01:46:22 -0500] coderanger: Yo
[2013-11-15 01:46:32 -0500] holms: finally got my starter to stable version..
[2013-11-15 01:46:57 -0500] holms: install chef-server to vm, setup workstation, bootstraps multiple nodes, create node
[2013-11-15 01:47:06 -0500] holms: with few commands :}
[2013-11-15 01:47:27 -0500] holms: quite cool when you've got lot's of not small project running over lots of compnies
[2013-11-15 01:48:33 -0500] holms: coderanger: https://github.com/holms/chef-starter/ :}
[2013-11-15 01:50:55 -0500] coderanger: Coolness!
[2013-11-15 02:08:55 -0500] dcbiker1029: I am trying to use a private repo and have found articles discussing using ssh_wrapper but now I am getting a "No resource found for ssh_wrapper." error.   I am specifying it in a application do block.  What am I doing wrong?
[2013-11-15 02:14:22 -0500] douglaswth: dcbiker1029: there is a deploy_key attribute that you might want to use instead...
[2013-11-15 02:15:45 -0500] dcbiker1029: where do I set it?  does it automatically use the ssh_wrapper if deploy_key is set?
[2013-11-15 02:16:08 -0500] dcbiker1029: btw thanks douglaswth
[2013-11-15 02:16:43 -0500] douglaswth: deploy_key is an attribute that can be used in the application resource; I don't know what the specific implementation is
[2013-11-15 02:17:17 -0500] jaredonline: @coderanger I have
[2013-11-15 02:17:52 -0500] coderanger: jaredonline: run this
[2013-11-15 02:17:53 -0500] coderanger: head -n 1 `which bundle`
[2013-11-15 02:17:56 -0500] coderanger: what do you see?
[2013-11-15 02:18:15 -0500] jaredonline: #!/usr/local/rvm/rubies/ree-1.8.7-2012.02/bin/ruby
[2013-11-15 02:18:41 -0500] douglaswth: dcbiker1029: it looks like deploy_key causes the application provider to create a an ssh_wrapper to use with the deploy resource/provider
[2013-11-15 02:18:47 -0500] douglaswth: https://github.com/opscode-cookbooks/application/blob/master/providers/default.rb#L89
[2013-11-15 02:19:35 -0500] jaredonline: @coderanger But bundle --deployment is installing the gems in vendor/bundle/ruby/1.9.1
[2013-11-15 02:28:18 -0500] dcbiker1029: douglaswth I think that's the tip I've been looking for, thank you very much
[2013-11-15 04:01:15 -0500] julian____: Hi all,
[2013-11-15 04:01:33 -0500] julian____: I am trying to factor some code into a method inside a recipe
[2013-11-15 04:02:29 -0500] julian____: but chef complains that the method is undefined
[2013-11-15 04:03:07 -0500] julian____: What do I need to do to localize some code inside a recipe?
[2013-11-15 04:05:59 -0500] julian____: Hmm, seems to be answered here http://stackoverflow.com/questions/15595144/dry-within-a-chef-recipe
[2013-11-15 04:06:11 -0500] julian____: And that I need a module in libraries
[2013-11-15 04:17:22 -0500] miah: kisoku: sup?
[2013-11-15 06:11:03 -0500] garrett__1: sometimes i'll be testing a cookbook, and changes won't get pulled down to the client unless i bump the version number.
[2013-11-15 06:11:09 -0500] garrett__1: it's not 100% of the time. is there a way to clear the cache?
[2013-11-15 06:11:15 -0500] storme_out: garrett__1: always the safest way to ensure you're working on the correct version
[2013-11-15 06:11:32 -0500] storme_out: garrett__1: rm -rf /var/cache/chef/cookbooks
[2013-11-15 06:12:20 -0500] garrett__1: storme_out: ok, thanks. that's what i'd done before, but i didn't know if i was maybe missing some magic command like 'chef-client undocumentedparamthateveryoneknowsaboutwhatareyousomesortofidiot?'
[2013-11-15 06:13:02 -0500] storme_out: no, the best way is to bump the version # :)
[2013-11-15 06:13:32 -0500] storme_out: my coworker set all of his cookbooks to be like 0.1.100001, heh
[2013-11-15 06:16:32 -0500] garrett__1: hehe, that's maybe not a terrible idea ;)
[2013-11-15 06:29:30 -0500] Nitecon: anyone have any idea why aws_ebs_volume 'data_volume' do would just be skipped completely?
[2013-11-15 06:30:29 -0500] Nitecon: it seems my recipe 100% skips the data volume provisioning and just sits and waits in an infinite loop for the partition to become available but it never does since it's skipped
[2013-11-15 07:35:13 -0500] garrett__1: Probably a dumb question, but there's no way to access node attributes, or mark them for lazy-evaluation, within a role, no?
[2013-11-15 07:36:02 -0500] garrett__1: ie: i have a role that runs a couple of things, but i want to override one default attribute with the machine's current IP address or something
[2013-11-15 07:37:00 -0500] garrett__1: seems sort of wasteful to make a cookbook recipe just to override that one attribute
[2013-11-15 07:42:21 -0500] dtrott: garrett__1: will attribute precedence resolve your issue ? http://docs.opscode.com/chef_overview_attributes.html
[2013-11-15 07:42:39 -0500] garrett__1: i think so. i'm drawing a little diagram for myself now
[2013-11-15 07:43:13 -0500] dtrott: The table on that page is pretty clear ...
[2013-11-15 07:43:28 -0500] garrett__1: oh, of my own stuff.
[2013-11-15 08:55:05 -0500] s2r2: woah, anyone seen this before? /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-11.6.0/lib/chef/node.rb:384:in `encode': "\xC3" on US-ASCII (Encoding::InvalidByteSequenceError)
[2013-11-15 10:09:45 -0500] ProfFalk1n: hey all, can I use the render feature of a template to build up a file from a number of resources before spitting it out onto disk?
[2013-11-15 10:11:19 -0500] nacer: hi there
[2013-11-15 10:11:36 -0500] nacer: i'm getting a lot of 500 error from api today
[2013-11-15 10:11:42 -0500] nacer: Hosted Chef
[2013-11-15 10:21:50 -0500] zts: ProfFalk1n: depending on exactly what you're trying to do, you don't need partials for that - http://docs.opscode.com/essentials_cookbook_definitions.html#many-recipes-one-definition
[2013-11-15 10:32:48 -0500] dev1x: how do i load an env variable
[2013-11-15 10:33:00 -0500] dev1x: to a chef variable?
[2013-11-15 10:33:13 -0500] dev1x: kind of confused with that
[2013-11-15 10:35:30 -0500] dev1x: set ENV_VAR=variable ?
[2013-11-15 10:36:21 -0500] chaos: dev1x, ENV["foo"]
[2013-11-15 10:36:43 -0500] dev1x: ENV["HOSTNAME"] = variable ?
[2013-11-15 10:37:11 -0500] chaos: yes, but it wil be only for chef execution time
[2013-11-15 10:37:33 -0500] dev1x: yeah, i just need it for that moment
[2013-11-15 10:37:35 -0500] chaos: and probably visible only to chef
[2013-11-15 10:37:43 -0500] dev1x: :) to when i'm running a chef recipe
[2013-11-15 10:37:51 -0500] chaos: and remember about execution order ;p
[2013-11-15 10:37:59 -0500] chaos: plain ruby code is executed before resources
[2013-11-15 10:38:53 -0500] dev1x: yeah, so in this case its better to define those variables in the metadata.rb so it can be used in the several recipes that i have on the cookbook, right?
[2013-11-15 10:39:13 -0500] chaos: rather in attributes
[2013-11-15 10:39:49 -0500] dev1x: ah cool!
[2013-11-15 10:39:51 -0500] dev1x: thank you
[2013-11-15 10:39:55 -0500] chaos: np ;-)
[2013-11-15 10:40:09 -0500] dev1x: but then again
[2013-11-15 10:40:13 -0500] dev1x: if i have recipe X and recipe Y
[2013-11-15 10:40:17 -0500] dev1x: can i have default.rb
[2013-11-15 10:40:19 -0500] dev1x: in atributtes
[2013-11-15 10:40:24 -0500] dev1x: ?
[2013-11-15 10:40:28 -0500] chaos: yes
[2013-11-15 10:40:39 -0500] dev1x: thank you :)
[2013-11-15 10:43:09 -0500] dev1x: but then, in that case
[2013-11-15 10:43:15 -0500] dev1x: if i want the hostname on where the recipe is running
[2013-11-15 10:43:16 -0500] dev1x: i just need
[2013-11-15 10:43:46 -0500] chaos: you are running chef-server hostname is stored in node["hostname"]
[2013-11-15 10:43:50 -0500] chaos: i'm not sure about chef-solo
[2013-11-15 10:43:54 -0500] dev1x: node.default[hostname]
[2013-11-15 10:44:01 -0500] dev1x: humm its for chef-server
[2013-11-15 10:44:32 -0500] dev1x: so i dont need to declare any variable in attributes if i want to use it
[2013-11-15 10:44:33 -0500] zts: dev1x: what are you trying to achieve?  What data do you need, and what needs to see it?
[2013-11-15 10:45:17 -0500] dev1x: well i want to retrieve a env variable, and get it into a local variable for use in other methods within the recipe
[2013-11-15 10:45:18 -0500] dev1x: for instance
[2013-11-15 10:45:24 -0500] dev1x: grabbing hostname and using it in a curl command to be executed
[2013-11-15 10:46:31 -0500] zts: dev1x: Chef (using a tool called Ohai) makes a lot of data available on the node object - this includes the hostname.  So in this particular case, you can already use node['hostname'] or node['fqdn'] inside your recipes to access that information
[2013-11-15 10:47:01 -0500] dev1x: so i can just
[2013-11-15 10:47:10 -0500] dev1x: node['hostname'] = var_hostname
[2013-11-15 10:47:16 -0500] chaos: you don't need to change it
[2013-11-15 10:47:18 -0500] dev1x: and then use var_hostname in the rest of the recipe, right?
[2013-11-15 10:47:20 -0500] chaos: just read it
[2013-11-15 10:47:25 -0500] dev1x: yes, just read
[2013-11-15 10:47:37 -0500] zts: dev1x: no, that would try to set node['hostname'] to the value of a variable called var_hostname
[2013-11-15 10:47:37 -0500] dev1x: ahhhh
[2013-11-15 10:47:39 -0500] dev1x: ok
[2013-11-15 10:47:43 -0500] dev1x: i think i got it
[2013-11-15 10:47:53 -0500] dev1x: hostname = node['net']['hostname']
[2013-11-15 10:47:53 -0500] zts: dev1x: some of the most commonly-used attributes are documented here: http://docs.opscode.com/chef/ohai.html
[2013-11-15 10:47:57 -0500] dev1x: then i can just use hostname
[2013-11-15 10:48:05 -0500] dev1x: as a local variable or wtv
[2013-11-15 10:48:08 -0500] dev1x: on the recipe
[2013-11-15 10:48:22 -0500] zts: correct
[2013-11-15 10:48:35 -0500] dev1x: thank you guys
[2013-11-15 11:48:11 -0500] ProfFalk1n: zts: thanks, we already have a define, I'm trying to have multiple recipes call a define to build up a single file on disk, much like Volcane's puppet-concat used to do
[2013-11-15 11:48:56 -0500] ProfFalk1n: zts: https://github.com/puppetlabs/puppetlabs-concat is the code I used under puppet to do this, wondering if there's something similar for chef
[2013-11-15 12:00:57 -0500] thom: ProfFalk1n: http://docs.opscode.com/essentials_cookbook_definitions.html#many-recipes-one-definition
[2013-11-15 12:01:23 -0500] thom: oh, sorry. already been posted
[2013-11-15 12:02:44 -0500] thom: so you want to put snippets in place from various recipes and then mash them together at the end of the run into a single file?
[2013-11-15 12:17:06 -0500] mrigesh: hello
[2013-11-15 12:17:11 -0500] mrigesh: need some help
[2013-11-15 12:17:40 -0500] mrigesh: i am running multiple db client installation recipes
[2013-11-15 12:18:21 -0500] mrigesh: like oracle, db2 in one chef client ru and these recipes internally call the user cookbook user to create specific user
[2013-11-15 12:19:35 -0500] mrigesh: but when chef-client executes its run they miss the call to user cookbook for other cookbooks after the execution of fisrt recipe
[2013-11-15 12:19:45 -0500] mrigesh: can somebody guide me
[2013-11-15 13:01:40 -0500] itsprdp: hey :)
[2013-11-15 13:03:08 -0500] itsprdp: So anyone here have an idea about how the chef-client runs automatically after particular interval ?
[2013-11-15 13:04:51 -0500] itsprdp: is someone there ?
[2013-11-15 13:22:46 -0500] ocholetras: hi guys!
[2013-11-15 13:23:16 -0500] ocholetras: someone know how to build attributes getting data from an inventory database?
[2013-11-15 13:23:53 -0500] ocholetras: We have the machines FQDN, IP and some other attributes like nagios checks on an inventory IT application
[2013-11-15 13:24:14 -0500] ocholetras: We want to feed chef with this application
[2013-11-15 13:25:03 -0500] ProfFalk1n: thom: yes
[2013-11-15 14:22:02 -0500] viraptor: hi all, is there some way of finding out if a resource with a given name has been defined already?
[2013-11-15 14:24:12 -0500] viraptor: in the recipe I mean, so that I can do something like "unless has_been_created("service[blah]") service "blah" do dummy_config end"
[2013-11-15 14:27:30 -0500] cwj: viraptor: maybe try examining node.run_context.resource_collection
[2013-11-15 14:28:22 -0500] cwj: i have done that in some deploy call backs, but i think those are kind of different since, as i understand it, they act like self-contained run_contexts
[2013-11-15 14:28:41 -0500] viraptor: cwj: going to try, thanks
[2013-11-15 14:29:05 -0500] viraptor: alternatively, is there any way of creating a notification that doesn't care whether the notification target exists or not?
[2013-11-15 14:29:59 -0500] cwj: i think subscriptions work that way, but the directionality is different
[2013-11-15 14:30:07 -0500] cwj: which might not help you
[2013-11-15 14:35:19 -0500] zaargy: you could hack it and make it create a file or such when the service is (originally) created or such
[2013-11-15 14:36:00 -0500] zts: viraptor: resources("service[blah]") will return the resource if it has been defined
[2013-11-15 14:36:38 -0500] zaargy: ooh.
[2013-11-15 14:37:55 -0500] viraptor: zts: thanks! it even gives me that resource back.... that's just waiting there to be abused :)
[2013-11-15 14:38:12 -0500] cwj: abuse is the right word
[2013-11-15 14:38:41 -0500] zts: viraptor: yeah, that is how you reopen resources (eg, if you need to override something in a cookbook you're wrapping) - https://gist.github.com/sethvargo/6443603
[2013-11-15 14:38:41 -0500] cwj: i guess i went straight for the convoluted approach since i had to do that most recently, but resources() is very useful
[2013-11-15 14:40:36 -0500] zaargy: hmm i have been rewinding resources then reapplying
[2013-11-15 14:40:38 -0500] zaargy: but this would be good in some cases...
[2013-11-15 14:45:42 -0500] Cope: it's effectively the same thing
[2013-11-15 14:53:59 -0500] viraptor: another crazy hack question - is there any way to force a recipe to be run at the end of the runlist? for example if I have role A with recipes X,Z and role B with recipes Y,Z, I'd like to have a node with assigned roles A,B, but make Z run at the end, not in the middle
[2013-11-15 14:56:09 -0500] daxroc: viraptor:  Put it at the end of the runlist it's executed in order?
[2013-11-15 14:57:50 -0500] viraptor: daxroc: yeah, that would be the best solution... but let's say that due to various constraints it cannot be put in the runlist directly (and I'd like to avoid creating a special separate role C containing A,B,Z)
[2013-11-15 14:58:20 -0500] daxroc: If your cookbooks are idempotent it shouldn't really matter. It would run twice altering the configuration the second run no ?
[2013-11-15 15:11:31 -0500] zts: viraptor: out of interest, what kind of things will be in the recipe you want to run last?
[2013-11-15 15:12:03 -0500] daxroc: Thinking about it you could check node roles in Z and if the current node as both roles and ints not on role B do nothing ?
[2013-11-15 15:13:11 -0500] daxroc: *current node has both roles and it's
[2013-11-15 15:13:26 -0500] zts: viraptor: (ie, why does it need to run after everything else)
[2013-11-15 15:14:51 -0500] a13x212: i'm running chef server 11.0.8-1, the server is still installing client version 11.4, how do i change it so it installs 11.6?
[2013-11-15 15:15:22 -0500] viraptor: zts: I need a service restart notification that is activated by multiple sources, is delayed and reliable even if chef-client crashes (and works in chef 10.24)
[2013-11-15 15:15:57 -0500] jperry: ohai folks
[2013-11-15 15:16:09 -0500] jperry: at one point during a chef run is the pure ruby code evaluated?
[2013-11-15 15:16:10 -0500] viraptor: zts: in practice that means changing service :restart notifications to file :create_if_missing notifications... but then somethign has to collect those together and actually do restarts at the end of the run
[2013-11-15 15:16:24 -0500] jperry: is that evaluated before the resource collection is executed?
[2013-11-15 15:16:43 -0500] jperry: for example I fetch a data bag and set it to a local variable
[2013-11-15 15:17:13 -0500] mikejw: can I user chef to remotely restart a service on a machine?
[2013-11-15 15:17:28 -0500] zts: viraptor: is the plan that if the run explodes before the end, the restart would happen the next time chef runs?
[2013-11-15 15:18:08 -0500] daxroc: mikejw: would knife exec work for you?
[2013-11-15 15:18:37 -0500] viraptor: zts: exactly, but additionally it merges single chef run restarts into one - so if A triggers restart and B triggers restart, service will restart only once at the end
[2013-11-15 15:18:45 -0500] zts: viraptor: anyway, the filthy hack I would use if this is for a single, specific service would be to use plain old ruby in an exception/report handler as one of those is guaranteed to run unless chef actually dies in the middle
[2013-11-15 15:19:38 -0500] zts: viraptor: but the better solution (as you probably know) is to upgrade to chef 11, since delayed notifications will still be handled if the run bails out in the middle
[2013-11-15 15:19:50 -0500] daxroc: Does the notify delay not take this into account?
[2013-11-15 15:20:33 -0500] daxroc: ah, zts :D
[2013-11-15 15:21:04 -0500] mikejw: daxroc: maybe.. I take it I need knife on the host machine
[2013-11-15 15:21:34 -0500] daxroc: zts: Which is good and bad, as if it borks mid run possible configuration mismatching
[2013-11-15 15:21:35 -0500] viraptor: zts: actually that's not perfect either - I want to execute the restart only after a complete run, so what chef 11 does is not going to work either (think: package and config updates in a single run - changing one, crashing and restarting the service can leave it with incompatible settings)
[2013-11-15 15:21:49 -0500] viraptor: zts: that was re. chef-11
[2013-11-15 15:23:03 -0500] daxroc: mikejw: better describe what you want to achieve first
[2013-11-15 15:23:06 -0500] zts: viraptor: I'm not sure I understand - delayed notifications are already coalesced (if multiple notify a service to restart, it will only restart once)
[2013-11-15 15:23:39 -0500] zts: viraptor: oh right, sorry - so you only want the restart to fire if a full set of things have notified it?
[2013-11-15 15:23:48 -0500] viraptor: exactly
[2013-11-15 15:23:55 -0500] mikejw: I have a vagrant instance being managed with chef and I want to restart memcache from the host machine vagrant is set up on
[2013-11-15 15:24:09 -0500] viraptor: zts: report handler would do that... I'll have to take a look at it
[2013-11-15 15:25:29 -0500] zts: viraptor: that's an interesting idea though.  The "right" solution for this might be subclassing the service provider, so that you can still listen for delayed notifications, but add some additional logic before firing the restart
[2013-11-15 15:25:40 -0500] daxroc: mikejw: Not sure I follow, from the host you want to restart memcached service ?
[2013-11-15 15:26:07 -0500] mikejw: yes
[2013-11-15 15:26:07 -0500] daxroc: *from the host you want to restart memcached on the vagrant box ?
[2013-11-15 15:26:09 -0500] mikejw: yes
[2013-11-15 15:26:23 -0500] daxroc: you don't need chef to do that , vagrant ssh
[2013-11-15 15:26:36 -0500] mikejw: hmm
[2013-11-15 15:27:39 -0500] mikejw: oh yeah.. with the -c flag :)
[2013-11-15 15:27:51 -0500] mikejw: sweet
[2013-11-15 15:28:32 -0500] daxroc: mikejw: if you find your writing out the commands alot add a plugin to vagrant :D
[2013-11-15 15:29:37 -0500] mikejw: well the plan is that it will run automatically before some system tests
[2013-11-15 15:33:05 -0500] viraptor: zts: do you know if the report handler created from chef will be active in the same run, or does it need another one?
[2013-11-15 15:40:46 -0500] rep0st: soo...what does everybody suggest when checking if a remote port is available when writing a cookbook?
[2013-11-15 15:41:08 -0500] zts: viraptor: I believe if you're using the chef_handler cookbook to install it, that it will be active immediately
[2013-11-15 15:48:08 -0500] jbowman: Hi, is there a way to set something to run at the very end of a chef-client run? I've tried using notifies with :delayed but it's not working. Basically I need a nrpe.cfg configured at the very end of all server runs. The only idea I've come up with is to write a script on the chef server that will reorganize the run_list to make sure recipe[nrpe] gets run last
[2013-11-15 15:56:01 -0500] viraptor: jbowman: you missed that conversation by around 20 minutes ;) but this looks like a simple case - why do you need to do the change at the end of the run?
[2013-11-15 15:58:20 -0500] jbowman: ha, always my luck. For nrpe, I have to configure the commands it runs. One set of commands is a list of disk mounts. Some of those mounts may be built via other recipes. So if I create the nrpe.cfg too early it doesn't have all the mounts listed, however when the nagios server runs it recipe to generate it's list of monitors it makes those checks and we command not defined errors.
[2013-11-15 15:58:46 -0500] jjj4: my recipe includes a restart of the ipsec service... it's restarting every time the recipe runs... how do i make this only happen when the recipe is first run?
[2013-11-15 16:05:25 -0500] jjj4: QUESTION: My recipe restarts a service, but it's restarting every time the recipe runs. How do I limit the restart to the first run of the recipe?
[2013-11-15 16:07:57 -0500] s2r2: service "blah" do action [:enable, :start] end; template "blah.conf" do  notifies :restart, "service[blah]", :delayed end
[2013-11-15 16:08:07 -0500] s2r2: only restart the service when its config is updated
[2013-11-15 16:08:44 -0500] michaelhart: Is there a way to check if a provider exists before trying to execute it? In english, "if the provider nagios_nrpe exists, execute it"
[2013-11-15 16:09:23 -0500] jjj4: s2r2: thanks, i'll look into that
[2013-11-15 16:12:30 -0500] michaelhart: nm, wrapping it in a begin/rescue NameError/end works.
[2013-11-15 16:17:51 -0500] viraptor: jbowman: it looks like you need to order it on the runlist really (or use the chef's report handler, but that's ugly)
[2013-11-15 16:18:44 -0500] pedda: hi there
[2013-11-15 16:18:58 -0500] viraptor: jbowman: or save the mounts list in the node attributes and so the first time you may get an incomplete list, but on the second one, it should be fine
[2013-11-15 16:19:30 -0500] pedda: if i want to override some php setting in the php cookbook which only resides in templates/debian/php.ini.erb , am i allowed to duplicate the file, put it into my own cookbook at the same place and adjust the value?
[2013-11-15 16:19:35 -0500] pedda: will it be overriden?
[2013-11-15 16:21:48 -0500] pedda: alternatively: how to raise php max_execution_time if it is hardcoded into a template of php cookbook ?
[2013-11-15 16:23:39 -0500] jbowman: all subsequent runs get it right, it's just the first. The difficult part is I have a team and I'm the on introducing chef so I'm trying to make it as easy as possible for them. Especially the monitoring integration has been a tough sell
[2013-11-15 16:24:14 -0500] wdilly: whats the difference between nodes and clients?
[2013-11-15 16:24:21 -0500] jbowman: oh and we don't run chef regularly, didn't like the idea of someone being able to hack the chef server and have access to everything. Right now chef-client is always run manually
[2013-11-15 16:26:15 -0500] jbowman: wdilly: clients are basically the stored ssl keys that create the trust relationship between the client and the server. nodes are where all the clients metadata like attributes and the run_list are stored.
[2013-11-15 16:27:59 -0500] wdilly: jbowman, thanks... so lets say a machine is being decomissioned. I would want to "knife node delete" and "knife client delete" it as well?
[2013-11-15 16:28:07 -0500] jbowman: yes
[2013-11-15 16:30:18 -0500] wdilly: jbowman, is there a way to bootstrap a client yet prevent it from shipping ohai data back to the server?
[2013-11-15 16:32:06 -0500] jbowman: wdilly: sorry, that's deeper than I've gotten. Right now in our redhat environment I bootstrap OS, popping that up as a vmware template. Deploying from that template I configure network (including host name), register with rhn, patch and then install chef. Sounds like a lot, usually only a few minutes per machine though.
[2013-11-15 16:36:42 -0500] wdilly: cool, chef-client runs seem to pull client data out of the metadata server of our private cloud and i choking on it because of the encoding, i would like to just tell chef-client it need not collect that data
[2013-11-15 16:40:04 -0500] wdilly: so, i deleted all of my knife clients and now the webui of the chef-server is toast... what gives?
[2013-11-15 16:41:23 -0500] jbowman: if you deleted a client, delete /etc/chef/client.pem on the client side, make sure you have the right /etc/chef/validation.pem and then rerun chef-client. It will restore the client
[2013-11-15 16:42:17 -0500] wdilly: i deleted all of my clients
[2013-11-15 16:42:21 -0500] wdilly: intentionally
[2013-11-15 16:42:29 -0500] wdilly: im just in the testing phase
[2013-11-15 16:42:43 -0500] wdilly: but now the web interface of the chef-server is not working
[2013-11-15 16:42:46 -0500] jbowman: do you mean you did 'knife client delete' or that you deleted the actual server?
[2013-11-15 16:43:01 -0500] wdilly: knife client bulk delete .*
[2013-11-15 16:43:05 -0500] jbowman: I don't know about the web server though, I do everything with knife at the command line
[2013-11-15 16:44:23 -0500] jbowman: my only hunch is the web server requires that it able be a client of the chef server environment to run. Run chef-client on the chef server after resetting the .pem files
[2013-11-15 16:44:55 -0500] pedda: how do i override values which are set in template files of vendor cookbooks ?
[2013-11-15 16:48:16 -0500] wdilly: the /etc/chef-server/chef-webui.pem file?
[2013-11-15 16:49:48 -0500] jbowman: no, your chef server is a client of chef too (usually), try 'mv /etc/chef/client.pem /tmp; chef-client' see if it works. If you get errors about validation.pem not being good, then you'll need to update that with the valid version
[2013-11-15 16:51:45 -0500] wdilly: there is no client.pem in /etc/chef
[2013-11-15 16:51:56 -0500] wdilly: on the server that is
[2013-11-15 16:52:27 -0500] jbowman: then maybe that server isn't a chef client? In that case, I don't know. I don't use the webui, sorry :(
[2013-11-15 16:52:33 -0500] zts: wdilly: you can drop some ohai data with this - https://github.com/irccloud/blacklist-node-attrs
[2013-11-15 16:54:16 -0500] wdilly: zts, thanks
[2013-11-15 16:54:59 -0500] zts: pedda: specifically for the PHP cookbook, see the ['php']['directives'] attribute - you can give it PHP options & values, which will get written at the bottom of the php.ini
[2013-11-15 16:55:36 -0500] zts: pedda: the original values are still earlier in the file, but PHP uses the last one it sees
[2013-11-15 16:55:40 -0500] pedda: oh, this is nice
[2013-11-15 16:55:57 -0500] pedda: so i just need to extend my attributes file with php directives and i'm done?
[2013-11-15 16:56:18 -0500] zts: pedda: in general, you can make a "wrapper" cookbook with your own template, then use this method to tell the PHP cookbook to use the template file from your cookbook - https://gist.github.com/sethvargo/6443603
[2013-11-15 16:56:37 -0500] spiffytech: If I have a Chef 10 server, do I need to upgrade it to pair it with Chef 11 nodes?
[2013-11-15 16:56:37 -0500] zts: pedda: yep, for just overriding some PHP settings, that should work alright for you
[2013-11-15 16:56:53 -0500] pedda: zts, thank you, i will give it a try
[2013-11-15 16:57:37 -0500] jbowman: Can you access and modify the run_list during a chef-client run? It's an attribute right?
[2013-11-15 17:01:31 -0500] tatemz: Anyone know how to chmod a directory and all subdirectories to 755 and all files to 644 using the directory or file resources?
[2013-11-15 17:03:20 -0500] tatemz: Anyone know how to chmod a directory and all subdirectories to 755 and all files to 644 using the directory or file resources?
[2013-11-15 17:04:52 -0500] pedda: zts is it enough to put that php directives right into my default.rb attributes file ?
[2013-11-15 17:05:20 -0500] tubbo: hi all. i'm trying to integrate Chef Server into my company's infrastructure workflow.
[2013-11-15 17:05:25 -0500] pedda: or di i need to put them at a place before the php cookbook is loaded (i'm not sure when attributes file gets parsed)
[2013-11-15 17:05:30 -0500] tubbo: right now, we use Chef Solo, a little shell script to place Chef on the device, and a PXE server to boot our OS
[2013-11-15 17:05:45 -0500] tubbo: from what I read it seems like we can use Chef for all of these things, no PXE or boot script necessary...is this true?
[2013-11-15 17:06:21 -0500] jblancett: tatemz:  the directory resource says if you pass a string to the mode attribute it will work exactly as the chmod command was passed
[2013-11-15 17:07:11 -0500] jblancett: tatemz: so you should be able to do something like "-R 755"  but I'm not sure
[2013-11-15 17:07:53 -0500] spiffytech: No, -R is going to change the permissions on  both files and directories.
[2013-11-15 17:08:01 -0500] tatemz: We are talking about chef right?
[2013-11-15 17:08:06 -0500] tatemz: In a cookbook...
[2013-11-15 17:08:11 -0500] tatemz: using the directory resource...
[2013-11-15 17:08:49 -0500] pedda: zts got it working thx again :)
[2013-11-15 17:08:54 -0500] tatemz: jblancett: I see... so any string in there will work as chmod
[2013-11-15 17:09:04 -0500] tatemz: jblancett: Will test
[2013-11-15 17:11:07 -0500] burtlo: Anyone have a resource I can read to understand what the difference in environment/settings it is when I run "sudo service SERVICENAME start" versus just running the process as root.
[2013-11-15 17:11:23 -0500] burtlo: In my case I'm running "bluepill" through a service and it never starts
[2013-11-15 17:12:25 -0500] burtlo: When I run the "bluepill" command, same one the service runs, it works
[2013-11-15 17:12:34 -0500] burtlo: So I feel like there is something missing when I run as a service, something related to ruby or some such.
[2013-11-15 17:14:38 -0500] jblancett: tatemz: since you're wanting to treat files and directories differently it may be better to use the bash resource and run custom commands
[2013-11-15 17:14:56 -0500] tatemz: jblancett: yeah
[2013-11-15 17:15:25 -0500] jjj4: QUESTION: Is it normal for Chef on a client to take 10 seconds to display "Starting Chef Client" and another 10 seconds to say "resolving cookbooks" and another 10 seconds to start "Synchronizing Cookbooks"?
[2013-11-15 17:15:51 -0500] pedda: passing some directives over to the vendor php cookbook makes their values to become strings like this: max_execution_time="360"
[2013-11-15 17:16:35 -0500] jblancett: jjj4: that sounds unusual to me
[2013-11-15 17:17:04 -0500] pedda: jjj4 looks to me as if you ran out of memory
[2013-11-15 17:17:28 -0500] pedda: as this happens on my machine if it ran out of memory
[2013-11-15 17:17:52 -0500] jjj4: out of memory on the client or the server?
[2013-11-15 17:18:22 -0500] pedda: the one which is taking that long to fire up vagrant
[2013-11-15 17:18:55 -0500] jjj4: i'm not using vagrant. i'm using 2 m1.small ec2 instances
[2013-11-15 17:19:11 -0500] pedda: ups.. i should have followed your topic ..
[2013-11-15 17:20:05 -0500] pedda: but this is kind of a general issue.. isn't it? if an application starts up/behaves very slowly it might be the issue of exceeded memory
[2013-11-15 17:20:26 -0500] pedda: another option is network connection speed
[2013-11-15 17:20:52 -0500] pedda: if the starting of chef client depends on some remote resources
[2013-11-15 17:23:00 -0500] jjj4: My OSS Chef server is taking 16 seconds to reply to each HTTPS request.
[2013-11-15 17:23:33 -0500] jjj4: It's consistently 15 seconds
[2013-11-15 17:23:58 -0500] Jamin: jjj4: ouch, you in the back of beyond?
[2013-11-15 17:24:23 -0500] jjj4: no, this is EC2 Virginia talking to EC2 Oregon
[2013-11-15 17:24:52 -0500] jjj4: it's very consistent, like a timeout
[2013-11-15 17:25:04 -0500] Jamin: I take it ping is much better :)
[2013-11-15 17:25:17 -0500] jjj4: let's double check...
[2013-11-15 17:26:58 -0500] jjj4: 83ms
[2013-11-15 17:31:27 -0500] pedda: zts i'm still struggeling with passing those directives, as they appear to have values wrapped by quotes which results in an "error"
[2013-11-15 17:31:58 -0500] pedda: sth. like this: default[:php][:directives][:max_execution_time] = 360 becomes max_execution_time="360" at the bottom of the ini file
[2013-11-15 17:33:26 -0500] zts: pedda: oh, hm.  Looks like the same thing happens for me, but hasn't been an error for the directives I change - which version of PHP are you using?
[2013-11-15 17:33:53 -0500] pedda: PHP Version 5.3.10-1ubuntu3.8
[2013-11-15 17:34:01 -0500] pedda: default precize32 box
[2013-11-15 17:34:10 -0500] pedda: and the cookbook from opscode
[2013-11-15 17:34:13 -0500] pedda: i mean
[2013-11-15 17:34:20 -0500] pedda: i need to adjust max upload filesize too
[2013-11-15 17:35:04 -0500] pedda: both appear at the bottom of the ini file but are wrapped by quotes and thus ignored.. i think
[2013-11-15 17:35:44 -0500] pedda: i've already restarted apache to make it take these two settings into account with no result
[2013-11-15 17:35:56 -0500] pedda: it might be also the tool i use to verify this ..
[2013-11-15 17:36:14 -0500] zts: pedda: not sure sorry, system I just checked is 5.3.27, an example directive I am setting is session.gc_maxlifetime, which is a bare integer in the default config, but a quoted integer in mine - and it works fine
[2013-11-15 17:36:19 -0500] pedda: i create some php_info script.. to ensure it'S not my "tool's" fault
[2013-11-15 17:36:34 -0500] zts: yeah, might be best to double-check
[2013-11-15 17:36:41 -0500] pedda: if it works for you, i definetly have an error on my side here..
[2013-11-15 17:36:53 -0500] pedda: ths for clarifying
[2013-11-15 17:36:57 -0500] pedda: *thx
[2013-11-15 17:37:06 -0500] zts: it seems unlikely it would be a difference between 5.3.10 and 5.3.27 - if you were on 5.2 or 5.4+, I would wonder :)
[2013-11-15 17:37:24 -0500] pedda: true
[2013-11-15 17:37:28 -0500] pedda: :)
[2013-11-15 17:38:47 -0500] pedda: just to make sure: where do you put that adjustment?
[2013-11-15 17:38:51 -0500] pedda: in your attributes file ?
[2013-11-15 17:39:34 -0500] pedda: that's what stated on the cookbook's readme at least
[2013-11-15 17:40:46 -0500] pedda: well.. this all makes sense if you realize there are two different php.ini files ;)
[2013-11-15 17:40:57 -0500] pedda: #and the relevant one is not the one i modified ..
[2013-11-15 17:41:06 -0500] pedda: (facepalm)
[2013-11-15 17:49:29 -0500] surge_: I can't seem to find any info on this, but what exactly can a non-admin chef user do in Open Source Chef Server?
[2013-11-15 17:49:40 -0500] surge_: It looks like the web gui doesnt match the opscode hosted one
[2013-11-15 17:52:37 -0500] surge_: Looks like I have no option to specify read-only access to chef server w/ the open source server...
[2013-11-15 17:52:53 -0500] timsmith1: open source lacks all the ACLs in enterprise
[2013-11-15 17:52:54 -0500] timsmith1: and hosted
[2013-11-15 17:52:57 -0500] timsmith1: that's the upsell
[2013-11-15 17:53:12 -0500] surge_: soo a non admin is just... what then? lol
[2013-11-15 17:53:23 -0500] surge_: the docs are missing that
[2013-11-15 17:54:06 -0500] timsmith1: they do seem to be missing that
[2013-11-15 17:56:10 -0500] timsmith1: admin rights allow tasks such as create, read, update, or delete for all nodes
[2013-11-15 17:56:10 -0500] timsmith1: normal rights are only actionable only on per-node basis
[2013-11-15 17:56:11 -0500] timsmith1: from the Auth doc
[2013-11-15 17:57:10 -0500] timsmith1: http://docs.opscode.com/auth.html
[2013-11-15 17:58:06 -0500] coderanger: surge_: non-admin client means read access to all objects, and update access to the node matching the name of hte client
[2013-11-15 17:58:25 -0500] surge_: yeah ok i see that now in the auth doc tim mentioned
[2013-11-15 18:02:34 -0500] timsmith1: coderanger: what's the process for updating docs.opscode.com
[2013-11-15 18:02:50 -0500] timsmith1: one sentence on what admin means in the getting started with open source would really help people out
[2013-11-15 18:02:50 -0500] coderanger: timsmith1: submit a pull req to github.com/opscode/chef-docs
[2013-11-15 18:02:56 -0500] timsmith1: cool
[2013-11-15 18:02:57 -0500] timsmith1: will do
[2013-11-15 18:04:15 -0500] wdilly: So, I made the error of bulk deleting all of my nodes and clients (That part is okay - I dont have anything in production just testing) but now the webui of my chef-server doesnt work. I can get to the intiial login, but after my password I get:  "We're sorry, but something went wrong."
[2013-11-15 18:05:04 -0500] wdilly: knife node bulk delete .* and knife client bulk delete .*
[2013-11-15 18:07:13 -0500] coderanger: wdilly: restart the server, it should recreate the chef-webui key for you
[2013-11-15 18:07:18 -0500] coderanger: and the validator
[2013-11-15 18:07:32 -0500] coderanger: Those should really probably be exempt from bulk delete
[2013-11-15 18:08:01 -0500] wdilly: coderanger, I appreciate your help. I have init 6'd the machine and chef-server-ctl reconfigure
[2013-11-15 18:08:07 -0500] wdilly: still the same issue
[2013-11-15 18:08:36 -0500] coderanger: wdilly: Also make sure you remove them from disk on the server
[2013-11-15 18:08:43 -0500] coderanger: in /etc/chef I think
[2013-11-15 18:08:58 -0500] wdilly: remove the validator.pem and the che-webui.pem?
[2013-11-15 18:10:07 -0500] stormerider: coderanger: isnt the webui key now in /etc/chef-server in 11?
[2013-11-15 18:10:27 -0500] coderanger: It might be, not sure
[2013-11-15 18:10:43 -0500] coderanger: Never used the UI in open-source chef 11
[2013-11-15 18:10:44 -0500] BenT: Question: I would like to download a file and based on its contents run a number of remote_file resources.  Is there a way to exeucte a remote file resource in a recipe manually, non-deferred?
[2013-11-15 18:10:52 -0500] coderanger: BenT: Yes, but don't, use LWRPs
[2013-11-15 18:11:52 -0500] wdilly: on my system those two .pems are in /etc/chef-server
[2013-11-15 18:12:00 -0500] coderanger: wdilly: Sounds right :-)
[2013-11-15 18:12:14 -0500] wdilly: code, im going to move them and then restart and let you know, thanks
[2013-11-15 18:20:02 -0500] wdilly: coderanger, restarting didnt regenerate chef-validator or webui .pem files
[2013-11-15 18:20:19 -0500] wdilly: do i need to reconfigure?
[2013-11-15 18:22:53 -0500] jjj4_: PROBLEM: My OSS Chef server (brand new install on ec2) is taking 15 seconds to respond to every HTTPS POST from the client. Examples are https://{server}//environments/_default/cookbook_versions and https://{server}//reports/nodes/{nodename}/runs
[2013-11-15 18:23:18 -0500] jjj4_: It takes the same amount of time for every response to every query.
[2013-11-15 18:23:46 -0500] BenT: @coderanger: Thanks.  How would I execute an LWRP to get the results back and then use that data in declaring other resources?
[2013-11-15 18:23:58 -0500] iamchrisf: Is there any ETA on the release of Chef Server 11.0.10?
[2013-11-15 18:25:46 -0500] BenT: @coderanger: I think my question has to do with running an LWRP non-deferred (?)
[2013-11-15 18:37:50 -0500] jjj4_: How do I get information about OTHER nodes for a template on one node?
[2013-11-15 18:39:26 -0500] wdilly: how do i regenerate my chef-webui.pem and chef-validation/pem in private chef?
[2013-11-15 18:55:54 -0500] tubbo: is there a `knife bootstrap` provider that works with PXE?
[2013-11-15 19:00:07 -0500] rdobbs: hi, I'm struggling with a bunch of the application_cookbooks, they're pretty broken. I was wondering if anybody had a fork of application_unicorn with a runit script that actually works?
[2013-11-15 19:00:45 -0500] rdobbs: or rather application_rails with a runit script for unicorn
[2013-11-15 19:07:00 -0500] stormerider: tubbo: i believe that the tools to use for that are razor, pxedust, and there's another one im blanking on... i think coderanger mentioned them yesterday, or maybe it was jtimberman
[2013-11-15 19:11:55 -0500] btm_: tubbo: https://github.com/crowbar/crowbar/wiki
[2013-11-15 19:11:56 -0500] coderanger: tubbo stormerider: crowbar is the dell one
[2013-11-15 19:12:04 -0500] coderanger: btm_: jinx ;-)
[2013-11-15 19:12:14 -0500] stormerider: that's the one i was forgetting :) thanks.
[2013-11-15 19:20:14 -0500] jjj4_: QUESTION: What is the right way to have a recipe on node A output a template with ohai details about node B?
[2013-11-15 19:20:28 -0500] tubbo: btm_: ooh, looks delicious :)
[2013-11-15 19:22:31 -0500] tubbo: coderanger: so Crowbar says "Crowbar currently supports deploying Openstack or Hadoop clusters.", does that mean it probably won't work for bare metal?
[2013-11-15 19:22:52 -0500] tubbo: we don't have any kind of special tools, we're just using PXE and a custom boot menu to build new boxes in production.
[2013-11-15 19:23:00 -0500] coderanger: tubbo: No, it deploys from bare metal to those kinds of clusters
[2013-11-15 19:23:17 -0500] tubbo: coderanger: oh i see
[2013-11-15 19:23:43 -0500] tubbo: coderanger: what do you mean by "from bare metal TO those kinds of clusters"? i guess i'm confused, thought those were more lateral positions than hierarchial..
[2013-11-15 19:24:05 -0500] tubbo: i'm just a dev trying to make our infrastructure better! ;)
[2013-11-15 19:24:17 -0500] jbz: tubbo: Crowbar is meant to stand up a working cluster.  IT doesn't stand up machines inside those clusters (at least, not out of the box)
[2013-11-15 19:24:36 -0500] jbz: tubbo:  So if you wanted to turn a stack of 20 iron boxes into an empty but working Openstack cluster, Crowbar is for you.
[2013-11-15 19:24:38 -0500] tubbo: oh ok. that doesn't seem like what i'm after.
[2013-11-15 19:24:41 -0500] tubbo: well right now
[2013-11-15 19:24:47 -0500] tubbo: eventually, hell yeah f'in rite ;)
[2013-11-15 19:24:54 -0500] jbz: :-)
[2013-11-15 19:25:34 -0500] tubbo: i also saw https://blogs.oracle.com/ksplice/entry/pxe_dust_scalable_day_to but that's a TL;DR for right now :P
[2013-11-15 19:25:36 -0500] tubbo: saved to pocket
[2013-11-15 19:25:47 -0500] tubbo: though this one seemed like the way to go https://www.bluebox.net/insight/blog-article/provisioning-with-razor-and-chef-an-interactive-demo
[2013-11-15 19:26:34 -0500] tubbo: i guess my issue with all these tools is they all seem to imply that i'm converting a bare metal infrastructure into a cloud cluster of boxes, which isn't what i'm trying to do right now.
[2013-11-15 19:26:56 -0500] tubbo: i don't want to go to a cloud, i just want my chef server to be able to bootstrap and deploy boxes centrally.
[2013-11-15 19:27:20 -0500] coderanger: tubbo: Eh, its often still easier to just throw openstack on them first
[2013-11-15 19:27:22 -0500] jjj4_: Is there an interactive chef interpreter of some kind? Is there some way to test recipe code snippets interactively?
[2013-11-15 19:27:29 -0500] coderanger: jjj4_: chef-shell
[2013-11-15 19:27:38 -0500] jjj4_: thank you!
[2013-11-15 19:27:59 -0500] tubbo: coderanger: i'm not too familiar with openstack honestly. is it partially something that must go on each bare metal box?
[2013-11-15 19:28:38 -0500] coderanger: tubbo: Basically you would be doing things the normal cloud-y way, but just use a single LXC-backed VM per physical node
[2013-11-15 19:29:33 -0500] tubbo: oh so basically each box would be a VM unto itself?
[2013-11-15 19:29:55 -0500] tubbo: that seems legit, especially if we're running our own cloud. but that's really not the problem i'm trying to solve
[2013-11-15 19:30:30 -0500] coderanger: Yeah, I mean you need the infra to get the OS on there, configure network, etc
[2013-11-15 19:30:31 -0500] tubbo: like for the majority of the boxes we build, they never come back into the datacenter.
[2013-11-15 19:30:36 -0500] tubbo: we ship them
[2013-11-15 19:31:16 -0500] tubbo: i guess i should see how much work it would really be to add that in
[2013-11-15 19:31:21 -0500] vt102: Who should own /opt/chef?  It installed as user 999 on ubuntu.  On CentOS, it looks like it's all root.
[2013-11-15 19:31:30 -0500] tubbo: we've wanted to use OpenStack, but never really knew much about how to get it going
[2013-11-15 19:31:41 -0500] tubbo: (for certain things)
[2013-11-15 19:31:47 -0500] dgarstang3: Does anyone know of a way to get a list of attached physical disks in amazon and gce with chef?
[2013-11-15 19:31:49 -0500] coderanger: tubbo: Ahh, you mean like building appliances?
[2013-11-15 19:31:59 -0500] tubbo: coderanger: that's exactly what we're doing. appliances.
[2013-11-15 19:32:11 -0500] coderanger: tubbo: Okay, then yeah, crowbar won't be what you want
[2013-11-15 19:32:23 -0500] coderanger: tubbo: pxedust will probably be the best fit :-)
[2013-11-15 19:32:23 -0500] tubbo: coderanger: lol i guess i never mentioned that, yeah...that's what we do. is there any tool that makes more sense for that?
[2013-11-15 19:32:30 -0500] tubbo: ok, i'll read up on it
[2013-11-15 19:35:41 -0500] gmcinnes: Howdy guys. I"m just kicking around ideas for using chef-server to enforce licences for my application. Anyone aware of anyone doing that before?
[2013-11-15 19:39:49 -0500] dgarstang3: lets try a different approach. How can I make data_bag_item() not barf when the data bag item doesn't exist?
[2013-11-15 19:40:02 -0500] Cope: erm, catch the exception?
[2013-11-15 19:41:02 -0500] dgarstang3: Cope: That throws 'Net::HTTPServerException' ... seems somewhat further up the stack than I'd like
[2013-11-15 19:41:15 -0500] dgarstang3: like maybe ... data_bag_item could return false or somethig?
[2013-11-15 19:41:21 -0500] dgarstang3: or nil
[2013-11-15 19:41:36 -0500] Cope: hmm - please hold
[2013-11-15 19:42:25 -0500] dgarstang3: Nothing on http://docs.opscode.com/essentials_data_bags.html about checking if a data bag key exists
[2013-11-15 19:43:08 -0500] gmcinnes: Howdy guys. I"m just kicking around ideas for using chef-server to enforce licences for my application. Anyone aware of anyone doing that before?
[2013-11-15 19:43:15 -0500] gmcinnes: sorry if that was spam. Just had a split here
[2013-11-15 19:44:37 -0500] gmcinnes: I"m just thinking about stuffing some secret in the chef-server and distributing that secret to the client via another channel (file etc) and then comparing them both at app startup.  Seem reasonable?
[2013-11-15 19:44:51 -0500] Cope: dgarstang3: so data_bag_item just makes a rest call using Chef::REST
[2013-11-15 19:45:21 -0500] dgarstang3: Cope: ooook....
[2013-11-15 19:46:05 -0500] dgarstang3: Is this the sum total of all human knowledge of writing how to catch an exception in chef recipes? http://docs.opscode.com/essentials_data_bags.html
[2013-11-15 19:46:20 -0500] dgarstang3: oops meant http://docs.opscode.com/essentials_handlers.html
[2013-11-15 19:46:57 -0500] Cope: dgarstang3: it's just ruby; you handle exceptions in just the same way.  If you want to know what the code will throw, just look at the src
[2013-11-15 19:47:00 -0500] Cope: https://github.com/opscode/chef/blob/master/lib/chef/rest.rb
[2013-11-15 19:47:32 -0500] Cope: ah the handlers is a different thing altgogether
[2013-11-15 19:47:33 -0500] dgarstang3: Cope: Thanks but I dunno what to do with that
[2013-11-15 19:47:47 -0500] dgarstang3: Cope: documented anywhere?
[2013-11-15 19:48:21 -0500] Cope: dgarstang3: handling exceptions is documented in all the standard ruby books; it's prety simple.
[2013-11-15 19:48:29 -0500] bean: dgarstang3: I'd probably just wrap it in an "begin / rescue / end" block
[2013-11-15 19:48:36 -0500] Cope: right
[2013-11-15 19:49:01 -0500] bean: What error is it throwing?
[2013-11-15 19:49:01 -0500] Cope: and if you want to be more explicit, you can handle the specific exception by name
[2013-11-15 19:49:06 -0500] bean: a 403?
[2013-11-15 19:49:10 -0500] dgarstang3: 404
[2013-11-15 19:49:16 -0500] Cope: i'd expect a 404
[2013-11-15 19:49:20 -0500] Cope: if teh data bag is not there
[2013-11-15 19:49:25 -0500] dgarstang3: yah no idea. googleing and googling and googling
[2013-11-15 19:49:32 -0500] bean: me too.
[2013-11-15 19:49:39 -0500] bean: What is the exact error its throwing in the logs
[2013-11-15 19:49:42 -0500] bean: and I'll show ya.
[2013-11-15 19:50:01 -0500] Cope: dgarstang3: happy to help you, but it'd be good to know what you've tried so far
[2013-11-15 19:50:22 -0500] dgarstang3: in the logs? stdout has 'Net::HTTPServerException' '404 "Object Not Found"'
[2013-11-15 19:50:33 -0500] bean: alright, one sec
[2013-11-15 19:50:34 -0500] dgarstang3: Cope: nothing except read the docs and see if loading a data bag could be handled gracefully. apparently not
[2013-11-15 19:50:36 -0500] bean: I'll make you a gist.
[2013-11-15 19:50:44 -0500] dgarstang3: tanx
[2013-11-15 19:50:56 -0500] jmickle: :-)
[2013-11-15 19:51:22 -0500] Cope: dgarstang3: so data_bag_item makes a call to teh databag api end point
[2013-11-15 19:51:41 -0500] Cope: when you create a databag, you effectively create the endpoint
[2013-11-15 19:52:16 -0500] dgarstang3: Not having to list physical disks in a data bag keyed by instance type would be great, but...
[2013-11-15 19:52:45 -0500] Cope: ie if you have a databag called fish, you can now hit the endpoint data/fish
[2013-11-15 19:52:49 -0500] bean: https://gist.github.com/daniellockard/f9b90fc185e622a25de0
[2013-11-15 19:52:58 -0500] bean: that's how I'd do it, if i didn't know if it would exist
[2013-11-15 19:52:58 -0500] Cope: and dbi of 'pike'
[2013-11-15 19:53:06 -0500] Cope: data/fish/pike
[2013-11-15 19:53:28 -0500] dgarstang3: bean: Thanks. What about the 404 tho?
[2013-11-15 19:53:35 -0500] Cope: dgarstang3: it's an http request
[2013-11-15 19:53:35 -0500] dgarstang3: or do I really care
[2013-11-15 19:53:39 -0500] bean: the 404 is getting caught there
[2013-11-15 19:53:40 -0500] Cope: what else would you expect
[2013-11-15 19:53:49 -0500] bean: I don't think you /should/ care about it
[2013-11-15 19:53:49 -0500] Cope: if your databag doesn't esist you'll get a 404
[2013-11-15 19:53:50 -0500] dgarstang3: Cope: but it's not acting based on the result code
[2013-11-15 19:53:58 -0500] dgarstang3: what if I get something else?
[2013-11-15 19:54:01 -0500] Cope: no, it just raises the exception as a rest client
[2013-11-15 19:54:06 -0500] dgarstang3: what if it times out?
[2013-11-15 19:54:35 -0500] dgarstang3: I guess I'll just stick with that. Thanks.
[2013-11-15 19:54:58 -0500] bean: if it times out I think it's actually a different error
[2013-11-15 19:54:59 -0500] dgarstang3: Seems really bizarre to me to use a high level function call, but yet wrap the exception handling in a layer below it
[2013-11-15 19:55:00 -0500] Cope: you'll might get a different exception i guess.. i'd need to check he code
[2013-11-15 19:55:02 -0500] spiffytech: Can someone point me to the documentation for setting up keys for a new user with Chef Server? I can't find it for the life of me...
[2013-11-15 19:55:47 -0500] bean: spiffytech: you just create the user and give them their key?
[2013-11-15 19:56:02 -0500] bean: or use "knife user create USER"
[2013-11-15 19:56:14 -0500] dgarstang3: bean: can I nest these guys?
[2013-11-15 19:57:00 -0500] spiffytech: bean: I have a user in the web interface, but I don't see any option to upload keys.
[2013-11-15 19:57:13 -0500] bean: spiffytech: you don't upload keys -- you're given one when you create the user.
[2013-11-15 20:00:49 -0500] spiffytech: bean: Ah, I see. Got confused when the web admin didn't do that for me.
[2013-11-15 20:01:06 -0500] bean: spiffytech: ah, yeah, he should be giving you the key that the webui spits out when he creates your user
[2013-11-15 20:01:08 -0500] bean: :)
[2013-11-15 20:02:35 -0500] spiffytech: bean: Sorry, I mean the web interface, not an administrator.
[2013-11-15 20:02:56 -0500] bean: ah okay. Yeah, it'll be on that page, but only the FIRST time the user is created
[2013-11-15 20:03:51 -0500] spiffytech: Hmmm, not getting it. I just have the "Created user <name>" message.
[2013-11-15 20:04:07 -0500] spiffytech: bean: I'm back on Chef 10, if that could be the problem. And knife for that doesn't have the 'user' subcommand, so I can't try that way.
[2013-11-15 20:04:17 -0500] spiffytech: Not sure how involved upgrading is.
[2013-11-15 20:04:39 -0500] bean: spiffytech: I, too, am on chef 10 on 2 of my chef servers. It's always shown it in the webui at least.
[2013-11-15 20:04:55 -0500] spiffytech: Hmmm, weird.
[2013-11-15 20:09:07 -0500] spiffytech: bean: http://i.imgur.com/BPG78yI.png
[2013-11-15 20:09:09 -0500] spiffytech: bean: http://i.imgur.com/UJYWL3n.png
[2013-11-15 20:09:28 -0500] bean: let me see
[2013-11-15 20:10:29 -0500] bean: oh, spiffytech, make yourself a client
[2013-11-15 20:10:41 -0500] bean: the two are easily confused :)
[2013-11-15 20:10:45 -0500] bean: the client is where the actual key comes from
[2013-11-15 20:10:59 -0500] bean: not enough caffeine today.
[2013-11-15 20:12:50 -0500] spiffytech: Ah, OK!
[2013-11-15 20:13:14 -0500] programmerq: ssd7: btw, I'm Jeff Anderson that's been working on COOK-3998 for the mysql cookbook service_name attribute stuff.
[2013-11-15 20:16:48 -0500] spiffytech: bean: Cool, I now have my new client and some keys that belong to it. How to I teach knife to use those keys?
[2013-11-15 20:23:10 -0500] dgarstang3: Does anyone know of a way to get a list of attached physical disks in amazon and gce with chef?
[2013-11-15 20:23:51 -0500] Cope: dgarstang3: if ohai knows, you'll have an attribute; if ohai doesn't know, write an ohai plugin.
[2013-11-15 20:24:30 -0500] Cope: dgarstang3: so, for starters, run ohai on a node and inspect the outputl or do knie node show if you prefer
[2013-11-15 20:26:42 -0500] dgarstang3: Cope: Not as simple as that I'm afraid. 'ohai gce | grep sdb' gets me nothing.
[2013-11-15 20:26:47 -0500] dgarstang3: Cope: Mostly Amazon/GCE's fault. You have to do a lot of scraping and inference to get the data
[2013-11-15 20:27:32 -0500] dgarstang3: The deviceName of a disk is '"log01-eu2"' for crying out loud
[2013-11-15 20:33:09 -0500] Cope: dgarstang3: it's precisely as simple as that
[2013-11-15 20:33:19 -0500] dgarstang3: Cope: as simple as?
[2013-11-15 20:33:27 -0500] Cope: you have 2 options:
[2013-11-15 20:33:45 -0500] Cope: 1) Does ohai know about it? If yes: great, you have the attr.  Inspect the node and find it.
[2013-11-15 20:34:09 -0500] Cope: 2) Does ohai not know about it? If not: alas, either search for a plugin or write one.
[2013-11-15 20:34:17 -0500] Cope: which is about 10 lines of ruby, if that
[2013-11-15 20:35:50 -0500] Otterley: has anyone been playing with lazy evaluators lately?
[2013-11-15 20:35:52 -0500] Otterley: my first experience didn't go so well
[2013-11-15 20:35:57 -0500] dgarstang3: Copy: 10 lines of ruby to query the metadata server, get a count of the number of disks attached, then go run fdisk, iterate over that, find physical device names, and associate that previous number with each disk?
[2013-11-15 20:36:41 -0500] Cope: dgarstang3: ok 15
[2013-11-15 20:37:16 -0500] dgarstang3: Copy: prolly helps if your ruby skills are decent too, which is why I was wondering if someone else had already invented this wheel.
[2013-11-15 20:37:32 -0500] Cope: to be fair, i don't doubt that there's complexity in writing the plugin, depending on how easy it is to get the data you want
[2013-11-15 20:37:55 -0500] Cope: dgarstang3: if your ruby skills are poor, fix that problem.
[2013-11-15 20:38:11 -0500] dgarstang3: Cope: not gonna happen by Sunday. :)
[2013-11-15 20:38:21 -0500] Cope: seriously - I will unapologetically say that if you want to go beyond the basics of Chef, you need to learn ruby.
[2013-11-15 20:38:37 -0500] Cope: dgarstang3: you've been resisting learning ruby for as long as you've been in this channel
[2013-11-15 20:39:02 -0500] dgarstang3: Cope: That will take considerable time. I've been doing this for about 16 years and I can safely say that in all that time Ruby is the most unintuitive language I've personally encountered.
[2013-11-15 20:39:03 -0500] Cope: you could have learned it to a perfectly decent standard by now, rather than whining about your lack of ruby skills
[2013-11-15 20:39:12 -0500] garrett__: hrm, ohai doesn't seem to be updating ip information after my ec2 node start/stops.
[2013-11-15 20:40:09 -0500] Cope: dgarstang3: i guess intuitive is very subjective; you'll find people very happy to help you if you're willing to try.
[2013-11-15 20:41:17 -0500] Cope: dgarstang3: i might go so far as to say that intuitive is a myth in itself; different people adapt to different things.
[2013-11-15 20:42:40 -0500] dgarstang3: Cope: I'm not so good at translating symbols into actions I guess
[2013-11-15 20:43:01 -0500] dgarstang3: typically read english better than symbol. :)
[2013-11-15 20:43:16 -0500] Cope: yeah, I think it's a really great steo if you can say what you find unintuitive
[2013-11-15 20:43:24 -0500] Cope: sometimesit's just a small mindest tweak
[2013-11-15 20:43:38 -0500] garrett__: erp, hrm. maybe it's just a caching issue
[2013-11-15 20:43:41 -0500] Cope: dgarstang3: but sumbols... really are nothing very much to worry about
[2013-11-15 20:43:54 -0500] Cope: you don't even need to use them :)
[2013-11-15 20:44:09 -0500] dgarstang3: Cope: except I have to translate them. maybe if I was a first year uni student who'd never programmed before it might be easier to natively learn squiggle.
[2013-11-15 20:44:36 -0500] dgarstang3: Copy: i dind't mean symbols in the ruby sense. I meant ruby's extensive use of <<, |, etc
[2013-11-15 20:44:41 -0500] Cope: dgarstang3: translate to what? do you have an example of some unintuitive code? perhaps that would help us
[2013-11-15 20:45:35 -0500] Cope: dgarstang3: oh.. hmm; not sure what code you've been looking at; i don't think ruby s very 'pnctuation heavy'
[2013-11-15 20:45:41 -0500] dgarstang3: Cope: how about stuff.each do |thing|
[2013-11-15 20:45:46 -0500] dgarstang3: I literally stare at that and keep asking myself wth that does
[2013-11-15 20:46:08 -0500] Cope: on a scale of python < -- > perl it's much closer to python
[2013-11-15 20:46:24 -0500] Cope: dgarstang3: ah ok; so what I found really helpful when i learned ruby was the amusing why the lucky stuff book
[2013-11-15 20:46:40 -0500] dgarstang3: or maybe ['Hello','There'].each { |e| print e}
[2013-11-15 20:47:16 -0500] dgarstang3: linky?
[2013-11-15 20:47:34 -0500] Cope: dgarstang3: so in the why book, he thinks of || as a chute through which things slide into the block
[2013-11-15 20:47:40 -0500] Cope: dgarstang3: hold on a sec
[2013-11-15 20:47:47 -0500] dgarstang3: Cope: see... translation required...
[2013-11-15 20:47:48 -0500] Otterley: does anyone know of a way to unconditionally dispatch a notification to a resource?
[2013-11-15 20:48:07 -0500] Otterley: i.e. even if resource A doesn't change state, I want to have it notify resource B
[2013-11-15 20:48:21 -0500] Cope: dgarstang3: sure, but that's the case with any language
[2013-11-15 20:48:36 -0500] Cope: dgarstang3: http://mislav.uniqpath.com/poignant-guide/book/
[2013-11-15 20:49:17 -0500] garrett__: ah, yeah. it looks like the nginx cookbook, included by kibana, doesn't see that it needs to update its conf templates after my node.ipaddress gets changed by ohai. is there a way to force a template to be re-generated that far upstream?
[2013-11-15 20:49:37 -0500] Cope: dgarstang3: btw (and this isn't a plug) my book has a chapter on ruby, and tries to introduce both ruby and chef from first principles, so you actually understand, rather than have to rely on memory
[2013-11-15 20:49:45 -0500] dgarstang3: Service Temporarily Unavailable.... must be a rails app. :)
[2013-11-15 20:49:51 -0500] Cope: dgarstang3: wfm
[2013-11-15 20:49:59 -0500] garrett__: wfm
[2013-11-15 20:50:49 -0500] garrett__: cute book, btw.
[2013-11-15 20:51:03 -0500] Cope: dgarstang3: it boils down to this: being good at your job takes effort; chef is ruby, if you want to be good at chef, you need to learn ruby. That's just the way it is.
[2013-11-15 20:51:24 -0500] Cope: you don't need to be an awesome powerful ruby dev, but you need to be fluent and conversant
[2013-11-15 20:51:38 -0500] Cope: and you'll learn a lot from the chef src code
[2013-11-15 20:51:42 -0500] Cope: which is very nice code
[2013-11-15 20:52:52 -0500] Cope: more often than not I look at the chef src to find answers; in some ways it's better than the official docs :)
[2013-11-15 20:59:57 -0500] btm_: @opscode cookbook code review: join: https://plus.google.com/hangouts/_/76cpi84sqctec4m6pit1has90g, watch: http://youtu.be/eFA9TE70goA
[2013-11-15 21:11:49 -0500] pbpolar_: There's probably an FAQ for this somewhere... but what's the idiom for appending a value onto a list that's a node attribute?  I.e., to express this:
[2013-11-15 21:11:49 -0500] pbpolar_: node.override['authorization']['sudo']['groups'] << 'analysts'
[2013-11-15 21:12:32 -0500] pbpolar_: which I'm betting wouldn't work (but I'd be pleased if it does).
[2013-11-15 21:13:11 -0500] jbz: pbpolar_: if the attrib in question is an array, you should be able to push to it:
[2013-11-15 21:13:50 -0500] jbz: node['authorization']['sudo']['groups'].push("analysts")
[2013-11-15 21:14:00 -0500] jbz: disclaimer: I am no Rubyist.
[2013-11-15 21:14:37 -0500] jbz: I suspect having 'override' in there would break this, because that's a method? I think?
[2013-11-15 21:14:44 -0500] jbz: but see disclaimer. :-)
[2013-11-15 21:16:41 -0500] philsturgeon: I thought knife ssh -E stag foo would run commands only on any nodes with "stag" as an environment?
[2013-11-15 21:16:42 -0500] philsturgeon: knife ssh -E stag "role:api" "sudo chef-client -o kapture::deploy_api"
[2013-11-15 21:16:54 -0500] philsturgeon: that runs code on my "test" and "prod" api too, which is amazingly dangerous
[2013-11-15 21:17:06 -0500] coderanger: pbpolar_: Don't use arrays with chef node attributes
[2013-11-15 21:17:12 -0500] jbz: heh
[2013-11-15 21:17:17 -0500] jbz: listen to @coderanger
[2013-11-15 21:17:27 -0500] jbz: def. not me.
[2013-11-15 21:17:36 -0500] coderanger: It is asking for trouble
[2013-11-15 21:18:57 -0500] nektos: anyone have any recommended best practices/tools for doing change management with chef?  Specifically something that can track node/env/databag changes as a "changeset" and promote them upon approval?
[2013-11-15 21:19:28 -0500] coderanger: nektos: Search for "the berkshelf way"
[2013-11-15 21:21:36 -0500] timsmith1: any idea when the omnibus installer will support Mavericks?
[2013-11-15 21:21:52 -0500] coderanger: timsmith1: poke btm_ to update the omnitruck scripts
[2013-11-15 21:23:16 -0500] timsmith1: will do
[2013-11-15 21:23:19 -0500] timsmith1: it's a 1 line fix
[2013-11-15 21:23:34 -0500] timsmith1: is that in github or is that internal to opscode?
[2013-11-15 21:24:29 -0500] btm_: internal, I've already committed a fix, it just needs a deploy. lamont mentioned something about some PBIs related to the install.sh that I'll follow up with when I get a second.
[2013-11-15 21:25:02 -0500] timsmith1: PBI?
[2013-11-15 21:25:53 -0500] timsmith1: I'm about to blast an e-mail to my Devs to get them off chef 11 and I want to get them off gems too
[2013-11-15 21:25:53 -0500] timsmith1: but they're all on mavericks
[2013-11-15 21:26:23 -0500] btm_: product backlog item == PBI == the things that our engineers fix.
[2013-11-15 21:27:09 -0500] timsmith1: k
[2013-11-15 21:27:55 -0500] philsturgeon: guys, can anyone shine any light on my question?
[2013-11-15 21:28:24 -0500] philsturgeon: the fact that the -E switch is seemingly being ignored and running things on production servers when i specify -E stag is SCARY
[2013-11-15 21:29:47 -0500] dgarstang3: Is this syntactically correct? http://pastebin.com/NH4J1Cu3
[2013-11-15 21:30:06 -0500] dgarstang3: Cuz.. it complains "Cannot find a resource for e on ubuntu version 12.04"
[2013-11-15 21:30:35 -0500] jbz: Recuse?
[2013-11-15 21:30:36 -0500] jbz: should that be rescue?
[2013-11-15 21:30:48 -0500] dgarstang3: oops.
[2013-11-15 21:30:55 -0500] dgarstang3: hm interesting error message the
[2013-11-15 21:31:17 -0500] timsmith1: philsturgeon:  you have an example of the chef-client command syntax you're trying to use
[2013-11-15 21:31:20 -0500] timsmith1: and what version are you on?
[2013-11-15 21:31:33 -0500] Cope: pbpolar_: use hashes :)
[2013-11-15 21:31:34 -0500] philsturgeon: timsmith1: knife ssh -E stag "role:api" "sudo chef-client -o kapture::deploy_api"
[2013-11-15 21:31:51 -0500] philsturgeon: Chef: 11.4.4
[2013-11-15 21:32:18 -0500] timsmith1: I think what you want is this: knife ssh "chef_environment:stag AND role:api" "sudo chef-client -o kapture::deploy_api"
[2013-11-15 21:32:40 -0500] dgarstang3: fixed typo. same error. ugh
[2013-11-15 21:33:42 -0500] philsturgeon: timsmith1: I'll try that, but the -E is meant to work. if you do knife ssh help it says that.    -E, --environment ENVIRONMENT    Set the Chef environment
[2013-11-15 21:34:18 -0500] bean: dgarstang3: were you the one that was having the problem where vagrant wasn't provisioning when it was "up"ing?
[2013-11-15 21:34:19 -0500] timsmith1: I've always used -E on the chef-client, but when you're trying to do a search you want to use a single search string with AND
[2013-11-15 21:34:30 -0500] dgarstang3: bean: yah
[2013-11-15 21:34:36 -0500] bean: I just reproduced that
[2013-11-15 21:34:38 -0500] bean: weird
[2013-11-15 21:34:49 -0500] dgarstang3: bean: Woo!
[2013-11-15 21:36:34 -0500] Cope: recuse ?
[2013-11-15 21:36:34 -0500] Cope: ah you did the typo already
[2013-11-15 21:36:55 -0500] dgarstang3: Cope: fixed it, got the same error. Caught by Berksfile.lock yet again
[2013-11-15 21:37:56 -0500] philsturgeon: timsmith1: does this not seem like a bug to you? or something that needs to be clear in the docs?
[2013-11-15 21:38:14 -0500] timsmith1: seems like a help doc issue to me
[2013-11-15 21:38:16 -0500] philsturgeon: -E, --environment ENVIRONMENT  Set the Chef environment (BUT THIS IS TOTALLY IGNORED IF YOU USE OTHER ARGUMENTS!"
[2013-11-15 21:39:02 -0500] timsmith1: if you do a knife node list with -E would you get back just the nodes in that environment?
[2013-11-15 21:41:51 -0500] philsturgeon: timsmith1: looks that way
[2013-11-15 21:41:52 -0500] philsturgeon: yes
[2013-11-15 21:42:10 -0500] timsmith1: I've never actually tried that
[2013-11-15 21:42:22 -0500] timsmith1: seems like it probably doesn't work with search based commands
[2013-11-15 21:56:59 -0500] coderanger: Trolololol https://github.com/opscode-cookbooks/jenkins/blob/master/resources/node.rb#L36
[2013-11-15 22:09:27 -0500] cwj: heeeeh
[2013-11-15 22:11:33 -0500] philsturgeon: timsmith1: SOMEBODY MUST PAY!
[2013-11-15 22:11:33 -0500] philsturgeon: or something :D
[2013-11-15 22:11:51 -0500] dgarstang3: I'm reading http://dougireton.com/blog/2012/12/31/creating-an-lwrp/. How would I test this locally and get it working first without chef?
[2013-11-15 22:12:00 -0500] timsmith1: it would be really simple to figure out where in the chef code that help comes from
[2013-11-15 22:12:08 -0500] timsmith1: fix it to be something more appropriate
[2013-11-15 22:12:10 -0500] philsturgeon: timsmith1: not for me
[2013-11-15 22:12:16 -0500] philsturgeon: weeeeell maybe. I can read source
[2013-11-15 22:12:23 -0500] philsturgeon: find in folder on the string
[2013-11-15 22:12:32 -0500] dgarstang3: ie how do you test a provider locally ?
[2013-11-15 22:12:37 -0500] timsmith1: fixing strings is my kind of fix
[2013-11-15 22:12:40 -0500] timsmith1: find and replace
[2013-11-15 22:12:51 -0500] philsturgeon: thanks, I'll send a PR. I already have my set of stickers from them from the last time, so its time to earn them.
[2013-11-15 22:14:47 -0500] dgarstang3: no way to test a custom provider locally via ruby?
[2013-11-15 22:15:29 -0500] coderanger: dgarstang3: As with all resources, you can use the chef-shell
[2013-11-15 22:15:57 -0500] dgarstang3: coderanger: I was hoping to write it as a ruby function first to get it working.
[2013-11-15 22:16:13 -0500] coderanger: chef-shell is a full irb prompt at heart
[2013-11-15 22:16:19 -0500] dgarstang3: docs?
[2013-11-15 22:16:23 -0500] coderanger: Google
[2013-11-15 22:16:54 -0500] nektos: coderanger: just watched "the berkshelf way"...berkshelf == rad, but thats not exactly what I'm asking.  My question is more about chef in continuous delivery.  So I have my CI system continuously update attributes on my integration nodes as builds come out and rerun chef.  My problem is, how do I keep track of the "state" of the node(s) at a point in time when automated tests pass and then manually approve that "state" of the node attributes (or env attribut
[2013-11-15 22:17:02 -0500] dgarstang3: coderanger: "testing chef provider with chef-shell" doesn't yield a whole lot
[2013-11-15 22:18:22 -0500] coderanger: nektos: The idea is to not have any state on the nodes, manage everything in cookbooks and use environments as the gates on policy application
[2013-11-15 22:18:54 -0500] nektos: coderanger: so a new build we mean a new version of the cookbook?
[2013-11-15 22:19:15 -0500] coderanger: Yep
[2013-11-15 22:19:23 -0500] dgarstang3: ugh, docs on using chef shell to test provider are non existent. it's either write a provider to get list of physical disks, or use a data bag which has it's own set of issues. *sigh*
[2013-11-15 22:19:38 -0500] coderanger: nektos: Its not the only way to do it, but its probably the best documented one right now
[2013-11-15 22:20:55 -0500] nektos: coderanger: any tips on "automating" that?  seems like our CI (jenkins) would need to have a build job for the cookbook downstream from the application's build job?
[2013-11-15 22:21:31 -0500] dgarstang3: I wonder why opscode doesn't have any open positions for a documenter on their web site.
[2013-11-15 22:21:32 -0500] jmickle: hey coderanger how are you
[2013-11-15 22:21:35 -0500] jmickle: dgarstang3: you can try doing some vagrant testing
[2013-11-15 22:21:58 -0500] dgarstang3: jmickle: This is specific to gce and amazon. It doesn't test so well on vagrant.
[2013-11-15 22:22:07 -0500] coderanger: nektos: Ahh, app version info generally comes from an external source, data bags if you want something easy, preferably your own source of truth though
[2013-11-15 22:22:19 -0500] coderanger: nektos: Whatever you use to manage the process, just have chef hit that
[2013-11-15 22:22:23 -0500] jmickle: dgarstang even with the aws plugin?
[2013-11-15 22:22:37 -0500] coderanger: nektos: So if its jenkins, use the jenkins API to see what the latest passing build is
[2013-11-15 22:22:47 -0500] dgarstang3: jmickle: gce is the first priority, and ohai has issues in gce too
[2013-11-15 22:22:54 -0500] jmickle: got it
[2013-11-15 22:23:03 -0500] jmickle: welcome to dependency hell?
[2013-11-15 22:23:04 -0500] jmickle: ;-P
[2013-11-15 22:23:05 -0500] coderanger: nektos: Depends on how C you want your CD ;-)
[2013-11-15 22:24:22 -0500] nektos: coderanger: pushing that envelope now...5/day?  i think you put me in a good direction.  currently i'm storing app build numbers in databags...but seems i ought to use our repository (artifactory) for that....thanks!!
[2013-11-15 22:24:42 -0500] dgarstang3: lets try another approach. I'd like to be able to get a list of physical disks on a recipe based on some key. Instance doesn't doesn't work (long story). So, it'd be nice to key it off the role. That is, if I'm a syslog server, then these are the physical disks, but since a run list has multple roles in it, I dunno, seems not possible
[2013-11-15 22:25:04 -0500] coderanger: nektos: Thats the nice thing about having Ruby at your disposal, just talk to the actual source of truth about the info :)
[2013-11-15 22:25:34 -0500] Otterley: hey folks - I have built a LWRP that dispatches a :create notification to a cron_d resource, but the cron job never gets created
[2013-11-15 22:25:50 -0500] coderanger: Otterley: pastebin?
[2013-11-15 22:26:24 -0500] Otterley: @coderanger http://pastebin.com/m4Nb4hrw
[2013-11-15 22:26:43 -0500] coderanger: I mean of the code
[2013-11-15 22:27:20 -0500] dgarstang3: Wow. how come chef doesn't even have a wiki for docs?
[2013-11-15 22:27:38 -0500] Otterley: @coderanger http://pastebin.com/KWAs5ETR
[2013-11-15 22:30:05 -0500] coderanger: Otterley: so lines 19 and 27, those will never fire
[2013-11-15 22:30:27 -0500] coderanger: since you can't check updated? usefully until after the resource runs
[2013-11-15 22:30:28 -0500] Otterley: coderanger, is that relevant?
[2013-11-15 22:30:33 -0500] Otterley: I was following common patterns I've seen in other providers
[2013-11-15 22:31:09 -0500] coderanger: Where is the cron_d resource in question defined?
[2013-11-15 22:31:17 -0500] Otterley: by the cron cookbook
[2013-11-15 22:31:28 -0500] coderanger: no, I mean cron_d[holland_backup]
[2013-11-15 22:31:31 -0500] Otterley: oh
[2013-11-15 22:31:32 -0500] Otterley: sec
[2013-11-15 22:32:38 -0500] Otterley: same cookbook, default recipe: http://pastebin.com/3bGhhwbu
[2013-11-15 22:33:00 -0500] coderanger: Okay, and the provider isn't using use_inline_resources, right?
[2013-11-15 22:33:09 -0500] dgarstang3: I'm reading http://dougireton.com/blog/2012/12/31/creating-an-lwrp/ ... Where does the resource go? What's it called?
[2013-11-15 22:33:49 -0500] Otterley: coderanger, you mean my custom one?
[2013-11-15 22:34:06 -0500] coderanger: Otterley: yes
[2013-11-15 22:34:08 -0500] Otterley: no, it's not - and if I try, it causes other problem
[2013-11-15 22:34:16 -0500] coderanger: yeah, it would :)
[2013-11-15 22:35:06 -0500] coderanger: Otterley: it looks like it should work, do you see any notifications running at the end?
[2013-11-15 22:35:23 -0500] dgarstang3: I know you lot are sick of hearing this, but honestly, I think this is a fair question. Why are there no docs on writing a custom lwrp beyond the rather basic stuff on the opscode web site?
[2013-11-15 22:35:26 -0500] Otterley: yes, see the original log snippet
[2013-11-15 22:35:34 -0500] Otterley: it *says* the cron_d resource is being created, but no actual file results.
[2013-11-15 22:37:04 -0500] coderanger: Otterley: Hmmm, that all looks correct
[2013-11-15 22:37:04 -0500] Otterley: yeah.
[2013-11-15 22:37:11 -0500] Otterley: I'm willing to bet that if I substitute a file resource for the cron_d resource it will work.
[2013-11-15 22:37:24 -0500] coderanger: Try it and see :)
[2013-11-15 22:37:31 -0500] Otterley: will do, back in a few
[2013-11-15 22:39:20 -0500] dgarstang3: Are there any docs on writing custom lwrp's?
[2013-11-15 22:40:14 -0500] Otterley: dgarstang3, best to learn by example - take a look at the cron cookbook for an easy example
[2013-11-15 22:40:29 -0500] dgarstang3: Otterley: fair enough. oki
[2013-11-15 22:43:53 -0500] dgarstang3: The cron cookbook has resources/d.rb. ... and then it looks like they are calling it later with cron_d. Is that the convention?
[2013-11-15 22:46:57 -0500] Otterley: correct, dgarstang3 - the convention is cookbook name + resource name, separated by an underscore
[2013-11-15 22:47:10 -0500] dgarstang3: Otterley: wow. that's arbitrary
[2013-11-15 22:47:20 -0500] Otterley: well, you have to namespace the resources somehow
[2013-11-15 22:47:27 -0500] Otterley: seems like a reasonable way to prevent conflicts
[2013-11-15 22:49:42 -0500] dgarstang3: Otterley: Hm. Can a lwrp return data?
[2013-11-15 22:49:58 -0500] Otterley: hey coderanger, changing the resource to a file did, in fact, work
[2013-11-15 22:50:32 -0500] Otterley: dgarstang3, to what end?
[2013-11-15 22:50:32 -0500] coderanger: Otterley: Oh derp
[2013-11-15 22:50:37 -0500] coderanger: Otterley: cron_d is an old-school LWRP
[2013-11-15 22:50:42 -0500] dgarstang3: Otterley: to get a list of attached physical disks.
[2013-11-15 22:50:47 -0500] coderanger: Otterley: Change the notify to :immediately and it will work
[2013-11-15 22:51:12 -0500] Otterley: coderanger, what's the underlying difference?
[2013-11-15 22:51:22 -0500] dgarstang3: Otterley: Maybe I need an ohai plugin, but it's my understanding that ohai plugins data isn't available until after chef has run
[2013-11-15 22:51:48 -0500] coderanger: Otterley: Without use_inline_resource or poise's notifying_block it means that the create action is just adding to the resource_collection, but they get added after the run terminates
[2013-11-15 22:52:01 -0500] coderanger: Otterley: Basically most LWRPs are written incorrectly and you should stop using them :)
[2013-11-15 22:52:15 -0500] Otterley: coderanger, IOW, cron_d isn't using use_inline_resources like it should?
[2013-11-15 22:53:01 -0500] coderanger: Otterley: Yeah, but it has other issues, the whole thing is bad
[2013-11-15 22:53:19 -0500] Otterley: that's not very reassuring :/
[2013-11-15 22:54:02 -0500] coderanger: Otterley: Stay tuned for more info on my Poise rewrite-the-world campaign :) or sign up at poise.io and I'll email you when the docs are up
[2013-11-15 22:54:13 -0500] Otterley: what's poise?
[2013-11-15 22:54:41 -0500] coderanger: Otterley: Reusable cookbook patterns distilled to a cookbook, intro'd it at http://www.slideshare.net/coderanger/reusable-cookbook-patterns
[2013-11-15 22:54:46 -0500] coderanger: (at the summit)
[2013-11-15 22:55:33 -0500] dgarstang3: If I write an ohai plugin, can I access the results of the plugin on the same chef run?
[2013-11-15 22:56:06 -0500] Otterley: yeah, I missed the Summit, sadly - we had a global summit of our own here so I had to cancel at the last minute
[2013-11-15 22:56:32 -0500] Otterley: anyway, it looks promising from my skimming of the slides.  looking forward to seeing a working implementation
[2013-11-15 22:56:40 -0500] dgarstang3: 'Ohai plugins use a ruby DSL' ... does that mean ohai it's ruby or not?
[2013-11-15 22:56:52 -0500] Otterley: yes it's Ruby
[2013-11-15 22:57:17 -0500] Otterley: dgarstang3, if you're loading your Ohai plugin early, the results should be available in the node object immediately
[2013-11-15 22:57:19 -0500] dgarstang3: Otterley: k, and ... the million dollar question. Is the data returned from an ohai plugin available in the same chef run?
[2013-11-15 22:57:27 -0500] coderanger: Otterley: Cookbook is up at github.com/poise/poise
[2013-11-15 22:57:40 -0500] dgarstang3: Otterley: skeptical, but will test
[2013-11-15 22:58:04 -0500] coderanger: dgarstang3: http://docs.opscode.com/resource_ohai.html#actions
[2013-11-15 22:58:26 -0500] dgarstang3: so, a reload is required?
[2013-11-15 22:58:33 -0500] Otterley: yeah
[2013-11-15 22:58:36 -0500] Otterley: as noted.
[2013-11-15 23:00:07 -0500] coderanger: and as noted, is the default
[2013-11-15 23:00:57 -0500] dgarstang3: I must be mentally retarded or somethinh. https://wiki.opscode.com/display/ChefCN/Writing+Ohai+Plugins .... orly "yeah, rly." ... what the hell is orly? where was that defined previouly?
[2013-11-15 23:01:37 -0500] coderanger: dgarstang3: How did you even find that?
[2013-11-15 23:01:50 -0500] dgarstang3: coderanger: its at the top of that page
[2013-11-15 23:01:53 -0500] coderanger: ChefCN is a dead copy of the wiki (which itself is deprecated)
[2013-11-15 23:02:09 -0500] dgarstang3: coderanger: i googled ohai plugins
[2013-11-15 23:02:14 -0500] coderanger: It was an experiment at translating the wiki into chinese
[2013-11-15 23:02:34 -0500] dgarstang3: coderanger: Well, http://docs.opscode.com/ohai.html has the same content, namely where does orly come from?
[2013-11-15 23:02:56 -0500] coderanger: btm_: ^^ Can we delete the ChefCN workspace on the public wiki, its even more crazy out of date than the rest of the wiki
[2013-11-15 23:03:10 -0500] dgarstang3: That doc says run irb and do a require ohai, which gets me a 'LoadError: no such file to load -- ohai'
[2013-11-15 23:03:20 -0500] coderanger: dgarstang3: Its an arbitrary string tag
[2013-11-15 23:03:23 -0500] dgarstang3: i suspect something is missing from the docs. :)
[2013-11-15 23:03:39 -0500] dgarstang3: coderanger: it looks like an undefined function to me
[2013-11-15 23:04:43 -0500] dgarstang3: So, I google 'LoadError: no such file to load -- ohai' and google returns ONE document
[2013-11-15 23:04:58 -0500] dgarstang3: ... which is someone's pastie
[2013-11-15 23:05:47 -0500] dgarstang3: and they say the chef learning curve isn't steep. *sigh*
[2013-11-15 23:06:25 -0500] dgarstang3: "LoadError: no such file to load -- ohai" - y?
[2013-11-15 23:06:57 -0500] nathenharvey: dgarstang3: what doe "'LoadError: no such file to load" usually means when you see it in ruby?
[2013-11-15 23:07:04 -0500] nathenharvey: s/doe/does
[2013-11-15 23:07:13 -0500] dgarstang3: nathenharvey: I don't know. i'm just following http://docs.opscode.com/ohai.html
[2013-11-15 23:07:14 -0500] dtrott: sounds like file not found ...
[2013-11-15 23:07:55 -0500] nathenharvey: dgarstang3: interesting.  maybe a pr is needed on the docs.  how'd you solve it?
[2013-11-15 23:08:07 -0500] dgarstang3: nathenharvey: Um, I haven't.
[2013-11-15 23:09:43 -0500] dgarstang3: I don't know how hard this is supposed to be. Drop file in /etc/chef/ohai_plugins and rum irb. Type 'require 'ohai'' and get error
[2013-11-15 23:09:53 -0500] nathenharvey: dgarstang3: maybe get less specific with your google search and look for only 'LoadError: no such file to load'
[2013-11-15 23:11:04 -0500] dgarstang3: still dunno what an orly is
[2013-11-15 23:11:42 -0500] nathenharvey: dgarstang3: don't think that's important and sure it's not part of the error you are seeing.
[2013-11-15 23:12:12 -0500] dgarstang3: I can get the output of the plugin if I run ohai -d /etc/chef/ohai_plugins (also undocumented).
[2013-11-15 23:12:30 -0500] dgarstang3: But, I can't fathom how 'orly' translates into output
[2013-11-15 23:12:45 -0500] dgarstang3: looks like an undefined function to me
[2013-11-15 23:14:32 -0500] dgarstang3: can't fathom how arbitrary undefined literal 'orly' produces output.
[2013-11-15 23:16:03 -0500] dgarstang3: so arbitrary undefined literal means 'print what follows'?
[2013-11-15 23:16:33 -0500] nathenharvey: it's probably time to look at a more realistic example.  Could be a great oppt'y for a pr to the docs, too.
[2013-11-15 23:18:30 -0500] dgarstang3: so, if ohai is ruby, does that mean I can write a ruby script and put arbitrary undefined literals in there?
[2013-11-15 23:23:18 -0500] nathenharvey: dgarstang3: in ruby, 'puts' means print what follows.  I'm sure there are other was to do so, too.  but puts should work if that's what you're trying to do
[2013-11-15 23:24:10 -0500] dgarstang3: nathenharvey: nope. puts 'foo' gets me an ohai fact called "put": null
[2013-11-15 23:25:29 -0500] nathenharvey: in irb "puts 'foo'" will print foo, for sure
[2013-11-15 23:25:32 -0500] dgarstang3: actually, it gets me nothing
[2013-11-15 23:25:40 -0500] dgarstang3: this is ohai. zero docs. :)
[2013-11-15 23:26:21 -0500] dgarstang3: the docs say it's ruby. but in ruby undefined literals don't translate into output
[2013-11-15 23:26:41 -0500] nathenharvey: there are docs for ohai.  I don't know that they're clear.  I PM'd you asking for your address as I have some older training slides on writing ohai plugins that I could share with you.
[2013-11-15 23:27:04 -0500] nathenharvey: dgarstang3: when you open irb and run "puts 'foo'" you get nothing?
[2013-11-15 23:27:08 -0500] dgarstang3: nathenharvey: oh, didn't get that. Funny
[2013-11-15 23:27:20 -0500] dgarstang3: nathenharvey: No... this is in an ohai plugin
[2013-11-15 23:27:56 -0500] dgarstang3: nathenharvey: http://pastebin.com/MAb3hzma
[2013-11-15 23:27:59 -0500] nathenharvey: oh, guess I didn't understand the question
[2013-11-15 23:28:31 -0500] dgarstang3: no worries
[2013-11-15 23:28:33 -0500] nathenharvey: got it.  I'm on a plane so it might take a minute to send
[2013-11-15 23:34:43 -0500] nathenharvey: dgarstang3: those slides I just sent provide a more realistic example.  Please give them a try and see how that goes for you.
[2013-11-15 23:35:04 -0500] nathenharvey: dgarstang3: Would love to see a PR to https://github.com/opscode/chef-docs to help clarify the ohai plugin writing section.  Sounds like an awesome way to give back!
[2013-11-15 23:35:42 -0500] thekev: ^do it, doug :)
[2013-11-15 23:35:53 -0500] thekev: (when coming up for air)
[2013-11-15 23:36:03 -0500] dgarstang3: thekev: *squinty eye*
[2013-11-15 23:36:31 -0500] dgarstang3: nathenharvey: Thanks. Will eyeball.
[2013-11-15 23:37:04 -0500] nathenharvey: dgarstang3: hope you'll do more than that ;)  give the lab a go
[2013-11-15 23:46:08 -0500] timsmith1: anyone know if you can install omnibus when you're on a chroot environment?
