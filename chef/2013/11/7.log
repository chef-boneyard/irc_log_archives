[2013-11-07 00:01:43 -0500] cannonball: I added  to an attributes/default.rb file:  puts "DEBUG: node name is " . node[:name]     But it complains:    undefined method `node' for "DEBUG: node name is ":String
[2013-11-07 00:02:06 -0500] cannonball: I don't quite understand what it's saying is wrong.  Can I get a hint?  A url is most welcome.
[2013-11-07 00:02:09 -0500] miah: because your ruby is invalid.
[2013-11-07 00:02:35 -0500] miah: try, puts "DEBUG: node name is #{ node[:name] }"
[2013-11-07 00:02:48 -0500] cannonball: will try, thanks.
[2013-11-07 00:03:08 -0500] miah: url: https://en.wikibooks.org/wiki/Ruby_Programming/Syntax/Literals
[2013-11-07 00:03:24 -0500] miah: though, fwiw. putting that in an attribute file is really the wrong place
[2013-11-07 00:05:12 -0500] cannonball: miah: It printed out that variable was blank.  So I must be accessing the wrong variable name for the node name.  But I also think in the attributes file is the wrong place.  I haven't figured out where is the right place.
[2013-11-07 00:05:34 -0500] cannonball: We have a few dev machines in the office which need resolv.conf one way, then a lot of machines elsewhere that need it another way.
[2013-11-07 00:06:29 -0500] chip-: cannonball: node.name & node.chef_environment are special, and must be accessed as methods instead of attributes.
[2013-11-07 00:06:47 -0500] cannonball: hmmmmm
[2013-11-07 00:06:49 -0500] chip-: Attributes file is the wrong place. Put it in a recipe instead.
[2013-11-07 00:06:54 -0500] cannonball: ok
[2013-11-07 00:07:16 -0500] chip-: afk
[2013-11-07 00:24:09 -0500] coderanger: miah: Have you played with chefspec much?
[2013-11-07 00:25:29 -0500] coderanger: Trying to figure out how to use it to test my new helper cookbook
[2013-11-07 00:25:40 -0500] coderanger: which has no recipes >_<
[2013-11-07 00:25:50 -0500] coderanger: I think I need to make a bunch of test cookbooks, that makes sense
[2013-11-07 00:36:04 -0500] miah: no, i just use minitest because rspec == soooo magical
[2013-11-07 00:36:31 -0500] miah: i have a really hard time using software i dont understand
[2013-11-07 00:38:31 -0500] coderanger: miah: Does that require a real converge?
[2013-11-07 00:38:42 -0500] miah: no
[2013-11-07 00:39:02 -0500] miah: you're basically testing class instance methods
[2013-11-07 00:47:09 -0500] coderanger: miah: No, I'm testing mixin modules and their various interactions
[2013-11-07 00:48:21 -0500] daos: weird issue... occasionally my `knife bootstrap` will finish running on a node without any errors (presumably the node is all good) but when i do `knife node show NODE` the run list is empty (as if the bootstrap had failed)
[2013-11-07 00:48:29 -0500] daos: anyone see this before
[2013-11-07 00:48:30 -0500] daos: ?
[2013-11-07 00:56:44 -0500] coderanger: miah: How are you doing minitest without a cnvergence?
[2013-11-07 00:59:40 -0500] dopacki: I think I'm a bit confused on attribute persistence. I'm trying to trigger an "apt-get upgrade" on the next chef run, by setting a normal attribute on the node (via knife exec).
[2013-11-07 00:59:42 -0500] dopacki: http://pastebin.com/xTJLaiMJ
[2013-11-07 01:00:18 -0500] dopacki: the apt-get upgrade triggers as expected, but the recipe isn't able to reset the value of the upgrade attribute. what am I doing wrong?
[2013-11-07 01:00:40 -0500] coderanger: dopacki: Ordering issue probably
[2013-11-07 01:00:47 -0500] dopacki: here's how I set the upgrade flag on a box - knife exec -E 'nodes.find("name:servername") {|n| n.normal.upgrade="1"; n.save}'
[2013-11-07 01:00:56 -0500] coderanger: dopacki: wrap the reset bit in a ruby_block
[2013-11-07 01:01:26 -0500] coderanger: dopacki: Also I think we played a few games of Diablo 3 together :-)
[2013-11-07 01:01:31 -0500] coderanger: so ::waves::
[2013-11-07 01:01:50 -0500] dopacki: hmm.. I can see that if the upgrade wasn't being triggered
[2013-11-07 01:02:08 -0500] dopacki: it is just that the value isn't being reset to zero afterwards.
[2013-11-07 01:02:17 -0500] dopacki: ok. let me try a ruby block anyways
[2013-11-07 01:05:30 -0500] dopacki: bummer. ruby block didn't seem to help
[2013-11-07 01:06:28 -0500] dopacki: lol. omg, I'm so retarded. node.set['upgrade'] == "0"  <-- should be '=', not '=='
[2013-11-07 01:06:36 -0500] dopacki: I think it is time to call it a day
[2013-11-07 01:06:59 -0500] dopacki: apparently I'm blind
[2013-11-07 01:07:24 -0500] coderanger: dopacki: trololol
[2013-11-07 01:07:48 -0500] coderanger: dopacki: You'll still probably want the ruby block since otherwise the reset will happen before the onlyif is checked I think :)
[2013-11-07 01:07:59 -0500] dopacki: maybe. :)
[2013-11-07 01:08:01 -0500] coderanger: guard blocks are run right before the action would execute
[2013-11-07 01:08:14 -0500] dopacki: I'm familiar with the convergence phase of chef
[2013-11-07 01:08:39 -0500] dopacki: but ruby_block certainly doesn't hurt
[2013-11-07 01:13:52 -0500] Majost: I have a really basic question regarding chefspec -- which doesn't seem to be answered outright anywhere
[2013-11-07 01:14:42 -0500] Majost: 1) Where does it go. 2) Does the name of the spec files matter in terms of functionality.
[2013-11-07 01:15:14 -0500] Majost: I am looking at Seth's blog post: http://sethvargo.com/chefspec
[2013-11-07 01:15:22 -0500] Majost: and it says what to put
[2013-11-07 01:15:28 -0500] Majost: but not specifically where
[2013-11-07 01:16:05 -0500] Majost: I suppose that is more the actual project page then a post
[2013-11-07 01:16:09 -0500] Majost: heh
[2013-11-07 03:21:50 -0500] joe__: hi is there a chef resource to create a windows_service?
[2013-11-07 03:59:41 -0500] xpe: I'm trying to remember the basic `bundle exec` command to reconverge a node
[2013-11-07 03:59:58 -0500] xpe: and wondering why it is so hard to find via Google
[2013-11-07 04:00:14 -0500] coderanger: xpe: chef-client?
[2013-11-07 04:00:28 -0500] xpe: oops `bundle exec knife exec` I meant
[2013-11-07 04:00:50 -0500] xpe: @coderanger yes, chef-client is it, I think
[2013-11-07 04:01:26 -0500] xpe: I'm iterating on a cookbook until I get it right, so need to manually run
[2013-11-07 04:01:53 -0500] coderanger: knife exec is for running little API scripts, not related to cookbooks
[2013-11-07 04:02:06 -0500] coderanger: Do you mean vagrant provision?
[2013-11-07 04:02:15 -0500] coderanger: (which you wouldn't use with bundler)
[2013-11-07 04:02:18 -0500] xpe: @coderanger no, vagrant is not involved
[2013-11-07 04:02:29 -0500] xpe: I thought there was an easy way to try the run_list again
[2013-11-07 04:03:36 -0500] coderanger: Without more information about what you are doing, its hard to say
[2013-11-07 04:03:54 -0500] xpe: @coderanger I am working on a new cookbook
[2013-11-07 04:04:01 -0500] xpe: but I haven't got it right yet
[2013-11-07 04:04:13 -0500] xpe: so I want to re-run it on a machine
[2013-11-07 04:04:23 -0500] coderanger: Yes, but how are you using chef, solo, server, etc
[2013-11-07 04:04:44 -0500] xpe: @coderanger oh. i'm using a chef-server that I have running on Linode
[2013-11-07 04:04:58 -0500] coderanger: So you want to SSH to the node in question and just run chef-client
[2013-11-07 04:05:04 -0500] coderanger: you can use knife ssh for that
[2013-11-07 04:05:07 -0500] coderanger: or just do it yourself
[2013-11-07 04:05:17 -0500] xpe: @coderanger ok, thanks
[2013-11-07 04:05:21 -0500] xpe: much appreciated
[2013-11-07 04:06:15 -0500] xpe: knife exec was a false lead
[2013-11-07 04:07:03 -0500] coderanger: but really for local dev, use vagrant :)
[2013-11-07 04:41:20 -0500] xpe: @coderanger: yeah, I should use Vagrant to speed up the cookbook tweaking, but for now, this is where I am
[2013-11-07 05:39:10 -0500] scottstamp: Hey there, I just deployed a Chef Server on one of my VMs, but I can't seem to access the WebUI. It's on port 443, correct?
[2013-11-07 05:40:09 -0500] scottstamp: Oh, never mind, it works when I don't change the external port. Weird.
[2013-11-07 06:15:44 -0500] manfred: ok, so I am experiencing some werid behavior. I have written a small lsyncd cookbook, and it is working well, i am using a .each loop to create each of the sync rules in /etc/lsycnd/lsyncd.conf.lua , the problem is, when i spin up my slave devices, i can see them in knife search 'role:web-slave' as soon as they finish bootstrapping, but if i use the search(:node, 'role:web-slave').each in a recipe, they refuse
[2013-11-07 06:15:47 -0500] manfred: to appear until the first time they have synced (not including the sync at the end of the bootstrap), any ideas?
[2013-11-07 06:18:35 -0500] programmerq: so, I'm using the opscode jenkins cookbook. This makes the assumption that my jenkins user's $HOME should be the same as my $JENKINS_HOME. my setup requires that they be different (yes, arbitrary and stupid I know). My question is how would I override the home directory of the jenkins user inside my own glue cookbook?
[2013-11-07 06:19:12 -0500] programmerq: I've tried defining it and setting home there, but it ends up running usermod twice in my chef run-- one for the jenkins::server recipe and one for mine.
[2013-11-07 06:20:06 -0500] programmerq: I've also tried doing resources("user[jenkins]").home = '/foo' but I get: undefined method `home=' for Chef::Resource::User
[2013-11-07 06:20:12 -0500] programmerq: any hints or ideas?
[2013-11-07 06:23:51 -0500] programmerq: manfred: this is a common problem. You could put the sync roles in your node files so the info you need to search is available as soon as you 'knife node from file'. You could also make the info appear a little sooner in the run by calling node.save early on. it doesn't eliminate the problem, but you don't have to wait until the very end of the chef run.
[2013-11-07 06:24:35 -0500] manfred: ahh ok
[2013-11-07 06:24:38 -0500] manfred: thanks
[2013-11-07 06:25:01 -0500] programmerq: manfred: we ended up doing the node.save
[2013-11-07 06:34:52 -0500] manfred: I will have to look into that in the morning
[2013-11-07 06:34:55 -0500] manfred: thanks
[2013-11-07 07:23:37 -0500] mrhjkim: does chef support cvs repository?
[2013-11-07 07:23:50 -0500] mrhjkim: I can't find any resource for cvs.
[2013-11-07 07:25:12 -0500] flaccid_: hmm, not sure. i'm kind of doubting it
[2013-11-07 07:25:54 -0500] programmerq: mrhjkim: yeah, it doesn't look good. all I found was an unanswered question: http://community.opscode.com/questions/52
[2013-11-07 07:26:02 -0500] flaccid_: mrhjkim: google showed me this though https://github.com/glensc/chef-cookbook-cvs
[2013-11-07 07:26:36 -0500] flaccid_: cvs is ancient
[2013-11-07 07:27:49 -0500] mrhjkim: thanks for information. I will try that cookbook
[2013-11-07 07:30:40 -0500] flaccid_: ack
[2013-11-07 08:19:55 -0500] glen: what could be the reasons why bootstrab says signature verification error on on particular host
[2013-11-07 08:20:04 -0500] glen: staff.delfi.lan Failed to authenticate to the chef server (http 401).
[2013-11-07 08:24:18 -0500] glen: http://sprunge.us/SLIQ
[2013-11-07 08:24:22 -0500] Stefan____: Is it better to have each node check in periodically or run recipes manually each time?
[2013-11-07 08:28:01 -0500] Stefan____: Right now I have nodes checking in every 3 minutes and sending an email report if something changes but sometimes wenn recipes fail the chef handler never send the mail. :/ How do you guys manage and check many nodes?
[2013-11-07 08:42:17 -0500] isbaran: Stefan____: install a handler ?
[2013-11-07 08:42:41 -0500] isbaran: see Chef::Handler, you can create a custom one for you situation
[2013-11-07 08:46:44 -0500] Stefan____: isbaran: I am using it and it sends me an email after a failed run, aren't there any central chef management solutions out there or an add-on for the web panel that gives you info on what was run, version etc?
[2013-11-07 08:47:17 -0500] isbaran: Stefan____: i'm not aware of any
[2013-11-07 08:47:53 -0500] isbaran: i'm using nagios and didn't need additional tools
[2013-11-07 08:48:27 -0500] isbaran: handler reports when chef-client fails, also when there are updated resources
[2013-11-07 08:48:35 -0500] isbaran: so it works fine for me
[2013-11-07 08:52:43 -0500] glen: isbaran: how exactly are you using nagios there?
[2013-11-07 09:00:07 -0500] isbaran: glen: handler is sending events to nagios, in this situation with a message ( fail or update )
[2013-11-07 09:01:19 -0500] isbaran: chef-client runs every x minutes, if nagios didn't hear from a node in x minutes, it alerts a chef-client run failure
[2013-11-07 09:02:26 -0500] bcave: morning all
[2013-11-07 09:04:21 -0500] Stefan____: good morning
[2013-11-07 09:16:18 -0500] bcave: General question: What test frameworks (TDD) are you using with chef? I've seen chefspec and food critic, and just came across cucumber
[2013-11-07 09:23:45 -0500] glen: isbaran: so you have passive monitoring there?
[2013-11-07 09:24:27 -0500] isbaran: glen: yes
[2013-11-07 09:37:49 -0500] Cope: bcave: I use cucumber, serverspec+test kitchen, chefspec, foodcritic
[2013-11-07 09:42:47 -0500] w3s_8ths: Did anyone ever come accross URI::InvalidURIError when trying to upload cookbooks with knife cookbook upload ? It seems that cookbook_uploader.rb doesn't parse the server URL and strips of the URL just letting https://:443/. Any idea what goes wrong ?
[2013-11-07 09:44:39 -0500] glen: damn how can the sig be bad when bootstrapping
[2013-11-07 09:44:40 -0500] glen: 2013-11-07T09:44:19Z erchef@127.0.0.1 INFO req_id=NDOymNxPh3htoMpFO/ywtQ==; status=401; method=POST; path=/clients; user=chef-validator; msg=bad_sig; req_time=6; rdbms_time=2; rdbms_count=1
[2013-11-07 09:56:42 -0500] bcave: thanks Cope. so cucumber and kitchen for integration
[2013-11-07 09:56:54 -0500] bcave: chefspec for unit testing and food critic for syntax / lint?
[2013-11-07 09:58:08 -0500] Cope: bcave: I view it as: cucumber for acceptance tests; serverspec for integration tests; chefspec for unit tests; foodcritic for linting.
[2013-11-07 10:00:35 -0500] bcave: Thanks, that makes sense. Kicking off with chefspec.
[2013-11-07 10:01:54 -0500] bcave: Hope you don't mind if I bug you over the next while :D
[2013-11-07 10:16:28 -0500] Cope: please do
[2013-11-07 10:53:21 -0500] bcave: 1st question incoming: If I'm testing a role, is there a way to test (chefspec) that recipes are included in a specific order?
[2013-11-07 10:55:20 -0500] bcave: erm.. actually... i think that's out of the scope of unit testing
[2013-11-07 10:55:49 -0500] bcave: that should probably be handled by acceptance / integration tests
[2013-11-07 10:55:59 -0500] bcave: question retracted
[2013-11-07 11:18:43 -0500] bcave: how do you organize your testing? I have a chef repo with a number of cookbooks and roles in it. I have a recipe-specific tests in cookbooks/spec/default_spec.rb,  and thinking to create roles/spec/somerole_spec.rb
[2013-11-07 11:22:42 -0500] Jamin: Good m00ning
[2013-11-07 11:38:42 -0500] Cope: bcave: let(:chef_run) { ChefSpec::Runner.new.converge('role[something]') }
[2013-11-07 11:38:55 -0500] Cope: expect(chef_run).to
[2013-11-07 11:39:03 -0500] Cope: and then you can specify the exact array
[2013-11-07 11:39:26 -0500] Cope: maybe
[2013-11-07 11:39:41 -0500] Cope: you can certainly do include_recipe() as a matcher
[2013-11-07 11:40:27 -0500] Cope: I would test roles externally
[2013-11-07 11:40:50 -0500] Cope: as in, i would think of the role as fulfilling a contract with the consumer of the role
[2013-11-07 11:41:02 -0500] Cope: and write an acceptance test for it
[2013-11-07 11:41:19 -0500] Cope: I don't think I would use chefspec to test roles
[2013-11-07 11:41:29 -0500] Cope: chefspec is cookbook-centric
[2013-11-07 11:51:18 -0500] holms: help?
[2013-11-07 11:51:18 -0500] holms: holms@roman:~/chef-repo$ knife cookbook upload -a
[2013-11-07 11:51:18 -0500] holms: ERROR: The data in your request was invalid
[2013-11-07 11:51:19 -0500] holms: Response: Bad checksums!
[2013-11-07 11:51:41 -0500] dmdeklerk: ALT+Printscreen+C ;-)
[2013-11-07 11:51:59 -0500] holms: dmdeklerk: i'm not using crappy ubuntu
[2013-11-07 11:51:59 -0500] holms: :)
[2013-11-07 11:52:25 -0500] holms: dmdeklerk: btw where you've heard about this :)?
[2013-11-07 11:52:49 -0500] holms: i've posted about this on hacker news recently
[2013-11-07 11:53:19 -0500] dmdeklerk: yeah I had that before, it was in my early chef days (like a few weeks ago) not sure what the sollution was.
[2013-11-07 11:53:20 -0500] bcave: Cope: yeah, I have that, I'm just wondering how to organize it in my chef workspace. I think it makes logical sense to put it in a "spec" subdirectory in "roles"
[2013-11-07 11:53:42 -0500] holms: trying librarian-chef clean
[2013-11-07 11:53:43 -0500] bcave: Using my role spec, the run fails, moaning about not being able to find the role, so busy debugging that.
[2013-11-07 11:54:09 -0500] bcave: oh - never mind, i just saw your "cookbook-centric" comment.
[2013-11-07 11:54:46 -0500] dmdeklerk: holms: try running that with -VV argument
[2013-11-07 11:55:39 -0500] holms: dmdeklerk: http://p.defau.lt/?8dLFVVJ2Q08THBsavHAF_Q
[2013-11-07 11:56:47 -0500] holms: i've only did knife init before
[2013-11-07 11:58:56 -0500] dmdeklerk: holms: Seems like your running your own chef-server at 10.49.118.164:443/cookbooks? cant help you there, never done that before sorry.
[2013-11-07 12:01:05 -0500] holms: lol
[2013-11-07 12:01:11 -0500] holms: default docs proposes to have chef-server vm
[2013-11-07 12:01:14 -0500] holms: your workstation and
[2013-11-07 12:01:25 -0500] holms: chef-client vm (or that one which you want to provision)
[2013-11-07 12:01:30 -0500] holms: what's wrnog with that/ :D
[2013-11-07 12:02:25 -0500] dmdeklerk: Just for clarity, are you running your own chef-server or is that opscode at 10.49.118.164 ?
[2013-11-07 12:02:46 -0500] holms: my own
[2013-11-07 12:02:48 -0500] holms: opensource chef
[2013-11-07 12:02:59 -0500] holms: why you need to depend on somebody else?
[2013-11-07 12:04:44 -0500] dmdeklerk: I agree. Wish they were cheaper. Right now I have only a handfull of nodes but production will be running 100+ nodes. Not sure if I want to that for what they are asking.
[2013-11-07 12:05:14 -0500] holms: we running 2000 nodes, just trying to learn stuff
[2013-11-07 12:05:36 -0500] dmdeklerk: cool
[2013-11-07 12:06:10 -0500] holms: i think i know what's the problem
[2013-11-07 12:06:23 -0500] holms: it tries to connect through http
[2013-11-07 12:06:28 -0500] holms: and by default it's https actually..
[2013-11-07 12:06:37 -0500] dmdeklerk: That could be it. Heard that before!
[2013-11-07 12:07:21 -0500] holms: k i'll start fresh 3rd time..
[2013-11-07 12:07:24 -0500] holms: http://railsware.com/blog/2013/04/19/getting-started-with-chef-server-part-1/ seems to be legit
[2013-11-07 12:08:45 -0500] dmdeklerk: cool add that to my favorites
[2013-11-07 12:10:58 -0500] ocholetras: any celan pattern to add header to template config files from community cookbooks without to copy entire template and modify the resource to get the new one from my wraper cookbook?
[2013-11-07 12:11:24 -0500] ocholetras: copy entire file to change only 1 line sounds like.. wtf?
[2013-11-07 12:20:54 -0500] ocholetras: hello world'
[2013-11-07 12:20:56 -0500] ocholetras: ?
[2013-11-07 12:20:57 -0500] ocholetras: xd
[2013-11-07 12:49:39 -0500] stevedomin: hello guys. I'm updating our chef setup to follow best practices, abandoning the single massive repo and splitting each cookbook into its own github repo and having a chef-data repo containing environments, roles, etc.
[2013-11-07 12:50:49 -0500] stevedomin: Are people using git submodules to still have cookbooks in the chef-repo folder?
[2013-11-07 12:56:55 -0500] zaargy: stevedomin: git submodule workflow is quite confusing
[2013-11-07 12:57:01 -0500] zaargy: you mihgt want to look at librarian-chef
[2013-11-07 12:57:09 -0500] zaargy: or berkshelf
[2013-11-07 12:58:28 -0500] holms: yeah, and my personal advice, with chef-server go only with berkshelf, or yuo gonna have a *bad* time
[2013-11-07 13:08:36 -0500] jbaptiste: Hi guys. We're actually deploying update on push for some of our apps by using a knife --override-run-list on a certain role, by using git-hook.
[2013-11-07 13:09:01 -0500] jbaptiste: Kinda feel that's the wrong way to do it, does anyone have a suggestion ?
[2013-11-07 13:38:42 -0500] hildgrim: Hello. Any reason the not_if in this one wouldn't work? http://pastebin.com/FUb8XmSJ
[2013-11-07 13:40:46 -0500] gchristensen: hildgrim: why do you have the .* wrapping hte replace_string?
[2013-11-07 13:41:14 -0500] hildgrim: gchristensen: just so that it would grep for anythingreplacestringanything
[2013-11-07 13:41:29 -0500] hildgrim: i tried without, no luck either
[2013-11-07 13:41:29 -0500] gchristensen: it doesn't need it, its already going to look inside words
[2013-11-07 13:41:35 -0500] hildgrim: hm
[2013-11-07 13:42:36 -0500] gchristensen: hildgrim: if you run that command manually, what does it do?
[2013-11-07 13:42:44 -0500] gchristensen: run grep .*replace_string.* /home/tomcat/bin/startup.sh; echo $?
[2013-11-07 13:43:55 -0500] hildgrim: t[root@test bin]# grep .*replace_string.* /home/tomcat/bin/startup.sh ; echo $?
[2013-11-07 13:43:56 -0500] hildgrim: export JAVA_OPTS="-server -Xms1280m -Xmx1280m -XX:PermSize=128m -XX:MaxPermSize=256m -javaagent:/usr/local/replace_string -Dtomcat_root=/home/tomcat"
[2013-11-07 13:43:58 -0500] hildgrim: 0
[2013-11-07 13:44:04 -0500] hildgrim: woops sorry
[2013-11-07 13:44:07 -0500] hildgrim: but yeah, 0
[2013-11-07 13:44:56 -0500] gchristensen: hildgrim: oh, you want only_if -- you only want to run if matches are found, and grep returns success only if it finds things.
[2013-11-07 13:45:06 -0500] hildgrim: oh damn haha, thanks
[2013-11-07 13:45:31 -0500] gchristensen: :) you're welcome
[2013-11-07 13:46:41 -0500] gchristensen: lol
[2013-11-07 13:47:25 -0500] hildgrim: A+++ would ask again ;)
[2013-11-07 13:51:38 -0500] stevedomin: zaargy: thanks for the answer
[2013-11-07 14:09:54 -0500] bcave: Cope - how do you deploy & test your integration tests? Does it run on a vagrant box?
[2013-11-07 14:13:27 -0500] stevedomin: is it a common practice to have one chef server per environment (prod, staging, etc.) ?
[2013-11-07 14:18:51 -0500] Stefan____: Is there a way to get the version of the recipe that was run on a node? or do I have to check what version is permitted to run in the environment the node is in?
[2013-11-07 14:35:45 -0500] jloucks: We are currently looking into purchasing enterprise chef. One of our goals is to be able to do farm switchovers on our ACE load balancer with a single click, preferably from a web interface. Is this something that Chef could do?
[2013-11-07 14:35:47 -0500] Cope: bcave: integration tests run with test-kitchen
[2013-11-07 14:36:00 -0500] Cope: bcave: depending on the driver, ec2 / lxc / vagrant / whatever
[2013-11-07 14:40:31 -0500] fveillette: Hi
[2013-11-07 14:40:42 -0500] fveillette: does someone can help me with registry_key ressource
[2013-11-07 14:41:18 -0500] fveillette: when i set action to create_if_missing, if the key exist but one of it's value is not correct... the chef run don't change it
[2013-11-07 14:47:12 -0500] Jaminda: Stefan____: no easy way I know of. Just check contraints defined in environments and cookbooks
[2013-11-07 14:47:39 -0500] Jaminda: You can see which version has run on each server by checking metadata in the cached cookbook on each node
[2013-11-07 14:49:05 -0500] Stefan____: Jaminda: that seems like a pain. Does the enterprise version provide more info on what was run on a node and logging?
[2013-11-07 14:49:31 -0500] Jaminda: not afaik
[2013-11-07 14:49:54 -0500] Jaminda: must be something more in ohai info tho :P
[2013-11-07 14:50:42 -0500] bryanl: chef seems to buffer output when running under chef. is that a vagrant or a chef issue?
[2013-11-07 15:18:50 -0500] fveillette: does someone can help me with registry_key ressource
[2013-11-07 15:18:51 -0500] fveillette: when i set action to create_if_missing, if the key exist but one of it's value is not correct... the chef run don't change it
[2013-11-07 15:37:44 -0500] bcave: thanks cope
[2013-11-07 15:41:25 -0500] cannonball: If I have a cookbook foo/recipes/dns.rb, and I add to my run_list  'recipe[foo:dns]', does chef look for attributes in foo/attributes/default.rb or foo/attributes/foo.rb?
[2013-11-07 15:41:32 -0500] ingerul9: hi
[2013-11-07 15:41:46 -0500] cannonball: oops, that's supposed to be recipe[foo::dns].
[2013-11-07 15:41:59 -0500] ingerul9: who can I ask about a command from chef?
[2013-11-07 15:42:14 -0500] cannonball: Just ask and someone will answer if they know it.
[2013-11-07 15:42:39 -0500] ingerul9: so when I try to run the command from the tutorial
[2013-11-07 15:42:46 -0500] ingerul9: knife cookbook upload apache
[2013-11-07 15:42:49 -0500] ingerul9: I get an error like this
[2013-11-07 15:42:59 -0500] ingerul9: FATAL: ruby: No such file or directory -- D:/documente/work (LoadError)
[2013-11-07 15:43:29 -0500] ingerul9: and also FATAL: Cookbook file default.rb has a ruby syntax error:
[2013-11-07 15:43:59 -0500] ingerul9: from the questions answered about this issue they said to correct in the metadata.rb file
[2013-11-07 15:44:05 -0500] ingerul9: and I found it but I don't know what to modify
[2013-11-07 15:44:30 -0500] phantasm66: @ingerul9: check your cookbook_path in knife.rb
[2013-11-07 15:44:51 -0500] cannonball: It should tell you after that what line it thinks the syntax error is in.
[2013-11-07 15:45:27 -0500] ingerul9: you mean like this? cookbook_path            ["#{current_dir}/../cookbooks"]
[2013-11-07 15:45:42 -0500] ingerul9: I need to modify the current directory
[2013-11-07 15:45:45 -0500] ingerul9: ?
[2013-11-07 15:46:39 -0500] fveillette: does someone can help me with registry_key ressource
[2013-11-07 15:46:43 -0500] fveillette: when i set action to create_if_missing, if the key exist but one of it's value is not correct... the chef run don't change it
[2013-11-07 15:49:25 -0500] phantasm66: @ingerul9: read this chef bug ticket - https://tickets.opscode.com/browse/CHEF-2809
[2013-11-07 15:51:48 -0500] cpuguy83: fveillette: That's the point of create_if_missing
[2013-11-07 15:52:14 -0500] phantasm66: @ingerul9: you can verify that is your problem by changing knife.rb's cookbook_path to the absolute path of where your cookbooks live
[2013-11-07 15:52:19 -0500] Jaminda: fveillette: was about to say can you use a different action here
[2013-11-07 15:52:20 -0500] fveillette: but i thought it will be enough logic to check also the value set to the key
[2013-11-07 15:52:58 -0500] fveillette: i use registry_key to create and maintain the config of my syslog agent
[2013-11-07 15:53:14 -0500] fveillette: if a value change i want to update the registry with the value in chef
[2013-11-07 15:53:22 -0500] fveillette: and i notifies a service resources too
[2013-11-07 15:53:55 -0500] fveillette: if i put create on my registry_key resource the value get updated but my serlvice are alway restarted
[2013-11-07 15:54:00 -0500] fveillette: i don't want that :)
[2013-11-07 15:54:36 -0500] fveillette: i can do a workarount in powershell... but i thought registry_key was a cleaner way to address registry config
[2013-11-07 15:54:54 -0500] fveillette: i try to be more ruby oriented as possible
[2013-11-07 15:59:33 -0500] cpuguy83: fveillette: create_if_missing is going to do just that.  If the key is there it's not going to touch it.  If you want it to also update the key you should get rid of that option
[2013-11-07 16:03:19 -0500] kraM: Hi there. Even if I really like the diff output when deploying a template; is there a way to get rid of that output? From the resource documentation I don't see any attribute which might do the trick.
[2013-11-07 16:03:26 -0500] Jaminda: fveillette: let us know if removing that action has the desired effect :)
[2013-11-07 16:36:32 -0500] ryanschwartz: Hi all - I have a template for apache config, with this in it: "Header always add Served-By <%= @node[:fqdn] %>" but during a chef-client run, @node[:fqdn] is returned as blank. Help?
[2013-11-07 16:37:17 -0500] ryanschwartz: I was under the impression that 'fqdn' was an automatic attribute after reading http://docs.opscode.com/chef_overview_attributes.html
[2013-11-07 16:38:06 -0500] fveillette: Jaminda?
[2013-11-07 16:41:05 -0500] ryanschwartz: I'm on chef-client 11.4.0 and ohai 6.16.0
[2013-11-07 16:43:02 -0500] fveillette: @ryanschwartz you should pass your fqdn to your ressource template
[2013-11-07 16:43:06 -0500] fveillette: will work better
[2013-11-07 16:43:40 -0500] fveillette: when you put @ in your template it's mean that he expect the attribute to be pass to your template attribute
[2013-11-07 16:43:46 -0500] fveillette: resources  imean
[2013-11-07 16:44:09 -0500] ryanschwartz: I think I know what's going on - `hostname --fqdn` is returning an error. Off to check DNS...
[2013-11-07 16:46:46 -0500] dopacki: is there a way to temporarily dial-up logging verbosity from inside a chef recipe? for example, to set debug on just a single resource block?
[2013-11-07 16:47:15 -0500] adamjk-dev: dopacki: good question.... I would be interested to know the same
[2013-11-07 16:58:55 -0500] adnichols: otakup0pe we use serverspec typically
[2013-11-07 17:42:18 -0500] cannonball: I'm having trouble understanding how to represent this ruby stanza in json:     "options" => {  "timeout" => 2, "rotate" => nil }
[2013-11-07 17:42:31 -0500] cannonball: Everything is cool until I get to the rotate setting.
[2013-11-07 17:43:04 -0500] dwradcliffe: cannonball: "rotate": null
[2013-11-07 17:43:08 -0500] cannonball: If I put "rotate": "", then what gets output is "rotate:"     If I put "rotate": "0", then what gets output is "rotate:0".
[2013-11-07 17:43:13 -0500] cannonball: Ah, dammit, I knew it was easy.
[2013-11-07 17:43:13 -0500] jonlives: yeah, you want null instead of nil
[2013-11-07 17:44:01 -0500] EHLOVader: good afternoon...
[2013-11-07 17:44:34 -0500] EHLOVader: data bags.. it appears they would be useful to override the default node attributes in a recipe. but it isn't clear how to do this
[2013-11-07 17:45:13 -0500] EHLOVader: how are recipes meant to be configured, in a use case of vagrant provisioner specifically?
[2013-11-07 17:45:55 -0500] adamjk-dev: hey all.... having issues with an execute command
[2013-11-07 17:46:20 -0500] adamjk-dev: I want to execute the following command as the jenkins user on my machine: NOKOGIRI_USE_SYSTEM_LIBRARIES=1 vagrant plugin install vagrant-berkshelf
[2013-11-07 17:46:30 -0500] adamjk-dev: but it keeps failing
[2013-11-07 17:46:34 -0500] adamjk-dev: I need to run it as the jenkins user
[2013-11-07 17:48:10 -0500] cannonball: Ok, next logic question.  If I set a default_attribute in a base role:       "options": { "timeout": "2", "rotate": null },   then I apply an "office" role with override_attributes:        "options": {  "timeout": "3" }     It doesn't delete the rotate hash element.  Is there a way to do so, or must I not declare it by default and specifically set it only when I want it?
[2013-11-07 17:51:54 -0500] cannonball: I wonder if I would have been better served by creating this in Ruby DSL instead of json.
[2013-11-07 17:56:55 -0500] jmickle: can anyone help me understand some variables?
[2013-11-07 17:57:23 -0500] mveitas: anybody have a nifty way to manage AWS keys on a Vagrant vm? I don't want to commit any keys into Git :)
[2013-11-07 17:59:18 -0500] EHLOVader: ok, I think I may have it figured out...
[2013-11-07 17:59:34 -0500] EHLOVader: data bags aren't loaded into node attributes, but roles would be...
[2013-11-07 18:00:13 -0500] EHLOVader: roles folder can have files, which are json, and their default_attributes will take precedence over the defaults found in the attributes of recipes? right?
[2013-11-07 18:00:25 -0500] EHLOVader: or would you always have to use override attributes?
[2013-11-07 18:01:54 -0500] gleam: see the table near the bottom of http://docs.opscode.com/chef_overview_attributes.html
[2013-11-07 18:09:40 -0500] stormerider: getting this during a knife bootstrap... what's the option to pass to configure this? 10.200.129.121 /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/mixlib-log-1.3.0/lib/mixlib/log.rb:97:in `level=': Log level must be one of :debug, :info, :warn, :error, or :fatal (ArgumentError)
[2013-11-07 18:25:09 -0500] mikesplain: stormerider looks like your log level is getting set to a level that your version of chef doesn't support
[2013-11-07 18:25:30 -0500] mikesplain: I've seen that before where it'll bootstrap to "auto" but older chef doesn't support auto
[2013-11-07 18:26:32 -0500] stormerider: ah, yeah, it's got 10.12 on it, which i want to nuke. i guess ill remove it manually and retry, thanks.
[2013-11-07 18:27:20 -0500] mikesplain: Sure, you can override loglevel in client rb on the box, then retry running with something like "chef-client -j /etc/chef/first-run.json" and it should work
[2013-11-07 18:27:28 -0500] mikesplain: np
[2013-11-07 18:38:55 -0500] defrag: stop it splain.
[2013-11-07 18:39:36 -0500] mikesplain: you're welcome frag
[2013-11-07 18:47:27 -0500] kudgelFish: so I have this cookbook recipe script that claims to have ran successfully but I see no changes to server. What is the first thing to check?
[2013-11-07 18:55:09 -0500] josephholsten: woo! ruby 2.0 breaks knife-windows bootstrapping
[2013-11-07 18:55:30 -0500] josephholsten: I hate everything
[2013-11-07 19:06:31 -0500] alxism: HI Guys
[2013-11-07 19:07:19 -0500] alxism: i'm trying to perfom a search (from knife) on a custom attribute. The json path to that attribute looks like a.b.c
[2013-11-07 19:07:55 -0500] alxism: I tried: knife search node 'a.b.c:foo*' but it does not return anything.
[2013-11-07 19:08:21 -0500] cwj: alxism: use underscores to join the keys
[2013-11-07 19:08:27 -0500] cwj: a_b_c:foo
[2013-11-07 19:08:33 -0500] alxism: Ah!
[2013-11-07 19:08:36 -0500] alxism: let me try.
[2013-11-07 19:09:03 -0500] alxism: cool. thank you.
[2013-11-07 19:09:05 -0500] cwj: np
[2013-11-07 19:10:48 -0500] |rt|: is it possible to test the value of a variable in a recipe with chef spec?
[2013-11-07 19:11:54 -0500] |rt|: I have a recipe that processes some ohai attributes into an array and I want to make sure that the array elements are what I expect given some fauxhai data
[2013-11-07 19:15:45 -0500] kudgelFish: Chef log says it processed and ran my recipe script successfully but I see no changes. What does this mean??
[2013-11-07 19:15:51 -0500] holms: anybody got problem with kitchen? http://pastie.org/8463461
[2013-11-07 19:16:16 -0500] holms: coderanger: ahoi D
[2013-11-07 19:16:17 -0500] holms: :
[2013-11-07 19:16:19 -0500] holms: :D
[2013-11-07 19:22:26 -0500] EHLOVader: thanks gleam.. I didn't see this before, but it certainly helps
[2013-11-07 19:22:53 -0500] EHLOVader: how would you suggest a repo with cookbook be configured by end users? for a specific instance? roles?
[2013-11-07 19:23:05 -0500] EHLOVader: things like license keys, usernames, passwords, etc
[2013-11-07 19:37:26 -0500] luimeme: coderanger, hi with PyChef can i ask all the attributes there is in knife node edit -a or just the one defined on the node ? thx
[2013-11-07 19:39:22 -0500] teukka: holms: if you are not using ssh keys, you'll get prompted the password for many times. no way to store it for rsync calls :/
[2013-11-07 19:40:19 -0500] teukka: holms: btw, whenever you are doubting, add -VV option to get the debug output to see what is really happening
[2013-11-07 19:41:52 -0500] coderanger: luimeme: Not sure what you mean, they are all loaded when you grab the object
[2013-11-07 19:41:55 -0500] coderanger: holms: Alo
[2013-11-07 19:42:01 -0500] holms: teukka: yeah, password doesnt work :) that's the point
[2013-11-07 19:42:02 -0500] holms: ssh keys helped
[2013-11-07 19:42:15 -0500] holms: -VV didn't showed anything interested
[2013-11-07 19:42:18 -0500] holms: solved
[2013-11-07 19:43:02 -0500] holms: coderanger: evening, you probably would think it's a stupid idea, but it's easing my life ))) https://gist.github.com/holms/7360034
[2013-11-07 19:43:35 -0500] holms: in case i'd like to start all over again, cause i've destroyed something last time
[2013-11-07 19:44:32 -0500] coderanger: holms: The manual steps are like three lines
[2013-11-07 19:44:56 -0500] coderanger: holms: Also for the love of all that is holy don't use rvm
[2013-11-07 19:45:01 -0500] coderanger: rbenv is better in literally every way
[2013-11-07 19:45:13 -0500] holms: k ill modify this later
[2013-11-07 19:45:23 -0500] holms: it's 3 line, but yuo need to copy keys
[2013-11-07 19:45:32 -0500] holms: would be nice to automate that too
[2013-11-07 19:45:45 -0500] coderanger: holms: The manual steps are 1: curl the rpm or deb 2: install it
[2013-11-07 19:45:46 -0500] jmartin: coderanger: preach! rvm is nasty
[2013-11-07 19:46:03 -0500] teukka: holms: asking the passowrd multiple times doesn't mean that it is not working, if it is asking it for different rsync calls. the cook command uploads all directories now one by one
[2013-11-07 19:46:07 -0500] coderanger: er, make that 1 and 2 :)
[2013-11-07 19:46:14 -0500] holms: teukka: i've entered it's like 20 times
[2013-11-07 19:46:42 -0500] luimeme: coderanger, i mean how do i get a node attribute set on the environment when i have the a Node() object
[2013-11-07 19:46:56 -0500] coderanger: luimeme: Set on the environment?
[2013-11-07 19:46:57 -0500] teukka: holms: ok, maybe not allowed by the sshd then?
[2013-11-07 19:47:01 -0500] holms: coderanger: uploading cookboks was giving me bad crc, i was just pissed off.. and wiped off everything, and thought would be nice to do this with chef solo from my workstation
[2013-11-07 19:47:12 -0500] coderanger: luimeme: I think the answer is "you don't", they aren't compiled on the server side
[2013-11-07 19:47:22 -0500] holms: teukka: it's allowed. from 1 password it processed, from second, password was rong
[2013-11-07 19:47:32 -0500] coderanger: holms: Sure, there is nothing wrong with it, you are just introducing a ton of moving pieces that aren't needed
[2013-11-07 19:47:33 -0500] luimeme: coderanger, well yes but they are cached on the server ex. knife node edit -a ?
[2013-11-07 19:47:58 -0500] holms: coderanger: i will setup this for my home server too, and friend asked the same ))
[2013-11-07 19:48:07 -0500] holms: in the end i'll have just  one repo
[2013-11-07 19:48:25 -0500] holms: which will need to do knife solo cook myhostname
[2013-11-07 19:48:28 -0500] coderanger: luimeme: Sure, and you can access those directly
[2013-11-07 19:48:30 -0500] holms: without ssh'ing anyway
[2013-11-07 19:48:42 -0500] coderanger: luimeme: But if you change something in the env object, you need to run chef-client again before it will show up there
[2013-11-07 19:49:20 -0500] coderanger: luimeme: node objects in pychef work like normal dicts
[2013-11-07 19:49:41 -0500] coderanger: luimeme: Or you can directly access node.override, node.default, etc
[2013-11-07 19:50:10 -0500] dgarstang3: Is there a better way than this http://pastebin.com/S0sDW9gx to work out what my instance type is?
[2013-11-07 19:51:29 -0500] teukka: holms: btw, you should be able to combine lines 66-74 with just: knife solo bootstrap -r "role[chef]" mynicehostname
[2013-11-07 19:53:12 -0500] teukka: or `knife bootstrap --solo -r ..` if you want to get people confused :)
[2013-11-07 19:56:16 -0500] jidar: so I notice that there isn't much (that I've found) on running chef without any sort of enterprise server, could somebody point me in the right direction, I want to just run chef/knife on a single box, without connecting to any cloud resources
[2013-11-07 19:56:29 -0500] holms: teukka: wrong learning curve if ask me
[2013-11-07 19:56:34 -0500] holms: but i'll aded )
[2013-11-07 19:56:38 -0500] holms: add it*
[2013-11-07 19:56:43 -0500] coderanger: jidar: Using chef-server or chef-solo?
[2013-11-07 19:56:52 -0500] jidar: either?
[2013-11-07 19:57:13 -0500] jidar: just trying to get my feet wet without using cloud services first
[2013-11-07 19:57:31 -0500] jmartin: jidar: you mean you want to test with local servers?
[2013-11-07 19:57:40 -0500] jmartin: jidar: VMs on your workstation?
[2013-11-07 19:57:47 -0500] jidar: I mean I want to test with a single server, and without connecting out to the internet
[2013-11-07 19:57:54 -0500] coderanger: jidar: http://docs.opscode.com/install_server.html shows how to install chef server
[2013-11-07 19:58:47 -0500] jidar: coderanger: yea, I've got this sort of thing done, I'm just having trouble determing how to apply cookbooks to a node, when the server is the only node
[2013-11-07 19:58:54 -0500] holms: teukka: added :}
[2013-11-07 19:59:27 -0500] coderanger: jidar: 1) don't do that, just spin up another VM or 2) do that and just set the chef_server_url to localhost
[2013-11-07 19:59:28 -0500] jidar: because all of a sudden it looks like chef wants to start using /etc/chef for his configs, rather than the local chef-repo directory (ie: $PWD)
[2013-11-07 19:59:41 -0500] coderanger: jidar: Yes, thats correct
[2013-11-07 20:00:49 -0500] jidar: coderanger: also, I'm trying not to complicate things because my first working use case is to bootstrap ec2 windows servers, so I'm kinda trying to keep things small for right now so I can get a better understanding first
[2013-11-07 20:00:58 -0500] coderanger: jidar: Then you probably want chef-solo
[2013-11-07 20:01:08 -0500] dgarstang3: Assuming that's a no on http://pastebin.com/S0sDW9gx
[2013-11-07 20:01:33 -0500] coderanger: jidar: chef-client/server is designed for larger setups
[2013-11-07 20:01:51 -0500] coderanger: jidar: Or if you are using chef-client 11.8 you can use the new local mode :)
[2013-11-07 20:02:11 -0500] jidar: I am indeed using 11.8
[2013-11-07 20:02:28 -0500] coderanger: jidar: Okay, ditch the chef-server then
[2013-11-07 20:03:01 -0500] coderanger: jidar: Check out http://jtimberman.housepub.org/blog/2013/10/10/preview-chef-client-local-mode/
[2013-11-07 20:03:08 -0500] jidar: will do, thanks
[2013-11-07 20:03:37 -0500] dgarstang3: Is it possible (and cool?) to put an include_recipe inside a conditional?
[2013-11-07 20:07:21 -0500] timsmith: anyone seeing all their services showing as being enabled on every run with Chef 11.8
[2013-11-07 20:07:35 -0500] timsmith: no issues with 11.6, but 11.8 has tons of resources getting updated on every run
[2013-11-07 20:09:19 -0500] miah: something probably has a shitty load_current_resource
[2013-11-07 20:12:33 -0500] timsmith: I'd say I did something wrong, but chef-client, rsyslog, ntp, and fail2ban all try to start on every run
[2013-11-07 20:44:12 -0500] troyready: dgarstang3, yeah, it often makes a ton of sense to gate include_recipes like that. "if node[platform] = lame_old_rhel; include_recipe..."
[2013-11-07 20:47:45 -0500] heydrick: does local mode chef-client (-z) support .rb roles? seems that only .json works
[2013-11-07 20:51:00 -0500] dgarstang3: troyready: kk
[2013-11-07 21:04:55 -0500] coderanger: heydrick: That is correct
[2013-11-07 21:05:33 -0500] holms: would be nice to have cookbook to prepare knife on my workstation
[2013-11-07 21:05:42 -0500] holms: i'm lazy to copy keys from vm, generate config and etc
[2013-11-07 21:05:44 -0500] heydrick: coderanger: any chance .rb support could be added? most of my roles are .rb
[2013-11-07 21:06:12 -0500] coderanger: heydrick: jkeiser2 and I have been talking about it, its on my todo list but I haven't had time to work on my dialects branch in a while now
[2013-11-07 21:06:40 -0500] heydrick: coderanger: would you like a ticket or is there already one?
[2013-11-07 21:07:15 -0500] coderanger: heydrick: I don't think there is one, but its part ofa much bigger change
[2013-11-07 21:10:40 -0500] mattsmith: Evening All, I have a Ubuntu 12.04 AMI that i'm trying to bootstrap - I'm getting the "ERROR: cannot verify www.opscode.com's certificate" message at the moment. To fix this i will need to update the ca-certificates and re-bundle the AMI. Can anyone else think of a way to do this?
[2013-11-07 21:11:35 -0500] mattsmith: i.e I'd like to pass --no-check-certificate to knife :-)
[2013-11-07 21:22:23 -0500] phutchins: Hey is there anything built in to chef on a chef-client node that has a restful interface to run the chef-client?
[2013-11-07 21:22:29 -0500] phutchins: or know of a cookbook that will accomplish this?
[2013-11-07 21:22:45 -0500] holms: how to get files from scp/sftp using recipes?
[2013-11-07 21:22:58 -0500] phutchins: holms: use remote_file resource
[2013-11-07 21:23:46 -0500] holms: thnnx
[2013-11-07 21:24:45 -0500] phutchins: holms: np. never used it with sftp tho but I dont' see why it wouldn't work as long as the host knows how to handle the url
[2013-11-07 21:26:21 -0500] holms: scp:// or ssh:// ;D?
[2013-11-07 21:26:26 -0500] holms: which software handles these requests
[2013-11-07 21:26:52 -0500] holms: oh ok it's sftp:// if it's curl
[2013-11-07 21:27:06 -0500] phutchins: yeah that shoudl match up then
[2013-11-07 21:37:00 -0500] holms: phutchins: any resource responsible for launching command, and enter info which that command asks for?
[2013-11-07 21:37:03 -0500] holms: i mean interactive mode
[2013-11-07 21:37:28 -0500] holms: ofcourse i'll try to find params first
[2013-11-07 21:42:02 -0500] dgarstang3: I have "override['bc-zookeeper']['data_volume_lvm_size'] = "50%VG"" in my cookbooks attributes file. I'm trying to override a value set in another cookbook. Not working. What could I be missing?
[2013-11-07 21:45:21 -0500] dgarstang3: Darn it.
[2013-11-07 21:45:34 -0500] nicgrayson: dgarstang3: i'm thinking it's the order you are including the recipes
[2013-11-07 21:47:09 -0500] dgarstang3: nicgrayson: I don't think so. how? there's just 4 recipes included
[2013-11-07 21:48:44 -0500] nicgrayson: dgarstang3: are you wrapping a cookbook that sets that attr?
[2013-11-07 21:49:08 -0500] dgarstang3: nicgrayson: I don't think so. This might be a berkshelf issue. This has bitten me soooo many times.
[2013-11-07 21:50:08 -0500] nicgrayson: dgarstang3: yep i've had this happen with berkshelf too
[2013-11-07 21:51:39 -0500] dgarstang3: nicgrayson: the locking thing? using old cookbooks ?
[2013-11-07 21:54:25 -0500] nicgrayson: dgarstang3: well that too
[2013-11-07 21:54:37 -0500] dgarstang3: nicgrayson: doh
[2013-11-07 21:54:53 -0500] nicgrayson: dgarstang3: if i'm wrapping a cookbook i have had to set 'parent' attrs
[2013-11-07 21:56:01 -0500] dgarstang3: nicgrayson: nah, not wrapping. Just including....? the kafka cookbook includes the zookeeper cookbook and tries to override some settings from the zookeeper cookbook to make it use localhost instead of a cluster, and to override the normal 100% of the vg used to more like 50/50 for now.
[2013-11-07 21:56:20 -0500] dgarstang3: anyway, trying again with correct cookbook versions
[2013-11-07 21:56:43 -0500] dgarstang3: test = test, stop, futz around in ~/.berkshelf and blow stuff away, remove Berksfile.lock and vagrant up again
[2013-11-07 21:57:21 -0500] dgarstang3: .... then wait 20 min for it to download java
[2013-11-07 22:00:43 -0500] fak3r: bootstrap error, why would this not be auth'ing?
[2013-11-07 22:00:44 -0500] fak3r: 10.187.255.184 [2013-11-07T15:59:03-06:00] INFO: Client key /etc/chef/client.pem is not present - registering
[2013-11-07 22:00:44 -0500] fak3r: 10.187.255.184 Chef encountered an error attempting to create the client "server.domain.com"
[2013-11-07 22:02:18 -0500] nicgrayson: fak3r: is a node with the same name already registered?
[2013-11-07 22:03:34 -0500] zaargy: anyone available to do some remote contracting on ops stuff like asap e.g. tomorrow? (chiefly chef) please pm if so :)
[2013-11-07 22:04:50 -0500] fak3r: nicgrayson: no
[2013-11-07 22:05:34 -0500] fak3r: nicgrayson: Authentication Error: Failed to authenticate to the chef server (http 401).
[2013-11-07 22:06:14 -0500] nicgrayson: fak3r: is your validator correct?
[2013-11-07 22:07:43 -0500] fak3r: nicgrayson: I think so, I can do knife status, and knife node edit other nodes not sure what I broke
[2013-11-07 22:09:33 -0500] nicgrayson: fak3r: those commands use your client key not your validator
[2013-11-07 22:09:50 -0500] nicgrayson: fak3r: validator is only for bootstrapping
[2013-11-07 22:10:04 -0500] fak3r: ah, ok, but existing nodes should have them?
[2013-11-07 22:10:31 -0500] nicgrayson: fak3r: existing nodes delete that key and get their own client key
[2013-11-07 22:10:38 -0500] fak3r: ah, ok
[2013-11-07 22:10:49 -0500] fak3r: so could I get it from the chef server again?
[2013-11-07 22:11:02 -0500] nicgrayson: fak3r: you will need to generate a new one
[2013-11-07 22:11:30 -0500] fak3r: nicgrayson: ok cool, thanks for the help
[2013-11-07 22:11:36 -0500] nicgrayson: np
[2013-11-07 22:26:21 -0500] dgarstang3: chef makes no sense sometimes. it's failing on a resource, but not running the LOG statement immediately before it. *sigh*
[2013-11-07 22:27:46 -0500] dgarstang3: if I define an attribute in a cookbook, and use it in that cookbook, can another cookbook include it and override it? What runs first? the include_recipe or the node override in the downstream cookbook?
[2013-11-07 22:31:40 -0500] dgarstang3: Should this work? http://pastebin.com/yGXnkq6H
[2013-11-07 22:32:26 -0500] dgarstang3: http://pastebin.com/yGXnkq6H: I set the data_volume_lvm_size in zookeeper at 100%. However, if kafka includes the zookeeper recipe I want to override that to 50%
[2013-11-07 22:33:52 -0500] mwhooker: dgarstang3 how are the attributes being referenced
[2013-11-07 22:33:56 -0500] mwhooker: and you're right, chef makes no sense
[2013-11-07 22:34:00 -0500] mwhooker: but we try to get along
[2013-11-07 22:34:28 -0500] mwhooker: you're probably hitting a compile vs runtime issue
[2013-11-07 22:34:37 -0500] dgarstang3: mwhooker: i said sometimes. :) Being accessed with just node...
[2013-11-07 22:34:55 -0500] mwhooker: can you show me some context?
[2013-11-07 22:35:07 -0500] holms: whyyyyyyyyyyyyy
[2013-11-07 22:35:07 -0500] holms: ArgumentError
[2013-11-07 22:35:08 -0500] holms: -------------
[2013-11-07 22:35:08 -0500] holms: Invalid uri, Only http(s), ftp, and file are currently supported
[2013-11-07 22:35:13 -0500] holms: i need sftp =(
[2013-11-07 22:35:16 -0500] dgarstang3: mwhooker: code or description?
[2013-11-07 22:35:19 -0500] mwhooker: code
[2013-11-07 22:36:25 -0500] holms: how to transfer file via ssh :/
[2013-11-07 22:38:42 -0500] holms: coderanger: how can I download file from scp/sftp/ssh in recipes?
[2013-11-07 22:38:58 -0500] coderanger: holms: execute resource?
[2013-11-07 22:39:19 -0500] holms: no i just to get files via ssh, instead of http
[2013-11-07 22:39:43 -0500] holms: just want*
[2013-11-07 22:39:46 -0500] bgood: in the deploy resource if shallow_clone is true the clone depth is set to 5, what does the 5 mean (commits, days, etc.)
[2013-11-07 22:39:57 -0500] coderanger: holms: Yes, you would have to shell out to scp or sftp
[2013-11-07 22:40:05 -0500] holms: shell out? :D
[2013-11-07 22:40:53 -0500] fak3r: knife bootstrapping is timing out, it does have to dnld a 20M splunk package - how can I change the timeout setting in chef/knife?
[2013-11-07 22:41:30 -0500] dgarstang3: mwhooker: sure, there's both cookbooks and the attributes. http://pastebin.com/c6LPt1St
[2013-11-07 22:42:26 -0500] dgarstang3: mwhooker: line #6. Set data_volume_lvm_size to 100%. Line #163 override it to 50%
[2013-11-07 22:43:16 -0500] mwhooker: dgarstang3 those are both recipe files?
[2013-11-07 22:43:29 -0500] dgarstang3: I'm getting the feeling that if cookbook A includes cookbook B, that anything set by cookbook A doesn't get used by cookbook B.
[2013-11-07 22:43:41 -0500] dgarstang3: mwhooker: yep. first is zookeeper. second is kafka
[2013-11-07 22:44:15 -0500] mwhooker: let me think
[2013-11-07 22:44:47 -0500] dgarstang3: mwhooker: crazy thing (beyond the override not working) is that line 22 works... but line 20 never gets logged.
[2013-11-07 22:45:00 -0500] mwhooker: I doubt this is the issue but I'm not sure node is implicit. usually see like node.default[...] = x, etc
[2013-11-07 22:45:20 -0500] dgarstang3: mwhooker: in the attributes files?
[2013-11-07 22:45:22 -0500] mwhooker: dgarstang3 you might need to look earlier up the log stack
[2013-11-07 22:45:38 -0500] mwhooker: ah, thought those were in the recipe files too
[2013-11-07 22:45:39 -0500] dgarstang3: mwhooker: I pasted the whole thing into vi and searched. nada
[2013-11-07 22:46:14 -0500] mwhooker: basically, anything that's in the body of a recipe gets evaluated before all the recipes are loaded
[2013-11-07 22:46:30 -0500] mwhooker: to get things to run in any sane order they need to be in resource blocks
[2013-11-07 22:47:00 -0500] dgarstang3: mwhooker: this is new information...
[2013-11-07 22:47:13 -0500] mwhooker: heh, they don't exactly make it obvious
[2013-11-07 22:47:20 -0500] justizin: anyone building, formatting, and mounting a software raid in a chef recipe? the device name seems to change after i reboot and it is reassembled, i worry that it will try to recreate and wipe data.
[2013-11-07 22:47:42 -0500] dgarstang3: mwhooker: this? http://docs.opscode.com/resource_ruby_block.html I don't want to run ruby code tho
[2013-11-07 22:48:09 -0500] mwhooker: https://wiki.opscode.com/display/Chef/Anatomy+of+a+Chef+Run
[2013-11-07 22:48:30 -0500] mwhooker: hmm, that's not the page I'm looking for
[2013-11-07 22:48:43 -0500] justizin: like if, say, manually i mdadm --create 0 -blah -blah -blah, it starts as /dev/md/0, but is /dev/md/127 after reboot.  i am mounting by uuid, but just worried chef will be like "ooh, no such raid at /dev/md/0, let's create that using these block devices!"
[2013-11-07 22:48:44 -0500] mwhooker: sec
[2013-11-07 22:51:43 -0500] holms: ok why
[2013-11-07 22:51:44 -0500] holms: r$ knife cookbook upload -a
[2013-11-07 22:51:46 -0500] holms: ERROR: The data in your request was invalid
[2013-11-07 22:51:46 -0500] holms: Response: Bad checksums!
[2013-11-07 22:51:59 -0500] holms: i've resetuped everything froms scratch - same error
[2013-11-07 22:53:31 -0500] dgarstang3: Well, I don't know. There seems to be almost no docs on how to practically use chef attributes
[2013-11-07 22:53:34 -0500] mwhooker: dgarstang3 here's the link I was looking for http://erik.hollensbe.org/2013/03/16/the-chef-resource-run-queue/
[2013-11-07 22:53:51 -0500] mwhooker: dgarstang3 I'd put them in attributes files first
[2013-11-07 22:54:10 -0500] dgarstang3: mwhooker: I have
[2013-11-07 22:54:18 -0500] dgarstang3: mwhooker: that link.... it talks about 'resource blocks' ?
[2013-11-07 22:54:36 -0500] mwhooker: yeah, anything that's like `blah "name" do` is a resource
[2013-11-07 22:54:47 -0500] dgarstang3: mwhooker: Well of course I'm using those...
[2013-11-07 22:54:47 -0500] mwhooker: http://docs.opscode.com/resource.html
[2013-11-07 22:55:05 -0500] dgarstang3: mwhooker: you can see that in the code I pasted
[2013-11-07 22:55:07 -0500] mwhooker: I'm just saying, the log on like 20 or whatever isn't going to run when you think it's going to
[2013-11-07 22:55:14 -0500] dgarstang3: oh
[2013-11-07 22:55:27 -0500] mwhooker: because it'll be evaluated during compile time
[2013-11-07 22:55:32 -0500] dgarstang3: i thought log "foo" was a resource...
[2013-11-07 22:55:51 -0500] dgarstang3: and in fact, it's still a block... log "foo" is just shorthand notation...
[2013-11-07 22:55:58 -0500] mwhooker: oh my bad, you're right
[2013-11-07 22:56:15 -0500] dgarstang3: anyway, the attribute overrides are the real issue
[2013-11-07 22:56:31 -0500] mwhooker: yeah
[2013-11-07 22:56:57 -0500] mwhooker: these are two different cookbooks?
[2013-11-07 22:57:08 -0500] dgarstang3: I wish opscode would pay a schlep to write their docs. someone who doesn't have the disadvantage of writing docs from the view of a developer
[2013-11-07 22:57:25 -0500] dgarstang3: mwhooker: yes. zookeeper and kafka
[2013-11-07 22:59:10 -0500] dgarstang3: To anyone... Cookbook A sets an attribute and uses it. If cookbook B includes cookbook A, can cookbook B override cookbook A's attribute?
[2013-11-07 22:59:10 -0500] mwhooker: let's see. there's weird things with attribute precedence
[2013-11-07 22:59:25 -0500] mwhooker: you might have to move the overrides from the attributes file to the recipe
[2013-11-07 22:59:31 -0500] dgarstang3: mwhooker: weird, like a mysterious lack of docs?
[2013-11-07 22:59:43 -0500] mwhooker: or coherent data model
[2013-11-07 23:00:14 -0500] troyready: *sigh* the same complaining train in here
[2013-11-07 23:00:37 -0500] dgarstang3: troyready: if you'd kindly provide docs, I'd be happy to shop complaining.
[2013-11-07 23:01:21 -0500] troyready: I may have never believed something less in my life
[2013-11-07 23:01:25 -0500] troyready: http://docs.opscode.com/essentials_cookbook_attribute_files.html#attribute-precedence
[2013-11-07 23:01:58 -0500] dgarstang3: troyready: yeah that one doesn't quite go far enough.
[2013-11-07 23:02:32 -0500] dgarstang3: troyready: it says nothing about how this applies to cookbooks including other cookbooks that I can see
[2013-11-07 23:02:42 -0500] mwhooker: not like 6 levels of precedence isn't confusing or anything
[2013-11-07 23:03:22 -0500] troyready: http://docs.opscode.com/essentials_cookbook_attribute_files.html#attribute-persistence
[2013-11-07 23:03:37 -0500] troyready: Ooooh, I see what you're saying
[2013-11-07 23:03:42 -0500] troyready: Not sure how the timing on that works
[2013-11-07 23:03:55 -0500] holms: jeez really?
[2013-11-07 23:03:55 -0500] troyready: Test and let me know
[2013-11-07 23:03:56 -0500] holms: Uploading logstash (0.5.9) to: 'https://10.49.118.164:443/'
[2013-11-07 23:03:56 -0500] holms: Ridley::Errors::ConnectionFailed: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed
[2013-11-07 23:04:05 -0500] holms: is thsi a default behavior..?
[2013-11-07 23:04:26 -0500] stormerider: holms: you probably want to tell berks to ignore ssl errors
[2013-11-07 23:04:32 -0500] holms: =/
[2013-11-07 23:04:41 -0500] dgarstang3: troyready: Nothing about cookbooks including other cookbooks. Did I miss it?
[2013-11-07 23:04:48 -0500] troyready: (and then issue a pull request on the docs, to contribute back and help future people in your situation)
[2013-11-07 23:05:27 -0500] holms: i sometimes think that chef just been released like week ago or smtng
[2013-11-07 23:05:29 -0500] mwhooker: dgarstang3 just put the overrides in your recipe. I don't overrides in attribute files work that way
[2013-11-07 23:05:42 -0500] troyready: dgarstang3, [15:03] <troyready> Ooooh, I see what you're saying [15:03] <troyready> Not sure how the timing on that works [15:03] <troyready> Test and let me know
[2013-11-07 23:05:53 -0500] dgarstang3: troyready: sorry?
[2013-11-07 23:06:10 -0500] troyready: I don't know the answer to your question. You should test it and let us know
[2013-11-07 23:06:12 -0500] dgarstang3: mwhooker: as a last resort, although I suspect what I'm trying to do isn't valid.
[2013-11-07 23:06:37 -0500] troyready: And then submit a patch to the docs to make it more clear
[2013-11-07 23:06:41 -0500] dgarstang3: troyready: It doesn't work as I'd expect. There you go.
[2013-11-07 23:06:57 -0500] stormerider: holms: berks isnt an official opscode tool, but it's easy to configure around ssl issues
[2013-11-07 23:07:19 -0500] dgarstang3: troyready: Can't see a whole lot of benefit in submitting doc updates until I understand the fundamentals, which I apparemtly don't
[2013-11-07 23:07:22 -0500] holms: stormerider: --ssl-verify=false ?
[2013-11-07 23:07:37 -0500] stormerider: i do it with a config file myself
[2013-11-07 23:08:26 -0500] troyready: Fair enough.  Seems like you understand this issue (attribute precedence during chef-client runs w/ include_recipe resources) enough to make a note in the docs about it, fwiw
[2013-11-07 23:09:32 -0500] dgarstang3: troyready: Sure. I could add a note saying that if you set an attribute in cookbook A, and then cookbook B includes cookbook A and tries to override that value before cookbook A runs, then it doesn't work. Is that how it's supposed to work? I don't know.
[2013-11-07 23:09:51 -0500] holms: ooh so you use berks over knife
[2013-11-07 23:10:01 -0500] holms: completely*
[2013-11-07 23:10:44 -0500] troyready: I would phrase it differently, but it could be a start.
[2013-11-07 23:11:14 -0500] holms: please kill me: Ridley::SandboxUploader crashed!
[2013-11-07 23:11:46 -0500] dgarstang3: holms: nah kill me first. chef attributes
[2013-11-07 23:13:06 -0500] dgarstang3: i just can't fathom why there's so few community docs out there on chef.
[2013-11-07 23:13:47 -0500] dgarstang3: Every single example seems to be so trivial and simple as not to be useful in any practical way beyond the most simple cases.
[2013-11-07 23:15:19 -0500] holms: dgarstang3: same for me, i even started to write my own guides for setuping this madness
[2013-11-07 23:15:46 -0500] dgarstang3: s/time wasted on puppet resource ordering/time wasted on understanding chef attributes/
[2013-11-07 23:15:59 -0500] holms: lol
[2013-11-07 23:16:05 -0500] dgarstang3: holms: well, I'm glad it's not just me. :)
[2013-11-07 23:16:26 -0500] programmerq: yeah, it certainly has a high learning curve.
[2013-11-07 23:16:46 -0500] programmerq: I think part of the reason there aren't many community docs is because chef is a fairly quick moving target still.
[2013-11-07 23:17:45 -0500] holms: Faraday::Error::ConnectionFailed: getaddrinfo: Name or service not known
[2013-11-07 23:17:48 -0500] holms: oops sorry
[2013-11-07 23:18:50 -0500] holms: if somebody needs chef-server automatization: https://gist.github.com/holms/7360034 and installing chef-solo from scratch with vagrant: https://gist.github.com/holms/7239334 and breef introduction to chef: learnchef.getharvest.com
[2013-11-07 23:18:59 -0500] holms: hope it helps
[2013-11-07 23:19:21 -0500] dgarstang3: phrased in yet another way, if cookbook A (zookeeper) has an attribute, and cookbook B (kafka) includes it, can cookbook B override a setting in cookbook A, such that when A runs, it uses the overridden value?
[2013-11-07 23:19:52 -0500] dgarstang3: should that be in an attribute file? a role? both? neither? am I losing my sanity?
[2013-11-07 23:19:56 -0500] holms: like overriding java version 7 in my own cookbook, when using java cookbook?
[2013-11-07 23:20:20 -0500] mwhooker: dgarstang3 yes. override it in recipe though
[2013-11-07 23:20:33 -0500] mwhooker: the attribute file for zk won't be evaluated
[2013-11-07 23:20:56 -0500] dgarstang3: mwhooker: why not attribute file?
[2013-11-07 23:20:57 -0500] troyready: dgarstang3, take a breath, grab a coke :) FWIW, i avoid that kind of confusion by specifying the desired attribute at a higher precedence level
[2013-11-07 23:21:13 -0500] mwhooker: because the attribute file for zk won't be evaluated
[2013-11-07 23:21:31 -0500] holms: learning curve reminds me git, but 10x harder
[2013-11-07 23:21:34 -0500] troyready: Generally, that would look like roles with default attributes (where I have my roles/recipes then called from), which will always keep the attributes set to what I want
[2013-11-07 23:21:38 -0500] holms: but docs in there are great :P
[2013-11-07 23:23:58 -0500] holms: why i'm getting this error =( Faraday::Error::ConnectionFailed: getaddrinfo: Name or service not known
[2013-11-07 23:24:10 -0500] holms: can't i just use ip of server?
[2013-11-07 23:25:54 -0500] dgarstang3: troyready: precendence level doesn't matter. I still don't understand how one cookbook including another applies to attribute ordering
[2013-11-07 23:27:27 -0500] troyready: It does matter for the example I just gave.
[2013-11-07 23:27:47 -0500] troyready: Precedence, as in "always taking precedence"
[2013-11-07 23:28:32 -0500] dgarstang3: well, now I just have no idea where to put this stuff
[2013-11-07 23:28:42 -0500] dgarstang3: it seems seems complely counterintuitive to not put attributes for a cookbook in the attributes file.
[2013-11-07 23:28:52 -0500] dgarstang3: i mean, duh.
[2013-11-07 23:29:49 -0500] holms: is chef-server can't be without domain or smtng?
[2013-11-07 23:36:28 -0500] dgarstang3: hang on... if I set the attribute in cookbook B, how's that gonna work? the include_recipe comes BEFORE hand
[2013-11-07 23:38:48 -0500] coderanger: holms: It needs a hostname it can be reached at if thats what you mean
[2013-11-07 23:54:18 -0500] dgarstang3: this seems really stoopid. setting every single attribute in a role
[2013-11-07 23:59:09 -0500] Majost: dgarstang3: http://docs.opscode.com/chef_overview_attributes.html#attribute-precedence
