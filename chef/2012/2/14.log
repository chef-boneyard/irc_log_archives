[2012-02-14 08:05:00 -0500] miah: vagrant reload is sometimes useful =)
[2012-02-14 08:34:00 -0500] dachary: jtimberman: thanks for the hint.
[2012-02-14 08:34:00 -0500] dachary: If I understand correctly, chef does not have the native ability to run synchronous operations in the same way mcollective does. Am I mistaken ?
[2012-02-14 10:14:00 -0500] makuk66: dachary: you can use "knife ssh" to explicitly and synchronously run chef-client on all your nodes, instead of having chef-client running all the time.
[2012-02-14 10:51:00 -0500] labria: ohai
[2012-02-14 10:53:00 -0500] labria: is there a way to define helpers to use in templates?
[2012-02-14 11:00:00 -0500] zts: dachary: what do you have in mind, when you refer to "synchronous operations" and mcollective and chef?
[2012-02-14 11:00:00 -0500] zts: dachary: in the same way as you can use mcollective with puppet, you can use mcollective with chef (we do that).  They are both useful in different ways
[2012-02-14 11:11:00 -0500] caaakeeey: what do i do if i want to copy a file from one place on a node to another
[2012-02-14 11:11:00 -0500] caaakeeey: the file resource doesnt support 'source' do i have to read it in with ruby and set the contents?
[2012-02-14 11:15:00 -0500] dachary: zts: from what I understand chef is asynchronous and you need mcollective to do things like : "update these nodes *now*". However, someone told me yesterday that chef does not need mcollective because it does all that by himself. I can't find traces of that on the web. I wanted to make sure he was bluffing ;-)
[2012-02-14 11:16:00 -0500] yatesy: you can use knife ssh to do simple tasks like trigger a chef-client run
[2012-02-14 11:32:00 -0500] makuk66: dachary: we use {knife ssh -x user "role:myrole" "run-chef-now" -a ec2.public_hostname}, where that script sends a hup signal to the running chef-client, to trigger it to run immediately
[2012-02-14 11:34:00 -0500] royh: makuk66: thanks. Any list like that? I'm very confused about what chef-expander does as well. and what data goes where? (local storage, solr, couchdb, etc.)
[2012-02-14 11:37:00 -0500] royh: http://pastie.org/3380121
[2012-02-14 11:37:00 -0500] royh: i get that when importing my old chef data
[2012-02-14 11:37:00 -0500] royh: there's no help on the interwebs so I'm really lost
[2012-02-14 11:38:00 -0500] royh: don't want to end up knee deep in ruby code for the next two weeks...
[2012-02-14 11:38:00 -0500] makuk66: royh: Chef Expander fetches messages from RabbitMQ, processes them into the correct format to be loaded into Solr and loads them into Solr.
[2012-02-14 11:39:00 -0500] royh: ah. that makes sense
[2012-02-14 11:39:00 -0500] makuk66: aiui solr is just for indexing, and everything lives in couchdb
[2012-02-14 11:40:00 -0500] royh: I've moved the solr data dir and imported everything from couchdb
[2012-02-14 11:40:00 -0500] royh: then moved it to a new server. though i get that error when trying to download the cookbook. chef is not helpful with error messages so i have no way to know where to look next
[2012-02-14 11:41:00 -0500] royh: also like i said, there doesn't seem to be any info available about this particular problem when i google it.
[2012-02-14 11:41:00 -0500] royh: quite frustrating :(
[2012-02-14 11:41:00 -0500] makuk66: there is a "knife index rebuild", which I've not used myself, but sounds like it might re-index all the data for you
[2012-02-14 11:41:00 -0500] royh: doesn't help :(
[2012-02-14 11:45:00 -0500] zts: dachary: as others have said, you can use "knife ssh" to run chef-client.  We don't like that, so we use mcollective to tell nodes to run immediately
[2012-02-14 11:46:00 -0500] makuk66: royh: http://wiki.opscode.com/display/chef/Backing+Up+Chef+Server might be of some help
[2012-02-14 11:47:00 -0500] zts: dachary: to be honest, the way you put the question is a little confusing to me.  I don't think it's that "chef is asynchronous", but that Chef and Puppet pull configuration from the server - it is not pushed out
[2012-02-14 11:47:00 -0500] royh: makuk66: will try. thanks
[2012-02-14 11:47:00 -0500] makuk66: whenever I've changed chef-server I've just rebuilt a new server and reloaded from source control, then re-registered the clients
[2012-02-14 11:47:00 -0500] zts: dachary: so if you want changes to be applied _now_, you need some way to tell nodes to run immediately
[2012-02-14 11:49:00 -0500] dachary: zts: I'm a little confused myself, sorry about that. You clarified the matter, thank you.
[2012-02-14 11:50:00 -0500] caaakeeey: what do i do if i want to copy a file from one place on a node to another - the file resource doesnt support 'source' do i have to read it in with ruby and set the contents?
[2012-02-14 11:51:00 -0500] makuk66: caaakeeey: or just execute/script a cp command
[2012-02-14 11:52:00 -0500] caaakeeey: yeah i guess
[2012-02-14 11:55:00 -0500] ashb: or use fileutils' cp method
[2012-02-14 11:55:00 -0500] ashb: http://ruby-doc.org/stdlib-1.8.7/libdoc/fileutils/rdoc/FileUtils.html#method-c-cp
[2012-02-14 11:58:00 -0500] BryanWB: is there a way to find out the name of the cookbook name I am in from w/ in a recipe?
[2012-02-14 12:03:00 -0500] zts: dachary: no problem, there's certainly a learning curve!
[2012-02-14 12:09:00 -0500] royh: Does anyone know what the End of file error means?
[2012-02-14 12:09:00 -0500] royh: what's wrong?
[2012-02-14 12:10:00 -0500] royh: http://pastebin.com/H4JMNkS9
[2012-02-14 12:31:00 -0500] royh: the export script at http://wiki.opscode.com/display/chef/Backing+Up+Chef+Server doesn't handle the clients. what are you supposed to do then?
[2012-02-14 12:33:00 -0500] royh: this is starting to get extremely painful...
[2012-02-14 12:54:00 -0500] neurodamage: royh: taking a look at your problem
[2012-02-14 12:54:00 -0500] royh: neurodamage: thanks
[2012-02-14 12:55:00 -0500] royh: let me know if you need any logs
[2012-02-14 12:56:00 -0500] neurodamage: which part of backin g up the chef server are you having problems with
[2012-02-14 12:56:00 -0500] royh: what am i supposed to register the nodes as clients again?
[2012-02-14 12:57:00 -0500] neurodamage: I'm not sure I understand the question?
[2012-02-14 12:58:00 -0500] BryanWB: royh: didn't work for me, i just reinstalled from scratch on new machine
[2012-02-14 12:58:00 -0500] neurodamage: each server should have both a "client" and "node"
[2012-02-14 12:58:00 -0500] royh: well i have about 150 nodes. when i restore the backups (using the backup script) how will i get the clients back in?
[2012-02-14 12:58:00 -0500] royh: yeah, exactly
[2012-02-14 12:58:00 -0500] neurodamage: royh: ah, I see what you're saying, basically you want to put validation.pem back in the /etc/chef directory
[2012-02-14 12:58:00 -0500] royh: it (the backup script) creates backups of the node-data, but not the client-data
[2012-02-14 12:58:00 -0500] neurodamage: and remove the existing /etc/chef/client.pem
[2012-02-14 12:58:00 -0500] royh: so i have to register again when i do the import...
[2012-02-14 12:59:00 -0500] royh: yikes...
[2012-02-14 12:59:00 -0500] royh: why can't it just export the client data?
[2012-02-14 12:59:00 -0500] zts: royh: unless you restore your couchdb database from old server to new server, you will need to reregister everything
[2012-02-14 12:59:00 -0500] royh: auduny: isn't it 150 now?
[2012-02-14 12:59:00 -0500] auduny: :-)
[2012-02-14 12:59:00 -0500] neurodamage: yeah, unfortunately
[2012-02-14 12:59:00 -0500] royh: we provision new boxes every day it seems ;)
[2012-02-14 12:59:00 -0500] neurodamage: I mean it's not that crazy
[2012-02-14 12:59:00 -0500] royh: zts: then that'll be the thing i gotta do then
[2012-02-14 12:59:00 -0500] auduny: But restoring the entire couchdb should work?
[2012-02-14 12:59:00 -0500] neurodamage: and the registration requests shouldn't take that long
[2012-02-14 12:59:00 -0500] royh: auduny: well, we've established it doesn't  :P
[2012-02-14 13:00:00 -0500] auduny: But why?
[2012-02-14 13:00:00 -0500] bawt: But why are you using ebs
[2012-02-14 13:00:00 -0500] royh: bawt: ebs?
[2012-02-14 13:00:00 -0500] bawt: ebs is just a wrapper over s3, basically :)
[2012-02-14 13:00:00 -0500] auduny: bawt: Are we?
[2012-02-14 13:00:00 -0500] neurodamage: royh: I mean if it's a backup only of the couchdb but not including the chef-servedr installation
[2012-02-14 13:01:00 -0500] auduny: neurodamage: But say you want to move _all_ data from one chef-server to another data for seamless moving from a small vm to a large physical machine.. THat sould be doable?
[2012-02-14 13:01:00 -0500] neurodamage: auduny: correct
[2012-02-14 13:02:00 -0500] royh: bawt: oh.. you didn't speak to us i guess...
[2012-02-14 13:06:00 -0500] neurodamage: royh: so in short to answer what I think is your question, if you backup the server configurations and databases correctly to migrate it, especially using the script, the clients do need to re-register
[2012-02-14 13:06:00 -0500] neurodamage: its as simple as how are you going to point them all to the new location?
[2012-02-14 13:06:00 -0500] neurodamage: I'm assuming the physical machine that you're migrating to has a different ip or hostname, while all your existing clients are connecting to the old servers
[2012-02-14 13:07:00 -0500] royh: neurodamage: yeah. it makes sense to do it through the bootstrap method
[2012-02-14 13:07:00 -0500] neurodamage: royh: here's how I used to do it
[2012-02-14 13:08:00 -0500] neurodamage: I would do a knife exec with all the machines first pointing them to the new location I would put the server
[2012-02-14 13:08:00 -0500] neurodamage: and then kick up the server and start responding to all the machines there
[2012-02-14 13:08:00 -0500] neurodamage: well usually it was a script with a knife exec and a search pattern for the nodes I wanted to point to another location
[2012-02-14 13:08:00 -0500] neurodamage: [6~
[2012-02-14 13:10:00 -0500] royh: I'll do the backup script import everything and then do the bootstra. does that sound reasonable?
[2012-02-14 13:10:00 -0500] royh: s/bootstra/&p/
[2012-02-14 13:15:00 -0500] sivy: hey folks: I'm trying to get vagrant setup with hosted-chef according to these docs: http://wiki.opscode.com/display/chef/Vagrant
[2012-02-14 13:15:00 -0500] sivy: and running into 401 unauthorized errors
[2012-02-14 13:16:00 -0500] sivy: i
[2012-02-14 13:16:00 -0500] sivy: m wondering how to interpret this section in the Vagrantfile
[2012-02-14 13:16:00 -0500] sivy:      # Put the client.rb in /etc/chef so chef-client can be run w/o specifying
[2012-02-14 13:16:00 -0500] sivy:      chef.provisioning_path = "/etc/chef"
[2012-02-14 13:17:00 -0500] ashb: sivy: could be time on the VM is wrong?
[2012-02-14 13:17:00 -0500] sivy: does the comment refer to chef putting a file there, or that i need to put a file there?
[2012-02-14 13:17:00 -0500] ashb: you need to put the file there
[2012-02-14 13:18:00 -0500] ashb: when chef first runs it looks for the client.rb file, if it can't find one but has they validator key instead it will create one on the fly with the server
[2012-02-14 13:18:00 -0500] sivy: ashb: hm, the time in the VM is PST, while I'm on mountain, but otherwise seems correct
[2012-02-14 13:18:00 -0500] ashb: so long as the time is right TZ shouldn't matter
[2012-02-14 13:19:00 -0500] sivy: https://gist.github.com/f4b778b4f06140c9737a <-- my vagrant config.vm.provision setupp
[2012-02-14 13:19:00 -0500] sivy: ashb: how close does the time have to be? seems the vm is a minute or two earlier than my workstation
[2012-02-14 13:19:00 -0500] ashb: sivy: that is probably good enough
[2012-02-14 13:20:00 -0500] ashb: there's a wiki page about auth problems somewhere I think
[2012-02-14 13:20:00 -0500] ashb: (it signs the requests with current time which is why it matters)
[2012-02-14 13:20:00 -0500] sivy: yeah, i've been reading this http://wiki.opscode.com/display/chef/Common+Errors
[2012-02-14 13:20:00 -0500] ashb: on the vm does /etc/chef/client.pem exist?
[2012-02-14 13:21:00 -0500] sivy: ashb: no
[2012-02-14 13:21:00 -0500] ashb: any other pems?
[2012-02-14 13:21:00 -0500] sivy: oh wait
[2012-02-14 13:21:00 -0500] sivy: i was looking for client.rb
[2012-02-14 13:21:00 -0500] sivy: yes, /etc/chef/client.pem exists
[2012-02-14 13:22:00 -0500] sivy: (and client.rb, apparently i was in the wrong terminal)
[2012-02-14 13:22:00 -0500] ashb: i don't know much about the auth, but chef-client -l debug might give some pointers
[2012-02-14 13:23:00 -0500] sivy: ah
[2012-02-14 13:23:00 -0500] sivy: apears that it's trying to provision a node that doesn't exist yet on hosted-chef
[2012-02-14 13:23:00 -0500] sivy: (per chef.node_name = "#{user}-vagrant")
[2012-02-14 13:23:00 -0500] ashb: ah, and without the validator.pem it can't create a node i think
[2012-02-14 13:24:00 -0500] sivy: well, wallrazer-validator.pem exists
[2012-02-14 13:24:00 -0500] ashb: i *think* if there is a client.pem it won't create a new one
[2012-02-14 13:24:00 -0500] sivy: chef.validation_key_path = "/Users/steve/PROJECTS/Wallrazer/pushcode/chef/.chef/wallrazer-validator.pem" # exists
[2012-02-14 13:25:00 -0500] sivy: does that chef.validation_key_path have to be on the VM? or locally?
[2012-02-14 13:26:00 -0500] ashb: in the VM for it to use. the param in your vagrant file is probably to copy it into the vm
[2012-02-14 13:26:00 -0500] sivy: ah
[2012-02-14 13:26:00 -0500] ashb: but I'm guessing here
[2012-02-14 13:28:00 -0500] sivy: well, it's true that i can't find a *validator.pem on the VM
[2012-02-14 13:28:00 -0500] sivy: will have to poke at that
[2012-02-14 13:28:00 -0500] sivy: thanks ashb
[2012-02-14 13:42:00 -0500] sivy: ashb: had to change OPSCODE_USER in env to the name of the registered clients
[2012-02-14 13:43:00 -0500] sivy: in this case "lucid64"
[2012-02-14 13:48:00 -0500] m4rcu5: hhmm, i still have not figured this out, is there a way to find out the name of the current running recipe? i would like to have an if block in the template which has "if current_recipe == ntp::server...."
[2012-02-14 13:50:00 -0500] |shad0w|: m4rcu5, why not just pass a variable to the template from that recipe
[2012-02-14 13:53:00 -0500] m4rcu5: |shad0w|: hhmm, thats an option, ill rethink some logic again, thx!
[2012-02-14 13:59:00 -0500] caaakeeey: how can i get a cookbook to run on a node without specifying a run list - the use is auto scaled nodes that connect to the server to ask for config
[2012-02-14 14:00:00 -0500] sivy: caaakeeey: you can add recipes to a role
[2012-02-14 14:00:00 -0500] sivy: and give the node a role
[2012-02-14 14:03:00 -0500] caaakeeey: how do i give the node a role? - i want chef to be able to see that the node is a given role, by inspecting a file on the node
[2012-02-14 14:03:00 -0500] caaakeeey: i guess i can access the rest api of the server from the node to set my role, but it's a bit involved
[2012-02-14 14:11:00 -0500] zts: caaakeeey: chef-client has a -j option, for specifying attributes in json
[2012-02-14 14:11:00 -0500] zts: which might be useful
[2012-02-14 14:12:00 -0500] zts: caaakeeey: when we first run chef-client on a newly provisioned node, we use that to set the initial run list (including roles)
[2012-02-14 14:14:00 -0500] |shad0w|: m4rcu5, looks like you can access recipe_name and cookbook_name in a recipe. Haven't tried it in a template yet though
[2012-02-14 14:16:00 -0500] jschneiderhan: pblittle I think I've seen that happen when using a user that doesn't have permission to the particular environment I'm trying to register the node in
[2012-02-14 14:16:00 -0500] caaakeeey: zts, i don't think I follow, how do you use that to set the initial runlist?
[2012-02-14 14:18:00 -0500] zts: caaakeeey: say you want the initial runlist to just have one role, called "your-role"...
[2012-02-14 14:18:00 -0500] zts: caaakeeey: make a file containing this: { "run_list": [ "role[your-role]" ] }
[2012-02-14 14:18:00 -0500] zts: caaakeeey: then pass the name of that file as the -j option
[2012-02-14 14:19:00 -0500] pblittle: jschneiderhan: I imagine it is a permissions issue also, but I have granted my org-validator client create/list for nodes.
[2012-02-14 14:20:00 -0500] pblittle: jschneiderhan: I just created a new environment and will try to pass it in with a knife create, looking for the option flag now.
[2012-02-14 14:20:00 -0500] ssd7: Ohai Chefs
[2012-02-14 14:23:00 -0500] caaakeeey: zts, ah ok, makes sense - thanks
[2012-02-14 14:23:00 -0500] pblittle: jschneiderhan: Just to double-check my hosted server setup I should have a client created (org-validator) and I should not have a node created when running knife ec2 server create. Is that correct?
[2012-02-14 14:23:00 -0500] mattray: dang ssd7, early to IRC
[2012-02-14 14:24:00 -0500] grEvenX: wow sorry for saying this, but trying to configure my first chef server on centos 5, not a good experience :/
[2012-02-14 14:24:00 -0500] grEvenX: anyone here running it on CentOS 5.x, and how did you end up with the setup?
[2012-02-14 14:24:00 -0500] mattray: grEvenX: agreed. For new users we recommend skipping the server setup and using Hosted Chef, it's free for the first 5 nodes.
[2012-02-14 14:25:00 -0500] royh: neurodamage: that worked :) thanks for the help!
[2012-02-14 14:25:00 -0500] mattray: grEvenX: we are planning on making it better, but CentOS 5 is a pain
[2012-02-14 14:25:00 -0500] zts: grEvenX: we ended up putting the server on Centos 6 instead
[2012-02-14 14:25:00 -0500] grEvenX: zts: ah, ok, so it's easier to get going there?
[2012-02-14 14:25:00 -0500] lflux: grEvenX: I'm running on centos 5
[2012-02-14 14:25:00 -0500] royh: grEvenX: the worst part about what you're doing is centos..
[2012-02-14 14:25:00 -0500] mattray: eventually there will be a full-stack installer for the open source server, just like the clients in beta right now
[2012-02-14 14:25:00 -0500] ssd7: mattray: :)
[2012-02-14 14:25:00 -0500] grEvenX: mattray: I see, perhaps the hosted solution is the one to go to give chef a "try" for starter anyway
[2012-02-14 14:25:00 -0500] lflux: you have to do some trickery with CC and CXX environment variables when building
[2012-02-14 14:26:00 -0500] lflux: and an ldconfig step
[2012-02-14 14:26:00 -0500] royh: grEvenX: we use the same thing, and was using rbel (rbel.frameos.org) pacakges for a long time
[2012-02-14 14:26:00 -0500] mattray: grEvenX: yeah, at least when you're getting started
[2012-02-14 14:26:00 -0500] zts: grEvenX: yeah - I'd agree with mattray that using the Hosted Chef for a trial is the best start, but if you need to run your own open-source Chef it's definitely easier on Centos 6
[2012-02-14 14:26:00 -0500] grEvenX: lflux: yeah, got that going, and got installed the correct packages from yum after some tries and so on but now the chef-server from init.d won't start and it's not giving my any errormessages
[2012-02-14 14:26:00 -0500] mattray: or heaven forbid, Ubuntu ;)
[2012-02-14 14:26:00 -0500] lflux: did you do the ldconfig part_
[2012-02-14 14:26:00 -0500] lflux: ?
[2012-02-14 14:26:00 -0500] zts: mattray: crazy-talk ;)
[2012-02-14 14:27:00 -0500] mattray: right now we're just trying to make the clients happy on CentOS 5
[2012-02-14 14:27:00 -0500] zts: the omnibus installer is a huge win for that
[2012-02-14 14:27:00 -0500] mattray: the full-stack installer is 100X easier than trying to get a happy ruby environment via packages IMO
[2012-02-14 14:28:00 -0500] mattray: zts: agreed
[2012-02-14 14:28:00 -0500] mattray: full-stack installer == omnibus
[2012-02-14 14:28:00 -0500] grEvenX: ah, lflux, genious, thanks for spotting that one!
[2012-02-14 14:28:00 -0500] lflux: grEvenX: np, it stumped me the first few times around
[2012-02-14 14:28:00 -0500] lflux: thank cthulhu for VMs with snapshots
[2012-02-14 14:29:00 -0500] grEvenX: :)
[2012-02-14 14:29:00 -0500] zts: mattray: full-stack is a better user-facing name, too :)
[2012-02-14 14:29:00 -0500] mattray: more descriptive at least
[2012-02-14 14:29:00 -0500] mattray: I prefer the original name before it went public
[2012-02-14 14:30:00 -0500] mattray: the "fatty installer"
[2012-02-14 14:31:00 -0500] zts: hah!
[2012-02-14 14:35:00 -0500] grEvenX: testing out using Chef for configuring our dev-servers now as a first
[2012-02-14 14:35:00 -0500] grEvenX: it'll be interesting :P
[2012-02-14 14:35:00 -0500] yfeldblum: dev servers?
[2012-02-14 14:36:00 -0500] grEvenX: servers configured for development environment
[2012-02-14 14:36:00 -0500] grEvenX: oh, or are you refering to that I'm not testing my code,, in production? :P
[2012-02-14 14:41:00 -0500] yfeldblum: what's the need for development servers?
[2012-02-14 14:41:00 -0500] jschneiderhan: pblittle: correct, the validator client should exist for initial registration of the node, but you should also be defining an admin client to edit the nodes and such
[2012-02-14 14:42:00 -0500] jschneiderhan: pblittle: what does your knife.rb file look like (minus any identifiers like was creds)?
[2012-02-14 14:43:00 -0500] pblittle: jschneiderhan: Give me one sec and I'll post my knife config. Thanks again.
[2012-02-14 14:44:00 -0500] jschneiderhan: no problem - I'm by no means a chef expert but would love to help if I can
[2012-02-14 14:45:00 -0500] BryanWB: i think the name of omnibus installer should be changed to 'hoagie' or 'poboy'
[2012-02-14 14:47:00 -0500] pblittle: jschneiderhan: https://raw.github.com/gist/1827184
[2012-02-14 14:48:00 -0500] pblittle: jschneiderhan: After looking at it with fresh eyes this morning, I don't think node_name should be defined given I am creating new nodes.
[2012-02-14 14:49:00 -0500] lflux: BryanWB: except that people outside the US would have a hard time getting the joke
[2012-02-14 14:50:00 -0500] BryanWB: lflux: of course, but i love foreign names like Ubuntu, and there could be a joke there :)
[2012-02-14 14:52:00 -0500] jschneiderhan: pblittle: try this out - log in to the chef-server management console
[2012-02-14 14:52:00 -0500] jschneiderhan: and go to the client's tab
[2012-02-14 14:52:00 -0500] jschneiderhan: and "edit permissions"
[2012-02-14 14:53:00 -0500] pblittle: jschneiderhan: I'm with you..
[2012-02-14 14:53:00 -0500] jschneiderhan: and make sure that the validator client has "create" permission
[2012-02-14 14:54:00 -0500] pblittle: jschneiderhan: he didn't. does now. wow, how did I over look that one. anything else before I rerun?
[2012-02-14 14:54:00 -0500] jschneiderhan: not that I can think of
[2012-02-14 14:54:00 -0500] jschneiderhan: if that works - check out this link: http://wiki.opscode.com/display/chef/Common+Errors
[2012-02-14 14:55:00 -0500] pblittle: jschneiderhan: will do. thank you.
[2012-02-14 14:56:00 -0500] jschneiderhan: the section on global permissions under the "403 Forbidden" heading describes the same type of permission issue, only with nodes instead of clients
[2012-02-14 14:57:00 -0500] jschneiderhan: also i don't think specifying the node_name at request time is an issue - working off memory here but I think at one time I was doing that to make sure the node name matched my ec2 instance id
[2012-02-14 14:57:00 -0500] jschneiderhan: but someone else can probably confirm that for you
[2012-02-14 15:15:00 -0500] auduny: Hm. Remote_Directory I can set owner to files, but subdirectories are always owned by root?
[2012-02-14 15:15:00 -0500] auduny: WHat am I doing wrong?
[2012-02-14 15:16:00 -0500] yfeldblum: auduny, have you tried setting owner and group on the remote_document resource?
[2012-02-14 15:17:00 -0500] auduny: Remote_document?
[2012-02-14 15:18:00 -0500] yfeldblum: remote_directory, sorry
[2012-02-14 15:19:00 -0500] auduny: I set a source, owner, group files_owner and files_group
[2012-02-14 15:20:00 -0500] auduny: But subdirectories are always root:root, even though all those I listed are set to another user.
[2012-02-14 15:20:00 -0500] yfeldblum: auduny, well then, two things: open a ticket at tickets.opscode.com, and immediately after the remote_directory resource make a ruby_block resource and inside the block attribute, walk through that directory yourself setting all the subdirectories' owners & groups (using FileUtils.chown)
[2012-02-14 15:22:00 -0500] `brendan: morning
[2012-02-14 15:27:00 -0500] yfeldblum: auduny, something like this (untested): http://pastie.org/private/2nssumjc7gwzrt4kpqcwfg
[2012-02-14 15:27:00 -0500] CaptTofu: argh,I feel like my hands are tied I know what I want the code to do but am new to ruby
[2012-02-14 15:27:00 -0500] CaptTofu: syntax error, unexpected $end, expecting kEND
[2012-02-14 15:27:00 -0500] CaptTofu: simple if/elsif/end block
[2012-02-14 15:27:00 -0500] CaptTofu: else if, that is
[2012-02-14 15:28:00 -0500] gmcinnes: no, you were right the first time.
[2012-02-14 15:28:00 -0500] CaptTofu: h, right
[2012-02-14 15:29:00 -0500] CaptTofu: duh, right...
[2012-02-14 15:37:00 -0500] yfeldblum: heh
[2012-02-14 16:31:00 -0500] gmcinnes: ahoy chefs
[2012-02-14 16:32:00 -0500] yfeldblum: ahoy
[2012-02-14 16:43:00 -0500] gerardc: Looking at the REST interface, but would just like someone to confirm: Theres no way to append to a databag item is there? They can only be written in their entirety?
[2012-02-14 16:45:00 -0500] gerardc: poo :(
[2012-02-14 16:45:00 -0500] jtimberman: gerardc: correct
[2012-02-14 16:48:00 -0500] yfeldblum: gerardc, why?
[2012-02-14 16:48:00 -0500] gerardc: How stupid an idea is this. Have two databag items in the apps databag, 1 called my_app and another called my_app_encrypted, and monkey patch search(:app) so that it retrieves the corresponding _encrypted item for each result, decrypts it, and merges it into the regular one? The goal being to pass a single databag item to the application recipes but still have passwords etc. encrypted.
[2012-02-14 16:48:00 -0500] yfeldblum: gerardc, bad
[2012-02-14 16:49:00 -0500] yfeldblum: gerardc, if you have two data bag items that are related to each other, change the normal code to find the two data bag items and to understand how to use them
[2012-02-14 16:49:00 -0500] gerardc: I guess, but from my reading of the recipes, application cookbook requires a single uber databag item, but that means plaintext passwords in version control, and that seems worse.
[2012-02-14 16:49:00 -0500] yfeldblum: gerardc, you can patch the community application cookbook
[2012-02-14 16:50:00 -0500] jtimberman: so, the application cookbook was written long before encrypted data bags were created.
[2012-02-14 16:50:00 -0500] jtimberman: COOK-634 is to be fixed before we start adding new features / functionality, though.
[2012-02-14 16:51:00 -0500] yfeldblum: gerardc, you can also create a readonly user with a randomly generatd password (`require "securerandom" ; SecureRandom.hex(16)`)
[2012-02-14 16:51:00 -0500] gerardc: I could try, but Im not very experienced, and I think it would be quite a big patch given that the recipes all start with a search(:apps). i thought that at least this way my patch would be localised and upfront. Once complete the application cookbook can just crack on as per normal?
[2012-02-14 16:51:00 -0500] jtimberman: iirc, that ticket is in the next dev sprint though.
[2012-02-14 16:51:00 -0500] yfeldblum: gerardc, it's a very bad idea because you have no idea what else that patch would affect and there is probably little way to limit its effects
[2012-02-14 16:52:00 -0500] yfeldblum: gerardc, it's the wrong place to build an abstraction, and whenever anyone tries to build an abstraction in the wrong place because it was easier, it always comes back to bite them in the behind
[2012-02-14 16:52:00 -0500] gmcinnes: hey y'all.  Can anyone explain the purpose of this line: https://github.com/opscode/cookbooks/blob/master/chef-client/recipes/config.rb#L28
[2012-02-14 16:53:00 -0500] gmcinnes: I get what it does, but can you essplain me why it does it?
[2012-02-14 16:53:00 -0500] gerardc: yfeldblum: Sorry, I dont understand how and where the readonly user comes in to solve this problem? Could you ellaborate?
[2012-02-14 16:54:00 -0500] yfeldblum: gerardc, what version control are you using?
[2012-02-14 16:54:00 -0500] gerardc: git
[2012-02-14 16:55:00 -0500] yfeldblum: gerardc, internal? hosted somewhere that lets you do deploy keys?
[2012-02-14 16:56:00 -0500] gerardc: jtimberman: Would you hazard a guess at how long it might be before the cookbook is updated to use encrypted bags? I mean months or years? If the former I might just accept plaintext passwords for the moment...
[2012-02-14 16:56:00 -0500] gerardc: github
[2012-02-14 16:56:00 -0500] gerardc: private
[2012-02-14 16:57:00 -0500] yfeldblum: gerardc, why not use a deploy key?
[2012-02-14 16:58:00 -0500] yfeldblum: gerardc, it's a new keypair solely for the purpose of deploying the app, and it's no-one else's keypair
[2012-02-14 16:58:00 -0500] gerardc: yfeldblum: Oh I see what you mean. I will, but Im thinking of the database passwords, etc.
[2012-02-14 17:00:00 -0500] yfeldblum: gerardc, gotcha, what specific threats are you trying to protect the db creds against?
[2012-02-14 17:02:00 -0500] gerardc: yfeldblum: I cant say I am exceptionally worried about someone accessing the db, no more so than general concerns about the whole servers security, but I am just really struggling with putting DB root and user passwords in plaintext in version control. Feels so wrong.
[2012-02-14 17:03:00 -0500] theozaurus: Hi, I'm having a bit of trouble updating my scripts to work with Chef 0.10.8 from 0.9.14 (I know). We used to use the `expand!` method in the attribute files to make sure that any reference to a value included overrides. For instance if I set:
[2012-02-14 17:03:00 -0500] bdha: Encrypted databag?
[2012-02-14 17:03:00 -0500] theozaurus: Sorry, hit enter too early!
[2012-02-14 17:03:00 -0500] yfeldblum: gerardc, why are you putting data bag items in version control?
[2012-02-14 17:03:00 -0500] theozaurus: Has anyone else used expand! and know how I can get similar functionality in 0.10.8
[2012-02-14 17:04:00 -0500] gerardc: yfeldblum: Is that not standard? I mean, the databag drives the application cookbook, so team members would need it to manage from their own workstations. Is it generally envisaged that the contents of /databags is distributed manually? (Im still new to this)
[2012-02-14 17:05:00 -0500] gmcinnes: gerardc: it is possible to store what you need in encrypted databags, isn't it? I mean, that's how I store my db passwords. And users keypairs etc.
[2012-02-14 17:06:00 -0500] yfeldblum: gerardc, many people do keep their data bag items in version control; i prefer to think of it more like records in a database, e.g. i don't keep app users in version control, i keep them in a users table
[2012-02-14 17:06:00 -0500] gerardc: gmcinnes: Well, not in this case, not without making what i think would be substantial changes to the the application and database cookbooks which I dont feel ready for at the moment ...
[2012-02-14 17:06:00 -0500] yfeldblum: gmcinnes, you cannot search an encrypted data bag
[2012-02-14 17:06:00 -0500] yfeldblum: gmcinnes, the application cookbook makes use of search
[2012-02-14 17:07:00 -0500] gerardc: yfeldblum: you can search the keys, no?
[2012-02-14 17:07:00 -0500] yfeldblum: gerardc, don't know, but don't see how that would help
[2012-02-14 17:07:00 -0500] gmcinnes: gerardc: your call, but I think in the end modifiying them will be easier than monkey patching search etc.
[2012-02-14 17:09:00 -0500] yfeldblum: gerardc, regarding your question as to what is generally envisaged: i think that it is generally envisaged that you will be writing a large chunk of the cookbooks you use, and that the community cookbooks are there to serve as resources for you to learn from in the general case, and reusable components in those cases where it is easy to reuse them
[2012-02-14 17:10:00 -0500] gerardc: Does anyone with famliarity with these recipes have suggestions about the modifications? I dont really see how to do it. They just go searching for all items in the :apps databag and then check for ones that match a server role and do stuff with them. Trying to split that to work with 2 databags (one regular, 1one encrypted) seems tough to me.
[2012-02-14 17:13:00 -0500] yfeldblum: gerardc, how many applications do you have to deploy?
[2012-02-14 17:15:00 -0500] gerardc: yfeldblum: At the moment just the one. This is a first foray into Chef, for what we expect will be an app requiring many servers.
[2012-02-14 17:18:00 -0500] gmcinnes: gerardc: what kind of app is it?
[2012-02-14 17:18:00 -0500] gmcinnes: I mean, ruby, php, java?
[2012-02-14 17:19:00 -0500] yfeldblum: gerardc, when i first looked at the opscode application cookbook, i took that as reference material and used it to figure out how to write my own very simple cookbook just for deploying the one app, without all the abstractions or restrictions surrounding the opscode application cookbook
[2012-02-14 17:19:00 -0500] gerardc: ruby on rails
[2012-02-14 17:19:00 -0500] gmcinnes: oh, then your database.yml will have the db password in plaintext anyway :)
[2012-02-14 17:20:00 -0500] gerardc: fair point
[2012-02-14 17:20:00 -0500] gmcinnes: Do you want to pastie what you have into a gist, and I'll see if I can get you started on how to modify it?
[2012-02-14 17:20:00 -0500] gmcinnes: anonymize your passwords, obviously.
[2012-02-14 17:21:00 -0500] gerardc: gmcinnes: Oh I can get the thing to deploy okay (finally), I just came to ask for adivice specifically about how I could try and get the cookbooks to use encrypted databgs. Thanks though.
[2012-02-14 17:23:00 -0500] gerardc: So far my only proposed solution, as mentioned above, is to have 2 databag items, decrypt the encrypted one, merge it into the other, and let the recipes use that.
[2012-02-14 17:23:00 -0500] gerardc: I take the point about monkey patching search though. Thats clearly risky.
[2012-02-14 17:23:00 -0500] gmcinnes: gerardc: fair enough. yfeldblum is right.  You have the correct idea, just don't modify search. Have two cookbooks as you suggest, and  look up the encrypted stuff you need from a unique key you discover in the unencrypted one.
[2012-02-14 17:24:00 -0500] gmcinnes: It won't be as hard as you think :)
[2012-02-14 17:24:00 -0500] gerardc: But it seems the consensus is to write my own cookbook :O
[2012-02-14 17:24:00 -0500] jtimberman: gmcinnes: in answer to your question about chef-client::config, line 28 is there to ensure that the node_name used is consistent when it writes the config.
[2012-02-14 17:24:00 -0500] jtimberman: gmcinnes: since the configuration file that is dropped off by using say, `knife bootstrap` is different
[2012-02-14 17:25:00 -0500] gmcinnes: right.
[2012-02-14 17:27:00 -0500] gmcinnes: so I have this weird issue going on where that recipe declines to put a node_name in my client.rb.  Fine.  But without it some of the nodes don't seem to be able to access chef_server.
[2012-02-14 17:27:00 -0500] gmcinnes: I'll go see what ohai says for fqdn
[2012-02-14 17:31:00 -0500] gerardc: thanks for advise all. i'll probably be back tomorrow with the same and more questions.
[2012-02-14 17:39:00 -0500] caaakeeey: im looking at auto scaling using chef - im considering either using user data to supply a role, and then using chef to configure the instance, or on a chef repo push, baking an instance automatically and using that... any advice?
[2012-02-14 18:06:00 -0500] sivy: is api.opscode.com down for anyone else?
[2012-02-14 18:06:00 -0500] sivy: or is it just me?
[2012-02-14 18:07:00 -0500] caaakeeey: im looking at auto scaling using chef - im considering either using user data to supply a role, and then using chef to configure the instance, or on a chef repo push, baking an instance automatically and using that... any advice?
[2012-02-14 18:08:00 -0500] ryker: sivy: I don't use hosted chef, but I can ping api.opscode.com.  Though I can't telnet to port 4000, which I assume is the right port for the api
[2012-02-14 18:09:00 -0500] sivy: ryker: yeah, looks like it might be a vpn thing on my end
[2012-02-14 18:11:00 -0500] yfeldblum: no, the API is on port 443, which is the default HTTPS port
[2012-02-14 18:11:00 -0500] agrajag: Anyone have any preferred way of managing /etc/aliases entries? I just want a clean way to append a few things to every client and then newalias but not do a file or template push overtop the pre-existing ones
[2012-02-14 18:11:00 -0500] ryker: yfeldblum: ah ok. yep. port 443 is listening fine. :)
[2012-02-14 18:14:00 -0500] ryker: agrajag: search the chef-users mail list.  there's been a quite a few questions about that.  search the list for Util::FileEdit.
[2012-02-14 18:18:00 -0500] ryker: i'm having a really stupid problem using knife search.  It works with a wildcard, but not when I specify something.  Anyone have any idea?  https://gist.github.com/216f29d23b4a4aa61241
[2012-02-14 18:22:00 -0500] ryker: agrajag: someone also wrote this lwrp for managing conf files: https://github.com/gecos-team/cookbook-conf
[2012-02-14 18:23:00 -0500] agrajag: ryker, Thanks much, looking now
[2012-02-14 18:23:00 -0500] ryker: yw
[2012-02-14 18:24:00 -0500] nect: my chef-solo-config.rb has a role_path ["/one/dir", "/two/dir", "/three/dir"] and when I add a role[anything] into the runlist, the role is not found in the /third/dir.. is there a way to have multi-role path for a chef-solo run?
[2012-02-14 18:26:00 -0500] jtimberman: ryker: the port is 443 :)
[2012-02-14 18:27:00 -0500] ryker: jtimberman: yeah, yfeldblum bloom already set me straight. :)
[2012-02-14 18:31:00 -0500] nect: the strange thing is, having multiple role paths works on the chef-client run.. although /one/dir and /two/dir exist, whereas in my example, they are broken and only /third/dir is valid
[2012-02-14 18:38:00 -0500] hcastro: what is the process for cookbooks from opscode/cookbooks to make it into the community site?
[2012-02-14 18:39:00 -0500] mattray: hcastro: usually one of the maintainers has to do a "knife cookbook site share"
[2012-02-14 18:39:00 -0500] mattray: hcastro: are you waiting on a merge?
[2012-02-14 18:40:00 -0500] hcastro: no, i was just wondering how that was connected to the jira tickets
[2012-02-14 18:40:00 -0500] hcastro: so basically it comes down to when the maintainer is ready to cut a new version?
[2012-02-14 18:41:00 -0500] mattray: yeah
[2012-02-14 18:41:00 -0500] mattray: so if there's a cookbook on the community site with "Opscode" listed as the maintainer, issues are being resolved through Jira
[2012-02-14 18:41:00 -0500] mattray: the GitHub opscode/cookbooks may be ahead of the community site
[2012-02-14 18:42:00 -0500] hcastro: and that isn't tied to knife or chef releases right?
[2012-02-14 18:42:00 -0500] mattray: no
[2012-02-14 18:42:00 -0500] mattray: knife is tied to chef releases
[2012-02-14 18:42:00 -0500] mattray: but cookbooks are independent
[2012-02-14 18:43:00 -0500] mattray: ohai is also independent
[2012-02-14 18:43:00 -0500] mattray: as are knife plugins
[2012-02-14 18:43:00 -0500] hcastro: i appreciate the explaination
[2012-02-14 18:51:00 -0500] agrajag: ryker, that lwrp Looks like exactly what I want, thanks again
[2012-02-14 18:51:00 -0500] ryker: agrajag: yw
[2012-02-14 18:54:00 -0500] nect: looking at the lib/chef/role.rb -> self.from_file -> there is only one role path allowed
[2012-02-14 18:54:00 -0500] nect: I'll send in a feature req
[2012-02-14 19:04:00 -0500] jtimberman: ohai
[2012-02-14 19:04:00 -0500] coderanger: Hi
[2012-02-14 19:04:00 -0500] jbz: ohai
[2012-02-14 19:05:00 -0500] gmcinnes: howdy
[2012-02-14 19:06:00 -0500] till_: when i want to 'install' code that's located in a git repo
[2012-02-14 19:06:00 -0500] till_: would i still use the deploy resource?
[2012-02-14 19:06:00 -0500] jbz: till_: You use the deploy resource when you want to perform a capistrano-like deployment of code in the repo.
[2012-02-14 19:08:00 -0500] till_: jbz: i think i am looking for the 'git' resource
[2012-02-14 19:08:00 -0500] till_: yay
[2012-02-14 19:11:00 -0500] BryanWB: peter donald around?
[2012-02-14 19:17:00 -0500] df11: Having a scoping issue with a variable used in a not_if with a ruby block.  Prior to the reuby_block in the recipe I am setting a variable, have tested to make sure it exists using puts.  But, the not_if is not evaluating.  Any guidance for these types of scoping issues?
[2012-02-14 19:17:00 -0500] savant: Hi all
[2012-02-14 19:18:00 -0500] savant: I have this awesome code that updates a mysql user password
[2012-02-14 19:18:00 -0500] savant: but sometimes it fails because the first user hasnt been setup
[2012-02-14 19:18:00 -0500] savant: and so either you run the mysql command with a password or without
[2012-02-14 19:18:00 -0500] savant: in any case
[2012-02-14 19:18:00 -0500] sivy: couple someone please explain vagrant networking to me? I just need the box to be able to access the outside world and be able to access the VM from my workstation
[2012-02-14 19:18:00 -0500] savant: i chucked the execute command in a begin/rescue/end block
[2012-02-14 19:18:00 -0500] savant: but its a fatal error from chef
[2012-02-14 19:18:00 -0500] savant: so it just breaks out anyhow
[2012-02-14 19:19:00 -0500] savant: any way in which I can let this command silently fail?
[2012-02-14 19:20:00 -0500] flashmanbahadur1: ignore_failure true   doesn work?
[2012-02-14 19:20:00 -0500] savant: woah
[2012-02-14 19:20:00 -0500] savant: didnt know about that
[2012-02-14 19:21:00 -0500] flashmanbahadur1: http://wiki.opscode.com/display/chef/Resources
[2012-02-14 19:21:00 -0500] savant: yeah
[2012-02-14 19:21:00 -0500] savant: i see it now
[2012-02-14 19:21:00 -0500] savant: thanks
[2012-02-14 19:21:00 -0500] savant: :)
[2012-02-14 19:21:00 -0500] flashmanbahadur1: np
[2012-02-14 19:25:00 -0500] frank_: is include_recipe default-scoped to the current cookbook?
[2012-02-14 19:26:00 -0500] frank_: eg will include_recipe "foo" be the same as include_recipe "mycookbook:foo"?
[2012-02-14 19:26:00 -0500] frank_: s/:/:: on that last one
[2012-02-14 19:27:00 -0500] savant: is there a way to swallow error output
[2012-02-14 19:27:00 -0500] savant: ignore_failure is cool and all
[2012-02-14 19:27:00 -0500] savant: but it still spits out bs
[2012-02-14 19:52:00 -0500] mlei: anyone know the cause of this: /usr/lib64/ruby/gems/1.8/gems/chef-0.10.8/lib/chef/checksum_cache.rb:174: [BUG] Segmentation fault
[2012-02-14 19:52:00 -0500] mlei: seems to happen randomly when running knife on cookbooks... next time it runs it's fine.
[2012-02-14 19:58:00 -0500] jbz: Is this on ubuntu?  People were talking about this a while back
[2012-02-14 19:59:00 -0500] mlei: no, it's centos
[2012-02-14 19:59:00 -0500] mlei: with ruby 1.8.7p352
[2012-02-14 20:00:00 -0500] jbz: mlei: There is this: http://tickets.opscode.com/browse/CHEF-2916
[2012-02-14 20:00:00 -0500] flashmanbahadur1: I have seen Seg faults as well
[2012-02-14 20:00:00 -0500] flashmanbahadur1: random, on ruby 1.8.7
[2012-02-14 20:00:00 -0500] jbz: dunno if that's what's happening to you
[2012-02-14 20:00:00 -0500] flashmanbahadur1: debatting changing knife to bootstrap 1.9.3 instead
[2012-02-14 20:01:00 -0500] mlei: it's not the same place, but i think i've seen this one too
[2012-02-14 20:02:00 -0500] jbz: Also http://tickets.opscode.com/browse/CHEF-2692
[2012-02-14 20:03:00 -0500] flashmanbahadur1: mine is usually with unix.rb
[2012-02-14 20:03:00 -0500] jbz: that latter one has a note at the end asking for anyone with segfaults in 1.8 to tell them
[2012-02-14 20:04:00 -0500] mlei: yes. how do i do that, just file an issue and cc btm?
[2012-02-14 20:04:00 -0500] savant: so before 0.10, chef was relatively quiet about output
[2012-02-14 20:04:00 -0500] savant: unless it did something
[2012-02-14 20:04:00 -0500] savant: why is that no longer the case in 0.10.8?
[2012-02-14 20:04:00 -0500] savant: I'm running chef-solo
[2012-02-14 20:05:00 -0500] jbz: There was a deliberate change to the logging verbosity.  Don't ask me why, I preferred the old way.
[2012-02-14 20:05:00 -0500] jbz: There was a bunch of discussion when it happened.
[2012-02-14 20:05:00 -0500] jtimberman: savant: you can make it less verbose by setting "verbose_logging false" in the configuration.
[2012-02-14 20:06:00 -0500] jbz: But beware:  That will take logging to a level *below that* of what it used to be.
[2012-02-14 20:06:00 -0500] savant: I just want to know the reasons
[2012-02-14 20:06:00 -0500] jtimberman: discussion here: http://tickets.opscode.com/browse/CHEF-2179
[2012-02-14 20:06:00 -0500] savant: ah okay
[2012-02-14 20:06:00 -0500] jtimberman: The reason for more verbosity is because it wasn't entirely clear where Chef might be encountering an error based on the default log output
[2012-02-14 20:07:00 -0500] jtimberman: I agree that the new logging is too verbose, as I opened that ticket :)
[2012-02-14 20:07:00 -0500] savant: well if it output an error
[2012-02-14 20:07:00 -0500] savant: thats what the chef stacktrace is for
[2012-02-14 20:07:00 -0500] jbz: jtimberman: Ah, hadn't seen thatdoes verbose_logging off restore 0.9.x log levls?
[2012-02-14 20:08:00 -0500] jtimberman: basically
[2012-02-14 20:08:00 -0500] savant: only basically?
[2012-02-14 20:08:00 -0500] jtimberman: it removes the "PRocessing resource" messages
[2012-02-14 20:08:00 -0500] savant: all of them?
[2012-02-14 20:08:00 -0500] bawt: all of them are like that
[2012-02-14 20:08:00 -0500] jtimberman: lol
[2012-02-14 20:08:00 -0500] jtimberman: !botsnack
[2012-02-14 20:08:00 -0500] bawt: jtimberman: =D
[2012-02-14 20:08:00 -0500] savant: or just the ones that dont do anything
[2012-02-14 20:08:00 -0500] jtimberman: bawt: forget all of them
[2012-02-14 20:08:00 -0500] bawt: aight
[2012-02-14 20:08:00 -0500] savant: this is bullshit
[2012-02-14 20:09:00 -0500] savant: logging should have stayed as is
[2012-02-14 20:09:00 -0500] jtimberman: savant: i don't recall if it prints the message if the resource changes.
[2012-02-14 20:09:00 -0500] jtimberman: i do'nt think it does
[2012-02-14 20:09:00 -0500] savant: "log_level get_off_my_lawn" if they want the full output
[2012-02-14 20:09:00 -0500] jbz: hahaha get_off_my_lawn
[2012-02-14 20:09:00 -0500] jtimberman: savant: that is a joke.
[2012-02-14 20:09:00 -0500] savant: fuck now idk what is actually changing
[2012-02-14 20:10:00 -0500] savant: assholes
[2012-02-14 20:10:00 -0500] jbz: whoa chill
[2012-02-14 20:10:00 -0500] savant: lol
[2012-02-14 20:10:00 -0500] jtimberman: O.o ?
[2012-02-14 20:10:00 -0500] savant: gonna fork chef
[2012-02-14 20:10:00 -0500] savant: and call it something else
[2012-02-14 20:10:00 -0500] savant: perhaps related to marionettes
[2012-02-14 20:10:00 -0500] jbz: bork?
[2012-02-14 20:10:00 -0500] jbz: hahaha
[2012-02-14 20:12:00 -0500] jtimberman: erm
[2012-02-14 20:14:00 -0500] aslan: hey guys i am getting this error in my chef server : merb : chef-server (api) : worker (port 4000) ~ NoMethodError: undefined method `closed?' for nil:NilClass - (Chef::Exceptions::SolrConnectionError)
[2012-02-14 20:14:00 -0500] aslan: i restarted merb but this looks like a solr issue
[2012-02-14 20:14:00 -0500] aslan: what should i do?
[2012-02-14 20:18:00 -0500] mlei: aslan: this a new install?
[2012-02-14 20:18:00 -0500] aslan: no it was always working
[2012-02-14 20:18:00 -0500] aslan: today i had to spin up a bunch of new servers not a lot
[2012-02-14 20:18:00 -0500] aslan: and i noticed solr is not responding
[2012-02-14 20:50:00 -0500] mattray: aslan: sounds familiar, lemme go check tickets.opscode.com
[2012-02-14 20:51:00 -0500] aslan: mattray: thanks a lot... i did a /etc/init.d/chef-solr restart and that fixed it
[2012-02-14 20:51:00 -0500] mattray: aslan: 0.10.8?
[2012-02-14 20:52:00 -0500] aslan: mattray: 0.9.18
[2012-02-14 20:52:00 -0500] mattray: oh.
[2012-02-14 20:53:00 -0500] mattray: you might want to hit the search and look through the results for "SolrConnectionError" for fixes if it continues to be wonky http://tickets.opscode.com/secure/QuickSearch.jspa
[2012-02-14 20:57:00 -0500] aslan: mattray: thanks i will checkout the ticket
[2012-02-14 21:00:00 -0500] BryanWB: mattray, the ironfan cookbooks all use the "action" resource/definition, any idea where it is defined?
[2012-02-14 21:02:00 -0500] mattray: nope
[2012-02-14 21:02:00 -0500] mlei: oh btw mattray, the empty data bag thing you helped me debug was caused by this: CHEF-2926
[2012-02-14 21:02:00 -0500] mlei: http://tickets.opscode.com/browse/CHEF-2926
[2012-02-14 21:02:00 -0500] mattray: thanks for opening a ticket
[2012-02-14 21:02:00 -0500] BryanWB: garrh
[2012-02-14 21:15:00 -0500] zambaroo: hey guys
[2012-02-14 21:16:00 -0500] zambaroo: trying to use the application and database cookbooks to deploy a php app
[2012-02-14 21:16:00 -0500] zambaroo: i keep getting an error from the database cookbook:  FATAL: NoMethodError: undefined method `database_name' for Chef::Resource::MysqlDatabase
[2012-02-14 21:17:00 -0500] zambaroo: im going through the apps database and through the roles - i think ive done everything according to the readme
[2012-02-14 21:18:00 -0500] zambaroo: wondering what i am doing wrong
[2012-02-14 21:18:00 -0500] zambaroo: s/apps database/apps databag
[2012-02-14 21:20:00 -0500] gale: Hi, I'm using the community version of the apache cookbook, is there a way to upgrade the version of apache I've got? I'm running debian I know how to do it without chef of course but what's the best way to use chef to upgrade those packages
[2012-02-14 21:20:00 -0500] gale: or have I missed the point somewhere?
[2012-02-14 21:21:00 -0500] miah: because everybody has different policies, its best left to 'you build a cookbook that manages package upgrades'
[2012-02-14 21:23:00 -0500] miah: the apache cookbook can still manage your installation, but you could have another cookbook that upgrades packages on your systems
[2012-02-14 21:24:00 -0500] gale: miah: okay, so use http://community.opscode.com/cookbooks/apt as a base for example?
[2012-02-14 21:24:00 -0500] miah: ya
[2012-02-14 21:25:00 -0500] gale: miah: that makes sense actually could end up in all sorts of trouble otherwise
[2012-02-14 21:25:00 -0500] gale: miah: thanks
[2012-02-14 21:25:00 -0500] miah: yup
[2012-02-14 21:25:00 -0500] sivy: hello all; i'm trying to configure a git resource that pulls from a private bitbucket repo, and can't seem to get the authentication working
[2012-02-14 21:26:00 -0500] miah: i usually just include nginx cookbook in my cookbook that manages my nginx site configurations
[2012-02-14 21:26:00 -0500] sivy: i could have sworn I had this working once before for a github repo
[2012-02-14 21:26:00 -0500] miah: and it handles updates
[2012-02-14 21:26:00 -0500] sivy: but i'm struggling now
[2012-02-14 21:59:00 -0500] savant: no journal files
[2012-02-14 21:59:00 -0500] savant: so what I do is I flush all writes to disk
[2012-02-14 21:59:00 -0500] savant: wrong channel!
[2012-02-14 21:59:00 -0500] savant: :P
[2012-02-14 22:08:00 -0500] geekbri: sivy: are you using a git SSH wrapper?
[2012-02-14 22:08:00 -0500] sivy: geekbri: yeah
[2012-02-14 22:08:00 -0500] sivy: https://gist.github.com/910ca0c4c48705b26243 <-- my setup
[2012-02-14 22:09:00 -0500] sivy: hm, that's missing the ssh wraper config
[2012-02-14 22:10:00 -0500] miah: STDERR: Permission denied (publickey,gssapi-with-mic,password).
[2012-02-14 22:10:00 -0500] miah: looks like its missing your ssh keys
[2012-02-14 22:11:00 -0500] sivy: geekbri: ssh_wrapper "#{node['pushcode']['dir']}/github-ssh-wrapper" if node['deploy_key']
[2012-02-14 22:11:00 -0500] sivy: miah: the keys are there but for some reason is not using them
[2012-02-14 22:12:00 -0500] sivy: I don't know how to determine what user that resource is actually running as
[2012-02-14 22:14:00 -0500] ssd7: sivy: I assume that that ssh config block sets up some ssh config in the user's home directory?
[2012-02-14 22:14:00 -0500] sivy: (updated the gist with the newest info)
[2012-02-14 22:14:00 -0500] Otterley: I have a bit of a chicken/egg problem - I need to condition recipe execution on an lspci invocation, but some hosts might not have lspci until the pciutils package has been installed.  How can I make this work properly?
[2012-02-14 22:15:00 -0500] mlei: recipe execution in general?
[2012-02-14 22:15:00 -0500] Otterley: does only_if defer properly?
[2012-02-14 22:15:00 -0500] sivy: ssd7: yes, it adds a host config in ssh/config
[2012-02-14 22:15:00 -0500] Otterley: mlei: no, just a specific recipe (sets up fusionio drivers on hosts that only have the card installed)
[2012-02-14 22:17:00 -0500] Otterley: if I wrap the recipe in an "if" block, the block gets executed too early, i.e., before the pciutils package has been installed
[2012-02-14 22:24:00 -0500] Micgo: Hi all... I'm having trouble using the " knife role create" command on Windows... I set my EDITOR to notepad as a test and it's not updating the actual role once I save my edits...
[2012-02-14 22:25:00 -0500] mlei: you may have to quit out of notepad for it to notice
[2012-02-14 22:25:00 -0500] Micgo: Ah! That got it... thanks!
[2012-02-14 22:26:00 -0500] mlei: Micgo: np
[2012-02-14 22:26:00 -0500] savant: can I have recipes inside folders?
[2012-02-14 22:26:00 -0500] savant: for example
[2012-02-14 22:27:00 -0500] savant: cookbook_name/recipes/datastores/redis.rb
[2012-02-14 22:27:00 -0500] savant: cookbook_name/recipes/datastores/mysql.rb
[2012-02-14 22:27:00 -0500] savant: etc.
[2012-02-14 22:27:00 -0500] savant: ?
[2012-02-14 22:29:00 -0500] jbz: savant: I think that will confuse things.  But I'm not positive.
[2012-02-14 22:29:00 -0500] savant: so at my company (seatgeek)
[2012-02-14 22:29:00 -0500] savant: we have a custom "seatgeek" cookbook
[2012-02-14 22:30:00 -0500] savant: with our stuff hardcoded (this was before roles) with stuff pertinent to certain types of machines
[2012-02-14 22:30:00 -0500] savant: now i've refactored it so a backup machine consists of multiple datastores, a webserver, etc.
[2012-02-14 22:30:00 -0500] savant: but those are still seatgeek specific
[2012-02-14 22:30:00 -0500] savant: so I'd like to have
[2012-02-14 22:30:00 -0500] savant: seatgeek/recipes/datastores/*
[2012-02-14 22:30:00 -0500] savant: seatgeek/recipes/services/*
[2012-02-14 22:30:00 -0500] savant: etc.
[2012-02-14 22:31:00 -0500] mlei: why not have cookbooks called seatgeek_datastores, seatgeek_services
[2012-02-14 22:31:00 -0500] mlei: seems less confusing.
[2012-02-14 22:32:00 -0500] savant: more folders?
[2012-02-14 22:32:00 -0500] jbz: yeah, that seems a much better plan.
[2012-02-14 22:32:00 -0500] savant: okay
[2012-02-14 22:32:00 -0500] jbz: Yeah, but remember in chef the 'cookbook' is the efficient unit.
[2012-02-14 22:32:00 -0500] savant: i'll take that into consideration :D
[2012-02-14 22:32:00 -0500] savant: hmm
[2012-02-14 22:32:00 -0500] savant: i guess
[2012-02-14 22:33:00 -0500] jbz: Also, if they're all in one cookbook, you have to upload *EVERYTHING* again when you touch anything, which is much riskier.
[2012-02-14 22:33:00 -0500] jbz: If nodes only run the subcookbooks they need, you can minimize risk of changes.
[2012-02-14 22:33:00 -0500] savant: rsync
[2012-02-14 22:34:00 -0500] savant: and then chef-solo just runs
[2012-02-14 22:34:00 -0500] savant: we're not at the point where i need to think about a chef server
[2012-02-14 22:34:00 -0500] jtimberman: savant: recipes cannot be in folders at this time
[2012-02-14 22:34:00 -0500] savant: k
[2012-02-14 23:18:00 -0500] hippiehacker: with file 'c:\foobar' do :delete end resource, it moves it to the recycle bin.... shouldn't it :delete it?
[2012-02-14 23:25:00 -0500] gondoi: hey jtimberman do you know if there is any plan to add repos to the installs used in the chef-full.erb bootstrap file?
[2012-02-14 23:25:00 -0500] jtimberman: hippiehacker: it uses Ruby's File.delete
[2012-02-14 23:25:00 -0500] jtimberman: hippiehacker: so wahtever that does.
[2012-02-14 23:25:00 -0500] jtimberman: gondoi: what do you mean?
[2012-02-14 23:26:00 -0500] gondoi: to allow for easy updating of the package install
[2012-02-14 23:26:00 -0500] jtimberman: gondoi: rerunning the install.sh will update the package install.
[2012-02-14 23:26:00 -0500] gondoi: so something like a yum-cron or yum upgrade will update to the newest.. etc
[2012-02-14 23:26:00 -0500] gondoi: hmmm
[2012-02-14 23:26:00 -0500] gondoi: okay
[2012-02-14 23:26:00 -0500] gondoi: thanks
[2012-02-14 23:26:00 -0500] jtimberman: i'm not aware of any plans to put them in any package repos
[2012-02-14 23:26:00 -0500] gondoi: okay, thanks
[2012-02-14 23:26:00 -0500] jtimberman: btm would have more words on that topic
[2012-02-14 23:26:00 -0500] jtimberman: if there are more words
[2012-02-14 23:26:00 -0500] gondoi: :D
[2012-02-14 23:27:00 -0500] Otterley: anyone have any feedback about my chicken-egg problem?
[2012-02-14 23:29:00 -0500] mlei: could you just install pciutils as a matter of course with :immediately?
[2012-02-14 23:30:00 -0500] mlei: somewher?
[2012-02-14 23:30:00 -0500] mlei: e
[2012-02-14 23:30:00 -0500] Otterley: it is installed in an earlier-running recipe
[2012-02-14 23:30:00 -0500] mlei: before your conditional?
[2012-02-14 23:30:00 -0500] mlei: right, yeah, but in the normal cycle
[2012-02-14 23:30:00 -0500] mlei: not :immediately
[2012-02-14 23:30:00 -0500] Otterley: what is the "normal cycle"?
[2012-02-14 23:31:00 -0500] Otterley: I'm just doing package "pcituils" { action: install }
[2012-02-14 23:31:00 -0500] mlei: right that queues it to happen
[2012-02-14 23:31:00 -0500] mlei: but it doesn't actually make it happen until after your test, correct?
[2012-02-14 23:31:00 -0500] Otterley: correct
[2012-02-14 23:31:00 -0500] Otterley: what is the workaround then?
[2012-02-14 23:32:00 -0500] Otterley: I could system out, but that smells funny
[2012-02-14 23:32:00 -0500] mlei: actually i'm not sure. i guess :immediately is for notifications, so i'm not sure that would work.
[2012-02-14 23:33:00 -0500] Otterley: my current workaround is to install pciutils in a pre-Chef bootstrap script, I guess I'll continue with that
[2012-02-14 23:34:00 -0500] mlei: does it need to happen on the first chef run?
[2012-02-14 23:34:00 -0500] mlei: if you don't care about it happening right away, you could just have it test for lspci and just do nothing if it's not there.
[2012-02-14 23:35:00 -0500] Otterley: running Chef twice doesn't sound optimal to me :)
[2012-02-14 23:43:00 -0500] jtimberman: Otterley: stick the package in your bootstrap / provisioning system a la kickstart or preseed (or other)
[2012-02-14 23:44:00 -0500] Otterley: jtimberman: yeah
[2012-02-14 23:44:00 -0500] Otterley: that's what I'm already doing
[2012-02-14 23:44:00 -0500] jtimberman: Otterley: you can also possibly use the compile-phase installation
[2012-02-14 23:44:00 -0500] Otterley: what's that?
[2012-02-14 23:44:00 -0500] jtimberman: compile phase?
[2012-02-14 23:44:00 -0500] jtimberman: forgot the keyword for taht :)
[2012-02-14 23:44:00 -0500] jtimberman: http://wiki.opscode.com/display/chef/Evaluate+and+Run+Resources+at+Compile+Time
[2012-02-14 23:45:00 -0500] Otterley: the specific example is instructive, thanks
[2012-02-14 23:46:00 -0500] Otterley: one wouldn't want to do that specific thing, though, if you're changing the apt config in any recipes.
[2012-02-14 23:46:00 -0500] Otterley: further down the rabbit hole :)
[2012-02-14 23:46:00 -0500] jtimberman: systems management is hard :)
[2012-02-14 23:47:00 -0500] Otterley: let's go shopping
[2012-02-14 23:50:00 -0500] miah: lets get some shoes!
[2012-02-14 23:53:00 -0500] flashmanbahadur1: is there some guidance on how to use the path parameter in the execute resource
[2012-02-14 23:53:00 -0500] flashmanbahadur1: the docs dont have an example, and my usage of it passes compilation, but doesnt seem to change anything
[2012-02-14 23:54:00 -0500] RoboTeddy: flashmanbahadur1: it looks like paths contains an array of paths that will be searched for the command
[2012-02-14 23:54:00 -0500] flashmanbahadur1: I get that
[2012-02-14 23:54:00 -0500] flashmanbahadur1: and I did
[2012-02-14 23:54:00 -0500] flashmanbahadur1: path ["/home/ubuntu/.nvm/v#{nodejs_version}/bin"]
[2012-02-14 23:54:00 -0500] flashmanbahadur1: but, doesnt seem to help
[2012-02-14 23:54:00 -0500] flashmanbahadur1: still cant find npm, or node
[2012-02-14 23:56:00 -0500] RoboTeddy: I'm actually brand new at chef, but off the top of my head: it could be a permissions problem, or maybe there's a mistake in the path? (you could try printing it out and making sure it exists as evaluated)
[2012-02-14 23:56:00 -0500] flashmanbahadur1: the $PATH variable doesnt get changed by the path parameter
[2012-02-14 23:56:00 -0500] flashmanbahadur1: so I am not sure how to determine what i can see
[2012-02-14 23:56:00 -0500] flashmanbahadur1: and on the command line
[2012-02-14 23:56:00 -0500] flashmanbahadur1: I can use the commands fine
[2012-02-14 23:57:00 -0500] RoboTeddy: there's probably a cleaner way to do it, but you're working in ruby, so you could just: puts "/home/ubuntu/.nvm/v#{nodejs_version}/bin"
[2012-02-14 23:59:00 -0500] flashmanbahadur1: tried that too, my variable substitution is working, just the path isnt being searched
[2012-02-14 23:59:00 -0500] flashmanbahadur1: oh nevermind
[2012-02-14 23:59:00 -0500] flashmanbahadur1: I get it
[2012-02-14 23:59:00 -0500] flashmanbahadur1: path only is a place to look for the initial command you run
[2012-02-14 23:59:00 -0500] flashmanbahadur1: if it in turn calls out to another command
[2012-02-14 23:59:00 -0500] flashmanbahadur1: that one is on its own
[2012-02-14 23:59:00 -0500] RoboTeddy: aha, yeah
