[2012-02-02 08:36:00 -0500] d[-_-]b: UselessPacket#1
[2012-02-02 08:36:00 -0500] d[-_-]b: Opps sorry for wasting your bandwidth ><
[2012-02-02 09:36:00 -0500] nacer: ohai
[2012-02-02 09:48:00 -0500] BryanWB: ciao nacer :)
[2012-02-02 09:48:00 -0500] nacer: Bonjour BryanWB
[2012-02-02 10:27:00 -0500] atlaz: hey, anyone know how I set php.ini changes when installing via chef?
[2012-02-02 10:27:00 -0500] atlaz: struggling a little short of editing the php.ini.erb
[2012-02-02 10:29:00 -0500] gadolin: atlaz: pass input parameter with the recipe (variables: ) and the use them from within the erb
[2012-02-02 10:30:00 -0500] gadolin: http://wiki.opscode.com/display/chef/Templates
[2012-02-02 10:31:00 -0500] atlaz: cheers
[2012-02-02 10:35:00 -0500] gadolin: Is there any solution apart from cucumber-chef to introduce BDD, the cons about it are that it requires usage of hosted chef (while I am running private server), is this project alive?. I like the idea of using LXC instead of creating full blown deployment everytime.
[2012-02-02 11:19:00 -0500] arretsor: Can you use override_attributes in an environment specification to set a bash environment variable? e.g. export RAILS_ENV=staging
[2012-02-02 11:20:00 -0500] arretsor: And what would happen if a node was running two environments with conflicting RAILS_ENV I wonder?
[2012-02-02 11:23:00 -0500] yfeldblum: arretsor, each node in chef has a single chef-environment, which is by default set to "_default"
[2012-02-02 11:24:00 -0500] arretsor: right ... so thats not really a help to me if I want to run a staging and a production version of my app on a single node then, eh?
[2012-02-02 11:25:00 -0500] yfeldblum: arretsor, i would generally recommend against that anyway
[2012-02-02 11:26:00 -0500] arretsor: yfeldblum: For a serious app thats fair enough, but we are just testing the waters ATM.
[2012-02-02 11:27:00 -0500] willejs: hi, ive got a problem with the application cookbook, im installing passenger_apache2 with it, and it isnt playing nicely
[2012-02-02 11:28:00 -0500] willejs: im getting "Cookbook my_app not found."
[2012-02-02 11:28:00 -0500] willejs: any ideas?
[2012-02-02 11:30:00 -0500] yfeldblum: arretsor, if you're testing the chef waters, maybe start small and just start by ensuring all the nodes have the same base configuration (sshd, users, sudo, ntp) via automation, while continuing to deploy the apps on top of that by hand or however else you were doing it?
[2012-02-02 11:31:00 -0500] arretsor: yfeldblum: Well, Im making some progress. Have automated the install of rvm, ruby, passenger niginx, but now Im throwing all that out and looking at the application cookbook to deploy a rails app. I see my question re ENV variables was dopey now having read a bit more closely.
[2012-02-02 11:36:00 -0500] yfeldblum: arretsor, the current version of the application cookbook makes a great many assumptions about your application that might not actually hold in any given case
[2012-02-02 11:38:00 -0500] arretsor: But its the only half decent resource Ive been able to find specifically about deploying rails :( It looks like it should do me initially anyway. Hopefully Ill pick up some chef in the meantime and be able to roll my own in future if I need to.
[2012-02-02 11:40:00 -0500] yfeldblum: arretsor, you can certainly use it as a guide, seeing what it's doing and writing a recipe that mimics it in some places and does other things in other places
[2012-02-02 11:41:00 -0500] yfeldblum: arretsor, chef doesn't help you figure out how to deploy a rails app; it assumes you know how to deploy a rails app, and provides a decent language so that you can write down the steps
[2012-02-02 11:45:00 -0500] BryanWB: yfeldblum: good morning!
[2012-02-02 11:46:00 -0500] yatesy: aww both knife-rackspace and ohai doesn't support rackspace cloud servers in the UK :(
[2012-02-02 11:47:00 -0500] yatesy: (sorry that was a general moan rather than a criticism)
[2012-02-02 11:52:00 -0500] yfeldblum: BryanWB, good morning to you!
[2012-02-02 11:53:00 -0500] yfeldblum: yatesy, just stick this in your knife.rb: knife[:rackspace_auth_url] = "lon.auth.api.rackspacecloud.com"
[2012-02-02 11:53:00 -0500] yfeldblum: not sure about the ohai bit tho
[2012-02-02 12:07:00 -0500] yatesy: yfeldblum: sorry i should've been more specific, the problem isn't authentication. the issue is that the hostname is hard coded to be static.cloud-ips.com whereas rackspace UK uses .co.uk
[2012-02-02 12:08:00 -0500] yatesy: it means bootstrap fails, and knife ssh also fails because the fqdn attribute picked up by ohai is just the hostname, not the real FQDN
[2012-02-02 12:08:00 -0500] yatesy: someones got a pull request in for knife-rackspace, haven't searched for ohai yet
[2012-02-02 12:08:00 -0500] yfeldblum: yatesy, set your own hostname
[2012-02-02 12:09:00 -0500] yfeldblum: `knife rackspace server create --node-name WHATEVERYOUWANT --server-name WHATEVERYOUWANT --run-list "role[base]"`
[2012-02-02 12:11:00 -0500] kindkid: Anyone ever seen this error before? My google-fu is failing me https://raw.github.com/gist/56f0734a514519a3936f/2cca3f814b5e8b27d2e62a51f47e2586d8cf0eb9/chef-stacktrace.out
[2012-02-02 12:12:00 -0500] BryanWB: do u have a file bigger than 15mb?
[2012-02-02 12:13:00 -0500] BryanWB: kindkid: iirc hosted chef can't handle a file larger than 15mb
[2012-02-02 12:13:00 -0500] kindkid: where?
[2012-02-02 12:15:00 -0500] kindkid: BryanWB: where should I be checking for such a file?
[2012-02-02 12:15:00 -0500] yatesy: yfeldblum: I've done that thanks, however that won't help with knife-rackspace bootstrap as it outputs a wrong public hostname
[2012-02-02 12:16:00 -0500] BryanWB: cookbook/foo/files/*
[2012-02-02 12:16:00 -0500] BryanWB: kindkid: but this is a guess, may not be your problem
[2012-02-02 12:16:00 -0500] kindkid: this is when I'm running sudo chef-client
[2012-02-02 12:16:00 -0500] BryanWB: is any cookbook > 15mb?
[2012-02-02 12:18:00 -0500] kindkid: the total size of my chef-repo is 3.8M
[2012-02-02 12:19:00 -0500] kindkid: hmm looks like it happens when i'm trying to have the node register with zabbix. might not be chef's problem.
[2012-02-02 12:19:00 -0500] BryanWB: sorry, no idea then
[2012-02-02 12:41:00 -0500] zts: Any opscode folks: filling out the form on http://www.opscode.com/private-chef/contact-sales/ redirects you to a broken link: http://http//www.opscode.com/private-chef/thank-you
[2012-02-02 13:00:00 -0500] `brendan: morning masters of the sandwich makers
[2012-02-02 13:01:00 -0500] |shad0w|: sandwiches are hard
[2012-02-02 13:03:00 -0500] `brendan: not for women to make
[2012-02-02 13:03:00 -0500] `brendan: :D
[2012-02-02 13:04:00 -0500] |shad0w|: only if invoked with sudo
[2012-02-02 13:04:00 -0500] `brendan: true dat
[2012-02-02 13:06:00 -0500] willejs: can anyone tell me where params[:name] is defined?
[2012-02-02 13:20:00 -0500] willejs: how is the params[] hash set?
[2012-02-02 13:29:00 -0500] yfeldblum: willejs, in definitions?
[2012-02-02 14:57:00 -0500] arretsor: What is config[:attribute], with respect to `knife ssh'? Ive seen suggestions that being nil might be why I keep getting "No nodes returned from search!".
[2012-02-02 15:03:00 -0500] yfeldblum: config[:attribute] is the attribute from the node that you want to pass into ssh as the address for sshing into the server, so for example if config[:attribute] is "fqdn", then you are telling knife to find the nodes, pull out the node["fqdn"] attribute, and try to ssh into the node's fqdn; likewise, if you have config[:attribute] of "ipaddress", then knife will find the nodes, pull out their node["ipaddress"] attribute, and attemp
[2012-02-02 15:03:00 -0500] yfeldblum: t to ssh to there
[2012-02-02 15:07:00 -0500] arretsor: ssd7: http://tickets.opscode.com/browse/CHEF-2847 is why I was asking
[2012-02-02 15:07:00 -0500] arretsor: yfeldblum: Thanks. This command just worked yesterday. Not sure whats changed, but thanks for the info.
[2012-02-02 15:08:00 -0500] dyer: Question, can I use different atribute files in a recipe?  For example if recipe/default.rb -> attributes/default.rb  and then recipe/source.rb -> attibutes/source.rb ?
[2012-02-02 15:10:00 -0500] ssd7: dyer: Actually, the situation is a bit different than that.  I believe that Chef will load up ALL of the files in attributes/ even if you don't use the similarly named recipe in the run list.
[2012-02-02 15:10:00 -0500] ssd7: arretsor: Thanks :)
[2012-02-02 15:51:00 -0500] flashmanbahadur: hey im using the aws cookbook, ran in to an issue where the EBS volume I created was deleted manually, but now the node data is still showing the old volume ID as being registered with the instance.  I can't seem to find any way to remove it beyond using knife to manually edit the node data.  Is there appropriate way to remove it? Should I just run a :detach in the script?
[2012-02-02 16:06:00 -0500] Mydalon: Hi, is there a way to set node attributes at bootstrap time (with knife ex2 create...) ?
[2012-02-02 16:06:00 -0500] Mydalon: I need that to tell the servers which db-dump to fetch and load
[2012-02-02 16:13:00 -0500] j-v-e: Hi all
[2012-02-02 16:13:00 -0500] j-v-e: chef newbie here
[2012-02-02 16:14:00 -0500] j-v-e: I'm wondering if, in a recipe, there is a way to run a command on the node, capture the result from stdout, and use that result on another node
[2012-02-02 16:15:00 -0500] j-v-e: ie. can I store the result of a command in a variable ?
[2012-02-02 16:15:00 -0500] hcastro: j-v-e: https://github.com/opscode/mixlib-shellout
[2012-02-02 16:16:00 -0500] j-v-e: Ha nice ! I can use that in my recipe directly ?
[2012-02-02 16:16:00 -0500] hcastro: usage example: https://github.com/opscode/cookbooks/blob/master/drbd/recipes/pair.rb#L49-52
[2012-02-02 16:17:00 -0500] dyer: Question, I have a conditional that runs one set of resources if debian and another if centos, and in the centos side I have a ruby_block that does a bit voodoo on a file which exists on centos systems.  The strange part is I am getting an exception here when I run this cookbook on debian
[2012-02-02 16:17:00 -0500] hcastro: looks like you need to require "chef/shell_out"
[2012-02-02 16:17:00 -0500] j-v-e: thanks hcastro ! I'll look into that
[2012-02-02 16:18:00 -0500] danryan: Can't that be shortened to `%x[drbd-overview].include?("drbd not loaded")` ?
[2012-02-02 16:18:00 -0500] dyer: https://gist.github.com/1724329
[2012-02-02 16:19:00 -0500] danryan: only_if { %x[drbd-overview].include?("drbd not loaded") }
[2012-02-02 16:19:00 -0500] dyer: shouldnt the fact that the file doesnt exist on Ubuntu not matter since that part shouldnt be evaluated at all ?
[2012-02-02 16:21:00 -0500] danryan: dyer: s/ubundu/ubuntu
[2012-02-02 16:21:00 -0500] dyer: lol
[2012-02-02 16:21:00 -0500] dyer: nice
[2012-02-02 16:21:00 -0500] dyer: even tested the platform? method on shef to check my sanity
[2012-02-02 16:25:00 -0500] mattray: dyer: are you updating the drbd cookbook for centos?
[2012-02-02 16:25:00 -0500] dyer: drdb?
[2012-02-02 16:25:00 -0500] bawt: drdb is hard to configure by itself
[2012-02-02 16:25:00 -0500] Mydalon: Hi, is there a way to set node attributes at bootstrap time (with knife ex2 create...) ?
[2012-02-02 16:26:00 -0500] mattray: dyer: oh, nevermind. Got confused by the other comments
[2012-02-02 16:30:00 -0500] jtimberman: bawt: forget drbd
[2012-02-02 16:30:00 -0500] bawt: okay
[2012-02-02 16:31:00 -0500] jtimberman: bawt: drbd refers to block devices designed as a building block to form high availability (HA) clusters (http://www.drbd.org/)
[2012-02-02 16:54:00 -0500] arretsor: Is it not possible to create a databag from an .rb file like with everything else?
[2012-02-02 16:54:00 -0500] Mydalon: Yes, you can do that
[2012-02-02 16:54:00 -0500] Mydalon: But you have to have each item of the data bag in one seperate file IIRC
[2012-02-02 16:55:00 -0500] Mydalon: Ah, my  bad
[2012-02-02 16:55:00 -0500] Mydalon: It's json of course
[2012-02-02 16:55:00 -0500] Mydalon: sorry
[2012-02-02 16:56:00 -0500] Mydalon: Hi, is there a way to set node attributes at bootstrap time (with knife ex2 create...) - perhaps in the runlist? I'd try to avoid having roles for all possible attribute values.
[2012-02-02 16:58:00 -0500] arretsor: Mydalon: Now I am _far_ from expert and probably misunderstand your question, but couldnt you do: -r 'role[some_role_which_defines_your_attributes]'
[2012-02-02 16:58:00 -0500] jkyle: morning
[2012-02-02 16:59:00 -0500] jkyle: I have a run list that expands to.. [ohai, ruby-shadow, users, .... other stuff]
[2012-02-02 16:59:00 -0500] Mydalon: Yes, I could do that. But I want to use this node value to determine which database dump to load (of a big list) and I would like to avoid having a role for each possible value of the node value
[2012-02-02 16:59:00 -0500] jkyle: but after botostrap when /usr/local/bin/chef-client -j /etc/chef/firstboot.json -E env1 is run, it fails saying ruby-shadow is required
[2012-02-02 17:01:00 -0500] JasonBox: hrm, the database cookbook makes managing users and databases easy, but what of loading database schema dumps?
[2012-02-02 17:01:00 -0500] JasonBox: For those of us with lame legacy applications
[2012-02-02 17:08:00 -0500] gmcinnes: Hi chefs
[2012-02-02 17:08:00 -0500] gmcinnes: Anyone had experience with a chef-client daemon randomly dying? There's nothing interesting in client.log indicating why it's falling over
[2012-02-02 17:09:00 -0500] laurent\: my chef couchdb is broken :-(
[2012-02-02 17:12:00 -0500] Mydalon: @gmcinnes - yes that is happening here, too
[2012-02-02 17:12:00 -0500] Mydalon: I couldn't find out why, though
[2012-02-02 17:13:00 -0500] Mydalon: So I just monitor knife status and restart the chef-client daemon if needed
[2012-02-02 17:13:00 -0500] gmcinnes: What's your platform? I'm CentOS 6.
[2012-02-02 17:13:00 -0500] Mydalon: debian etch (i know, I know)
[2012-02-02 17:14:00 -0500] gmcinnes: I've seen random segfaults when running chef-client manually.
[2012-02-02 17:14:00 -0500] Mydalon: Sorry it is lenny, but that's only marginally better ;-)
[2012-02-02 17:14:00 -0500] gmcinnes: Probably 1 in 100 times.
[2012-02-02 17:15:00 -0500] gmcinnes: Mydalon: Hey, it is what it is.  At least you know it's stable.  There's a very good argument to be made for it.
[2012-02-02 17:15:00 -0500] Mydalon: I didn't see that, but I don't run chef-client manually all that often
[2012-02-02 17:16:00 -0500] Mydalon: BUT: we will switch to Squeeze in the next weeks. I hoped that would change this issue, but if centOS has the same problem, it might well be a problem in the daemon
[2012-02-02 17:16:00 -0500] Mydalon: @jtimberman: Do you know of any issues with the client daemon?
[2012-02-02 17:16:00 -0500] thbar: hi folks
[2012-02-02 17:22:00 -0500] jtimberman: Mydalon: what issues?
[2012-02-02 17:22:00 -0500] slyphon: jtimberman: is it...normal for there to be like 22G of .chef_design files in the couchdb?
[2012-02-02 17:23:00 -0500] slyphon: i run the cleanup scripts every 3 minutes
[2012-02-02 17:23:00 -0500] slyphon: and couch reports the dbs as being smaller than 100M
[2012-02-02 17:23:00 -0500] slyphon: (and views)
[2012-02-02 17:26:00 -0500] jtimberman: slyphon: you should compact the couchdb
[2012-02-02 17:26:00 -0500] jtimberman: our chef-server cookbook's default recipe does that
[2012-02-02 17:26:00 -0500] slyphon: i did
[2012-02-02 17:26:00 -0500] slyphon: and do
[2012-02-02 17:26:00 -0500] slyphon: i'm wondering if that's the sum-total of the contents of the db
[2012-02-02 17:27:00 -0500] slyphon: blah
[2012-02-02 17:27:00 -0500] flashmanbahadur: has anyone seen issues with automating RAID creation on EBS failing at the mdadm command?  Getting errors where it says one of the disks is busy then failing at that step.  However after destroying the array I am able to format the individual disks and mount them without issues.
[2012-02-02 17:27:00 -0500] jamescarr: is it possible to set the node name with the knife command when bootstrapping an ec2 instance?
[2012-02-02 17:28:00 -0500] yfeldblum: jamescarr, --server-name WHATEVER --node-name WHATEVER
[2012-02-02 17:28:00 -0500] Mydalon: @jtimberman: The chef-client daemon occasionally and seemingly without reason crashes. This is at least true for me and  for gmcinnes
[2012-02-02 17:28:00 -0500] gmcinnes: jtimberman: Mydalon and I are seeing the chef-client die every once in a while.
[2012-02-02 17:28:00 -0500] yfeldblum: the "node name" is strictly how the chef-server knows the node, and has got nothing at all to do with hostname, fqdn, dns, etc
[2012-02-02 17:29:00 -0500] jamescarr: yfeldblum, yeah
[2012-02-02 17:29:00 -0500] jamescarr: argh... sorry, I'm still going through the wiki and learning, in addition to the other tasks I have going :)
[2012-02-02 17:30:00 -0500] thbar: Is there anyone here used to the knife-windows plugin? I'm on OS X and I get GSSAPI warnings when using it. Moving to Basic + AllowUnencrypted will let knife connect (as advised for testing here http://wiki.opscode.com/display/chef/Knife+Windows+Bootstrap#KnifeWindowsBootstrap-Requirements%2FVersion), but I'd like to connect securely instead.
[2012-02-02 17:30:00 -0500] gmcinnes: jtimberman: But there's nothing in client.log to point to a problem.  OTHO, when running chef-client manually, every once in a while I get a ruby segfault.
[2012-02-02 17:30:00 -0500] jtimberman: Mydalon: i'm not aware, but can you open a ticket at tickets.opscode.com in the CHEF project?
[2012-02-02 17:30:00 -0500] jtimberman: well, it might be crashing with said ruby segfault. what version of ruby?
[2012-02-02 17:30:00 -0500] gmcinnes: jtimberman: But I have no idea on how to get a reproduction case
[2012-02-02 17:31:00 -0500] jtimberman: (this might be happening for other users, too, but i'm not aware and haven't had a look)
[2012-02-02 17:31:00 -0500] laurent\: chef couchdb error: Error: os_process_error {exit_status,0}
[2012-02-02 17:31:00 -0500] laurent\: has anybody ever encountered this issue ?
[2012-02-02 17:32:00 -0500] slyphon: wow
[2012-02-02 17:32:00 -0500] slyphon: awesome
[2012-02-02 17:32:00 -0500] slyphon: listen couchdb
[2012-02-02 17:32:00 -0500] laurent\: i'm stuck, couchdb-dump is ok to dump the base, but couchdb-load complains about "data integrity check failed"
[2012-02-02 17:32:00 -0500] slyphon: you were a cute idea, the developers with the fancy eyeglasses and tight jeans thought you were just SPIFFY
[2012-02-02 17:33:00 -0500] slyphon: but, you don't scale, you're a horrendous pain in the balls to administer
[2012-02-02 17:33:00 -0500] thbar: I suspect my issue is linked to this winrm issue: https://github.com/zenchild/WinRM/issues/16
[2012-02-02 17:33:00 -0500] slyphon: i think its time you go DIAF, kthxbai
[2012-02-02 17:33:00 -0500] Mydalon: jtimberman, I can't tell you the ruby version - we just upgraded and I had no problems since... I'll open a ticket, but I can't reproduce the problem
[2012-02-02 17:35:00 -0500] thbar: jtimberman: the doc page on knife windows mention that we can manage our Windows nodes from OS X, but do you know if someone managed to do that (from OS X) while not having to use non-encrypted settings?
[2012-02-02 17:36:00 -0500] jamescarr: so I'm still trying to understand how nodes work... I mean, I follow the quickstart guide and it feels like applications just magically know where the db server is. Yet I can't figure out how it resolves it (i don't see references to node names)
[2012-02-02 17:37:00 -0500] jamescarr: does it just consider whoever ran db_master as the host? how does the application cookbook resolve @host?
[2012-02-02 17:37:00 -0500] jbz: jamescarr: Exactly.  The node that ran db_master is the database host.  It finds the node which did that by searching on the chef server, and then it uses the hostname field of the node which did that.
[2012-02-02 17:38:00 -0500] jamescarr: ah I see now
[2012-02-02 17:38:00 -0500] jamescarr:  78     results = search(:node, "role:#{app["database_master_role"][0]} AND chef_environment:#{node.chef_environment}", nil, 0, 1)
[2012-02-02 17:39:00 -0500] gmcinnes: I'm ruby 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux] on CentOS 6.
[2012-02-02 17:39:00 -0500] jtimberman: Mydalon: ruby --version
[2012-02-02 17:39:00 -0500] jtimberman: Mydalon: will show the ruby version. if you installed as an OS package, you can query the package manager
[2012-02-02 17:39:00 -0500] jbz: jamescarr: Exactly.  The 'results' will be an array of complete node records.  It can then 'reach into' those node records and extract the hostname.
[2012-02-02 17:41:00 -0500] jamescarr: jbz, so if I want to have my application configure rabbitmq, I should create a role for the master (which could be a server, could be a load balancer in front of a server cluster) and then have a recipe in my app that configures it?
[2012-02-02 17:41:00 -0500] jtimberman: gmcinnes: iirc there are known segfault problems on centos w/ ruby 1.8.7, but i don't have details, perhaps mkent_ recalls
[2012-02-02 17:41:00 -0500] jtimberman: if he's around :)
[2012-02-02 17:42:00 -0500] jamescarr: or would it be rude to do this in the application cookbook? It feels like I should do it in an specific cookbook for my app, but not sure I can modify the configuration file from it if the application cookbook generates it
[2012-02-02 17:42:00 -0500] jtimberman: jamescarr: specific cookbook for your app is the general idea.
[2012-02-02 17:43:00 -0500] jtimberman: jamescarr: let the application cookbook's recipes handle getting the app code deployed and ready to run under the specific webserver
[2012-02-02 17:43:00 -0500] mkent_: heya - not sure on the situation with centos 6 stock ruby honestly - I've only used 1.9.2 via rvm
[2012-02-02 17:43:00 -0500] jtimberman: mkent_: :(
[2012-02-02 17:43:00 -0500] jtimberman: you've failed me!
[2012-02-02 17:43:00 -0500] jtimberman: :D
[2012-02-02 17:43:00 -0500] statix: Unless otherwise specified, will a node automatically use the newest Cookbook Version?
[2012-02-02 17:43:00 -0500] mkent_: sorry! :)
[2012-02-02 17:43:00 -0500] jamescarr: jtimberman, heh, I realize that I'm delving more into distributed directory services rather than something chef handles I gues
[2012-02-02 17:43:00 -0500] gmcinnes: 's ok. I'll go walk the mailing list.
[2012-02-02 17:44:00 -0500] jtimberman: jamescarr: :)
[2012-02-02 17:44:00 -0500] jamescarr: my general idea was to configure the web server with the rabbitMQ details (so it can look it up like it does the datasource)
[2012-02-02 17:44:00 -0500] jtimberman: statix: correct
[2012-02-02 17:44:00 -0500] statix: ie. if a new version is uploaded, will nodes switch to that newest version?
[2012-02-02 17:44:00 -0500] yatesy: yup
[2012-02-02 17:44:00 -0500] jtimberman: if their environment doesn't specify a specific version, they'll download the latest version.
[2012-02-02 17:44:00 -0500] statix: Thank you!
[2012-02-02 17:45:00 -0500] jamescarr: argh... is there a way to delete all my nodes on hosted chef? I killed them via the EC2 console so they still show up on hosted chef
[2012-02-02 17:46:00 -0500] jamescarr: clicking delete one by one is no fun :)
[2012-02-02 17:46:00 -0500] jtimberman: jamescarr: knife node delete NODENAME
[2012-02-02 17:46:00 -0500] jtimberman: knife client delete CLIENTNAME
[2012-02-02 17:46:00 -0500] moos3: jamescarr yeah someone would make a relationship between ec2 and chef nodes for deletation
[2012-02-02 17:47:00 -0500] jtimberman: jamescarr: you can do a bulk delete too, but be careful about that one with clients so you don't delete your validator.
[2012-02-02 17:47:00 -0500] jamescarr: jtimberman, heh... I have 100 nodes :)
[2012-02-02 17:47:00 -0500] slyphon: jtimberman: it looks like you guys never compact the cookbooks design doc
[2012-02-02 17:47:00 -0500] slyphon: which was 11G on my server
[2012-02-02 17:47:00 -0500] jamescarr: I see bulk delete :)
[2012-02-02 17:47:00 -0500] jbz: Would anyone find a report handler which could produce the particular segment of the chef log from the run that called it useful?
[2012-02-02 17:47:00 -0500] slyphon: sorry 12 gig
[2012-02-02 17:48:00 -0500] jtimberman: slyphon: sorry - that is fixed in opscode/master in github.com/opscode/cookbook
[2012-02-02 17:48:00 -0500] jamescarr: I discovered why my multi-server setup wasnt working...
[2012-02-02 17:48:00 -0500] jtimberman: er, cookbooks
[2012-02-02 17:48:00 -0500] slyphon: ah
[2012-02-02 17:48:00 -0500] jamescarr: it was getting nodes that were gone when it searched ;)
[2012-02-02 17:48:00 -0500] slyphon: ok, i grabbed the one from the other place
[2012-02-02 17:48:00 -0500] moos3: if the chef-client is running why can't i see anything on the status tab
[2012-02-02 17:48:00 -0500] mconigliaro: hey guys. i'm trying to automate the setup of a chef server. is there any way for me to specify the validation keys instead of having the installer create new ones every time?
[2012-02-02 17:48:00 -0500] jtimberman: jamescarr: yeah
[2012-02-02 17:48:00 -0500] slyphon: shit
[2012-02-02 17:48:00 -0500] slyphon: jtimberman: thanks
[2012-02-02 17:49:00 -0500] jtimberman: slyphon: we do have an internal ticket to handle releasing a new version of the chef-server cookbook
[2012-02-02 17:49:00 -0500] slyphon: ah
[2012-02-02 17:49:00 -0500] slyphon: jtimberman: cool, no worries, i'm just trying to get my stuff moved over to chef 0.10 and rsycing was taking forever
[2012-02-02 17:50:00 -0500] jtimberman: bittorrent!
[2012-02-02 17:50:00 -0500] slyphon: hah!
[2012-02-02 17:51:00 -0500] slyphon: ahhhhh
[2012-02-02 17:51:00 -0500] slyphon: much better
[2012-02-02 17:51:00 -0500] c_t: I must qsk
[2012-02-02 17:51:00 -0500] c_t: ask, even
[2012-02-02 17:51:00 -0500] c_t: how did the cookbook design doc manage to be 12GB?
[2012-02-02 17:58:00 -0500] gmcinnes: so, if I needed to upgrade the ruby that chef is running on, how would I go about that?
[2012-02-02 17:58:00 -0500] jtimberman: gmcinnes: install new version of ruby
[2012-02-02 17:58:00 -0500] jtimberman: gmcinnes: restart chef processes using ruby
[2012-02-02 17:58:00 -0500] jtimberman: :)
[2012-02-02 17:59:00 -0500] gmcinnes: fair enough. There's no weird chicken and egg issues?  I guess I'll find out.
[2012-02-02 17:59:00 -0500] brandoma: 3.) hope your dependencies are good
[2012-02-02 17:59:00 -0500] gmcinnes: exactly brandoma
[2012-02-02 18:00:00 -0500] brandoma: i suggest shaking a chicken bone and chanting 'lucky lucky chicken bone' a few times
[2012-02-02 18:01:00 -0500] gmcinnes: any recipies I have now that install a gem package will have to be smart enough to pick up that the 1.9.X gem doesn't exist. Thisa coulda geta messy.
[2012-02-02 18:01:00 -0500] ranjibd: jtimberman, gems are generally installed inside versioned folder ,.. like 1.8/gems/
[2012-02-02 18:01:00 -0500] ranjibd: wont that cause problem.. i always have ran gem install chef after every ruby upgrade
[2012-02-02 18:04:00 -0500] jbz: Search question!
[2012-02-02 18:04:00 -0500] jbz: Is it possible to search for multiple matches without doing multiple searches?
[2012-02-02 18:05:00 -0500] labria: is there any point in upgrading ruby used only for chef?
[2012-02-02 18:05:00 -0500] ssd7: jbz: Can you elaborate a bit?
[2012-02-02 18:05:00 -0500] gmcinnes: labria: I'm seeing segfaults with my particular ruby version on CentOS
[2012-02-02 18:05:00 -0500] jbz: So if I have node[:foo][:bar] and node[:foo][:baz] and node[:foo][:quux] is it possible to search for a node whose bar/baz/quux all match without doing three searches?
[2012-02-02 18:06:00 -0500] labria: jbz: there's a AND operator
[2012-02-02 18:06:00 -0500] labria: err, OR
[2012-02-02 18:06:00 -0500] jbz: ...
[2012-02-02 18:06:00 -0500] jbz: ...
[2012-02-02 18:06:00 -0500] jbz: oh yeah.
[2012-02-02 18:06:00 -0500] ssd7: :)
[2012-02-02 18:06:00 -0500] jbz: Thanks labria, especially for refraining from "you dunce" at the end.
[2012-02-02 18:06:00 -0500] labria: gmcinnes: 1.8.7?
[2012-02-02 18:07:00 -0500] jtimberman: ranjibd: ah good point :)
[2012-02-02 18:07:00 -0500] labria: jbz: np, mindstalls happen =)
[2012-02-02 18:07:00 -0500] gmcinnes: labria: yeah. 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux]
[2012-02-02 18:07:00 -0500] jtimberman: so much sadness in a 2 year old version of Ruby
[2012-02-02 18:09:00 -0500] labria: jtimberman: to be frank, _all_ of my servers run stock debian ruby, ie. ruby 1.8.7 (2010-08-16 patchlevel 302) or something like it
[2012-02-02 18:09:00 -0500] labria: never had a glitch
[2012-02-02 18:09:00 -0500] mconigliaro: jtimberman: out of curiosity, what's the biggest chef installation you're aware of? (e.g. number of managed clients)
[2012-02-02 18:09:00 -0500] jtimberman: mconigliaro: "thousands"
[2012-02-02 18:10:00 -0500] labria: jtimberman: that's hosted?
[2012-02-02 18:10:00 -0500] labria: I guess IGN has a lot =)
[2012-02-02 18:10:00 -0500] mconigliaro: well, i think we're going to blow past "thousands" pretty quickly
[2012-02-02 18:10:00 -0500] jtimberman: I cannot speak to the number of nodes in Opscode Hosted Chef.
[2012-02-02 18:10:00 -0500] mconigliaro: so i could use some advice ;-)
[2012-02-02 18:10:00 -0500] jtimberman: mconigliaro: opscode.com/private-chef :)
[2012-02-02 18:11:00 -0500] labria: i'm still at the hundreds level )
[2012-02-02 18:11:00 -0500] jtimberman: :)
[2012-02-02 18:11:00 -0500] jbz: Do the boolean operators for search go inside the quotes?
[2012-02-02 18:11:00 -0500] ssd7: jbz: yup
[2012-02-02 18:11:00 -0500] gmcinnes: yeah, I'm just using the stock ruby from CentOS
[2012-02-02 18:11:00 -0500] jbz: thankee
[2012-02-02 18:11:00 -0500] jtimberman: mconigliaro: I have anecdotal evidence of organizations running Open Source Chef with 10k+ nodes
[2012-02-02 18:11:00 -0500] labria: whoa, cool
[2012-02-02 18:11:00 -0500] jtimberman: mconigliaro: there was a guy at the denver/boulder cloud meetup that said he was running 17k
[2012-02-02 18:12:00 -0500] jtimberman: and like 2k of those were AIX iirc.
[2012-02-02 18:12:00 -0500] mconigliaro: jtimberman: that's nothing. our goal is something like a hundred thousand new clients per month
[2012-02-02 18:12:00 -0500] jtimberman: mconigliaro: sure :)
[2012-02-02 18:12:00 -0500] mconigliaro: haha
[2012-02-02 18:12:00 -0500] mconigliaro: that's the number i was given
[2012-02-02 18:12:00 -0500] labria: mconigliaro: good luck )
[2012-02-02 18:12:00 -0500] mconigliaro: =D
[2012-02-02 18:13:00 -0500] labria: 100k with a default 15min schedule is like 100+ chef-runs per second, resulting in 1k rps.
[2012-02-02 18:13:00 -0500] slyphon: jtimberman: so, in theory, i should be able to just copy over my couchdb data files, from 0.9 -> 0.10 and start the server and "presto"?
[2012-02-02 18:14:00 -0500] labria: slyphon: I did that twice.
[2012-02-02 18:14:00 -0500] slyphon: so "yes"
[2012-02-02 18:14:00 -0500] labria: slyphon: don't forget to rsync/copy cookbook files, or do a purge and re-upload
[2012-02-02 18:14:00 -0500] jbz: wait, can I use search from within a report handler?>
[2012-02-02 18:14:00 -0500] jtimberman: slyphon: "basically"
[2012-02-02 18:14:00 -0500] slyphon: jtimberman: hah! :)
[2012-02-02 18:14:00 -0500] slyphon: oh roight
[2012-02-02 18:14:00 -0500] jtimberman: slyphon: there's a document on the wiki about upgrading
[2012-02-02 18:15:00 -0500] ssd7: jbz: Almost certainly (it's just ruby after all) but I haven't tried it.  You may have to include the relevant language mixins
[2012-02-02 18:16:00 -0500] jbz: ssd7: Ah.
[2012-02-02 18:16:00 -0500] ranjibd: jbz, you can .. u wont get the search method directly .. you have to create the search query object manually
[2012-02-02 18:16:00 -0500] jbz: Thanks guys! Any pointers for what I should read to learn to do that?
[2012-02-02 18:17:00 -0500] labria: in the code
[2012-02-02 18:17:00 -0500] ranjibd: but rest everything is configured (as Chef::Config is populated )
[2012-02-02 18:17:00 -0500] labria: q = Chef::Search::Query.new
[2012-02-02 18:17:00 -0500] labria: nodes = q.search("node", ".")
[2012-02-02 18:23:00 -0500] slyphon: labria: did you follow any particular documentation?
[2012-02-02 18:23:00 -0500] slyphon: i've got this feeling that i'm like 60% of the way there
[2012-02-02 18:24:00 -0500] slyphon: i'm not "upgrading", more starting fresh but wanting to bring over my data
[2012-02-02 18:24:00 -0500] labria: slyphon: no, just a year of experience, I did 0.8 => 0.9 => 0.10 on two servers
[2012-02-02 18:24:00 -0500] slyphon: did you upgrade? or reinstall and migrate?
[2012-02-02 18:25:00 -0500] labria: i moved to a different server each time, transferring the data (cookbook+couch) and then moving clients
[2012-02-02 18:25:00 -0500] slyphon: cookbooks is the cookbook_index ?
[2012-02-02 18:28:00 -0500] labria: slyphon: yes, IIRC
[2012-02-02 18:29:00 -0500] slyphon: gahhh
[2012-02-02 18:29:00 -0500] slyphon: https://gist.github.com/1724989
[2012-02-02 18:32:00 -0500] jamescarr: is there a way to search nodes for a specific role with knife?
[2012-02-02 18:32:00 -0500] cwj: knife search node "roles:foo"
[2012-02-02 18:33:00 -0500] mconigliaro: hmm, who is zac ceigler? someone in here?
[2012-02-02 18:33:00 -0500] mconigliaro: not sure why they added me on linkedin just now...
[2012-02-02 18:35:00 -0500] atomic-penguin: slyphon, have you looked at http://wiki.opscode.com/display/chef/Backing+Up+Chef+Server
[2012-02-02 18:35:00 -0500] slyphon: ah, that would be useful
[2012-02-02 18:35:00 -0500] atomic-penguin: slyphon, I used an older version of that guide to migrate my chef-server
[2012-02-02 18:36:00 -0500] slyphon: ah cool
[2012-02-02 18:36:00 -0500] haakon__: my chef-client doesn't start after the ubuntu server has been rebooted. how to fix that in the initial chef-client configuration?
[2012-02-02 18:36:00 -0500] labria: I love the "This should not happen" exceptions =)
[2012-02-02 18:36:00 -0500] bencaron: why would the apache2 cookbook not set the port to what I set in a role with override_attributes?
[2012-02-02 18:36:00 -0500] bencaron: I'm saying override_attributes "apache2" => { "listen_ports" => [ "8080" ], "max_children" => "20" }
[2012-02-02 18:37:00 -0500] bencaron: node attributes are set to that in my chef-server webui
[2012-02-02 18:37:00 -0500] bencaron: but the ports.conf is still showing port 80 and 443
[2012-02-02 18:38:00 -0500] labria: you sure the node has the cookbook in the runlist?
[2012-02-02 18:38:00 -0500] bencaron: yes, it loaded and did it's job
[2012-02-02 18:38:00 -0500] bencaron: I modified my role, knife push it
[2012-02-02 18:38:00 -0500] labria: knife role from file?
[2012-02-02 18:39:00 -0500] bencaron: yes
[2012-02-02 18:39:00 -0500] bencaron: seems to be ignored
[2012-02-02 18:39:00 -0500] bencaron: i set the same thing in a recipe directly just for fun
[2012-02-02 18:39:00 -0500] bencaron: the attribute is there in the webui
[2012-02-02 18:40:00 -0500] bencaron: is this correct node[:apache2]['listen_ports'] = [ "8080" ]
[2012-02-02 18:40:00 -0500] bencaron: mixing symbols and string keys, not sure...
[2012-02-02 18:41:00 -0500] ssd7: bencaron: It will work, but I'd avoid doing it.  Just use strings.
[2012-02-02 18:41:00 -0500] labria: weird, it works fine for me, I have apache on 81
[2012-02-02 18:41:00 -0500] bencaron: well well...
[2012-02-02 18:42:00 -0500] bencaron: i mv ports.conf, changed for all-strings, repush my cookbook, no luck
[2012-02-02 18:42:00 -0500] jbz: gr.
[2012-02-02 18:42:00 -0500] bencaron: i don't think it's the right place to set this, the cookbook though... the role seems better
[2012-02-02 18:42:00 -0500] jbz: Anyone up for another search-in-handlers question?
[2012-02-02 18:43:00 -0500] labria: jbz: anytime )
[2012-02-02 18:44:00 -0500] bencaron: labria: well thanks 4 the therapy :P I'll reread all this
[2012-02-02 18:44:00 -0500] jbz: labria: Whee!  Thanks.  So when I look at my search result in my handler, I seem have an array of nodes, which is what I expect.  However, when I try to pull out any of their attributes, it fails.
[2012-02-02 18:44:00 -0500] bencaron: i was hoping for a very obvious think I would have forget :D
[2012-02-02 18:44:00 -0500] jbz: So for example: Chef::Log.info("DRH: First node name is #{nodelist.first["name"]}")
[2012-02-02 18:44:00 -0500] jbz: (where nodelist is the result) leads to an error.
[2012-02-02 18:44:00 -0500] jbz: (should I gist this?)
[2012-02-02 18:45:00 -0500] ssd7: jbz: name isn't an attribute typically
[2012-02-02 18:45:00 -0500] labria: LOL
[2012-02-02 18:45:00 -0500] ssd7: jbz: nodelist.first.name
[2012-02-02 18:45:00 -0500] jbz: ssd7:  That doesn't work either
[2012-02-02 18:45:00 -0500] jbz: tried that first, because that's how I did it in my recipe
[2012-02-02 18:45:00 -0500] ssd7: OIC, gist it is then
[2012-02-02 18:45:00 -0500] labria: jbz: change that to: nodelist.first.first["name"]}"
[2012-02-02 18:46:00 -0500] ssd7: ahh
[2012-02-02 18:46:00 -0500] ssd7: yeah
[2012-02-02 18:46:00 -0500] labria: a search result is a array of [nodes, count, count]
[2012-02-02 18:46:00 -0500] jbz: OH
[2012-02-02 18:46:00 -0500] jbz: derp.
[2012-02-02 18:46:00 -0500] labria: yeah!
[2012-02-02 18:46:00 -0500] jbz: And in the recipe method, it handles that for me?
[2012-02-02 18:46:00 -0500] jamescarr: is it possible to use knife to ssh into one of my boxes?
[2012-02-02 18:46:00 -0500] labria: yes
[2012-02-02 18:46:00 -0500] jbz: haHAAAA
[2012-02-02 18:46:00 -0500] jbz: *light dawns*
[2012-02-02 18:46:00 -0500] jbz: thank you again.
[2012-02-02 18:46:00 -0500] labria: jamescarr: knife ssh --help
[2012-02-02 18:47:00 -0500] bencaron: aaaah... stupid me. debian-ism: the attributes is apache, not apache2
[2012-02-02 18:47:00 -0500] labria: bencaron: oh, missed the 2 in your code )
[2012-02-02 18:47:00 -0500] jamescarr: labria, thanks!
[2012-02-02 18:48:00 -0500] labria: jamescarr: np
[2012-02-02 18:48:00 -0500] bencaron: labria: me too, and I read it way more time than you, so stupid ==> me  ;)
[2012-02-02 18:48:00 -0500] jamescarr: labria, argh, I'm a little confused
[2012-02-02 18:48:00 -0500] jamescarr: knife ssh QUERY COMMAND
[2012-02-02 18:48:00 -0500] bencaron: works perfectly now
[2012-02-02 18:48:00 -0500] labria: bencaron: take a break, go for a walk, helps every time
[2012-02-02 18:49:00 -0500] bencaron: exactly what i was thinking :)
[2012-02-02 18:49:00 -0500] labria: jamescarr: QUERY is the search query to get the nodes (in your case "name:foobar") COMMAND is what you wanna run there ("rm -Rf /etc/chef").
[2012-02-02 18:50:00 -0500] labria: jamescarr: no, you can not get a interactive session, use plain ssh for that )
[2012-02-02 18:51:00 -0500] ssd7: you can get an interactive session, it just is a bit odd
[2012-02-02 18:51:00 -0500] labria: ssd7: yeah? probably, never tried
[2012-02-02 18:53:00 -0500] ssd7: You can have knife ssh open up a screen or tmux session with tabs for each server if you want.  There is also an "interactive" mode, but it is kinda strange to use if you aren't used to it (it sends each command you type to all the nodes and then your results come back all interleaved
[2012-02-02 18:53:00 -0500] jamescarr: so I'm still struggling with the quickstart... do I need to somehow open the mysql port for other hosts on ec2 to connect?
[2012-02-02 18:54:00 -0500] jamescarr: I verified that it is running on 10.28.24.23 but when I try to connect from 10.28.24.11 it just hangs until it times out
[2012-02-02 18:54:00 -0500] jamescarr: if I go to 10.28.24.23 it works
[2012-02-02 18:54:00 -0500] cwj: you have security groups set up correctly to allow the connection?
[2012-02-02 18:55:00 -0500] jamescarr: they all use the same security group
[2012-02-02 18:55:00 -0500] jamescarr: doh!
[2012-02-02 18:55:00 -0500] jamescarr: now I know
[2012-02-02 18:57:00 -0500] jbz: labria: Hehe one more quesiton if you have time
[2012-02-02 18:57:00 -0500] jbz: (and I have a gist for this one)
[2012-02-02 18:57:00 -0500] labria: jbz: so?
[2012-02-02 18:58:00 -0500] jbz: That seems to have worked, in that I now end up with a node where I think I have a node, BUT I can't seem to extract the name from it.  Do I just have the attribute wrong?  Is it nodename?
[2012-02-02 18:58:00 -0500] jbz: https://gist.github.com/1725107
[2012-02-02 19:00:00 -0500] ssd7: jbz: Like I said above, node["name"] generally won't work.  But I seem to be really under-caffienated atm, so I could be completely wrong.
[2012-02-02 19:00:00 -0500] jbz: Ah.  Roger.  Do I have to use the key, then?
[2012-02-02 19:00:00 -0500] labria: node.name, not node["name"]
[2012-02-02 19:00:00 -0500] jbz: heh.
[2012-02-02 19:00:00 -0500] flashmanbahadur: is there a way to make blocks in a chef recipe execute in parallel (without using execute and backgrounding the shell)?
[2012-02-02 19:01:00 -0500] jbz: This is what I get for only half-understanding the ruby unpinnings of all of this.
[2012-02-02 19:01:00 -0500] ssd7: For a few items in the Node object you have to use their accessor methods since they aren't actually "attributes".  name, chef_environment, run_list
[2012-02-02 19:01:00 -0500] jbz: Thanks for your patience, gents.
[2012-02-02 19:02:00 -0500] jbz: SWEET that worked.
[2012-02-02 19:02:00 -0500] jbz: Whew.
[2012-02-02 19:02:00 -0500] labria: enjoy )
[2012-02-02 19:02:00 -0500] labria: and take some time to read the code,
[2012-02-02 19:03:00 -0500] jbz: yeah.
[2012-02-02 19:03:00 -0500] labria: btw: shef is a nice tool to test such stuff out without doing the "change, upload, run, goto :change"
[2012-02-02 19:03:00 -0500] jbz: I'mstill not very comfortable with tools like irb and shef.  I'm an Op more than a coder.
[2012-02-02 19:04:00 -0500] jbz: I mean, I know perfectly well how they're supposed to work, but getting them to do what I want leads to broken coffee mugs. :-)
[2012-02-02 19:04:00 -0500] labria: jbz: read "The Ruby Way", understanding ruby will help you a LOT
[2012-02-02 19:04:00 -0500] jbz: (and I very much appreciate your patient help).
[2012-02-02 19:04:00 -0500] jtimberman: jbz: shef will change your life
[2012-02-02 19:05:00 -0500] labria: jbz: you'll grow a beard and move into the basement
[2012-02-02 19:05:00 -0500] jtimberman: http://stevendanna.github.com/blog/2012/01/28/shef-debugging-tips-1/
[2012-02-02 19:05:00 -0500] jbz: jtimberman: heh I've heard *that* sooo often and yet here I am, fat & single hahahaha
[2012-02-02 19:05:00 -0500] jtimberman: labria: iirc he has a beard.
[2012-02-02 19:05:00 -0500] jbz: I do have a beard.
[2012-02-02 19:05:00 -0500] jtimberman: :D
[2012-02-02 19:05:00 -0500] labria: jtimberman: then only one step left!
[2012-02-02 19:05:00 -0500] jbz: haha
[2012-02-02 19:05:00 -0500] jbz: 8th floor apartment, safe from the basement so far!
[2012-02-02 19:05:00 -0500] jbz: although at Dad's house...
[2012-02-02 19:06:00 -0500] labria: does your dad own a garage by any chance?
[2012-02-02 19:06:00 -0500] labria: if not, you should totally convince him to get one, you'll need it soon )
[2012-02-02 19:07:00 -0500] jbz: Where the network gear I put in for his house is.
[2012-02-02 19:07:00 -0500] jbz: Hm, cost of living is indeed way cheaper in N. Vt. than NYC.  Working remotely, here I come.
[2012-02-02 19:07:00 -0500] jbz: Yeah, but better, he has a basement.
[2012-02-02 19:09:00 -0500] atomic-penguin: coderanger, has an epic beard
[2012-02-02 19:10:00 -0500] coderanger: Heh, it is a source of frequent humor around the office
[2012-02-02 19:15:00 -0500] jbz: My beard is not epic.  It would need work.
[2012-02-02 19:15:00 -0500] cwj: no time like the present
[2012-02-02 19:16:00 -0500] jbz: :-D
[2012-02-02 19:16:00 -0500] labria: jbz: can you _make_ a beard epic? i always thought it either is or is not.
[2012-02-02 19:16:00 -0500] jbz: labria: I think the probability of epicness increases with time since last cut.
[2012-02-02 19:16:00 -0500] cwj: it is made through superior genetics and patience
[2012-02-02 19:17:00 -0500] cwj: not all possess the necessary follicles
[2012-02-02 19:17:00 -0500] labria: jbz: you may _try_, but some beards just don't grow epic =(
[2012-02-02 19:17:00 -0500] jbz: yeah.
[2012-02-02 19:22:00 -0500] labria: for example: http://bit.ly/izGFAw a big beard, but nothing epic
[2012-02-02 19:22:00 -0500] atomic-penguin: http://www.geekologie.com/2010/04/22/beards-full.jpg
[2012-02-02 19:23:00 -0500] labria: hm this makes me something between amish and Lincoln
[2012-02-02 19:24:00 -0500] mattrobenolt: Hey, kinda new to Chef, and we're in the process of migrating a bunch of messy cookbooks into a much more vanilla setup so it's easier to manage.
[2012-02-02 19:25:00 -0500] jbz: I'm all the way at the left.
[2012-02-02 19:25:00 -0500] mattrobenolt: So as a best practice, say we have our web app, let's call it "webapp". If I were to structure as cleanly as possible Apache2 and a proper vhost for the app, would you do another recipe inside the apache cookbook?
[2012-02-02 19:25:00 -0500] mattrobenolt: Or would you do a completely separate cookbook that moved a file into sites-available, etc.
[2012-02-02 19:27:00 -0500] labria: mattrobenolt: the best way is probably to make a separate cookbook using resources from other cookbooks.
[2012-02-02 19:27:00 -0500] jbz: mattrobenolt: I'd make sure there's a LWRP for the apache cookbook that let other cookbooks configure sites, and have a cookbook that cycled through assigned sites via a databag or attribute use that LWRP to bring the node's sites up.
[2012-02-02 19:27:00 -0500] labria: mattrobenolt: (though we don't, we usually make recipes in the relevant cookbooks, and then require them/include in a role)
[2012-02-02 19:28:00 -0500] mattrobenolt: Ok, so from within a new cookbook, you can access definitions and stuff from another?
[2012-02-02 19:28:00 -0500] labria: jbz: LWRP is probably the best way, yes
[2012-02-02 19:28:00 -0500] mattrobenolt: And templates from another cookbook?
[2012-02-02 19:29:00 -0500] labria: mattrobenolt: template "/path/to/file" do source "foobar.erb"; cookbook "some_other_cookbook" end, that's that easy
[2012-02-02 19:29:00 -0500] mattrobenolt: What about using a definition from another cookbook?
[2012-02-02 19:30:00 -0500] mattrobenolt: (I'm just using Apache as an example because it's very basic to understand).
[2012-02-02 19:31:00 -0500] mattrobenolt: So the apache cookbook has a definition "web_app" that is called to render the vhost template and install it.
[2012-02-02 19:31:00 -0500] labria: i'm pretty sure you can, if you depend on that cookbook. but I never tried
[2012-02-02 19:31:00 -0500] mattrobenolt: If I were to have my own "my_web_app" cookbook, could I call that web_app definition?
[2012-02-02 19:32:00 -0500] mattrobenolt: That's why i was leaning towards just doing a recipe inside the apache cookbook.
[2012-02-02 19:32:00 -0500] mattrobenolt: And do:  apache::my_web_app
[2012-02-02 19:32:00 -0500] labria: ?
[2012-02-02 19:32:00 -0500] labria: what's the last line supposed to do?
[2012-02-02 19:32:00 -0500] jbz: mattrobenolt: That does work, yes.  But it makes maintaining things a pain, because whenever you need to change how *any* of your web apps work, you have to touch/upload the whole cookbook.
[2012-02-02 19:32:00 -0500] mattrobenolt: Sorry, install that recipe specifically.
[2012-02-02 19:33:00 -0500] mattrobenolt: jbz: I agree.
[2012-02-02 19:33:00 -0500] mattrobenolt: https://github.com/opscode/cookbooks/blob/master/apache2/definitions/web_app.rb
[2012-02-02 19:33:00 -0500] jbz: And thus risk affecting all nodes that use the apache cookbook.
[2012-02-02 19:33:00 -0500] mattrobenolt: That's the web_app definition defined in apache.
[2012-02-02 19:33:00 -0500] mattrobenolt: How could I use that from another cookbook entirely?
[2012-02-02 19:44:00 -0500] flashmanbahadur: hey, is there a way to get around the issue where a gem installed in a recipe is not available immediately afterwards?  Having some trouble using the aws cookbook.
[2012-02-02 19:44:00 -0500] jbz: Anyone else getting transient "400 Bad Request" errors on the Platform?
[2012-02-02 19:45:00 -0500] jbz: ('transient' as in the same request 5 secs later goes through fine)
[2012-02-02 19:46:00 -0500] geekbri: Is there anyway within chef to see what roles are active amongst all nodes, and maybe also to be able to see all cookbooks in use within those nodes?
[2012-02-02 19:46:00 -0500] jbz: geekbri:  Do you mean from within recipes?
[2012-02-02 19:47:00 -0500] geekbri: jbz: Nope, maybe via knife?
[2012-02-02 19:47:00 -0500] jbz: geekbri:  I wrote a plugin for knife called 'knife audit' which will give you the runlists of your nodes, or let you search for all nodes using particular cookbooks
[2012-02-02 19:47:00 -0500] jbz: gem install knife-audit :-)
[2012-02-02 19:47:00 -0500] geekbri: jbz: you da man dawg. arf arf
[2012-02-02 19:48:00 -0500] jbz: :-)
[2012-02-02 19:48:00 -0500] geekbri: jbz: maybe this is a dumb question but how does one read the documentation for this :)
[2012-02-02 19:49:00 -0500] jbz: hm I can't remember if it has rdoc...
[2012-02-02 19:49:00 -0500] jbz: https://github.com/jbz/knife-audit
[2012-02-02 19:49:00 -0500] labria:  knife audit --help
[2012-02-02 19:49:00 -0500] jbz: woo, does that work?
[2012-02-02 19:49:00 -0500] jbz: hahahaha
[2012-02-02 19:49:00 -0500] labria: yes
[2012-02-02 19:49:00 -0500] labria: but not too helpful
[2012-02-02 19:50:00 -0500] labria: err
[2012-02-02 19:50:00 -0500] labria: my mistake
[2012-02-02 19:50:00 -0500] labria: quite helpful
[2012-02-02 19:51:00 -0500] jbz: hee I wrote that to solve a particular problem I was having on my infrastructure, no guarantees it'll be helpful
[2012-02-02 19:52:00 -0500] jbz: geekbri: The 'install cookbook' option drops a knife-audit cookbook into your cookbook repo.  That cookbook, if run on nodes, gives knife-audit access to the 'full' runlist (all cookbooks, all cookbooks from roles, *and* all cookbooks run via 'include').
[2012-02-02 19:52:00 -0500] geekbri: jbz: i see! thanks
[2012-02-02 19:53:00 -0500] jbz: yw
[2012-02-02 20:04:00 -0500] jbz: Will search result node lists always be in the same order, or do I need to sort them to be sure?
[2012-02-02 20:13:00 -0500] jbz: flashmanbahadur: Argh, just saw your question, and now I have the same question because I can't remember the trick.  There is a trick to loading a just-installed gem during a run.
[2012-02-02 20:14:00 -0500] flashmanbahadur: jbz: thanks, I heard rumors of something like that but cant find it
[2012-02-02 20:14:00 -0500] flashmanbahadur: doesnt seem to matter since even once I have the gem installed AWS:EBS reliability is very poor
[2012-02-02 20:15:00 -0500] jbz: heh I need it because I'm installing a handler and that handler needs a gem
[2012-02-02 20:15:00 -0500] jbz: and I daemonize the client
[2012-02-02 20:15:00 -0500] jbz: so it won't work until I cycle the daemon
[2012-02-02 20:16:00 -0500] flashmanbahadur: meh
[2012-02-02 20:16:00 -0500] flashmanbahadur: not fun
[2012-02-02 20:20:00 -0500] yfeldblum: jbz, flashmanbahadur, http://pastie.org/private/l6e4zgvztu082y75sllt0g
[2012-02-02 20:20:00 -0500] jbz: yfeldblum: THANKS!
[2012-02-02 20:21:00 -0500] yfeldblum: mhmm
[2012-02-02 20:21:00 -0500] flashmanbahadur: many thank yfeldblum
[2012-02-02 20:22:00 -0500] flashmanbahadur: many thanks*
[2012-02-02 20:22:00 -0500] yfeldblum: keep in mind that all library/definition/resource/provider files are loaded before any recipes, so installing a gem in a recipe will not help you if you try to require that gem from a library/definition/etc
[2012-02-02 20:23:00 -0500] yfeldblum: from the top-level of a library/definition/etc file, anyway; you can only require the gems from within the library functions or within the definitions blocks etc
[2012-02-02 20:47:00 -0500] geekbri: Anybody have any good ideas on how you test cookbooks?  I have yet to find a good way to do this other than to just bring up a ec2 server and give a role that runs my test cookbooks.
[2012-02-02 20:49:00 -0500] asg: geekbri: vagrant is pretty popular
[2012-02-02 20:49:00 -0500] asg: geekbri: I personally use environments and a few KVM instances myself
[2012-02-02 20:49:00 -0500] fujin: https://github.com/fujin/chef-minitest https://github.com/calavera/rspec-chef
[2012-02-02 20:49:00 -0500] geekbri: asg: mmm yes i've heard of vagrant but haven't had time to look into it,.
[2012-02-02 20:50:00 -0500] ranjibd: how-to-test-cookbook is  https://github.com/fujin/chef-minitest https://github.com/calavera/rspec-chef
[2012-02-02 20:51:00 -0500] ranjibd: how-to-test-cookbook is  https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:51:00 -0500] ranjibd: how-to-test-cookbook?
[2012-02-02 20:51:00 -0500] bawt: how-to-test-cookbook is https://github.com/fujin/chef-minitest https://github.com/calavera/rspec-chef
[2012-02-02 20:52:00 -0500] ranjibd: fujin, how to train bawt for multiple answers
[2012-02-02 20:52:00 -0500] reset: i've got a cookbook in my open source server which is giving me an "end of file reached" error when I try to view it in the webui or perform any actions on it with knife. I'm not able to destroy the cookbook. Any ideas?
[2012-02-02 20:52:00 -0500] fujin: ranjibd: <foo> is also <bar>
[2012-02-02 20:52:00 -0500] ranjibd: how-to-test-cookbook is  also https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:52:00 -0500] ranjibd: how-to-test-cookbook?
[2012-02-02 20:52:00 -0500] bawt: how-to-test-cookbook is https://github.com/fujin/chef-minitest https://github.com/calavera/rspec-chef or https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:52:00 -0500] atomic-penguin: Testing is https://github.com/fujin/chef-minitest, https://github.com/calavera/rspec-chef, https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:52:00 -0500] fujin: there ya go
[2012-02-02 20:53:00 -0500] atomic-penguin: Testing is https://github.com/fujin/chef-minitest, also https://github.com/calavera/rspec-chef, also https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:53:00 -0500] ranjibd: aha .. bravo
[2012-02-02 20:53:00 -0500] atomic-penguin: testing?
[2012-02-02 20:53:00 -0500] bawt: testing is all
[2012-02-02 20:53:00 -0500] jtimberman: testing?
[2012-02-02 20:53:00 -0500] bawt: testing is all
[2012-02-02 20:53:00 -0500] jtimberman: bawt: forget testing
[2012-02-02 20:53:00 -0500] bawt: done
[2012-02-02 20:53:00 -0500] fujin: lol =P
[2012-02-02 20:53:00 -0500] atomic-penguin: testing is https://github.com/fujin/chef-minitest, also https://github.com/calavera/rspec-chef, also https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:53:00 -0500] jtimberman: bawt: testing is Testing or how-to-test-cookbooks
[2012-02-02 20:53:00 -0500] jtimberman: testing?
[2012-02-02 20:53:00 -0500] bawt: testing is Testing or how-to-test-cookbooks
[2012-02-02 20:53:00 -0500] fujin: d'aw!
[2012-02-02 20:53:00 -0500] fujin: !forget testing
[2012-02-02 20:53:00 -0500] bawt: okies!
[2012-02-02 20:53:00 -0500] jtimberman: lawl
[2012-02-02 20:54:00 -0500] fujin: testing is https://github.com/fujin/chef-minitest also https://github.com/calavera/rspec-chef also https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:54:00 -0500] fujin: testing?
[2012-02-02 20:54:00 -0500] bawt: testing is https://github.com/fujin/chef-minitest also https://github.com/calavera/rspec-chef also https://github.com/Atalanta/cucumber-chef
[2012-02-02 20:54:00 -0500] fujin: try to keep up guys <3 :P
[2012-02-02 20:54:00 -0500] jtimberman: hahahaha
[2012-02-02 20:54:00 -0500] ranjibd: ;-)
[2012-02-02 20:56:00 -0500] Damm: david's gotten into rspec huh?
[2012-02-02 20:56:00 -0500] Damm: i'm not completely shocked
[2012-02-02 21:04:00 -0500] jstump: How does one access an environment's attribute from a template? This fact appears precisely 0 times in OpsCode's documentation, sadly.
[2012-02-02 21:08:00 -0500] damienj: hola :)
[2012-02-02 21:08:00 -0500] damienj: hey is there a way to supply a prefix for the chef web_ui?
[2012-02-02 21:09:00 -0500] damienj: trying to setup an haproxy redirect to chef on this server, and would like root to be "/chef", is that possible?
[2012-02-02 21:12:00 -0500] fujin: sure
[2012-02-02 21:12:00 -0500] fujin: of course, it's just http
[2012-02-02 21:13:00 -0500] damienj: fujin, is there an attribute i can add to /etc/chef/webui.rb to supply desired root prefix?
[2012-02-02 21:13:00 -0500] fujin: no
[2012-02-02 21:14:00 -0500] damienj: or are you suggesting I just use haproxy to redirect/rewrite urls to :4040?
[2012-02-02 21:14:00 -0500] fujin: i would put something else directly infront of chef, like Nginx
[2012-02-02 21:14:00 -0500] fujin: and use nginx w/ a location map to do it
[2012-02-02 21:14:00 -0500] damienj: ah
[2012-02-02 21:14:00 -0500] fujin: I *think* you could make your own chef-server
[2012-02-02 21:14:00 -0500] fujin: merb
[2012-02-02 21:15:00 -0500] fujin: and mount the chef-server-api at /chef/api or something
[2012-02-02 21:15:00 -0500] fujin: but it would take custom code. :)
[2012-02-02 21:15:00 -0500] damienj: I have apache on this machine configuration already with stunnel so perhaps I can play around with getting apache to do the redirect
[2012-02-02 21:15:00 -0500] fujin: apache can definitely do it :)
[2012-02-02 21:15:00 -0500] damienj: cool, I will explore there - as appealing as making and managing and supporting my custom build of chef-server to support url prefix feature ;)
[2012-02-02 21:16:00 -0500] damienj: *would be :D
[2012-02-02 21:16:00 -0500] tpot: maybe some rack middleware?
[2012-02-02 21:17:00 -0500] jtimberman: jstump: attributes in an environment are applied to the node, like all other attributes.
[2012-02-02 21:17:00 -0500] tpot: but you have to rewrite the URLs coming back
[2012-02-02 21:18:00 -0500] tpot: which would screw up the signing
[2012-02-02 21:18:00 -0500] tpot: or something like that
[2012-02-02 21:18:00 -0500] jstump: jtimberman: I finally figured it out, but that's not clear from the docs how that stuff works.
[2012-02-02 21:19:00 -0500] reset: jtimberman: have you ever seen this issue - I have a cookbook which passes knife cookbook test, upload works just fine, once it's on the server one of the recipe files is somehow corrupt giving an "end of file reached" error. It's the default recipe according to debug output of chef-client
[2012-02-02 21:20:00 -0500] reset: it's this cookbook: https://github.com/RiotGames/redis-cookbook
[2012-02-02 21:20:00 -0500] jtgiri_: Hey guys, I was wondering if there is way to make aware chef of all the systems when they go up and down. Right now it sounds like in addition to Chef you still need tools like Scalr or Rightscale for stuff like that
[2012-02-02 21:21:00 -0500] NightMonkey: Couldn't one use something like Nagios to "tell" chef that something has happened?
[2012-02-02 21:21:00 -0500] reset: line endings are unix, no weird characters in the file, etc etc
[2012-02-02 21:21:00 -0500] NightMonkey: Ah, now I see that's not what you want.
[2012-02-02 21:28:00 -0500] slyphon: thin's habit of dying without leaving a suicide note really pisses me the fuck off
[2012-02-02 21:29:00 -0500] slyphon: does merb not bind to 0.0.0.0 by deault or something?
[2012-02-02 21:30:00 -0500] slyphon: oh right, i'm a fucking tool
[2012-02-02 21:34:00 -0500] reset: jtimberman: I have no idea what the problem was, incrementing the version number helped. This looks to be some sort of weird bug - is there any information I should send you guys over that you'd be interesting in seeing?
[2012-02-02 21:38:00 -0500] j-v-e: can I source several templates in a destination file ?
[2012-02-02 21:38:00 -0500] fujin: like contatenate them together? no, don't think so
[2012-02-02 21:38:00 -0500] fujin: concatenate **
[2012-02-02 21:38:00 -0500] j-v-e: can I do it in 2 steps ?
[2012-02-02 21:39:00 -0500] j-v-e: write the beginning of the file in a first template section
[2012-02-02 21:39:00 -0500] j-v-e: and continue in a second template section ?
[2012-02-02 21:39:00 -0500] j-v-e: or does the template section overwrite the destination file ?
[2012-02-02 21:39:00 -0500] fujin: Generally when I need to do stuff like this I make a /etc/foo.d directory
[2012-02-02 21:39:00 -0500] fujin: then concat the contents into /etc/foo.conf
[2012-02-02 21:39:00 -0500] fujin: then you can just have templates that dump snippets into the foo.d directory, trigger the exec
[2012-02-02 21:39:00 -0500] fujin: ruby_block or whatever
[2012-02-02 21:40:00 -0500] fujin: that runs through /etc/foo.d & joins them all together. make sense?
[2012-02-02 21:40:00 -0500] laurent\: any couchdb expert here ? :)
[2012-02-02 21:40:00 -0500] laurent\: (here or alive)
[2012-02-02 21:40:00 -0500] laurent\: having some issue with my old couch 0.11.0
[2012-02-02 21:41:00 -0500] j-v-e: fujin: make sense, I'll try that
[2012-02-02 21:41:00 -0500] j-v-e: thanks
[2012-02-02 21:44:00 -0500] fujin: np, good luck!
[2012-02-02 21:54:00 -0500] fujin: i might make a template_snippet resource
[2012-02-02 21:55:00 -0500] vhogemann: hi there... I'm trying to write a LWRP... and got stuck. Is it possible to call resources from within a Provider?
[2012-02-02 21:55:00 -0500] fujin: what you mean "call resources"
[2012-02-02 21:55:00 -0500] vhogemann: I mean... I want to mount filesystems
[2012-02-02 21:55:00 -0500] vhogemann: and create EBS volumes on amazon
[2012-02-02 21:55:00 -0500] fujin: yes, you can do that stuff from lwrp
[2012-02-02 21:56:00 -0500] vhogemann: same syntax as recipes?
[2012-02-02 21:56:00 -0500] fujin: yeh
[2012-02-02 21:56:00 -0500] fujin: you can use them inside of the action :foo do blocks
[2012-02-02 21:56:00 -0500] fujin: creates a new run context though so you don't have access to resources outside of it usually
[2012-02-02 21:56:00 -0500] vhogemann: so, inside my Provider, I can do : import recipe 'aws'
[2012-02-02 21:56:00 -0500] fujin: yes
[2012-02-02 21:56:00 -0500] fujin: you can
[2012-02-02 21:57:00 -0500] fujin: but as i said it is a new run context
[2012-02-02 21:57:00 -0500] vhogemann: Sweet
[2012-02-02 21:57:00 -0500] fujin: if aws has already been evaluated once.. well the new context doesn't know about it.
[2012-02-02 21:57:00 -0500] fujin: so it will be evaluated at least once more
[2012-02-02 21:57:00 -0500] fujin: e.g. include_recipe "aws"; include_recipe "your_recipe::lwrps", your lwrp includes aws, it'll get incl. 2x
[2012-02-02 21:57:00 -0500] fujin: at least, that is the behavior I noticed last time I attempted some crazy include-recipe-in-lwrp stuff.
[2012-02-02 21:58:00 -0500] vhogemann: Ok, I'll keep this im mind
[2012-02-02 21:58:00 -0500] vhogemann: thanks
[2012-02-02 22:04:00 -0500] betamatt: Is anyone using environments to manage the process of testing and promoting chef recipes from staging to production? What do you do about roles, which can't be managed that way?
[2012-02-02 22:05:00 -0500] betamatt: (we're finally upgrading out 0.9 setup)
[2012-02-02 22:07:00 -0500] Brad_K: we've just started using environments this way.  our plan is to have the cookbooks lock down the specific versions of the packages that are installed and the other resources that are provided, and then lock the environments down to certain specific cookbook versions.
[2012-02-02 22:12:00 -0500] holoway: betamatt: you can use environment specific run lists for changes to the run list
[2012-02-02 22:13:00 -0500] betamatt: what about attributes that are set in the role?
[2012-02-02 22:13:00 -0500] holoway: betamatt: and you can have environment-specific keys in your data structures for attributes
[2012-02-02 22:13:00 -0500] miketheman: anyone use freebsd?
[2012-02-02 22:14:00 -0500] miketheman: (I don't but need it  for a build system...)
[2012-02-02 22:30:00 -0500] jstump: Can you download your roles in OpsCode back into files?
[2012-02-02 22:30:00 -0500] jstump: I created a few with knife environment create and would like to have versioning locally.
[2012-02-02 22:31:00 -0500] holoway: jstump: sure - knife role show foo with the json output turned on and a redirect
[2012-02-02 22:32:00 -0500] jstump: holoway: I mixed up my words (though that's important too), I need environment (and roles). Same deal?
[2012-02-02 22:33:00 -0500] holoway: jstump: aye!
[2012-02-02 22:33:00 -0500] jstump: holoway: do I drop those into environments/{name}.json?
[2012-02-02 22:33:00 -0500] jstump: and roles/{role_name}.json?
[2012-02-02 22:35:00 -0500] holoway: sure!
[2012-02-02 22:37:00 -0500] laurent\: i'm having issues with chef and my old couchdb (0.11.0). for some reason i've been starting to get some os_process_error,{exit_status,0} errors, https://gist.github.com/1726030
[2012-02-02 22:38:00 -0500] laurent\: i've no knowledge of couchdb at all, i can't replicate or dump/load the database, there must be something wrong it, and i don't know what
[2012-02-02 22:38:00 -0500] laurent\: is there a way to recover it ?
[2012-02-02 22:41:00 -0500] yatesy: holoway: great tip, thanks :)
[2012-02-02 22:41:00 -0500] betamatt: holoway: env-specific attributes seem a bit of a hack since it routes around the way chef layers attributes but I'll think on ways we could use that. would be nice to have environments be a little more sandboxed but it doesn't seem like that's the design.
[2012-02-02 22:42:00 -0500] laurent\: i can't access any of the view, is there a way to rebuild them ?
[2012-02-02 22:43:00 -0500] betamatt: holoway: also negates the "test and promote" methodology we're trying to go for
[2012-02-02 22:43:00 -0500] laurent\: are you moving away from couchdb for the next version btw ?
[2012-02-02 22:44:00 -0500] laurent\: (i don't mind speaking to myself :))
[2012-02-02 22:49:00 -0500] mattray: betamatt: "routes around"? http://wiki.opscode.com/display/chef/Attributes#Attributes-Precedence
[2012-02-02 22:50:00 -0500] mattray: laurent\: I believe the intention is for Chef 11 to be all SQL, no couch
[2012-02-02 22:50:00 -0500] mattray: laurent\: we're still porting it
[2012-02-02 22:50:00 -0500] miketheman: mattray: what about other document-oriented stores?
[2012-02-02 22:50:00 -0500] jtimberman: reset: sorry, not sure offhand. open a CHEF ticket?
[2012-02-02 22:50:00 -0500] betamatt: mattray: maybe I am misunderstanding what is being proposed :Reads:
[2012-02-02 22:50:00 -0500] reset: jtimberman: I figured out the problem
[2012-02-02 22:51:00 -0500] reset: jtimberman: it's VERY weird, but i'll open a ticket
[2012-02-02 22:52:00 -0500] mattray: miketheman: http://wiki.opscode.com/display/chef/Opscode+Chef+Short-Term+Roadmap+and+Performance+Improvements
[2012-02-02 22:52:00 -0500] laurent\: miketheman: there are people using freebsd here, doesn't look like they're in front of their screen right now
[2012-02-02 22:53:00 -0500] betamatt: mattray: holoway seems to be referring to environment-spacing attributes in role files as such: override[:cookbook][ENV][:feature] = 'y'
[2012-02-02 22:53:00 -0500] miketheman: mattray: saw that. Curious how the element model will map to sql db's, considering the extensible part of an ohai repsonse
[2012-02-02 22:53:00 -0500] laurent\: mattray: and what about the search engine ?
[2012-02-02 22:54:00 -0500] laurent\: me too
[2012-02-02 22:54:00 -0500] laurent\: but right now i don't give a shit (pardon my french) about that, i want to recover from my couchdb corruption
[2012-02-02 22:55:00 -0500] |shad0w|: I'm using fbsd, read up but didn't see a question about it
[2012-02-02 22:55:00 -0500] laurent\: looks like i'm able to read from every document from the "all document" view (sorry i'm not a couchdb expert), is there a way to rebuild the views ?
[2012-02-02 22:56:00 -0500] laurent\: s/from//
[2012-02-02 22:56:00 -0500] miketheman: |shad0w|: using with chef deployed? can you point me to any existing cookbooks/bootstrap methods?
[2012-02-02 22:56:00 -0500] |shad0w|: we built our own bootstrap
[2012-02-02 22:57:00 -0500] mattray: miketheman: I believe they're just storing JSON blobs in the DB and it's faster than JSON documents in couch
[2012-02-02 22:57:00 -0500] mattray: but I'm not in the guts
[2012-02-02 22:57:00 -0500] |shad0w|: have a port of a standalone ruby instance for the client too (not sure where that project ended up though)
[2012-02-02 22:57:00 -0500] miketheman: mattray: considering that most queries are mapreduces over a single database containing all the of the elements, it that the best way to tackle something?
[2012-02-02 22:58:00 -0500] miketheman: |shad0w|: can you share the bootstrap?
[2012-02-02 22:58:00 -0500] |shad0w|: yeah, give me a sec to clean out some internal stuff
[2012-02-02 22:58:00 -0500] |shad0w|: have it loading a version specif chef build that has some local changes
[2012-02-02 22:58:00 -0500] mattray: miketheman: I'm not the person to ask. I'll defer to engineering and their copious benchmarking and testing and understanding of what the data and requests look like :)
[2012-02-02 22:59:00 -0500] mattray: miketheman: skeptomai is the CTO
[2012-02-02 22:59:00 -0500] mattray: miketheman: holoway is the CPO
[2012-02-02 22:59:00 -0500] miketheman: mattray: do they ever jump in here and see these discussions?
[2012-02-02 22:59:00 -0500] mattray: absolutely
[2012-02-02 23:00:00 -0500] mattray: miketheman: lots of folks who know the server side are frequently in here
[2012-02-02 23:00:00 -0500] mattray: I just write cookbooks :)
[2012-02-02 23:01:00 -0500] miketheman: what's a CPO?
[2012-02-02 23:01:00 -0500] miketheman: do I need one?
[2012-02-02 23:01:00 -0500] mattray: heh, he's actually the CCO. Chief Customer Officer now
[2012-02-02 23:01:00 -0500] mattray: CPO was Product Officer
[2012-02-02 23:02:00 -0500] mattray: making folks happy with Chef
[2012-02-02 23:02:00 -0500] miketheman: ok, I'll pretend that makes sense. ;)
[2012-02-02 23:03:00 -0500] mattray: these guys: http://www.opscode.com/team/
[2012-02-02 23:03:00 -0500] Brad_K: you see lots of names in here, only you just don't necessarily connect them with who they are in the p-world.
[2012-02-02 23:04:00 -0500] |shad0w|: miketheman, check pm
[2012-02-02 23:04:00 -0500] miketheman: |shad0w|: got it, thanks!
[2012-02-02 23:05:00 -0500] siezer: I just make slide decks and curse a lot
[2012-02-02 23:05:00 -0500] siezer: .wii miketheman
[2012-02-02 23:05:00 -0500] siezer: er
[2012-02-02 23:05:00 -0500] Brad_K: heck, some of the people in this room don't even work for opscode!  ;-)
[2012-02-02 23:06:00 -0500] |shad0w|: meh, reminds me that I need to go write something to rpm up the gems for chef-client
[2012-02-02 23:06:00 -0500] Brad_K: the rpm users amongst us appreciate the work you do, very much.  thanks!
[2012-02-02 23:06:00 -0500] |shad0w|: ??
[2012-02-02 23:07:00 -0500] siezer: shad0w have you seen the rbel repos?
[2012-02-02 23:07:00 -0500] Brad_K: just saying that us rpm users gotta stick together.
[2012-02-02 23:07:00 -0500] siezer: shad0w also have you seen http://www.opscode.com/chef/install.sh
[2012-02-02 23:08:00 -0500] |shad0w|: siezer, last I looked the rbl stuff replaced system ruby
[2012-02-02 23:08:00 -0500] |shad0w|: which I don't want to do
[2012-02-02 23:08:00 -0500] siezer: aha. good call
[2012-02-02 23:08:00 -0500] siezer: check out the omnibus installers then
[2012-02-02 23:08:00 -0500] siezer: everything above libc in /opt/opscode
[2012-02-02 23:09:00 -0500] |shad0w|: do they still build from source?
[2012-02-02 23:09:00 -0500] |shad0w|: I want to get to a point where I can deploy without needing a compiler
[2012-02-02 23:09:00 -0500] miketheman: siezer: there's already a port for freebsd, and omnibus requires a compiler
[2012-02-02 23:09:00 -0500] siezer: nope, all binary
[2012-02-02 23:09:00 -0500] miketheman: siezer: lies! when I want more gems, compilers are needed
[2012-02-02 23:09:00 -0500] siezer: well building the omnibus installers obviously requires a binary
[2012-02-02 23:09:00 -0500] siezer: er, compiler
[2012-02-02 23:10:00 -0500] Brad_K: the Full Stack Installer doesn't require a compiler for itself, at least not so far as I've seen.  obviously, some of the additional cookbooks or gems might require compilers....
[2012-02-02 23:10:00 -0500] miketheman: Brad_K: yes. it's that some distros have the compiled binaries already, and cannot "include" them into the omnibus install
[2012-02-02 23:12:00 -0500] Brad_K: the point of the omnibus install is that you get an embedded version of ruby and everything else needed for chef, which does not conflict or interact with any of the other installed software, at least not unless your cookbook or other tools cause that to happen after chef itself is installed.
[2012-02-02 23:12:00 -0500] siezer: sooo.... anybody know the best way to get ruby running on an AIX box?
[2012-02-02 23:12:00 -0500] Brad_K: now, chef-server is a whole different kettle-o-fish.
[2012-02-02 23:12:00 -0500] miketheman: of course.
[2012-02-02 23:14:00 -0500] Brad_K: siezer: i'm not familiar with AIX myself, but i know some people who are, some of whom might be messing about with chef.  should i ask around?
[2012-02-02 23:14:00 -0500] miketheman: but considering that many cookbooks leverage the ability to import gems from packages, having a compilation occur despite a distro providing the binary seems wasteful
[2012-02-02 23:14:00 -0500] miketheman: siezer: http://blog.karthiks.in/2006/03/compiling-ruby-on-ibm-aix.html
[2012-02-02 23:15:00 -0500] Brad_K: miketheman: there is duplication, yes.  but sometimes there is a good reason for the duplication  just like there is sometimes a good reason for de-normalizing your database.
[2012-02-02 23:15:00 -0500] siezer: miketheman most of the core ruby gems need to compile a c extension to make them to fast (json, mysql, etc)
[2012-02-02 23:15:00 -0500] siezer: and therefore need a compiler
[2012-02-02 23:15:00 -0500] siezer: I'd venture to say running a ruby application on a machine without a compiler and half the available system libraries (zlib and friends) is an exercise in futility
[2012-02-02 23:16:00 -0500] |shad0w|: just because im running chef doesn't mean I'm deploying ruby apps :P
[2012-02-02 23:18:00 -0500] siezer: right. which is why you don't need anything to run the obminus/fullstack installers
[2012-02-02 23:18:00 -0500] siezer: =)
[2012-02-02 23:18:00 -0500] Brad_K: if you're using chef, then you're programming in ruby, and by virtue of the fact that you're deploying things with chef that means that you are deploying at least one highly customized ruby app  whatever it is that you've built with chef.  and doing that with the base standard gems and without any other plugins or other tools that might require a compiler is  hard.
[2012-02-02 23:19:00 -0500] |shad0w|: fullstack rpm looks somewhat okay, where is the srpm for it?
[2012-02-02 23:19:00 -0500] Brad_K: obminus.  my new favourite word of the day!
[2012-02-02 23:20:00 -0500] Brad_K: the srpm would be internal to opscode.
[2012-02-02 23:20:00 -0500] spicyWith: does anyone here actually do the deploy of code using chef?
[2012-02-02 23:20:00 -0500] Brad_K: we do.
[2012-02-02 23:20:00 -0500] holoway: |shad0w| you can see the current build process at github.com/opscode/omnibus
[2012-02-02 23:20:00 -0500] spicyWith: Brad_K: could you explain?
[2012-02-02 23:20:00 -0500] holoway: |shad0w| you can also just get the new installers at http://www.opscode.com/chef/install
[2012-02-02 23:21:00 -0500] |shad0w|: thanks hobodave
[2012-02-02 23:21:00 -0500] |shad0w|: holoway even
[2012-02-02 23:21:00 -0500] holoway: miketheman: you can still compile stuff and stick it in omnibus, you just need to make sure the toolchain is available on the system
[2012-02-02 23:21:00 -0500] |shad0w|: well, we often patch some of chef-client
[2012-02-02 23:21:00 -0500] |shad0w|: if I'd use it I'd have to be able to build it myself
[2012-02-02 23:21:00 -0500] Brad_K: we build the stuff we're going to deploy as an rpm, which we deploy with recipes, just like any other rpm.  we have our own internal repo that we use for that kind of thing.
[2012-02-02 23:22:00 -0500] laurent\: i'm still stuck with my couchdb issue, can anybody help ?
[2012-02-02 23:22:00 -0500] siezer: the rpm is assebled with fpm
[2012-02-02 23:22:00 -0500] miketheman: holoway: so I'd compile/package my own gems? and deploy them pre/post-omnibus install?
[2012-02-02 23:23:00 -0500] Brad_K: and thanks to advice from folks at opscode, we also use fpm in building our rpms.
[2012-02-02 23:23:00 -0500] holoway: miketheman: yep, if you wanted to totally avoid a compiler on the edges
[2012-02-02 23:23:00 -0500] holoway: miketheman: the easy way would be to install the omnibus build on your build system
[2012-02-02 23:23:00 -0500] NightMonkey: Does fpm create RPMS with good dependencies? That's my main problem with hand-built RPMS.
[2012-02-02 23:23:00 -0500] siezer: miketheman are you talking about gems external to chef to power an application? Or to use as a gem needed by chef in a recipe?
[2012-02-02 23:24:00 -0500] holoway: miketheman: then do whatever you need to get things installed (/opt/opscode/embedded/bin/gem install foobar)
[2012-02-02 23:24:00 -0500] holoway: miketheman: and use fpm to rebundle
[2012-02-02 23:24:00 -0500] Brad_K: internally, fpm uses rpmbuild, so yes  the dependency chain should be good, if you've done your job in preparing what goes into the rpm.
[2012-02-02 23:24:00 -0500] spicyWith: Brad_K: ok, got it. so it's not really through git or anything similar
[2012-02-02 23:25:00 -0500] Brad_K: and fpm gives you relatively easy ways to specify any additional dependencies if you want.
[2012-02-02 23:25:00 -0500] |shad0w|: laurent\ have you looked at https://issues.apache.org/jira/browse/COUCHDB-893
[2012-02-02 23:25:00 -0500] spicyWith: not sure what an fpm is, lemme check it out
[2012-02-02 23:26:00 -0500] Brad_K: spicyWith: no, we don't deploy direct from git.  we gateway through jenkins to create the binaries and the rpms from the binaries, which get pushed to the repo.  from there, the recipes in the cookbooks have to be updated, and because we lock down our environments to only certain versions of the cookbooks, that has to be updated as well.
[2012-02-02 23:26:00 -0500] Brad_K: fpm == effin' package manager.
[2012-02-02 23:26:00 -0500] Brad_K: it's a gem.
[2012-02-02 23:26:00 -0500] siezer: what the shit AIX has rpm on it???
[2012-02-02 23:26:00 -0500] siezer: mind blow.
[2012-02-02 23:26:00 -0500] siezer: n
[2012-02-02 23:26:00 -0500] Brad_K: https://github.com/jordansissel/fpm/wiki
[2012-02-02 23:26:00 -0500] |shad0w|: fpm is a nasty solution to people who don't want to learn packaging for different package managers :P
[2012-02-02 23:26:00 -0500] laurent\: |shad0w|: thanks for answering me ! i'm not invisible in the end :) yep i found that, but i'm stuck with a my couchdb i can't export or use anymore.
[2012-02-02 23:27:00 -0500] laurent\: so i can't upgrade to 1.1.1
[2012-02-02 23:27:00 -0500] |shad0w|: laurent\, I'm not that familar with couch but its the storage just a file(s)?
[2012-02-02 23:28:00 -0500] holoway: laurent\: what's the issue?
[2012-02-02 23:28:00 -0500] laurent\: |shad0w|: yep, please don't tell me about restoring from backup (i wouldn't be that desperate otherwise)
[2012-02-02 23:28:00 -0500] spicyWith: Brad_K: any idea if this would this work with django + python + pip?
[2012-02-02 23:29:00 -0500] |shad0w|: no, but you could build a version with the patch and load a copy of the file
[2012-02-02 23:29:00 -0500] Brad_K: spicyWith: it says "python" - make a package from a python module (via easy_install or local setup.py)
[2012-02-02 23:29:00 -0500] miketheman: holoway: that seems like a valid approach, especially if I don't allow compilers
[2012-02-02 23:29:00 -0500] laurent\: holoway: couchdb complaining with "os_process_error,{exit_status,0}" error, it happens when i was knife cookbook uploading
[2012-02-02 23:29:00 -0500] Brad_K: dunno if that would work with pip, though.
[2012-02-02 23:29:00 -0500] Brad_K: your best bet would be to talk to Jordan.
[2012-02-02 23:30:00 -0500] spicyWith: Brad_K: is he here?
[2012-02-02 23:30:00 -0500] spicyWith: Brad_K: also, how do you trigger the download from the server?
[2012-02-02 23:30:00 -0500] Brad_K: Jordan's page is at https://github.com/jordansissel
[2012-02-02 23:30:00 -0500] aussiegeek: I've just added a new role to a node, ran chef-client, but now when I search for nodes containing that role, there are 0 results. I've restarted solr/expaner/chef-server, but I'm not sure where to look next
[2012-02-02 23:30:00 -0500] laurent\: don't really know if it's related to the cookbook upload, in futon i can only use the "all documents" view, every other views give the error
[2012-02-02 23:30:00 -0500] Brad_K: you should be able to contact him through that page.
[2012-02-02 23:30:00 -0500] miketheman: siezer: it's typically stuff to allow chef to make smart decisions in cookbooks - such as the database cookbook needing the mysql gem, et al.
[2012-02-02 23:31:00 -0500] laurent\: been trying to replicate the database from couchdb but the replicated db gives the same errors
[2012-02-02 23:32:00 -0500] laurent\: beeen trying to couchdb_dump and couchdb_load but the restore bit complains about "data integrity check failed"
[2012-02-02 23:33:00 -0500] laurent\: and as you can guess, i'm only using couchdb because i need it for chef, i'm don't know it at all
[2012-02-02 23:34:00 -0500] spicyWith: Brad_K: thanks. Do you know of anyone in the channel that deploys using git?
[2012-02-02 23:34:00 -0500] Brad_K: spicyWith: not personally, no.
[2012-02-02 23:35:00 -0500] spicyWith: Brad_K: just out of curiosity, what are you deploying using rpms/
[2012-02-02 23:35:00 -0500] laurent\: and in that case it's kind of useless to ask on #couchdb because you don't know anything about the internals
[2012-02-02 23:35:00 -0500] spicyWith: ?
[2012-02-02 23:36:00 -0500] laurent\: i'm playing with git to workaround some chef (opensource) limitations and i'm also experimenting with binaries
[2012-02-02 23:36:00 -0500] Brad_K: spicyWith: all of the rpms for all the packages we use, including standard tools like monit, rsyslog, etc.  we also deploy all of our custom content, including all our website files, Java .war files, custom applications we've written on top of RabbitMQ, etc.
[2012-02-02 23:36:00 -0500] laurent\: i was i mean
[2012-02-02 23:37:00 -0500] spicyWith: Brad_K: what's the final application?
[2012-02-02 23:39:00 -0500] Brad_K: spicyWith: final application of?  we have a small cluster of production machines, a web load balancer using haproxy, a couple of front-end web servers using lighttpd, a Jetty application server for one small part of the overall puzzle, a custom middleware layer that takes jobs that are submitted through the web interface and processes them, all of which is backed by a sharded/replicated MongoDB cluster.  there's some back-end admin machines also in ther
[2012-02-02 23:40:00 -0500] Brad_K: spicyWith: basically, everything we have or do online for our customers will be done on or through this system.
[2012-02-02 23:40:00 -0500] spicyWith: Brad_K: oh, sorry, was just wondering what company/website this was
[2012-02-02 23:41:00 -0500] Brad_K: a tiny little company called ihiji.  we've got only seven employees.
[2012-02-02 23:42:00 -0500] miketheman: Brad_K: interesting
[2012-02-02 23:43:00 -0500] spicyWith: Brad_K: and a badass setup :)
[2012-02-02 23:44:00 -0500] miketheman: Brad_K: with that size, are you using a opensource chef, or the opscode hosted chef?
[2012-02-02 23:44:00 -0500] miketheman: (if you don't mind my asking)
[2012-02-02 23:44:00 -0500] Brad_K: spicyWith: miketheman: see http://www.cepro.com/article/ihiji_adds_low_cost_remote_monitoring_appliance_at_cedia/
[2012-02-02 23:44:00 -0500] Brad_K: we're a Hosted Chef customer.
[2012-02-02 23:45:00 -0500] miketheman: nice
[2012-02-02 23:46:00 -0500] Brad_K: for a look at the older version of the appliance, check out http://www.electronichouse.com/article/ihiji_adds_control4_and_zigbee_support/
[2012-02-02 23:46:00 -0500] miketheman: I kinda want to plug one of these into the dc network.
[2012-02-02 23:47:00 -0500] spicyWith: miketheman: do you deploy code using git?
[2012-02-02 23:48:00 -0500] miketheman: spicyWith: we do, but not via chef.
[2012-02-02 23:48:00 -0500] spicyWith: miketheman: what do you use?
[2012-02-02 23:48:00 -0500] Brad_K: miketheman: they're really awesome to hold in your hands and realize that it's a full-on low power Linux box to act as an agent for remote monitoring.
[2012-02-02 23:48:00 -0500] laurent\: would recreating an empty chef couch db and adding documents one by one work ?
[2012-02-02 23:48:00 -0500] miketheman: spicyWith: custom in-house code, that interacts with our commercial lb to "drain" an instance before deploying new code to it.
[2012-02-02 23:49:00 -0500] Brad_K: spicyWith: i've also heard of people who deploy code with Capistrano, but i don't know anything about it.
[2012-02-02 23:49:00 -0500] spicyWith: miketheman: drain in the sense of no more user sessions on it. Something like fabric or capistrano?
[2012-02-02 23:49:00 -0500] miketheman: Brad_K: yes. have you ever seen the gumstix products?
[2012-02-02 23:50:00 -0500] spicyWith: Brad_K: yeah, I used to use fabric, but I think some of it can be substituted with chef
[2012-02-02 23:50:00 -0500] miketheman: spicyWith: something like that, but purely custom in house code
[2012-02-02 23:50:00 -0500] siezer: spicyWith http://wiki.opscode.com/display/chef/Deploy+Resource
[2012-02-02 23:50:00 -0500] erikh: we use capistrano with some patches for chef search
[2012-02-02 23:50:00 -0500] erikh: so you can wean your roles from chef search, etc.
[2012-02-02 23:51:00 -0500] spicyWith: erikh: oh, beautiful, yes, that's what I would love. I guess chef has an API after all....
[2012-02-02 23:51:00 -0500] miketheman: could probably eventually port the logic into chef, but not a priority now - the devs want to push on demand
[2012-02-02 23:51:00 -0500] erikh: chef's API isn't hard to suss out -- it's just not in your face, you have to do some source diving.
[2012-02-02 23:51:00 -0500] siezer: you mean they want to trigger pulls on demand
[2012-02-02 23:51:00 -0500] miketheman: siezer: yep
[2012-02-02 23:52:00 -0500] Brad_K: miketheman: no, i've not seen the gumstix other than pictures in a magazine or online, but these are actually quite powerful little boxes.
[2012-02-02 23:53:00 -0500] spicyWith: siezer: thanks :)
[2012-02-02 23:59:00 -0500] spicyWith: siezer: any idea of how to deal with ssh keys for github, for example?
[2012-02-02 23:59:00 -0500] spicyWith: siezer: nm, found the doc
