[2012-02-07 08:43:00 -0500] mosez: is it possible to access the node hash within LWRP implementations?
[2012-02-07 08:43:00 -0500] mosez: i want to get node[:fqdn] within my lwrp
[2012-02-07 09:07:00 -0500] mosez: done, the node hash is available within the lwrp
[2012-02-07 09:38:00 -0500] nacer: ohai
[2012-02-07 09:38:00 -0500] nacer: mosez: i think you can
[2012-02-07 09:54:00 -0500] mosez: nacer: already got that. node is directly available :)
[2012-02-07 09:55:00 -0500] nacer: mosez: :)
[2012-02-07 09:55:00 -0500] nacer: mosez: what kind of lwrp are you doing ?
[2012-02-07 09:55:00 -0500] mosez: nacer: a modified version of apt :)
[2012-02-07 09:55:00 -0500] mosez: nacer: and a port of the apache stuff for lighttpd web_app's
[2012-02-07 09:56:00 -0500] nacer: mosez: cool for the lighttpd web_app
[2012-02-07 09:56:00 -0500] mosez: nacer: i will publish it on github when it's done :)
[2012-02-07 10:42:00 -0500] der_flo: Hello
[2012-02-07 10:42:00 -0500] labria: hi
[2012-02-07 10:43:00 -0500] der_flo: I'm search for an easy way to group resources together and set a group-wide "not_if" condition.
[2012-02-07 10:43:00 -0500] der_flo: Any hints?
[2012-02-07 10:44:00 -0500] erikh: probably best to assign the block or string to a variable, and reference that in your recipes
[2012-02-07 10:46:00 -0500] der_flo: I understand.
[2012-02-07 10:50:00 -0500] labria: erikh if the condition is available at compile time, you can wrap the whole group with a simple "if"
[2012-02-07 10:51:00 -0500] der_flo: "compile time" is on the node where the resources are applied?
[2012-02-07 10:51:00 -0500] labria: yes, before any of them are executed
[2012-02-07 10:53:00 -0500] der_flo: Ok, that should be a nice solution.
[2012-02-07 10:54:00 -0500] der_flo: I'll try that. Thank you for all the solutions.
[2012-02-07 10:54:00 -0500] labria: np
[2012-02-07 10:54:00 -0500] der_flo: Have a nice day. Bye bye
[2012-02-07 10:55:00 -0500] erikh: labria: if he has not_if { File.exist?("foo") } which is created by another resource
[2012-02-07 10:55:00 -0500] erikh: he's gonna have to converge twice before it actually works with a normal 'if' statement.
[2012-02-07 10:56:00 -0500] labria: if he'll have "unless  File.exist?("foo")" the resources won't be created
[2012-02-07 10:56:00 -0500] labria: (if foo exists)
[2012-02-07 10:57:00 -0500] erikh: file "foo" { action :create } breaks your idea
[2012-02-07 10:57:00 -0500] labria: why?
[2012-02-07 10:57:00 -0500] erikh: because the resources aren't applied until converge time -- not compile time
[2012-02-07 10:57:00 -0500] erikh: are you familiar with the two phases of a chef run?
[2012-02-07 10:57:00 -0500] labria: does not exist => gets created => never runs again
[2012-02-07 10:58:00 -0500] erikh: yes
[2012-02-07 10:58:00 -0500] erikh: which will require two converge runs.
[2012-02-07 10:58:00 -0500] erikh: (which may be harmful)
[2012-02-07 10:58:00 -0500] labria: why again?
[2012-02-07 10:58:00 -0500] erikh: go read the "anatomy of a chef run" wiki page.
[2012-02-07 10:59:00 -0500] labria: if the file exists, nothing happens (blocked by the if)
[2012-02-07 10:59:00 -0500] erikh: please, go read the wiki
[2012-02-07 10:59:00 -0500] erikh: :)
[2012-02-07 10:59:00 -0500] labria: if the file does not exist, the resource is created in the first phase and then converged in the second
[2012-02-07 10:59:00 -0500] erikh: yes -- that's two converge runs
[2012-02-07 10:59:00 -0500] erikh: exactly what I said
[2012-02-07 10:59:00 -0500] erikh: which may or may not be ok
[2012-02-07 11:00:00 -0500] labria: where do you see a second run here? the first check is pure-ruby unrelated to chef
[2012-02-07 11:00:00 -0500] erikh: the file gets created in the first *converge*, then in the second run the file exists
[2012-02-07 11:00:00 -0500] erikh: not until then
[2012-02-07 11:00:00 -0500] erikh: resources are not applied until converge.
[2012-02-07 11:01:00 -0500] erikh: which means in the first run that check will fail -- and could be harmful
[2012-02-07 11:01:00 -0500] erikh: that's the whole point of not_if/only_if
[2012-02-07 11:01:00 -0500] fujin: there's one converge run
[2012-02-07 11:01:00 -0500] fujin: not two
[2012-02-07 11:01:00 -0500] fujin: it's two phase because the dsl is compiled into resource objects
[2012-02-07 11:02:00 -0500] erikh: right
[2012-02-07 11:02:00 -0500] fujin: in the second phase the actions are all run
[2012-02-07 11:02:00 -0500] erikh: I'm not disputing that
[2012-02-07 11:02:00 -0500] erikh: right
[2012-02-07 11:02:00 -0500] fujin: well then, carry on. :)
[2012-02-07 11:02:00 -0500] labria: and what are you disputing?
[2012-02-07 11:02:00 -0500] erikh: that's what I'm saying -- in the first compile, the check fails then the resource is applied, then on the second compile, the check succeeds
[2012-02-07 11:02:00 -0500] labria: here's the code for reference: https://gist.github.com/e435c0ae9398e9964b9c
[2012-02-07 11:03:00 -0500] erikh: in the *first* compile, the resources will get run where in a not_if scenario the resources could be ordered as such to not allow this
[2012-02-07 11:03:00 -0500] erikh: well it'll all be deferred to the converge is what i'm saying.
[2012-02-07 11:03:00 -0500] fujin: labria: if you manage foo with a not_if then you will be able to notify that resource, re-open it, etc
[2012-02-07 11:03:00 -0500] fujin: it's params will be available to report handlers
[2012-02-07 11:04:00 -0500] erikh: https://gist.github.com/2e3e85455f5fb544145b
[2012-02-07 11:04:00 -0500] erikh: this deletes "bar" on the first run.
[2012-02-07 11:04:00 -0500] labria: erikh wow, now that's absolutely NOT what we're talking about
[2012-02-07 11:05:00 -0500] fujin: erikh: no, it won't
[2012-02-07 11:05:00 -0500] fujin: you need to reread that.
[2012-02-07 11:05:00 -0500] fujin: action :create gets fired during *convergence* phase. the lines after that, evaluated during *compile* phase, will not be ran
[2012-02-07 11:05:00 -0500] fujin: the delete resource will not be evaluated
[2012-02-07 11:05:00 -0500] fujin: the action will not be set to :delete
[2012-02-07 11:05:00 -0500] labria: fujin notice the _unless_
[2012-02-07 11:05:00 -0500] fujin: .........................................
[2012-02-07 11:05:00 -0500] erikh: the file won't be created until the converge run
[2012-02-07 11:06:00 -0500] erikh: which means that the "bar" resource will be added to the first converge.
[2012-02-07 11:06:00 -0500] labria: erikh yes, in your case you'll get problems for sure at some point.
[2012-02-07 11:06:00 -0500] erikh: that's what I was referring to
[2012-02-07 11:06:00 -0500] labria: what I was suggesting is wrapping _all_ of the related resources with a common conditional.
[2012-02-07 11:07:00 -0500] labria: this way its all or nothing, and no conflict should arise, and no double runs
[2012-02-07 11:07:00 -0500] erikh: right, but if that conditional races like I suggested --  that will happen, which is why not_if is a lot safer, if more verbose
[2012-02-07 11:07:00 -0500] erikh: I mean it all depends on context I suppose
[2012-02-07 11:08:00 -0500] labria: I use it sometimes for things like "if node.roles.include?("foobar")". It's a hack, but for a hack it's quite a clean one
[2012-02-07 11:08:00 -0500] erikh: oh sure
[2012-02-07 11:08:00 -0500] erikh: I'm not saying it's useless
[2012-02-07 11:08:00 -0500] labria: but you have to use it with care, understanding what this will result in
[2012-02-07 11:08:00 -0500] erikh: right... it's easy to get wrong. that's all I was suggesting.
[2012-02-07 11:31:00 -0500] yatesy: s
[2012-02-07 11:34:00 -0500] yatesy: arg, ignore that eronious s there!
[2012-02-07 12:34:00 -0500] linuxboy_: hi guys
[2012-02-07 12:34:00 -0500] linuxboy_: I've just setup a new chef-server (with chef-client installed on teh same box) and I keep getting this when I run chef-client:
[2012-02-07 12:34:00 -0500] linuxboy_: [Tue, 07 Feb 2012 12:31:47 +0000] INFO: HTTP Request Returned 401 Unauthorized: Failed to authenticate. Ensure that your client key is valid.
[2012-02-07 12:34:00 -0500] linuxboy_: [Tue, 07 Feb 2012 12:31:47 +0000] FATAL: Stacktrace dumped to /var/cache/chef/chef-stacktrace.out
[2012-02-07 12:34:00 -0500] linuxboy_: [Tue, 07 Feb 2012 12:31:47 +0000] FATAL: Net::HTTPServerException: 401 "Unauthorized"
[2012-02-07 12:35:00 -0500] BryanWB: linuxboy_: did u connect to a different chef-server previously?
[2012-02-07 12:35:00 -0500] linuxboy_: nope, new box
[2012-02-07 12:35:00 -0500] BryanWB: does your client have the validation.pem from your new chef-server?
[2012-02-07 12:35:00 -0500] ctrabold: linuxboy_: Already checked http://wiki.opscode.com/display/chef/Common+Errors ?
[2012-02-07 12:36:00 -0500] linuxboy_: I'm wanting to run the client on the server
[2012-02-07 12:36:00 -0500] linuxboy_: so the validation.pem file is the same one
[2012-02-07 12:41:00 -0500] linuxboy_: ctrabold: looking now
[2012-02-07 13:38:00 -0500] dkingofpa: I can't seem to find a definitive answer on the wikiwill the default recipe always run, even if you are just using one of the other recipes in the cookbook?
[2012-02-07 13:39:00 -0500] yatesy: no the default is designed so that if you just specify the name of the cookbook in the run list it'll run the default.rb recipe I believe
[2012-02-07 13:40:00 -0500] yatesy: basically an alias for cookbookname::default.rb
[2012-02-07 13:41:00 -0500] dkingofpa: yatesy:  thanks for the info
[2012-02-07 14:16:00 -0500] sidewar: Is it possible to change the FQDN, IP, etc details of a node? Ive just restarted an EC2 instance and now the node data is incorrect.
[2012-02-07 14:27:00 -0500] hcastro: sidewar: run ohai
[2012-02-07 14:31:00 -0500] sidewar: hcastro: Thanks. Ill go learn about ohai.
[2012-02-07 14:33:00 -0500] geekbri: So my chef run blew up with a ArgumentError: Invalid only_if/not_if command: true (TrueClass) error... but I'm having a heck of a time trying to track back to where that error originated from the stack trace.  Any tips on this one?
[2012-02-07 14:33:00 -0500] hcastro: sidewar: ohai is what populates node atributes. if you setup chef-client to run as a daemon, it executes ohai at a 30 minute interval by default
[2012-02-07 14:36:00 -0500] gadolin: hey, is there anything special with the output of knife environment show -Fj ENVNAME, i cannot parse it correctly with JSON.parse, while same command for node works?
[2012-02-07 14:39:00 -0500] hcastro: gadolin: you capturing stderr + stdout by accident?
[2012-02-07 14:40:00 -0500] gadolin: env = (result of execution of the command above), shows valid contented, then after i do result = JSON.parse(env), i can see only evn name
[2012-02-07 14:52:00 -0500] BryanWB: is there an lwrp for apache rewrite rules and ajp proxies?
[2012-02-07 14:54:00 -0500] Scrivener: If my chef run returns HTTP 412 Precondition Failed with the message that there is no cookbook by the specified name ("non_existent_cookbooks" :["newrelic"]...), what could be the issue? I'm missing something, because that cookbook does exist.
[2012-02-07 14:54:00 -0500] Scrivener: Is it required to include a version number, or will it fetch the latest by default?
[2012-02-07 14:57:00 -0500] bugoff: did you upload your cookbook?
[2012-02-07 14:57:00 -0500] bugoff: knife upload cookbook newrelic
[2012-02-07 14:57:00 -0500] bugoff: it will automaticly fetch the latest version
[2012-02-07 14:58:00 -0500] bugoff: hm
[2012-02-07 14:58:00 -0500] bugoff: knife cookbook upload <cookbook> it is
[2012-02-07 14:58:00 -0500] bugoff: if you upload your cookbook it will automaticly generate a new md5 hash
[2012-02-07 14:58:00 -0500] gadolin: hcastro: ah, actually json.parse did create Chef::Environment, so here we go, everything is reachable in a very nice way
[2012-02-07 14:59:00 -0500] bugoff: and see that your cookbook has changed
[2012-02-07 14:59:00 -0500] Scrivener: bugoff: I am pretty clueless when it comes to this, but I thought it would automatically fetch it from opscode for some reason.
[2012-02-07 14:59:00 -0500] Scrivener: Because that's a cookbook that lives up there.
[2012-02-07 14:59:00 -0500] Scrivener: newrelic or newrelic_monitoring:
[2012-02-07 14:59:00 -0500] Scrivener: http://community.opscode.com/cookbooks/newrelic_monitoring
[2012-02-07 15:00:00 -0500] Scrivener: So I never had it on my workstation.
[2012-02-07 15:00:00 -0500] bugoff: aha, thats something different :)
[2012-02-07 15:00:00 -0500] bugoff: i'll take a look if there is a command for that
[2012-02-07 15:00:00 -0500] Scrivener: Hrm...
[2012-02-07 15:01:00 -0500] Scrivener: I had tried "knife cookbook download COOKBOOK [VERSION]" in the past, but got the same "non-existant" messages.
[2012-02-07 15:01:00 -0500] Scrivener: Oh good grief, I missed the "site".
[2012-02-07 15:02:00 -0500] Scrivener: I suppose. Because it just worked.
[2012-02-07 15:02:00 -0500] Scrivener: knife cookbook site download COOKBOOK [VERSION]
[2012-02-07 15:02:00 -0500] bugoff: knife uses :)
[2012-02-07 15:02:00 -0500] bugoff: aha
[2012-02-07 15:02:00 -0500] bugoff: i always download my cookbooks :)
[2012-02-07 15:04:00 -0500] Scrivener: Where should the downloaded .tar.gz be extracted to?
[2012-02-07 15:04:00 -0500] Scrivener: The repo?
[2012-02-07 15:05:00 -0500] Scrivener: Or chef-repo/cookbooks, perhaps..
[2012-02-07 15:06:00 -0500] Scrivener: Nope, still returns nonexistant cookbook.
[2012-02-07 15:06:00 -0500] bugoff: oke
[2012-02-07 15:07:00 -0500] bugoff: so when you use the site install command
[2012-02-07 15:07:00 -0500] bugoff: you still need to upload the file
[2012-02-07 15:07:00 -0500] bugoff: so try knife cookbook upload <cookbook>
[2012-02-07 15:07:00 -0500] Scrivener: I'm currently ssh'd into the remote server, though (sacrilege?), so that doesn't make alot of sense..
[2012-02-07 15:12:00 -0500] bugoff: i think your mixing some things
[2012-02-07 15:13:00 -0500] bugoff: you have a chef server , chef workstation , and chef clients
[2012-02-07 15:13:00 -0500] Scrivener: I found one thing I was missing -- cookbook_path set wrong in knife.rb
[2012-02-07 15:14:00 -0500] Scrivener: Ah, yes, that. =) I do know I have a workstation, and I should be working everything from the workstation (without the need for ssh), but I was having so many problems just getting the server to run, I figured it would be easy to troubleshoot from the server end.
[2012-02-07 15:14:00 -0500] Scrivener: And worry about executing it from my workstation once I knew it actually was operational -- less things to troubleshoot at a time.
[2012-02-07 15:14:00 -0500] Scrivener: The documentation doesn't help much :] But it's getting there.
[2012-02-07 15:15:00 -0500] Scrivener: Now the cookbook successfully attempted its installation, and I just need to add a license key.
[2012-02-07 15:31:00 -0500] jtimberman: BryanWB: using shef for beginners seems like a good idea at first, but i've found people really need some foundation and some hands on with other parts before throwing them at the REPL
[2012-02-07 15:31:00 -0500] jtimberman: most often, they merely forget to enter recipe context, which causes a lot of confusion
[2012-02-07 15:32:00 -0500] frank_: jtimberman: just the man I needed :)
[2012-02-07 15:33:00 -0500] frank_: jtimberman: what's recommended way to throw an error in a recipe?
[2012-02-07 15:33:00 -0500] cwj: raise
[2012-02-07 15:33:00 -0500] cwj: usually right after a Chef::Log.error "zomg!!!"
[2012-02-07 15:35:00 -0500] jtimberman: frank_: What cwj said, or you can use Chef::Application.fatal!("zomg noes")
[2012-02-07 15:35:00 -0500] __chrisf__: Quick question: anyone know what will happen if a recipe uses the DIRECTORY resource with action :create but the dir already exists? Will it attempt to modify the directory based on the owner, group, model you provide or will it simply skip over it?
[2012-02-07 15:36:00 -0500] BryanWB: jtimberman: good point
[2012-02-07 15:36:00 -0500] jtimberman: __chrisf__: It will modify it to match the resource as declared in your recipe.
[2012-02-07 15:38:00 -0500] __chrisf__: thanks jtimberman, I didn't see that happen but hadn't dived deep enough to figure out why. Wanted to make sure my assumption was correct.
[2012-02-07 15:39:00 -0500] helllen: helllo
[2012-02-07 15:39:00 -0500] helllen: what is used chef-expander for?
[2012-02-07 15:40:00 -0500] jtimberman: helllen: it passes JSON data that should be indexed over to SOLR
[2012-02-07 15:40:00 -0500] jtimberman: helllen: JSON data being nodes, clients, data bags, roles
[2012-02-07 15:40:00 -0500] frank_: jtimberman: cwj thanks
[2012-02-07 15:41:00 -0500] jtimberman: __chrisf__: run chef with -l debug
[2012-02-07 15:41:00 -0500] jtimberman: and it will tell you more about what its doing with the resource
[2012-02-07 15:41:00 -0500] mattdawson: if i define override_attributes in two different roles, both which get applied to the node, do they merge?
[2012-02-07 15:41:00 -0500] mattdawson: or does the second role win out?
[2012-02-07 15:41:00 -0500] ssd7: deep merge?
[2012-02-07 15:41:00 -0500] helllen: and what is used solr for?
[2012-02-07 15:41:00 -0500] ssd7: hrmm
[2012-02-07 15:42:00 -0500] ssd7: bawt: deep merge?
[2012-02-07 15:42:00 -0500] __chrisf__: helllen: solr http://lucene.apache.org/solr/
[2012-02-07 15:42:00 -0500] __chrisf__: it's a full-text search platform
[2012-02-07 15:42:00 -0500] ssd7: mattdawson: They are merged.  For the merging rules, see http://wiki.opscode.com/display/chef/Deep+Merge
[2012-02-07 15:42:00 -0500] mattdawson: ssd7: sorry - i know that it's probably a really annoyingly frequent question.
[2012-02-07 15:42:00 -0500] lusis: helllen: solr is used for search
[2012-02-07 15:42:00 -0500] lusis: in your recipes
[2012-02-07 15:43:00 -0500] mattdawson: ssd7: Thanks! i thought that was the case, but couldn't find that page - i knew i'd seen it before.
[2012-02-07 15:43:00 -0500] jtimberman: lusis: ohai ;D
[2012-02-07 15:43:00 -0500] ssd7: mattdawson: Oh, no problem, not annoying at all. I'm just surprised bawt didn't have that link.
[2012-02-07 15:43:00 -0500] ssd7: bawt: deep merge is http://wiki.opscode.com/display/chef/Deep+Merge
[2012-02-07 15:43:00 -0500] lusis: jtimberman: ohai indeed
[2012-02-07 15:43:00 -0500] ssd7: bawt hates me
[2012-02-07 15:43:00 -0500] helllen: is it necessary for chef-server ?
[2012-02-07 15:44:00 -0500] lusis: bawt ssd7 is someone I hate
[2012-02-07 15:44:00 -0500] lusis: bawt ssd7
[2012-02-07 15:44:00 -0500] lusis: bah
[2012-02-07 15:44:00 -0500] lusis: helllen: yes, it is
[2012-02-07 15:44:00 -0500] lusis: helllen: if you'd like to use search
[2012-02-07 15:44:00 -0500] __chrisf__: about the deep merge: is it a two pass system? The other day I was trying to access the hash content set in one attribute file to dynamically generate another attribute file and ran into some issues I decided to find a simpler workaround.
[2012-02-07 15:45:00 -0500] helllen: and if I don not use search
[2012-02-07 15:45:00 -0500] helllen: ?
[2012-02-07 15:45:00 -0500] brettweavnet: Anyone have a good link to steps for using encrypted data bags w/ chef solo?
[2012-02-07 15:46:00 -0500] lusis: helllen: you'll still need it
[2012-02-07 15:46:00 -0500] lusis: the chef-server setup is a stack
[2012-02-07 15:46:00 -0500] mattdawson: bawt snack
[2012-02-07 15:46:00 -0500] lusis: if you don't need search, you really don't need chef-server
[2012-02-07 15:47:00 -0500] mattdawson: ssd7: didn't that used to do something? :)
[2012-02-07 15:47:00 -0500] lusis: I mean there are other things obviously that server provides
[2012-02-07 15:47:00 -0500] lusis: I think bawt is hung
[2012-02-07 15:47:00 -0500] lusis: wait
[2012-02-07 15:47:00 -0500] lusis: that sounded wrong
[2012-02-07 15:47:00 -0500] jtimberman: botsnack!
[2012-02-07 15:47:00 -0500] jtimberman: er
[2012-02-07 15:47:00 -0500] jtimberman: !botsnack
[2012-02-07 15:47:00 -0500] bawt: jtimberman: thanks :)
[2012-02-07 15:48:00 -0500] jtimberman: there :)
[2012-02-07 15:48:00 -0500] hcastro: brettweavnet: http://jtimberman.housepub.org/blog/2011/08/06/encrypted-data-bag-for-postfix-sasl-authentication/
[2012-02-07 15:48:00 -0500] jtimberman: he's here
[2012-02-07 15:48:00 -0500] jtimberman: hey thats me!
[2012-02-07 15:48:00 -0500] cwj: ugh you again?!
[2012-02-07 15:48:00 -0500] jtimberman: lusis: there's reasons to use chef-server w/o search, but search is like, one of the best things about chef :)
[2012-02-07 15:48:00 -0500] hcastro: still the clearest example of encrypted data bags i've seen
[2012-02-07 15:48:00 -0500] brettweavnet: Thanks!
[2012-02-07 15:48:00 -0500] lusis: jtimberman: that was my point
[2012-02-07 15:49:00 -0500] lusis: I thought MY encrypted data bags were simpler =(
[2012-02-07 15:49:00 -0500] lusis: jk
[2012-02-07 15:49:00 -0500] mattdawson: jtimberman: ha! i knew that was in there somewhere.
[2012-02-07 15:49:00 -0500] jtimberman: lusis: :P
[2012-02-07 15:49:00 -0500] jtimberman: lusis: i overcomplicate everything man
[2012-02-07 15:49:00 -0500] cwj: i still need to transition from lusis encrypted data bags to opscode encrypted data bags
[2012-02-07 15:50:00 -0500] cwj: :/
[2012-02-07 15:50:00 -0500] lusis: oh damn
[2012-02-07 15:50:00 -0500] lusis: you were using mine?
[2012-02-07 15:50:00 -0500] lusis: hehe
[2012-02-07 15:50:00 -0500] cwj: yes
[2012-02-07 15:50:00 -0500] lusis: I never transititioned at the last place
[2012-02-07 15:50:00 -0500] lusis: I kind of liked my impl a bit better
[2012-02-07 15:50:00 -0500] lusis: but I'm glad it works for you!
[2012-02-07 15:50:00 -0500] cwj: i guess i haven't done a full comparison side by side
[2012-02-07 15:50:00 -0500] cwj: but i did see that opscode uses different cipher
[2012-02-07 15:51:00 -0500] cwj: so im kinda like :/
[2012-02-07 15:51:00 -0500] cwj: yeah it works a treat, just requires a bit of extra code
[2012-02-07 15:51:00 -0500] lusis: honestly the biggest difference is that they encrypt everything
[2012-02-07 15:51:00 -0500] lusis: imho
[2012-02-07 15:52:00 -0500] lusis: and of course the official stuff is much better integrated
[2012-02-07 15:52:00 -0500] cwj: yeh
[2012-02-07 15:52:00 -0500] jtimberman: oh you guys
[2012-02-07 15:53:00 -0500] cwj: youse guise
[2012-02-07 15:55:00 -0500] lusis: jtimberman: brohugs
[2012-02-07 15:55:00 -0500] Scrivener: bugoff: On this page (http://community.opscode.com/cookbooks/newrelic_monitoring), when I am to edit some attributes with the license key, what attributes exactly are these?
[2012-02-07 15:55:00 -0500] Scrivener: Where is it located?
[2012-02-07 15:56:00 -0500] cwj: re: chefconf, tuesday workshops are just a full-day intro to chef?
[2012-02-07 15:57:00 -0500] jtimberman: cwj: at this point nothing is specifically scheduled, but the general idea is a crash course in Chef Fundamentals.
[2012-02-07 15:57:00 -0500] cwj: k
[2012-02-07 15:57:00 -0500] jtimberman: cwj: I don't know if we're going to have intermediate-advanced content
[2012-02-07 15:57:00 -0500] jtimberman: Scrivener: those are node attributes.
[2012-02-07 15:58:00 -0500] jtimberman: Scrivener: the cookbook defines defaults in the attributes directory's files (usually attributes/default.rb)
[2012-02-07 15:58:00 -0500] jtimberman: Scrivener: you can override those by applying the node attributes through a role.
[2012-02-07 15:58:00 -0500] jtimberman: roles?
[2012-02-07 15:58:00 -0500] bawt: roles is http://wiki.opscode.com/display/chef/Roles
[2012-02-07 15:58:00 -0500] jtimberman: attributes?
[2012-02-07 15:58:00 -0500] bawt: attributes is http://wiki.opscode.com/display/chef/Attributes
[2012-02-07 15:58:00 -0500] auduny: knife search node 'languages_php_version:5.3*' -a languages_php_version
[2012-02-07 15:58:00 -0500] lusis: crap
[2012-02-07 15:58:00 -0500] ssd7: deep_merge?
[2012-02-07 15:58:00 -0500] lusis: I gotta book my flight to chefconf
[2012-02-07 15:59:00 -0500] lusis: and my hotel
[2012-02-07 15:59:00 -0500] jtimberman: ssd7: he hasn't learned that one
[2012-02-07 15:59:00 -0500] auduny: How is this supposed to work?
[2012-02-07 15:59:00 -0500] auduny: -a something else?
[2012-02-07 15:59:00 -0500] ssd7: DeepMerge?
[2012-02-07 15:59:00 -0500] auduny: The first bit work.
[2012-02-07 15:59:00 -0500] jtimberman: deep merge?
[2012-02-07 15:59:00 -0500] bawt: deep merge is http://wiki.opscode.com/display/chef/Deep+Merge
[2012-02-07 15:59:00 -0500] auduny: But what about the -a bit?
[2012-02-07 15:59:00 -0500] jtimberman: bawt: deep_merge is http://wiki.opscode.com/display/chef/Deep+Merge
[2012-02-07 15:59:00 -0500] Scrivener: Will any chefconf content be made available online?
[2012-02-07 16:00:00 -0500] jtimberman: auduny: separate the value for -a with dots.
[2012-02-07 16:00:00 -0500] jtimberman: auduny: -a languages.php.verison
[2012-02-07 16:00:00 -0500] jtimberman: spelled correctly
[2012-02-07 16:00:00 -0500] Scrivener: Alright, so under "knife role edit chef-server" I can override the default attributes, adding the newrelic license key?
[2012-02-07 16:00:00 -0500] jtimberman: auduny: the _'s is due to the way that solr creates the index field names.
[2012-02-07 16:00:00 -0500] jtimberman: Scrivener: bingo
[2012-02-07 16:01:00 -0500] auduny: jtimberman: Cool. Would be cool if you could search so that you can group hosts by value
[2012-02-07 16:01:00 -0500] jtimberman: auduny: yeah, but its a search, not a sql statement :)
[2012-02-07 16:02:00 -0500] auduny: So that it lists out all versions of php and the hostsnames that matches that version afterworks :-)
[2012-02-07 16:02:00 -0500] Scrivener: And just to be sure, for the attribute, should I format it *exactly* as is shown?
[2012-02-07 16:02:00 -0500] Scrivener: node['newrelic']['license_key']?
[2012-02-07 16:02:00 -0500] jtimberman: Scrivener: not in the role json
[2012-02-07 16:02:00 -0500] jtimberman: see the roles page
[2012-02-07 16:02:00 -0500] auduny: jtimberman: I know. But sticking it in a hash/assosiative array of some kind would be pretty easy :-)
[2012-02-07 16:03:00 -0500] Mithrandir: having knife search have a --group-by which it'd group by for output purposes would be fairly simple.
[2012-02-07 16:03:00 -0500] jtimberman: auduny: this post may be interesting to you for the internals of some of the solr stuff we did on opscode hosted chef: http://www.opscode.com/blog/2012/01/20/post-hoc-index-design-from-regex-to-peg/
[2012-02-07 16:04:00 -0500] Scrivener: Ahah -- so the overridden attribute should appear as this? override_attributes "newrelic" => { "license_key" => "SOMEKEY" }?
[2012-02-07 16:04:00 -0500] Scrivener: Given the "node[:apache2][:max_children]" example there.
[2012-02-07 16:08:00 -0500] Scrivener: Nevermind the last question.
[2012-02-07 16:18:00 -0500] Brad_K: Mithrandir: check out the knife plugin "gather".
[2012-02-07 17:46:00 -0500] Javin: Hi all. I've been hitting an odd problem for over a day now and thought I'd see if anyone could lend me a hand. I have a recipe which works great on the initial node I tested it on. I now have a second node I am testing it on, and I am getting a consistent error when the rendered template is being moved into place that suggests some sort of file open problem. Any pointers would be helpful.
[2012-02-07 17:46:00 -0500] Javin: This is the error: FATAL: Errno::EBUSY: template[/var/named/chroot/etc/named.conf] (bind::default line 96) had an error: Errno::EBUSY: Device or resource busy - /tmp/chef-rendered-template20120207-775-r0upm1-0 or /var/named/chroot/etc/named.conf
[2012-02-07 17:47:00 -0500] Javin: Is there a way to tell chef, not to delete the rendered template on failure? Might help troubleshoot.
[2012-02-07 17:48:00 -0500] Javin: As root I can easily edit /var/named/chroot/etc/named.conf right after the run, so it doesn't seem like a legitimate file open of permissions issue.
[2012-02-07 17:55:00 -0500] dajia: Hey, all.  What do I need to do to search a data bag from a Library?
[2012-02-07 17:55:00 -0500] dajia: FATAL: NoMethodError: undefined method `search' for Chef::Recipe::ApolAttr:Class
[2012-02-07 18:01:00 -0500] nect: if I have an environment that specifies cookbook versions, and the role is not tied to an environment nor has any environment specific versions, will it still use the environment versions? And if I do specify the version the env_run_list environment, will that override the environment version?
[2012-02-07 18:05:00 -0500] cwj: nect: maybe its just that i don't use roles to set versions, but i don't think that they provide that functionality
[2012-02-07 18:05:00 -0500] jtimberman: roles do not have versions.
[2012-02-07 18:05:00 -0500] cwj: env_run_lists in a role sets which recipes to use, cookbook_versions in an environment are used to determine which versions of the cookbooks in the run list are used
[2012-02-07 18:05:00 -0500] jtimberman: to use environments in roles, specify an environment specific run list.
[2012-02-07 18:08:00 -0500] nect: ok thanks
[2012-02-07 18:10:00 -0500] flaccid: heya guys, just wondering what the current best practice is for pulling remote files, i.e. which resource to use?
[2012-02-07 18:11:00 -0500] jtimberman: flaccid: "remote_file"?
[2012-02-07 18:11:00 -0500] geekbri: flaccid: I believe there is a remote_file resource
[2012-02-07 18:13:00 -0500] flaccid: ah right, thanks y0; deprecated only for cookbook file
[2012-02-07 18:14:00 -0500] flaccid: any size limit of the remote file?
[2012-02-07 18:15:00 -0500] jtimberman: flaccid: depends. the download of the file might time out
[2012-02-07 18:16:00 -0500] jtimberman: if you're transferring large files with remote_file, there might be a better approach.
[2012-02-07 18:16:00 -0500] jtimberman: e.g., http://ckbk.it/transmission
[2012-02-07 18:16:00 -0500] flaccid: thanks jtimberman, good ol blobs..
[2012-02-07 18:16:00 -0500] JasonBox: Cool
[2012-02-07 18:19:00 -0500] dajia: jtimberman: do you know the answer to my databag search question?
[2012-02-07 18:22:00 -0500] jtimberman: dajia: "search()" is a method in the Recipe DSL. You can create an instance of Chef::Search::Query
[2012-02-07 18:23:00 -0500] dajia: Okay.  I understand that in principle, but my Ruby isn't strong enough.  I'm going to have to spend some time on that.
[2012-02-07 18:26:00 -0500] Javin: Anyone got any idea what might be causing this error when moving a rendered template into place?        FATAL: Errno::EBUSY: template[/var/named/chroot/etc/named.conf] (bind::default line 96) had an error: Errno::EBUSY: Device or resource busy - /tmp/chef-rendered-template20120207-775-r0upm1-0 or /var/named/chroot/etc/named.conf
[2012-02-07 18:27:00 -0500] Javin: This file is not locked, or open (after the chef run anyhow). root has good permissions and the recipe works fine on another node.
[2012-02-07 18:32:00 -0500] dajia: jtimberman: can you elaborate a little?  I'm having some trouble doing that.
[2012-02-07 18:34:00 -0500] jtimberman: dajia: http://community.opscode.com/cookbooks/discovery/source - libraries/search.rb has code you can look at for ideas
[2012-02-07 18:36:00 -0500] toddnine: hey guys.  I'm having some serious issues importing the datastax gpg keys, I've tried both the MIT servers and wwwkeys.eu.pgp.net.  Any ideas what's going on?  It just can't find the key.  I'm using 08x.  gpg --keyserver wwwkeys.eu.pgp.net --recv-keys 4BD736A82B5C1B00
[2012-02-07 18:50:00 -0500] spicyWith: basic question: in a json data bag, how do I escape new lines in an ssh key? "deploy_key": "NSdjdbohSoSC8to\n
[2012-02-07 18:50:00 -0500] spicyWith:                  pdeMaYXH8d0", something like this doesn't seem to be valid
[2012-02-07 19:00:00 -0500] Four02: enhancement request  action :runall     multiple command statements
[2012-02-07 19:03:00 -0500] Four02: execute "install" do
[2012-02-07 19:03:00 -0500] Four02:   cwd "/tmp"
[2012-02-07 19:03:00 -0500] Four02:   command "A"
[2012-02-07 19:03:00 -0500] Four02:   command "B"
[2012-02-07 19:03:00 -0500] Four02:   command "C"
[2012-02-07 19:03:00 -0500] Four02:   action :runall
[2012-02-07 19:03:00 -0500] Four02: end
[2012-02-07 19:03:00 -0500] mconigliaro: Four02: you can just use the script resource
[2012-02-07 19:03:00 -0500] mconigliaro: that should do the same thing
[2012-02-07 19:03:00 -0500] Four02: mconigliaro: I know but this seems easier to read
[2012-02-07 19:03:00 -0500] Four02: easier than bash also
[2012-02-07 19:05:00 -0500] mconigliaro: hmm
[2012-02-07 19:05:00 -0500] mconigliaro: well, you can do it this way too....
[2012-02-07 19:05:00 -0500] mconigliaro: ['a', 'b', 'c'].each { |c| execute c }
[2012-02-07 19:06:00 -0500] Four02: thanks
[2012-02-07 19:07:00 -0500] mconigliaro: it's all just ruby code, right? ;-)
[2012-02-07 19:07:00 -0500] mconigliaro: i use loops like that all the time
[2012-02-07 19:10:00 -0500] lusis: I use a lot of %w{package1 package2 package3}.each do
[2012-02-07 19:10:00 -0500] lusis: heh
[2012-02-07 19:11:00 -0500] jbz: argh
[2012-02-07 19:11:00 -0500] jbz: stupid q
[2012-02-07 19:11:00 -0500] jbz: how do I set a default attribute from a recipe?
[2012-02-07 19:11:00 -0500] jbz: node.default[:foo] = "bar"?
[2012-02-07 19:12:00 -0500] |shad0w|: jbz, yup
[2012-02-07 19:12:00 -0500] jbz: hmmm
[2012-02-07 19:15:00 -0500] jbz: Is there any reason a handler wouldn't be able to access an attribute that had been saved as default?  Do those get wiped out once the node.save is done?
[2012-02-07 19:18:00 -0500] |shad0w|: not that familiar with handlers, when is the one you are interested in being triggered in the run ?
[2012-02-07 19:19:00 -0500] |shad0w|: and yes, if the run completes it should update the node with the values
[2012-02-07 19:24:00 -0500] jbz: |shad0w|: I'm having a weird problem with something else, turns out.  I'm setting an attribute early in a run from a default recipe in a cookbook, then calling another recipe in the same cookbook and accessing that attribute, and it's saying that it's nil when I run chef client (despite the fact that this worked all week up until now and I didn't change the recipe which assigned it as far as I can tell, argh argh argh). :-)
[2012-02-07 19:28:00 -0500] spicyWith: anyone have some wisdom on how to have new lines in a JSON string?
[2012-02-07 19:28:00 -0500] |shad0w|: spicyWith \n should work
[2012-02-07 19:29:00 -0500] |shad0w|: line1\nline2
[2012-02-07 19:30:00 -0500] spicyWith: |shad0w|: chef barfs when I try something like this: http://pastebin.com/SjYQWwDu
[2012-02-07 19:30:00 -0500] |shad0w|: don't actually put the newline in there
[2012-02-07 19:30:00 -0500] |shad0w|: "deploy_key": "DrfCi8kuoJBogaddJBgLTnMBquUeBkma8w9yud1IoQTmfoKZ/NSdjdbohSoSC8to\nhRKnmwWX8XOVflKijSlXR2/rOSHtg4syi2oCrwIDAQABAoIBAGGMNpdeMaYXH8d0",
[2012-02-07 19:32:00 -0500] spicyWith: so the private key is broken into multiple lines, how do I deal with that?
[2012-02-07 19:32:00 -0500] |shad0w|: line1\nline2\nline3\nline4
[2012-02-07 19:32:00 -0500] |shad0w|: etc etc
[2012-02-07 19:33:00 -0500] spicyWith: it also doesn't seem to like the ------BEGIN PRIVATE KEY---- , can I get rid of those ---?
[2012-02-07 19:33:00 -0500] atomic-penguin: single quote ''
[2012-02-07 19:33:00 -0500] atomic-penguin: single quote '
[2012-02-07 19:33:00 -0500] spicyWith: atomic-penguin: what should I single quote?
[2012-02-07 19:34:00 -0500] atomic-penguin: The private key getting interpreted as multiple lines
[2012-02-07 19:34:00 -0500] atomic-penguin: "....\n..." (interpreted as new line)
[2012-02-07 19:34:00 -0500] atomic-penguin: '.....\n...' (no interpretation)
[2012-02-07 19:35:00 -0500] spicyWith: atomic-penguin: so I should use ". But what about the initial ----
[2012-02-07 19:36:00 -0500] atomic-penguin: spicyWith, are you talking about http://pastebin.com/SjYQWwDu, or something else?
[2012-02-07 19:37:00 -0500] atomic-penguin: "\n" is a newline, '\n' is a slash and letter n
[2012-02-07 19:39:00 -0500] spicyWith: atomic-penguin: so that is just a fragment of a private key I'm trying to put into a json data bag. See the green column to the right here http://wiki.opscode.com/display/chef/Data+Bags
[2012-02-07 19:40:00 -0500] jessicab: spicywith i believe if you dont use the initial  you get an error telling you it needs it.. i sort of remember seeing one when i was playing with those
[2012-02-07 19:40:00 -0500] kallistec: spicyWith: this might work: `ruby -e  'p ARGF.read' ~/.ssh/id_rsa.pub`
[2012-02-07 19:41:00 -0500] atomic-penguin: spicyWith, your key needs to be all on one line you don't need the part '-----BEGIN RSA KEY----'
[2012-02-07 19:41:00 -0500] spicyWith: jessicab: but json thinks it's an invalid character
[2012-02-07 19:41:00 -0500] kallistec: on mac, throw a `|pbcopy` on there
[2012-02-07 19:41:00 -0500] jessicab: ah, nevermind me then.. must be remembering it wrong
[2012-02-07 19:41:00 -0500] spicyWith: kallistec: thanks
[2012-02-07 19:41:00 -0500] spicyWith: atomic-penguin: jessicab thanks
[2012-02-07 19:43:00 -0500] spicyWith: kallistec: can you break down that ruby command for me?
[2012-02-07 19:44:00 -0500] kallistec: spicyWith: sure.
[2012-02-07 19:45:00 -0500] kallistec: then `p` is for print to STDOUT, but call inspect on the object you pass in
[2012-02-07 19:45:00 -0500] kallistec: ruby -e  is to execute the code, like perl's -e and whatever python has that's similar
[2012-02-07 19:45:00 -0500] spicyWith: kallistec: yup
[2012-02-07 19:46:00 -0500] kallistec: by contrast, `puts` calls #to_s on the argument
[2012-02-07 19:46:00 -0500] spicyWith: ok
[2012-02-07 19:46:00 -0500] kallistec: then ARGF is an IO-like object that reads all of the files passed as arguments
[2012-02-07 19:47:00 -0500] kallistec: so it works kinda like `cat` does when you pass multiple files as arguments
[2012-02-07 19:47:00 -0500] kallistec: then you call read on it to read the files
[2012-02-07 19:50:00 -0500] spicyWith: kallistec: and it adds the \n automagically?
[2012-02-07 19:50:00 -0500] kallistec: spicyWith: yeah, because you called #inspect on the string, it prints newlines and such as their escape sequences
[2012-02-07 19:51:00 -0500] spicyWith: kallistec: cool. Know very little ruby, so it's always cool to learn new stuff
[2012-02-07 19:51:00 -0500] kallistec: spicyWith: compare `ruby -e 'puts "foo"'` vs. `ruby -e 'p "foo"'`
[2012-02-07 19:52:00 -0500] kallistec: or just play around with it in irb
[2012-02-07 19:53:00 -0500] simon_d: does every chef node NEED a fqdn?
[2012-02-07 19:54:00 -0500] kallistec: simon_d: no, you can configure the node_name in the client.rb config file beforehand
[2012-02-07 19:54:00 -0500] luke_: question for someone using chef to host rails: do you always do bundle install and assets:precompile even if they haven't changed from the last deployment? that causes deployments to take ages for me on ec2.
[2012-02-07 19:56:00 -0500] simon_d: kallistec: configure the node name to something other than a fqdn?
[2012-02-07 19:56:00 -0500] simon_d: like an IP
[2012-02-07 19:56:00 -0500] kallistec: simon_d: yep. it can be whatever you want, it's best to use something that's unique and will not be reused
[2012-02-07 19:57:00 -0500] simon_d: my problem is when I come to use knife or whatever from my workstation it cant contact some of the nodes because the names of those nodes are just internal names and doent have DNS setup for them to resolve
[2012-02-07 19:58:00 -0500] simon_d: I dont really want to expose all my servers through DNS
[2012-02-07 19:58:00 -0500] simon_d: am I being to paranoid?
[2012-02-07 19:59:00 -0500] kallistec: simon_d: you can use the -a option for search/ssh: knife search node role:foo -a ipaddress
[2012-02-07 20:01:00 -0500] simon_d: I tried something like that before but couldn't get it to work, obviously because i just used IP rather than ipaddress
[2012-02-07 20:01:00 -0500] spicyWith: anyone know if I you can use the database recipe with postgresql?
[2012-02-07 20:02:00 -0500] spicyWith: or rather, how I would use it?
[2012-02-07 20:02:00 -0500] simon_d: next problem: authentication failed since its trying to use my current user?
[2012-02-07 20:04:00 -0500] kallistec: simon_d: -x USERNAME
[2012-02-07 20:05:00 -0500] simon_d: ok thanks. is there a configuration setting you can change to do this automatically?
[2012-02-07 20:08:00 -0500] jbz: Thisis totally making me crazy.
[2012-02-07 20:08:00 -0500] |shad0w|: that bad jbz ?
[2012-02-07 20:08:00 -0500] jbz: |shad0w|: Yeah. :-(
[2012-02-07 20:09:00 -0500] jbz: I'm doing this complicated dance where I save objects into the node run state in order to do an application deploy on them
[2012-02-07 20:09:00 -0500] jbz: That seems to wrk
[2012-02-07 20:09:00 -0500] |shad0w|: what does the set and deref look like for the attrib you are having trouble with?
[2012-02-07 20:09:00 -0500] jbz: then later I try to pull out that same attribute from a handler
[2012-02-07 20:09:00 -0500] jbz: and it says it's nil.
[2012-02-07 20:09:00 -0500] jbz: My question is:  do default attributes get flushed by the time the handler runs?
[2012-02-07 20:10:00 -0500] jbz: because I'm saving this attribute as default, so that it doesn't get saved up to the chef server (which as I understand it happens *before* the report handler runs).
[2012-02-07 20:10:00 -0500] |shad0w|: default attributes should get saved on the node
[2012-02-07 20:11:00 -0500] |shad0w|: not as normal attributes, but they should exist
[2012-02-07 20:11:00 -0500] jbz: sigh
[2012-02-07 20:12:00 -0500] |shad0w|: knife node show nodename -a node.default
[2012-02-07 20:13:00 -0500] |shad0w|: what does your dereference in the handler look like?
[2012-02-07 20:14:00 -0500] kallistec: jbz: the default and override attrs get saved to the server so that the right attributes/values can be computed (for search) if you manually edit a node
[2012-02-07 20:14:00 -0500] jbz: aigh, they're THERE
[2012-02-07 20:14:00 -0500] jbz: (thanks guys)
[2012-02-07 20:14:00 -0500] jbz: this means I'm doing somethingeven dumber, which I can't figure out.
[2012-02-07 20:14:00 -0500] kallistec: they're hidden by default in knife because you should never really need to edit them
[2012-02-07 20:14:00 -0500] jbz: So here's my pain:
[2012-02-07 20:14:00 -0500] kallistec: you can access the underlying raw data with node.default_attrs
[2012-02-07 20:14:00 -0500] jbz: I have a bunch of stuff in node[:app_sets] and I've verified using knife that they're there.
[2012-02-07 20:15:00 -0500] jbz: I reference them in a recipe where I use them to deploy apps.
[2012-02-07 20:15:00 -0500] jbz: But when I reference them in a handler, as follows:
[2012-02-07 20:15:00 -0500] jbz:  Chef::Log.info("OQHandler: run state is #{node.run_state[:app_sets].inspect}")
[2012-02-07 20:15:00 -0500] jbz: I get no method errors for nil (NilClass)
[2012-02-07 20:16:00 -0500] jbz: What's worse is that this stuff works then doesn't work then works again, and I'm having trouble figuring out what changes to which recipes/handlers are breaking it.
[2012-02-07 20:17:00 -0500] jbz: Anyway.  Thanks for letting me rant.  Gotta go have a tea and clear my brain before trying again.
[2012-02-07 20:18:00 -0500] |shad0w|: run_state doesn't contain node attribs afaik
[2012-02-07 20:18:00 -0500] |shad0w|: are you looking to see if you've seen a recipe with a name built from :app_sets?
[2012-02-07 20:20:00 -0500] jtimberman: node.run_state is a nice sneaky way to hide things that you want to keep throughout various recipes but not save as node attributes.
[2012-02-07 20:20:00 -0500] jtimberman: we do that in the application cookbook's recipes to load up the application data from a data bag.
[2012-02-07 20:21:00 -0500] |shad0w|: ah
[2012-02-07 20:22:00 -0500] |shad0w|: right there in the default
[2012-02-07 20:25:00 -0500] jgoulah: is it possible to reload a recipe in shef, say if you make changes and want to test them in the console?
[2012-02-07 20:26:00 -0500] jgoulah: i did something like node.run_state[:seen_recipes].delete("myrecipe")  which lets me include it again, but seems cached somewhere
[2012-02-07 20:34:00 -0500] jgoulah: is there no better way than exit'ing out of recipe mode and back?
[2012-02-07 20:34:00 -0500] cwj: good question, i never found a way to do it
[2012-02-07 20:46:00 -0500] jgoulah: it makes iteration painful
[2012-02-07 20:48:00 -0500] pearcec: Hi have a recipe that runs a command that prompts me via a dialog box
[2012-02-07 20:48:00 -0500] pearcec: I want to take the default of enter.
[2012-02-07 20:48:00 -0500] pearcec: How do I supply that input?
[2012-02-07 21:01:00 -0500] jbz: jtimberman: OH
[2012-02-07 21:01:00 -0500] jbz: jtimberman: so things in run_state AREN'T ATTRIBUTES.
[2012-02-07 21:02:00 -0500] fujin: It's just a plain hash, yeh
[2012-02-07 21:04:00 -0500] yfeldblum: that's correct
[2012-02-07 21:14:00 -0500] kallen: on my new chef-server (from scratch) setup is not running the webui (my intention), and if i go thru the initial knife client setup using "knife configure -i" (this setup asks for webui.pem) it fails due to "Creating initial API user... ERROR: Failed to authenticate to http://chef:4000 as chef-webui with key .chef/webui.pem
[2012-02-07 21:15:00 -0500] kallen: does the webui necessarily be running in order to create the initial api client using that knife configure -i method?
[2012-02-07 21:16:00 -0500] kallen: i did in fact copy the needed pems from /etc/chef to ~/.chef
[2012-02-07 21:19:00 -0500] labria: kallen no, it just needs _any_ admin key for the server, webui.pem is just the default to use
[2012-02-07 21:22:00 -0500] kallen: hmm ok. i'm getting a failure. don't know why. i'll keep debugging and maybe send email
[2012-02-07 21:35:00 -0500] ranjibd: kallen, use the validation cert to create client key
[2012-02-07 21:36:00 -0500] ranjibd: some how the client creation in webui is broken
[2012-02-07 21:36:00 -0500] kallen: i am, i think. failing.
[2012-02-07 21:36:00 -0500] ranjibd: but its not consistent
[2012-02-07 21:37:00 -0500] kallen: i'll illustrate my steps. this is a fresh chef-server installed via opscode pkgs on ubuntu.
[2012-02-07 21:37:00 -0500] fujin: wipe the couchdb database and restart the chef-server-api
[2012-02-07 21:37:00 -0500] fujin: it should recreate the webui user and write the webui pem out
[2012-02-07 21:37:00 -0500] kallen:  /etc/chef/validation.pem and /etc/chef/webui.pem were put in place by me. they come from my previous working chef server. i copy those to ~/.chef and chown
[2012-02-07 21:37:00 -0500] fujin: that should let you use knife configure -i to craeate an admin
[2012-02-07 21:37:00 -0500] fujin: kallen: that isn't going to work
[2012-02-07 21:38:00 -0500] kallen: then i run "knife configure -i" per wiki doc..
[2012-02-07 21:38:00 -0500] fujin: chef stores parts of the cryptography in the database
[2012-02-07 21:38:00 -0500] kallen: ah .. /me listens
[2012-02-07 21:38:00 -0500] fujin: the public key, in fact
[2012-02-07 21:38:00 -0500] kallen: that's what i wondered..
[2012-02-07 21:38:00 -0500] fujin: so the clients can use the private key to sign headers (which is verified against the public key in the *database*) with the keys
[2012-02-07 21:38:00 -0500] kallen: how does one wipe the couchdb?
[2012-02-07 21:38:00 -0500] fujin: You can probably http DELETE the chef database.
[2012-02-07 21:38:00 -0500] fujin: curl -XDELETE localhost:5984/chef or whatever the fuck it is.
[2012-02-07 21:38:00 -0500] ranjibd: curl -X delete couchurl
[2012-02-07 21:39:00 -0500] kallen: ok cool. i'll try it
[2012-02-07 21:39:00 -0500] ranjibd: delete the fuck.
[2012-02-07 21:39:00 -0500] kallen: when i installed new chef server via pkg, chef-server starts. when it does that, does it create cryptographic whatsits automatically? and that's what i need to wipe and place with my own?
[2012-02-07 21:40:00 -0500] fujin: yes unless the webui user exists it will create one i think
[2012-02-07 21:40:00 -0500] kallen: i guess the deb pkg is config'd to post-install start it..
[2012-02-07 21:40:00 -0500] ranjibd: kallen, my experience is with el/centos/amazonlinux.. and with fresh install ...
[2012-02-07 21:41:00 -0500] ranjibd: kallen, so your one is failing for valid reasons
[2012-02-07 21:41:00 -0500] RobbieAB: How interested would people be in a RHEL/Centos6 repo for chef?
[2012-02-07 21:41:00 -0500] RobbieAB: As I have to maintain it for work...
[2012-02-07 21:43:00 -0500] kallistec: RobbieAB: there is RBEL and also packages maintained by aegisco (http://rbel.frameos.org/ and http://blog.aegisco.com/index.php/2011/04/08/chef-0-10-pre-requisites-gecode-and-ruby-rpms/ )
[2012-02-07 21:44:00 -0500] kallistec: might be better off for the community if you can work with one of them and mirror
[2012-02-07 21:44:00 -0500] kallen: i'm currently using frameos. i thot you might be affiliated with one of those..
[2012-02-07 21:46:00 -0500] RobbieAB: kallistec: We looked at them, and they are lagging a long way behind, hence the decision to repackage our own.
[2012-02-07 21:49:00 -0500] ranjibd: yeah
[2012-02-07 21:49:00 -0500] ranjibd: rbel in 0.10.6
[2012-02-07 21:50:00 -0500] ranjibd: is there any plan for rpm.opscode.com ?
[2012-02-07 21:51:00 -0500] kallistec: 0.10.6 should be fine on Linux, 0.10.8 has one windows fix only
[2012-02-07 21:52:00 -0500] RobbieAB: Ok. I guess I will leave it at that. (We also did SeLinux patching which seems to be semi-working)
[2012-02-07 21:57:00 -0500] jtimberman: ranjibd: no current plans for an rpm / yum repository, as the effort for packaging is focused on the "omnibus builds" of chef full stack installers.
[2012-02-07 22:00:00 -0500] atomic-penguin: I was under the impression that the frameos and rbel packages were the same cooperative effort for RHEL-ish users.
[2012-02-07 22:00:00 -0500] jtimberman: separate efforts
[2012-02-07 22:06:00 -0500] atomic-penguin: Ah, James uses fpm, Rubio uses gem2rpm.  I've tested both in the past, both are very responsive if you find a problem
[2012-02-07 22:20:00 -0500] spicyWith: anyone know how I can use the database recipe with postgres as the db?
[2012-02-07 22:22:00 -0500] cwj: spicyWith: http://cookbooks.opscode.com/cookbooks/database readme has a number of examples
[2012-02-07 22:23:00 -0500] cwj: but to set up a postgres server you will have to use the postgres cookbook i believe
[2012-02-07 22:26:00 -0500] cwj: postgresql that is
[2012-02-07 22:28:00 -0500] Brad_K: RobbieAB: we're currently using CentOS 5, and would be looking forward to moving to CentOS 6 sometime in the not-too-distant future.
[2012-02-07 22:30:00 -0500] RobbieAB: Brad_K: It's a major improvement in many areas.
[2012-02-07 22:30:00 -0500] Brad_K: i believe you.  we just had enough things we were changing that we couldn't change the base OS while we were also changing everything else.
[2012-02-07 22:33:00 -0500] RobbieAB: Ah, reasonable.
[2012-02-07 22:33:00 -0500] spicyWith: cwj: you're right, thanks! I was following an old example for database: https://github.com/opscode/django-quick-start/tree/master/cookbooks/database
[2012-02-07 22:33:00 -0500] simon_d: help.... I've got my chef server setup, my Macbook as my workstation with knife. I can use knife to make modifications to the chef server roles and clients etc but if I try knife ssh the authentication fails. Any idea why? U have username.pem and validation.pem, knife.rb points to them.
[2012-02-07 22:34:00 -0500] jtimberman: spicyWith: the database cookbook's recipes were written for mysql and haven't been updated for postgresql.
[2012-02-07 22:34:00 -0500] jtimberman: so you'd have to write your own
[2012-02-07 22:34:00 -0500] jtimberman: simon_d: what is the failure message? could be from ssh, not chef
[2012-02-07 22:34:00 -0500] simon_d: do I need to swap keys with all chef clients I might need to connect to?
[2012-02-07 22:35:00 -0500] simon_d: Net::SSH::AuthenticationFailed
[2012-02-07 22:36:00 -0500] spicyWith: jtimberman: what about  http://cookbooks.opscode.com/cookbooks/database, it has some examples for postgres
[2012-02-07 22:36:00 -0500] jtimberman: spicyWith: the *recipes* are not written for postgresql
[2012-02-07 22:36:00 -0500] jtimberman: spicyWith: the cookbook itself includes resources/providers for postgresql.
[2012-02-07 22:36:00 -0500] jtimberman: you can use those in your own recipes.
[2012-02-07 22:37:00 -0500] spicyWith: jtimberman: got it, thanks
[2012-02-07 22:37:00 -0500] jtimberman: simon_d: so you probably need to propagate your ssh key to your systems, or use the -P to specify your password.
[2012-02-07 22:38:00 -0500] Brad_K: we use the users cookbook to pre-populate all the ssh keys of all the admins who will need to be accessing the machines.
[2012-02-07 22:38:00 -0500] simon_d: jtimberman: i kind of though chef took care of the SSH keys
[2012-02-07 22:39:00 -0500] Brad_K: simon_d: for doing a "knife ssh " i think it does.  but not when you do regular ssh as your own user.
[2012-02-07 22:39:00 -0500] simon_d: knife ssh to multiple servers is what I'm after/trying
[2012-02-07 22:39:00 -0500] spicyWith: jtimberman: the mysql recipe is creating the db with username and password based on the data bag, and that's about it, correct?
[2012-02-07 22:40:00 -0500] simon_d: when I do knife ssh does it go through the chef server or authenticate separately with each chef client?
[2012-02-07 22:40:00 -0500] jtimberman: simon_d: you can write a recipe to do that.
[2012-02-07 22:40:00 -0500] jtimberman: or use an existing one like our users cookbook
[2012-02-07 22:40:00 -0500] jtimberman: or put that in a bootstrap template.
[2012-02-07 22:41:00 -0500] simon_d: OK I'll take a look at the users cookbook
[2012-02-07 22:42:00 -0500] Brad_K: simon_d: you're not using ssh to authenticate to the chef server.  when you authenticate to it, you don't actually log in there and run commands.  you have a client program that authenticates with your certificate (in PEM format) and then the client program interacts with the server through the chef API.
[2012-02-07 22:43:00 -0500] Brad_K: they're both forms of public key cryptography, but for example OpenSSL is not the same thing as OpenSSH.  two different tools, albeit related.
[2012-02-07 22:47:00 -0500] ranjibd: jtimberman, i was excited to see the chef_gem resource
[2012-02-07 22:47:00 -0500] jtimberman: ranjibd: Cool :)
[2012-02-07 22:47:00 -0500] ranjibd: that resource can be used very innovative way ....
[2012-02-07 22:49:00 -0500] ranjibd: we can use this gem_package/chef_gem  combination along with report handlers to do integration tests
[2012-02-07 22:50:00 -0500] ranjibd: specially for the api related ones
[2012-02-07 23:38:00 -0500] l1x: hey folks
[2012-02-07 23:39:00 -0500] l1x: which process creates this directory structure ? /var/lib/chef/cookbook_index
[2012-02-07 23:39:00 -0500] l1x: and how can i re-start it because half of the files are missing
[2012-02-07 23:40:00 -0500] tpot: directory "/var/lib/chef/cookbook_index" do
[2012-02-07 23:40:00 -0500] tpot:   action :create
[2012-02-07 23:40:00 -0500] tpot:   recursive true
[2012-02-07 23:40:00 -0500] tpot: end
[2012-02-07 23:40:00 -0500] tpot: heh
[2012-02-07 23:40:00 -0500] erikh: recursive true on create doesn't do what you think it does
[2012-02-07 23:40:00 -0500] erikh: at least it didn't before
[2012-02-07 23:40:00 -0500] tpot: oh?
[2012-02-07 23:40:00 -0500] erikh: it doesn't adjust permissions
[2012-02-07 23:41:00 -0500] tpot: hmm
[2012-02-07 23:41:00 -0500] erikh: that might not matter, but more often than not it does
[2012-02-07 23:41:00 -0500] tpot: l1x: i don't have anything in the cookbook_index directory on a couple of chef nodes i just checked
[2012-02-07 23:42:00 -0500] l1x: which is good because this is the chef server
[2012-02-07 23:42:00 -0500] tpot: i think that directory is used for cookbook cache stuff
[2012-02-07 23:42:00 -0500] l1x: chef actually stores the cookbooks in this directory structure
[2012-02-07 23:42:00 -0500] l1x: for caching reasons
[2012-02-07 23:42:00 -0500] l1x: i guess
[2012-02-07 23:43:00 -0500] l1x: question is how could I recreate it because some of them is not there and therefore the API call fails with an EOF
[2012-02-07 23:43:00 -0500] tpot: aha - yes it does have something on a chef server
[2012-02-07 23:43:00 -0500] tpot: i was checking chef clients
[2012-02-07 23:44:00 -0500] tpot: maybe try re-uploading all your cookbooks?
[2012-02-07 23:44:00 -0500] l1x: hahaha
[2012-02-07 23:44:00 -0500] l1x: maybe try to reinstall my entire production chef cluster and stop everything for a day
[2012-02-07 23:45:00 -0500] tpot: reuploading cookbooks shouldn't be a destructive operation
[2012-02-07 23:45:00 -0500] l1x: alright, we have 100+ cookbooks :)
[2012-02-07 23:45:00 -0500] tpot: ugh
[2012-02-07 23:45:00 -0500] l1x: anyway, i might cut a tt to opscode dudes
[2012-02-07 23:45:00 -0500] tpot: that directory looks like an index of md5sum -> cookbook file
[2012-02-07 23:46:00 -0500] tpot: so i wouldn't be surprised if a whole lot of weird stuff was happening in your cluster
[2012-02-07 23:47:00 -0500] edelschaedel: I'm trying to setup a splay for the same cronjob across multiple servers so they don't kick off all at the same time.  I'm trying to implement this with a random number for the min and hour in a cron resource, but it's not working.  any idea why?  can one use variables for the min and hour of the cron resource?
[2012-02-07 23:48:00 -0500] Brad_K: tpot: "recursive true" on a directory is more like "mkdir -p".  It doesn't touch ownership & permission unless it actually needs to create the directory in question.  If you want to do a "chown -R" and a "chmod -R", and enforce those on every single run, then you need to do those commands separately.
[2012-02-07 23:52:00 -0500] tpot: Brad_K: hmm - i would have assumed that the recursive mkdir would set the permissions to the owner.group specified
[2012-02-07 23:52:00 -0500] Brad_K: l1x: that's what scripts are for.  I can bump the version number in metadata.rb and then re-upload each cookbook, and do that across all 50+ of our cookbooks in just a few minutes.
[2012-02-07 23:53:00 -0500] Brad_K: tpot: it only does that if it actually has to take the action of creating the directory.  if it doesn't have to create the directory, then the assumption is that someone or something else has set different ownership & permissions for a reason, and it doesn't try to second-guess you on that.
[2012-02-07 23:54:00 -0500] kallistec: tpot: that's problematic because chef will also manage the owner and so on for you if you decide to change them later. But there's no way for chef to know which directories to manage once they're created. so the process is not really repeatable
[2012-02-07 23:55:00 -0500] Brad_K: l1x: the "spork" plugin for knife is particularly useful for doing several operations on a given cookbook in quick succession, including bumping version numbers, checking in to your source code control system, uploading to chef, checking to see what is currently uploaded to chef and whether or not it's safe to upload what you have locally, etc....
[2012-02-07 23:57:00 -0500] l1x: brad that is great
[2012-02-07 23:58:00 -0500] l1x: still i would rather fix the chef side issue than reupload all my cookbooks
[2012-02-07 23:58:00 -0500] l1x: and i am going to :)
[2012-02-07 23:58:00 -0500] l1x: i just thought you know the answer here
[2012-02-07 23:59:00 -0500] Brad_K: yeah, re-uploading can be  tiresome, especially if you don't have to do it for some other legitimate reason.
[2012-02-07 23:59:00 -0500] Brad_K: i must have missed the earlier part of this conversation  what was the problem for which re-uploading was the band-aid as opposed to the real fix?
[2012-02-07 23:59:00 -0500] l1x: since there is nothing broken  with the cookbooks or couchdb i would investigate what is broken
