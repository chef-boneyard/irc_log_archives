[2012-02-03 08:06:00 -0500] hasrb: ranjibd: thanks, the mysql cookbook has a ports template already and iptables has an iptables_rule definition so you can just put iptables_rule "port_mysql" at the end of your mysql server recipe
[2012-02-03 08:06:00 -0500] hasrb: and then modify the template within the mysql cookbook as needed
[2012-02-03 08:06:00 -0500] mosez: hi
[2012-02-03 08:07:00 -0500] mosez: i have seen the web_app for apache recipe. but where can i put my web_app calls to define the vhosts? into a seperate recipe?
[2012-02-03 08:08:00 -0500] hasrb: mosez: yeah, just setup a cookbook for the app your are actually working on and put that in your default recipe and then add it to your run list
[2012-02-03 08:08:00 -0500] mosez: hasrb: thx
[2012-02-03 08:09:00 -0500] hasrb: mosez: and just put your templates in that new cookbook's template dir
[2012-02-03 08:09:00 -0500] mosez: hasrb: ok, i got it, thx
[2012-02-03 08:09:00 -0500] hasrb: mosez: no prob
[2012-02-03 09:15:00 -0500] hasrb: I'm running a deploy_revision and migrate is set to true within the block but the migration command never actually runs, any pointers on where to trigger/look?
[2012-02-03 09:23:00 -0500] dwt: Hi there, how do I use attribute defaults to provide defaults for array members?
[2012-02-03 09:23:00 -0500] dwt: i.e. I want to have something like node[:applications] = []
[2012-02-03 09:23:00 -0500] dwt: which then contains dictionaries (provided by json) to configure each deployment of an app
[2012-02-03 09:24:00 -0500] dwt: For those dictionaries I would like to provide defaults to shorten the json configuration
[2012-02-03 09:24:00 -0500] dwt: but I don't understand from the documentation how to apply the system to provide defaults for those
[2012-02-03 09:24:00 -0500] hasrb: dwt: just drop them in attributes/default.rb within your cookbook, take a look at the apache2 cookbooks for some decent examples
[2012-02-03 09:24:00 -0500] dwt: hasrb: am I missing something? For Those there never seems to be an array involved
[2012-02-03 09:25:00 -0500] hasrb: dwt: it's just ruby hashes and arrays so you can do whatever you'd like
[2012-02-03 09:25:00 -0500] dwt: maybe for a better example: my node data reads like this
[2012-02-03 09:25:00 -0500] hasrb: dwt: here's an array within Apache's default[:apache][:listen_ports] = [ "80","443" ]
[2012-02-03 09:26:00 -0500] dwt: ok, let me think about that for a moment
[2012-02-03 09:27:00 -0500] hasrb: default is a hash, they key :listen_ports is set to an array
[2012-02-03 09:27:00 -0500] hasrb: *the not they
[2012-02-03 09:33:00 -0500] dwt: hasrb: I'm still not quite sure how to apply this, so here's a little bigger examle:
[2012-02-03 09:33:00 -0500] dwt: https://gist.github.com/51a30317f35d7991ebf6
[2012-02-03 09:33:00 -0500] dwt: I want to provide defaults for the hashes inside the applications array
[2012-02-03 09:34:00 -0500] dwt: but I don't know how many of those will be availeable in the attributes default file
[2012-02-03 09:34:00 -0500] dwt: so I can't just list them
[2012-02-03 09:35:00 -0500] haakon__: On Hosted Chef, I'm currently experiencing "INFO: HTTP Request Returned 409 Conflict: Client already exists. INFO: HTTP Request Returned 403 Forbidden: Merb::ControllerExceptions::Forbidden. FATAL: Stacktrace dumped to /var/chef/cache/chef-stacktrace.out
[2012-02-03 09:35:00 -0500] haakon__: knife node list does not list the host
[2012-02-03 09:35:00 -0500] hasrb: dwt: not sure but you'll prob want to look at environments then. You can set the "_default" environment value and then override the values on a per environment basis
[2012-02-03 09:35:00 -0500] haakon__: when running knife bootstrap
[2012-02-03 09:36:00 -0500] dwt: hasrb: ok, thanks, I'll follow that pointer
[2012-02-03 09:36:00 -0500] hasrb: dwt: you would basically scope it one more level down beneath "_default"
[2012-02-03 10:27:00 -0500] nico: can't find out to log via syslog in the docs... any pointer ? seems like CHEF-273 is solved but using this directive fails
[2012-02-03 10:31:00 -0500] ranjibd: haakon__, knife client list
[2012-02-03 10:32:00 -0500] ranjibd: and delete the client from there , and delete the client.pem from the node
[2012-02-03 10:57:00 -0500] haakon__: ranjibd: thanks
[2012-02-03 13:15:00 -0500] gadolin: hey, i am writing my cookbook within which i start tomcat, also I place cookbook file with tomcat file, and... within cookbook_file block I use  notifies :restart, "service[tomcat6]", very after I place definition of the service "tomcat6", with actions enable, start. It seems that this breaks at the first run as cookbook file says to tomcat to restart, but it doesnot run so through error. And nothing is started at the end. It seem
[2012-02-03 13:15:00 -0500] gadolin: s to be thing to be automatically discovered by chef.How should I do it correctly?
[2012-02-03 13:17:00 -0500] cwj: gadolin: if you gist your recipe we can take a look
[2012-02-03 13:18:00 -0500] gadolin: cwj: http://pastebin.com/fJZrRKum
[2012-02-03 13:18:00 -0500] gadolin: cwj: that is really simple one
[2012-02-03 13:20:00 -0500] cwj: the service needs to be defined before you declare resources to send it any notifications.
[2012-02-03 13:20:00 -0500] cwj: so move the service resource to the top
[2012-02-03 13:27:00 -0500] cwj: if your cookbook doesn't set things up to where the service will successfully start without your templated tomcat6.conf you could do something like this
[2012-02-03 13:27:00 -0500] cwj: http://pastebin.com/ZBqfWzKV
[2012-02-03 13:27:00 -0500] cwj: i think
[2012-02-03 13:29:00 -0500] cwj: but then that depends on your init script allowing "restart" to work if the service is not already running
[2012-02-03 13:31:00 -0500] gadolin: cwj: thx, this the issue that sevice is not running and it throws error code when I call stop. I hoped that chef could automagically, discover it within service resouce e.g. calling status
[2012-02-03 13:35:00 -0500] cwj: gadolin: if you add ":status => true" to the supports statement in your service resource, chef will try to use that to determine the state of the service
[2012-02-03 13:35:00 -0500] cwj: http://wiki.opscode.com/display/chef/Resources#Resources-Service
[2012-02-03 13:36:00 -0500] cwj: otherwise it is just grepping the process table for the service name you specifief
[2012-02-03 14:01:00 -0500] dkingofpa: Why wouldn't the apt cookbook update the apt cache during an initial chef-solo run?  https://gist.github.com/1727534
[2012-02-03 14:12:00 -0500] cwj: dkingofpa: the source for recipe[apt::default] indicates that it would try to do an apt-get update after installing the update-notifier-common package. if you want apt to update every chef run, you will probably need to modify the recipe so that the "apt-get update" execute resource has action :run instead of action :nothing
[2012-02-03 14:12:00 -0500] cwj: i admit i don't fully understand the logic there, aside from avoiding overwhelming apt repository mirrors with update requests at every chef run
[2012-02-03 14:18:00 -0500] dkingofpa: cwj:  thanks.  Guess I was mislead by the documentation - "This cookbook includes recipes to execute apt-get update to ensure the local APT package cache is up to date"
[2012-02-03 14:18:00 -0500] dkingofpa: cwj:  it doesn't actually apply to the apt cookbook itself though.  :)
[2012-02-03 14:26:00 -0500] cwj: dkingofpa: yeah i think its more about providing an apt-repository resource so people can set up non-standard repositories. when that resource is used, newly configured repositories will cause apt-get update to run.
[2012-02-03 14:35:00 -0500] ssd7: Morning all
[2012-02-03 14:39:00 -0500] geekbri: With chef, if you want to populate an ERB on one node with say.. the hostname of another node thats managed by chef... what is the normal way of doing that?  Can you access the other nodes attributes ?
[2012-02-03 14:40:00 -0500] jonlives: geekbri: you can use search to get that node and then get at it's attributes
[2012-02-03 14:41:00 -0500] geekbri: jonlives: ah ok, perfect!  I should have figured that since you can use that to search data bags as well :)
[2012-02-03 14:41:00 -0500] jonlives: np :)
[2012-02-03 14:41:00 -0500] cwj: use the search, Chef!
[2012-02-03 14:41:00 -0500] jonlives: search(:node, "name:foo"), in this case :)
[2012-02-03 15:30:00 -0500] geekbri: Chef::Config[] just gives you access to chef configuration settings right?
[2012-02-03 15:36:00 -0500] jamescarr: what would be a good way to fetch a binary file from a private github account?
[2012-02-03 15:37:00 -0500] jamescarr: I want to have this cookbook fetch a compiled binary of our project from github for deployment to our servers
[2012-02-03 15:39:00 -0500] cwj: jamescarr: configure a deploy ssh key on your private github repo, then chef can install the key, a ssh wrapper for git that uses the key, and set up a deploy resource which uses the ssh wrapper to deploy your binary
[2012-02-03 15:43:00 -0500] geekbri: hrm, i suppose you would need to store the SSH private key in an encrypted data bag.
[2012-02-03 15:46:00 -0500] yfeldblum: why would you need to encrypt deploy keys? (***deploy*** keys specifically)
[2012-02-03 15:48:00 -0500] cwj: yfeldblum: because you are concerned about protecting your trade secrets?
[2012-02-03 15:48:00 -0500] geekbri: why wouldn't you?  I guess its just my natural instinct to encrypt a private key thats being stored somewhere that many people might have access to it.
[2012-02-03 15:48:00 -0500] cwj: i store mine encrypted
[2012-02-03 15:52:00 -0500] geekbri: is there a chef equivalent to the puppet ensure => running ?
[2012-02-03 15:54:00 -0500] cjs226: I'm dipping my toes into using environments.  we're wanting to use roles+environments.  For example, the role www-dev would utilize the latest versions of cookbooks whereas www-prod would utilize the versions as dictated by the production environment.  does this make sense or am i in the weeds?
[2012-02-03 15:55:00 -0500] jbz: cjs226: That makes perfect sense.
[2012-02-03 15:55:00 -0500] flashmanbahadur: geekbri: notifies :start , resources(:my_resource => "my_instance_of_resource")
[2012-02-03 15:56:00 -0500] flashmanbahadur: probably another way as well
[2012-02-03 15:56:00 -0500] flashmanbahadur: notifies is more for things like rebooting after a config change etc
[2012-02-03 15:56:00 -0500] cjs226: jbz: excellent, thx
[2012-02-03 16:03:00 -0500] yfeldblum: geekbri, `action [:enable, :start]` for service resources
[2012-02-03 16:03:00 -0500] yfeldblum: geekbri, the enable and start actions are both idempotent: the enable action checks if the service is already enabled, and if not then enables it; likewise the start action checks if the service is already started, and if not then starts it
[2012-02-03 16:04:00 -0500] dyer: Question, is ruby-shawdown still requires for the password function in the users cookbook?
[2012-02-03 16:04:00 -0500] dyer: in the docs it says "In order to use the "password" attribute in Chef 0.5.6, you must have "ruby-shadow" installed. You can get this by installing the debian package "libshadow-ruby1.8"."
[2012-02-03 16:06:00 -0500] geekbri: flashmanbahadur, yfeldblum: ah ok, thanks.
[2012-02-03 16:07:00 -0500] dyer: Anyone have any idea why this would be required ?
[2012-02-03 16:07:00 -0500] jbz: dyer:  0.5.6?  :-P
[2012-02-03 16:07:00 -0500] dyer: hey dont look at me I didnt write the doc's ;)
[2012-02-03 16:07:00 -0500] yfeldblum: dyer, the gem ruby-shadow knows how to update the passwd and shadow files
[2012-02-03 16:08:00 -0500] dyer: ok, but it seems to barf it its not installed and we even added gem_package to install it at the top of the sysadmin recipe and its still barfing
[2012-02-03 16:08:00 -0500] yfeldblum: if you have installed rubygems from the debian package, then you may install this gem as well via the package; if you have installed rubygems from source, then you should install the gem ruby-shadow using the gem command only
[2012-02-03 16:09:00 -0500] jbz: dyer:  Did you restart chef-client daemon after the install, or use the hack?  Otherwise, gems installed won't be available during that same run
[2012-02-03 16:09:00 -0500] cwj: cjs226: i think you should consider using the same role across all environments, because the environments let you specify the cookbook versions.
[2012-02-03 16:09:00 -0500] dyer: what hack?
[2012-02-03 16:09:00 -0500] jbz: yfeldblum: Didn't you just save my bacon with this yesterday? :-)
[2012-02-03 16:10:00 -0500] yfeldblum: use one of the following two patterns from this pastie to install a gem and then use it in the same chef-client run: http://pastie.org/private/l6e4zgvztu082y75sllt0g
[2012-02-03 16:10:00 -0500] jbz: as yfeldblum said. :-)
[2012-02-03 16:12:00 -0500] yfeldblum: gisted here: https://gist.github.com/de2feaeeae42db0013a9
[2012-02-03 16:13:00 -0500] yfeldblum: jbz, :)
[2012-02-03 16:14:00 -0500] yfeldblum: in the case of the gem ruby-shadow, there's a caveat: the name of the gem is "ruby-shadow", but the file to require is JUST "shadow" ... e.g.: `gem install ruby-shadow ; ruby -e 'require "shadow"'`
[2012-02-03 16:15:00 -0500] yfeldblum: here, the file to require is different from the name of the gem
[2012-02-03 16:21:00 -0500] jbz: Does anyone have an example of a recipe pushing something to S3? Or, better, a report handler?
[2012-02-03 16:22:00 -0500] jbz: At present I'm planning to handle this by installing s3cmd and using a script block, but I fervantly believe there's a Better Way that I haven't figured out yet. :-)  Unsure if I wanna drag Fog into a report handler, but will if it makes things beter.
[2012-02-03 16:24:00 -0500] dajia: Morning, all.  Any opscode people in here?
[2012-02-03 16:25:00 -0500] yfeldblum: jbz, use fog
[2012-02-03 16:25:00 -0500] yfeldblum: jbz, everything that can be done in ruby should be done in ruby
[2012-02-03 16:28:00 -0500] jbz: :-) kk
[2012-02-03 16:28:00 -0500] labria: dajia: why would you want them personally?
[2012-02-03 16:32:00 -0500] dajia: Because I have a message that needs to get to Opscode sales.
[2012-02-03 16:32:00 -0500] dajia: It's important to them, and I'm looking for an avenue I haven't already tried.
[2012-02-03 16:36:00 -0500] labria: dajia: then sit back and relax, someone will surely come by
[2012-02-03 16:37:00 -0500] labria: dajia: something secret? otherwise: just blog it and await results =)
[2012-02-03 16:40:00 -0500] dajia: Heh.  Not something suitable for blogging, though not exactly "secret".
[2012-02-03 16:41:00 -0500] labria: They have a bug that lets you get money for using the platform? =)
[2012-02-03 16:43:00 -0500] spicyWith: when should I be using the "application" recipe vs the "deploy" recipe?
[2012-02-03 16:44:00 -0500] yfeldblum: yep, if you have < -5 nodes, you qualify for the -$100/mo plan
[2012-02-03 16:44:00 -0500] labria: spicyWith: use application when deploy does not seem complicated enough )
[2012-02-03 16:45:00 -0500] spicyWith: labria: helpful.
[2012-02-03 16:45:00 -0500] labria: spicyWith: your question is too vague. what do you deploy?
[2012-02-03 16:45:00 -0500] yfeldblum: spicyWith, "application" is a full, complex, and highly-opinionated beast of an opscode-maintained cookbook; "deploy" is a resource that ships with chef, and which has two providers, which you can use in your own cookbooks
[2012-02-03 16:46:00 -0500] labria: yfeldblum: it has two "resources"
[2012-02-03 16:48:00 -0500] labria: yfeldblum: the best about the deploy resource that you can bend it to use your own provider, making it very flexible
[2012-02-03 16:48:00 -0500] spicyWith: labria: you're right. I'm trying to deploy a django application. I'd like to set up the whole application (including virtual environment, pip install, and migration) using chef, but if possible trigger new deploys using something like fabric (capistrano for us pythonistas) cc/ yfeldblum
[2012-02-03 16:49:00 -0500] labria: spicyWith: if you want to deploy with fabric, you can just install all the deps/packages/etc with chef, and then deploy with fabric as much as you want
[2012-02-03 16:50:00 -0500] labria: deploy/application do not let you trigger them, except by updating the ref in a SCM.
[2012-02-03 16:50:00 -0500] labria: OR, you can use attributes/databags to trigger deployment
[2012-02-03 16:50:00 -0500] labria: but then, why not just use your tool
[2012-02-03 16:50:00 -0500] spicyWith: labria: I'd like to avoid having to create virtual environments, running pip install and so on with fabric
[2012-02-03 16:51:00 -0500] yfeldblum: spicyWith, if you want "push"-style deploys, use fabric; if you want automated "pull"-style deploys, you may usechef
[2012-02-03 16:51:00 -0500] labria: spicyWith: exactly! do all of that with chef
[2012-02-03 16:51:00 -0500] spicyWith: labria: ok, and at what point does fabric come in?
[2012-02-03 16:51:00 -0500] labria: spicyWith: and _then_ deploy with fabric to a ready-to-use env
[2012-02-03 16:52:00 -0500] labria: fabric comes in after chef did its job on the server, preparing everything it could in advance
[2012-02-03 16:52:00 -0500] spicyWith: labria: so what would fabric do?
[2012-02-03 16:52:00 -0500] labria: deploy the right version and restart
[2012-02-03 16:54:00 -0500] labria: anyone has a ready to use IRC report handler?
[2012-02-03 16:54:00 -0500] spicyWith: labria: so fabric would upload a tar'd copy of my code or check it out from git. How do I handle something like a settings file that's really a chef template (to be able to set the right memcached or db server)
[2012-02-03 16:55:00 -0500] spicyWith: labria: and would I be using the chef "deploy" or "application" recipes?
[2012-02-03 16:55:00 -0500] labria: just deploy it with chef, and use a symlink
[2012-02-03 16:55:00 -0500] labria: spicyWith: you wold not be using them, no
[2012-02-03 16:59:00 -0500] spicyWith: labria: is this how you're doing it?
[2012-02-03 17:00:00 -0500] labria: spicyWith: long ago we did do that, yes. now we do not
[2012-02-03 17:00:00 -0500] spicyWith: labria: what did you switch to?
[2012-02-03 17:00:00 -0500] labria: deploy_revision
[2012-02-03 17:03:00 -0500] bgood: I have a recipe that deploys new a new nrpe.cfg and then notifies a xinetd service to restart, however, it the service will fail to fully restart and stop accepting connections ... has anyone else experienced something like this when restarting the xinetd service?
[2012-02-03 17:08:00 -0500] Brad_K: bgood: sorry, it's been a long time since i used xinetd for anything.
[2012-02-03 17:08:00 -0500] labria: bgood: we run nrpe as a daemon
[2012-02-03 17:09:00 -0500] bgood: the bummer part is when it happens if log on to the server and manually restart it, it starts responding again
[2012-02-03 17:09:00 -0500] bgood: and it doesn't alway fail when restarted with the recipe
[2012-02-03 17:10:00 -0500] labria: nothing in the logs?
[2012-02-03 17:14:00 -0500] bgood: no errors only info log that indicates it is succeeding
[2012-02-03 17:14:00 -0500] bgood: i see the following:
[2012-02-03 17:14:00 -0500] bgood: template[/usr/local/nagios/etc/nrpe.cfg] sending restart action to service[xinetd] (delayed)
[2012-02-03 17:14:00 -0500] labria: syslog, messages, nothing?
[2012-02-03 17:14:00 -0500] jtimberman: dajia: You can email info@opscode.com
[2012-02-03 17:14:00 -0500] bgood: service[xinetd] restarted
[2012-02-03 17:15:00 -0500] jtimberman: or sales@ :)
[2012-02-03 17:20:00 -0500] bgood: i see a log message in syslog that matches the chef restarted timestamp that says exiting...
[2012-02-03 17:21:00 -0500] bgood: then a few minutes later successful restart logs ... then a few minutes later successful restart messages for xinetd
[2012-02-03 17:21:00 -0500] bgood: presumably when the manual restart was issued
[2012-02-03 17:21:00 -0500] JasonBox: Oh, what's the bts for chef?
[2012-02-03 17:22:00 -0500] labria: btc?
[2012-02-03 17:22:00 -0500] labria: bts?
[2012-02-03 17:22:00 -0500] thom: tickets.opscode.com
[2012-02-03 17:22:00 -0500] labria: oh
[2012-02-03 17:23:00 -0500] thom: assuming that was intended to expand to bug tracking system :)
[2012-02-03 17:23:00 -0500] bgood: that is exactly what is happening the chef command results in exiting log entry and then the manual restart results in successful restart log entries
[2012-02-03 17:24:00 -0500] jtimberman: xinetd?
[2012-02-03 17:25:00 -0500] bgood: jtimberman: yes, i'm having problems where xinetd doesn't restart properly from my recipe to deploy nrpe configs
[2012-02-03 17:25:00 -0500] jtimberman: bgood: sorry, stuck on xinetd
[2012-02-03 17:25:00 -0500] jtimberman: i haven't used it in like
[2012-02-03 17:25:00 -0500] jtimberman: :)
[2012-02-03 17:48:00 -0500] dajia: Can someone point me to a good example of loading a bunch of default attributes from a databag?  The attribute names and values are in the databag, and I need a quick way to iterate over the bag contents to set the attributes.
[2012-02-03 17:50:00 -0500] spicyWith: coderanger: you around?
[2012-02-03 17:55:00 -0500] tolland: ohai
[2012-02-03 17:56:00 -0500] labria: tolland: are you expecting to get a huge json representation of this channel?
[2012-02-03 17:56:00 -0500] tolland: are there any cookbooks that include registering nodes with ldap servers during deploy
[2012-02-03 17:57:00 -0500] tolland: knife irc chef show
[2012-02-03 17:57:00 -0500] tolland: ill write a plugin
[2012-02-03 17:57:00 -0500] tolland: knife irc #chef show
[2012-02-03 17:58:00 -0500] laurent\: knife irc #comment ? :)
[2012-02-03 17:59:00 -0500] atomic-penguin: knife tf2 #facestab
[2012-02-03 18:00:00 -0500] labria: tolland: not sure about ldap, we have a in-house cookbook, but it's just a bunch of templates/files highly specific to us
[2012-02-03 18:01:00 -0500] coderanger: spicyWith: Whats up
[2012-02-03 18:02:00 -0500] labria: tolland: i can share it if you want
[2012-02-03 18:02:00 -0500] tolland: hmm. thats starting to become a problem with my use of chef. I feel like I should be doing something "properly" but I think screw it, its friday, hack some hard coded cookbook and go to the pub
[2012-02-03 18:02:00 -0500] tolland: labria: sure, its got client machine registering in ldap server?
[2012-02-03 18:03:00 -0500] labria: tolland: it's not registering, it's just installing ldap authentication and mounting /home. not sure that's what you want
[2012-02-03 18:03:00 -0500] atomic-penguin: tolland, that is the way most people probably do it.  Fewer occasionally go back and refactor it into something more reusable.
[2012-02-03 18:05:00 -0500] labria: atomic-penguin: yeah, people just have very specific need. like who would ever re-use my cookbook deploying .war files from Artifactory to jetty?
[2012-02-03 18:06:00 -0500] atomic-penguin: labria, yeah but somebody probably has that same problem on tomcat and jboss
[2012-02-03 18:06:00 -0500] atomic-penguin: Nothing wrong with whipping something up that is "good enough"
[2012-02-03 18:07:00 -0500] labria: atomic-penguin: i had, before we moved the hell out of tomcat to jetty =)
[2012-02-03 18:17:00 -0500] JasonBox: =P
[2012-02-03 18:18:00 -0500] jtimberman: dajia: do it in a recipe
[2012-02-03 18:18:00 -0500] jtimberman: dajia: rather than an attributes file
[2012-02-03 18:19:00 -0500] dajia: jtimberman: that much I have.  Should I just treat the elements in a data bag as attributes in my recipes, or should I turn them into recipes.  If the latter, how to do that?  I'd rather not have 30-40 assignment statements to maintain.
[2012-02-03 18:20:00 -0500] dajia: Er, should I turn them into "attributes
[2012-02-03 18:20:00 -0500] dajia: Brain and fingers moving at different speeds.
[2012-02-03 18:21:00 -0500] atomic-penguin: dajia, that might be the problem, if your brain moves faster than your fingers you could get a concussion
[2012-02-03 18:21:00 -0500] dajia: Way past that.
[2012-02-03 18:22:00 -0500] atomic-penguin: concussions suck
[2012-02-03 18:25:00 -0500] jtimberman: dajia: I probably wouldn't convert them all to attributes, because then you're storing the same data in two places. However, some places assigning an attribute can make sense. For example we do that in managing EBS volumes for MySQL by putting the assigned EBS volume ID on the node itself so it is easier to correlate.
[2012-02-03 18:29:00 -0500] dajia: That makes sense.
[2012-02-03 18:34:00 -0500] tolland: I always try and make things as hard as possible for myself, thats why we also have puppet in our environment
[2012-02-03 18:35:00 -0500] atomic-penguin: puppet?
[2012-02-03 18:35:00 -0500] bawt: puppet is another configuration management tool written in Ruby.
[2012-02-03 18:35:00 -0500] atomic-penguin: lol
[2012-02-03 18:37:00 -0500] mconigliaro: hey guys, is there a "json-attributes" option i can use within client.rb?
[2012-02-03 18:39:00 -0500] mconigliaro: i know there's one on the chef-client command line
[2012-02-03 18:39:00 -0500] mconigliaro: but i want to always pull in json attributes from a file (if it exists)
[2012-02-03 18:40:00 -0500] mconigliaro: oooh, json_attribs
[2012-02-03 18:41:00 -0500] mconigliaro: i think that's what i want. thanks guys. =P
[2012-02-03 18:41:00 -0500] JasonBox: Indeed
[2012-02-03 18:42:00 -0500] mconigliaro: what is json_attribs? just a string?
[2012-02-03 18:47:00 -0500] dwhsix: does anyone have a good model for having most attributes be common across environments, but wanting to be able to override on a per-env basis?
[2012-02-03 18:47:00 -0500] dwhsix: I rigged something up w/ laoding a data bag in my environment files which I don't like...
[2012-02-03 19:09:00 -0500] jmazzi: `shef` is assuming i'm using solo mode, which isn't true. i have my config setup like this https://gist.github.com/e01e597bff6611c89cb2.
[2012-02-03 19:09:00 -0500] geekbri: Does it make sense to have a recipe that checks a nodes role before executing certain blocks of code?  Or is it generally not accepted as the right way to do things and that code should be split into a new recipe that only gets called by certain roles.
[2012-02-03 19:10:00 -0500] jmazzi: I'm trying to look in some encrypted data bags and it's raising an error. the traceback brings me to an if that's under Config[:solo] which shouldn't be the case
[2012-02-03 19:10:00 -0500] miah: you should check the nodes recipes
[2012-02-03 19:10:00 -0500] jmazzi: does shef not look in the .chef dir like knife does in a repo?
[2012-02-03 19:12:00 -0500] miah: it does
[2012-02-03 19:12:00 -0500] miah: shef -z
[2012-02-03 19:14:00 -0500] jmazzi: -z looks in the global location, not the relative. knife will look for .chef/knife.rb where shef doesn't not seem to.
[2012-02-03 19:17:00 -0500] ssd7: you can use -c to force it to use a specific config file.  I believe if you have a .chef/solo.rb it will look there before going to /etc
[2012-02-03 19:25:00 -0500] arrowtoknee: whats the best way to trigger a chef run.  Like say i update a data bag that updates firewall rules and I want them pushed out immediately instead of at next chef run, should i just trigger a 'sudo chef-client' via an ssh command?
[2012-02-03 19:26:00 -0500] kevinharvey: Anyone here familiar with OpsCode's Nagios recipe? I just did the quick start (awesome), now I'm trying to set up a new instance to monitor
[2012-02-03 19:27:00 -0500] kevinharvey: I reran the ec2 create command, just with role[base], then reran chef-client on the Nagiso server node
[2012-02-03 19:27:00 -0500] kevinharvey: I can't get the second instance to show up
[2012-02-03 19:27:00 -0500] kevinharvey: is there a step I'm missing?
[2012-02-03 19:28:00 -0500] arrowtoknee: im not familiar with the quick start but I can probably help
[2012-02-03 19:29:00 -0500] arrowtoknee: can you link me to the quick start?
[2012-02-03 19:29:00 -0500] kevinharvey: https://github.com/opscode/nagios-quick-start
[2012-02-03 19:29:00 -0500] jtimberman: kevinharvey: you need to rerun chef on the nagios system.
[2012-02-03 19:29:00 -0500] kevinharvey: I did
[2012-02-03 19:29:00 -0500] kevinharvey: no dice
[2012-02-03 19:29:00 -0500] jtimberman: kevinharvey: it uses Chef search to find the node
[2012-02-03 19:29:00 -0500] jtimberman: so see if the node comes back from search
[2012-02-03 19:29:00 -0500] jtimberman: knife search role:base
[2012-02-03 19:30:00 -0500] jtimberman: there can be a delay between the time the nagios client node is saved to the chef server, and when it shows up in the search index.
[2012-02-03 19:30:00 -0500] jtimberman: if the client node failed to converge (chef run failed) then it will not be saved.
[2012-02-03 19:33:00 -0500] kevinharvey: aha
[2012-02-03 19:33:00 -0500] kevinharvey: so, it's not showing up in search
[2012-02-03 19:33:00 -0500] kevinharvey: so... why isn't it?
[2012-02-03 19:36:00 -0500] kevinharvey: is the create ec2 command with just the role[base] enough to get an instance I can use to test this?
[2012-02-03 19:39:00 -0500] kevinharvey: however, I do have 5 total nodes that are showing up from search, but none of them are making it into the gnereated hosts.cfg (though none of them have the nagios::client recipe)
[2012-02-03 19:39:00 -0500] jbz: aaaaggggh offtopic
[2012-02-03 19:39:00 -0500] jbz: does anyone remember the 'magic URL' for getting info from an EC2 node?
[2012-02-03 19:39:00 -0500] jbz: 169.254.something?
[2012-02-03 19:40:00 -0500] jbz: googling for 'EC2 node info URL' and various combos thereof not helpful.
[2012-02-03 19:43:00 -0500] jbz: Ah, found it by testing:   http://169.254.169.254/1.0/meta-data/
[2012-02-03 19:44:00 -0500] miah: kevinharvey: are the nodes all in the same environment?
[2012-02-03 19:44:00 -0500] miah: the nagios cookbook only searches for nodes in the same environment as itself.
[2012-02-03 19:45:00 -0500] kevinharvey: yes
[2012-02-03 19:45:00 -0500] kevinharvey: yes, they are all in the same environment
[2012-02-03 19:48:00 -0500] miah: run chef client in debug node on your monitoring host?
[2012-02-03 19:48:00 -0500] miah: s/node/mode
[2012-02-03 19:50:00 -0500] arrowtoknee: what recipes do you have applied to your nagios server?
[2012-02-03 19:50:00 -0500] arrowtoknee: nagios::server?
[2012-02-03 19:50:00 -0500] kevinharvey: processed the host.cfg template fine
[2012-02-03 19:50:00 -0500] kevinharvey: not storing it, as it is up to date
[2012-02-03 19:51:00 -0500] kevinharvey: recipes are base,apt,and apache2
[2012-02-03 19:51:00 -0500] arrowtoknee: id run shef -z then run search(:node, "hostname:[* TO *] AND app_environment:#{node[:app_environment]}")
[2012-02-03 19:51:00 -0500] arrowtoknee: see what comes back
[2012-02-03 19:52:00 -0500] arrowtoknee: looks like thats the actual search from the recipe
[2012-02-03 19:52:00 -0500] arrowtoknee: i run a different search
[2012-02-03 19:53:00 -0500] kevinharvey: haven't used shef before, no config file (epic fail)
[2012-02-03 19:54:00 -0500] arrowtoknee: are you running shef -z
[2012-02-03 19:55:00 -0500] kevinharvey: just ran the create command for the Nagios server again
[2012-02-03 19:55:00 -0500] kevinharvey: created a brand new Nagios server, and that one is showing up in the original Nagios
[2012-02-03 19:55:00 -0500] kevinharvey: does role[monitoring] make a difference?
[2012-02-03 19:55:00 -0500] maek: when I do a knife cookbook upload im getting ERROR: Server returned error for http://localhost:4000/sandboxes, retrying 1/5 in 3s - everything else about the chef server seems to be working fine.
[2012-02-03 19:56:00 -0500] kevinharvey: I mean, it obviously just did
[2012-02-03 19:56:00 -0500] kevinharvey: but does an instance have to have that role to get picked up by the original Nagios server
[2012-02-03 19:57:00 -0500] kevinharvey: BTW, this is after rerunning chef-client on the original Server
[2012-02-03 19:57:00 -0500] maek: oh lies, expander is not running
[2012-02-03 20:02:00 -0500] kevinharvey: I'm trying to figure out how I have to modify my existing roles to get my instances picked up by Nagios. I was thinking all I had to do as add the nagios recipe, and add "recipe[nagios::client'] to my own base role
[2012-02-03 20:06:00 -0500] bkmontgomery: I'm trying to conditionally write some content to a file, but I want to first make sure that content doesn't already exist in the file.  Here's the recipe I've got: https://gist.github.com/1732028  --- only the 2nd line gets written. Am I just completely misunderstanding how this works?
[2012-02-03 20:07:00 -0500] maek: sorry to keep bugging . Im getting this error ERROR: Server returned error for http://10.200.190.254:4000/sandboxes, retrying 1/5 in 3s when uploading a cookbook and expander is now running. knife search, node list, cookbook download all work. cookbook upload is just doa
[2012-02-03 20:09:00 -0500] geekbri: If a recipe contains a "service" resource can i restart that service from a different recipe in that cookbook?
[2012-02-03 20:11:00 -0500] miah: role 'monitoring' is used by the nrpe server and such to figure out where the mointoring hosts are
[2012-02-03 20:11:00 -0500] miah: geekbri: yes
[2012-02-03 20:12:00 -0500] geekbri: miah: is there a specific way to reference the service... or can you just do like notifies :restart, resources(:service => 'service_name')
[2012-02-03 20:12:00 -0500] miah: yes, you can just use that method
[2012-02-03 20:12:00 -0500] geekbri: miah: do I need to include the recipe name there anyway or is it automatically in the same namespace by being in the same cookbook
[2012-02-03 20:12:00 -0500] geekbri: miah: tnx
[2012-02-03 20:12:00 -0500] miah: though it is the older method
[2012-02-03 20:13:00 -0500] miah: notifies :restart, "service[service_name]"
[2012-02-03 20:13:00 -0500] miah: is the 0.10 way iirc
[2012-02-03 20:16:00 -0500] geekbri: oh well thats much less verbose :)
[2012-02-03 20:16:00 -0500] geekbri: i will use that.
[2012-02-03 20:18:00 -0500] maek: are there any problems with deleting dirs in the /var/cache/chef/sandboxes dir? Ive run out of inode/links to make dirs in that directory
[2012-02-03 20:19:00 -0500] miah: specifically that directory, or that filesystem ?
[2012-02-03 20:19:00 -0500] maek: miah: that dir
[2012-02-03 20:19:00 -0500] kevinharvey: looking back, I was getting errors when I tried to create nodes from the partial nagios-quick-start create command
[2012-02-03 20:19:00 -0500] maek: has 31,999 dirs in it and thats the limit
[2012-02-03 20:19:00 -0500] maek: well 31,998
[2012-02-03 20:19:00 -0500] kevinharvey: going to try adding the base nagios client stuff to my recipes and creating a new instance from there
[2012-02-03 20:20:00 -0500] jbz: Can a report handler do a node.save? or is that verboten?
[2012-02-03 20:20:00 -0500] miah: i dont even know what the sandboxes dir is
[2012-02-03 20:21:00 -0500] miah: what version of chef are you on?
[2012-02-03 20:26:00 -0500] mleinart: any windows chef users around?
[2012-02-03 20:27:00 -0500] maek: mleinart: I do
[2012-02-03 20:27:00 -0500] mleinart: i just inherited some windows boxen.. wondering how people run chef
[2012-02-03 20:27:00 -0500] mleinart: like as a daemon? started at startup how?
[2012-02-03 20:27:00 -0500] thehar: heh
[2012-02-03 20:27:00 -0500] maek: mleinart: http://www.opscode.com/blog/2011/12/15/chef-client-installer-for-windows/
[2012-02-03 20:28:00 -0500] fujin: jbz: the report handler does have access to the node, yes
[2012-02-03 20:28:00 -0500] maek: I knife ssh into them and run chef-client. we only want it to happen at certain times.
[2012-02-03 20:28:00 -0500] mleinart: yeah found that and tried it.. but that just appears to give me a sane ruby and chef install
[2012-02-03 20:28:00 -0500] judd7: hey folks, why would my newly boostrapped node not show an IP address with "knife node show <nodename> -Fj"  ?? other, older nodes do.
[2012-02-03 20:28:00 -0500] mleinart: ah i see - i'm a regular-run kindof guy (180 second loop)
[2012-02-03 20:30:00 -0500] fujin: 180 seconds? damn
[2012-02-03 20:31:00 -0500] fujin: mleinart: the chef client itself can daemonize and run in the background
[2012-02-03 20:31:00 -0500] fujin: although, I'm not sure it works on windows
[2012-02-03 20:33:00 -0500] jessicab: mleinart  - when 10.10 is released it should support daemonizing on windows.. theres a work around at the bottom of this bug if youre interested in looking into it now though http://tickets.opscode.com/browse/CHEF-1736
[2012-02-03 20:33:00 -0500] jbz: fujin: Thanks!
[2012-02-03 20:34:00 -0500] jbz: If I want to send a flag to a report handler to tell it whether or not to do something, does it make sense to use a 'default' attribute so it doesn't get written to the server (thus requiring the handler to do a node_save if it clears the flag)?
[2012-02-03 20:34:00 -0500] jbz: Or will I be unable to set an attr as 'default' from within a recipe execution?
[2012-02-03 20:36:00 -0500] raj_: reading the "firewall" section of chef-010112-0629-12.pdf the examples show single port numbers being specified with the port attribute.  ufw can take a range of start:finish .  Can that be given to chef or can chef do only one port number at a time?
[2012-02-03 20:42:00 -0500] kallen: hiya. i'm starting to use opscode's aws cookbook: ebs and elastic IP. is there a recipe out there that also handles ec2-tag? when i bootstrap an instance, i like my instance to tag itself with its hostname when its born.
[2012-02-03 20:42:00 -0500] kallen: it's
[2012-02-03 20:43:00 -0500] jbz: nope, its :-)
[2012-02-03 20:44:00 -0500] jbz: How do I set a default attribute from a recipe?  Does default[:attribute] = "blah" work?
[2012-02-03 20:44:00 -0500] jbz: Or do I need node.default[:attribute] = "blah"?
[2012-02-03 20:44:00 -0500] kallen: derf :>
[2012-02-03 20:45:00 -0500] jbz: kallen:  Sorry, I'm compulsive about that stuff.
[2012-02-03 20:45:00 -0500] kallen: me too
[2012-02-03 20:45:00 -0500] jessicab: kallen - the pull requests on this bug havent been merged and tested, but they might do what youre looking for http://tickets.opscode.com/browse/KNIFE_EC2-18
[2012-02-03 20:46:00 -0500] kallen: thank ye
[2012-02-03 20:48:00 -0500] mleinart: jessicab: thanks for the jira link, thats exactly what i was looking for
[2012-02-03 20:54:00 -0500] miah: attributes?
[2012-02-03 20:54:00 -0500] bawt: attributes is http://wiki.opscode.com/display/chef/Attributes
[2012-02-03 20:54:00 -0500] miah: =)
[2012-02-03 21:12:00 -0500] jbz: miah: That actually wasn't clear to me :-)
[2012-02-03 21:27:00 -0500] flashmanbahadur: has anyone seen the ruby 1.8.7 unix.rb segfault problem on ubuntu and know how to solve it?  Everything seems to be for CentOS
[2012-02-03 21:32:00 -0500] jbz: flashmanbahadur: Which Chef version is this?
[2012-02-03 21:33:00 -0500] flashmanbahadur: 10.8
[2012-02-03 21:33:00 -0500] jbz: Ah, thanks.
[2012-02-03 21:33:00 -0500] flashmanbahadur: (just got bit with a 10.4 vs 10.8 bug but found a way around it)
[2012-02-03 21:33:00 -0500] flashmanbahadur: only managed to get it to happen once, couldnt duplicate
[2012-02-03 21:35:00 -0500] dajia: Is it possible to load a data bag with search() from within a library?
[2012-02-03 21:35:00 -0500] dajia: NoMethodError: undefined method `search' for Chef::Recipe::ApolAttr:Class
[2012-02-03 21:38:00 -0500] danryan: true
[2012-02-03 21:39:00 -0500] danryan: derp. window lockup ftl
[2012-02-03 21:39:00 -0500] JasonBox: hrm, what is the way of poking attribute values out of shef exactly?
[2012-02-03 21:39:00 -0500] JasonBox: I fail every time
[2012-02-03 21:45:00 -0500] jtimberman: JasonBox: node['thing']
[2012-02-03 21:46:00 -0500] jtimberman: just like anywhere else
[2012-02-03 21:46:00 -0500] jtimberman: like in chef recipes
[2012-02-03 21:51:00 -0500] kallen: hmm. i just saw a case of running "knife ec2 server create", i view the output of the launch in my shell. from that output, it never finishes (stuck on Executing apt-get xxx). but i ssh in, view chef client log, and the chef-client run is in fact complete.
[2012-02-03 21:51:00 -0500] kallen: known?
[2012-02-03 21:52:00 -0500] hcastro: i've seen that behavior when i assign an elastic ip during the run
[2012-02-03 21:52:00 -0500] kallen: ah.. that's what i just tested too
[2012-02-03 21:52:00 -0500] kallen: ding!
[2012-02-03 21:52:00 -0500] kallen: musta worked
[2012-02-03 22:19:00 -0500] spyvspy: hi
[2012-02-03 22:20:00 -0500] spyvspy: i am designing a system, and i have a current json representation of a server
[2012-02-03 22:20:00 -0500] spyvspy: ie https://gist.github.com/1733260
[2012-02-03 22:20:00 -0500] spyvspy: I should be able to boostrap a server, using a databag, and that data etc correct?
[2012-02-03 22:21:00 -0500] spyvspy: (obviously, more json will be outputted, when I get the representation part completed
[2012-02-03 22:30:00 -0500] jstump: If recipe "foo" includes recipe "bar", do I need to make sure that: 1. "bar" is in the run_list of servers using "foo" (above it?), 2. Upload the cookbook to OpsCode? (I'm guessing yes and yes, but want to sanity check myself.)
[2012-02-03 22:31:00 -0500] jbz: And, um, #3 above.
[2012-02-03 22:31:00 -0500] jbz: jstump: It doesn't have to be in the runlist, but it has to be on the server.
[2012-02-03 22:31:00 -0500] jbz: It does, however, have to be in the 'depends' statement in the calling cookbook's metadata.rb
[2012-02-03 22:31:00 -0500] jstump: jbz: Ah, so yes to #2 and no to #1.
[2012-02-03 22:31:00 -0500] jbz: Correct.
[2012-02-03 22:32:00 -0500] jstump: Haha, yes, and the third metadata.rb requirement.
[2012-02-03 22:49:00 -0500] heydrick: is there a way to specify a node's environment in the first-boot.json?
[2012-02-03 23:08:00 -0500] ssd7: heydrick: Directly in that file, no.  But, if you are using a recent version of chef, you should be able to use -E ENVNAME in the bootstrap command and it will pass the relevant command line argument to chef-client to start it in the specified environment.
[2012-02-03 23:08:00 -0500] spicyWith: anyone using the application recipe with different environments?
[2012-02-03 23:09:00 -0500] heydrick: thanks ssd7: i just found the -E flag
[2012-02-03 23:24:00 -0500] spicyWith: delete environment in chef server. try to edit node. crash the whole server. don't try this at home. fun times.
[2012-02-03 23:52:00 -0500] Brad_K: ooh, cool.  i may have to try that on Hosted Chef.  ;-)
