[2012-02-21 08:01:00 -0500] plu: can I somehow set json attributes in /etc/chef/client.rb - the same I'd pass to chef-client using -j ?
[2012-02-21 08:02:00 -0500] fujin: plu: you can put json_attribs "/path/to/sime/file.js"
[2012-02-21 08:02:00 -0500] fujin: and then put the attribs in there
[2012-02-21 08:04:00 -0500] plu: fujin: thanks :)
[2012-02-21 08:05:00 -0500] fujin: -j is short for --json-attribs
[2012-02-21 08:05:00 -0500] fujin: which is magic json_attribs "PATH" in the config file
[2012-02-21 08:05:00 -0500] plu: ah :)
[2012-02-21 08:05:00 -0500] plu: thanks!
[2012-02-21 08:05:00 -0500] fujin: np =D
[2012-02-21 08:06:00 -0500] plu: kallistec: did you have the code review meeting yet regarding not_if, only_if and same resource names across different cookbooks? :)
[2012-02-21 08:32:00 -0500] auduny: Hm.
[2012-02-21 09:00:00 -0500] auduny: Hm. notification is done :delayed (at the very end of the chef-run) or :immediately (which is right now)
[2012-02-21 09:00:00 -0500] auduny: But is there a version that is run at the end of this recipe?
[2012-02-21 09:02:00 -0500] Mithrandir: not that I know of.  Would be fairly easy to write a ruby block to look for outstanding notifications and tack that on to the end of the recipe, though.
[2012-02-21 09:44:00 -0500] bpa: hi
[2012-02-21 09:49:00 -0500] bpa: I have a question about chef
[2012-02-21 09:50:00 -0500] bpa: what does it mean node.set[:foo][:bar] = [':toto']
[2012-02-21 09:50:00 -0500] bpa: it's name the same that node[:foo][:bar] = [':toto']
[2012-02-21 09:50:00 -0500] bpa: ?
[2012-02-21 11:17:00 -0500] Axsuul: How are the opscode nginx and unicorn cookbooks? Or any recommendations?
[2012-02-21 11:28:00 -0500] thom: the unicorn one works great
[2012-02-21 11:31:00 -0500] jonlives: bpa: It's a precedence thing. Check out http://wiki.opscode.com/display/chef/Attributes#Attributes-Precedence
[2012-02-21 11:54:00 -0500] lflux:  ohai
[2012-02-21 11:55:00 -0500] lflux: is there an easy way to hack in support for action :graceful for a service
[2012-02-21 11:55:00 -0500] lflux: like apache
[2012-02-21 12:08:00 -0500] lflux: well, besides using reload_command to run /etc/init.d/httpd graceful
[2012-02-21 12:37:00 -0500] zts: lflux: that's the way I'd do it - are you running into a problem with that approach?
[2012-02-21 12:38:00 -0500] zts: lflux: you might otherwise use an execute resources, but I'd probably avoid that unless my init script had a load of different actions I needed to be able to run
[2012-02-21 12:42:00 -0500] bpa: jonlives: ok, thx you
[2012-02-21 12:42:00 -0500] jonlives: np :)
[2012-02-21 13:08:00 -0500] rgsteele: Is anybody aware of an existing resource/cookbook for managing Debian-based network interface configs (/etc/network/interfaces)?  Checked the docs and did some Googling, but haven't found much of substance other than hardcoding a file and plopping it on the filesystem via the file resource.
[2012-02-21 13:08:00 -0500] Axsuul: Hmm ok, replacing a bashrc file with chef (same exact line for line) creates a end of line syntax error, anyone experience this before?
[2012-02-21 13:08:00 -0500] rgsteele: I saw one OC thread that mentioned using a .d/ directory and concatenating the files, but I'm unsure as to whether that's the best approach.  It makes managing each interface easier, but I fear it could be a somewhat cumbersome implementation.
[2012-02-21 13:15:00 -0500] rgsteele: Come to think of it - I'm not even sure if the capability exists to concatenate files.
[2012-02-21 13:17:00 -0500] BryanWB: rgsteele: u mean for managing only part of a file?
[2012-02-21 13:22:00 -0500] rgsteele: BryanWB: Kinda, yeah.  I want to be able to manage each interface independently, so I can just throw new interfaces into a .d directory and have it all get set up properly.
[2012-02-21 13:23:00 -0500] rgsteele: So, I wanted to be able to concatenate all the files in the .d/ dir, and put the resulting file at /etc/network/interfaces.  (The current resource for managing network interfaces is RedHat-only)
[2012-02-21 13:23:00 -0500] BryanWB: rgsteele: that is frowned on because it can be pretty unpredictable
[2012-02-21 13:24:00 -0500] BryanWB: though, juanje wrote an lwrp to do that
[2012-02-21 13:24:00 -0500] BryanWB: i would template the whole thing, are u afraid of destroying your network connection?
[2012-02-21 13:27:00 -0500] Axsuul: BryanWB: nice podcast, had a listen
[2012-02-21 13:28:00 -0500] Axsuul: ElasticSearch... too bad I chose Solr
[2012-02-21 13:28:00 -0500] BryanWB: Axsuul: tks
[2012-02-21 13:28:00 -0500] BryanWB: Axsuul: what could we do better?
[2012-02-21 13:29:00 -0500] Axsuul: I think you guys are doing a good job
[2012-02-21 13:29:00 -0500] nico: ES is good
[2012-02-21 13:29:00 -0500] Axsuul: i would be interested if you guys talked about some "good practices" though
[2012-02-21 13:30:00 -0500] Axsuul: i only learned chef this week though
[2012-02-21 13:31:00 -0500] BryanWB: Axsuul: that's definitely planned, tks
[2012-02-21 13:31:00 -0500] Axsuul: where is this Chef conf gonna be at?
[2012-02-21 13:31:00 -0500] BryanWB: SF, CA
[2012-02-21 13:31:00 -0500] Axsuul: Ah ok cool
[2012-02-21 13:31:00 -0500] BryanWB: no in Burlingame, CA just outside SF
[2012-02-21 13:32:00 -0500] Axsuul: I would also be really interested if you had some people on the show who use Chef for web stacks
[2012-02-21 13:36:00 -0500] Aengus-: I would be surprised if someone wasn't using Chef for web stacks :)
[2012-02-21 13:37:00 -0500] Axsuul: hehe true
[2012-02-21 13:37:00 -0500] Axsuul: can't get enough of it though
[2012-02-21 13:39:00 -0500] lflux: zts: not really running into problems, other than I'm not really sure of the difference for apache when it comes to reload (which just sends SIGHUP) and graceful (which actually is a restart, though most likely what you mean with a reload in my environment)
[2012-02-21 13:43:00 -0500] lflux: BryanWB: chef conf? when?
[2012-02-21 13:43:00 -0500] lflux: oh, SF. wtb euro chef conf.
[2012-02-21 13:43:00 -0500] BryanWB: lflux: april i think
[2012-02-21 13:43:00 -0500] BryanWB: chefcamp.eu , we want to do soemthing in october connected to devopsdays in Italy
[2012-02-21 13:44:00 -0500] BryanWB: but i want someone else to organize, cuz i want to focus on cooking
[2012-02-21 13:45:00 -0500] lflux: there's a puppet conf here in stockholm soonish that I might attend just to get a feel for what people around me are doing, but Italy is definitely doable
[2012-02-21 13:48:00 -0500] plu: if I run `knife cookbook upload build-essentials -E stable --freeze` the cookbook build-essential should only show up in the 'stable' environment, shouldnt it? I did not upload that cookbook before, but it shows up in all environments I have (stable, test and _default)
[2012-02-21 13:50:00 -0500] renchap: cookbooks are global to the server
[2012-02-21 13:50:00 -0500] renchap: but you setup version constraints on each environment
[2012-02-21 13:50:00 -0500] renchap: which allow you to choose which version each environment uses
[2012-02-21 13:54:00 -0500] plu: renchap: ah thanks :)
[2012-02-21 13:55:00 -0500] zts: lflux: hm, it used to be that graceful was "graceful reload", and they subsequently added a "graceful restart" - the latter is a full restart, but doesn't terminate in-progress connections
[2012-02-21 13:56:00 -0500] zts: lflux: but we're on an old apache here (with custom init scripts), so I'd definitely recommend referring to docs for that one :)
[2012-02-21 14:24:00 -0500] ssd7: Ohai Chefs
[2012-02-21 14:26:00 -0500] sivy: hi ssd7
[2012-02-21 14:26:00 -0500] sivy: good morning
[2012-02-21 14:27:00 -0500] sivy: so ssd7: I've worked around a set_unless issue by simply hacking my copy of the mysql::server recipe, but can we make sure it gets bubbled  up to the right people?
[2012-02-21 14:27:00 -0500] sivy: sample: https://gist.github.com/1860143
[2012-02-21 14:28:00 -0500] sivy: someone from opscode had a shef sample on Friday, but I missed it and lost my backlog
[2012-02-21 14:28:00 -0500] sivy: set_unless doesn't seem to respect some node values
[2012-02-21 15:05:00 -0500] xerxas: Hi all
[2012-02-21 15:05:00 -0500] xerxas: what would you use tu make service discovery / service reconfiguration / notification / propagation of topology change with chef
[2012-02-21 15:05:00 -0500] xerxas: ?
[2012-02-21 15:06:00 -0500] xerxas: as an example, I have a worker process using redis, I want the worker to know redis' address
[2012-02-21 15:06:00 -0500] xerxas: if the redis server is changing , I'll need to run chef-client on my workers servers
[2012-02-21 15:07:00 -0500] xerxas: is there a zookeeper fed by a chef server ? or does chef have a mecanism to advertize differents hosts of topology change ? doubts so , because chef-client doesn't listen on the network ...
[2012-02-21 15:08:00 -0500] hoover_damm: xerxas, you can define a role like redis, and you can then use 'search' to find all the nodes with the 'redis' role
[2012-02-21 15:08:00 -0500] xerxas: hoover_damm:  yes, but it doesn't do notification
[2012-02-21 15:09:00 -0500] hoover_damm: have you looked into Noah? 
[2012-02-21 15:09:00 -0500] hoover_damm: https://github.com/lusis/Noah
[2012-02-21 15:09:00 -0500] xerxas: yeah
[2012-02-21 15:09:00 -0500] xerxas: zookeeper , and doozer alos
[2012-02-21 15:09:00 -0500] xerxas: also
[2012-02-21 15:10:00 -0500] xerxas: how do I glue chef and noah together ?
[2012-02-21 15:10:00 -0500] xerxas: is that a strange idea ?
[2012-02-21 15:10:00 -0500] lusis: https://github.com/lusis-cookbooks/noah
[2012-02-21 15:10:00 -0500] xerxas: hi lusis  , thanks for noah ! ;)
[2012-02-21 15:10:00 -0500] lusis: xerxas: if you shoot me an email, I can send you some general tips
[2012-02-21 15:11:00 -0500] xerxas: noah is designed to be glued with chef ?
[2012-02-21 15:11:00 -0500] lusis: not specifically with chef but it does glue pretty well
[2012-02-21 15:11:00 -0500] xerxas: lusis:  I'm moslty looking and thinking, I'm not sure I'll deploy this , for now
[2012-02-21 15:11:00 -0500] lusis: totally understand
[2012-02-21 15:11:00 -0500] xerxas: I'll start with some manual steps
[2012-02-21 15:11:00 -0500] xerxas: as for me it seems a bit complicated for now
[2012-02-21 15:11:00 -0500] xerxas: and maybe overkill for my current task
[2012-02-21 15:12:00 -0500] lusis: the general idea is that you have a step in your chef recipe that updates noah, noah sends a ping to a remote node which will run chef client
[2012-02-21 15:12:00 -0500] xerxas: but I would really appreciate sth closely tight with chef ;)
[2012-02-21 15:12:00 -0500] xerxas: lusis: very nice and simple design
[2012-02-21 15:12:00 -0500] lusis: heh
[2012-02-21 15:12:00 -0500] lusis: thanks
[2012-02-21 15:12:00 -0500] xerxas: noah is still not highly available ?
[2012-02-21 15:12:00 -0500] lusis: though honestly, you could probably get by with creative use of load balancer/haproxy
[2012-02-21 15:12:00 -0500] xerxas: IIRC , noah is based on redis , right ?
[2012-02-21 15:13:00 -0500] lusis: in that case
[2012-02-21 15:13:00 -0500] lusis: it's not HA, no. It depends on Redis for that part
[2012-02-21 15:13:00 -0500] lusis: but the front ends are horizontal
[2012-02-21 15:13:00 -0500] xerxas: ahh , right
[2012-02-21 15:13:00 -0500] xerxas: yes, for sure
[2012-02-21 15:13:00 -0500] xerxas: "though honestly, you could probably get by with creative use of load balancer/haproxy", didn't get the point
[2012-02-21 15:14:00 -0500] xerxas: you mean , my load balancer have a fixed address and should be attached to my backend service ?
[2012-02-21 15:14:00 -0500] lusis: the general idea is that you use a local haproxy on app nodes
[2012-02-21 15:14:00 -0500] xerxas: then I see the same problem with my load balancer configuration ?
[2012-02-21 15:14:00 -0500] lusis: yes
[2012-02-21 15:14:00 -0500] lusis: sort of
[2012-02-21 15:14:00 -0500] xerxas: + I don't like haproxy ;)
[2012-02-21 15:14:00 -0500] lusis: hah
[2012-02-21 15:15:00 -0500] xerxas: I mean , I don't like configuration based proxies ;)
[2012-02-21 15:15:00 -0500] xerxas: registration is better
[2012-02-21 15:15:00 -0500] xerxas: I like the ideas behind zeroMQ
[2012-02-21 15:15:00 -0500] xerxas: mongrel ...
[2012-02-21 15:15:00 -0500] lusis: yeah zeromq is pretty awesome
[2012-02-21 15:16:00 -0500] lusis: xerxas: if you shoot me an email, I'd be glad to help noodle out some noah approaches ( or zeromq). A bit hectic on work stuff today so I can't focus on IRC too much
[2012-02-21 15:16:00 -0500] lusis: =/
[2012-02-21 15:16:00 -0500] xerxas: noah, so by using "notifies" with chef which will notify noah, noah will notify my infrastructure ?
[2012-02-21 15:16:00 -0500] lusis: yep
[2012-02-21 15:16:00 -0500] xerxas: nice
[2012-02-21 15:16:00 -0500] lusis: the noah LWRP provides a way to add entries to noah
[2012-02-21 15:16:00 -0500] xerxas: ;)
[2012-02-21 15:16:00 -0500] xerxas: nice
[2012-02-21 15:16:00 -0500] m4rcu5: im doing an search for some nodes and i need the ip address of these machines, not the fqdn, what would be the best way to go about that?
[2012-02-21 15:16:00 -0500] xerxas: lusis:  I won't disturb you today
[2012-02-21 15:17:00 -0500] xerxas: I think I need to test some stuff
[2012-02-21 15:17:00 -0500] lusis: xerxas: I totally don't mind at all
[2012-02-21 15:17:00 -0500] lusis: just not able to focus at the immediate moment ;)
[2012-02-21 15:18:00 -0500] xerxas: yeah
[2012-02-21 15:18:00 -0500] xerxas: thanks
[2012-02-21 15:18:00 -0500] lusis: np!
[2012-02-21 15:33:00 -0500] jtimberman: top o' the mornin' from hollywood chefs :)
[2012-02-21 15:34:00 -0500] mattray: jtimberman, Chef Trainer to the Stars!
[2012-02-21 15:34:00 -0500] dyer: Morning everyone
[2012-02-21 15:36:00 -0500] ivey: can anyone answer a question about sea bass? i've been going around and around and i just can't keep it from ending up tough
[2012-02-21 15:37:00 -0500] atomic-penguin: ivey, what method are you using to cook your sea bass?
[2012-02-21 15:37:00 -0500] ivey: SSH
[2012-02-21 15:37:00 -0500] ivey: sorry, need more coffee to make the joke go longer
[2012-02-21 15:37:00 -0500] hoover_damm: clearly
[2012-02-21 15:38:00 -0500] hoover_damm: ivey, try some salt?
[2012-02-21 15:38:00 -0500] hoover_damm: what salt method?
[2012-02-21 15:38:00 -0500] judd7: I like a nice salted hash.
[2012-02-21 15:38:00 -0500] ivey: also, mostly vegan so i don't know anything about cooking sea bass
[2012-02-21 15:38:00 -0500] jonlives: ivey: you prob want to move your seabass to a cloud.
[2012-02-21 15:38:00 -0500] hoover_damm: http://www.mexfish.com/fish/bsbass/bsbasshawl.jpg
[2012-02-21 15:39:00 -0500] ivey: that's quite a fish
[2012-02-21 15:39:00 -0500] judd7: we now support cloud AND ocean.
[2012-02-21 15:40:00 -0500] jtimberman: mattray: hah
[2012-02-21 15:41:00 -0500] dyer: Anyone around that can help me w/ an ohai plugin ?
[2012-02-21 15:42:00 -0500] dyer: having a hell of a time getting one to work, not sure I understand how they are exected
[2012-02-21 15:44:00 -0500] jtimberman: dyer: ohai loads all the plugins in the plugin path when it runs
[2012-02-21 15:44:00 -0500] dyer: jtimberman, ty for ack'ing
[2012-02-21 15:44:00 -0500] dyer: ok, so I am trying to get a work around for this bug http://tickets.opscode.com/browse/OHAI-310
[2012-02-21 15:45:00 -0500] dyer: I wrote my own library for doing this which I was using in several cookbooks, but its not very dry
[2012-02-21 15:45:00 -0500] dyer: so I was thinking my work around should be a ohai plugin, at least until that bug is resolved
[2012-02-21 15:46:00 -0500] dyer: Here is what I have in a library ( https://gist.github.com/1663740027f004f301b5 )
[2012-02-21 15:47:00 -0500] jtimberman: you have to tell ohai where to look for them
[2012-02-21 15:48:00 -0500] dyer: Yea, I am able to call the plugin, I am just not getting anything back
[2012-02-21 15:48:00 -0500] dyer: well I am getting nil back
[2012-02-21 15:48:00 -0500] dyer: one sec, I hacked my "plugin" all to hell
[2012-02-21 15:48:00 -0500] dyer: let me get it back to a sane state
[2012-02-21 15:48:00 -0500] dyer: so I can show u whats going on
[2012-02-21 15:50:00 -0500] jtimberman: i actually have to go now
[2012-02-21 15:51:00 -0500] dyer: oh
[2012-02-21 15:51:00 -0500] dyer: ok
[2012-02-21 15:51:00 -0500] dyer: anyone else able to assist?
[2012-02-21 15:52:00 -0500] jtimberman: http://wiki.opscode.com/display/chef/Ohai
[2012-02-21 15:53:00 -0500] yatesy: cd
[2012-02-21 15:53:00 -0500] yatesy: ls
[2012-02-21 15:54:00 -0500] yatesy: arg, sorry
[2012-02-21 15:58:00 -0500] dyer: yea, I have been on there
[2012-02-21 15:59:00 -0500] atomic-penguin: ivey, you could smoke your sea bass, http://imgur.com/r/WTF/saJzC
[2012-02-21 16:00:00 -0500] BryanWB: oh no! culinary invasion!
[2012-02-21 16:00:00 -0500] Brad_K: on the #chef channel?!?  scandalous!  ;-)
[2012-02-21 16:01:00 -0500] atomic-penguin: nobody actually looked at the funny picture
[2012-02-21 16:01:00 -0500] gmcinnes: ha ha ha
[2012-02-21 16:01:00 -0500] cwj: an humor joke
[2012-02-21 16:01:00 -0500] dyer: ok, wtf, so I have the same plugin running on ec2 and locally ( exampleI found online ) and I get nil back on ec2, and the expected hash on darwin
[2012-02-21 16:01:00 -0500] dyer: https://gist.github.com/ab717afd345465c32c2f
[2012-02-21 16:01:00 -0500] dyer: same version of chef
[2012-02-21 16:02:00 -0500] Brad_K: if turducken = turkey + duck + chicken, would that make this something like chibass?
[2012-02-21 16:11:00 -0500] gmcinnes: ladies and gentleshefs: on Friday last, I was complaining that chef-client was wedging at select() in Net::HTTP on all my machines.
[2012-02-21 16:12:00 -0500] gmcinnes: Using strace -p I see that select is being called like: select(7, [6], NULL, NULL, NULL)
[2012-02-21 16:13:00 -0500] gmcinnes: timeout is the last param there, and from the manpage: If timeout is NULL (no timeout), select() can block indefinitely.
[2012-02-21 16:13:00 -0500] gmcinnes: So. I see why.
[2012-02-21 16:13:00 -0500] gmcinnes: I guess I need to spelunk into chef-client to see how its calling Net::HTTP and see if I can force feed it a timeout.
[2012-02-21 16:14:00 -0500] btm: gmcinnes: if you find something, please make sure there is an open ticket for the issue on http://tickets.opscode.com Thanks!
[2012-02-21 16:15:00 -0500] gmcinnes: If that select() is blocking forever it likely means the chef server is doing something it shouldn't be. Hosted chef
[2012-02-21 16:16:00 -0500] BryanWB: is there a good postgresql9 cookbook out there?
[2012-02-21 16:16:00 -0500] btm: gmcinnes: You can open a support issue against hosted chef by emailing support@opscode.com as well.
[2012-02-21 16:28:00 -0500] gmcinnes: btm: Will do. Let me see if I can get a patch.
[2012-02-21 16:40:00 -0500] chefnewbie: I have written a recipe which installs a package and starts up the listener. The listener accepts inputs during startup using switches. I can't figure out how to pass those inputs to it via the Chef recipe/cookbook. Any help would be appreciated.
[2012-02-21 16:40:00 -0500] chefnewbie: service my listener start --username newbie --password newbie
[2012-02-21 16:41:00 -0500] cwj: chefnewbie: can you provide a gist or pastebin of your recipe so we can see what you are working with?
[2012-02-21 16:41:00 -0500] chefnewbie: sure, in a minute
[2012-02-21 16:50:00 -0500] chefnewbie: https://gist.github.com/1877335
[2012-02-21 16:50:00 -0500] quazimodo: hrm
[2012-02-21 16:50:00 -0500] quazimodo: so
[2012-02-21 16:50:00 -0500] quazimodo: salt does remote execution
[2012-02-21 16:51:00 -0500] quazimodo: i guess by changing your recipes or whatever, you can get chef to run scripts that are effectively going to do remote execution, eh?
[2012-02-21 16:52:00 -0500] btm: chefnewbie: do you always start with those flags? You can use the 'start_command' attribute. If you only do it once, you could use an execute resource to start the first time (action :nothing, and notify it from the package installation) and then use a service resource to keep it running.
[2012-02-21 16:52:00 -0500] btm: chefnewbie: http://wiki.opscode.com/display/chef/Resources#Resources-Service
[2012-02-21 16:53:00 -0500] chefnewbie: btm: Only the first startup is with those flags. Every subsequent startup may or may not have those flags.
[2012-02-21 16:57:00 -0500] btm: chefnewbie: https://gist.github.com/1877351
[2012-02-21 16:59:00 -0500] chefnewbie: btm: thanks for that, trying it now
[2012-02-21 17:02:00 -0500] BryanWB: quazimodo: yes
[2012-02-21 17:03:00 -0500] cjs226: running into an issue with implementing environments.  env prod with cookbook versions set works like a charm.  however, having a dev environment with not cookbook versions is causing "FATAL: Net::HTTPServerException: 404 "Not Found"" when uploading new versions of cookbooks.
[2012-02-21 17:04:00 -0500] BobFunk: seems like couchdb just went ballicstic and started eaiting up a whole lot of ram - any tips on what could cause this?
[2012-02-21 17:08:00 -0500] BobFunk: chef server log is full of
[2012-02-21 17:08:00 -0500] BobFunk: Connection refused connecting to localhost:5984 for /chef/_design/id_map, retry 1/5
[2012-02-21 17:08:00 -0500] BobFunk: couchdb is running but just using memory way out of the normal
[2012-02-21 17:09:00 -0500] BobFunk: this came out of nowhere - no changes to anything chef related or anything on the chef server machine in general
[2012-02-21 17:13:00 -0500] Urocyon: Where would you keep things like database tuning settings for a specific server type or deployment?  Role? Recipe?  Data Bag?
[2012-02-21 17:14:00 -0500] AntonZ: attributes
[2012-02-21 17:14:00 -0500] BobFunk: get an endless stream of this in the couch.log: https://gist.github.com/1877483
[2012-02-21 17:14:00 -0500] btm: BobFunk: Can you access the futon web interface on couchdb? http://localhost:5984/_utils ?
[2012-02-21 17:14:00 -0500] Urocyon: sure, attributes... but there are plenty of options for where you put those.
[2012-02-21 17:15:00 -0500] btm: BobFunk: What version of CouchDB?
[2012-02-21 17:15:00 -0500] BobFunk: 0.10.0
[2012-02-21 17:15:00 -0500] Urocyon: or do you  mean in a particular cookbook's /attributes directory?
[2012-02-21 17:15:00 -0500] AntonZ: im new to chef, and that's the only place i know :)
[2012-02-21 17:15:00 -0500] BobFunk: only used by chef
[2012-02-21 17:15:00 -0500] thom: Urocyon: data bag
[2012-02-21 17:16:00 -0500] AntonZ: the structure is - cookbook -> attribiutes folder - default.rb
[2012-02-21 17:16:00 -0500] BobFunk: and no, no luck connecting to ed #chef
[2012-02-21 17:16:00 -0500] BobFunk: to futon
[2012-02-21 17:16:00 -0500] thom: Urocyon: that way you can trivially have a per application or per host config
[2012-02-21 17:16:00 -0500] btm: BobFunk: it looks like Couchdb is crashing and restarting.
[2012-02-21 17:16:00 -0500] BobFunk: yeah
[2012-02-21 17:17:00 -0500] BobFunk: once chef-server gives up retrying the connecting there's not even any crash info
[2012-02-21 17:17:00 -0500] Urocyon: Sounds good.   I'm thinking I might have several different aws sizes with tunings for each size system to which I wish to deploy.
[2012-02-21 17:17:00 -0500] BobFunk: I just keep seeing the "Apache CouchDB has started" notice in the log, nothing else
[2012-02-21 17:17:00 -0500] thom: Urocyon: yah
[2012-02-21 17:17:00 -0500] btm: BobFunk: it keeps repeating that even with chef turned off?
[2012-02-21 17:18:00 -0500] BobFunk: gonna make sure
[2012-02-21 17:18:00 -0500] thom: databags are great for things like that; i use them for EBS volumes, rabbitmq vhosts
[2012-02-21 17:18:00 -0500] thom: etc
[2012-02-21 17:18:00 -0500] btm: BobFunk: I'd poke around couchdb, maybe try 1.0.1
[2012-02-21 17:20:00 -0500] BobFunk: might be worth it upgrading - isn't there some problem with the storage format changing along the way?
[2012-02-21 17:20:00 -0500] BobFunk: hmm, seems it was a chef-expander worker driving couch crazy
[2012-02-21 17:21:00 -0500] btm: BobFunk: last time I had a problem like that was before 0.10. The internet seems to confirm you just need to copy the databases from one versions directory to the next.
[2012-02-21 17:21:00 -0500] BobFunk: ok, great
[2012-02-21 17:21:00 -0500] Urocyon: There should be a chef cookbook cookbook  with things like example data bags and such....
[2012-02-21 17:23:00 -0500] Urocyon: heh, just saw the db_config example on http://wiki.opscode.com/display/chef/Data+Bags
[2012-02-21 17:24:00 -0500] BobFunk: will go for the couchdb upgrade
[2012-02-21 17:24:00 -0500] BobFunk: seems that whenever anything tries to access couch it just start blowing up
[2012-02-21 17:25:00 -0500] mmangino: I have a total noob question which I apologize for in advance, but I can't seem to figure out where to look
[2012-02-21 17:25:00 -0500] mmangino: When I update a data bag, for example adding a new user
[2012-02-21 17:26:00 -0500] mmangino: how do I make sure the new user is created on all of my hosts?
[2012-02-21 17:27:00 -0500] jbz: mmangino: If your cookbooks are built to, each time, create users for all entries in the data bag, it sohuld work fine.
[2012-02-21 17:28:00 -0500] mmangino: I'm using the java web start
[2012-02-21 17:28:00 -0500] miah: i use the users cookbook
[2012-02-21 17:28:00 -0500] mmangino: which uses the users cookbook
[2012-02-21 17:28:00 -0500] jbz: The first run after you've added the info, they'll loop through all the entries, and the entry for the nonexistent user will generate a resource that will fire because the user doesn't exist yet.
[2012-02-21 17:28:00 -0500] jbz: What's harder is *removing* users. :-P
[2012-02-21 17:28:00 -0500] mmangino: OKay, so here is what I'm missing
[2012-02-21 17:28:00 -0500] jbz: mmangino: Oh, then you should be fine.
[2012-02-21 17:28:00 -0500] mmangino: "The first run after..." what first run?
[2012-02-21 17:29:00 -0500] jbz: mmangino: OK, there are a few ways people use Chef
[2012-02-21 17:29:00 -0500] mmangino: how do I make that happen?
[2012-02-21 17:29:00 -0500] jbz: 1) run it as a daemon process
[2012-02-21 17:29:00 -0500] jbz: 2) run it manually
[2012-02-21 17:29:00 -0500] jbz: 3) run it from a control tier (running it manually, basically)
[2012-02-21 17:29:00 -0500] miah: i usually build a wrapper cookbook that calls the other cookbooks and ensures things like users exist
[2012-02-21 17:29:00 -0500] jbz: if you have chef running as a daemon, it will do a new client run every (interval) seconds
[2012-02-21 17:29:00 -0500] mmangino: aha! that makes sense
[2012-02-21 17:30:00 -0500] jbz: You can run chef-client as a daemon manually, or you can use init or upstart or runit or another service to ensure its up.
[2012-02-21 17:30:00 -0500] mmangino: does the hosted chef have a way of saying "update all nodes"
[2012-02-21 17:30:00 -0500] jbz: The chef gem includes a sample init.d script
[2012-02-21 17:30:00 -0500] jbz: mmangino:  No, chef is pull-only.
[2012-02-21 17:30:00 -0500] mmangino: It seems like something that knife should do
[2012-02-21 17:30:00 -0500] jbz: You can't 'push' changes to nodes.
[2012-02-21 17:30:00 -0500] jbz: Yes, knife can be used to run the client (using knife ssh)
[2012-02-21 17:30:00 -0500] jbz: And you can use knife ssh to run the chef-client on multiple nodes at once.
[2012-02-21 17:30:00 -0500] mmangino: oh, knife ssh
[2012-02-21 17:31:00 -0500] btm: mmangino: typically you run 'knife ssh *:* sudo chef-client' to run chef on all nodes simultaneously.
[2012-02-21 17:33:00 -0500] mmangino: okay, that makes sense
[2012-02-21 17:34:00 -0500] ssd7: Ohai Chefs!
[2012-02-21 17:35:00 -0500] mmangino: and it almost worked, but the node that was magically created following the tutorial can't be contacted
[2012-02-21 17:36:00 -0500] mmangino: because the fqdn is wrong
[2012-02-21 17:38:00 -0500] ssd7: mmangino: Is the node on ec2?
[2012-02-21 17:38:00 -0500] mmangino: Yeah, it is
[2012-02-21 17:38:00 -0500] ssd7: try this
[2012-02-21 17:39:00 -0500] ssd7: knife ssh '*:*' 'sudo chef-client' -a ec2.public_hostname
[2012-02-21 17:39:00 -0500] ssd7: that will tell knife to use the node attribute "ec2.public_hostname" rather than the fqdn
[2012-02-21 17:40:00 -0500] mmangino: okay, let me bring up a new server to make sure the environment is pristine
[2012-02-21 17:50:00 -0500] mmangino: ssd7: awesome, that worked perfectly. I'm starting to figure this out!
[2012-02-21 18:15:00 -0500] dyer: Question, I am doing a ohai plugin and I call net/http in it to get some metadata from the aws api
[2012-02-21 18:15:00 -0500] dyer: So when I do this it seems to run the request multiple times and then block
[2012-02-21 18:15:00 -0500] dyer: https://gist.github.com/fe2d95ab3680f2acbb73
[2012-02-21 18:15:00 -0500] dyer: Why is it running that 3 times?
[2012-02-21 18:17:00 -0500] dyer: Hrm, it sees to be retrying
[2012-02-21 18:17:00 -0500] dyer: 9 times now
[2012-02-21 18:21:00 -0500] jbz: yeah, 404 - it doesn't like public-ipv4s?  Is that the end of the URL you're using?
[2012-02-21 18:21:00 -0500] jbz: I had thought there was an EC2 bug where vpc nodes didn't report public_ipv4s
[2012-02-21 18:22:00 -0500] jbz: in fact didn't have aws attribs at all until recently, due to some problem
[2012-02-21 18:22:00 -0500] dyer: jbz, yes
[2012-02-21 18:23:00 -0500] dyer: I am taking Mitchell Hashimoto's stance on that ticket
[2012-02-21 18:23:00 -0500] dyer: writing a ohai plugin for vpc
[2012-02-21 18:23:00 -0500] dyer: http://tickets.opscode.com/browse/OHAI-310
[2012-02-21 18:24:00 -0500] dyer: its a WIP right now
[2012-02-21 18:24:00 -0500] dyer: https://gist.github.com/1877969
[2012-02-21 18:25:00 -0500] dyer: when I make the api request I return nil if the http response code is not 200
[2012-02-21 18:25:00 -0500] dyer: so whhy is it doing 10 retries ?
[2012-02-21 18:29:00 -0500] jbz: dyer:  I dunno, actually.  Is ohai error handling doing that?
[2012-02-21 18:29:00 -0500] jbz: Above the plugin level?
[2012-02-21 18:30:00 -0500] dyer: I dont know kinda was hoping u guys had some insight there
[2012-02-21 18:30:00 -0500] dyer: :)
[2012-02-21 18:30:00 -0500] jbz: :-)
[2012-02-21 18:30:00 -0500] dcolish: Is there a way to calculate all required cookbooks for any given cookbook (say chef-server)?
[2012-02-21 18:31:00 -0500] cwj: dcolish: establishing dependencies is one purpose of cookbook metadata
[2012-02-21 18:32:00 -0500] cwj: knife cookbook show chef-server latest
[2012-02-21 18:32:00 -0500] dcolish: yes, so is there a cli frontend to tell me them?
[2012-02-21 18:32:00 -0500] jbz: dcolish: have a look here: http://agilesysadmin.net/chef-dependencies
[2012-02-21 18:33:00 -0500] cwj: the output will include a list of dependencies
[2012-02-21 18:33:00 -0500] jbz: cwj:  Ooh, is that recursive?
[2012-02-21 18:33:00 -0500] dcolish: ah nice
[2012-02-21 18:33:00 -0500] cwj: not sure about recursiveness
[2012-02-21 18:33:00 -0500] cwj: guessing it is not recursive
[2012-02-21 18:34:00 -0500] dcolish: yeah i'm looking for a recursive traversal of the dependency graph so I can get those cookbooks copied to one directory and boostrap a chef-server
[2012-02-21 18:34:00 -0500] cwj: that might be a use case for librarian
[2012-02-21 18:36:00 -0500] cwj: not sure since i dont use it myself
[2012-02-21 18:36:00 -0500] dcolish: hmm that might work. this wouldnt be an issue if i could just clone the entire cookbooks repo from opscode and point chef-solo directly to it
[2012-02-21 18:37:00 -0500] cwj: well its my understanding that opscode intends to split up the existing cookbooks repo in favor of having people use librarian
[2012-02-21 18:37:00 -0500] Brad_K: dcolish: see http://wiki.opscode.com/display/chef/Community+Plugins
[2012-02-21 18:37:00 -0500] Brad_K: there are multiple plugins for knife which might help.
[2012-02-21 18:39:00 -0500] dcolish: knife-solo looks like it might do something, hard to tell
[2012-02-21 18:40:00 -0500] dcolish: yeah thats not going to do much more than what vagrant is already doing for me
[2012-02-21 18:41:00 -0500] Brad_K: dcolish: i don't think that knife-solo will do what you think.  knife-audit and knife-crawl seem to be closer to what you're looking for.  of course, there are even more plugins available on github that are not listed here.
[2012-02-21 18:41:00 -0500] Brad_K: you'd have to go searching github to see what additional plugins you can find that might be useful.
[2012-02-21 18:42:00 -0500] Brad_K: and there may be more knife plugins available as standard gems that can also be installed, so you could do a quick gem search to look and see what is available.
[2012-02-21 18:48:00 -0500] dcolish: well, I dont see anything off hand that can do that without introspecting chef-server, but I just worked through the tracebacks until chef-solo ran correctly
[2012-02-21 19:22:00 -0500] liao: Hi, has anyone seen where a chef server can not offer to download the cookbooks to the client? I have a chef-server that just sends back a 500 error. Its like the coobook is not on the chef-servers file system
[2012-02-21 19:22:00 -0500] liao: THis is all I get: [Tue, 21 Feb 2012 19:21:29 +0000] ERROR: Server returned error for https://chef2/cookbooks/sudo/0.0.1/files/6aab41fe37f60f9ffcbde3c82642fbaf, retrying 1/5 in 4s
[2012-02-21 19:22:00 -0500] liao: Thats on the chef-client
[2012-02-21 19:24:00 -0500] chefnewbie: Hello btw: Tried the recipe and can't shake this error: https://gist.github.com/1878154
[2012-02-21 19:24:00 -0500] chefnewbie: Sorry if it's evident how to fix, but haven't been able to
[2012-02-21 19:39:00 -0500] and311: I'm trying to create an ec2 server using "knife exec". Can someone tell me why this simple script returns the errors shown? http://pastie.org/3429110 returns
[2012-02-21 19:40:00 -0500] jbz: and311:  Are you sure that ssh key and that AMI exist on the ec2 endpoint you're using?
[2012-02-21 19:40:00 -0500] jbz: Those are specific to AWS regions
[2012-02-21 19:41:00 -0500] and311: It's for the us-east region, which is the default, no?
[2012-02-21 19:41:00 -0500] j-v-e: Hi All
[2012-02-21 19:41:00 -0500] j-v-e: search question
[2012-02-21 19:42:00 -0500] j-v-e: I'd like to do one search that return an array of node_ip:node_fqdn
[2012-02-21 19:42:00 -0500] j-v-e: array={ node1_ip:node1_fqdn, node2_ip:node2fqdn, ...}
[2012-02-21 19:42:00 -0500] and311: jbz: Link to ami details: http://thecloudmarket.com/image/ami-71dc0b18--ubuntu-images-ebs-ubuntu-lucid-10-04-i386-server-20120110#/definition
[2012-02-21 19:42:00 -0500] j-v-e: is there a way to do that in ruby ?
[2012-02-21 19:43:00 -0500] jbz: and311: Hm
[2012-02-21 19:43:00 -0500] and311: jbz: I'm not sure if my use of ".config" is appropriate.
[2012-02-21 19:43:00 -0500] jbz: and311: I'm digging up similar calls in our console code
[2012-02-21 19:43:00 -0500] itwasntandy: j-v-e: are all nodes in the same environment, or running the same role?
[2012-02-21 19:44:00 -0500] and311: jbz: Knife exec docs are a little unclear to me. I see the example for Chef::Knife::Ec2ServerDelete in the wiki, and it never uses .config, but I don't see accessors for anything so this is the only way I know to do it.
[2012-02-21 19:45:00 -0500] j-v-e: itwasntandy: all node are in the same environment and running the same role
[2012-02-21 19:45:00 -0500] j-v-e: I just want to do one search to get both the IP and FQDN for all nodes
[2012-02-21 19:45:00 -0500] jbz: j-v-e:  You do a search for the nodes, and then you pull out those values once you've gotten the results.  Your search is going to return an array of node objects.
[2012-02-21 19:46:00 -0500] jbz: j-v-e:  beware, though, if you have *lots* of nodes, that means you're dealing with a fair chunk of stuff :-)
[2012-02-21 19:47:00 -0500] j-v-e: jbz: so my first search would be "ossec_agents = search(:node, "role:ossec-agent AND chef_environment:vagrant")
[2012-02-21 19:47:00 -0500] gmcinnes: le dudes.  you have a *lot* of pull requests.
[2012-02-21 19:48:00 -0500] j-v-e: jbz: and from the returned array, I can do ossec_agents[0][:ipaddress], correct ?
[2012-02-21 19:49:00 -0500] jbz: j-v-e: OK, so ossec_agents is going to be an array of node objects.  Use map or whatever and create a new array
[2012-02-21 19:49:00 -0500] jbz: right, you can.  Be sure to check it's not nil. :-)
[2012-02-21 19:49:00 -0500] jbz: (i.e. no search results for whatever reason).
[2012-02-21 19:50:00 -0500] jbz: and311: Sorry, our deal uses fog to create nodes directly, not Chef::Knife
[2012-02-21 19:50:00 -0500] and311: jbz: Thanks for looking
[2012-02-21 19:51:00 -0500] itwasntandy: is the Chef::Knife stuff the same as the knife ec2bootstrap stuff?
[2012-02-21 19:51:00 -0500] and311: It should be
[2012-02-21 19:51:00 -0500] itwasntandy: because we use that.
[2012-02-21 19:52:00 -0500] and311: Well actually, I mean these are the classes I'm trying to use: https://github.com/opscode/knife-ec2/tree/master/lib/chef/knife
[2012-02-21 19:52:00 -0500] and311: Bootstrap isn't here, that's part of main knife I think
[2012-02-21 19:52:00 -0500] Urocyon: Is there a preferred form for specifying an attribute?  node.foo.bar, node[:foo][:bar], node['foo']['bar'] ?
[2012-02-21 19:52:00 -0500] itwasntandy: well yes, knife-ec2 is what I meant
[2012-02-21 19:53:00 -0500] Urocyon: mix and match? node.foo[:bar]
[2012-02-21 19:55:00 -0500] dyer: Can anyone explain to me why a ohai plugin is run multiple times?
[2012-02-21 19:55:00 -0500] dyer: https://gist.github.com/4d7cee18ef434fc48fbb
[2012-02-21 19:56:00 -0500] itwasntandy: and311: so... for me using the knife cli command it works..
[2012-02-21 19:56:00 -0500] itwasntandy: $ knife ec2 server create -r "role[ehcache]" -I ami-71dc0b18 --flavor m1.small -x root -N test1
[2012-02-21 19:56:00 -0500] itwasntandy: hang on
[2012-02-21 19:56:00 -0500] itwasntandy: https://gist.github.com/1878501
[2012-02-21 19:57:00 -0500] itwasntandy: so is there's someting wrong with your ec2 account or is i defaulting to a different zone?
[2012-02-21 19:57:00 -0500] itwasntandy: if you specify the zone you think you want directly does it work?
[2012-02-21 20:00:00 -0500] Urocyon: ah, may have an answer here: http://wiki.opscode.com/display/chef/Cookbook+Style+Guide+Draft
[2012-02-21 20:00:00 -0500] and311: itwasntandy: Yeah, it works for me, too. I've been trying to automate stuff with knife exec
[2012-02-21 20:00:00 -0500] Urocyon: Use strings for accessing node attributes.
[2012-02-21 20:00:00 -0500] and311: itwasntandy: I can do it fine with knife ec2 server ..., just doesn't work from knife exec.
[2012-02-21 20:02:00 -0500] and311: itwasntandy: also, if I print out create.config, I get what you see here: http://pastie.org/3429110
[2012-02-21 20:03:00 -0500] and311: I started a help discussion on this here: http://help.opscode.com/discussions/problems/1261-invalid-image-value-error-in-knife-exec
[2012-02-21 20:10:00 -0500] sivy: anyone using bitbucket from a git resource in chef? i'm getting really annoyed
[2012-02-21 20:16:00 -0500] hazzmatt: hi all
[2012-02-21 20:16:00 -0500] hazzmatt: wondering if anyone was available for a pretty newbie question?
[2012-02-21 20:16:00 -0500] hazzmatt: if this is not the right forum, lemme know.
[2012-02-21 20:17:00 -0500] cwj: hazzmatt: best just to ask instead of asking to ask :)
[2012-02-21 20:18:00 -0500] hazzmatt: fair. ok. new setup. my 2 nodes are deploying a new release unintentionally.
[2012-02-21 20:19:00 -0500] hazzmatt: can modifying a local directory tell chef client that it needs to update a release?
[2012-02-21 20:19:00 -0500] hazzmatt: nothing new was checked into the remote repo. cookbook was not updated. just local (on box) changes made to directory that chef deploys to.
[2012-02-21 20:20:00 -0500] cwj: gist your deployment recipe?
[2012-02-21 20:22:00 -0500] hazzmatt: https://gist.github.com/1878654
[2012-02-21 20:23:00 -0500] cwj: looks like you dont have an only_if or not_if to guard that resource
[2012-02-21 20:23:00 -0500] cwj: so its probably going to deploy every time
[2012-02-21 20:23:00 -0500] cwj: i use a lock file
[2012-02-21 20:24:00 -0500] cwj: e.g. not_if { File.exists?("/path/to/some/lockfile") }
[2012-02-21 20:24:00 -0500] jbz: hazzmatt:  Or you want to use deploy_revision instead
[2012-02-21 20:25:00 -0500] dyer: Anyone around that can help me w/ this ohai stuff?  it seems to be a bit of a total crapshoot to get it working
[2012-02-21 20:25:00 -0500] hazzmatt: and the lockfile gets created when new release happens? and not after?
[2012-02-21 20:25:00 -0500] jbz: hazzmatt:  If you use deploy_revision, chef will keep track of the revision ID it has deployed for that resource (in /var/cache/chef/revision-deploys or something like that) and won't re-deploy unless the revision changes or unless you use the force_deploy attribute.
[2012-02-21 20:26:00 -0500] hazzmatt: ok. that makes sense.
[2012-02-21 20:30:00 -0500] j3r0m3: I need to use a different ports.conf file for production than for development/staging.. currently there is only one and it is located in the /files/default/ directory of my application in my chef-repo. how do I edit it for production and make sure it is used while spinning up an instance in the production env?
[2012-02-21 20:31:00 -0500] jbz: j3r0m3: Probably the best way would be to write it out using a template resource, then you can override its contents via environment.
[2012-02-21 20:31:00 -0500] j3r0m3: ah.. yes even the existing template file will need to be modified..
[2012-02-21 20:32:00 -0500] jbz: Yeah, more work up front for rue Op Laziness later.
[2012-02-21 20:32:00 -0500] jbz: Best Way(tm).
[2012-02-21 20:32:00 -0500] jbz: *true
[2012-02-21 20:33:00 -0500] hazzmatt: jbz - thanks for your help!
[2012-02-21 20:34:00 -0500] jbz: hazzmatt:  yw
[2012-02-21 20:34:00 -0500] dyer: Anyone around that has some experence w/ Ohai plugins?
[2012-02-21 20:36:00 -0500] werdnativ: Chatting in #rvm, I was trying to set up a chef-recipe to install rvm system-wide. The "official" community cookbook for rvm runs as root, which is very wrong according to rvm docs, and it breaks.
[2012-02-21 20:36:00 -0500] werdnativ: wondering what's the best workaround to install it using "sudo bash" as recommended?
[2012-02-21 20:37:00 -0500] atomic-penguin: BryanWB, you around?
[2012-02-21 20:37:00 -0500] werdnativ: also, using it with vagrant which runs chef_solo using sudo...
[2012-02-21 20:37:00 -0500] BryanWB: atomic-penguin, yeah
[2012-02-21 20:38:00 -0500] atomic-penguin: In your java cookbook that just got merged...
[2012-02-21 20:38:00 -0500] BryanWB: uh-oh
[2012-02-21 20:38:00 -0500] atomic-penguin: Is "amazon" equivalent to redhat,centos,scientific
[2012-02-21 20:38:00 -0500] BryanWB: atomic-penguin, i have no idea
[2012-02-21 20:38:00 -0500] BryanWB: atomic-penguin, jtimberman added that
[2012-02-21 20:38:00 -0500] ssd7_: werdnativ: You might want to check out this one: https://github.com/fnichol/chef-rvm, it has lots of nice features icnluding user install
[2012-02-21 20:38:00 -0500] atomic-penguin: The case switches seemed kind of inconsistent
[2012-02-21 20:39:00 -0500] werdnativ: ssd7_: nice, thanks. I tried adding rvm group users, etc. to the original recipe, but it's not quite right...
[2012-02-21 20:40:00 -0500] BryanWB: atomic-penguin, where is the 'amazon' reference? i don't see it in attributes/default.rb
[2012-02-21 20:41:00 -0500] atomic-penguin: BryanWB, yeah it is in metadata, openjdk recipe, etc.
[2012-02-21 20:41:00 -0500] BryanWB: interesting, no idea really
[2012-02-21 20:41:00 -0500] atomic-penguin: BryanWB, also got a "//" in a path in attributes
[2012-02-21 20:41:00 -0500] BryanWB: atomic-penguin, fuck
[2012-02-21 20:41:00 -0500] ssd7_: BryanWB: atomic-penguin can't speak for jtimberman, but amazon tends to be somewhere in between RHEL and Fedora
[2012-02-21 20:42:00 -0500] BryanWB: ssd7_, umm, what is 'amazon' in this context? amazon's own distro? or something funky that some centos ami's report?
[2012-02-21 20:42:00 -0500] atomic-penguin: ssd7_, I didn't say he could speak for him
[2012-02-21 20:43:00 -0500] ssd7_: BryanWB: It is what "Amazon Linux" AMIs on EC2
[2012-02-21 20:43:00 -0500] BryanWB: ssd7_, damn i am cloud illiterate
[2012-02-21 20:43:00 -0500] ssd7_: atomic-penguin: Sorry, my sentence was typed too quickly it seems.  Meant to be parsed as "BryanWB, atomic-penguin: I can't ..."
[2012-02-21 20:44:00 -0500] BryanWB: atomic-penguin, where did u get the '//' ? and for which recipe?
[2012-02-21 20:44:00 -0500] atomic-penguin: ssd7, I was wondering, because it should probably be either treated as ubuntu,debian or redhat,centos distros in case switches
[2012-02-21 20:45:00 -0500] atomic-penguin: BryanWB, "when arch"... in attributes
[2012-02-21 20:46:00 -0500] atomic-penguin: #Line 31
[2012-02-21 20:46:00 -0500] BryanWB: atomic-penguin, oh i c it typo
[2012-02-21 20:46:00 -0500] BryanWB: atomic-penguin, u use arch?
[2012-02-21 20:46:00 -0500] atomic-penguin: nope
[2012-02-21 20:46:00 -0500] BryanWB: ah, u just saw it
[2012-02-21 20:49:00 -0500] BryanWB: i asked this earlier but it doesn't hurt to ask 2x ;), any one know of postgresql9 cookbook?
[2012-02-21 20:49:00 -0500] btm: atomic-penguin, BryanWB, ssd7: Amazon Linux has been moved to the RHEL platform_family club in Ohai: http://tickets.opscode.com/browse/OHAI-331
[2012-02-21 20:49:00 -0500] c_t: ... there's an Amazon Linux now?
[2012-02-21 20:50:00 -0500] BryanWB: btm, sweet, i think i recall that from your extremely informative chef-dev summary :)
[2012-02-21 20:50:00 -0500] spheromak: btm this is good
[2012-02-21 20:51:00 -0500] spheromak: c_t: has been for a long while
[2012-02-21 20:51:00 -0500] c_t: <-- behind the curve
[2012-02-21 20:51:00 -0500] ssd7: My guess is that until we get platform_family out in the wild, we still need to list "amazon" here: https://github.com/opscode/cookbooks/blob/master/java/recipes/openjdk.rb#L26
[2012-02-21 20:53:00 -0500] BryanWB: ssd7, and in attributes/default.rb
[2012-02-21 20:53:00 -0500] spheromak: i have to make provisions for xenserver as well
[2012-02-21 20:53:00 -0500] atomic-penguin: BryanWB, I opened COOK-1051, I'm gonna knock it out
[2012-02-21 20:54:00 -0500] BryanWB: atomic-penguin, awesome, tks
[2012-02-21 20:54:00 -0500] dyer: bueller ? ;)
[2012-02-21 20:57:00 -0500] BryanWB: g'night all
[2012-02-21 21:05:00 -0500] benner: how to get different attributes per node?
[2012-02-21 21:05:00 -0500] benner: i.e. vhost list in different apache nodes?
[2012-02-21 21:21:00 -0500] sivy: anyone using the git resource to pull code from a private repo on bitbucket?
[2012-02-21 21:22:00 -0500] sivy: i'm hitting a wall and my voodoo dancing isn't helping
[2012-02-21 21:22:00 -0500] sivy: i can ssh to bitbucket using a basic `ssh -i /path/to/private_key git@bitbucket.org`
[2012-02-21 21:23:00 -0500] sivy: but i can't clone a repo using `git clone git@bitbucket.org:myusername/therepo.git`
[2012-02-21 21:24:00 -0500] sivy: it asks for a password for the key (which is passwordless)
[2012-02-21 21:25:00 -0500] erikh: sivy: hold on, I have some code for you.
[2012-02-21 21:26:00 -0500] sivy: erikh: great!
[2012-02-21 21:26:00 -0500] sivy: i should mention that i *am* usign an ssh wrapper but it doesn't seem to make a difference
[2012-02-21 21:27:00 -0500] erikh: https://gist.github.com/52b2f841507befee2586
[2012-02-21 21:27:00 -0500] erikh: are you using it with exec like above?
[2012-02-21 21:29:00 -0500] sivy: erikh: hm
[2012-02-21 21:30:00 -0500] sivy: erikh: why action :nothing?
[2012-02-21 21:30:00 -0500] erikh: it's in a provider
[2012-02-21 21:30:00 -0500] erikh: can't show the rest, sorry :)
[2012-02-21 21:31:00 -0500] erikh: you don't need that bit
[2012-02-21 21:31:00 -0500] sivy: the action :nothing bit?
[2012-02-21 21:32:00 -0500] sivy: erikh: GIT_SSH=/var/path/github-ssh-wrapper git clone git@bitbucket.org:me/therepo.git
[2012-02-21 21:32:00 -0500] sivy: that's how i was testing the wrapper
[2012-02-21 21:32:00 -0500] erikh: sure. is it working?
[2012-02-21 21:32:00 -0500] sivy: no :-(
[2012-02-21 21:33:00 -0500] erikh: what does your ssh wrapper look like?
[2012-02-21 21:33:00 -0500] sivy: https://gist.github.com/971205749570027e4184 <-- the template
[2012-02-21 21:34:00 -0500] erikh: I think you want to use exec there, but I'd consult the docs to be sure
[2012-02-21 21:35:00 -0500] leifmadsen: hey all, I'm having an issue trying to install packages via yum (through chef of course). I get the "Verbose <foo> of <package> not found. Did you specify both version and release?", and if I go to the node and manually 'yum install <package>-<version>" then it shows up fine. Same via yum info.
[2012-02-21 21:35:00 -0500] leifmadsen: not sure what to show really :)
[2012-02-21 21:35:00 -0500] sivy: good question: which docs? git's or chef's?
[2012-02-21 21:36:00 -0500] erikh: git's
[2012-02-21 21:36:00 -0500] sivy: ah yeah
[2012-02-21 21:36:00 -0500] erikh: it should be in man git-clone
[2012-02-21 21:36:00 -0500] erikh: or man git-fetch
[2012-02-21 21:41:00 -0500] AntonZ: Hello, can somone please tell me why this possible fails, i got this template from opscode site: https://gist.github.com/1879159
[2012-02-21 21:43:00 -0500] flashmanbahadur: AntonZ: can you give a bit more of the error message?
[2012-02-21 21:43:00 -0500] flashmanbahadur: AntonZ: or part of the stack trace?
[2012-02-21 21:44:00 -0500] AntonZ: one moment
[2012-02-21 21:45:00 -0500] leifmadsen: aha, issue seems to be that the repo is not being added before the package installation for some reason
[2012-02-21 21:45:00 -0500] AntonZ: polease upadte the gist
[2012-02-21 21:46:00 -0500] flashmanbahadur: my guess is that it cannot find the data inside the node
[2012-02-21 21:46:00 -0500] AntonZ: so im following this example: http://wiki.opscode.com/display/chef/Templates
[2012-02-21 21:46:00 -0500] flashmanbahadur: :sudoers_groups is getting assigned an empty array which is blowing up some other function
[2012-02-21 21:46:00 -0500] AntonZ: waht ive done is i added tempalte resource to my own recipe in my own cookbook, and then added tempaltes folder and suoders template
[2012-02-21 21:47:00 -0500] AntonZ: i modified sudoers.rb to my needs
[2012-02-21 21:47:00 -0500] AntonZ: but im not sure if i need to do anything else
[2012-02-21 21:48:00 -0500] flashmanbahadur: try modifying the recipe to print out node[:authorization][:sudo][:groups]
[2012-02-21 21:48:00 -0500] flashmanbahadur: my guess is that is null
[2012-02-21 21:49:00 -0500] AntonZ: im sorry, im not a developer, so ill ask more questions :) - lets say it's null, what do i need to do then? i honestly not sure how to modiry recipe to print out node[:authorization][:sudo][:groups]
[2012-02-21 21:50:00 -0500] flashmanbahadur: ok, np
[2012-02-21 21:50:00 -0500] flashmanbahadur: try adding a line like this
[2012-02-21 21:52:00 -0500] flashmanbahadur: Chef::Log.info("#{@new_resource} Sudo Groups: #{node.authorization.sudo.groups}")
[2012-02-21 21:52:00 -0500] flashmanbahadur: then it should print out during the chef run what is has for that valuie
[2012-02-21 21:53:00 -0500] AntonZ: does that go somehwere at the end of my recipe ?
[2012-02-21 21:53:00 -0500] AntonZ: or has to go insite template section ?
[2012-02-21 21:53:00 -0500] flashmanbahadur: put it before the block that errors
[2012-02-21 21:53:00 -0500] AntonZ: roger that, trying
[2012-02-21 22:02:00 -0500] jdeamattson: Am hitting a problem with a gem install of "fog". Reporting "FATAL: Gem::Installer::ExtensionBuildError: gem_package[fog] (awsclient::default line 22) had an error: Gem::Installer::ExtensionBuildError: ERROR: Failed to build gem native extension.
[2012-02-21 22:02:00 -0500] jdeamattson: " Details in this gist: https://gist.github.com/1879282. Have looked for similar situation, but not finding anything. Any thoughts on it? Ring any bells?
[2012-02-21 22:03:00 -0500] jbz: jdeamattson: Yep, you need to install the libxml2 library using your OS package management system first.
[2012-02-21 22:03:00 -0500] AntonZ: flashman - it failed- https://gist.github.com/1879303
[2012-02-21 22:04:00 -0500] jdeamattson: jbz: before this I have package "libxml2-devel" do
[2012-02-21 22:04:00 -0500] jdeamattson:   action :install
[2012-02-21 22:04:00 -0500] jdeamattson: end, thought this was the right package. Am I missing something?
[2012-02-21 22:05:00 -0500] jbz: jdeamattson: try it.  Manually install libxml2 (not the dev library) first, and see if it still fails.
[2012-02-21 22:05:00 -0500] jdeamattson: Ok.
[2012-02-21 22:05:00 -0500] AntonZ: so the article http://wiki.opscode.com/display/chef/Templates says: his example depends on node attributes that would have to be set elsewhere. where is elsewhere ?
[2012-02-21 22:06:00 -0500] hazzmatt: I am trying to deploy from a specific tag of a specific branch
[2012-02-21 22:06:00 -0500] hazzmatt: should I use deploy_branch?
[2012-02-21 22:06:00 -0500] flashmanbahadur: AntonZ: you can set them almost anywhere, most common is the role files
[2012-02-21 22:06:00 -0500] hazzmatt: if so, do I set branch and revision? o
[2012-02-21 22:06:00 -0500] jbz: AntonZ: Manually on the node, using a role, using an environment
[2012-02-21 22:07:00 -0500] jdeamattson: jbz: Tried that one, and got back the following: https://gist.github.com/1879335
[2012-02-21 22:08:00 -0500] jdeamattson: jbz:  Looks like it is already installed.
[2012-02-21 22:08:00 -0500] AntonZ: a role file would be metadata.json file ?
[2012-02-21 22:08:00 -0500] jdeamattson: jbz: this is for the use of a gem in a recipe.
[2012-02-21 22:08:00 -0500] jbz: jdeamattson: Hm.  Wait, a vague memory about this is surfacing.  Let me check.
[2012-02-21 22:08:00 -0500] jdeamattson: AntonZ: No.
[2012-02-21 22:08:00 -0500] jdeamattson: jbz: Thanks! Appreciate it.
[2012-02-21 22:09:00 -0500] jbz: jdeamattson: Ah.  I think you'll get that error if you're missing a build toolchain, not if you're actually missing libxml2, it's just that nokogiri doesn't know how to deal with the deeper problemare you on amazon linux?
[2012-02-21 22:09:00 -0500] jbz: Try installing libxslt-dev, libxml2-dev and libxml2 and see if that works
[2012-02-21 22:10:00 -0500] jdeamattson: jbz: Am on Amazon Linux. In what order should I install them?
[2012-02-21 22:11:00 -0500] jbz: jdeamattson: I don't think it matters, so long as you get them installed before you try to install fog (which pulls in nokogiri) but try it manually first.
[2012-02-21 22:11:00 -0500] AntonZ: hmmm, so where would i define the node, what role file ?
[2012-02-21 22:11:00 -0500] jbz: I don't think they depend on each other, but I think something depends on all of them and isn't telling you (nokogiri)
[2012-02-21 22:11:00 -0500] jbz: If it works if you install those three manually first, then just stick 'em before the fog install in any order.
[2012-02-21 22:11:00 -0500] dyer: In a cookbook library are you able to reference node attributes?
[2012-02-21 22:12:00 -0500] jbz: dyer:  Yep.
[2012-02-21 22:12:00 -0500] dyer: hrm, node[:cookbook][:value] ?
[2012-02-21 22:12:00 -0500] jbz: dyer: Yes, so long as something set that.
[2012-02-21 22:12:00 -0500] jdeamattson: jbz: Even though libxml2-devl was in the install mix, it wasn't installed when I did my Yum install.
[2012-02-21 22:13:00 -0500] jbz: Just having a cookbook doesn't guarantee the :cookbook namespace exists...
[2012-02-21 22:13:00 -0500] jbz: jdeamattson: Ahhhh
[2012-02-21 22:13:00 -0500] jbz: does it work now though?
[2012-02-21 22:13:00 -0500] AntonZ: generally speak about this sudoers example: http://wiki.opscode.com/display/chef/Templates - why do i need variables there at all ?
[2012-02-21 22:13:00 -0500] jdeamattson: Nor was libxslt-devel.hmmm, but libxml2 was installed.
[2012-02-21 22:13:00 -0500] jbz: AntonZ: You gotta tell the template *which* users and groups get sudo access!
[2012-02-21 22:13:00 -0500] AntonZ: ohhh
[2012-02-21 22:14:00 -0500] AntonZ: i thought i do that in the sudoers.erb
[2012-02-21 22:14:00 -0500] jbz: nonono
[2012-02-21 22:14:00 -0500] jbz: the whole point of the template is to allow you to specify which users/groups at runtime
[2012-02-21 22:14:00 -0500] jbz: the template just needs to know how to write out each entry (formatting).
[2012-02-21 22:14:00 -0500] jdeamattson: Yes, but why weren't they installed by the recipe. See this gist: https://gist.github.com/1879379
[2012-02-21 22:14:00 -0500] dyer: jbz. [Tue, 21 Feb 2012 23:14:27 +0100] FATAL: Chef::Mixin::Template::TemplateError: undefined local variable or method `node' for Prism:Module
[2012-02-21 22:14:00 -0500] dyer: I can call the attibute in shef and its deffinitly set
[2012-02-21 22:14:00 -0500] AntonZ: okay, let me see if i can figure out this role file....
[2012-02-21 22:15:00 -0500] jbz: dyer:  Hm, this is a Ruby thing I don't know the answer to, I think
[2012-02-21 22:16:00 -0500] jbz: I don't really *understand* when to use which method of accessing node data, I cargo-cult it, so I get it wrong a lot
[2012-02-21 22:17:00 -0500] jbz: jdeamattson: Can you gist the whole run output?
[2012-02-21 22:17:00 -0500] jdeamattson: Of the broken run?
[2012-02-21 22:17:00 -0500] jbz: yeah
[2012-02-21 22:17:00 -0500] AntonZ: so it looks like i can stick my node rule file under attributes
[2012-02-21 22:17:00 -0500] jbz: jdeamattson: looking
[2012-02-21 22:17:00 -0500] jdeamattson: jbz: Any thoughts on why they were not installed given the recipe in my gist? https://gist.github.com/1879379
[2012-02-21 22:17:00 -0500] jdeamattson: jbz: Thanks! I greatly appreciate it. You rock!
[2012-02-21 22:18:00 -0500] jbz: AntonZ:  Which?  The users/groups?
[2012-02-21 22:18:00 -0500] AntonZ: yes
[2012-02-21 22:18:00 -0500] jbz: You're going to put it in the attributes file?
[2012-02-21 22:18:00 -0500] jdeamattson: jbz: Almost all of the run - can run again if required - https://gist.github.com/1879406
[2012-02-21 22:18:00 -0500] silk1: IS action :nothing valid for a package resource?
[2012-02-21 22:19:00 -0500] jdeamattson: Running chef-client agin after manually installing those packages..looks good. jbz
[2012-02-21 22:19:00 -0500] AntonZ: looks like i can, i dont know any better :) - my original problem was this- https://gist.github.com/1879159 - we figured that i dont have my variables set anywhere, so i need to define them somwhere
[2012-02-21 22:19:00 -0500] silk: as it is attempting to install it regardless
[2012-02-21 22:19:00 -0500] jbz: AntonZ:  You really shouldn't put them in cookbook attribute roles unless they're defaults that never ever change
[2012-02-21 22:20:00 -0500] jbz: AntonZ: Because if you put your users/groups in there, whenever a user needs to be added you have to version the cookbook.
[2012-02-21 22:20:00 -0500] jbz: And upload a new one.  Which means if you whoops anything, you break convergence on all nodes which use it.
[2012-02-21 22:20:00 -0500] jdeamattson: jbz: Successful run after the manual install....
[2012-02-21 22:20:00 -0500] jdeamattson: jbz: Successful run after the manual install.
[2012-02-21 22:20:00 -0500] jbz: jdeamattson: Hm, that's cool, now why didn't it work...
[2012-02-21 22:21:00 -0500] jbz: are you *positive* the cookbook version on the node is the same as the one on the server?  If you go into /var/cache/chef/cookbooks/ or wherever, does the recipe have the package installs in it?
[2012-02-21 22:21:00 -0500] jdeamattson: jbz: checking
[2012-02-21 22:21:00 -0500] AntonZ: at this time it does not look like it will change.. but i will most certainly listen to your suggestion as to where i should be putting it :)
[2012-02-21 22:22:00 -0500] jdeamattson: jbz: the exact same cookbook.
[2012-02-21 22:22:00 -0500] jbz: AntonZ: :)
[2012-02-21 22:22:00 -0500] jdeamattson: jbz: I can try spinning up another instance and capture all the details.
[2012-02-21 22:24:00 -0500] sascha_d: lazy question: can I cookbook_file a whole directory?
[2012-02-21 22:25:00 -0500] AntonZ: jbz - so any word of advise how should i wrap this up ?
[2012-02-21 22:30:00 -0500] hazzmatt: looking for more info on deploy_revision. can I use it to deploy a 'develop' branch at a specific tag?
[2012-02-21 22:31:00 -0500] jbz: jdeamattson: Huh, because the error says it's running a gem install at line 22 of the awe::client cookbook and in the gist you published, line 22 is the libxslt install
[2012-02-21 22:31:00 -0500] jbz: hazzmatt: Yes.  Are you using git?
[2012-02-21 22:31:00 -0500] hazzmatt: yes
[2012-02-21 22:31:00 -0500] jbz: hazzmat:  tags are unique across branches.
[2012-02-21 22:31:00 -0500] hazzmatt: ah. silly me. I should have known that
[2012-02-21 22:31:00 -0500] hazzmatt: thx jbz
[2012-02-21 22:32:00 -0500] jbz: hazzmatt: most welcome.  Don't worry, this stuff trips me up every. single. day.
[2012-02-21 22:32:00 -0500] jdeamattson: Just had it blow up again. I will try again and make sure that the right cookbook is there.
[2012-02-21 22:32:00 -0500] jbz: AntonZ: one sec
[2012-02-21 22:32:00 -0500] jbz: jdeamattson: plz capture the whole first run log
[2012-02-21 22:32:00 -0500] jdeamattson: Will do....
[2012-02-21 22:32:00 -0500] AntonZ: cheers
[2012-02-21 22:33:00 -0500] jbz: AntonZ: I woluld recommend you populate [:sudo][:authorizations][:users] at the role level
[2012-02-21 22:33:00 -0500] jbz: Or the environment level.
[2012-02-21 22:33:00 -0500] AntonZ: where do i do that? in my default recipe file or elsewhere ?
[2012-02-21 22:33:00 -0500] AntonZ: ill research from there
[2012-02-21 22:34:00 -0500] jbz: AntonZ: No.  Elsewhere.
[2012-02-21 22:34:00 -0500] jbz: AntonZ:  Think of it this way
[2012-02-21 22:34:00 -0500] jbz: AntonZ:  Cookbooks tell chef *how* to set things up.  Attributes (set via role or environment or node) tell it *what* to set up.
[2012-02-21 22:35:00 -0500] jbz: AntonZ:  So for example, you have an environment on your chef server named "production"
[2012-02-21 22:35:00 -0500] jbz: and you can set up that environment to set the  [:sudo][:authorizations][:users] attribute
[2012-02-21 22:35:00 -0500] AntonZ: okay, that makes sense, but i would like to keep all attributes within a cookbook if possible
[2012-02-21 22:35:00 -0500] jbz: AntonZ:  No, you don't.
[2012-02-21 22:35:00 -0500] jbz: AntonZ:  Really.
[2012-02-21 22:35:00 -0500] AntonZ: so i have all my files, etc at one place
[2012-02-21 22:36:00 -0500] jbz: AntonZ:  Cookbooks should be *generic*.  They shouldn't implement *your instance's settings*
[2012-02-21 22:36:00 -0500] jbz: AntonZ:  No.  A chef repository has a directory in it called 'roles', for example, that is *separate* from the 'cookbooks' directory.
[2012-02-21 22:36:00 -0500] jbz: And it has 'environments.'
[2012-02-21 22:36:00 -0500] AntonZ: ah okay, well, that makes sense, but something i havent done yet
[2012-02-21 22:36:00 -0500] sivy: FYI erikh: got that git resource working
[2012-02-21 22:36:00 -0500] jbz: You keep your role and environment files in there, and upload them to the server.
[2012-02-21 22:36:00 -0500] sivy: not entirely sure which thing i changed had the effect
[2012-02-21 22:36:00 -0500] sivy: :)
[2012-02-21 22:37:00 -0500] erikh: sivy: excellent!
[2012-02-21 22:37:00 -0500] erikh: what was it?
[2012-02-21 22:37:00 -0500] erikh: oh I should probably read all the scrollback before I respond
[2012-02-21 22:37:00 -0500] sivy: well, i had the ssh_wrapper commented out in the resource
[2012-02-21 22:37:00 -0500] erikh: oh, ha
[2012-02-21 22:37:00 -0500] sivy: but i had been trying to do it from the CLI to test
[2012-02-21 22:37:00 -0500] jbz: AntonZ: Think of it this way - cookbooks are the programs, and attributes are the inputs.  It's way easier to break your world by changing the program code than by changing your inputs.
[2012-02-21 22:37:00 -0500] sivy: never got that working
[2012-02-21 22:37:00 -0500] sivy: but re-enabling the wrapper in the resource seems to have worked in the actual chef run
[2012-02-21 22:38:00 -0500] jbz: So you want to get the cookbooks working, accepting data via inputs (attributes) and then freeze them.
[2012-02-21 22:38:00 -0500] jbz: Then, when you need to change your setup, you change the *inputs*, not the *programs*.
[2012-02-21 22:38:00 -0500] AntonZ: jbz that was an excellent example! Really! im just worried about implementing this in my environemnt, becasue we dont host chef server, we use RigghtScale to process our cookbooks and i wouldnt know how to upload roles folder to them
[2012-02-21 22:38:00 -0500] jbz: AntonZ:  If you want things to be the same in every node, I'd recommend just setting the _default environment on your chef server or platform org to contain the attributes you want.
[2012-02-21 22:39:00 -0500] jbz: AntonZ:  Ah. Rightscale may not support environments yet.  But they *should* support roles.
[2012-02-21 22:39:00 -0500] AntonZ: yea, i would have to ask their support... another can of worms :)
[2012-02-21 22:40:00 -0500] jbz: AntonZ: I'm not sure, do they still use chef-solo?
[2012-02-21 22:40:00 -0500] jbz: If so, you should still be able to do it - you just push the roles.rb file to the node, i think, and chef-solo will still accept the attributes
[2012-02-21 22:40:00 -0500] AntonZ: no clue - thats what it say when they start thr run process
[2012-02-21 22:40:00 -0500] AntonZ:  Starting Chef Run (Version 0.9.14.4)
[2012-02-21 22:40:00 -0500] jbz: I'm sorry, though, I don't use chef-solo (or Rightscale) much.
[2012-02-21 22:41:00 -0500] jbz: AntonZ:  So do you propagate the cookbooks to the nodes by putting them into the node boot image?
[2012-02-21 22:41:00 -0500] AntonZ: i upload my cokbooks to rightscale and run them from there
[2012-02-21 22:41:00 -0500] mitchellh: Alright, I've ran into this multiple times, so I should finally ask: I have an LWRP. I want to "updated_by_last_action(true)" only if any of the resources within the LWRP ran. Is there a good example of doing this?
[2012-02-21 22:41:00 -0500] mitchellh: let me gist up an example, I guess
[2012-02-21 22:42:00 -0500] jdeamattson: jbz:  Full first run log - https://gist.github.com/1879540
[2012-02-21 22:42:00 -0500] AntonZ: yes, they are part of boot image i guess
[2012-02-21 22:42:00 -0500] jbz: AntonZ:  Upload them where?  To your chef repo?
[2012-02-21 22:42:00 -0500] AntonZ: yes to ym chef repo
[2012-02-21 22:42:00 -0500] AntonZ: my*
[2012-02-21 22:42:00 -0500] AntonZ: we have our own git serverhooked up to RS
[2012-02-21 22:42:00 -0500] mitchellh: Example: https://gist.github.com/31808e78a1ba7c30dbd8
[2012-02-21 22:43:00 -0500] AntonZ: i added my own repo path
[2012-02-21 22:43:00 -0500] jbz: AntonZ:  Ah, then if you put role files in your chef repo, it should propagate those too...
[2012-02-21 22:43:00 -0500] AntonZ: that points to our git server
[2012-02-21 22:43:00 -0500] AntonZ: let me try :)
[2012-02-21 22:43:00 -0500] jbz: jdeamattson: looking
[2012-02-21 22:43:00 -0500] AntonZ: so the roles fodler structure would be - roles -> default.rb or ?
[2012-02-21 22:44:00 -0500] jbz: AntonZ:  I would think so, but I'm not positive.  I'm not sure how (or if) you can tell chef-solo which role to use...
[2012-02-21 22:44:00 -0500] AntonZ: or roles->sudoers.rb
[2012-02-21 22:44:00 -0500] jdeamattson: jbz: and here is the cookbook for the recipe. https://gist.github.com/1879556
[2012-02-21 22:44:00 -0500] AntonZ: so is it better to stick to roles-> default.rb ?
[2012-02-21 22:46:00 -0500] jbz: jdeamattson:  This is wacky.  It looks like it's just skipping your package installs.
[2012-02-21 22:46:00 -0500] jdeamattson: jbz: Here is the install of the two libraries which are in the recipe.
[2012-02-21 22:47:00 -0500] AntonZ: id have to ask, i dont know
[2012-02-21 22:47:00 -0500] jbz: It goes right from something in aws::default (referenced by your include_recipe) to the fog install on line 26
[2012-02-21 22:47:00 -0500] jdeamattson: jbz:  Is this something to do with the ruby gem being side-wise installed? Is it possible that they aren't there yet?
[2012-02-21 22:47:00 -0500] jbz: AntonZ:  Check this: http://wiki.opscode.com/display/chef/Chef+Solo#ChefSolo-Roles
[2012-02-21 22:47:00 -0500] jdeamattson: jbz: That is what I am starting to think. If that is the case, then I could put them in my bootstrap, couldn't I?
[2012-02-21 22:48:00 -0500] jbz: jdeamattson: Well, it's supposed to try to install those things in order.  It shouldn't try to install the fog gem without installing those packages.  I'm confused.
[2012-02-21 22:48:00 -0500] jdeamattson: Doesn
[2012-02-21 22:48:00 -0500] jdeamattson: t
[2012-02-21 22:48:00 -0500] jbz: jdeamattson: You could, certainly, install the packages in the bootstrap, yes, but I'm confused why they're not being installed by your recipe :-)
[2012-02-21 22:49:00 -0500] jdeamattson: jbz: Doesn't a side-wise install step outside of the normal framework? Because you are installing into the running ruby vm instance in order to have the facilities available to you?
[2012-02-21 22:49:00 -0500] jdeamattson: I can imagine that the packages are not there yet?
[2012-02-21 22:49:00 -0500] jbz: OH WAIT
[2012-02-21 22:49:00 -0500] jbz: yes
[2012-02-21 22:49:00 -0500] jbz: you're doing the compile-time trick!
[2012-02-21 22:49:00 -0500] jbz: aren't you?
[2012-02-21 22:49:00 -0500] jdeamattson: Yes, look at the recipe.
[2012-02-21 22:49:00 -0500] jbz: YESSSS
[2012-02-21 22:49:00 -0500] jbz: that's why.
[2012-02-21 22:49:00 -0500] jbz: OK.
[2012-02-21 22:49:00 -0500] jbz: That's the problem. :-P
[2012-02-21 22:49:00 -0500] jdeamattson: jbz: So, I should add this to the bootstrap, shouldn't I?
[2012-02-21 22:50:00 -0500] jbz: So do the same trick
[2012-02-21 22:50:00 -0500] jbz: install those two packages with package.run_action(:install) first
[2012-02-21 22:50:00 -0500] jbz: and it should install *those two* during compile time *also* (prior to the gem)
[2012-02-21 22:50:00 -0500] jdeamattson: Ah, ok!
[2012-02-21 22:50:00 -0500] jbz: Chef respects ordering in recipes within phases
[2012-02-21 22:51:00 -0500] dyer: Hrm, anyone have any idea how to call attributes inside a cookbook library, @node and node dont seem to work
[2012-02-21 22:51:00 -0500] jdeamattson: jbz: I am going to rewrite the AWS and EC2 collection of cookbooks into a single cookbook and do it right to clean up all of these issues.
[2012-02-21 22:51:00 -0500] jbz: jdeamattson:  So you'll need to do yum_package.run_action(:install)
[2012-02-21 22:54:00 -0500] jdeamattson: jbz: So, how does this look? https://gist.github.com/1879612
[2012-02-21 22:54:00 -0500] fujin: be careful using the yum provider in the compile phase, I know I had some trouble with something like that ages ago
[2012-02-21 22:54:00 -0500] fujin: using the damn dpkg provider in compile phase to send run_action, and something hadn't been done yet, so it wouldn't work
[2012-02-21 22:54:00 -0500] fujin: [probably fixed now]
[2012-02-21 22:55:00 -0500] jdeamattson: fujin: Thanks for your input. Yes, am trying to be careful here.
[2012-02-21 22:55:00 -0500] jdeamattson: fujin: if need be, I could work around that by installing the required packages in my bootstrap step, couldn't I?
[2012-02-21 22:57:00 -0500] dyer: I assume its possible, jbz seemed to think so
[2012-02-21 22:58:00 -0500] fujin: sure
[2012-02-21 22:58:00 -0500] fujin: https://gist.github.com/1879618
[2012-02-21 22:59:00 -0500] dyer: Cant seem to get it to work,     if opts[:relay_address] && @node[:prism][:nat_mode] or     if opts[:relay_address] && node[:prism][:nat_mode]
[2012-02-21 22:59:00 -0500] jbz: what fujin said. :-)
[2012-02-21 22:59:00 -0500] jbz: Sorry, work called.
[2012-02-21 22:59:00 -0500] dyer: fujin, that for me ?
[2012-02-21 22:59:00 -0500] miah: moin
[2012-02-21 22:59:00 -0500] fujin: neg
[2012-02-21 22:59:00 -0500] fujin: jdeamattson:  ^
[2012-02-21 22:59:00 -0500] fujin: dyer: what are you trying to do
[2012-02-21 23:00:00 -0500] KarlHungus: if i have an attrribute in a recipe with a default value of an array (path to ssh host keys) and i want to replace it with a different array in a role, how do i do this?
[2012-02-21 23:00:00 -0500] fujin: if opts.has_key? :relay_address and @node.has_key? :prism and @node[:prism].has_key? :nat_mode
[2012-02-21 23:00:00 -0500] KarlHungus: i need to dodge the deep merge
[2012-02-21 23:00:00 -0500] fujin: dyer: ^
[2012-02-21 23:01:00 -0500] jdeamattson: fujin: nice work up of it.
[2012-02-21 23:01:00 -0500] fujin: KarlHungus: there is a "knockout" mode to the deep merge, which is rumoured to be going away because nobody used it
[2012-02-21 23:01:00 -0500] fujin: KarlHungus: let me find how you use it..
[2012-02-21 23:01:00 -0500] KarlHungus: fujin: hmm. i suppose i could set the array as empty in the attributes file, then have the recipe populate it if foo.empty?
[2012-02-21 23:01:00 -0500] KarlHungus: well, i dont want to use it if its going away :P
[2012-02-21 23:02:00 -0500] KarlHungus: fujin: i'm close to having freebsd package mgmt 100% also ;) only took me 4 weeks longer than expected
[2012-02-21 23:02:00 -0500] fujin: lol
[2012-02-21 23:02:00 -0500] fujin: nice
[2012-02-21 23:03:00 -0500] KarlHungus: one more portmaster call to replace with ruby and :install and :update will work without ay deps outside of base
[2012-02-21 23:03:00 -0500] fujin: I think it's !merge:key => [ "val" ]
[2012-02-21 23:03:00 -0500] fujin: to knockout the other vals for key when the merge runs
[2012-02-21 23:03:00 -0500] KarlHungus: ahh. interesting... i will read up
[2012-02-21 23:03:00 -0500] fujin: i don't think i've ever had to do it
[2012-02-21 23:04:00 -0500] fujin: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/deep_merge.rb#L40
[2012-02-21 23:04:00 -0500] KarlHungus: i'm thinking i should refactor around this problem also
[2012-02-21 23:04:00 -0500] fujin: it sounds like a smelly problem
[2012-02-21 23:04:00 -0500] KarlHungus: yeah. so my ssh recipe set a default array of host keys to set in the sshd_config
[2012-02-21 23:05:00 -0500] KarlHungus: and my base role set a different list of keys
[2012-02-21 23:05:00 -0500] KarlHungus: so, i end up with ALL THE KEYS and i dont want that \(-_-)/
[2012-02-21 23:08:00 -0500] jdeamattson: jbz: fujin: Thanks! We fixed it. I appreciate the assistance.
[2012-02-21 23:10:00 -0500] jbz: jdeamattson: Welcome!  Thanks fujin!
[2012-02-21 23:11:00 -0500] dyer: fujin, to be clear I was to use a node's attribute inside a library
[2012-02-21 23:11:00 -0500] fujin: dyer: I responded in the PM you opened
[2012-02-21 23:13:00 -0500] fujin: the 'node' object from the recipe is not magically passed to any old class or module or whatever in a Library
[2012-02-21 23:13:00 -0500] fujin: imagine definine a node method on every damn class every user every created? heresy!
[2012-02-21 23:13:00 -0500] fujin: the humans would moan
[2012-02-21 23:14:00 -0500] dyer: fujin, tyvm
[2012-02-21 23:14:00 -0500] fujin: there might be some ruby magic that allows you to create a binding with a node in it that you call the a random module in the context of, or something, but I don't know it
[2012-02-21 23:14:00 -0500] fujin: [speculatory]
[2012-02-21 23:20:00 -0500] AntonZ: jbz - i read the  article you sent, but it looks like that role file defines only the run list, i need to define variables
[2012-02-21 23:20:00 -0500] AntonZ: oh do i use  "default_attributes": { }, ?
[2012-02-21 23:20:00 -0500] jbz: AntonZ:  Yep!  You put that in the role file.
[2012-02-21 23:21:00 -0500] AntonZ: i wish i could find an example, let me put together a role file for my example and then i'll paste it here to see if i got even close :)
[2012-02-21 23:23:00 -0500] jbz: AntonZ:  There are sample role files which set attributes here: http://wiki.opscode.com/display/chef/Roles#Roles-ManagingRolesthroughKnife
[2012-02-21 23:24:00 -0500] marty: on the opscode runit cookbook is there any documentation/help for setting up a runit_service with the LWRP?
[2012-02-21 23:24:00 -0500] AntonZ: reading
[2012-02-21 23:24:00 -0500] marty: specifically looking at implementing this - https://github.com/cloudant/bucky/blob/master/runit/run
[2012-02-21 23:24:00 -0500] marty: havent really used runit before so excuse me if its obvious
[2012-02-21 23:26:00 -0500] fujin: marty: the runit_service definition expects a few templates in the cookbook where you call it from, namely
[2012-02-21 23:26:00 -0500] fujin: sv-<NAME>-run.erb
[2012-02-21 23:26:00 -0500] fujin: and
[2012-02-21 23:26:00 -0500] fujin: sv-<NAME>-log-run.erb
[2012-02-21 23:26:00 -0500] fujin: (hehee! namely)
[2012-02-21 23:26:00 -0500] fujin: marty: if you plonk those templates in there, whammo! should just work
[2012-02-21 23:26:00 -0500] erikh: WHAMMO
[2012-02-21 23:27:00 -0500] erikh: new chef runsv template! from WHAMMO
[2012-02-21 23:27:00 -0500] marty: thanks a lot! i think thats my issue
[2012-02-21 23:32:00 -0500] AntonZ: so in this example of a role file: default_attributes "apache2" => { "listen_ports" => [ "80", "443" ] } - what is apache2 ? is this the name of the recipe ?
[2012-02-21 23:32:00 -0500] AntonZ: recipe file*-
[2012-02-21 23:33:00 -0500] fujin: no its the apache 2recipe
[2012-02-21 23:33:00 -0500] fujin: node.apache2
[2012-02-21 23:34:00 -0500] fujin: could be setup by the apache cookbook.. could be setup by anything :)
[2012-02-21 23:34:00 -0500] AntonZ: so if i have this : :sudoers_groups => node[:authorization][:sudo][:groups],
[2012-02-21 23:34:00 -0500] AntonZ:     :sudoers_users => node[:authorization][:sudo][:users]
[2012-02-21 23:34:00 -0500] AntonZ: what do i put in the role statement ?
[2012-02-21 23:35:00 -0500] AntonZ: would it be something like this: default_attributes "sudoers" => { "groups" => [ "sysadmin" ] }
[2012-02-21 23:35:00 -0500] AntonZ: sudoers is the name of my recipe file ...
[2012-02-21 23:35:00 -0500] AntonZ: i dnt udnerstand this veyr well
[2012-02-21 23:36:00 -0500] fujin: default_attributes "authorization" => { "sudo" => "groups" => [ "sysadmin" ] } }
[2012-02-21 23:37:00 -0500] fujin: oh missed a f'n {
[2012-02-21 23:37:00 -0500] fujin: default_attributes "authorization" => { "sudo" => { "groups" => [ "sysadmin" ] } }
[2012-02-21 23:37:00 -0500] AntonZ: ooohhh
[2012-02-21 23:37:00 -0500] AntonZ: interesting
[2012-02-21 23:38:00 -0500] AntonZ: cheers for that mate
[2012-02-21 23:39:00 -0500] AntonZ: do i have to define default attribiutes for each variable, meaning that i need to do the same for users ?
[2012-02-21 23:39:00 -0500] AntonZ: the question is do i do it in a single statement or multiple
[2012-02-21 23:40:00 -0500] fujin: attributes?
[2012-02-21 23:40:00 -0500] bawt: attributes is http://wiki.opscode.com/display/chef/Attributes
[2012-02-21 23:40:00 -0500] fujin: go read
[2012-02-21 23:40:00 -0500] fujin: y u no read before try to use ?
[2012-02-21 23:40:00 -0500] AntonZ: reading
[2012-02-21 23:40:00 -0500] fujin: recipes use attribs. attribs can be set in cookbooks, roles, environments
[2012-02-21 23:40:00 -0500] AntonZ: i have 20 tabs opened, trying to put all this together mate
[2012-02-21 23:40:00 -0500] fujin: they have 9 levels of precedence or some shit
[2012-02-21 23:43:00 -0500] marty: ahh shame doesnt work, will keep hacking at it
[2012-02-21 23:44:00 -0500] fujin: what'd you put in the templtes?
[2012-02-21 23:44:00 -0500] fujin: post the debug log of the failure
[2012-02-21 23:49:00 -0500] marty: hold on i think it might be a permission problem on my part, ill keep fooling with it I think its setup right with runit
[2012-02-21 23:52:00 -0500] fujin: marty: the service will log to /etc/<service/log/main/current usually
[2012-02-21 23:52:00 -0500] fujin: unless you supply weird params to svlogdir
[2012-02-21 23:55:00 -0500] marty: thanks for your help.  that file is blank but i think the issue is actually with bucky itself.  i dont have graphite actually installed yet and its its trying to connect and just dies
[2012-02-21 23:55:00 -0500] marty: so normal behaviour
[2012-02-21 23:56:00 -0500] marty: just about to drop the heavy water cookbook on
[2012-02-21 23:56:00 -0500] fujin: ah, funny you should mention that
[2012-02-21 23:56:00 -0500] fujin: look at the commit log :)
[2012-02-21 23:57:00 -0500] fujin: I work at heavywater, graphite cookbook is one of my goodies
[2012-02-21 23:57:00 -0500] fujin: we use collectd + collectd-carbon -> carbon-cache -> graphite <-> graphiti
[2012-02-21 23:58:00 -0500] fujin: i should publish the collectd plugins modifications to the AtariTech stuff
[2012-02-21 23:58:00 -0500] marty: ahhh yeah I was going to use that but im on ubuntu 10.04.1 with collect 4.8.2
[2012-02-21 23:58:00 -0500] marty: and from what I read i need 4.9 to use the python plugin for collectd which most of those seem to use
[2012-02-21 23:58:00 -0500] fujin: yeah :\
[2012-02-21 23:59:00 -0500] marty: could just compile from source but need statsd integration as well, so makes sense to try bucky
[2012-02-21 23:59:00 -0500] fujin: the python one is the highest performing that I tested.
[2012-02-21 23:59:00 -0500] fujin: I run collectd 4.10
[2012-02-21 23:59:00 -0500] fujin: all installations currently running oneiric
[2012-02-21 23:59:00 -0500] fujin: 11.04
