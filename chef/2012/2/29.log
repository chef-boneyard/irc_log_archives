[2012-02-29 08:29:00 -0500] BryanWB_: anyone have an idea why t.base evaluates to nil in my `ivy` resource but has a valid value in the the following ruby_block? in the ruby_block it outputs "/usr/local/tomcat/jira/lib"
[2012-02-29 08:29:00 -0500] BryanWB_: https://gist.github.com/1939159
[2012-02-29 08:34:00 -0500] BryanWB_: i think i c, the variable interpolation happens before the tomcat resource calculates t.base
[2012-02-29 08:41:00 -0500] jespada: BryanWB_, you got it ;), seems to be that indeed
[2012-02-29 08:41:00 -0500] BryanWB_: jespada: fuck, is their elegant way to manage this?
[2012-02-29 08:41:00 -0500] BryanWB_: jespada: buenos dias jorge ;)
[2012-02-29 08:42:00 -0500] BryanWB_: hola desde roma
[2012-02-29 08:42:00 -0500] jespada: hehe Buenos dias.. desde argentina
[2012-02-29 08:44:00 -0500] jespada: BryanWB_, may be with end.run_action :install
[2012-02-29 08:44:00 -0500] jespada: not sure
[2012-02-29 08:47:00 -0500] BryanWB_: jespada: that does the trick, tks
[2012-02-29 08:47:00 -0500] BryanWB_: but using run_action screws up control flow, not sure how maintainable it is
[2012-02-29 08:47:00 -0500] jespada: yeah... I missed the elegant part.. hehe
[2012-02-29 08:48:00 -0500] BryanWB_: jespada: from my experience, using run_action makes it harder to keep track of how resources interact
[2012-02-29 08:49:00 -0500] BryanWB_: i bet jtimberlake has a solution for this
[2012-02-29 08:50:00 -0500] jespada: BryanWB_, true...but I used it in many recipe... jtimberman  is the master, so..
[2012-02-29 08:51:00 -0500] BryanWB_: jespada: but if some lwrps use run_action and others don't, i find that shit gets very unpredictable, my $0.02
[2012-02-29 08:53:00 -0500] jespada: you are right.. I have some crappy cookbooks that need more love, thank you for the heads up
[2012-02-29 08:54:00 -0500] BryanWB_: jespada: ok, here is why that is a bad idea
[2012-02-29 08:55:00 -0500] BryanWB_: the tomcat lwrp relies on the skeleton tomcat being there, creating /usr/local/tomcat
[2012-02-29 08:55:00 -0500] BryanWB_: using run_action cause my tomcat resource to look for /usr/local/tomcat/jira    before /usr/local/tomcat even exists
[2012-02-29 08:57:00 -0500] jespada: hmm.. is not as straight forward as I thought
[2012-02-29 09:06:00 -0500] jespada: BryanWB_, I will learn from the answer of your email , tks ;)
[2012-02-29 09:16:00 -0500] jespada: BryanWB_, btw loved the foodfight podcast, kudos for u lusis  and mattray
[2012-02-29 09:18:00 -0500] danderson: huh, the chef-server debian package pulls in X11 and Qt... What's up with that?
[2012-02-29 09:19:00 -0500] BryanWB_: jespada: tks, makes me feel better a lot of people have complained about audio quality
[2012-02-29 09:19:00 -0500] BryanWB_: danderson: u on ubuntu 11?
[2012-02-29 09:20:00 -0500] danderson: this is Debian squeeze.
[2012-02-29 09:20:00 -0500] danderson: freshly installed, headless machine.
[2012-02-29 09:20:00 -0500] BryanWB_: danderson: fuck don't know, i know ubuntu pulls in suggested
[2012-02-29 09:20:00 -0500] danderson: That's why I'm surprised that the chef server apparently requires a bunch of graphical stuff
[2012-02-29 09:21:00 -0500] BryanWB_: it shouldn't
[2012-02-29 09:21:00 -0500] danderson: yeah, I'm certain this is something in chef-server pulling it in. The debian I start out with is the minimal base system.
[2012-02-29 09:23:00 -0500] danderson: grmbl.
[2012-02-29 09:23:00 -0500] danderson: well, there's something in the dependency graph that pulls in X.
[2012-02-29 09:23:00 -0500] danderson: my kingdom for a dependency analyzer.
[2012-02-29 09:24:00 -0500] BryanWB_: danderson: i feel ur pain, seriously
[2012-02-29 09:24:00 -0500] jespada: danderson, apt-rdepends
[2012-02-29 09:24:00 -0500] BryanWB_: random packages on rhel do this all the time
[2012-02-29 09:24:00 -0500] jespada: install it and play with it
[2012-02-29 09:25:00 -0500] jespada: I have chef server running on debian squeeze
[2012-02-29 09:26:00 -0500] jespada: and indeed have x11 stuff there
[2012-02-29 09:26:00 -0500] danderson: ah, found it
[2012-02-29 09:26:00 -0500] danderson: chef-server-api
[2012-02-29 09:26:00 -0500] BryanWB_: ???
[2012-02-29 09:26:00 -0500] BryanWB_: wtf
[2012-02-29 09:26:00 -0500] danderson: which depends on libgecode for constraint solving
[2012-02-29 09:27:00 -0500] danderson: which depends on libqt (probably using the non-graphical libraries)
[2012-02-29 09:27:00 -0500] danderson: which pulls in a crapload of X11.
[2012-02-29 09:27:00 -0500] jespada: there you go
[2012-02-29 09:27:00 -0500] danderson: time to go cry in a corner about how libqt should be cut up into smaller bits :)
[2012-02-29 09:28:00 -0500] BryanWB_: i always install gecode from source
[2012-02-29 09:28:00 -0500] danderson: anyway, so far so good on the chef install. Compared to the experience of attempting to install a puppetmaster, this bodes well.
[2012-02-29 09:28:00 -0500] BryanWB_: + chef-server does so much more than puppetmaster
[2012-02-29 09:28:00 -0500] jespada: danderson, have you tried omnibus to get chef stuff installed
[2012-02-29 09:30:00 -0500] danderson: oooh, interesting.
[2012-02-29 09:30:00 -0500] danderson: jespada: no, since opscode graciously provides debian packages, I just let it do its thing that way.
[2012-02-29 09:30:00 -0500] danderson: and it Just Worked, which is all I ask at this point :)
[2012-02-29 09:53:00 -0500] proffalken: danderson: heh, sounds like you're in the same boat as me, moving from Puppet to chef...
[2012-02-29 09:54:00 -0500] danderson: proffalken: I actually have nothing right now (exploring options to build out an infrastructure)
[2012-02-29 09:54:00 -0500] danderson: tried puppet, and after a couple of days of banging my head against a wall, gave chef a shot
[2012-02-29 09:54:00 -0500] proffalken: danderson: cool, you've made an excellent decision so far - use puppet or chef... :P
[2012-02-29 09:54:00 -0500] danderson: ... from my experience so far, clearly I should have tried chef first :)
[2012-02-29 09:55:00 -0500] proffalken: danderson: I've worked with CFEngine as well and seen presentations on BCFG2, chef/puppet are far easier
[2012-02-29 09:55:00 -0500] proffalken: danderson: nah, if you hadn't tried puppet, you wouldn't appreciate Chef so much... ;)
[2012-02-29 09:55:00 -0500] danderson: right, puppet is used at my day job
[2012-02-29 09:56:00 -0500] danderson: but chef seems much more friendly for less enterprisey setups
[2012-02-29 09:56:00 -0500] proffalken: Puppet is awesome (please don't kickban me! :P ), it's all I used up until three weeks ago however my current contract is Chef so that's what I'm learning
[2012-02-29 09:56:00 -0500] proffalken: danderson: possibly, yes, although one of the reasons it's being used here is because is scales far better than puppet
[2012-02-29 09:56:00 -0500] danderson: huh, I'd have thought it was the other way round.
[2012-02-29 09:56:00 -0500] danderson: fascinating.
[2012-02-29 09:57:00 -0500] proffalken: puppet always needs some kind of CA, therefore until you have load-balanced CAs (which are a PITA to set up!) puppet doesn't scale too well
[2012-02-29 09:57:00 -0500] danderson: (no particular reason, just superstition)
[2012-02-29 09:57:00 -0500] proffalken: danderson: you always have a SPOF
[2012-02-29 09:57:00 -0500] danderson: yeah, I've done load-balanced CAs before
[2012-02-29 09:57:00 -0500] danderson: it's not impossible, but it's highly annoying
[2012-02-29 10:00:00 -0500] proffalken: danderson: and you need to generate and sign the certificates for each node when they connect, which if you're not using the built-in CA can also be a PITA from what I've heard
[2012-02-29 10:01:00 -0500] proffalken: not too sure if any of these issues occurr in Chef, but it seems to scale beyond a couple of hundred nodes without too many issues...
[2012-02-29 10:05:00 -0500] BryanWB_: i think chef-server will easily go to 1000 w/ nginx or apache in front of it
[2012-02-29 10:06:00 -0500] BryanWB_: chef-solr is the only part that might become resource intensive
[2012-02-29 10:08:00 -0500] danderson: ouch, chef did not appreciate the server re-ip
[2012-02-29 10:09:00 -0500] danderson: clearly I need to give localhost:... addresses during setup, rather than the public addr.
[2012-02-29 10:53:00 -0500] aeris: hello #chef
[2012-02-29 10:54:00 -0500] aeris: i always have a problem with node and role attribute merge
[2012-02-29 10:54:00 -0500] jonlives: proffalken / Bryan we're up to nearly 700 nodes or so, had to add extra workers behind apache, everything else is fine :)
[2012-02-29 10:54:00 -0500] aeris: http://pastebin.com/xVeEhnFC
[2012-02-29 10:55:00 -0500] aeris: here is my conf, but the node apply only node value with chef-client, seems not merged with role
[2012-02-29 10:55:00 -0500] jonlives: aeris: check out the precedence stuff here: http://wiki.opscode.com/display/chef/Attributes#Attributes-Precedence
[2012-02-29 11:00:00 -0500] aeris: jonlives > there is no  attribute from node file  in this precedence list
[2012-02-29 11:00:00 -0500] aeris: i try some precedence combinations, but nothing works
[2012-02-29 11:01:00 -0500] aeris: node continue to apply only node attribute from json and not attributes merged with role
[2012-02-29 11:01:00 -0500] jonlives: aeris: you're setting a normal attribute on the node, which overrides the default attribute you're setting in the role.
[2012-02-29 11:01:00 -0500] aeris: "default" not work
[2012-02-29 11:01:00 -0500] jonlives: you want to put it in the override attributes section of the role.
[2012-02-29 11:04:00 -0500] aeris: no better
[2012-02-29 11:04:00 -0500] aeris: in this case, only role att are apply
[2012-02-29 11:04:00 -0500] jonlives: oh you want to *merge* the attributes
[2012-02-29 11:04:00 -0500] aeris: yes =)
[2012-02-29 11:05:00 -0500] jonlives: i'm not sure how you'd do that.
[2012-02-29 11:06:00 -0500] jonlives: i don't think you even can - the precedence will take the attribute with the highest precedence level and use that, not merge it with things beneath it.
[2012-02-29 11:06:00 -0500] aeris: yes, but in this case, why there is no  default  level on node ?
[2012-02-29 11:07:00 -0500] aeris: this is very annoying, because of just one firewall rule, i have to create a new role just for one node
[2012-02-29 11:07:00 -0500] jonlives: there is, but you need to set it in a recipe
[2012-02-29 11:07:00 -0500] jonlives: 4th from bottom in precedence list: default attributes applied on a node directly in a recipe
[2012-02-29 11:07:00 -0500] aeris: yes in recipe, not in json node file
[2012-02-29 11:08:00 -0500] aeris: json node file only contain normal and override
[2012-02-29 11:08:00 -0500] jonlives: and it doesn't work if you add a default section?
[2012-02-29 11:08:00 -0500] aeris: no, in this case, only role attr are applied
[2012-02-29 11:09:00 -0500] aeris: seems default node attr just ignored
[2012-02-29 11:09:00 -0500] jonlives: well like I said, it won't merge them, and the role's attribute has higher precedence. default node attribs are near the bottom of the precedence list.
[2012-02-29 11:10:00 -0500] jonlives: the list on that page is from low to high.
[2012-02-29 11:10:00 -0500] aeris: yes, the current result seems logical with the precedence list
[2012-02-29 11:10:00 -0500] aeris: just missing  default  node attribute from jsom file :
[2012-02-29 11:14:00 -0500] aeris: strange,  knife show node  seems view default attributes from file
[2012-02-29 11:26:00 -0500] ashb: default node attr doesn't make sense. it either has an attr on the node or it doesn't
[2012-02-29 11:26:00 -0500] ashb: there is no 'default' to override at the node level
[2012-02-29 11:26:00 -0500] bluenemo: ok this might be a stupid question but can i write plain ruby code in a chef recipe/default.rb?
[2012-02-29 11:26:00 -0500] ashb: bluenemo: of course.
[2012-02-29 11:27:00 -0500] bluenemo: ok cool. thx m)
[2012-02-29 11:27:00 -0500] ashb: you need to be careful about when you want it executed
[2012-02-29 11:27:00 -0500] bluenemo: ok
[2012-02-29 11:27:00 -0500] ashb: if you want it executed at 'run time' you need to use the ruby block resource
[2012-02-29 11:27:00 -0500] danderson: so, I'm confused: what does the validation client/cert actually do?
[2012-02-29 11:27:00 -0500] ashb: (i.e. if you want to examine the state of files created by a previous resource etc)
[2012-02-29 11:27:00 -0500] bluenemo: ah ok i see thank you!
[2012-02-29 11:27:00 -0500] danderson: seems like it has to be the same everywhere, and knife bootstrap requires it
[2012-02-29 11:28:00 -0500] danderson: but I don't understand what function it has if all nodes have the same cert.
[2012-02-29 11:28:00 -0500] danderson: (or even in general, come to that)
[2012-02-29 11:28:00 -0500] ashb: danderson: the validation cert is a 'master' cert that can create other nodes/clients
[2012-02-29 11:28:00 -0500] ashb: once the node is bootstrapped it can be deleted from the node
[2012-02-29 11:29:00 -0500] aeris: ashb > i agree  default  is strange on a node
[2012-02-29 11:29:00 -0500] danderson: ah, so it's high privilege. I guess that means I'm bootstrapping from the knife on the chef server, not from my laptop...
[2012-02-29 11:30:00 -0500] danderson: does that make sense as a strategy for using bootstrap?
[2012-02-29 11:30:00 -0500] aeris: but in this case, how i can do a node applying both role attr and  private  attr ?
[2012-02-29 11:30:00 -0500] ashb: aeris: override on the node? that will override attrs set anywhere else i think?
[2012-02-29 11:31:00 -0500] ashb: there are various levels in the doc that was linked to and they are merged 'deeply' (i think) in the order mentioned there
[2012-02-29 11:31:00 -0500] aeris: yes, but in this case, i have to redifine all attributes, even the role ones
[2012-02-29 11:31:00 -0500] aeris: because if i have default attr in role and override attr in node, only node attr are applied
[2012-02-29 11:32:00 -0500] ashb: hmmm that seems counter intuative to what I'd expect
[2012-02-29 11:32:00 -0500] ashb: no idea, sorry
[2012-02-29 11:32:00 -0500] aeris: leading to unmaintainable craft
[2012-02-29 11:36:00 -0500] bluenemo: ok here is my nooby ruby block :) if any of you have a half minute please tell me if this might work out: http://pastebin.com/NQ9Epnbe
[2012-02-29 11:40:00 -0500] ashb: bluenemo: it looks like it will work. a more Chef-y way of doing it would be to 1) use only_if, 2) use a bash block insted of `` in ruby_block
[2012-02-29 11:40:00 -0500] ashb: http://wiki.opscode.com/display/chef/Resources#Resources-ConditionalExecution
[2012-02-29 11:40:00 -0500] ashb: http://wiki.opscode.com/display/chef/Resources#Resources-Script
[2012-02-29 11:41:00 -0500] bluenemo: ok i'll read that thank you. i'm still learning much, automated bash only for a long time so i'm always getting into writing bash somewhere ;)
[2012-02-29 11:42:00 -0500] bluenemo: with bash block you mean script "foobar" do \ interpreter "bash" and so on?
[2012-02-29 11:43:00 -0500] ashb: there is a short cut of bash "name" do \ code <<-EOF
[2012-02-29 11:43:00 -0500] bluenemo: ah cool thx
[2012-02-29 11:43:00 -0500] ashb: see the 'Use bash provider/interpreter to run the same script' example
[2012-02-29 11:48:00 -0500] bluenemo: ah ok perfect. in such things i can also write if while foo loops and so on?
[2012-02-29 12:03:00 -0500] aeris: ashb > i try override node attr with default role attr
[2012-02-29 12:03:00 -0500] aeris: it's worst, attr is not at all apply
[2012-02-29 12:04:00 -0500] aeris: i note something, after each run, override and default node attr are reset to empty
[2012-02-29 12:04:00 -0500] aeris: but not normal ones
[2012-02-29 12:08:00 -0500] aeris: http://pastebin.com/ufztpqhp
[2012-02-29 12:08:00 -0500] aeris: default and override empty after chef-client run
[2012-02-29 12:09:00 -0500] aeris: only normal attribute from json file are kept between run
[2012-02-29 12:10:00 -0500] aeris: better, attributes are reset BEFORE chef-client run : unable to use override or default attributes on recipe
[2012-02-29 12:12:00 -0500] BryanWB_: dammit where's ranjibD when u need him
[2012-02-29 12:50:00 -0500] BryanWB_: is there something like   Object#tap that returns the modified value?
[2012-02-29 12:54:00 -0500] ashb: BryanWB_: what?
[2012-02-29 12:54:00 -0500] BryanWB_: ashb: nevermind, found an easier way
[2012-02-29 12:54:00 -0500] BryanWB_: Object#tap is nice for method chaining
[2012-02-29 12:57:00 -0500] aeris: i don't understand at all how node json file are processed by chef
[2012-02-29 12:57:00 -0500] aeris: seems very complicated and not intuitive
[2012-02-29 12:58:00 -0500] aeris: normal attributes override completely all others attributes (role or recipe), default and override attributes are not persisted and vanished at next run
[2012-02-29 12:59:00 -0500] aeris: i look at the chef code, and seems normal attributes are not processed exactly as others
[2012-02-29 13:13:00 -0500] `brendan: morning folks
[2012-02-29 13:50:00 -0500] BryanWB_: how can i reference the current recipe_name in an lwrp? self.cookbook_name works but not self.recipe_name
[2012-02-29 13:50:00 -0500] BryanWB_: this ruby programming is dark magic
[2012-02-29 14:11:00 -0500] fearoffish: anyone aware of any issues with the opscode platform right now?  I'm trying to manage an organization in my list and it's giving me an error that it doesn't exist when I regenerate the validation key
[2012-02-29 14:11:00 -0500] fearoffish: specifically "Organization not found. (Error 32033)"
[2012-02-29 14:13:00 -0500] fearoffish: found a help file on why, following it
[2012-02-29 14:20:00 -0500] ssd7: Mornin' all
[2012-02-29 14:20:00 -0500] BryanWB_: ssd7: guten tag
[2012-02-29 14:20:00 -0500] BryanWB_: ssd7: i got a question when u get a chance
[2012-02-29 14:21:00 -0500] fearoffish: Top of d'mornin to ya.
[2012-02-29 14:24:00 -0500] ssd7: BryanWB_: What's the question?
[2012-02-29 14:25:00 -0500] BryanWB_: ssd7: having a tough time figuring out how to manage attributes generated in one resource that are used in following resources
[2012-02-29 14:26:00 -0500] BryanWB_: ssd7: so my tomcat LWRP puts a tomcat instance for jira at /usr/local/tomcat/jira/ , following that i unpack a tarball of dependencies to /usr/local/tomcat/jira/lib/
[2012-02-29 14:26:00 -0500] BryanWB_: i want to do this w/out hard-coding paths, so the tomcat cookbook works well on different distros
[2012-02-29 14:28:00 -0500] BryanWB_: so i have resorted to doing this in tomcat LWRP    node[self.cookbook_name]['tomcat']['base'] = "/usr/local/tomcat/jira"
[2012-02-29 14:29:00 -0500] ssd7: BryanWB_: I see.  Just read your mailing list email as well.
[2012-02-29 14:29:00 -0500] BryanWB_: good.  I feel dirty
[2012-02-29 14:31:00 -0500] ssd7: So, to summarize, the problem here is that you are computing an attribute at run_time in the LWRP but want to use its value for a resource attribute in a subsequent resource (which would typically be evaluated at compile time).
[2012-02-29 14:31:00 -0500] BryanWB_: yup
[2012-02-29 14:31:00 -0500] BryanWB_: i got the run_time runaround
[2012-02-29 14:32:00 -0500] ssd7: :)
[2012-02-29 14:33:00 -0500] ssd7: Yeah, this can be a problem occasionally.  I need to take care of a thing or two but I'll see if there is some more obvious way to do it in this case in a few minutes.  If you need to leave just drop a note and I'll respond on the ml if I come up with anything
[2012-02-29 14:33:00 -0500] BryanWB_: tks, i will be around for awhile, harrassing others, esp. atomic-penguin
[2012-02-29 14:49:00 -0500] NicolaSalvo: Hi all
[2012-02-29 14:49:00 -0500] NicolaSalvo: anybody who can help a noob like me?
[2012-02-29 14:51:00 -0500] ssd7: NicolaSalvo: A number of helpful people are usually lurking, what's your question?
[2012-02-29 14:51:00 -0500] NicolaSalvo: it's very silly, but I'm banging my head against the monitor so I'll give it a try
[2012-02-29 14:52:00 -0500] NicolaSalvo: I'm using the rsyslog cookbook to configure a server and client
[2012-02-29 14:52:00 -0500] NicolaSalvo: I've got a role for the server which uses     "recipe[rsyslog::server]"
[2012-02-29 14:57:00 -0500] NicolaSalvo: the documentation suggests to set the server_role attribute (http://www.opscode.com/blog/2009/04/07/chef-cookbook-for-rsyslog/) any idea how to do it?
[2012-02-29 14:59:00 -0500] ssd7: NicolaSalvo: the server_role attribute is in the attribute file in the cookbook: attributes/default.rb
[2012-02-29 15:00:00 -0500] NicolaSalvo: yeah, but I guess I need to do it only for the server not for all nodes isn't it?
[2012-02-29 15:01:00 -0500] NicolaSalvo: in my role I've done:
[2012-02-29 15:01:00 -0500] ssd7: NicolaSalvo: Ah yes, so you could also do it by setting a default or override attribute in your role with the same name.  Check out: http://wiki.opscode.com/display/chef/Attributes#Attributes-RoleAttributes
[2012-02-29 15:01:00 -0500] NicolaSalvo: override_attributes(          "rsyslog" => {                  "server_role" => "true"          })
[2012-02-29 15:02:00 -0500] bluenemo: is it somehow possible to use chef variables in 'script' bash scripts (for example: "#{node['mysql']['server_root_password']}\")
[2012-02-29 15:02:00 -0500] ssd7: NicolaSalvo: ahh, I see
[2012-02-29 15:02:00 -0500] ssd7: NicolaSalvo: sorry, I'm not very familiar with this cookbook
[2012-02-29 15:03:00 -0500] ssd7: just took a quick peak at the resource and it seems that what the attribute does is store the NAME of the role that that the clients should search for when looking for the server
[2012-02-29 15:03:00 -0500] ssd7: so, if your rsyslog server's role is "loghost" you should set that attribute to "loghost" everywhere so your clients can find your server
[2012-02-29 15:04:00 -0500] bluenemo: maybe command '"foo=['foo']['bar']   export foo"' or so..?
[2012-02-29 15:05:00 -0500] NicolaSalvo: oh I see
[2012-02-29 15:05:00 -0500] ssd7: BryanWB_: So, I've thought of /different/ ways to do this.  Not sure they are better though.  I'm not a huge fan of LWRPs changing node attributes.
[2012-02-29 15:05:00 -0500] BryanWB_: understandably
[2012-02-29 15:06:00 -0500] NicolaSalvo: so will it be in my base role?
[2012-02-29 15:06:00 -0500] NicolaSalvo: like: override_attributes("rsyslog" => { "server_role" => "loghost"})
[2012-02-29 15:06:00 -0500] ssd7: NicolaSalvo: Well, since that attribute should be the same for everyone, I would just set it in the cookbook itself and then not set it in any role
[2012-02-29 15:07:00 -0500] BryanWB_: ssd7: i woulnd't put it in cookbook, will make it harder to merge an updated version of the cookbook later
[2012-02-29 15:07:00 -0500] BryanWB_: NicolaSalvo: i would put it in a role, base if u intend it to apply to all your servers
[2012-02-29 15:07:00 -0500] rrichardsr3: \quit
[2012-02-29 15:07:00 -0500] ssd7: BryanWB_: This is a valid concern.
[2012-02-29 15:08:00 -0500] NicolaSalvo: ok I'll give it a try
[2012-02-29 15:08:00 -0500] NicolaSalvo: brb
[2012-02-29 15:09:00 -0500] halfamind-desk: Hi #chef! Is there a current best/recommended method for spawning, bootstrapping and chef-solo-ing new cloud (e.g., EC2) instances? I've used poolparty and custom rake tasks with fog for this in the past, but prefer to use a chef-blessed method like knife. All of the examples I've seen rely on a chef-server, though.
[2012-02-29 15:10:00 -0500] ssd7: BryanWB_: So I /think/ you could have the LWRP set the attribute at complile time which would then mean you could use it a bit more directly in subsequent resources.  Kinda trading one ugliness for another, but at least you decouple that second resource from having to know how to parse the magical attribute
[2012-02-29 15:10:00 -0500] BryanWB_: ssd7: i tried that, causes lots of problems
[2012-02-29 15:11:00 -0500] BryanWB_: ssd7: the tomcat lwrp depends on the tomcat::base recipe running first
[2012-02-29 15:11:00 -0500] BryanWB_: which creates a skeleton to hang tomcat instances on
[2012-02-29 15:11:00 -0500] BryanWB_: ssd7: wait maybe i misunderstood u
[2012-02-29 15:11:00 -0500] ssd7: BryanWB_: Ahh, but I'm talking about something even potentailly grosser than running the tompat resource
[2012-02-29 15:12:00 -0500] ssd7: s/grosser/more gross/
[2012-02-29 15:12:00 -0500] BryanWB_: ssd7: will the code inside the lwrp's initialize run during compile time?
[2012-02-29 15:12:00 -0500] BryanWB_: i could put it there
[2012-02-29 15:12:00 -0500] ssd7: Yeah, code inside the resources's initizlier should run at compile time
[2012-02-29 15:13:00 -0500] mattray: halfamind-desk: there isn't a chef-blessed method for what you're describing with solo
[2012-02-29 15:13:00 -0500] BryanWB_: ssd7: i could try that, any possible pitfalls?
[2012-02-29 15:13:00 -0500] mattray: halfamind-desk: you could probably look into a custom bootstrap script
[2012-02-29 15:14:00 -0500] halfamind-desk: mattray: what do folks prefer these days (or at least, what do they commonly use)? I've used poolparty, spatula, and custom scripts. It's hard to believe everyone's writing the same custom scripts though.
[2012-02-29 15:14:00 -0500] mattray: halfamind-desk: they prefer knife-ec2?
[2012-02-29 15:15:00 -0500] ssd7: BryanWB_: Well, it triggers my "Ewww" instinct, but I've honestly never done it so I'm not sure what you may run into.
[2012-02-29 15:15:00 -0500] mattray: halfamind-desk: a custom bootstrap that uses solo instead of chef-client would work
[2012-02-29 15:16:00 -0500] mattray: halfamind-desk: it's just an odd use case to ask for a box with an API that you're going to track manually
[2012-02-29 15:16:00 -0500] BryanWB_: ssd7: will test it, the issue w/ my current approach is that it requires me to revise several other lwrps to support my wacky `dest_attr` construct
[2012-02-29 15:16:00 -0500] BryanWB_: and of course,  change other coobkook's attrs
[2012-02-29 15:18:00 -0500] ssd7: BryanWB_: Yeah, the advantage I see is that you limit the WTFness to a single LWRP.  I've recently been thinking about a feature that would help for problems like this since it is often a problem.  But I haven't thought it all through yet.
[2012-02-29 15:18:00 -0500] halfamind-desk: mattray: Hmm. Then maybe I'm thinking about it incorrectly. I just want to codify a given environment's configuration in a repo of cookbooks, and be able to re-apply recipes at will. It's not manual per se (e.g., other devs will share the repo and help with management). I just don't see the need to maintain a chef-server backing just one or a few instances.
[2012-02-29 15:18:00 -0500] BryanWB_: ssd7: this is really key to making cookbooks that work across different distros
[2012-02-29 15:20:00 -0500] mattray: halfamind-desk: but you're describing the benefits of chef-server and saying you don't want them. "codify a given environment's config in a repo" => environments and cookbooks on the server. "re-apply recipes at will" knife ssh
[2012-02-29 15:20:00 -0500] mattray: halfamind-desk: with solo, you have to package your cookbooks for every machine and reapply
[2012-02-29 15:21:00 -0500] mattray: halfamind-desk: and if there are any dependencies between the machines, that can't be automated
[2012-02-29 15:22:00 -0500] BryanWB_: ssd7: wait, at compile time, my roles, and node attrs haven't loaded
[2012-02-29 15:24:00 -0500] halfamind-desk: mattray: True about dependenciesI understand the need for chef-server in those cases. My current workflow is to `rake x:spawn` (custom fog-based bootstrapping of ruby and chef), and `rake x:configure` to SCP recipes, and run chef-solo via SSH. It works OK, but the bootstrapping could be generalized (which is why I'd rather move to knife or the like).
[2012-02-29 15:29:00 -0500] mattray: halfamind-desk: it sounds like you're recreating a lot of the functionality of the chef-server manually. At its heart, knife is a tool for dealing with APIs (especially the chef-server, but also the ec2 and other APIs).
[2012-02-29 15:29:00 -0500] mattray: halfamind-desk: you can probably create your own custom bootstrap to work with solo, but I think in the longterm you'd save yourself time and energy using chef-server
[2012-02-29 15:30:00 -0500] ssd7: BryanWB_: Hmm.  I think they should be actually, the actual recipes are the last thing to be loaded in the compile phase.
[2012-02-29 15:30:00 -0500] BryanWB_: ssd7: hmm, experimenting
[2012-02-29 15:33:00 -0500] jonlives: halfamind-desk: you could also look at Opscode platform if you don't wanna run the server yourself.
[2012-02-29 15:36:00 -0500] mattray: yeah, it's free for 5 nodes
[2012-02-29 15:44:00 -0500] halfamind-desk: mattray: Sounds reasonable. Yeah I was wondering if the opscode free/low-end chef-server plans would be a good fit here.
[2012-02-29 16:00:00 -0500] rgsteele: Anybody here using the apt recipe and getting "FATAL: NoMethodError: apt_repository[foo] (foo::default line XX) had an error: undefined method `action_run' for #<Chef::Provider::AptRepository:0x7f6796b81dc0>"?
[2012-02-29 16:01:00 -0500] rgsteele: I followed the README and put recipe[apt] first in my run_list, and copied an apt_repository resource out of the README file (substituting the URI and name for something relevant to my cookbook), but the runs all balk at this 'action_run' method.
[2012-02-29 16:02:00 -0500] rgsteele: I grepped the entire local chef installation for action_run and found nothing, so I'm not sure what it's referring to.
[2012-02-29 16:02:00 -0500] flashmanbahadur: rgsteele: its the default action for the apt provider I think
[2012-02-29 16:02:00 -0500] flashmanbahadur: action :run
[2012-02-29 16:02:00 -0500] flashmanbahadur: style
[2012-02-29 16:03:00 -0500] flashmanbahadur:     end.run_action(:create)
[2012-02-29 16:03:00 -0500] flashmanbahadur:     execute "update package index" do
[2012-02-29 16:03:00 -0500] flashmanbahadur:       command "apt-get update"
[2012-02-29 16:03:00 -0500] flashmanbahadur:       action :nothing
[2012-02-29 16:03:00 -0500] flashmanbahadur:     end.run_action(:run)
[2012-02-29 16:03:00 -0500] flashmanbahadur:     new_resource.updated_by_last_action(true)
[2012-02-29 16:03:00 -0500] flashmanbahadur:   end
[2012-02-29 16:03:00 -0500] flashmanbahadur: end
[2012-02-29 16:03:00 -0500] flashmanbahadur: from the repository.rb provider
[2012-02-29 16:05:00 -0500] rgsteele: flashmanbahadur: Hm... I dunno if this is just a bug, or if the README is lacking a critical detail.
[2012-02-29 16:18:00 -0500] PizzaPill: Hi, quick question: is it possible to access the node['name'] attribute in a role file? I'd like to run the hostname cookbook and set the fqdn of the node to the name shown in chef-server
[2012-02-29 16:20:00 -0500] flashmanbahadur: my guess is it is slightly out of date, run chef-client -l debug
[2012-02-29 16:20:00 -0500] flashmanbahadur: to get more info
[2012-02-29 16:21:00 -0500] BryanWB_: ssd7: tks a lot!
[2012-02-29 16:21:00 -0500] flashmanbahadur: can you make a gist of the block of code that you have added to your cookbook that is throwing the error?
[2012-02-29 16:21:00 -0500] flashmanbahadur: rgsteele:
[2012-02-29 16:22:00 -0500] rgsteele: Sure, hang on a sec.  FYI, I notice if I ssh into the VM and run chef-client manually after the failure during initial provisioning, it works.
[2012-02-29 16:23:00 -0500] atomic-penguin: BryanWB_, did you want something?
[2012-02-29 16:24:00 -0500] BryanWB_: atomic-penguin: resolved, was looking for excuse to bother u
[2012-02-29 16:24:00 -0500] BryanWB_: :)
[2012-02-29 16:24:00 -0500] flashmanbahadur: rgsteele: sounds like a class loading issue
[2012-02-29 16:25:00 -0500] hoover_damm: what's up with rackspace and the nodenames?
[2012-02-29 16:25:00 -0500] hoover_damm: or is it my chefserver?
[2012-02-29 16:25:00 -0500] atomic-penguin: At home sick, so really not paying much attention to the computer
[2012-02-29 16:26:00 -0500] hoover_damm: annoying, the node name is the instance id (200.....) and the fqdn is what I want
[2012-02-29 16:26:00 -0500] hoover_damm: so I have to search to find it
[2012-02-29 16:28:00 -0500] rgsteele: flashmanbahadur: https://gist.github.com/1942250
[2012-02-29 16:29:00 -0500] rgsteele: flashmanbahadur: I added in the 'include_recipe "apt"' as an 'I hope this works' step - the README just says to put it in the run_list, but that didn't work either.
[2012-02-29 16:29:00 -0500] Brad_K: hoover_damm: by default, when you create a new node on rackspace, the instance id is the node name.  i fix that manually by explicitly specifying the node name at the time of creation.
[2012-02-29 16:30:00 -0500] hoover_damm: Brad_K, hrm, we set --server-name bob
[2012-02-29 16:30:00 -0500] hoover_damm: Brad_K, are you doing --node-name as well?
[2012-02-29 16:30:00 -0500] Brad_K: I use both -S and -N arguments, yes.
[2012-02-29 16:31:00 -0500] rgsteele: flashmanbahadur: BTW, line 25 is the first line of the 'apt_repository' block in the recipe
[2012-02-29 16:31:00 -0500] flashmanbahadur: i figured
[2012-02-29 16:32:00 -0500] rgsteele: ;) Just wanted to make sure
[2012-02-29 16:32:00 -0500] hoover_damm: Brad_K, we'll just have to start using -N hen as well
[2012-02-29 16:32:00 -0500] hoover_damm: Brad_K, thanks :)
[2012-02-29 16:32:00 -0500] Brad_K: you're welcome!
[2012-02-29 16:32:00 -0500] hoover_damm: then*
[2012-02-29 16:33:00 -0500] hoover_damm: and then some
[2012-02-29 16:33:00 -0500] flashmanbahadur: rgsteele: looks like the apt repository is returning something of the wrong type, not much debugging code inside the apt repository provider
[2012-02-29 16:33:00 -0500] flashmanbahadur: you can add some with lines like
[2012-02-29 16:33:00 -0500] Urocyon: I have a data bag on my server and I want to write it out to a json file.  Is there a way to knife that?
[2012-02-29 16:33:00 -0500] flashmanbahadur: Chef::Log.debug " #{new_resource} Running foo with #{bar}"
[2012-02-29 16:37:00 -0500] Urocyon: got it -F json
[2012-02-29 16:39:00 -0500] Squarism: im a programmer.. and ive changed a cookbook. How do i "apply" these changes to the machines which has this cookbook?
[2012-02-29 16:39:00 -0500] PizzaPill: Anybody know if its possible to access node[name] in the override_attributes of a role-file somehow?
[2012-02-29 16:41:00 -0500] hoover_damm: Urocyon, -Fj is by default
[2012-02-29 16:41:00 -0500] hoover_damm: {
[2012-02-29 16:41:00 -0500] hoover_damm: "id": "somebag",
[2012-02-29 16:41:00 -0500] hoover_damm: "content": "something"
[2012-02-29 16:41:00 -0500] hoover_damm: }
[2012-02-29 16:42:00 -0500] hoover_damm: always bugs espresso in emacs
[2012-02-29 16:45:00 -0500] toddnine: Hey guys.  I want to create both the node and the client using knife the same way knife ec2 does when bootstrapping nodes.  However I do NOT want to actually start a node.  What's the best way to do this?
[2012-02-29 16:47:00 -0500] Brad_K: Squarism: tell the ops guy to go re-run chef on all those nodes?
[2012-02-29 16:48:00 -0500] Squarism: Brad_K, i think i can do it myself with a little help
[2012-02-29 16:48:00 -0500] rgsteele: flashmanbahadur: Hm... this seems suspicious: Processing execute[install-key XXXXXXX] action nothing
[2012-02-29 16:48:00 -0500] Brad_K: that's assuming you've checked the updated cookbook into your source control and re-uploaded the cookbook to your chef-server.
[2012-02-29 16:48:00 -0500] rgsteele: that should say "action run"
[2012-02-29 16:48:00 -0500] Squarism: its just that i dont know what the common practice is. Do i need to know what nodes to apply changes on - i mean, isnt this listed within the chef ui?
[2012-02-29 16:49:00 -0500] fearoffish: anyone using a test framework to 'bdd' their infrastructure?
[2012-02-29 16:49:00 -0500] Kuckkuck: Hi, did anyone get a working run of the sql_server cookbook via knife ssh or knife winrm  (sql server 2008 r2 enterprise)?
[2012-02-29 16:49:00 -0500] flashmanbahadur: rgsteele: if you look at the end of the block it probably calls run_action at the end
[2012-02-29 16:49:00 -0500] Brad_K: Squarism: if your ops folks have done what we have done here, then the environment you would be affecting will be locked down to specific versions of specific cookbooks, and those cookbooks will have been uploaded with the "freeze" argument so that no one else can re-upload the same cookbook with the same version number.  so, it really does depend on what the specific procedures are at your site.
[2012-02-29 16:49:00 -0500] fearoffish: last time I tried cucumber-chef it was broken and not actively maintained (even though they have a book out for it)
[2012-02-29 16:49:00 -0500] fearoffish: rspec-chef looks almost empty
[2012-02-29 16:50:00 -0500] rgsteele: flashmanbahadur: perhaps, but in looking at the all-knowing Google results, it seems like that log line should be different, e.g.: http://comments.gmane.org/gmane.comp.sysutils.chef.user/2647
[2012-02-29 16:50:00 -0500] fearoffish: vagabond looks not worked on
[2012-02-29 16:50:00 -0500] fearoffish: it makes me believe that people clearly don't want or need to test their infrastructure
[2012-02-29 16:50:00 -0500] fearoffish: thoughts?
[2012-02-29 16:52:00 -0500] Brad_K: Squarism: some sites will even have separate source repositories for the developers versus the operations material, and also separate chef repositories.  so, once your code was uploaded to your source repository and checked (pair programming, or whatever agile/qa methods you use), then it would have to be downloaded by someone who has the access and privileges to do so.
[2012-02-29 16:53:00 -0500] Squarism: ok ok... i asked the ops guy to do it
[2012-02-29 16:53:00 -0500] Brad_K: fearoffish: i'm sure there are people doing testing, but i'm not sure how many of them are using the specific tools you mention.  i seem to recall some recent discussion of minitest.
[2012-02-29 16:53:00 -0500] Brad_K:  and Rspec?
[2012-02-29 16:53:00 -0500] Kuckkuck: Silent installation of microsoft sql_server isn't working via knife winrm or knife ssh, because of security calls (winrm) or gui calls (ssh) or is this wrong?
[2012-02-29 16:53:00 -0500] fearoffish: Brad_K: I'm just surprised that there isn't a decent toolset already out there, that actually works
[2012-02-29 16:54:00 -0500] fearoffish: it makes me think there's a reason
[2012-02-29 16:54:00 -0500] fearoffish: if there isn't, then I'll just have to start one
[2012-02-29 16:54:00 -0500] Brad_K: fearoffish: i think the tools are out there, and i hear that they are getting wider use.  i'm not sure that they are well documented yet, however.
[2012-02-29 16:54:00 -0500] fearoffish: cucumber-chef you mean?
[2012-02-29 16:55:00 -0500] fearoffish: it would have to be a full integration test, because I can't see how running segregated resources would be a real test
[2012-02-29 16:55:00 -0500] fearoffish: so I guess it would be a slow test
[2012-02-29 16:55:00 -0500] Brad_K: no, i'm thinking about minitest and Rspec.
[2012-02-29 16:55:00 -0500] fearoffish: okay, I'll have a hunt for that
[2012-02-29 16:55:00 -0500] fearoffish: thanks
[2012-02-29 16:55:00 -0500] fearoffish: dinner time!
[2012-02-29 16:56:00 -0500] BryanWB_: beer time!
[2012-02-29 16:56:00 -0500] Brad_K: there's over 100 hits on github repositories if you search for "minitest".
[2012-02-29 16:57:00 -0500] Kuckkuck: anyone with cookbook sql_server experience online?
[2012-02-29 17:04:00 -0500] hoover_damm: fearoffish, honestly most of the CI systems that I see don't really appeal to me
[2012-02-29 17:04:00 -0500] hoover_damm: fearoffish, kinda sad
[2012-02-29 17:04:00 -0500] hoover_damm: chef-rspec and cucumber-chef are eh
[2012-02-29 17:04:00 -0500] hoover_damm: minitest I can get on board with kinda, but it seems like the pattern needs to be better to test with
[2012-02-29 17:05:00 -0500] hoover_damm: then the testing paths
[2012-02-29 17:21:00 -0500] Kuckkuck: anyone with cookbook sql_server remote execution experience online?
[2012-02-29 17:22:00 -0500] hoover_damm: Kuckkuck, you may be the first.  You can try the mailing lists for more attention
[2012-02-29 17:22:00 -0500] hoover_damm: that will reach a wider audiance
[2012-02-29 17:22:00 -0500] Kuckkuck: maybe
[2012-02-29 17:23:00 -0500] hoover_damm: bawt, mailing lists?
[2012-02-29 17:23:00 -0500] hoover_damm: bawt, lists?
[2012-02-29 17:23:00 -0500] bawt: lists is http://lists.opscode.com
[2012-02-29 17:23:00 -0500] Kuckkuck: I will have a look, thanks.
[2012-02-29 17:34:00 -0500] jtimberman: bawt: mailing lists is http://lists.opscode.com
[2012-02-29 17:39:00 -0500] plu: let's say I have different recipes deploying different apps. All of them should go to /app/<appname>. Now I have many ways to achieve that: a) make a role "base" which creates the /app folder b) make a cookbook "app-folder", make all cookbooks which install an app depend on that and require it, ...
[2012-02-29 17:40:00 -0500] plu: I'm a bit lost what's the best practice on that
[2012-02-29 17:40:00 -0500] plu: the first 'recipes' should read 'cookbooks' in my first sentence
[2012-02-29 17:54:00 -0500] toddnine: Hey guys.  How do I create both a node and it's client without actually firing up an instance?
[2012-02-29 17:55:00 -0500] ssd7_: toddnine: You can use knife node create and knife client create.  If you are on Hosted Chef, you need to do a bit of extra work to make sure the permissions are correct.
[2012-02-29 17:55:00 -0500] toddnine: We have automated starting an entire environment with knife plugins.  So I want to create all the nodes on the chef server with json and clients, then use our custom scripts to fire up the entire environment
[2012-02-29 17:56:00 -0500] toddnine: ssd7_: Thanks, I'll write a knife plugin to wrap both of those
[2012-02-29 17:59:00 -0500] ssd7_: toddnine: You might also want to check out Spiceweasel: http://wiki.opscode.com/display/chef/Spiceweasel
[2012-02-29 18:21:00 -0500] jbz: ohai chefs.  A question.  When you reference a cookbook using 'include_recipe', does *every* attribute file in the referenced cookbook get loaded?  Or just the default.rb attrib file?  Or just the one which matches the called recipe name?
[2012-02-29 18:22:00 -0500] cap10morgan: inside a resource block, is there a way to execute some ruby and assign the result to a variable at the time everything else runs? eval time is too early.
[2012-02-29 18:23:00 -0500] cap10morgan: or else assign the result of a ruby_block resource to a variable?
[2012-02-29 18:27:00 -0500] jbz:  cap10morgan:  You can have the ruby block stuff its result into an attribute on the node
[2012-02-29 18:27:00 -0500] jbz: that will happen when the block executes, i.e. at execute time.
[2012-02-29 18:27:00 -0500] cap10morgan: jbz: yeah, that's true
[2012-02-29 18:28:00 -0500] jbz: And there is node.run_state
[2012-02-29 18:28:00 -0500] jbz: which is a variable hash specifically used for passing things around during the run, if I understand jtimberman & co correctly.
[2012-02-29 18:29:00 -0500] cap10morgan: oh ok, cool. thanks.
[2012-02-29 18:34:00 -0500] cap10morgan: ok, i'm confused about this. i'm setting the path attribute in a template resource to the value of some node attributes that are set by a recipe i'm including at the top of the one this template resource is in. however, the node attrs are not set when it gets there. it seems like i need to defer reading them until execute time?
[2012-02-29 18:37:00 -0500] jbz: cap10morgan: Check 'The Anatomy of a Chef Run' on the wiki.  If the part or the recipe that you're including is setting that info at execute time and not compile time, then the declaration of the template (which happens at compile time) will fail.
[2012-02-29 18:38:00 -0500] cap10morgan: yeah, so that confirms my suspicions. now i'm curious what the options are for getting around that?
[2012-02-29 18:39:00 -0500] jbz: Wellit's a basic ordering problem.  If you can't set the attribute until information that's available at execute time you can't use the info.  What are you doing to set the attribute?  Does it rely on execute-time info>
[2012-02-29 18:39:00 -0500] jbz: ?
[2012-02-29 18:39:00 -0500] cap10morgan: i'm saying "path node[:key-thats-set-by-the-included-recipe-at-execute-time]"
[2012-02-29 18:40:00 -0500] jbz: right, that won't work
[2012-02-29 18:40:00 -0500] jbz: it wouldn't matter if it was in the same recipe, it still won't work
[2012-02-29 18:40:00 -0500] jbz: so my question is, why does setting that path have to happen at execute time?  What is it depending on?
[2012-02-29 18:41:00 -0500] cap10morgan: it's trying to write a .profile into a user's home dir. the included recipe creates the user (and thus their home dir)
[2012-02-29 18:42:00 -0500] jbz: so it sounds like you need to have compile-time code set up all the various resources you're going to run
[2012-02-29 18:42:00 -0500] jbz: o
[2012-02-29 18:42:00 -0500] jbz: ok
[2012-02-29 18:44:00 -0500] jbz: off the top of my head, I'd say have the profile-writing recipe get its data from the same place the user-creation recipe does, so it knows which users/homedirs it will need to write to
[2012-02-29 18:44:00 -0500] jbz: presumably the info on 'which users' and etc. will be available at the start of run
[2012-02-29 18:46:00 -0500] jbz: Absolute worst case, if the user/homedir is constant, you can just have the profile-writing recipe create the homedir and write the profile, and the usercreation dir do a chmod once it has created the user just in case the homedir already exists
[2012-02-29 18:46:00 -0500] jbz: I mena, do a chown
[2012-02-29 18:47:00 -0500] cap10morgan: jbz: yeah, i could do that. it's just less DRY. instead of asking the node[:etc] hierarchy where the home dir lives, i'd be assuming it will live where i tell it to in the other recipe. which if i ever had to change, there'd be two places to do it.
[2012-02-29 18:47:00 -0500] jbz: Yeah, indeed.  Preferred option is to have something set the node attributes prior to the run, and have both recipes reference that same data.
[2012-02-29 18:48:00 -0500] gondoi: will the begin rescue not work on resources? even if something like t = deploy "blah" is done?
[2012-02-29 18:49:00 -0500] cap10morgan: jbz: if i call a manual node.save first, that will set all those attrs, yeah?
[2012-02-29 18:49:00 -0500] jbz: well
[2012-02-29 18:50:00 -0500] jbz: that will write the current state up to the server
[2012-02-29 18:50:00 -0500] jbz: that won't really make a difference for what you're doing, I don't think
[2012-02-29 18:50:00 -0500] jbz: If you set an attr on the node, it will be readable on the node later in the run without saving
[2012-02-29 18:50:00 -0500] JasonBox: hrm, chef owns me
[2012-02-29 18:50:00 -0500] cap10morgan: right, the homedir won't exist yet. that's the fundamental problem. ok, i think i understand it well enough to figure out a good fix now. thanks, jbz!
[2012-02-29 18:51:00 -0500] jbz: yw!
[2012-02-29 18:52:00 -0500] jbz: cap10morgan: One solution - store the users that have to be created in attributes, either via defaults or via roles, and then have the profile-writing recipe pull the user info from there and include a user-creation recipe which gets the info from the same place.
[2012-02-29 18:52:00 -0500] cap10morgan: jbz: right, and make an explicit home_dir location attr
[2012-02-29 18:52:00 -0500] cap10morgan: good idea
[2012-02-29 18:54:00 -0500] jbz: cap10morgan: Yeahor use databags
[2012-02-29 18:55:00 -0500] jbz: cap10morgan: If this is a common user across a bunch of roles/environments, databags are a better bet, you could have compile-time code in the profile-writing recipe pull the list of user hashes (including their homedirs) and then pass that to the user-writing recipe.  Or write a provider for the user recipe which you can just pass the requisite info to.  Although natch, that's a bunch of work. :-)
[2012-02-29 18:57:00 -0500] cap10morgan: jbz: it's a user that a web app runs as that the web app's recipe creates
[2012-02-29 18:58:00 -0500] jbz: cap10morgan: Ah, OK, so a more DRY solution might be to mod the user-creation recipe you're using to offer a LWRP which accepts parameters and just creates the requisite user.  Then have the web app's recipe call that LWRP.
[2012-02-29 18:58:00 -0500] jbz: And you can re-use the user creation recipe with any other recipe that needs a user.
[2012-02-29 18:59:00 -0500] cap10morgan: how would that help the .profile template resource?
[2012-02-29 19:00:00 -0500] jbz: OK, so the web app recipe presumably knows the info for the user it needs when the run starts, either via default attributes or some other means
[2012-02-29 19:00:00 -0500] cap10morgan: yep
[2012-02-29 19:00:00 -0500] jbz: the web app recipe, prior to writing the profile, calls a LWRP to create the user and includes the requisite user info
[2012-02-29 19:00:00 -0500] jbz: then it declares a template with that same user homedir path
[2012-02-29 19:01:00 -0500] jbz: at execute time, the LWRP will fire first because it comes before the template
[2012-02-29 19:01:00 -0500] jbz: it declares and executes a 'user' resource, and it will create the user and homedir, which will be ready and waiting for the template resource.
[2012-02-29 19:02:00 -0500] jbz: The main 'fix' here is that the web app recipe both calls the user LWRP and sets up the template in that order using the same information.
[2012-02-29 19:02:00 -0500] jbz: The advantage is that the 'user' recipe doesn't have to know or care about figuring out which user to install, it just gets handed that info by the calling recipe, making it eminently reusable.
[2012-02-29 19:03:00 -0500] jbz: And you only have to manage order inside the same web app recipe - so long as you call the user LWRP prior to calling the .profile template, you're good.
[2012-02-29 19:03:00 -0500] jbz: Because both will fire at execute time.
[2012-02-29 19:03:00 -0500] cap10morgan: well, that's the rub, i don't want the profile written in that recipe. i only want that written sometimes from another recipe. it's for changing the PATH that only that other recipe depends on. so i wanted to de-couple them as much as possible.
[2012-02-29 19:03:00 -0500] jbz: Wait, you don't want the profile written in the web app recipe?
[2012-02-29 19:03:00 -0500] z: if I wanted to check :node[platform_version] inside an LWRP (more specifically, inside load_current_resource) how might ya'll suggest I go about that?
[2012-02-29 19:04:00 -0500] cap10morgan: yeah, sorry, it's confusing. the web app recipe is used on lots of nodes. but on some nodes, it needs to run under jruby (but not others)
[2012-02-29 19:04:00 -0500] cap10morgan: so the .profile writer is in the jruby recipe
[2012-02-29 19:04:00 -0500] cap10morgan: and changes the path so that it gets jruby as its ruby
[2012-02-29 19:04:00 -0500] jbz: o
[2012-02-29 19:04:00 -0500] jbz: ok
[2012-02-29 19:05:00 -0500] jbz: so what you need to do then is have the web app recipe *always* call the jruby recipe and have that recipe smart enough to only make the appropriate changes if the environment calls for it?
[2012-02-29 19:05:00 -0500] jbz: Or have the web app recipe check the node its running on to determine if jruby is being used, and if so, *then* call jruby
[2012-02-29 19:06:00 -0500] jbz: and as long as you 'call jruby' by declaring resources, you're still good if you do it after the user creation call.
[2012-02-29 19:06:00 -0500] cap10morgan: hmm, yeah i could do that. i think i'll see how this works first (i.e. assuming the home dir is the app_root attr which is already set)
[2012-02-29 19:19:00 -0500] flashmanbahadur: does anyone know of an example cookbook that has a provider that templates a file where the file is specified in the parent recipe that calls the provider and the template file is stored with the parent recipe?
[2012-02-29 19:26:00 -0500] flashmanbahadur: can a provider determine the cookbook it is called from?
[2012-02-29 19:27:00 -0500] ssd7_: flashmanbahadur: I think the new_resource should have a cookbook_name method on it
[2012-02-29 19:27:00 -0500] flashmanbahadur: ok
[2012-02-29 19:27:00 -0500] flashmanbahadur: thanks
[2012-02-29 19:27:00 -0500] flashmanbahadur: ill check the code
[2012-02-29 19:28:00 -0500] ssd7_: could be wrong though, I haven't checked in a while
[2012-02-29 19:28:00 -0500] flashmanbahadur: new_resource is essentially "self" from python?  just a reference to your current instance?
[2012-02-29 19:29:00 -0500] flashmanbahadur: nice:
[2012-02-29 19:29:00 -0500] flashmanbahadur: def resource_cookbook
[2012-02-29 19:29:00 -0500] flashmanbahadur: @new_resource.cookbook || @new_resource.cookbook_name
[2012-02-29 19:29:00 -0500] flashmanbahadur: end
[2012-02-29 19:29:00 -0500] flashmanbahadur: from chef/provider/template.rb
[2012-02-29 19:39:00 -0500] geekbri: Has anybody had any luck using the opscode mysql cookbook?  This thing just does NOT want to work for me.
[2012-02-29 20:02:00 -0500] cap10morgan: why did the passenger_apache2 cookbook stop creating passenger.load on debian-based distros? this breaks my ubuntu server.
[2012-02-29 20:26:00 -0500] tolland: would it not make sense to disibute cookbooks as gems?
[2012-02-29 20:27:00 -0500] erikh: yfeldblum: you're the librarian maintainer, right?
[2012-02-29 20:27:00 -0500] cap10morgan: oh, i guess it has never created the module.load on debian-based distros. anyone know why that is?
[2012-02-29 20:28:00 -0500] cap10morgan: (apach2 CB, apache_module def)
[2012-02-29 20:29:00 -0500] kevinharvey: I'm getting an error trying install pips. The error is "/usr/local/bin/pip install: error: no such option: --environment"
[2012-02-29 20:30:00 -0500] kevinharvey: I ssh'd in and confirmed with both the global pip and a virtualenv pip
[2012-02-29 20:30:00 -0500] kevinharvey: anyone ever seen that?
[2012-02-29 20:34:00 -0500] kevinharvey: I'm using the python package recipe, and trying to install unicorn (among other things) with python_pip
[2012-02-29 20:39:00 -0500] thehar: there is no 'modprobe' or resoruce, right? only loading kernel modules through execute.
[2012-02-29 20:43:00 -0500] danderson: is there a knife comment to force a chef-client to check in early with the server?
[2012-02-29 20:43:00 -0500] danderson: something like `knife poke client1` I guess
[2012-02-29 20:46:00 -0500] geekbri: danderson: wouldn't it just be knife ssh "*:*" "sudo -E chef-client" -x ubuntu
[2012-02-29 20:46:00 -0500] geekbri: or something simliar
[2012-02-29 20:46:00 -0500] geekbri: (that would force all servers to check in)
[2012-02-29 20:48:00 -0500] danderson: I don't know, that's my question :-)
[2012-02-29 20:48:00 -0500] geekbri: danderson: well the answer is, what I said will work, you just need to filter properly by what servers you want to checkin
[2012-02-29 20:48:00 -0500] geekbri: so you would use something like knife ssh "role:my_server_role" "sudo -E chef-client" -x ubuntu if you wanted all servers with the my_server_role to checkin
[2012-02-29 20:49:00 -0500] geekbri: now thats for ubuntu servers where the ubuntu user has sudo access to chef-client, your mileage may vary if its a different distro, or different setup with ubuntu :)
[2012-02-29 20:51:00 -0500] danderson: right, got it
[2012-02-29 20:51:00 -0500] danderson: thanks!
[2012-02-29 20:52:00 -0500] geekbri: no problemo
[2012-02-29 20:55:00 -0500] kevinharvey: so. the --environment option was removed in pip 1.1
[2012-02-29 20:55:00 -0500] kevinharvey: That's probably going to break a lot of python apps in chef
[2012-02-29 20:56:00 -0500] kevinharvey: since almost every 'python_pip' block I've encountered has a 'virtualenv' argument in it
[2012-02-29 21:06:00 -0500] kevinharvey: I'm going to try pinning the version of pip in python::pip to 1.0.2
[2012-02-29 21:07:00 -0500] jesserobbins: Hey just a reminder - Today is last day to register for #ChefConf at Ultra-earlybird Pricing! http://chefconf.opscode.com/registration/
[2012-02-29 21:09:00 -0500] Brad_K: but at least i'm going to do as best i can to hold up our end in Edinburgh  see <http://www.flossuk.org/Events/Spring2012/Talks>.
[2012-02-29 21:11:00 -0500] z: jesserobbins: How many folks are you expecting at the event, and how many main/side tracks will there be?
[2012-02-29 21:12:00 -0500] jesserobbins: z: 300-500.  3 tracks.
[2012-02-29 21:15:00 -0500] jesserobbins: track 1: internals / deep dive, track 2: use cases, track 3: demos & show+tell
[2012-02-29 21:15:00 -0500] jesserobbins: essentially.
[2012-02-29 21:16:00 -0500] mattray: and booths!
[2012-02-29 21:16:00 -0500] mattray: and maybe BoFs?
[2012-02-29 21:17:00 -0500] z: mattray: am I allowed to petition jesserobbins to alter your job title to 'Booth Babe' given your love of booths?
[2012-02-29 21:17:00 -0500] geekbri: my company can't afford to send me :'(
[2012-02-29 21:17:00 -0500] mattray: z: nobody wants that
[2012-02-29 21:20:00 -0500] jesserobbins: geekbri: is it travel or is it price?
[2012-02-29 21:20:00 -0500] geekbri: jesserobbins: both :)
[2012-02-29 21:20:00 -0500] Brad_K: same  here.
[2012-02-29 21:21:00 -0500] c_t: jesserobbins speaks!
[2012-02-29 21:22:00 -0500] jesserobbins: Unfortunately the per-attendee costs for the event are about $750 or I'd just hand out passes to everyone.
[2012-02-29 21:23:00 -0500] c_t: well, there's ways to bring it down I'm sure
[2012-02-29 21:23:00 -0500] geekbri: Oh I understand that its expensive to run, I just wish my company had the $ to send me :)
[2012-02-29 21:23:00 -0500] c_t: like have the meet-and-greet party be in a train tunnel and serve only malt liquor
[2012-02-29 21:23:00 -0500] jesserobbins: c_t: Innovation!
[2012-02-29 21:23:00 -0500] c_t: Demonstrate to the world that chef users keep it real
[2012-02-29 21:23:00 -0500] geekbri: c_t: moonshine could be cheaper
[2012-02-29 21:24:00 -0500] Brad_K: c_t: is that what they call a "brown bag" lunch?
[2012-02-29 21:24:00 -0500] asg: BYOL,B,D
[2012-02-29 21:24:00 -0500] geekbri: infact BYODC
[2012-02-29 21:24:00 -0500] geekbri: (darn conference)
[2012-02-29 21:25:00 -0500] c_t: I suppose so, Brad_K
[2012-02-29 21:25:00 -0500] c_t: geekbri: to really keep costs down, Sterno is also an option
[2012-02-29 21:25:00 -0500] Brad_K: BYOS?
[2012-02-29 21:26:00 -0500] Brad_K: or maybe just BYO.*$ ?
[2012-02-29 21:26:00 -0500] geekbri: c_t: If we are having it in a train tunnel. drinking the rain water puddles is always an option
[2012-02-29 21:27:00 -0500] Brad_K: so, when you were young and hiding in the trunk of a car, that's what you thought they meant when they said "it's raining"?
[2012-02-29 21:28:00 -0500] Brad_K: uhoh, i guess that was too much for him.  oh, well.
[2012-02-29 21:28:00 -0500] mattray: c_t: there's already a meet-and-greet down at the train tunnel, lots of cheap booze. Not so much tech talk
[2012-02-29 21:28:00 -0500] asg: mattray: you aren't talking 'bout Rails?
[2012-02-29 21:29:00 -0500] mattray: asg: not sure they have a web page either
[2012-02-29 21:29:00 -0500] asg: egads!
[2012-02-29 21:30:00 -0500] Brad_K: well, it might be on Rails, but I don't think it would be Ruby.  Not unless she was taped to the front of the train.
[2012-02-29 21:30:00 -0500] kevinharvey: FYI, pinning pip to version 1.0.2 in python::pip works as a stop gap. Change line 37 of pip.rb to "easy_install pip==1.0.2" to pin it.
[2012-02-29 21:31:00 -0500] z: wonder if the venue is going to have decent WiFi
[2012-02-29 21:31:00 -0500] z: the OpenStack guys have struggled on that front, but I'm told the next one (April) is at a hotel with tons of experience managing large/geek events
[2012-02-29 21:31:00 -0500] asg: z: BYOWiFi ;)
[2012-02-29 21:32:00 -0500] z: asg: Being from the UK the rates for 3G/4G/LTE roaming are absolute extortion
[2012-02-29 21:32:00 -0500] Brad_K: asg: at that level, it's called MiFi.
[2012-02-29 21:32:00 -0500] asg: z: yeah, that sucks
[2012-02-29 21:33:00 -0500] Brad_K: z:  i'm going to be in the reverse position.  how easy is it to buy a data-enabled cell phone with a pay-as-you-go sim?
[2012-02-29 21:33:00 -0500] asg: Brad_K: *nod*
[2012-02-29 21:33:00 -0500] z: asg: and 3G suffers from the same issues. Densely populated areas have more towers, but they're transmitting with lower power, so you still end up with the "Lots of geeks using the same access path" problem because everyone is localised to the same ~1000m2 (in the hotel)
[2012-02-29 21:33:00 -0500] Brad_K: that's why they bring in the portable cell towers on trucks for the big conferences.
[2012-02-29 21:34:00 -0500] z: Likely not a problem for #chefconf but the organisers at bigger events have to worry about it :)
[2012-02-29 21:34:00 -0500] asg: z: I know, we had similar issues with press overload when Obama visited the College I used to work at.
[2012-02-29 21:34:00 -0500] z: As long as my room has a working wired connection to which I can connect an Airport Express, than I won't moan too much, I suppose
[2012-02-29 21:35:00 -0500] c_t: I think it's just the law that wifi at conferences sucks
[2012-02-29 21:35:00 -0500] c_t: I've even noticed this at non-techie conferences
[2012-02-29 21:35:00 -0500] z: mattray: Are the tracks wired up so speakers are on a wired connection?  Fighting with 100+ people for WiFi whilst doing a live demonstration can suck rather hard.
[2012-02-29 21:35:00 -0500] asg: c_t: I think that's so people have to actually talk to each other
[2012-02-29 21:36:00 -0500] mattray: z: I don't know and jesse's ducked out. I expect so, the conference organizers are borrowed from O'Reilly
[2012-02-29 21:36:00 -0500] mattray: I'll verify
[2012-02-29 21:37:00 -0500] z: c_t: That does not need to be the case. Either doing an "on the day" (BYO) setup with Aruba or Ruckus gear can work. Bit expensive.
[2012-02-29 21:38:00 -0500] z: c_t: Otherwise you can get a specialist company in to sort it if you don't trust the hotel. Only big challenge is main tracks with high attendance, then the headcount/devices per square meter can be "fun" to manage. Anything over 10000m2 is easier as that is enough room to reuse channels in 2.4GHz
[2012-02-29 21:40:00 -0500] z: c_t: these days its absolutely essential to have gear which supports band steering, and to have a dude on-site who is monitoring and reacting to issues. Abnormal client loading on a particular AP is /fairly/ common, and getting the clients to disassociate and 'rebalance' over other nearby APs usually involves a dude walking up and pulling the power for ~30 seconds. Low Tech ()
[2012-02-29 22:21:00 -0500] flaccid__: hello everyone. i was just wondering with chef what the de facto cookbook/lwrp etc. would be used for updating a dns record in a zone with a provider such as dme, dyn etc. ?
[2012-02-29 22:28:00 -0500] Brad_K: flaccid: dynect.
[2012-02-29 22:28:00 -0500] Brad_K: we don't have service with them, so i had to hack my own with zerigo.  blech.
[2012-02-29 22:29:00 -0500] mattray: there's a dyn cookbook http://community.opscode.com/cookbooks/dynect
[2012-02-29 22:29:00 -0500] flaccid: thanks guys. i guess these providers don't usually support rfc update anywayz
[2012-02-29 22:29:00 -0500] Brad_K: with zerigo, it's a RESTful API, which we update via curl.
[2012-02-29 22:30:00 -0500] Brad_K: there is support in the Fog library for zerigo, but they don't have a working cookbook that uses that library, so we had to hack our own.
[2012-02-29 22:30:00 -0500] Brad_K: i think dynect uses the Fog library, too.
[2012-02-29 22:33:00 -0500] dc-chef: I have been able to get my first cookbook working, well sort of. It works well when run on on a newly created for the first time. There on out, it fails. And I don't think it's anything to do with the cookbook per se. But it maybe related to Chef.
[2012-02-29 22:34:00 -0500] dc-chef: The program I am trying to install expects FDs 0-2 to be open.
[2012-02-29 22:34:00 -0500] dc-chef: If it finds additional FDs open, it shuts down.
[2012-02-29 22:35:00 -0500] dc-chef: To that end, my question is does the Chef client have FDs open to communicate with the Chef Server?
[2012-02-29 22:35:00 -0500] dc-chef: Has anyone else run into a similar issue?
[2012-02-29 22:37:00 -0500] RoboTeddy: would it be a terrible idea to commit your organization-validator.pem to version control?
[2012-02-29 22:37:00 -0500] Brad_K: dc-chef: i can't say that i have ever heard of this kind of problem before, but i've only been doing chef since September.
[2012-02-29 22:37:00 -0500] RoboTeddy: (I'm not quite sure what it lets someone do)
[2012-02-29 22:38:00 -0500] mrtazz: hey, so I have an execute block in a loop and the not_if clause for execute only seems to be executed for the first iteration
[2012-02-29 22:38:00 -0500] Brad_K: RoboTeddy: yeah, well once it's in version control, that's your private key out there for everyone to see  and maybe change.
[2012-02-29 22:38:00 -0500] z: I saw jtimberman published a DNSimple one
[2012-02-29 22:38:00 -0500] z: http://jtimberman.housepub.org/blog/2012/01/02/switching-to-dnsimple/
[2012-02-29 22:38:00 -0500] z: and I use DNSimple and would *highly* recommend them. Utterly awesome customer support.
[2012-02-29 22:38:00 -0500] RoboTeddy: Brad_K: it'd be a private repository on github, but that's still not the most secure place
[2012-02-29 22:39:00 -0500] RoboTeddy: Brad_K: if someone malicious had the validator private key, would that be a disaster?
[2012-02-29 22:39:00 -0500] Brad_K: personally, i don't want any kind of pem file committed to version control, anywhere.  at least, not in any form that is unencrypted.
[2012-02-29 22:39:00 -0500] mrtazz: Is chef doing any optimization on that, so that this does make sense?
[2012-02-29 22:40:00 -0500] Brad_K: RoboTeddy: basically, i think they could bork your entire chef environment  full read and write access to everything that key has access to.
[2012-02-29 22:40:00 -0500] mattray: RoboTeddy: you can always revoke the validator.pem
[2012-02-29 22:40:00 -0500] mattray: and only use encrypted data bags to hold stuff
[2012-02-29 22:40:00 -0500] mattray: SSH only done with keys, no unencrypted creds in chef
[2012-02-29 22:40:00 -0500] Brad_K: and only check the encrypted json version of the data bag contents into source control.
[2012-02-29 22:41:00 -0500] z: for security-conscious implementations you could also look at chef-solo
[2012-02-29 22:41:00 -0500] z: gets rid of the chef-server component entirely. does mean you lose Search and some other stuff.
[2012-02-29 22:42:00 -0500] z: and instead of 'security-conscious' you could replace that with 'tin foil hat' implementations, since there are ways/means to make the usual client/server setup pretty secure too :)
[2012-02-29 22:42:00 -0500] RoboTeddy: :D gotcha, thanks guys
[2012-02-29 22:43:00 -0500] RoboTeddy: I guess the last question then is: what does organization-validator have permission to do by default?
[2012-02-29 22:43:00 -0500] Brad_K: iirc, that's the root key from which all other permissions are derived.
[2012-02-29 22:43:00 -0500] RoboTeddy: I'm looking at the acl page for it on the opscode management page, but it's not quite clear to me
[2012-02-29 22:44:00 -0500] RoboTeddy: Brad_K: gotcha, so, I guess it lets you do anything then. thanks
[2012-02-29 22:45:00 -0500] AntonZ: Hello, what does this mean: https://gist.github.com/1895560
[2012-02-29 22:45:00 -0500] Brad_K: IMO, you want to make sure that your .gitignore and .svnignore files are set up to ignore all .pem files.  that solves the problem of the keys ever getting checked into version control.
[2012-02-29 22:45:00 -0500] AntonZ: what cookbook is it looking for ?
[2012-02-29 22:46:00 -0500] RoboTeddy: Brad_K: right, I'll do that, but then I need to find another way to distribute keys around to developers
[2012-02-29 22:47:00 -0500] RoboTeddy: Brad_K: thanks for the advice
[2012-02-29 22:47:00 -0500] Brad_K: so, here's a different question for you  i've got a template file that needs to iterate on a selection of hostnames, and i was trying to use this logic:
[2012-02-29 22:47:00 -0500] Brad_K: <% %w( @hosts ).each do |host| -%>
[2012-02-29 22:47:00 -0500] Brad_K: However, passing @hosts in from the recipe doesn't seem to work in this context.  I'm obviously missing something here  how do i build an array of strings that can be passed into a template file and then fed into a %w type iterator?
[2012-02-29 22:48:00 -0500] RoboTeddy: @hosts is probably already an array, so you can probably just go <% @hosts.each do |host| %>
[2012-02-29 22:48:00 -0500] Brad_K: RoboTeddy: for us, we have each user generate their own keys when they create their account in the webui, and then it's up to them to make sure that their user keys never get checked into version control.
[2012-02-29 22:49:00 -0500] RoboTeddy: %w(hello goodbye) is just shorthand for turning a comma-separated list of words into a list, e.g. > ["hello", "goodbye"]
[2012-02-29 22:49:00 -0500] RoboTeddy: and lists have a .each method you can use to iterate over their elements
[2012-02-29 22:50:00 -0500] Brad_K: RoboTeddy: thanks!  giving that a try now.
[2012-02-29 22:50:00 -0500] Brad_K: syntax-wise, it's looking plausible.  let's see what actually gets templated out.
[2012-02-29 22:51:00 -0500] RoboTeddy: so you can use individual user accounts for validator_client_name instead of orname-validator?
[2012-02-29 22:51:00 -0500] Brad_K: hmm.  no, but that didn't work, but i think i am a step closer and this now gives something of an idea of how to fix what i now have.
[2012-02-29 22:52:00 -0500] RoboTeddy: Brad_K: if you put  the template resource and the template file up on a paste bin I can probably help you out
[2012-02-29 22:52:00 -0500] Brad_K: RoboTeddy: yeah, in the knife.rb that each person has, we specify the following:
[2012-02-29 22:52:00 -0500] Brad_K: client_key "#{File.dirname(__FILE__)}/#{user}.pem"
[2012-02-29 22:53:00 -0500] Brad_K: earlier in the file, we define:
[2012-02-29 22:53:00 -0500] Brad_K: user = ENV['OPSCODE_USER'] || ENV['USER']
[2012-02-29 22:53:00 -0500] RoboTeddy: Brad_K: gotcha, cooool. thank you.
[2012-02-29 22:53:00 -0500] RoboTeddy: I wish these sorts of practices were all listed somewhere
[2012-02-29 22:53:00 -0500] Brad_K: there's a fully commented knife.rb out there somewhere.  let me see if i can dig up an url.
[2012-02-29 22:54:00 -0500] RoboTeddy: it feels like there are 30 different things each person has to figure out when they start using chef
[2012-02-29 22:54:00 -0500] Brad_K: yeah, i copied this from a gist that jtimberman had done, and which had been listed in the wiki.  then the wiki got changed, and the link to this gist got lost.  try https://gist.github.com/7837dcd970ff2459ceff
[2012-02-29 22:55:00 -0500] Brad_K: lots of good stuff in there.
[2012-02-29 22:55:00 -0500] Brad_K: yeah, we try to document best practices in the wiki, but sometimes things get changed on us....
[2012-02-29 22:56:00 -0500] RoboTeddy: I guess I'd rather have chef change and improve than not
[2012-02-29 22:56:00 -0500] AntonZ: hey guys, anyone can tell me why the run fails there https://gist.github.com/1895560
[2012-02-29 22:57:00 -0500] AntonZ: i just started with this cookbook, so it will be a learning curve...
[2012-02-29 22:58:00 -0500] Brad_K: AntonZ: did you do a "knife cookbook upload yum"?
[2012-02-29 23:00:00 -0500] AntonZ: probably not as i dont know what it is... i install my cookbooks via rightScale, which i was told is something like chef-solo
[2012-02-29 23:02:00 -0500] caryp: AntonZ: looks like your cookbook depends on the 'yum' cookbook.  Be sure to add depends "yum" into your metadata
[2012-02-29 23:02:00 -0500] Brad_K: yum is a cookbook that is used to tell chef how to install packages on RHEL-based systems, what repos to use, etc.  if you didn't upload it, then i would guess that it doesn't exist in your environment.  you'd need to talk to people who know more about RightScale than i do, however.  that's a separate product/service, although it is based on an ancient version of chef.  i'm told it has some similarities to the Hosted Chef service that opscode runs.
[2012-02-29 23:04:00 -0500] caryp: yeah it is running chef-solo (v0.9) but the cookbooks are pushed to the edge just like in chef-client, so you have to get your depends right
[2012-02-29 23:05:00 -0500] AntonZ: i wish the jenkins cookbook told me all dependenices it requires :)
[2012-02-29 23:05:00 -0500] AntonZ: so far i figured it relies on yum as you said and then java next
[2012-02-29 23:06:00 -0500] AntonZ: so there are two yum cookbooks yum and yumrepo, which one do i need
[2012-02-29 23:06:00 -0500] Brad_K: you need yum, not yumrepo.
[2012-02-29 23:06:00 -0500] AntonZ: roger that, thank you
[2012-02-29 23:07:00 -0500] Brad_K: yumrepo is what you would use if you had additional repos that you wanted to easily define and have your clients use.
[2012-02-29 23:07:00 -0500] Brad_K: we use yumrepo for some of our stuff.
[2012-02-29 23:08:00 -0500] AntonZ: sounds useful for sure!
[2012-02-29 23:09:00 -0500] Brad_K: i think the plan is to modify the yum cookbook so that yumrepo isn't needed any more, and then yumrepo will go away.  but in your case, i wouldn't worry about it either way.
[2012-02-29 23:10:00 -0500] AntonZ: cool, ading yum cookbook in front of jenkins one, see how it goes this time
[2012-02-29 23:14:00 -0500] tolland: i have some instances that a previous person had done some bash script that created loads of duplicate rows. I can repair it using augeas from the command line, but is there something similar in terms of a resource?
[2012-02-29 23:14:00 -0500] tolland: (in the sudoers file)
[2012-02-29 23:15:00 -0500] Brad_K: tolland: uniq?
[2012-02-29 23:16:00 -0500] flashmanbahadur: tolland: why not jsut template the file
[2012-02-29 23:16:00 -0500] Brad_K: that's a better idea.
[2012-02-29 23:19:00 -0500] tolland: Brad_K: yeah sure I can fix it. but I am thinking more generally for fixing some attribute
[2012-02-29 23:19:00 -0500] tolland: for example i can ship a template /etc/sudoers and write it out to my liking, but often I just want to make sure some attribute is set to some thing
[2012-02-29 23:19:00 -0500] tolland: for example I just want to ensure the wheel group is set for NOPASSWD
[2012-02-29 23:20:00 -0500] tolland: not to managed the whole file, and mangle and custom local changes
[2012-02-29 23:20:00 -0500] tolland: sudoers is probably ok, because it doesn't require restarting a service. I can just sed that line out
[2012-02-29 23:21:00 -0500] tolland: Damn. I cannot type today.
[2012-02-29 23:21:00 -0500] tolland: I guess I am saying that I would like a resource for managing some particular settings, rather than have to blatt the whole config file with a template.
[2012-02-29 23:23:00 -0500] JasonBox: tolland: hrm, there's Util::FileEdit, which will let you replace lines or words on lines
[2012-02-29 23:23:00 -0500] tolland: ok, I see that Adam Jacob mentions augeas in an interview in 2009, http://akitaonrails.com/2009/11/18/chatting-with-adam-jacob
[2012-02-29 23:24:00 -0500] JasonBox: Chef::Util::FileEdit
[2012-02-29 23:25:00 -0500] tolland: is that policy the still the case now, ie write a custom provider, or dont support the local changes ant-pattern?
[2012-02-29 23:33:00 -0500] Brad_K: yes, Chef::Util::FileEdit exists.  but my understanding is that actually using it is generally considered an anti-pattern.
[2012-02-29 23:34:00 -0500] Brad_K: but, we're ops guys.  or at least devops.  and sometimes we have to do what is practical, not what theory says we should do.
[2012-02-29 23:37:00 -0500] Twirrim: it's fine to be anti-pattern, and go against theory, as long as it's not a gut reaction to a situation :)
[2012-02-29 23:48:00 -0500] tolland: JasonBox: cheers, looks like FileEdit will do the trick
[2012-02-29 23:50:00 -0500] AntonZ: BradK, so got a new one https://gist.github.com/1895560
[2012-02-29 23:51:00 -0500] AntonZ: i dont see where do i need to specify apache2 cookbook, or this is another dependency that i install prior just like yum ?
