[2012-02-12 14:15:00 -0500] aeris: hello #chef
[2012-02-12 14:15:00 -0500] aeris: what can be the best way to manage one-server-only and very sensitive files with chef ?
[2012-02-12 14:16:00 -0500] aeris: in my case x509 certificates and private keys
[2012-02-12 14:16:00 -0500] aeris: for vpn and ssl www
[2012-02-12 15:36:00 -0500] ashc: is there a way to control the order in which recipes are applied to my VM? or at least a way to run an apt-get update on the VM before attempting to install the recipes?
[2012-02-12 15:36:00 -0500] ashc: trying to install postgres using recipe but it needs an apt-get update to find it
[2012-02-12 15:49:00 -0500] bluenemo: is there any kind of dependency management for 'knife cookbook site foobar' yet?
[2012-02-12 15:49:00 -0500] bluenemo: s/y/j
[2012-02-12 15:56:00 -0500] asg: ashc: use the 'apt' cookbook and put it early in your runlist
[2012-02-12 16:04:00 -0500] aeris: is there any way to reference other node attribute when defining role attribute ?
[2012-02-12 16:04:00 -0500] aeris: something like that
[2012-02-12 16:04:00 -0500] aeris: default_attributes( :firewall => { :rules => [ { :protocol => node[:openvpn][:proto], :dst_port => node[:openvpn][:port] } ] })
[2012-02-12 16:05:00 -0500] BryanWB: how can i access the a templates name attribute inside the .erb ?
[2012-02-12 16:05:00 -0500] BryanWB: aeris, no
[2012-02-12 16:06:00 -0500] aeris: =(
[2012-02-12 16:06:00 -0500] BryanWB: roles are compiled into json when u upload them, they aren't dynamic
[2012-02-12 16:08:00 -0500] ashc: asg: that is what I have, but no luck - see output and run_list here http://dpaste.com/701995/
[2012-02-12 16:17:00 -0500] asg: ashc: hmmm, is that using a ppa or non-standard repo? My I only see 8.4.3 available in 10.04
[2012-02-12 16:18:00 -0500] asg: ashc: and 8.4.9 from security updates
[2012-02-12 16:19:00 -0500] asg: ashc: sorry I've got to go but good luck
[2012-02-12 16:54:00 -0500] BryanWB: how can i access the name of my template inside the erb?
[2012-02-12 17:09:00 -0500] ashc: this seems to have solved my problem - http://tickets.opscode.com/browse/COOK-1011
[2012-02-12 17:18:00 -0500] aeris: what can be the best way to manage one-server-only and very sensitive files with chef ?
[2012-02-12 17:18:00 -0500] aeris: in my case x509 certificates and private keys for ssl and vpn
[2012-02-12 17:38:00 -0500] jgoulah: aeris: encrypted data bags are one way
[2012-02-12 17:38:00 -0500] aeris: it is possible to fetch file from databag ?
[2012-02-12 17:39:00 -0500] aeris: encryption is not necessary in my case
[2012-02-12 17:39:00 -0500] aeris: just at this time file are embedded in cookbook files, so distributed =(
[2012-02-12 17:39:00 -0500] aeris: but if i can store those file on db, it's better =)
[2012-02-12 17:43:00 -0500] kallistec: aeris: what kind of db?
[2012-02-12 17:43:00 -0500] aeris: databag
[2012-02-12 17:43:00 -0500] aeris: not database :
[2012-02-12 17:44:00 -0500] kallistec: are you using a chef server already?
[2012-02-12 17:44:00 -0500] aeris: hosted for the moment
[2012-02-12 17:44:00 -0500] aeris: test purpose
[2012-02-12 17:44:00 -0500] kallistec: yeah, so encrypted data bags will work
[2012-02-12 17:44:00 -0500] aeris: but production will be on chef server
[2012-02-12 17:45:00 -0500] kallistec: you have to managed the distribution of the encryption keys for the data bag yourself
[2012-02-12 17:45:00 -0500] kallistec: since it's symmetric encryption
[2012-02-12 17:45:00 -0500] aeris: encryption is not necessary in my case
[2012-02-12 17:45:00 -0500] aeris: just i don't want distribute such file with cookbook
[2012-02-12 17:46:00 -0500] kallistec: well, you could put the key in a regular data bag, but then other chef clients will be able to see it
[2012-02-12 17:46:00 -0500] kallistec: on hosted chef, you can tweak the ACLs
[2012-02-12 17:47:00 -0500] aeris: all chef clients are under my control, so no problem of leak =)
[2012-02-12 17:47:00 -0500] aeris: (without comprommission :
[2012-02-12 17:48:00 -0500] kallistec: yeah, then something like a "secrets" data bag would work fine
[2012-02-12 17:48:00 -0500] aeris: yep
[2012-02-12 17:48:00 -0500] aeris: or "pki" in my case :
[2012-02-12 17:49:00 -0500] kallistec: we keep most of our data bags as files in version control, but we have a "secrets" data bag that we manage manually and don't commit to git
[2012-02-12 17:50:00 -0500] JasonBox: Yeah
[2012-02-12 18:13:00 -0500] aeris: seems "file" resource doesn't look on files/nodename, only on files/default, files/debian and files/debian-6.0.3 in my case
[2012-02-12 18:13:00 -0500] aeris: is it normal ?
[2012-02-12 18:14:00 -0500] maek: aeris: as far as I understand yes. You can only do default or platfrom dirs for file
[2012-02-12 18:15:00 -0500] aeris: =(
[2012-02-12 18:15:00 -0500] maek: aeris: you could do source "foo-#{node[:hostname]} maybe but that seems dirty
[2012-02-12 18:15:00 -0500] maek: why have a specific file for a single hostname?
[2012-02-12 18:16:00 -0500] aeris: maek > x509 certificate :
[2012-02-12 18:16:00 -0500] aeris: http://wiki.opscode.com/display/chef/File+Distribution
[2012-02-12 18:16:00 -0500] aeris: but on this doc, seems nodename is search
[2012-02-12 18:17:00 -0500] maek: oh it says it should work for host
[2012-02-12 18:17:00 -0500] maek: are you sure they all match up?
[2012-02-12 18:17:00 -0500] aeris: oh, i missed the host- ><
[2012-02-12 18:20:00 -0500] aeris: but seems not work too
[2012-02-12 18:20:00 -0500] maek: hostname -f matched the dir you have under the file dir?
[2012-02-12 18:20:00 -0500] aeris: this is good
[2012-02-12 18:21:00 -0500] aeris: knife doesn't handle symbolic link ><
[2012-02-12 18:21:00 -0500] aeris: ln -s host-prod host-test, this is not working
[2012-02-12 18:21:00 -0500] aeris: cp -r host-prod host-test is better :
[2012-02-12 18:40:00 -0500] bluenemo: hi guys, this wont remove the htop recipe from the runlist, what am i doing wrong?   knife node run_list remove nemo-laptop htop
[2012-02-12 18:43:00 -0500] aeris: knife node run_list remove nemo-laptop 'recipe[htop]'
[2012-02-12 18:43:00 -0500] bluenemo: ah ok thank you!
[2012-02-12 19:00:00 -0500] ssd7: Ohai Chefs
[2012-02-12 19:00:00 -0500] renchap: idem/win 56
[2012-02-12 19:00:00 -0500] renchap: oops
[2012-02-12 19:46:00 -0500] bluenemo: does anyone have a recipe script which makes extensive use of copying files (and folders)? i cant find good examples for it. i managed to copy a file so far, but not yet whole folders (recursively)
[2012-02-12 19:46:00 -0500] bluenemo: (getting files from cookbook_name/files)
[2012-02-12 19:47:00 -0500] maek: tar?
[2012-02-12 19:53:00 -0500] bluenemo: ah you mean packing them, moving the tar over to the machine and then giving a command in the recipe that untars and moves the files to the according position maek?
[2012-02-12 19:56:00 -0500] maek: bluenemo: yes
[2012-02-12 19:56:00 -0500] maek: maybe you can do something like source "foo/*.*" im not sure. when I have to move more then a few files I do a tar
[2012-02-12 19:56:00 -0500] bluenemo: tar is the perfect idea thank you!
[2012-02-12 19:58:00 -0500] maek: bluenemo: welcome, gl.
[2012-02-12 20:09:00 -0500] tolland: i have a cookbook for an app kontrollbase that needs an ssh key setup for its service account which needs to be added to the users data bag
[2012-02-12 20:10:00 -0500] tolland: so if i create the ssh keys and add them to the data bag, no problemo. but then I am sending the private key out
[2012-02-12 20:10:00 -0500] tolland: obviously I can step to an encrypted data bag, but it would seem sensible to create the key on the server cookboko, but the recipe
[2012-02-12 20:11:00 -0500] tolland: cant write a new data bag item
[2012-02-12 20:11:00 -0500] tolland: or am I doing this wrong?
[2012-02-12 20:15:00 -0500] andreacampi: hi fellow chef people. in NYC for a few days, anybody up for beers tonight?
[2012-02-12 20:17:00 -0500] tolland: ok i got I make the server an admin?
[2012-02-12 20:22:00 -0500] tolland: next time you are in London... ;-)
[2012-02-12 20:26:00 -0500] andreacampi: tolland: sure :)
[2012-02-12 20:26:00 -0500] andreacampi: tolland: yeah, your node would need to be an admin in order to manipulate data bags
[2012-02-12 20:27:00 -0500] andreacampi: call me paranoid, but I would never do that
[2012-02-12 20:28:00 -0500] andreacampi: either use an encrypted data bag
[2012-02-12 20:29:00 -0500] andreacampi: or have the server fetch the private key via http with a remote_file
[2012-02-12 20:30:00 -0500] tolland: andreacampi: if i make the server an admin, then the private key remains local
[2012-02-12 20:31:00 -0500] tolland: because i then use the admin privilege to write the pubkey to the users data bag
[2012-02-12 20:32:00 -0500] tolland: the server is going to have a key for all the clients anyway, so its not like its not already a weak point in the security model
[2012-02-12 20:32:00 -0500] andreacampi: ah the chef server you mean?
[2012-02-12 20:35:00 -0500] tolland: its not the same box as the chef server, but its a similar role
[2012-02-12 20:38:00 -0500] andreacampi: right, so I don't get it. the server may have some power anyway, but if you make it an admin and anything goes bad (read, you are hacked), the server will have the power to manipulate everything in the chef server
[2012-02-12 20:39:00 -0500] andreacampi: but at the end of the day, only you know your needs and setup so if you are comfortable with that, why not :)
[2012-02-12 21:39:00 -0500] flashmanbahadur: is there any good reason to keep your validation key on the server after you have successfully registered as a client?
[2012-02-12 21:48:00 -0500] tolland: flashmanbahadur: only if you feel you need blat the client and start again
[2012-02-12 21:48:00 -0500] tolland: which happens
[2012-02-12 21:54:00 -0500] tolland: if I create a user, can I immediately get its uid back for use in some other resource?
[2012-02-12 21:56:00 -0500] flashmanbahadur: tolland: "need blat the client"
[2012-02-12 21:59:00 -0500] tolland: flashmanbahadur: Unfortunately I am working on some systems for a customer who is building openstack virtual bollox, and quite often I turn up at work and someone has changed the server naming scheme and the servers have the wrong name
[2012-02-12 21:59:00 -0500] tolland: hence, need to delete the client pem and reregister
[2012-02-12 21:59:00 -0500] flashmanbahadur: i see
[2012-02-12 22:00:00 -0500] flashmanbahadur: thanks
[2012-02-12 22:00:00 -0500] tolland: the chef-client recipe has a block to do it automatically
[2012-02-12 22:00:00 -0500] flashmanbahadur: yeah thats what I am using now to delete it
[2012-02-12 22:01:00 -0500] flashmanbahadur: after talking with yfeldblum about it the other day
[2012-02-12 22:01:00 -0500] flashmanbahadur: on a side note, is there a better cookbook for dealing with AWS ebs drives  and/or  mdadm raid commands than the resources provided by Opscode?
[2012-02-12 22:01:00 -0500] tolland: haha, maybe I am deleting the wrong client, if you know what I mean ... ;-)
[2012-02-12 22:02:00 -0500] flashmanbahadur: hah
[2012-02-12 22:10:00 -0500] tolland: no idea. but come back here and tell everyone about it if you find something
[2012-02-12 22:10:00 -0500] tolland: because I want to do something like that in a few weeks
[2012-02-12 22:11:00 -0500] flashmanbahadur: havent found a ton thats useful, but ill keep looking
[2012-02-12 22:11:00 -0500] flashmanbahadur: or if I have the time to get better with ruby, just build my own
[2012-02-12 22:12:00 -0500] flashmanbahadur: main issues seem to be lack of proper retry functionality for mdadm and forced commands for EBS volumes
[2012-02-12 22:25:00 -0500] jj3423: I'm getting 404's with solr requests ie: https://gist.github.com/1436124 Is this a known issue?
