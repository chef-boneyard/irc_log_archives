[2012-09-24 00:13:34 -0400] thedeeno: If I have a node with role['a'] in it's runlist, and role['a] contains role['b'] in it's runlist, is it expected that `knife search node "role:b"` would return 0 items?
[2012-09-24 00:13:56 -0400] thedeeno: cause I totally expected my node to be 'in role b' even if it's not the top level role
[2012-09-24 00:16:27 -0400] thedeeno: aha, I see here that this _is_ expected: http://wiki.opscode.com/display/chef/Search
[2012-09-24 00:17:12 -0400] thedeeno: follow up then, is there a way to use the search api for this query? How do I find nodes assigned a role that isn't in a top-level run-list
[2012-09-24 00:17:16 -0400] thedeeno: ?
[2012-09-24 00:17:48 -0400] thedeeno: fml, nvm
[2012-09-24 00:17:54 -0400] thedeeno: use 'roles' plural
[2012-09-24 00:17:57 -0400] chip-: thedeeno: use the plural.
[2012-09-24 00:18:00 -0400] chip-: d'oh
[2012-09-24 00:18:10 -0400] thedeeno: haha, yeah, i'm dumb
[2012-09-24 00:18:32 -0400] chip-: I'd argue that it's not immediately obvious :)
[2012-09-24 00:19:35 -0400] thedeeno: truth!
[2012-09-24 00:51:01 -0400] alephant: hey all
[2012-09-24 00:51:10 -0400] alephant: gotta question about layout
[2012-09-24 00:52:31 -0400] alephant: I want to manage Linux and OSX machines.  I have a bunch of common stuff that should be done for each.  Should I have a role for each that uses similarly-named but differently-implemented recipes, or a single role and a single recipe that branches on each resource to do different OSes differently?
[2012-09-24 01:04:35 -0400] Axsuul: yfeldblum:  you around? do you know bash well? I'm trying to make that script but having trouble --> https://gist.github.com/4b853d5409c16bdceff2
[2012-09-24 01:04:59 -0400] yfeldblum: Axsuul, you need to use export
[2012-09-24 01:05:30 -0400] yfeldblum: Axsuul, see the comment
[2012-09-24 01:05:42 -0400] alephant: ``export'' makes the shel var available in the current process and any children.
[2012-09-24 01:07:23 -0400] Axsuul: yfeldblum: hmm, still doesn't work for me
[2012-09-24 01:07:32 -0400] Axsuul: yfeldblum: ./environment echo $FOO outputs nothing
[2012-09-24 01:07:48 -0400] alephant: what's the best way to write a recipe for a service that requires a humongous (1TB) datafile provisioned out-of-band from Chef?
[2012-09-24 01:08:13 -0400] Axsuul: yfeldblum: sorry, I may have confused you, the btotom portion is what I want to happen, but that's not what's happening
[2012-09-24 01:08:24 -0400] alephant: i.e. "start the recipe, do A, B, C but wait until file $somefile exists before doing D, E, F"
[2012-09-24 01:08:25 -0400] alephant: ?
[2012-09-24 01:12:27 -0400] yfeldblum: Axsuul, $FOO is evaluated (to '') before your environment script is run
[2012-09-24 01:13:01 -0400] yfeldblum: Axsuul, you can try ./environment echo '$FOO'
[2012-09-24 01:14:38 -0400] yfeldblum: Axsuul, but you'll probably have to change to: `exec sh -c $@` or something like that
[2012-09-24 01:33:15 -0400] ssd7: Ohai Chefs
[2012-09-24 01:33:32 -0400] flaccid: iaho
[2012-09-24 01:43:31 -0400] ssd7: lol
[2012-09-24 01:44:49 -0400] alephant: template /proc/kcore...
[2012-09-24 01:47:19 -0400] killfill: hi
[2012-09-24 01:48:36 -0400] tolland: hi
[2012-09-24 01:48:55 -0400] tolland: how do you make knife bootstrap send a tty option to ssh/sudo
[2012-09-24 01:49:07 -0400] tolland: our build has requiretty set
[2012-09-24 01:54:20 -0400] killfill: im new to chef, and am trying to run a recept.. i see this "FATAL: Chef::Exceptions::ValidationFailed: Required argument id is missing!" what does it mean?
[2012-09-24 01:55:02 -0400] yfeldblum: Axsuul, any luck?
[2012-09-24 01:55:47 -0400] yfeldblum: tolland, maybe change the build?
[2012-09-24 01:57:51 -0400] alephant: A ``metadata.json'' appeared mysteriously in one of my cookbooks.  What is it and should I keep it in Git?
[2012-09-24 01:59:38 -0400] flaccid: alephant: its not needed and shouldn't be in git. should be explained on the Metadata page on wiki
[2012-09-24 02:01:01 -0400] jtimberman: alephant: if you downloaded a cookbook from the community site, it might contain that.
[2012-09-24 02:01:09 -0400] alephant: it's my own cookbook
[2012-09-24 02:01:27 -0400] alephant: reading wiki...
[2012-09-24 02:01:55 -0400] jtimberman: metadata can be in .rb or .json format, the rb is converted to json when knife is used to upload the cookbook, but i thought that it wasn't kept on disk once uploaded if the metadata.rb exists.
[2012-09-24 02:02:35 -0400] alephant: wiki doesn't really explain it so I can delete the metadata.json if metadata.rb exists?
[2012-09-24 02:02:51 -0400] flaccid: sounds like that wiki page could do with a bit more info
[2012-09-24 02:02:58 -0400] jtimberman: alephant: yeah
[2012-09-24 02:03:04 -0400] jtimberman: flaccid: mebbe :)
[2012-09-24 02:03:07 -0400] alephant: haha
[2012-09-24 02:03:08 -0400] flaccid: hehe
[2012-09-24 02:03:08 -0400] alephant: thanks
[2012-09-24 02:05:21 -0400] alephant: So if I have a cookbook for XYZ service; and the directory where it lives, and various strings to put in its templates, etc. are all going to vary multiple times for each desired instance on each host, is a data bag the correct place to put all that?
[2012-09-24 02:09:17 -0400] alephant: It seems like a data bag is for use across multiple things in this case each individual host is going to have "dirname1, tcp_port1; dirname2, tcp_port2; dirname3, tcp_port3" etc., and hosts might all be different
[2012-09-24 02:09:27 -0400] alephant: Should that go into Node attributes instead?
[2012-09-24 02:09:56 -0400] ssd7: tolland: I /thought/ we did request a tty
[2012-09-24 02:12:57 -0400] Axsuul: yfeldblum: thanks I got it to work with ./environment ruby script.rb, and it reads ENV fine, but... echo "$FOO" for example doesn't work, probably cause bash is not evaluating it
[2012-09-24 02:13:36 -0400] Axsuul: yfeldblum: I guess I need to do... ./environment bash -c 'echo $FOO'
[2012-09-24 02:13:43 -0400] jtimberman: alephant: yeah, so, data bags are generally where you store data that are infrastructure wide
[2012-09-24 02:14:13 -0400] alephant: jtimberman: these should be Node attributes then?
[2012-09-24 02:15:29 -0400] jtimberman: i'd make them node attributes.
[2012-09-24 02:15:36 -0400] jtimberman: either node specific or calculated based on something about the node.
[2012-09-24 02:17:49 -0400] alephant: ok
[2012-09-24 02:18:12 -0400] alephant: jtimberman: Is there a common/idiomatic way to keep my Node definitions in Git up-to-date with what's in the chef-server?
[2012-09-24 02:18:47 -0400] alephant: I'd rather not have to use an API client to get info about my Nodes' run_lists / attributes / roles etc.; I'd rather have that in Git.
[2012-09-24 02:19:54 -0400] alephant: is that just a cronjob that iterates ``knife node show -l''  over ``knife node list''?
[2012-09-24 02:20:11 -0400] alephant: or is there a better way? (or a compelling reason not to do it at all?)
[2012-09-24 02:25:59 -0400] gchristensen: alephant: my understanding is you shouldn't make changes via the UI
[2012-09-24 02:26:12 -0400] thedeeno: alephant: you can keep roles, nodes, etc definitions in files in your git repo
[2012-09-24 02:26:24 -0400] thedeeno: when you make changes to them, you just push via knife
[2012-09-24 02:26:24 -0400] alephant: OK but still - it's possible to change a node via ``knife node edit''
[2012-09-24 02:26:58 -0400] thedeeno: workflow: edit local file, push with `knife node from file ...`
[2012-09-24 02:27:39 -0400] thedeeno: I only edit encrypted data bags, for everything else, I just assume everything on the server is mutable from files in my repo.
[2012-09-24 02:28:50 -0400] thedeeno: alephant: put another way, my goal is to keep chef-server up-to-date with my git repo
[2012-09-24 02:28:53 -0400] thedeeno: not the other way around
[2012-09-24 02:29:04 -0400] alephant: dig
[2012-09-24 02:29:17 -0400] alephant: but is there a way to prevent api clients (knife, web) from updating a node?
[2012-09-24 02:29:33 -0400] alephant: or is that a bridge whose crossing is deferred?
[2012-09-24 02:30:19 -0400] jtimberman: alephant: i don't generally store nodes in git
[2012-09-24 02:30:29 -0400] thedeeno: fwiw, niether do i
[2012-09-24 02:30:37 -0400] alephant: Alternate opinions!
[2012-09-24 02:30:42 -0400] thedeeno: i use roles to drive things
[2012-09-24 02:30:46 -0400] alephant: So you keep nodes only in the chef_server?
[2012-09-24 02:31:35 -0400] thedeeno: yeah, though now that I'm actually thinking of it, they probably should be in my repo (even if they are just wrappers around my roles)
[2012-09-24 02:32:13 -0400] thedeeno: as for permissions on api clients, idk. You can check the permissions api to see if they're that fine grained
[2012-09-24 02:32:24 -0400] thedeeno: I've never had that requirment
[2012-09-24 02:34:01 -0400] jtimberman: the ACLs (permissions on objects) are a feature of Opscode Hosted Chef and Opscode Private Chef, not available in Open Source Chef Server.
[2012-09-24 02:34:04 -0400] jtimberman: fwiw
[2012-09-24 02:37:44 -0400] yfeldblum: not everything needs to be in git
[2012-09-24 02:38:24 -0400] alephant: ok thx
[2012-09-24 02:38:30 -0400] alephant: screen swimming before my eyes
[2012-09-24 02:38:31 -0400] alephant: time for bed
[2012-09-24 02:39:29 -0400] yfeldblum: alephant, that's when it's time to get started
[2012-09-24 02:39:42 -0400] alephant: augh no
[2012-09-24 02:40:35 -0400] thedeeno: so how do you guys deal with cross-cutting concerns? Like setting up monit, for instance. Do you create one monit cookbook with support for tons of applications? Or do you add a monit recipe to each application's cookbook?
[2012-09-24 02:41:16 -0400] thedeeno: I'm currently doing the latter
[2012-09-24 02:42:14 -0400] thedeeno: and doing a `node.recipes.include?('monit')` at the beginning of each recipe
[2012-09-24 02:42:23 -0400] thedeeno: to be safe
[2012-09-24 02:51:23 -0400] chip-: thedeeno: Check out the nagios and munin cookbooks for great examples of how Search helps to solve this problem.
[2012-09-24 02:51:43 -0400] chip-: thedeeno: also self-configuring monitoring is just awesome.
[2012-09-24 02:53:27 -0400] thedeeno: chip-: awesome, willd o
[2012-09-24 02:57:51 -0400] thedeeno: chip-: can you point me to an interesting place in the nagios repo or perhaps explain a little more about what you mean about 'self-configuring'. I'm diving through here but feel like I'm missing something
[2012-09-24 02:58:04 -0400] thedeeno: my interest is def peaked
[2012-09-24 02:58:09 -0400] Axsuul: thedeeno: I have a monit recipe that installs monit, and I have a monit provider that I use in other recipes to set up the configs
[2012-09-24 02:59:16 -0400] chip-: thedeeno: Nagios server recipe sets up a nagios server, and then runs a search to find all nodes running nagios-client recipe in the current environment.
[2012-09-24 02:59:46 -0400] chip-: I haven't looked at it for a while so this may be different, but last I checked it then runs a loop for each node that breaks out the run list, and for each role in the run list, it can have different logic that defines checks based on that role.
[2012-09-24 03:00:17 -0400] chip-: so on the server side, if it sees 'nginx' it'll build a nagios host group for every node with the nginx role, and then has a set of standard checks for the nginx role.
[2012-09-24 03:00:27 -0400] thedeeno: Axsuul: care to share that lwrp? I'm just using a vanilla template resource, hadn't got around to writing a lwrp yet
[2012-09-24 03:00:32 -0400] chip-: client recipe meanwhile can install plugins based on roles assigned to the node.
[2012-09-24 03:01:05 -0400] Axsuul: thedeeno: Ya I'm writing it as we speak actually, it'll be pushed to https://github.com/axsuul/cookbook-monit
[2012-09-24 03:02:01 -0400] chip-: Nice!
[2012-09-24 03:02:13 -0400] thedeeno: chip-: interesting, it sound like they def took the central cookbook approach then. Nagios cookbook knows how to check many processes, and searches the infrastructure for them
[2012-09-24 03:02:48 -0400] thedeeno: ty sir, starred
[2012-09-24 03:02:49 -0400] chip-: I think a LWRP-based refactor would be amazing.
[2012-09-24 03:03:33 -0400] chip-: I don't know if it's possible and the hours involved would be many, but a general-purpose 'monitoring' cookbook, similar to the newish 'database' cookbook, that acts as a glue layer between various monitoring infrastructures and the services they watch would be fantastic.
[2012-09-24 03:03:50 -0400] chip-: But y'know
[2012-09-24 03:03:52 -0400] chip-: so would a pony
[2012-09-24 03:03:55 -0400] thedeeno: i'm still torn, should nginx know how to monitor itself with monit? Or should monit itself know the finite list of things it can watch.
[2012-09-24 03:03:56 -0400] chip-: with sparkles
[2012-09-24 03:04:13 -0400] thedeeno: seems pros and cons with both approaches
[2012-09-24 03:04:16 -0400] jtimberman: nagios cookbook works like that mainly because nagios doesn't have an API for clients to register themselves with the server.
[2012-09-24 03:04:22 -0400] chip-: I'm of the opinion that the service should tell the monitor how to watch it
[2012-09-24 03:04:43 -0400] thedeeno: I'm def leaning that wa
[2012-09-24 03:04:44 -0400] thedeeno: y
[2012-09-24 03:04:46 -0400] Axsuul: thedeeno: my approach is, create a nginx::monit recipe, and use the monit LWRP that I'm writing
[2012-09-24 03:04:48 -0400] jtimberman: chip-: ##monitoringsucks
[2012-09-24 03:04:49 -0400] jtimberman: :)
[2012-09-24 03:05:01 -0400] jtimberman: sensu may be of interest
[2012-09-24 03:05:19 -0400] thedeeno: just got done setting up a test of sensu, it seems cool
[2012-09-24 03:05:46 -0400] thedeeno: i don't like how the default web interface doesn't really show you any information unless a check fails though
[2012-09-24 03:05:52 -0400] thedeeno: (if I set it up correctly)
[2012-09-24 03:05:59 -0400] chip-: jtimberman: Why not? What's one more chan to idle? :)
[2012-09-24 03:07:08 -0400] thedeeno: Axsuul: is your lwrp wrapping the entire monit config dsl? Or is it shorthand for dropping a monit.conf template?
[2012-09-24 03:07:33 -0400] Axsuul: thedeeno: it's a shorthand for dropping a monit.conf and then reloading the monit service to recognize the config
[2012-09-24 03:07:57 -0400] Axsuul: thedeeno: but I'm also implmeenting DSL
[2012-09-24 03:08:11 -0400] Axsuul: thedeeno: like, the most comon config dsl methods
[2012-09-24 03:08:48 -0400] thedeeno: Axsuul: sounds legit.
[2012-09-24 03:10:33 -0400] thedeeno: a little OT, but is anyone using logstash without a JVM? I heard it can be run with MRI ruby
[2012-09-24 03:10:55 -0400] thedeeno: and omg, does this jvm take up memory. Totally not worth it for simple log aggregation
[2012-09-24 03:17:20 -0400] hoover_damm: thedeeno, it's in java for performance
[2012-09-24 03:18:04 -0400] hoover_damm: thedeeno, one fun bit of languages lately is the java love... clojure, jython, jruby, ...
[2012-09-24 03:21:30 -0400] Kouno: Hi!
[2012-09-24 03:21:56 -0400] Kouno: Is there any way to tell Chef to not bother with owner/user on directory creation ?
[2012-09-24 03:25:58 -0400] Kouno: I'm using Vagrant shared folder with NFS and my `directory` directive is trying to modify the owner/group of the folder. Which results in Errno::EPERM: Operation not permitted - /vagrant/tmp
[2012-09-24 03:31:09 -0400] flaccid: afaik chef runs as root so maybe this is vagrant specific issue
[2012-09-24 03:31:56 -0400] flaccid: but then again if that location is nfs mounted with incorrect perms or not supportable to chown, then you'd have to expect operationnot permissted
[2012-09-24 03:32:03 -0400] flaccid: which is different to access denied..
[2012-09-24 03:32:56 -0400] Kouno: yes, I actually believe it's vagrant fault. it mounts it with my user_id on my host system, and apparently I can't do anything about it right now.
[2012-09-24 03:34:05 -0400] Kouno: Vagrant in the end make it in a way that permit creation/deletion of directory and files within /vagrant as if it was a know user id
[2012-09-24 03:34:57 -0400] Kouno: if chef wasn't checking for the owner and group in this particular place, I would be able to just live with it but it doesn't and complains about it. Which generally is a good thing, but not here.
[2012-09-24 03:35:39 -0400] Kouno: I wonder if I'll have to remount the vagrant folder by hand or not...
[2012-09-24 03:36:30 -0400] flaccid: #vagrant
[2012-09-24 03:37:04 -0400] Axsuul: Kouno: curious, is the host OS on windows
[2012-09-24 03:37:21 -0400] Kouno: no. NFS is not supported for vagrant on Windows.
[2012-09-24 03:37:29 -0400] Kouno: I'm using Mac OS
[2012-09-24 03:37:39 -0400] Axsuul: ah ok
[2012-09-24 08:04:26 -0400] nacer: hello guys
[2012-09-24 08:04:51 -0400] nacer: Somone remember the knife plugins who help to manage multiple organization ?
[2012-09-24 08:07:10 -0400] bluepojo: I wrote this bash script to do that for me: https://gist.github.com/3774874
[2012-09-24 08:07:28 -0400] bluepojo: name directories like ~/.chef-something
[2012-09-24 08:07:37 -0400] bluepojo: then you can do knife-config something to switch to it
[2012-09-24 08:08:32 -0400] bluepojo: it was originally written for different servers
[2012-09-24 08:08:35 -0400] bluepojo: but different orgs work too
[2012-09-24 08:30:18 -0400] nacer: Tks bluepojo
[2012-09-24 08:30:24 -0400] zts: nacer: knife-block is what I use
[2012-09-24 08:30:56 -0400] bluepojo: I didn't like knife-block cause it keeps everything in the same directory
[2012-09-24 08:31:03 -0400] bluepojo: but I'm sure it works well
[2012-09-24 08:31:35 -0400] nacer: ok
[2012-09-24 08:31:51 -0400] nacer: bluepojo: yeah i do the link stuff by hand too
[2012-09-24 08:32:04 -0400] nacer: but it don't bother me that all the stuff is .chef
[2012-09-24 09:31:59 -0400] shamaz: I try to search all nodes in a role AND the ohai_time is in the range [NOW-1HOUR TO NOW]? My first try looked like: search(:node, "role:Tester AND ohai_time:[NOW-1HOUR TO NOW]")
[2012-09-24 09:32:10 -0400] shamaz: but it returns an empty array
[2012-09-24 09:39:11 -0400] AikiLinux: hello , i am attempting to register a newly installed chef-client and getting this error :NameError: undefined local variable or method `e' for #<Chef::Formatters::ErrorInspectors::RegistrationErrorInspector:0x00000001b4e348>
[2012-09-24 09:39:42 -0400] AikiLinux: this is a new installed of chef
[2012-09-24 09:39:57 -0400] AikiLinux: can any one tell me where to start looking ?
[2012-09-24 09:42:35 -0400] shamaz: @ AikiLinux: which method have you used to register the client? knife bootstrap, knife client ...?
[2012-09-24 09:45:00 -0400] ranjibd: shamaz,  do you have to use the search only... or you can use  knife exec ?
[2012-09-24 09:46:16 -0400] pprakash: Hi, When I try to bootstrap it's failing to connect to opscode.com server
[2012-09-24 09:46:26 -0400] pprakash: Connecting to opscode.com|184.106.28.82|:80... failed: Connection timed out.
[2012-09-24 09:53:50 -0400] AikiLinux: shamaz, checf-client
[2012-09-24 09:55:26 -0400] shamaz: AikiLinux: and the client is registerd in the server as client and node?
[2012-09-24 09:55:29 -0400] pprakash: I found opscode.com get resolved to 184.106.28.83 but http://opscode.com/chef/install.sh is getting resolved to 184.106.28.82
[2012-09-24 09:58:34 -0400] AikiLinux: shamaz,  i managed to sort that issue , conflicting packages , now i have an issue with the registering, but it seems like an issue with my copy of the validation.pem
[2012-09-24 10:00:28 -0400] shamaz: AikiLinux: get you some errors like:  ... Forbidden... for client /chef ... ?
[2012-09-24 10:01:55 -0400] pprakash: .quit
[2012-09-24 10:08:11 -0400] AikiLinux: not yet , still issues with the pem download /
[2012-09-24 10:18:36 -0400] AikiLinux: sorted the pem issue , now the error i get is pretty clear and needs to be sorted with the chef administrator ("Cannot load role Base")
[2012-09-24 10:19:10 -0400] shamaz: AikiLinux: before a chef-client can get some data from the server it must be registered as api-client with his own client.pem key.
[2012-09-24 10:22:55 -0400] masterkorp: http://i.imgur.com/prPWR.jpg
[2012-09-24 10:23:01 -0400] masterkorp: FUCK DA POLICE
[2012-09-24 10:23:07 -0400] masterkorp: oops wrong windows
[2012-09-24 10:23:15 -0400] masterkorp: oh well still funny
[2012-09-24 10:26:54 -0400] AikiLinux: the client.pem is created ok, butis rejected on the role(which I know have not been set up yet)
[2012-09-24 10:35:26 -0400] shamaz: AikiLinux: can you run "chef-client --log_level debug" and pastepin that?
[2012-09-24 10:39:43 -0400] AikiLinux: http://pastie.org/4790280
[2012-09-24 10:51:14 -0400] shamaz: AikiLinux: it looks like that there are missing some programs or they are not in the PATH variable. Like php java mono gcc groovy ... have you previously installed rubygems and the required programms?
[2012-09-24 10:57:47 -0400] AikiLinux: i have installed rubygems , the install was handled by yum so it resolves the deps
[2012-09-24 10:59:20 -0400] AikiLinux: the whole install is done at build time via cobbler
[2012-09-24 11:23:05 -0400] shamaz: AikiLinux: Check your PATH variable and in the /usr/bin dir. If there are not the required programms you must install it or add the missung link manually.
[2012-09-24 11:25:37 -0400] anentropic: anyone got an idea what's causing this?
[2012-09-24 11:25:39 -0400] anentropic: $ knife node list --verbose
[2012-09-24 11:25:40 -0400] anentropic: INFO: HTTP Request Returned 500 Internal Server Error: Named route node could not be generated with {:id=>nil}
[2012-09-24 11:25:40 -0400] anentropic: ERROR: Server returned error for http://localhost:4000/nodes, retrying 1/5 in 4s
[2012-09-24 11:26:27 -0400] alexbst: I've got a chef-client on windows set to start automatically on boot, but it never starts, and it never logs anything..
[2012-09-24 11:33:46 -0400] Unicron_: when i use a bootstrap proxy in knife bpootstrap command - is there any way to tell the new node to NOT use the proxy for communicating with the chef-server which is on the internal netwrok?
[2012-09-24 11:35:23 -0400] Unicron_: i need proxy to get out to download chef using omnibus installer and for other things such as installing gems automatically (such as shadow) but the client then uses the proxy to try to register with the chef-server which is not desirable
[2012-09-24 11:44:42 -0400] anentropic: it looks like jacobat had the same problem back in June and got no answer either http://community.opscode.com/chat/chef/2012-06-19
[2012-09-24 12:01:06 -0400] anentropic: in the web ui all the tabs work except the 'nodes' tab, where I get "No Method Error 500"
[2012-09-24 12:08:20 -0400] shepard_: Hello, is any1 familiar with memory-leaking by chef-client?
[2012-09-24 12:22:20 -0400] Unicron_: anentropic, was that for me?  Can't find issue same as mine from that archive link
[2012-09-24 12:22:38 -0400] anentropic: Unicron, no just talking about my own issue sorry
[2012-09-24 12:28:13 -0400] anentropic: and I just found the answer... a node with a null name had got created somehow
[2012-09-24 12:28:26 -0400] anentropic: eventually worked out how to delete it directly in couchdb
[2012-09-24 12:28:40 -0400] anentropic: knife node list and the webui work again now
[2012-09-24 12:40:49 -0400] anentropic: ticketed: http://tickets.opscode.com/browse/CHEF-3473
[2012-09-24 12:56:43 -0400] cpasmoi: Hi there, I would like to execute a particular recipe if the node I'm on is a Centos 6 one. How can I do so ?
[2012-09-24 13:13:53 -0400] jwitrick: jtimberman: I have submitted a new pull request against the heartbeat cookbook. Thanks for the feedback.  https://github.com/opscode-cookbooks/heartbeat/pull/4
[2012-09-24 13:15:49 -0400] gyre007: what do I need to do if I want to log something from within a resource ?
[2012-09-24 13:16:03 -0400] gyre007: I mean in the resource blokc
[2012-09-24 13:16:15 -0400] gyre007: like from within package/execute resource block
[2012-09-24 13:29:36 -0400] gyre007: cpasmoi, do soemthing like platform?... include_recipe...
[2012-09-24 13:30:46 -0400] cpasmoi: I guess I'll also have to use platform_version ?
[2012-09-24 13:31:01 -0400] willythewisp: anybody knows when chef 10.14.4 will be released, bug CHEF-3435 is affecting my deploy process?
[2012-09-24 13:31:34 -0400] cpasmoi: I'm looking for something like "plaform_version?"
[2012-09-24 13:32:54 -0400] cpasmoi: oh well, I've just read that might work this way
[2012-09-24 13:35:25 -0400] cpasmoi: Hum, OK. Now, I want that for every centOS 6.x nodes. I'm trying `if platform?("centos") && node[:platform_version] == "6"` but I doubt the platfom_version only contains the major number
[2012-09-24 13:36:54 -0400] jmartin: platform_version.to_i mebbe?
[2012-09-24 13:36:54 -0400] gyre007: cpasmoi, run ohai and have a look on the output...and use the attribs from there..
[2012-09-24 13:37:03 -0400] jmartin: itll make it an integer
[2012-09-24 13:37:08 -0400] jmartin: or
[2012-09-24 13:37:15 -0400] jmartin: platform_version >= 6
[2012-09-24 13:37:26 -0400] jmartin: err
[2012-09-24 13:37:29 -0400] jmartin: platform_version.to_f
[2012-09-24 13:38:26 -0400] cakehero: I'm unable to deploy a new revision of my application with the application cookbook (which uses the deploy provider) because of this error, any ideas? https://gist.github.com/688dc6e02fb17cb9bf19
[2012-09-24 13:42:58 -0400] cpasmoi: thanks gyre007 and jmartin !
[2012-09-24 13:43:50 -0400] gyre007: cakehero, what version of Chef ? deploy resource on 10.14 is a total disaster...I had to rollback to 10.12...issue after issue
[2012-09-24 13:43:54 -0400] cakehero: 10.12
[2012-09-24 13:44:04 -0400] cakehero: gyre007 yeah, me too
[2012-09-24 13:44:54 -0400] gyre007: cakehero, well in your case chef can't find some file so it cant finish the deployment
[2012-09-24 13:45:04 -0400] cakehero: yeah, but that file is in the repo and in shared
[2012-09-24 13:45:05 -0400] gyre007: Chef::Exceptions::FileNotFound: Cannot symlink /srv/api/shared/database.yml to /srv/api ....
[2012-09-24 13:45:08 -0400] cakehero: yeah
[2012-09-24 13:45:32 -0400] cakehero: I can debug /usr/lib/ruby/gems/1.9.3-p0/gems/chef-10.12.0/lib/chef/provider/deploy.rb
[2012-09-24 13:45:37 -0400] cakehero: and make sure permissions are right
[2012-09-24 13:45:41 -0400] cakehero: but I am not sure what I should be checking
[2012-09-24 13:45:46 -0400] gyre007: one thing is sure...debugging Chef is just PAIN...simples :)
[2012-09-24 13:46:56 -0400] cakehero: heh
[2012-09-24 13:48:31 -0400] gyre007: Im getting ArgumentError: wrong number of arguments (1 for 2) but the number of args is correct :-D
[2012-09-24 13:49:12 -0400] willythewisp: @gyre007 if u are using deploy resource its bug CHEF-3435 / CHEF-3450 which is affecting  me at the moment as well
[2012-09-24 13:49:19 -0400] jmartin: ^
[2012-09-24 13:49:25 -0400] jmartin: known bug iirc
[2012-09-24 13:49:33 -0400] gyre007: willythewisp, are you getting the same error ?
[2012-09-24 13:49:46 -0400] willythewisp: every second chef-client run
[2012-09-24 13:50:00 -0400] willythewisp: http://tickets.opscode.com/browse/CHEF-3450
[2012-09-24 13:50:03 -0400] gyre007: in my case its failing on bundle install
[2012-09-24 13:50:53 -0400] gyre007: willythewisp, not sure if that's related to what I copy pasted...you sure ?
[2012-09-24 13:51:14 -0400] gyre007: might be ...not sure
[2012-09-24 13:52:06 -0400] gyre007: im getting this when bundle install is supposed to be running...and then it dies with wrong number of arguments...not really sure how to debug this though...
[2012-09-24 13:52:48 -0400] gyre007: willythewisp, that ticket is most likely related to cakehero problem...
[2012-09-24 13:53:48 -0400] willythewisp: yeah think I switched that
[2012-09-24 13:54:18 -0400] willythewisp: just read gyre007: Chef::Exceptions::FileNotFound: Cannot symlink /srv/api/shared/database.yml to /srv/api ....
[2012-09-24 13:54:23 -0400] jtimberman: jwitrick: great, thank you :D
[2012-09-24 13:54:37 -0400] gyre007: willythewisp, dude...that's copypaste from cakehero gist :)
[2012-09-24 13:54:38 -0400] jtimberman: jwitrick: in the future don't forget to set the jira ticket as resolved so we see it for code review.
[2012-09-24 13:54:50 -0400] cakehero: willythewisp gyre007  I'm not sure that it's the same
[2012-09-24 13:55:21 -0400] gyre007: willythewisp, mine one is: ArgumentError ; wrong number of arguments (1 for 2)
[2012-09-24 13:55:28 -0400] gyre007: worked fine on 10.12
[2012-09-24 13:55:43 -0400] gyre007: still does in fact...something must've changed and screwed things up...in deploy resource
[2012-09-24 13:55:58 -0400] cakehero: it looks like its not checking out the new release folder for me
[2012-09-24 13:58:16 -0400] jwitrick: cool. will do.
[2012-09-24 13:58:21 -0400] cakehero: it looks like it's trying to rollback to the release, but, that release doesn't exist
[2012-09-24 14:01:01 -0400] cakehero: gyre007 willythewisp looks like 'force_deploy' fixed it for me
[2012-09-24 14:01:11 -0400] gyre007: :)
[2012-09-24 14:01:19 -0400] gyre007: cakehero, I wish I was that luck too! :D
[2012-09-24 14:01:34 -0400] cakehero: Don't worry it took me long enough o figure out =)
[2012-09-24 14:03:18 -0400] gyre007: cakehero, well don't have much spare time hahaha
[2012-09-24 14:03:39 -0400] gyre007: strangely not seeing any problems on 10.12..
[2012-09-24 14:11:02 -0400] gyre007: can I query chef version from within the recipe ? need to workaround that deploy resource mess...
[2012-09-24 14:13:38 -0400] cheeseplus: gyre007: ohai should have the chef-client version available
[2012-09-24 14:18:17 -0400] gyre007: cheeseplus, yeah looks like its this: node["chef_packages"]["chef"]["version"]
[2012-09-24 14:18:31 -0400] cheeseplus: yup
[2012-09-24 14:18:46 -0400] cheeseplus: sorry, I had that in the bar and just didn't hit enter
[2012-09-24 14:18:50 -0400] cheeseplus: scumbag irc helper
[2012-09-24 14:20:49 -0400] till_: can i notify multiple services to restart them when a template changes?
[2012-09-24 14:26:06 -0400] gyre007: till_, not sure but you can subscribe each service to given template change
[2012-09-24 14:26:28 -0400] gyre007: till_, like subscribes :restart, resources(...)
[2012-09-24 14:26:42 -0400] gyre007: within each service you want to have restarted...
[2012-09-24 14:32:58 -0400] jblaine: jtimberman: Opscode ntp cookbook. I have tweaks to allow it to work on Solaris 10. For starter discussion, ntp.conf.erb includes various things that are unknown to Solaris 10 ntp. How would you prefer I address this? a) include logic in ntp.conf.erb b) make ntp.conf.solaris10.erb and add case logic in the recipe c) other
[2012-09-24 14:34:56 -0400] gchristensen: jblaine: you can have a template for a specific environment
[2012-09-24 14:34:59 -0400] gchristensen: would that work?
[2012-09-24 14:35:37 -0400] jblaine: gchristensen: I'm trying to not solve only my problem, but improve the Opscode ntp cookbook
[2012-09-24 14:35:46 -0400] till_: gyre007: which version of chef do i need for that?
[2012-09-24 14:35:49 -0400] gchristensen: I know, but that would be perhaps a better way to solve the problem
[2012-09-24 14:36:19 -0400] gyre007: till_, should definitely be in 10.x
[2012-09-24 14:36:32 -0400] till_: 0.10.x?
[2012-09-24 14:36:40 -0400] balboah: I'm a total newbie and following the quickstart guides. But the node ip address was incorrectly detected, how do I change this for my node?
[2012-09-24 14:36:47 -0400] gyre007: till_, yeah
[2012-09-24 14:37:04 -0400] gchristensen: jblaine: http://wiki.opscode.com/display/chef/Templates#Templates-TemplateLocationSpecificity like this?
[2012-09-24 14:37:10 -0400] gyre007: balboah, what do you mean by incorrectly deteceted ?
[2012-09-24 14:37:17 -0400] gyre007: whats coming up in ohai ?
[2012-09-24 14:38:15 -0400] balboah: gyre007: it's running in a virtual box and the ip that got used is not something I could ssh into. There are two nic's and I would need to change it to match the 2nd nic for the knife ssh command to work
[2012-09-24 14:38:17 -0400] jblaine: gchristensen: Ah. So not "environments". That's totally different. Possible.
[2012-09-24 14:38:23 -0400] jblaine: jtimberman: or d) see above
[2012-09-24 14:38:47 -0400] gchristensen: jblaine: oh sorry... I meant 'platform'
[2012-09-24 14:38:47 -0400] gyre007: balboah, got used where ?
[2012-09-24 14:39:19 -0400] balboah: gyre007: listed on https://manage.opscode.com/nodes/ and I guess the knife command uses that value
[2012-09-24 14:40:28 -0400] till_: gyre007: ok, i'll see if i can update
[2012-09-24 14:41:20 -0400] balboah: gyre007: I tried the attributes edit page for the json hash, but it seems it doesn't change anything
[2012-09-24 14:41:27 -0400] gyre007: balboah, those IP values are filled in by ohai...not sure if you can change them...
[2012-09-24 14:43:10 -0400] jblaine: gchristensen: the only thing I don't like about that solution is that it creates future skew due to another file to maintain
[2012-09-24 14:43:25 -0400] jblaine: gchristensen: not my call though, and thanks for the reminder of that feature
[2012-09-24 14:43:42 -0400] gchristensen: sure
[2012-09-24 14:43:44 -0400] jblaine: IMO, ntp.conf.erb could use a lot more generic-ification
[2012-09-24 14:44:07 -0400] balboah: gyre007: got it. "As these automatic attributes will be re-written with each Ohai run - Chef doesn't provide any way to modify them"
[2012-09-24 14:44:15 -0400] jblaine: as in querying ntp[statistics] to see if enabled by cookbook user
[2012-09-24 14:44:24 -0400] jblaine: and not assuming always wanted
[2012-09-24 14:44:42 -0400] jblaine: also "flags" for restrict and "server" or "peer"
[2012-09-24 14:45:11 -0400] jblaine: ntp[restrict_flags], etc...
[2012-09-24 14:45:25 -0400] jblaine: 'kod' doesn't work as a flag for solaris 10, for example
[2012-09-24 14:45:38 -0400] jblaine: and 'iburst' for the server and peer lines does not work either
[2012-09-24 14:52:19 -0400] gyre007: balboah, yup...sorry was making a tea
[2012-09-24 14:54:45 -0400] balboah: gyre007: so I could just add my own option and use knife ssh -a
[2012-09-24 14:55:01 -0400] balboah: at least in this particular case the ip will always be the same
[2012-09-24 14:55:08 -0400] gyre007: balboah, yeah thats true
[2012-09-24 14:55:38 -0400] balboah: ok. Reading on :)
[2012-09-24 15:02:46 -0400] till_: is there a way to use 'delayed' with a service resource directly?
[2012-09-24 15:02:50 -0400] till_: like without the 'notifies'?
[2012-09-24 15:11:34 -0400] _dumfrie-: till_ what are you trying to do?
[2012-09-24 15:12:28 -0400] till_: _dumfrie-: trying to collect restarts "required" during a chef run, so it only restarts once in the end. vs. a dozen times during execution
[2012-09-24 15:13:08 -0400] _dumfrie-: I understand that to be the default behaviour unless you have asked the notifications to be applied immediately.
[2012-09-24 15:14:16 -0400] till_: weird, so for whatever reason then: i had a service "foo" do action :restart end and that seemed to happen before anything else
[2012-09-24 15:17:04 -0400] _dumfrie-: was 'foo' being notified from another resource perhaps?
[2012-09-24 15:22:38 -0400] Unicron_: I am using the knife bootstrap command to bootstrap an ubuntu server passing the --bootstrap-proxy option, how can  I make sure that the chef-server url does not go through the proxy? I know the no_proxy can be set in client.rb but how to do this at bootstrap time?
[2012-09-24 15:27:56 -0400] jwheare: hi, i'm trying to lookup a list of node attributes from a script that runs local to that node. is knife the tool to use here?
[2012-09-24 15:29:29 -0400] jwheare: e.g. a node has attrs :list_of_things => [ { :name => 'foo', :value => 'abc' }, { :name => 'bar', :value => 'xyz' } ]
[2012-09-24 15:29:46 -0400] jwheare: i want to look up all the values in list_of_things
[2012-09-24 15:32:29 -0400] philsturgeon: I am using the deploy resource and the git provider to deploy code for a few nodes. works ok on one, but identical chunks of recipe have one node erroring, complaining about tmp, public/system, etc not existing
[2012-09-24 15:32:33 -0400] jwheare: seems like knife is able to find nodes by attribute, but not just lis attributes on a local node
[2012-09-24 15:33:15 -0400] philsturgeon: these are default "symlink" folders, which do not exist. Firstly, how do I tell the deploy script to not bother trying to symlink anything, and secondly, what are they and should I care? I cannot find documentation explainign why I would need to symlink folders before migrate
[2012-09-24 15:33:57 -0400] philsturgeon: I believe it relates to this issue http://tickets.opscode.com/browse/CHEF-1626 but seems weird I have to explicitly stop chef symlinking default folders.
[2012-09-24 15:38:33 -0400] yfeldblum: jwheare, you can write a ruby script that fetches this data with `knife exec`
[2012-09-24 15:43:17 -0400] anentropic: anoyone know how knife-ec2 plugin is supposed to work?
[2012-09-24 15:43:33 -0400] anentropic: I understood if you do
[2012-09-24 15:43:34 -0400] anentropic: $ knife ec2 server create -I some_AMI -S some_key -N MYCOOLNODENAME
[2012-09-24 15:44:01 -0400] anentropic: then it should associate the new instance with the chef node MYCOOLNODENAME ?
[2012-09-24 15:44:34 -0400] anentropic: instead it seems to create a new chef node, named like: ip-<aws internal ip>.eu-west-1.compute.internal
[2012-09-24 15:45:38 -0400] anentropic: is that correct?  have I misunderstood?
[2012-09-24 15:45:39 -0400] Pushnell: anentropic: here's a paste from my notes, creating a node named 'cheftest05'
[2012-09-24 15:45:42 -0400] Pushnell: knife ec2 server create -I ami-aecd60c7 -x ec2-user -f t1.micro --region 'us-east-1' --node-name cheftest05 -i ~/.ssh/chef.pem -V -V
[2012-09-24 15:46:05 -0400] Pushnell: double V's for victory
[2012-09-24 15:46:23 -0400] anentropic: what do the double -Vs do?
[2012-09-24 15:46:35 -0400] Pushnell: win :)
[2012-09-24 15:46:38 -0400] Pushnell: extra verbose
[2012-09-24 15:47:37 -0400] matschaffer1: is there a good tool for the modify-cookbook/upload-to-chef-server/run-chef-client-via-knife-ssh cycle?
[2012-09-24 15:47:41 -0400] anentropic: Pushnell ...did you create cheftest05 as a chef node first?  you didn't get a new node with long auto name?
[2012-09-24 15:48:00 -0400] matschaffer: I've been writing shell scripts, but I get the feeling there's gotta be something for this
[2012-09-24 15:48:36 -0400] anentropic: Pushnell, I've been commenting on this (closed) ticket http://tickets.opscode.com/browse/KNIFE_EC2-18
[2012-09-24 15:48:48 -0400] anentropic: it's annoying you can't set the EC2 instance name properly either
[2012-09-24 15:48:56 -0400] Pushnell: anentropic: that paste is everything I needed to create a node named 'cheftest05'.
[2012-09-24 15:50:19 -0400] Pushnell: matschaffer: I know I've seen one but I can't remember the name
[2012-09-24 15:51:23 -0400] matschaffer: basically I've got this script now that you give it a file, it runs librarian, figures out the right upload command (cookbook vs role vs env), does that, then runs chef-client via knife ssh
[2012-09-24 15:51:38 -0400] matschaffer: maybe I should just make a gem anyway, but seems like there should be something for this
[2012-09-24 15:57:35 -0400] till_: _dumfrie-: I can't tell - all notifications are with 'delayed' though
[2012-09-24 15:57:41 -0400] till_: so i was thinking those are fine
[2012-09-24 15:58:32 -0400] anentropic: Pushnell, doesn't work for me... after running the `knife ec2 server create` command with --node-name if I `knife node list` I have no nodes
[2012-09-24 16:04:30 -0400] jkeiser: gyre007: just caught up with your knife-essentials issue from (yesterday?)  were there any cookbooks already in your directory when you did knife download cookbooks/* ?
[2012-09-24 16:04:35 -0400] jkeiser: One thing about command line expansion is, if the server has cookbooks a, b and c, and you only have a locally, "knife download cookbooks/*" translates to "knife download cookbooks/a" because the shell expands it before knife download gets it
[2012-09-24 16:04:54 -0400] jkeiser: So you wouldn't get b and c, because knife doesn't know you want them :)
[2012-09-24 16:05:17 -0400] rep0st: good to know jkeiser.
[2012-09-24 16:05:20 -0400] jkeiser: "knife download cookbooks" or "knife download cookbooks/\*" will both do the trick
[2012-09-24 16:05:21 -0400] rep0st: ty
[2012-09-24 16:06:06 -0400] philsturgeon: if anybody could help with this stackoverflow question I would be very grateful http://stackoverflow.com/questions/12568767/chef-deployment-with-irrelevant-default-symlinks
[2012-09-24 16:09:02 -0400] jkeiser: The knife list issue is weirder, and I'd love to get data on that.  I doubt the download and list issues were connected, but I totally understand getting scared :)  I didn't even develop the upload command for months for similar reasons--much safer to test things modifying my local filesystem than the server
[2012-09-24 16:09:42 -0400] till_: can i use notifies from a package resource?
[2012-09-24 16:09:54 -0400] till_: so it only restarts a service when the package was installed?
[2012-09-24 16:10:11 -0400] jkeiser: It *could* be (this is speculation) that you ran "knife list cookbooks/*" and you didn't have any actual cookbooks locally, but you did have a file.  Like, you had a file named cookbooks/README.md
[2012-09-24 16:11:04 -0400] philsturgeon: nobody has any idea about the Deploy Resource then?
[2012-09-24 16:12:09 -0400] philsturgeon: there is a bug reported here: http://tickets.opscode.com/browse/CHEF-1626 and the solutions dont seem to work. Even when I explicitly set symlink_before_migrate({}) it will STILL try and symlink config/database.yml which doesnt exist.
[2012-09-24 16:12:17 -0400] jkeiser: gyre007: If you do knife list cookbooks/* in that situation, it expands to "knife list cookbooks/README.md" and knife list will not list anything, because README.md is not on the server and knife list is sopposed to tell you things that are on the server
[2012-09-24 16:12:40 -0400] jkeiser: s/sopposed/supposed
[2012-09-24 16:13:48 -0400] jkeiser: gyre007: you can use \* instead of * in these situations, but for the use cases you were in, I would actually use "knife download cookbooks" and "knife list cookbooks"--it's recursive by default
[2012-09-24 16:14:07 -0400] jkeiser: And nothing ever gets modified on the server unless you are using knife upload or knife delete
[2012-09-24 16:22:01 -0400] jtimberman: jblaine: sorry was away for abit
[2012-09-24 16:23:50 -0400] jtimberman: jblaine: there's platform specific checks in the attributes that could set those to nil so they're not rendered in the template
[2012-09-24 16:23:57 -0400] jtimberman: with better guards about that in the template itself.
[2012-09-24 16:24:15 -0400] jtimberman: jblaine: is there a ticket opened for this?
[2012-09-24 16:25:47 -0400] till_: jtimberman: is there a piece of documentation which explains 'notifies' in detail? e.g. the resources it is available for and the options?
[2012-09-24 16:27:46 -0400] yfeldblum: philsturgeon, http://stackoverflow.com/a/12569090/12349
[2012-09-24 16:30:58 -0400] jtimberman: till_: http://wiki.opscode.com/display/chef/Resources#Resources-Meta
[2012-09-24 16:38:17 -0400] _0x783czar: I have a custom client.rb that I've made, is there a way I can have that version be the one that gets installed on a client when I bootstrap?
[2012-09-24 16:41:34 -0400] jblaine: jtimberman: No ticket yet. I'll do that instead of IRC.
[2012-09-24 16:43:44 -0400] maek: Im migrating from oss to hosted chef and I was under the impression if I dumped my api client objects out to json and re imported them to the new hosted chef org, I should then be able to use the same client.pem on my nodes for the new hosted chef org. That seems to be no correct. When migrating nodes do I have to delete the client.pem and re register?
[2012-09-24 16:44:12 -0400] chip-: maek: There's a set of very good scripts and instructions for doing just this
[2012-09-24 16:44:51 -0400] maek: chip-: whats what im somewhat following, but there it suggests deleting the client.pem and validation.pem, pushing up a new validator and running chef-client
[2012-09-24 16:45:04 -0400] chip-: maek: In my experience the big thing was that you had to be careful to follow the instructions correctly, or your client objects wouldn't have permission for their corresponding node objects once the import was done
[2012-09-24 16:45:27 -0400] maek: I guess i could do that, I was just under the impression the client.pem was the private key and the api_client on the chef server was the public so I should be able to re use them.
[2012-09-24 16:45:49 -0400] maek: chip-: ah, let me look at that. thanks
[2012-09-24 16:46:00 -0400] chip-: maek: Hosted chef adds granularity to node permissions that make the recreation necessary
[2012-09-24 16:46:05 -0400] maek: I am just taking json dumps and importing them via the chef::objectloader
[2012-09-24 16:46:34 -0400] chip-: maek: My experience with the migration scripts about 9 months ago was very positive, as long as I followed the instructions
[2012-09-24 16:46:44 -0400] chip-: when I deviated / thought I knew better / could skip ahead I caused problems.
[2012-09-24 16:47:02 -0400] chip-: (such as the aforementioned)
[2012-09-24 16:47:02 -0400] maek: chip-: ok thanks!
[2012-09-24 16:47:24 -0400] chip-: We migrated about 175 nodes, fwiw, got it all done in an afternoon.
[2012-09-24 16:58:02 -0400] matschaffer: opscode fyi: http://www.downforeveryoneorjustme.com/http://wiki.opscode.com/
[2012-09-24 17:00:23 -0400] chefster: yeah, having trouble connecting to wiki.opscode.com too
[2012-09-24 17:05:50 -0400] kallistec: we're on it
[2012-09-24 17:06:12 -0400] JoshuaMiller: Heh.  That's a great URL.
[2012-09-24 17:16:20 -0400] _0x783czar: kallistec: is there a way I can have my bootstrap install a custom client.rb file?
[2012-09-24 17:18:46 -0400] jessicab: chefster: wikis back up now btw
[2012-09-24 17:19:56 -0400] kallistec: _0x783czar: http://wiki.opscode.com/display/chef/Custom+Knife+Bootstrap+Script
[2012-09-24 17:22:36 -0400] jtimberman: jblaine: it helps keep the conversation in one place, where we can put code and whatnot easier.
[2012-09-24 17:22:48 -0400] jtimberman: jblaine: thank you for your involvement and help in improving solaris support, too.
[2012-09-24 17:26:47 -0400] cwj: shucks, contributor registration for the community summit appears to be sold out
[2012-09-24 17:26:58 -0400] till_: jtimberman: thanks
[2012-09-24 17:35:06 -0400] Eulipion: i'm having trouble with the application cb.  deploy_revision keeps bailing with 'no such file -', not sure what its trying to do, can someone help?
[2012-09-24 17:37:17 -0400] jb__: hum, when testing some cookbooks directy on the node with chef-solo, shouldnt it be enough to just 'knife node foo show -l -F json > chef/config/foo.json'
[2012-09-24 17:37:27 -0400] jb__: and then giving solo the json?
[2012-09-24 17:38:06 -0400] jb__: Eulipion: you looked at the -l debug output?
[2012-09-24 17:39:01 -0400] _0x783czar: kallistec: thanks
[2012-09-24 17:39:06 -0400] Eulipion: jb__: yea, nothing stands out to me.  i know just enough ruby for chef
[2012-09-24 17:40:00 -0400] Eulipion: i think its bailing when it gets to the migrate step
[2012-09-24 18:05:58 -0400] dysinger: Is using node attributes in a template bad or an anti-pattern? somebody shine the light on this. I do it when I'm feeling lazy & not wanting to assign a dozen template variables when templating.
[2012-09-24 18:11:42 -0400] till_: dysinger: did you answer your own question? ;)
[2012-09-24 18:12:08 -0400] bluepojo: dysinger: whenever I can, I set the variables directly in the variables hash
[2012-09-24 18:12:18 -0400] bluepojo: in cases like mysql, where there's literally hundreds of fields
[2012-09-24 18:12:20 -0400] bluepojo: I just use node
[2012-09-24 18:12:52 -0400] dysinger: It seems arbitrary & actually mode typing to assign template variables when it's just a pass-through
[2012-09-24 18:12:57 -0400] dysinger: s/mode/more
[2012-09-24 18:14:22 -0400] bluepojo: It means that your resource call is what determines what values are passed through to the template and it decouples your attributes layout from your template making everything a bit more maintainable
[2012-09-24 18:14:32 -0400] bluepojo: in my opinion
[2012-09-24 18:14:38 -0400] bluepojo: people often use node, however, so it's up to you
[2012-09-24 18:14:42 -0400] bluepojo: I wouldn't call it an antipattern
[2012-09-24 18:14:45 -0400] bluepojo: more of a preference
[2012-09-24 18:15:08 -0400] dysinger: how is maintaing a template a separate concern from a recipe ?  unless maybe you are reusing the template over and over in different recipes.
[2012-09-24 18:15:12 -0400] bluepojo: another option I've seen is to pass a subhash of node as the argument to variables in the template resource
[2012-09-24 18:15:13 -0400] dysinger: that would be a good reason
[2012-09-24 18:15:29 -0400] bluepojo: yeah, you can reuse templates
[2012-09-24 18:15:45 -0400] dysinger: but if you don't need to do that, then you are just typing more
[2012-09-24 18:15:47 -0400] bluepojo: though that isn't a common usecase
[2012-09-24 18:15:49 -0400] bluepojo: right
[2012-09-24 18:16:40 -0400] bluepojo: my primary reason is debugging obscure errors
[2012-09-24 18:16:47 -0400] bluepojo: which may be less of a problem with 10.14
[2012-09-24 18:16:54 -0400] bluepojo: with better error messages
[2012-09-24 18:17:04 -0400] bluepojo: template errors are harder to track down
[2012-09-24 18:17:11 -0400] bluepojo: undefined [] for nil errors, etc
[2012-09-24 18:17:20 -0400] bluepojo: in the recipe, the line number is exact
[2012-09-24 18:17:24 -0400] bluepojo: in the template it's not so clear
[2012-09-24 18:17:54 -0400] jb__: ah. theres the answer to my question: http://tickets.opscode.com/browse/COOK-1604 *voteup*
[2012-09-24 18:22:28 -0400] matschaffer: is there a version of https://github.com/kisoku/chef-handler-mail that let's you set pony options? (e.g., sending via smtp?
[2012-09-24 18:27:12 -0400] edmundsalvacion: hi does anyone know how to resolve the Net::HTTPServerException: 404 "Not Found" - (Chef::Exceptions::SolrConnectionError) issue?
[2012-09-24 18:27:27 -0400] edmundsalvacion: at some point chef-solr failed, and upon restart chef-server is unable to communicate with it
[2012-09-24 18:27:38 -0400] edmundsalvacion: i am on chef 10.14.2
[2012-09-24 18:31:08 -0400] edmundsalvacion: lsof -i :8983 shows java to be listening on that port, and the process is up
[2012-09-24 18:37:36 -0400] edmundsalvacion: turns out it was a permissions error in the log directory
[2012-09-24 18:40:04 -0400] Eulipion: can someone help me with http://tickets.opscode.com/browse/COOK-1700
[2012-09-24 18:48:54 -0400] Eulipion: kallistec: http://tickets.opscode.com/browse/COOK-1700, any advise on how to debug?
[2012-09-24 18:49:26 -0400] rep0st: has anybody documented best practices for chef? or is it kinda adhoc right now?
[2012-09-24 18:54:02 -0400] matschaffer: rep0st: foodcritic helps
[2012-09-24 18:54:17 -0400] matschaffer: only covers code-level stuff, but it's a start
[2012-09-24 18:55:32 -0400] rep0st: matschaffer: i'll give it a shot. Any start is a good start. thanks!
[2012-09-24 18:57:46 -0400] chip-: rep0st: Chef isn't particularly opinionated software and the territory is pretty new, so I don't think there are hard & fast "this is what has worked in most cases" rules.
[2012-09-24 18:57:53 -0400] chip-: rep0st: that said, Food Fight podcast is a great place to start.
[2012-09-24 19:00:07 -0400] rep0st: chip: hum. I've been meaning to get into some podcasts for the commute in. I'll google it. Thanks.
[2012-09-24 19:04:44 -0400] Leitz: Is there a place to read about the move towards Erlang?
[2012-09-24 19:11:20 -0400] Leitz: Will there be a time in the near term we can embed Erlang in recipies?
[2012-09-24 19:13:54 -0400] geekbri_: chef-client is going to stay ruby
[2012-09-24 19:14:10 -0400] geekbri_: (it is particularly useful for writing internal dsl's)
[2012-09-24 19:14:40 -0400] yfeldblum: Leitz, you can do it now with the script/execute resources: http://www.erlang.org/doc/man/escript.html
[2012-09-24 19:15:44 -0400] geekbri_: well that is a resource you create.  Is that what he means by embed ?
[2012-09-24 19:16:07 -0400] geekbri_: who knows!
[2012-09-24 19:16:21 -0400] jtimberman: Eulipion: CHEF-3435 may resolve your issue.
[2012-09-24 19:17:18 -0400] Eulipion: jtimberman: thanks, i'll try that
[2012-09-24 19:17:45 -0400] jtimberman: rep0st: Opscode doesn't prescribe much because our goal is to provide you with primitives that you can use to solve your business problems. We do work with the foodcritic author on rules for correctness and style that follow what we generally teach in our training classes.
[2012-09-24 19:18:34 -0400] jtimberman: rep0st: we teach (via our training courses) practices that have been fairly widely adopted by the community at large, and we generally try to follow upstream or industry best practices for things that are setting policy on your systems.
[2012-09-24 19:18:45 -0400] rep0st: jtimberman: which i attended in nyc and someara is awesome.
[2012-09-24 19:18:45 -0400] miketheman: opscode will "teach a man to fish", and give you a pole. don't poke your eye out with it.
[2012-09-24 19:18:51 -0400] jtimberman: rep0st: he is! :)
[2012-09-24 19:18:57 -0400] jtimberman: miketheman: lol
[2012-09-24 19:19:51 -0400] geekbri_: "With great power comes great responsibility" - Uncle Ben, Opscode
[2012-09-24 19:20:35 -0400] miketheman: geekbri_:I used that line today with a user who now has push access to the chef repo.
[2012-09-24 19:20:48 -0400] geekbri_: I hope that he heeds the advice!
[2012-09-24 19:20:49 -0400] rep0st: jtimberman: i'm just grasping for as much information possible. trying to think ahead for when i eventually leave or if someone else takes responsibilty for deployment and configuration. that they don't dive into spaghetti code
[2012-09-24 19:20:51 -0400] geekbri_: he/she
[2012-09-24 19:20:55 -0400] Leitz: yfeldblum, thanks!
[2012-09-24 19:21:22 -0400] miketheman: rep0st: shameless self-promotion. https://github.com/miketheman/knife-role-spaghetti
[2012-09-24 19:23:09 -0400] geekbri_: Nice!
[2012-09-24 19:23:12 -0400] geekbri_: I'll have to star that
[2012-09-24 19:23:45 -0400] rep0st: miketheman: hah that's awesome.
[2012-09-24 19:24:31 -0400] miketheman: here's another one of my projects, if you're in to open-sourcing/sharing cookbooks: http://miketheman.github.com/knife-community/
[2012-09-24 19:24:36 -0400] mortuar: is it safe to just ask random chef questions here?
[2012-09-24 19:24:41 -0400] miketheman: jtimberman was nice enough to blog about it
[2012-09-24 19:24:57 -0400] Twirrim: mortuar: generally, yes
[2012-09-24 19:25:00 -0400] mortuar: I'm just getting started running into a problem.
[2012-09-24 19:25:31 -0400] geekbri_: miketheman: apologies for not reading the documentation on just running it yet, but will it handle properly the situation where my roles files are nested in sub directories ?
[2012-09-24 19:25:42 -0400] rep0st: can this chan be thought of as the moronic monday thread on /r/sysadmin ?
[2012-09-24 19:26:07 -0400] miketheman: geekbri_: good question. I don't know - I think it depends on whether Chef's role-loader can handle that
[2012-09-24 19:26:56 -0400] geekbri_: Well roles are stored flat on the chef server, but in my git repo I have them organized in sub directories
[2012-09-24 19:27:08 -0400] geekbri_: I assume this does some sort of mapping between the two since it needs role_path set?
[2012-09-24 19:27:10 -0400] bluepojo: mortuar: it's generally safe :)
[2012-09-24 19:27:22 -0400] miketheman: geekbri_: my plugin doesn't search chef-server, it uses local files only
[2012-09-24 19:27:36 -0400] jtimberman: http://www.opscode.com/blog/2012/09/17/community-authored-plugin-knife-community-release/
[2012-09-24 19:27:39 -0400] mortuar: Gonna throw this out in case anyone can help or has run into it before I have knife kicking off servers and bootstrapping, adding users/sshkeys/passwords - and that works fine however, when I go to run 'chef-client' just after the bootstrap it vomits complaining about ruby-shadow
[2012-09-24 19:27:42 -0400] geekbri_: ok well, when I install it i guess i'll find out!
[2012-09-24 19:27:44 -0400] jblaine1: jtimberman: NP man. I did the CLA dance a few days ago, been fixing tiny wiki things, and intend to get much more involved as I hit each cookbook we intend to use
[2012-09-24 19:27:59 -0400] miketheman: geekbri_: please report issues/suggestions via github issues.
[2012-09-24 19:27:59 -0400] jtimberman: jblaine1: Super awesome.
[2012-09-24 19:28:05 -0400] geekbri_: miketheman: will do.
[2012-09-24 19:28:22 -0400] mortuar: I'd much rather just not deal with passwords at all right now but that's not an option. ;)
[2012-09-24 19:28:39 -0400] jblaine1: jtimberman: It's the least I can do to counterbalance my bitching ;)
[2012-09-24 19:28:57 -0400] bluepojo: mortuar: what's the error you're getting?
[2012-09-24 19:29:03 -0400] bluepojo: mortuar: do you lack build tools?
[2012-09-24 19:29:06 -0400] matschaffer: mortuar: how are you installing/running chef-client?
[2012-09-24 19:29:22 -0400] matschaffer: bluepojo: also a good question :)
[2012-09-24 19:30:26 -0400] mortuar: bluepojo the error is "FATAL: Chef::Exceptions::MissingLibrary: user[user] (/var/chef/cache/cookbooks/users/providers/manage.rb line 73) had an error: Chef::Exceptions::MissingLibrary: You must have ruby-shadow installed for password support!"
[2012-09-24 19:30:31 -0400] leifmadsen: hey all -- I'm trying to figure out how to update minitest-chef-handler to use the new ::Chef::Platform.provider_for_resource() method. I can't seem to figure out exactly what the "action" argument should contain. This is what I've tried, and the error is the top half when running. It seems to not be injecting the new methods:  https://gist.github.com/3777809
[2012-09-24 19:30:36 -0400] jtimberman: jblaine1: have you done much at all with OmniOS? I've been using it as my "solaris" lately, because... well, it's free and easy to get.
[2012-09-24 19:30:53 -0400] mortuar: matschaffer I'm kicking the servers via 'knife rackspace server create' so it's bootstrapping at the same time.. which is why I'm confused that ruby-shadow is missing
[2012-09-24 19:31:11 -0400] mortuar: what confuses me more is that the initial run completes fine and the subsequent runs fail with that error
[2012-09-24 19:31:24 -0400] leifmadsen: mortuar: means the server doesn't have ruby-shadow installed and the user resource has a password defined
[2012-09-24 19:31:24 -0400] chip-: mortuar: ia ia shub niggurath!
[2012-09-24 19:31:24 -0400] chip-: er
[2012-09-24 19:31:25 -0400] chip-: ia ia chef niggurath!
[2012-09-24 19:31:25 -0400] chip-: or perhaps ia ia chef fthagn.
[2012-09-24 19:31:25 -0400] chip-: Man, lovecraft is a conversation-killer. What's up, mortuar?
[2012-09-24 19:31:33 -0400] matschaffer: mortuar: I suspect you're runing on two different rubies
[2012-09-24 19:32:18 -0400] mortuar: leifmadsen does typical chef bootstrapping through knife rackspace server create not throw ruby-shadow on when it compiles ?
[2012-09-24 19:32:31 -0400] jblaine1: jtimberman: No, just know of it. We're stuck in enterprise land with ~20 old Solaris 10 *SPARC* boxes at work. I loved them and the OS, but 2013 will be the migration year. Just going to end up as Linux boxes.
[2012-09-24 19:32:46 -0400] leifmadsen: mortuar: I've always had to install it via chef_gem to make it work, or have my server pre-provisioned with ruby-shadow installed
[2012-09-24 19:32:47 -0400] mortuar: matschaffer - it appears chef's bootstrap has thrown it's install in /opt/chef
[2012-09-24 19:33:07 -0400] leifmadsen: beyond that I don't know what a typical rackspace server had installed
[2012-09-24 19:33:09 -0400] matschaffer: should be omnibus them
[2012-09-24 19:33:13 -0400] matschaffer: s/them/then/
[2012-09-24 19:33:24 -0400] matschaffer: does `which chef-client` show /opt/chef/bin/chef-client?
[2012-09-24 19:33:30 -0400] mortuar: leifmadsen right on - i'll have to check out chef_gem.
[2012-09-24 19:33:37 -0400] jblaine1: jtimberman: Does OmniOS work on SPARC? I can't tell from the site.
[2012-09-24 19:33:41 -0400] rep0st: =( rackspace
[2012-09-24 19:33:45 -0400] jblaine1: seems unlikely
[2012-09-24 19:33:49 -0400] mortuar: matschaffer: [root@new-chef-test bin]# which chef-client
[2012-09-24 19:33:57 -0400] mortuar: woops - shows /usr/bin/chef-client
[2012-09-24 19:34:02 -0400] matschaffer: yeah
[2012-09-24 19:34:19 -0400] matschaffer: try running /opt/chef/bin/chef-client
[2012-09-24 19:34:26 -0400] mortuar: rep0st: I feel ya. I worked there for quite a while. ;)
[2012-09-24 19:34:47 -0400] mortuar: matschaffer: running now
[2012-09-24 19:35:07 -0400] jblaine1: mortuar: Likely a symlink to /opt/chef/bin/chef-client
[2012-09-24 19:35:18 -0400] rep0st: mortuar: one time a rackspace net-eng was working on our standby F5 and punted it...well yea he was working on the primary.
[2012-09-24 19:35:28 -0400] mortuar: matschaffer: same error
[2012-09-24 19:36:00 -0400] mortuar: rep0st: unfortunately not uncommon. I worked there for 6 years and our account (we're a customer now) has had the most ridiculous problems over the course of the last 1.5yr
[2012-09-24 19:36:08 -0400] mortuar: it would take me a day and a half to tell you about all of them.
[2012-09-24 19:36:36 -0400] mortuar: jblaine1: you're right :D
[2012-09-24 19:36:41 -0400] mortuar: it's a symlink
[2012-09-24 19:36:51 -0400] matschaffer: mortuar: does `/opt/chef/embedded/bin/gem list ruby-shadow` show anything?
[2012-09-24 19:36:51 -0400] jtimberman: jblaine1: oh - i don't know, i think its x86 only
[2012-09-24 19:37:15 -0400] rep0st: mortuar: lol i wonder if you ever worked on my account.
[2012-09-24 19:37:21 -0400] mortuar: matschaffer: it's empty
[2012-09-24 19:37:36 -0400] matschaffer: oh, weird. I wonder how I got my copy then
[2012-09-24 19:37:49 -0400] mortuar: rep0st: care to say who you were/are working with? ;)
[2012-09-24 19:37:50 -0400] matschaffer: I figured it came with the installer
[2012-09-24 19:38:26 -0400] mortuar: matschaffer: me too which is why I'm confused. more confused that it completes during the server kick and then fails on the subsequent run.
[2012-09-24 19:38:36 -0400] mortuar: I can't get the gem to install manually either
[2012-09-24 19:38:42 -0400] mortuar: btw I'm on CentOS 6.3
[2012-09-24 19:38:49 -0400] matschaffer: mortuar: do you set GEM_PATH anywhere?
[2012-09-24 19:38:54 -0400] matschaffer: the env var that is
[2012-09-24 19:39:02 -0400] mortuar: matschaffer: I haven't - should I?
[2012-09-24 19:39:17 -0400] matschaffer: no
[2012-09-24 19:39:44 -0400] mortuar: matschaffer: this is a completely fresh kick being set off by 'knife rackspace server create ...'
[2012-09-24 19:40:03 -0400] mortuar: and it's failing when it tries to look at setting the passwords on the subsequent runs (due to ruby-shadow missing)
[2012-09-24 19:40:09 -0400] matschaffer: mortuar: how about /opt/chef/embedded/lib/ruby/gems/1.9.1/gems
[2012-09-24 19:40:10 -0400] matschaffer: is there a ruby-shadow there?
[2012-09-24 19:40:10 -0400] mortuar: everything else is happy
[2012-09-24 19:40:33 -0400] mortuar: matschaffer: there is - ruby-shadow-2.1.4
[2012-09-24 19:40:48 -0400] mortuar: oh but you know what
[2012-09-24 19:40:57 -0400] mortuar: i think that was created when i tried a 'gem install ruby-shadow'
[2012-09-24 19:41:01 -0400] mortuar: that complained too
[2012-09-24 19:41:11 -0400] mortuar: yeah, timestamp is 28min older than all the other gems
[2012-09-24 19:42:00 -0400] jtimberman: jblaine1: confirmed: omniti doesn't have sparc builds of omnios.
[2012-09-24 19:42:23 -0400] matschaffer: hrm might help to see the full error, and the error that happens when you try to gem install it
[2012-09-24 19:42:33 -0400] mortuar: let me ask a different question is there any way to setup your own bootstrap to be used during a knife rackspace server create ?
[2012-09-24 19:42:42 -0400] mortuar: or can you only use custom bootstraps on a knife bootstrap
[2012-09-24 19:45:15 -0400] mortuar: matschaffer: /opt/chef/embedded/lib/ruby/1.9.1/mkmf.rb:368:in `try_do': The complier failed to generate an executable file. (RuntimeError)
[2012-09-24 19:45:16 -0400] mortuar: You have to install development tools first.
[2012-09-24 19:45:55 -0400] bluepojo: mortuar: now you need build-essential
[2012-09-24 19:46:05 -0400] bluepojo: or your OS's equivalent
[2012-09-24 19:46:21 -0400] Axsuul: thedeeno: Hey, I pushed to the repo if you wanna give it a try
[2012-09-24 19:46:40 -0400] leifmadsen: the problem is a chicken-and-egg one though -- you can't satisfy the build tools with build-essentials if you're using chef_gem because chef_gem attempts to build the gem prior to the executing of the build-essentials cookbook
[2012-09-24 19:47:04 -0400] bluepojo: no
[2012-09-24 19:47:05 -0400] leifmadsen: so build-essentials needs to be installed during bootstrap
[2012-09-24 19:47:08 -0400] bluepojo: you install during compile time
[2012-09-24 19:47:11 -0400] Axsuul: If anyone needs a monit cookbook, https://github.com/axsuul/cookbook-monit, would love some feedback as well
[2012-09-24 19:47:21 -0400] bluepojo: not during convergeance
[2012-09-24 19:47:37 -0400] bluepojo: I have a gist with an example, sec
[2012-09-24 19:47:37 -0400] leifmadsen: bluepojo: how do you get build-essentials to install at compile, not convergence
[2012-09-24 19:47:42 -0400] bluepojo: ^^
[2012-09-24 19:47:53 -0400] bluepojo: https://gist.github.com/3763909
[2012-09-24 19:48:05 -0400] bluepojo: change the action to :install or whatever makes sense for that resource
[2012-09-24 19:48:09 -0400] bluepojo: and it will run at compile time
[2012-09-24 19:48:39 -0400] matschaffer: mortuar: looks like it takes a template-file option: https://github.com/opscode/knife-rackspace/blob/master/lib/chef/knife/rackspace_server_create.rb#L92
[2012-09-24 19:48:51 -0400] leifmadsen: bluepojo: can you give a more thorough example?
[2012-09-24 19:48:59 -0400] bluepojo: there's not really more to it
[2012-09-24 19:49:04 -0400] bluepojo: but I can give a non-genericized version
[2012-09-24 19:49:07 -0400] leifmadsen: right
[2012-09-24 19:49:21 -0400] leifmadsen: show what you'd use for build-essentials to install at compile time so chef_gem can be used
[2012-09-24 19:49:37 -0400] matschaffer: mortuar: that's the gem install error, right?
[2012-09-24 19:50:00 -0400] bluepojo: leifmadsen: https://gist.github.com/3777939
[2012-09-24 19:50:00 -0400] bluepojo: oh
[2012-09-24 19:50:02 -0400] bluepojo: um
[2012-09-24 19:50:09 -0400] bluepojo: I can write that as well
[2012-09-24 19:50:10 -0400] matschaffer: I guess what confuses me is that omnibus should ship with a pre-compiled version
[2012-09-24 19:50:13 -0400] matschaffer: I'd be curious to start from scratch and see what `gem list ruby-shadow` returns
[2012-09-24 19:50:36 -0400] leifmadsen: I've always had to install ruby-shadow on anything I've used :)
[2012-09-24 19:51:09 -0400] mortuar: matschaffer: i'm not seeing a gem install error that you posted? sorry
[2012-09-24 19:51:35 -0400] matschaffer: I mean what you posted. -> /opt/chef/embedded/lib/ruby/1.9.1/mkmf.rb:368:in `try_do': The complier failed to generate an executable file. (RuntimeError)
[2012-09-24 19:51:39 -0400] bluepojo: leifmadsen: I haven't tested, but I suspect this should work https://gist.github.com/3777946
[2012-09-24 19:51:48 -0400] mortuar: leifmadsen I'm confused why it would run fine during the server kick/bootstrap, setting passwords along the way but would fail on a second run
[2012-09-24 19:52:08 -0400] matschaffer: that's what happens when you try to gem install ruby-shadow, right?
[2012-09-24 19:52:27 -0400] mortuar: yes
[2012-09-24 19:52:38 -0400] leifmadsen: bluepojo: hmm interesting -- I'll have to try that little tidbit out so I don't have to work around chef_gem stuff in my kickstart/preseed file
[2012-09-24 19:52:53 -0400] leifmadsen: bluepojo: thanks -- I asked that question on the mailing list a few weeks back, and hadn't seen that used before :)
[2012-09-24 19:53:02 -0400] bluepojo: sure :D
[2012-09-24 19:57:20 -0400] jb__: any chance to get node-json-data from chef-server ready to be used with chef-solo (-j)?
[2012-09-24 19:57:24 -0400] yfeldblum: better to install build-essential during bootstrap IMO
[2012-09-24 19:57:39 -0400] hoover_damm: jb__, better chance of building it  by hand
[2012-09-24 19:57:48 -0400] jb__: hoover_damm: i need it automated
[2012-09-24 19:57:51 -0400] bluepojo: leifmadsen: just occurred to me that you probably don't need the block at all: https://gist.github.com/3777946
[2012-09-24 19:57:55 -0400] matschaffer: mortuar: me too. My theory is that omnibus is installing the ruby-shadow gem, then something else is coming in and messing up the installed one
[2012-09-24 19:58:01 -0400] hoover_damm: jb__, use require 'json'?
[2012-09-24 19:58:07 -0400] leifmadsen: bluepojo: nice
[2012-09-24 19:58:13 -0400] jb__: hoover_damm: by now i have to edit the json and kick out the "normal" hirachie
[2012-09-24 19:58:30 -0400] hoover_damm: jb__, right use something to automate writing the json
[2012-09-24 19:58:31 -0400] jb__: thats the only thing that prevents that it works
[2012-09-24 19:58:38 -0400] hoover_damm: s/right/write
[2012-09-24 19:58:49 -0400] hoover_damm: jb__, your doing it too hard
[2012-09-24 19:58:54 -0400] jb__: hoover_damm: why?
[2012-09-24 19:59:13 -0400] hoover_damm: jb__, you can write a ruby script to spit out the json fairly easily... then make that script know what you want to change
[2012-09-24 19:59:21 -0400] hoover_damm: jb__, so you don't have to be json right
[2012-09-24 19:59:33 -0400] jblaine1: jtimberman: As requested http://tickets.opscode.com/browse/COOK-1702 (Solaris vs. Opscode ntp cookbook)
[2012-09-24 19:59:36 -0400] hoover_damm: jb__, i can't speak for anyone else in here but I ugh when my json validates
[2012-09-24 19:59:41 -0400] hoover_damm: err fails to validte
[2012-09-24 19:59:44 -0400] hoover_damm: validate*
[2012-09-24 19:59:55 -0400] jtimberman: jblaine1: thanks!
[2012-09-24 20:00:06 -0400] yfeldblum: jb__, the basic idea of chef-solo is that you will either (a) write node data json files by hand or (b) automate them somehow that probably isn't chef-server because otherwise you would have used chef-client
[2012-09-24 20:00:44 -0400] hoover_damm: if you have a common task that you have to do often... automate it
[2012-09-24 20:00:56 -0400] jb__: yfeldblum: ye. but actually the json data coming from chef-server is usable by chef-solo when you just remove the "normal": { } section
[2012-09-24 20:01:15 -0400] yfeldblum: jb__, as hoover_damm indicates, simple ruby scripts to start with data and spit out json files are really easy
[2012-09-24 20:01:34 -0400] yfeldblum: jb__, indeed, but why are you mixing things not designed to be mixed?
[2012-09-24 20:02:33 -0400] yfeldblum: jb__, i mean you could write a ruby script that fetches the node data from chef-server-api, merges the normal value upward, and writes out a json file suitable for chef-client
[2012-09-24 20:02:45 -0400] jb__: yfeldblum: why shouldnt node-data be used in both contexts? after all chef-solo also needs node-data to run, so..
[2012-09-24 20:03:05 -0400] jb__: yfeldblum: ye. good idea. going to do that
[2012-09-24 20:03:12 -0400] jb__: thanks hoover_damm too
[2012-09-24 20:03:35 -0400] yfeldblum: jb__, just to be clear, i'm not the one saying it's a good idea ...
[2012-09-24 20:04:18 -0400] hoover_damm: it's a idea that is ugh that would work
[2012-09-24 20:04:49 -0400] hoover_damm: as my penchant for clojure is still around i've been just using cheshire to generate json blobs
[2012-09-24 20:04:52 -0400] hoover_damm: got tired or require 'json' heh
[2012-09-24 20:06:14 -0400] jb__: yfeldblum: ye, but, if you dont want to upload the cookbook after each small change in development? how would you handle it then, if not with chef-solo?
[2012-09-24 20:07:09 -0400] yfeldblum: jb__, there are many possible approaches; it's not a choice between just two things
[2012-09-24 20:07:14 -0400] bluepojo: any feature not handled by chef-solo gets mocked out by library functions that return default or locally calculated values in our cookbooks
[2012-09-24 20:07:22 -0400] bluepojo: so we can test in vagrant with chef-solo
[2012-09-24 20:07:24 -0400] jb__: yfeldblum: i'm happy to hear about more alternatives
[2012-09-24 20:07:40 -0400] bluepojo: if Chef::Config[:solo]
[2012-09-24 20:08:21 -0400] jb__: bluepojo: good idea though
[2012-09-24 20:08:58 -0400] cheeseplus: you could also build the mocked out json into the Vagrantfile and version that
[2012-09-24 20:09:03 -0400] yfeldblum: jb__, some people use a post-receive hook that syncs the chef-server to the new git state
[2012-09-24 20:09:14 -0400] cheeseplus: depending on how much json you are trying to keep track of
[2012-09-24 20:09:26 -0400] bluepojo: post-receive hooks are a terrible idea unless you are also bumping the version number automatically
[2012-09-24 20:09:27 -0400] jb__: yfeldblum: i dont want to commit/push either?
[2012-09-24 20:09:47 -0400] bluepojo: you never want to have 2 cookbooks that are the same version with different code.
[2012-09-24 20:09:52 -0400] bluepojo: cause they'll squash eachother
[2012-09-24 20:10:06 -0400] bluepojo: (side note: always freeze your cookbooks on the server so this doesn't happen :D )
[2012-09-24 20:11:18 -0400] jb__: true
[2012-09-24 20:11:25 -0400] jb__: thanks for the inspiration guys
[2012-09-24 20:11:33 -0400] jb__: i'll figure that out
[2012-09-24 20:11:45 -0400] yfeldblum: bluepojo, they're not a terrible idea in general; they're a terrible idea sometimes, depending on the details of the case, and a great idea other times, again depending on the details of the case
[2012-09-24 20:12:47 -0400] bluepojo: yfeldblum: that's the most nonanswer of an answer possible XD
[2012-09-24 20:13:05 -0400] bluepojo: I have personally never seen a reason to squash cookbooks on the chef server so I only have reasons why not to do it.
[2012-09-24 20:13:47 -0400] yfeldblum: bluepojo, you do it when you consider git-push to be your deploy mechanism
[2012-09-24 20:14:21 -0400] yfeldblum: bluepojo, similar to how you can use git-push to deploy an application to various application hosting services such as heroku
[2012-09-24 20:15:03 -0400] bluepojo: right, but I was talking about in the absence of autoversion bumping
[2012-09-24 20:15:11 -0400] yfeldblum: bluepojo, me too
[2012-09-24 20:15:26 -0400] bluepojo: versioning becomes meaningless if you have more than one of the same version
[2012-09-24 20:15:53 -0400] yfeldblum: bluepojo, then don't version
[2012-09-24 20:16:23 -0400] bluepojo: how do you handle dependencies and conflicts if you don't version?
[2012-09-24 20:16:25 -0400] yfeldblum: bluepojo, if it's meaningless in case A, then don't use it in case A
[2012-09-24 20:17:01 -0400] bluepojo: how do you do rollbacks if you don't version?
[2012-09-24 20:17:13 -0400] bluepojo: I suppose that'll work in the simplest of cases
[2012-09-24 20:17:19 -0400] bluepojo: most people don't work in simple cases, tho
[2012-09-24 20:17:27 -0400] yfeldblum: bluepojo, use librarian-chef to get a complete & consistent resolution of cookbooks, and sync git to the chef-server on git-push
[2012-09-24 20:18:19 -0400] yfeldblum: bluepojo, rollback is just looking at the git-reflog, rolling back to that, and re-syncing
[2012-09-24 20:18:43 -0400] bluepojo: and then what do your QA environments do?
[2012-09-24 20:18:52 -0400] bluepojo: suck it up and get their cookbooks squashed?
[2012-09-24 20:19:06 -0400] bluepojo: use a whole separate chef server?
[2012-09-24 20:19:14 -0400] yfeldblum: bluepojo, sync to the QA infrastructure's chef-server when you git-push to the QA branch or to the QA remote
[2012-09-24 20:19:28 -0400] bluepojo: and turn off chef-client's daemon mode?
[2012-09-24 20:19:38 -0400] bluepojo: so it doesn't accidentally check in while the QA cookbooks are on there?
[2012-09-24 20:19:51 -0400] bluepojo: sounds like a lot of headache just so you don't have to use proper versioning
[2012-09-24 20:21:14 -0400] yfeldblum: bluepojo, so trigger runs instead of using daemon mode?
[2012-09-24 20:21:27 -0400] yfeldblum: bluepojo, the point i'm trying to make is that there are many ways to do it
[2012-09-24 20:21:30 -0400] bluepojo: also known as: build your own solution instead of use chef primatives
[2012-09-24 20:21:36 -0400] bluepojo: I mean sure, you can do anything you want
[2012-09-24 20:21:39 -0400] bluepojo: some are not as intelligent as others
[2012-09-24 20:22:17 -0400] bluepojo: I'm not going to tell someone to do less intelligent things so when they eventually turn successful they're unable to scale
[2012-09-24 20:22:23 -0400] bluepojo: cause they decided that not versioning was ok
[2012-09-24 20:22:23 -0400] leifmadsen: I'm making a change to how some software is loading ::Chef::Provider.provider_for_resources(...), but since it is different between Chef versions, I'm curious how best to add in a check so it loads correctly based on the installed version of chef?
[2012-09-24 20:22:27 -0400] yfeldblum: bluepojo, indeed, but who says that the primitives are the best thing to use, or that some particular way to use the primitives is the best approach?
[2012-09-24 20:22:53 -0400] yfeldblum: bluepojo, git does the versioning already ...
[2012-09-24 20:23:18 -0400] bluepojo: and forces you to turn off key components like daemon mode
[2012-09-24 20:23:42 -0400] bluepojo: I've been down that route, trying to build extras on top of chef. I learned my lesson when I tried to scale my infrastructure
[2012-09-24 20:23:54 -0400] bluepojo: I'm going to give advice that fits that experience
[2012-09-24 20:24:08 -0400] bluepojo: and doing everything with a git repo is not scalable.
[2012-09-24 20:24:30 -0400] bluepojo: just "cause it works" doesn't mean it's the right solution
[2012-09-24 20:24:36 -0400] yfeldblum: bluepojo, indeed
[2012-09-24 20:24:47 -0400] bluepojo: so don't tell people "sure, do it that way, cause it works"
[2012-09-24 20:25:29 -0400] yfeldblum: bluepojo, i'm not - i'm telling you that while your way may work for you, based on the details of your case, it's not the only workable approach
[2012-09-24 20:25:40 -0400] bluepojo: fair enough
[2012-09-24 20:26:39 -0400] rep0st: i know chef isn't really opinionated. but i mean the whole reason why people want to use chef is for the ability to scale. Maybe there should be some best practice on scaling.
[2012-09-24 20:26:50 -0400] rep0st: or maybe just tell people to read john allspaw's book lol
[2012-09-24 20:31:36 -0400] bluepojo: yeah, a chef best practices book would be a welcome thing
[2012-09-24 20:31:48 -0400] bluepojo: I know there's a book coming out next year
[2012-09-24 20:31:50 -0400] bluepojo: august
[2012-09-24 20:31:51 -0400] mortuar: bluepojo rep0st I concur.
[2012-09-24 20:32:00 -0400] bluepojo: http://vialstudios.com/guide-authoring-cookbooks.html
[2012-09-24 20:32:03 -0400] bluepojo: reset wrote this
[2012-09-24 20:32:05 -0400] bluepojo: it's not complete
[2012-09-24 20:32:07 -0400] bluepojo: but it's very good
[2012-09-24 20:32:15 -0400] bluepojo: it's how we do cookbooks at Riot
[2012-09-24 20:59:06 -0400] Pushnell: I'm trying to use the application_python cookbook for the first time.  looks like it is calling 'pip -E' but the -E flag is gone in pip 1.1 so the recipe fails.  Anyone else experience this / know the correct workaround?  (django is not my specialty ...)
[2012-09-24 21:02:34 -0400] jtimberman: rep0st: scaling in what way?
[2012-09-24 21:06:49 -0400] rep0st: jtimberman: any form of scaling honestly. My comment was in reference to preventing one self from creating a cookbook and pidgeon holing your self into something that would make it a headache to scale out because an engineer decided to do xyz because it "just worked"
[2012-09-24 21:08:08 -0400] rep0st: jtimberman: i for one am not coming from a programming background. But i do understand certain concepts and can most definitely have things "just work" but it might not be the best practice to future proof my infrastructure in case i get hit by a bus
[2012-09-24 21:08:54 -0400] mortuar: rep0st: I'm in the same position as you
[2012-09-24 21:09:03 -0400] mortuar: <--- engineer, not so much de
[2012-09-24 21:09:04 -0400] mortuar: dev*
[2012-09-24 21:21:04 -0400] Axsuul: I notice that for some cookbooks when they use the Template resource, nothing gets output to the log. How can I achieve this?
[2012-09-24 21:21:41 -0400] Axsuul: or am I tripping
[2012-09-24 21:37:32 -0400] carlp: Could someone point me in right direction on how to use the platform resource?  When I try to use it in a case statement I get the error "NameError: Cannot find a resource for platform on ubuntu version 12.04
[2012-09-24 21:38:45 -0400] yfeldblum: carlp, there isn't any platform resource
[2012-09-24 21:42:40 -0400] ranjibd: carlp, are you referring to the platform attribute ?
[2012-09-24 21:46:07 -0400] _0x783czar: I was trying to install Chef Server on an Ubuntu Machine for the first time (up until now I've only done it on CentOS) following the instructions at http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo
[2012-09-24 21:46:27 -0400] _0x783czar: Chef's error out-put was this: http://pastebin.com/hWRCNF0f
[2012-09-24 21:46:48 -0400] carlp: ranjibd: Maybe?
[2012-09-24 21:47:05 -0400] carlp: ranjibd: My goal is "on ubuntu do this, on fedora do this"
[2012-09-24 21:47:11 -0400] _0x783czar: Chef's It blames a particular command as having errored, so I ran it maunally and go this output: http://pastebin.com/gKW4HBJ0
[2012-09-24 21:47:18 -0400] ranjibd: carlp, node.platform is the way you access that inside a recipe..
[2012-09-24 21:47:34 -0400] _0x783czar: And here's the Stacktrace: http://pastebin.com/G6GL93ZY
[2012-09-24 21:47:45 -0400] ranjibd: carlp, also take a look at the value_for_platform helper method
[2012-09-24 21:48:30 -0400] bluepojo: carlp: it's common practice to case on node[:platform]
[2012-09-24 21:48:48 -0400] bluepojo: case node[:platform]; when 'centos'; when 'ubuntu'; etc
[2012-09-24 21:49:47 -0400] carlp: bluepojo: OK, I was just missing the node part.  Thanks!
[2012-09-24 21:49:57 -0400] carlp: ranjibd, bluepojo : thanks!
[2012-09-24 21:55:52 -0400] jtimberman: Eulipion: a release candidate of chef is available on rubygems.org if you want to test the deploy provider problem you were experiencing, version: 10.14.4.rc.0
[2012-09-24 21:56:10 -0400] jtimberman: Eulipion: if you used the full stack package, on a test system update with: /opt/chef/embedded/bin/gem install chef --pre
[2012-09-24 21:56:45 -0400] jtimberman: Eulipion: and if that fixes the issue, please update COOK-1700
[2012-09-24 22:28:42 -0400] _0x783czar: OK, has anyone ever had trouble installing Chef-Server on Ubuntu 12.04?
[2012-09-24 22:30:10 -0400] rava: what issues are you having? gem or deb install?
[2012-09-24 22:30:40 -0400] rava: i had issues during install using special characters for the rabbitmq password, if you pass in something that can be evaluated by the shell it breaks the install process
[2012-09-24 22:31:04 -0400] _0x783czar: rava I'm using the chef-solo method.
[2012-09-24 22:31:31 -0400] rava: _0x783czar: that could still be via gems or deb packages :)
[2012-09-24 22:32:34 -0400] _0x783czar: rava: true, I'm following this guide: http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo
[2012-09-24 22:32:54 -0400] _0x783czar: rava: so it's through gems I believe
[2012-09-24 22:33:31 -0400] _0x783czar: rava: the problem I'm having is that it fails when it trys to install CouchDB
[2012-09-24 22:33:41 -0400] _0x783czar: rava: I get some weird errors.
[2012-09-24 22:34:00 -0400] _0x783czar: rava: http://pastebin.com/hWRCNF0f
[2012-09-24 22:38:16 -0400] rava: _0x783czar: what's in the stack trace referenced?
[2012-09-24 22:39:13 -0400] _0x783czar: rava: http://pastebin.com/G6GL93ZY
[2012-09-24 22:40:04 -0400] rava: _0x783czar: Chef::Exceptions::Exec: apt-get -q -y install couchdb=1.0.1-0ubuntu18 returned 100, expected 0 is the problem
[2012-09-24 22:40:13 -0400] rava: _0x783czar: run that command manually and see why it's puking
[2012-09-24 22:40:29 -0400] _0x783czar: rava: already did here it is http://pastebin.com/gKW4HBJ0
[2012-09-24 22:40:45 -0400] _0x783czar: rava: I'm wondering if it's a problem with locales
[2012-09-24 22:41:11 -0400] rava: _0x783czar: do you have chef-client running on that machine?
[2012-09-24 22:41:31 -0400] _0x783czar: rava: yes (well chef-solo)
[2012-09-24 22:41:42 -0400] rava: _0x783czar: last time i checked, the chef-client recipe changes perms on /var/run/chef and /var/log/chef
[2012-09-24 22:42:02 -0400] rava: _0x783czar: to root:root, which makes chef-server bail because it runs as chef:chef
[2012-09-24 22:42:16 -0400] rava: see what user couchdb wants to run as
[2012-09-24 22:42:25 -0400] rava: and what the perms are on those folders when it tries to kick up
[2012-09-24 22:42:33 -0400] _0x783czar: rava: well I'm not running the chef-client cookbook, if that's what you're asking
[2012-09-24 22:43:26 -0400] rava: _0x783czar: i'd remove through apt couchdb, run apt-get clean all, and try installing it manually again
[2012-09-24 22:43:46 -0400] _0x783czar: rava: alright
[2012-09-24 22:43:53 -0400] rava: _0x783czar: if you haven't already run through all that, otherwise take a look at the post-install script for that pkg
[2012-09-24 22:44:26 -0400] rava: _0x783czar: and trace what's going on in the phase where it's trying to kick up couchdb
[2012-09-24 22:47:06 -0400] rava: _0x783czar: ubuntu package details: https://wiki.ubuntu.com/PackagingGuide/Basic#postinst_and_prerm
[2012-09-24 22:53:19 -0400] _0x783czar: rava: alright, I'll have a look at that
[2012-09-24 22:53:37 -0400] _0x783czar: rava: I got part of the error fixed by installing locales
[2012-09-24 22:53:54 -0400] rava: _0x783czar: groovy
[2012-09-24 22:54:05 -0400] rava: which part is still broken?
[2012-09-24 22:54:36 -0400] _0x783czar: rava: this is the output now http://pastebin.com/ywznS86s
[2012-09-24 22:55:47 -0400] rava: what's an ls -al /var/run | grep couch show you for permissions?
[2012-09-24 22:56:17 -0400] _0x783czar: rava: no output
[2012-09-24 23:03:32 -0400] rava: _0x783czar: a bit involved, but try running through: http://blog.scriptedmotion.com/?p=78
[2012-09-24 23:10:22 -0400] _0x783czar: rava: thanks that might help
[2012-09-24 23:11:25 -0400] _0x783czar: rava: never mind got it to work, but only doing so manually by manually editing the initscript.  There seems to be a problem with how the "couchdb" user is getting configured.
[2012-09-24 23:11:37 -0400] _0x783czar: by changing that user to root everything works fine
[2012-09-24 23:11:51 -0400] rava: _0x783czar: yeah, had to be something along those lines
[2012-09-24 23:12:24 -0400] rava: _0x783czar: either the user wasn't created right, or the process launched as the user before the right folders had the right perms, etc.
[2012-09-24 23:12:41 -0400] _0x783czar: rava: it's a real pain, gotta figure out if there's a way to make it work automatically
[2012-09-24 23:13:36 -0400] rava: _0x783czar: try a fresh vm and run that apt command manually, if it still fails then it's problem with the deb package and file a bug report
[2012-09-24 23:14:00 -0400] rava: _0x783czar: haven't looked at the cookbooks involved for that install, they might be adding a ppa for the version of couch to install or some such
[2012-09-24 23:14:25 -0400] Axsuul: Hmm am I reading this correctly? So nodes don't have the default_attributes and override_attributes?
[2012-09-24 23:15:03 -0400] _0x783czar: rava: this isn't a vm, it's a VPS container.  and I've already rebuilt the container once, so I'm thinking it might need a bug report.  But we're making sure to cover all our bases here.
[2012-09-24 23:15:49 -0400] cheeseplus: Axsuul: what context?
[2012-09-24 23:16:33 -0400] Axsuul: cheeseplus: https://gist.github.com/
[2012-09-24 23:16:57 -0400] rava: Axsuul: empty gist
[2012-09-24 23:17:03 -0400] cheeseplus: Axsuul: try again!
[2012-09-24 23:17:04 -0400] Axsuul: Oops
[2012-09-24 23:17:05 -0400] Axsuul: https://gist.github.com/752b254b4386036df431
[2012-09-24 23:17:48 -0400] Axsuul: try to set node['application']['staging'] depending on the node
[2012-09-24 23:18:07 -0400] Axsuul: but it's not setting, and from the documentation @ http://wiki.opscode.com/display/chef/Attributes
[2012-09-24 23:18:11 -0400] Axsuul: it looks like it's not supported?
[2012-09-24 23:18:30 -0400] rava: Axsuul: that looks like stuff you'd set in a role
[2012-09-24 23:19:09 -0400] Axsuul: rava: hmm cause I have 3 different machines that will share the same role, but I want one attribute to be different which is the environment
[2012-09-24 23:20:13 -0400] rava: Axsuul: use a chef environment and assign that value based on what environment the node is in?
[2012-09-24 23:21:09 -0400] rava: or just set those attributes in the env definition
[2012-09-24 23:21:49 -0400] rava: Axsuul: http://wiki.opscode.com/display/chef/Environments#Environments-attributes
[2012-09-24 23:22:41 -0400] cheeseplus: Axsuul: if you try override_attributes does that work?
[2012-09-24 23:23:18 -0400] Axsuul: rava: unfortunately I use littlechef, and environments aren't supported =/
[2012-09-24 23:23:44 -0400] Axsuul: cheeseplus: nope
[2012-09-24 23:24:09 -0400] rava: Axsuul: sadness. i'm a big fan of chef environments, i've no experience with littlechef, sorry
[2012-09-24 23:25:27 -0400] cheeseplus: Axsuul: so that is odd, at the very least the override ones should take precedence
[2012-09-24 23:26:02 -0400] cheeseplus: the only way those would be supplanted is if ohai also is using that exact namespace
[2012-09-24 23:27:26 -0400] cheeseplus: although with littlechef it could be a bug?
[2012-09-24 23:28:16 -0400] Axsuul: cheeseplus: hmm maybe, ya i'm using a different namespace and still not there.
[2012-09-24 23:28:55 -0400] cheeseplus: perhaps something wrong with the json
[2012-09-24 23:29:09 -0400] cheeseplus: one of the nice things is that chef-server spits it back at you if it's wrong ;)
[2012-09-24 23:29:41 -0400] Axsuul: cheeseplus: ya littlechef does that too :)
[2012-09-24 23:29:57 -0400] cheeseplus: oh well then that isn't a problem
[2012-09-24 23:31:50 -0400] Axsuul: cheeseplus: ah duh, since it's a node attribute, setting it directly on the node works
[2012-09-24 23:34:23 -0400] Axsuul: cheeseplus, rava: this works =p https://gist.github.com/752b254b4386036df431
[2012-09-24 23:34:57 -0400] Axsuul: thanks for the help
