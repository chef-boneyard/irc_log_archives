[2012-09-13 00:05:29 -0400] psykidellic: I would be interested in answer to that too. I am trying to understand how to override default attributes, e.g. with the opscode nginx recipe, I am trying to disable the default site so I did: default["nginx"]["default_site_enabled"] = false and it does not seem to work.
[2012-09-13 00:11:19 -0400] Pushnell: I think #opscode is asleep
[2012-09-13 00:12:10 -0400] hoover_damm: try #chef
[2012-09-13 00:12:23 -0400] Pushnell: 20 goto 10
[2012-09-13 00:13:06 -0400] hoover_damm: default[:bob][:bill]="boo"
[2012-09-13 00:13:18 -0400] hoover_damm: put that in a recipe and ensure that recipe is in the runlist or depended on
[2012-09-13 00:13:28 -0400] hoover_damm: then node[:bob][:bill] should be boo
[2012-09-13 00:13:47 -0400] hoover_damm: note using 'bob' or :bob is preference
[2012-09-13 00:13:48 -0400] Pushnell: So strings are no good but symbols are?
[2012-09-13 00:14:00 -0400] hoover_damm: it should not make or break anything
[2012-09-13 00:14:20 -0400] Pushnell: I'll try converting all of my attributes to symbols but I don't know why strings are bad
[2012-09-13 00:14:43 -0400] hoover_damm: that shouldn't make or break it
[2012-09-13 00:14:55 -0400] hoover_damm: verify it's in your runlist, run chef-client -l debug
[2012-09-13 00:14:57 -0400] hoover_damm: look harder
[2012-09-13 00:16:56 -0400] Pushnell: I'm not not looking hard.  I'm a noob, and trying to figure out how/where to look.
[2012-09-13 00:19:45 -0400] fish_: hrm, looks like solr got deployed to /solr but chef-expander expects it to be a /
[2012-09-13 00:20:05 -0400] hoover_damm: fish_, deployed the war yourself?
[2012-09-13 00:20:21 -0400] fish_: hoover_damm: nope, guess chef-solr-installer did that
[2012-09-13 00:20:27 -0400] hoover_damm: neat
[2012-09-13 00:20:50 -0400] hoover_damm: fish_, solr logs?
[2012-09-13 00:20:59 -0400] hoover_damm: maybe they can be helpful
[2012-09-13 00:21:10 -0400] hoover_damm: Pushnell, start with -l debug, verify it's in the runlist
[2012-09-13 00:23:30 -0400] fish_: hoover_damm: well, neither solr nor chef-expander seem to be very talky. I've started both with -l debug but expander is just saying 'Failed to post to solr' and solr isn't saying anything at all
[2012-09-13 00:23:41 -0400] fish_: hoover_damm: I had to run a tcpdump to see whats going on
[2012-09-13 00:24:19 -0400] hoover_damm: fish_, well without solr on / it won't work right...
[2012-09-13 00:24:22 -0400] fish_: hoover_damm: that showed that chef-expander is doinga POST /update and solr responds with a 404
[2012-09-13 00:24:51 -0400] hoover_damm: yep
[2012-09-13 00:24:55 -0400] fish_: hoover_damm: maybe a bug with chef-solr-installer?
[2012-09-13 00:25:20 -0400] fish_: no idea why it put solr on /solr not /
[2012-09-13 00:26:13 -0400] hoover_damm: fish_, http://wiki.opscode.com/display/chef/Chef+Configuration+Settings#ChefConfigurationSettings-solrsettings
[2012-09-13 00:26:21 -0400] hoover_damm: fish_, basically update the configuration file to know the right path
[2012-09-13 00:26:44 -0400] hoover_damm: fish_, there was another user reporting the same issue 7-18 (in my logs) and that's what he did
[2012-09-13 00:27:25 -0400] hoover_damm: fish_, basically I've logged chef shortly since I started using chef in 2009... and have archived a few years of irclogs of it at http://logs.likens.us/
[2012-09-13 00:27:33 -0400] hoover_damm: fish_, and yes you can google that
[2012-09-13 00:27:44 -0400] hoover_damm: fish_, site:logs.likens.us somerandomquestion
[2012-09-13 00:30:03 -0400] fish_: hoover_damm: yep, changing that url would be the next thing. but I'm wondering a bit why it was deploed to /solr in the first place
[2012-09-13 00:34:31 -0400] fish_: ah damn
[2012-09-13 00:35:20 -0400] fish_: ah never mind, works now \o/
[2012-09-13 00:46:55 -0400] v1n3: anyone out there have a good redis cookbook
[2012-09-13 00:46:57 -0400] v1n3: ?
[2012-09-13 01:06:50 -0400] hoover_damm: v1n3, there's several on the community site
[2012-09-13 01:07:05 -0400] v1n3: they both have 2 stars
[2012-09-13 01:07:41 -0400] v1n3: well, all 4 of them have 2 stars
[2012-09-13 01:07:42 -0400] v1n3: http://community.opscode.com/search?query=redis&scope=cookbook
[2012-09-13 01:07:45 -0400] hoover_damm: redisio has 4 stars
[2012-09-13 01:07:56 -0400] v1n3: ok, nm
[2012-09-13 01:09:48 -0400] v1n3: thanks hoover_damm, my google foo kept bringing me back to 2 star results
[2012-09-13 02:25:57 -0400] williamherry: there are one resource is defined from other cookbook, how can chef find it?
[2012-09-13 02:56:29 -0400] zts: williamherry: when you use the resource, its name is cookbook_resource.  Eg, the "repository" resource in the "apt" cookbook is called "apt_repository" when you use it
[2012-09-13 02:56:50 -0400] zts: williamherry: see http://wiki.opscode.com/display/chef/Lightweight+Resources+and+Providers
[2012-09-13 02:58:19 -0400] williamherry: zts, so resource monitoring_procmon will look for cookbook monitoring and then procmon.rb file under resources directory?
[2012-09-13 02:58:25 -0400] williamherry: zts, thanks a lot
[2012-09-13 03:00:43 -0400] zts: exactly
[2012-09-13 06:13:30 -0400] mrafa: Hi, I am facing issues running minitest handler on windows. I am running Chef 0.10.6 . Initially the chef_gem died so as a test, I installed the gem manually and then ran the minitest handler with a simple test to check if a file is available.
[2012-09-13 06:15:15 -0400] mrafa: The errors that I face are here - http://pastebin.com/HAwV5qcy
[2012-09-13 06:15:26 -0400] mrafa: Has anyone had similar trouble ?
[2012-09-13 06:18:49 -0400] mrafa: The same setup works  perfectly fine on Centos
[2012-09-13 06:46:58 -0400] ssd7: Ohai Chefs
[2012-09-13 06:49:36 -0400] j4m3s: ohai
[2012-09-13 06:50:38 -0400] j4m3s: what's the best way to restart cron from a recipe? i am using the cron resource to create a cron job entry but cron isn't running
[2012-09-13 06:51:44 -0400] j4m3s: ssd7, maybe you know? ^^
[2012-09-13 06:52:22 -0400] meineerde: j4m3s: https://github.com/opscode-cookbooks/cron
[2012-09-13 06:53:16 -0400] ssd7: You can manage the cron service with a service resource and then notify a restart.
[2012-09-13 06:54:02 -0400] ssd7: However, dpending on how you are adding your entry you don't necessarily need to restart
[2012-09-13 06:54:20 -0400] ssd7: if your cron supports .d style config, it should read new entries everytime it wakes up
[2012-09-13 06:54:43 -0400] j4m3s: ssd7, it's on centos6 http://pastie.org/private/r8agprgtu9etlbjbhvgnyg
[2012-09-13 06:56:54 -0400] ssd7: On its face, that looks right to me.
[2012-09-13 06:57:42 -0400] j4m3s: ssd7, FATAL: Chef::Exceptions::ResourceNotFound: resource cron[freeswitch] is configured to notify resource service[cron] with action restart, but service[cron] cannot be found in the resource collection. cron[freeswitch] is defined in /var/chef_solo/cookbooks/freeswitch/recipes/whistle.rb:275:in `from_file
[2012-09-13 06:58:09 -0400] ssd7: Right, so you need to have a service resource from cron somewhere before that in your cookbooks
[2012-09-13 06:58:18 -0400] ssd7: one easy way would be the cookbook that meineerde linked to
[2012-09-13 06:59:02 -0400] j4m3s: if i include that recipe in will i have access to that resource?
[2012-09-13 07:00:16 -0400] ssd7: Yes, althougth I believe the service name in that cookbook will be crond
[2012-09-13 07:00:23 -0400] ssd7: so service[crond]
[2012-09-13 07:01:06 -0400] ssd7: although, you really shouldn't need to restart cron, it should notice changes
[2012-09-13 07:01:08 -0400] j4m3s: thanks ssd7 & meineerde i'm still quite new
[2012-09-13 07:02:12 -0400] alex88: hi guys, i've this http://pastebin.com/Bqwqfxae databag in folder data_bags/myapp/deploy_settings.json but using chef solo via vagrant i see "Failed to load data bag item: "imagefog" "deploy_settings" how can i get more error on why it fails?
[2012-09-13 07:02:25 -0400] j4m3s: ssd7, my cron recipe is much different than the one linked. and cron wasn't running on the initial boot of this xen domU i have created
[2012-09-13 07:10:37 -0400] meineerde: alex88: the id in your data bag item must specify the item, not the data bag. in your case, it probably need to contain "deploy_settings"
[2012-09-13 07:11:08 -0400] meineerde: alex88: the file names of the data bag items are always irrelevant.
[2012-09-13 07:11:21 -0400] alex88: meineerde: ooohhhthat's the case thank you very much! :)
[2012-09-13 08:18:19 -0400] upayavira: musing, is there a way to handle manual tasks in Chef? i.e. ones that *must* be invoked by a human being (e.g. format an Amazon EBS volume, or clone a mysql database)
[2012-09-13 08:33:17 -0400] zts: upayavira: not quite sure what you mean there, could you elaborate?  My best guess: there are some operations that you want a human to do manually, but would like Chef to know whether or not they've been done
[2012-09-13 08:35:11 -0400] upayavira: zts:  take mysql replication - I want chef to automatically set up the my.cfg, maybe execute the GRANT REPLICATION SLAVE command, etc, but I want to manually clone the database
[2012-09-13 08:35:34 -0400] upayavira: zts: But, I want to use Chef to code it all, I don't want to have another language for the bit that Chef doesn't do
[2012-09-13 08:37:31 -0400] zts: upayavira: okay, so when you talk about doing it manually, it's about fine-grained control over when those actions are being performed?  ie, you still want the tasks automated in Chef, but you don't want them to be run as part of your regular chef runs?
[2012-09-13 08:37:47 -0400] upayavira: zts: exactly
[2012-09-13 08:37:56 -0400] upayavira: I want to be able to trigger them, and watch them happen
[2012-09-13 08:38:03 -0400] upayavira: but have Chef do the work
[2012-09-13 08:40:52 -0400] zts: upayavira: I can think of a few possibilities, but I'm not sure I would call them good ideas
[2012-09-13 08:41:00 -0400] zts: upayavira: one option is to define each task in its own recipe, then run chef-client with the --override-runlist option to add the recipe for just one run
[2012-09-13 08:41:56 -0400] zts: upayavira: another would be to have your recipe look for something (a node attribute, a file on disk) that determines whether to run the recipe/resources
[2012-09-13 08:43:35 -0400] upayavira: zts: I just thought of the second, but the first is much better, perfect actually
[2012-09-13 08:44:52 -0400] upayavira: zts: let me go upgrade my chef client :-)
[2012-09-13 08:47:34 -0400] zts: upayavira: one nice thing I noticed about --override-runlist is that the node you use it on will gain a runlist_override_history attribute, which records that you've used the feature (what time, and what the runlist was)
[2012-09-13 08:48:50 -0400] upayavira: that's great, very useful
[2012-09-13 08:48:51 -0400] zts: upayavira: Also, this is a great question to ask on the chef mailing list - I'm sure there will be many other suggestions (and things to be concerned about)
[2012-09-13 08:49:02 -0400] upayavira: I really should join...
[2012-09-13 08:50:00 -0400] zts: I thoroughly recommend it :)
[2012-09-13 08:50:43 -0400] upayavira: :-) It's more a question of how to manage the many lists I already subscribe to (go away for a week, come back to 3000 emails!)
[2012-09-13 08:52:31 -0400] zts: I can sympathise :)
[2012-09-13 09:05:37 -0400] rBEL: Anyone knows how to get chef run in noninteractive mode when installing new version of apt packages?
[2012-09-13 09:06:39 -0400] rBEL: at this moment i'm installing a new version of php packages and it's asking what to do with some configuration files which exists already on the server
[2012-09-13 09:07:34 -0400] rBEL: as far as i know chef did this good in the past by using "DEBIAN_FRONTEND" => "noninteractive" while installing packages
[2012-09-13 09:16:23 -0400] msch: when i use remote_directory to mirror a complete directory of config files, how can i say "this one file gets a different file_mode from all others" ?
[2012-09-13 09:23:43 -0400] rBEL: you'll have to change the file mode of this specific file using the file resource after you ran the remote_directory..
[2012-09-13 09:37:56 -0400] msch: rBEL: thanks!
[2012-09-13 09:40:00 -0400] msch: and how can i make sure i stop a service before deleting it's directory? e.g. is there a service "postgresql" { action :stop ; only_if next_action_will_happen }
[2012-09-13 11:25:59 -0400] iroller: Ohai Chefs. I have a template with the same name in two different recipes assigned to one node. In one of them there is "not_if" statement which should help not to override this template. Looks like chef is using the same `template "mytemplate"` for both recipes and I'm not getting my template in place because of not_if
[2012-09-13 11:26:09 -0400] iroller: Is it expected in Chef?
[2012-09-13 11:33:36 -0400] rBEL: iroller you'll have to give the 2nd template a different name
[2012-09-13 11:34:41 -0400] rBEL: if i dont mistake myself chef builds everything on the start of the chef run and i think chef overwrites the first "mytemplate" resource with the 2nd "mytemplate" resource
[2012-09-13 11:34:52 -0400] rBEL: at least if they share the same template resource "name"
[2012-09-13 11:37:52 -0400] iroller: rBEL: yeah, looks like you're right
[2012-09-13 11:46:15 -0400] msch: what cookbook/recipe is used to add a public key to a user's authorized_keys?
[2012-09-13 11:49:08 -0400] masterkorp: msch: users
[2012-09-13 11:56:42 -0400] msch: masterkorp: thanks
[2012-09-13 11:57:34 -0400] Yulya: hello guys
[2012-09-13 11:57:42 -0400] Yulya: i have some trouble
[2012-09-13 11:58:05 -0400] Yulya: i have my dns broken for few minutes
[2012-09-13 11:58:25 -0400] Yulya: and my nodes was unable to determine its hostname
[2012-09-13 11:59:38 -0400] Yulya: after everything become ok and my nodes properly detemine its hostname with hostname -f or ohai fqdn i still got following error FATAL: ArgumentError: Attribute fqdn is not defined!
[2012-09-13 11:59:58 -0400] Yulya: even if node have this attribute on server side
[2012-09-13 12:00:28 -0400] Yulya: how can i fix it?
[2012-09-13 12:00:47 -0400] Yulya: maybe chef stores attributes in some kind of cache?
[2012-09-13 12:27:10 -0400] williamherry: is there any opscode guy here, my avatar not show in community
[2012-09-13 12:29:13 -0400] alex88: hi guys, i'm trying the deploy resource, and it gives me this problem: http://pastie.org/private/lbsvzqeckcdivdij7e9qrw
[2012-09-13 12:30:03 -0400] alex88: the problem is that in /home/ubuntu/myproject-tools/shared/ there isn't a config folder and in /home/ubuntu/myproject-tools/releases/20120913105154/ i see the git working directory
[2012-09-13 12:30:09 -0400] alex88: so it shouldn't be any data there
[2012-09-13 12:36:37 -0400] masterkorp: alex88: using capistrano ?
[2012-09-13 12:37:37 -0400] alex88: masterkorp: nope, using this recipe http://pastie.org/private/gomlo9ajcnwhjry3h3d2va
[2012-09-13 12:38:04 -0400] alex88: just the deploy resource
[2012-09-13 12:38:35 -0400] masterkorp: You need to symlink the folders
[2012-09-13 12:38:54 -0400] masterkorp: chef "borrows" the capistrano deploy style
[2012-09-13 12:39:13 -0400] alex88: yeah, do i need to symlink them manually?
[2012-09-13 12:39:48 -0400] masterkorp: alex88: http://wiki.opscode.com/display/chef/Deploy+Resource#DeployResource-DeployResource
[2012-09-13 12:39:55 -0400] masterkorp: there is a symlink
[2012-09-13 12:40:09 -0400] masterkorp: also it depends how the config is deployed
[2012-09-13 12:40:16 -0400] alex88: oh symlink_before_migrate
[2012-09-13 12:40:33 -0400] alex88: mmhh.. is that needed in case i need a shared config between releases?
[2012-09-13 12:40:41 -0400] masterkorp: yes
[2012-09-13 12:40:48 -0400] masterkorp: unless its overwritten
[2012-09-13 12:40:49 -0400] alex88: oh, so i just need to set it to ""
[2012-09-13 12:41:57 -0400] masterkorp: ?, no
[2012-09-13 12:41:59 -0400] masterkorp: http://labs.headshift.com/2012/02/29/a-basic-gitcapistrano-workflow/
[2012-09-13 12:42:01 -0400] masterkorp: here
[2012-09-13 12:42:18 -0400] alex88: masterkorp: do i really need symlinks?
[2012-09-13 12:42:30 -0400] masterkorp: yeah
[2012-09-13 12:42:54 -0400] alex88: oh the config is regarding capistrano?
[2012-09-13 12:42:55 -0400] masterkorp: or no if you keep your config in git and its not managed by chef
[2012-09-13 12:43:02 -0400] alex88: yeah, that's my case
[2012-09-13 12:43:13 -0400] alex88: well in this case what i have to deploy doesn't have a config
[2012-09-13 12:43:18 -0400] alex88: it's just a set of tools
[2012-09-13 12:43:44 -0400] masterkorp: "You dont need" but its a good practice to have the configs, logs, pids and other stuff on the shared dir
[2012-09-13 12:43:59 -0400] masterkorp: it will help you in the future
[2012-09-13 12:44:40 -0400] alex88: masterkorp: well, it's just a bunch of scripts which doesn't have logs, configs etc.. they just need to be run on vm boot and i want to easly update them
[2012-09-13 12:44:52 -0400] rgsteele: Can you add items to an encrypted databag, or do you have to recreate it to avoid double-encrypting the already encrypted items in there?
[2012-09-13 12:45:21 -0400] alex88: rgsteele: i think you should use knife to edit them
[2012-09-13 12:45:21 -0400] rgsteele: The process I've been using is: 1. create the openssl key, 2. create the json file, 3: create the data bag with knife using the openssl key
[2012-09-13 12:46:00 -0400] rgsteele: alex88: Ah, yeah, that makes complete sense.  I think I need my first cup of coffee -_-
[2012-09-13 12:46:21 -0400] alex88: rgsteele: we're in the same boat :)
[2012-09-13 12:48:31 -0400] gyre007: mm I'm getting Undefined method default_action in PHP cookbook's provider...
[2012-09-13 12:48:42 -0400] gyre007: is default_action undefined in LWRPs ?
[2012-09-13 12:51:53 -0400] gyre007: it looks like there is no such thing as default_action but the opscode\s cookbook has it...mmm
[2012-09-13 12:56:47 -0400] alex88: masterkorp: running chef with the deploy resource will actually do the deploy only if the git has new commits right? It doesn't create a new one everytime
[2012-09-13 13:02:42 -0400] gyre007: im trying to create a directory via chef....and Im getting NoMethodError - undefined method `directory'
[2012-09-13 13:02:45 -0400] gyre007: what da heck
[2012-09-13 13:02:57 -0400] gyre007: dodgy
[2012-09-13 13:03:15 -0400] geekbri: gyre007: can you gist the offending code?
[2012-09-13 13:03:24 -0400] gyre007: geekbri, sure...second
[2012-09-13 13:04:32 -0400] gyre007: geekbri, line 45
[2012-09-13 13:04:50 -0400] geekbri: um, line 45 of?
[2012-09-13 13:05:00 -0400] geekbri: maybe you could gist your code that is causing the issue?
[2012-09-13 13:05:11 -0400] gyre007: https://gist.github.com/3714153
[2012-09-13 13:05:17 -0400] gyre007: lol I fogot to paste the url
[2012-09-13 13:05:20 -0400] gyre007: arrgh :)
[2012-09-13 13:05:32 -0400] geekbri: ahhh much better
[2012-09-13 13:05:37 -0400] gyre007: Im thinking its because it's with the "application" blck
[2012-09-13 13:05:53 -0400] gyre007: and it looks like you can't use Chef's resources within that block...
[2012-09-13 13:05:54 -0400] gyre007: mmm
[2012-09-13 13:06:12 -0400] gyre007: otherwise Chef will be looking for them in the Application cookbook uhh..
[2012-09-13 13:06:46 -0400] geekbri: I am not overly familiar with the application resource, and I haven't read the source for it yet so I can't speak to much to that
[2012-09-13 13:06:48 -0400] gyre007: but that's just a guess
[2012-09-13 13:07:05 -0400] geekbri: syntactically I don't see anything wrong.  Your other nested resources work?
[2012-09-13 13:07:25 -0400] geekbri: It could be an issue with the nginx_load_balancer resource as well
[2012-09-13 13:08:15 -0400] gyre007: well either...basically...you can't use Chef resources within those blocks because otherwise they seem to be considered some libraries/cookbook methods or something like that
[2012-09-13 13:09:29 -0400] gyre007: what a shame :(
[2012-09-13 13:09:54 -0400] masterkorp: yeah
[2012-09-13 13:10:06 -0400] alex88: also guys, i've tried to use "symlink_before_migrate nil" but it still tries to symlink config/database.yml :/
[2012-09-13 13:10:07 -0400] masterkorp: you need to get those blocks outside
[2012-09-13 13:10:13 -0400] alex88: any idea?
[2012-09-13 13:12:30 -0400] gyre007: masterkorp, talking to me right ?
[2012-09-13 13:16:26 -0400] masterkorp: gyre007: yeah
[2012-09-13 13:16:30 -0400] gyre007: cool
[2012-09-13 13:16:35 -0400] gyre007: thanks
[2012-09-13 13:16:42 -0400] masterkorp: "nested" blocks are not possible on ruby dsl
[2012-09-13 13:17:24 -0400] masterkorp: gyre007: what you can do is use a notification event on the nginx_load_balencer block
[2012-09-13 13:17:55 -0400] gyre007: masterkorp, hm ?
[2012-09-13 13:20:40 -0400] gyre007: masterkorp, could you elaborate a bit ?
[2012-09-13 13:21:42 -0400] gyre007: im kind of trying to figure out how to set up the ssl stuff there based on the attribute...if i have to take that piece of code outside of that block it will be tricky...
[2012-09-13 13:22:28 -0400] gyre007: because ssl_certificate and ssl_certky must be there for nginx_load balancer
[2012-09-13 13:22:39 -0400] gyre007: when the code reaches that stage i guess
[2012-09-13 13:23:32 -0400] geekbri: Well I think what he meant to say is, nested resources aren't allowed in the recipe DSL
[2012-09-13 13:23:41 -0400] geekbri: you can nest resources inside say... the resource definition dsl
[2012-09-13 13:25:41 -0400] gyre007: geekbri, wouldn't like to mess around with the community cookbooks if not necessary....the nginx_loadbalancer is from opscode community cookbook
[2012-09-13 13:25:48 -0400] gyre007: would like to keep those consistent
[2012-09-13 13:26:08 -0400] geekbri: gyre007: you may want to consider definitions as well
[2012-09-13 13:26:40 -0400] geekbri: http://wiki.opscode.com/display/chef/Definitions
[2012-09-13 13:27:50 -0400] gyre007: that would be adding more complexity...imho...but thanks for advice geekbri
[2012-09-13 13:31:23 -0400] shamaz: Hello everybody, is there a documetation generator for chef cookbooks? Not for ruby code!
[2012-09-13 13:33:39 -0400] gyre007: kind of like masterkorp idea of notifications....but not sure if i got it right...
[2012-09-13 13:36:55 -0400] karmi: Hi, when I run `knife cookbook site install <NAME>`, it fails, and removes the whole "site-cookbooks". Anybody has run into that?
[2012-09-13 13:37:07 -0400] karmi: My knife.rb contains: cookbook_path ["#{current_dir}/../site-cookbooks", "#{current_dir}/../cookbooks"]
[2012-09-13 13:39:46 -0400] mrafa: karmi - can you try to download it and see if that works first ?
[2012-09-13 13:40:32 -0400] karmi: mrafa: download what? the cookbook? yes, it's there, it's possible to `knife cookbook site download <NAME>` it
[2012-09-13 13:52:02 -0400] mrafa: karma - do you see any other information on the screen ?
[2012-09-13 14:00:36 -0400] gyre007: masterkorp, can I do something like notifies restart, nginx_loadbalancer, delayed ?
[2012-09-13 14:01:20 -0400] gyre007: nginx_loadbalancer is a LWRP resource so I'm not sure how to reference those in the notify clauses
[2012-09-13 14:01:51 -0400] gyre007: the question is if it is even possible...
[2012-09-13 14:03:54 -0400] geekbri: gyre007: "nginx_loadbalancer[name_of_resource]"
[2012-09-13 14:04:10 -0400] gyre007: geekbri, it has no name :) have you seen that gist I sent
[2012-09-13 14:04:25 -0400] gyre007: not sure if i can give it a name mmm...
[2012-09-13 14:04:29 -0400] gyre007: probably yes...mm
[2012-09-13 14:04:38 -0400] gyre007: https://gist.github.com/3714153
[2012-09-13 14:05:37 -0400] geekbri: is this the opscode nginx cookbook?
[2012-09-13 14:05:57 -0400] gyre007: geekbri, yup
[2012-09-13 14:06:14 -0400] msch: is there something like capistrano for chef? e.g. something that takes care of git repositories via a local copy that it syncs?
[2012-09-13 14:06:14 -0400] gyre007: http://community.opscode.com/cookbooks/application_nginx
[2012-09-13 14:06:44 -0400] gyre007: it looks like I can't give it a name...daaarn...
[2012-09-13 14:07:48 -0400] vintuwei: how do i upgrade my install php 5.4 on my vagrant box
[2012-09-13 14:09:31 -0400] gyre007: basically geekbri what im trying to figure out is how to restart nginx once the cert and key are in place...
[2012-09-13 14:10:18 -0400] geekbri: gyre007: inspect your resource_collection and see what its called in there
[2012-09-13 14:10:30 -0400] gyre007: geekbri, how ?
[2012-09-13 14:11:39 -0400] geekbri: @run_context.resource_collection.each { |r| Chef::Log.info(r.name) }   might do it
[2012-09-13 14:12:11 -0400] geekbri: you could try .find instead
[2012-09-13 14:12:26 -0400] geekbri: maybe .find("nginx_loadbalancer")
[2012-09-13 14:12:39 -0400] geekbri: it may be that you can just notify the resouce without providing a name
[2012-09-13 14:12:54 -0400] gyre007: geekbri, I tried but it didnt work...
[2012-09-13 14:13:23 -0400] gyre007: unless I notify the application which is the outer blok encapsulating the loadbalancer LWRP ?
[2012-09-13 14:13:25 -0400] gyre007: mm
[2012-09-13 14:13:33 -0400] gyre007: makes no sense though...totally
[2012-09-13 14:13:51 -0400] karmi: FYI, `knife cookbook site install` works on 0.10.8. The 10.14.*versions are broken.
[2012-09-13 14:13:53 -0400] gyre007: because application contains unicorn and other funny things...
[2012-09-13 14:16:14 -0400] geekbri: gyre007: Did you try printing out the resource collection names? It might enlighten you
[2012-09-13 14:16:41 -0400] gyre007: haven yet...im working on it...
[2012-09-13 14:16:57 -0400] gyre007: never done that before
[2012-09-13 14:17:00 -0400] gyre007: sec...
[2012-09-13 14:17:04 -0400] geekbri: gyre007: it may be just nginx_loadbalancer[nginx_loadbalancer] or something.  I'd have to dig into the chef source to see what it initalizes a resource that doesn't provide a name attribute
[2012-09-13 14:17:26 -0400] gyre007: geekbri, where should I actually put that code ?
[2012-09-13 14:17:53 -0400] geekbri: gyre007: you can stick it in the recipe that is calling that resources at the end
[2012-09-13 14:18:02 -0400] gyre007: cool
[2012-09-13 14:18:04 -0400] gyre007: sec
[2012-09-13 14:18:29 -0400] geekbri: really you just want to have it far enough in your run that the resource is actually added to the rseource collection
[2012-09-13 14:22:06 -0400] gyre007: can't seem to find anything in the logs...i saw bunch of stuff in the console but most of that stuff is not in logged into /var/log/chef/client
[2012-09-13 14:24:11 -0400] geekbri: if you ran the chef run manually it'll all be there in the chef run output
[2012-09-13 14:24:43 -0400] geekbri: maybe right before that line you want to put something like   Chef::Log.info("Printed out resource collection!! -------------------") to make it really visible
[2012-09-13 14:25:32 -0400] gyre007: geekbri, yeah will do that but the output is so long that i can't scroll up enough to see it all...
[2012-09-13 14:25:35 -0400] gyre007: arrgh
[2012-09-13 14:26:08 -0400] geekbri: sounds like you need to increase your scrollback buffer or pipe it to less ors omething!
[2012-09-13 14:29:03 -0400] geekbri: it will actually make it a lot easier to read if you do something like this
[2012-09-13 14:29:04 -0400] geekbri: @run_context.resource_collection.each {|r| Chef::Log.info("#{r.resource_name}[#{r.name}]") }
[2012-09-13 14:29:37 -0400] geekbri: then you will get output like this:   [2012-09-13T14:28:51+00:00] INFO: service[ntp]
[2012-09-13 14:31:27 -0400] geekbri: gyre007: ^
[2012-09-13 14:34:04 -0400] Loof: Is there a smart way to ensure that deployments are only done on certain runs without modifying the run list every time?
[2012-09-13 14:34:16 -0400] gyre007: geekbri, uhh -> application_nginx_nginx_load_balancer[sensu-admin]
[2012-09-13 14:34:18 -0400] gyre007: wtf
[2012-09-13 14:34:19 -0400] gyre007: :)
[2012-09-13 14:34:22 -0400] Loof: I'm trying to decide if there's any reason to leave chef-client running regularly...
[2012-09-13 14:34:37 -0400] geekbri: gyre007: looks like at least you have an answer as to what needs to be notified :)
[2012-09-13 14:34:42 -0400] Loof: there's one string reason not to... to avoid having a deployment happen just because someone pushed a change to the repo
[2012-09-13 14:34:44 -0400] gyre007: but I doubt that that will have restart action defined!
[2012-09-13 14:34:58 -0400] geekbri: gyre007: you could always just have it subscribe instead of notifying it
[2012-09-13 14:35:01 -0400] Loof: since we tend to vet things over the day... and then do a deployment once it's all been put into the branch
[2012-09-13 14:35:19 -0400] Loof: Any feedback (or good article) on this?
[2012-09-13 14:35:20 -0400] gyre007: geekbri, whats the difference...nginx needs to be restarted anyway
[2012-09-13 14:35:26 -0400] geekbri: Loof: why wouldn't you just set the deployment to look at a certain branch that only gets pushed to when its ready to be deployed?
[2012-09-13 14:35:51 -0400] Loof: geekbri: Because that's not how our dev tools work
[2012-09-13 14:35:55 -0400] geekbri: Loof: I personally am pretty against the idea of only running chef selectively.  I have done it way in the past, and it brought me nothing but pain.  It kind of goes against the idea, in my mind, of what chef is supposed to do
[2012-09-13 14:36:02 -0400] gyre007: if it doesnt have restart action defined it's pointless ...
[2012-09-13 14:36:27 -0400] geekbri: What good is a utility that makes sure everything that needs to be there is there if you only run it manually?
[2012-09-13 14:36:35 -0400] geekbri: I mean it still has uses, but I just think its not as useful
[2012-09-13 14:37:03 -0400] Loof: geekbri: Yes and no... the idea is to sync the system... if these are automaticly maintained systems... WHY would it ever go out of sync /w chef making all of the changes (unless a chef run fails, but that's another issue)
[2012-09-13 14:37:22 -0400] geekbri: Somebody logs in and makes a change they aren't supposed to?
[2012-09-13 14:37:36 -0400] awgross|flashman: Loof: I am with Geekbri, having Chef run regularly has saved my bacon a few times
[2012-09-13 14:37:39 -0400] Loof: geekbri: No one has the authority to log in
[2012-09-13 14:37:46 -0400] awgross|flashman: even if it is just a stapgap when a service mysteriously crashes
[2012-09-13 14:37:48 -0400] geekbri: You make a mistake?
[2012-09-13 14:38:02 -0400] Loof: Yes, but that's the entire point... I'm only ever pushing changes out via chef
[2012-09-13 14:38:05 -0400] geekbri: I mean I don't mean to imply you make mistakes, but I do sometimes
[2012-09-13 14:38:09 -0400] Loof: Now... if I mess up and ssh is no longer running
[2012-09-13 14:38:13 -0400] Loof: that's an oops
[2012-09-13 14:38:18 -0400] Loof: but then I go back to the prior snapshot
[2012-09-13 14:38:56 -0400] Loof: Mind you, I'm not arguing for argument's sake... I really don't get why it's exciting to run chef client regularly
[2012-09-13 14:39:09 -0400] Loof: the only time an IP should change is on boot... I intend to have chef client run once on boot
[2012-09-13 14:39:21 -0400] Loof: So, rebooting the instance will make chef client run
[2012-09-13 14:39:34 -0400] Loof: which is about the only time I'd see a potential lack of sync
[2012-09-13 14:39:50 -0400] geekbri: If you think that is how it will be successful for you, then do it.
[2012-09-13 14:39:58 -0400] geekbri: however the other issue with thatis
[2012-09-13 14:40:06 -0400] geekbri: what if you have a configuraiton change you want to make in chef, but you don't want your code deployed
[2012-09-13 14:40:11 -0400] geekbri: but somebody has pushed to the branch that gets deployed.
[2012-09-13 14:40:18 -0400] Loof: geekbri: I'm trying to understand the other side of the coin
[2012-09-13 14:40:20 -0400] geekbri: now you can't deploy your configuration change without pushing out the code
[2012-09-13 14:40:35 -0400] Loof: geekbri: Exactly, that's why I'm looking to see if I can selectively deploy
[2012-09-13 14:40:47 -0400] Loof: without adding a new branch which will cause tons of headaches for all of the developers
[2012-09-13 14:41:24 -0400] Loof: Basically, managing deployments will bug me... changing HOW we manage deployments will bug everyone else
[2012-09-13 14:41:32 -0400] Loof: so I'm going to make chef fit what we have... not the other way around.
[2012-09-13 14:41:40 -0400] Loof: As far as your example...
[2012-09-13 14:41:54 -0400] Loof: I'd upload a cookbook with the deploy portion disabled
[2012-09-13 14:41:56 -0400] Loof: run chef
[2012-09-13 14:42:01 -0400] Loof: then upload again
[2012-09-13 14:42:06 -0400] Loof: or adjust the run list
[2012-09-13 14:42:21 -0400] Loof: I've not made the deploy a distinct recipe yet... but I could do that without too much trouble
[2012-09-13 14:42:24 -0400] geekbri: But why not just have chef run all the time, and have that deploy flag disabled by default
[2012-09-13 14:42:27 -0400] Loof: then I could adjust the run list
[2012-09-13 14:42:29 -0400] geekbri: and then just enable it when you want code to go out?
[2012-09-13 14:42:39 -0400] Loof: geekbri: Ok, and how would I do that :)
[2012-09-13 14:42:46 -0400] geekbri: A million different ways!
[2012-09-13 14:42:58 -0400] Loof: I've been using Chef a week and a half... so I'm just not fully aware of the best ways to handle things
[2012-09-13 14:43:23 -0400] geekbri: I've seen many an argument about "Don't use chef to deploy code" vs "Yes I use chef to deploy code and it works for me"
[2012-09-13 14:43:45 -0400] geekbri: I don't use the deploy resource, but can't you specify a commit ID that is supposed to be deployed?
[2012-09-13 14:43:52 -0400] Loof: Most of the guides I find actually use chef-solo and avoid the whole issue entirely
[2012-09-13 14:43:58 -0400] Loof: -that- seems a little pointless
[2012-09-13 14:44:12 -0400] geekbri: Couldn't you just point that to a particular commit ID , base that on an attribute theb just update that attribute in a role when you wanted to do a deploy?
[2012-09-13 14:44:24 -0400] Loof: Ok, the reason I want to use Chef to deploy code is simple
[2012-09-13 14:44:25 -0400] geekbri: Again I don't use the deploy resource so I can't speak to how it works... but that might work
[2012-09-13 14:44:36 -0400] Loof: I want to have an update & verify stage in the boot process
[2012-09-13 14:44:38 -0400] geekbri: since you can write regular ole' ruby in chef recipes you can do just about anything you want.
[2012-09-13 14:44:39 -0400] Loof: managed by chef
[2012-09-13 14:44:48 -0400] Loof: if the server doesn't validate... it doesn't join the production pool
[2012-09-13 14:44:58 -0400] Loof: I don't have the validation rules in place yet... but that's my intent long term
[2012-09-13 14:45:28 -0400] Loof: geekbri: And what's the best way to determine if I'm in a 'daemon' run vs a 'command line run that should deploy' :P :)
[2012-09-13 14:46:23 -0400] Loof: The general concensus was just not to run it in the background
[2012-09-13 14:46:24 -0400] Loof: here
[2012-09-13 14:46:33 -0400] Loof: but I'm trying to understand what we lose out on by doing that
[2012-09-13 14:47:02 -0400] Loof: I'm not opposed to fighting for... no... we specify --someflag='want_to_deploy' on the chef-client run...and otherwise it won't deploy
[2012-09-13 14:47:15 -0400] Loof: But I don't know the benefit of letting chef client steal CPU every few hours
[2012-09-13 14:47:17 -0400] Loof: or mins
[2012-09-13 14:47:33 -0400] gyre007: geekbri, mm looks like Chef ate that trick with the loadbalancer
[2012-09-13 14:47:48 -0400] geekbri: gyre007: does that mean it worked?
[2012-09-13 14:47:54 -0400] geekbri: I dont know if ate is good or bad :)
[2012-09-13 14:47:55 -0400] gyre007: geekbri, looks like it...
[2012-09-13 14:47:58 -0400] geekbri: hooray
[2012-09-13 14:48:06 -0400] gyre007: well...im hitting  a wall with rabbitmq recipe now...
[2012-09-13 14:48:10 -0400] gyre007: actually apt...
[2012-09-13 14:48:11 -0400] gyre007: arrgh
[2012-09-13 14:48:18 -0400] gyre007: thanks for that trick though
[2012-09-13 14:48:22 -0400] geekbri: not a problem
[2012-09-13 14:49:27 -0400] gyre007: either apt or rabbitmq Opscode recipes are faulty or something....rabbimq calls the apt one and apt one fails....when setting up rabbit repo...arrrgh :)
[2012-09-13 14:49:42 -0400] Loof: gyre007: the rabbitmq recipe uses the rabbitmq repo... not the default system package... just in case
[2012-09-13 14:49:59 -0400] gyre007: Loof, I know...but the recipe fails in apt...
[2012-09-13 14:50:02 -0400] Loof: gyre007: Unless you need the latest and greated... I'd modify it to use the system package (and will/did)
[2012-09-13 14:50:04 -0400] gyre007: https://gist.github.com/3714153
[2012-09-13 14:50:17 -0400] Loof: (I did... but I'm not USING the recipe yet for much other than 1 test)
[2012-09-13 14:50:33 -0400] gyre007: Loof, we'd like to be up to date as much as possible as are devs are using the latest Rabbit versions
[2012-09-13 14:50:57 -0400] Loof: Chef for undefined variables
[2012-09-13 14:51:03 -0400] Loof: Check even :P
[2012-09-13 14:51:10 -0400] Loof: Sorry, I've got a cold... affects the brain :P
[2012-09-13 14:51:30 -0400] gyre007: Loof, looks like some uninitialized constant or something uhh...
[2012-09-13 14:55:06 -0400] Loof: I suspect it can't find or get to your key
[2012-09-13 14:55:44 -0400] Loof: I suggest you add a logging line in repository.rb before each of those mentioned... print the contents of the key resource to the log
[2012-09-13 14:55:52 -0400] Loof: I'll be one of those is coming back nil
[2012-09-13 14:55:55 -0400] Loof: bet
[2012-09-13 14:56:01 -0400] Loof: Now, as far as why... no clue yet
[2012-09-13 14:56:06 -0400] msch: in chef-solo, can the nodes.json files somehow include other files? e.g. i'd like one "default" for all my nodes
[2012-09-13 14:56:09 -0400] Loof: I'll tell you once I've been using Chef for 3 weeks ;)
[2012-09-13 14:57:02 -0400] Loof: msch: Does this help http://wiki.opscode.com/display/chef/Chef+Solo#ChefSolo-Roles
[2012-09-13 14:57:45 -0400] msch: Loof: ah so while i can't really inherit, i can just define one role for all those nodes? and this role can then also set attributes that are available via node[:something][:else]
[2012-09-13 15:02:56 -0400] Loof: msch: Or multiple roles
[2012-09-13 15:03:01 -0400] Loof: msch: default + whatever else
[2012-09-13 15:03:19 -0400] Loof: Though, I'd avoid 'default' because it's a fairly special word for Chef
[2012-09-13 15:06:52 -0400] gyre007: arrgh...Rabbitmq Opscode cookbook is a nightmare.....arrrgh
[2012-09-13 15:10:08 -0400] awgross|flashman: gyre007: run with -l debug
[2012-09-13 15:10:14 -0400] gyre007: awgross|flashman, I did
[2012-09-13 15:10:27 -0400] gyre007: produces same output....https://gist.github.com/3714153
[2012-09-13 15:10:33 -0400] gyre007: no difference
[2012-09-13 15:10:34 -0400] awgross|flashman: gyre007: strange i thought the shellout would have had a bit more output
[2012-09-13 15:10:49 -0400] gyre007: doesnt look like it does
[2012-09-13 15:10:56 -0400] awgross|flashman: yeah
[2012-09-13 15:11:17 -0400] awgross|flashman: looks like the apt cookbook is trying to validate the GPG keys from cmd output, a tricky situation
[2012-09-13 15:11:36 -0400] awgross|flashman: you are installing from a custom PPA?
[2012-09-13 15:12:00 -0400] gyre007: awgross|flashman, im using the community cookbook
[2012-09-13 15:12:08 -0400] gyre007: that's it...
[2012-09-13 15:12:32 -0400] gyre007: this is the URI being used uri "http://www.rabbitmq.com/debian/"
[2012-09-13 15:13:44 -0400] awgross|flashman: hmm ok
[2012-09-13 15:13:50 -0400] gyre007: looks like its failing on apt-key finger
[2012-09-13 15:14:14 -0400] gyre007: thats the last thing I can see when I put some debugging logs right into APT provider code...
[2012-09-13 15:14:15 -0400] awgross|flashman: yeah its trying to validate the GPG key, which normally requires user input
[2012-09-13 15:14:33 -0400] Pushnell: If I want to apply a databag's contents to a node, can I do something like node['myattribute'] = my_databagitem.to_hash ?
[2012-09-13 15:14:35 -0400] gyre007: this has worked fine on my test box mmm
[2012-09-13 15:14:45 -0400] gyre007: failing in staging area ...
[2012-09-13 15:14:47 -0400] gyre007: stange
[2012-09-13 15:14:53 -0400] gyre007: strange even
[2012-09-13 15:14:54 -0400] awgross|flashman: gyre007: interesting, both same OS, same chef?
[2012-09-13 15:14:59 -0400] gyre007: same OS
[2012-09-13 15:15:07 -0400] gyre007: chef...not sure...let me see
[2012-09-13 15:15:41 -0400] gyre007: the one in testlab is omnibus...i know that...
[2012-09-13 15:15:58 -0400] gyre007: the one in staging is gem...
[2012-09-13 15:17:21 -0400] awgross|flashman: are they both the same version?
[2012-09-13 15:18:22 -0400] tolland_: is there a shortcut to set an attribute on a node, from the command line?
[2012-09-13 15:18:30 -0400] tolland_: i have some round-about knife.exec command
[2012-09-13 15:19:19 -0400] PapaSierra: anyone familiar with the opscode php cookbook, is it possible to build php 5.4 from source? we're only able to get 5.3 built
[2012-09-13 15:19:44 -0400] gyre007: awgross|flashman, nope...the omnibus one is 10.12...the staging one is 10.6
[2012-09-13 15:19:55 -0400] tolland_: knife exec -E "nodes.find(:name => '$(hostname)') {|n| n.set['mysttributes'] = ['devel1'] ; n.save }"
[2012-09-13 15:20:06 -0400] msch: Loof: ah so i can define a role default that will be included automatically? cool
[2012-09-13 15:20:26 -0400] awgross|flashman: gyre007: that would be my guess, i would bump the staging gem to 10.12
[2012-09-13 15:20:53 -0400] Loof: msch: I don't think automatically... but you can use multiple roles
[2012-09-13 15:21:05 -0400] Loof: so 'base' would be on your run list for all nodes
[2012-09-13 15:21:06 -0400] msch: Loof: ok thanks
[2012-09-13 15:21:22 -0400] Loof: g'luck
[2012-09-13 15:23:20 -0400] Pushnell: In an attributes file, is there any difference between set['attribute'] and default['attribute'] ?
[2012-09-13 15:27:11 -0400] gyre007: awgross|flashman, it fails on this line so = Mixlib::ShellOut.new(cmd)
[2012-09-13 15:27:20 -0400] gyre007: basically it doesn't even create so object...
[2012-09-13 15:34:12 -0400] awgross|flashman: gyre007: can you log what cmd is in this case?
[2012-09-13 15:34:26 -0400] gyre007: apt-key finger
[2012-09-13 15:34:34 -0400] gyre007: when run on command line it works fine
[2012-09-13 15:34:37 -0400] awgross|flashman: hmm
[2012-09-13 15:34:40 -0400] gyre007: when shelling out in Chef it crashes
[2012-09-13 15:34:49 -0400] awgross|flashman: ShellOut is some deep ruby magic
[2012-09-13 15:35:06 -0400] awgross|flashman: and you are now on 10.12 in both envs?
[2012-09-13 15:35:58 -0400] Loof: awgross|flashman: Ok, back from MeetingHell(tm)... how has leaving chef running as a daemon saved your bacon?
[2012-09-13 15:36:46 -0400] awgross|flashman: Loof: i have a few services which enjoy seg faulting (MongoDB)
[2012-09-13 15:36:51 -0400] gyre007: awgross|flashman, https://gist.github.com/3715137
[2012-09-13 15:36:54 -0400] gyre007: thats what I did...
[2012-09-13 15:36:55 -0400] uncommitted: in a template, I'd like to see if the run_list includes a certain role and set a variable. How would I do this?
[2012-09-13 15:37:05 -0400] gyre007: it looks like the Shellout object doesnt even get created...
[2012-09-13 15:37:08 -0400] gyre007: and it exits
[2012-09-13 15:37:19 -0400] gyre007: because the second print message never gets printed
[2012-09-13 15:37:24 -0400] awgross|flashman: Loof: itill pull them back up eventually, I also know what state my environment is in and I get an email whenever it breaks
[2012-09-13 15:37:29 -0400] gyre007: ie the Shelling Out one
[2012-09-13 15:37:37 -0400] Loof: awgross|flashman: Sounds like a job for init :)
[2012-09-13 15:37:39 -0400] awgross|flashman: Loof: this means my Chef runs can actually diagnose problems (remote APIs being down etc)
[2012-09-13 15:37:41 -0400] gyre007: no this is happening on 10.6...10.12 works ok
[2012-09-13 15:38:01 -0400] awgross|flashman: gyre007: you cant upgrade staging to a newer version? sounds like a bug in ShellOut that got fixed
[2012-09-13 15:38:11 -0400] Loof: The chef runs diagnosing problems makes some sense... though I intend to have a couple of monitoring tools for that
[2012-09-13 15:38:25 -0400] Loof: I've been playing with zabbix... it's not bad
[2012-09-13 15:38:31 -0400] awgross|flashman: Loof: fair enough
[2012-09-13 15:38:46 -0400] Loof: I got used to nagios... so it feels odd, but I'll either get used to it or get rid of it
[2012-09-13 15:39:23 -0400] gyre007: im updating now
[2012-09-13 15:39:31 -0400] Loof: awgross|flashman: Nothing wrong with your setup... just trying to relate it to what I have set up and if it would be useful
[2012-09-13 15:40:11 -0400] Loof: The main things that seem useful so far... the node data gets updated... so I can make 'smart' decisions about nodes inside of chef based on memory free or some such thing... BUT... Chef feels like the wrong place to do that
[2012-09-13 15:40:14 -0400] awgross|flashman: Loof: fair enough. I find it to be a nice peace of midn to have it always running, i have a few servers (databases mostly) that dont have it running constantly and I am more worried about their state
[2012-09-13 15:40:46 -0400] Loof: At the moment the entire 'farm' I'm managing consists of AWS VMs
[2012-09-13 15:40:55 -0400] Loof: so I can snapshot, restart, revert on a whim
[2012-09-13 15:41:20 -0400] Loof: The 2 main things that bug me about running chef (or puppet) constantly... one is the deploy issue I mentioned
[2012-09-13 15:41:24 -0400] Loof: the other is that they try to fix the system
[2012-09-13 15:41:30 -0400] Loof: If someone logs in and changes something
[2012-09-13 15:41:35 -0400] Loof: hacker or idiot admin
[2012-09-13 15:41:38 -0400] Loof: I want to KNOW about it
[2012-09-13 15:41:41 -0400] uncommitted: never mind me, over thinking things :)
[2012-09-13 15:41:50 -0400] Loof: Not have all of the forensic evidence erased
[2012-09-13 15:43:09 -0400] Loof: What would be ideal for me is 3 kinds of runs... a full run that happens at deployment time... an update run that happens on boot, and fails if something isn't installed (because it means we probably used the wrong base AMI)... and a run that's a dry-run and reports if it would have done anything that runs regularly
[2012-09-13 15:43:26 -0400] Loof: Chef supports dry runs now... but not as a daemon run
[2012-09-13 15:43:41 -0400] Loof: Not sure if I could make 'has to do something' an exception
[2012-09-13 15:44:00 -0400] Loof: The other would likely require different roles/run lists
[2012-09-13 15:48:37 -0400] masterkorp: gyre007: yes
[2012-09-13 15:48:50 -0400] gyre007: :) what ? haha
[2012-09-13 15:49:29 -0400] jasond: is it possible to include a library from another cookbook?  i see a load-libraries-in-cookbook function referenced here http://tickets.opscode.com/browse/CHEF-3376, but i can't find any documentation for it
[2012-09-13 15:50:06 -0400] Loof: Oh, interesting
[2012-09-13 15:50:30 -0400] Loof: One little tidbit... -o for chef-client should _NOT_ have changed my node's run list
[2012-09-13 15:50:33 -0400] Loof: that was a bug
[2012-09-13 15:51:07 -0400] alexbst: I'm trying to have a cookbook create a dynamic list in a template based on an attribute that has multiple entries comma separated - anyone know any examples of this ?
[2012-09-13 15:52:06 -0400] Loof: alexbst: You'll want to use split... which creats an array then .each on the array
[2012-09-13 15:52:37 -0400] alexbst: I'm assuming I can then format the contents I want to go into the erb ? (it'll be xml..)
[2012-09-13 15:52:46 -0400] alexbst: shall see
[2012-09-13 16:07:23 -0400] geekbri: jasond: That is a ticket with psuedo code, I don't believe that method exists.
[2012-09-13 16:07:35 -0400] geekbri: That ticket is a discussion of ways to handle loading libraries from other cookbooks
[2012-09-13 16:07:54 -0400] jasond: ok, so I'll just have to load it using the full path?
[2012-09-13 16:16:53 -0400] j|: if I wanted to change all the environments of a list of nodes using 'knife exec', assuming I have that list returned from a search query, what is the syntax for the environment setting in the knife exec/ Shef DSL?
[2012-09-13 16:21:06 -0400] msch: anyone got any idea why this doesn't restart nginx if i change the template? https://gist.github.com/217e6e9740b5420688c3
[2012-09-13 16:21:22 -0400] msch: if i manually run restart nginx it works
[2012-09-13 16:21:47 -0400] msch: and chef also says "Processing service[nginx] action restart (nginx::default line 23)"
[2012-09-13 16:22:15 -0400] j|: using the node.set; node.save to do this gives something I didn't expect. The attribute is changed, but it doesn't show up when printed out. The only reason I know it is changed is b/c the nodes still come back from searching for the new environment on the next time around
[2012-09-13 16:22:47 -0400] j|: but they no longer come back as search results when querying for the environment that they print out as
[2012-09-13 16:24:59 -0400] j|: so, I start w/ some nodes in _default env, I search for them, change the env to, say, 'new_env', with node.set, node.save, and then the next query I search for  nodes in the environment _default. nothing comes back. I search for nodes in environment 'new_env' and they come back as expected, but if I print out the node.chef_environment, it confusingly still says '_default'.
[2012-09-13 16:25:47 -0400] j|: I dunno what to make out of that, really. Guess there's more going on in the Shef DSL than I know about yet.
[2012-09-13 16:26:16 -0400] j|: first day trying out knife exec scripts, so I thought I'd just do one to change all the environments of a certain set of nodes.
[2012-09-13 16:27:04 -0400] j|: any pointers anyone has are appreciated... ? :)
[2012-09-13 16:28:28 -0400] geekbri: msch: isn't the syntax notifies :restart, "service[nginx]"     (they might have recently changed this)
[2012-09-13 16:28:44 -0400] geekbri: wrapping that resource in resources()
[2012-09-13 16:28:57 -0400] geekbri: oh no, not wrapping it
[2012-09-13 16:29:00 -0400] msch: geekbri: i can try, but chef tells me it's actually doing a restart so i'm guessing that's not it?
[2012-09-13 16:29:08 -0400] geekbri: oh, interesting
[2012-09-13 16:29:23 -0400] geekbri: maybe restart was never defined for the service nginx resource?
[2012-09-13 16:29:43 -0400] geekbri: what happens if you change it to say.... notify a stop then a start?
[2012-09-13 16:29:46 -0400] msch: geekbri: nope, if i do "restart nginx" manually via ssh it works
[2012-09-13 16:29:57 -0400] msch: geekbri: how can i make it notify first a stop, then a start?
[2012-09-13 16:30:08 -0400] geekbri: two notifies
[2012-09-13 16:30:11 -0400] msch: k
[2012-09-13 16:30:26 -0400] geekbri: I meant maybe the restart attribute on the service nginx resource wasn't defined
[2012-09-13 16:30:42 -0400] geekbri: not that service nginx restart didn't exist
[2012-09-13 16:30:56 -0400] geekbri: I can see how that isn't so clear though
[2012-09-13 16:31:12 -0400] msch: geekbri: the attribute is set and i tried with removing it?
[2012-09-13 16:31:46 -0400] geekbri: I see that it says it supports restart, but is restart actually defined
[2012-09-13 16:32:03 -0400] msch: geekbri: sorry, i'm new to chef. where would it be defined?
[2012-09-13 16:32:06 -0400] geekbri: what if you try adding to your service nginx block restart "service nginx restart"
[2012-09-13 16:32:54 -0400] geekbri: sorry its restart_command
[2012-09-13 16:32:56 -0400] geekbri: not restart
[2012-09-13 16:32:58 -0400] msch: geekbri: ok, just a sec
[2012-09-13 16:33:04 -0400] j|: my questions must always suck or something. :P
[2012-09-13 16:33:24 -0400] j|: :: goes and pouts in corner ::
[2012-09-13 16:33:31 -0400] msch: geekbri: nope, it just doesn't restart :/
[2012-09-13 16:33:33 -0400] geekbri: j|: I unfortuante just don't know off hand your answer, and I don't have the time to look into it at the moment :)
[2012-09-13 16:33:47 -0400] j|: geekbri: yea, no worries. I'm just being whiny. :)
[2012-09-13 16:33:50 -0400] geekbri: msch: what happens if you try the two notifies
[2012-09-13 16:34:16 -0400] j|: the knife exec stuff is pretty awesome.
[2012-09-13 16:34:18 -0400] msch: geekbri: i've figured it out :)
[2012-09-13 16:34:28 -0400] geekbri: msch: ahh, what was wrong :
[2012-09-13 16:34:29 -0400] geekbri: :)
[2012-09-13 16:34:36 -0400] j|: just not sure how to learn it really
[2012-09-13 16:34:45 -0400] msch: geekbri: i've got service"nginx" do action :stop only_if { File.exists?("/etc/init.d/nginx") } end somewhere up in the file
[2012-09-13 16:34:53 -0400] msch: geekbri: because i'm replacing my /etc/init.d/nginx with upstart nginx
[2012-09-13 16:35:19 -0400] msch: geekbri: and it seems i can't redefine the service afterwards to use upstart? if i remove that block (which is ok once the init.d/nginx has been removed) it works
[2012-09-13 16:35:22 -0400] j|: oh, shit. think I just got a hint
[2012-09-13 16:35:56 -0400] j|: so, the attributes in 'knife node edit', in the most external scope, these are default attributes?
[2012-09-13 16:36:11 -0400] msch: geekbri: so if i remove the first service block it works: https://gist.github.com/de5f2ac51e9aa269d89c
[2012-09-13 16:36:25 -0400] j|: there's an inner block for 'normal' level attributes, that's where my node.set, node.save attribute went off to
[2012-09-13 16:36:25 -0400] msch: geekbri: any ideas how to workaround that?
[2012-09-13 16:37:42 -0400] geekbri: Msch: If I am correct (and I might or might not be), that first service resource is still being defined which is a problem.  I would wrap the service resource creations in an actual ruby IF, not use the only_if guard
[2012-09-13 16:38:09 -0400] msch: geekbri: but then it will still fail on the first deployment when i install nginx and then remove the init.d and replace it with my upstart script?
[2012-09-13 16:39:04 -0400] gyre007: that mess with embedded rubies and installed gems is gonna kill me I swear...
[2012-09-13 16:39:33 -0400] geekbri: msch: What I would do is create the nginx service resouce and just use conditionals to set the start_command, stop_command, and restart_command
[2012-09-13 16:39:55 -0400] geekbri: msch: If you know you are going to be removing the init file though I dont' see any reason to even use the conditionals
[2012-09-13 16:40:30 -0400] geekbri: maybe I misunderstand what youre trying to do
[2012-09-13 16:40:34 -0400] t-work: afternoon
[2012-09-13 16:41:03 -0400] t-work: can anyone tell me what the best practices are when installing Chef on Ubuntu 12.04, i'm being asked about installing a new menu.lst boot/grub file
[2012-09-13 16:41:40 -0400] msch: geekbri: true. i can just do execute { command "/etc/init.d/nginx stop" }
[2012-09-13 16:42:03 -0400] geekbri: msch: Oh I get the problem, the issue is that the installation is starting nginx
[2012-09-13 16:42:09 -0400] msch: geekbri: yep!
[2012-09-13 16:45:57 -0400] lucas_: t-work, I did that recently
[2012-09-13 16:46:11 -0400] lucas_: are you referring to chef server or bootstrapping a client?
[2012-09-13 16:48:10 -0400] Pushnell: I'd like to use a databag for node attributes, similar to chef-solo -j, and let the recipe/role choose which databag to apply.  Is this possible / am I doing it wrong?
[2012-09-13 16:49:33 -0400] lucas_: you can, but only with recipe code to do that, similar to using a different databag per environment
[2012-09-13 16:50:02 -0400] lucas_: and data bags tend to not work as expected outside a recipe, as the mixing isn't applied the same
[2012-09-13 16:50:04 -0400] Loof: Pushnell: I'm curious... what's the advantage... or what problem are you trying to solve?
[2012-09-13 16:50:07 -0400] lucas_: so, using it in an attribute file
[2012-09-13 16:50:18 -0400] lucas_: won't work with the same as when using it in a recipe
[2012-09-13 16:50:31 -0400] j|: or, you may want to use one data bag with per environment fields.
[2012-09-13 16:51:03 -0400] j|: meh, scratch that.
[2012-09-13 16:51:26 -0400] j|: fingers type before brain thinks sometimes. sorry
[2012-09-13 16:56:03 -0400] uncommitted: chef would be so much easier for me if I knew ruby worth a darn :)
[2012-09-13 16:59:08 -0400] t-work: lucas_: server, but i got it, thanks :)
[2012-09-13 17:05:40 -0400] Pushnell: Ok, first off, I'm a chef noob.  But the general environment here is we have dozens of websites on a bunch of different nodes, and we want to do a/b testing with different site configs.  We also want to allow devs to configure and deploy sites without having to poke at the recipes.  I thought the easiest way to accomplish this would be with a "website" recipe and a bunch of databag items, one for each site config.  I want t
[2012-09-13 17:06:40 -0400] Pushnell: But it seems that there is no natural way for databag data to override attribute data.  They're two separate data realms, and if I want them to interact I have to do it myself.
[2012-09-13 17:07:21 -0400] Pushnell: So, for each attribute, check if there is a databag override and if not then use the node attribute for a default value.
[2012-09-13 17:08:37 -0400] Pushnell: I know my conception of chef might be off, so let me know if it is.  This was the initial arrangement that struck me as obvious.  Json databags for all of the parameters to a recipe.
[2012-09-13 17:10:26 -0400] Pushnell: Which is very similar to using chef-solo -j, but I don't know how to get there from here.  I thought perhaps there would be a method I could call that did the same thing as -j
[2012-09-13 17:10:50 -0400] Pushnell: (from inside a recipe)
[2012-09-13 17:11:40 -0400] lucas_: Pushnell: looks like you're trying to do this: https://github.com/karmi/cookbook-elasticsearch/blob/master/attributes/plugin_aws.rb
[2012-09-13 17:14:33 -0400] Pushnell: lucas_: yeah, that looks like the manual version of what I was talking about.  I guess I could write that as a foreach just to suck in everything.
[2012-09-13 17:15:05 -0400] lucas_: yeah, not sure I would recommend it though. I'm actually pulling that out of the recipe as I've had some issues
[2012-09-13 17:15:08 -0400] Pushnell: I'm basically duplicating the functionality of -j though so I thought there must be some built-in way of handling that.  (Or, I'm just plain doing it wrong.)
[2012-09-13 17:15:22 -0400] Pushnell: lucas_: curious, what issues?
[2012-09-13 17:15:36 -0400] lucas_: even though the database is there, it doesn't seem to be finding it
[2012-09-13 17:15:47 -0400] lucas_: can't figure out why and it's easier to just toss it in as an attribute in an environment or role
[2012-09-13 17:16:10 -0400] lucas_: I like the idea of data bags, but it still needs some work I think
[2012-09-13 17:16:27 -0400] btm_: Pushnell: walk the databag in a loop and populate attributes from it, overriding what is there and not replacing what isn't?
[2012-09-13 17:17:04 -0400] lucas_: (it could be that the approach used in the link I sent you isn't recommend, maybe something about when attributes are loaded vs recipes, etc)
[2012-09-13 17:17:19 -0400] lucas_: I've found data bag usage in recipes to be rock solid, so, could be that
[2012-09-13 17:17:22 -0400] Pushnell: btm_: exactly.  I'm just surprised that this doesn't exist somewhere in chef already.
[2012-09-13 17:18:25 -0400] Pushnell: btm_: either that, or I'm missing something.
[2012-09-13 17:19:26 -0400] btm_: Pushnell: like what? a load_attributes_from_bag method? it's not that complicated of a pattern.
[2012-09-13 17:20:15 -0400] yfeldblum: Pushnell, why are you doing a/b at the infra or app-deployment level? why not from the application?
[2012-09-13 17:20:32 -0400] chrisss: Hi, I'm setting some machines with chef, I've to deploy different applications based on the server (some has 1 app, others more), I'm thinking about doing the whole deploy process with capistrano. How should I set chef in order to set the basic data (log folders, database.yml, and other files)? I was thinking about setting an applications[] value on each node and then access it from the role's recipes. Is it safe or should I do it in a
[2012-09-13 17:21:07 -0400] Pushnell: yfeldblum: we're doing a/b infra testing.  So, for example, does a specific site perform any better with nginx vs apache.  etc.
[2012-09-13 17:30:20 -0400] Pushnell: (or more precisely, does writing code a specific way work better under one server or the other)
[2012-09-13 17:31:10 -0400] greenmoss: is it possible to read the contents of a cookbook_file resource from within a chef recipe?
[2012-09-13 17:31:59 -0400] jwitrick: is it possible to call a definition from within a ruby block?
[2012-09-13 17:32:53 -0400] martinisoft: is it advisable to manage hostnames via chef?
[2012-09-13 17:40:16 -0400] j|: martinisoft: sure, but you'll have to integrate your DNS somehow. There's a route53 cookbook, but I haven't used it
[2012-09-13 17:40:55 -0400] j|: and that's assuming you don't mind using route53 for your nameservers.
[2012-09-13 17:41:26 -0400] martinisoft: already do for an ec2 cluster
[2012-09-13 17:41:35 -0400] martinisoft: but for my linodes I use DNSimple
[2012-09-13 17:46:51 -0400] martinisoft: hmm, these seem nice as LWRPs, but wondering about managing hostnames too
[2012-09-13 17:47:48 -0400] fish_: hrm.. looks like the search syntax changed between chef 0.9 and chef 0.10, right?
[2012-09-13 17:47:48 -0400] bsdguru: is there a way to override the behaviour of user and resource management?
[2012-09-13 17:56:46 -0400] oddover: hi chefs. what does the "disable" option for the service resource do? would that be a chkconfig off?
[2012-09-13 17:56:52 -0400] BryanWB: ohai chefs!
[2012-09-13 17:59:52 -0400] BryanWB: ohai chefs!
[2012-09-13 18:00:00 -0400] jmartin: ohai
[2012-09-13 18:00:08 -0400] oddover: ohai BryanWB
[2012-09-13 18:00:51 -0400] btm_: oddover: yes, service :disable is making the service not run on startup.
[2012-09-13 18:01:02 -0400] oddover: btm_: thanks!
[2012-09-13 18:01:22 -0400] oddover: so this: service "NetworkManager" do   action [ :stop, :disable] end
[2012-09-13 18:01:38 -0400] oddover: would turn off NetworkManager, and keep it off?
[2012-09-13 18:13:42 -0400] Pushnell: oddover: yep
[2012-09-13 18:14:22 -0400] corp: hey
[2012-09-13 18:14:37 -0400] corp: will LWRPs obey not_if and only_if?
[2012-09-13 18:15:36 -0400] miketheman: corp: they should
[2012-09-13 18:17:39 -0400] geekbri: yes LWRP's will honor guards
[2012-09-13 18:17:46 -0400] geekbri: you can't use guards with definitions though
[2012-09-13 18:24:37 -0400] yfeldblum: resources have guards, whether builtin, heavyweight shipped with gems, heavyweight shipped with cookbooks, or lightweight shipped with cookbooks
[2012-09-13 18:26:41 -0400] corp: thanks
[2012-09-13 18:31:04 -0400] timops: ok
[2012-09-13 18:31:10 -0400] timops: oops, wrong window :-D
[2012-09-13 18:31:39 -0400] Guest80463: it/qu
[2012-09-13 18:31:44 -0400] Guest80463: it/qu
[2012-09-13 18:32:08 -0400] fish_: is there a breaking changes log for 0.9<->0.10?
[2012-09-13 18:37:32 -0400] hoover_damm: fish_, http://wiki.opscode.com/display/ChefCN/Upgrading+Chef+0.9.x+to+Chef+0.10.x
[2012-09-13 18:37:56 -0400] hoover_damm: fish_, that's the upgrade guide lol somehow i hit chinese ... in english
[2012-09-13 18:38:41 -0400] hoover_damm: fish_, as far as cookbook breakage... easiest way to test is to sign up a hosted account and run your recipes on hosted
[2012-09-13 18:38:44 -0400] hoover_damm: and see how they fare
[2012-09-13 18:39:01 -0400] hoover_damm: fish_, then you can update your recipes and update to 10. when your ready
[2012-09-13 18:41:08 -0400] PapaSierra: does anyone know of a chef recipe that installs php 5.4
[2012-09-13 18:45:32 -0400] fish_: hoover_damm: I've already setup a chef 10 server and searches are breaking, so I'm looking for specific syntax changes
[2012-09-13 18:46:16 -0400] chrisss: I'm setting some machines with chef, I've to deploy different applications based on the server (some has 1 app, others more), I'm thinking about doing the whole deploy process with capistrano. How should I set chef in order to set the basic data (log folders, database.yml, and other files)? I was thinking about setting an applications[] value on each node and then access it from the role's recipes. Is it safe or should I do it in anoth
[2012-09-13 18:46:48 -0400] srleod: Howdy!  Anybody give me hints why changes to a template file aren't making it to my node?  I upload the cookbook to hosted chef server, and can see the changes there through the management console, but when I run chef-client, the metadata.rb gets the new version, but the new template file isn't there.
[2012-09-13 18:46:59 -0400] fish_: hoover_damm: looks like it's breaking on searches where value contains /
[2012-09-13 18:50:20 -0400] fish_: hoover_damm: hrm.. Is this expected? can't get any search working where value contains /. tried to escape it with \, with wrapping in "" and '', as well as urlencode it but nothing works
[2012-09-13 18:50:42 -0400] srleod: ... that is it's not in /var/chef/cache/cookbooks, and it's not being used either
[2012-09-13 18:51:34 -0400] fish_: my guess is that chef hands those queries over to solr without proper escaping
[2012-09-13 18:52:15 -0400] hoover_damm: fish_, hrm maybe you can escape the searches better
[2012-09-13 18:52:18 -0400] hoover_damm: with %w or something?
[2012-09-13 18:52:23 -0400] hoover_damm: fish_, got an example of the searches failing?
[2012-09-13 18:52:46 -0400] fish_: hoover_damm: knife search node 'foo:ba/r'
[2012-09-13 18:54:14 -0400] fish_: same result for foo:ba\/r, foo:"ba/r", '"foo:ba/r"' and even foo:ba%2Fr
[2012-09-13 18:54:37 -0400] hoover_damm: i wonder how 0.9.x escaped that
[2012-09-13 18:54:38 -0400] hoover_damm: differently
[2012-09-13 18:54:51 -0400] fish_: with 0.9.18 this works fine
[2012-09-13 18:55:25 -0400] hoover_damm: fish_, you should sniff the traffic and see the different urls
[2012-09-13 18:55:41 -0400] hoover_damm: fish_, because I'm suprised it worked
[2012-09-13 18:56:02 -0400] fish_: ok, lets see
[2012-09-13 18:59:51 -0400] hoover_damm: fish_, http://wiki.opscode.com/display/chef/Search doesn't liste / as special
[2012-09-13 18:59:54 -0400] hoover_damm: it lists \ as special
[2012-09-13 19:00:56 -0400] fish_: hrm.. is chef-server talking to solr dirctly or via some other service?
[2012-09-13 19:00:59 -0400] srleod: are templates specific to an environment?
[2012-09-13 19:03:00 -0400] hoover_damm: chef-server talks to it
[2012-09-13 19:03:17 -0400] hoover_damm: so it's 4000 -> solr
[2012-09-13 19:05:44 -0400] fish_: hoover_damm: hrm let me try again, looks like it doesn't issue a query at all
[2012-09-13 19:06:36 -0400] jhulten: chrisss: I set up a role for each application I deploy and a common role for things that go on all boxes.
[2012-09-13 19:07:34 -0400] fish_: hoover_damm: but here is the query from 0.9.18: GET /solr/select?wt=ruby&fq=%2BX_CHEF_database_CHEF_X%3Achef+%2BX_CHEF_type_CHEF_X%3Anode&q=foo%3Aba%2Fr&indent=off&start=0&rows=20 HTTP/1.1
[2012-09-13 19:07:34 -0400] chrisss: jhulten: it sounds as a good plan :-)
[2012-09-13 19:09:15 -0400] srleod: why would my templates/default directory be blank on a real node but not in the chef server?
[2012-09-13 19:09:33 -0400] hoover_damm: srleod, you had templates but they were not requested...
[2012-09-13 19:09:52 -0400] jhulten: I also try to write cookbooks that can install all of a class of services (like play2 apps or war files), then have that recipe look up what version to deploy from the attributes which I set in the environments. Lets you manage application/environment lifecycle without too much pain.
[2012-09-13 19:09:59 -0400] hoover_damm: srleod, the cache will only download what you need to run... if you do a run and it doesn't need some... it removes the fat
[2012-09-13 19:10:02 -0400] hoover_damm: so to speak
[2012-09-13 19:10:20 -0400] fish_: hoover_damm: yep, it doesn't even get to solr
[2012-09-13 19:10:23 -0400] srleod: that makes sense.
[2012-09-13 19:11:14 -0400] srleod: oh i see!  the template is triggered on another action which isn't firing.
[2012-09-13 19:11:22 -0400] chrisss: jhulten: what do you use for backups? duplicity?
[2012-09-13 19:11:29 -0400] hoover_damm: srleod, right not needed
[2012-09-13 19:11:43 -0400] hoover_damm: fish_, then fix chef-server-api and open a ticket on said issue
[2012-09-13 19:12:04 -0400] fish_: hoover_damm: yep, looks like chef-server-api is filtering that for whatever reason
[2012-09-13 19:12:20 -0400] hoover_damm: fish_, find the code you'll find a reason hehe
[2012-09-13 19:12:54 -0400] awgross|flashman: is it expected that there is a delay between the creation a Node and the ability to see it in knife search?
[2012-09-13 19:13:15 -0400] fish_: awgross|flashman: maybe your rabbitmq is backlogging
[2012-09-13 19:13:23 -0400] hoover_damm: awgross|flashman, how big is your delay?
[2012-09-13 19:13:26 -0400] awgross|flashman: fish_: not running my own chef server
[2012-09-13 19:13:31 -0400] awgross|flashman: maybe a minute or 2
[2012-09-13 19:13:40 -0400] awgross|flashman: my automated test runs, bootstraps a fresh EC2 node with knife
[2012-09-13 19:13:47 -0400] awgross|flashman: runs a chef-client run with minitest
[2012-09-13 19:14:00 -0400] awgross|flashman: then searches for its own name with knife to get it's FQDN
[2012-09-13 19:14:04 -0400] awgross|flashman: so it cna copy over the test results
[2012-09-13 19:14:10 -0400] awgross|flashman: and shut itself down
[2012-09-13 19:15:10 -0400] awgross|flashman: normally i am able to search myself right away, took me about a minute this last time
[2012-09-13 19:15:44 -0400] awgross|flashman: a minute after the chef run finished*
[2012-09-13 19:17:17 -0400] awgross|flashman: i think ill just switch to knife node show
[2012-09-13 19:17:22 -0400] awgross|flashman: instead of doing a search
[2012-09-13 19:18:40 -0400] jhulten: chrisss: Backing up what?
[2012-09-13 19:18:46 -0400] uncommitted: anyone using the reprepro cookbook? can't figure out how to insert the PGP keys into the data bag.
[2012-09-13 19:25:06 -0400] awgross|flashman: Thanks for the free pass to the community summit Opscode, you guys rock
[2012-09-13 19:27:34 -0400] geekbri: When is opscode gonna have something on the East Coast :-P
[2012-09-13 19:27:42 -0400] chrisss: jhulten: mostly the db (postgres, redis, etc) dump... all the other files are from github or s3
[2012-09-13 19:29:55 -0400] jhulten: chrisss: Are your instances EBS backed or instance store?
[2012-09-13 19:31:11 -0400] chrisss: jhulten: I'm on dedicated servers, with space for backups on an external server (to be double sure I'll uploaded them to s3 too)
[2012-09-13 19:31:39 -0400] fish_: hoover_damm: really weird.. it looks like this shouldn't have worked in 0.9.18 :)
[2012-09-13 19:32:08 -0400] jhulten: I do all my stuff on EC2 at the moment so I select tools that cluster and fail nicely.
[2012-09-13 19:32:24 -0400] awgross|flashman: geekbri: agreed, I cant go all the way to WA for 2 days
[2012-09-13 19:33:05 -0400] geekbri: I may or may not be able to, but if it were in say... Boston or  NY that would be certainly a yes for sure :)
[2012-09-13 19:33:36 -0400] chrisss: jhulten: ok
[2012-09-13 19:33:56 -0400] fish_: hoover_damm: ah nope, looks like 0.9 didn't do much to the query and just send it to solr where 10 is doing a lot of parsing
[2012-09-13 19:34:57 -0400] fish_: wondering why we are the only people using / in their searches ;)
[2012-09-13 19:52:02 -0400] fish_: hrm unsure about the severity
[2012-09-13 19:53:32 -0400] fish_: hoover_damm: do you think it's a blocker? for sure, it's a blocker for us - but it seems that other people don't use / in their searches ;)
[2012-09-13 19:55:35 -0400] mhalligan: has anyone seen any good blog postings, or have any suggestions, on how to hire/identify candidates who have a process/auytmation/"devops(ugh)" mentality?
[2012-09-13 19:57:14 -0400] rocket: I am trying to better understand an attribute scope issue.  I have overridden a value in one role .. but does that overridden value only work for that role and not the following role in a runlist?
[2012-09-13 19:57:23 -0400] ank: if I wanted to write a standalone ruby script/app that interacts with the chef server API would I use Chef::REST? Any examples out there?
[2012-09-13 19:57:40 -0400] bluepojo: Chef::REST works
[2012-09-13 19:58:16 -0400] bluepojo: ank: https://github.com/RiotGames/berkshelf/blob/master/lib/berkshelf/uploader.rb
[2012-09-13 19:58:39 -0400] awgross|flashman: rocket: the values are set during convergence, so it piles them all together for the whole run.  It should apply to everything in the run list once it is compiled
[2012-09-13 19:58:52 -0400] ank: bluepojo: perfect, thanks!
[2012-09-13 20:00:48 -0400] rocket: hrmm then something is weird .. it works fine for the first part of this role .. and then breaks once it goes into a second role .. :/
[2012-09-13 20:01:10 -0400] rocket: awgross|flashman: how would I debug something like this?
[2012-09-13 20:02:18 -0400] makerbreakr: ank, Spice gem
[2012-09-13 20:02:30 -0400] awgross|flashman: rocket: hmm, not sure.  Maybe have it dump the node data at the beginning of each role run
[2012-09-13 20:02:31 -0400] makerbreakr: just put the finishing touches on an app that interacts with the api
[2012-09-13 20:02:51 -0400] rava: is there a way to have a client delete it's own node/client entries on the server?
[2012-09-13 20:03:24 -0400] rava: trying to avoid setting up a notification service to deal with hosts just goign away (aws spot instances)
[2012-09-13 20:04:02 -0400] rocket: awgross|flashman: should I be overridding attributes in a role with the overrride_attribute option instead of the default_attribute?
[2012-09-13 20:04:54 -0400] awgross|flashman: rocket: i believe so
[2012-09-13 20:05:26 -0400] fish_: hoover_damm: haha, right into the next parse error :)
[2012-09-13 20:05:27 -0400] awgross|flashman: rava: its tricky unless you install knife and give it keys
[2012-09-13 20:06:12 -0400] awgross|flashman: rava:  simpler to just have a cron job that runs every 10 or so minutes and deletes and clients/nodes that no longer have a corresponding AWS instance
[2012-09-13 20:06:42 -0400] rava: awgross|flashman: yeah, the more i think about the more that makes sense
[2012-09-13 20:06:59 -0400] awgross|flashman: thats how I clear out EBS vols from hosts that go down
[2012-09-13 20:07:09 -0400] awgross|flashman: instead of trying to have some complicated pre-shutdown script
[2012-09-13 20:07:20 -0400] awgross|flashman: I like to keep my nodes as dumb as possible
[2012-09-13 20:07:30 -0400] rava: awgross|flashman: i was looking at reusing rabbitmq instance used by chef server, but then started going over securing the messages, host auth, blah..
[2012-09-13 20:08:18 -0400] rava: awgross|flashman: it would just be 2 init scripts "hey, i'm awake, am i still a recognized node? no, reregister." and "good bye cruel world! chef, this is my last will"
[2012-09-13 20:08:47 -0400] fish_: hrm looks like my fix broke other stuff
[2012-09-13 20:09:36 -0400] awgross|flashman: rava: it sounds simple enough, but the removal requires more privileges than the registration AFAIK
[2012-09-13 20:10:10 -0400] rava: awgross|flashman: i've a local admin user that would be subscribed to the topic on the chef server
[2012-09-13 20:10:47 -0400] rava: awgross|flashman: the wake up message might have a call to s3 to grab a validation key using an instance role credential
[2012-09-13 20:12:10 -0400] awgross|flashman: rava: is it possible to be notified of the shutdown sent to the spot instance?
[2012-09-13 20:12:28 -0400] awgross|flashman: coudl just bootstrap a spot instance with knife
[2012-09-13 20:12:36 -0400] awgross|flashman: and then shut it down when notified by AWS
[2012-09-13 20:13:04 -0400] rava: awgross|flashman: not in a timely enough manner that i'm aware of, but the instances go through a full shutdown sequence when told to terminate
[2012-09-13 20:13:16 -0400] awgross|flashman: ok
[2012-09-13 20:13:24 -0400] rava: awgross|flashman: so pre-shutdown scripts is what i would rely on
[2012-09-13 20:13:30 -0400] awgross|flashman: wasnt sure if they posted the shutdowns to SNS
[2012-09-13 20:13:34 -0400] awgross|flashman: kk
[2012-09-13 20:13:39 -0400] awgross|flashman: tho
[2012-09-13 20:13:46 -0400] rava: awgross|flashman: that would be fricking sweet :/
[2012-09-13 20:14:01 -0400] awgross|flashman: you could have the node have an IAM for jsut 1 SNS topic
[2012-09-13 20:14:04 -0400] awgross|flashman: and post that message
[2012-09-13 20:14:10 -0400] awgross|flashman: so it can get cleaned up asynch
[2012-09-13 20:14:45 -0400] rava: SNS is pricey though, rather just reuse the running rabbitmq server on chef-server
[2012-09-13 20:14:49 -0400] awgross|flashman: not sure of the leeway in shutdown times for spot instances
[2012-09-13 20:15:52 -0400] miah: hi
[2012-09-13 20:15:55 -0400] maek: I have a centos box with omnibus installed chef-client, should I be updating it via the same rpm?
[2012-09-13 20:16:09 -0400] rava: miah: hi
[2012-09-13 20:17:04 -0400] miah: maek: http://community.opscode.com/cookbooks/omnibus_updater
[2012-09-13 20:17:39 -0400] maek: miah: ty
[2012-09-13 20:20:48 -0400] rava: i'm starting to wonder if i just shouldn't use chef-solo with the server's repo for this test environment
[2012-09-13 20:21:05 -0400] rava: except i'd lose all the databag searching..blargh
[2012-09-13 20:26:32 -0400] ohlol: anyone know why foodcritic would claim that this https://gist.github.com/534479ae0788ac66ada6 does not notify when updated ?
[2012-09-13 20:28:17 -0400] BryanWB: danryan, around?
[2012-09-13 20:28:33 -0400] danryan: BryanWB: yo!
[2012-09-13 20:29:15 -0400] BryanWB: danryan, hey man, what u think of my mind to have a stripped-down mode for mastermind for use w/ vagrant?
[2012-09-13 20:29:26 -0400] BryanWB: if u think it stupid, np ;)
[2012-09-13 20:29:52 -0400] miah: rava: you can't search databags, but you can load them directly with 'data_bag' and 'data_bag_item'
[2012-09-13 20:30:04 -0400] miah: i've been making the nagios cookbook work with chef solo
[2012-09-13 20:30:27 -0400] rava: miah: yeah, but we have some auth databags whose values we don't keep in plain text in the chef repo
[2012-09-13 20:30:38 -0400] miah: right
[2012-09-13 20:30:41 -0400] danryan: BryanWB: I loved it, actually! I spent the better part of last night rewriting everything.
[2012-09-13 20:30:45 -0400] miah: you can still use encrypted data bags afaik in solo
[2012-09-13 20:30:56 -0400] rava: miah: ah, doh yeah i'm an idiot :)
[2012-09-13 20:31:36 -0400] miah: no, not an idiot =)
[2012-09-13 20:32:00 -0400] fish_: and found another search syntax supported by chef 0.9.18 but not chef 10: knife search node 'foo:"ba:r"'
[2012-09-13 20:32:03 -0400] BryanWB: danryan, sweet can't wait to play w/ it
[2012-09-13 20:32:26 -0400] rava: miah: i'll poke at the idea this weekend
[2012-09-13 20:32:30 -0400] BryanWB: danryan, i think the problem w/ existing orchestration frameworks is that u have to do so much to get started
[2012-09-13 20:32:38 -0400] rava: miah: if it works smoothly, i can use it for the auto scaling groups
[2012-09-13 20:32:41 -0400] danryan: BryanWB: will likely follow the solo vs. client/server pattern
[2012-09-13 20:32:50 -0400] jasond: i have some plain ruby code in a recipe that i expected to run sequentially, but i think it's being run during "compile time", before the preceding code.  is there a way i can make it run during "execute time"?
[2012-09-13 20:33:17 -0400] BryanWB: danryan: sweet
[2012-09-13 20:33:18 -0400] danryan: BryanWB: agreed 100%. I just want something that basically runs a script
[2012-09-13 20:33:23 -0400] rava: i hate having that part of my env the only one that doesn't have chef running config, due to the up/down register/dereg that has to keep happening
[2012-09-13 20:33:36 -0400] miah: ya, it should work fine
[2012-09-13 20:33:38 -0400] spox: jasond: use the 'ruby_block' resource
[2012-09-13 20:33:59 -0400] jasond: spox: i'll try that.  thanks
[2012-09-13 20:35:20 -0400] fish_: wondering what the reason behind filtering the searches was
[2012-09-13 20:35:47 -0400] fish_: I mean, why don't just url encode and hand it over to solr like chef < 0.10 did?
[2012-09-13 20:36:24 -0400] yfeldblum: fish_, what do you mean by "not supported"?
[2012-09-13 20:36:41 -0400] fish_: yfeldblum: well, it's not working :)
[2012-09-13 20:36:49 -0400] yfeldblum: fish_, define "not working"?
[2012-09-13 20:36:50 -0400] fish_: yfeldblum: but it worked fine with 0.9.18
[2012-09-13 20:37:04 -0400] fish_: yfeldblum: WARN: HTTP Request Returned 400 Bad Request: invalid search query: 'foo:"ba:r"' Parse error at offset: 3 Reason: Expected one of \, " at line 1, column 8 (byte 8) after :"ba
[2012-09-13 20:37:14 -0400] fish_: yfeldblum: because if the :
[2012-09-13 20:37:39 -0400] fish_: yfeldblum: foo:bar\:r works fine, but prior to 0.10 you could 'escape' that by wrapping it in "
[2012-09-13 20:38:59 -0400] fish_: I think the chef parser turns foo:"ba:r" into foo:\"bar:r\" which in fact would break
[2012-09-13 20:40:38 -0400] yfeldblum: fish_, chef doesn't lucene-encode things so far as i know
[2012-09-13 20:41:05 -0400] fish_: yfeldblum: it sanitized/parses it - no idea why
[2012-09-13 20:41:22 -0400] fish_: yfeldblum: look at chef/lib/chef/solr_query
[2012-09-13 20:41:40 -0400] fish_: chef/lib/chef/solr_query/lucene.treetop defines the syntax
[2012-09-13 20:46:27 -0400] fish_: yfeldblum: would be really interesting to know why opscode decides to parse all that..
[2012-09-13 20:49:03 -0400] joemiller: is there an ETA on 10.14.3 ?
[2012-09-13 20:51:56 -0400] miketheman: joemiller: 10.14.3 is a development version number - the patched release will be 10.14.4
[2012-09-13 20:54:08 -0400] joemiller: is there an eta on 10.14.4? =)
[2012-09-13 20:55:45 -0400] yfeldblum: joemiller, "when it's ready"
[2012-09-13 20:59:32 -0400] joemiller: what's the criteria for ready?
[2012-09-13 20:59:56 -0400] maxmande1s: As mentioned previously, new to both OSX, Ruby and Chef - but making progress! Having trouble installing ruby-shadow for setting password with user resource: https://gist.github.com/3717602 Not sure where to begin in debugging this - any tips>
[2012-09-13 21:00:57 -0400] juliancdunn: maxmande1s: you probably need some -devel libraries for libshadow
[2012-09-13 21:02:48 -0400] maxmanders: juliancdunn: brew install libshadow-devel?
[2012-09-13 21:03:15 -0400] juliancdunn: maxmanders: seems like a sensible thing to try
[2012-09-13 21:03:46 -0400] maxmanders: cool - well that's a nudge in the right direction - I'll see what I can come up with - cheers!
[2012-09-13 21:09:40 -0400] rocket: how do I dump the node attributes to debug them during a chef run?
[2012-09-13 21:21:00 -0400] awgross|flashman: rocket: you could prob just call Chef::Log.debug(node)
[2012-09-13 21:21:08 -0400] awgross|flashman: to call the to_s on the object
[2012-09-13 21:21:52 -0400] maxmanders: So - according to the #ruby channel, libshadow won't work on OSX because it doesn't have shadow.h - Surely that can't mean that if my Chef workstation is on OSX then I can't use the user resource with a defined password
[2012-09-13 21:23:35 -0400] awgross|flashman: maxmanders: you are prob going to need to hook in to however OS x does command line user management
[2012-09-13 21:23:57 -0400] awgross|flashman: im sure they are contrarian about it, like most useful linux defacto standards
[2012-09-13 21:26:22 -0400] awgross|flashman: does anyone have contact info for the ops people at Riot Games, want to talk to them about how they set up their cookbook testing in Jenkins
[2012-09-13 21:28:29 -0400] miah: guh. my opscode.com login is still associated with a old job and i can't reset my password.
[2012-09-13 21:28:56 -0400] miah: and i can't open a ticket because i dont have my login. fml.
[2012-09-13 21:29:03 -0400] awgross|flashman: just create a new one
[2012-09-13 21:29:32 -0400] maxmanders: awgross|flashman: cheers for the encouragement - I'll keep digging ;-)
[2012-09-13 21:30:59 -0400] miah: can i get a opscode person to assist me with this derp?
[2012-09-13 21:34:11 -0400] miah: awgross|flashman: uh. i use hosted chef and my account is associated with multiple organizations. i'd rather not create a new account.
[2012-09-13 21:34:38 -0400] miketheman: miah: I always have my hosted account email associated with my personal email address
[2012-09-13 21:34:45 -0400] miketheman: something to consider for the future.
[2012-09-13 21:34:51 -0400] miah: well. i thought mine was.
[2012-09-13 21:34:58 -0400] miah: i generally use my personal account email as well.
[2012-09-13 21:36:37 -0400] miketheman: miah: have you tried emailing support@opscode.com ?
[2012-09-13 21:38:08 -0400] miah: ya. but thats slow.
[2012-09-13 21:38:42 -0400] ribo: using the deploy resource, doesn't seem like chef is picking up and running what's in deploy/before_migrate.rb
[2012-09-13 21:38:42 -0400] maxmanders: Maybe I'm thinking about this the wrong way - and I should instead be trying to find out how _not_ to use shadow passwords in Chef...
[2012-09-13 21:38:55 -0400] awgross|flashman: miah: oic, fair enough.
[2012-09-13 21:39:11 -0400] ribo: is there some new logic for this?
[2012-09-13 21:39:20 -0400] miah: Opscode requires that your ticket be associated with a user in our system and we
[2012-09-13 21:39:21 -0400] miah: were unable to find one corresponding to "miah@chia-pet.org".
[2012-09-13 21:39:22 -0400] miah: FML
[2012-09-13 21:39:53 -0400] miketheman: fut the wuck.
[2012-09-13 21:40:28 -0400] miah: i could just respond to the email i got from jesse, but i dont think i should exploit that avenue =)
[2012-09-13 21:42:29 -0400] organicveggie: anyone using chef-client on the server with rvm? i'm on centos and looking for help getting my init script working to daemonize chef-client.
[2012-09-13 21:45:22 -0400] jgoulah: can i put a ruby function in a chef recipe? if so how?
[2012-09-13 21:45:23 -0400] hoover_damm: miah, just email support@
[2012-09-13 21:45:28 -0400] miah: i did.
[2012-09-13 21:45:38 -0400] miah: you can't email them unless your email is associated with an account
[2012-09-13 21:45:58 -0400] miah: my problem is i no longer have access to the email that is associated with my account
[2012-09-13 21:46:19 -0400] miah: so i can't reset, or email support.
[2012-09-13 21:46:42 -0400] miah: jgoulah: libraries
[2012-09-13 21:46:58 -0400] miah: http://wiki.opscode.com/display/chef/Libraries
[2012-09-13 21:47:33 -0400] jgoulah: miah: thanks
[2012-09-13 21:52:50 -0400] ssd7: miah: We still got your email even though the ticket system bounced it
[2012-09-13 21:53:02 -0400] ssd7: I'll make sure someone follows up
[2012-09-13 21:56:14 -0400] hoover_damm: miah, :) with the email it works :)
[2012-09-13 21:56:22 -0400] hoover_damm: just a little nudge on the side
[2012-09-13 21:57:07 -0400] coderanger: miah: I can do it, what addr do you want?
[2012-09-13 21:58:57 -0400] miah: miah@chia-pet.org
[2012-09-13 22:00:18 -0400] coderanger: Whois checks out so if this is an account hack someone is going to a lot of trouble :)
[2012-09-13 22:00:20 -0400] rava: <3 the domain name miah
[2012-09-13 22:00:34 -0400] miah: coderanger: feel free to call me for confirmation
[2012-09-13 22:01:00 -0400] hoover_damm: miah, I hope you fix the domain soon so you own it again
[2012-09-13 22:01:06 -0400] miah: i do own it
[2012-09-13 22:02:05 -0400] miah: my problem is that my opscode account was still associated with my previous job at cx.com
[2012-09-13 22:02:14 -0400] miah: though i thought i updated that email address when i left cx
[2012-09-13 22:02:51 -0400] miah: rava: =)
[2012-09-13 22:03:16 -0400] yfeldblum: miah, if only you could CM your jira account info
[2012-09-13 22:03:29 -0400] ribo: having some problems with my chef deploy resource, it's not running my deploy/before_migrate.rb callback script
[2012-09-13 22:03:30 -0400] miah: cm?
[2012-09-13 22:03:38 -0400] miah: fwiw. http://en.wikipedia.org/wiki/Idoru (why chia pet)
[2012-09-13 22:04:02 -0400] organicveggie: Still trying to daemonize chef-client on CentOS with RVM. I'm including /etc/profile.d/rvm.sh in the chef-client init script, but it's still complaining that "chef-client: command not found". Any bright ideas?
[2012-09-13 22:04:16 -0400] miah: i can login to my jira account but thats different from the opscode account
[2012-09-13 22:05:03 -0400] rava: miah: yes! i've been looking for more quality dystopia cyberpunk
[2012-09-13 22:05:18 -0400] miah: its part of a trilogy. so make sure to read all three books
[2012-09-13 22:09:41 -0400] joemiller: organicveggie: have you tried `rvm wrapper` ?
[2012-09-13 22:14:22 -0400] ribo: ok
[2012-09-13 22:14:54 -0400] Pushnell: Is there any difference between set['attribute'] or default['attribute'] in an attributes.rb file?
[2012-09-13 22:15:06 -0400] ribo: chef 10.12.0, runs deploy/ callback scripts, chef 0.14.0&.2 don't
[2012-09-13 22:15:24 -0400] ribo: is this a regression or new behavior?
[2012-09-13 22:16:51 -0400] dougireton: We have several knife exec scripts which we'd like to keep with our chef-repo. Is there a recommended place to put those?
[2012-09-13 22:18:14 -0400] juliancdunn: Pushnell: it's a precedence thing - http://wiki.opscode.com/display/chef/Attributes#Attributes-AttributeTypeandPrecedence
[2012-09-13 22:18:53 -0400] juliancdunn: ("set" is "normal")
[2012-09-13 22:19:28 -0400] juliancdunn: so if you "set" within an attributes file, you override all defaults that might be set elsewhere
[2012-09-13 22:19:39 -0400] Pushnell: ahh, ok.  thanks.
[2012-09-13 22:20:49 -0400] juliancdunn: it's best practice to use the lowest precedence level necessary in a given context
[2012-09-13 22:28:06 -0400] j2d3: so... I have a question about the "execute" resource
[2012-09-13 22:28:41 -0400] bluepojo: j2d3: what do you need to know?
[2012-09-13 22:29:22 -0400] erikh: he wants to know what love is
[2012-09-13 22:29:23 -0400] j2d3: i am trying to run a "command" that returns either an error message or a port number, and i need to keep running the command until it returns a port number with a little sleep in between so as not to hammer the remote api my command hits
[2012-09-13 22:29:25 -0400] erikh: he wants you to show him
[2012-09-13 22:29:43 -0400] ribo: I guess I'll open a bug then
[2012-09-13 22:29:54 -0400] j2d3: i am having trouble figuring out how to see what my command returns
[2012-09-13 22:30:22 -0400] bluepojo: you'd have to write that in the bash
[2012-09-13 22:30:34 -0400] bluepojo: or you could write a ruby block if you don't want detailed bash logic (which I generally don't)
[2012-09-13 22:30:38 -0400] j2d3: i have been able to get the value returned by the command like "value=`command`"
[2012-09-13 22:30:52 -0400] bluepojo: yeah, you can do that in a ruby_block resource
[2012-09-13 22:30:55 -0400] j2d3: but that gets executed too early - the backticks i wish to avoid.
[2012-09-13 22:31:13 -0400] bluepojo: ruby_block will get run at convergence and not compile time
[2012-09-13 22:31:33 -0400] j2d3: so if i do the same thing (with backticks) but wrapped in a ruby_block
[2012-09-13 22:31:36 -0400] j2d3: it will work?
[2012-09-13 22:31:39 -0400] bluepojo: sounds like it
[2012-09-13 22:31:42 -0400] bluepojo: based on what you said
[2012-09-13 22:32:04 -0400] bluepojo: http://wiki.opscode.com/display/chef/Resources#Resources-RubyBlock
[2012-09-13 22:32:10 -0400] j2d3: that's what i was just trying, so i guess i'm on the right track. lemme see :) thanks!
[2012-09-13 22:32:19 -0400] erikh: are you trying to do dynamic port allocation?
[2012-09-13 22:32:38 -0400] erikh: e.g., bind() checking?
[2012-09-13 22:32:49 -0400] erikh: it's pretty easy to do in straight ruby, and will be significantly faster if you do.
[2012-09-13 22:33:24 -0400] j2d3: no the "command" is really a python script that hits the loggly api, first to create a loggly "input", then next to describe the input in order to get the port number that loggly assigns
[2012-09-13 22:33:33 -0400] erikh: aha
[2012-09-13 22:33:59 -0400] j2d3: that's why i need a little sleep time in between creating and then checking for what port number it is. it isn't available immediately
[2012-09-13 22:34:10 -0400] erikh: makes sense
[2012-09-13 22:34:20 -0400] j2d3: and also why i can't have it run too early, becuase the python tools / loggly api need to be set up / installed first.
[2012-09-13 22:34:58 -0400] bluepojo: this is also a case where you could write an LWRP for loggly
[2012-09-13 22:35:11 -0400] j2d3: i started with this cookbook: https://github.com/EA2D/loggly-cookbook
[2012-09-13 22:35:35 -0400] j2d3: which has been helpful in getting me started on this loggly project, but it doesn't work out of the box, unfortunately.
[2012-09-13 22:35:51 -0400] bluepojo: you can abstract all of this into straight ruby code with an LWRP and then just call the resource rather than having to deal with rubyblocks
[2012-09-13 22:35:59 -0400] bluepojo: then the code will be reusable for all projects that need loggly
[2012-09-13 22:36:14 -0400] bluepojo: if I'm understanding what you're trying to do
[2012-09-13 22:36:18 -0400] erikh: yeah, I doubt it's hard, it's whether or not it's worth the effort to you
[2012-09-13 22:36:53 -0400] erikh: speaking of effort, does anyone know what godawful dirt-old version of chef engineyard is using?
[2012-09-13 22:36:55 -0400] bluepojo: loggly is a component of an application, so writing the LWRP and using it in your application cookbook is the correct way to do it
[2012-09-13 22:36:59 -0400] erikh: hoover_damm: ping
[2012-09-13 22:37:41 -0400] j2d3: once i have the port number, i use it to set up the config in rsyslog (with chef) which is why i need the port number back into my chef recipe
[2012-09-13 22:38:14 -0400] erikh: yeah, that does sound like a good application for a LWRP
[2012-09-13 22:38:24 -0400] erikh: or even better - a libraryh
[2012-09-13 22:38:27 -0400] j2d3: the recipe also writes that port number into a cache file so that on further runs, if the input is setup already, it skips past this stuff.
[2012-09-13 22:38:31 -0400] erikh: that works into a rsyslog provider.
[2012-09-13 22:40:00 -0400] rava: anyone know a good python interface for chef?
[2012-09-13 22:40:37 -0400] rava: i've tried pychef, but it's cludgey and not well documented
[2012-09-13 22:40:37 -0400] j2d3: i know what you're saying about abstracting this stuff out of chef and into a script that handles pretty much the whole ordeal - setup the input, get the port number, setup and restart rsyslog. i started with that public cookbook for loggly/chef integration, and so that's why i'm where i am. nearly at the finish line.
[2012-09-13 22:41:05 -0400] flaccid: rava: prolly just shell to chef, personally i don't see much of a point in a binding
[2012-09-13 22:41:48 -0400] rava: flaccid: just ugly to me to subprocess down to a shell to run knife when the api is there
[2012-09-13 22:42:42 -0400] rava: we use boto to control our aws resources, would be nice to keep everything pythonic :)
[2012-09-13 22:43:04 -0400] rava: at least until chef gets an endpoint for clients to use to be able to deregister themselves
[2012-09-13 22:44:04 -0400] flaccid: rava: its ugly to do it whichever way here
[2012-09-13 22:44:12 -0400] flaccid: nothing run with doing it normally..
[2012-09-13 22:44:48 -0400] flaccid: *wrong
[2012-09-13 22:45:25 -0400] flaccid: i like things like fabric though i must say. i can show you the other way around hehe https://github.com/flaccid/cookbooks/tree/master/cookbooks/boto
[2012-09-13 22:45:47 -0400] bluepojo: j2d3: I don't mean out of chef... LWRPs and libraries are built into chef for this use case.
[2012-09-13 22:45:47 -0400] rava: aye, i dig fabric. we use that extensively aswell
[2012-09-13 22:46:11 -0400] rava: what i'm trying to accomplish is clearing out dead nodes/clients that end up after spot instances in aws are terminated
[2012-09-13 22:46:13 -0400] mhalligan: can I pass a hash to template definition for interpolation with "variables (@hashname)"
[2012-09-13 22:46:47 -0400] bluepojo: j2d3: I would write a library that does the heavy lifting (talking to loggly) and then write an LWRP that takes configuration to call the library.
[2012-09-13 22:46:55 -0400] rava: so building a cron job to clean them out for me, but wondering if it would make sense as a recipe, since chef-client runs every 3 minutes as is
[2012-09-13 22:46:56 -0400] rava: hrm..
[2012-09-13 22:47:18 -0400] flaccid: rava: i'd expect you could make a service on term there
[2012-09-13 22:47:32 -0400] rava: service on term?
[2012-09-13 22:47:33 -0400] flaccid: guess you could do it many ways
[2012-09-13 22:47:54 -0400] flaccid: so when aws terminates the spot instance, a service runs ont he runlevel shutting down to remove itself
[2012-09-13 22:48:00 -0400] j2d3: bluepojo: ohhhh. LWRP. ok i saw that as LWP - and thought u meant like - a LWP robot to talk to the API and set up the rsyslog conf given the "input name" and triggered by chef. I see what u mean now.
[2012-09-13 22:48:25 -0400] rava: right, but chef-client doesn't seem to have a flag to tell the chef-server to delete the node's node and client entries
[2012-09-13 22:48:35 -0400] bluepojo: LWRP = lightweight resource provider
[2012-09-13 22:48:38 -0400] rava: so i end up having to write a notification service
[2012-09-13 22:49:05 -0400] rava: or using one, and building the pub/sub crap + host auth, etc.. big pita :)
[2012-09-13 22:49:07 -0400] gyre008: how can a git cookbook depend on runit yum and dog i will never get
[2012-09-13 22:49:26 -0400] spox: so, using test-kitchen with a couple 'configuration' options set. is it possible for this setup to not use rvm at all?
[2012-09-13 22:50:05 -0400] bluepojo: j2d3: I also mean a chef library there's a libraries directory in the cookbook where you can put ruby classes you want to use elsewhere.
[2012-09-13 22:50:14 -0400] bluepojo: or modules, for that matter
[2012-09-13 22:51:48 -0400] j2d3: so - the benefit of doing it with a library is that it will make the recipe cleaner and the library is reusable... though i'm not sure i'd need to use it in any other cases besides this recipe...
[2012-09-13 22:52:05 -0400] bluepojo: loggly is to set up logging for a given application, right?
[2012-09-13 22:52:09 -0400] bluepojo: so
[2012-09-13 22:52:26 -0400] bluepojo: you'd have your appication cookbook, say. myapp
[2012-09-13 22:52:28 -0400] bluepojo: application
[2012-09-13 22:52:34 -0400] bluepojo: in the myapp cookbook
[2012-09-13 22:52:45 -0400] bluepojo: you'd put "depends 'loggly'" in the metadata.rb
[2012-09-13 22:53:03 -0400] bluepojo: and then you can call the LWRP defined in the loggly cookbook from myapp's recipes
[2012-09-13 22:53:14 -0400] bluepojo: so your application specific setup is done in myapp's cookbook
[2012-09-13 22:53:24 -0400] bluepojo: and the loggly logic is encapsulated in the loggly cookbook
[2012-09-13 22:53:28 -0400] bluepojo: j2d3: ^
[2012-09-13 22:53:56 -0400] j2d3: ah okay. i see. as it is i've added the loggly recipes for each app to the roles.
[2012-09-13 22:54:07 -0400] bluepojo: ah, that could get you into trouble
[2012-09-13 22:54:09 -0400] bluepojo: roles are not versioned
[2012-09-13 22:54:28 -0400] bluepojo: cookbooks are
[2012-09-13 22:54:31 -0400] j2d3: and each app has a "recipe" which is really just a little conf file all which depend on the "definition"
[2012-09-13 22:54:37 -0400] flaccid: insert fllod here
[2012-09-13 22:54:51 -0400] j2d3: the definition being the main part of the recipe that does stuff.
[2012-09-13 22:54:51 -0400] bluepojo: one rule of thumb is never to use a role like a dependency list
[2012-09-13 22:55:00 -0400] bluepojo: cookbooks need to handle all dependencies
[2012-09-13 22:55:14 -0400] bluepojo: if you have to roll back to an older version, you'll also have to remember what the role looked like at that time
[2012-09-13 22:55:33 -0400] j2d3: i should clarify i'm using chef solo
[2012-09-13 22:55:46 -0400] j2d3: and it's a subfolder of the github repo of our app
[2012-09-13 22:55:48 -0400] bluepojo: fair enough, but roles are still dangerous
[2012-09-13 22:55:54 -0400] gyre008: can someone tell me why am I getting a response from Chef server that the cookbook I'm uploading has some dependencies on another cookbook DESPITE the fact that that cookbook IS present on the Chef server ? https://gist.github.com/3718361
[2012-09-13 22:55:57 -0400] gyre008: uhh
[2012-09-13 22:55:58 -0400] bluepojo: in this case you are versioning roles then
[2012-09-13 22:56:08 -0400] bluepojo: roles are not versioned on chef-server
[2012-09-13 22:56:27 -0400] bluepojo: I'd still advise that you manage your dependencies within the cookbook
[2012-09-13 22:56:30 -0400] bluepojo: and not in the role
[2012-09-13 22:56:49 -0400] j2d3: right. eventually i'd like to transition to either hosted chef or to running our own chef server, so yes, i'd like to follow the general patterns used for that kind of setup
[2012-09-13 22:57:04 -0400] masterkorp: From a recipe: Can i iterate to all nodes and check wich ones have a certain recipe in the run_list ?
[2012-09-13 22:57:09 -0400] bluepojo: yeah, and if you make sure you keep dependencies in cookbooks now, it'll be a seamless transition to hosted chef or chef server
[2012-09-13 22:57:18 -0400] gyre008:  don't get itthe cookbook IS on the server yet Chef just can't see it ? uhh
[2012-09-13 22:57:19 -0400] bluepojo: otherwise your transition will be more painful
[2012-09-13 22:57:41 -0400] j2d3: yes. well thank u for your help bluepojo! :)
[2012-09-13 22:57:46 -0400] bluepojo: sure
[2012-09-13 22:58:25 -0400] gyre008: makes no sense I swear
[2012-09-13 22:58:52 -0400] bluepojo: gyre007: note the matcher on ohai
[2012-09-13 22:58:56 -0400] bluepojo: it's an optimistic matcher
[2012-09-13 22:59:03 -0400] bluepojo: so 1.1 won't match ~1.0.x
[2012-09-13 23:00:01 -0400] gyre008: but 1.1 is HIGHER than 1.0
[2012-09-13 23:06:30 -0400] addisonj: I am having a weird issue where cookbooks being downloaded are randomly missing files
[2012-09-13 23:07:04 -0400] addisonj: chef-server and chef-client 10.12
[2012-09-13 23:11:07 -0400] reset_: BryanWB: shims are gone - closed your ticket on Berkshelf
[2012-09-13 23:12:15 -0400] addisonj: has anyone seen that before? cookbooks randomly missing files? I rerun chef-client, but it still fails
[2012-09-13 23:12:25 -0400] addisonj: if I reupload the cookbook and restart chef-cookbook it works
[2012-09-13 23:20:43 -0400] gyre008: is it possible to tell omnibus install to install particular version of Chef ?
[2012-09-13 23:20:52 -0400] gyre008: so far it looks like 10.14 is really buggy
[2012-09-13 23:20:57 -0400] gyre008: would like to install 10.12
[2012-09-13 23:21:15 -0400] miketheman: reset: you there?
[2012-09-13 23:21:51 -0400] reset: I'm here
[2012-09-13 23:22:48 -0400] miketheman: curious about berks 0.4 and newer: using `cookbook "name", "path: ~/other_name"` seems to result in a cookbooks/other_name
[2012-09-13 23:22:54 -0400] miketheman: is this known/expected?
[2012-09-13 23:23:08 -0400] miketheman: I'd hope that the name provided is the name I want
[2012-09-13 23:23:31 -0400] BryanWB: reset_: tks, i don't even remember will have to look
[2012-09-13 23:23:41 -0400] reset: the name of your cookbook is inferred by the directory containing it or the 'name' attribute in the metadata
[2012-09-13 23:23:54 -0400] reset: the path containing the cookbook contains a metadata.rb file
[2012-09-13 23:23:58 -0400] reset: does it have a name attribute set?
[2012-09-13 23:26:20 -0400] gyre008: reset, I'm getting some errors when installing a ruby using your rbenv cookbook.
[2012-09-13 23:27:00 -0400] reset: what version of the cookbook
[2012-09-13 23:27:01 -0400] reset: and what is the error
[2012-09-13 23:27:14 -0400] gyre008: latest version of the cookbook
[2012-09-13 23:27:17 -0400] gyre008: second will gist it
[2012-09-13 23:27:41 -0400] gyre008: https://gist.github.com/3718361
[2012-09-13 23:27:56 -0400] gyre008: first line is the recipe I'm using to install ruby 1.9.3 as global ruby
[2012-09-13 23:28:03 -0400] gyre008: and below it is the error I'm getting
[2012-09-13 23:28:29 -0400] bluepojo: gyre008: yes, the number is higher, but the version matcher isn't asking for higher
[2012-09-13 23:28:48 -0400] reset: line 39 in the gist is your problem
[2012-09-13 23:28:51 -0400] bluepojo: ~> 1.0.1 means "up to but not including 1.1.0"
[2012-09-13 23:28:53 -0400] reset: the name of the resource is Ruby 1.9.3
[2012-09-13 23:29:01 -0400] reset: the name attribute is also the version attribute
[2012-09-13 23:29:09 -0400] reset: rbenv doesn't know "Ruby 1.9.3"
[2012-09-13 23:29:14 -0400] bluepojo: in order to make it do "higher" it'd have to be > 1.0.1
[2012-09-13 23:29:23 -0400] reset: just use "1.9.3"
[2012-09-13 23:29:26 -0400] reset: or add the attribute
[2012-09-13 23:29:36 -0400] reset: ruby_version "1.9.3"-p194
[2012-09-13 23:29:39 -0400] gyre008: hmm ok
[2012-09-13 23:29:41 -0400] reset: ruby_version "1.9.3-p194"
[2012-09-13 23:29:43 -0400] gyre008: let me see
[2012-09-13 23:29:56 -0400] reset: the error is actually in your gist
[2012-09-13 23:30:06 -0400] reset: rbenv install didn't understand Ruby 1.9.3
[2012-09-13 23:30:18 -0400] gyre008: i thought i could put arbitrary string as a name
[2012-09-13 23:30:53 -0400] reset: you can
[2012-09-13 23:31:01 -0400] reset: but not if you don't specify ruby_version
[2012-09-13 23:31:10 -0400] reset: the name attribute is ruby_version
[2012-09-13 23:31:12 -0400] reset: so if you leave it out
[2012-09-13 23:31:15 -0400] reset: the name of your resource is used in place
[2012-09-13 23:31:16 -0400] miketheman: reset: it does not, as that's not required, nor usually used in many opscode cookbooks.
[2012-09-13 23:31:40 -0400] miketheman: reset: it makes more sense to not infer it, rather to use the name specified in the berksfile, no?
[2012-09-13 23:31:43 -0400] reset: miketheman: it's not required but it should be, and hopefully will be in future releases of Chef
[2012-09-13 23:31:48 -0400] gyre008: reset, ok I'm confused now :)
[2012-09-13 23:32:20 -0400] gyre008: I HAVE the attribute ruby_version
[2012-09-13 23:32:28 -0400] gyre008: it's at the beginning of the gist
[2012-09-13 23:32:44 -0400] gyre008: confused what to changeI have changed the name to 1.9.3 as you advised
[2012-09-13 23:32:49 -0400] gyre008: same result
[2012-09-13 23:32:52 -0400] reset: miketheman: it actually should probably raise an error if the name of the cookbook found at :path is not the same as what is expected
[2012-09-13 23:33:26 -0400] reset: gyre008: oh I see what you mean. It might be a bug in the latest release. Let me check it out
[2012-09-13 23:33:26 -0400] gyre008: should I use 1.9.3-p194 in the name then
[2012-09-13 23:33:28 -0400] miketheman: reset: that makes more sense. especially since I can now state `cookbook "xyzzy", "path: /some_path"`
[2012-09-13 23:33:32 -0400] reset: ya try that for now
[2012-09-13 23:33:42 -0400] gyre008: second
[2012-09-13 23:34:01 -0400] reset: miketheman: ya i'll put a ticket in for that to be fixed
[2012-09-13 23:34:09 -0400] miketheman: awesome, thanks
[2012-09-13 23:34:20 -0400] gyre008: reset, ok now its building...
[2012-09-13 23:34:21 -0400] miketheman: agreed that 'name' in metadata should be required
[2012-09-13 23:34:30 -0400] gyre008: su the name and the ruby_version must be the same
[2012-09-13 23:34:37 -0400] gyre008: oh wait a sec
[2012-09-13 23:34:39 -0400] gyre008: it failed
[2012-09-13 23:35:16 -0400] gyre008: /bin/mkdir: cannot create directory `/opt/rbenv/versions/1.9.3-p194': Permission denied
[2012-09-13 23:35:16 -0400] gyre008: /bin/mkdir: cannot create directory `/opt/rbenv/versions/1.9.3-p194': Permission denied
[2012-09-13 23:35:17 -0400] gyre008: /bin/mkdir: cannot create directory `/opt/rbenv/versions/1.9.3-p194': Permission denied ...
[2012-09-13 23:35:19 -0400] gyre008: uhh
[2012-09-13 23:35:33 -0400] gyre008: sudo chef-client should run chef as user root
[2012-09-13 23:35:33 -0400] reset: miketheman: I talked to jtimberman about that a few weeks back. In the mean time I'd set the name attribute explicitly. It's a good practice especially when yous tart passing your cookbooks around to people
[2012-09-13 23:35:34 -0400] gyre008: no ?
[2012-09-13 23:35:49 -0400] miketheman: reset: tell that to opscode. :)
[2012-09-13 23:35:54 -0400] miketheman: reset: again and again
[2012-09-13 23:36:44 -0400] gyre008: shouldn't it?
[2012-09-13 23:36:47 -0400] reset: gyre008: yes but I think the rbenv user is who installs the rubies
[2012-09-13 23:36:56 -0400] reset: I haven't looked at that code in a while
[2012-09-13 23:37:03 -0400] gyre008: hm
[2012-09-13 23:37:04 -0400] reset: the cookbook has some bugs in it that need to be worked out
[2012-09-13 23:37:17 -0400] gyre008: so does it have to be in rbenv group then ?
[2012-09-13 23:37:22 -0400] gyre008: i thought it would be by default
[2012-09-13 23:37:52 -0400] reset: all you should need to do is add
[2012-09-13 23:37:53 -0400] reset: include_recipe "rbenv::default"
[2012-09-13 23:37:53 -0400] reset: include_recipe "rbenv::ruby_build"
[2012-09-13 23:37:56 -0400] reset: and then rbenv_ruby "1.9.3-p194"
[2012-09-13 23:38:07 -0400] gyre008: yeah thats what I'm fdoign :)
[2012-09-13 23:38:11 -0400] gyre008: but no success
[2012-09-13 23:38:12 -0400] gyre008: :)
[2012-09-13 23:38:14 -0400] reset: the cookbook may make some assumptions about the state of your node
[2012-09-13 23:38:17 -0400] reset: which is where the bugs would come in
[2012-09-13 23:38:22 -0400] reset: or edge cases
[2012-09-13 23:38:23 -0400] gyre008: :)
[2012-09-13 23:38:32 -0400] reset: it is probably assuming you have some sort of permissions already set on /opt
[2012-09-13 23:38:42 -0400] gyre008: let me add rbenv user to that list in attributes
[2012-09-13 23:39:26 -0400] masterkorp: jhttps://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-ash4/431246_10151214237383377_925436050_n.jpg
[2012-09-13 23:39:30 -0400] masterkorp: err
[2012-09-13 23:40:00 -0400] miketheman: masterkorp: ?
[2012-09-13 23:40:21 -0400] masterkorp: sorry wrong window
[2012-09-13 23:40:34 -0400] gyre008: the problem is /opt/rbenv
[2012-09-13 23:41:10 -0400] gyre008: actuallyits /opt/rbenv/versions
[2012-09-13 23:41:17 -0400] gyre008: versions is owned by user gyre
[2012-09-13 23:41:24 -0400] gyre008: and rbenv can't write into it ;(
[2012-09-13 23:41:37 -0400] srleod: how do I send a restart notification to an application?  notifies :restart, "application[appname]" doesn't work
[2012-09-13 23:42:26 -0400] ptrstr: service
[2012-09-13 23:42:36 -0400] ptrstr: not application
[2012-09-13 23:43:12 -0400] srleod: thx!
[2012-09-13 23:45:10 -0400] srleod: unfortunately that gives "resource not found"
[2012-09-13 23:45:24 -0400] gyre008: anyone here from opscode ? omnibus install.can I install Chef version < 10.14 ??
[2012-09-13 23:45:58 -0400] srleod: does it matter that I'm using supervisord, not runit?
[2012-09-13 23:46:41 -0400] ptrstr: you still need to define a service
[2012-09-13 23:47:30 -0400] srleod: doesn't the application cookbook do that already?
[2012-09-13 23:47:37 -0400] miketheman: gyre008: read this thread http://lists.opscode.com/sympa/arc/chef/2012-09/msg00137.html
[2012-09-13 23:49:36 -0400] gyre008: miketheman, awesome! exactly what  i was looking for!!
[2012-09-13 23:50:22 -0400] ptrstr: srleod: i do not know, do you use the supervisor cookbook/provider?
[2012-09-13 23:51:31 -0400] srleod: ptrstr, i do.
[2012-09-13 23:53:27 -0400] srleod: maybe I'm supposed to use the :deploy action instead?
[2012-09-13 23:53:31 -0400] srleod: or :force_deploy?
[2012-09-13 23:54:35 -0400] ptrstr: srlead: don't you have to define supervisor_service do;  ; end somewhere?
[2012-09-13 23:55:09 -0400] aslan: hi all... have a question about chef 10 installation both client and server. is the bootstrap method still supported?
[2012-09-13 23:56:22 -0400] srleod: i'm not sure how or why but that seems to have happened magically.  all I did was include depends "supervisor" in my metadata.rb
