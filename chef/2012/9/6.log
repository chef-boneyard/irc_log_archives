[2012-09-06 00:11:54 -0400] _0x783czar: If my package resource's action is set to install, will it upgrade an existing package?  Or will I need to have a second resource to update?
[2012-09-06 00:17:01 -0400] ssd7_: _0x783czar: If you want to upgrade it, you can set the action to :upgrade
[2012-09-06 00:18:26 -0400] _0x783czar: ssd7: yes, yes, of course.  But I have a recipe, and I'd like it to install the package if it's not installed and upgrade if it is already installed.  So I was wondering if the install action would do that already
[2012-09-06 00:18:48 -0400] ssd7: No, but the :upgrade action will.
[2012-09-06 00:19:05 -0400] _0x783czar: ssd7: so if It's not installed it will install it?
[2012-09-06 00:21:32 -0400] ssd7: I believe that is the convention for the existing providers.  I'd have to double check those that I don't use often.
[2012-09-06 00:22:11 -0400] _0x783czar: Do you know if that's what would happen for say YUM?  If so that would be great.
[2012-09-06 00:22:40 -0400] ssd7: You can also specify multiple actions [:install, :upgrade]
[2012-09-06 00:23:13 -0400] _0x783czar: ssd7: really... now that's new to me.  and it will just do whichever one fits?
[2012-09-06 00:24:41 -0400] ssd7: Well, it will do both in the order specified.
[2012-09-06 00:24:53 -0400] ssd7: But, all you need is upgrade in this case.
[2012-09-06 00:25:08 -0400] _0x783czar: ssd7: OK, thanks.
[2012-09-06 00:34:13 -0400] silk1: Is it possible to see logs of accesses / edits to data bags on hosted chef?
[2012-09-06 00:34:46 -0400] yfeldblum_: _0x783czar, you should think of the resource's "actions" as more of "goal-actions" - translate `action :install` to `goal :should_be_installed`, for example
[2012-09-06 00:35:34 -0400] yfeldblum_: _0x783czar, because the idea is to declare the *goal* resource, the resource's goal attributes, etc
[2012-09-06 00:35:42 -0400] ssd7: silk: Not really.
[2012-09-06 00:35:59 -0400] silk: there are no api logs?
[2012-09-06 00:36:13 -0400] silk: ie, a data bag appears to have changed its content, and i'd like to know why
[2012-09-06 00:36:47 -0400] yfeldblum_: silk, you can potentially set up strict access controls and only edit them via an app that does the logging ...
[2012-09-06 00:37:13 -0400] silk: yfeldblum, sure not overly helpful in this instance however
[2012-09-06 00:37:34 -0400] yfeldblum_: _0x783czar, translate, in your mind, `action :upgrade` to `goal :at_latest_version`
[2012-09-06 00:37:35 -0400] ssd7: silk: I meant in terms of self-service.  If you contact support@opscode with the problem, we will almost surely use API logs on our side to help identify when and who made a change and where it came from.
[2012-09-06 00:37:56 -0400] silk: ok thanks
[2012-09-06 00:45:36 -0400] _0x783czar: yfeldblum_: Great, that helps
[2012-09-06 00:46:04 -0400] yfeldblum_: _0x783czar, if there's an action like `action :install`, then during the converge (after all the recipes have run and all the resources have been declared) the provider for that resource will check whether there is that package actually installed; if it is installed, the provider will exit fast because the system is already converged; if it is not installed, the provider will go ahead and install it in order to converge the system
[2012-09-06 00:47:16 -0400] _0x783czar: yfeldblum_: well that sure is cool
[2012-09-06 00:48:06 -0400] yfeldblum_: _0x783czar, https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/package.rb#L59-83
[2012-09-06 00:51:06 -0400] williamherry: Hi, I have to collect chef-client's log and post to some place, I heard what ruby's class can be reopened, so I am consider to make a patch to releated class or method, but can't find where to start, I don't wan't waste your time on this, just some one know well about this, give me some hits, thanks?
[2012-09-06 02:24:32 -0400] halcyonCorsair: can I get chef to be more verbose for a certain part of a run?
[2012-09-06 02:54:08 -0400] Loof: jessicab: That's exactly what I saw... thanks!
[2012-09-06 02:54:11 -0400] j-v-e: anyone still hacking on chef at that late time of the day ?
[2012-09-06 02:54:44 -0400] flaccid_: how long is a piece of string?
[2012-09-06 02:54:58 -0400] j-v-e: I have a library/provider question, I'll just drop it here and see if anyone has insight on it :)
[2012-09-06 02:55:15 -0400] Loof: j-v-e: Well, for some it's not a late time of day... and for others they're just obsessive workaholics :)
[2012-09-06 02:55:48 -0400] Loof: I can't list/delete in the webui either :/
[2012-09-06 02:56:03 -0400] j-v-e: I created a cookbook that does some crypto stuff. Now other people are asking to reuse some of that crypto, so I want to provide to other cookbook a function that they can just use. What's the right way to expose a function of a cookbook to other cookbooks ?
[2012-09-06 02:56:05 -0400] Loof: Is there an easy way to bypass the server and delete the corrupt role?
[2012-09-06 02:56:14 -0400] j-v-e: Loof: right, I'd fall into the later category, it seems :p
[2012-09-06 02:56:41 -0400] Loof: j-v-e: include + add to depends
[2012-09-06 02:57:24 -0400] Loof: If it's something that can be written as a function... you can simply write it as a function and include it
[2012-09-06 02:57:33 -0400] j-v-e: so if I include_recipe['crypto_cookbook'], how do I call the 'decrypt' function in my target recipe ?
[2012-09-06 02:58:54 -0400] Loof: It should import them into your namespace
[2012-09-06 02:59:02 -0400] Loof: so you'd just do decrypt ...
[2012-09-06 02:59:22 -0400] Loof: Mind you, I've been using Chef around 1.5 weeks... so take what I say with a grain of salt
[2012-09-06 02:59:42 -0400] yfeldblum: j-v-e, what is this crypto you're doing that's not part of the ruby stdlib?
[2012-09-06 03:01:02 -0400] j-v-e: yfeldblum: I just said crypto, but it's more of a key distribution system for encrypted databags. other recipe want to use encrypted databags as well, so instead of having them code the whole key retrieval + decryption in each recipe, I just want to provide one way of doing it
[2012-09-06 03:01:52 -0400] yfeldblum: j-v-e, why not just bootstrap the nodes with the key, or scp the key to the nodes after-the-fact?
[2012-09-06 03:02:25 -0400] yfeldblum: j-v-e, if nodes can just fetch keys at a whim, then what was the point?
[2012-09-06 03:02:36 -0400] j-v-e: yfeldblum: I created a central key distribution service that SCP the keys over to the nodes
[2012-09-06 03:03:18 -0400] j-v-e: simplification fail :/ sorry, it's late. node don't actually retrieve the key, but execute a keymaster-client recipe that will allow the keymaster-server to ssh-in and distribute the key
[2012-09-06 03:03:21 -0400] zts: j-v-e: if you've already got the code in a library (or are considering that), have you looked at http://wiki.opscode.com/display/chef/Libraries ?
[2012-09-06 03:04:26 -0400] zts: j-v-e: conversely, if you're implementing an LWRP (or a regular resource and provider), those will be available to recipes in your other cookbooks after you've used include_recipe['crypto_cookbook'] (or just listed it as a dependency in their metadata.rb)
[2012-09-06 03:05:04 -0400] j-v-e: yfeldblum: I wanted to remove the manual process of copying the keys over, and I definitely don't want to use one single key for all encrypted databags. so instead, I built a key distribution service. We have one master key, copied manually on the keymaster server, that is used to decrypt the databag that contains all other keys. Then, these keys are scp-ed to their destinations nodes (identified by a chef search).
[2012-09-06 03:05:13 -0400] yfeldblum: zts, you must list the dependency in metadata.rb, whether or not you include_recipe
[2012-09-06 03:06:03 -0400] zts: yfeldblum: is that new?  It never used to be the case - unless you're using that as a proxy for "something must get the cookbook onto the node, which can be achieved by listing it any cookbook's metadata.rb, or putting it on the runlist in some way"
[2012-09-06 03:06:16 -0400] zts: or just good practice?
[2012-09-06 03:06:19 -0400] yfeldblum: zts, it's old as far as i'm aware
[2012-09-06 03:06:33 -0400] yfeldblum: zts, if your cookbook has a dependency on another cookbook, then you must declare it; that's the rule
[2012-09-06 03:06:57 -0400] zts: I suspect we have differing definitions of "must".  What is the consequence of not declaring it?
[2012-09-06 03:07:24 -0400] jtimberman: zts: you *must* either have the cookbook in the node's expanded run list or declare it as a dependency in another cookbook's metadata.
[2012-09-06 03:07:27 -0400] Loof: Before I start digging in the code... anyone know where roles are physically stored?
[2012-09-06 03:07:29 -0400] yfeldblum: zts, in order to comply with the expectations of how he will use a system, a person is required to do that
[2012-09-06 03:07:45 -0400] jtimberman: chef client only downloads from the server the cookbooks that it needs to fulfill its run list, or the ones that are dependencies of the ones to fulfill its run list.
[2012-09-06 03:07:54 -0400] zts: jtimberman: yeah, that is my understanding.  And it's simply good practice
[2012-09-06 03:07:59 -0400] jtimberman: Loof: on the chef server?
[2012-09-06 03:08:31 -0400] jtimberman: Loof: they're uploaded from your local repository to the chef server, or created directly in the chef server if created with 'knife role create' or through the webui
[2012-09-06 03:08:43 -0400] jtimberman: zts: its like a package manager.
[2012-09-06 03:08:48 -0400] jtimberman: in that
[2012-09-06 03:08:52 -0400] jtimberman: if you want to use features from another cookbook
[2012-09-06 03:09:08 -0400] jtimberman: you need a dependency or use it specifically
[2012-09-06 03:10:06 -0400] jtimberman: like, i can say "apt-get install postfix libsasl2-2", or "apt-get install postfix" and the dependency will get libsasl2-2 too
[2012-09-06 03:10:09 -0400] zts: I'd say it's like a package manager in that something in your package can depend on something installed by another package, without depending on that package.  But implicit dependencies are bad practice, and youre going to end up having a bad time
[2012-09-06 03:10:25 -0400] jtimberman: right
[2012-09-06 03:10:27 -0400] jtimberman: don't have a bad time
[2012-09-06 03:10:32 -0400] jtimberman: be explicit about the dependencies
[2012-09-06 03:10:34 -0400] zts: jtimberman++
[2012-09-06 03:10:52 -0400] jtimberman: that said, we don't declare dependencies in some of our cookbooks if they're not strictly necessary in the default use case.
[2012-09-06 03:11:17 -0400] j-v-e: So, I cannot actually do the following:
[2012-09-06 03:11:17 -0400] j-v-e: include_recipe "keymaster::client"
[2012-09-06 03:11:17 -0400] j-v-e: KeymasterDecrypt()
[2012-09-06 03:11:36 -0400] j-v-e: with a `def KeymasterDecrypt` in the keymaster::client recipe ?
[2012-09-06 03:12:29 -0400] jtimberman: like, some of our cookbooks work on platforms that require other platform specific cookbooks, but those are ones we consider "you'll want to have this in your base role anyway" since people don't like to have extra code they're not using in their repository
[2012-09-06 03:12:33 -0400] halcyonCorsair: would anyone be able to take a look over this https://github.com/halcyonCorsair/chef-koha and comment? the requirements recipe is meant to be run first, followed by the default
[2012-09-06 03:12:42 -0400] jtimberman: and by the last bit, i mean people have made some really grumpy posts on the mailing list, in here and on twitter about that :)
[2012-09-06 03:14:32 -0400] zts: jtimberman: on that note, is there any work underway on enhancing the metadata to support platform-specific dependencies, or anything along those lines?  Or is that the kind of thing where contributions from the community might be welcomed?
[2012-09-06 03:14:58 -0400] jtimberman: zts: that has come up a number of times recently but i am not aware of internal efforts on it. i'm sure community contribution would be an awesomeness to behold.
[2012-09-06 03:15:11 -0400] jtimberman: there might be a ticket, but i'm sure your ability to find it is better than mine :)
[2012-09-06 03:15:36 -0400] zts: jtimberman: duly noted :)
[2012-09-06 03:17:56 -0400] zts: j-v-e: don't take my word from it, but I believe you'll need to organise things like the example at the top of http://wiki.opscode.com/display/chef/Libraries
[2012-09-06 03:18:17 -0400] Loof: jtimberman: No, I mean physically on the server
[2012-09-06 03:18:28 -0400] zts: j-v-e: ie, put KeymasterDecrypt into a library, have the default recipe in your keymaster cookbook import that function into Chef::Recipe.  At that point, it will be available in recipes
[2012-09-06 03:18:29 -0400] Loof: the REST interface is failing due to a corrupt role
[2012-09-06 03:18:37 -0400] Loof: so knife & webui are both failing
[2012-09-06 03:20:01 -0400] j-v-e: zts: I'm trying to create a class, see if that works
[2012-09-06 03:20:59 -0400] jtimberman: Loof: they're stored in couchdb.
[2012-09-06 03:21:09 -0400] jtimberman: all the JSON documents are stored in couchdb
[2012-09-06 03:21:24 -0400] jtimberman: on chef-server =< 10.
[2012-09-06 03:21:33 -0400] zts: j-v-e: not a class, just a module.  So looking at that example, "module MyKeymasterLibrary" then "def KeymasterDecrypt".
[2012-09-06 03:23:29 -0400] j-v-e: zts: guess what, that actually worked: https://gist.github.com/3650690
[2012-09-06 03:24:11 -0400] zts: j-v-e: hurrah!  Thanks for sharing that back, now I've learned something today :)
[2012-09-06 03:24:52 -0400] j-v-e: that's cool, I sleep better when things work the way they should :)
[2012-09-06 03:26:42 -0400] j-v-e: Can I pass arguments to that KeymasterDecrypt function ?
[2012-09-06 03:28:16 -0400] yfeldblum: jtimberman, there should be a way to say that a cookbook which is an optional dependency of something in the run-list (but not marked as a dependency because it's optional) needs to be delivered to a node
[2012-09-06 03:29:59 -0400] zts: j-v-e: yeah, say "def selfDecryptDataBagItem(my_argument)", and then you can just use it as "my_argument" inside the method body
[2012-09-06 03:30:31 -0400] j-v-e: thanks zts
[2012-09-06 03:32:23 -0400] yfeldblum: j-v-e, no need to stick that inside the Chef::Recipe namespace ...
[2012-09-06 03:33:21 -0400] Loof: jtimberman: Well yes, not on chef 11 yet :P
[2012-09-06 03:33:27 -0400] j-v-e: yfeldblum: you think using a module would be cleaner ?
[2012-09-06 03:33:47 -0400] yfeldblum: j-v-e, you can use normal modules instead of classes since nobody is creating new instances, and you can either stick `extend self` or `module_function` at the top of the module
[2012-09-06 03:34:04 -0400] Loof: I tried accessing the futon page and _utils doesn't list any databases
[2012-09-06 03:34:36 -0400] yfeldblum: j-v-e, ruby naming conventions say that methods should be named in snake_case: `def decrypt_data_bag_item(arg1, arg2)`
[2012-09-06 03:34:57 -0400] yfeldblum: j-v-e, otherwise you'll be surprising a whole bunch of people with your non-ruby ruby
[2012-09-06 03:37:02 -0400] j-v-e: thanks yfeldblum
[2012-09-06 03:37:06 -0400] yfeldblum: j-v-e, https://gist.github.com/3650851
[2012-09-06 03:37:10 -0400] j-v-e: Is there a convention for modules naming ?
[2012-09-06 03:37:29 -0400] j-v-e: hum, interesting
[2012-09-06 03:37:36 -0400] j-v-e: so what does module_function do exactly >
[2012-09-06 03:37:37 -0400] j-v-e: ?
[2012-09-06 03:38:00 -0400] yfeldblum: j-v-e, classes and modules use PascalCasingWithInitialCap
[2012-09-06 03:38:23 -0400] j-v-e: of course... :)
[2012-09-06 03:38:43 -0400] yfeldblum: j-v-e, module_function makes all the methods that appear after it in the same module block be "static methods" in java-speak
[2012-09-06 03:39:40 -0400] yfeldblum: j-v-e, by default, modules in ruby are collections of instance methods which can be added to classes, so the classes that want them can have the instance methods from the modules
[2012-09-06 03:40:01 -0400] yfeldblum: j-v-e, it's a form of diamond inheritance, in a sense
[2012-09-06 03:40:23 -0400] yfeldblum: j-v-e, but that's not what you're looking for in this case - here it appears that you just want a proper namespace for your methods
[2012-09-06 03:40:37 -0400] yfeldblum: j-v-e, modules are great for that too, if you start the module scope off with `module_function`
[2012-09-06 03:40:49 -0400] yfeldblum: j-v-e, or `extend self` which is similar
[2012-09-06 03:41:35 -0400] yfeldblum: j-v-e, http://rubylearning.com/satishtalim/modules_mixins.html
[2012-09-06 03:41:38 -0400] j-v-e: this is a bit over my head, but I'm taking your word for it. however, I'm getting this error with your code
[2012-09-06 03:41:39 -0400] j-v-e: [Thu, 06 Sep 2012 03:39:59 +0000] FATAL: NoMethodError: undefined method `decrypt_data_bag_item' for Chef::Recipe::Keymaster:Class
[2012-09-06 03:42:27 -0400] yfeldblum: j-v-e, http://www.cowboycoded.com/2010/03/10/ruby-module-mixin-awesomeness/
[2012-09-06 03:42:45 -0400] yfeldblum: j-v-e, what's your file look like?
[2012-09-06 03:45:20 -0400] j-v-e: https://gist.github.com/3650851#comments
[2012-09-06 03:47:22 -0400] yfeldblum: j-v-e, from a new chef-client run?
[2012-09-06 03:47:47 -0400] yfeldblum: j-v-e, also point of terminology, that's not a data-bag data; it's a data-bag-item data
[2012-09-06 03:48:07 -0400] j-v-e: alright, it's working
[2012-09-06 03:48:25 -0400] yfeldblum: data-bags are like whole tables in mysql; data-bag items are like individual records; and here you're fetching the equivalent of an individual record from a table by primary key
[2012-09-06 03:49:14 -0400] j-v-e: stupid upload mistake, it's wasn't a code issue
[2012-09-06 03:49:30 -0400] yfeldblum: j-v-e, :P
[2012-09-06 03:49:30 -0400] j-v-e: yep yfeldblum, you'll notice I had the terminology right in the module :) just not in the recipe
[2012-09-06 03:50:02 -0400] yfeldblum: j-v-e, :P
[2012-09-06 03:50:06 -0400] ssd7: Ohai Chefs
[2012-09-06 03:50:25 -0400] j-v-e: on another note, anyone going to surge baltimore at the end of the month ?
[2012-09-06 03:50:30 -0400] yfeldblum: j-v-e, but apparently the way i get my kicks is by finding the tiny little things in other people and criticizing
[2012-09-06 03:51:06 -0400] yfeldblum: j-v-e, haha i don't know
[2012-09-06 03:51:19 -0400] j-v-e: yfeldblum: no pb, that for the same reason linus torvalds invented the git pull-request review process :p
[2012-09-06 03:53:56 -0400] yfeldblum: j-v-e, heh
[2012-09-06 03:54:06 -0400] yfeldblum: j-v-e, what's going on at surge?
[2012-09-06 03:54:27 -0400] j-v-e: yfeldblum: http://omniti.com/surge/2012/sessions
[2012-09-06 03:56:25 -0400] yfeldblum: j-v-e, some of those look pretty interesting
[2012-09-06 03:58:00 -0400] j-v-e: $boss decided to take 5 people down there ! it better be interesting :)
[2012-09-06 03:58:49 -0400] yfeldblum: j-v-e, heh
[2012-09-06 03:59:21 -0400] yfeldblum: j-v-e, some tips from the pro: use many small queries against your backend datastore instead of one large query
[2012-09-06 03:59:58 -0400] yfeldblum: j-v-e, for reliability, set up 9-way multi-continent sync replication
[2012-09-06 04:00:51 -0400] yfeldblum: j-v-e, when in doubt, disable the GC, let linux kill the process when it runs out of memory, and use runit to bring the process back up
[2012-09-06 04:01:01 -0400] j-v-e: yfeldblum: I'm up to 8, but getting latency from the speed of light, we're working on a fix
[2012-09-06 04:01:16 -0400] yfeldblum: j-v-e, use quantum entanglement?
[2012-09-06 04:01:37 -0400] j-v-e: no, just bump the version and pretends it comes from the future
[2012-09-06 04:03:54 -0400] j-v-e: 12:03, 34min of battery left. perfect time for a test against production
[2012-09-06 04:24:37 -0400] jtgiri_: Hey guys, for some reason after I did knife index rebuild, nothing is coming up in data bag search, I've already restarted expander and rebbitmq is running, any ideas what could cause this ?
[2012-09-06 04:40:43 -0400] ssd7: jtgiri_: Still having the problem?  How long ago did you rebuild the index?
[2012-09-06 04:41:01 -0400] jtgiri_: yeah - 5 minutes ago
[2012-09-06 04:41:28 -0400] jtgiri_: looks like this bug http://tickets.opscode.com/browse/CHEF-2244
[2012-09-06 04:41:42 -0400] jtgiri_: none of the search is working
[2012-09-06 04:44:03 -0400] ssd7: jtgiri_: If it woulld help I can help you work up some knife-exec code to rebuild your indexes.  So are nodes, clients, etc also not working?
[2012-09-06 04:45:12 -0400] jtgiri_: that would be great, yeah nodes clients nothing is returning anything, this directory is empty ll /var/lib/chef/search_index
[2012-09-06 04:54:21 -0400] ssd7: jtgiri_: Try something like this for nodes: knife exec -E 'Chef::Node.list.keys.each {|k| puts api.get("/nodes/#{k}").save }'
[2012-09-06 04:54:36 -0400] ssd7: Then wait a few minutes and see if nodes start turning up in search.
[2012-09-06 04:56:25 -0400] jtgiri_: Okay
[2012-09-06 04:57:33 -0400] jtgiri_: okay it finished
[2012-09-06 04:57:40 -0400] jtgiri_: knife search node "name:*"
[2012-09-06 04:57:40 -0400] jtgiri_: 0 items found
[2012-09-06 04:59:30 -0400] ssd7: Can you tail the expander logs to see if it is working through those updates still and posting them to solr?
[2012-09-06 05:00:54 -0400] jtgiri_: expander logs are empty for some reason
[2012-09-06 05:00:56 -0400] jtgiri_: tail -f /var/log/chef/expander.log
[2012-09-06 05:00:58 -0400] jtgiri_: nothing there
[2012-09-06 05:01:09 -0400] jtgiri_: grep expander
[2012-09-06 05:01:09 -0400] jtgiri_: root      2221  0.0  0.1  81416 15236 ?        S    04:47   0:00 /usr/bin/ruby1.8 /usr/bin/chef-expander -d -c /etc/chef/solr.rb -P /var/run/chef/expander.pid -L /var/log/chef/expander.log -n 1 -i 1
[2012-09-06 05:03:51 -0400] ssd7: So you don't see any workers in the ps output then?
[2012-09-06 05:04:50 -0400] ssd7: try: chef-expanderctl log-level debug
[2012-09-06 05:04:58 -0400] ssd7: and then see if it logs anything more usefully.
[2012-09-06 05:05:07 -0400] ssd7: s/ly//
[2012-09-06 05:05:20 -0400] jtgiri_: i am in idiot, amqp_pass in solar.rb was incorrect :)
[2012-09-06 05:05:27 -0400] jtgiri_: it's working now
[2012-09-06 05:05:48 -0400] jtgiri_: it's weird that even if the password is wrong rebuild index says it's a success
[2012-09-06 05:06:08 -0400] jtgiri_: Thank you so much for your help though
[2012-09-06 05:07:01 -0400] ssd7: No problem.  The way the reindex works is we delete the solr database and then resave all the objects.  Saving an object just puts it on the queue though, it doesn't check that it actually showed up in search though.
[2012-09-06 05:07:36 -0400] ssd7: jtgiri_: now that expander is connect to search, it is probably chewing through all those updates.  If not, issuing reindex again will probably fix you up.
[2012-09-06 05:07:48 -0400] ssd7: s/connect to search/connected to rabbit/
[2012-09-06 05:07:56 -0400] jtgiri_: Okay
[2012-09-06 06:39:15 -0400] BryanWB: ohai chefs!
[2012-09-06 06:50:10 -0400] jj_: ..
[2012-09-06 07:34:33 -0400] frogx: hello there
[2012-09-06 09:18:24 -0400] BryanWB: jtimberman, when u get a chance i have some q's for u about the postgresql::ruby recipe
[2012-09-06 10:07:56 -0400] cpasmoi: can someone help me with the mysql::server recipee ? I'm on a CentOS 6 and don't understand why the block 'unless platform?(%w{debian ubuntu})' which sets the root password doesn't work
[2012-09-06 10:08:09 -0400] cpasmoi: e.g. the root password is not set
[2012-09-06 10:25:13 -0400] syphon: Can anyone help me find the source code for the Group resource in Chef? I'm trying to debug why my cookbook is sporadically failing
[2012-09-06 10:25:56 -0400] syphon: specifically, how does the Group resource become idempotent? I assume it runs some command to verify if a user is already in the group. That's what I'm trying to repro manually
[2012-09-06 10:37:12 -0400] ashb: syphon: start here https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/group.rb
[2012-09-06 10:40:02 -0400] syphon: Thanks. I was looking in the resources which weren't very helpful
[2012-09-06 11:48:09 -0400] rgsteele: On the topic of encrypted data bags - how do others handle secret files?  I feel like it's somehow wrong to store it in git with the rest of my chef stuff, but I don't really see another way of getting it to the nodes so they can load it to decrypt the data bag.
[2012-09-06 11:49:25 -0400] rgsteele: Is there some nifty way I'm completely staring past that's preferable to storing it in the cookbook's files/default/ directory and just copying it to the nodes from there?
[2012-09-06 11:54:46 -0400] adz: rgsteele, you can have configure knife so knife bootstrap copies one key
[2012-09-06 11:55:31 -0400] meineerde: rgsteele: the whole idea of encrypted data bags is to prevent the case of losing sensitive data if the chef server gets mugged.
[2012-09-06 11:55:47 -0400] meineerde: rgsteele: thus it would be counter productive to store the secret on the chef server
[2012-09-06 11:57:48 -0400] adz: I don't know about that, as there's no cookbook signing the attacker could just modify a cookbook to get the hosts to mail the secret to him
[2012-09-06 11:58:26 -0400] rgsteele: meineerde: That's kinda why I asked - the approach I had felt wrong.
[2012-09-06 11:59:07 -0400] rgsteele: adz: But, what if you're adding it after the fact?
[2012-09-06 11:59:10 -0400] meineerde: rgsteele: most people ship the secret during bootstrap from a host different from the chef server
[2012-09-06 11:59:14 -0400] rgsteele: i.e., after the node is provisioned
[2012-09-06 11:59:32 -0400] meineerde: rgsteele: you can still copy it with something like knife ssh
[2012-09-06 12:00:59 -0400] meineerde: rgsteele: (and tbh I'm kinda not satisfied with this situation either. I'm thinking about building a system with gpg keys per host and encrypted secrets. but I've not takled it yet)
[2012-09-06 12:04:00 -0400] rgsteele: meineerde: Yeah, that feels very tedious.  I mean, I guess there isn't really an optimal way to do this post-provisioning.
[2012-09-06 12:39:44 -0400] rgsteele: Hm
[2012-09-06 12:56:15 -0400] frank_: all: is there a way for the apt-cookbook not to gpg receive-keys on every chef-run? (keys.gnupg.net for instance, is slow as hell, and causes failed chef-runs because of timeout)
[2012-09-06 13:12:29 -0400] rgsteele: frank_: Well, not quite what you asked for, but you could set up a local pgp key server.
[2012-09-06 13:20:03 -0400] geekbri: If i were to create a resource inside of a cookbook named "file", does that mean it would override the default file resource when used within that cookbook without the full namespacing?
[2012-09-06 13:20:26 -0400] geekbri: EG I know mycookbook_file can be simply called as file within the cookbook that the resource is defined
[2012-09-06 13:20:38 -0400] geekbri: so does that mean file would override the currently existing file resource?
[2012-09-06 13:28:21 -0400] rgsteele: frank_: https://bitbucket.org/skskeyserver/sks-keyserver/wiki/Home
[2012-09-06 13:45:30 -0400] igor_afonov: hi, does anybody using nagios cookbook?
[2012-09-06 13:46:16 -0400] igor_afonov: I have a strange problem with it after every request to nagios - I have a `perl-fcgi` process that eats 100% of cpu and after several requests server becomes almos irresponsible
[2012-09-06 13:47:05 -0400] igor_afonov: all it happens on ubuntu 12.04 with latest nagios cookbook and nginx
[2012-09-06 14:55:15 -0400] organicveggie: I'm struggling with a Chef server upgrade from 0.9.14 to 10.12.0.
[2012-09-06 14:55:55 -0400] organicveggie: Running on EC2. Setup brand new instance with Chef 10.12.0. Stopped all services. Copied couchdb data files over. Restarted CouchDB and got a bunch of errors.
[2012-09-06 14:55:57 -0400] organicveggie: https://gist.github.com/3657051
[2012-09-06 14:56:15 -0400] organicveggie: Any bright ideas?
[2012-09-06 14:58:53 -0400] adz: {error,eaccess} suggests it's a file permission problem
[2012-09-06 14:59:57 -0400] organicveggie: adz: ooh! good point!
[2012-09-06 15:10:13 -0400] BryanWB: i get these messages "Cookbook metadata specifies an unrecognized platform that will not be tested: redhat" for each disto that my cookbook supports
[2012-09-06 15:10:17 -0400] BryanWB: anyone know why?
[2012-09-06 15:10:31 -0400] BryanWB: ^^ when i run `kitchen test`
[2012-09-06 15:11:13 -0400] jtimberman: BryanWB: because the 'platform' defined in the default Kitchenfile doesn't have them listed.
[2012-09-06 15:11:29 -0400] jtimberman: BryanWB: if you dont' have "platform" in your cookbook's kitchenfile, then it uses the default
[2012-09-06 15:11:43 -0400] jtimberman: https://github.com/opscode/test-kitchen/blob/master/config/Kitchenfile
[2012-09-06 15:11:51 -0400] BryanWB: jtimberman, tks, btw am starting on moving the ministest tests into the java cookbook
[2012-09-06 15:11:52 -0400] jtimberman: those are the defaults
[2012-09-06 15:11:57 -0400] jtimberman: BryanWB: cool
[2012-09-06 15:12:04 -0400] jtimberman: BryanWB: you has questions for me!
[2012-09-06 15:12:10 -0400] jtimberman: BryanWB: i saw your ticket comments.
[2012-09-06 15:12:16 -0400] BryanWB: jtimberman, oh yeah ;)
[2012-09-06 15:12:26 -0400] jtimberman: BryanWB: the regex was removed because it was breaking on my run with kitchen test.
[2012-09-06 15:12:38 -0400] jtimberman: i don't remember which platforms though, but nuking it and making it greedy worked :-|
[2012-09-06 15:12:44 -0400] BryanWB: interesting, turns out that its not the real issue
[2012-09-06 15:13:17 -0400] BryanWB: could it be that java::openjdk has never worked on centos6 ?
[2012-09-06 15:14:16 -0400] jtimberman: BryanWB: i'm fairly sure it converged :)
[2012-09-06 15:14:19 -0400] jtimberman: brb
[2012-09-06 15:14:25 -0400] BryanWB: then color me confused
[2012-09-06 15:23:54 -0400] pferdefleisch: Hi all, I am trying to install the nagios::server recipe with chef-solo and it keeps trying to connect to localhost:4000
[2012-09-06 15:24:13 -0400] pferdefleisch: it is because of the search method
[2012-09-06 15:24:50 -0400] pferdefleisch: is there a way to bypass this or do i need to use chef-server with this kind of recipe?
[2012-09-06 15:26:22 -0400] organicveggie: Still struggling with a Chef server upgrade from 0.9.14 to 10.12.0.
[2012-09-06 15:26:26 -0400] organicveggie: Running on EC2. Setup brand new instance with Chef 10.12.0. Stopped all services. Copied /var/lib/couchdb and /etc/couchdb over to new instance.
[2012-09-06 15:26:29 -0400] organicveggie: Fixed permissions. CouchDB appears to start without errors. Nothing in the logs. But not responding to any requests.
[2012-09-06 15:26:41 -0400] gyre007: anyone used the application cookbook ? I could use a bit of guidance ;(
[2012-09-06 15:27:14 -0400] organicveggie: "/etc/couchdb/default.ini" implies that it *should* be listening on port 5984. But no luck.
[2012-09-06 15:27:19 -0400] organicveggie: Any suggestions?
[2012-09-06 15:28:44 -0400] organicveggie: default.ini can be seen here: https://gist.github.com/3657051
[2012-09-06 15:28:48 -0400] Urocyon: gyre007: ask away, maybe someone can help.
[2012-09-06 15:29:18 -0400] gyre007: well basically Im reading that application recipe is reading some data bag ....
[2012-09-06 15:29:31 -0400] gyre007: i guess I need to create it and populate it somehow ?
[2012-09-06 15:29:37 -0400] gyre007: https://github.com/opscode/cookbooks/tree/master/application
[2012-09-06 15:30:16 -0400] Urocyon: gyre007: that's one approach.  The new version of application has an lwrp that you could just add to a recipe, and not use data bags at all.
[2012-09-06 15:30:42 -0400] jtimberman: pferdefleisch: that cookbook is designed specifically to use chef server features of search and data bags.
[2012-09-06 15:31:25 -0400] Urocyon: https://github.com/opscode-cookbooks/application
[2012-09-06 15:31:37 -0400] pferdefleisch: jtimberman: i found a few of them and they are all using search. Do you know of one compatible with chef-solo?
[2012-09-06 15:31:49 -0400] jtimberman: pferdefleisch: i don't
[2012-09-06 15:31:51 -0400] pferdefleisch: jtimberman: or how to search for one more efficiently
[2012-09-06 15:31:52 -0400] Urocyon: gyre007: the opscode/cookbook repository is deprecated.  Newer versions will be found in opscode-cookbooks.
[2012-09-06 15:32:35 -0400] gyre007: Urocyon, basically im trying to get this working:  https://github.com/sniperd/sensu-chef/blob/add-sensu-admin/recipes/admin.rb
[2012-09-06 15:33:08 -0400] pferdefleisch: jtimberman: I'll probably roll my own as a learning experience
[2012-09-06 15:33:15 -0400] gyre007: and its failing on application because its trying to find it in apps cookbook
[2012-09-06 15:33:17 -0400] pferdefleisch: jtimberman: thanks
[2012-09-06 15:33:18 -0400] gyre007: i mean data bag
[2012-09-06 15:33:22 -0400] gyre007: arrgh
[2012-09-06 15:33:39 -0400] BryanWB: jtimberman, why are the  centos images so big? something like 600 GB each iirc
[2012-09-06 15:33:53 -0400] jtimberman: BryanWB: dunno.
[2012-09-06 15:34:09 -0400] jtimberman: pferdefleisch: or just use chef server :)
[2012-09-06 15:34:21 -0400] Jay_Levitt: I want to set up RAID-10 on my EC2 instances. aws cookbook uses outdated right_aws that doesn't understand VPCs, but chef already includes fog, so: any good examples of doing foggy stuff right from within chef?
[2012-09-06 15:35:35 -0400] pferdefleisch: jtimberman: i will eventually but it will take too much time for me to get figure it all out and it isn't much of a priority for my current project
[2012-09-06 15:35:53 -0400] pferdefleisch: jtimberman: are the docs available as a pdf by chance?
[2012-09-06 15:37:33 -0400] gyre007: Urocyon, you mean community cookbooks ? that's exactly what I downloaded to my laptop and pushed to the chef server
[2012-09-06 15:38:44 -0400] organicveggie: No bright ideas on why couchdb isn't responding?
[2012-09-06 15:38:52 -0400] OscarSchneider: j-v-e: just saw your post regarding crypto right now. you could take a look at https://github.com/oscarschneider/openssldemo
[2012-09-06 15:39:46 -0400] BryanWB: does test-kitchen require me to have rvm installed?
[2012-09-06 15:40:22 -0400] jtimberman: BryanWB: no
[2012-09-06 15:41:08 -0400] jtimberman: BryanWB: but you have to set runtimes [] in the kitchenfile or it tries to use rvm, http://tickets.opscode.com/browse/KITCHEN-4
[2012-09-06 15:41:26 -0400] BryanWB: jtimberman, ah, that explains
[2012-09-06 15:41:39 -0400] jtimberman: BryanWB: for configurations, you can pass the runtimes too
[2012-09-06 15:41:49 -0400] jtimberman: configuration("default") { runtimes [] }
[2012-09-06 15:41:52 -0400] jtimberman: its awkward
[2012-09-06 15:42:21 -0400] Urocyon: gyre007 got a traceback on the failure to share?
[2012-09-06 15:42:45 -0400] pferdefleisch: jtimberman: or i can use google instead of you ;) http://wiki.opscode.com/display/chef/Documentation
[2012-09-06 15:42:48 -0400] gyre007: well I didnt have the damn data bag created so im putting it together now...
[2012-09-06 15:43:59 -0400] jtimberman: gyre007: the application cookbook's recipes and data bag use are considered deprecated in favor of the LWRPs.
[2012-09-06 15:43:59 -0400] Urocyon: gyre007: I'm kind of surprised you need one.  I've only messed around with the new version of application a little bit, but I didn't think there was a data bag requirement in the new lwrp, which it looks like you are using - from than admin.rb you pointed to.
[2012-09-06 15:44:22 -0400] gyre007: did you have a look at that recipe ?
[2012-09-06 15:45:48 -0400] BryanWB: jtimberman, werd https://gist.github.com/3657609     i put in `runtimes []` and still no luck
[2012-09-06 15:46:15 -0400] gyre007: https://gist.github.com/3657617
[2012-09-06 15:46:21 -0400] gyre007: that's the gist
[2012-09-06 15:46:32 -0400] gyre007: jtimberman, hm ?
[2012-09-06 15:47:26 -0400] jtimberman: BryanWB: https://gist.github.com/3657616
[2012-09-06 15:47:39 -0400] BryanWB: ah!
[2012-09-06 15:47:47 -0400] jtimberman: thats whats awkward.
[2012-09-06 15:47:52 -0400] BryanWB: woof
[2012-09-06 15:48:01 -0400] jtimberman: But, it works, in that it doesn't do the rvm stuff.
[2012-09-06 15:48:17 -0400] gyre007: actually Urocyon ...second...this is the one im getting...https://gist.github.com/3657617
[2012-09-06 15:48:20 -0400] gyre007: arrgh
[2012-09-06 15:48:26 -0400] geekbri: What happens if create a light weight resource and give it the name of an existing resource?  EG you name it file, but file already exists?  I know they are name spaced by their cookbooks, but within a cookbook you can refer to a resource without its full name
[2012-09-06 15:48:40 -0400] geekbri: does that mean your mycookbook_file resource would clobber the existing file resource?
[2012-09-06 15:52:19 -0400] gyre007: ah
[2012-09-06 15:52:32 -0400] gyre007: it loos like node is NOT available within application resource!!!
[2012-09-06 15:52:34 -0400] gyre007: arrgh
[2012-09-06 15:53:08 -0400] BryanWB: is it generally a good practice to gitignore ur Gemfile.lock?
[2012-09-06 15:54:52 -0400] _0x783czar: So if I want to install an rpm from a given url, and I use the rpm_package resource, where would I specify the URL.  In the package name? or is that functionality even supported?
[2012-09-06 16:00:20 -0400] gyre007: Urocyon, i fixed that...but now im getting damn errors on Nginx
[2012-09-06 16:00:22 -0400] gyre007: arrgh
[2012-09-06 16:04:23 -0400] Zenigor: I am currently looking to build a new chef server based on ubuntu 12.04 LTS. I will leave my current chef server up until my new one is built. Question is, do I need to re-bootstrap each server against my new chef server or can I just re-bind them to the new server?
[2012-09-06 16:04:27 -0400] rocket: Does anyone know of a chef cookbook for installing the java rpm from oracle?
[2012-09-06 16:04:54 -0400] BryanWB: rocket, github.com/bryanwb/java
[2012-09-06 16:08:46 -0400] krisk: why does the default knife bootstrap install a .deb on ubuntu/debian machines, that is brutally different from the opscode repositories? e.g. the bootstrapped chef doesn't have an chef-client init-script, etc
[2012-09-06 16:09:26 -0400] rocket: Thanks BryanWB :)  Btw what are the main differences in your repo versus the mainline one?
[2012-09-06 16:09:38 -0400] BryanWB: rocket, many but am working to integrate them
[2012-09-06 16:10:08 -0400] BryanWB: i wrote the mainline oracle recipe but my own has diverged cuz too lazy to push back
[2012-09-06 16:11:24 -0400] rocket: I was using the mainline recipe for my zenoss cookbook .. but the official zenoss rpms are asking that the jre rpm is installed so its complaining
[2012-09-06 16:12:29 -0400] gyre007: why isn't node_ipaddress populating here https://gist.github.com/3657617
[2012-09-06 16:17:13 -0400] gyre007: ha I think this bit is not running at all.. <% @hosts.each do |node| %> probably because @hosts is empty...but where do I set it to something ?
[2012-09-06 16:21:49 -0400] gyre007: application_server_role is this the server's role as Chef role ??
[2012-09-06 16:21:58 -0400] gyre007: in nginx_loadbalancer recipe
[2012-09-06 16:22:03 -0400] gyre007: ehm provider
[2012-09-06 16:24:06 -0400] jtimberman: krisk: the default bootstrap uses the "omnibus" full stack packages.
[2012-09-06 16:24:37 -0400] jtimberman: krisk: there's eleven thousand different init systems to worry about, and the 'chef-client' cookbook already handles a fair number of them.
[2012-09-06 16:24:57 -0400] jtimberman: so we leave it up to the user to decide how to manage the chef installation and don't put a lot of opinion in the package other than putting the right bits in /opt/chef
[2012-09-06 16:31:57 -0400] olmo: i'm just getting started with chef, but i have a question. i understand that chef helps to build the infrastructure by configuring clients/nodes for you. I can also gleam, that for EC2 and other virtual computing you can configure chef to initialize new instances for you. I'm wondering, however, if chef can setup physical computers. say install ubuntu any updates, plus self configure chef or as a human i have to do at least that when it's a physical computer
[2012-09-06 16:32:34 -0400] pwf: it can do that
[2012-09-06 16:33:01 -0400] pwf: it needs ssh access to be set up, but from there you can use scripts to install chef-client, and then run chef to continue setting up whatever you need
[2012-09-06 16:33:15 -0400] JoshuaMiller: Does "set up" mean install the OS olmo?
[2012-09-06 16:33:21 -0400] olmo: right JoshuaMiller
[2012-09-06 16:33:29 -0400] olmo: everything before the first ssh connect
[2012-09-06 16:33:38 -0400] JoshuaMiller: That's a good question.  Is there a chef-endorsed phsyical provisioning system?
[2012-09-06 16:33:42 -0400] pwf: oh :/
[2012-09-06 16:33:54 -0400] olmo: i'm wondering if i'll still want to try doing an iso image of the system
[2012-09-06 16:34:02 -0400] olmo: so that saves me that hassle at first
[2012-09-06 16:34:34 -0400] mattray: JoshuaMiller: pxe_dust is kinda supported
[2012-09-06 16:34:34 -0400] JoshuaMiller: I use kickstart / PXE, but that doesn't have anything to do with chef.
[2012-09-06 16:34:38 -0400] wamilton: chef doesn't do anything until you can ssh into the client
[2012-09-06 16:35:00 -0400] mattray: JoshuaMiller: in as much as I maintain it and you can open tickets against it
[2012-09-06 16:35:01 -0400] olmo: yeah that's what i figured. but i'll lookup kickstart / PXE
[2012-09-06 16:35:18 -0400] mattray: olmo: pxe_dust does pxe installs of ubuntu and debian
[2012-09-06 16:35:42 -0400] JoshuaMiller: Matt, what's the play?  A PXE-server that's configured by chef maybe?
[2012-09-06 16:35:49 -0400] olmo: nice
[2012-09-06 16:35:57 -0400] JoshuaMiller: PXE/DHCP/Kickstart perhaps?
[2012-09-06 16:36:19 -0400] mattray: JoshuaMiller: it's a cookbook that sets up PXE booting via TFTP and OS installation, plus Chef
[2012-09-06 16:36:28 -0400] mattray: no DHCP requirement
[2012-09-06 16:36:45 -0400] mattray: so that's currently unmanaged (my router does it)
[2012-09-06 16:38:01 -0400] Loof: Anyone have experience using chef+windows (in particular via winrm)?
[2012-09-06 16:38:11 -0400] Loof: I'm trying to bootstrap windows and having mixed success
[2012-09-06 16:38:17 -0400] Loof: Well, no success yet
[2012-09-06 16:38:36 -0400] Eulipion: did you try turning it off and on?
[2012-09-06 16:38:50 -0400] JoshuaMiller: Wah wah waaaah
[2012-09-06 16:39:05 -0400] krisk: jtimberman: ok, so I should write myself a custom knife-bootstrap-template, that set's up the opscode repos and apt-gets the chef package? I really need the chef-client daemon mode as well as initscript, otherwise I'd have to fiddle around on each node to set it up properly afterwards..
[2012-09-06 16:39:35 -0400] krisk: jtimberman: I was just wondering why the omnibus thing (that (if I read correctly) installes a .deb) is not using the same .deb as in the opscode repos
[2012-09-06 16:39:54 -0400] krisk: jtimberman: because I think the one in the repos is far more sophisticated..
[2012-09-06 16:40:08 -0400] mattray: krisk: just pass a run list when you bootstrap including the chef-client cookbook
[2012-09-06 16:40:33 -0400] mattray: krisk: omnibus doesn't have any OS dependencies
[2012-09-06 16:40:57 -0400] mattray: krisk: apt-repo one is a proper .deb, depends on Ubuntu or Debian's Ruby for example
[2012-09-06 16:42:21 -0400] krisk: mattray: ah ok, chef-client cookbook is new to me. won't the two chef packages collide? (the one that omnibus installed, and the one that's installed then from the opscode repos)
[2012-09-06 16:42:56 -0400] thehar: lalalalala
[2012-09-06 16:43:07 -0400] mattray: krisk: you don't need the apt-repo one. The default template will install the omnibus .deb
[2012-09-06 16:43:34 -0400] mattray: krisk: the chef-client cookbook just manages daemonizing the chef-client, it assumes Chef is already on the box ;)
[2012-09-06 16:43:46 -0400] krisk: Another question: I recognized that chef doesn't use https by default, but since I run knife on my client workstation, I want the connection to be encrypted. Do I have to setup a nginx reverse-proxy that takes care of ssl, or can chef-server do this by itself? what's the recommended way of doing this? will the clients just accept https:// as chef-server URL?
[2012-09-06 16:44:26 -0400] jtimberman: krisk: it isn't the same deb.
[2012-09-06 16:44:34 -0400] krisk: mattray: ic. mmh. that doesn't automatically update chef-client though, in case there's a new package available then and stuff. but I can probably write a custom recipe that takes care of that
[2012-09-06 16:44:40 -0400] jtimberman: krisk: the omnibus deb is a full stack package for all the things above libc required to run chef-client.
[2012-09-06 16:45:04 -0400] jtimberman: krisk: i suggest using the chef-client cookbook's service recipe to manage the service.
[2012-09-06 16:45:09 -0400] mattray: krisk: there's another cookbook for that
[2012-09-06 16:45:28 -0400] mattray: krisk: https setup here: http://wiki.opscode.com/display/chef/How+to+Proxy+Chef+Server+with+Apache
[2012-09-06 16:45:31 -0400] krisk: mattray: you happen to remember the name?
[2012-09-06 16:45:34 -0400] jtimberman: also, mattray said things too and i ignored them because my name wasn't highlighted on those lines :)
[2012-09-06 16:45:52 -0400] mattray: krisk: looking
[2012-09-06 16:46:07 -0400] mattray: krisk: http://community.opscode.com/cookbooks/omnibus_updater
[2012-09-06 16:46:46 -0400] krisk: mmh, call me conservative.. but my stomach would kinda rather go with decent apt/yum repos and packages, that can be updated using the normal system update process.. :/
[2012-09-06 16:46:50 -0400] gyre007: can I add a user to additional groups apart from the default one when I create it in the recipe ?
[2012-09-06 16:47:07 -0400] gyre007: i need a user which will be a member of multiple groups...
[2012-09-06 16:47:12 -0400] gyre007: is it possible ?
[2012-09-06 16:47:37 -0400] jtimberman: krisk: sure, so, use the apt bootstrap template or customize it :)
[2012-09-06 16:48:04 -0400] jtimberman: e.g., https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap/ubuntu10.04-apt.erb
[2012-09-06 16:48:05 -0400] mattray: krisk: the ubuntu10.04 template could be updated
[2012-09-06 16:48:34 -0400] krisk: jtimberman: ah, i was looking for this, the github folder I had a look on only contained full and *-gem templates
[2012-09-06 16:49:01 -0400] krisk: ah, ok bc it's an old ubuntu :)
[2012-09-06 16:49:33 -0400] mattray: krisk: if it's a really old Ubuntu, you could have Chef 0.8 in there, so be warned
[2012-09-06 16:49:59 -0400] krisk: jtimberman: mattray: mmh, looks like its pretty easily updated to 12.04 or so though.. may try that
[2012-09-06 17:01:34 -0400] Jay_Levitt: I'm trying to use the 'hostname' cookbook to set my hostname from my node name.  But I can't find ANY way to discover, in a Chef recipe, my proper node name!  node[:name] is being set to the existing hostname; so is Chef::Config[:node_name]
[2012-09-06 17:04:24 -0400] JoshuaMiller: What are you defining as the "proper" node name?
[2012-09-06 17:05:05 -0400] Jay_Levitt: the name I used when creating with 'knife ec2 server create --node-name', which is also what I see in the "name:" field doing "knife node edit --all"
[2012-09-06 17:08:04 -0400] addisonj: blah! the opscode blog has really screwed up formatting on old posts for me, am I the only one seeing that?
[2012-09-06 17:08:11 -0400] Jay_Levitt: addisonj: nah, I've noticed it too
[2012-09-06 17:08:30 -0400] addisonj: it makes the information un-consumeable, which is too bad
[2012-09-06 17:12:05 -0400] jtimberman: il
[2012-09-06 17:12:15 -0400] jtimberman: silly focus stealing apps
[2012-09-06 17:12:32 -0400] JoshuaMiller: Fiddling with one of my systems that has a different node name than hostname, and...it doesn't seem to have any problem with the hostname (per uname -n) different from the node name
[2012-09-06 17:13:05 -0400] JoshuaMiller: Jay_Levitt: are you sure one of your recipes isn't enforcing they match?
[2012-09-06 17:13:56 -0400] CharlieSu: Anyone see anything wrong with what I'm doing here?  I'm finding that some of my users are never being added to the group..  https://gist.github.com/3a0e1f7549977f301f3e
[2012-09-06 17:15:00 -0400] CharlieSu: Specifically they're not being added to the "sftponly" group
[2012-09-06 17:15:45 -0400] mattray: FYI, Spiceweasel 1.2.0 is now out.
[2012-09-06 17:15:52 -0400] mattray: http://bit.ly/spcwsl
[2012-09-06 17:16:06 -0400] Jay_Levitt: JoshuaMiller: No, I just checked my whole repo and nothing is setting node['name'] (or :name or .name)
[2012-09-06 17:18:49 -0400] jtimberman: Jay_Levitt: node['hostname'] is an automatic attribute.
[2012-09-06 17:19:09 -0400] jtimberman: Jay_Levitt: you cannot modify it without changing the underlying OS configuration that ohai reads (hostname -f on unix/linux) to set it.
[2012-09-06 17:19:10 -0400] Jay_Levitt: jtimberman: right, I would expect node['hostname'] to show the current hostname (ip-10-0-66)
[2012-09-06 17:19:56 -0400] Jay_Levitt: jtimberman: the 'hostname' cookbook does just that; it'll set /etc/hostname, run 'hostname' to change for the current session, etc
[2012-09-06 17:20:23 -0400] Jay_Levitt: jtimberman: but the 'hostname' cookbook requires you to tell it what you want the hostname to be.  And I want the hostname to be whatever the *node* name is (e.g. 'bastion')
[2012-09-06 17:20:41 -0400] jtimberman: node.name
[2012-09-06 17:20:44 -0400] jtimberman: will return the node's name.
[2012-09-06 17:20:49 -0400] Jay_Levitt: jtimberman: you would think so.
[2012-09-06 17:20:57 -0400] Jay_Levitt: chef:attributes > node.name
[2012-09-06 17:20:58 -0400] Jay_Levitt:  => "ip-10-0-0-66"
[2012-09-06 17:21:25 -0400] Jay_Levitt: so you can see my consternation here :)
[2012-09-06 17:21:32 -0400] jtimberman: are you configuring node.name something different with chef-client -N or node_name in /etc/chef/client.rb?
[2012-09-06 17:21:59 -0400] jtimberman: shef is going to use the ohai default value unless you pass in the configuration file
[2012-09-06 17:22:05 -0400] jtimberman: with the node_name set
[2012-09-06 17:22:10 -0400] jtimberman: shef doesn't have -N
[2012-09-06 17:22:30 -0400] Jay_Levitt:  grep node_name /etc/chef/client.rb
[2012-09-06 17:22:30 -0400] Jay_Levitt: node_name "robomo"
[2012-09-06 17:22:48 -0400] jtimberman: shef -c /etc/chef/client.rb
[2012-09-06 17:22:52 -0400] jtimberman: chef > node.name
[2012-09-06 17:22:58 -0400] jtimberman: should #=> "robomo"
[2012-09-06 17:23:07 -0400] Jay_Levitt: ahhhh
[2012-09-06 17:23:16 -0400] Jay_Levitt: Gotcha, shef doesn't automatically look where chef-client does for the client.rb
[2012-09-06 17:23:25 -0400] segv: hey guys, quick question, I dumped the node information for a specific host, has all of its information except for the IP address etc. Does the node dump no longer save this information? (the interfaces)
[2012-09-06 17:24:07 -0400] JoshuaMiller: segv: ohai collects assigned IPs ; I've seen it on RHEL4/5/6
[2012-09-06 17:24:37 -0400] jtimberman: https://gist.github.com/3658746
[2012-09-06 17:24:50 -0400] jtimberman: Jay_Levitt: it only looks for client.rb if you use -z
[2012-09-06 17:24:52 -0400] jtimberman: automatically
[2012-09-06 17:24:54 -0400] segv: yeah it grabs them in ohai
[2012-09-06 17:24:58 -0400] JoshuaMiller: segv: what kind of interfaces are you referring to?
[2012-09-06 17:25:00 -0400] jtimberman: or you can always pass in a specific arbitrary config file with -c
[2012-09-06 17:25:00 -0400] segv: but the chef dump doesn't contain that information
[2012-09-06 17:25:11 -0400] Jay_Levitt: jtimberman: ah hah.... thanks, new to shef
[2012-09-06 17:25:23 -0400] segv: network->interfaces->eth0->addresses
[2012-09-06 17:25:26 -0400] segv: is empy
[2012-09-06 17:25:27 -0400] segv: empty**
[2012-09-06 17:25:32 -0400] segv: just "addresses": {}
[2012-09-06 17:26:04 -0400] JoshuaMiller: Does running ohai on the node show values?
[2012-09-06 17:26:16 -0400] gyre007: Im trying to get the rails app up and running...all went ok but it looks like the unicorn is not starting...maybe i havent created the resource correctly ?
[2012-09-06 17:26:20 -0400] gyre007: anyone idea ?
[2012-09-06 17:26:39 -0400] segv: JoshuaMiller: yep
[2012-09-06 17:27:00 -0400] segv: JoshuaMiller: I see them there, and if I do a knife search, I can pull out the attributes, but when I dump the node with -Fj from a show, the values are empty
[2012-09-06 17:28:08 -0400] gyre007: this is what ive got... https://gist.github.com/3658773
[2012-09-06 17:28:38 -0400] gyre007: all goes well...with tiny bit...unicorn is not running...but i might be missing something...
[2012-09-06 17:28:47 -0400] gyre007: maybe i havent created it correctly...
[2012-09-06 17:29:09 -0400] JoshuaMiller: segv: Does this search find what you're looking for?  knife search node "addresses:10.10.10.10" -i
[2012-09-06 17:29:38 -0400] alexbst: chef keeps deleting templates I used and then complaining that they can't be found.
[2012-09-06 17:29:50 -0400] gyre007: probably the config ?
[2012-09-06 17:29:54 -0400] alexbst: I turned some code into a def block and call it twice
[2012-09-06 17:30:03 -0400] Jay_Levitt: jtimberman: while I have you.. do your new database & postgresql cookbooks, along with 0.14, work well with chef-full now?
[2012-09-06 17:30:03 -0400] alexbst: chef code, that is.
[2012-09-06 17:30:12 -0400] segv: JoshuaMiller: ah, nope it doesn't
[2012-09-06 17:32:37 -0400] JoshuaMiller: segv: A search finds the attributes, but node show -Fj excludes them?  Then I dunno.
[2012-09-06 17:32:45 -0400] rshade98: alex, are you saying you made it a definition?
[2012-09-06 17:32:52 -0400] alexbst: thats right
[2012-09-06 17:33:05 -0400] CharlieSu: How can I use the ohai data to get the ip addresses for eth0 and tun0?  I notice the values are stored as keys, but I've also got other 'addresses' for for different families
[2012-09-06 17:33:05 -0400] alexbst: is there a saner way ?
[2012-09-06 17:33:08 -0400] rshade98: do you have cookbook_name in the template definition
[2012-09-06 17:33:19 -0400] segv:  JoshuaMiller I stand corrected the search doesn't even find it
[2012-09-06 17:33:19 -0400] alexbst: probably, let me check rshade98
[2012-09-06 17:33:50 -0400] alexbst: no, I don't
[2012-09-06 17:33:50 -0400] segv: It doesn't even show the ipaddress information
[2012-09-06 17:34:09 -0400] alexbst: template "#{coder_install_dir}\\#{coderDir}\\web.config" do
[2012-09-06 17:34:10 -0400] rshade98: alexbst, you will need that
[2012-09-06 17:34:10 -0400] alexbst:    source "#{coderDir}_web.config.erb"
[2012-09-06 17:34:30 -0400] alexbst: rshade98 - how to specify it ?
[2012-09-06 17:34:33 -0400] rshade98: add cookbook_name 'cookbook'
[2012-09-06 17:34:51 -0400] alexbst: inside the template
[2012-09-06 17:34:52 -0400] retr0h: CharlieSu: https://gist.github.com/1040543
[2012-09-06 17:35:03 -0400] rshade98: yeah
[2012-09-06 17:35:10 -0400] rshade98: sorry it is cookbook - http://wiki.opscode.com/display/chef/Resources#Resources-Template
[2012-09-06 17:35:15 -0400] alexbst: thanks, will give that a go shortly
[2012-09-06 17:35:50 -0400] gyre007: arrrgh
[2012-09-06 17:35:52 -0400] gyre007: :0
[2012-09-06 17:35:54 -0400] CharlieSu: retr0h: nice..  Is this a plugin?  Where do I put it?
[2012-09-06 17:35:57 -0400] gyre007: going nuts
[2012-09-06 17:36:04 -0400] retr0h: CharlieSu: Yah, it's an ohai plugin
[2012-09-06 17:36:48 -0400] retr0h: CharlieSu: just add the ohai cookbook, drop that plugin under files/.... and add ohai to your runlist, you will then have the data
[2012-09-06 17:37:26 -0400] CharlieSu: retr0h: thanks!
[2012-09-06 17:38:10 -0400] Loof: Is it just me or is the chef client on windows terribly slow to start?
[2012-09-06 17:38:24 -0400] CharlieSu: retr0h: so this sets node attributes?
[2012-09-06 17:38:33 -0400] retr0h: yah
[2012-09-06 17:39:11 -0400] retr0h: CharlieSu: node['network']['ipaddress_eth0']
[2012-09-06 17:39:16 -0400] alexbst: rshade98 - this is all within a recipe file within the cookbook, so I've referenced the cookbook for cookbookname.. going to be interesting.
[2012-09-06 17:40:40 -0400] CharlieSu: retr0h: where does this come from?   require_plugin "hostname" and require_plugin "#{os}::network"
[2012-09-06 17:49:48 -0400] retr0h: CharlieSu: that is built into ohai https://github.com/opscode/ohai/tree/master/lib/ohai/plugins
[2012-09-06 17:50:26 -0400] mjreed: Ok, I'm at a loss.  I have a gem_package resource that is failing and I don't know why.  gem_package "bespoke" do   action :install;  source node[:bespoke][:gem_source];  notifies :restart, "service[bespoke]"; end
[2012-09-06 17:50:53 -0400] mjreed: that blows up with FATAL: Gem::InstallError: gem_package[bespoke] (bespoke::unicorn line 19) had an error: Gem::InstallError: bespoke requires mongo (>= 0, runtime)
[2012-09-06 17:51:34 -0400] mjreed: but if I just do 'gem install bespoke --source (same url as node attr, verified)', it works.
[2012-09-06 17:55:20 -0400] CharlieSu: retr0h: thanks for your help.  Everything worked perfectly..  Now time to refactor some things
[2012-09-06 17:55:26 -0400] retr0h: CharlieSu: awesome
[2012-09-06 18:00:20 -0400] mjreed: hm, 0.10.8.  might have hit a bug.  let me try newer chef.
[2012-09-06 18:01:01 -0400] justinlilly: hey folks. Is there a reasonable way to say "I want every server to have the following runlist"? Do you just add `role[base_install]` add into every role?
[2012-09-06 18:01:39 -0400] Mithrandir: I do that
[2012-09-06 18:02:53 -0400] mjreed: we have a role[base] that we just put on all our nodes first thing
[2012-09-06 18:03:19 -0400] justinlilly: mjreed: right. I was basically wondering if there was somewhere I could put that in which I didn't have to include it in the current and all future roles.
[2012-09-06 18:03:27 -0400] justinlilly: like something above environments.
[2012-09-06 18:05:22 -0400] mjreed: you don't have to add it to roles, you can just put it on the nodes directly.
[2012-09-06 18:05:45 -0400] mjreed: every time we create a new VM or bootstrap a new node, we do it with -r 'role[base]'.  whatever run list we put on from there, we never remove it.
[2012-09-06 18:11:09 -0400] linTest: I'm having an ohai problem; Ohai OHAI-273; http://tickets.opscode.com/browse/OHAI-273
[2012-09-06 18:11:20 -0400] linTest: Unable to find version for Windows 2003 Server R2 node
[2012-09-06 18:11:31 -0400] linTest: I have two Windows 2003 nodes (different hardware for each); one has this problem and one is working as expected.
[2012-09-06 18:12:11 -0400] linTest: Dell PowerEdge 2950 is broken; HP380 works
[2012-09-06 18:13:20 -0400] linTest: Chef: 10.12.0 and Ruby: 1.9.2 and ohai:  6.14.0
[2012-09-06 18:34:05 -0400] justinlilly: In my team's chef configs, we have 2 different roles prod_app and staging_app. I think this is there so we can update the staging_app first, make sure the chef config works, then do the prod one. Are there facilities for this in chef? If my understanding is right, if I were to update the "app_server" roll, it would deploy to all environments at once?
[2012-09-06 18:38:02 -0400] justinlilly: hrm. looks like cookbook versions might be what I want.
[2012-09-06 18:42:41 -0400] chip-: justinlilly: yes, use environments + cookbook versioning
[2012-09-06 18:42:52 -0400] chip-: justinlilly: look into the 'spork' plugin for knife, from etsy. It helps you enforce proper versioning workflows, among many other things.
[2012-09-06 18:46:32 -0400] chip-: justinlilly: https://github.com/jonlives/knife-spork
[2012-09-06 18:47:08 -0400] justinlilly: thanks!
[2012-09-06 18:48:48 -0400] chip-: jonlives: Don't know if I've told you this, but I'm to the point where if I run into a "I wish Chef could" situation, the first thing i do is check Etsy's blog and your git repos, because you've probably already built it.
[2012-09-06 18:49:05 -0400] jonlives: chip-: haha excellent :p
[2012-09-06 19:10:14 -0400] smurfy: how would i format a query to ec2:security_groups:group_name in knife ?
[2012-09-06 19:11:24 -0400] terbeaux: did you try escaping the : characters
[2012-09-06 19:11:40 -0400] terbeaux: like "ec2\:security_groups\:group_name"
[2012-09-06 19:11:52 -0400] terbeaux: or using single quotes instead like 'ec2:security_groups:group_name'
[2012-09-06 19:12:05 -0400] smurfy: yeah it's not seeing it either way
[2012-09-06 19:12:18 -0400] smurfy: can't seem to get it to work on anything that's nested
[2012-09-06 19:12:56 -0400] terbeaux: http://wiki.opscode.com/display/chef/Search
[2012-09-06 19:13:09 -0400] terbeaux: find on page: "To search in a nested key"
[2012-09-06 19:14:19 -0400] smurfy: ah underscore
[2012-09-06 19:14:21 -0400] smurfy: thanks
[2012-09-06 19:20:29 -0400] fish_: I'm confused. shouldn't roles contain the expanded list of all roles applied to a node?
[2012-09-06 19:22:17 -0400] BryanWB:   how do i set node attrs for my test-kitchen configuration?
[2012-09-06 19:22:26 -0400] fish_: or does that only work for searches?
[2012-09-06 19:24:11 -0400] fish_: it doesn't even work for searches
[2012-09-06 19:24:24 -0400] fish_: I'm totally confused now
[2012-09-06 19:25:06 -0400] fish_: given role foo has role bar in the run_list, role foo is applied to a node. now a search for roles:bar should find that node, shouldn't it?!
[2012-09-06 19:25:45 -0400] organicveggie: Trying to upgrade from Chef server 0.9.14 on one server to 10.12.0 on another server. Setup new EC2 instance, copied CouchDB over and things seem fine. But I'm not seeing some of the nodes in search results.
[2012-09-06 19:25:56 -0400] organicveggie: "knife node list" shows the full set of servers (as expected).
[2012-09-06 19:26:11 -0400] fish_: ah never mind, role in our repo doesn't match role at chef server m(
[2012-09-06 19:26:22 -0400] organicveggie: But "knife search node 'role:*'" is only showing a subset... the nodes that have run chef-client since the server switch over.
[2012-09-06 19:26:29 -0400] organicveggie: Am I missing something?
[2012-09-06 19:29:09 -0400] tsan: has anyone had an error like this when doing a chef run? - NameError: undefined local variable or method `node' for #<Class:0x7f5f5df3d2c0>.  It seems that node can't be used in cookbook_name/resources files.
[2012-09-06 19:29:50 -0400] fish_: organicveggie: sounds like the same issue a colleague of mine had - also need a solution for that
[2012-09-06 19:30:38 -0400] fish_: organicveggie: it probably has something to do with the fact that "new" attributes are only searchable after the next chef run
[2012-09-06 19:30:41 -0400] organicveggie: fish_: well, at least i'm not alone. :) i'm also sure there is a reasonable explanation...
[2012-09-06 19:31:23 -0400] fish_: so we have to somehow save the current state, probably we need to copy some solr stuff over but I'm not sure
[2012-09-06 19:31:40 -0400] fish_: but I'm planning pretty much the same upgrade right now
[2012-09-06 19:32:21 -0400] organicveggie: fish_: Hrmph.
[2012-09-06 19:32:39 -0400] organicveggie: I had to switch back b/c we automatically populate DNS with information from Chef.
[2012-09-06 19:33:21 -0400] fish_: organicveggie: yep, if we hadn't discovered that during testing, it would have killed our infrastricture as well :/
[2012-09-06 19:33:24 -0400] organicveggie: When I switched over to the 10.12.0 server, search didn't return any results... so DNS was empty.
[2012-09-06 19:33:48 -0400] organicveggie: Sadly, I was *trying* to test... but forgot that DNS was automatically synchronized. :)
[2012-09-06 19:34:49 -0400] fish_: we tested it on a completely separated environment because yep, it's sometimes really hard to keep in mind every part of the infrastructure chef is touching
[2012-09-06 19:35:34 -0400] yfeldblum: organicveggie, you sayd that you copied the couchdb database; did you copy the solr index?
[2012-09-06 19:36:16 -0400] yfeldblum: organicveggie, remember, the search feature, whether done on the CLI with knife, or whether done in chef-client, does a query against the solr index, and not against the couchdb database
[2012-09-06 19:36:16 -0400] organicveggie: yfeldblum: ummmm....
[2012-09-06 19:36:28 -0400] organicveggie: yfeldblum: whoops.
[2012-09-06 19:36:43 -0400] yfeldblum: organicveggie, so if you didn't copy the index, you can probably rebuild the index after-the-fact
[2012-09-06 19:36:48 -0400] yfeldblum: organicveggie, using `knife index rebuild`
[2012-09-06 19:36:58 -0400] yfeldblum: organicveggie, which will likely take some time to complete
[2012-09-06 19:38:02 -0400] yfeldblum: organicveggie, so you can either copy the solr index alongside the couchdb database, or you can copy just the couchdb database and then rebuild the solr index
[2012-09-06 19:38:19 -0400] organicveggie: yfeldblum: i can spare the time.
[2012-09-06 19:38:47 -0400] organicveggie: yfeldblum: very very useful tidbit. Thanks!
[2012-09-06 19:38:55 -0400] yfeldblum: organicveggie, in any event, test it first if you can :P
[2012-09-06 19:39:06 -0400] organicveggie: yeah yeah. :)
[2012-09-06 19:39:30 -0400] organicveggie: Now that I remember our two DNS servers are linked, I will remember to unlink them *before* testing it again... :)
[2012-09-06 19:47:33 -0400] tigris_: hi guys, if anyone is knowledgable on the deploy resource, i am curious if there is a "standard" place where people dump their rake assets:precompile task... i'm currently doing it in "before_restart", but i notice that runs after the "current" folder has been symlinked, and since it takes > 5 mins to run, i wonder if that's a bit unsafe
[2012-09-06 19:54:28 -0400] BryanWB: argh these bento boxes are freaking huge, must be a way to slim them down
[2012-09-06 19:55:31 -0400] yfeldblum: tigris_, yeah the deploy resource, like capistrano, works in a way that i don't think works well with applications that have actual build steps
[2012-09-06 19:55:55 -0400] yfeldblum: tigris_, nature of the beast, if you will
[2012-09-06 20:04:08 -0400] jtimberman: BryanWB: but you only have to download them once :)
[2012-09-06 20:04:19 -0400] jtimberman: BryanWB: also, you could build it locally and all will be well too
[2012-09-06 20:04:21 -0400] jtimberman: :D
[2012-09-06 20:04:35 -0400] jtimberman: (though yes, they should probably be smaller)
[2012-09-06 20:04:53 -0400] BryanWB: jtimberman, i know man but we po' in europe, i only have a 1mbps connection,
[2012-09-06 20:05:01 -0400] jtimberman: BryanWB: :-|
[2012-09-06 20:05:15 -0400] BryanWB: also, uh, when I lived in Kathmandu 2 yrs ago I had a 64k connection :)
[2012-09-06 20:06:20 -0400] jmartin: *shudder*
[2012-09-06 20:07:11 -0400] tigris_: yfeldblum: it's probably a non-issue, stuff like unicorn and other daemons started up when the "current" symlink was in place will probably be tied to the old files even when that symlink disappears
[2012-09-06 20:07:40 -0400] tigris_: until the "restart" hook comes along at HUPs them all
[2012-09-06 20:07:47 -0400] yfeldblum: tigris_, heh, my approach is just to avoid the whole problem altogether
[2012-09-06 20:09:56 -0400] tigris_: yfeldblum: heh, yes i sometimes wonder if the best approach is to just trigger a 503 maintenance page at the start of a deploy run, and remove it when complete... will be no "migration" issues there :)
[2012-09-06 20:10:14 -0400] yfeldblum: tigris_, heh, well that's not quite what i meant
[2012-09-06 20:13:16 -0400] whack: Having some odd newbie issues with chef-solo - https://gist.github.com/3dedab0004876ff4aca6
[2012-09-06 20:13:28 -0400] whack: Basically, I'm saying file_cache_path "./cache" and it tries to use "/cache"
[2012-09-06 20:13:52 -0400] tigris_: whack: there is an issue with chef-solo and relative paths
[2012-09-06 20:14:13 -0400] whack: tigris_: gotcha, will use full paths
[2012-09-06 20:14:28 -0400] tigris_: first thing it does is changes to /, forgetting where it was when it started up, so setting anything relative will break
[2012-09-06 20:15:16 -0400] whack: hah, gotcha
[2012-09-06 20:15:17 -0400] whack: dir = File.dirname(__FILE__).gsub(/^\./, File.realpath("."))
[2012-09-06 20:15:19 -0400] whack: that fixed it.
[2012-09-06 20:15:23 -0400] whack: tigris_: thanks :)
[2012-09-06 20:15:40 -0400] BryanWB: jtimberman, when u get a chance, wud like to know what u think of my suggestion for the postgresql::ruby cookbook
[2012-09-06 20:16:26 -0400] whack: though I suppose File.realpath(dir) works too, dummy me.
[2012-09-06 20:18:17 -0400] tigris_: whack: yeah but obfu is fun
[2012-09-06 20:22:21 -0400] organicveggie: After reindexing my 10.12.0 test server, my clients can't seem to talk to it successfully. "/usr/lib/ruby/1.8/net/protocol.rb:135:in `sysread': end of file reached (EOFError)"
[2012-09-06 20:23:36 -0400] organicveggie: Any suggestions?
[2012-09-06 20:28:17 -0400] yfeldblum: organicveggie, you will always want to provide the full backtrace if you can ...
[2012-09-06 20:28:36 -0400] organicveggie: trying to reproduce it now. :(
[2012-09-06 20:28:50 -0400] jtimberman: BryanWB: which ticket is that
[2012-09-06 20:32:20 -0400] tigris_: BryanWB: is this the issue of the pg gem being loaded too early?
[2012-09-06 20:36:27 -0400] yfeldblum: if you try to load two versions of the chuck_norris gem, you don't get a LoadError; you get a RoundhouseError
[2012-09-06 20:37:10 -0400] laruellef: Hi, I'm looking for hosted chef support, am i at the right place?
[2012-09-06 20:41:02 -0400] hoover_damm: laruellef, http://www.opscode.com/support/ is the best place.  There are opscode employee's here
[2012-09-06 20:41:14 -0400] hoover_damm: so both answers should work
[2012-09-06 20:41:20 -0400] yfeldblum: laruellef, opscode's official support for their commercial products is at opscode.com/support/ and support@opscode.com
[2012-09-06 20:41:41 -0400] yfeldblum: laruellef, but hoover_damm here will be more than delighted to take your questions ^_^
[2012-09-06 20:42:02 -0400] hoover_damm: yfeldblum, excuse me?
[2012-09-06 20:42:39 -0400] geekbri: yfeldblum: the chuck_norris gem should be deprecated due to its poor design and hateful nature
[2012-09-06 20:43:00 -0400] yfeldblum: laruellef, more seriously, though, you can certainly ask questions of chef in general and of hosted-chef in particular in this channel, and someone here might be able to respond
[2012-09-06 20:43:04 -0400] hoover_damm: yfeldblum, mind recanting that statement?
[2012-09-06 20:43:37 -0400] laruellef: ha! cool, This is my first 20 mins working with chef, i'm having some problems with the quick start guide http://wiki.opscode.com/display/chef/Fast+Start+Guide  I'm unable to find the Organization validation key and User key in the management console
[2012-09-06 20:43:43 -0400] yfeldblum: i recant "hoover_damm here will be more than delighted to take your questions"
[2012-09-06 20:44:04 -0400] hoover_damm: Yes you can because I did not make that statement nor offer support.
[2012-09-06 20:45:04 -0400] geekbri: but it was too late, they'd already seen everything
[2012-09-06 20:45:23 -0400] cwj: laruellef: at https://manage.opscode.com/organizations you can regenerate the organization's validation key
[2012-09-06 20:45:50 -0400] cwj: and then if you need to get a key for your user you can do that at https://www.opscode.com/account/password
[2012-09-06 20:46:17 -0400] laruellef: Hmmh, just created my account 20 mins ago, why do i need to REgenerate an org key?
[2012-09-06 20:46:34 -0400] yfeldblum: laruellef, you can only *regenerate* keys, but you can never retrieve them, because Opscode does not actually retain the private part of the keypair (they only retain the public part, and download to you the private part)
[2012-09-06 20:46:37 -0400] laruellef: why not get the current existing key, where is it?
[2012-09-06 20:46:49 -0400] yfeldblum: laruellef, this is par-for-the-course public/private key management
[2012-09-06 20:47:05 -0400] cwj: yerp
[2012-09-06 20:47:47 -0400] yfeldblum: laruellef, so there wasn't necessarily any error or mistake - this is just how it's done - this is just the method by which you get the org validation key, your your admin-user/admin-client key, etc
[2012-09-06 20:47:51 -0400] laruellef: Looks like the fast start guide needs some updating, imho
[2012-09-06 20:48:01 -0400] yfeldblum: laruellef, :P
[2012-09-06 20:48:23 -0400] ortho_stice: Does anyone have any pointers toward best practices for managing one-time changes in chef?
[2012-09-06 20:48:47 -0400] cwj: i think that the sign up process includes links to at least your user key, but it could have changed since i last used it
[2012-09-06 20:49:42 -0400] bluepojo: ortho_stice: what's an example of a one time change?
[2012-09-06 20:49:48 -0400] justinlilly: Is there a signal I can send chef-client process which says "I know you're going to update in 5 minutes, but I want you to do it RIGHT NOW."
[2012-09-06 20:50:22 -0400] bluepojo: justinlilly: you can turn off daemon mode, fire chef-client, then turn it back on.
[2012-09-06 20:50:37 -0400] yfeldblum: bluepojo, is that the KILL signal?
[2012-09-06 20:51:10 -0400] bluepojo: hm, we might send a kill I'd have to check
[2012-09-06 20:51:12 -0400] bluepojo: we have a tool that does it
[2012-09-06 20:51:18 -0400] ortho_stice: bluepojo: Our LDAP server's IP address changed.  Our OS writes a config file that includes the (resolved) IP address, though our attributes just provide the hostname.  There is a not_if on the resource, but it just checks for the existsence of the generated config file
[2012-09-06 20:51:41 -0400] justinlilly: I suppose what I want is http://tickets.opscode.com/browse/CHEF-2451
[2012-09-06 20:52:20 -0400] linTest: anybody have good workaround for a Windows Server 2003 node that has trouble running ohai, therefore can't auth to chef server?
[2012-09-06 20:52:55 -0400] justinlilly: hrm. although the duplicated ticket seems to suggest what I want is USR1. :)
[2012-09-06 20:53:36 -0400] ortho_stice: You can fix it in several ways - delete the generated config file (causing the notif to not be satisfies, so the resource runs); modify the notif to check for the old IP in the config file....  but that seems crufty
[2012-09-06 20:54:07 -0400] bluepojo: ortho_stice: yeah, I was thinking of a way to modify the not_if cleanly I think the not_if is the problem
[2012-09-06 20:54:20 -0400] bluepojo: cause you don't really mean "if the file exists, never update"
[2012-09-06 20:54:20 -0400] ortho_stice: It's a pretty broad brush
[2012-09-06 20:54:30 -0400] bluepojo: you mean "if the file exists and the information inside hasn't changed"
[2012-09-06 20:54:45 -0400] ortho_stice: But there is a lot in that config file, and it's one generated by the OS - I can't really template it
[2012-09-06 20:54:57 -0400] bluepojo: chef likes to take complete control of files
[2012-09-06 20:54:58 -0400] ortho_stice: and I can't really tell what changes in it would be "significant"
[2012-09-06 20:55:15 -0400] bluepojo: I see
[2012-09-06 20:55:20 -0400] ortho_stice: (this is ldapclient under Illumos)
[2012-09-06 20:56:02 -0400] bluepojo: the simple fix is to match a regex in the file to see if the information is still valid other than templating the whole file I can't think of a better solution.
[2012-09-06 20:56:38 -0400] bluepojo: if you can template it, I think you should if there's a good reason you can't, then I can't think of a clean solution
[2012-09-06 20:56:56 -0400] ortho_stice: yeah, but I can't write that regex, because I can't determine what is valid.  This time, it was the IP address of the ldap server that is no longer valid.   Next time, might be some other setting....
[2012-09-06 20:57:23 -0400] bluepojo: yeah, you'd have to handle it case by case
[2012-09-06 20:57:33 -0400] bluepojo: is ldapclient not managed by chef in this case?
[2012-09-06 20:57:39 -0400] ortho_stice: solve today's problems today , etc
[2012-09-06 20:57:41 -0400] bluepojo: maybe you need a recipe for ldapclient
[2012-09-06 20:57:54 -0400] ortho_stice: well, we have a locally developed ldap recipe
[2012-09-06 20:58:05 -0400] ortho_stice: which includes a bash resource to drive ldapclient
[2012-09-06 20:58:53 -0400] ortho_stice: Let's say I chose the "make the not_if smarter, and have it look for the bad IP" approach
[2012-09-06 20:59:11 -0400] ortho_stice: I can do that... but over time, my recipes accumulate crud
[2012-09-06 20:59:23 -0400] ortho_stice: checking for old, invalid configurations
[2012-09-06 20:59:56 -0400] ortho_stice: Anyone know of blog posts, musings, etc on how to deal with that?
[2012-09-06 21:01:49 -0400] bluepojo: usually templating is the right solution for this, cause you always end up with trouble if you're trying to deal with existing files that chef doesn't own 100%
[2012-09-06 21:02:01 -0400] bluepojo: there is an undocumented file_edit resource that handles some of this
[2012-09-06 21:02:17 -0400] bluepojo: but the reason it's undocumented is that it's generally advised to manage the whole file with chef
[2012-09-06 21:02:29 -0400] bluepojo: and you should only edit when you absolutely have to
[2012-09-06 21:02:31 -0400] ortho_stice: we need a sed resource! :)
[2012-09-06 21:02:33 -0400] bluepojo: which might be your case
[2012-09-06 21:02:40 -0400] bluepojo: well that's kinda what file_edit is
[2012-09-06 21:02:43 -0400] ortho_stice: yeah
[2012-09-06 21:03:15 -0400] yfeldblum: ortho_stice, templating the full file is the general or default chefish approach
[2012-09-06 21:04:02 -0400] ortho_stice: Or - as you suggested - in this particular case, I have an OS tool that wants to own the file; if I can't template the file safely (the tool has other side effects), then I should make the recipe smart enough to deal with it's peculiarities
[2012-09-06 21:04:21 -0400] yfeldblum: ortho_stice, because of chef's overall convergent or goal-driven model instead of a command-driven or delta-driven model, the chef way is to specify the goal state in full, rather than specifying items to change
[2012-09-06 21:04:22 -0400] laruellef: ok, i'm in, tks for the tips on "re-generating" org and user keys  but seriously, might wanna update the fast start guide to state that, coz it wasn't exactly intuitive
[2012-09-06 21:04:48 -0400] bluepojo: ortho_stice: I do something like what you're trying to do, I think, in this recipe: https://github.com/RiotGames/perforce-cookbook/blob/master/recipes/default.rb#L34
[2012-09-06 21:04:56 -0400] bluepojo: I can't manage the .bashrc file
[2012-09-06 21:05:07 -0400] bluepojo: so I check the file for what I want to add
[2012-09-06 21:05:09 -0400] bluepojo: and add it
[2012-09-06 21:05:11 -0400] bluepojo: if it's not there
[2012-09-06 21:05:47 -0400] bluepojo: this recipe was intended to deploy perforce to a developer machine with the proper server configs and such pulled from the environment
[2012-09-06 21:06:03 -0400] pedahzur: OK...need some understanding.  I invoke chef-solo with a .json file.  In that .json file, I define some attributes for the host. the .json file has a role in its runlist.  In that role file, it defines some attributes (override_attributes) with the same names as the attributes defined in the json file. These are, apparently, overridding the attributes in the json file.  Is that supposed to be the case? I thought a json file "trumped"
[2012-09-06 21:06:04 -0400] pedahzur: everything else.  OK, I see the precedence list here: http://wiki.opscode.com/display/chef/Attributes Where in that list do attributes defined in a .json file fall?
[2012-09-06 21:06:47 -0400] ortho_stice: pedahzur - those are node, or "normal" level attributes.  Override will indeed trump them.
[2012-09-06 21:07:05 -0400] ortho_stice: s/node/nodefile/
[2012-09-06 21:08:07 -0400] ortho_stice: bluepojo: thanks, that's a good example
[2012-09-06 21:08:34 -0400] ortho_stice: I may (reluctantly) do something similar for managing user's umasks for development project policy
[2012-09-06 21:09:09 -0400] terbeaux: looking in the source code for chef opensource it looks like the default package manager for osx is macports. is that right?
[2012-09-06 21:09:52 -0400] terbeaux: and windows does not have a package providor?
[2012-09-06 21:09:56 -0400] terbeaux: provider
[2012-09-06 21:10:06 -0400] ortho_stice: yfeldblum: re: one-time changes and end state.  What I'm looking for is guidance on how to manage one-time changes, that may only be detectable by detecting a particular prior state
[2012-09-06 21:10:55 -0400] pedahzur: ortho_stice: Thanks. So I should change that 'override_attributes' in the role to 'default_attributes' then the .json file will override anything it defines?
[2012-09-06 21:11:06 -0400] ortho_stice: Yes
[2012-09-06 21:11:18 -0400] pedahzur: ortho_stice: (Not a chef expert, if you can't tell...working with a system I inherited). :)
[2012-09-06 21:11:28 -0400] ortho_stice: generally, you should try to use the weakest precedence possible
[2012-09-06 21:11:41 -0400] ortho_stice: (and only override, when you have to)
[2012-09-06 21:12:07 -0400] yfeldblum: ortho_stice, the simple approach is to use some ruby code to determine what the final state should be and then, in a ruby_block resource, to detect the current state of the system, compare it to the intended final state, and, if they're different, change the system to bring it into line with the intended final state
[2012-09-06 21:12:26 -0400] ortho_stice: I can certainly do that
[2012-09-06 21:12:36 -0400] pedahzur: ortho_stice: Thanks much!
[2012-09-06 21:12:46 -0400] ortho_stice: my issue is that, for some changes, detecting prior states involves specifying them
[2012-09-06 21:13:13 -0400] ortho_stice: eg, I can't always say "This is the currently correct IP address for this service"
[2012-09-06 21:13:35 -0400] ortho_stice: but I can say "I know if you have an IP on this list, it's obsolete, and wrong"
[2012-09-06 21:13:50 -0400] ortho_stice: I can implement resources to enforce that
[2012-09-06 21:14:03 -0400] ortho_stice: but over time, as things change, more and more things become obsolete
[2012-09-06 21:14:26 -0400] ortho_stice: and the conditionals become crazy, just full of cruft
[2012-09-06 21:15:04 -0400] organicveggie: yfeldblum: finally can reproduce the EOFError with upgraded chef server.  https://gist.github.com/3657051
[2012-09-06 21:15:21 -0400] yfeldblum: ortho_stice, of course it really works best with a full-on template-the-whole-file approach, which is the way chef naturally works
[2012-09-06 21:15:26 -0400] yfeldblum: ortho_stice, but you can also use some other tricks
[2012-09-06 21:15:30 -0400] ortho_stice: (I'm speaking in black-and-white terms; more often it's shades of grey - eg I CAN determine correct final state, but only with an expensive lookup)
[2012-09-06 21:15:44 -0400] organicveggie: New chef server instance running 10.12.0 with data copied from old server (0.9.14). Client running 0.9.14.
[2012-09-06 21:15:51 -0400] organicveggie: Solr index rebuilt.
[2012-09-06 21:16:13 -0400] organicveggie: "/etc/hosts" on client temporarily has hardcoded IP pointed at new chef server.
[2012-09-06 21:16:33 -0400] organicveggie: Running chef-client throws the above error: "/usr/lib/ruby/1.8/net/protocol.rb:135:in `sysread': end of file reached (EOFError)"
[2012-09-06 21:16:38 -0400] yfeldblum: ortho_stice, for example, you can have a list of known old ldap ip address and stick it in a data-bag item or in an environment json or in a role json or in the node json, and then have the ruby code in place in the recipe to look for these known old ip addresses and replace them
[2012-09-06 21:16:39 -0400] organicveggie: https://gist.github.com/3657051
[2012-09-06 21:17:51 -0400] bluepojo: why do you need to know what the old one is?
[2012-09-06 21:17:57 -0400] bluepojo: Why can't you just check if the correct one is there?
[2012-09-06 21:18:22 -0400] ortho_stice: In this case, I probably could just do a DNS lookup, and check for that IP
[2012-09-06 21:18:46 -0400] ortho_stice: In other cases, the lookup may be too expensive, or there may be a lot of fanout
[2012-09-06 21:19:22 -0400] yfeldblum: ortho_stice, don't know; any chance of trying with chef-10 chef-client?
[2012-09-06 21:19:37 -0400] organicveggie: Also tried upgrading to chef client 10.12.0 - no luck. chef-stacktrace.out shows the same error. :(
[2012-09-06 21:20:21 -0400] ortho_stice: It's actually chef-solo
[2012-09-06 21:21:00 -0400] yfeldblum: ortho_stice, so in the node .json file, a role .rb or .json file, or a data-bag-item .json file
[2012-09-06 21:21:47 -0400] ortho_stice: This is perhaps a bad example
[2012-09-06 21:22:40 -0400] ortho_stice: It's a case where the OS tool is ill-behaved (side-effecting, and wanting ownership of a config file, making it difficult to template)
[2012-09-06 21:23:11 -0400] ortho_stice: and determining the correct end state doable (a DNS lookup isn't a big deal for a 15-sec convergence)
[2012-09-06 21:24:03 -0400] ortho_stice: I guess I'm looking for advice/best practices on how to manage one-time changes in general
[2012-09-06 21:24:24 -0400] ortho_stice: and the answer generally seems to be "find a way to re-cast the change in terms of the end state"
[2012-09-06 21:24:27 -0400] yfeldblum: ortho_stice, what i said above is a useful approach to take sometimes
[2012-09-06 21:24:42 -0400] yfeldblum: ortho_stice, for example, you can have a list of known old ldap ip address and stick it in a data-bag item or in an environment json or in a role json or in the node json, and then have the ruby code in place in the recipe to look for these known old ip addresses and replace them
[2012-09-06 21:25:20 -0400] ortho_stice: Not concerned about implementability.  Concerned about maintainability of that approach.
[2012-09-06 21:25:45 -0400] yfeldblum: ortho_stice, this is in general a way of specifying an old state "manually" instead of having chef-solo discover the old state
[2012-09-06 21:25:59 -0400] yfeldblum: ortho_stice, or you could just adjust the files by hand
[2012-09-06 21:26:23 -0400] yfeldblum: organicveggie, beats me ...
[2012-09-06 21:26:28 -0400] ortho_stice: I know how to make chef determine there is a change needed, given a list of old states
[2012-09-06 21:26:47 -0400] ortho_stice: my concern is that maintaining that list of old states gets worse and worse over time
[2012-09-06 21:27:39 -0400] ortho_stice: Here's perhaps a better example
[2012-09-06 21:27:45 -0400] ortho_stice: deleting a service
[2012-09-06 21:28:09 -0400] ortho_stice: Suppose a machine runs a DB server, and a web server
[2012-09-06 21:28:25 -0400] ortho_stice: down the line, those services are moved
[2012-09-06 21:28:35 -0400] ortho_stice: the machine now only needs to run the webserver
[2012-09-06 21:28:58 -0400] ortho_stice: So you ... what, add a resource to disable/delete the service?
[2012-09-06 21:29:35 -0400] ortho_stice: That's specifying an end state (don't run postgres)
[2012-09-06 21:29:57 -0400] ortho_stice: but how long does one keep that resource around?
[2012-09-06 21:30:54 -0400] ortho_stice: Once could also add a "delete the telnet service"
[2012-09-06 21:31:02 -0400] ortho_stice: not that we were ever running telnet
[2012-09-06 21:31:48 -0400] ortho_stice: People become afraid to delete resources that may or may not be used
[2012-09-06 21:32:16 -0400] ortho_stice: I'm looking for blogs, best practices, etc about maintainability ....
[2012-09-06 21:32:27 -0400] bluepojo: chef recipes should say what a server is, not what it used to be
[2012-09-06 21:32:42 -0400] bluepojo: if you need to reprovision the server, I'd say the best path is to rebuild it from a base OS
[2012-09-06 21:32:54 -0400] bluepojo: or build a new server and flip DNS once it's ready
[2012-09-06 21:32:55 -0400] JoshuaMiller1: I'd say if the role of the system changes, then you should change the role so that it doesn't configure that service.
[2012-09-06 21:32:55 -0400] JoshuaMiller1: Then, to unconfigure it, you can do something like this:
[2012-09-06 21:32:55 -0400] JoshuaMiller1: http://hectcastro.me/2012/03/31/running-chef-recipes-once.html
[2012-09-06 21:34:11 -0400] yfeldblum: ortho_stice, all good questions, which do not really fit well with the convergent model
[2012-09-06 21:34:28 -0400] JoshuaMiller1: But many people will espouse a rebuild
[2012-09-06 21:35:05 -0400] yfeldblum: JoshuaMiller1, indeed, i would go with "rebuild" as option #1; but there are other options if rebuilding is infeasible
[2012-09-06 21:35:12 -0400] ortho_stice: That's my gut reaction, too - if the deployment is automated, then this individual server is not precious, and reprovisioning is the right answer
[2012-09-06 21:36:52 -0400] whack: maintain vs destroy/create is a similar argument to push vs pull; merits to both. pick whatever works for your situation :)
[2012-09-06 21:37:16 -0400] bluepojo: chef tends to favor destroy/create as it doesn't really do "remove" very well.
[2012-09-06 21:37:41 -0400] ortho_stice: It gets gross when there is data to move around, though
[2012-09-06 21:38:01 -0400] yfeldblum: ortho_stice, that's why you still want sysadmins
[2012-09-06 21:38:02 -0400] bluepojo: are your db servers replicated?
[2012-09-06 21:38:06 -0400] bluepojo: like
[2012-09-06 21:38:19 -0400] bluepojo: destroy one, bring up a new one, replicate to it
[2012-09-06 21:38:26 -0400] bluepojo: no data lost
[2012-09-06 21:38:41 -0400] ortho_stice: Depends on whether the client is paying for replication.  "My god yes" is our starting point
[2012-09-06 21:38:46 -0400] bluepojo: if there's non-replicated data, you should probably solve that problem first
[2012-09-06 21:38:54 -0400] ortho_stice: Indeed
[2012-09-06 21:39:15 -0400] ortho_stice: startups and their hosting budgets /me rolls eyes
[2012-09-06 21:39:35 -0400] bluepojo: I'm not a business guy, but it feels bad not to include replication as part of the base package given how necessary it is
[2012-09-06 21:39:48 -0400] ortho_stice: Oh yes, we do
[2012-09-06 21:39:57 -0400] bluepojo: ah ok
[2012-09-06 21:40:03 -0400] ortho_stice: That's a very rare minority who ask to negotiate away replciation
[2012-09-06 21:40:08 -0400] bluepojo: ouch
[2012-09-06 21:40:13 -0400] ortho_stice: and we stringly advise against it
[2012-09-06 21:40:29 -0400] ortho_stice: it's mainly those who haven't "raised the curtain" yet
[2012-09-06 21:40:38 -0400] bluepojo: ah I see so data's not as valuable
[2012-09-06 21:40:43 -0400] bluepojo: cause it's not real
[2012-09-06 21:40:45 -0400] ortho_stice: rigth
[2012-09-06 21:40:46 -0400] bluepojo: or it's beta stuff
[2012-09-06 21:40:55 -0400] ortho_stice: and schema, etc under version control
[2012-09-06 21:42:23 -0400] ortho_stice: Anyway, thanks for the input on run-once type changes, everyone
[2012-09-06 21:42:33 -0400] ortho_stice: I may end up writing about it or something
[2012-09-06 21:58:13 -0400] pedahzur: Silly question: where does the chef acquire the value in node[:fqdn] ?
[2012-09-06 22:01:54 -0400] yfeldblum: pedahzur, https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/linux/hostname.rb#L23
[2012-09-06 22:02:09 -0400] yfeldblum: pedahzur, that's the linux version
[2012-09-06 22:04:04 -0400] pedahzur: yfeldblum: Thanks, that's what I thought.
[2012-09-06 22:14:19 -0400] organicveggie: Still stuck trying to upgrade a chef client from 0.9.14 to 10.12.0. Getting an EOFError. https://gist.github.com/3657051
[2012-09-06 22:19:33 -0400] organicveggie: Alright. If I can't get an upgrade to work... what are my alternate options? Start with a fresh server and manually add each node? (keeping in mind, we have about 170 servers)
[2012-09-06 22:21:05 -0400] yfeldblum: organicveggie, http://wiki.opscode.com/display/chef/Upgrading+Chef+0.9.x+to+Chef+10.x
[2012-09-06 22:22:06 -0400] organicveggie: yfeldblum: thanks, but that's not quite what i was looking for. upgrading the client works on some instances. Other instances show the EOFError I mentioned.
[2012-09-06 22:22:30 -0400] yfeldblum: organicveggie, ah sorry
[2012-09-06 22:22:37 -0400] organicveggie: since no has any idea what might be causing the EOFError, i'm trying to figure out what my alternatives are.
[2012-09-06 22:22:54 -0400] yfeldblum: organicveggie, is ruby up-to-date?
[2012-09-06 22:23:05 -0400] organicveggie: oh god no. i'm running on CentOS 6. :)
[2012-09-06 22:23:11 -0400] organicveggie: Ruby 1.8.7, baby.
[2012-09-06 22:23:15 -0400] organicveggie: :)
[2012-09-06 22:23:21 -0400] Urocyon: rbenv is your friend
[2012-09-06 22:23:42 -0400] Urocyon: or really omnibus chef
[2012-09-06 22:23:45 -0400] organicveggie: 170 instances... not really excited about the prospect of trying to upgrade Chef AND ruby.
[2012-09-06 22:24:02 -0400] bluepojo: we wrote an rbenv cookbook
[2012-09-06 22:24:19 -0400] bluepojo: https://github.com/RiotGames/rbenv-cookbook
[2012-09-06 22:25:09 -0400] organicveggie: bluepojo: i'll take a look. i was hoping to just get the upgrade finished. didn't really want to start the process of evaluating using rbenv or rvm across our clusters. that will take a few weeks. :(
[2012-09-06 22:26:20 -0400] organicveggie: Is Ruby 1.8.7 not supported with Chef 10?
[2012-09-06 22:26:33 -0400] organicveggie: (I know it's an ancient version of Ruby *grin*)
[2012-09-06 22:26:50 -0400] yfeldblum: organicveggie, is it at the latest patchlevel?
[2012-09-06 22:27:02 -0400] yfeldblum: organicveggie, i'm just throwing things out there to check for
[2012-09-06 22:27:14 -0400] organicveggie: yfeldblum: depends on what the latest patch level is for ruby 1.8.7...we're on 352.
[2012-09-06 22:27:21 -0400] organicveggie: that's the latest official release for centos.
[2012-09-06 22:27:24 -0400] Urocyon: I installed my chef-server using chef-solo and the chef-server cookbook onto a rhel6 system.   I had to make some tweaks to the chef-server cookbook though.
[2012-09-06 22:27:48 -0400] yfeldblum: organicveggie, o i c what the problem is ... centos!
[2012-09-06 22:28:03 -0400] organicveggie: hah hah. another debian/ubuntu fan i'm guessing? :)
[2012-09-06 22:28:08 -0400] yfeldblum: organicveggie, have you thought about migrating to os x server? or win 8 server?
[2012-09-06 22:28:21 -0400] organicveggie: yfeldblum: okay. now you're just being mean. :)
[2012-09-06 22:28:45 -0400] yfeldblum: organicveggie, heh well
[2012-09-06 22:29:02 -0400] bluepojo: our whole infrastructure is centos 6
[2012-09-06 22:29:04 -0400] yfeldblum: organicveggie, i don't know the intricacies of ruby on centos
[2012-09-06 22:29:11 -0400] bluepojo: or rather, our new boxes are centos 6
[2012-09-06 22:29:48 -0400] bluepojo: and the centos 5 boxes are going away
[2012-09-06 22:29:56 -0400] yfeldblum: bluepojo, i'm not sure that i would use that as a pickup line
[2012-09-06 22:30:07 -0400] bluepojo: I don't
[2012-09-06 22:30:10 -0400] bluepojo: it's k
[2012-09-06 22:30:27 -0400] bluepojo: I get the ladies by giving them free RP
[2012-09-06 22:30:30 -0400] bluepojo: >_>
[2012-09-06 22:30:32 -0400] bluepojo: <_<
[2012-09-06 22:31:30 -0400] kallistec: organicveggie: are you sure your server is sending a legit response? does this happen on every request?
[2012-09-06 22:31:47 -0400] organicveggie: kallistec: every request for certain clients.
[2012-09-06 22:31:58 -0400] organicveggie: no errors on the server, i don't think.
[2012-09-06 22:32:34 -0400] kallistec: organicveggie: are you using nginx or some other proxy that would log bytes sent and disconnections?
[2012-09-06 22:33:06 -0400] organicveggie: kallistec: sadly, no.
[2012-09-06 22:33:13 -0400] organicveggie: goes straight to chef.
[2012-09-06 22:34:09 -0400] organicveggie: Okay. Now this gets weird (as if it weren't already).
[2012-09-06 22:34:42 -0400] organicveggie: Since I'm getting ready to take off for the day, I changed the hosts file on the problem client to point at the old chef server and switched back to chef 0.9.14.
[2012-09-06 22:34:44 -0400] organicveggie: Logged out.
[2012-09-06 22:35:00 -0400] organicveggie: Then I wanted to double check whether or not chef-server was really sending legit responses.
[2012-09-06 22:35:13 -0400] organicveggie: So I logged back into the problem server, changed the hosts file and re-ran chef-client.
[2012-09-06 22:35:17 -0400] organicveggie: Now it works.
[2012-09-06 22:35:51 -0400] organicveggie: And now it broke.
[2012-09-06 22:36:36 -0400] organicveggie: After 3 successful chef-client runs, the 4th one failed.
[2012-09-06 23:14:39 -0400] tspencer: Hello chef people!  How can I set a node's environment without using knife or the client.rb file?  I'm hoping there's some way to say "chef-client -j foo.json" and have some json that will set it for me, but when I tried { "chef_environment": "develop" }, that didn't work.
[2012-09-06 23:16:54 -0400] yfeldblum: tspencer, you can use `--environment ENVIRONMENT` (or the `-E` shortcut) on the CLI
[2012-09-06 23:17:16 -0400] tspencer: Right, that sets it for that invocation, though, not for all time, right?
[2012-09-06 23:18:08 -0400] yfeldblum: tspencer, not sure
[2012-09-06 23:18:41 -0400] tspencer: I would like something that would essentially do a "knife node edit nodename" and then change the chef_environment in there.  Except just done one time, by chef-client.
[2012-09-06 23:19:05 -0400] yfeldblum: tspencer, https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/core/bootstrap_context.rb#L82-88
[2012-09-06 23:19:18 -0400] yfeldblum: tspencer, looks like it might set it permanently
[2012-09-06 23:20:31 -0400] tspencer: Hmm.  So how is that being run?
[2012-09-06 23:22:19 -0400] tspencer: Some background:  I have a script that sets up chef-client automatically on new nodes that are launched.  So I need these nodes to come up in the "base" role and in the "master" environment.
[2012-09-06 23:23:20 -0400] tspencer: I can set the role with chef-client -j foo.json, which contains { "run_list": [ "role[base]" ] }.
[2012-09-06 23:23:28 -0400] tspencer: But I can't seem to set the environment.
[2012-09-06 23:26:07 -0400] tspencer: Hmm.  I think I figured out a way to do it.
[2012-09-06 23:33:17 -0400] yfeldblum: tspencer, as i said, use `chef-client -j foo.json -E us-east-1` (or some other env name if you don't like us-east-1)
[2012-09-06 23:34:41 -0400] tspencer: Well, the problem with that is from then on, that node will be in the us-east-1 environment, unless I go change the cron job that runs chef-client on that node.
[2012-09-06 23:34:59 -0400] tspencer: I'd much rather that be set in the chef repo where it's easily centrally managed.
[2012-09-06 23:35:22 -0400] tspencer: s/chef repo/chef-server/
