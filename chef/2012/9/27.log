[2012-09-27 00:04:03 -0400] rava: rest easy all
[2012-09-27 00:04:19 -0400] _0x783czar: rava: later, thanks for the help
[2012-09-27 00:05:00 -0400] rava: don't think i was too helpful, but anytime :) . should have seen the imprints of homerow on my forhead a couple months back
[2012-09-27 00:18:24 -0400] justinlilly: With attributes like [:apache2][:listen_ports].. is it possible to append to it without having to set it?
[2012-09-27 00:19:01 -0400] justinlilly: blarg. nm.
[2012-09-27 00:19:04 -0400] xuru: justinlilly: yep
[2012-09-27 00:19:07 -0400] bluepojo: in your recipe you can
[2012-09-27 00:19:22 -0400] justinlilly: So I found a place in my project where I can do it via a role.
[2012-09-27 00:19:31 -0400] justinlilly: If I could do it in the recipe, that'd be better. How do I do that?
[2012-09-27 00:19:48 -0400] justinlilly: node[:apache2][:listen_ports].push("8090") ?
[2012-09-27 00:20:19 -0400] bluepojo: provided an array is in there, yeah
[2012-09-27 00:20:26 -0400] bluepojo: or you can do
[2012-09-27 00:21:01 -0400] xuru: ok, so I figured out that http_request action :head has been working all along, you just can't hook a notifies on it apparently...
[2012-09-27 00:21:11 -0400] bluepojo: node.set[:apache2][:listen_ports] = node[:apache2][:listen_ports] | node[:myapp_apache][:listen_ports]
[2012-09-27 00:22:07 -0400] bluepojo: xuru: it could be a definition
[2012-09-27 00:22:16 -0400] bluepojo: xuru: definitions don't have notifies
[2012-09-27 00:22:32 -0400] bluepojo: you'd need an LWRP for that
[2012-09-27 00:22:53 -0400] xuru: hmm   they list it as a resource here:  http://wiki.opscode.com/display/chef/Resources#Resources-HTTPRequest
[2012-09-27 00:23:24 -0400] bluepojo: oh
[2012-09-27 00:23:28 -0400] bluepojo: dunno then
[2012-09-27 00:24:02 -0400] xuru: shef is actually pretty useful
[2012-09-27 01:24:01 -0400] MaxMAx: Hi, can anyone help with that while running wordpress recipe: FATAL: Chef::Exceptions::Exec: package[libmysqlclient-dev] (mysql::client line 46) had an error: Chef::Exceptions::Exec: apt-get -q -y install libmysqlclient-dev=5.1.63-0ubuntu0.10.04.1 returned 100, expected 0
[2012-09-27 01:25:11 -0400] MaxMAx: I get this with an EC2 server (knife ec2 server create .... -r wordpress)
[2012-09-27 01:27:07 -0400] d2kagw: what happens when you SSH into the machine and run the apt-get command manually (my guess is the apt-get cache needs an update)
[2012-09-27 01:27:49 -0400] hoover_damm: ubuntu updates the mirrors constantly
[2012-09-27 01:27:58 -0400] hoover_damm: files are removed that have security issues
[2012-09-27 01:31:49 -0400] MaxMAx: i'm not too familiar with ec2. What's the easiest way to connect through SSH?
[2012-09-27 01:35:25 -0400] d2kagw: if you're using Knife then you can use the SSH command: http://wiki.opscode.com/display/chef/Knife+Built+In+Subcommands#KnifeBuiltInSubcommands-SSH
[2012-09-27 01:51:41 -0400] MaxMAx: d2kagw: it looks like I can't access this address from the server:http://us-east-1.ec2.archive.ubuntu.com/ubuntu/
[2012-09-27 01:52:16 -0400] MaxMAx: when I execute the apt-get on the server, i get 403 and 404 errors
[2012-09-27 02:01:34 -0400] MaxMAx: ok, it looks like running apt-get clean and then apt-get update before installing the package fixes the problem
[2012-09-27 02:01:56 -0400] MaxMAx: how/where should I insert this in the recipe?
[2012-09-27 02:02:57 -0400] d2kagw: I assumed that would be the issue - what recipe are you using? Most of the Opscode managed ones should be doing this automatically.
[2012-09-27 02:03:15 -0400] d2kagw: I'd start by making sure you're running the latest cookbook versions (especially the Apt cookbook)
[2012-09-27 02:04:11 -0400] MaxMAx: its the wordpress cookbook
[2012-09-27 02:04:38 -0400] d2kagw: does it depend on the apt cookbook?
[2012-09-27 02:04:50 -0400] d2kagw: (not familiar with the wordpress cookbook myself)
[2012-09-27 02:06:20 -0400] MaxMAx: I ran "knife cookbook download apt" and then "knife cookbook upload -a". is it enough?
[2012-09-27 02:07:43 -0400] d2kagw: unfortunately it's a little more complex
[2012-09-27 02:08:46 -0400] MaxMAx: no...i mean to get the latest version of apt recipe
[2012-09-27 02:09:30 -0400] d2kagw: there's a github repository that would have the latest version - wether that version has been pushed to the community site or not is another question
[2012-09-27 02:10:51 -0400] d2kagw: look at this repository: https://github.com/opscode-cookbooks/apt
[2012-09-27 02:11:18 -0400] d2kagw: if you include the default apt recipe in your role it should do an `apt-get update` for you if the cache is more than a day old
[2012-09-27 02:27:14 -0400] MaxMAx: thanks d2kagw, it works now...as you said, the apt recipe was missing in my run list
[2012-09-27 02:27:22 -0400] d2kagw: brillianbt
[2012-09-27 02:30:01 -0400] bluepojo: maxmanders: if your recipe requires that apt has run on the box, call include_recipe 'apt' in your recipe
[2012-09-27 02:30:08 -0400] bluepojo: don't use a run list like a dependency list
[2012-09-27 02:30:33 -0400] bluepojo: MaxMAx:
[2012-09-27 02:32:17 -0400] MaxMAx: bluepojo: I added a "base" role to my command, which include the apt recipe. but thanks for the hint?
[2012-09-27 02:32:20 -0400] MaxMAx: !
[2012-09-27 02:35:30 -0400] MaxMAx: another question: if I run a "knife ec2 server create ...-r myrecipe" and it fails somewhere in the recipe, how can I rerun the same recipe on the already created server (after fixing my recipe)?
[2012-09-27 03:25:20 -0400] ssd7: Ohai Chefs!
[2012-09-27 04:25:06 -0400] geekyogi: Has anyone tried to bootstrap RHEL ?
[2012-09-27 04:32:53 -0400] zts: geekyogi: almost certainly
[2012-09-27 04:33:16 -0400] geekyogi: @zts, can you provide me the bootstrap .erb file
[2012-09-27 04:33:31 -0400] geekyogi: for RHEL 6.x
[2012-09-27 04:34:20 -0400] zts: geekyogi: I would have thought that the default bootstrap (using omnibus/chef-full) should work okay - it has for me in the past on Centos
[2012-09-27 04:34:44 -0400] zts: geekyogi: what version of knife are you using, and what's the problem you're experiencing?
[2012-09-27 04:35:13 -0400] geekyogi: @zts, Unfortunately it doesn't work for me! I tried using the  CentOS bootstrap..
[2012-09-27 04:35:29 -0400] geekyogi: Let me check the knife version
[2012-09-27 04:36:40 -0400] geekyogi: 0.10.6
[2012-09-27 04:37:12 -0400] zts: geekyogi: okay, first I would suggest updating your knife - current versions default to the "chef-full" bootstrap, which is the "omnibus" installer
[2012-09-27 04:37:25 -0400] zts: geekyogi: that will install you everything you need for Chef (including ruby) under /opt/chef
[2012-09-27 04:37:37 -0400] zts: geekyogi: as long as you're happy with that approach, it should work fine for you on RHEL 6
[2012-09-27 04:37:41 -0400] geekyogi: @zts, Super cool
[2012-09-27 04:38:02 -0400] zts: if you try it and it doesn't work, please pastebin the errors you receive and we'll see if we can work it out :)
[2012-09-27 04:43:53 -0400] geekyogi: @zts, thanks :)
[2012-09-27 04:44:16 -0400] zts: no problem :)
[2012-09-27 04:56:24 -0400] Axsuul: Any way to make a recipe run last no matter where it's called in the run list?
[2012-09-27 04:58:37 -0400] Axsuul: Or rather.. execute this code at the end
[2012-09-27 04:59:01 -0400] Axsuul: A delayed recipe
[2012-09-27 04:59:49 -0400] Axsuul: I need this because I'm writing a cookbok for my dotfiles, and I need it to execute at the end to overwrite any dotfiles that may have been created from other cookbooks
[2012-09-27 05:06:34 -0400] josephholsten: Axsuul: you could have resource that you define with an action :none, then send it a delayed notification with another resource
[2012-09-27 05:07:59 -0400] josephholsten: but honestly, I've been considering a tail role to complement my base role
[2012-09-27 05:08:52 -0400] Axsuul: josephholsten: hmm yea that's probably better
[2012-09-27 05:12:03 -0400] Axsuul: josephholsten: but then again, I feel like ti belongs in base still
[2012-09-27 05:35:08 -0400] Axsuul: Is it more or does rbenv + ruby-build take forever?
[2012-09-27 07:40:52 -0400] swim: are you guys prepared for
[2012-09-27 07:41:31 -0400] swim: -=[ parakeet/budgeriger ]=-  5/98
[2012-09-27 07:41:33 -0400] swim:                      _..._
[2012-09-27 07:41:33 -0400] swim:                   .-'     '-.
[2012-09-27 07:41:34 -0400] swim:                  /     _    _\
[2012-09-27 07:41:34 -0400] swim:                 /':.  (o)  /__)
[2012-09-27 07:41:34 -0400] swim:                /':. .,_    |  |
[2012-09-27 07:41:54 -0400] swim:               |': ; /  \   /_/
[2012-09-27 07:41:54 -0400] swim:               /  ;  `"`"    }
[2012-09-27 07:41:54 -0400] swim:              ; ':.,         {
[2012-09-27 07:41:55 -0400] swim:             /      ;        }
[2012-09-27 07:41:55 -0400] swim:            ; '::.   ;\/\ /\ {
[2012-09-27 07:41:55 -0400] swim:           |.      ':. ;``"``\
[2012-09-27 07:41:55 -0400] swim:          / '::'::'    /      ;
[2012-09-27 07:41:55 -0400] swim:         |':::' '::'  /       |
[2012-09-27 07:41:56 -0400] swim:         \   '::' _.-`;       ;
[2012-09-27 07:41:59 -0400] swim:         /`-..--;` ;  |       |
[2012-09-27 07:42:01 -0400] swim:        ;  ;  ;  ;  ; |       |
[2012-09-27 07:42:04 -0400] swim:        ; ;  ;  ; ;  ;        /
[2012-09-27 07:42:06 -0400] swim:        |; ;  ;  ;  ;/       ;
[2012-09-27 07:42:09 -0400] swim:        | ;  ;  ; ; /       /        _,
[2012-09-27 07:42:12 -0400] swim:        |  ;   ;  /`      .'   _,==""
[2012-09-27 07:42:14 -0400] swim:        \;  ; ; .'. _  ,_'-.=~"  _.==~"
[2012-09-27 07:42:17 -0400] swim:        |  ;  .'`_~'-;--. ) )==~"
[2012-09-27 07:42:19 -0400] swim:        ; ; ;/`"(_`-,) )`=~`
[2012-09-27 07:42:22 -0400] swim:        /; ;/ /`  _.="`
[2012-09-27 07:42:24 -0400] swim:        |_/`| |  (
[2012-09-27 07:42:27 -0400] swim:        `   |_\   \
[2012-09-27 07:42:29 -0400] swim:     jgs ,="`      |
[2012-09-27 07:42:32 -0400] swim:            _,==";`
[2012-09-27 07:42:34 -0400] royh: very mature
[2012-09-27 07:42:35 -0400] swim:         =~"|;  ;|
[2012-09-27 07:42:37 -0400] swim:            | ;  |
[2012-09-27 07:42:40 -0400] swim:            |;|\ |
[2012-09-27 07:42:42 -0400] swim:            |/  \|
[2012-09-27 07:42:45 -0400] swim: rac rac rac rac rac rac rac rac rac rac rac rac rac rac rac rac rac rac
[2012-09-27 07:43:21 -0400] swim: so there is someone lurking in here
[2012-09-27 07:43:50 -0400] swim: hi royh
[2012-09-27 07:44:27 -0400] swim: Im sorry I did not mean to offend you, I only hope to educate people on the dangers of having parakeets
[2012-09-27 07:44:34 -0400] swim: they poke their heads out of trees
[2012-09-27 07:44:57 -0400] Mithrandir: you're being annoying, so please stop.
[2012-09-27 07:46:04 -0400] swim: awwwww
[2012-09-27 07:46:15 -0400] swim: I'm sorry
[2012-09-27 07:46:21 -0400] swim: me so sorry
[2012-09-27 07:46:23 -0400] swim: lolololol
[2012-09-27 08:45:22 -0400] gyre007: is there any general Rack app cookbook ?
[2012-09-27 09:15:03 -0400] zts: I think I'm going crazy.. I have template[/etc/postgresql/9.1/main/pg_hba.conf] declared twice (in two separate recipes)
[2012-09-27 09:15:18 -0400] zts: it is being written out twice
[2012-09-27 09:16:43 -0400] zts: Is this expected behaviour on 10.14.2?
[2012-09-27 09:18:06 -0400] zts: Additional context:  I'm declaring the template a second time so that I can override the source parameter without modifying the original recipe.
[2012-09-27 09:18:49 -0400] zts: What I expected: the two resource definitions would be merged, and the merged resource converged once
[2012-09-27 09:21:04 -0400] zeroXten: does _default in env_run_list override run_list for role?
[2012-09-27 09:21:28 -0400] zeroXten: or is it basically run_list OR env_run_list, pick one
[2012-09-27 09:22:31 -0400] zts: zeroXten: last time I used it, it was the latter (if you use env_run_list, it had to have a _default key, and the role's run_list was ignored)
[2012-09-27 09:23:02 -0400] zts: but that was on 0.10.6, so you probably shouldn't take my word for it
[2012-09-27 09:24:48 -0400] zeroXten: ah, so I can't add something to run_list that would get applied to all envs?
[2012-09-27 09:25:57 -0400] zeroXten: mind you, the example json on the roles page specifies both
[2012-09-27 09:26:31 -0400] zts: Not in my recollection... one question immediately springs to mind: where would the extra items go?  Start of the env_run_list?  Or the end?  etc
[2012-09-27 09:29:15 -0400] zeroXten: wouldn't it just process them in order?
[2012-09-27 09:29:37 -0400] zts: http://lists.opscode.com/sympa/arc/chef/2012-04/msg00359.html <- that might be a good solution, if you use the ruby DSL to specify your roles
[2012-09-27 09:30:04 -0400] zeroXten: e.g. run_list = ( "recipe[screen]" ) env_run_list = ( "staging" => "recipe[man]", "_default" => [] )
[2012-09-27 09:30:15 -0400] zeroXten: k, reading it now
[2012-09-27 09:30:48 -0400] zts: in that example, if you were in the staging environment, would it do recipe[man] before recipe[screen], or the other way around?
[2012-09-27 09:31:07 -0400] zeroXten: i would expect recipe screen before man
[2012-09-27 09:31:24 -0400] zeroXten: because run_list came first
[2012-09-27 09:31:37 -0400] zts: but env_run_list is alphabetically earlier, so perhaps it should be first? :)
[2012-09-27 09:31:47 -0400] zeroXten: heh na
[2012-09-27 09:32:28 -0400] zeroXten: i presume it is effectively just pushing onto an ordered array, so whatever comes first comes first
[2012-09-27 09:32:30 -0400] zts: that section of the Roles page really needs an update though
[2012-09-27 09:32:42 -0400] zts: it's not very clear about what behaviour to expect
[2012-09-27 09:32:49 -0400] zeroXten: yeah, i noticed that the wiki seems to not document edge cases very well in places
[2012-09-27 09:32:52 -0400] zeroXten: quite
[2012-09-27 09:33:09 -0400] zeroXten: also, in that link, he didn't specify the required "_default"
[2012-09-27 09:33:10 -0400] zeroXten: :(
[2012-09-27 09:34:41 -0400] zts: If you've got a little bit of time, perhaps you could update the wiki docs to be a little clearer? :)
[2012-09-27 09:37:21 -0400] zeroXten: yeah, once i've worked out the answer ;) I'm just gonna test it and see what happens
[2012-09-27 09:41:38 -0400] zts: Often the best plan :)
[2012-09-27 10:04:23 -0400] thehenster: Hi all, I'm attempting to create an ec2 server with the knife command. I'm getting the following error..
[2012-09-27 10:04:36 -0400] thehenster: ERROR: Excon::Errors::SocketError: hostname was not match with the server certificate
[2012-09-27 10:05:31 -0400] thehenster: The following command created that error..
[2012-09-27 10:05:31 -0400] thehenster: knife ec2 server create -r 'role[webserver]' -I ami-5d474129 -f m1.small --region eu-west-1b
[2012-09-27 10:08:36 -0400] thehenster: Is there a log/something that I could post to make my problem clearer? I've searched for it and can't find anything..
[2012-09-27 10:20:11 -0400] erthad: hi all
[2012-09-27 10:33:03 -0400] zeroXten: zts: didn't even have to test, knife shows the run_list is empty
[2012-09-27 10:39:40 -0400] erthad: where are cookbooks stored on chef server? is it possible to tweak them without using knife nor webui?
[2012-09-27 10:40:57 -0400] erthad: `find / -name default.rb` on the chef server produces nothing relevant :-\
[2012-09-27 10:44:17 -0400] jonlives: erthad: they're stored in CouchDB
[2012-09-27 10:44:33 -0400] zeroXten: i have to keep telling myself that chef != puppet ;)
[2012-09-27 10:48:44 -0400] erthad: jonlives: thx, I suspected that
[2012-09-27 10:50:23 -0400] jonlives: erthad: out of curiosity, why do you want to tweak them without using knife or the web-ui?
[2012-09-27 10:51:40 -0400] erthad: jonlives: I don't know yet, I'm just trying chef after using puppet and investigate how the things work in chef
[2012-09-27 10:52:10 -0400] jonlives: erthad: ah fair enough :) knife is generally the way to interface with chef, unless you particularly like point and click :p
[2012-09-27 10:53:20 -0400] erthad: e.g. I though the chef-repo could be found in the place where the cookbooks are stored ;-)
[2012-09-27 10:54:30 -0400] erthad: jonlives: I particularly like in-place edits however OpsCode team seem to have worked hard to prevent us from doing that but use a better way instead =)
[2012-09-27 10:54:58 -0400] jonlives: erthad: yeah it's a slightly different model to puppet. typical model is to keep all of your cookbooks etc in git, and use knife to upload them to chef.
[2012-09-27 10:55:46 -0400] erthad: jonlives: in puppet we've used the similar model but had to invent our own tools to upload manifests to master etc
[2012-09-27 10:57:59 -0400] erthad: anyway I seem to like the way things are set up by default in chef after having to spend a day or more when I needed to get up new puppetmaster with dashboard, hiera and so on
[2012-09-27 10:58:21 -0400] jonlives: ah good good!
[2012-09-27 12:26:22 -0400] leifmadsen: morning all! We have a webapp that has database updates (either data changes in the base tables, or schema changes to the system as we add new features). I'm curious what people do to handle that with chef? We want to be able to go forward and backward with regards to versions, and am unfamiliar with how this typically works in deployments (or even just in general).
[2012-09-27 12:26:43 -0400] joris_: Good morning/afternoon all
[2012-09-27 12:26:58 -0400] joris_: I have a question regarding the Windows chef-client
[2012-09-27 12:27:20 -0400] joris_: I am trying to get an unattended install of the chef-client msi but can't get it working
[2012-09-27 12:27:39 -0400] joris_: Anyone figured out how to do that?
[2012-09-27 12:37:26 -0400] yfeldblum: leifmadsen, why would you handle that with chef?
[2012-09-27 12:37:43 -0400] leifmadsen: well it doesn't need to be chef that handles it, but it needs to be done by something
[2012-09-27 12:37:51 -0400] leifmadsen: and chef is the trigger
[2012-09-27 12:37:52 -0400] yfeldblum: leifmadsen, more to the point - why are the infra ops people doing that rather than the app devs or app ops people?
[2012-09-27 12:38:10 -0400] leifmadsen: someone has to do it
[2012-09-27 12:38:48 -0400] leifmadsen: a deployment of the application still needs to happen to lots of servers, and the database needs to be updated to fix that, so someone must have solved that problem before
[2012-09-27 12:39:29 -0400] jonlives: leifmadsen: in our case, we handle config management and code / database change deploys seperately.
[2012-09-27 12:39:55 -0400] leifmadsen: jonlives: how so though? do you write bash scripts and deploy them yourself?
[2012-09-27 12:40:05 -0400] jonlives: leifmadsen: nope, we use https://github.com/etsy/deployinator for our deploys
[2012-09-27 12:40:15 -0400] jonlives: and have another tool for handing schema changes and the like
[2012-09-27 12:40:39 -0400] yfeldblum: leifmadsen, i like the heroku approach: http://www.12factor.net/admin-processes
[2012-09-27 12:40:48 -0400] leifmadsen: I suspect it's not chef doing the database management and it's another tool, but the servers are provisioned via chef, so when it runs again and needs to do an upgrade, something must get triggered to handle it
[2012-09-27 12:41:24 -0400] jonlives: leifmadsen: by upgrade, you mean a migration or a schema change?
[2012-09-27 12:41:30 -0400] leifmadsen: right
[2012-09-27 12:41:36 -0400] leifmadsen: copying of the php files is easy :)
[2012-09-27 12:42:17 -0400] jonlives: so in our case, the servers are provisioned by chef, but chef does not deploy code or touch the databases themselves.
[2012-09-27 12:43:20 -0400] leifmadsen: jonlives: right, and that's fine, and you've pointed out a tool that you use outside of that, which is kind of what I'm looking for. I assume people who deploy webapp servers via chef have methods they've used to deploy their webapp itself and to do database schema updates/migrations
[2012-09-27 12:43:30 -0400] leifmadsen: along with ability to create development environments etc
[2012-09-27 12:43:58 -0400] jonlives: leifmadsen: unfortunately our schema change tool isn't open sourced yet, being a fairly recent addition
[2012-09-27 12:44:01 -0400] leifmadsen: and frankly I don't trust our app ops department to pick a tool that does anything automatically or sanely
[2012-09-27 12:44:07 -0400] jonlives: but deployinator is what we use for out code deploys.
[2012-09-27 12:44:37 -0400] leifmadsen: jonlives: gotcha, thanks. Ya the code itself is pretty much just a sync of a git repo, so that's pretty straight forward, but the changes to database are the tricky part
[2012-09-27 12:45:07 -0400] jonlives: right
[2012-09-27 12:45:19 -0400] jonlives: leifmadsen: I'd cautionm against doing them automatically as a rule anyway
[2012-09-27 12:45:42 -0400] jonlives: leifmadsen: good post: http://www.kitchensoap.com/2012/09/21/a-mature-role-for-automation-part-i/
[2012-09-27 12:45:50 -0400] leifmadsen: ya I read that yesterday
[2012-09-27 12:46:10 -0400] leifmadsen: I still want to abstract the sticky fingers of web developers from running commands on the machines
[2012-09-27 12:46:11 -0400] gchristensen: oy I would pick a different tool for deploys, like capistrano
[2012-09-27 12:46:21 -0400] jonlives: whatever tool works really
[2012-09-27 12:47:37 -0400] jonlives: leifmadsen: in our case for example, we automate a lot, but schema changes are always manually triggered and chef never handles restarts of "core" services for example.
[2012-09-27 12:48:20 -0400] leifmadsen: jonlives: right that's fine I suppose, as long as things are scripted in a sane manner that is easily portable across multiple boxes
[2012-09-27 12:48:29 -0400] jonlives: leifmadsen: of course
[2012-09-27 12:48:39 -0400] leifmadsen: jonlives: ya, we deploy asterisk, so we can't have it do restarts willy nilly either :)
[2012-09-27 12:48:44 -0400] jonlives: leifmadsen: deployinator helps us there
[2012-09-27 12:49:20 -0400] jonlives: ops actually have zero to do with code deploys at Etsy, the devs do it all themselves using deployinator, and they don't have to log onto the servers to do it.
[2012-09-27 12:50:15 -0400] leifmadsen: jonlives: excellent :)  for years before I showed up all the upgrades were done using a custom script each time, then ran manually, and only got ran against production whenever it was time to go :)
[2012-09-27 12:50:34 -0400] jonlives: leifmadsen: I feel your pain, been there too
[2012-09-27 12:50:37 -0400] leifmadsen: I'm trying to get into a situation where we can at least easily reproduce the production environment and execute upgrade processes in a test environment first :D
[2012-09-27 12:51:11 -0400] jonlives: leifmadsen: so in our case we have a staging environment which still points at the live data but isn't public facing. so code goes from dev's vm -> staging -> prod
[2012-09-27 12:51:53 -0400] jonlives: stuff still slips through, ie stuff that only appears with prod traffic volumes, but it works pretty well.
[2012-09-27 12:52:03 -0400] leifmadsen: jonlives: nice, that's the work flow we're working on as well. Multiple stages and ability to essentially work with the live data without screwing with it :)
[2012-09-27 12:52:10 -0400] jonlives: staging and prod servers are identical in every way, just staging doesn't get traffic from t'webs.
[2012-09-27 12:52:24 -0400] leifmadsen: jonlives: ya that happens everywhere -- test with 3 people works fine, test with 300 omgwhathappened?!
[2012-09-27 12:52:32 -0400] leifmadsen: jonlives: nice, I like that
[2012-09-27 12:52:33 -0400] jonlives: right
[2012-09-27 12:53:01 -0400] jonlives: leifmadsen: i'd caution against having staging be cheaper hardware etc etc like so often happens...should be as close to prod as humanly possible.
[2012-09-27 12:53:39 -0400] leifmadsen: jonlives: ya I think that's the plan. We're also looking at moving some infrastructure into openstack or other cloud infrastructure, so it'll all look the same (or can look the same)
[2012-09-27 12:53:47 -0400] jonlives: yeah
[2012-09-27 12:57:02 -0400] leifmadsen: jonlives: thank for the chat -- that gives me some ideas. Basically it'll be, "hey apps ops! do whatever you want to do the schema changes, as long as they work against this base deploy and existing deploys"
[2012-09-27 12:57:10 -0400] jonlives: leifmadsen: np :)
[2012-09-27 12:59:31 -0400] yfeldblum: leifmadsen, yep, the db schema and its evolution ought to belong to the app, and therefore to the app devs and ops (if they're different people instead of different hats on the same people, then they can figure out who does what)
[2012-09-27 12:59:53 -0400] yfeldblum: leifmadsen, all you gotta do w.r.t. the infrastructure is make it so they have the ability to do that work
[2012-09-27 13:00:24 -0400] leifmadsen: yfeldblum: gotcha, makes sense. I just want to provide some sane solutions to the apps people though or they're going to end up writing messy custom scripts each time
[2012-09-27 13:00:35 -0400] leifmadsen: probably trying to handhold too much, but I've seen this story play out before
[2012-09-27 13:01:16 -0400] yfeldblum: leifmadsen, they should probably try to ensure that the latest app code can work with v_n of the db schema but also work with v_(n-1) of the db schema so that they can deploy the app and then run the migration without downtime
[2012-09-27 13:01:52 -0400] yfeldblum: leifmadsen, deploy copies of the production db & app to an isolated environment and let the app ops do the upgrade and migration there in a test run?
[2012-09-27 13:02:30 -0400] leifmadsen: yfeldblum: yep that's pretty much the idea I'm thinking as well -- deploy a dev environment, import prod data, execute upgrade, verify it works
[2012-09-27 13:02:42 -0400] leifmadsen: at least things are reproducible
[2012-09-27 13:04:41 -0400] yfeldblum: leifmadsen, mhmm
[2012-09-27 13:04:57 -0400] leifmadsen: yfeldblum: thanks -- passing some of this data onto apps as well so they can create a game plan
[2012-09-27 13:05:20 -0400] yfeldblum: leifmadsen, cool
[2012-09-27 13:05:25 -0400] yfeldblum: leifmadsen, is it a php app?
[2012-09-27 13:05:27 -0400] leifmadsen: I'll come back if I run into any specific questions :)
[2012-09-27 13:05:32 -0400] leifmadsen: yfeldblum: ya, php+mysql
[2012-09-27 13:05:47 -0400] leifmadsen: laamp deployment (the extra a == asterisk)
[2012-09-27 13:11:50 -0400] yfeldblum: leifmadsen, what's asterisk?
[2012-09-27 13:12:02 -0400] leifmadsen: yfeldblum: open source pbx platform
[2012-09-27 13:12:11 -0400] leifmadsen: yfeldblum: asteriskdocs.org if you're interested
[2012-09-27 13:13:12 -0400] yfeldblum: leifmadsen, gotcha
[2012-09-27 13:15:56 -0400] anentropic: I have a Provisioning with Vagrant and Chef Server I am getting a problem where ".example.org" is getting tacked on to the end of my hostname, but only sometimes! being used as the name of the generated chef node and chef client... the vm then gets confused because sometimes it looks to a node with the wrong name for attribute values
[2012-09-27 13:16:08 -0400] anentropic: "I have a problem provisioning"
[2012-09-27 13:16:36 -0400] anentropic: I just posted as an issue to Vagrant https://github.com/mitchellh/vagrant/issues/1161
[2012-09-27 13:17:09 -0400] anentropic: ...but I think it is maybe a Chef problem as I can't find "example.org" in the Vagrant source code, only in Chef
[2012-09-27 13:20:10 -0400] anentropic: and only in the chef/spec/ files
[2012-09-27 13:22:58 -0400] anentropic: I got the impression they were just tests though, rather than the executable chef code
[2012-09-27 13:23:00 -0400] anentropic: ?
[2012-09-27 13:24:11 -0400] anentropic: I don't have "example.org" in any of my own code
[2012-09-27 13:24:29 -0400] rocket: example.org in any roles or attributes?
[2012-09-27 13:24:52 -0400] anentropic: nowhere in my kitchen
[2012-09-27 13:26:05 -0400] anentropic: the github issue has more details
[2012-09-27 13:29:57 -0400] railsraider: Hi I have a few mysql machines (~20) i need to override the chef-client interval on all of them so they can start pulling updates
[2012-09-27 13:30:27 -0400] railsraider: how can i edit the whole nodes with knife?
[2012-09-27 13:35:45 -0400] zeroXten: i think i'm missing something obvious, so I've got a uber dumb question. Node attributes. Where should they go? Do I have to some how get a json file onto the server, or can something be done using knife?
[2012-09-27 13:36:11 -0400] sunil__: @railsraider are you using a role to manage mysql machines?
[2012-09-27 13:36:20 -0400] railsraider: yes
[2012-09-27 13:37:24 -0400] anentropic: zeroXten: http://wiki.opscode.com/display/chef/Managing+Nodes+With+Knife#ManagingNodesWithKnife-EditinganodewithKnife
[2012-09-27 13:37:24 -0400] railsraider: in one of my recipes i do this:   search(:node, "roles:mysql AND chef_environment:production") do |matching_node|
[2012-09-27 13:37:36 -0400] railsraider: i have this page open
[2012-09-27 13:37:55 -0400] railsraider: i need to get all nodes and edit the chef-run interval on each
[2012-09-27 13:38:34 -0400] yfeldblum: railsraider, bad idea
[2012-09-27 13:38:50 -0400] railsraider: yfeldblum: what's the best way to do that?
[2012-09-27 13:39:09 -0400] railsraider: i can always do a bash script with ssh to each that run's the chef-client
[2012-09-27 13:39:40 -0400] yfeldblum: railsraider, one chef-client should modify its own node data, but not the node data of other nodes
[2012-09-27 13:43:49 -0400] maxmanders: How does a local chef-client 'know' whether a recipe has changed, and to reapply it?  E.g. I had a syntax error, fixed the error and uploaded the cookbook.  Ran chef client on the node but an error is still being reported about the (now fixed) syntax error.
[2012-09-27 13:45:03 -0400] jonlives: maxmanders: are you using environments with version constraints?
[2012-09-27 13:45:06 -0400] masterkorp: Can i override a default attribute on a node with knife ?
[2012-09-27 13:45:47 -0400] balboah: Is this normal? http://pastebin.com/eKqS6E1b
[2012-09-27 13:46:03 -0400] maxmanders: I am using an environment, but couldn't say about version constraints - I've just started the job and am diving in at the deep end :-)
[2012-09-27 13:47:12 -0400] jonlives: maxmanders: do "knife environment show environmentname"
[2012-09-27 13:47:39 -0400] maxmanders: Yup - what am I looking for
[2012-09-27 13:47:48 -0400] jonlives: maxmanders: the name of the cookbook you're having issues with :)
[2012-09-27 13:47:57 -0400] jonlives: that command will show if there's any version constraint for that cookbook
[2012-09-27 13:48:19 -0400] rocket: has anyone got a cookbook that will install mysql 5.5 on centos6?
[2012-09-27 13:49:02 -0400] maxmanders: jonlives: well there don't appear to be... so absent any version constraints - should I just delete the local chef cache to force the client to fetch new copies of the cookbooks
[2012-09-27 13:49:57 -0400] jonlives: maxmanders: you don't see anything under the cookbook_versions section of the output?
[2012-09-27 13:50:25 -0400] jonlives: maxmanders: you shouldn't need to delete the local cache, it'll pick up changes automatically. that's why I'm suspecting something else is going on
[2012-09-27 13:52:00 -0400] masterkorp: INFO: template[/etc/nagios/nrpe.cfg] sending restart action to service[nagios-nrpe-server] (delayed)
[2012-09-27 13:52:19 -0400] masterkorp: does delayed mean that the services was not actually restarted ?
[2012-09-27 13:52:30 -0400] rep0st: any chef xenserver vm provisioners here?
[2012-09-27 13:52:38 -0400] Loof: Bah... I updated to 10.14.2 and still having trouble /w windows instances... The ec2 ohai plugin takes more than 5 minutes to run (just to get the ec2 metadata) and windows nodes don't show up properly in knife search node...
[2012-09-27 13:54:29 -0400] alexbst: HTTP Request Returned 409 Conflict: Client already exists.
[2012-09-27 13:54:31 -0400] gyre007: is there any rack application cookbook  I'm not aware of  guys?
[2012-09-27 13:54:38 -0400] alexbst: followed by a HTTP Request Returned 403 Forbidden: Merb::ControllerExceptions::Forbidden
[2012-09-27 13:54:42 -0400] alexbst: (there was no client.pem)
[2012-09-27 13:54:44 -0400] alexbst: any ideas ?
[2012-09-27 13:55:30 -0400] alexbst: if I put the client.pem there, I get a 401 :)
[2012-09-27 14:05:43 -0400] Loof: Well, I fixed the knife search issue... I made the solr maxfieldlength much bigger
[2012-09-27 14:05:53 -0400] Loof: I know I tried that before... but I didn't make it _HUGE_ just bigger
[2012-09-27 14:06:15 -0400] Loof: This time I went /w the comment on JIRA and tada... search works
[2012-09-27 14:06:16 -0400] Loof: bah
[2012-09-27 14:07:15 -0400] jmartin: Loof: believe in the JIRA of the lamp! phenomenal cosmic powers! itty bitty living space
[2012-09-27 14:07:34 -0400] gchristensen: haha yes
[2012-09-27 14:09:24 -0400] Loof: I wish for my windows chef runs to take less than 10 mins for 2 very short recipies :P
[2012-09-27 14:10:08 -0400] Loof: Bah
[2012-09-27 14:10:18 -0400] Loof: Now my winsw based service is failing to start
[2012-09-27 14:10:21 -0400] Loof: Yay, progress :P
[2012-09-27 14:10:55 -0400] Loof: Anyone have much experience auto-scaling /w chef on EC2... I've found a number of blog posts, but it might be nice to pick someone's brain who has actually done it :)
[2012-09-27 14:14:28 -0400] benoitbb: Hello
[2012-09-27 14:14:29 -0400] benoitbb: are there "static" links for omnibus? I mean "not the latest" equivalent of http://opscode.com/chef/install.sh which I can make sure the SHA1 is the one I expect?
[2012-09-27 14:15:41 -0400] jmartin: http://www.opscode.com/chef/install/ possibly pick your OS here and below there are some packages like RPMs?
[2012-09-27 14:15:55 -0400] jmartin: and/or debs
[2012-09-27 14:19:23 -0400] benoitbb: ok, so I suppose I can't use install.sh to install a specific version of chef on several OS (i.e. a Debian, a Fedora, ...)
[2012-09-27 14:19:40 -0400] jmartin: oh i have no idea
[2012-09-27 14:19:52 -0400] jmartin: twas just a suggestion by me
[2012-09-27 14:20:28 -0400] benoitbb: and the suggestion helps me ;)
[2012-09-27 14:20:50 -0400] benoitbb: but I liked the OS detection in install.sh
[2012-09-27 14:24:19 -0400] maxmanders: jonlives: sorry, I got sidetracked with something else - thanks for your points, I'll do some digging using this as a starting point - better to learn by doing :-)
[2012-09-27 14:24:31 -0400] jonlives: maxmanders: np :)
[2012-09-27 14:24:52 -0400] masterkorp: Can i override a default attribute on a node with knife ?
[2012-09-27 14:51:17 -0400] erthad: whe I need to apply certain recipes to all my nodes what is the best place to put those?
[2012-09-27 14:52:10 -0400] gchristensen: I usually have a base role that all other roles extend
[2012-09-27 14:53:38 -0400] erthad: thx
[2012-09-27 14:57:40 -0400] patcon: hey guys, i think this is more a ruby question, but anyone know how i would use the find() function for the resource collection to add a condition to a "notifies" resource attr?
[2012-09-27 14:58:15 -0400] patcon: https://github.com/opscode/chef/blob/master/chef/lib/chef/resource_collection.rb#L132-147
[2012-09-27 14:59:04 -0400] patcon: like `notifies :restart, "service[varnish]" if ::Chef::ResourceCollection.find("service[varnish]")
[2012-09-27 15:03:42 -0400] yfeldblum: patcon, is the service[varnish] resource already declared by the time you want to declare this notification?
[2012-09-27 15:07:04 -0400] balboah: how come knife cookbook site install fails if you remove a cookbook through git rebase and then try to re-install it? says it can't read metadata.rb
[2012-09-27 15:10:40 -0400] j|: looking at bootstrap templates, there is a curious idiom of using 'awk NF <file> > <new_file>'
[2012-09-27 15:11:12 -0400] j|: I was just curious as to why this seems to be the standard way to copy a file within a bootstrap script
[2012-09-27 15:14:23 -0400] zeroXten: rah! file system: "data_bags". Knife command "data bag". WHY U NO USE underscore
[2012-09-27 15:14:45 -0400] mattray: zeroXten: don't they both work?
[2012-09-27 15:14:50 -0400] patcon: yfeldblum: ah sorry, missed the tray jumping. yep, this is like the very last recipe :)
[2012-09-27 15:14:52 -0400] mattray: well, at least the knife command
[2012-09-27 15:15:03 -0400] zeroXten: knife data_bag --help diesn't seems to show all help
[2012-09-27 15:15:03 -0400] patcon: yfeldblum: i say that it's probably my ruby because i get this:
[2012-09-27 15:15:14 -0400] zeroXten: knife data bag --help shows only data bag stuff
[2012-09-27 15:15:20 -0400] patcon: yfeldblum: > [Thu, 27 Sep 2012 17:13:59 +0200] FATAL: NoMethodError: undefined method `find' for Chef::ResourceCollection:Class
[2012-09-27 15:15:30 -0400] zeroXten: but, i havent' tried an upload yet
[2012-09-27 15:16:24 -0400] zeroXten: i'll give it whirl
[2012-09-27 15:18:24 -0400] drnfx: is there a way to execute a specific recipe on a server? Not modifying the run list?
[2012-09-27 15:21:54 -0400] rocket: mattray: do you know if there are any cookbooks that will install mysql 5.5 on centos6?
[2012-09-27 15:22:11 -0400] mattray: rocket: mysql cookbook doesn't work?
[2012-09-27 15:22:12 -0400] zeroXten: oh come on. /^[\-[:alnum:]_]+$/ means I can't use a FQDN as an id :(
[2012-09-27 15:22:28 -0400] rocket: mattray: it uses yum repos I believe
[2012-09-27 15:22:32 -0400] rocket: I will double check it
[2012-09-27 15:22:40 -0400] yfeldblum: patcon, do you just want to always restart varnish?
[2012-09-27 15:24:05 -0400] patcon: yfeldblum: haha hm. you're right. that would def work! it's pretty quick to do, and i don't think it flushes anything... (it's for a local vagrant dev env)
[2012-09-27 15:24:40 -0400] yfeldblum: patcon, http://pastie.org/private/hy4ylqvikeur5vrg8nkeg
[2012-09-27 15:28:31 -0400] patcon: ahhh. thanks yfeldblum! :)
[2012-09-27 15:28:35 -0400] jtimberman: drnfx: chef-client -o
[2012-09-27 15:29:09 -0400] jtimberman: zeroXten: i believe its because the id of a data bag is used in the URL
[2012-09-27 15:29:41 -0400] jtimberman: yeah, e.g.: DEBUG: Sending HTTP Request via GET to api.opscode.com:443/organizations/MYORG/data/users/jtimberman
[2012-09-27 15:29:49 -0400] sunil__: I have yet another question on supervisor cookbook..sorry I am still a newbie to chef..do you generally add the program definitions into supervisor.default.erb or create a serrate file with list of program definitions and include it in the recipe?  In other words, the celery example in the opscode supervisor cookbook, where is that defined?
[2012-09-27 15:30:22 -0400] jtimberman: or, DEBUG: Sending HTTP Request via GET to api.opscode.com:443/organizations/MYORG/data/dns/int_MYDOMAIN_org
[2012-09-27 15:30:39 -0400] jtimberman: otherwise i would have used int.MYDOMAIN.org for the data bag name.
[2012-09-27 15:31:48 -0400] erthad: is there a way to reconstruct the data passed from server to chef client after the client run is finished? in other words: is data cached anywhere on the node (apart from cookbooks)?
[2012-09-27 15:33:29 -0400] zeroXten: ahh heh jtimberman
[2012-09-27 15:33:49 -0400] jtimberman: so yeah its annoying.
[2012-09-27 15:34:19 -0400] zeroXten: i'll set the id to s/./_/g and add hostname as a key
[2012-09-27 15:34:20 -0400] jtimberman: which is why djbdns::internal_server, e.g., has this: dns = data_bag_item("dns", node[:djbdns][:domain].gsub(/\./, "_"))
[2012-09-27 15:34:30 -0400] zeroXten: hehe
[2012-09-27 15:34:42 -0400] jtimberman: (sounds like that is relevant to your interests)
[2012-09-27 15:35:00 -0400] zeroXten: let me guess, api framework trying to do something clever with last .
[2012-09-27 15:35:11 -0400] zeroXten: cool, thanks jtimberman
[2012-09-27 15:37:06 -0400] yfeldblum: jtimberman, is there an automatic encoding scheme for encoding names such that, in encoded form, they can be used as part of http resource names?
[2012-09-27 15:37:26 -0400] yfeldblum: jtimberman, e.g. for encoding data-bag-item names
[2012-09-27 15:38:06 -0400] yfeldblum: jtimberman, and i don't mean uri-encode-component, i mean the bit before that
[2012-09-27 15:38:11 -0400] yfeldblum: jtimberman, or is that not necessary?
[2012-09-27 15:38:48 -0400] patcon: still testing, but i don't think that worked yfeldblum: when you mention `resources(:service => "varnish")`, it always seems to throw:
[2012-09-27 15:38:51 -0400] patcon: > Cannot find a resource matching service[varnish] (did you define it first?)
[2012-09-27 15:39:20 -0400] patcon: but I wrapped the `notifies` in `if "service[varnish]".kind_of?(Chef::Resource)` and that might be working
[2012-09-27 15:39:22 -0400] patcon: need to test more
[2012-09-27 15:39:45 -0400] yfeldblum: patcon, an instance of String will absolutely never also be kind_of Chef::Resource ...
[2012-09-27 15:40:22 -0400] yfeldblum: patcon, if it throws, then that means there is no such resource with that type and that name
[2012-09-27 15:40:57 -0400] patcon: yfeldblum: ah, you're right. read this too quickly :) https://github.com/opscode/chef/blob/master/chef/lib/chef/resource_collection.rb#L106-110
[2012-09-27 15:42:06 -0400] yfeldblum: patcon, also do you really need to notify? or do you just need to make sure it restarts?
[2012-09-27 15:42:09 -0400] jtimberman: patcon: you want: notifies :action, "resource[name]", e.g., notifies :restart, "service[varnish]"
[2012-09-27 15:42:22 -0400] jtimberman: in order to not have to define the resource before the one notifying it
[2012-09-27 15:43:02 -0400] patcon: yfeldblum: no, you're right, i don't mind it running. i just went back to the drawing board when your pastie didn't work (but it gave me leads to chase)
[2012-09-27 15:45:27 -0400] patcon: sorry jtimberman? to clarfy, im trying to have one recipe that will restart varnish if varnish cookbook is there, but ignore if there's no varnish (creating local env where varnish can be added or removed from run_list)
[2012-09-27 15:47:20 -0400] jtimberman: perhaps, node['recipes'].include?("varnish")
[2012-09-27 15:47:59 -0400] yfeldblum: jtimberman, ew
[2012-09-27 15:48:45 -0400] patcon: haha, i suppose that would technically work ... :)
[2012-09-27 15:50:12 -0400] rocket: jtimberman: is there a doc somewhere on using site-cookbooks and how they work to override default cookbooks etc?
[2012-09-27 15:50:16 -0400] patcon: jtimberman: i honestly hadn't thought of that, so thanks! and thanks very much yfeldblum :)
[2012-09-27 15:51:02 -0400] yfeldblum: patcon, http://pastie.org/private/fqerckcdha7hhu7fue4aw
[2012-09-27 15:51:12 -0400] yfeldblum: rocket, yes: don't
[2012-09-27 15:51:31 -0400] yfeldblum: rocket, it's deprecated and will be removed, so the docs are: don't do it
[2012-09-27 15:51:41 -0400] rocket: yfeldblum: good to know :p
[2012-09-27 15:52:03 -0400] rocket: is the current strategy just to fork git repos etc?
[2012-09-27 15:52:20 -0400] jtimberman: specifically the overriding a cookbook in cookbooks with one in site-cookbooks is deprecated.
[2012-09-27 15:52:32 -0400] jtimberman: having multiple directories in the cookbook_path is ok.
[2012-09-27 15:52:40 -0400] jtimberman: i don't believe there are plans to change that.
[2012-09-27 15:52:49 -0400] drnfx: jtimberman, thank you. worked like a charm.
[2012-09-27 15:53:20 -0400] rocket: jtimberman: ok I am already doing that .. so keep doing what I am doing then .. :p
[2012-09-27 15:53:26 -0400] jtimberman: :)
[2012-09-27 15:53:29 -0400] patcon: jtimberman: oh and psssst. Went to a working group in Ottawa yesterday. Government of Canada is 1) interested in standardizing on the Drupal CMS, 2) Interesting in standardizing all gov Drupal dev on a comon Vagrant dev environment (http://github.com/myplanetdigital/ariadne), and so 3) potentially a bunch of government devs getting their hands dirty in chef. So government ops might start feeling the pressure to keep up and accomodate :)
[2012-09-27 15:53:44 -0400] jtimberman: patcon: nice ;)
[2012-09-27 15:54:49 -0400] patcon: jtimberman: not all official. but the drupal initiative is. and there are ppl internally pushing to have vagrant and vbox approved for all government workstations. all the above is becoming progressively more official, i feel
[2012-09-27 15:56:13 -0400] patcon: jtimberman: anyhow, not sure how much opscode evangelizes to gov, but the canadian project is working closely with us gov counterparts too. the drupal CMS framework is being developed from the ground up publicly on github, and that's a first for both countries. chance to showcase benefits of opensource mentality
[2012-09-27 15:59:00 -0400] patcon: yfeldblum: wha. that's rad. i always learn something when I talk to you. you're probably half the reason I've dug into chef's insides even as much as I have
[2012-09-27 16:05:37 -0400] masterkorp: How do i run a knife ssh on all nodes ?
[2012-09-27 16:07:21 -0400] masterkorp: name:*
[2012-09-27 16:08:06 -0400] j|: masterkorp: y
[2012-09-27 16:08:08 -0400] j|: es
[2012-09-27 16:10:56 -0400] zeroXten: in a data_bag, does the filename.json have to be the same as the ITEM_NAME?
[2012-09-27 16:11:43 -0400] ryker: sry, this isn't chef specific, but I thought folks here might have run into this problem. Anyone else have issues on Centos6 where the user accounts become locked and they can't be unlocked because it says the user must have a password before it can be unlocked?
[2012-09-27 16:12:45 -0400] j|: zeroXten: I think that's a convenience so that knife knows where to look for items when uploading them.
[2012-09-27 16:12:55 -0400] j|: the "id" is indexed in solr
[2012-09-27 16:13:21 -0400] j|: but having the id be the filename lets you manage items with knife more easily. At least I think that's the idea.
[2012-09-27 16:13:46 -0400] zeroXten: knife, data bag and easy don't belong together
[2012-09-27 16:14:03 -0400] j|: zeroXten: ehh.. ok. ?
[2012-09-27 16:14:10 -0400] zeroXten: i'm trying to automate some things and knife trying to be clever is actually making it ahrder
[2012-09-27 16:14:13 -0400] zeroXten: or harder even
[2012-09-27 16:14:28 -0400] yfeldblum: zeroXten, how so?
[2012-09-27 16:16:21 -0400] j|: in bootstrap time, before the node has registered itself with the chef-server, how do I tell what environment the node was launched in? (the '-E' in knife)
[2012-09-27 16:17:04 -0400] j|: will the -E of the knife command go into @chef_config, or will that be what was gleaned from my knife.rb?
[2012-09-27 16:18:05 -0400] zeroXten: in data_bags/servers
[2012-09-27 16:18:22 -0400] zeroXten: knife data bag from file servers my_server_com.json
[2012-09-27 16:18:30 -0400] zeroXten: ERROR: The object you are looking for could not be found
[2012-09-27 16:24:00 -0400] yfeldblum: j|, https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/core/bootstrap_context.rb#L82-88
[2012-09-27 16:24:39 -0400] yfeldblum: j|, #start_chef in that class returns a string which is the CLI command that will be used to actually start chef
[2012-09-27 16:25:07 -0400] j|: ah.
[2012-09-27 16:25:09 -0400] j|: awesome.
[2012-09-27 16:25:41 -0400] j|: that's exactly the level I need to see something to understand wtf I'm working with. thx!
[2012-09-27 16:25:54 -0400] yfeldblum: j|, no probs
[2012-09-27 16:29:03 -0400] JasonF: j|: another trick I used when troubleshooting bootstrap issues was to make a bootstrap file with nothing but <%= puts @chef_config.inspect %> \n exit 127
[2012-09-27 16:29:22 -0400] JasonF: that'll print your whole chef_config object so you can see what config params are being passed through (like environment)
[2012-09-27 16:29:34 -0400] JasonF: and obviously make no changes on the server you pointed the bootstrap at
[2012-09-27 16:30:29 -0400] j|: ah. that's useful as well.
[2012-09-27 16:30:34 -0400] j|: thx, JasonF
[2012-09-27 16:32:20 -0400] zeroXten: so, "knife data bag create servers".... thanks for that random comment at the bottom of the wiki page
[2012-09-27 16:32:56 -0400] erikh: zeroXten: if you knife --help it's listed there along with many other things that are good to know.
[2012-09-27 16:33:17 -0400] senilegenius: anybody know why 'knife search node "hostname:*"' comes back with 63 items but 'knife search node "hostname:*"' comes back with actual # of nodes in chef, 68? using open source chef server
[2012-09-27 16:33:53 -0400] erikh: those are the exact same search queries?
[2012-09-27 16:35:14 -0400] senilegenius: erikh: DOH sorry second one should be 'knife search node "name:*"'
[2012-09-27 16:35:26 -0400] erikh: ah
[2012-09-27 16:35:32 -0400] yfeldblum: zeroXten, right, that's basically like a `create table servers (...)` being necessary before doing anything like `insert into servers (...) values (...)`
[2012-09-27 16:35:47 -0400] senilegenius: issue is with using "hostname" vs "name", not sure why one would return something different
[2012-09-27 16:36:12 -0400] erikh: so, what I suspect is happening there is that ohai is probably not able to gather a hostname for the missing nodes, OR a full converge hasn't run yet on those boxes (which would keep the ohai data from getting saved)
[2012-09-27 16:36:15 -0400] j|: senilegenius: I can't replicate that behavior w/ 10.14.2
[2012-09-27 16:36:24 -0400] erikh: nodes always have a name, but the hostname must be gathered.
[2012-09-27 16:36:49 -0400] senilegenius: erikh:  can you explain?
[2012-09-27 16:36:50 -0400] yfeldblum: senilegenius, hostname is what comes from running `hostname -f` on the server running chef-client; name is what you named the node instance in the chef-server-api
[2012-09-27 16:37:03 -0400] senilegenius: yfeldblum: ah ok
[2012-09-27 16:37:25 -0400] erikh: senilegenius: ohai is what collects those bits of information. a node has a name associated with it on creation... you can see with `knife node list`.
[2012-09-27 16:37:51 -0400] erikh: if your converges never finish, chef-client will never save the node data which contains what ohai has gathered (the hostname)
[2012-09-27 16:38:28 -0400] erikh: alternatively if for some reason you can't get hostname information on the box that would also cause it
[2012-09-27 16:38:41 -0400] erikh: but I strongly suspect your converges are just failing on those 5 servers, or have never been converged.
[2012-09-27 16:39:31 -0400] senilegenius: erikh:  good info thx. i'll check on that.
[2012-09-27 16:39:48 -0400] zeroXten: yfeldblum: but I can do "knife role from file myrole.rb" without a "knife role create myrole"
[2012-09-27 16:40:38 -0400] senilegenius: j|: thanksi definitely need to upgrade. only on 0.10.8 right now
[2012-09-27 16:41:12 -0400] yfeldblum: zeroXten, the table of roles has already been created for you - chef-server-api does that when it boots up (or something like that)
[2012-09-27 16:41:20 -0400] anentropic: zeroxTen yes but a data_bag is like a folder, the json files are items inside the bag, have to create the bag name first
[2012-09-27 16:42:13 -0400] yfeldblum: zeroXten, the table of roles belongs to chef; but you can create a table of X's, which in chef-land is called a "data-bag"
[2012-09-27 16:42:22 -0400] zeroXten: hmm, not how I would have done it. Or at least, I would have created it if it didn't exist, but hey. I can work around it in bash
[2012-09-27 16:43:31 -0400] yfeldblum: zeroXten, sorry if it's confusing
[2012-09-27 16:43:41 -0400] yfeldblum: zeroXten, there's good arguments for both sides ... everything is a tradeoff
[2012-09-27 16:43:55 -0400] zeroXten: yeah, stupid universe
[2012-09-27 16:44:10 -0400] zeroXten: i blame entropy
[2012-09-27 16:52:17 -0400] senilegenius: yfeldblum  erikh: hrm. chef-client is running and no errors. and 'hostname -f' responds with FQDN. any other ideas?  my next step would be to remove/re-add the node
[2012-09-27 16:53:01 -0400] erikh: senilegenius: have you tried `knife node edit <node> -a` to verify the hostname really isn't there? you could be having solr issues too.
[2012-09-27 16:54:03 -0400] senilegenius: erikh: i've never edited a node directlyi'll check.  i'm guessing it's solr. this is where a private chef instance would come in handy :S :)
[2012-09-27 16:55:47 -0400] erikh: oh, are you on hosted chef?
[2012-09-27 16:56:21 -0400] erikh: they actually do a lot of behind-the-scenes solr replication, you'll see some lag there between writes and search availability.
[2012-09-27 16:56:23 -0400] senilegenius: no, open source, installed it.
[2012-09-27 16:56:39 -0400] erikh: yeah; you shouldn't see this with chef you host yourself, unless you're doing HA stuff.
[2012-09-27 16:58:57 -0400] senilegenius: erikh: hrm. yeah, i'm not doing *anything* with solrjust crossing fingers and hoping it keeps working fine ;)
[2012-09-27 17:00:08 -0400] erikh: yeah, I'd check to ensure the hostname isn't set before blaming solr
[2012-09-27 17:00:28 -0400] erikh: this is definitely something to file under "problems you do not want"
[2012-09-27 17:18:46 -0400] senilegenius: erikh:  yeah, ug. i deleted the node from chef, re-added, re-applied run_list, re-ran chef-client on node, and still the same. hostname -f is exactly the same as "name" for the node. made sure /etc/hosts and /etc/sysconfig/network look ok. sigh.
[2012-09-27 17:19:19 -0400] Pushnell: Is there a proper way to do something like an include_attributes?  I have a cookbook with no default recipe - you must pick one of several recipes.  but all recipe have some common attributes and I'm trying to stay DRY
[2012-09-27 17:19:19 -0400] senilegenius: :)
[2012-09-27 17:19:57 -0400] erikh: senilegenius: oh, hostname is set but is just the same as the node name?
[2012-09-27 17:19:59 -0400] erikh: that's different :)
[2012-09-27 17:20:03 -0400] anentropic: Pushnell, the cookbook can have an attributes/default.rb file
[2012-09-27 17:20:18 -0400] Pushnell: anentropic: and that gets used even if I'm not calling the default recipe?
[2012-09-27 17:20:41 -0400] senilegenius: erikh:  um lol i had hoped noti set all my node names == hostname -f  :)
[2012-09-27 17:20:42 -0400] anentropic: Pushnell, actually I have no idea
[2012-09-27 17:20:56 -0400] erikh: ah
[2012-09-27 17:21:02 -0400] chip-: Pushnell: Yes, the default attributes will be available to all recipes in the cookbook.
[2012-09-27 17:21:11 -0400] erikh: sounds like you have solr issues, then.
[2012-09-27 17:21:15 -0400] Pushnell: chip- and anentropic: thanks
[2012-09-27 17:21:57 -0400] chip-: Pushnell: If you so choose, you can also put attributes for other recipes into other files in /attributes, but I find a monolithic default attributes file to be more manageable most of the time. YMMV.
[2012-09-27 17:23:00 -0400] gyre008: can someone tell me why is knife ssh returning the following error to me ? DEBUG: ---- End HTTP Status/Header Data ----
[2012-09-27 17:23:49 -0400] Pushnell: straw poll: favorite text editor to work on chef?  (I've never had so many identically-named files open in my life...)
[2012-09-27 17:23:51 -0400] senilegenius: erikh: thanks for helping me narrow it down. :)
[2012-09-27 17:23:54 -0400] gyre008: oops
[2012-09-27 17:23:54 -0400] gyre008: https://gist.github.com/3795251
[2012-09-27 17:24:14 -0400] gyre008: basically it looks like the ssh is not working at all :)
[2012-09-27 17:24:17 -0400] chip-: Pushnell: Sublime Text 2, regardless of your platform. It's amazing.
[2012-09-27 17:24:43 -0400] anentropic: chip- Pushnell +1
[2012-09-27 17:26:38 -0400] gyre008: knife search returns all the nodes just fine...
[2012-09-27 17:26:49 -0400] gyre008: but knife ssh throws an error
[2012-09-27 17:26:53 -0400] yfeldblum: notepad?
[2012-09-27 17:27:35 -0400] gyre008: hm ?
[2012-09-27 17:30:14 -0400] anentropic: anyone got any tips for matching the imaginary line numbers that come back from chef with actual lines of code?
[2012-09-27 17:30:33 -0400] anentropic: (wsgi_apps::rbx line 109) had an error: ArgumentError: wrong number of arguments (1 for 2)
[2012-09-27 17:30:56 -0400] anentropic: wsgi_apps is my own cookbook, I have an rbx recipe in it
[2012-09-27 17:31:02 -0400] gyre008: knife ssh returns: WARNING: Failed to connect to  -- SocketError: getaddrinfo: nodename nor servname provided, or not known
[2012-09-27 17:31:22 -0400] anentropic: but I assume wsgi_apps::rbx is a generated class or something because it has no line #109
[2012-09-27 17:31:31 -0400] anentropic: (the rbx recipe I mean)
[2012-09-27 17:33:42 -0400] rava: ah, just had one of those momements where having chef in place just saved me a couple hours and a whole lotta heart burn.
[2012-09-27 17:35:37 -0400] rava: anyone use emacs when editing chef and have some useful packages?
[2012-09-27 17:36:12 -0400] en0x: emacs?
[2012-09-27 17:36:20 -0400] rava: hahah
[2012-09-27 17:37:26 -0400] rava: need to poke at the shef repl, i can likely get an interface going in emacs :D
[2012-09-27 17:37:41 -0400] josephholsten: rava: I think jtimberman is
[2012-09-27 17:38:16 -0400] en0x: my boss used to say "emacs is good at anything except being an editor"
[2012-09-27 17:38:17 -0400] en0x: [;
[2012-09-27 17:38:28 -0400] rava: en0x: not going there
[2012-09-27 17:38:33 -0400] en0x: hehe
[2012-09-27 17:38:37 -0400] en0x: j/k
[2012-09-27 17:38:52 -0400] rava: en0x: though i admit it's my favorite, portable operating system
[2012-09-27 17:38:58 -0400] gyre008: totally don't get it .https://gist.github.com/3795251
[2012-09-27 17:38:58 -0400] en0x: i have issue uploading my cookbooks and can't figure out why :(
[2012-09-27 17:39:16 -0400] rava: en0x: details?
[2012-09-27 17:39:57 -0400] en0x: rava: http://wklej.org/id/837404/ it says that it cannot generate a tempfile
[2012-09-27 17:40:10 -0400] en0x: but i see it can create folders in sandboxes
[2012-09-27 17:41:07 -0400] rava: someone had the same issue last night
[2012-09-27 17:41:16 -0400] en0x: it was me i guess
[2012-09-27 17:41:18 -0400] rava: is this on a fresh install of chef using chef-solo?
[2012-09-27 17:41:28 -0400] rava: his handle was _0..something something :)
[2012-09-27 17:41:51 -0400] en0x: its a chef-server... i'm trying to remotely upload cookbook from different client
[2012-09-27 17:44:08 -0400] en0x: and it's a clean install
[2012-09-27 17:44:14 -0400] en0x: running centos 5.8 as chef-server
[2012-09-27 17:44:17 -0400] jtimberman: josephholsten: i haven't done shef in emacs.
[2012-09-27 17:45:06 -0400] josephholsten: oh, I missed that bit. that'd be neat
[2012-09-27 17:45:14 -0400] en0x: of course using chef 10.14.2
[2012-09-27 17:45:31 -0400] josephholsten: I wonder if there's pry-emacs hooks
[2012-09-27 17:47:11 -0400] erikh: shef-mode!
[2012-09-27 17:47:57 -0400] josephholsten: en0x: /usr/lib/ruby/gems/1.8/gems/chef-server-api-10.14.2/sandbox20120926-27206-3o6ie8-9 looks like an odd place for temp files to be created
[2012-09-27 17:47:59 -0400] erikh: ISTR there being a general purpose inferior mode that was good for such things
[2012-09-27 17:48:06 -0400] rava: there's an awesome rails platform in emacs called rinari, was thinking of thieving some of it's magic
[2012-09-27 17:48:09 -0400] erikh: I used it with sqlplus more years ago than I care to admit
[2012-09-27 17:50:20 -0400] en0x: rava: well it is but why it's pointing there? this is my server.rb config http://wklej.org/id/837897/
[2012-09-27 17:52:19 -0400] rava: en0x: i haven't been able to figure it out. i was going to try and repro it last night but passed out fairly early
[2012-09-27 17:53:10 -0400] jtimberman: rava: there was a chef-mode published on github... https://github.com/mpasternacki/chef-mode
[2012-09-27 17:53:39 -0400] jtimberman: I really like ruby-tools-mode, it has a couple shortcuts for switching strings between quote styles (double vs single) and to/from symbols.
[2012-09-27 17:54:45 -0400] josephholsten: en0x: really don't get where temp file got the idea to use that directory: https://github.com/opscode/chef/blob/master/chef-server-api/app/models/sandbox_file.rb#L101
[2012-09-27 17:55:48 -0400] rava: en0x: how did you install chef-server on this machine?
[2012-09-27 17:56:01 -0400] rava: jtimberman: thanks, i'll check that out
[2012-09-27 17:56:26 -0400] en0x: rava: using this: http://blog.frameos.org/2011/04/29/installing-chef-server-0-10-in-centos-5-rhel-5/
[2012-09-27 17:57:03 -0400] rava: hrm, so gem install
[2012-09-27 17:57:48 -0400] josephholsten: en0x: are you avoiding the omnibus install? or is that the first thing you found?
[2012-09-27 17:57:59 -0400] rava: buddy who had this problem last night was doing an install using chef-solo on ubuntu 12.04, which also uses a gem install
[2012-09-27 17:58:23 -0400] drnfx: gem isntall again?
[2012-09-27 17:58:34 -0400] drnfx: error uploading cookbooks?
[2012-09-27 17:59:07 -0400] josephholsten: en0x: if you don't mind, would you try reinstalling using these instructions: http://www.opscode.com/chef/install/
[2012-09-27 17:59:32 -0400] josephholsten: oh wait, chef server.
[2012-09-27 18:00:29 -0400] jwitrick: ohai: I need some help understanding chef search.
[2012-09-27 18:02:38 -0400] jwitrick: https://gist.github.com/3795441
[2012-09-27 18:02:48 -0400] jwitrick: It does not appear to be consistent.
[2012-09-27 18:04:36 -0400] josephholsten: you searched one time with name: attribute, the other time with fqdn:
[2012-09-27 18:05:05 -0400] jwitrick: true. but the output is the same.
[2012-09-27 18:05:25 -0400] jwitrick: or let me correct that.
[2012-09-27 18:05:32 -0400] jwitrick: the output returns an incorrect result.
[2012-09-27 18:05:48 -0400] jwitrick: In my case. i am searching for server '2' but it only returns results for server'1'
[2012-09-27 18:06:57 -0400] josephholsten: is your chef server overloaded? it can take a bit for chef-expander to work through its queue to update search indexes
[2012-09-27 18:07:26 -0400] jwitrick: Should not be those servers have been index for a while. my next course is to restart the services.
[2012-09-27 18:12:32 -0400] anentropic: do you have to use symbol key names for deep merge to work properly?
[2012-09-27 18:14:26 -0400] jrenaut: hello, i've been having some problems bootstraping ec2 instances
[2012-09-27 18:15:17 -0400] jrenaut: chef says client.pem is not present then receives a http 500 error form chef server saying the connection failed, retries and tells me the client already exists
[2012-09-27 18:15:44 -0400] jrenaut: if i check the server the node hasn't been created but the client has... any clues?
[2012-09-27 18:15:55 -0400] joshhertz: delete the client and try again.
[2012-09-27 18:16:14 -0400] joshhertz: you can do it via the website fir hosted chef, or knife client delete CLIENT
[2012-09-27 18:16:25 -0400] jrenaut: tried that a few times checking the logs on the server and nothing pops out
[2012-09-27 18:16:56 -0400] jrenaut: i'm using open source chef server btw, not the hosted one
[2012-09-27 18:17:26 -0400] jrenaut: which is also in an ec2 instance
[2012-09-27 18:17:33 -0400] anentropic: does deep merge work properly between default and override attributes?
[2012-09-27 18:17:41 -0400] jwitrick: http://tickets.opscode.com/browse/CHEF-3482
[2012-09-27 18:17:56 -0400] anentropic: my nested hash is getting overwritten instead of merged
[2012-09-27 18:18:36 -0400] tolland: whats the news?
[2012-09-27 18:27:27 -0400] joewilliams: anyone using omnibus for non-chef builds? oss examples/
[2012-09-27 18:29:55 -0400] jtimberman: paging joemiller? ^
[2012-09-27 18:43:53 -0400] aleksei: Hello! Would you please give me an example of how to define before_symlink (or other  callback) using new 'application' cookbook? Maybe the question is very stupid, but I completely stuck with it.
[2012-09-27 18:45:25 -0400] aleksei: I am trying to do something like this: https://gist.github.com/3795655
[2012-09-27 18:45:47 -0400] aleksei: howevery callback is simply ignored when I run chef-client.
[2012-09-27 18:45:54 -0400] aleksei: *however
[2012-09-27 18:50:09 -0400] joemiller: joewilliams: yes
[2012-09-27 18:50:44 -0400] joemiller: joewilliams: sensu is. https://github.com/sensu/sensu/wiki/Package-Repositories
[2012-09-27 18:52:06 -0400] joemiller: joewilliams: we wrote Bunchr (dsl on top of rake) based on the original clojure-omnibus that holoway wrote to help with the builds. https://github.com/joemiller/bunchr
[2012-09-27 18:52:28 -0400] joemiller: joewilliams: and then we use vagrant to execute pkg builds. https://github.com/sensu/sensu-build
[2012-09-27 18:52:41 -0400] mattray: fwiw, new knife-rackspace coming out shortly
[2012-09-27 18:53:29 -0400] joemiller: joewilliams: also, mitchellh is doing omnibus-style builds for vagrant itself. using chef to orchestrate build + pkg. https://github.com/mitchellh/vagrant-installers
[2012-09-27 19:02:23 -0400] jtimberman: joemiller: sounds like sensu is the older omnibus then, not the newer ruby dsl
[2012-09-27 19:03:00 -0400] joemiller: jtimberman: correct. newer ruby dsl wasn't out yet. i was anxious to get omnibus'd
[2012-09-27 19:04:38 -0400] jtimberman: :)
[2012-09-27 19:08:56 -0400] jblaine: what's the knife.rb option for setting cookbook path?
[2012-09-27 19:09:11 -0400] jtimberman: jblaine: cookbook_path
[2012-09-27 19:09:11 -0400] jblaine: the knife page in the wiki says nothing
[2012-09-27 19:09:15 -0400] jblaine: ah
[2012-09-27 19:09:18 -0400] jblaine: imagine that
[2012-09-27 19:09:20 -0400] jtimberman: :)
[2012-09-27 19:09:25 -0400] jtimberman: the configuration settings page should have that
[2012-09-27 19:09:36 -0400] pwf: is there an easy way to make a resource run once per day even if chef runs every 30 minutes?
[2012-09-27 19:09:39 -0400] jtimberman: i should resurrect bawt.
[2012-09-27 19:10:06 -0400] pwf: i probably just need to make a cron resource for this...
[2012-09-27 19:12:01 -0400] joewilliams: cool, i'll take a look. thanks joemiller
[2012-09-27 19:12:37 -0400] atomic-penguin: Anyone going to Columbus for Ohio LinuxFest this weekend?
[2012-09-27 19:12:39 -0400] yfeldblum: pwf, yeah chef should not be running things
[2012-09-27 19:13:21 -0400] jblaine: wiki_updates++
[2012-09-27 19:13:24 -0400] yfeldblum: pwf, every chef run after the first should always be a no-op, unless the configuration has changed (updated cookbook, updated data-bag item, updated list of nodes, etc)
[2012-09-27 19:13:35 -0400] pwf: word.
[2012-09-27 19:13:55 -0400] yfeldblum: pwf, so whatever you were thinking of probably should be dropped into a script and cronned
[2012-09-27 19:24:24 -0400] rava: anyone run into an issue where chef-client just hangs when trying to load the linux::filesystem plugin?
[2012-09-27 19:26:19 -0400] jonlives: rava: yes - it can happen with dead nfs mounts, in my experience
[2012-09-27 19:27:25 -0400] rava: that's not happy, as i don't have nfs mounts
[2012-09-27 19:27:48 -0400] rava: what i do have is ebs volumes
[2012-09-27 19:28:17 -0400] rava: that have been flakey in terms of io latency
[2012-09-27 19:30:57 -0400] cap10morgan: is anyone else seeing random old cookbook versions installed on nodes from hosted chef?
[2012-09-27 19:31:31 -0400] jonlives: rava: could well explain it then
[2012-09-27 19:32:36 -0400] rava: jonlives: wonder what that plugin loader is doing that could possibly hang for so long
[2012-09-27 19:32:52 -0400] rava: just trying to read partition meta data?
[2012-09-27 19:34:16 -0400] jonlives: i'm not 100% sure,
[2012-09-27 19:34:20 -0400] jonlives: never looked into it
[2012-09-27 19:34:29 -0400] kgraham: hello, how do i down grade from 10.14.2 to 10.12, having problems with the deploy resource
[2012-09-27 19:35:04 -0400] kgraham: or when will the fix for http://tickets.opscode.com/browse/CHEF-3449 be out, thanks, love the product :)
[2012-09-27 19:38:17 -0400] jtimberman: kgraham: there's a release candidate of 10.14.4
[2012-09-27 19:38:23 -0400] jtimberman: you can install with gem install --pre chef
[2012-09-27 19:40:41 -0400] patcon: yfeldblum: just a heads up that the resource_collection's `find()` method used `lookup()` as well, which throws an error if it's not found. Seems like the error handling could happen somewhere else so that we could search without throwing an error, but for now, I used `if run_context.resource_collection.detect {|res| res.to_s == "service[#{service}]"}`
[2012-09-27 19:40:48 -0400] patcon: cc: jtimberman ^^
[2012-09-27 19:41:10 -0400] yfeldblum: patcon, you can also rescue
[2012-09-27 19:41:48 -0400] yfeldblum: patcon, res = run_context.resource_collection.lookup("service[#{service}]") rescue nil ; if res ... end
[2012-09-27 19:42:27 -0400] patcon: ah good point. thanks yfeldblum
[2012-09-27 19:42:42 -0400] ev0ldave: when would set ever come in handy with attributes?
[2012-09-27 19:42:49 -0400] ev0ldave: as opposed to default
[2012-09-27 19:43:04 -0400] jtimberman: ev0ldave: i use 'set' when i'm setting node attributes in recipes.
[2012-09-27 19:43:36 -0400] ev0ldave: and then you remove that recipe and the node has the attribute still stuck on it
[2012-09-27 19:43:37 -0400] patcon: ev0ldave: or overriding another cookbooks default attributes from another
[2012-09-27 19:43:52 -0400] yfeldblum: ev0ldave, when your recipe is using the node as a read/write datastore, rather than as an input parameter
[2012-09-27 19:44:08 -0400] kgraham: jtimberman: thanks, i'll try that
[2012-09-27 19:44:38 -0400] ev0ldave: patcon: sounds like a design issue
[2012-09-27 19:45:15 -0400] ev0ldave: yfeldblum:  mind expanding on that with an example?
[2012-09-27 19:45:30 -0400] patcon: sorry set = normal in attr files, unless i'm misunderstanding. for ex, percona cookbook needs to set some mysql attr to piggyback on it
[2012-09-27 19:45:52 -0400] patcon: ev0ldave: ^^ don't think it's doable another way. but could be wrong
[2012-09-27 19:46:28 -0400] yfeldblum: ev0ldave, if your recipe needs to generate or compute a value during one run and save that generated or computed value to the chef-server, but then on the next run retrieve that value from the chef-server rather than re-generating or re-computing it
[2012-09-27 19:46:41 -0400] Pushnell: Am I correct in understanding that the User resource doesn't provide a way to add a user to a group?
[2012-09-27 19:47:24 -0400] bluepojo: Pushnell: you can specify the group
[2012-09-27 19:47:30 -0400] bluepojo: it just has to exist before you create the user
[2012-09-27 19:47:32 -0400] yfeldblum: Pushnell, http://wiki.opscode.com/display/chef/Resources#Resources-Group
[2012-09-27 19:47:36 -0400] bluepojo: so call the group resource first
[2012-09-27 19:48:32 -0400] Pushnell: So if I have a group with users A and B and I use a Group resource to define members ['C'], do A and B lose membership?
[2012-09-27 19:48:36 -0400] yfeldblum: bluepojo, terminologically, i'd go with "declare" rather than "call" w.r.t. a resource
[2012-09-27 19:48:55 -0400] bluepojo: that's a funny word
[2012-09-27 19:48:58 -0400] bluepojo: terminologically
[2012-09-27 19:49:02 -0400] patcon: ev0ldave: https://github.com/myplanetdigital/chef-percona/blob/master/attributes/default.rb#L31 but hey, maybe it's a design issue if there's a better way
[2012-09-27 19:49:06 -0400] yfeldblum: Pushnell, the docs for the group resource answers that question
[2012-09-27 19:49:24 -0400] Pushnell: yfeldblum: sorry, I just realized that
[2012-09-27 19:49:31 -0400] Pushnell: :append
[2012-09-27 19:49:34 -0400] bluepojo: and yeah, I was a ruby dev first, then learned chef, so it still feels like calling methods to me
[2012-09-27 19:49:34 -0400] bluepojo: :P
[2012-09-27 19:49:42 -0400] bluepojo: cause technically it is
[2012-09-27 19:49:52 -0400] bluepojo: but you're right that the dsl wants you to feel like it's a declaration
[2012-09-27 19:49:55 -0400] bluepojo: not a call
[2012-09-27 19:50:04 -0400] yfeldblum: bluenemo, terminologically, you're calling a method and, in so doing, declaring a resource
[2012-09-27 19:50:06 -0400] ev0ldave: are normal and set the same?
[2012-09-27 19:50:09 -0400] yfeldblum: bluepojo, ^
[2012-09-27 19:50:19 -0400] patcon: yep
[2012-09-27 19:50:21 -0400] patcon: http://wiki.opscode.com/display/chef/Attributes#Attributes-CookbookAttributeMethods
[2012-09-27 19:50:30 -0400] bluenemo: yfeldblum, i dont think so :P
[2012-09-27 19:50:31 -0400] bluenemo: ;)
[2012-09-27 19:50:41 -0400] bluepojo: sup blue brotha
[2012-09-27 19:50:44 -0400] bluepojo: :O
[2012-09-27 19:51:02 -0400] yfeldblum: ev0ldave, no, node.normal.set (shorthand: node.set) is normal level, but node.default.set is default level (and likewise the other two levels)
[2012-09-27 19:53:06 -0400] ev0ldave: thank you everyone
[2012-09-27 19:54:24 -0400] Pushnell: yfeldblum and bluepojo: thanks
[2012-09-27 19:57:30 -0400] gyre007: whens the next stable chef release out ? ie current 10.14.4.rc.0
[2012-09-27 19:57:33 -0400] gyre007: anyone idea ?
[2012-09-27 19:58:11 -0400] drnfx: What should I be searching for to be able to do a "multicast" to multiple nodes?
[2012-09-27 20:02:04 -0400] mattray: new knife-rackspace released, tackling the V2 patchset now
[2012-09-27 20:02:29 -0400] ev0ldave: drnfx:  need more explanation
[2012-09-27 20:02:29 -0400] mattray: gyre007: very soon, possibly today
[2012-09-27 20:02:51 -0400] mattray: gyre007: checking on a few possible regressions
[2012-09-27 20:04:49 -0400] drnfx: the ability to ship recipies to multiple nodes at once
[2012-09-27 20:05:06 -0400] drnfx: without writing a script with multiple knife commands
[2012-09-27 20:06:09 -0400] mattray: drnfx: give each of those nodes a role in their run list, modify the role to include different recipes
[2012-09-27 20:06:19 -0400] chip-: drnfx: This problem is traditionally solved by putting the cookbook up on the Chef server, and then editing the run list on those nodes.
[2012-09-27 20:06:25 -0400] mattray: drnfx: knife ssh "role:foo" "chef-client"
[2012-09-27 20:07:17 -0400] drnfx: mattray, that will execute chef-client accross all nodes associated with role::foo ?
[2012-09-27 20:07:55 -0400] mattray: drnfx: yup
[2012-09-27 20:08:21 -0400] mattray: so to change all their run lists, update the role, push it to the server, then run that
[2012-09-27 20:10:34 -0400] drnfx: and i can interchange that "chef-client" with "chef-client -o" for specific recipes
[2012-09-27 20:10:52 -0400] drnfx: do the recipes have to be in the run list? or just available to the node (i.e. on the chef server)
[2012-09-27 20:11:57 -0400] jmartin: is it possible to use the omnibus chef-solo binary to bootstrap a chef-server?
[2012-09-27 20:19:33 -0400] gyre007: mattray, awesome...where can I find out if it's released ?
[2012-09-27 20:19:47 -0400] gyre007: I presume it'll be available via omnibus install ?
[2012-09-27 20:20:02 -0400] mattray: yeah, that'll be lagging a little bit
[2012-09-27 20:20:07 -0400] mattray: rubygems first I guess
[2012-09-27 20:20:16 -0400] mattray: you can grab a pre release from there
[2012-09-27 20:20:26 -0400] mattray: and you can upgrade an omnibus
[2012-09-27 20:20:27 -0400] gyre007: I already am running pre release :)
[2012-09-27 20:20:37 -0400] mattray: ahh, how's that working out for you? :)
[2012-09-27 20:20:52 -0400] edelschaedel: hey is anything up with hosted chef?   suddenly it's not allowing me to authenticate.  says "invalid signature for user or client"  I haven't touched my keys.  anyone else seeing issues?
[2012-09-27 20:21:15 -0400] edelschaedel: wow just as i type that.  now it works.
[2012-09-27 20:21:31 -0400] gyre007: mattray, '/opt/chef/embedded/bin/gem install chef --pre :)
[2012-09-27 20:21:40 -0400] edelschaedel: and broken again.
[2012-09-27 20:22:01 -0400] edelschaedel: looks intermittent.  Anyone seeing the same thing?
[2012-09-27 20:22:24 -0400] mattray: edelschaedel: yeah, I think they're having an issue with a load balancer, probably going to update http://status.opscode.com/ shorly
[2012-09-27 20:22:55 -0400] gyre007: mattray, it works very good...i was having issues with deploy_resource...but with the new RC all seems to be fixed
[2012-09-27 20:22:58 -0400] mattray: and there it is
[2012-09-27 20:23:07 -0400] gyre007: i have to say that 10.14 seems to be faster than 10.12
[2012-09-27 20:23:20 -0400] edelschaedel: thanks  Matt.
[2012-09-27 20:25:08 -0400] jessicab: edelschaedel: we just updated status btw, seeing lots of 500 errors it sounds like
[2012-09-27 20:25:12 -0400] gyre007: also...-f option when running as daemon saves shed loads of memory...10.12 was bloating in memory...
[2012-09-27 20:25:40 -0400] mattray: gyre007: yeah, upgraded to Ruby 1.9.3
[2012-09-27 20:26:03 -0400] tolland: ... ERROR: Server returned error for https://api.opscode...
[2012-09-27 20:26:13 -0400] mattray: gyre007: I particularly like -lfatal -Fminimal
[2012-09-27 20:29:43 -0400] gyre007: mmm havent heard of those...what are those for ?
[2012-09-27 20:29:47 -0400] gyre007: lemmesee
[2012-09-27 20:33:52 -0400] ianbrandt: Greetings.  I installed Chef client/solo via the Omnibus installer on my OS X 10.6.8 laptop.  Now I'm trying to bootstrap a local server per: http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo.  When I run the rubygems-install recipe it fails with "Attribute cpu is not defined!": https://gist.github.com/3796291.  Has anyone succeeded in using this recipe on OS X?
[2012-09-27 20:33:56 -0400] jtimberman: tolland: http://status.opscode.com/post/32409871339/hosted-chef-connectivity-issue
[2012-09-27 20:34:08 -0400] jtimberman: 11 minutes ago
[2012-09-27 20:35:36 -0400] tolland: the status page is a bit flaky as well
[2012-09-27 20:37:50 -0400] hakunin: I need to install a bunch of ttf fonts into my target server. It's really easy, I just need to put them into /usr/share/fonts and run a command.
[2012-09-27 20:38:09 -0400] hakunin: But the cookbook_file resource is really meant for single file. So I'm thinking - should I
[2012-09-27 20:38:37 -0400] hakunin: 1. Iterate over files in directory using ruby's Dir globbing and declare resource per file?
[2012-09-27 20:38:44 -0400] hakunin: 2. Put them in gzip and extract
[2012-09-27 20:38:59 -0400] JasonF: Isn't there a command to sync over a full directory?
[2012-09-27 20:39:51 -0400] JasonF: does remote_directory not work for you?
[2012-09-27 20:40:05 -0400] hakunin: JasonF: i see Remote Directory, but wouldn't it transfer directly from local to remote, rather than use already uploaded cookbook on remote?
[2012-09-27 20:40:29 -0400] hakunin: afai understand - the ttf files will already be uploaded with the cookbook
[2012-09-27 20:40:37 -0400] hakunin: and this thing will upload them again?
[2012-09-27 20:40:52 -0400] JasonF: http://wiki.opscode.com/display/chef/Resources#Resources-RemoteDirectory
[2012-09-27 20:40:57 -0400] JasonF: I don't think so?
[2012-09-27 20:41:17 -0400] hakunin: yeah looking at it, if not then it does look about right
[2012-09-27 20:41:26 -0400] JasonF: default source per that doc is files/ directory in the cookbook
[2012-09-27 20:41:39 -0400] JasonF: in our implementation, we use remote_directory and put the dir in files/default/dirname
[2012-09-27 20:41:45 -0400] hakunin: although it means i'd have to let chef fully consume the /usr/share/fonts dir
[2012-09-27 20:42:00 -0400] hakunin: or not?
[2012-09-27 20:42:03 -0400] hakunin: hm
[2012-09-27 20:42:33 -0400] JasonF: In my experience, unless you modify the defaults, it's only additive. You'd have to do something different if you wanted to do automatic removals as well (which is hard in either implementation)
[2012-09-27 20:42:42 -0400] hakunin: ok i see, it has ways to say overwrite or purge
[2012-09-27 20:42:57 -0400] hakunin: JasonF: thanks, this seems like my exact use case then
[2012-09-27 20:43:54 -0400] jkyle: I have a recipe that compiles some source in a bash resource. What I'm seeing is that the configure stage uses a shell escape to retrieve library paths. e.g. `dpkg-builddeps -get LDFLAGS`. When run in chef, this command isnt' shelled out but is treated like a literal.
[2012-09-27 20:54:18 -0400] PuppyNuts: Hello everyone, how are you?
[2012-09-27 20:54:49 -0400] PuppyNuts: I have what I'm sure is a pretty newbie question if someone has a moment to help out
[2012-09-27 20:55:22 -0400] PuppyNuts: I've finally gotten the chef-server installed on Centos 6.3 x86_64 (mostly manual install) and I got all the init.d scripts configured for services
[2012-09-27 20:55:41 -0400] PuppyNuts: I got the web-ui to come up.. However, the login I set in the webui.rb file  is not allowing me to login
[2012-09-27 20:56:33 -0400] PuppyNuts: I was at first getting it couldn't read the private key /etc/chef/webui.pem but I chowned it as the proper user and fixed that. But I've set the login as user"admin" pass" admin" but it's not working.. even tried the default password that I found in sample webui.rb
[2012-09-27 21:12:22 -0400] jblaine: node['platform_version'].to_i
[2012-09-27 21:12:25 -0400] jblaine: wash, rinse, repeat
[2012-09-27 21:14:56 -0400] jtimberman: jblaine: because you want centos 5 or 6, not 5.3, 5.6, etc?
[2012-09-27 21:18:21 -0400] jblaine: yeah
[2012-09-27 21:18:58 -0400] jblaine: also, what's the way to short-circuit exit a recipe due to wrong platform
[2012-09-27 21:19:01 -0400] jblaine: just for safety's sake
[2012-09-27 21:19:39 -0400] PuppyNuts: Hello, is there anyone here who can help me with a beginners question?
[2012-09-27 21:20:46 -0400] _aeris_: PuppyNuts > just ask your question
[2012-09-27 21:21:00 -0400] JasonF: jblaine: in default .rb: include_recipe "lol::rofl" if platform_check; then put the real work of the cookbook in rofl.rb
[2012-09-27 21:21:12 -0400] _aeris_: so anybody can help you when available
[2012-09-27 21:21:30 -0400] PuppyNuts: I did about 30 minutes ago didn't wanna repost if no one was around like earlier. Don't know how you all are about kicking for re-posts in your IRC
[2012-09-27 21:21:37 -0400] PuppyNuts: so will do so thanks :)
[2012-09-27 21:21:50 -0400] PuppyNuts: I've finally gotten the chef-server installed on Centos 6.3 x86_64 (mostly manual install) and I got all the init.d scripts configured for services
[2012-09-27 21:21:56 -0400] PuppyNuts:  I got the web-ui to come up.. However, the login I set in the webui.rb file  is not allowing me to login
[2012-09-27 21:22:03 -0400] PuppyNuts: I was at first getting it couldn't read the private key /etc/chef/webui.pem but I chowned it as the proper user and fixed that. But I've set the login as user"admin" pass" admin" but it's not working.. even tried the default password that I found in sample webui.rb
[2012-09-27 21:22:06 -0400] jblaine: JasonF: Ew.
[2012-09-27 21:22:23 -0400] _aeris_: the pass in webui.rb is just the default one
[2012-09-27 21:22:33 -0400] _aeris_: the real password is in database
[2012-09-27 21:22:57 -0400] PuppyNuts: how do I set/find this? Even just what to search for would be helpful
[2012-09-27 21:23:04 -0400] _aeris_: hum
[2012-09-27 21:23:04 -0400] PuppyNuts: or proper area of wiki to read
[2012-09-27 21:23:39 -0400] jblaine: PuppyNuts: I could not get into mine with default password (new install last week) until I stopped trying to copy/paste from the webui note at right.
[2012-09-27 21:23:52 -0400] jblaine: PuppyNuts: typed it in by hand and it worked
[2012-09-27 21:24:06 -0400] jtimberman: jblaine: do you want to exit the run entirely on the wrong platform, or just the recipe?
[2012-09-27 21:24:10 -0400] PuppyNuts: I have been typing by hand.. but will try again
[2012-09-27 21:24:13 -0400] PuppyNuts: brb
[2012-09-27 21:24:14 -0400] _aeris_: or change the password throw couchdb
[2012-09-27 21:24:17 -0400] jblaine: jtimberman: recipe
[2012-09-27 21:24:38 -0400] jtimberman: jblaine: return unless node['platform'] == 'platform_i_want'
[2012-09-27 21:24:44 -0400] PuppyNuts: so I should look up couchdb on the wiki?
[2012-09-27 21:24:47 -0400] PuppyNuts: because I've never used it before
[2012-09-27 21:24:56 -0400] jblaine: jtimberman: simple. thanks.
[2012-09-27 21:24:57 -0400] jtimberman: or, return if node['platform'] == 'platform_i_dont_want'
[2012-09-27 21:24:58 -0400] _aeris_: http://dev-ops.net/2012/02/09/resetting-a-users-password-in-chef/
[2012-09-27 21:25:04 -0400] PuppyNuts: thank you so much!
[2012-09-27 21:25:08 -0400] jtimberman: you can make a multi-line conditional if you want, too.
[2012-09-27 21:26:11 -0400] _aeris_: or http://lists.opscode.com/sympa/arc/chef/2011-08/msg00151.html
[2012-09-27 21:27:12 -0400] _aeris_: And an automated script : http://pastebin.com/RsREbauW
[2012-09-27 21:28:54 -0400] PuppyNuts: got it with the first script
[2012-09-27 21:29:02 -0400] PuppyNuts: thanks so much _aeris_
[2012-09-27 21:29:18 -0400] jtimberman: jblaine: i wrote a cookbook library file that can check the cookbook's metadata for "supports" (supported platforms) and return if the platform running the recipe is unsupported.
[2012-09-27 21:30:09 -0400] PuppyNuts: I've been thrown into learning chef on my own at work... and I'm finding it a somewhat steep learning curve even though I pick up on things quickly. But I do have to say it's been one of the more fun & interesting projects I've had in a while and has been fun playing with
[2012-09-27 21:30:10 -0400] jblaine: jtimberman: Nice
[2012-09-27 21:30:31 -0400] JasonF: jblaine: yeah, his answer is infinately better than mine, haha
[2012-09-27 21:33:26 -0400] jtimberman: https://gist.github.com/e61cb0e7702ee028c277
[2012-09-27 21:34:36 -0400] jtimberman: jblaine: ^ the aforementioned library
[2012-09-27 21:43:43 -0400] PuppyNuts: Can anyone tell me why /etc/chef is not automatically created along with associated *.rb files? (I understand on the server cause I had to do manual instatll) but on the client I was able to do omnibus and it didn't install any init scripts (all though found them in /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-10.14.2/lib/chef as well as /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-10.14.2/lib/chef/application but no init scripts (which I unders
[2012-09-27 21:43:43 -0400] PuppyNuts: tand due to OS differences) but why no /etc/chef with sample *.rb files put there?
[2012-09-27 21:44:11 -0400] jmartin: PuppyNuts: bootstrap the client with chef-client recipe
[2012-09-27 21:44:24 -0400] jmartin: not everyone wants it to do check ins
[2012-09-27 21:44:36 -0400] PuppyNuts: ahh ok thank you :)
[2012-09-27 21:49:29 -0400] yfeldblum: PuppyNuts, the full-stack installer is basically a replacement for `gem install ohai chef`
[2012-09-27 21:49:53 -0400] yfeldblum: PuppyNuts, and `gem install` doesn't copy in any init scripts or create any config files
[2012-09-27 21:50:13 -0400] yfeldblum: PuppyNuts, so neither does the full-stack installer
[2012-09-27 21:50:41 -0400] yfeldblum: PuppyNuts, so setting up init scripts and config files is the job of either a bootstrap template or adding the chef-client recipe to the node's run-list, as jmartin notes
[2012-09-27 21:51:00 -0400] PuppyNuts: oh ok, was just curious. Took me a bit to find that they were on my machine had to search through git hub at first, but nice to learn. Will be much easier for additional clients etc...\
[2012-09-27 21:54:18 -0400] masterkorp: jtimberman: hey you just closed my report, that grep was the first thing i did
[2012-09-27 21:54:22 -0400] masterkorp: no results
[2012-09-27 21:54:40 -0400] masterkorp: i also did on your gem dir
[2012-09-27 21:56:03 -0400] jtimberman: masterkorp: is it still happening? what cookbook? one of your own? can you do "knife cookbook test -VV" on it?
[2012-09-27 21:56:43 -0400] masterkorp: jtimberman: its a monit cookbit
[2012-09-27 21:56:51 -0400] masterkorp: yeah its pretty custom
[2012-09-27 21:58:10 -0400] masterkorp: jtimberman: http://pastie.org/4831940
[2012-09-27 21:58:15 -0400] masterkorp: gold
[2012-09-27 21:59:37 -0400] kyleb: masterkorp: looks like a typo of BaicFile instead of BasicFile
[2012-09-27 22:00:15 -0400] masterkorp: yees it looks
[2012-09-27 22:00:25 -0400] masterkorp: but i have no idea where that typo is
[2012-09-27 22:00:36 -0400] masterkorp: i grep'ed my whole disk for that
[2012-09-27 22:01:13 -0400] jtimberman: masterkorp: hm, can you gist your knife.rb?
[2012-09-27 22:01:54 -0400] jblaine: jtimberman: Awesome. Definitely snagging that.
[2012-09-27 22:02:37 -0400] masterkorp: jtimberman: http://pastie.org/private/bnkkf3lyz1yii0v75enssg here
[2012-09-27 22:02:39 -0400] rava: is there anyway i can make chef-client execute without doing whatever filesystem scan linux::filesystem is doing?
[2012-09-27 22:03:39 -0400] kyleb: masterkorp: its on line 16 of your pastie there
[2012-09-27 22:04:03 -0400] masterkorp: OMG
[2012-09-27 22:04:15 -0400] masterkorp: i looked trough this file 100x times
[2012-09-27 22:04:25 -0400] masterkorp: kyleb: you sir, you deserve a beer
[2012-09-27 22:04:36 -0400] kyleb: masterkorp: thanks and np
[2012-09-27 22:04:46 -0400] JasonF: masterkorp: you deserve a better version of grep ;)
[2012-09-27 22:05:13 -0400] gchristensen: I hear ack is better than grep
[2012-09-27 22:05:25 -0400] masterkorp: i did grep -r "BaicFile" /
[2012-09-27 22:05:46 -0400] masterkorp: grep: memory exhausted
[2012-09-27 22:05:49 -0400] masterkorp: yeah this
[2012-09-27 22:06:26 -0400] kyleb: plus grep doesn't always handle things inside hidden folders like ".chef"
[2012-09-27 22:06:40 -0400] erikh: it does with -r
[2012-09-27 22:07:02 -0400] JasonF: masterkorp: maybe next time, grep -ri 'BaicFile' /var/cache/chef ?
[2012-09-27 22:07:24 -0400] masterkorp: JasonF: yeah it was in my /home/masterkorp/
[2012-09-27 22:07:41 -0400] masterkorp: maybe next i should learn how to fucking type
[2012-09-27 22:08:24 -0400] JasonF: *shrug*. It happens. The only thing you can do is make sure you do a better job of troubleshooting it next time.
[2012-09-27 22:08:47 -0400] masterkorp: i was like blind
[2012-09-27 22:09:02 -0400] masterkorp: i did look trough my knife.rb alot
[2012-09-27 22:09:05 -0400] masterkorp: *a lot
[2012-09-27 22:13:57 -0400] jkyle: I have a bash resource that compiles a package with dpkg-buildpackage -us -uc. This command consistently fails at the same spot when using a resource, but always succeeds when run on the cli. gist of the resource block and the failed output => https://gist.github.com/3796571
[2012-09-27 22:14:52 -0400] jkyle: it treats a shellout, `dpkg-buildflags` as a literal. is there some other way I can "shell out" of the chef environment?
[2012-09-27 22:17:19 -0400] rava: jkyle: Chef::ShellOut.new()
[2012-09-27 22:17:40 -0400] rava: jkyle: try using <<-EOH though
[2012-09-27 22:18:25 -0400] rava: jkyle: i had some wonky errors doing 'yes | bash script.sh' using <<-EOF , but works fine with EOH
[2012-09-27 22:20:56 -0400] jkyle: so, EOH and EOF aren't just arbitrary conventions? I mean, you should be able to do <<-BLAHBLAH if you want eh?
[2012-09-27 22:21:51 -0400] rava: jkyle: tbh i'm not sure. i was used to always using EOF in most shell scripts, bashed my head for a while on my provider, saw EOH in another recipe, tried it and it's worked
[2012-09-27 22:22:23 -0400] jkyle: that's very odd, but no more odd than treating cli shellouts like literal strings :P
[2012-09-27 22:22:39 -0400] jkyle: heredoc's in bash, I know, are just arbitrary delimiters
[2012-09-27 22:23:51 -0400] rava: jkyle: if you end up using Chef::ShellOut.new(), just remember the order in which chef does things. ruby snippets get compiled and run before dsl snippets
[2012-09-27 22:24:13 -0400] jkyle: but, I read the source and could see that bash inherits from execute which looks like it inherits form chef::shellout. I'll try shellout, but if I see the same behavior is there a way to truely shell out?
[2012-09-27 22:24:16 -0400] rava: jkyle: bit me in the ass using shellout.new to test for something that was supposed to be run by a provider earlier up in the recipe
[2012-09-27 22:24:29 -0400] yfeldblum: jkyle, yes, ruby supports docstrings with arbitrary markers
[2012-09-27 22:25:03 -0400] jkyle: yeah, so EOF vs. EOH making a difference would be weird
[2012-09-27 22:25:43 -0400] yfeldblum: jkyle, right, it wouldn't make a difference, you can pick whichever is your favorite
[2012-09-27 22:26:02 -0400] rava: yfeldblum: i should dig more into why that recipe way back when failed for me
[2012-09-27 22:26:03 -0400] yfeldblum: jkyle, obviously you have to use the same market to close the string as you use to open it
[2012-09-27 22:26:20 -0400] jkyle: obviously ;)
[2012-09-27 22:26:43 -0400] rava: this is pretty odd, why would nodes fail to check in, but when runnign chef-client manually on them they execute just fine?
[2012-09-27 22:27:01 -0400] rava: if the server was busy, i'd understand a check in failing, but shouldn't chef-client just try again within it's next interval?
[2012-09-27 22:49:19 -0400] jtimberman: masterkorp: sorry, i had to run to a meeting earlier.
[2012-09-27 22:49:37 -0400] jtimberman: sounds like peer review found the cache_type in knife.rb though.
[2012-09-27 22:50:41 -0400] wdpro_kevin: anyone up for an "easy" spork question?
[2012-09-27 22:51:26 -0400] wdpro_kevin: may also be related to Foodcritic
[2012-09-27 22:52:26 -0400] juliancdunn: fire away
[2012-09-27 22:53:49 -0400] jkyle: ok, so is there a way besides Chef::Shellout and the resources that use it to call a script in chef?
[2012-09-27 22:54:12 -0400] wdpro_kevin: FC011 says change your README from rdoc to md
[2012-09-27 22:54:19 -0400] jkyle: I'd like to try to write the command to a file and then run it
[2012-09-27 22:54:24 -0400] juliancdunn: jkyle: why not just use the execute resource
[2012-09-27 22:54:30 -0400] jkyle: juliancdunn: it fails
[2012-09-27 22:54:47 -0400] wdpro_kevin: but when i change the file from README.rdoc to README.md
[2012-09-27 22:54:47 -0400] juliancdunn: jkyle: can you be more specific?
[2012-09-27 22:54:56 -0400] jkyle: with the same problem as the bash resource, looking at the chef list.github.com/3796571
[2012-09-27 22:54:57 -0400] wdpro_kevin: I get an error from spork
[2012-09-27 22:55:00 -0400] jkyle: oops
[2012-09-27 22:55:01 -0400] jkyle: https://gist.github.com/3796571
[2012-09-27 22:55:08 -0400] jkyle: resource block and failure
[2012-09-27 22:55:13 -0400] wdpro_kevin: ERROR: Errno::ENOENT: No such file or directory README.rdoc
[2012-09-27 22:55:19 -0400] jkyle: command only fails when chef runs it
[2012-09-27 22:55:43 -0400] JasonF: I've def. seen %x( some; bash; commands ) used to run bash in a chef recipe
[2012-09-27 22:55:57 -0400] JasonF: but that's probably far from the correct chef way of doing it
[2012-09-27 22:56:03 -0400] juliancdunn: jkyle: that looks like dpkg-buildflags isn't in your path
[2012-09-27 22:56:28 -0400] jkyle: it is
[2012-09-27 22:56:33 -0400] juliancdunn: wdpro_kevin: did you modify your metadata.rb to reference the markdown format readme?
[2012-09-27 22:56:41 -0400] JasonF: jkyle: just for fun, make that a full path in your bash block
[2012-09-27 22:56:43 -0400] jkyle: hm, let me check root's default path
[2012-09-27 22:56:50 -0400] JasonF:  /path/to/dpkg-buildpackage
[2012-09-27 22:56:50 -0400] wdpro_kevin: chcking
[2012-09-27 22:57:18 -0400] juliancdunn: jkyle: or, you could also set the path attribute in your execute resource
[2012-09-27 22:57:20 -0400] juliancdunn: just to make sure
[2012-09-27 22:57:27 -0400] jkyle: it finds and runs the dpkg-buildpackage. it fails when that `dpkg-buildflags --get LDFLAGS` is called in the configure later on
[2012-09-27 22:57:34 -0400] jkyle: yeah, I'll try that
[2012-09-27 22:57:39 -0400] juliancdunn: oh wait, ignore me... that's just for finding the command itself
[2012-09-27 22:57:40 -0400] wdpro_kevin: "Everything looks good!"   Thank you JCD
[2012-09-27 22:57:47 -0400] juliancdunn: wdpro_kevin: np
[2012-09-27 22:57:58 -0400] jkyle: but it's in /usr/bin
[2012-09-27 22:58:04 -0400] jkyle: so it'd be very odd if that's not in the path
[2012-09-27 22:58:40 -0400] wdpro_kevin: I'll let Adam give the hugs
[2012-09-27 22:58:50 -0400] juliancdunn: jkyle: wouldn't be so sure... the execute resource probably shells out without reading any .profile files
[2012-09-27 22:59:07 -0400] JasonF: yeah, jkyle as a general rule, I always put full paths, even in just bash scripts NOT run under chef/ruby
[2012-09-27 22:59:15 -0400] juliancdunn: you could try setting the path within the "environment" attribute just to be certain
[2012-09-27 23:00:30 -0400] jkyle: the problem is, it's not failing on the command call
[2012-09-27 23:01:06 -0400] jkyle: that failed line is generated...the command specified inthe bash resource has been called and is running....I have no (reasonable) way to put the full path on that call
[2012-09-27 23:01:16 -0400] jkyle: I can set the PATH though
[2012-09-27 23:05:36 -0400] juliancdunn: yeah, try that... say with environment ({'PATH' => ENV['PATH']})
[2012-09-27 23:05:58 -0400] jkyle: ah, I just put export PATH=/usr/bin:${PATH} in the bash resource code block
[2012-09-27 23:07:07 -0400] jkyle: also, check it out
[2012-09-27 23:07:16 -0400] jkyle: it treats the call as a string literal, not a shell out
[2012-09-27 23:08:56 -0400] jkyle: e.g. `dpkg-buildflags --get LDFLAGS`. The error is "no such file or directory: `dpkg-buildflags". Including the ` in the "no such file". next error is "no such file or directory: LDFLAGS`" notice it too includes the ` and treats it as a separate argument
[2012-09-27 23:09:21 -0400] jkyle: it also treats --get as an invalid flag passed to _configure_ itself
[2012-09-27 23:30:06 -0400] rava: when actions are listed in a recipe, does the order matter? i'm using a user management recipe that doesn't seem to want to delete users with the :remove action attribute, and i'm thinking it's because :remove is the first element of the actions list
[2012-09-27 23:31:26 -0400] _0x783czar: Question, we're trying to get our OpenSource ChefServer to be able to issue knife commands to nodes (sorta weird maybe, but we have our reasons) I believe there shouldn't be anything preventing that, am I correct in assuming that?
[2012-09-27 23:31:52 -0400] rava: _0x783czar: hey man, no just create a client key for the user
[2012-09-27 23:32:08 -0400] rava: _0x783czar: we do the same thing using python's fabric
[2012-09-27 23:33:51 -0400] _0x783czar: rava: awesome, well I tried that and kept getting Errno::ETIMEDOUT when I tried to trigger a chef-run on a node.  I tried the same command from my usual management workstation and it worked just fine.
[2012-09-27 23:34:09 -0400] rava: how did you run it?
[2012-09-27 23:34:14 -0400] isotope: did anyone else just upgrade their rackspace gem and have it break all knife commands?
[2012-09-27 23:34:20 -0400] _0x783czar: rava: also, BTW we have our OpenSource Chef Server completely up and running now that we used packages.
[2012-09-27 23:34:32 -0400] rava: deb packages instead of gems?
[2012-09-27 23:34:49 -0400] _0x783czar: rava: just the ususal knife ssh:NODENAME etc...
[2012-09-27 23:34:53 -0400] _0x783czar: rava: yup!
[2012-09-27 23:35:43 -0400] rava: _0x783czar: nice, someone else was here earlier with your issue from last night. they were using yum to run a rubygem install like package for chef
[2012-09-27 23:36:36 -0400] rava: _0x783czar: do you have the full command?
[2012-09-27 23:37:12 -0400] _0x783czar: rava "knife ssh name:testingtestingtesting.pagodabox.com -x USER -P PASSWORD "sudo chef-client" -a ipaddress"
[2012-09-27 23:37:39 -0400] _0x783czar: rava: obviously there are actual values for the user and password
[2012-09-27 23:37:48 -0400] beandip: isotope don't use the gem
[2012-09-27 23:37:59 -0400] beandip: use the current git repo from opscode
[2012-09-27 23:38:09 -0400] beandip: the gem is broken by rackspace api changes
[2012-09-27 23:38:13 -0400] isotope: beandip don't use knife-rackspace gem?
[2012-09-27 23:38:42 -0400] beandip: isotopethe gem is behind the git repo
[2012-09-27 23:38:49 -0400] rava: _0x783czar: how are you executing that command? a shellout in a recipe?
[2012-09-27 23:38:52 -0400] isotope: beandip thanks
[2012-09-27 23:38:54 -0400] beandip: the git repo has changes to fix issues with rackspace api
[2012-09-27 23:38:55 -0400] _0x783czar: isotope: he's saying you should clone the repo directly
[2012-09-27 23:39:15 -0400] _0x783czar: rava: just right from the terminal.
[2012-09-27 23:39:28 -0400] ryan__: is all of node.automatic_attrs filled out by ohai? or does something else add values there as well?
[2012-09-27 23:39:56 -0400] jpb_: has anyone else had any issues getting test-kitchen to test a cookbook that references another private cookbook?
[2012-09-27 23:40:27 -0400] isotope: beandip I just removed the latest gem knife-rackspace-0.5.16 as I still had knife-rackspace-0.5.14 installed
[2012-09-27 23:40:30 -0400] isotope: all working again
[2012-09-27 23:40:54 -0400] beandip: ah
[2012-09-27 23:40:58 -0400] beandip: the gem did getupdated
[2012-09-27 23:41:00 -0400] beandip: cool
[2012-09-27 23:41:13 -0400] beandip: I had a ticket in opscode support to get it fixed in the gem
[2012-09-27 23:41:19 -0400] beandip: looks like they closed it as fixed
[2012-09-27 23:41:20 -0400] isotope: note to all knife-rackspace-0.5.16 = broken knife
[2012-09-27 23:41:20 -0400] _0x783czar: rava: the machine we were going to use as an automated MW (to automate some of the knife commands) has a bunch of dependency conflicts with chef, so we want to use the server itself as a Management Workstation.
[2012-09-27 23:41:21 -0400] beandip: :)
[2012-09-27 23:41:31 -0400] cheesepl_: ryan__: ohai should be the only source of automatic attributes
[2012-09-27 23:41:39 -0400] jpb_: I have a cookbook, call it nucleus, that I can test just fine with test-kitchen. I'm starting to write a second cookbook, atom, that includes the nucleus cookbook, and I cannot get test-kitchen to load nucleus at all :-(
[2012-09-27 23:41:44 -0400] beandip: isotope kninfe was never broken, just the rackspace lugin
[2012-09-27 23:41:58 -0400] rava: _0x783czar: that's ugly :) , but what's the output of using -v -v with the command?
[2012-09-27 23:42:33 -0400] isotope: beandip agreed, stoopid rackspace :-)
[2012-09-27 23:42:53 -0400] _0x783czar: rava: just the chef version.  or do you mean -V ?
[2012-09-27 23:43:21 -0400] rava: _0x783czar: si :)
[2012-09-27 23:44:11 -0400] _0x783czar: rava: no difference when using -V I still get "WARNING: Failed to connect to node[testingtestingtesting.pagodabox.com] -- Errno::ETIMEDOUT: Connection timed out - connect(2)"
[2012-09-27 23:45:33 -0400] rava: i was hoping it would give more info on the error, and you're on standard ssh port? does regular ssh to that box from that host work using a remote command?
[2012-09-27 23:49:56 -0400] _0x783czar: rava: DERP!  iptables rules.  the node I'm trying to access will only accept incoming ssh connections from one particular ipaddress.  since the chef server is on the same network I need it to use the internal ip.  Is there a way for a node to have multiple ipaddresses?
[2012-09-27 23:52:28 -0400] rava: _0x783czar: what do you mean?
[2012-09-27 23:52:37 -0400] rava: _0x783czar: chef doesn't care how many ip addresses something has
[2012-09-27 23:52:51 -0400] rava: _0x783czar: just use the right attribute
[2012-09-27 23:53:57 -0400] _0x783czar: rava: yes, but the ipaddress that chef has stored for that node is the external ip.  How do I go about adding another ip to my node?  Or is there some way to override the ipaddress?
[2012-09-27 23:54:12 -0400] _0x783czar: from this machine I need it to use the internal ip....
[2012-09-27 23:54:17 -0400] rava: _0x783czar: check out the node attributes, is it an ec2 address?
[2012-09-27 23:54:28 -0400] _0x783czar: rava: no
[2012-09-27 23:54:33 -0400] rava: _0x783czar: or some other cloud instance?
[2012-09-27 23:55:00 -0400] _0x783czar: rava: Softlayer
[2012-09-27 23:55:02 -0400] rava: _0x783czar: in either case, do a knife node show NODENAME -l
[2012-09-27 23:55:20 -0400] rava: and look for the node attribute that has the ip address you're looking for
[2012-09-27 23:55:36 -0400] rava: then just pass it like you were with the -a flag to knife ssh
[2012-09-27 23:57:10 -0400] _0x783czar: rava: is there a usual ohai attribute for the internal ip?
[2012-09-27 23:57:58 -0400] _0x783czar: rava: I think I may have found it...
[2012-09-27 23:58:42 -0400] rava: _0x783czar: that depends really on how ohai detects it. for me it has it in cloud.local_ipv4
[2012-09-27 23:58:54 -0400] rava: _0x783czar: that's with ec2 instances though
