[2012-09-08 00:03:23 -0400] whack: are 'depends' in a cookbook metadata meaningful? Like if I have something that needs runit, do I need to do any magic to make it aware?
[2012-09-08 00:03:34 -0400] coolie: i use my chef-server machine as workstation as well. so can i just use the client i setup on that machine (when i did knife configure -i) ?
[2012-09-08 00:03:44 -0400] coolie: or should i create another client which makes no sense to me?
[2012-09-08 00:09:53 -0400] bluepojo: whack: depends allows you to use libraries and such from other cookbooks.
[2012-09-08 00:10:10 -0400] bluepojo: whack: it also helps you enforce that the cookbook is available when you want to use include_recipe
[2012-09-08 00:11:50 -0400] jtimberman: whack: when using chef with a server, the "depends" tells the server the cookbooks to also send to the client.
[2012-09-08 00:12:01 -0400] jtimberman: when using solo, you have to ship all the cookbooks yourself
[2012-09-08 00:12:13 -0400] jtimberman: generally people just make a tarball for that
[2012-09-08 00:15:05 -0400] hoover_damm: wasn't there a rake task for that at one point?
[2012-09-08 00:19:11 -0400] Guest98780: Hi, i'm reading about chef, should I always have the chef-client running on the nodes? Or can I automatically launch it on all of them only when I want to apply some changes?
[2012-09-08 00:22:23 -0400] Guest98780: And in the case I should have it always running, do you suggest having god/monit to check that it's running?
[2012-09-08 00:23:37 -0400] Twirrim: Guest98780: you can have it run as a cron job if you want
[2012-09-08 00:23:55 -0400] Twirrim: Guest98780: alternatively you can run it as a service, it's entirely up to you :)
[2012-09-08 00:24:21 -0400] Twirrim: Guest98780: it is pull only, not push.  The client connects to the server to pull down changes, you can't set the server to push out changes.
[2012-09-08 00:24:55 -0400] Guest98780: Twirrim: eheh, sure. I'm trying to understand how everything works.. until now I've used chef just as a simple user (running my servers on engine yard)
[2012-09-08 00:26:03 -0400] Guest98780: I was trying to figure out how their "apply changes" works, as when I run it I think it'll run all the chef clients in order to update the single instances
[2012-09-08 00:26:20 -0400] hoover_damm: Guest98780, 'apply changes' fires off a chef-solo run
[2012-09-08 00:26:33 -0400] hoover_damm: Guest98780, that basically tears out  your cron jobs and reapplies them
[2012-09-08 00:28:17 -0400] jessicab: you could also run chef-client with a knife search.. but normally thats used when you need to update the clients inbetween the cron task or when it normally runs
[2012-09-08 00:29:32 -0400] jessicab: er i mean, using a search with knife ssh, like name:* if you wanted to run it on all of them - http://wiki.opscode.com/display/chef/Knife+Built+In+Subcommands#KnifeBuiltInSubcommands-SSH
[2012-09-08 00:30:15 -0400] Guest98780: understood :)
[2012-09-08 00:30:16 -0400] hoover_damm: Guest98780, if your coming from Engine Yard to just regular chef (solo) or hosted... you might find Rundeck or Fabric to be good enough.  You can always configure your capistrano file to fire off chef
[2012-09-08 00:30:19 -0400] Guest98780: that's cool :)
[2012-09-08 00:30:42 -0400] Guest98780: hoover_damm: I'll check on them, thanks
[2012-09-08 00:30:43 -0400] hoover_damm: not to knock knife it's just after 20 servers knife ssh feels weird
[2012-09-08 00:31:14 -0400] jtimberman: hoover_damm: like, when you use knife ssh to 20 servers?
[2012-09-08 00:31:46 -0400] hoover_damm: jtimberman, more like 250
[2012-09-08 00:32:02 -0400] hoover_damm: jtimberman, but I admit I also do complex stuf in fabric
[2012-09-08 00:32:19 -0400] hoover_damm: jtimberman, the one off ssh tool to just run random commands always scares me in the end
[2012-09-08 00:32:21 -0400] jtimberman: hoover_damm: yeah uh ... i have like, 7 systems that i run chef on regularly
[2012-09-08 00:32:27 -0400] jtimberman: two of those are laptops
[2012-09-08 00:32:52 -0400] hoover_damm: I honestly haven't counted how many instances we have in awhile
[2012-09-08 00:33:00 -0400] hoover_damm: I know it's over a thousand
[2012-09-08 00:34:18 -0400] Guest98780: I just hope that when we'll reach a lot of servers we'll have someone dedicated to them :)
[2012-09-08 00:34:52 -0400] hoover_damm: that's a good idea
[2012-09-08 00:35:14 -0400] hoover_damm: now is a good time to start that search while you get close :)
[2012-09-08 00:35:22 -0400] hoover_damm: you don't have to hire just keep an eye out :)
[2012-09-08 00:37:37 -0400] Guest98780: first I should finish to develop the application :) I'm just exploring chef as this time I'm thinking about going with the bare metal instead of cloud/paas providers
[2012-09-08 00:38:52 -0400] Guest98780: good, I'm not the only one with these strange thoughts :)
[2012-09-08 00:39:13 -0400] hoover_damm: the only time I was really for the cloud is when I worked for Engine Yard
[2012-09-08 00:39:14 -0400] hoover_damm: heh
[2012-09-08 00:39:38 -0400] hoover_damm: I was not for it before hand, and afterwards ... just feels good to show people the differences and let them decide
[2012-09-08 00:40:16 -0400] Guest98780: so you're damm from EY :) why have you left it if I can ask?
[2012-09-08 00:40:23 -0400] z: In the right situation, Cloud can be an enabler. Doesn't mean you have to use Public Cloud, its plenty possible these days to deploy behind the firewall, and PaaS is another debate entirely but in a SOA shop with 10+ applications it can be DRY for your infrastructure to some extent.
[2012-09-08 00:40:49 -0400] hoover_damm: Guest98780, I won't make that last portion public.
[2012-09-08 00:41:11 -0400] hoover_damm: Guest98780, but it was time for me to move on honestly.
[2012-09-08 00:43:10 -0400] Guest98780: z: yeah, sure. I like platform like EY, heroku, etc because you have everything ready to use, but the price is quite high for the performance you get from ec2 :(
[2012-09-08 00:43:18 -0400] Guest98780: hoover_damm: understood
[2012-09-08 00:43:47 -0400] Guest98780: I think that almost everywhere there are technical debts :)
[2012-09-08 00:43:57 -0400] hoover_damm: Technical debt is the ugly monster of almost all startups
[2012-09-08 00:44:01 -0400] hoover_damm: rarely spoken of
[2012-09-08 00:44:04 -0400] hoover_damm: always ugly
[2012-09-08 00:44:11 -0400] z: hoover_damm: s/all startups/everywhere/
[2012-09-08 00:44:32 -0400] hoover_damm: z, i'm not qualified to make said statement.  If you wish to think you are feel free
[2012-09-08 00:44:45 -0400] z: hoover_damm: I do, and I just did.
[2012-09-08 00:45:02 -0400] Guest98780: yeah... I know exactly that part... :-/
[2012-09-08 00:46:46 -0400] hoover_damm: the problem for me with technical debt isn't the debt itself
[2012-09-08 00:46:59 -0400] hoover_damm: it's how people get defensive, errational, emotional
[2012-09-08 00:47:43 -0400] hoover_damm: Guest98780, fwiw I just deployed 1.8TB of SSD today with 2 Sandybridge 6 core (12 Thread) CPU's
[2012-09-08 00:47:59 -0400] Guest98780: the fear of change... ;)
[2012-09-08 00:48:11 -0400] Guest98780: cool
[2012-09-08 00:48:36 -0400] hoover_damm: Guest98780, basically if you do metal only words of advise I have are disable cpu frequency scaling and ensure turbo is enabled
[2012-09-08 00:48:39 -0400] hoover_damm: Guest98780, and enjoy
[2012-09-08 00:49:42 -0400] Guest98780: I'll take it into consideration...
[2012-09-08 00:50:39 -0400] hoover_damm: we've been taking our time benchmarking just because we wanted the math
[2012-09-08 00:50:49 -0400] hoover_damm: feels good to have validation on your side
[2012-09-08 00:51:58 -0400] Guest98780: do you have any suggestion on some providers to use? at the moment I'm looking at Incero (having low budget)
[2012-09-08 00:52:38 -0400] hoover_damm: Guest98780, we use internap
[2012-09-08 00:52:56 -0400] hoover_damm: Guest98780, originally signed the contract as voxel, but they are internap now.
[2012-09-08 00:53:19 -0400] Guest98780: checking
[2012-09-08 00:53:20 -0400] hoover_damm: Guest98780, their cloud product isn't worth much itself but their metal and how fast they can spin it up
[2012-09-08 00:54:10 -0400] hoover_damm: the configurations and customization
[2012-09-08 00:54:28 -0400] Guest98780: I've also read good reviews about hetzner, they're a german hosting company
[2012-09-08 00:55:00 -0400] hoover_damm: your needs do change part of this equasion
[2012-09-08 00:55:05 -0400] hoover_damm: and where you need to be
[2012-09-08 00:55:39 -0400] hoover_damm: we didn't bother trying to stay in Equinix (Ashburn area) which cut our cost a bit
[2012-09-08 00:55:51 -0400] z: Guest98780: Codero, Softlayer, OVH/Hetzner (EU), Rackspace, ServerBeach, serverloft
[2012-09-08 00:56:13 -0400] z: Guest98780: a very short list of folks who'll do dedicated servers
[2012-09-08 00:56:14 -0400] hoover_damm: no baremetalcloud?
[2012-09-08 00:56:15 -0400] hoover_damm: lol
[2012-09-08 00:56:41 -0400] hoover_damm: honestly metal isn't that hard to find, it's just that people forgot how to find it
[2012-09-08 00:56:51 -0400] hoover_damm: or don't know how to find it
[2012-09-08 00:57:08 -0400] Guest98780: z: thanks :)
[2012-09-08 00:57:57 -0400] hoover_damm: I was like *doh* I had to have a confrence call to be told that there's a lack of people who have a clue with metal
[2012-09-08 01:09:19 -0400] joemiller: what's a metal?
[2012-09-08 01:10:03 -0400] hoover_damm: joemiller, crappy description for when you are bold enough to not want a hypervisor
[2012-09-08 01:15:39 -0400] nstielau: @joemiller, I think he meant 'medal'
[2012-09-08 01:16:45 -0400] hoover_damm: likely the term metal comes from your server being hosted in a metal case instead of a virtual container
[2012-09-08 01:17:05 -0400] joemiller: hrm.
[2012-09-08 01:18:00 -0400] joemiller: i always thought metal meant big mainframes
[2012-09-08 01:18:30 -0400] hoover_damm: joemiller, depends how long you've been around the industry
[2012-09-08 01:18:34 -0400] hoover_damm: joemiller, my father would agree with you
[2012-09-08 01:18:45 -0400] hoover_damm: and he was a PDP-11 programmer
[2012-09-08 01:19:33 -0400] joemiller: that was the first handheld playstation?
[2012-09-08 01:20:04 -0400] hoover_damm: joemiller, http://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Pdp-11-40.jpg/250px-Pdp-11-40.jpg
[2012-09-08 01:20:23 -0400] hoover_damm: http://en.wikipedia.org/wiki/PDP-11
[2012-09-08 01:20:26 -0400] hoover_damm: for the full article
[2012-09-08 01:34:03 -0400] timsmith: what kind of delay should I expect between chef runs and node attributes getting updated in solr
[2012-09-08 01:41:33 -0400] hoover_damm: timsmith, that can depend on how often you run and if there's a backup in the queue to update
[2012-09-08 01:41:56 -0400] hoover_damm: timsmith, if you review the expander logs you should be able to see when solr gets updated
[2012-09-08 01:43:31 -0400] timsmith: Over the last few hours I upgraded chef from 0.10.6 to 10.12 on a pile of clients, but it's not showing up on everything in search.  I'll take a peak at the logs
[2012-09-08 01:46:25 -0400] hoover_damm: timsmith, there's a notice about some maxFieldLength
[2012-09-08 01:46:38 -0400] hoover_damm: timsmith, http://tickets.opscode.com/browse/CHEF-2346
[2012-09-08 01:46:57 -0400] timsmith: you know I think I know what's going on
[2012-09-08 01:47:13 -0400] timsmith: I didn't restart the init script so the old gem is still in memory
[2012-09-08 01:50:19 -0400] timsmith: that fixed it
[2012-09-08 01:55:02 -0400] timsmith: well I think I just proved I can scale my chef install a bit more.  Every client in my environment ran at once without a problem
[2012-09-08 01:58:21 -0400] hoover_damm: :)
[2012-09-08 02:49:42 -0400] ssd7: Ohai Chefs
[2012-09-08 03:01:19 -0400] rockpunk: hey #chef, i'm in a tiny startup that's currently evaluating chef for use in deploying our application to client machines (which usually live behind client firewalls and that we have no control over).  We currently have a disgusting shell script which bootstraps the machine with all the needed software, and another script for deploying our application code. I'd like to unify this all under chef, both server bootstrap and application deplo
[2012-09-08 03:01:19 -0400] rockpunk: upgrades.  Does this seem like something chef can handle?
[2012-09-08 03:02:49 -0400] ssd7: rockpunk: Yes.
[2012-09-08 03:04:37 -0400] rockpunk: do you know of any other folks who might be using chef to deploy client-side applications in infrastructure you can't really access?
[2012-09-08 03:04:40 -0400] ssd7: Although, Chef's most powerful features require a chef-server.  Depending on your clients requirements and firewalls, setting up a server/using Hosted Chef may or may not be tenable.  You can still get a long way with chef-solo most likely.
[2012-09-08 03:05:49 -0400] rockpunk: Right, I don't think paying for each client node in hosted chef is tenable yet, but I also don't know if hosting and maintaining our own chef server is tenable either :)
[2012-09-08 03:05:55 -0400] rockpunk: There's a lot of moving parts in chef server
[2012-09-08 03:06:26 -0400] ssd7: rockpunk: FYI, Not ready for production yet, but the Chef 11 server has many fewer moving parts.
[2012-09-08 03:07:18 -0400] ssd7: rockpunk: Whether chef will work well for you will obviously depend on the details.  When you say "can't really access" what do you mean?  Will you be able to run chef-client or chef-solo on the target machines?
[2012-09-08 03:09:14 -0400] rockpunk: ssd7: thanks well, many of our clients have their own IT departments who usually provision bare metal (or ec2) servers for us. We then embarrassingly give them our disgusting shell script to deploy our app. (Needless to say, this doesn't always go swell.)  Sometimes in order to fix it, the client has to start a webex or goto meeting and give me remote screen control so I can fix things.  _definitely_ not tenable.
[2012-09-08 03:10:04 -0400] rockpunk: since our app also has a lot of moving parts, i'd like to simplify the process with something programatic.
[2012-09-08 03:10:46 -0400] rockpunk: so, i was thinking we'd replace our shell script with some sort of chef-client bootstrap process that will just take care of the rest
[2012-09-08 03:11:27 -0400] rockpunk: assuming we set up a client key for them before hand and pass it off to them during or before the install of chef-client.
[2012-09-08 03:11:48 -0400] ssd7: rockpunk: Rather than handing them over a shell script, you could hand them a tarball of cookbooks and some simple instructions for installing and running chef-solo.  Ideally you could have them run chef-client and then you would just be shipping them a config and client key and a few lines of instructions.
[2012-09-08 03:15:28 -0400] z: rockpunk: GitHub has their 'Enterprise' (behind the firewall) product which entirely uses chef-solo under the hood
[2012-09-08 03:16:09 -0400] z: rockpunk: It makes no assumptions or assertions around Internet access. It doesn't phone home. Long as the customer has the OVA for loading into VMware, license file and the 'ghp' (package) then you're set
[2012-09-08 03:17:34 -0400] ssd7: rockpunk: Also, Chef 11's configuration and setup is handled mostly by chef-solo under the hood as well.
[2012-09-08 03:17:42 -0400] ssd7: Chef 11 Server's configuration that is
[2012-09-08 03:18:10 -0400] rockpunk: ssd7: yes, that sounds beautiful. z, that's great to hear others doing this as well.  so, do you think chef-solo is more robust for this sort of thing vs a chef-client setup?
[2012-09-08 03:18:29 -0400] z: thats like comparing a horse to a llama
[2012-09-08 03:18:32 -0400] z: both have four legs
[2012-09-08 03:18:35 -0400] rockpunk: ha
[2012-09-08 03:18:39 -0400] z: but one whinnies and the other doesnt
[2012-09-08 03:18:50 -0400] rockpunk: got it, but llamas are ugly
[2012-09-08 03:18:58 -0400] z: you need to decide whether you want llama shit or horse shit in your living room.
[2012-09-08 03:18:59 -0400] rockpunk: tina, come get your ham
[2012-09-08 03:19:24 -0400] z: chef-client and the chef-server component gives you Search, which if you have a multi-tier app, can be hella handy
[2012-09-08 03:19:38 -0400] rockpunk: +1
[2012-09-08 03:19:44 -0400] z: if you're always just deployed on one node, then maybe you dont care as much
[2012-09-08 03:19:51 -0400] z: esp if your clients will be wary about things phoning home
[2012-09-08 03:20:08 -0400] z: its the same substrate underneath. its not *hard* to write recipes which work for both
[2012-09-08 03:20:26 -0400] z: its possible to determine what mode you're running in so you can if/else to cover both behaviours if you really want
[2012-09-08 03:20:47 -0400] whack: Question - it appears that you cannot 'notifies' a resources before it exists, but I'm tryign to notify a service and I don't want it to start until after I write a config file. Thoughts?
[2012-09-08 03:21:06 -0400] rockpunk: got it. thanks z and ssd7 for your help.  i'm going to go try some things out. :)
[2012-09-08 03:21:12 -0400] z: rockpunk: rock on ;)
[2012-09-08 03:21:17 -0400] ssd7: rockpunk: have fun!
[2012-09-08 03:21:30 -0400] rockpunk: later
[2012-09-08 03:21:49 -0400] z: whack: If you're doing a notify from within the same cookbook as the service, that *shouldnt* be a problem AFAICT
[2012-09-08 03:22:48 -0400] whack: z: https://gist.github.com/78ee424d4d1856241752
[2012-09-08 03:22:59 -0400] z: actually ignore me
[2012-09-08 03:23:04 -0400] z: can you just create the service with action :nothing?
[2012-09-08 03:23:56 -0400] whack: no idea what the runit cookbook supports
[2012-09-08 03:24:07 -0400] z: ugh runit
[2012-09-08 03:24:15 -0400] z: paging jtimberman
[2012-09-08 03:24:17 -0400] whack: I"m used to puppet where this kind of stuff is fairly straight forward to describe ;)
[2012-09-08 03:24:21 -0400] whack: hah
[2012-09-08 03:24:34 -0400] whack: yeah I'm not entirely sure how the runit_service define supports notifies, if at all
[2012-09-08 03:24:44 -0400] z: instead of #monitoringsucks we need #processmanagementsucks
[2012-09-08 03:24:57 -0400] z: because I've yet to meet a process management framework or process supervision tool which I don't loathe
[2012-09-08 03:25:10 -0400] whack: hah, runit is just fine for that I think, at least comapred to alternatives (upstart,systemd,supervisord,monit,god)
[2012-09-08 03:25:24 -0400] z: and before the SmartOS wonks pipe up and say SMF is sexual, NO.
[2012-09-08 03:25:27 -0400] whack: I'm a fairly long-time user of daemontools though, so the simplicity of runit is appealing ;)
[2012-09-08 03:26:16 -0400] ssd7: We all just need to move to systemd and call it a day.
[2012-09-08 03:26:53 -0400] hoover_damm: +1
[2012-09-08 03:27:09 -0400] hoover_damm: whack, you forgot s6
[2012-09-08 03:27:33 -0400] z: yeah so you basically can't notify runit_service
[2012-09-08 03:27:56 -0400] z: however
[2012-09-08 03:28:11 -0400] z: you could probably use http://wiki.opscode.com/display/chef/Resources#Resources-Service
[2012-09-08 03:28:23 -0400] z: and pass start_command and stop_command to do runit stuff
[2012-09-08 03:28:34 -0400] ssd7: The runit_service defintion should end up creating an actual "service" resource that you can notify I believe
[2012-09-08 03:28:36 -0400] z: thereby giving yourself a notifiable Service
[2012-09-08 03:28:48 -0400] z: ssd7: /me looks...
[2012-09-08 03:28:59 -0400] z: (not having ever used runit_service in anger)
[2012-09-08 03:29:49 -0400] z: https://github.com/cookbooks/runit/blob/master/definitions/runit_service.rb#L147
[2012-09-08 03:31:59 -0400] z: whack: It looks like you could .. notifies :restart, "service[elasticsearch]"
[2012-09-08 03:32:50 -0400] whack: ssd7: notifying the service sort of defeats the purpose of abstracting it doesn't it?
[2012-09-08 03:33:02 -0400] z: whack: and runit_service looks like it creates that for you, based on L147 pasted above.
[2012-09-08 03:33:04 -0400] whack: I'm willing to patch it, but I'm not sure what needs to be done.
[2012-09-08 03:33:07 -0400] z: anyway thats all I got ;)
[2012-09-08 03:33:28 -0400] z: whack: https://gist.github.com/a2df25119365bca4a61b
[2012-09-08 03:33:51 -0400] whack: that still doesn't answer my question I think, though. The error I'm getting says the resource 'runit_service[elasticsearch]' doesn't exist, so even if I fixed the notification, it wouldn't work anyway
[2012-09-08 03:33:59 -0400] z: yeah
[2012-09-08 03:34:03 -0400] z: runit_service isn't a resource
[2012-09-08 03:34:05 -0400] z: its a definition
[2012-09-08 03:34:10 -0400] whack: oh, so not like puppet then
[2012-09-08 03:34:19 -0400] z: it *could* be a resource
[2012-09-08 03:34:22 -0400] z: 'service' is a resource
[2012-09-08 03:34:23 -0400] whack: there's no way to notify a definition?
[2012-09-08 03:34:35 -0400] hoover_damm: basically runit needs to be lwrp
[2012-09-08 03:34:40 -0400] z: damm is correct :-)
[2012-09-08 03:34:47 -0400] whack: ahh, weak.
[2012-09-08 03:34:58 -0400] hoover_damm: right
[2012-09-08 03:35:04 -0400] z: whack: the definition creates the service for you, which *is* notifiable
[2012-09-08 03:35:08 -0400] hoover_damm: you could write up your own service block with start and stop commands
[2012-09-08 03:35:11 -0400] hoover_damm: and notify that
[2012-09-08 03:35:19 -0400] z: and I'm guessing someone will LWRP it soon and the definition will just go >POOF< and vanish entirely
[2012-09-08 03:35:22 -0400] hoover_damm: hella crufty
[2012-09-08 03:35:42 -0400] hoover_damm: z, more likely someone will lwrp it and then delete the repo tomorrow
[2012-09-08 03:35:47 -0400] z: its becoming rarer and rarer to see definitions
[2012-09-08 03:35:59 -0400] ssd7: z: your example woudl work if you just put runit_service first I believe
[2012-09-08 03:36:04 -0400] hoover_damm: I should introduce you to some old chef 0.6 code z
[2012-09-08 03:36:10 -0400] z: I remember it :)
[2012-09-08 03:36:23 -0400] hoover_damm: not the code Ihave :)
[2012-09-08 03:36:45 -0400] whack: changing it to notify service[...] worked without changing the order
[2012-09-08 03:36:58 -0400] whack: made sure to put a comment in about how it's lame ;)
[2012-09-08 03:37:10 -0400] z: lame but works :P
[2012-09-08 03:37:27 -0400] whack: z: I don't really support lame, I suppose I"ll have to do one of these lwrp things then
[2012-09-08 03:37:30 -0400] whack: hehe
[2012-09-08 03:37:36 -0400] z: i was actually planning to use Runit a bunch more for $job[0] so I may well need to LWRP that
[2012-09-08 03:37:41 -0400] z: lwrp is pretty trivial
[2012-09-08 03:37:58 -0400] ssd7: whack: z: so notifying services created by runit_service should work
[2012-09-08 03:38:00 -0400] ssd7: https://gist.github.com/3671608
[2012-09-08 03:38:23 -0400] z: thats what he has now IMO
[2012-09-08 03:38:52 -0400] z: albeit without the attr-based enable/disable toggle
[2012-09-08 03:40:14 -0400] ssd7: Oh, I see. I'm not paying enough attention tonight.
[2012-09-08 03:40:36 -0400] z: whack: Are you attempting to make consuming Logstash easier?
[2012-09-08 03:40:53 -0400] whack: nod, my confusion came from mostly carrying puppet knowledge; you can notify defines in puppet ;)
[2012-09-08 03:41:19 -0400] whack: z: working on deploying it at work. Hoping to release configs/cookbooks whenever they mature enough
[2012-09-08 03:41:29 -0400] hoover_damm: can logstash really be any easier?
[2012-09-08 03:41:32 -0400] whack: got a 14 machine cluster to deploy it on :D
[2012-09-08 03:41:35 -0400] hoover_damm: i mean it really is easy
[2012-09-08 03:41:47 -0400] whack: hoover_damm: definitely, lots of warts right now (especially around debugging, new user experience, etc)
[2012-09-08 03:41:49 -0400] ssd7: whack: There are some pretty good community cookbooks out there already I believe.  Might want to contribute to those.
[2012-09-08 03:42:03 -0400] hoover_damm: whack, usual
[2012-09-08 03:42:08 -0400] z: whack: we're still pretty stuck in terms of our deployment, went back to Splunk, some weird ES amplification issue
[2012-09-08 03:42:24 -0400] whack: ssd7: indeed; mainly started writing this one because I need to learn chef anyway and the existing ES cookbooks I found were far from what I wanted
[2012-09-08 03:42:28 -0400] hoover_damm: our logstash setup is quite solid
[2012-09-08 03:42:32 -0400] hoover_damm: no reason to mess with it
[2012-09-08 03:42:44 -0400] whack: z: amplification in terms of data size?
[2012-09-08 03:42:49 -0400] z: whack: yea about 5x
[2012-09-08 03:43:02 -0400] whack: z: yeah, the new ES compression helps by 2-3x reduction
[2012-09-08 03:43:32 -0400] ssd7: z: Interesting.  I'm currently running it as an experiment in one of non-production environments, putting that on my list of items to look out for.
[2012-09-08 03:43:34 -0400] z: whack: which for us is basically show-stopper, even at our current Splunk load, never mind if we were *able* to enable logging all the things
[2012-09-08 03:44:19 -0400] whack: z: the main problem is going from crappy plain text logs to JSON, without being careful you can go from a 100 byte string to a 500-1000 byte json payload
[2012-09-08 03:44:51 -0400] whack: https://gist.github.com/2934066 <-- example
[2012-09-08 03:44:53 -0400] z: oh yeah, I wasn't the engineer working our Logstash efforts, but I saw your JSON-related Twitter rage and assumed it was related
[2012-09-08 03:45:00 -0400] whack: hah, nod
[2012-09-08 03:45:28 -0400] whack: will experiment soon with different json schemas to see how I can do better at storage size
[2012-09-08 03:45:45 -0400] z: the value of Logstash vs Splunk was not paying for volume
[2012-09-08 03:45:53 -0400] whack: plus there's a few ES-side optimizations you can do that need to be the default
[2012-09-08 03:46:09 -0400] whack: z: for now, yeah, soon it'll beat it on features and performance as well ;)
[2012-09-08 03:46:12 -0400] z: not that we'd increase verbosity, its just we have a lot of apps we'd like to log centrally which don't today ;)
[2012-09-08 03:46:21 -0400] whack: where soon == 1-3 years
[2012-09-08 03:46:57 -0400] z: so the context is that 5x costs me huge. 30 days retention becomes like >50TB data
[2012-09-08 03:47:16 -0400] hoover_damm: z, grab your cloud cape
[2012-09-08 03:47:21 -0400] hoover_damm: j/k
[2012-09-08 03:47:56 -0400] hoover_damm: but I've also grown to the point where I do what I have to do, to survive
[2012-09-08 03:48:03 -0400] hoover_damm: that's why I upgraded to 1.8TB for a graphite server
[2012-09-08 03:48:10 -0400] hoover_damm: massively overprovisioning
[2012-09-08 03:48:28 -0400] z: whack: Oh I think the business case today is sound if a few niggly things like ES can get addressed. End of the day a Splunk license is $x and uses $y in hardware. Logstash can use significantly more hardware and still be cheaper.
[2012-09-08 03:48:56 -0400] z: whack: Performance wise RAM is pretty darn cheap these days, SSD all the things is becoming our motto, etc
[2012-09-08 03:49:13 -0400] whack: z: nod, with the latest logstash+es you can cut that 5x into 2.5x without making any chagnes other than saying "compress this, yo"
[2012-09-08 03:49:41 -0400] z: whack: $job[0]["boss"] acquiesced to my "CAN HAZ SSD CLOUD?" so there's *no* spinning disks in that
[2012-09-08 03:49:45 -0400] whack: z: nod, I did some math with mark imbriaco a few weeks back computing the costs; even factored in 2 full-time engineers working on it and it was about even
[2012-09-08 03:49:50 -0400] hoover_damm: z, dedicated san for logstash?
[2012-09-08 03:49:55 -0400] hoover_damm: i can see it
[2012-09-08 03:49:58 -0400] z: hoover_damm: what is this SAN word you speak of?
[2012-09-08 03:50:23 -0400] whack: z: I'll publish what I find at the end of this month after doing some more testing; I think I can get raw 'apache log' to json to inflate only 1.5 or maybe 2x (vs 5x as corrent)
[2012-09-08 03:51:12 -0400] z: whack: That'd be neat. I'm busy on 'mundane things' like building out a new datacenter right now, but I'ma probably be back around to logging by November, and even the 2.5x would probably be okay
[2012-09-08 03:51:21 -0400] z: whack: so its good to hear thats there already ;)
[2012-09-08 03:51:23 -0400] whack: z: righto
[2012-09-08 03:51:42 -0400] hoover_damm: z, emc.com
[2012-09-08 03:51:51 -0400] hoover_damm: and ihope that was in jest
[2012-09-08 03:51:51 -0400] whack: z: can you email me with details on your deployment? (data rates, sample events maybe, expected retention, daily log size, etc)
[2012-09-08 03:52:01 -0400] z: hoover_damm: yea, er, I have no need for any of that in my datacenter
[2012-09-08 03:52:06 -0400] z: whack: I work for Imbriaco
[2012-09-08 03:52:11 -0400] whack: z: oh, hah
[2012-09-08 03:52:11 -0400] z: whack: you have the data ;)
[2012-09-08 03:52:15 -0400] whack: I have the data then! :)
[2012-09-08 03:52:24 -0400] z: whack: http://github.com/agh
[2012-09-08 03:52:43 -0400] whack: z: ahha, howdy! :)
[2012-09-08 03:54:38 -0400] z: hoover_damm: Aside from /maybe/ looking at Pure Storage as a way to get Flash storage into IaaS instances so that MySQL can be moved into private cloud, I can contemplate precisely no situations where I'd require an EMC SAN in my day job, and my shared storage at HP Cloud was basically just some cheap P4000 iSCSI shelves to make ESX happy.
[2012-09-08 03:55:16 -0400] hoover_damm: z, I've only watched them fall over
[2012-09-08 03:55:27 -0400] z: P4000s?
[2012-09-08 03:55:33 -0400] hoover_damm: z, I have never worked for an employer who wanted to throw that kinda money away
[2012-09-08 03:55:41 -0400] hoover_damm: not p4000's
[2012-09-08 03:55:48 -0400] hoover_damm: atmos emc sans
[2012-09-08 03:56:09 -0400] hoover_damm: z, sometimes walking through random datacenters you can see offensive horrible events
[2012-09-08 03:56:12 -0400] z: the banks I occasionally consult for are in *love* with Symmetrix
[2012-09-08 03:56:43 -0400] hoover_damm: many times walking through savvis have I seen EMC sans moved by amatuer movers
[2012-09-08 03:56:52 -0400] hoover_damm: and them picking the disks up off the floor
[2012-09-08 03:56:59 -0400] countdigi: been there :-)
[2012-09-08 03:57:28 -0400] countdigi: i wouldnt let these guys move a lamp in my apartment and they are haulin 1 mil units
[2012-09-08 03:57:39 -0400] z: whack: 0500 so zzZZzZZZ time but shout if you have any issues with the Logstash chef stuff
[2012-09-08 03:57:46 -0400] z: countdigi: 1mil is the cheap unit
[2012-09-08 03:58:23 -0400] hoover_damm: get some 3par sata
[2012-09-08 03:58:28 -0400] hoover_damm: apply xen
[2012-09-08 03:58:34 -0400] countdigi: yeah i know they can get expensive w/ lots of cache, directors, and high spindle count
[2012-09-08 03:58:49 -0400] z: lol 3par
[2012-09-08 03:58:51 -0400] countdigi: then add some snapshot and srdf and ur salesman has a new yacht :-)
[2012-09-08 03:59:15 -0400] hoover_damm: I only say 3par sata because many times have I had that sale been put in my face and I laugh each time
[2012-09-08 03:59:18 -0400] hoover_damm: and throw it away
[2012-09-08 03:59:37 -0400] hoover_damm: that and Terrormark actually has a 3par with sata disks in it
[2012-09-08 03:59:46 -0400] hoover_damm: not SSD, rust
[2012-09-08 04:01:25 -0400] hoover_damm: not sure I care looking back
[2012-09-08 04:02:17 -0400] z: Pure Storage is around 8U and $250k for 50TB usable storage, and a decent config. Thats darn reasonable.
[2012-09-08 04:03:26 -0400] hoover_damm: you mentioned vmware a few times i assume you get the joy of it now?
[2012-09-08 04:04:14 -0400] z: $job[-1] runs some, $job[0] has I think one box on a free license. I used to manage a much larger ESX3 and ESX4 estate.
[2012-09-08 04:04:19 -0400] hoover_damm: that must be 8D
[2012-09-08 04:04:34 -0400] hoover_damm: or oddly enough it mocks the performance of my 8D SSD boxes
[2012-09-08 04:04:38 -0400] hoover_damm: weird
[2012-09-08 04:04:45 -0400] hoover_damm: s/mock/is on par
[2012-09-08 04:04:56 -0400] z: our IaaS is all 8D SSD
[2012-09-08 04:04:58 -0400] hoover_damm: says 12 ports so i woulda thought more
[2012-09-08 04:05:50 -0400] hoover_damm: then again you toss in load balancing and other features and ugh screw scaling
[2012-09-08 04:05:57 -0400] hoover_damm: too many men in the picture at that point
[2012-09-08 04:08:07 -0400] hoover_damm: z, vmware certified then?
[2012-09-08 04:08:50 -0400] z: yes
[2012-09-08 04:09:10 -0400] z: don't get much use of that, and haven't for 4-5 years. No great loss.
[2012-09-08 04:09:24 -0400] z: http://www.purestorage.com/blog/video-blog-pure-storage-architecture-whiteboard-session/
[2012-09-08 04:09:27 -0400] z: http://www.purestorage.com/blog/whiteboard-video-blog-pure-storage-resiliency-and-high-availability/
[2012-09-08 04:09:30 -0400] z: Are both interesting talks.
[2012-09-08 04:13:16 -0400] z: ssd7: Did you find a ticket for runit_service LWRP-ing?
[2012-09-08 04:18:42 -0400] hoover_damm: https://github.com/jtimberman/runit/tree/CHEF-154
[2012-09-08 04:18:46 -0400] hoover_damm: ^^ whack
[2012-09-08 04:22:08 -0400] whack: will put that on the todo list
[2012-09-08 04:26:19 -0400] hoover_damm: yeah i just made a ticket and passed it off to a teammate
[2012-09-08 04:28:10 -0400] hoover_damm: systemd is going to be our goal likely just so we can have service dependency
[2012-09-08 04:28:33 -0400] hoover_damm: sucks when your webapp is up and mongos has crashed and nothing restarted it and your web app is serving 500's
[2012-09-08 04:29:03 -0400] hoover_damm: fail and pull it down until it can be started
[2012-09-08 04:29:47 -0400] hoover_damm: but when you run 256 app nodes, you can pull down a node because it's failing a lot easier then when you have 1 instance on ec2.
[2012-09-08 04:52:05 -0400] jtimberman: whack, z: i have a branch of a mostly complete conversion of runit_service definition to a LWRP.
[2012-09-08 04:52:26 -0400] jtimberman: oh, hoover_damm said it while i was reading scrollback :)
[2012-09-08 04:52:33 -0400] jtimberman: not while, but didn't get that far yet.
[2012-09-08 04:52:37 -0400] jtimberman: anyway. sleep time
[2012-09-08 04:52:43 -0400] jtimberman: good weekend to ya, chefs!
[2012-09-08 04:52:52 -0400] whack: jtimberman: word
[2012-09-08 04:54:06 -0400] ssd7: have a nice weekend jtimberman !
[2012-09-08 07:56:37 -0400] hellsings: hi :)
[2012-09-08 09:36:22 -0400] hellsings: is there a way to send back to chef server an execute command output (stdout) on chef client ?
[2012-09-08 10:07:41 -0400] z: hellsings: http://wiki.opscode.com/display/chef/Exception+and+Report+Handlers
[2012-09-08 13:06:46 -0400] BryanWB: ohai chefs!
[2012-09-08 14:46:37 -0400] countdigi: ohai
[2012-09-08 14:55:15 -0400] mika__: hi, I'm browsing http://community.opscode.com/cookbooks , do you know if there is a way to sort the results/categories by the most downloaded? It would be very useful to immediately see useful packages that I haven't thought about
[2012-09-08 15:16:59 -0400] countdigi: good question - they are actually on github at https://github.com/opscode-cookbooks
[2012-09-08 15:17:08 -0400] countdigi: wondering if w/ some api calls that might be possible
[2012-09-08 15:19:12 -0400] mika__: yeah, I'm looking at https://github.com/opscode/cookbooks too, but it's hard to find out quickly what would be useful (ie. most installed)
[2012-09-08 15:20:12 -0400] mika__: I've checked the api (http://wiki.opscode.com/display/chef/Cookbook+Site+API) but it doesn't say anything about order/sort... just the number of items returned, and they don't even include the # of downloads
[2012-09-08 15:21:43 -0400] mika__: it's also hard to find a "best cookbooks for chef" list on google, as it returns food results :)
[2012-09-08 15:22:20 -0400] countdigi: apache is a good one to start w/
[2012-09-08 15:28:29 -0400] countdigi: man i feel far from chef right now - allocating 1000s of raw lvs in aix for oracle restore ... lol
[2012-09-08 15:28:39 -0400] countdigi: well using ruby to help out... guess not too bad
[2012-09-08 15:29:53 -0400] mika__: i was thinking more for: nginx, unicorn, git, chef-client, memcached, ruby, god, postgresql, exim or postfix, at least to start... then I'll have to find out how to deploy everything from github, if using capistrano or what else (as I'll like to launch it from a campfire chat...github style ;) )
[2012-09-08 15:30:11 -0400] mika__: lol
[2012-09-08 15:30:17 -0400] countdigi: ah w/ hubot
[2012-09-08 15:30:22 -0400] countdigi: yeah i wanted to mess w/ that
[2012-09-08 15:32:09 -0400] mika__: yup.. I played while ago using some script already made (I'll need to learn javascript someday :) ) and it's nice... I actually run it on a talkerapp room instead of campfire, but I see that campfire has stuff for everything, even a chef error notifier
[2012-09-08 15:37:45 -0400] maxmanders: Trying to get to grips with the Chef terminology by using Chef-Solo to provision Vagrant.  So, I'd create generic roles, e.g. lam-server; django-server.  I'd apply the role.  Then I'd create recipes that actually configure a role for a particular app instance (checkout source, configure VHOST that sort of thing), then apply that recipe _after_ the generic role... does that sound correct?
[2012-09-08 15:38:51 -0400] JoshuaMiller: You configure a role, which will specify which recipes to include for that role
[2012-09-08 15:43:35 -0400] maxmanders: JoshuaMiller: I thought roles were meant to be more generic than that - I.e. I might want a lamp server; I thought that would be a role.  But I might want different apps on different servers so I thought when provisioning both I'd specify the lamp server role, but then refine each server with a specific recipe
[2012-09-08 15:43:59 -0400] maxmanders: JoshuaMiller: Are you suggesting that I'd instead have a role for lamp-server-1-app-foo and lam-server-2-some-other-app?
[2012-09-08 15:44:34 -0400] countdigi: you add a role to the runlist of a specific server and then you could add additional recipies to
[2012-09-08 15:44:51 -0400] countdigi: but variation may occur in the attributes as opposed to recipe
[2012-09-08 15:44:55 -0400] countdigi: as well
[2012-09-08 15:45:36 -0400] countdigi: a role can have attributes and then the individual instance may override some attributes
[2012-09-08 15:45:38 -0400] maxmanders: Okay, so role = generic purpose; recipe = more specific app refinements; attributes = fine grained configurtations
[2012-09-08 15:46:10 -0400] maxmanders: countdigi: That makes sense... so I'd expet most per-application vrariation in specific recipes and attribute overrides...
[2012-09-08 15:47:07 -0400] maxmanders: Thank you both :-)
[2012-09-08 15:47:17 -0400] countdigi: lets take a simple example like an apache webserver
[2012-09-08 15:47:53 -0400] countdigi: role: common-webserver has cookbooks apache and mysql w/ some common attributes defined in the role
[2012-09-08 15:48:02 -0400] countdigi: then on one box you want to add memcached
[2012-09-08 15:48:22 -0400] countdigi: you would put the role common-webserver in the runlist for that node and then add the cookbook/recipe memcached as well
[2012-09-08 15:49:07 -0400] maxmanders: Okay, sounds sensible...
[2012-09-08 15:49:43 -0400] countdigi: definitely check out http://wiki.opscode.com/display/chef/Setting+Attributes+(Examples)
[2012-09-08 15:50:17 -0400] maxmanders: And where do e.g. configuring the apache virtual hosts for a particular app come in to play?  And should Chef be used for also e.g. checking out an instance of the app from e.g. source code - or should that be clearly separated as a developer build task?
[2012-09-08 15:50:20 -0400] JoshuaMiller: Optionally, you could make a second role for memcached, include your memcached recipe, and attach both roles to a system that meets that description.
[2012-09-08 15:50:38 -0400] countdigi: JoshuaMiller: that would be too easy what the heck? ;-)
[2012-09-08 15:51:21 -0400] countdigi: maxmanders: check out the deploy resource for that
[2012-09-08 15:51:54 -0400] maxmanders: Great - that makes things clear - just want to do things the correct way from the outset, and keep things as detached as possible
[2012-09-08 15:51:56 -0400] countdigi: or the developer can use capistrano, fabric, etc.
[2012-09-08 15:52:00 -0400] countdigi: out-of-band
[2012-09-08 15:53:41 -0400] maxmanders: Moving forward a little... say I'm using Chef to provision e.g. on-demand ec2 instances for scaling an app across multiple servers... that would be an instance where I _would_ want the app code to be part of the provisioning , with a generic load balancer maching somewhere?
[2012-09-08 15:54:54 -0400] JoshuaMiller: God bless you.
[2012-09-08 15:56:26 -0400] JoshuaMiller: Generically speaking, you can use chef to do searches (say, based on a role), and have your configuration take the membership into account.
[2012-09-08 15:56:29 -0400] countdigi: havent done that yet but afaik u would want to use a deploy resource, and then in ur lb recipe use search to detect the additional nodes and reconfigure
[2012-09-08 15:56:53 -0400] 1JTAACUCU: have an attribute question...
[2012-09-08 15:57:05 -0400] JoshuaMiller: That said, I bet there are caveats with ec2 specifically, but to which I can't speak.
[2012-09-08 15:57:07 -0400] 1JTAACUCU: in a recipe, i want to do something like this:
[2012-09-08 15:57:09 -0400] 1JTAACUCU:   node[:xen][:vlans].each do |vlan|
[2012-09-08 15:57:09 -0400] 1JTAACUCU:     Chef::Log.info "#{vlan.inspect}"
[2012-09-08 15:57:28 -0400] 1JTAACUCU: this doesn't work as an attribute: default[:xen][:vlans]= [ 7, 9, 8 ]
[2012-09-08 15:57:43 -0400] 1JTAACUCU: this does, and I'm confused: node[:xen][:vlans]= [ 7, 9, 8 ]
[2012-09-08 15:58:16 -0400] maxmanders: Thanks countdigi and JoshuaMiller - tht's enough food for thought for now - I think I'll carry on with baby steps and see how I get on...
[2012-09-08 15:59:21 -0400] countdigi: illumination by experimentation.. always a good choice like sam adams :-)
[2012-09-08 16:00:32 -0400] JoshuaMiller: 1JTAACUCU: Where are you setting your attribute?
[2012-09-08 16:00:54 -0400] 1JTAACUCU: attributes/default.rb
[2012-09-08 16:01:28 -0400] JoshuaMiller: When you say "doesn't work", what isn't working?
[2012-09-08 16:02:25 -0400] 1JTAACUCU: when the prefix is set to default, it doesn't log. when it's set to node, it logs just fine
[2012-09-08 16:03:08 -0400] 1JTAACUCU: oh, hey Joshua wil here :)
[2012-09-08 16:03:15 -0400] mika__: is just me or https://manage.opscode.com is reeeeaallly slow?
[2012-09-08 16:03:34 -0400] JoshuaMiller: Try 'knife node show <node_name> -Fj' and see if the attributes are actually set
[2012-09-08 16:04:01 -0400] countdigi: this is going to happen _before_ converge right? because its not in a rule
[2012-09-08 16:04:08 -0400] countdigi: resource
[2012-09-08 16:06:16 -0400] countdigi: im not sure but just throwin it out there... could it be that default gets set before converge but node is not set until converge starts? its a stretch i know
[2012-09-08 16:06:21 -0400] 1JTAACUCU: yea, they aren't set when it's set to default. must be a behavior change?
[2012-09-08 16:06:41 -0400] countdigi: ah im sorry i said it backward
[2012-09-08 16:07:04 -0400] countdigi: wonder if u wrapped this in a ruby block resource
[2012-09-08 16:07:15 -0400] hajile: has anyone tried to bootstrap a chef-server using the chef-solo method on OEL?
[2012-09-08 16:07:45 -0400] hajile: I went through and modified all the recipes to include support for the oracle platform type, but now i'm getting a bizarre ruby error
[2012-09-08 16:08:02 -0400] hajile: No such file or directory - nil/gems/chef-10.14.0/distro/redhat/etc/sysconfig/chef-solr
[2012-09-08 16:08:11 -0400] hajile: it's not prepending /opt/chef/...
[2012-09-08 16:10:21 -0400] JoshuaMiller: Is your vlan.inspect code running in a ruby_block?
[2012-09-08 16:11:20 -0400] JoshuaMiller: I don't have a good grip on convergence and the anatomy of a chef run, but your attributes might not be set at the time the block is executed.
[2012-09-08 16:11:37 -0400] 1JTAACUCU: it's not in a block
[2012-09-08 16:11:44 -0400] countdigi: JoshuaMiller: me either but i concur i am guessing thats the issue
[2012-09-08 16:12:09 -0400] JoshuaMiller: Do you have that attribute being set somewhere else in your configuration?  i.e. at a node, environment, role level?
[2012-09-08 16:12:25 -0400] JoshuaMiller: Or an override
[2012-09-08 16:12:40 -0400] 1JTAACUCU: no, this is the only place they are defined
[2012-09-08 16:15:01 -0400] JoshuaMiller: Alas, I dunno.  When we specify attributes in a cookbook we use the "default" keyword, not node
[2012-09-08 16:16:02 -0400] countdigi: wrap it up in a ruby block resource and see what u get?
[2012-09-08 16:18:11 -0400] JoshuaMiller: I'm not familiar with .inspect - you might try taking that off to see if there's something funky with that function
[2012-09-08 16:18:57 -0400] countdigi: it is in ruby kernel it does a basic enumeration of an object (instance variables, etc.)
[2012-09-08 16:19:15 -0400] countdigi: sorry method in Object
[2012-09-08 16:19:29 -0400] countdigi: if i was typing that in ruby-lang i would have already been b*tchslapped :-)
[2012-09-08 16:29:26 -0400] 1JTAACUCU: in case you're curious, this seems to set the attributes: set[:xen][:vlans] = [ 7, 9, 8, 12 ]
[2012-09-08 16:29:36 -0400] Loof: Ugh, chef client on windows is giving me headaches... the windows::network and/or ec2 plugin take 6mins to get something (I think userdata, oddly enough)
[2012-09-08 16:29:44 -0400] Loof: and now windows::virtualization plugin crashed
[2012-09-08 16:38:38 -0400] sascha_d: Loof... are you using the latest chef? 10.14? I'm doing some dev work with it on windows this morning also and I think it's a little rocket
[2012-09-08 16:38:40 -0400] sascha_d: rocky
[2012-09-08 16:39:03 -0400] sascha_d: I had to download a patch for the new formatters so that I could get some coherent error messages
[2012-09-08 16:52:53 -0400] hajile: well, if anyone has a moment.. I'm running into problems with the chef-solo chef-server bootstrap install on OEL 6.2: https://gist.github.com/3677089
[2012-09-08 16:53:40 -0400] alexbst: my devops department just merged with the corporate IT dept
[2012-09-08 16:53:45 -0400] alexbst: heh
[2012-09-08 16:59:06 -0400] ssd7: sascha_d: Other than the formatter's issue, what kind of issues are you seeing on Windows?
[2012-09-08 17:02:19 -0400] sascha_d: ssd7I'm not sure yet that there's anything more. I don't work on windows enough to to know when it's an existing eccentricity. For example, an execute resource usually allows execute "my actual command" but it took me a while to discover that windows_batch wasn't untarring my file because it didn't regard the name attribute as an actual command, but just a label
[2012-09-08 17:03:32 -0400] sascha_d: last night I kept trying to use the ark cookbook by removing a few unix-centric required attributes (mode, gid) and kept getting the vague errors that I thought were legit until I discovered it was the formatters this morning
[2012-09-08 17:04:15 -0400] ssd7: hrmmm. I'm mostly worried about regressions at the moment, but that windows_batch issue does sound like a bug.
[2012-09-08 17:04:17 -0400] sascha_d: so it's just more that I'm stubbing my toe a lot this morning and last night and the formatters were at the root of quite a bit and I didn't realize it until my run failed on an actual recipe file
[2012-09-08 17:05:08 -0400] sascha_d: an actual recipe file that I myself wrote that is. I finally realized when it said "loading X recipe" and then puking on me instead of giving me a line number that there must be a 10.14 bug
[2012-09-08 17:05:49 -0400] sascha_d: on the upside, the new formatters are the BOMB when they work
[2012-09-08 17:06:40 -0400] ssd7: Indeed.  The amount of time the error inspectors have been saving me is amazing
[2012-09-08 17:06:51 -0400] sascha_d: because once I got them going, they immediately caught and highlighted something that I thought last night "Oh I'll remember to fix that" and then completely forgot until the declared vs compiled resource show it to me with blinking neon
[2012-09-08 17:07:02 -0400] sascha_d: <3
[2012-09-08 17:08:28 -0400] sascha_d: On one hand, it's nice that I can read chef errors and know what the problem is despite its esoteric nature; on the other hand, yay for plain english
[2012-09-08 17:09:21 -0400] ssd7: Right. I didn't really realize the cognitive load of debugging until it was removed and there was an arrow(>>) pointing at my error.
[2012-09-08 17:20:27 -0400] mika__: if anyone is interested.... http://pastebin.com/YKideDXb all the cookbooks sorted by downloads ;)
[2012-09-08 17:24:26 -0400] atomic-penguin: I've got two in the top 25 :)
[2012-09-08 17:25:23 -0400] mika__: :)
[2012-09-08 17:30:02 -0400] ssd7: mika__: Did you construct that manually?
[2012-09-08 17:30:03 -0400] atomic-penguin: I think the d/l numbers are way off though.  I don't think it has ever been accurate counts
[2012-09-08 17:30:19 -0400] atomic-penguin: Not even sure if it counts 'knife' downloads
[2012-09-08 17:30:47 -0400] mika__: ssd7: naa, a simple ruby crawler that fetched all the pages and then sorted
[2012-09-08 17:30:58 -0400] ssd7: Ahh, cool
[2012-09-08 17:31:07 -0400] mika__: as it's not possible to sort on the website :(
[2012-09-08 17:31:14 -0400] ssd7: atomic-penguin: Yeah, the downloads for getting-started seem way off
[2012-09-08 17:31:53 -0400] mika__: atomic-penguin: better than nothing... it's just to have an idea on the most common packages
[2012-09-08 17:32:15 -0400] ssd7: mika__: Thanks for doing this, interesting list :)
[2012-09-08 17:32:28 -0400] mika__: :)
[2012-09-08 17:40:22 -0400] karmi: Hi  having problems with the nginx cookbook. On Chef 10.14.0 via Omnibus, getting `undefined method `[]' for nil:NilClass` for the `template "#{node['ohai']['plugin_path']}/nginx.rb" do ` line. Anybody has any idea how to fix it?
[2012-09-08 17:43:07 -0400] cheeseplus: karmi: not familiar with the nginx cookbook but it seems like you need  a omplementary ohai plugin installed and it's not
[2012-09-08 17:43:24 -0400] atomic-penguin: karmi, can you post your stacktrace output on a gist
[2012-09-08 17:43:37 -0400] karmi: cheeseplus: seems to me like something new in Chef?
[2012-09-08 17:43:41 -0400] karmi: atomic-penguin: sure can
[2012-09-08 17:44:37 -0400] karmi: atomic-penguin: http://hastebin.com/qupobirigi.txt
[2012-09-08 17:45:19 -0400] atomic-penguin: That is just the console output, I meant /var/chef/cache/chef-stacktrace.out
[2012-09-08 17:45:39 -0400] atomic-penguin: Which it mentions at the bottom of the console output
[2012-09-08 17:46:20 -0400] cheeseplus: that is the first time I've seen the 10.14 output, thats really nice
[2012-09-08 17:47:13 -0400] karmi: atomic-penguin: you can see the offending line in the new output, but sure: http://hastebin.com/cehuniwoxu.txt
[2012-09-08 17:47:22 -0400] karmi: cheeseplus: yes! it's a great feature.
[2012-09-08 17:48:08 -0400] cheeseplus: karmi: I'm curious, if you run ohai on the node is the ohai plugin_path attribute populated?
[2012-09-08 17:48:18 -0400] karmi: cheeseplus: will try
[2012-09-08 17:49:27 -0400] karmi: cheeseplus: No, not there  which I expected
[2012-09-08 17:51:30 -0400] atomic-penguin: What version of nginx, and ohai cb's?
[2012-09-08 17:52:12 -0400] atomic-penguin: I have 1.0.2 ohai, and 0.101.6 nginx
[2012-09-08 17:54:46 -0400] karmi: atomic-penguin: cheeseplus: Hmm, seems when I include "ohai" in run_list, it runs OK. Is this intentional?
[2012-09-08 17:55:21 -0400] atomic-penguin: Do a 'git grep include_attribute' in your nginx dir
[2012-09-08 17:55:39 -0400] karmi: nginx cookbook says `depends 'ohai', '~> 1.0.2'`, but it didn't fail with missing cookbook.
[2012-09-08 17:55:59 -0400] atomic-penguin: I think that may be missing.
[2012-09-08 17:56:29 -0400] karmi: atomic-penguin: nginx is 1.0.0, ohai is 1.1.2
[2012-09-08 17:56:44 -0400] karmi: well that's a weird semantics for "depends" then :)
[2012-09-08 17:56:52 -0400] karmi: when you have "recommends" etc
[2012-09-08 17:57:26 -0400] atomic-penguin: It should definitely be a depends, not a recommends
[2012-09-08 17:58:44 -0400] atomic-penguin: try putting `include_attribute "ohai"` in the nginx/attributes/default.rb
[2012-09-08 17:59:38 -0400] atomic-penguin: I think the issue is that the node.ohai attribute is not loaded when you call the template resource.
[2012-09-08 17:59:51 -0400] karmi: atomic-penguin: including the cookbook does fix it, probably, will try with a clean node again
[2012-09-08 18:00:22 -0400] atomic-penguin: Well, the ohai recipe should be included after the template resource, anyway.
[2012-09-08 18:00:57 -0400] atomic-penguin: The real issue is that the attribute is not loaded the first time it is referenced, I believe.
[2012-09-08 18:01:54 -0400] atomic-penguin: That would be a cleaner (more correct) fix than including the "ohai" recipe twice
[2012-09-08 18:02:24 -0400] karmi: atomic-penguin: it is included by default? or what do you mean by "twice"?
[2012-09-08 18:04:35 -0400] atomic-penguin: I mean, "ohai::default" should already be included as a result of the nginx::ohai_plugin recipe.  If you have to manually include it in your run_list, the cookbook won't be fixed.  You'll have only worked around the bug in the cookbook.  The bug, which is that the attributes from "ohai" have not been explicitly loaded into the nginx cookbook.
[2012-09-08 18:05:24 -0400] karmi: atomic-penguin: Absolutely. The cookbook is the thing which must be fixed.
[2012-09-08 18:06:00 -0400] karmi: atomic-penguin: My problem is that this is for a talk  so I'd like to work with a regular release and not a Github tarball etc
[2012-09-08 18:11:52 -0400] atomic-penguin: Off to find a stock pot, and make a big pot of chili
[2012-09-08 18:13:03 -0400] karmi: atomic-penguin: good plan :)
[2012-09-08 18:13:38 -0400] atomic-penguin: I have a big stock pot, it had a glass lid
[2012-09-08 18:14:04 -0400] atomic-penguin: My brother broke the lid this summer
[2012-09-08 18:38:42 -0400] jtimberman: there was a dependency problem on the ohai cookbook
[2012-09-08 18:38:48 -0400] jtimberman: i fixed it and released nginx 1.0.2
[2012-09-08 18:41:33 -0400] cheeseplus: jtimberman: nicely done
[2012-09-08 18:48:55 -0400] eliklein: is anyone around that's involved at all with the chef-server bootstrap stuff?
[2012-09-08 19:15:33 -0400] jtimberman: eliklein: best to just ask the question :)
[2012-09-08 19:15:46 -0400] jtimberman: i'm "here" in that I occassionally look at this terminal.
[2012-09-08 19:26:42 -0400] sascha_d: so are the new output formatters only designed to show up on STDOUT logging? I can see them in my buffer but my log file doesn't show them (I have log_level debug with verbose_logging set to true)
[2012-09-08 19:57:38 -0400] mika__: is it a bug that roles with run list empty set recipe[recipe[recipe[]]] and then chef-client throws and error about it?
[2012-09-08 20:49:40 -0400] pwf: why would 'knife client list' work but 'knife cookbook download foo' fail to authenticate...?
[2012-09-08 20:50:19 -0400] pwf: welp, nevermind. i specified a download directory but forgot -d
[2012-09-08 20:54:08 -0400] martinisoft: has Chef 10.14.0 been posted to s3?
[2012-09-08 20:54:12 -0400] martinisoft: http://s3.amazonaws.com/opscode-full-stack <- not seeing it there yet
[2012-09-08 20:58:13 -0400] hoover_damm: martinisoft, you can  always build your own omnibus
[2012-09-08 20:58:27 -0400] martinisoft: oh?
[2012-09-08 20:59:51 -0400] hoover_damm: https://github.com/opscode/omnibus-software
[2012-09-08 21:34:02 -0400] mika__: mmm.... <Error><Code>RequestTimeout</Code><Message>Your socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed.</Message><RequestId>515FC20F44ECDB66</RequestId><HostId>HwWcFuy4rSagV2rokDJ+hZPnLm0mkxj3tgcgi2Wqd4dJ3EUc0KAslc+S2C/4n0Sb</HostId></Error>
[2012-09-08 21:34:13 -0400] mika__: during knife cookbook upload -a
[2012-09-08 21:50:30 -0400] eliklein: jtimberman: I've asked it 3 times :)
[2012-09-08 21:51:43 -0400] eliklein: jtimberman: here's what's going on... I'm running into problems with the chef-solo chef-server bootstrap install on OEL 6.2: https://gist.github.com/3677089
[2012-09-08 21:57:28 -0400] jtimberman: eliklein: for a chef server installation, the instructions for using the "chef solo bootstrap" aren't tested with an omnibus installation of Chef client.
[2012-09-08 21:58:06 -0400] jtimberman: martinisoft: 10.14 is available via the omnibus installation, but i don't know if the bucket is the same or not.
[2012-09-08 21:58:32 -0400] jtimberman: martinisoft: you can use the install.sh script, which basically does a detection of the platofrm and then sends a request to the site to download the right package.
[2012-09-08 21:58:40 -0400] eliklein: it seems to work fine on centos 6.x
[2012-09-08 22:00:19 -0400] jtimberman: eliklein: i mean, using the "chef-solo bootstrap for Chef Server" with the client installed from the omnibus package isn't tested.
[2012-09-08 22:00:35 -0400] jtimberman: eliklein: i've only tested using the client installation instructions from rubygems per the wiki page.
[2012-09-08 22:00:50 -0400] eliklein: jtimberman: yes, and i'm saying it works fine on centos 6.x using the omnibus installed chef-client
[2012-09-08 22:01:14 -0400] eliklein: ok, i'll try again installing the client manually
[2012-09-08 22:01:15 -0400] jtimberman: martinisoft: wget https://www.opscode.com/chef/download?v=${version}&p=${platform}&pv=${platform_version}&m=${machine}
[2012-09-08 22:01:36 -0400] eliklein: it really looks like a simple problem to solve though
[2012-09-08 22:01:42 -0400] eliklein: just isn't including the proper path to find the gems
[2012-09-08 22:01:55 -0400] eliklein: s/simple/straight-forward
[2012-09-08 22:04:58 -0400] martinisoft: jtimberman: ah thanks :)
[2012-09-08 22:05:05 -0400] jtimberman: martinisoft: where version is the chef omnibus version, which has a package revision designator (10.14.0-1, e.g.), the platform similar to detection from ohai (ubuntu, redhat, centos, solaris2, etc), platform version of course is the platform's version 12.04, 5.8, etc, and the machine type, i386, x86_64
[2012-09-08 22:05:28 -0400] martinisoft: jtimberman: reason I ask is the chef-omnibus_updater cookbook uses the s3 bucket to grab the file
[2012-09-08 22:05:31 -0400] martinisoft: https://github.com/heavywater/chef-omnibus_updater <-
[2012-09-08 22:07:50 -0400] jtimberman: martinisoft: ah. i've not used that cookbook.
[2012-09-08 22:08:06 -0400] martinisoft: makes keeping omnibus updated easy usually :x
[2012-09-08 22:08:23 -0400] martinisoft: I am glas ruby-shadow is now bundled with it
[2012-09-08 22:08:26 -0400] martinisoft: glad*
[2012-09-08 22:08:40 -0400] martinisoft: made a cookbook to install it before, one less dependency
[2012-09-08 22:10:03 -0400] martinisoft: jtimberman: could I just use the install script line to update the omnibus package?
[2012-09-08 22:20:06 -0400] sascha_d: so are the new output formatters only designed to show up on STDOUT logging? I can see them in my buffer but my log file doesn't show them (I have log_level debug with verbose_logging set to true)
[2012-09-08 22:23:18 -0400] eliklein: jtimberman: for the bootstrap portion.. do you know if there's some trick to make OEL work right out of the box?
[2012-09-08 22:23:38 -0400] eliklein: jtimberman: I ended up modifying almost all of the recipes to add "oracle" to the arrays listing redhat, centos, fedora, etc
[2012-09-08 22:24:14 -0400] jtimberman: eliklein: OEL?
[2012-09-08 22:24:22 -0400] jtimberman: ooooh, Oracle Enterprise Linux?
[2012-09-08 22:24:23 -0400] eliklein: jtimberman: sorry, oracle enterprise linux
[2012-09-08 22:24:25 -0400] jtimberman: I've never used it.
[2012-09-08 22:24:34 -0400] eliklein: basically identical to centos
[2012-09-08 22:27:14 -0400] eliklein: unfortunately, ohai says the platform is "oracle"
[2012-09-08 22:27:20 -0400] eliklein: instead of rhel or centos
[2012-09-08 22:27:41 -0400] jtimberman: ah
[2012-09-08 22:27:42 -0400] jtimberman: yeah
[2012-09-08 22:28:05 -0400] jtimberman: so, one of the things we want to do is get as much of our cookbooks using the ohai platform_family attribute introduced a couple versions of ohai ago.
[2012-09-08 22:28:08 -0400] jtimberman: but we're not there yet
[2012-09-08 22:28:16 -0400] eliklein: oh ok
[2012-09-08 22:28:17 -0400] eliklein: i saw that
[2012-09-08 22:28:22 -0400] eliklein: the family says rhel
[2012-09-08 22:28:26 -0400] jtimberman: you should be able to just find all the places in the unarchived cookbooks directory
[2012-09-08 22:28:32 -0400] jtimberman: that say "centos"
[2012-09-08 22:28:34 -0400] eliklein: yep i did
[2012-09-08 22:28:41 -0400] eliklein: and then took off the -r ... and ran again
[2012-09-08 22:28:43 -0400] jtimberman: and add the oracle one to it
[2012-09-08 22:29:17 -0400] eliklein: i can send you guys the patch i generated if you want in the meantime
[2012-09-08 22:29:48 -0400] eliklein: let me see if bootstrap works now that i just did the gem install chef
[2012-09-08 22:30:26 -0400] eliklein: ah much better!
[2012-09-08 22:30:43 -0400] eliklein: doh, spoke too soon
[2012-09-08 22:31:08 -0400] eliklein: erlang cookbook
[2012-09-08 22:34:05 -0400] eliklein: ok, fixed that
[2012-09-08 22:34:37 -0400] jtimberman: sounds like you're on the right track :)
[2012-09-08 22:34:43 -0400] eliklein: haha
[2012-09-08 22:34:47 -0400] eliklein: indeed :D
[2012-09-08 22:34:52 -0400] jtimberman: i gotta go play RPGs now :)
[2012-09-08 22:34:58 -0400] eliklein: enjoy
[2012-09-08 22:35:03 -0400] eliklein: hopefully you're playing outside, it's beautiful
[2012-09-08 22:35:15 -0400] eliklein: haha
[2012-09-08 22:43:28 -0400] martinisoft: woa
[2012-09-08 22:43:36 -0400] martinisoft: like the new error output for chef runs
[2012-09-08 22:48:55 -0400] martinisoft: did something happen to the method assert_enclosing_directory_exists! ??
[2012-09-08 22:49:22 -0400] martinisoft: not finding it in the changelog
[2012-09-08 23:21:31 -0400] eliklein: ahhh finally have things functioning properly
[2012-09-08 23:21:33 -0400] eliklein: now i get to play
[2012-09-08 23:21:48 -0400] martinisoft: ah its a private method
[2012-09-08 23:21:51 -0400] martinisoft: :/
