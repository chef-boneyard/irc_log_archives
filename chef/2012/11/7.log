[2012-11-07 00:16:28 -0500] dopacki: hi - I think the chef-expander and chef-solr init scripts that ship with latest omnibus may be bugged
[2012-11-07 00:16:50 -0500] dopacki: when trying to start the process and it is already running, the scripts "exit 3"
[2012-11-07 00:17:36 -0500] dopacki: per the LSB specification (http://refspecs.linuxbase.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/iniscrptact.html) "running start on a service already running" should be considered success, and exit code should be zero
[2012-11-07 00:18:15 -0500] dopacki: ran into issues running chef under heartbeat due to the issue..
[2012-11-07 00:18:15 -0500] cmceldowney: All: using deploy_revision, how would I reference an include_recipe inside of one of the capistrano hooks in deploy_revision.. e.g. inside the before_restart hook
[2012-11-07 00:34:59 -0500] kallistec: cmceldowney: the callbacks in the deploy resource execute in their own mini chef run
[2012-11-07 00:35:21 -0500] kallistec: I don't think they'll be able to see recipes from the outside
[2012-11-07 00:35:56 -0500] cmceldowney: kallistec: ok. so how would I include a recipe inside this? or am I better off going to an LWRP for the logic I want to handle?
[2012-11-07 00:36:43 -0500] kallistec: cmceldowney: LWRP ought to work
[2012-11-07 00:37:59 -0500] kallistec: side note, thank ZNC, my persistent connections to everything have been dropping all day
[2012-11-07 00:38:31 -0500] erikh: znc <3
[2012-11-07 00:38:35 -0500] erikh: also partyline module
[2012-11-07 00:38:40 -0500] erikh: best trolling tool to ever exist
[2012-11-07 00:39:08 -0500] cmceldowney: kallistec: appears to be same problem. Can't reference LWRP inside the before_migrate. How would I bring in this resource to this "mini chef run"?
[2012-11-07 00:40:06 -0500] kallistec: LWRP should work, I would think, since it's just some sugar around defining a "real" resource and provider in the (only) namespace
[2012-11-07 00:40:25 -0500] kallistec: cmceldowney: are you getting bit by LWRPs tacking on the cookbook name in front?
[2012-11-07 00:40:44 -0500] kallistec: e.g., ark.rb in the java cookbook makes a "java_ark" resource
[2012-11-07 00:41:22 -0500] cmceldowney: kallistec: not that I can tell. Just getting a NameError: cannot find a resource...
[2012-11-07 00:41:52 -0500] kallistec: can you create one with action :nothing above your deploy resource just to double check?
[2012-11-07 00:43:09 -0500] joeydaggr: can anyone answer a quick question about chef logging for me?
[2012-11-07 00:45:26 -0500] cmceldowney: kallistec: you're right. just needed to prepend the parent cookbook name beforehand. unfortunately I stil lhave the same underlying problem... now I can't get the included library files from another cookbook to load inside of the provider
[2012-11-07 00:46:12 -0500] cmceldowney: joeydaggr: post the question and someone will answer for ya
[2012-11-07 00:46:24 -0500] joeydaggr: word
[2012-11-07 00:46:27 -0500] kallistec: cmceldowney: library files should load unconditionally, too... or are you trying to cookbook_file some stuff?
[2012-11-07 00:46:51 -0500] joeydaggr: what files do you typically find in /var/log/chef ?  I know client.log for chef-client, but are there any other files that are common?
[2012-11-07 00:47:23 -0500] joeydaggr: I'm putting together a recipe for logrotate and would like a "typical" config until I can get access to my client's system
[2012-11-07 00:47:27 -0500] cmceldowney: kallistec: library files are in a separate cookbook. Issue was I was bringing them in with class Chef::Recipe but since they're in LWRP, I needed to change to class Chef::Provider. now this works properly
[2012-11-07 00:47:51 -0500] cmceldowney: joeydaggr: On chef server you also have logs for all of the server processes
[2012-11-07 00:48:33 -0500] cmceldowney: joeydaggr: e.g. solr, expander, merb.main, server
[2012-11-07 00:52:28 -0500] cmceldowney: kallistec: Thx, btw..
[2012-11-07 00:52:37 -0500] kallistec: cmceldowney: no problem
[2012-11-07 02:23:29 -0500] josephholsten_: do I have to include something to get a class in a library to have data_bag_item() and search()?
[2012-11-07 02:23:59 -0500] josephholsten_: I see it working in the application cookbook: https://github.com/opscode-cookbooks/application/blob/master/libraries/default.rb#L97
[2012-11-07 02:24:08 -0500] josephholsten_: but I don't see an include that would do it
[2012-11-07 02:24:45 -0500] sunil__: can I manage various virtual hosts as data bag items?
[2012-11-07 02:25:11 -0500] sunil__: anyone know how to do this?
[2012-11-07 02:26:41 -0500] bluepojo: theoretically you could
[2012-11-07 02:27:06 -0500] bluepojo: for nginx, I keep a list of "site-available" in an attribute
[2012-11-07 02:27:13 -0500] bluepojo: and use that list to iterate and write config files
[2012-11-07 02:29:46 -0500] sunil__: oooh..can you share some examples of the role or data bag item?
[2012-11-07 02:31:49 -0500] sunil__: I am trying few things with apache..but not having great luck.
[2012-11-07 02:31:55 -0500] bluepojo: I'll see if I can gist something, sec
[2012-11-07 02:39:07 -0500] bluepojo: https://gist.github.com/4029275
[2012-11-07 02:39:09 -0500] bluepojo: sunil__:
[2012-11-07 02:40:18 -0500] bluepojo: in this case, they are rack applications, so they can all use the same reverse proxy template with different configs
[2012-11-07 02:42:46 -0500] sunil__: ah I see..
[2012-11-07 02:42:55 -0500] sunil__: Thanks..I am going to spend some time learning this.
[2012-11-07 03:31:13 -0500] Guest99909: Anyone have a pointer for me if chef-solo ignores the cookbook_path defined in ~/solo.rb? I'm specifying it implicity via -c as well, still refuses to look outside of /var/chef-solo for cookbooks.
[2012-11-07 03:36:00 -0500] c_t: should solo.rb be in ~/.chef?
[2012-11-07 04:24:01 -0500] Pri-ChefUser: hi
[2012-11-07 04:24:56 -0500] Pri-ChefUser: During knife configure, I'm getting the following error with Ubuntu 10.04 : chef-server > knife configure -i  /usr/lib/ruby/1.8/mixlib/config.rb:37:in `read': Permission denied - /etc/chef/server.rb (Errno::EACCES) from /usr/lib/ruby/1.8/mixlib/config.rb:37:in `from_file' from /usr/sbin/chef-server:77
[2012-11-07 04:25:14 -0500] Pri-ChefUser: Any help will be appreciated.
[2012-11-07 04:30:31 -0500] aruntomar: Pri-ChefUser: use sudo knife configure -i
[2012-11-07 04:36:38 -0500] Pri-ChefUser: aruntomar.. thanks a lot
[2012-11-07 04:37:08 -0500] Pri-ChefUser: it helped.. I kept trying sudo chef-server> knife configure -i
[2012-11-07 06:37:21 -0500] jensofsweden: Morning cooks =)
[2012-11-07 06:37:36 -0500] BryanWB_: ohai chefs!
[2012-11-07 06:37:44 -0500] jensofsweden: Heyas =)
[2012-11-07 06:38:52 -0500] c_t: Jens of Sweden
[2012-11-07 06:39:01 -0500] c_t: Any relation to Tom of Finland?
[2012-11-07 06:39:15 -0500] jensofsweden: Nope, but would be cool to get to know him =)
[2012-11-07 06:40:47 -0500] jensofsweden: I have a question to ya all. If you manage your applications trough chef. How do you manage your core linux systems with like patches and stuff like that for packages not included in your cookbooks? Or do you cookbook  every appliaction in the system? (Witch seems impossible) =)
[2012-11-07 06:46:05 -0500] bluepojo: jensofsweden: we start with CentOS minimal and install everything that the app depends on
[2012-11-07 06:46:08 -0500] bluepojo: and we cookbook everything
[2012-11-07 06:46:11 -0500] bluepojo: absolutely everything
[2012-11-07 06:46:33 -0500] bluepojo: I mean we install everything the app depends on with the cookbook
[2012-11-07 06:47:05 -0500] jensofsweden: Do you have a recipe to update the centos Minimal if there is like a kernel security issue? How do you do with openssh and stuff like that, cookbooks there aswell?
[2012-11-07 06:47:24 -0500] bluepojo: we run yum update
[2012-11-07 06:47:31 -0500] bluepojo: in a cookbook, iirc
[2012-11-07 06:49:42 -0500] jensofsweden: Ok, is cool to know since I have run RHN satellite forever, ever since I started to centralizing linux environments and standrarize them on RHEL. Just started using chef to manage appliactions instead of satellite. So cool to know how others are doing it =)
[2012-11-07 06:52:07 -0500] jensofsweden: My biggest problem is that I cant let anyone use knife since there is no way to connect it to the AD as I know of to be Audit compliant with our policys and regulations :(
[2012-11-07 10:06:10 -0500] AikiLinux: Hi , is there a way to search the runlist during execution and use that to determine some values for a template?
[2012-11-07 10:07:14 -0500] AikiLinux: i thought of using the 'search' function , but it seems not to work as I need it (or my code is all wrong)
[2012-11-07 10:56:28 -0500] masterkorp: AikiLinux: can you paste your code ?
[2012-11-07 10:58:16 -0500] AikiLinux: i already sorted it in a different way , but thanks
[2012-11-07 11:01:00 -0500] masterkorp: oh well
[2012-11-07 11:37:27 -0500] kraM: Hey, how do I `search' from within a library?
[2012-11-07 11:39:12 -0500] masterkorp: kraM: search function
[2012-11-07 11:40:10 -0500] kraM:  had an error: NoMethodError: undefined method `search' for -- Looks like I need to do something like Chef::Search::Query.search() ?
[2012-11-07 12:21:09 -0500] royh: currently running chef-client/ohai through the omnibus installer
[2012-11-07 12:21:15 -0500] royh: now my ohai plugins has stopped working
[2012-11-07 12:21:39 -0500] royh: any way to get /etc/chef/ohai_plugins included as the plugins folder for ohai?
[2012-11-07 12:21:57 -0500] royh: i want this to work when running ohai stand alone as well as through chef-client
[2012-11-07 12:23:40 -0500] lxndrp: Hey folks.
[2012-11-07 12:24:10 -0500] lxndrp: I've got a q re: data bags.
[2012-11-07 12:24:51 -0500] lxndrp: i was wondering whether it is possible to reference a data bag item using the standard node name (the FQDN, that is).
[2012-11-07 12:25:25 -0500] lxndrp: At least for chef-solo, I get a complaint in vagrant:
[2012-11-07 12:25:27 -0500] lxndrp: FATAL: Chef::Exceptions::InvalidDataBagItemID: Data Bag items must have an id matching /^[\-[:alnum:]_]+$/, you gave: "vagrant.vm"
[2012-11-07 12:25:32 -0500] lxndrp: Any ideas?
[2012-11-07 13:15:08 -0500] wonko_be: anyone with some test-kitchen experience?
[2012-11-07 13:15:30 -0500] wonko_be: it is not picking up dependencies on other cookbooks within the same repository
[2012-11-07 13:17:00 -0500] masterkorp: wonko_be: is it on the metadata
[2012-11-07 13:17:06 -0500] masterkorp: what error do you get
[2012-11-07 13:17:07 -0500] masterkorp: ?
[2012-11-07 13:19:49 -0500] wonko_be: masterkorp: I think I just found it - is it possible it doesn't read the metadata, but only reads the Cheffile
[2012-11-07 13:20:34 -0500] wonko_be: The error is like this "Cookbook postfix not found. If you're loading postfix from another cookbook, make sure you configure the dependency in your metadata"
[2012-11-07 13:20:58 -0500] wonko_be: postfix is a cookbook that sites in the same repository as the cookbook i'm testing (called "base")
[2012-11-07 13:21:09 -0500] masterkorp: Cheffile is auto filled if you have it on the metadata
[2012-11-07 13:21:26 -0500] wonko_be: so, cookbooks/base/metadata.rb has a "depends postfix" in it
[2012-11-07 13:21:38 -0500] wonko_be: which should load cookbooks/postfix/...
[2012-11-07 13:21:51 -0500] wonko_be: kitchen test is ran from the cookbooks/base directory
[2012-11-07 13:22:15 -0500] masterkorp: do you have it on the test_base cookbook metadata too ?
[2012-11-07 13:22:30 -0500] wonko_be: ah, no
[2012-11-07 13:22:40 -0500] wonko_be: I assumed it would take the dependencies from the base
[2012-11-07 13:22:42 -0500] wonko_be: just a sec
[2012-11-07 13:23:10 -0500] wonko_be: I should create that within the test/kitchen?
[2012-11-07 13:23:52 -0500] masterkorp: yeah, check the apache2 cookbook
[2012-11-07 13:24:00 -0500] masterkorp: see how the test cookbook works
[2012-11-07 13:25:01 -0500] wonko_be: ah, a lot of duplication...
[2012-11-07 13:27:06 -0500] wonko_be: so, to test the default.rb recipe from base, the test/kitchen/cookbooks/base_test/default.rb is converged (which would then "include_recipe 'base::default')
[2012-11-07 13:27:35 -0500] masterkorp: yes
[2012-11-07 13:27:47 -0500] wonko_be: and the dependencies arent read from cookbooks/base/metadata.rb, but from t/k/cookbooks/base_test/metadata.rb
[2012-11-07 13:28:23 -0500] wonko_be: I assume the "supports" should also go in the test cookbook metadata then
[2012-11-07 13:28:35 -0500] wonko_be: while it is actually picked up from the current metadata
[2012-11-07 13:29:36 -0500] masterkorp: You should keep these metadata in sync
[2012-11-07 13:29:45 -0500] wonko_be: yeah, so i figured now :)
[2012-11-07 13:29:56 -0500] masterkorp: altough i personally thing metadata.rb in the test.rb its useless
[2012-11-07 13:30:12 -0500] wonko_be: I fully agree :)
[2012-11-07 13:30:25 -0500] wonko_be: it wasted like 2 hours of my life already, so :D
[2012-11-07 13:31:27 -0500] wonko_be: am i missing something, or can that just be a copy of the metadata.rb
[2012-11-07 13:31:30 -0500] wonko_be: or even a symlink
[2012-11-07 13:31:48 -0500] wonko_be: i might not be grasping all of this correctly
[2012-11-07 13:32:36 -0500] masterkorp: not sure about a symlink
[2012-11-07 13:32:47 -0500] masterkorp: but i just copied and changed the cookbook name
[2012-11-07 13:33:28 -0500] bugoff: /7/7
[2012-11-07 13:33:29 -0500] wonko_be: seems a bit redundant work to me, but I'll just go along, I must be missing some crucial part
[2012-11-07 13:34:48 -0500] lxndrp: Hey folks.
[2012-11-07 13:35:00 -0500] lxndrp: Any ideas on my data bags question?
[2012-11-07 13:36:12 -0500] masterkorp: that is because the fqdn does not match the id
[2012-11-07 13:36:14 -0500] jtimberman: wonko_be: the "test" cookbook is there to set up so that other post converge tests can run, and do things that may not be covered by the cookbook being tested.
[2012-11-07 13:36:44 -0500] lxndrp: @masterkorp was that re:  me?
[2012-11-07 13:36:54 -0500] masterkorp: yeah
[2012-11-07 13:36:54 -0500] jtimberman: wonko_be: for example, you can make use of a LWRP in the cookbook you're testing, both to test that the LWRP works, and to run minitest-chef or cucumber tests aginst the resulting node state.
[2012-11-07 13:37:24 -0500] jtimberman: its like other support code for integration testing in other frameworks.
[2012-11-07 13:37:27 -0500] masterkorp: jtimberman: i really chef server support. I want to add bullet prof testing that could catch any regression :p
[2012-11-07 13:37:38 -0500] lxndrp: The thing is: I am using node['name] in my recipes to pickout the right data bag item.
[2012-11-07 13:37:50 -0500] wonko_be: yeah, okay, but I just have a simple cookbook, and I want to see if I can converge it on ubuntu, debian and centos
[2012-11-07 13:38:06 -0500] jtimberman: masterkorp: http://tickets.opscode.com/browse/KITCHEN-31 :-)
[2012-11-07 13:38:12 -0500] wonko_be: I thought that just running kitchen test would just do that
[2012-11-07 13:38:20 -0500] jtimberman: wonko_be: yes, it will.
[2012-11-07 13:38:33 -0500] lxndrp: But since that's by default the fqdn, the lookup seems to fail. I guess because the fqdn contains dots.
[2012-11-07 13:38:45 -0500] wonko_be: docs suggest that, through the use of librarian, and from the metadata, it will include the needed dependencies
[2012-11-07 13:38:56 -0500] jtimberman: yes that too
[2012-11-07 13:39:07 -0500] wonko_be: then I must be doing something wrong
[2012-11-07 13:39:08 -0500] masterkorp: jtimberman: i am following it already :)
[2012-11-07 13:39:16 -0500] jtimberman: masterkorp: :D
[2012-11-07 13:39:51 -0500] jtimberman: wonko_be: if you need additional dependencies for librarian to resolve, you can define them in test/kitchen/cookbooks/Cheffile
[2012-11-07 13:40:03 -0500] masterkorp: that will really for my icinga cookbook
[2012-11-07 13:40:05 -0500] wonko_be: without the cookbooks in test/kitchen/cookbooks, and with no specific stuff in the Kitchenfile, it should take the depends-lines from the metadata.rb from the cookbooks?
[2012-11-07 13:40:32 -0500] wonko_be: ...the cookbook itself
[2012-11-07 13:40:45 -0500] wonko_be: okay, I'm explaining this more complex than it is
[2012-11-07 13:41:15 -0500] wonko_be: given two cookbooks, created with knife cookbook create, named "base" and "postfix"
[2012-11-07 13:41:31 -0500] wonko_be: in cookbooks/base/metadata.rb there is a line "depends 'postfix'"
[2012-11-07 13:41:55 -0500] wonko_be: and in cookbooks/base/recipes/default.rb, there is "include_recipe "postfix::default""
[2012-11-07 13:41:59 -0500] jtimberman: https://github.com/opscode/test-kitchen/blob/master/config/Cheffile#L37-40 - that will use the cookbook being tested in librarian, and librarian will use the metadata in the cookbook to resolve its dependencies.
[2012-11-07 13:42:14 -0500] lxndrp: masterkorp any ideas?
[2012-11-07 13:42:28 -0500] wonko_be: when running kitchen init in base, and then kitchen test, it fails to find/include the postfix in the vagrant-runs
[2012-11-07 13:42:48 -0500] intinig: hi
[2012-11-07 13:42:55 -0500] wonko_be: although it is defined in cookbooks/base/metadata.rb in
[2012-11-07 13:43:07 -0500] intinig: why don't ec2 instances I bring up with knife ec2 have node[:ip]?
[2012-11-07 13:43:18 -0500] intinig: I have to go and look for node[:ec2][:public_ipv4]
[2012-11-07 13:43:59 -0500] jtimberman: https://github.com/opscode/test-kitchen/blob/master/config/Cheffile#L46-54 - the second if block here looks for the Cheffile at test/kitchen/cookbooks/Cheffile
[2012-11-07 13:44:51 -0500] wonko_be: jtimberman: but it only reads the Cheffile
[2012-11-07 13:44:54 -0500] wonko_be: not the metadata.rb
[2012-11-07 13:45:58 -0500] jtimberman: librarian resolves the dependencies in the metadata
[2012-11-07 13:46:41 -0500] lxndrp: Folks, if my q is really stupid, just tell me. But ATM, I am fiddling with -N sh*t everywhere.
[2012-11-07 13:48:36 -0500] royh: hah
[2012-11-07 13:48:40 -0500] royh: found a bug in ohai
[2012-11-07 13:49:43 -0500] jtimberman: lxndrp: in your data bag item, name it with, e.g., "vagrant_vm". then do a gsub in the recipe to change the _ to . when you load it.  mystuff = data_bag_item(:mystuff, node.name.gsub(/./, "_"))
[2012-11-07 13:49:54 -0500] BryanWB_: hey kids, i thought that I could reopen  a resource, say declare once   as     `  user "foo" do ;  home '/home   ; done `
[2012-11-07 13:50:18 -0500] royh: do you guys accept patches?
[2012-11-07 13:50:32 -0500] BryanWB_: and then redeclare it in a cookbook declared later   `  user 'foo' do ;   home '/opt'   ; done `
[2012-11-07 13:50:51 -0500] BryanWB_: and only the final change is made
[2012-11-07 13:50:58 -0500] lxndrp: jtimberman: Thought of something like that. So I have to work around that anyway, no hope for just handing in the fqdn and finding the correct stuff automatically, right?
[2012-11-07 13:51:00 -0500] jtimberman: royh: certainly: http://wiki.opscode.com/display/chef/How+to+Contribute
[2012-11-07 13:51:04 -0500] masterkorp: royh: yes, i sure they do, open a ticket and submit the patch
[2012-11-07 13:51:05 -0500] royh: jtimberman: thanks :)
[2012-11-07 13:51:14 -0500] BryanWB_: is this incorrect? I thoulg i could treat a resource like an open class in ruby
[2012-11-07 13:52:19 -0500] jtimberman: BryanWB_: https://gist.github.com/4031713
[2012-11-07 13:53:51 -0500] jtimberman: you can also do resources("user[foo]").home "/opt/foo"
[2012-11-07 13:54:18 -0500] BryanWB_: jtimberman: so this won't have the desired effect?   https://gist.github.com/4031717
[2012-11-07 13:56:45 -0500] BryanWB_: jtimberman: here is a clearer example https://gist.github.com/4031717
[2012-11-07 13:57:43 -0500] jtimberman: BryanWB_: so what will happen is you get the resource in the resource collection twice
[2012-11-07 13:57:52 -0500] jtimberman: well
[2012-11-07 13:57:56 -0500] jtimberman: not "twice" literally
[2012-11-07 13:58:19 -0500] jtimberman: https://gist.github.com/4031759
[2012-11-07 13:59:18 -0500] BryanWB_: jtimberman: yeah, that's what i have been seeing
[2012-11-07 13:59:35 -0500] jtimberman: but it gets processed twice
[2012-11-07 13:59:45 -0500] wonko_be: jtimberman: okay, there must be something else wrong with my setup, in a newly created env, it works as expected
[2012-11-07 13:59:54 -0500] wonko_be: thx for the input
[2012-11-07 14:00:45 -0500] lxndrp: kthxbai, jtimberman
[2012-11-07 14:01:24 -0500] jtimberman: BryanWB_: https://gist.github.com/4031772
[2012-11-07 14:01:33 -0500] BryanWB_: damn, this is a big problem for writing a wrapper cookbook
[2012-11-07 14:01:34 -0500] jtimberman: wonko_be: you're welcome.
[2012-11-07 14:02:00 -0500] BryanWB_: and cookbook reusability in general
[2012-11-07 14:02:03 -0500] jtimberman: wonko_be: there's a few areas of duplicatation that i'd like resolved
[2012-11-07 14:02:16 -0500] jtimberman: BryanWB_: i like the idea of library vs application cookbooks
[2012-11-07 14:02:36 -0500] BryanWB_: but that idea rests on being able to override the templates in the library cookbook
[2012-11-07 14:02:39 -0500] jtimberman: BryanWB_: but customizing heavily i think is an anti pattern
[2012-11-07 14:03:08 -0500] BryanWB_: i think that putting one's changes in the application cookbook w/out modifying the library cookbook is ideal
[2012-11-07 14:03:24 -0500] jtimberman: https://github.com/opscode-cookbooks/mysql/blob/master/recipes/server.rb#L185-197
[2012-11-07 14:03:57 -0500] wonko_be: jtimberman: I see the need for additional recipes, to setup specific "use cases"
[2012-11-07 14:04:15 -0500] wonko_be: and include testing of lwrp's and the such, with all possible edge cases
[2012-11-07 14:04:35 -0500] wonko_be: but my setup was that easy - but it is something in my setup, now I just need to figure out what it is
[2012-11-07 14:04:49 -0500] BryanWB_: hmm, need to think
[2012-11-07 14:05:14 -0500] wonko_be: i'm rebuilding everything from scratch, I'll see, once I find it, if it is just a stupid mistake, or something that might be usefull to others
[2012-11-07 14:05:41 -0500] BryanWB_: the resources("user[foo]").home "/opt/foo"    thing is not intuitive
[2012-11-07 14:06:49 -0500] BryanWB_: jtimberman: something like this would be a lot more intuitvie https://gist.github.com/4031792
[2012-11-07 14:08:14 -0500] jtimberman: BryanWB_: its not intuitive because we don't document the resources() method very well.
[2012-11-07 14:08:30 -0500] jtimberman: imo ;)
[2012-11-07 14:08:34 -0500] BryanWB_: the name of the method is not descriptive
[2012-11-07 14:08:55 -0500] BryanWB_: and ugly if u edit multiple attributes of a resource
[2012-11-07 14:09:13 -0500] BryanWB_: blocks are nicer ;)
[2012-11-07 14:11:51 -0500] jtimberman: http://rubydoc.info/gems/chef/Chef/ResourceCollection:find
[2012-11-07 14:13:05 -0500] jtimberman: gotta run
[2012-11-07 14:13:10 -0500] BryanWB_: jtimberman: kewl, i will be too, get some sleep
[2012-11-07 14:13:28 -0500] jtimberman: sleep ain't happenin now, stupid body clock :)
[2012-11-07 14:14:49 -0500] royh: jtimberman: do i really have to sign the CLA? it's just a oneliner.
[2012-11-07 14:18:50 -0500] royh: jtimberman: this is on behalf of a company so i guess getting my boss to sign it is the most cleanest approach...
[2012-11-07 14:19:03 -0500] royh: jtimberman: do you prefer pull requests on github or patch files in your ticket system?
[2012-11-07 14:20:09 -0500] yfeldblum: royh, a ticket in JIRA plus a pull-request on github is how it's typically one
[2012-11-07 14:20:36 -0500] yfeldblum: royh, they work from jira but if the pull-request is linked to in the ticket they can take the patch that way
[2012-11-07 14:21:44 -0500] royh: yfeldblum: ah, goodie :)
[2012-11-07 14:23:35 -0500] yfeldblum: royh, yes your company has to sign the CCLA before opscode will merge your pull-request, even if it's just a one-liner ... sucks, but c'est la vie
[2012-11-07 14:37:20 -0500] UForgotten: good morning.  I'm using chef-solo and trying to figure out a good way to combine attributes from multiple environments.  for example, I have development, staging, and production roles, but need to be able to write a .yaml file that has data from all 3.
[2012-11-07 14:37:34 -0500] UForgotten: but each role needs to have attributes that are named the same.
[2012-11-07 14:42:55 -0500] BryanWB_: rrrrrrrrruby!
[2012-11-07 14:46:37 -0500] yfeldblum: BryanWB_, sounds like code surgery ... take your `knife`!
[2012-11-07 14:47:07 -0500] BryanWB_: yfeldblum: lol, i may ask u for some advice on how or how not to use instance_eval in a bit if u don't mind
[2012-11-07 14:47:26 -0500] yfeldblum: BryanWB_, no problem
[2012-11-07 14:50:30 -0500] kjk: how to get a previously defined resource in a recipe? say i defined a template "abc" with some attributes set. Then, later i'd like to obtain that template object and then change some attributes or set some more..
[2012-11-07 14:51:10 -0500] BryanWB_: kjk: u = resources("user[foo]")
[2012-11-07 14:51:32 -0500] kjk: awesome! thanks
[2012-11-07 14:52:09 -0500] kjk: i've been using template("abc"), though that seems to work but seems to have some side effects
[2012-11-07 14:54:14 -0500] kjk: just tested! it works! thanks a lot BryanWB_
[2012-11-07 14:56:28 -0500] UForgotten: good morning.  I'm using chef-solo and trying to figure out a good way to combine attributes from multiple environments.  for example, I have development, staging, and production roles, but need to be able to write a .yaml file on a client that has data from all 3. thoughts?
[2012-11-07 15:13:54 -0500] flowersj: hello
[2012-11-07 15:14:07 -0500] flowersj: anyone on know much about Test Kitchen?
[2012-11-07 15:14:40 -0500] flowersj: and or how Chef deals with dependencies in a cookbook
[2012-11-07 15:15:20 -0500] flowersj: for example I was wanting to write some tests for the jenkins cookbook
[2012-11-07 15:15:31 -0500] flowersj: can it depends on the java cookbook
[2012-11-07 15:15:59 -0500] flowersj: when I run the test with kitchen it fails because java is not installed
[2012-11-07 15:19:18 -0500] jtimberman: flowersj: the jenkins cookbook doesn't do an include_recipe "java"
[2012-11-07 15:20:45 -0500] jtimberman: er, that is a question
[2012-11-07 15:21:12 -0500] jtimberman: need more information though - which jenkins cookbook and which platform fails?
[2012-11-07 15:22:14 -0500] matti: Ah, testing.
[2012-11-07 15:22:19 -0500] matti: So I have a question too.
[2012-11-07 15:22:47 -0500] matti: jtimberman: Is it possible to access data bags when using minitest-chef-handler from within a TestCase?
[2012-11-07 15:23:54 -0500] jtimberman: matti: "yes" in that its ruby and you can do anything you want, but whether its easy i don't know :)
[2012-11-07 15:24:46 -0500] matti: I was more after the "yes real easy..." ;d
[2012-11-07 15:25:10 -0500] matti: I will see if I can do something.
[2012-11-07 15:26:35 -0500] flowersj: here is the jenkins cookbook: https://github.com/fnichol/chef-jenkins
[2012-11-07 15:27:32 -0500] flowersj: so depends does what exactly then?
[2012-11-07 15:28:16 -0500] flowersj: do I need to do both depends and include_recipe?
[2012-11-07 15:28:36 -0500] flowersj: if I do include_recipe do I need to do depends?
[2012-11-07 15:28:55 -0500] yfeldblum: flowersj, depends tells chef-client that it needs to download the depended-on cookbook too; include_recipe tells chef-client to load a given recipe (which will fail if the cookbook including it isn't downloaded!)
[2012-11-07 15:29:11 -0500] yfeldblum: the cookbook containing* it ...
[2012-11-07 15:30:26 -0500] flowersj: so for the test should I be adding the include_recipe to the jenkins cookbook or do I add java to the kitchenfile run_list_extras
[2012-11-07 15:32:53 -0500] flowersj: I don't often see include_recipe but I do often see depends
[2012-11-07 15:34:11 -0500] flowersj: to get tests to run successfully I need all the dependencies to get converged
[2012-11-07 15:34:26 -0500] flowersj: there seem to be multiple ways to accomplish that
[2012-11-07 15:34:51 -0500] jtimberman: matti: i'd consider not testing things in the data bag, but instead test whether the behavior of the system is reflected by the data
[2012-11-07 15:35:02 -0500] flowersj: is there a preferred way of doing that, a best practice and/or bad practice?
[2012-11-07 15:35:06 -0500] jtimberman: like, if your data bag describes an application to deploy, test whether it was deployed
[2012-11-07 15:35:41 -0500] jtimberman: flowersj: are you using this on ubuntu? https://github.com/fnichol/chef-jenkins/blob/master/recipes/default.rb#L109
[2012-11-07 15:36:34 -0500] flowersj: nope, the first OS it was testing with was CentOS
[2012-11-07 15:37:02 -0500] flowersj: interesting
[2012-11-07 15:37:20 -0500] jtimberman: flowersj: you might consider this version: http://community.opscode.com/cookbooks/jenkins
[2012-11-07 15:37:48 -0500] flowersj: hmm
[2012-11-07 15:37:55 -0500] jtimberman: it looks like its based on the one fletcher has, but updated, e.g. uses a yum repository which presumably would have java packages since it doesn't include_recipe "java"
[2012-11-07 15:37:57 -0500] flowersj: I wonder how they differ?
[2012-11-07 15:38:18 -0500] flowersj: okay
[2012-11-07 15:38:54 -0500] flowersj: thank you :-)
[2012-11-07 15:39:47 -0500] jtimberman: i think they're essentially the same cookbook but now heavywater is maintaining it instead of fletcher.
[2012-11-07 15:39:54 -0500] jtimberman: i can only speculate :)
[2012-11-07 16:03:10 -0500] matti: jtimberman: Indeed. I just need to see whether use submitted a data bag items.
[2012-11-07 16:03:21 -0500] matti: jtimberman: If so, then a different thing will have place.
[2012-11-07 16:03:31 -0500] matti: jtimberman: I am dealing with solo runs.
[2012-11-07 16:03:57 -0500] matti: jtimberman: So, if the bag is there and has items, I am assumig that user decided to configure service to participate in a cluster.
[2012-11-07 16:04:29 -0500] matti: jtimberman: Mind you, I am not sure whether this is the right pattern. I created my first cookbook two days ago ;)
[2012-11-07 16:28:44 -0500] theRawr: rawr!
[2012-11-07 16:29:50 -0500] willejs: i have loads of different environments for a service, however the service is made up of a lot of services
[2012-11-07 16:29:56 -0500] willejs: how can i use environments
[2012-11-07 16:30:11 -0500] willejs: i would ideally have one environment, with all the services in roles
[2012-11-07 16:30:22 -0500] willejs: however, i would be bound to cookbooks in that environment
[2012-11-07 16:30:49 -0500] willejs: if i had multiple environments for each service and environment, it would be more flexible
[2012-11-07 16:30:52 -0500] willejs: and ideas?
[2012-11-07 16:31:33 -0500] matti: jtimberman: Chef::DataBag and Chef::DataBagItem works like a charm ;]
[2012-11-07 16:31:48 -0500] matti: 49 tests, 155 assertions, 1 failures, 0 errors, 1 skips
[2012-11-07 16:31:51 -0500] matti: \o/
[2012-11-07 16:32:11 -0500] matti: Now, why upstart provider seem to be failing on testing whether something is enabled.
[2012-11-07 16:32:14 -0500] matti: Umhmh.
[2012-11-07 16:33:13 -0500] chip-: wille: Are you modeling environments on geography, pipeline (dev/stage/prod), or both?
[2012-11-07 16:34:20 -0500] willejs: pipeline
[2012-11-07 16:34:48 -0500] willejs: however, in each environment for example stage, i have several different services
[2012-11-07 16:34:57 -0500] Oct: Ohai chefs
[2012-11-07 16:35:03 -0500] chip-: So I'd say use a versioned cookbook for each of your custom services, with a corresponding role, and then use environments to model your pipeline.
[2012-11-07 16:35:21 -0500] flowersj: is there a way to specify a version of a cookbook in a run list?
[2012-11-07 16:35:25 -0500] Oct: schisamo: you there ?
[2012-11-07 16:35:30 -0500] matti: Ohai Oct
[2012-11-07 16:35:30 -0500] willejs: i thought you could only version the cookbooks in the environments?
[2012-11-07 16:35:36 -0500] chip-: flowersj: Environments can specify cookbook versions.
[2012-11-07 16:36:02 -0500] chip-: willejs: Yes. So each environment specifies the version of the cookbook, and each host has a role for the service in the run list, which will rarely change.
[2012-11-07 16:36:02 -0500] flowersj: what does that look like?
[2012-11-07 16:36:32 -0500] chip-: Then to push new code through the pipeline, update the cookbook, update the cookbook version, and then releasing becomes updating the version of the cookbook in the environment file.
[2012-11-07 16:36:36 -0500] flowersj: env_run_lists "prod" => ["recipe[apache2]"]
[2012-11-07 16:36:50 -0500] flowersj: what would a version in that look like?
[2012-11-07 16:37:06 -0500] chip-: flowersj: You'd do it in the environment itself, not in the role.
[2012-11-07 16:37:28 -0500] Oct: I'm having problem enabling a chef_handler on my configuration ( http://wiki.opscode.com/display/chef/Exception+and+Report+Handlers ) and there seems to something going wrong around line #47 of chef_handler/provides/default.rb...
[2012-11-07 16:37:31 -0500] chip-: More information on environments and pinning cookbook versions to environments: http://wiki.opscode.com/display/chef/Environments
[2012-11-07 16:38:08 -0500] flowersj: thank you
[2012-11-07 16:38:09 -0500] willejs: chip: thanks. its what I'm doing, but i don't like the say that my services share common cookbooks, and i worry about having to update one, and it breaking the others
[2012-11-07 16:38:16 -0500] BryanWB_: yfeldblum: if u could take a look at this https://gist.github.com/4032575
[2012-11-07 16:38:33 -0500] flowersj: is that the only place, in ends, that you can specify versions of cookbooks?
[2012-11-07 16:38:47 -0500] flowersj: s/ends/envs/
[2012-11-07 16:38:49 -0500] BryanWB_: it's a monkey patch to chef that I intend to distribute as a gem and also submit as a pr to chef
[2012-11-07 16:38:53 -0500] chip-: flowersj: Yes.
[2012-11-07 16:38:58 -0500] masterkorp: Guys is there any plugin for knife that validates json before uploading ?
[2012-11-07 16:39:34 -0500] chip-: masterkorp: It already does that, yes? What's your case where it's not happening?
[2012-11-07 16:39:54 -0500] masterkorp: I want to validate only
[2012-11-07 16:40:03 -0500] gyre008: guys is there any way how I can use attribute?() method for checking nested attributes ?
[2012-11-07 16:40:06 -0500] chip-: willejs: Dependency management is tricky business!
[2012-11-07 16:40:30 -0500] willejs: yeah :(
[2012-11-07 16:40:38 -0500] willejs: at least its a little cleaner this wa
[2012-11-07 16:40:39 -0500] willejs: y
[2012-11-07 16:40:42 -0500] gyre008: I mean I have a attribute which goes like this: foo=>{ :foo1 => { :foo3 => val}}
[2012-11-07 16:40:45 -0500] chip-: masterkorp: knife noun from file noun.json isn't validating for you?
[2012-11-07 16:41:01 -0500] philsturgeon: trying to work with php-fpm module. its creating the fpm/php.ini file when run the first time but not the second.
[2012-11-07 16:41:18 -0500] philsturgeon: the default (and only) recipe is http://pastie.org/5341250
[2012-11-07 16:41:43 -0500] philsturgeon: i know php-fpm is being called as its running the service, but it wont create (for the 2nd time) or override an existing php.ini
[2012-11-07 16:41:52 -0500] philsturgeon: any ideas why not? It feels like im missing something obvious
[2012-11-07 16:42:07 -0500] strcrzy_: does anyone know why chef could fail installing gems with native extensions?
[2012-11-07 16:42:17 -0500] strcrzy_: specifically glib2, gtk2 seem to just be blowing up under chef
[2012-11-07 16:42:21 -0500] gyre008: philsturgeon, if the checksum on the rendered template file is the same as on previous run then it won't create itno point for it
[2012-11-07 16:42:27 -0500] masterkorp: chip-: but that uploads too
[2012-11-07 16:42:34 -0500] strcrzy_: but install just fine on the system without chef
[2012-11-07 16:42:39 -0500] chip-: Ah, so you just want to validate without uploading.
[2012-11-07 16:42:48 -0500] philsturgeon: gyre008: right, but in the logs its not even checking the md5 hashes. http://pastie.org/5341247
[2012-11-07 16:42:55 -0500] philsturgeon: this is the extend of the fpm mentions
[2012-11-07 16:42:56 -0500] chip-: I understand now.
[2012-11-07 16:43:10 -0500] philsturgeon: besides, md5(deleted file) != md5(new file)
[2012-11-07 16:43:26 -0500] gyre008: philsturgeon, run it with -l debug
[2012-11-07 16:43:28 -0500] philsturgeon: i've been adding in debug, changing config values, deleting the file, etc. it just wont put the new one in place
[2012-11-07 16:44:05 -0500] philsturgeon: gyre008: ouch, thats a lot of debug
[2012-11-07 16:44:27 -0500] chip-: Unfortunately I don't think that exists right now.
[2012-11-07 16:45:55 -0500] philsturgeon: gyre008: there is no mention of php.ini when I search against "fpm"
[2012-11-07 16:46:28 -0500] philsturgeon: in fact the only mention of php.ini at all is the cli version http://d.pr/i/kmzA
[2012-11-07 16:47:05 -0500] Oct: no mention of www.conf either, philsturgeon ?
[2012-11-07 16:47:10 -0500] gyre008: its clear from that log file that the checksum is the same
[2012-11-07 16:47:21 -0500] philsturgeon: mone
[2012-11-07 16:47:27 -0500] gyre008: NOT FETCHING PHP.INI dude...
[2012-11-07 16:47:39 -0500] gyre008: and just below it you have checksums
[2012-11-07 16:47:42 -0500] philsturgeon: none*. looks like that file aint being run, but the weird thing is the service knows it needs to run - so that file must be being run
[2012-11-07 16:47:55 -0500] philsturgeon: gyre008: like i said, cli/php.ini !== fpm/php.ini
[2012-11-07 16:48:02 -0500] Oct: this is not fpm php.ini
[2012-11-07 16:48:20 -0500] philsturgeon: yeah i fully expect both of them to be active, but that is the only mention of php.ini, which is the problem.
[2012-11-07 16:48:20 -0500] gyre008: then check your cookbook if you are rendering correct template...
[2012-11-07 16:48:41 -0500] Oct: philsturgeon: is the cookbook even run ?
[2012-11-07 16:49:17 -0500] flowersj: is there a way to know what OS you are on in the metadata.rb?
[2012-11-07 16:49:25 -0500] nathenharvey: masterkorp knife cookbook test foo will check cookbook files but looks like that's only going to look at .rb and .erb http://docs.opscode.com/knife_cookbook.html#test
[2012-11-07 16:49:56 -0500] flowersj: I would like to add certain depends when on a certain OS
[2012-11-07 16:50:05 -0500] nathenharvey: doesn't look like there's a similar verb for role or environments
[2012-11-07 16:50:46 -0500] philsturgeon: Oct: gyre008: yeah guys, it has to be run as it knows to start and enable the service - which i can see it's doing in the logs. http://d.pr/i/yF3K
[2012-11-07 16:51:06 -0500] gyre008: can you please paste your recipe...
[2012-11-07 16:51:17 -0500] alexbst: http://status.opscode.com <- not working again :/
[2012-11-07 16:51:30 -0500] philsturgeon: php-fpm is in the run list for multiple nodes, and when i run vagrant provision it kicks off each of those nodes (definitely) so its actually being requested three times
[2012-11-07 16:51:45 -0500] alexbst: and opscode's twitter isn't updated
[2012-11-07 16:51:52 -0500] Oct: philsturgeon: so if you plant an error in the cb, chef aborts ?
[2012-11-07 16:52:26 -0500] philsturgeon: Oct: what sort of error could i throw in that would be an accurate replection? I assume not syntax?
[2012-11-07 16:52:30 -0500] philsturgeon: reflection* erf
[2012-11-07 16:52:36 -0500] Oct: raise "boum"
[2012-11-07 16:52:39 -0500] Oct: something like that
[2012-11-07 16:52:45 -0500] Oct: will break chef early in the run
[2012-11-07 16:52:52 -0500] Oct: but you'd know it's evaluated
[2012-11-07 16:55:24 -0500] yfeldblum: BryanWB_, cool
[2012-11-07 16:55:40 -0500] BryanWB_: yfeldblum: tks
[2012-11-07 16:55:42 -0500] yfeldblum: BryanWB_, got a few comments for u, on the gist, but it's a neat idea
[2012-11-07 16:56:39 -0500] BryanWB_: yfeldblum: i fucking needed it yesterday, ur comments would be very helpful
[2012-11-07 16:57:57 -0500] masterkorp: i am looking to test json
[2012-11-07 16:58:10 -0500] masterkorp: oh well i will use another tool
[2012-11-07 16:58:11 -0500] yfeldblum: BryanWB_, hmmm added 1 more comment
[2012-11-07 16:58:18 -0500] gyre008: guysis there any way how I can check for existence of nested attribute ? using attribute?() method ?
[2012-11-07 16:59:02 -0500] gyre008: like node.attribute?(some_nested_attribute)
[2012-11-07 16:59:15 -0500] yfeldblum: gyre008, you can use that method, but you can also use the methods #include? and #has_key?, which are both instance methods of normal Hash instances as well as on node attributes
[2012-11-07 16:59:51 -0500] BryanWB_: yfeldblum: tks for the comments, will work on it
[2012-11-07 16:59:53 -0500] yfeldblum: gyre008, ruby programmers know about Hash#include? and Hash#has_key? but won't know what #attribute? is
[2012-11-07 17:00:09 -0500] gyre008: yfeldblum, yeah I could use has_key but Id like to keep Chef code Chef-y
[2012-11-07 17:00:14 -0500] BryanWB_: yfeldblum: and heh, the chef source uses instance_eval but i agree that instance_exec seems more sane
[2012-11-07 17:00:54 -0500] yfeldblum: BryanWB_, i believe instance_exec is new in ruby-1.8.7 or maybe a little earlier, while instance_eval is older
[2012-11-07 17:01:55 -0500] yfeldblum: BryanWB_, so some of that code may be from years ago when ruby-1.8.6 was still out there and still supported
[2012-11-07 17:02:07 -0500] philsturgeon: Oct: hey doing that now. php::module_mysql, nginx, php-fpm i see it in the run list there
[2012-11-07 17:02:23 -0500] philsturgeon: Oct: but no errors
[2012-11-07 17:04:21 -0500] flagg0204: im trying to find a way to locally cache Chef searches, has anyone every done this?  I see there is a 'cache_type' in knife.rb that supposedly can point to redis or memcache
[2012-11-07 17:05:53 -0500] philsturgeon: Oct: think there is a conflict with the main "php" module having a template called
[2012-11-07 17:06:11 -0500] philsturgeon: "php.ini.erb" and the php-fpm cookbook having a template called "php.ini.erb" too?
[2012-11-07 17:06:36 -0500] Oct: don't you have several php-fpm cookbooks ? with various versions ?
[2012-11-07 17:06:52 -0500] philsturgeon: Oct: "php" and "php-fpm", that is all
[2012-11-07 17:07:38 -0500] Oct: i'm not familiar with these cookbook unfortunately
[2012-11-07 17:08:01 -0500] philsturgeon: each have their own "php.ini", although the main "php" has MANY for different OS's. I have confirmed that "php"'s php.ini is the ubuntu one, i know where that is coming from entirely. the php-fpm cookbook installs SOME php.ini first time around, but never updates the pph.ini with changes, or replaces when it deletes
[2012-11-07 17:08:07 -0500] behemphi1: @gyre008 I noticed yesterday the bit of code I got from your gist is no longer working its magic with knife-ssh and rackspace cloud.  B/f I dig in futher I was wondering if you noticed the same
[2012-11-07 17:08:13 -0500] philsturgeon: oct: its just this http://pastie.org/5341250
[2012-11-07 17:08:26 -0500] yfeldblum: BryanWB_, what was going on yesterday?
[2012-11-07 17:08:37 -0500] philsturgeon: DAMMIT it should probably be called php5-fpm
[2012-11-07 17:08:39 -0500] BryanWB_: yfeldblum: going on where?
[2012-11-07 17:08:42 -0500] gyre008: behemphi1, it was working and it's not any more mmit seems to be woking for me still...
[2012-11-07 17:08:49 -0500] Oct: philsturgeon: indeed
[2012-11-07 17:08:49 -0500] gyre008: actuallylet me see
[2012-11-07 17:09:12 -0500] philsturgeon: no sorry it doesnt http://community.opscode.com/cookbooks/php-fpm
[2012-11-07 17:09:13 -0500] yfeldblum: BryanWB_, you were talking about how you "needed it yesterday"
[2012-11-07 17:09:27 -0500] philsturgeon: jtimberman: you're marked as a collaborator, could you possibly throw in?
[2012-11-07 17:09:30 -0500] BryanWB_: yfeldblum: no, i just really needed this code for last 2 weeks
[2012-11-07 17:09:37 -0500] ekristen: is it possible to set a node name in a recipe?
[2012-11-07 17:09:39 -0500] yfeldblum: BryanWB_, ah cool
[2012-11-07 17:09:50 -0500] behemphi1: @gyre008 OK that part that it is working is good to know.  but to answer your question, it worked a charm up to yesterday and now  back to the same badness
[2012-11-07 17:09:51 -0500] yfeldblum: ekristen, no
[2012-11-07 17:10:06 -0500] rayrod2030: hai
[2012-11-07 17:10:09 -0500] gyre008: mm
[2012-11-07 17:10:21 -0500] yfeldblum: ekristen, but remember that node-name has nothing to do with fqdn, hostname, dns name, etc
[2012-11-07 17:10:36 -0500] rayrod2030: are there any tutorials out there showing how to use the chef api via a web application?
[2012-11-07 17:11:57 -0500] gyre008: strange behemphi1  I just checked and it still works for me like a charmcan you run knife ssh with verbose logging ?
[2012-11-07 17:12:01 -0500] gyre008: -vv or something like that
[2012-11-07 17:12:14 -0500] Oct: got to move, sorry philsturgeon and good luck
[2012-11-07 17:12:38 -0500] philsturgeon: thanks oct
[2012-11-07 17:15:00 -0500] behemphi1: So long as you don't take this as me bitching when you are really helping me out :-)
[2012-11-07 17:15:01 -0500] behemphi1: sec
[2012-11-07 17:18:00 -0500] gyre008: nah thats coolI'm curious mysqlf
[2012-11-07 17:18:03 -0500] gyre008: *e
[2012-11-07 17:18:40 -0500] behemphi1: @gyre008 https://gist.github.com/4033032
[2012-11-07 17:19:09 -0500] behemphi1: That might be the most awesome typo ever  mysqlf
[2012-11-07 17:21:34 -0500] gyre008: it looks like it is working why do you think its not ? looks like the ls command is executed just fine...
[2012-11-07 17:22:15 -0500] behemphi1: Note that I am getting this 50-57-80-197.static.cloud-ips.com when I should be getting the hostname
[2012-11-07 17:22:35 -0500] ekristen: whats the best way to set FQDN and Hostname and then make it happen on the server? I found https://github.com/johntdyer/hostname-chef/ but its based on node.name, which I can modify
[2012-11-07 17:22:37 -0500] behemphi1: I limited my search a bit, but I occassionally get a host name still
[2012-11-07 17:22:45 -0500] ekristen: yfeldblum: any suggestions would be appreciated
[2012-11-07 17:23:09 -0500] behemphi1: Also I will get (at random time) these
[2012-11-07 17:23:09 -0500] behemphi1: WARNING: Failed to connect to  -- Net::SSH::Disconnect: connection closed by remote host
[2012-11-07 17:23:10 -0500] behemphi1: WARNING: Failed to connect to  -- Errno::EPIPE: Broken pipe - send(2)
[2012-11-07 17:23:23 -0500] behemphi1: note lack of any sort of name for the node
[2012-11-07 17:23:51 -0500] behemphi1: The magic you have me last week fixed all that  fluffy bunnies, rainbows, etc
[2012-11-07 17:23:59 -0500] kjk: is there a chef handler that will allow me to configure recipes to skip on errors and would continue executing the rest of the recipes in the run list?
[2012-11-07 17:25:00 -0500] gyre008: mmclosed by remote host errors are caused by the server.nothing to do with client unfortunately ;(
[2012-11-07 17:25:26 -0500] philsturgeon: gyre008: hey, we started a conversation earlier and I am still rather stuck on this. Something truely strange is happening
[2012-11-07 17:25:27 -0500] gyre008: ill have to have a look into the hostname stuff...
[2012-11-07 17:25:45 -0500] behemphi1: it is really the second one with the Broken pipe I shoud call your attn to
[2012-11-07 17:25:53 -0500] behemphi1: that was the other part of last weeks issue
[2012-11-07 17:25:59 -0500] philsturgeon: php-fpm is listed in my run list, but nothing in the file happens. Even adding a rase "BLARG" is not breaking it (and yes I am uploading these changes via knife)
[2012-11-07 17:29:10 -0500] flowersj: when I run kitchen tests I don't see the VBs getting shutdown
[2012-11-07 17:29:48 -0500] flowersj: is there an option to have the tests shutdown the VBs when the test completes?
[2012-11-07 17:30:19 -0500] flowersj: it's killing my system having 4 VBs up and running
[2012-11-07 17:30:29 -0500] yfeldblum: ekristen, however you would normally do it from bash ...
[2012-11-07 17:34:58 -0500] jtimberman: kjk: you can use ignore_failure
[2012-11-07 17:35:22 -0500] jtimberman: http://docs.opscode.com/resource_common.html
[2012-11-07 17:35:52 -0500] jtimberman: be careful about using that though, in case the resource you wanted to configure throws an error that prevents something else from being configured correctly.
[2012-11-07 17:36:17 -0500] behemphi1: @gyre008 I just updated that gist with a query that has both the missing hostnames and failed connections.  (The things your code swap fixed last week when I wrote http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573
[2012-11-07 17:36:56 -0500] behemphi1: yuck, that should have been http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573http://tickets.opscode.com/browse/CHEF-3573
[2012-11-07 17:37:14 -0500] behemphi1: OK, give up CHEF-3573
[2012-11-07 17:37:45 -0500] jtimberman: behemphi1: E_TOOMANYPASTES
[2012-11-07 17:37:46 -0500] jtimberman: :)
[2012-11-07 17:38:42 -0500] matti: Haha
[2012-11-07 17:38:46 -0500] matti: jtimberman: +1 ;]
[2012-11-07 17:39:03 -0500] kjk: jtimberman: oh i see, thanks. Though, I wish i can do that at the recipe level instead of at the resource level
[2012-11-07 17:39:06 -0500] behemphi1: @jtimberman I really just did paste that in once.  Hitting enter did all the duplicating.  Sort of like the mystery key stroke that deletes half a file in vi :-)
[2012-11-07 17:39:28 -0500] behemphi1: <grumble>sucks to be me today</grumble>
[2012-11-07 17:43:07 -0500] flowersj: is there a way to detect the platform in the metadata.rb?
[2012-11-07 17:43:13 -0500] chip-: Anyone have a good example of setting node attributes from providers?
[2012-11-07 17:43:30 -0500] flowersj: I would like to conditionally add depends based on different platforms
[2012-11-07 17:44:51 -0500] flowersj: node.platform and platform? does seem to be available in metadata.rb
[2012-11-07 17:45:00 -0500] flowersj: does not that is
[2012-11-07 17:45:26 -0500] philsturgeon: guys - i have a recipe being listed in the run list, which i have emptied out and totally replaces with "SDFGDFJGDFGJKDF" and im not getting any areas when I upload and run the chef-client
[2012-11-07 17:45:37 -0500] philsturgeon: some voodoo magic is happening here, and im confused as hell
[2012-11-07 17:45:43 -0500] BryanWB_: jtimberman:  here is what i have in mind https://github.com/bryanwb/chef-edit
[2012-11-07 17:46:13 -0500] BryanWB_: yfeldblum: tks for ur help, i still have to figure out how to not use the exception, not ignoring ur advice there, just run out of time
[2012-11-07 17:46:37 -0500] philsturgeon: any errors*, typing like english is my second language, sorry guys.
[2012-11-07 18:04:11 -0500] otterley: is there such a thing as conditional notifications, or conditional execution of notifications, in Chef?
[2012-11-07 18:05:15 -0500] otterley: my use case is to restart bind, but only if named-checkconf says the zone passes
[2012-11-07 18:05:38 -0500] philsturgeon: where are cookbooks stored on the server when chef-client is run?
[2012-11-07 18:05:47 -0500] philsturgeon: im making changes and they're being magically ignored somehow.
[2012-11-07 18:05:56 -0500] philsturgeon: want to make sure the downloaded file is correct
[2012-11-07 18:06:04 -0500] chip-: otterly: check out only_if
[2012-11-07 18:06:10 -0500] kryptek: sup all
[2012-11-07 18:06:19 -0500] chip-: sorry, otterley
[2012-11-07 18:06:22 -0500] otterley: chip-: in which resource?
[2012-11-07 18:06:43 -0500] otterley: I'm aware of only_if but I'm not sure how it could help here
[2012-11-07 18:06:52 -0500] chip-: otterley: http://wiki.opscode.com/display/chef/Resources#Resources-ConditionalExecution
[2012-11-07 18:07:21 -0500] kryptek: chip-, I think he's asking how to use it in the context of executing a shell
[2012-11-07 18:07:25 -0500] chip-: otterley: the first example for only_if relies on "test -f /etc/password"
[2012-11-07 18:07:40 -0500] philsturgeon: please, can somebody in here give me some help? I have a cookbook in the run list which has garbage content and its still running. I have no idea how it can do that. I litterally replaced the content with BLARG and it's still installing and nothing fails. http://d.pr/i/ipm4
[2012-11-07 18:07:53 -0500] philsturgeon: php-fpm is replaced with garbage content and runs fine. How on earth can that happen?
[2012-11-07 18:08:07 -0500] jkyle: I'm trying to set an attribute to a default of nil like so and getting "can't convert Symbol into Integer", the line in question is: default[:postgresql][:hba][:localnet] = nil
[2012-11-07 18:08:10 -0500] kryptek: PhilK, Are you re-uploading the cookbook when you do your changes ?
[2012-11-07 18:08:20 -0500] philsturgeon: kryptek: absolutely.
[2012-11-07 18:08:49 -0500] kryptek: jkyle,  where are you trying that assignment, in your attributes file?
[2012-11-07 18:09:01 -0500] jkyle: default attributes file
[2012-11-07 18:09:10 -0500] jkyle: cookbookname/attributes/default.rb
[2012-11-07 18:09:13 -0500] kryptek: PhilK,  Try looking at the cookbook in opscode and see if the content is updated there
[2012-11-07 18:09:19 -0500] otterley: chip-: in this case, the BIND config file always has to be created; and the BIND service always has to exist.  those aren't conditional.  the conditional case is that we notify the bind service to restart IFF the config test passes, in case our generated config file turned out to be bogus, so that we don't automate ourselves into an outage.
[2012-11-07 18:09:22 -0500] philsturgeon: kryptek: http://d.pr/i/UMqy
[2012-11-07 18:10:23 -0500] otterley: jkyle, don't use symbols in keys.  you'll get errors like that.
[2012-11-07 18:10:31 -0500] kryptek: philsturgeon, When you updated the cookbook did the chef client run say it stored the updated cookbook?
[2012-11-07 18:10:41 -0500] philsturgeon: kryptek: ahh, here is some weird shit http://d.pr/i/9iGD
[2012-11-07 18:11:17 -0500] kryptek: philsturgeon,  Looks like you've got multiple versions.  Make sure your environment is specified to use the intended version
[2012-11-07 18:11:49 -0500] philsturgeon: kryptek: deleting both and uploading whatever i have locallyu
[2012-11-07 18:11:50 -0500] philsturgeon: mad
[2012-11-07 18:12:07 -0500] philsturgeon: kryptek: thanks for suggesting i look there.
[2012-11-07 18:12:16 -0500] kryptek: philsturgeon,  np ;)
[2012-11-07 18:12:44 -0500] kryptek: jkyle,  Are you assigning a value to the parents keys of localnet?
[2012-11-07 18:12:56 -0500] philsturgeon: kryptek: http://d.pr/i/6QLq best exception ever
[2012-11-07 18:13:01 -0500] jkyle: same error using quotes: default["postgresql"]["hba"]["localnet"] = nil
[2012-11-07 18:13:06 -0500] chip-: otterley: check out the link resource example in this article, where he sends a restart notify to a service, but not_if based on a simple validation check: https://support.cloud.engineyard.com/entries/21406977-custom-chef-recipes-examples-best-practices
[2012-11-07 18:13:16 -0500] kryptek: philsturgeon, LOL
[2012-11-07 18:13:18 -0500] chip-: (not an endorsement of the entire article; I haven't read it.)
[2012-11-07 18:13:36 -0500] kryptek: jykle:  Do you have some value assigned to default['postgresql']['hba'] ?
[2012-11-07 18:13:36 -0500] otterley: chip-, that still won't work.
[2012-11-07 18:13:42 -0500] jkyle: kryptek: ah, good call. looked higher up in the file I think I see what's going on
[2012-11-07 18:14:00 -0500] otterley: chip-, that always dispatches a notification as long as the resource was created.
[2012-11-07 18:14:26 -0500] chip-: Ah, yeah. Bad example.
[2012-11-07 18:15:09 -0500] mattupstate: is it possible to change the ssh port during bootstrap and then have subsequent knife calls be made on the new port?
[2012-11-07 18:15:15 -0500] otterley: chip-: I think I may have a workaround involving declaring an execute resource, let me test it out
[2012-11-07 18:16:15 -0500] mattupstate: trying to figure out the best way to do this with minimal changes to my knife config and recipes
[2012-11-07 18:16:36 -0500] otterley: mattupstate, I don't think bootstrap is the right time to be doing ssh daemon config changes...
[2012-11-07 18:16:42 -0500] mattupstate: ok
[2012-11-07 18:16:56 -0500] mattupstate: so lets say i change it on the first chef-client run on the node
[2012-11-07 18:17:02 -0500] kryptek: mattupstate,  --ssh-port flag to knife ?
[2012-11-07 18:17:07 -0500] mattupstate: thats gotta happen on 22
[2012-11-07 18:17:14 -0500] mattupstate: oh
[2012-11-07 18:17:15 -0500] mattupstate: actually
[2012-11-07 18:17:17 -0500] mattupstate: nevermind
[2012-11-07 18:17:27 -0500] mattupstate: chef-client doesn't happen over ssh, right?
[2012-11-07 18:17:36 -0500] otterley: nope
[2012-11-07 18:17:39 -0500] mattupstate: right right
[2012-11-07 18:17:40 -0500] mattupstate: ok
[2012-11-07 18:17:48 -0500] kryptek: chef-client is an api call to the server
[2012-11-07 18:17:51 -0500] mattupstate: right
[2012-11-07 18:17:52 -0500] mattupstate: duh
[2012-11-07 18:17:54 -0500] kryptek: :P
[2012-11-07 18:18:01 -0500] mattupstate: i'm still stuck in push mode
[2012-11-07 18:18:21 -0500] chip-: Repeat: Anyone have a good example of setting node attributes from within providers?
[2012-11-07 18:19:29 -0500] otterley: chip-, how about an Ohai plugin instead?
[2012-11-07 18:19:54 -0500] kryptek: chip-,  set_or_return(:variable,value)
[2012-11-07 18:21:30 -0500] mattupstate: chip- i've never seen node attributes set in providers
[2012-11-07 18:21:38 -0500] mattupstate: only in recipes
[2012-11-07 18:24:04 -0500] otterley: it does seem like a Bad Thing To Do
[2012-11-07 18:24:31 -0500] otterley: as far as I'm concerned, providers should be read-only in terms of attributes
[2012-11-07 18:25:01 -0500] otterley: at least when you install an Ohai plugin, you know that's going to be a side effect, presumably because you want it.
[2012-11-07 18:28:15 -0500] chip-: Yeah, I don't love it myself, just dealing with a requirement of statefulness where there should be no state.
[2012-11-07 18:31:23 -0500] jtimberman: kryptek: ohai :)
[2012-11-07 18:35:15 -0500] yfeldblum: chip-, don't set node attributes from within providers ...
[2012-11-07 18:35:23 -0500] yfeldblum: chip-, set node attributes only from recipes
[2012-11-07 18:36:47 -0500] yfeldblum: chip-, you *can* have your resource class have an attribute that can be assigned a block, and then in the provider you *can* call that block at some point, and in your recipe when declaring the resource, you can pass a block that sets attributes on the node
[2012-11-07 18:38:46 -0500] c_t: ohai chefs
[2012-11-07 18:47:09 -0500] otterley: chip-, figured out an elegant way to do it
[2012-11-07 18:47:19 -0500] chip-: otterley: cool! Can you gist?
[2012-11-07 18:47:24 -0500] otterley: sure
[2012-11-07 18:48:28 -0500] otterley: chip-: https://gist.github.com/4033571
[2012-11-07 18:49:47 -0500] chip-: Very elegant.
[2012-11-07 18:49:52 -0500] chip-: Thanks for closing the loop with me.
[2012-11-07 18:50:03 -0500] otterley: yw
[2012-11-07 18:51:33 -0500] otterley: this sort of pattern is useful, generally, where you want to avoid Chef automating you off a cliff
[2012-11-07 18:53:12 -0500] chip-: Agreed.
[2012-11-07 18:58:02 -0500] kryptek: jtimberman,  Hey!
[2012-11-07 19:00:16 -0500] strcrzy_: i'm having strange issues installing gems with native extensions using chef's gem_pkg, that seems to work fine when i install them by hand
[2012-11-07 19:00:22 -0500] strcrzy_: has anyone else encountered this?
[2012-11-07 19:12:12 -0500] jkyle: I'm using the deploy resource. I have a directory: project_name/deploy/shared which has a database.yml and a settings.yml. I have set "symlink_before_migrate" for config/database.yml and config/settings.yml. When I deploy, the chef resource checks out the repo, creates a releases and shared directory in the deploy_to path....but it doesn't copy any of the files from the deploy/shared directory to the created shared directory
[2012-11-07 19:12:37 -0500] jkyle: I think I'm missing something in the work flow, but I thought the shared directory contents was supposed to be copied to the shared directory in the deploy_to
[2012-11-07 19:24:17 -0500] jkyle: it doesn't seem to copy any of the required files into the shared/ directory before running db:migrate...so this needs to be done manually?
[2012-11-07 19:25:19 -0500] wcmaier: j4
[2012-11-07 19:25:21 -0500] wcmaier: erm
[2012-11-07 19:27:26 -0500] mattp: jkyle: yes. typically the reason for this is so you can publish a project but not have, say, the db config (from the shared directory) be externally visible. so set up your files in .../shared manually (just the once for that environment) then then use the rake commands as normal
[2012-11-07 19:30:08 -0500] jkyle: mattp: k, that makes more sense I can begin generating these files before the deploy then
[2012-11-07 19:30:21 -0500] kallistec: strcrzy_: is this using omnibus packages? Are there dependencies on other C libraries?
[2012-11-07 19:32:43 -0500] mattp: jkyle: Yes.  I.e. the steps (assuming the codebase is written) will be 1) create empty shell, 2) create the shared config, 3) deploy.  Naturally, step 3 can be repeated as you make code changes.
[2012-11-07 19:33:45 -0500] jkyle: hm, this could require creation of a new cookbook for each app deployed
[2012-11-07 19:34:02 -0500] strcrzy_: kallistec: im not sure what the omnibus packages are, and yes there are heavy dependencies on other c libraries
[2012-11-07 19:34:04 -0500] jkyle: or caching files in a data bag
[2012-11-07 19:34:35 -0500] kallistec: strcrzy_: well, how'd you install chef? rubygem?
[2012-11-07 19:34:43 -0500] strcrzy_: yes
[2012-11-07 19:34:55 -0500] strcrzy_: i'm on 10.14 because of the cookbook file bug
[2012-11-07 19:35:17 -0500] otterley: I like the Omnibus installer; installing via Rubygems leaves Chef susceptible to external changes
[2012-11-07 19:35:20 -0500] kallistec: strcrzy_: then perhaps it's an environment issue
[2012-11-07 19:36:04 -0500] strcrzy_: i suspect as much i just dont know how to dig deeper / fix it
[2012-11-07 19:36:22 -0500] strcrzy_: whats really weird is if i run chef-client again after it fails it works fine
[2012-11-07 19:37:12 -0500] mattp: jkyle: with a well designed recipe there should be no need for a new cookbook for each app.  just create a suitable defintion and supply the parameters to that.  you could also create a databag containing webapp information, and have a recipe which scans that databag - indeed it's what I do in my current place.
[2012-11-07 19:37:15 -0500] kallistec: strcrzy_: do you mean chef succeeds without error, or it installs the gem and compiles the C ext?
[2012-11-07 19:37:16 -0500] otterley: what's the cookbook file bug you're referring to strcrzy_ ?
[2012-11-07 19:37:25 -0500] strcrzy_: kallistec: well, both
[2012-11-07 19:37:44 -0500] strcrzy_: otterley: in .16 cookbook file wouldnt set permissions correctly
[2012-11-07 19:37:58 -0500] otterley: have a Jira reference?
[2012-11-07 19:38:00 -0500] kallistec: strcrzy_: fixed in 10.16.2
[2012-11-07 19:38:56 -0500] otterley: oh good, I have 10.16.2 via Omnibus
[2012-11-07 19:39:20 -0500] strcrzy_: kallistec: nice
[2012-11-07 19:39:22 -0500] strcrzy_: http://tickets.opscode.com/browse/CHEF-3547
[2012-11-07 19:42:10 -0500] strcrzy_: kallistec: so if i install chef using the omnibus installer you think i might encounter less frustration?
[2012-11-07 19:43:50 -0500] kallistec: strcrzy_: I don't think it will change anything for this particular issue. It is nice to have the whole thing installed as a single package, but also there are some unfortunate issues if you are loading database gems into chef, e.g., http://tickets.opscode.com/browse/COOK-1406
[2012-11-07 19:46:13 -0500] strcrzy_: hm
[2012-11-07 19:46:20 -0500] strcrzy_: well first off, thanks for saving me some time
[2012-11-07 19:46:37 -0500] strcrzy_: what do you think i should do? should i open a ticket?
[2012-11-07 19:47:14 -0500] jkyle: mattp: I'm putting the file contents for config in a databag...at least the ones that aren't automatically generated from node searching like the database.yml
[2012-11-07 19:47:41 -0500] strcrzy_: i guess i'll try it on .16.2 first to be sure it hasnt been fixed
[2012-11-07 19:47:42 -0500] kallistec: strcrzy_: well, can you post a gist of the error you get and the recipe you're using? I'd guess it's a problem there rather than in Chef
[2012-11-07 19:47:50 -0500] atomic-penguin: http://www.youtube.com/watch?v=7E1KcDinD5c
[2012-11-07 19:47:53 -0500] strcrzy_: of course one sec
[2012-11-07 19:50:48 -0500] strcrzy_: kallistec: https://gist.github.com/e1f65a923dd745df7ba2
[2012-11-07 19:51:52 -0500] strcrzy_: kallistec: whats even stranger to me is that it will fail on different things sometimes (sometimes it compiles but fails at link-time)
[2012-11-07 19:52:03 -0500] strcrzy_: my apologies if i'm doing something completely stupid :(
[2012-11-07 19:54:07 -0500] kallistec: strcrzy_: nothing obvious to me, is there anything on the tubes if you google for the error message you get out of gem?
[2012-11-07 19:55:03 -0500] Vadim: Hi guys
[2012-11-07 19:55:34 -0500] Vadim: Have a question related :immediate invocation
[2012-11-07 19:56:42 -0500] Vadim: Is it blocking? I am trying to shutdown a tomcat, but when running a command right after immediate is run it says that tomcat is still running
[2012-11-07 19:57:13 -0500] strcrzy_: kallistec: thanks for looking. i just gisted the recipes too if you want. i googled the error and the most useful information i got out of it was about .pc files and include paths, but the thing is i'm not sure how to modify chef's behavior about these things
[2012-11-07 19:57:40 -0500] strcrzy_: is there a way to get chef to reload {header,library,whatever the hell .pc is} search paths in a run?
[2012-11-07 19:59:10 -0500] strcrzy_: i feel like what's happening is something's not getting updated as the dependencies for this gem are installed in the same run. what i dont understand is this has never been a problem before.
[2012-11-07 20:00:09 -0500] kallistec: strcrzy_: if there are options to pass to the gem install to tell it where libraries are, you can add them as an options string: http://docs.opscode.com/resource_package.html
[2012-11-07 20:01:52 -0500] strcrzy_: hm good point
[2012-11-07 20:02:03 -0500] strcrzy_: i'll dig there
[2012-11-07 20:48:49 -0500] strcrzy_: kallistec: fyi, it's not a problem in 10.16.2
[2012-11-07 20:49:02 -0500] strcrzy_: so i guess whatever was problematic has since been fixed
[2012-11-07 20:49:32 -0500] strcrzy_: thanks for taking the time to wade through this with me
[2012-11-07 21:13:35 -0500] balgarath: so, I was trying to edit some of a node's attributes to pass into a recipe(an array of gem names to be installed) via "knife node edit [name]" - and got "Node not updated, skipping node save".  some googling tells me I can only edit the run_list and normal attributes(not sure what a normal attribute is) via the command.  do I need to be using roles to add attributes to a node?  or am I missing something?
[2012-11-07 21:14:15 -0500] wassy121:  That error might happen if you have a syntax error with your JSON
[2012-11-07 21:15:22 -0500] balgarath: i did have some syntax errors and got an appropriate message for those.  after fixing the errors I got that message.  are you saying I should be able to add a list of gems into the attributes from there?
[2012-11-07 21:16:03 -0500] wassy121: balgarath, yes, you should be able to manage the attributes directly in there.
[2012-11-07 21:16:53 -0500] wassy121: is that the full text of the error?  It seems like there should be something above it that says why it wasn't updating/saving
[2012-11-07 21:16:56 -0500] balgarath: wassy121: should I be adding these inside the "normal" hash, or as a top-level attribute?
[2012-11-07 21:17:17 -0500] wassy121: Inside the normal: {} hash.  That is where the node attributes are set
[2012-11-07 21:18:26 -0500] wassy121: Be aware of the order of attribute precedence (http://wiki.opscode.com/display/chef/Attributes) , so you may need to put it in override_attributes if you're doing something weird in your recipe/attributes files
[2012-11-07 21:20:02 -0500] balgarath: great thanks
[2012-11-07 21:33:01 -0500] rava: any reason a cookbook wouldn't see a dependent cookbook even though it shows up in a knife cookbook list?
[2012-11-07 21:33:46 -0500] miah: environmental restrictions
[2012-11-07 21:33:49 -0500] wonko_be: jtimberman: found the problem I had with test-kitchen - librarian apparently assumes that all listed dependencies actually point to the public hosted cookbooks...
[2012-11-07 21:34:17 -0500] rava: i've uploaded it with the -E flag to the environment the recipe should be running in
[2012-11-07 21:34:32 -0500] rava: the jenkins cookbook is yelling that it can't find apt
[2012-11-07 21:38:11 -0500] rava: ah found it, jenkins default recipe uses an include_recipe statement for apt but doesn't have depends "apt" in metadata.rb
[2012-11-07 21:42:12 -0500] rava: ugh, foodcritic...must get it running
[2012-11-07 21:43:49 -0500] miah: gem install foodcritic
[2012-11-07 21:43:58 -0500] miah: foodcritic /path/to/cookbook
[2012-11-07 21:46:41 -0500] rava: yeah, that's easy, its getting ruby to behave on os x an rvm to not puke in wierd ways that's the fun part
[2012-11-07 21:48:09 -0500] chip-: rava: It's crashy but once you get Xcode / Xcode-cli / brew / brew gcc installed, then Jewelrybox can help with the whole RVM-on-osx dance.
[2012-11-07 21:48:35 -0500] rava: chip-: thanks, hadn't run across a reference to jewlerybox yet. a googleing i shall go
[2012-11-07 22:01:06 -0500] miah: i just brew install rbenv and ruby-build
[2012-11-07 22:01:09 -0500] miah: pretty damned simple
[2012-11-07 22:01:40 -0500] chip-: rava: You'll need homebrew and home-brew gcc if you're on a newer osx, thanks to Apple's NIH around compilers.
[2012-11-07 22:03:36 -0500] erikh: llvm is NIH?
[2012-11-07 22:08:55 -0500] otterley: what's the point of Chef on OS X?
[2012-11-07 22:09:27 -0500] otterley: unless you're just running knife, I guess
[2012-11-07 22:12:20 -0500] miah: or managing your workstation with chef..
[2012-11-07 22:12:40 -0500] miah: or writing code against chef and testing it locally.. etc etc etc
[2012-11-07 22:16:31 -0500] rava: otterley: what miah said. i shef on my local machine has saved me a ton of time
[2012-11-07 22:17:08 -0500] otterley: that's what VMs are for.  you can't reliably test a cookbook on a different OS than your deployment target.
[2012-11-07 22:18:47 -0500] rava: otterley: i'm not always testing package providers and other stuff that would rely on the node being a specific platform. testing jenkins job files, config file generation based on roles, blah blah blah are all really easy and portable across platforms
[2012-11-07 22:19:08 -0500] otterley: fair enough
[2012-11-07 22:19:23 -0500] rava: and os x's memory management sucks so much ass that running even 2 vagrant boxes will start pissing me off
[2012-11-07 22:19:28 -0500] otterley: I still wouldn't pollute my workstation with that garbage
[2012-11-07 22:19:32 -0500] otterley: but that's a personal preference :)
[2012-11-07 22:20:14 -0500] otterley: agreed on OS X's VM.  vestiges from mid-'90s NeXT OS that never really evolved :(
[2012-11-07 22:20:16 -0500] rava: there are enough tools that isolate the packages being used that that's not a problem. brew's cellars, rvm for managing ruby versions and gems, etc..
[2012-11-07 22:20:36 -0500] otterley: s/rvm/rbenv.  friends don't let friends use rvm
[2012-11-07 22:22:53 -0500] rafaelmagu: :D
[2012-11-07 22:26:25 -0500] rava: otterley: heh, it would help if i spent more time in ruby land. only reason i touch it is for chef. otherwise my shop's all python
[2012-11-07 22:26:55 -0500] rava: every time i look at how to do something in ruby it feels like there's a whole new framework and way to do it. most ADD community ever
[2012-11-07 22:28:50 -0500] rava: and the version fractioning hurts my soul
[2012-11-07 22:36:23 -0500] otterley: yeah, the culture isn't as refined as what I'm used to from the old Perl days
[2012-11-07 22:37:36 -0500] yfeldblum: rava, otterley, progress happens fast!
[2012-11-07 22:39:00 -0500] otterley: yfeldblum: http://www.youtube.com/watch?v=Q5cEAhjcv54
[2012-11-07 22:39:38 -0500] slava_dp|: in what cases can I use node.attr in place of node["attr"] ?
[2012-11-07 22:40:53 -0500] otterley: only when you're absolutely sure your attribute isn't the same name as a method already existing on node
[2012-11-07 22:40:59 -0500] otterley: I would advise against it
[2012-11-07 22:42:11 -0500] jtimberman: slava_dp|: while you can use node.attribute_name_you_want_to_use, it is possible for attributes to contain characters that are not allowed in Ruby methods, such as node["some-method-with-dashes"] or, freakishly, node["why did you use spaces and a question mark?"]
[2012-11-07 22:42:19 -0500] jtimberman: well i guess yo ucan hav ea question mark in a method :)
[2012-11-07 22:42:31 -0500] julian__: hey guys, I am a newbie here.  how do I include a base role in another role file?
[2012-11-07 22:42:41 -0500] julian__: include_role?
[2012-11-07 22:42:46 -0500] jtimberman: julian__: put role[thing_i_want] in the role's run list
[2012-11-07 22:42:46 -0500] otterley: julian__:  put it in the run_list
[2012-11-07 22:42:55 -0500] jtimberman: just like recipe[thing]
[2012-11-07 22:42:57 -0500] schlazor: is it possible to reference a node attribute, say fqdn, inside the value of a role override_attribute, either in the Ruby DSL or json? So like building a URI that contains the fqdn of the node?
[2012-11-07 22:43:02 -0500] yfeldblum: jtimberman, but only at the end of the method, not in the middle
[2012-11-07 22:43:11 -0500] jtimberman: yfeldblum: true!
[2012-11-07 22:43:17 -0500] julian__: ahhhh.  so:    role[base]
[2012-11-07 22:43:35 -0500] jtimberman: schlazor: no, the role is data and stored on the server, if you need logic put it in a recipe.
[2012-11-07 22:43:49 -0500] otterley: speaking of attributes, jtimberman
[2012-11-07 22:44:00 -0500] otterley: I've noticed that shef doesn't seem to populate them properly, unlike chef-clietn
[2012-11-07 22:44:04 -0500] LennyLinux: Besides node['dontdothis'] = '', is it wrong myvar = node['dothis'] ?
[2012-11-07 22:45:37 -0500] LennyLinux: Ok, maybe i should read the doc about it before ask here. :P
[2012-11-07 22:46:35 -0500] jtimberman: otterley: what do you mean?
[2012-11-07 22:46:40 -0500] jtimberman: otterley: if you run shef in client mode?
[2012-11-07 22:46:45 -0500] schlazor: jtimberman: OK thanks
[2012-11-07 22:46:49 -0500] otterley: jtimberman, ya, client mode
[2012-11-07 22:47:00 -0500] jtimberman: otterley: yeah, ssd7 has dug into why that is more than i have.
[2012-11-07 22:47:15 -0500] otterley: default attributes set by roles don't seem to be set, so when I inspect the node object, it's just totally wrong
[2012-11-07 22:47:18 -0500] jtimberman: otterley: generally if i'm debugging attributes in shef, i just go to attributes mode and past in the content from my cookbook.
[2012-11-07 22:47:22 -0500] jtimberman: yeah
[2012-11-07 22:47:32 -0500] jtimberman: the roles aren't loaded, i think
[2012-11-07 22:47:43 -0500] jtimberman: but, i defer to ssd7's debuggery
[2012-11-07 22:47:45 -0500] otterley: ssd7, do you have a Jira ticket I can track?
[2012-11-07 22:48:35 -0500] ssd7: reading backsroll
[2012-11-07 22:49:02 -0500] julian__: ok this explains it: http://wiki.opscode.com/display/chef/Roles  Should have read the doc :-)
[2012-11-07 22:49:19 -0500] ssd7: otterley: OH, yeah, one second.  There is a bug that I submitted a fix for, let me find it.
[2012-11-07 22:50:20 -0500] ssd7: otterley: I need to add tests: http://tickets.opscode.com/browse/CHEF-2467
[2012-11-07 22:50:42 -0500] schlazor: jtimberman: so how would I get a group of nodes to have as an attribute used by template in a recipe to have a string built from a static set of characters plus that node's FQDN? Define a role with a pre and post string and if they both exist as an attribute build the URI in the recipe? Seems kind of hackish.
[2012-11-07 22:50:52 -0500] ssd7: otterley: I'll try to do that tonight.  I find writing tests for CHEF pretty painful, but I want that fix too.
[2012-11-07 22:51:10 -0500] kryptek: schlazor,  In the resource template, use variables({}) to pass that string to the template
[2012-11-07 22:52:07 -0500] kryptek: schlazor,  variables({:some_fqdn, "#{node['fqdn']}-#{static_string}"})
[2012-11-07 22:52:09 -0500] kryptek: something like that
[2012-11-07 22:52:30 -0500] otterley: ssd7, no hurry, I just wanted to watch the resolution of it so I know what release the fix will be in
[2012-11-07 22:54:12 -0500] schlazor: kryptek: I know how to pass variables to a template in a recipe, i just don't see how I can build the variable to pass it unless I do some sort of hackish thing where I expect some attribute to be defined by a role and then only pass the variable if its defined
[2012-11-07 22:55:09 -0500] schlazor: kryptek: I'd rather the recipe didn't have any dependency on a arbitrary role, is what I'm saying
[2012-11-07 22:57:51 -0500] yfeldblum: schlazor, that's the right goal to achieve
[2012-11-07 22:58:49 -0500] schlazor: maybe use a data bag or something? can those reference a node's attribute to be expanded at run time?
[2012-11-07 23:00:47 -0500] yfeldblum: schlazor, "Define a role with a pre and post string and if they both exist as an attribute build the URI in the recipe? Seems kind of hackish." ... but the whole point of a recipe is to run ruby code to compute just such kinds of things! so it's not hackish at all, but the opposite
[2012-11-07 23:04:44 -0500] schlazor: yfeldblum: I guess my frustration is that I want to use a list of hashes to populate a config file using a template, and if a role's attributes could reference the node instance's attributes it'd be really clean. Seems like there would be other situations where that could be useful.
[2012-11-07 23:07:40 -0500] schlazor: yfeldblum: especially since I can do so in a cookbook's attributes file, i.e. default['activemq']['transport_connectors'] = [{ "name" => "ssl", "uri" => "ssl://#{node['fqdn']}:443"},{"name" => "openwire", "uri" => "tcp://#{node['fqdn']}:61616", "discoveryUrl" => "multicast://default"} ]
[2012-11-07 23:08:08 -0500] madzim: hi everyone. I'm just starting to play with Chef. I have client and server VMs on Ubuntu. I'm trying to use KNIFE to install the JAVA cookbook. When I run the command, i'm told that the cookbook repo path /var/chef/cookbooks does not exist. But the path is set in server.rb as /var/lib/chef/cookbooks. Where is the disconnect?
[2012-11-07 23:08:43 -0500] madzim: The command is from the wiki: "sudo knife cookbook site install java"
[2012-11-07 23:10:03 -0500] yfeldblum: schlazor, your roles should *only* have intention details and *not* implementation details ... your recipes should figure out the implementation details based on the intentions expressed in roles
[2012-11-07 23:10:41 -0500] yfeldblum: schlazor, your roles should be small and your recipes should be big
[2012-11-07 23:11:38 -0500] cheeseplus: yfeldblum: so would you consider overriding many attributes in a role a bad thing?
[2012-11-07 23:11:46 -0500] yfeldblum: cheeseplus, yes
[2012-11-07 23:12:34 -0500] yfeldblum: cheeseplus, that's usually a situation where you have complex implementation details; that belongs in code, and code belongs in a recipe
[2012-11-07 23:12:41 -0500] cheeseplus: hrm, trying to think of how I would write it such that the recipes were still generic enough
[2012-11-07 23:12:47 -0500] rava: yfeldblum: i've heard tell of the opposite. make recipes small, providers small, with big libraries and attribute values in roles/environments
[2012-11-07 23:13:20 -0500] yfeldblum: cheeseplus, you can have a top-level recipe that's purely specific to your infrastructure that sets node attributes and then includes other recipes
[2012-11-07 23:13:34 -0500] cheeseplus: yfeldblum: in this case it's config attributes for a database so while it looks big in json it's mostly things like put db directory here, set log size, etc
[2012-11-07 23:13:39 -0500] yfeldblum: cheeseplus, you can have a few of those top-level recipes for different purposes
[2012-11-07 23:14:08 -0500] cheeseplus: yfeldblum: that may be the way I take it then, it's kind of ugly having all the json in there and 9/10 times I bust it when editing
[2012-11-07 23:14:21 -0500] yfeldblum: rava, in the simple case of comparing recipes vs roles, take the complexity out of roles and put it into recipes
[2012-11-07 23:14:39 -0500] schlazor: yfeldblum: OK so then I just have to document all the arbitrary attribute stuff / make it user configurable?
[2012-11-07 23:15:06 -0500] cheeseplus: would be a dead simple top level recipe, probably less lines than the role/me ponders
[2012-11-07 23:15:10 -0500] yfeldblum: rava, then you get to the question of cookbooks which are more complicated and have recipes, libraries, definitions, resources, and providers ... and how to distribute different parts of the code between the different parts of the cookbook ... but that's a question for another day :D
[2012-11-07 23:15:23 -0500] rava: yfeldblum: indeed
[2012-11-07 23:15:40 -0500] yfeldblum: cheeseplus, busting json :(
[2012-11-07 23:16:17 -0500] cheeseplus: yfeldblum: thanks for the food for thought, it's overly complicated with json or rb files because of the nested nature of the attributes and the fact they have to be piped through a helper library anyway
[2012-11-07 23:16:30 -0500] cheeseplus: the joys of erlang configs
[2012-11-07 23:16:40 -0500] yfeldblum: cheeseplus, have all the helper libraries you want! ... in your cookbooks :D
[2012-11-07 23:16:50 -0500] rava: cheeseplus: i stick with json everywhere except where i can't
[2012-11-07 23:17:31 -0500] cheeseplus: well that is where they are, we use prefixes for the role attributes: __string_STRINGHERE becomes an erlang string
[2012-11-07 23:17:38 -0500] wassy121: How can you set the value of a node attribute from a recipe that returned that node item from a search?
[2012-11-07 23:18:25 -0500] wassy121: So, I have a sql cluster data node, and it needs to find the cluster manager, increment the "number_of_connected_servers" attribute on that node from the sql node recipe
[2012-11-07 23:18:54 -0500] slava_dp|: otterley, jtimberman, thanks for your replies regarding node.attr, I was afk for a while :)
[2012-11-07 23:19:03 -0500] wassy121: I tried it like: cluster_manager.set['clusterdb']['current_sql_connectors'] = cluster_manager['clusterdb']['current_sql_connectors'] + 1
[2012-11-07 23:19:49 -0500] yfeldblum: wassy121, sounds like a bad idea
[2012-11-07 23:20:19 -0500] yfeldblum: wassy121, maybe each server maintains its own list of servers_connected_to?
[2012-11-07 23:20:42 -0500] otterley: one of these days I should publish our Chef repository structure; it's very sensible and scalable
[2012-11-07 23:20:50 -0500] rava: wow, so much <3 for foodcritic. this would have saved me so much time last week
[2012-11-07 23:21:22 -0500] rava: otterley: i'd love to see more chef-repos published
[2012-11-07 23:21:43 -0500] schlazor: yfeldblum: role attributes seemed like the perfect place to customize the config values of a generic recipe for a product but what you're saying is I should rather have separate, use-case specific recipes for each specific task I want to do with a product, then apply that specific recipe in a cookbook to a role?
[2012-11-07 23:21:45 -0500] otterley: I can't publish the repository itself, just how we organize roles and attribute priorities
[2012-11-07 23:21:46 -0500] wassy121: yfeldblum, I can get my head around how to do it like you say.
[2012-11-07 23:22:06 -0500] slava_dp|: otterley: do it, we need more examples! =)
[2012-11-07 23:22:56 -0500] yfeldblum: schlazor, there's no such thing as "role attributes"; there are only node attributes, some of which happen to be set by a role, some of which happen to be set by a recipe, etc
[2012-11-07 23:23:15 -0500] rava: schlazor: there's a good write up that i got linked to here on cookbooks and recipes, let me see if i can find it. i like miah 's cookbooks as thought reference as well
[2012-11-07 23:23:31 -0500] yfeldblum: schlazor, the nitty-gritty of how to configure a particular recipe whose job it is to configure a particular package isn't really the job for a role
[2012-11-07 23:24:10 -0500] yfeldblum: schlazor, the nitty-gritty of configuring a recipe should be the job of another recipe, and the role just has a few key, high-level, overall bits of data, but none of the nitty-gritty
[2012-11-07 23:24:43 -0500] schlazor: yfeldblum: OK, I just saw all these recipes using attribute overrides for the mundane config stuff so I went down the road to add the things I wanted to configure for a group of nodes and got stuck here.
[2012-11-07 23:25:21 -0500] wassy121: yeah, so search returns just a json blob of the node, and not the node object itself.  Can I make one recipe change the value on a node from a different recipe?
[2012-11-07 23:25:27 -0500] schlazor: yfeldblum: but I'll take that approach instead. Thanks for the advice!
[2012-11-07 23:26:23 -0500] wassy121: Or, make it call a function in a different recipe that increments that value or something?  Gah.
[2012-11-07 23:26:42 -0500] wassy121: It sounds messy, like I shouldn't have one node changing another.
[2012-11-07 23:27:59 -0500] madzim: I realize this is an rtfm question, but i'm just beating my head against the wall here. what is the right way to get a cookbook from github into the chef-server?
[2012-11-07 23:28:23 -0500] gchristensen: not knife?
[2012-11-07 23:28:34 -0500] rava: knife cookbook site download|install COOKBOOK
[2012-11-07 23:29:08 -0500] rava: or just grab it using git and stick in your cookbooks directory in your repo then go about pushing it as you see fit
[2012-11-07 23:29:27 -0500] rava: you'll still need to do the push if you do a knife site * anyway
[2012-11-07 23:33:19 -0500] madzim: @rava: thanks. I tried that command but was getting the wrong cookbook_path so I defined the path created by chef-server in knife.rb. I was prompted to use "git init" to initialize the repo. After doing that in the cookbooks folder, I'm getting "default branch 'master' does not exist.
[2012-11-07 23:33:31 -0500] madzim: Wow, so much still to learn.
[2012-11-07 23:34:03 -0500] madzim: @rava I missed that last statement about pushing before I responded
[2012-11-07 23:34:31 -0500] madzim: So it sounds like I first use knife to get the code from github then use knife to install it to my chef-server repo.
[2012-11-07 23:34:32 -0500] rava: madzim: get in the habit of using knife cookbook test COOKBOOK before a push :)
[2012-11-07 23:34:51 -0500] rava: madzim: pretty much, though you don't NEED to use knife to get the cookbook in the first place
[2012-11-07 23:35:02 -0500] rava: you can get the files anyway you see fit, it's just easier
[2012-11-07 23:36:08 -0500] madzim: @rava: okay, so shortest path for my demo on monday (omg!) would be to just git the cookbook. Just goes straight into the chef-server cookbooks folder? or knife cookbook install it from a staging location?
[2012-11-07 23:37:00 -0500] rava: if knife's configured right, and the cookbook path in your knife.rb is the one where you will be doing your editing/managing of the repo, make things simple for yourself and use knife cookbook site download
[2012-11-07 23:37:06 -0500] rava: to get the cookbook
[2012-11-07 23:38:09 -0500] julian__: Hey guys, getting this error:  ATAL: Errno::ENOENT: No such file or directory - /var/chef/cache/cookbooks/s3/recipes/pull_wp_file.rb.  I have added cookbook s3 and added in recipe but for some reason the chef client is not finding it locally on the client.  ideas?
[2012-11-07 23:38:11 -0500] madzim: @rava, configured right.. huge assumption! :)
[2012-11-07 23:38:13 -0500] rava: futz with it with whatever your workflow is, knife cookbook test COOKBOOK (won't catch runtime issues, but simple syntax problems and the liek get caught)
[2012-11-07 23:39:46 -0500] julian__: do I have to declare it in metadata.rb?
[2012-11-07 23:40:07 -0500] julian__: the recipe pull_wp_file.rb that is.
[2012-11-07 23:40:20 -0500] rava: julian__: depends "s3"
[2012-11-07 23:40:50 -0500] yfeldblum: wassy121, i'd suggest never trying to save nodes in a recipe
[2012-11-07 23:40:55 -0500] rava: julian__: that's a funky message though, got a gist of the full traceback?
[2012-11-07 23:40:59 -0500] julian__: rava: thanks for the response.  Where does that go exactly?
[2012-11-07 23:41:00 -0500] yfeldblum: wassy121, i'd suggest looking for another way to accomplish the overall goal
[2012-11-07 23:41:27 -0500] rava: julian__: if you're trying to declare a cookbook depends on another cookbook. i may not be understanding what you wanted right htough :)
[2012-11-07 23:42:06 -0500] miah: rava: http://blog.nistu.de/2012/03/04/reusability-in-configuration-management-systems/ ?
[2012-11-07 23:42:54 -0500] rava: miah: that's the article i was looking for earlier! thanks :)
[2012-11-07 23:45:53 -0500] madzim: @rava can I just git clone straight into the cookbooks folder?
[2012-11-07 23:49:58 -0500] rava: madzim: not sure i grok what you mean
[2012-11-07 23:50:14 -0500] rava: madzim: do you mean just cloning the cookbook from the repo into the cookbooks folder? then yes
[2012-11-07 23:50:20 -0500] madzim: that's cuz I dont understand what I'm asking!
[2012-11-07 23:50:43 -0500] madzim: okay, I tried that
[2012-11-07 23:50:59 -0500] madzim: but chef-webui didn't see them
[2012-11-07 23:51:06 -0500] rava: madzim: the way you get the cookbook doesn't matter. chef doesn't care when you try to upload it
[2012-11-07 23:51:09 -0500] madzim: Is there a knife command to force a refresh?
[2012-11-07 23:51:19 -0500] rava: do a knife cookbook list
[2012-11-07 23:51:26 -0500] rava: if it doesn't show up, then it's not pushed to the server
[2012-11-07 23:52:01 -0500] rava: if that's the case, you have to run knife cookbook upload COOKBOOK [options]
