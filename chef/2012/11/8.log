[2012-11-08 00:04:03 -0500] lyric: I have an ec2 node and domain and fqdn are not defined, i did not see this on others, thoughts
[2012-11-08 00:04:04 -0500] lyric: ?
[2012-11-08 00:06:05 -0500] madzim: @rava thanks for your patience. knife cookbook list did not return anything. cookbook_path is defined as "[/var/lib/chef/cookbooks]" in both ~/.chef/knife.rb and /etc/chef/server.rb. I used GIT CLONE to get the java cookbook into /var/lib/chef/cookbooks/java
[2012-11-08 00:07:36 -0500] slava_dp|: can I use shared variables between recipe and template?
[2012-11-08 00:07:38 -0500] rava: madzim: ouch, that cookbook path in knife.rb should be your chef repo's cookbook path
[2012-11-08 00:08:36 -0500] madzim: I think it is time I reread the basics page on the wiki.
[2012-11-08 00:08:37 -0500] rava: even still
[2012-11-08 00:08:58 -0500] rava: if the folder for the cookbook is in there...knife should find it for a knife cookbook upload
[2012-11-08 00:09:34 -0500] miah: you need to use knife or another tool to upload your cookbooks to chef, not git clone directly into the server
[2012-11-08 00:11:16 -0500] maplebed: the nagios cookbook[1] references an Opscode Nagios Quick Start document at http://help.opscode.com/kb/otherhelp/nagios-quick-start.  That link is dead.  Anybody know where I can find the doc?
[2012-11-08 00:11:22 -0500] maplebed: [1] https://github.com/opscode/cookbooks/tree/master/nagios
[2012-11-08 00:11:38 -0500] miah: the quickstart stuff is really out of date
[2012-11-08 00:11:51 -0500] maplebed: does that imply that the nagios cookbook is also really out of date?
[2012-11-08 00:11:57 -0500] miah: no. not at all.
[2012-11-08 00:12:01 -0500] madzim: I didn't come across references to chef-repo walking through the chef-server setup. So should I git clone .../chef-repo into another location and point knife's cookbook_path to that location?
[2012-11-08 00:12:32 -0500] miah: madzim: yes
[2012-11-08 00:12:34 -0500] rava: madzim: read the sections on configuring your management workstation
[2012-11-08 00:12:39 -0500] miah: ^^^^
[2012-11-08 00:13:32 -0500] madzim: will do. It sounds like the best practice is that one does not use the chef-server as the management workstation?
[2012-11-08 00:13:44 -0500] rava: madzim: correct
[2012-11-08 00:14:55 -0500] madzim: okay. awesome. thanks for identifying the root cause...my lack of knowledge. :)
[2012-11-08 00:14:57 -0500] rava: madzim: while you can configure a local user with knife and client keys, it's generally frowned upon. the running concensus is that the management workstation should be a remote machine with only client api access
[2012-11-08 00:15:29 -0500] maplebed: miah: do you have a suggestion for a different place to look for more detail about using the nagios cookbook?  I'm looking to replace my janky homegrown nagios cookbook with it and it's always daunting diving into a complicated cookbook like this one.
[2012-11-08 00:15:32 -0500] rava: madzim: as that's the workflow pattern when you're running with hosted chef. you don't get shell access to opscode servers :)
[2012-11-08 00:16:11 -0500] yfeldblum: rava, unless you're 1337
[2012-11-08 00:16:43 -0500] maplebed: speaking of best practice, rava, how do most folks integrate revision control (presumably on github) with hosted chef (and knife uplload)?
[2012-11-08 00:16:48 -0500] madzim: good point, rava. I know I'm trying to put these into the simple client-server model I understand.
[2012-11-08 00:17:24 -0500] miah: madzim: not really. just read through the cookbook source.
[2012-11-08 00:17:58 -0500] miah: ask questions in here
[2012-11-08 00:18:13 -0500] maplebed: ok, np.
[2012-11-08 00:18:15 -0500] rava: maplebed: seperate concerns, just cuz there's a cookbook comitted to your repo doesn't neccessarily mean it's in chef-server
[2012-11-08 00:18:35 -0500] rava: miah: think you meant that for maplebed ?
[2012-11-08 00:18:39 -0500] maplebed: rava: precisely.  half the time you forget to git commit your change and the toher half the time you forget to knife upload it.
[2012-11-08 00:18:58 -0500] maplebed: both of which wreak havok on managing the cookbooks with a team.
[2012-11-08 00:18:59 -0500] rava: check out the presentation by etsy on their spork knife plugin
[2012-11-08 00:19:21 -0500] maplebed: I was thinking of trying to set up a post-commit hook to do a knife upload...
[2012-11-08 00:19:24 -0500] rava: http://www.youtube.com/watch?v=nSnJCJiZDDU
[2012-11-08 00:19:27 -0500] maplebed: ah.
[2012-11-08 00:19:33 -0500] maplebed: ok, thanks.  I'll give it a watch.
[2012-11-08 00:19:34 -0500] miah: probably. im lazytype today.
[2012-11-08 00:19:40 -0500] maplebed: ;)
[2012-11-08 00:20:48 -0500] yfeldblum: so ... this is like having your application in git, but then having to scp each changed file into place on the server each time you commit a change
[2012-11-08 00:21:11 -0500] maplebed: heh...  not quite that bad.
[2012-11-08 00:21:14 -0500] rava: yfeldblum: it's so horrible sounding when you put it like that
[2012-11-08 00:21:29 -0500] yfeldblum: rava, and yet, it's exactly what 99% of chefers do ...
[2012-11-08 00:23:28 -0500] kallistec: yfeldblum: for dev/test it makes sense. when I'm working on a HTTP app, I don't push every change to github, tag it, and deploy to a cluster just to see it work.
[2012-11-08 00:23:39 -0500] yfeldblum: rava, i like to change the metaphor to Infrastructure As Application ... build and run your infrastructure like you build and run your applications ... figure out how you build and run your applications, and then build and run your infrastructure that way :D
[2012-11-08 00:23:54 -0500] bluepojo: If you use proper version locks, it's not exactly like the scp example
[2012-11-08 00:24:06 -0500] bluepojo: in fact, it's not at all like the scp example
[2012-11-08 00:24:12 -0500] bluepojo: cause it won't go to production
[2012-11-08 00:24:15 -0500] bluepojo: until you bump your locks
[2012-11-08 00:24:27 -0500] bluepojo: however I agree that you should use a build job to push your cookbooks
[2012-11-08 00:24:34 -0500] yfeldblum: bluepojo, it's still a hack to work around the fact that it's basically scp'ing each file into place
[2012-11-08 00:24:35 -0500] bluepojo: with automated testing and foodcritic linting
[2012-11-08 00:24:46 -0500] rava: bluepojo: i like env + version locks, but that's just nitpicking
[2012-11-08 00:26:04 -0500] rava: would be nice if i could sandbox what environment new engineers could push to
[2012-11-08 00:26:10 -0500] maplebed: does the etsy youtube cover what you're talking about?
[2012-11-08 00:26:27 -0500] rava: maplebed: environments? yes
[2012-11-08 00:26:33 -0500] maplebed: and version locks
[2012-11-08 00:26:46 -0500] rava: not precisely, he glosses over it real quick
[2012-11-08 00:27:02 -0500] rava: look in the wiki on version constraints
[2012-11-08 00:27:06 -0500] yfeldblum: rava, you can: their own!
[2012-11-08 00:27:20 -0500] maplebed: k.
[2012-11-08 00:27:54 -0500] rava: yfeldblum: on OSS chef at least, i can't say "this client key can only push to environment Y"
[2012-11-08 00:28:06 -0500] yfeldblum: rava, per-developer infrastructures (with per-developer chef-servers), on the cloud!
[2012-11-08 00:28:18 -0500] rava: yfeldblum: ew, so pricey :)
[2012-11-08 00:28:28 -0500] yfeldblum: rava, or if your devs have big desktops, then a local openstack!
[2012-11-08 00:28:40 -0500] yfeldblum: rava, or libvirt
[2012-11-08 00:28:56 -0500] rava: yfeldblum: tiny vagrant box does the job for me. i saw some neat stuff with cucumber-chef
[2012-11-08 00:29:03 -0500] yfeldblum: rava, or vagrant with multiboxes
[2012-11-08 00:29:31 -0500] yfeldblum: rava, but one of them being a prepackaged chef-server, the others being to run the the cookbooks
[2012-11-08 00:29:39 -0500] rava: yfeldblum: though we're already working on getting ci going through jenkins. now that i've tested and like foodcritic i'm scheming a build build jobs :)
[2012-11-08 00:30:16 -0500] bluepojo: rava: we manage all environments via json files in chef-repo which get pushed by a build job. New engineers aren't allowed to push to chef-repo without a pull request
[2012-11-08 00:30:23 -0500] bluepojo: or rather
[2012-11-08 00:30:24 -0500] rava: yfeldblum: yeah, i toyed with the idea of having a vagrant folder in the chef repo with a Vagrantfile defining the sandbox env
[2012-11-08 00:30:28 -0500] bluepojo: new engineers can't merge their own pull requests
[2012-11-08 00:30:48 -0500] yfeldblum: rava, i don't think that kind of thing can really be in version control, since there are so many pieces and so many ways to test
[2012-11-08 00:30:52 -0500] rava: bluepojo: we're already all file based for a workflow
[2012-11-08 00:31:06 -0500] rava: it's just a matter of putting the scaffolding together
[2012-11-08 00:31:07 -0500] yfeldblum: rava, maybe a single one designed to mimic a full infrastructure, used for CI, but not vagrantfiles for developers
[2012-11-08 00:32:23 -0500] rava: yfeldblum: i don't see how it would be a problem. it's just 3 small box definitions, a chef-server that would run the LOCAL environment attributes during install, and the same for the 2 other nodes.
[2012-11-08 00:32:43 -0500] yfeldblum: rava, sure but that doesn't scale up to a bigger infrastructure
[2012-11-08 00:32:55 -0500] yfeldblum: rava, so it can work so long as it's small
[2012-11-08 00:34:18 -0500] rava: yfeldblum: don't need them to have a full stack, and they can just assing roles as needed to mimic a specific node in the infrastructure. but you're right in the context a vast and complicated stack. when the infrastructure's not that disparate, it's not a problem.
[2012-11-08 00:35:14 -0500] rava: if they need more than 3 boxes to do something, they better be grabbing me cuz i want to know wtf they are getting at :D
[2012-11-08 00:35:22 -0500] yfeldblum: rava, so i might have a CI vagrantfile, but then just have docs in the repo on how to setup a vagrantfile for development work
[2012-11-08 00:35:47 -0500] madzim: @rava,miah: Thank you very much. I didn't setup a separate workstation yet (too long to setup the VM tonight) but I did manage to follow all of your instructions to get java to my chef-server.
[2012-11-08 00:36:22 -0500] rava: yfeldblum: i'd have those as roles and just drop a readme saying "for client side code, use these roles. for back end stack work, use these.."
[2012-11-08 00:36:49 -0500] rava: madzim: woot :)
[2012-11-08 00:36:50 -0500] yfeldblum: rava, 3 boxes? easy ... one sharded mongo cluster is 11 boxes (2x shards, each 3x replicas + 3x configs + 2x mongos's)
[2012-11-08 00:37:28 -0500] rava: yfeldblum: in the context of my stack then, 3 boxes is all they need :)
[2012-11-08 00:38:21 -0500] rava: yfeldblum: though it could be argued that all the important testing for that stack could be mimiced and tested without boxen at all in shef
[2012-11-08 00:38:51 -0500] rava: yfeldblum: at least as far as making sure the config files get written out properly and all that
[2012-11-08 00:39:08 -0500] yfeldblum: rava, what about testing that it actually works?
[2012-11-08 00:40:15 -0500] yfeldblum: rava, functional testing of individual components is nice and all that, but the integration test which actually provisions a mongo cluster and tests a few writes and reads is nice too
[2012-11-08 00:40:34 -0500] rob___: What is the preferred way of modifying an existing cookbook when using librarian?
[2012-11-08 00:40:48 -0500] rava: yfeldblum: yes, but imo that's the job of the build process, not the engi writing the components. though i do grok your point
[2012-11-08 00:40:59 -0500] rob___: and/or add onto an existing recipe
[2012-11-08 00:41:28 -0500] yfeldblum: rava, what about that being the job of the guy who's writing the mongocluster cookbook?
[2012-11-08 00:41:39 -0500] rob___: for example.. I would like to add a new template for the nginx cookbook
[2012-11-08 00:42:13 -0500] yfeldblum: rob___, if it's purely an addition, then i would write my own cookbook that just does that one additional thing
[2012-11-08 00:42:49 -0500] rob___: i see.. then include_recipe('...')
[2012-11-08 00:42:52 -0500] rob___: ?
[2012-11-08 00:43:01 -0500] yfeldblum: rob___, if it's changing an attribute of a particular resource declared in the nginx cookbook, you can write your own cookbook that has a recipe that re-opens that resource and changes that attribute
[2012-11-08 00:43:13 -0500] rava: yfeldblum: can still do each unit of work independently and build incrementally. i wouldn't want that engi to be spending hours writing a big complicated cookbook without putting each piece of work through the build process incrementally unless said engi REALLY knew what they were doing (ie. not me)
[2012-11-08 00:43:16 -0500] yfeldblum: rob___, yes you could do that
[2012-11-08 00:43:44 -0500] rob___: sounds easy enough.. thanks
[2012-11-08 00:44:18 -0500] yfeldblum: rava, that sounds like putting the cart before the horse
[2012-11-08 00:45:54 -0500] rava: yfeldblum: the process is working for me thus far, but i'm sure it will change as my team and i grok more of chef's vibe and how it likes to work
[2012-11-08 00:49:58 -0500] rava: yfeldblum: especially with me beating into everyone's head the 1 recipe for 1 unit of work rule. it's made this incremental building of complex stuff like a cookbook im in the middle of for a vendor that has no standard package distribution of their product (all tarballs and jars..ugh)
[2012-11-08 01:07:57 -0500] matti: jtimberman: Alive?
[2012-11-08 01:11:28 -0500] rava: anyone else use the jenkins cookbook?
[2012-11-08 01:15:47 -0500] rava: or the apt cookbook's repository provider?
[2012-11-08 01:18:34 -0500] matti: I was looking at apt.
[2012-11-08 01:18:56 -0500] matti: BTW, do you guys write tests for not your own / 3rd parties cookbooks too?
[2012-11-08 01:19:15 -0500] rava: matti: have you seen a problem where you would use repository provider but apt-get update doesn't get run after a new repo is installed?
[2012-11-08 01:19:21 -0500] Glace_: Anyone had success managing Windows users in Chef? including passwords
[2012-11-08 01:19:40 -0500] Glace_: I did not find any cookbook.. and I cant seem to think of a way to handle it.. specially passwords
[2012-11-08 01:19:53 -0500] rava: the jenkins cookbooks seems to do everything right until it gets to the point of installing the package, because it hasn't done an apt-get, but the provider has that command spelled out as a code block. very confused how this could be happening in this order
[2012-11-08 01:20:47 -0500] matti: rava: No, haven't used it yet.
[2012-11-08 01:40:10 -0500] slava_dp|: speaking about the "execute" resouce. can I use ruby variables in the command string?
[2012-11-08 01:40:47 -0500] bluepojo: yes, you can build the string however you like
[2012-11-08 01:41:02 -0500] bluepojo: execute "cat /a/b/c/#{filename}"
[2012-11-08 01:41:18 -0500] slava_dp|: thanks
[2012-11-08 01:59:45 -0500] bmcgee: Hey, chef noob here. I'm using hosted chef with a vagrant VM. Having issues with the database/mysql cookbook. Gist is here: https://gist.github.com/4036042
[2012-11-08 01:59:53 -0500] bmcgee: Any help would be greatly appreciated
[2012-11-08 02:29:02 -0500] bmcgee: I've been looking through the tickets and can't seem to find anything close to the problem I'm having. Been stuck on this for a few days now
[2012-11-08 02:32:01 -0500] yfeldblum: bmcgee, probably shouldn't be saving the node anyway
[2012-11-08 02:35:01 -0500] bmcgee: looking through the server.rb recipe for the mysql cookbook the only time it doesn't save node data is if it's running under chef solo
[2012-11-08 02:41:20 -0500] bmcgee: I updated the gist with the apps config and role I'm using. I don't believe I'm doing anything out of the ordinary or complex, taking inspiration from the rails-quick-start to just test if I can get mysql installed and setup: https://gist.github.com/4036042
[2012-11-08 02:49:57 -0500] bmcgee: I raised a ticket instead, http://tickets.opscode.com/browse/COOK-1867
[2012-11-08 02:57:15 -0500] jtimberman: bmcgee: are you reusing a node object from a node that was created before but not deleted? e.g. vagrant box?
[2012-11-08 02:57:51 -0500] bmcgee: Whenever i recycle the VM i make sure to delete the client from the server first
[2012-11-08 02:58:09 -0500] bmcgee: before I was doing that it would bomb out straight away
[2012-11-08 02:58:24 -0500] jtimberman: bmcgee: are you deleting the node object too?
[2012-11-08 02:58:30 -0500] bmcgee: not the node object
[2012-11-08 02:58:34 -0500] jtimberman: delete the node
[2012-11-08 02:58:48 -0500] jtimberman: the new api client created doesn't have permission on the node object.
[2012-11-08 02:59:03 -0500] jtimberman: you could also add the permission for the client to modify the node in the manage.opscode.com webui
[2012-11-08 02:59:19 -0500] jtimberman: but its easier to delete the node object.
[2012-11-08 03:02:43 -0500] bmcgee: Done, recycling the VM now
[2012-11-08 03:03:36 -0500] bmcgee: so am i right in saying it's easier to create allow the VM to create the node and the client and then edit the node configuration to set things like environment etc. ?
[2012-11-08 03:03:55 -0500] bmcgee: As opposed to pre-creating the node config
[2012-11-08 03:05:01 -0500] jtimberman: i think using the validation key to automatically create a new api client and node together is easier than pre-creating the nodes.
[2012-11-08 03:05:22 -0500] bmcgee: Good to know thx
[2012-11-08 03:05:24 -0500] jtimberman: give the node the data you need through the "bootstrap" process.
[2012-11-08 03:05:51 -0500] jtimberman: bmcgee: i'll close this ticket since its not a bug in the cookbook
[2012-11-08 03:05:58 -0500] bmcgee: np
[2012-11-08 03:07:44 -0500] jtimberman: :-D
[2012-11-08 03:14:10 -0500] rafaelmagu: what the?
[2012-11-08 03:14:19 -0500] rafaelmagu: When did berks install lose the --shims flag?
[2012-11-08 03:14:25 -0500] rafaelmagu: Or, more importantly, why?
[2012-11-08 03:14:59 -0500] bluepojo: shims were problematic for certain harddrive partition configurations
[2012-11-08 03:15:07 -0500] bluepojo: shims were hard links to the cookbooks
[2012-11-08 03:15:19 -0500] bluepojo: if you need similar functionality, you can use --path
[2012-11-08 03:15:23 -0500] bluepojo: which will copy cookbooks to a path
[2012-11-08 03:15:30 -0500] rafaelmagu: Ah right
[2012-11-08 03:15:36 -0500] bluepojo: however the #1 usecase for shims was for Vagrant
[2012-11-08 03:15:42 -0500] bluepojo: which berkshelf ships with a vagrant plugin now
[2012-11-08 03:15:59 -0500] rafaelmagu: Will I have to rm -rf * inside cookbooks every time I want to run berks path?
[2012-11-08 03:16:05 -0500] bluepojo: not sure
[2012-11-08 03:16:08 -0500] bluepojo: I don't use path much
[2012-11-08 03:16:22 -0500] rafaelmagu: I should probably investigate the use of Vagrant with berks
[2012-11-08 03:16:56 -0500] bluepojo: the vagrant plugin sets up a directory mounted into the vm automatically on vagrant up or vagrant provision
[2012-11-08 03:17:03 -0500] bluepojo: and cleans up after itself on vagrant destroy
[2012-11-08 03:17:08 -0500] rafaelmagu: Cool
[2012-11-08 03:17:19 -0500] bluepojo: it also automatically does the dependency resolution
[2012-11-08 03:17:22 -0500] joonas: :o
[2012-11-08 03:17:23 -0500] bluepojo: so all you need is your berksfile
[2012-11-08 03:17:24 -0500] joonas: sounds neat
[2012-11-08 03:17:38 -0500] bluepojo: don't even need to berks install
[2012-11-08 03:17:56 -0500] rafaelmagu: I was used to doing the changes to a cookbook then uploading directly to my chef server to then test on a vm in dev env
[2012-11-08 03:18:16 -0500] rafaelmagu: vagrant will do this faster, i think
[2012-11-08 03:18:27 -0500] bluepojo: ah yeah, probably
[2012-11-08 03:18:31 -0500] bluepojo: http://berkshelf.com/
[2012-11-08 03:18:39 -0500] bluepojo: search for Vagrant with Berkshelf
[2012-11-08 03:18:46 -0500] bluepojo: (page could use a table of contents...)
[2012-11-08 03:22:59 -0500] joonas: bluepojo: berkshelf is cool stuff
[2012-11-08 03:23:03 -0500] joonas: I wish I had discovered it earlier :P
[2012-11-08 03:23:28 -0500] bluepojo: :D
[2012-11-08 03:24:15 -0500] bluepojo: joonas: http://vialstudios.com/guide-authoring-cookbooks.html
[2012-11-08 03:24:24 -0500] bluepojo: detailed guide on developing a cookbook with berkshelf
[2012-11-08 03:24:50 -0500] joonas: bluepojo: that's handy, thanks :)
[2012-11-08 03:24:56 -0500] joonas: I was actually looking for something like that
[2012-11-08 03:25:23 -0500] joonas: bluepojo: funny story, friend of mine actually (almost?) applied to work for Riot :)
[2012-11-08 03:25:38 -0500] bluepojo: he should apply, it's a great place to work
[2012-11-08 03:25:56 -0500] joonas: bluepojo: I'm not sure if he did
[2012-11-08 03:26:00 -0500] joonas: he said he did
[2012-11-08 03:26:02 -0500] joonas: but Idk
[2012-11-08 03:26:15 -0500] bluepojo: I've been here >1.5 years it's easily the best place I've worked.
[2012-11-08 03:34:50 -0500] bmcgee: @jtimberman node save data problem is fixed :) different issue now but it's progress
[2012-11-08 03:38:46 -0500] gchristensen: gosh... anyone else have issues bootstrapping instances with the omnibus installer? with gems it works fine, but with omnibus it fails to getaddrinfo when downloading cookbooks. I've re
[2012-11-08 03:38:58 -0500] gchristensen: bootstrapped this last node 5 times.
[2012-11-08 03:41:37 -0500] rafaelmagu: Does anyone else have an issue with net-ssh 2.2.2 and 2.6.1 conflicting when trying to use capistrano-chef?
[2012-11-08 04:03:22 -0500] gildegoma: Hi! I try to upload a new cookbook via web-form on community.opscode.com but I always get the error: Cookbook folder must match cookbook name
[2012-11-08 04:03:30 -0500] yfeldblum: rafaelmagu, that'll happen unless you're using bundler or gemsets
[2012-11-08 04:03:44 -0500] gildegoma: googling about this error gave some stuff
[2012-11-08 04:03:49 -0500] gildegoma: http://tickets.opscode.com/browse/CHEF-2920
[2012-11-08 04:05:22 -0500] rafaelmagu: yfeldblum: right. I only have one project, really, so I'd have to create separate "working" folders for using different things. Easier to just gem uninstall net-ssh -v 2.6.1
[2012-11-08 04:05:23 -0500] rafaelmagu: :)
[2012-11-08 04:05:34 -0500] gildegoma: same problem for j-v-e when trying to import https://github.com/jvehent/AFW (see http://logs.likens.us/2012/%23chef.09-16.12.log)
[2012-11-08 04:05:44 -0500] yfeldblum: rafaelmagu, easier, really, to use bundler ...
[2012-11-08 04:07:06 -0500] gildegoma: Actually I think my tarball is quite correct (according to documentation http://wiki.opscode.com/display/chef/Cookbook+Site+Help)
[2012-11-08 04:07:38 -0500] gildegoma: Hence my question to experienced cookbook-maker is following:
[2012-11-08 04:08:29 -0500] gildegoma: is there really (now) a known problem CHEF-2920, that prevent web upload of cookbooks created with 'rake bundle_cookbook' ?
[2012-11-08 04:09:58 -0500] rafaelmagu: yfeldblum: off I go, then, to create a Gemfile. Thanks!
[2012-11-08 05:00:01 -0500] ssd7: I feel like I might stop going to code review just because I'm super creeped out by seeing myself on youtube
[2012-11-08 05:10:52 -0500] juliancdunn: ssd7: I must admit I do find Google Hangouts somewhat creepy
[2012-11-08 05:22:21 -0500] miah: hi
[2012-11-08 05:30:06 -0500] jtimberman: ssd7: I just ignore that the youtube thing exists :)
[2012-11-08 05:35:46 -0500] wonko_be: jtimberman: would you want to help me out with the cookbook-including-issue in test-kitchen/librarian?
[2012-11-08 05:36:24 -0500] wonko_be: in short, librarian never treats my local cookbooks as a possible source
[2012-11-08 05:37:23 -0500] wonko_be: it would be a solution to add the dependencies to the test/kitchen/cookbooks/Cheffile
[2012-11-08 05:37:35 -0500] wonko_be: but I need to list the dependencies of my dependencies there also
[2012-11-08 05:38:02 -0500] wonko_be: which is just not doable...
[2012-11-08 05:39:19 -0500] wonko_be: isn't there a way to either tell test-kitchen to ditch librarian, and just add all my cookbooks, from the path I'll provide, a bit like vagrant has it's "cookbook path" setting
[2012-11-08 05:39:45 -0500] wonko_be: (but I assume that will conflict with the needs test-kitchen as on the yum/rvm/chef-minihandler/... cookbooks)
[2012-11-08 05:45:17 -0500] yfeldblum: wonko_be, you can add local cookbooks to a Cheffile using the path source
[2012-11-08 05:45:39 -0500] wonko_be: yfeldblum: yes, I know, but then I'll need to include the dependencies of dependencies, of ...
[2012-11-08 05:46:14 -0500] wonko_be: we have a cookbook "base", depending on "postfix", which in turn depends on "iptables", which in turn depends on "kernelmodules"
[2012-11-08 05:46:23 -0500] wonko_be: all local
[2012-11-08 05:46:36 -0500] yfeldblum: wonko_be, add them all to your test-kitchen Cheffile?
[2012-11-08 05:46:53 -0500] wonko_be: yeah, that would be the short solution
[2012-11-08 05:47:06 -0500] wonko_be: but that is just one of the dependencies
[2012-11-08 05:47:22 -0500] wonko_be: in the end, this will be unmaintanable
[2012-11-08 05:47:55 -0500] yfeldblum: Dir["/path/to/cookbooks/dir"].each{|d| name = File.basename(d) ; cookbook name}
[2012-11-08 05:48:06 -0500] wonko_be: so either I just "include them all", with a simple routine to loop over all my cookbooks...
[2012-11-08 05:48:07 -0500] yfeldblum: Dir["/path/to/cookbooks/dir"].each{|d| name = File.basename(d) ; cookbook name, :path => d}
[2012-11-08 05:48:14 -0500] wonko_be: indeed
[2012-11-08 05:48:46 -0500] wonko_be: there is no way to let librarian read the metadata.rb files, and assume that each found dependency is local, with a path prefix that I supply?
[2012-11-08 05:49:24 -0500] wonko_be: ideal, I would need the "site" option to librarian to default to a local path
[2012-11-08 05:49:57 -0500] yfeldblum: wonko_be, not presently, but perhaps in a future version there may be support for multiple default sources
[2012-11-08 05:50:35 -0500] wonko_be: okay, thanks, that saves me a lot of try-n-error - I'll just include everything in my test/kitchen/cookbooks/Cheffile
[2012-11-08 05:52:21 -0500] wonko_be: is the Cheffile evaluated as ruby? Can I just toss in a variation on your ruby-snippet above?
[2012-11-08 05:53:45 -0500] jtimberman: are all those dependencies required to do isolated testing of your "base" cookbook?
[2012-11-08 05:53:56 -0500] jtimberman: The point of test-kitchen is to do isolated project integration testing.
[2012-11-08 05:54:23 -0500] jtimberman: not really for interdependent testing of multiple cookbooks and how they work with or build off each other.
[2012-11-08 05:55:12 -0500] wonko_be: jtimberman: that is something we need to solve, and our "base" cookbook is an assembly of things that need to be split out
[2012-11-08 05:55:41 -0500] wonko_be: but I thought that it might be a good idea to setup testing for this, before I started refactoring this
[2012-11-08 05:55:57 -0500] jtimberman: i'd probably start with testing the individual pieces that this composes
[2012-11-08 05:56:12 -0500] jtimberman: rather than going full tilt on the big one
[2012-11-08 05:56:59 -0500] wonko_be: jtimberman: it is the one screaming for change, and as the name suggests, it is a rather important cookbook :)
[2012-11-08 05:58:12 -0500] yfeldblum: wonko_be, Cheffile is ruby
[2012-11-08 05:58:24 -0500] jtimberman: ruby all of the things!
[2012-11-08 05:58:29 -0500] wonko_be: but then again, I have other cookboks, and the dependency on "iptables", which in turn needs the kernel modules, is rather common in our use-case
[2012-11-08 05:58:55 -0500] yfeldblum: jtimberman, i hear that recipes are going to start supporting custom ruby code in chef 11!
[2012-11-08 05:59:07 -0500] yfeldblum: jtimberman, is that true?
[2012-11-08 05:59:16 -0500] jtimberman: yfeldblum: ?
[2012-11-08 05:59:29 -0500] yfeldblum: jtimberman, will we be able to write loops and ifs in our recipes in chef 11?
[2012-11-08 05:59:47 -0500] jtimberman: ha :)
[2012-11-08 05:59:57 -0500] jtimberman: that was available in chef 0.0.1
[2012-11-08 06:00:07 -0500] yfeldblum: oooo
[2012-11-08 06:00:07 -0500] joonas: sounds frisky
[2012-11-08 06:01:20 -0500] yfeldblum: jtimberman, what does "isolated integration" mean?
[2012-11-08 06:03:51 -0500] erikh: miah and I are working on environment-wide integration testing
[2012-11-08 06:04:04 -0500] jtimberman: yfeldblum: standalone?
[2012-11-08 06:04:37 -0500] erikh: getting close now, hope to have something to talk about next week.
[2012-11-08 06:05:07 -0500] jtimberman: erikh: :-)
[2012-11-08 06:50:07 -0500] julian__: can I run a recipe twice in a role but change override attributes?
[2012-11-08 06:54:39 -0500] jtimberman: julian__: recipes are "run once", in that chef will only evaluate a recipe one time, the first time it encounters it in the expanded run list. as chef evaluates the recipe, it adds the resources to the resource collection.
[2012-11-08 06:54:48 -0500] jtimberman: at the end of all the recipes, it walks the resource collection.
[2012-11-08 06:55:34 -0500] julian__: so If I list a recipe twice to run it will only run once?
[2012-11-08 07:07:45 -0500] jtimberman: Correct.
[2012-11-08 07:13:25 -0500] BryanWB_: ohai chefs!
[2012-11-08 07:20:25 -0500] d2kagw: hai :P
[2012-11-08 07:45:10 -0500] jensofsw_: Ohai
[2012-11-08 07:57:00 -0500] con: Hai. I'm struggling to do multiple 'things', that collectively have the same condition. For example: When I folder doesn't exist I want to create, do magic in it and change it's permissions.
[2012-11-08 07:57:19 -0500] con: How would I do this without for each 'thing' specifying a 'not_if'?
[2012-11-08 07:58:07 -0500] con: Any RTFMs with a corresponding URL are very welcome too.
[2012-11-08 07:59:36 -0500] Mithrandir: resources are idempotent, so just do directory "foo" do\nowner "root"\n"group "root"\n"mode 0755\nend
[2012-11-08 08:00:00 -0500] Mithrandir: you can use subscribes and notifies to chain resources too
[2012-11-08 08:00:55 -0500] con: Ah, notifies in the directory block. I was fooling around with notifies in a ruby_block; stupid. Thanks.
[2012-11-08 09:32:33 -0500] Oct: hello
[2012-11-08 09:33:26 -0500] Oct: that kind of cron "11 7-17 * * Mon-Fri" seems to be handled in a weird way by recent version of chef (bumped from 0.10 to 10.16.2 and now chef adds an entry in the cron at each run)
[2012-11-08 09:33:34 -0500] Oct: is this something anyone is familiar with ?
[2012-11-08 09:44:41 -0500] Oct: seems like ranges are only supported with numerical day of week now
[2012-11-08 09:50:05 -0500] bugoff: 2/2
[2012-11-08 10:18:09 -0500] rohrer: anyone using the postgresql191 cookbook at https://github.com/damm/postgresql and if so which sysctl cookbook are you using?
[2012-11-08 10:18:11 -0500] nacer: hi
[2012-11-08 10:24:38 -0500] BryanWB_: nathenharvey: good morning EST!
[2012-11-08 10:40:44 -0500] zts: BryanWB_: hi!  I haven't been around much the last couple of weeks as I'm on holiday, but that exact issue has been on my list of things to look into
[2012-11-08 10:41:48 -0500] zts: BryanWB_: I could have sworn that that behaviour is a regression.  ie, that it used to be that you could reopen a resource declared earlier in your run, and that it would only be converged a single time
[2012-11-08 10:42:10 -0500] BryanWB_: zts: I don't think it is a regression
[2012-11-08 10:42:20 -0500] BryanWB_: zts: talked w/ btm about it yesterday
[2012-11-08 10:42:33 -0500] BryanWB_: and it is to be expected and there are reasons for it
[2012-11-08 10:43:08 -0500] superbaloo: doesn't it look like a hack to you ?
[2012-11-08 10:44:13 -0500] superbaloo: i mean, if i provide a cookbook to you, with some assumptions on it (like a user home dir) i don't want you to change it
[2012-11-08 10:44:30 -0500] zts: BryanWB_: interesting, that saves me retesting on earlier chef-client's then :)
[2012-11-08 10:44:33 -0500] BryanWB_: superbaloo: are you familiar w/ library cookbooks vs. application cookbooks?
[2012-11-08 10:44:49 -0500] zts: BryanWB_: still, I think the current behaviour is broken
[2012-11-08 10:45:13 -0500] BryanWB_: zts: it is counterintuitive imho
[2012-11-08 10:45:39 -0500] zts: BryanWB_: well, I think it should do one of two things:  a) merge the two definitions, converge once; or, b) blow up when the second definition is encountered
[2012-11-08 10:46:49 -0500] zts: BryanWB_: but that's a tangent.  I like your sugar there
[2012-11-08 10:46:57 -0500] superbaloo: BryanWB_: yeah, what i mean is: if the original author doesn't provide you a clean way to override it
[2012-11-08 10:47:01 -0500] superbaloo: like an attribute
[2012-11-08 10:47:19 -0500] superbaloo: he may rely on this path
[2012-11-08 10:47:26 -0500] superbaloo: in further versions
[2012-11-08 10:48:38 -0500] BryanWB_: superbaloo: u can't parameterize everything
[2012-11-08 10:48:51 -0500] superbaloo: sure
[2012-11-08 10:48:52 -0500] BryanWB_: or u can w/ some times too many layers of abstraction
[2012-11-08 10:49:13 -0500] BryanWB_: i want to use the postgrestql cookbook from opscode but my postgresql.conf is totally different
[2012-11-08 10:49:37 -0500] BryanWB_: and it is not realistic that u can template every single possible variation in that file
[2012-11-08 10:49:47 -0500] BryanWB_: so let me override it entirely
[2012-11-08 10:50:13 -0500] BryanWB_: zts: https://gist.github.com/4038108  here are my test results
[2012-11-08 10:57:19 -0500] zts: BryanWB_: the example that tripped me up was either a file or a template resource being declared twice - every run, it was rewritten twice, and the associated service being restarted.  Not fun!
[2012-11-08 10:57:20 -0500] BryanWB_: y
[2012-11-08 11:07:55 -0500] maruq: hi guys. I find my "knife ec2 server create" hangs because our ISP's network is going to shit
[2012-11-08 11:08:23 -0500] maruq: is there another way of triggering the same thing - ie. omnibus installer & then running the node
[2012-11-08 11:08:45 -0500] maruq: actually, that might work
[2012-11-08 11:08:55 -0500] maruq: anyone know what knife ec2 server actually calls?
[2012-11-08 11:29:11 -0500] maruq: never mind, it seems to run, just the break in connectivity loses the stdout stream :(
[2012-11-08 11:58:03 -0500] masterkorp: it uses fog
[2012-11-08 11:58:13 -0500] masterkorp: i think
[2012-11-08 12:29:51 -0500] maruq: masterkorp: cheers. I used gem-open to inspect. it seems it calls the omnibus script & then creates some dirs & keys
[2012-11-08 12:31:48 -0500] masterkorp: that is the bootstarp operation
[2012-11-08 12:32:30 -0500] maruq: yeah. it's all good. it seemed to work, just the stdout wasn't streaming back because of connection
[2012-11-08 12:33:09 -0500] masterkorp: good
[2012-11-08 12:33:23 -0500] masterkorp: that being said i prefer rackspace :p
[2012-11-08 12:35:09 -0500] maruq: yeah. I think I will eventually change to using the ec2-userdata method.
[2012-11-08 12:59:20 -0500] Oct: schisamo: I've submitted a small push request re what I understood is a scope issue in chef_handler code
[2012-11-08 13:08:35 -0500] masterkorp: Can i encrypt data bag with gpg instead of openssl ?
[2012-11-08 13:08:45 -0500] masterkorp: that way i need to share the key
[2012-11-08 13:14:53 -0500] yfeldblum: masterkorp, you can encrypt however you like
[2012-11-08 13:15:08 -0500] masterkorp: and upload with knife ?
[2012-11-08 13:15:14 -0500] yfeldblum: masterkorp, and upload with knife
[2012-11-08 13:15:24 -0500] masterkorp: will the server still recognize ?
[2012-11-08 13:15:33 -0500] yfeldblum: masterkorp, you may need to write your own knife plugin
[2012-11-08 13:15:50 -0500] yfeldblum: masterkorp, the server doesn't know anything at all about whether data-bag items are encrypted
[2012-11-08 13:15:59 -0500] yfeldblum: masterkorp, or what the encryption algorithm is, or what the key is
[2012-11-08 13:16:18 -0500] yfeldblum: masterkorp, to the server, an encrypted data-bag item is just a data-bag item like any other
[2012-11-08 13:16:18 -0500] masterkorp: so, its chef-client that decrypts it ?
[2012-11-08 13:16:23 -0500] yfeldblum: masterkorp, yes
[2012-11-08 13:16:43 -0500] masterkorp: how do i pass the key for chef client ?
[2012-11-08 13:16:59 -0500] masterkorp: the wiki isn't really clear on this
[2012-11-08 13:17:26 -0500] yfeldblum: masterkorp, however you like
[2012-11-08 13:17:43 -0500] yfeldblum: masterkorp, in your bootstrap template, with scp, etc
[2012-11-08 13:19:11 -0500] masterkorp: Can you point me to any doc/example on this =
[2012-11-08 13:19:13 -0500] masterkorp: ?
[2012-11-08 13:19:21 -0500] yfeldblum: masterkorp, on using scp?
[2012-11-08 13:20:22 -0500] masterkorp: You how to manage ecryption
[2012-11-08 13:20:27 -0500] yfeldblum: masterkorp, https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb#L37-46
[2012-11-08 13:36:22 -0500] Joris_: Hi Chef people
[2012-11-08 13:36:51 -0500] Joris_: I want to use my chef repo using SVN rather than GIT but Knife keeps on complaining that it needs to be a git repository (e.g. when installing a cookbook)
[2012-11-08 13:37:00 -0500] Joris_: There must a simple resolution to this I hope
[2012-11-08 13:40:34 -0500] Oct: create a .git folder at your repo root :->
[2012-11-08 13:41:38 -0500] Joris_: @ryantology: unfortunately that doesn't work
[2012-11-08 13:42:00 -0500] Joris_: it seems to me that the knife cookbook install is stick with git and without git I have to revert to the download command
[2012-11-08 13:45:43 -0500] masterkorp: Joris_: can i ask why the hell do you want to use svn over git ?
[2012-11-08 13:47:00 -0500] BryanWB_: masterkorp: sometimes the choice is made by others
[2012-11-08 13:47:49 -0500] masterkorp: i know
[2012-11-08 13:48:04 -0500] masterkorp: i would still use git-svn in that case :p
[2012-11-08 13:51:17 -0500] Joris_: @masterkorp: we're standardised on SVN, that's why
[2012-11-08 13:51:34 -0500] masterkorp: wow, that is... sad...
[2012-11-08 13:51:45 -0500] masterkorp: use git-svn
[2012-11-08 13:52:02 -0500] Joris_: :-)
[2012-11-08 13:52:11 -0500] Joris_: I'll have a look at that
[2012-11-08 13:52:33 -0500] Joris_: But svn works fine for us, so there is no hurry in moving to git
[2012-11-08 13:53:00 -0500] Joris_: I know, chef is a git place and I am cursing in the church but that's simply the way it is :-)
[2012-11-08 14:06:25 -0500] masterkorp: Joris_: good luck
[2012-11-08 14:06:41 -0500] masterkorp: i use git-svn everytime i need to work with svn repo
[2012-11-08 14:07:12 -0500] masterkorp: works like a normal git repo locally, and its compatible with svn server
[2012-11-08 14:07:50 -0500] BryanWB_: Joris_:  for better or worse all the devops tools are based around git, it is really hard to escape git
[2012-11-08 14:08:05 -0500] masterkorp: yeah
[2012-11-08 14:08:37 -0500] shay: hi, whtat is the best way to have a cookbook file per environment?
[2012-11-08 14:10:20 -0500] masterkorp: knife cookbook upload icinga
[2012-11-08 14:10:22 -0500] masterkorp: oops
[2012-11-08 14:16:22 -0500] shay: hi, whtat is the best way to have a cookbook file per environment?
[2012-11-08 14:22:25 -0500] maruq: Hey guys. Any idea why a run would work correctly for me, but the same run_list breaks for coworker using the same key
[2012-11-08 14:22:49 -0500] maruq: breaks on trying to do a deploy_revision. he gets a permission denied trying to clone from github
[2012-11-08 14:23:02 -0500] maruq: all keys, everything are the same.
[2012-11-08 14:30:44 -0500] maruq: okay. seems to be an issue with launching from knife 10.16.2. I just updated my gem from 10.12.0 & now get the issue too
[2012-11-08 14:36:26 -0500] wes_: Does anyone know if the Powershell resource (in the Chef wiki) is supposed to be included in the Chef 14.4 release?
[2012-11-08 14:54:26 -0500] shay: is there a way to geht all available cookbook files in the cookbook?
[2012-11-08 15:03:12 -0500] poolpog: Hello, folks
[2012-11-08 15:04:38 -0500] poolpog: I have a chef repo... in it is the apache2 community cookbook... we have a role that uses that, and in there is an override_attributes section...
[2012-11-08 15:04:47 -0500] poolpog: my question is this:
[2012-11-08 15:05:23 -0500] poolpog: in the attributes_override, the array uses strings for the keys. In the cookbook, the attributes arrays use symbols for keys
[2012-11-08 15:05:57 -0500] poolpog: can I switch the strings to symbols and it will still work? I'm trying to figure out why the guy who wrote this did it this way
[2012-11-08 15:06:27 -0500] poolpog: (probably more of a ruby question than a chef question, but there you go)
[2012-11-08 15:07:15 -0500] matti: poolpog: Try it.
[2012-11-08 15:07:31 -0500] poolpog: i'd rather not -- it is a production chef repo
[2012-11-08 15:07:34 -0500] matti: No, no.
[2012-11-08 15:07:54 -0500] poolpog: test it in irb or sumthin?
[2012-11-08 15:07:56 -0500] matti: For a cookbook all you need is probably metadata.rb and your cookbook/recipe/default.rb
[2012-11-08 15:07:57 -0500] poolpog: that what u mean?
[2012-11-08 15:08:05 -0500] matti: Mock up attributes/default.rb
[2012-11-08 15:08:13 -0500] matti: And sun it as solo to say "Hello I am poolpog"
[2012-11-08 15:08:21 -0500] poolpog: *run
[2012-11-08 15:08:36 -0500] matti: I can tell you, that unless there is some magic around attributes access.
[2012-11-08 15:08:45 -0500] matti: In Ruby :foo vs 'foo' is not the same.
[2012-11-08 15:08:49 -0500] poolpog: ok
[2012-11-08 15:09:10 -0500] poolpog: so if those aren't the same, then how is the attribute override working at all?
[2012-11-08 15:09:21 -0500] matti: Its a function, right.
[2012-11-08 15:09:23 -0500] nacer: poolpog: it's the same
[2012-11-08 15:09:24 -0500] shay: hi, what is the best way to have a cookbook file per environment?
[2012-11-08 15:09:53 -0500] matti: And they are probably doing merge or deep merge, and then to_sym or to_s somewhere there on keys.
[2012-11-08 15:10:06 -0500] poolpog: nacer, it is the same, in ruby? or it is the same because the chef function makes it the same? or both?
[2012-11-08 15:10:13 -0500] matti: poolpog: Chef, I guess.
[2012-11-08 15:10:18 -0500] nacer: poolpog: Chef
[2012-11-08 15:10:21 -0500] poolpog: ok
[2012-11-08 15:10:28 -0500] poolpog: thanks, this is mucho helpful
[2012-11-08 15:10:58 -0500] poolpog: so, why would one use a string for the key in this example? is that typical?
[2012-11-08 15:11:02 -0500] nacer: poolpog: I thin chef do Symbol.to_s
[2012-11-08 15:11:14 -0500] poolpog: ok
[2012-11-08 15:11:21 -0500] matti: nacer: I said that too ;p
[2012-11-08 15:11:30 -0500] nacer: matti: oups didn't see :)
[2012-11-08 15:11:36 -0500] matti: :<
[2012-11-08 15:11:56 -0500] nacer: matti: it must be true :)
[2012-11-08 15:12:00 -0500] poolpog: but, just so I understand -- why? why wouldn't the override_attributes just use symbols, too
[2012-11-08 15:12:00 -0500] matti: Haha
[2012-11-08 15:12:14 -0500] poolpog: the examples here use strings: http://wiki.opscode.com/display/chef/Setting+Attributes+%28Examples%29
[2012-11-08 15:12:30 -0500] matti: poolpog: I've noticed that recommened for Chef is strings here and there.
[2012-11-08 15:12:33 -0500] nacer: poolpog: if you put your override in json json don't do s ymbol
[2012-11-08 15:12:34 -0500] matti: poolpog: People use symbols.
[2012-11-08 15:12:51 -0500] matti: poolpog: But for consistency sake with JSON, strings are prefered.
[2012-11-08 15:12:52 -0500] nacer: poolpog: what recipe and line use symbol ?
[2012-11-08 15:13:01 -0500] poolpog: apache2
[2012-11-08 15:13:08 -0500] nacer: poolpog: default.rb ?
[2012-11-08 15:13:14 -0500] poolpog: one sec, I'll find it specifially
[2012-11-08 15:13:25 -0500] poolpog: yes, default.rb
[2012-11-08 15:13:31 -0500] poolpog: full of symbols
[2012-11-08 15:13:49 -0500] matti: Haha
[2012-11-08 15:13:54 -0500] nacer: poolpog: ohhhh
[2012-11-08 15:14:04 -0500] poolpog: hey!
[2012-11-08 15:14:13 -0500] poolpog: the newest version appears to use strings
[2012-11-08 15:14:16 -0500] poolpog: https://github.com/opscode-cookbooks/apache2/blob/master/attributes/default.rb
[2012-11-08 15:14:27 -0500] _rc: attributes use the mash datatype, so you can access them with symbol keys, string keys, or just as methods.
[2012-11-08 15:14:53 -0500] poolpog: an older version uses symbols: https://github.com/opscode-cookbooks/apache2/blob/1.1.4/attributes/default.rb
[2012-11-08 15:14:57 -0500] nacer: poolpog: yeah the new rules is 'String'
[2012-11-08 15:15:06 -0500] _rc: your house style needs to pick one, the foodcritic one mandates strings
[2012-11-08 15:15:08 -0500] poolpog: but, just seeing that helps answer this question
[2012-11-08 15:15:15 -0500] nacer: poolpog: old school cookbook use symbol
[2012-11-08 15:15:35 -0500] _rc: http://acrmp.github.com/foodcritic/#FC001
[2012-11-08 15:15:39 -0500] poolpog: my house style was set 2 years ago by our resident ruby expert who left 6 months ago
[2012-11-08 15:15:40 -0500] poolpog: so
[2012-11-08 15:16:01 -0500] poolpog: I'm sure most folks here are familiar with that type of situation
[2012-11-08 15:16:15 -0500] matti: poolpog: Go with strings.
[2012-11-08 15:17:44 -0500] slam-: hey, yesterday at the DreamHost+Opscode webinar, Carl Perry and Matt Ray talked about switches running linux and chef-client, someone knows the brand name ?
[2012-11-08 15:19:04 -0500] poolpog: ok, strings it is bitches
[2012-11-08 15:19:08 -0500] poolpog: sorry, got carried away
[2012-11-08 15:19:29 -0500] poolpog: so, next question... I have one simple override I'd like to apply on a per-role basis
[2012-11-08 15:19:42 -0500] poolpog: it is basically "disable the /icons/ alias in apache"
[2012-11-08 15:20:30 -0500] poolpog: the way I see doing it is this: 1) create new mod_alias template file; 2) create new recipe that uses that template; 3) use that recipe in our web app role
[2012-11-08 15:20:55 -0500] poolpog: but this doesn't feel quite right... so, questions
[2012-11-08 15:21:08 -0500] poolpog: 1) is there a per-role override possible?
[2012-11-08 15:21:32 -0500] poolpog: 2) Should I just leave the apache cookbook alone and use an override?
[2012-11-08 15:22:08 -0500] poolpog: 3) where should the override template file live? in the community apache cookbook? In our own cookbook?
[2012-11-08 15:22:38 -0500] poolpog: feel free to berate me for bad questions, I'll fix 'em
[2012-11-08 15:22:46 -0500] nacer: poolpog: check the documentation, you have a tables how explain the override food chain
[2012-11-08 15:22:54 -0500] poolpog: yeah, I read that
[2012-11-08 15:22:59 -0500] poolpog: but "role" isn't mentioned
[2012-11-08 15:23:12 -0500] nacer: poolpog: role can override and set attribute
[2012-11-08 15:23:38 -0500] poolpog: so, is the thing I want to override an *attribute* or a *template file*?
[2012-11-08 15:23:38 -0500] nacer: poolpog: most of the times a never override and puts my attribute in default_attribute
[2012-11-08 15:23:43 -0500] poolpog: or, both
[2012-11-08 15:23:48 -0500] nacer: poolpog: a ttribute
[2012-11-08 15:24:17 -0500] poolpog: so, in the apache cookbook, there is an attribute for "icondir"
[2012-11-08 15:24:28 -0500] poolpog: but I want to disable the alias, not the attribute
[2012-11-08 15:24:58 -0500] poolpog: i.e. the alias itself is set in the mod_alias template file (which is an Apache2, debian-style mod enable file)
[2012-11-08 15:25:20 -0500] poolpog: do I override the attribute that points to the template file?
[2012-11-08 15:28:53 -0500] poolpog: ah, ok, another question in response to your "i don't override" -- if you change the attributes in default, how do you upgrade the cookbook?
[2012-11-08 15:29:08 -0500] jtimberman: slam-: arista, i believe. it was mentioned at chefconf: http://wiki.opscode.com/display/chef/Chef+on+Arista
[2012-11-08 15:29:28 -0500] poolpog: also, do you mean, by "default_attribute" -- "cookbook/apache/attributes/default.rb"
[2012-11-08 15:30:10 -0500] slam-: jtimberman: i asked if it was Arista, it wasn't, but i did not get the name. Something like "Cumulus Networks"
[2012-11-08 15:30:29 -0500] jtimberman: poolpog: there's no difference at all to chef wheter you use strings or symbols for node attributes.
[2012-11-08 15:30:32 -0500] slam-: the sound was awful =(
[2012-11-08 15:30:32 -0500] jtimberman: slam-: i don't know
[2012-11-08 15:30:41 -0500] jtimberman: poolpog: symbols are converted to strings under the hood
[2012-11-08 15:30:55 -0500] poolpog: k
[2012-11-08 15:31:09 -0500] jtimberman: poolpog: strings are the least surprising thing to people not already familiar with ruby, and have benefits like ease of interpolation
[2012-11-08 15:31:33 -0500] poolpog: "least surprising" -- I like that turn of phrase
[2012-11-08 15:31:55 -0500] jtimberman: e.g., node["app_#{node.chef_environment]"]
[2012-11-08 15:32:08 -0500] jtimberman: vs using a symbol, where you'd have to put it in quotes anyway :)
[2012-11-08 15:34:59 -0500] poolpog: ok, so, let me ask a very specific question: which attribute do I need to override to change the template file, for mod_alias, in the apache cookbook?
[2012-11-08 15:35:16 -0500] poolpog: default["apache"]["..."]
[2012-11-08 15:35:20 -0500] poolpog: what is "..."?
[2012-11-08 15:37:16 -0500] shay: hi, what is the best way to have a cookbook file per environment?
[2012-11-08 15:38:41 -0500] gchristensen: shay: can you say more about what your end goal is?
[2012-11-08 15:39:15 -0500] shay: sure, i want to use different template files in different environments
[2012-11-08 15:39:55 -0500] shay: and if there is no specific template file i want to use the default
[2012-11-08 15:42:15 -0500] shay: for example in environment a i want to use iptables.erb.a and in environment b i want to use iptables.erb.b
[2012-11-08 15:42:37 -0500] shay: and if there is no specific template for this environment i want to use iptables.erb
[2012-11-08 15:44:39 -0500] gchristensen: shay: now I'm not the highest expert with Chef so I may be wrong, but I think generally any changes that made would normally done via options that you can pass into the template
[2012-11-08 15:45:29 -0500] killfill: hi
[2012-11-08 15:45:53 -0500] gchristensen: shay: and any IPs that might be changes would be done with search, or again - options passed from the environment
[2012-11-08 15:45:56 -0500] killfill: https://github.com/opscode-cookbooks/application/blob/master/metadata.rb#L18  <-- that line makes it depends on a lot of cookbooks.
[2012-11-08 15:46:02 -0500] shay: well this would not work for me, because i want to use some other static values in different environments
[2012-11-08 15:46:15 -0500] gchristensen: it sure does, killfill
[2012-11-08 15:46:16 -0500] killfill: is that ok?.. that will be removed soon or not?
[2012-11-08 15:46:58 -0500] killfill: the readme sais "This mode of operation has been DEPRECATED".. dont know if it referes to that dependencies or the attributes thing?
[2012-11-08 15:47:38 -0500] gchristensen: killfill: what is the issue with depending on those cookbooks? unless you use them, it won't install all that software
[2012-11-08 15:47:43 -0500] killfill: gchristensen, i.e for php there is application_php.. sholdnt application_php depends on php and not application?
[2012-11-08 15:48:07 -0500] killfill: gchristensen: when i do knife cookbook install'it, it doenloads them all.. :S
[2012-11-08 15:48:33 -0500] gchristensen: killfill: it downloads them, puts them into your cookbooks, but likely don't actually use many of them.
[2012-11-08 15:48:38 -0500] kryptek: good morning all
[2012-11-08 15:49:17 -0500] killfill: gchristensen: yup.. if they are not getting used.. why have them?.. :P
[2012-11-08 15:49:38 -0500] gchristensen: I'm not the author, so I can't say :)
[2012-11-08 15:49:59 -0500] killfill: maybe its for backwards comatibility :P
[2012-11-08 15:50:28 -0500] BryanWB_: can any opscoders comment on this monkey-patch I make to Chef::Resource ? https://github.com/bryanwb/chef-edit/blob/master/lib/chef/edit.rb#L35
[2012-11-08 15:51:07 -0500] BryanWB_: hard for me to tell whether I am doing great violence to Chef or if this natural Ruby workflow
[2012-11-08 15:53:21 -0500] poolpog: ugh, sorry to rehash... What attribute do I override in the apache cookbook to change the template file for an apache module?
[2012-11-08 15:53:32 -0500] ssd7: Ohai Chefs!
[2012-11-08 15:53:38 -0500] BryanWB_: ohai!
[2012-11-08 15:53:55 -0500] poolpog: at this point, only a specific answer as an example will make sense to me
[2012-11-08 15:56:33 -0500] killfill: jtimberman: hi, are you online?
[2012-11-08 15:56:37 -0500] ssd7: BryanWB_: What is your primary use case for that?
[2012-11-08 15:57:11 -0500] BryanWB_: ssd7: say I use the postgresql  community cookbook
[2012-11-08 15:57:33 -0500] BryanWB_: rather than fork the postgresql community cookbook, i create a new cookbook my-postgresql that wraps around it
[2012-11-08 15:57:55 -0500] BryanWB_: and overrides the main configuration template file for postgres
[2012-11-08 15:58:35 -0500] BryanWB_: because there is no way that the main postgresql cookbook will have everything parameterized
[2012-11-08 15:59:13 -0500] BryanWB_: ssd7: and parameterizing everything could actually make the main template too complicated and difficult to maintain
[2012-11-08 15:59:19 -0500] poolpog: ok, better, more specific question: The "Template location specificity" description only shows rules for choosing a template file based on host and platform
[2012-11-08 15:59:29 -0500] BryanWB_: so I want to selectively override certain resources
[2012-11-08 15:59:39 -0500] poolpog: Is there a way to specify based on role? or on any arbitrary value?
[2012-11-08 16:00:50 -0500] ssd7: BryanWB_: Hrm. Intesesting.  My gut says this will be hard to maintain and think about in the long run.
[2012-11-08 16:01:17 -0500] BryanWB_: ssd7: i disagree based on my experience w/ chef thus far
[2012-11-08 16:01:24 -0500] ssd7: poolpog: OK, let's back up.  You are using the community apache2 cookbook and want to set some custom configuration.
[2012-11-08 16:01:35 -0500] willejs: is there a way to alter a nodes environment membership through knife?
[2012-11-08 16:01:43 -0500] poolpog: ssd7, yes
[2012-11-08 16:02:13 -0500] poolpog: specifically, I want to disable the alias set for /icons/. And I want to do it in the most "correct" way
[2012-11-08 16:02:15 -0500] ssd7: BryanWB_: It's entirely possible I'm wrong.  Still thinking abou tit to be honest.
[2012-11-08 16:02:16 -0500] BryanWB_: ssd7: we need library cookbooks w/ sane defaults and application cookbooks that wrap a library cookbook w/ values specific to my organization
[2012-11-08 16:02:37 -0500] BryanWB_: ssd7: i tried to parameterize and lwrp all the things and u end up painting yourself into a corner
[2012-11-08 16:03:01 -0500] BryanWB_: and w/ lwrps that are inflexible and unmaintainable
[2012-11-08 16:03:13 -0500] ssd7: poolpog: You should be able to set "conf true" as an attribute and then put a template in templtes/default/mods/MODULE_NAME.conf.erb
[2012-11-08 16:03:24 -0500] ssd7: s/attribute/resource attribute/
[2012-11-08 16:03:45 -0500] Litex: willejs: You could do it with a 'knife exec', but it's much easier to use a plugin like: https://github.com/jonlives/knife-flip
[2012-11-08 16:03:47 -0500] BryanWB_: lwrps are good but they can't encompass every possible variation
[2012-11-08 16:03:52 -0500] BryanWB_: and shouldn't
[2012-11-08 16:04:15 -0500] willejs: cheers mate
[2012-11-08 16:04:29 -0500] poolpog: ssd7, why would I put a custom template erb file in the default/... dir structure? This is more of a philosohpical question than a specific use-case question
[2012-11-08 16:05:09 -0500] poolpog: everything else I'm seeing implies a custom directory structure for local overrides and customizations
[2012-11-08 16:05:22 -0500] ssd7: poolpog: I typically only use the folders other than default if I have an expectation that I am going to need more than 1 version of that file and that the differences would be too hard to maintain in code.
[2012-11-08 16:05:49 -0500] willejs: litex: much appriciated
[2012-11-08 16:05:55 -0500] Litex: willejs: No problem.
[2012-11-08 16:06:04 -0500] ssd7: poolpog: The directory structure just gives you a way of providing different version of the same template to different hosts.  If you need to do that it can be useful.  I usually find that I don't need to do that.
[2012-11-08 16:06:30 -0500] poolpog: see, I could save myself hassle and just edit cookbooks/apache2/templates/default/mods/alias.conf.erb direfctly -- but that doesn't strike me as "most correct"
[2012-11-08 16:07:35 -0500] poolpog: I don't need to do that with different hosts, either. Am I barking up the wrong tree even worrying about this "default" stuff? i.e. I'm concerned about long-term maintainabilty and updates if I change defaults
[2012-11-08 16:08:04 -0500] ssd7: poolpog: Ah, I see what your question is.  This is actually similar to what BryanWB_ and I are discussing
[2012-11-08 16:08:47 -0500] poolpog: i.e. keeping the stuff I've installed from the community untouched, and only changing it with local overrrides
[2012-11-08 16:09:26 -0500] ssd7: poolpog: Right.  It isn't clear that there is a "correct" way to do that.
[2012-11-08 16:09:33 -0500] poolpog: ok
[2012-11-08 16:09:47 -0500] ssd7: Lots of people have work flows they've developed, but I think it is something to community is still figuring out.
[2012-11-08 16:09:48 -0500] BryanWB_: poolpog i would wrap the main apache2  cookbook  w/   poolpog-apache2   that selectively overrides resources declared in the apache2 cookbook
[2012-11-08 16:10:01 -0500] BryanWB_: but my thinking and code here is also in the alpha stage
[2012-11-08 16:10:11 -0500] poolpog: then is this a case of hitting a point of immaturity in chef's development? (and I don't mean "immature" in a deragatory way)
[2012-11-08 16:10:15 -0500] BryanWB_: but this is what the gurus at RiotGames do
[2012-11-08 16:10:32 -0500] BryanWB_: well, i think it is fair to say that Chef is still immature
[2012-11-08 16:10:46 -0500] BryanWB_: it has come a long way and is developing quickly
[2012-11-08 16:11:26 -0500] poolpog: ok, so, if I make a change to cookbooks/apache2/templates/default/mods/alias.conf.erb  -- which is waht I'm going to do based on my questions here -- how will that affect future upgrades to that community cookbook?
[2012-11-08 16:11:39 -0500] BryanWB_: poolpog: it will make them harder
[2012-11-08 16:11:51 -0500] BryanWB_: and u will need enough git-fu to use `git rebase`
[2012-11-08 16:11:57 -0500] poolpog: also, we are building a new datacenter with new chef and new community cookbooks -- how can I track my local changes?
[2012-11-08 16:12:12 -0500] cheeseplus: chef doesn't make a lot of decisions for you, so for what you gain in flexibility you forgo a set of rigid best practices
[2012-11-08 16:12:15 -0500] poolpog: BryanWB_, alrighty, thanks
[2012-11-08 16:12:39 -0500] poolpog: I don't want "rigid" -- but I do want to hear what y'alls do in cases like this
[2012-11-08 16:12:45 -0500] BryanWB_: poolpog: jamie winsor explains this philosophy far better than i do and it is recorded in the foodfightshow
[2012-11-08 16:12:56 -0500] cheeseplus: poolpog: well that is my point, it's kind of all over the place depending who you get in channel
[2012-11-08 16:12:58 -0500] poolpog: "foodfightshow"?
[2012-11-08 16:13:12 -0500] poolpog: ok, cheeseplus , that makes sense
[2012-11-08 16:13:23 -0500] BryanWB_: http://foodfightshow.org/2012/08/jamie-winsor-and-michael-ivey-skool-us-on-berkshelf.html
[2012-11-08 16:14:09 -0500] BryanWB_: hey cheeseplus !
[2012-11-08 16:14:18 -0500] cheeseplus: hola BryanWB_!
[2012-11-08 16:14:46 -0500] Litex: BryanWB_: Have you abandoned roles in favor of wrapper cookbooks?
[2012-11-08 16:14:52 -0500] cheeseplus: poolpog: and yes, check out foodfightshow
[2012-11-08 16:15:00 -0500] poolpog: yes
[2012-11-08 16:15:00 -0500] poolpog: gonna
[2012-11-08 16:15:04 -0500] BryanWB_: Litex: steadily doing so
[2012-11-08 16:15:19 -0500] BryanWB_: and the ShipShow, another excellent podcast ;)
[2012-11-08 16:15:20 -0500] cheeseplus: I'm actually going to try doing the same roles -> wrapper cookbooks for my colo
[2012-11-08 16:15:23 -0500] cheeseplus: hehe
[2012-11-08 16:15:34 -0500] Litex: BryanWB_: Cool.
[2012-11-08 16:15:36 -0500] BryanWB_: srsly, it's a gr8 show, i learn a lot from it
[2012-11-08 16:15:52 -0500] BryanWB_: hey Litex ! just remembered ur handle ;)
[2012-11-08 16:15:59 -0500] Litex: BryanWB_: Howdy!  (=
[2012-11-08 16:17:15 -0500] cheeseplus: poolpog: I stressed a lot about the "right"/"best" way when I started using chef and probably the biggest lesson was "get shit done first, then iterate towards best"
[2012-11-08 16:17:47 -0500] Litex: cheeseplus: That's very well stated.
[2012-11-08 16:18:23 -0500] cheeseplus: Litex: thanks! I think that should be the on the intro docs - "there is no spoon"
[2012-11-08 16:19:24 -0500] poolpog: cheeseplus, I'm trying. However, in my experience "get shit done now" leads to "this shit is totally broken" later
[2012-11-08 16:19:51 -0500] cheeseplus: well the upside is that at least you are configuring infra as code
[2012-11-08 16:20:37 -0500] cheeseplus: and shit will always totally break in new and yet unseen ways :D
[2012-11-08 16:20:40 -0500] ssd7: Hrmm.  I haven't listened to that berkshelf episode yet.  Someone will have to convince me on this role -> wrapper cookbook thing.  It still seems odd to me.
[2012-11-08 16:21:00 -0500] BryanWB_: ssd7: give it a listen, it was hard for me to fathom at first as well
[2012-11-08 16:21:16 -0500] cheeseplus: ssd7: there was some chatter in here yesterday about just that, for me my roles were huge and nasty
[2012-11-08 16:21:36 -0500] siezer: ssd7 it makes a lot of sense when you're using vagrant for rapid test iteration
[2012-11-08 16:21:45 -0500] poolpog: which podcast is the roles-vs-wrappers one?
[2012-11-08 16:21:54 -0500] siezer: cd wrappercookbook ; b vagrant up
[2012-11-08 16:21:58 -0500] poolpog: nm
[2012-11-08 16:22:00 -0500] poolpog: I figured it out
[2012-11-08 16:22:08 -0500] cheeseplus: it became much easier and clearer to override stuff in a wrapper cookbook, I can still use roles but I rather keep em simple
[2012-11-08 16:22:41 -0500] ssd7: cheeseplus: BryanWB_ People using the "wrapper cookbook" method should definitely look at Dan's most recent post regarding attribute changes in Chef 11
[2012-11-08 16:22:55 -0500] ssd7: I think it could potentially affect you guys substantially.
[2012-11-08 16:22:59 -0500] Litex: It sounds very weird at first, but ultimately...  A role just sets a run list and sets attributes.  You can do that in a simple cookbook, with the added benefit of having them versioned.
[2012-11-08 16:23:55 -0500] siezer: ssd7 how would the new attribute stuff affect the "application cookbook" workflow?
[2012-11-08 16:24:45 -0500] BryanWB_: ssd7: i looked at and I don't see how it would affect the "application cookbook" workflow. Am i missing something?
[2012-11-08 16:24:58 -0500] BryanWB_: i thought it just made setting attributes more explicit
[2012-11-08 16:25:13 -0500] jtimberman: siezer: use node.set
[2012-11-08 16:25:17 -0500] jtimberman: i believe
[2012-11-08 16:25:21 -0500] jtimberman: maybe node.override
[2012-11-08 16:25:32 -0500] siezer: node.default
[2012-11-08 16:25:39 -0500] ssd7: BryanWB_: Well, since I don't use the workflow everday I might be mistaken.  However, it also means that node.default in a recipe no longer overrides defaults from a role.
[2012-11-08 16:25:49 -0500] ssd7: I guess if you don't use roles it wouldn't matter
[2012-11-08 16:25:53 -0500] BryanWB_: yup
[2012-11-08 16:26:41 -0500] BryanWB_: i know i asked earlier but if anyone else would like to look at this monkey-patch to Chef, i would love the extra eyes https://github.com/bryanwb/chef-edit/blob/master/lib/chef/edit.rb#L21
[2012-11-08 16:26:54 -0500] BryanWB_: and it has everything to do w/ the application cookbook scenario
[2012-11-08 16:28:10 -0500] jblaine: Perhaps I'm stupid: Is there no way to pass a recipe (literal, not file ref) to chef-solo?
[2012-11-08 16:28:43 -0500] jblaine: as in chef-solo -c solo.rb -something 'package "foo"'
[2012-11-08 16:29:10 -0500] ssd7: jblaine: Not stupid, feature doesn't exist.
[2012-11-08 16:29:20 -0500] jblaine: okay, thanks
[2012-11-08 16:29:23 -0500] jtimberman: BryanWB_: i wonder if any ocd ruby folks are twitching because you didn't name the file after the class (lib/chef/recipe.rb)
[2012-11-08 16:29:25 -0500] BryanWB_: jblaine: oooh, or     nc -l u 80 | chef-solo -c solo.rb  -
[2012-11-08 16:29:41 -0500] BryanWB_: jtimberman: gud point, i m such a n00b
[2012-11-08 16:29:55 -0500] jtimberman: i don't have any other opinions on the code
[2012-11-08 16:29:56 -0500] jtimberman: :)
[2012-11-08 16:30:16 -0500] BryanWB_: jtimberman: am totally paranoid that it is crap that will blow up in my face
[2012-11-08 16:30:24 -0500] ssd7: jblaine: Similar new feature preposed here: http://tickets.opscode.com/browse/CHEF-3571
[2012-11-08 16:30:24 -0500] jtimberman: jblaine: dan (kallistec) wrote a proof of concept gist that gives a "chef-apply" that you can run against a single recipe file.
[2012-11-08 16:30:28 -0500] BryanWB_: and i need this functionality desperatley
[2012-11-08 16:30:40 -0500] poolpog: thanks, folks, you are very helpful
[2012-11-08 16:31:17 -0500] kallistec: here you go: https://gist.github.com/2920702
[2012-11-08 16:31:24 -0500] jblaine: BTW, the overall atmosphere yesterday vs. Monday code review broadcast was night and day
[2012-11-08 16:31:35 -0500] jtimberman: kallistec: woot, i couldn't find it and made my own from the file i have on disk :)
[2012-11-08 16:31:55 -0500] jblaine: I thought you all were ready to commit suicide Monday
[2012-11-08 16:31:55 -0500] kallistec: jtimberman: y u no star my gist?
[2012-11-08 16:32:03 -0500] jtimberman: kallistec: how does the internet work?
[2012-11-08 16:32:29 -0500] jtimberman: I did star it, apparently.
[2012-11-08 16:32:33 -0500] jblaine: jtimbermania: Thanks re: chef-apply
[2012-11-08 16:32:45 -0500] killfill: jtimberman: can i as you something about https://github.com/opscode-cookbooks/application/blob/master/metadata.rb#L18 ?
[2012-11-08 16:32:57 -0500] ssd7: jblaine: I think we are all still getting used to the fact that it is being recorded.  I'm pretty used to just staring at the code with a blank expression and occasionally offering a hopefully helpful comment.
[2012-11-08 16:33:03 -0500] killfill: jtimberman: isnt suposted to i.e. application_php to depends on php, and not application itself?
[2012-11-08 16:33:32 -0500] jtimberman: killfill: those are dependencies from the recipes in that cookbook
[2012-11-08 16:33:59 -0500] killfill: jtimberman: like for application::php ?.. thouse will be obsolete, right?
[2012-11-08 16:35:11 -0500] jblaine: ssd7: nod - was really just the tone in voices Monday. Whatever, it's not like it's supposed to be entertainment :)
[2012-11-08 16:35:43 -0500] jblaine: but now that I've said something, you'll all be self-conscious and I've ruined everything
[2012-11-08 16:35:57 -0500] ssd7: :)
[2012-11-08 16:38:29 -0500] jblaine: jtimberman: Before I spend a bunch of ruby noob time on it, do you think there's a Valid(tm) reason for the insane Ruby open()s ? Or is it at least a possibility that I could find something for build-time tweaking that would reduce that number greatly and not cause any trouble?
[2012-11-08 16:38:38 -0500] jblaine: jtimberman: It's under my skin now.
[2012-11-08 16:38:49 -0500] siezer: what the hell. my vim fingers came back.
[2012-11-08 16:39:20 -0500] killfill: jtimberman: is it there becouse of backwards compatibility?..
[2012-11-08 16:39:35 -0500] masterkorp: siezer: hehe
[2012-11-08 16:39:43 -0500] jtimberman: https://github.com/opscode-cookbooks/application/pull/22/files - via http://tickets.opscode.com/browse/COOK-1820
[2012-11-08 16:40:02 -0500] jtimberman: killfill: i'm unclear about whether all those cookbooks are still required after that change.
[2012-11-08 16:40:17 -0500] shay: Hi, why does chef not search in environment subdirectories for templates? Like it does for platforms e.g. /template/suse/template.erb. I want to use that for my environments, so it should search in /template/production/template.rb
[2012-11-08 16:40:21 -0500] jtimberman: jblaine: i don't know for sure, kallistec would be better to ask
[2012-11-08 16:40:54 -0500] jtimberman: shay: because when that file specificity was written into chef's template and cookbook_file resources, chef "environments" didn't exist as a thing.
[2012-11-08 16:40:59 -0500] jtimberman: bbiab
[2012-11-08 16:41:46 -0500] kallistec: jblaine: explain "insane Ruby open()s"
[2012-11-08 16:41:49 -0500] shay: damn, i really need that :/
[2012-11-08 16:42:27 -0500] kallistec: shay: you can hack it out on your own by setting the template source, I think
[2012-11-08 16:42:32 -0500] kyleb: shay: have you tried setting the source to something like "#{node.chef_environment}/templated.rb.erb"?
[2012-11-08 16:42:34 -0500] killfill: jtimberman: i thought so too..:) maybe andres just forgot to remove the deps?
[2012-11-08 16:42:45 -0500] jtimberman: kallistec: isn't the initial run time of chef-solo --help, e.g., because ruby loads (allthethings)?
[2012-11-08 16:42:50 -0500] jtimberman: bbiab for reals.
[2012-11-08 16:43:24 -0500] BryanWB_: kallistec: could there be any unintended side effects to this https://github.com/bryanwb/chef-edit/blob/master/lib/chef/edit.rb#L21 ?
[2012-11-08 16:44:15 -0500] BryanWB_: specifically using the set_and_return for   the @cookbook_name instance variable
[2012-11-08 16:44:18 -0500] shay: kyleb: the problem is, that this will not work for _default environment i think
[2012-11-08 16:45:31 -0500] shay: or if there is no file for this environment, in this case i want to use the default one
[2012-11-08 16:46:04 -0500] kallistec: BryanWB_: would have to look at what we do now
[2012-11-08 16:46:37 -0500] BryanWB_: kallistec: curretnly    `attr_accessor :cookbook_name`  afaict
[2012-11-08 16:47:06 -0500] kyleb: shay: the first one shouldn't be an issue, though the second one of falling back to default definitely would
[2012-11-08 16:47:38 -0500] kallistec: BryanWB_: so one weird thing is that the attr setter isn't validated, while the set_or_return version is
[2012-11-08 16:47:57 -0500] BryanWB_: true, u could pass anything
[2012-11-08 16:48:12 -0500] shay: kyleb: i tried to workareound i using begin/recue. But it doesn't execute the rescue block: http://pastebin.com/Z2Y8EXni - any ideas?
[2012-11-08 16:48:29 -0500] jblaine: kallistec: For example, chef-solo --help calls open() ~8000 times, ~7000 of which are ENOENT
[2012-11-08 16:48:49 -0500] BryanWB_: whoah
[2012-11-08 16:48:53 -0500] poolpog: can anyone answer why the apache2 community cookbook uses ":restart" instead of ":reload" for many things, such as enable/disable mods?
[2012-11-08 16:49:06 -0500] shay: sry my keyboard sucks really hard :D
[2012-11-08 16:49:27 -0500] jblaine: kallistec: ~1000 of those errors are from "mixlib"
[2012-11-08 16:49:49 -0500] kallistec: jblaine: newest rubygems will be better, but a lot of that comes from the way rubygems searches through gems to load files
[2012-11-08 16:50:31 -0500] kallistec: unfortunately, rubygems has the most possible flexibility and late-boundness in terms of what files come from where, which means it has to do a lot of work at runtime
[2012-11-08 16:50:53 -0500] kallistec: on my laptop, I'm running this: https://github.com/danielsdeleo/loadpath-compiler
[2012-11-08 16:51:11 -0500] BryanWB_: bbl
[2012-11-08 16:51:28 -0500] jblaine: kallistec: Fair enough, as long as it is a known issue.
[2012-11-08 16:52:02 -0500] kallistec: that's worked  for me for a few months, but I'm pretty sure there are lots of cases where it won't work and I've just not run into them yet
[2012-11-08 16:52:02 -0500] mbf: hi all
[2012-11-08 16:52:03 -0500] jblaine: kallistec: Would be fascinating to see what kind of perf gains could be had in runs
[2012-11-08 16:52:22 -0500] jblaine: kallistec: w/o breaking anything
[2012-11-08 16:53:28 -0500] kallistec: jblaine: you mean during the chef run? or just the startup time?
[2012-11-08 16:54:32 -0500] jblaine: kallistec: largely startup time I guess, as I am sure the run is mostly blocked on none of this stuff
[2012-11-08 16:54:34 -0500] kallistec: anyway, it's less of an issue for me now that I have SSD on my laptop, but that loadpath compiler still cuts the time for e.g., `knife help` in half
[2012-11-08 16:55:08 -0500] kallistec: 800ms down to 400ms last I measured
[2012-11-08 16:55:21 -0500] jblaine: my chef-solo --help is 1.5s
[2012-11-08 16:55:26 -0500] jblaine: that is where this all started
[2012-11-08 16:55:39 -0500] jblaine: "my GOD WHAT IS IT DOING"
[2012-11-08 16:55:51 -0500] kallistec: jblaine: how are you installing? Can you get latest rubygems?
[2012-11-08 16:55:51 -0500] mbf: i'm having some problem with my runlist not running in order
[2012-11-08 16:56:04 -0500] jblaine: I'm a complete ruby sub-novice, FWIW
[2012-11-08 16:56:16 -0500] kallistec: jblaine: also, latest 1.9.3 has some fixes
[2012-11-08 16:57:45 -0500] jblaine: kallistec: Omnibus. It's cool, I'll just check back down the road. Nothing critical, just seemed like there might be something that someone had not looked into yet due to more pressing work. Clearly you've dug in and know all about it.
[2012-11-08 16:58:02 -0500] jblaine: kallistec: Ultimately I was looking to be of service.
[2012-11-08 16:58:15 -0500] wcmaier: ./buffer #tea
[2012-11-08 16:58:23 -0500] wcmaier: yes, we have a #tea at simple
[2012-11-08 17:02:06 -0500] masterkorp: ./buffer #beer
[2012-11-08 17:02:21 -0500] jtimberman: masterkorp: /buffer #pub
[2012-11-08 17:02:21 -0500] jtimberman: :)
[2012-11-08 17:02:34 -0500] wcmaier: we talk about beer in #portland, mostly -- don't have a dedicated channel for that
[2012-11-08 17:02:37 -0500] wcmaier: or coffee, oddly
[2012-11-08 17:02:46 -0500] masterkorp: :)
[2012-11-08 17:03:16 -0500] masterkorp: http://en.wikipedia.org/wiki/Kriek_lambic
[2012-11-08 17:03:23 -0500] masterkorp: hmmmmmummy
[2012-11-08 17:03:39 -0500] shay: kyleb: any idea?
[2012-11-08 17:04:10 -0500] wcmaier: masterkorp: not far from our office: http://www.cascadebrewing.com/
[2012-11-08 17:04:46 -0500] masterkorp: looks cool
[2012-11-08 17:04:52 -0500] masterkorp: do they ship ?
[2012-11-08 17:04:59 -0500] kallistec: jblaine: yeah, there aren't any simple low-risk fixes unfortunately
[2012-11-08 17:06:06 -0500] kallistec: mbf: can you explain?
[2012-11-08 17:06:17 -0500] kyleb: shay: no sorry and digging through the source code it doesn't look easy to extend the template pathing for platforms to also include environments
[2012-11-08 17:08:37 -0500] mbf: hi @kallistec  i have a node with a role which has a run list like so: run_list "recipe[php]", "recipe[java]", "recipe[nginx]", "recipe[git]", "recipe[configuration::appConfiguration]" . the appconfiguration recipe depends on the presence of git but always runs before the git recipe
[2012-11-08 17:09:00 -0500] shay: kyleb: thank you
[2012-11-08 17:09:49 -0500] kallistec: mbf: are you using include_recipe anywhere?
[2012-11-08 17:10:30 -0500] kallistec: mbf: also, does the log message that prints the expanded run_list match your expectations?
[2012-11-08 17:14:29 -0500] mbf: @kallistec not using any includes for the configuration recipe in the prior recipes.
[2012-11-08 17:14:40 -0500] wcmaier: masterkorp: i think so -- cascade is awesome
[2012-11-08 17:14:50 -0500] wcmaier: you can find their bottles in better NW/west-coast stores
[2012-11-08 17:14:56 -0500] masterkorp: i like to try new beers
[2012-11-08 17:15:04 -0500] masterkorp: wcmaier: i am from Portugal, Europe
[2012-11-08 17:16:25 -0500] wcmaier: well then ;)
[2012-11-08 17:18:24 -0500] luckymike: anyone encountered an issue with knife rackspace server create where the node name in client.rb contains the next flag like "mynode.hostname.com --environment"
[2012-11-08 17:20:45 -0500] mbf: @kallistec the runlist expands like so: [2012-11-08T17:17:33+00:00] INFO: Run List is [role[client], role[app], role[monitoring], role[appconf]] [2012-11-08T17:17:33+00:00] INFO: Run List expands to [getting-started, php, java, nginx, git, configuration::appConfiguration, nagios::client]
[2012-11-08 17:48:36 -0500] mbf: @kallistec any other ideas of what i can look at/for?
[2012-11-08 17:56:05 -0500] nautical9: Hey folks, excuse the newbie question, but I was feeling brave and wanted to play with the hot omnibus preview release of chef 11 server - but I'm hitting some simple roadblocks due to the install instructions referring to paths & settings that look liked they've changed...
[2012-11-08 17:56:30 -0500] nautical9: Things like /etc/chef -> /etc/chef-server, validation PEM name changes, etc, even the default nginx config running on standard 443 vs. the old 4000 default. Does anyone know of a changelog or list of changes?
[2012-11-08 17:56:52 -0500] nautical9: Or is my best bet to dig through the chef-solo recipes that set it all up?
[2012-11-08 17:57:05 -0500] nautical9: (I know, I should really know chef admin inside and out before attempting a preview release, but didn't want to spend too much time with chef 10 considering 11 is around the corner, and due to chef 11's use of standard SQL vs. couchdb)
[2012-11-08 18:04:43 -0500] julian___: Hey
[2012-11-08 18:05:11 -0500] julian___: sorry...Hey guys, quick newbie question - how do I call a default attribute from a recipe?
[2012-11-08 18:09:57 -0500] wassy121: myvar = node['foo']['attribute_name']
[2012-11-08 18:10:37 -0500] julian___: is foo the cookbook name?
[2012-11-08 18:10:44 -0500] julian___: Thanks for the response.
[2012-11-08 18:10:45 -0500] wassy121: It's whatever you name it
[2012-11-08 18:13:47 -0500] mikeywaites: hey! im just getting started with chef, i have set up a vagrant box posing as a chef server.  The webui and everything is all running as expected but whenever i try to upload a cookbook i get the following error
[2012-11-08 18:14:01 -0500] mikeywaites: http://dpaste.com/827454/
[2012-11-08 18:14:13 -0500] mikeywaites: anyone got any ideas what might be causing it?
[2012-11-08 18:14:57 -0500] julian___: so in cookbooks/aws/attributes/default.rb I have set """default['aws']['device'] = "/dev/sdf"""".  In my recipe this would be referenced by """node['aws']['device']"""?
[2012-11-08 18:20:22 -0500] thehar: so many quotes
[2012-11-08 18:27:23 -0500] julian___: thehar: lol. eyah.
[2012-11-08 18:33:49 -0500] jkyle: I keep getting a Failed to authenticate to the chef server (http 401).  due to invalid client.pem. This is on the first node I've bootstrapped with a new chef server. it throws the error right at the end of the first run. I can check knife node list and knife client list and the host is there.
[2012-11-08 18:34:01 -0500] jkyle: I've tried removing /etc/chef and deleting the node and client entries and rerunning, same result
[2012-11-08 18:50:39 -0500] yfeldblum: jkyle, are you reusing node names? e.g. create a VM with chef-client, delete the VM, recreate the VM?
[2012-11-08 18:54:31 -0500] jblaine: jtimberman: How do you feel about me ripping out a Ubuntu 8.04 block from the rsyslog cookbook as part of a larger block of commits
[2012-11-08 18:54:59 -0500] jblaine: jtimberman: RHEL6 comes with rsyslog by default, making the cookbook do the right thing there
[2012-11-08 18:59:29 -0500] dberry: is there an equivalent to if platform? for architecture(64 vs. 32 bit)?
[2012-11-08 19:06:30 -0500] wassy121: node[:kernel][:machine]
[2012-11-08 19:06:35 -0500] yfeldblum: dberry, take a look at what `ohai` prints
[2012-11-08 19:08:10 -0500] uncommitted: does chef have support for yum group install?
[2012-11-08 19:17:08 -0500] cheeseplus: uncommitted: not yet - http://tickets.opscode.com/browse/CHEF-1392
[2012-11-08 19:18:29 -0500] uncommitted: cheeseplus: thank you, I was looking at 3462 and didn't think to look at the dup.
[2012-11-08 19:18:46 -0500] cheeseplus: np, I've asked in the past too
[2012-11-08 19:19:13 -0500] mobilemike: Can anyone point to a good article or wiki page explaining when to you attributes set in recipes or roles vs. reading those attributes from data bags?
[2012-11-08 19:19:24 -0500] mobilemike: *you=use
[2012-11-08 19:27:38 -0500] geekbri: I haven't seen one, but you should think of a databag's and something like database tables
[2012-11-08 19:28:17 -0500] geekbri: Attributes vary per node, but with a databag, if you query it from a recipe, no matter what node you are doing it from the information is the same
[2012-11-08 19:28:27 -0500] geekbri: Maybe that clarifies things or makes some level of sense?
[2012-11-08 19:29:03 -0500] cheeseplus: what geekbri said, also you won't get merging of attributes the way you get with roles unless you do it explicitly in the recipe
[2012-11-08 19:35:53 -0500] yfeldblum: data-bags typically contain data that is not specific to any one node; nodes contain data that is specific to any one node (including data coming from the cookbooks but also data coming from roles)
[2012-11-08 19:38:26 -0500] jkyle: yfeldblum: got pulled away, but it's the first node being bootstrapped...so there are no other chef client or node entries except for the chef server and my initial user's client
[2012-11-08 19:44:34 -0500] jkyle: what would be the way to do a "fresh start" and reregister a node?
[2012-11-08 19:45:38 -0500] yfeldblum: `knife node list` and `knife client list` to make sure there are no nodes or clients with that name (`knife node delete NAME` and `knife client delete NAME` if there are) ... and then rebootstrap
[2012-11-08 19:45:55 -0500] jkyle: done
[2012-11-08 19:46:39 -0500] jkyle: so, starting again. clean slate. no nodes or clients with the same name
[2012-11-08 19:46:50 -0500] jkyle: how do you pass a non-standard port to the bootstrap?
[2012-11-08 19:47:18 -0500] jkyle: found it
[2012-11-08 19:49:08 -0500] jkyle: same 401 error
[2012-11-08 19:49:27 -0500] jkyle: brb, will note response
[2012-11-08 19:49:54 -0500] jkyle: so, clean slate, no cruft, reboostrapped...same 401
[2012-11-08 19:51:20 -0500] yfeldblum: make sure you've got the validation key downloaded and your knife.rb configured to point to it
[2012-11-08 19:51:53 -0500] Stephan_: (for good measure, make sure permissions are 0400 or 0600 on the key)
[2012-11-08 19:58:52 -0500] sethvargo: why are direct attribute access forbidden in chef 11?
[2012-11-08 19:58:52 -0500] sethvargo: WARN: Setting attributes without specifying a precedence is deprecated and will be
[2012-11-08 19:58:53 -0500] sethvargo: removed in Chef 11.0. To set attributes at normal precedence, change code like:
[2012-11-08 19:58:53 -0500] sethvargo: `node["key"] = "value"` # Not this
[2012-11-08 19:58:53 -0500] sethvargo: to:
[2012-11-08 19:58:53 -0500] sethvargo: `node.set["key"] = "value"` # This
[2012-11-08 19:59:38 -0500] yfeldblum: sethvargo, it reduces the implementation complexity significantly and removes a number of bugs and quirks
[2012-11-08 20:00:17 -0500] sethvargo: blah. ok. but like 99% of cookbooks out there are currently violating this, including most of opscodes
[2012-11-08 20:03:21 -0500] yfeldblum: change is sometimes painful
[2012-11-08 20:03:21 -0500] rava: make sure not to have :upgrade set in your chef* package recipes :)
[2012-11-08 20:03:39 -0500] yfeldblum: but lack of change would have us all still using os/360
[2012-11-08 20:03:57 -0500] yfeldblum: or ... gasp ... windows
[2012-11-08 20:04:07 -0500] sethvargo1: i'm not saying it's not good im just saying that opscode should lead my example :)
[2012-11-08 20:05:35 -0500] yfeldblum: i believe jtimbermonkey is randomly typing at his keyboard until all the cookbooks are updated to the new style
[2012-11-08 20:05:48 -0500] yfeldblum: so it might take a while
[2012-11-08 20:16:06 -0500] jkyle: yfeldblum: the validation.pem is on the target node in /etc/chef/validation.pem
[2012-11-08 20:17:18 -0500] julian: Another newb question: How do I run a bash command in a recipe?
[2012-11-08 20:17:27 -0500] jkyle: and I've verified it's identialc to the validation.pem on the server
[2012-11-08 20:17:40 -0500] rava: julian: read the wiki section on lwrps
[2012-11-08 20:18:00 -0500] rava: there might be a provider that's doing what you're trying to do as a bash command
[2012-11-08 20:19:00 -0500] rava: it also will give you the usage of the command resource(?..i want to call it. correct me if i'm wrong and it's a provider..)
[2012-11-08 20:19:32 -0500] julian: perfect.  thankyou.
[2012-11-08 20:19:51 -0500] rava: np
[2012-11-08 20:20:31 -0500] holoway: sethvargo: we will, we just haven't done it yet
[2012-11-08 20:20:51 -0500] holoway: sethvargo: it's an interesting thing, since most of the opscode folks have been around for the duration of Chef's existence
[2012-11-08 20:21:01 -0500] holoway: so we have, by definition, the cruftiest shit of all time :)
[2012-11-08 20:21:03 -0500] jkyle: it also completes the client registration, downloads the cookbooks, and starts running them
[2012-11-08 20:21:06 -0500] sethvargo: heheheheheh
[2012-11-08 20:21:08 -0500] jkyle: and then breaks right after this
[2012-11-08 20:21:09 -0500] jkyle: Processing ruby_block[reload_client_config] action create (chef-client::config line 7
[2012-11-08 20:21:16 -0500] jkyle: ruby_block[reload_client_config] called
[2012-11-08 20:21:24 -0500] sethvargo: I'm just wondering if it makes sense for me to start PRing stuff or if that's going to get annoying to jtimberman
[2012-11-08 20:21:25 -0500] jkyle: then throws a 401 client.pem error
[2012-11-08 20:21:44 -0500] holoway: sethvargo: doing work should never be annoying :)
[2012-11-08 20:22:04 -0500] jkyle: holoway: especially when it's someone else doing the work ;)
[2012-11-08 20:23:10 -0500] jkyle: ah, need to look at the client config...
[2012-11-08 20:23:52 -0500] BryanWB:  /msg jtimberman skype or g+ ?
[2012-11-08 20:24:20 -0500] BryanWB: damn space bar
[2012-11-08 20:26:14 -0500] fe: I'm getting this error when I try to setup knife chef server
[2012-11-08 20:26:25 -0500] fe: ERROR: Server returned error for http://
[2012-11-08 20:27:08 -0500] fe: is this related to some permission issue ?
[2012-11-08 20:27:16 -0500] forest: should chef-server create validation.pem when it is started, if it doesn't already exist?
[2012-11-08 20:27:35 -0500] forest: 10.16.2
[2012-11-08 20:34:12 -0500] maplebed: I've heard folks talking about wrapping cookbooks.  What does this mean, and is it a good method?
[2012-11-08 20:35:49 -0500] fe: :(
[2012-11-08 20:35:55 -0500] fe: :|
[2012-11-08 20:35:59 -0500] fe: :)
[2012-11-08 20:36:16 -0500] fe: :--{|
[2012-11-08 20:36:29 -0500] fe: -----
[2012-11-08 20:36:29 -0500] miah: it means. don't modify existing cookbooks that you don't maintain. instead. you should wrap the functionality required from those cookbooks into your own. eg. write a cookbook that calls the nginx cookbook and nginx_site rather than executing nginx cookbook directly.
[2012-11-08 20:36:33 -0500] miah: fe: wtf?
[2012-11-08 20:36:59 -0500] fe: my bad
[2012-11-08 20:37:14 -0500] fe: ok so my question was
[2012-11-08 20:37:37 -0500] miah: did you put in the correct url to your server?
[2012-11-08 20:37:39 -0500] fe: I'm getting this error when I try to setup knife chef server. is this related to some permission issue ?
[2012-11-08 20:38:00 -0500] maplebed: miah: so it's a method of extending cookbooks (eg I'm looking at nagios; I would add my own checks to mynagios instead of directly into the nagios cookbook); can you use the same technique to modify the cookbook (say, to move a hardcoded option into an attribute)?
[2012-11-08 20:38:14 -0500] fe: I used the default.
[2012-11-08 20:38:21 -0500] fe: which is the server url
[2012-11-08 20:38:36 -0500] fe: and on the port 4000
[2012-11-08 20:39:00 -0500] miah: maplebed: ya. basically. in the case of hardcoded i would fix and pull request to get it upstream
[2012-11-08 20:39:19 -0500] miah: fe, look at your knife.rb. ensure validity.
[2012-11-08 20:40:18 -0500] maplebed: miah: and if the changes can't be upstreamed (assuming a change that's not as simple as my prev. example), just fork it and eat the following upgrade issues?
[2012-11-08 20:41:53 -0500] forest: chef is not recreating validation.pem & webui.pem even when I reinstall... any ideas why this is?
[2012-11-08 20:45:25 -0500] fe: mish : hmm I only see this
[2012-11-08 20:45:31 -0500] fe: client_key               '/root/.chef/fe.pem'
[2012-11-08 20:45:43 -0500] fe: and I didnt create fe,pem
[2012-11-08 20:45:46 -0500] fe: yet
[2012-11-08 20:45:51 -0500] fe: fe.pem*
[2012-11-08 20:46:32 -0500] fe: should I generate it ?
[2012-11-08 20:54:35 -0500] daquinox: Hey. Possibly a not so quick questions. We're running a chef server internally and exposing the api on port 443. As far as I can tell, my knife.rb is configured correctly as far as I can tell, and I can run "knife client list" with expected behavior. However; when I try and upload a new cookbook I get the following error https://gist.github.com/4041515 Any thoughts? Thanks.
[2012-11-08 20:56:24 -0500] daquinox: Pardon my lack of proofing.
[2012-11-08 21:13:06 -0500] miah: maplebed: you can still upstream unsimple changes =)
[2012-11-08 21:13:21 -0500] maplebed: heh...
[2012-11-08 21:13:29 -0500] miah: but generally. just try to wrap the other cookbooks. it becomes a little more clear when you're dealing with cookbooks that are more lwrp/library based than recipe based thought
[2012-11-08 21:14:22 -0500] maplebed: I was thinking of the ganglia cookbook - I made extensive changes to enable multiple clusters, but the way I made them is only compatible with ganglia in unicast mode.  The original cookbook supports both unicast and multicast mode, but I think I've broken multicast mode, which makes me loath to upload it.
[2012-11-08 21:14:25 -0500] leifmadsen: has anyone deployed the rabbitmq cookbook in a cluster? Just trying to get a good idea about how I should define the cluster_disk_node attribute so that the rabbitmq servers can spin up in a cluster format
[2012-11-08 21:14:43 -0500] maplebed: but I don't have time (or an environment) to fix the multicast stuff, so ...
[2012-11-08 21:15:28 -0500] maplebed: it seems poor form to take a working cookbook and try and upstream a "better in some cases but broken in others" replacement.
[2012-11-08 21:16:56 -0500] miah: i agree
[2012-11-08 21:26:58 -0500] knuckolls: anyone know how to get knife search to return a subattribute?
[2012-11-08 21:27:00 -0500] knuckolls: knife search node name:prod-haproxy-static-eip -a cloud
[2012-11-08 21:27:05 -0500] knuckolls: that works
[2012-11-08 21:27:10 -0500] knuckolls: but i want cloud:public_ipv4
[2012-11-08 21:27:21 -0500] knuckolls: but i can't figure out the syntax for the nested value
[2012-11-08 21:27:29 -0500] nathenharvey: Here's the Google Hangout URL if you're interested in joining our discussion on cookbook reusability - https://plus.google.com/hangouts/_/stream/9573bdcc8a52bf2a00f356f24fedf7a8f2dfa8d2
[2012-11-08 21:27:29 -0500] yfeldblum: knuckolls, are you trying to shell out to knife? because don't
[2012-11-08 21:27:34 -0500] knuckolls: no
[2012-11-08 21:27:39 -0500] nathenharvey: and the YouTube if you want to just watch http://t.co/Oj9cPAPf
[2012-11-08 21:27:44 -0500] knuckolls: i want to use this syntax with knife ssh to run a one off
[2012-11-08 21:28:44 -0500] knuckolls: i guess the more appropriate question is how to have knife ssh use the cloud:public_ipv4 attribute
[2012-11-08 21:28:52 -0500] knuckolls: knife ssh name:prod-haproxy-static-eip -a cloud:public_ipv4
[2012-11-08 21:28:54 -0500] knuckolls: doesn't behave
[2012-11-08 21:29:10 -0500] yfeldblum: knuckolls, what cloud is this? the cloud public_ipv4 attribute should be copied to the top-level ipaddress attribute
[2012-11-08 21:29:17 -0500] knuckolls: ec2
[2012-11-08 21:29:38 -0500] knuckolls: checking.
[2012-11-08 21:30:21 -0500] knuckolls: hm, it is in knife node show
[2012-11-08 21:30:23 -0500] knuckolls: as IP
[2012-11-08 21:30:34 -0500] knuckolls: but i can't reference that with -a IP
[2012-11-08 21:30:36 -0500] knuckolls: in knife ssh
[2012-11-08 21:31:03 -0500] yfeldblum: knuckolls, the "ipaddress" top-level attribute
[2012-11-08 21:31:27 -0500] knuckolls: yeah that's the 10.0.0.0 address
[2012-11-08 21:31:35 -0500] knuckolls: i want to ssh to the public address
[2012-11-08 21:31:42 -0500] knuckolls: the internal address
[2012-11-08 21:31:48 -0500] knuckolls: is what's in the ipaddress field
[2012-11-08 21:31:54 -0500] yfeldblum: knuckolls, remember, `knife node show` doesn't show you the actual node attributes; it shows you a human-formatted summary
[2012-11-08 21:32:02 -0500] knuckolls: -l does
[2012-11-08 21:32:03 -0500] knuckolls: right?
[2012-11-08 21:32:16 -0500] knuckolls: knife node show <my_node> -l | grep ipaddress
[2012-11-08 21:32:21 -0500] yfeldblum: knuckolls, no, -Fj does
[2012-11-08 21:32:23 -0500] knuckolls: k
[2012-11-08 21:32:34 -0500] yfeldblum: knuckolls, don't know what -l does actually
[2012-11-08 21:33:10 -0500] knuckolls: -Fj just appears to be the attributes set by the roles
[2012-11-08 21:33:11 -0500] yfeldblum: knuckolls, ah yes -l does do that
[2012-11-08 21:34:12 -0500] yfeldblum: knuckolls, ah ok, -l includes the full node attributes rather than just the normal-level node attributes apparently, and -Fj shows json-formatted (instead of summary-formatted)
[2012-11-08 21:34:32 -0500] knuckolls: makes sense
[2012-11-08 21:34:45 -0500] knuckolls: i think i'm just going to go read the source of knife ssh to find the correct syntax
[2012-11-08 21:34:52 -0500] knuckolls: google has found nothing useful
[2012-11-08 21:35:00 -0500] knuckolls: and maybe ipaddress should be the internal address
[2012-11-08 21:35:10 -0500] knuckolls: because i want search inside the recipes to connect to each other via that
[2012-11-08 21:35:15 -0500] knuckolls: this is just from my workstation up to the cloud
[2012-11-08 21:35:25 -0500] knuckolls: a convienience
[2012-11-08 21:36:19 -0500] yfeldblum: knuckolls, ipaddress should probably be Internet-facing ipaddress, and you can set other attributes for whatever local networks you've got (a single private network, 6 private networks, etc)
[2012-11-08 21:36:58 -0500] knuckolls: i agree in theory, in practice i have a lot of cookbooks already using that address as the internal address so there's some refactoring to be done
[2012-11-08 21:37:39 -0500] knuckolls: anyway thanks yfeldblum. I appreciate the help
[2012-11-08 21:38:15 -0500] yfeldblum: knuckolls, refactor away!
[2012-11-08 21:46:35 -0500] rava: wonkyness, why would a knife show against an encrypted data bag on one workstation return cyphererror::bad decrypt, but using the same key on my own workstation work fine?
[2012-11-08 21:51:28 -0500] La_:  I added a question here about chef
[2012-11-08 21:51:30 -0500] La_: http://stackoverflow.com/questions/13298320/error-when-configure-knife-with-open-source-chef-server
[2012-11-08 21:51:46 -0500] La_: if anybody could take a quick look
[2012-11-08 21:55:03 -0500] rava: is there a big disparity as to how knife from chef 10.18 and 10.16 would try to read an encrypted data bag?
[2012-11-08 21:55:36 -0500] rava: er 10.8
[2012-11-08 22:00:27 -0500] yfeldblum: rava, doubtful: https://github.com/opscode/chef/commits/10.16.2/chef/lib/chef/encrypted_data_bag_item.rb
[2012-11-08 22:01:12 -0500] rava: yfeldblum: hrm, can't think of any otherway that the same encrypted dbag key would cause an error on one workstation but not another
[2012-11-08 22:01:30 -0500] yfeldblum: rava, different ruby versions?
[2012-11-08 22:03:30 -0500] rava: hrm, good point
[2012-11-08 22:05:30 -0500] yfeldblum: rava, chef's edb crypto algo uses an odd and deprecated kdf that might be an issue, in particular when different ruby versions are involved
[2012-11-08 22:06:18 -0500] rava: ok, trying it out
[2012-11-08 22:07:27 -0500] rava: ugh, and now ruby is segfaulting on me >.>
[2012-11-08 22:09:49 -0500] yfeldblum: rava, have you exceeded your daily allocation of rubypixies?
[2012-11-08 22:10:37 -0500] rafaelmagu: For some strange reason, every time I run chef-client on a node, client.rb gets changed from my chef server url to localhost. Anyone else experienced this?
[2012-11-08 22:10:40 -0500] rava: yfeldblum: likely, though if it wouldn't take all fricking day, i would setup my tool chain in the ubuntu volume i have on this macbook
[2012-11-08 22:11:03 -0500] julian: help! keep getting this error when trying to install wordpress: FATAL: Errno::ENOENT: No such file or directory - /var/chef/cache/cookbooks/wordpress/recipes/default.rb
[2012-11-08 22:11:15 -0500] yfeldblum: rafaelmagu, does the run-list include the chef-client cookbook?
[2012-11-08 22:11:22 -0500] rafaelmagu: yfeldblum: yes
[2012-11-08 22:11:26 -0500] julian: but default.rb is in the wordpress cookbook
[2012-11-08 22:11:29 -0500] Guest60539: Hey - I'm doing a SSL proxy in front of my Chef instance, and one minor question:   is there any way inside Chef to tell it to reject any connections not coming from localhost?  I can use IPTables to firewall those ports, but it would be simpler if Chef Server itself could be told to just ignore any connection not coming from localhost...
[2012-11-08 22:11:33 -0500] rafaelmagu: AH!
[2012-11-08 22:11:37 -0500] rafaelmagu: Now I see the issue
[2012-11-08 22:11:41 -0500] yfeldblum: rafaelmagu, cheers
[2012-11-08 22:11:44 -0500] rafaelmagu: yfeldblum: thanks!
[2012-11-08 22:11:47 -0500] rava: julian: knife cookbook list, does worpress show up?
[2012-11-08 22:12:40 -0500] julian: It does.  Here is some more output: ec2-23-23-46-101.compute-1.amazonaws.com [2012-11-08T22:08:43+00:00] INFO: Processing gem_package[mysql] action install (wordpress::default line 30)ec2-23-23-46-101.compute-1.amazonaws.com [2012-11-08T22:08:50+00:00] ERROR: Running exception handlers
[2012-11-08 22:12:48 -0500] c_t: Guest60539: Can you bind chef server to 127.0.0.1?
[2012-11-08 22:12:57 -0500] c_t: seems like the most straightforward way to me
[2012-11-08 22:13:02 -0500] julian: So it looks like it is dying at mysql gem?
[2012-11-08 22:13:11 -0500] rafaelmagu: Remind me to buy you a <insert favorite alcoholic beverage here> if/when I meet you
[2012-11-08 22:13:15 -0500] rafaelmagu: :)
[2012-11-08 22:14:36 -0500] Guest60539: I don't see how I do that.
[2012-11-08 22:15:06 -0500] Litex: Berkshelf + Vagrant is fun.
[2012-11-08 22:15:20 -0500] Guest60539: Chef runs as a merb, and I don't understand merbs well enough to know what I can tell it to do.
[2012-11-08 22:15:32 -0500] rafaelmagu: Litex: except when you deal with lots of cookbooks that rely on search ;)
[2012-11-08 22:16:02 -0500] Litex: rafaelmagu: Yeah, although you can use chef server pretty easily w/ that same dev workflow.
[2012-11-08 22:16:32 -0500] rafaelmagu: Litex: does it de-register the clients automatically when you re-provision the box?
[2012-11-08 22:17:07 -0500] Litex: rafaelmagu: I think so, have played with it very little so far.
[2012-11-08 22:17:15 -0500] yfeldblum: Guest60539, i don't see anything for that offhand
[2012-11-08 22:18:48 -0500] rafaelmagu: Litex: ooh, that's sexy if it does
[2012-11-08 22:22:01 -0500] Guest60539: I didn't either.  I want Apache to do the proxying for Chef (i.e. only incoming SSL connections), but block access to any Chef-related port for connections NOT coming through the proxy. Looks like I'll have to use IPTables...
[2012-11-08 22:33:31 -0500] jkyle: Guest60539: I have about a 15 line nginx site config for proxying to chef that terminates the ssl and proxies to the chef backend based on http headers, if you're interested
[2012-11-08 22:34:31 -0500] jkyle: Guest60539: you would need to do the same in apache to get the proxy working
[2012-11-08 22:36:31 -0500] Guest60539: No, I'm doing fine in Apache. That's all configured and working, so that it forwards SSL incoming on 443 to HTTP 4000, and SSL 444 to HTTP 4040.  What I wanted to know was if I could tell Chef to reject any incoming connection attempts on 4000 or 4040 that don't come from the Apache HTTPD (or, more generically, reject all non-localhost connection attempts to 4000/4040)
[2012-11-08 22:37:28 -0500] Guest60539: I can't tell Apache (or Nginx, or any other proxy software) to monitor 4000/4040, as that will screw with the Chef processes binding to those ports.
[2012-11-08 22:39:22 -0500] Axsuul: Anyone know why fetcing a tar.gz with remote_file and trying to tar it gives not in gzip format?
[2012-11-08 22:42:19 -0500] yfeldblum: Axsuul, show some code?
[2012-11-08 22:43:23 -0500] kyleb: Guest60539: You could configure chef server and webui to bind to the localhost ip 127.0.0.1 instead of the open 0.0.0.0, its the -h argument for both chef-server and chef-server-webui
[2012-11-08 22:43:49 -0500] Axsuul: yfeldblum: https://gist.github.com/4ac518dc78c2adbf89e8
[2012-11-08 22:44:04 -0500] Axsuul: yfeldblum: STDERR: gzip: stdin: not in gzip format
[2012-11-08 22:46:05 -0500] Axsuul: yfeldblum: on that tar command
[2012-11-08 22:46:15 -0500] Axsuul: yfeldblum: fetching with wget however doesn't throw that error
[2012-11-08 22:46:30 -0500] Axsuul: yfeldblum: ah, just found this, http://stackoverflow.com/questions/8530593/chef-install-and-update-programs-from-source
[2012-11-08 22:46:48 -0500] Axsuul: yfeldblum: at the end of the comments, it says remote_file  will sometimes ungzip a file
[2012-11-08 22:46:51 -0500] Guest60539: Ahh - that's what I was looking for. So merb has a host restriction option, then.
[2012-11-08 22:47:11 -0500] otterley: is anyone aware of an issue where running "knife cookbook site install" causes an error like
[2012-11-08 22:47:16 -0500] otterley: No submodule mapping found in .gitmodules for path 'cookbooks/ssh_known_hosts'
[2012-11-08 22:47:16 -0500] yfeldblum: Axsuul,
[2012-11-08 22:47:19 -0500] yfeldblum: Axsuul, ah
[2012-11-08 22:47:29 -0500] otterley: when you run "git submodule" ?
[2012-11-08 22:48:13 -0500] yfeldblum: Axsuul, lulz technically the client should only ungzip if the header is content-transfer-encoding, and shouldn't if the header is content-encoding
[2012-11-08 22:55:17 -0500] Guest60539: Alright, that worked. I put OPTIONS="-h 127.0.0.1" in /etc/sysconfig/chef-server.   I'll do the same for chef-server-webui
[2012-11-08 23:02:34 -0500] dmazer: anyone know why I get ERROR: RestClient::InternalServerError: 500 Internal Server Error  when running "knife cookbook upload ntp" ?  Same happens to another person.
[2012-11-08 23:03:13 -0500] rava: dmazer: check the chef server logs, one of the services is puking
[2012-11-08 23:03:42 -0500] dmazer: I can upload data bags, do knife client list, knife cookbooks list
[2012-11-08 23:04:10 -0500] dmazer: I restarted rabbitmq, couchdb -- same
[2012-11-08 23:04:49 -0500] Axsuul: yfeldblum: hah
[2012-11-08 23:04:59 -0500] Axsuul: yfeldblum: they should really document that
[2012-11-08 23:05:26 -0500] Axsuul: yfeldblum: btw, i still have yet to make progress on that git sha check, although it's something I really need. I hope to make some progress soon when everything settles down
[2012-11-08 23:06:18 -0500] rava: yfeldblum: blargh, no dice. i went through and made sure to use the same versions of ruby and even synced chef versions. one workstation can unencrypt the data (my local os x_, and one can't
[2012-11-08 23:06:28 -0500] philsturgeon1: anyone installed graylog2 using the official cookbook?
[2012-11-08 23:06:38 -0500] yfeldblum: rava, very odd ...
[2012-11-08 23:06:46 -0500] rava: yes
[2012-11-08 23:06:57 -0500] jkyle: in the deploy resource's migrate command...how can I pass it the rails environment?
[2012-11-08 23:08:03 -0500] rava: the md5 checksums on the keys both match up aswell
[2012-11-08 23:08:32 -0500] jkyle: I tried: migrate_command "RAILS_ENV=#{node.chef_environment} rake db:migrate", but it treats the whole line as a command rather than shelling out saying => Errno::ENOENT: No such file or directory - RAILS_ENV=production rake db:migrate
[2012-11-08 23:08:33 -0500] kallistec: Axsuul, yfeldblum some servers are stupid and transfer tgz as content-type tar and content-encoding gzip. There's a workaround in place where chef skips unzip if the filename ends in gz
[2012-11-08 23:09:23 -0500] kallistec: Axsuul: what version of chef is this?
[2012-11-08 23:09:32 -0500] Axsuul: kallistec: 0.10.10
[2012-11-08 23:10:10 -0500] kallistec: Axsuul: yeah, should be fixed in a subsequent release
[2012-11-08 23:11:57 -0500] jkyle: ah ha, got it
[2012-11-08 23:12:35 -0500] Axsuul: kallistec: cool good to know
[2012-11-08 23:13:14 -0500] kallistec: rava: probably it's mismatched yaml engines, which can happen even on the same version of ruby if one has libyaml and the other doesn't
[2012-11-08 23:13:37 -0500] kallistec: we'll most likely be moving encrypted data bags to JSON in chef 11
[2012-11-08 23:14:19 -0500] kallistec: see http://tickets.opscode.com/browse/CHEF-3328
[2012-11-08 23:16:31 -0500] rava: kallistec: thanks
[2012-11-08 23:18:25 -0500] yfeldblum: kallistec, can you also get rid of the deprecated kdf, and add a real IV?
[2012-11-08 23:19:38 -0500] yfeldblum: kallistec, this needs to go: https://github.com/opscode/chef/blob/master/lib/chef/encrypted_data_bag_item.rb#L134
[2012-11-08 23:24:05 -0500] rava: so i see someone mentioning in the ticket that they setup a config in knife to use the same version of yaml across the board, how can i set that?
[2012-11-08 23:24:28 -0500] kallistec: yfeldblum: I don't know about all the ciphers and such at that level
[2012-11-08 23:25:05 -0500] kallistec: the chances of someone at opscode working on it before Chef 11 are pretty low
[2012-11-08 23:25:38 -0500] yfeldblum: rava, require "yaml" ; require "psych" ; YAML::ENGINE.yamler = "psych"
[2012-11-08 23:25:44 -0500] yfeldblum: kallistec, who would know?
[2012-11-08 23:26:38 -0500] yfeldblum: kallistec, because as long as you're changing to json, might as well go all the way on that ...
[2012-11-08 23:26:51 -0500] yfeldblum: kallistec, put all the breaking changes in one release
[2012-11-08 23:26:52 -0500] rava: yfeldblum: thanks
[2012-11-08 23:27:25 -0500] kallistec: well, the idea was to fallback to YAML so you could upgrade your clients without having to change all your databags at once
[2012-11-08 23:27:43 -0500] kallistec: but all new writes would be JSON
[2012-11-08 23:29:41 -0500] yfeldblum: kallistec, anyway who would know about that stuff at opscode?
[2012-11-08 23:30:12 -0500] kallistec: Lamont knows a ton about that and probably quite a few others
[2012-11-08 23:30:49 -0500] kallistec: I'm OOTO sick today or else I'd be sitting next to him
[2012-11-08 23:34:32 -0500] rava: is chef good with ruby 1.9?
[2012-11-08 23:34:33 -0500] yfeldblum: kallistec, well, http://tickets.opscode.com/browse/CHEF-3480 is the ticket
[2012-11-08 23:34:46 -0500] rava: my server's still running 1.8, and psych seems to require 1.9
[2012-11-08 23:35:00 -0500] yfeldblum: rava, the chef-full installer ships with ruby-1.9
[2012-11-08 23:35:22 -0500] rava: i installed via apt
[2012-11-08 23:35:22 -0500] yfeldblum: rava, in an isolated copy, not in the PATH, so it shouldn't mess with your system
[2012-11-08 23:35:58 -0500] yfeldblum: kallistec, sorry to hear that ... feel better!
[2012-11-08 23:36:21 -0500] kallistec: yfeldblum: cool. I'll poke some people and see what happens
[2012-11-08 23:37:11 -0500] rava: and the server seems to look in 1.8: https://gist.github.com/4042623
