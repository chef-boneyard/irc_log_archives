[2012-07-28 00:25:14 -0400] jayd3e: how would you go about troubleshooting when a role can't find a nested role, but yet they are both in the same roles/ directory
[2012-07-28 00:25:52 -0400] jayd3e: for example I have a base role and a webserver role, I access the webserver role using "role[webserver]" in the runlist of base.json
[2012-07-28 00:28:59 -0400] cheeseplus: jayd3e: what is the error look like?
[2012-07-28 00:29:07 -0400] cheeseplus: gist it up
[2012-07-28 00:29:56 -0400] jayd3e: cheeseplus:
[2012-07-28 00:29:58 -0400] jayd3e: https://gist.github.com/3191194
[2012-07-28 00:30:02 -0400] jayd3e: gisted up
[2012-07-28 00:33:06 -0400] cheeseplus: and I assume those roles exist in the roles directory?
[2012-07-28 00:33:32 -0400] jayd3e: yup
[2012-07-28 00:33:44 -0400] cheeseplus: might need to gist the clusterfunk.json too
[2012-07-28 00:34:15 -0400] cheeseplus: does the stacktrace show anything helpful?
[2012-07-28 00:34:36 -0400] jayd3e: cheeseplus: https://gist.github.com/3191206
[2012-07-28 00:35:09 -0400] jayd3e: and nah the stacktrace really isn't helpful
[2012-07-28 00:35:15 -0400] jayd3e: I can gist that as well tho if you want
[2012-07-28 00:36:07 -0400] tarnfeld: Does anyone know what happens if two recipes (of different cookbooks) both use a `cookbook_file` in the same location? Does the last overwrite any previous, or are they appended to each other?
[2012-07-28 00:36:47 -0400] cheeseplus: jayd3e: does your solo.rb have the role_path set?
[2012-07-28 00:37:36 -0400] jayd3e: cheeseplus: no it does not, I didn't realize that that was an option
[2012-07-28 00:37:57 -0400] jayd3e: where is the section of the docs that lists all of them?
[2012-07-28 00:37:59 -0400] cheeseplus: jayd3e: http://wiki.opscode.com/display/chef/Chef+Solo#ChefSolo-Roles
[2012-07-28 00:38:23 -0400] cheeseplus: by default it's looking in /var/chef/roles
[2012-07-28 00:39:35 -0400] jayd3e: setting the roles path fixed that, now this https://gist.github.com/3191224
[2012-07-28 00:42:10 -0400] jayd3e: all of these roles worked in vagrant oddly enough
[2012-07-28 00:42:35 -0400] cheeseplus: vagrant presets some default paths for you
[2012-07-28 00:44:27 -0400] jayd3e: cheeseplus: that isn't a config issue is it?
[2012-07-28 00:44:35 -0400] jayd3e: the latest gist
[2012-07-28 00:44:40 -0400] cheeseplus: jayd3e: did you also set the cookbook path?
[2012-07-28 00:44:49 -0400] cheeseplus: it could be, hard to tell
[2012-07-28 00:44:59 -0400] cheeseplus: the stacktrace may be more helpful
[2012-07-28 00:46:12 -0400] jayd3e: cheeseplus: https://gist.github.com/3191257
[2012-07-28 00:48:21 -0400] cheeseplus: any chance you have something named the same in the roles or recipes?
[2012-07-28 00:50:51 -0400] jayd3e: cheeseplus: nope L(
[2012-07-28 00:50:54 -0400] jayd3e: :(*
[2012-07-28 00:54:33 -0400] cheeseplus: jayd3e: my only suggestion from here would be to run one role at a time to find what exactly is breaking
[2012-07-28 00:54:35 -0400] cheeseplus: also
[2012-07-28 00:54:48 -0400] cheeseplus: use the "-l debug" option
[2012-07-28 00:55:03 -0400] jayd3e: kk
[2012-07-28 00:55:08 -0400] cheeseplus: lots of output but that should help find out where it's failing
[2012-07-28 00:55:14 -0400] jayd3e: damn this is such a minimal setup I just don't understand it
[2012-07-28 01:01:04 -0400] cheeseplus: jayd3e: is this via vagrant?
[2012-07-28 01:01:47 -0400] jayd3e: cheeseplus: no this is via chef-solo
[2012-07-28 01:01:52 -0400] jayd3e: but they worked with vagrant
[2012-07-28 01:01:58 -0400] jayd3e: so what I did, and it seems to be working
[2012-07-28 01:02:14 -0400] jayd3e: is I took out the json_class attribute for the one role that I call, and left it in for the others
[2012-07-28 01:02:55 -0400] cheeseplus: jayd3e: I actually saw that somewhere else while hunting for another problem
[2012-07-28 01:03:04 -0400] cheeseplus: slight inconsistencies between the platforms
[2012-07-28 01:03:15 -0400] jayd3e: cheeseplus: weird, so is that how you fix it?
[2012-07-28 01:03:38 -0400] jayd3e: For every role that you need to actually run, you need to remove json_class?
[2012-07-28 01:04:47 -0400] cheeseplus: that is how someone else fixed a similar issue
[2012-07-28 01:04:58 -0400] cheeseplus: although I haven't a clue why that actually works O_o
[2012-07-28 01:35:23 -0400] tarnfeld: Hey, if anyone is familiar with the ssh gateway option in knife, am really struggling here.. http://serverfault.com/questions/411994/how-to-use-an-ssh-gateway-with-chefs-knife-bootstrap
[2012-07-28 02:01:19 -0400] anthroprose: tarn: yo... I've been doing some work with it lately
[2012-07-28 02:01:58 -0400] anthroprose: at least ive been digging through the code for it...
[2012-07-28 02:03:32 -0400] anthroprose: tarn: you need to put your gateway creds in the --ssh-gateway="gateway.node" section
[2012-07-28 02:04:12 -0400] anthroprose: http://pastebin.com/Gz2V74Fa
[2012-07-28 02:05:34 -0400] anthroprose: it'll then use the identity or password you gave it through the other options
[2012-07-28 02:08:31 -0400] jayd3e: so I'm trying to simply create some attributes to override.  Will this work? https://gist.github.com/3191439
[2012-07-28 02:08:40 -0400] jayd3e: I'm trying to override the vagrant user with jayd3e
[2012-07-28 02:09:37 -0400] tarnfeld: anthroprose: ah!! I thought it might be that but i thought it would be odd to do that, nice, thanks
[2012-07-28 02:10:11 -0400] anthroprose: im currently trying to workout the proper way to trickle that down into the ec2 plugin
[2012-07-28 02:11:48 -0400] jayd3e: I guess I should ask, should that work?  b/c at the moment it does not
[2012-07-28 02:11:56 -0400] anthroprose: tarnfeld: although on second glance it may default your ssh_user to the passed in opt if its not parsed out of the gateway name
[2012-07-28 02:12:02 -0400] anthroprose: my rubyfoo is wanting
[2012-07-28 02:12:45 -0400] anthroprose: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/ssh.rb btw...
[2012-07-28 02:13:23 -0400] anthroprose: jayde: maybe the overrides need to come from another scope? i really dont know
[2012-07-28 02:14:19 -0400] jayd3e: anthroprose: not sure what you mean by another scope?
[2012-07-28 02:14:41 -0400] anthroprose: jayde: your doing it all from one file?
[2012-07-28 02:14:57 -0400] anthroprose: like the defaults need to come from a role or cookbook
[2012-07-28 02:15:03 -0400] anthroprose: and then you override at a recipe or something
[2012-07-28 02:15:05 -0400] anthroprose: ?
[2012-07-28 02:15:15 -0400] anthroprose: (totally guessing)
[2012-07-28 02:15:23 -0400] tarnfeld: anthroprose: is it me, or is that a typo https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/ssh.rb#L82
[2012-07-28 02:15:40 -0400] anthroprose: hahaha
[2012-07-28 02:15:44 -0400] tarnfeld: by the looks of where that is used
[2012-07-28 02:15:46 -0400] anthroprose: we have a winner!
[2012-07-28 02:15:50 -0400] tarnfeld: it should be `ssh_gateway`
[2012-07-28 02:15:55 -0400] tarnfeld: LOL I'm like 'wtf I'm doing this perfectly'
[2012-07-28 02:16:00 -0400] tarnfeld: will open an issue
[2012-07-28 02:16:00 -0400] anthroprose: agreed
[2012-07-28 02:16:21 -0400] jayd3e: anthroprose: so right now, what you see is the only code that deals with attributes.  Then in the recipe, I use the variables like so -> node['clusterflunk']['user']
[2012-07-28 02:16:27 -0400] anthroprose: I would just fix it, but then I'd have to fill out that damn doc ;)
[2012-07-28 02:16:37 -0400] jayd3e: so they are not defined in the attributes/default.rb
[2012-07-28 02:16:44 -0400] tarnfeld: https://github.com/opscode/chef/pull/326
[2012-07-28 02:16:51 -0400] jayd3e: I thought that the role's default_attributes would take care of that
[2012-07-28 02:17:03 -0400] anthroprose: rotfl
[2012-07-28 02:17:10 -0400] anthroprose: we need a place to anonymously drop patches
[2012-07-28 02:17:13 -0400] anthroprose: for the love of god
[2012-07-28 02:18:57 -0400] ampledata: Report handler Chef::Handler::ErrorReport raised #<RegexpError: Stack overflow in regexp matcher: /\A\s*(?:\[.*\]|\{.*\})\s*\Z/m>
[2012-07-28 02:19:00 -0400] ampledata: god
[2012-07-28 02:19:06 -0400] ampledata: http://tickets.opscode.com/browse/CHEF-2694
[2012-07-28 02:19:38 -0400] tarnfeld: anthroprose: yeah, like now i need to wait for opscode and a release of chef, grrrr
[2012-07-28 02:20:14 -0400] anthroprose: I went ahead and stuck a patch into my deploy process
[2012-07-28 02:20:21 -0400] anthroprose: I literally just started on stuff today
[2012-07-28 02:20:25 -0400] anthroprose: so im glad you were here
[2012-07-28 02:21:11 -0400] anthroprose: https://github.com/opscode/knife-ec2/pull/53
[2012-07-28 02:21:14 -0400] anthroprose: is my current issue..
[2012-07-28 02:21:54 -0400] anthroprose: ampledata: http://acrmp.github.com/foodcritic/
[2012-07-28 02:22:15 -0400] jayd3e: anthroprose: any idea?  I guess I'm mainly curious if that should work
[2012-07-28 02:22:30 -0400] jayd3e: how do you usually define attributes?
[2012-07-28 02:22:30 -0400] anthroprose: jay: I'm pokin round.. but nothing off the top of my head
[2012-07-28 02:22:42 -0400] anthroprose: I currently do them at a recipe attribute level
[2012-07-28 02:22:53 -0400] anthroprose: and then bootstrap pertinent ones
[2012-07-28 02:22:57 -0400] anthroprose: others populate during the run
[2012-07-28 02:22:59 -0400] ampledata: not sure how that's related
[2012-07-28 02:23:01 -0400] ampledata: but ok thanks
[2012-07-28 02:23:24 -0400] anthroprose: ampledata: well json is aready lintable...
[2012-07-28 02:23:45 -0400] jayd3e: so you define them in attrbiutes/default.rb, by doing something like default['apache']['port'], and then in the recipe, use them like node['apache']['port'].
[2012-07-28 02:23:54 -0400] ampledata: unrelated to json
[2012-07-28 02:24:09 -0400] ampledata: more in how we parse handle json
[2012-07-28 02:24:13 -0400] ampledata: s/parse//
[2012-07-28 02:24:18 -0400] tarnfeld: anthroprose: https://github.com/opscode/chef/pull/326#issuecomment-7329866 lool
[2012-07-28 02:24:31 -0400] ampledata: i think macros was talking about this last night
[2012-07-28 02:24:36 -0400] anthroprose: ample: my mistake, i took it as malformed json made it through to cause errors
[2012-07-28 02:24:37 -0400] ampledata: PRETTYPRINT ALL THE THINGS
[2012-07-28 02:24:45 -0400] anthroprose: not impoper parsing of proper json
[2012-07-28 02:24:46 -0400] tarnfeld: Is there anyone form opscode actually alive here? (btm ?)
[2012-07-28 02:24:53 -0400] jayd3e: and you can override them in the roles file by adding key/value pairs, in the override_attributes value of the role file
[2012-07-28 02:24:58 -0400] anthroprose: tarn: usually business hours
[2012-07-28 02:25:31 -0400] anthroprose: jayde: http://pastebin.com/Buz7dUc1
[2012-07-28 02:25:39 -0400] tarnfeld: damn it, its just a gem right, maybe I can hack together the ruby file
[2012-07-28 02:25:44 -0400] anthroprose: attributes/replication-master.rb
[2012-07-28 02:26:01 -0400] anthroprose: so I know I'm the master goin in...
[2012-07-28 02:26:11 -0400] anthroprose: node.set[:mysql][:server][:log_file] =
[2012-07-28 02:26:17 -0400] anthroprose: and then I do that from inside a ruby block
[2012-07-28 02:26:58 -0400] jayd3e: why node.set?
[2012-07-28 02:27:09 -0400] anthroprose: i suck at ruby and thats what the examples show
[2012-07-28 02:27:11 -0400] jayd3e: o wait
[2012-07-28 02:27:14 -0400] jayd3e: I see
[2012-07-28 02:27:15 -0400] anthroprose: there are a couple different syntaxes
[2012-07-28 02:27:25 -0400] jayd3e: so you do the overriding the actual recipe?
[2012-07-28 02:27:28 -0400] anthroprose: I was not using node.set before, but a different method
[2012-07-28 02:27:30 -0400] jayd3e: in*
[2012-07-28 02:27:40 -0400] anthroprose: *I* do yes
[2012-07-28 02:27:49 -0400] jayd3e: kk
[2012-07-28 02:28:05 -0400] anthroprose: but you can also do it with tiered attrs for roles & such
[2012-07-28 02:28:14 -0400] anthroprose: like your environment is test by default
[2012-07-28 02:28:24 -0400] anthroprose: but a role[dev-something] would switch it to development
[2012-07-28 02:28:38 -0400] anthroprose: or a recipe[prod-whatever] would switch it to production
[2012-07-28 02:29:12 -0400] jayd3e: yah I feel like my method should work
[2012-07-28 02:29:47 -0400] anthroprose: -j '{ "public_ip":"107.23.1.1", "cluster": {"name": "TEST-10-46-128-96"}, "mysql" : { "cluster" : { "name" : "TEST-10-46-128-96" }, "server": { "role": "master" } } }'  is how I kick off mine currently
[2012-07-28 02:30:00 -0400] anthroprose: I don't have the stack far enough along for multiple roles & such
[2012-07-28 02:30:16 -0400] anthroprose: my server:role is the same thing
[2012-07-28 02:31:06 -0400] tarnfeld: anthroprose: also, that issue you linked to, I'm gonna need that too, lol
[2012-07-28 02:31:24 -0400] anthroprose: tarn: we should unite forces
[2012-07-28 02:31:36 -0400] anthroprose: so I'm just waiting on a response before i submit my pull req
[2012-07-28 02:31:50 -0400] anthroprose: because they said it was better done in knife/bootstrap but that dosnt make sense to me
[2012-07-28 02:32:08 -0400] anthroprose: because if you dont pass them to ec2, it dosnt pass them to bootstrap
[2012-07-28 02:32:34 -0400] tarnfeld: yeah, I'm also not using ec2, so I just need this anyways :/
[2012-07-28 02:33:05 -0400] anthroprose: ah ok.. that was for knife-ec2
[2012-07-28 02:33:51 -0400] anthroprose: my lack of ruby could be missing inheritance that obviously allows it to work... but I would have expected they would have just said that
[2012-07-28 02:34:32 -0400] tarnfeld: yeah
[2012-07-28 02:35:07 -0400] tarnfeld: anthroprose: i'm so amazed something like that managed to get through, it can't have ever worked (https://github.com/opscode/chef/commit/e2481adbb5bc35c8730360e5962c4e8a44625eae#commitcomment-1641965)
[2012-07-28 02:35:40 -0400] anthroprose: so.... it took me a couple weeks of using knife to even know it existed
[2012-07-28 02:35:47 -0400] anthroprose: because its so hidden
[2012-07-28 02:36:05 -0400] anthroprose: and I wrote code to wrap knife in ec2 api calls to get around it
[2012-07-28 02:36:06 -0400] anthroprose: heh
[2012-07-28 02:36:19 -0400] anthroprose: skapping EIPs on stuff and then ripping them off
[2012-07-28 02:36:25 -0400] tarnfeld: heh
[2012-07-28 02:36:26 -0400] anthroprose: eip=public ip
[2012-07-28 02:36:38 -0400] tarnfeld: oooh lol, damn :/
[2012-07-28 02:36:50 -0400] anthroprose: not good security practices heh
[2012-07-28 02:36:56 -0400] tarnfeld: no not at all
[2012-07-28 02:37:04 -0400] tarnfeld: kinda defeats the point of VPC
[2012-07-28 02:37:18 -0400] anthroprose: thats ok, I suggested pre-generating SSH keys and storing them in a queue for use the other day
[2012-07-28 02:37:26 -0400] anthroprose: so you shouldn't listen to me about stuff like that
[2012-07-28 02:38:06 -0400] anthroprose: I'll be diving into all of this over the weekend & first part of next week
[2012-07-28 02:38:19 -0400] anthroprose: so I should have whatever needs to be fixed or changed working
[2012-07-28 02:38:32 -0400] anthroprose: for a full ec2 vpc launch through a gateway
[2012-07-28 02:38:38 -0400] tarnfeld: :D
[2012-07-28 02:48:14 -0400] tolland: gah
[2012-07-28 02:48:22 -0400] tolland: chef-client hangs
[2012-07-28 02:48:31 -0400] tolland: chef-client -l debug runs through fine
[2012-07-28 02:48:33 -0400] tolland: ;-)
[2012-07-28 03:05:46 -0400] hoover_damm: ouch
[2012-07-28 03:05:54 -0400] hoover_damm: tolland, break out strace or perf?
[2012-07-28 03:08:19 -0400] mce128: Hello
[2012-07-28 03:12:45 -0400] mce128: Well, I guess I'll throw this question out there and just see if I get any bites... I  have a node that is not placing one of it's files from the recipe. The recipe is in the runlist in the output of chef-client -l debug. I've even gone so far as to delete the pre-existing file to no avail. The exact same config worked on another node with out incident, so it is driving me a bit nuts.
[2012-07-28 03:13:55 -0400] mce128: Thoughts, ideas, etc... would be greatly appreciated, but if noone has run into this or nobody's actually around, then I guess I won't get an answer and that is ok... I'll live and eventually figure it out.
[2012-07-28 03:27:22 -0400] hoover_damm: mce128, if you can post the recipe in question and the debug log in question we'd have something to go on
[2012-07-28 03:27:28 -0400] hoover_damm: also it's friday night which is quiet
[2012-07-28 03:27:39 -0400] hoover_damm: seems irc is still quite american
[2012-07-28 03:27:58 -0400] hoover_damm: friday around 7pm hits and irc gets quiet in a lot of rooms
[2012-07-28 03:28:03 -0400] mce128: lol
[2012-07-28 03:28:20 -0400] mce128: that certainly can happen
[2012-07-28 03:29:09 -0400] hoover_damm: mce128, it's likely you have a not_if condition that is causing this resource to not run
[2012-07-28 03:29:12 -0400] hoover_damm: fwiw
[2012-07-28 03:29:36 -0400] hoover_damm: fire up shef and run the resource on the host and see if it works
[2012-07-28 03:29:39 -0400] hoover_damm: always a fun way to debug
[2012-07-28 03:31:43 -0400] mce128: Yeah, I wish it was a not_if, good suggestion though
[2012-07-28 03:31:53 -0400] hoover_damm: creates?
[2012-07-28 03:31:54 -0400] bawt: creates is a special case
[2012-07-28 03:32:01 -0400] mce128: yes it is :create
[2012-07-28 03:32:02 -0400] hoover_damm: bawt, forget creates
[2012-07-28 03:32:03 -0400] bawt: fine
[2012-07-28 03:32:06 -0400] hoover_damm: no not :create
[2012-07-28 03:32:07 -0400] hoover_damm: creates
[2012-07-28 03:32:14 -0400] mce128: ummm lemme look
[2012-07-28 03:32:23 -0400] hoover_damm: it's a shortcut to not_if File.exists?("path/to/file")
[2012-07-28 03:32:36 -0400] hoover_damm: basically with what little you've given me, I can't tell you anything useful
[2012-07-28 03:32:56 -0400] mce128: I have an attribute of   action :create set for the file
[2012-07-28 03:33:10 -0400] mce128: all the other files in the run get put in too...
[2012-07-28 03:33:12 -0400] hoover_damm: let's start with some code
[2012-07-28 03:33:20 -0400] hoover_damm: can you post the recipe in question?
[2012-07-28 03:33:27 -0400] mce128: ok
[2012-07-28 03:33:34 -0400] mce128: postgresqlconf = File.join(File::SEPARATOR, "var", "lib", "pgsql", "data", "postgresql.conf")
[2012-07-28 03:33:36 -0400] mce128: then
[2012-07-28 03:33:46 -0400] mce128: cookbook_file postgresqlconf do   source "postgresql.conf"   mode 0755   owner "postgres"   group "postgres"   action :create end
[2012-07-28 03:33:53 -0400] mce128: oh that didn't format well
[2012-07-28 03:33:57 -0400] mce128: from pasting
[2012-07-28 03:34:06 -0400] hoover_damm: huh
[2012-07-28 03:34:14 -0400] mce128: well I guess the spaces make it clear where the line breaks are
[2012-07-28 03:34:16 -0400] hoover_damm: why did you use File.join
[2012-07-28 03:34:23 -0400] hoover_damm: that's pure silly
[2012-07-28 03:34:28 -0400] mce128: Becuase, I was thrown to the wolves
[2012-07-28 03:34:36 -0400] mce128: and reused existing recipes
[2012-07-28 03:34:37 -0400] hoover_damm: the fact that it's failing likely is because it's not running in the right context
[2012-07-28 03:35:01 -0400] hoover_damm: let's start by removing the lame postgresqlconf= line
[2012-07-28 03:35:06 -0400] hoover_damm: and hardcode it like you're already doing
[2012-07-28 03:35:19 -0400] hoover_damm: cookbook_file "/var/lib/pgsql/data/postgresql.conf" do ..
[2012-07-28 03:35:23 -0400] mce128: ok
[2012-07-28 03:35:39 -0400] hoover_damm: unless your expecting to support windows and linux in the same cookbook
[2012-07-28 03:35:45 -0400] hoover_damm: i have no clue why you'd use File::SEPARATOR
[2012-07-28 03:36:09 -0400] mce128: I know why they did that actually
[2012-07-28 03:36:16 -0400] hoover_damm: why?
[2012-07-28 03:36:20 -0400] mce128: to be system agnostic
[2012-07-28 03:36:34 -0400] hoover_damm: but your path ignorant
[2012-07-28 03:36:37 -0400] hoover_damm: so that does nothing
[2012-07-28 03:36:44 -0400] mce128: lol
[2012-07-28 03:36:53 -0400] hoover_damm: that path likely isn't the same on windows
[2012-07-28 03:36:56 -0400] hoover_damm: and outside of windows
[2012-07-28 03:36:59 -0400] hoover_damm: i'm not sure what you'd gain by that
[2012-07-28 03:37:03 -0400] mce128: well, I'm learning as I go... like I said thrown to the wolves...
[2012-07-28 03:37:07 -0400] hoover_damm: but that's cool
[2012-07-28 03:37:11 -0400] hoover_damm: i figured that's why
[2012-07-28 03:37:15 -0400] mce128: I see you point there and it is certainly a fair one
[2012-07-28 03:37:36 -0400] mce128: and I am supposed to use the conventions they use in their other recipies
[2012-07-28 03:37:57 -0400] hoover_damm: hrm, yeah basically my guess is that it's coming out as nil due to compile vs runtime magic
[2012-07-28 03:37:58 -0400] mce128: knifing up the change now and then I'll run it...
[2012-07-28 03:38:01 -0400] hoover_damm: and it should be wrapped in a ruby_block
[2012-07-28 03:38:10 -0400] mce128: hmmmn... ok
[2012-07-28 03:38:15 -0400] hoover_damm: so cookbook_file is trying to update nil and saying hey wtf? let's go
[2012-07-28 03:38:23 -0400] mce128: lol
[2012-07-28 03:38:33 -0400] hoover_damm: but you've given me very little to guess on :) so we're just a good guess
[2012-07-28 03:39:08 -0400] mce128: I know, but there isn't much to just placing a fixed content file
[2012-07-28 03:39:19 -0400] mce128: normally in my limited exp
[2012-07-28 03:39:21 -0400] hoover_damm: yep and it's not working
[2012-07-28 03:39:24 -0400] mce128: lol
[2012-07-28 03:39:27 -0400] hoover_damm: which means I'd want chef-client -l debug
[2012-07-28 03:39:44 -0400] hoover_damm: when our expectations do not meet with reality we need to grab a shovel
[2012-07-28 03:39:46 -0400] hoover_damm: and dig a hole
[2012-07-28 03:39:51 -0400] hoover_damm: and find out where the hell we went wrong
[2012-07-28 03:39:53 -0400] mce128: yeah
[2012-07-28 03:40:41 -0400] mce128: I've been manually running chef-client with -l debug all evening... it's funny though all the other ones copy over fine as do all the fixed files in the other cookbooks I did the same way too
[2012-07-28 03:41:19 -0400] mce128: lol :)
[2012-07-28 03:41:42 -0400] hoover_damm: I spent my time in hell
[2012-07-28 03:41:44 -0400] mce128: I'm waiting on the run to finish, but I suspect your guess is likely correct
[2012-07-28 03:41:45 -0400] hoover_damm: no reason to go back
[2012-07-28 03:41:50 -0400] mce128: hahahaha
[2012-07-28 03:42:10 -0400] hoover_damm: mce128, ruby_block it in the future :)
[2012-07-28 03:42:19 -0400] hoover_damm: might wanna fix all those un-ruby blocked items
[2012-07-28 03:42:21 -0400] hoover_damm: that should be
[2012-07-28 03:42:32 -0400] hoover_damm: although that sounds pretty janky
[2012-07-28 03:42:37 -0400] mce128: cool, will do, I prefer to do things the "proper" way
[2012-07-28 03:42:49 -0400] hoover_damm: ruby_block "postgresqlconf" do block do .. end end then do cookbook_file
[2012-07-28 03:42:50 -0400] hoover_damm: lol
[2012-07-28 03:43:02 -0400] hoover_damm: oof turns a bad 2 line paste in irc to be more
[2012-07-28 03:43:04 -0400] hoover_damm: :)
[2012-07-28 03:43:18 -0400] mce128: yeah, that's what happened to me earlier too
[2012-07-28 03:43:29 -0400] mce128: but I see what you're getting at
[2012-07-28 03:43:54 -0400] jberanek: hoover_damn: I'll bite, why ruby_block the line? If it doesn't depend on any logic from the resources, so evaluating during the first pass seems like it should be ok
[2012-07-28 03:44:27 -0400] hoover_damm: jberanek, expecations arn't meeting reality... first step
[2012-07-28 03:44:28 -0400] mce128: oooh intrigue builds
[2012-07-28 03:44:47 -0400] hoover_damm: jberanek, it seems like an easy line but reality is not on our side
[2012-07-28 03:44:55 -0400] mce128: hey btw, hardcoding the path did it. Thank you VERY much!
[2012-07-28 03:45:15 -0400] hoover_damm: hypothesis confirmed :(
[2012-07-28 03:45:16 -0400] hoover_damm: damn
[2012-07-28 03:45:20 -0400] hoover_damm: mce128, your welcome
[2012-07-28 03:45:42 -0400] mce128: I didn't know you could do it that way, because I was extrapolating from some extant cookbooks... but looking at it, it's obvious that it could be done that way
[2012-07-28 03:45:56 -0400] mce128: hindsight, 20/20, etc...
[2012-07-28 03:46:04 -0400] hoover_damm: always is
[2012-07-28 03:46:08 -0400] mce128: yup
[2012-07-28 03:47:19 -0400] mce128: also in presenting the problem, I was attempting to isolate the problem part from all the extraneous crap and could supply answers to questions if need be... I hate it when providing support and someone drowns you in irrelevant details... muddys the water
[2012-07-28 03:48:12 -0400] mce128: although, it also annoys me when not enough information is supplied and then the person is incapable of answering further questions about the details... fortunately, I'm no longer in support ;)
[2012-07-28 03:49:45 -0400] hoover_damm: over a year since i was in a support role
[2012-07-28 03:49:58 -0400] hoover_damm: and I took that role to tone down the stress
[2012-07-28 03:50:03 -0400] hoover_damm: too bad it meant i had to support chef 0.6 lol
[2012-07-28 03:50:42 -0400] mce128: lol
[2012-07-28 03:50:47 -0400] hoover_damm: I just am very good at troubleshooting via a stack trace
[2012-07-28 03:50:53 -0400] hoover_damm: regardless of what language it's in
[2012-07-28 03:50:55 -0400] mce128: I used to do phone support for TCWO.com when they still existed
[2012-07-28 03:51:06 -0400] hoover_damm: ahh I worked for Engine Yard for 2years
[2012-07-28 03:51:16 -0400] hoover_damm: last 6-8months of my job I was their release manager
[2012-07-28 03:51:22 -0400] mce128: now I'm an indie contractor
[2012-07-28 03:51:27 -0400] hoover_damm: freelance now
[2012-07-28 03:51:28 -0400] hoover_damm: myself
[2012-07-28 03:51:32 -0400] mce128: same here
[2012-07-28 03:51:45 -0400] mce128: it's nice to be able to work from anywhere you feel like that day
[2012-07-28 03:51:58 -0400] hoover_damm: totally
[2012-07-28 03:52:01 -0400] hoover_damm: and walk away the next day
[2012-07-28 03:52:01 -0400] mce128: once it cools down some, I'm going to start working from parks and stuff
[2012-07-28 03:52:08 -0400] mce128: yeah, indeed
[2012-07-28 03:52:23 -0400] hoover_damm: find something you don't like? no need to care
[2012-07-28 03:52:24 -0400] hoover_damm: just walk
[2012-07-28 03:52:26 -0400] mce128: at least ruby was pretty easy to pick up
[2012-07-28 03:52:34 -0400] mce128: yeah... there is merit to that
[2012-07-28 03:52:45 -0400] hoover_damm: anymore? hell yes
[2012-07-28 03:52:48 -0400] hoover_damm: too many startups
[2012-07-28 03:53:05 -0400] hoover_damm: basically the problem is (imo) there are too many managers who have never been managers before
[2012-07-28 03:53:15 -0400] hoover_damm: so you introduce problems that are created due to lack of training
[2012-07-28 03:53:15 -0400] mce128: yeah, I was agreeing
[2012-07-28 03:53:30 -0400] mce128: yeah, I see that alot
[2012-07-28 03:53:54 -0400] mce128: or people managing who have no idea about the working details of the project
[2012-07-28 03:54:14 -0400] mce128: I've seen that more times than I'd cared to for sure
[2012-07-28 03:54:27 -0400] mce128: at least on my current project, even the managers know thier stuff
[2012-07-28 03:54:37 -0400] hoover_damm: must be one of those new wave managers who doesn't need the details to inspire you
[2012-07-28 03:54:48 -0400] hoover_damm: just yell at you long enough
[2012-07-28 03:55:26 -0400] mce128: they pull the management from the technical staff it seems, there is a large turnover in the management too due to overworking them
[2012-07-28 03:55:47 -0400] hoover_damm: seems to be overmeeting itis lately in the management area
[2012-07-28 03:57:08 -0400] hoover_damm: but at least management is from the technical staff
[2012-07-28 03:57:11 -0400] hoover_damm: then from out of nowhere
[2012-07-28 03:57:11 -0400] mce128: hahahahaha, yeah, endless mettings can be a killer
[2012-07-28 03:57:17 -0400] mce128: agreed
[2012-07-28 03:58:14 -0400] mce128: Well now that that is solved, I can take off my work hat and turn to more leisurely pursuits
[2012-07-28 03:58:29 -0400] mce128: I'm gonna jet, but again, thank you very much!
[2012-07-28 03:58:41 -0400] mce128: good talking to ya a bit as well
[2012-07-28 03:58:57 -0400] hoover_damm: have a quiet friday
[2012-07-28 03:59:40 -0400] mce128: ;)
[2012-07-28 03:59:47 -0400] mce128: you too
[2012-07-28 06:03:45 -0400] tolland: hosted chef seems sllooooow
[2012-07-28 06:04:13 -0400] coderanger: tolland: Haven't gotten paged so it should all be within normal nagios readings :)
[2012-07-28 06:05:51 -0400] dvolker: hey whatever happened to flapjack?
[2012-07-28 06:05:56 -0400] tolland: maybe its like that all the time then, I don't have much call to go to the lovely lovely frontend
[2012-07-28 06:05:59 -0400] tolland: ;-)
[2012-07-28 06:06:29 -0400] tolland: eaten?
[2012-07-28 10:53:07 -0400] nobdraisentone: Can someone help with that? https://gist.github.com/f52d0bee92128037537c (where this `/var/chef` came from and how can I change it?)
[2012-07-28 10:55:25 -0400] xerxas: Hi all !
[2012-07-28 10:57:21 -0400] xerxas: I find chef too slow, mostly what I see is that we spend a long long time executing all the requires from the gems, so I straced and confirmed it, we spend aroung 70% in lstat64 , stat-ing the same files several times.
[2012-07-28 10:59:10 -0400] xerxas: I looked around and found slimgems (https://github.com/slimgems/slimgems) , which I installed with the embedded gem which replaced the embedded gem, launching chef dropped from ~18 seconds, to ~ 6 seconds
[2012-07-28 10:59:20 -0400] xerxas: and my chef run seems to work
[2012-07-28 10:59:27 -0400] xerxas: is that a totally crazy idea ?
[2012-07-28 13:54:46 -0400] _alpha_: hey guys, I have made some new chef nodes, but when I run chef-client for the first time it complains that chef_environment is not defined
[2012-07-28 13:54:57 -0400] _alpha_: I have set this via. the chef web interface, which worked
[2012-07-28 13:55:13 -0400] _alpha_: but after running chef-client and getting that error, if I check the web ui again the environment is back to _default
[2012-07-28 14:52:07 -0400] alephant: Hi all
[2012-07-28 14:52:10 -0400] alephant: chef newbie here
[2012-07-28 14:52:51 -0400] alephant: I want to set up a server for my app so I've got the cookbooks to manage e.g. mysql and my own cookbook to install packages and set parameters etc.
[2012-07-28 14:55:17 -0400] alephant: my cookbook has a default.rb which installs packages, it works fine.  I'm now trying to set one of the mysql tunable parameters and I must be doing something wrong because the setting isn't being made in the generated my.cnf file once chef runs
[2012-07-28 14:55:24 -0400] alephant: node.override['mysql']['tunable']['max_allowed_packet'] = "32M"
[2012-07-28 14:55:29 -0400] alephant: what's the proper syntax?
[2012-07-28 16:42:51 -0400] kvanderw: what is the process to update chef server 0.10.10 -> 10.12.0 ??
[2012-07-28 16:49:16 -0400] kvanderw: well never mind - that was easy - apt-get upgrade - doh!
[2012-07-28 17:33:02 -0400] tarnfeld: Does anyone know, in chef, if from a recipe running on node A, you can somehow get attributes from node B (and find node B by its chef hostname) ?
[2012-07-28 17:34:11 -0400] Mithrandir: yes, look at search
[2012-07-28 17:35:15 -0400] tarnfeld: @Mithrandir oh thats awesome, thanks!!
[2012-07-28 18:24:28 -0400] tarnfeld: Hmm, for some reason I get an empty string outputted when I access node['chef_environmen'] -- is there a way I can get a nodes environment as a string?
[2012-07-28 18:24:37 -0400] tarnfeld: node['chef_environment'] **
[2012-07-28 18:25:30 -0400] hoover_damm: node.chef_environment
[2012-07-28 18:28:33 -0400] tarnfeld: hoover_damm: awesome! :
[2012-07-28 18:39:49 -0400] patcon: jtimberman: hey man! any thoughts on adding a user resource attr to mac_os_x_userdefaults so that pivotal_workstation can start using it as a dep?
[2012-07-28 18:39:50 -0400] patcon: https://github.com/pivotal/pivotal_workstation/blob/master/providers/defaults.rb
[2012-07-28 18:40:53 -0400] patcon: i'm not with pivotal, but starting to use their workstation cookbook and want to submit some pull requests if they're willing
[2012-07-28 18:41:49 -0400] patcon: I realize you pulled your cookbooks out of theirs, but duplicated efforts make me antsy
[2012-07-28 18:41:53 -0400] patcon: Maybe I have OCDRY :)
[2012-07-28 19:00:35 -0400] ssd7: Ohai Chefs!
[2012-07-28 19:11:32 -0400] cnf: ohai!
[2012-07-28 21:18:47 -0400] cakehero: is there an awesome way to set ulimit via chef or do i just do it sorta using the file and execute resources?
[2012-07-28 21:24:24 -0400] coderanger: cakehero: Immediate ulimits or setting the global control files?
[2012-07-28 21:24:36 -0400] cakehero: coderanger global would be simpler i suppose
[2012-07-28 21:24:38 -0400] cakehero: it's for riak
[2012-07-28 21:25:03 -0400] coderanger: Yeah, template "/etc/security/limits.conf" do ... end
[2012-07-28 21:25:04 -0400] coderanger: :-)
[2012-07-28 21:25:08 -0400] coderanger: Seems easy enough
[2012-07-28 21:25:19 -0400] coderanger: or cookbook_file if you just want to dump some in
[2012-07-28 21:27:22 -0400] cakehero: ok and
[2012-07-28 21:27:25 -0400] cakehero: i'll use sysctl
[2012-07-28 21:27:34 -0400] cakehero: w/action :nothing and notifies
[2012-07-28 21:36:06 -0400] retr0h: cakehero: http://community.opscode.com/cookbooks/sysctl can use that to set your sysctl stuff.. works quite well
[2012-07-28 21:36:14 -0400] cakehero: nice
[2012-07-28 21:36:16 -0400] cakehero: awesome
[2012-07-28 21:36:44 -0400] retr0h: even restarts procps so it takes effect right away
[2012-07-28 21:38:04 -0400] coderanger: sysctl is different from ulimits though
[2012-07-28 21:49:33 -0400] cakehero: coderanger how so?
[2012-07-28 21:49:38 -0400] cakehero: <-- newb
[2012-07-28 21:50:27 -0400] coderanger: cakehero: Different APIs and different config files
[2012-07-28 21:50:36 -0400] coderanger: Sysctl is much bigger in scope
[2012-07-28 21:50:42 -0400] cakehero: k
[2012-07-28 21:50:57 -0400] cakehero: I'm ok w/that, it's just for a dev environment
[2012-07-28 21:54:53 -0400] papertigers: I have node[:network][:interfaces][:net0][:addresses].keys.first, but I want to wild card on node[:network][:interfaces][*][:addresses].keys.each
[2012-07-28 21:54:56 -0400] papertigers: how can I do that?
[2012-07-28 21:55:19 -0400] coderanger: .first?
[2012-07-28 21:55:20 -0400] bawt: .first is limiting it to the first result in the array
[2012-07-28 21:55:31 -0400] coderanger: bawt forget .first
[2012-07-28 21:55:31 -0400] bawt: done
[2012-07-28 21:55:55 -0400] papertigers: no, the :net0 I want that to be a wildcard of all interfaces
[2012-07-28 21:56:00 -0400] papertigers: so I can grab all of the IPs
[2012-07-28 21:56:38 -0400] erikh: node[:network][:interfaces].map { |x| x[:addresses].keys.first }
[2012-07-28 21:56:45 -0400] erikh: likely that.
[2012-07-28 21:57:26 -0400] papertigers: erikh: so I could loop over that with node[:network][:interfaces].map { |x| x[:addresses].keys.first }.each do |ip|
[2012-07-28 21:57:32 -0400] erikh: correct.
[2012-07-28 21:57:43 -0400] erikh: although, and this is very important
[2012-07-28 21:57:49 -0400] erikh: the order of keys may not be deterministic
[2012-07-28 21:58:00 -0400] erikh: so your "first" may not be the same everytime
[2012-07-28 21:58:09 -0400] erikh: especially if you change it at some point
[2012-07-28 21:58:36 -0400] erikh: e.g., add another address.
[2012-07-28 21:58:54 -0400] coderanger: yahr
[2012-07-28 21:59:18 -0400] erikh: hashes aren't ordered, so you'll probably want to use an array there if you can.
[2012-07-28 21:59:24 -0400] papertigers: erikh: thats fine, I want to put it in a case to look for the ip starting with 192.  Each box has many ips and one internal
[2012-07-28 21:59:32 -0400] papertigers: I cant think of a better way to find the internal ip
[2012-07-28 22:00:43 -0400] erikh: node[:network][:interfaces].map { |x| x[:addresses].keys }.flatten.select { |x| x =~ /^192/ }
[2012-07-28 22:01:07 -0400] erikh: not the fastest thing, but for a small data set it should be fine.
[2012-07-28 22:01:29 -0400] erikh: alternatively I guess you could use x[:addresses][/^192/]
[2012-07-28 22:01:42 -0400] erikh: anyhow, you have a few options here. time to play with them.
[2012-07-28 22:01:49 -0400] ashb: erikh: that works?
[2012-07-28 22:01:57 -0400] erikh: it should, yes
[2012-07-28 22:01:59 -0400] ashb: (using regex for array access)
[2012-07-28 22:02:00 -0400] ashb: huh
[2012-07-28 22:02:11 -0400] erikh: it's actually a key lookup.
[2012-07-28 22:02:20 -0400] erikh: anyhow, brb.
[2012-07-28 22:02:28 -0400] papertigers: erikh: thats giving FATAL: TypeError: can't convert Symbol into Integer
[2012-07-28 22:02:50 -0400] erikh: do you have an array or a hash there?
[2012-07-28 22:03:17 -0400] papertigers: how would I determine that?
[2012-07-28 22:03:22 -0400] erikh: with p
[2012-07-28 22:03:36 -0400] erikh: sec.
[2012-07-28 22:03:42 -0400] papertigers: in `[]', so array?
[2012-07-28 22:03:48 -0400] erikh: http://erik.hollensbe.org/blog/2012/06/17/the-best-ruby-debugger-kernel-dot-p/ :)
[2012-07-28 22:04:01 -0400] erikh: well, you need to determine which part of that is an array
[2012-07-28 22:04:16 -0400] ashb: {'abc' => 'def'}[/b/]
[2012-07-28 22:04:20 -0400] ashb: returns nil
[2012-07-28 22:04:22 -0400] ashb: same with /e/
[2012-07-28 22:04:30 -0400] erikh: so, I'd start with node[:network][:interfaces] (which is likely an array)
[2012-07-28 22:04:44 -0400] erikh: ashb: hm, I thought that worked.
[2012-07-28 22:04:46 -0400] erikh: oh well.
[2012-07-28 22:05:07 -0400] ashb: infact it 'works' in that you can have a regex as a key I think
[2012-07-28 22:05:30 -0400] erikh: papertigers: then work through the the { |x| x[:addresses].keys } part, so {|x| p x[:addresses] }
[2012-07-28 22:05:43 -0400] erikh: which is likely what you're having trouble with but I can't say for sure.
[2012-07-28 22:05:53 -0400] erikh: ashb: ah, that totally makes sense
[2012-07-28 22:06:00 -0400] erikh: you can do that with arrays, I figured it extended to hashes too.
[2012-07-28 22:06:15 -0400] erikh: e.g., %w[foo bar][/f|b/]
[2012-07-28 22:06:43 -0400] erikh: haha wtf
[2012-07-28 22:06:46 -0400] erikh: guess not!
[2012-07-28 22:06:50 -0400] erikh: I swear that worked.
[2012-07-28 22:07:13 -0400] erikh: ah, it works with strings
[2012-07-28 22:07:17 -0400] erikh: maybe that's where my head was at.
[2012-07-28 22:07:56 -0400] ashb: i haven't read backscroll but is the ipaddress not the right thing for you?
[2012-07-28 22:09:00 -0400] erikh: no, he's trying to access an array with a symbol
[2012-07-28 22:09:08 -0400] erikh: it's probably the x[:addresses]
[2012-07-28 22:09:25 -0400] ashb: i mean looking at node[:ipaddress] instead of looking at network.interfaces....
[2012-07-28 22:09:47 -0400] erikh: oh. he needs to get the 192/8 address out of the total sum of interfaces
[2012-07-28 22:09:57 -0400] erikh: there's supposedly only one, and it's not the main ipaddress.
[2012-07-28 22:10:10 -0400] ashb: ah
[2012-07-28 22:10:40 -0400] papertigers: yeah this is being a pain
[2012-07-28 22:10:43 -0400] erikh: I gave him a line above but I suspect he's dealing with an array using it like a hash.
[2012-07-28 22:10:51 -0400] erikh: papertigers: play with it in shef.
[2012-07-28 22:11:07 -0400] erikh: anyhow, really this time, brb..
[2012-07-28 22:22:41 -0400] ashb: papertigers: you're after the IP or the iface name?
[2012-07-28 22:24:33 -0400] ashb: node['network']['interfaces'].values.map { |info| (info['addresses'] || {}).keys }.flatten.grep /^10\./
[2012-07-28 22:28:10 -0400] papertigers: ashb: ip
[2012-07-28 22:28:23 -0400] ashb: that is close to what you want then
[2012-07-28 22:28:31 -0400] papertigers: it looks like its a hash
[2012-07-28 22:28:49 -0400] papertigers: node[:network][:interfaces].find_all { |name, addresses| puts name }
[2012-07-28 22:28:54 -0400] papertigers: will print the name of each interface
[2012-07-28 22:29:02 -0400] ashb: see the code i just pasted
[2012-07-28 22:29:03 -0400] papertigers: addresses returns a hash
[2012-07-28 22:31:16 -0400] papertigers: testing
[2012-07-28 22:34:24 -0400] papertigers: ashb: how do i get it out of the []
[2012-07-28 22:34:37 -0400] ashb: .grep(/^10.\./).first
[2012-07-28 22:35:50 -0400] knuckolls_: papertigers: not to be rtfm about it, but these links should help immensely. http://www.ruby-doc.org/core-1.9.3/Array.html http://www.ruby-doc.org/core-1.9.3/Hash.html http://ruby-doc.org/core-1.9.3/Enumerable.html
[2012-07-28 22:36:12 -0400] ashb: the enumerable one doesn't make it really clear about hashes
[2012-07-28 22:36:26 -0400] ashb: but all fothose work ahd get { |key,value| } passed to the blocks
[2012-07-28 22:37:24 -0400] papertigers: knuckolls_: thanks, man this all makes me hate ruby so much haha.
[2012-07-28 22:37:55 -0400] knuckolls_: papertigers: once enumerable clicked for me, i went from hating ruby to refusing to use a loop ever again.
[2012-07-28 22:38:05 -0400] knuckolls_: a for loop perhaps
[2012-07-28 22:38:55 -0400] knuckolls_: papertigers: you can test out anything in irb or shef. that'll let you play with test data to make sure you understand the methods.
[2012-07-28 22:39:39 -0400] papertigers: knuckolls_: I didnt know about shef, I was wondering if something existed
[2012-07-28 22:39:41 -0400] papertigers: its awesome
[2012-07-28 22:40:10 -0400] knuckolls_: use shef -z i think emulates the chef run the best
[2012-07-28 22:40:12 -0400] knuckolls_: lemme look.
[2012-07-28 22:40:28 -0400] ashb: i tested it with juse 'shef' here
[2012-07-28 22:41:26 -0400] knuckolls_: god i can't remember what gotcha kamabe and i ran into working with shef instead of shef -z. i ended up just always using shef -z
[2012-07-28 22:44:17 -0400] ssd7: The "initilaization" code in shef has drifted among some of the options.  -z is your best bet I think, but even that has a bug or two I believe
[2012-07-28 22:48:36 -0400] ssd7: :( At my favorite place to work on weekend projects and every electrical outlet is taken.
[2012-07-28 22:53:02 -0400] knuckolls_: tragedy
[2012-07-28 23:30:41 -0400] papertigers: Can I nest an execute in a template?
[2012-07-28 23:32:38 -0400] papertigers: Or do I have to use a notifies?  The reason I ask is because it needs to be dynamic.  I dont want to hardcode in a bunch of executes
[2012-07-28 23:45:43 -0400] Babar: you can use ruby blocks, or notifies. Rest probably won't be as dynamic as you'd want
[2012-07-28 23:55:27 -0400] hoover_damm: papertigers, you should avoid logic in templates
[2012-07-28 23:55:32 -0400] hoover_damm: beyond the basic if
[2012-07-28 23:55:41 -0400] papertigers: hoover_damm: I figured out what I wanted
[2012-07-28 23:55:45 -0400] papertigers: thanks
