[2012-07-11 00:01:17 -0400] Majost: heh
[2012-07-11 00:01:34 -0400] Majost: I don't like typing two commands for something I do more than once
[2012-07-11 00:50:03 -0400] mxbtt: I just installed chef with 'gem install chef' and upon running 'knife configure' it's saying that it can't find chef dependency "Could not find chef (>= 0)"
[2012-07-11 00:50:24 -0400] mxbtt: but I've verified that chef was indeed installed with gem. any clues as to what is going on?
[2012-07-11 00:51:25 -0400] mxbtt: http://pastebin.com/raw.php?i=BCmMzzkK
[2012-07-11 00:52:42 -0400] c_t: looks like perhaps the gem in question was using some other ruby?
[2012-07-11 00:53:55 -0400] mxbtt: gem env said it's using 1.9.3 as I thought
[2012-07-11 00:56:35 -0400] lawrenceseattle: is it possible to use chef recipe language features in plugins, e.g. data_bag?
[2012-07-11 01:01:30 -0400] barefoot: mxbtt: did you `sudo gem`?
[2012-07-11 01:02:26 -0400] mxbtt: yes
[2012-07-11 01:03:01 -0400] barefoot: so your rvm version wouldnt know how to find it right?
[2012-07-11 01:04:13 -0400] mxbtt: gem env says gem path is to .rvm/gems/ruby-1.9.3-p194 which is my current ruby version
[2012-07-11 01:04:17 -0400] barefoot: guessing, im actually curious as I dont use that or rbenv
[2012-07-11 01:04:17 -0400] hoover_damm: fi you use rvm and you use sudo
[2012-07-11 01:04:21 -0400] hoover_damm: that's your first failure
[2012-07-11 01:04:23 -0400] hoover_damm: s/fi/if
[2012-07-11 01:04:29 -0400] hoover_damm: so you should call fi here
[2012-07-11 01:04:31 -0400] hoover_damm: and ehehe
[2012-07-11 01:04:36 -0400] hoover_damm: use rvm-sudo
[2012-07-11 01:04:41 -0400] mxbtt: tried that and same result
[2012-07-11 01:04:59 -0400] hoover_damm: that's the whole point of the rvm-sudo wrapper
[2012-07-11 01:05:04 -0400] hoover_damm: so you can sudo while keeping rvm up
[2012-07-11 01:15:48 -0400] mxbtt: cleaned up some stuff in my $PATH and all of a sudden it works...
[2012-07-11 01:57:34 -0400] mhalligan: is anyone else seeing problems with hosted-chef ands3?
[2012-07-11 01:57:37 -0400] mhalligan: I've been screwed for a day now
[2012-07-11 01:58:04 -0400] miah: herp herp
[2012-07-11 01:59:45 -0400] yfeldblum: mhalligan, if you're seeing a problem with hosted-chef, you'll probably want to email support@opscode.com, or go to help.opscode.com, since those are the places intended for support for hosted- and private-chef
[2012-07-11 02:00:50 -0400] mhalligan: yeah they've been pretty useless so far, I was just wondering if anyone else is seeing issues
[2012-07-11 02:01:57 -0400] mhalligan: but thanks
[2012-07-11 02:09:12 -0400] hoover_damm: not really what i would classify opscode support (being useless)
[2012-07-11 02:09:22 -0400] hoover_damm: i find them to be fast on responses and very detail oriented
[2012-07-11 03:20:03 -0400] jtimberman: mhalligan: not aware of any issues in particular myself, but someone in the support department might have more information, please email support@opscode.com and someone can check.
[2012-07-11 03:29:23 -0400] flaccid_: wondering if there is a nice/de facto way for deploying a mediawiki with local mysql server?
[2012-07-11 03:30:46 -0400] flaccid_: i'm assuming this would be it http://www.opscode.com/blog/2011/05/27/chef-whips-up-a-mediawiki-lamp-stack-for-you/
[2012-07-11 03:32:03 -0400] flaccid_: http://help.opscode.com/kb/otherhelp/build-a-lamp-stack redirects to the support page :(
[2012-07-11 03:32:40 -0400] flaccid_: hmm thats ha/lb though
[2012-07-11 03:35:50 -0400] flaccid_: i think it needs link updated to http://wiki.opscode.com/display/chef/Build+a+LAMP+Stack
[2012-07-11 03:45:42 -0400] yfeldblum: jtimberman, was one of the ops crews trying to figure out the locker problem (http://www.math.msu.edu/~nathsinc/java/Lockers/)?
[2012-07-11 03:46:12 -0400] yfeldblum: jtimberman, in the data centers, using power buttons and/or ethernet cabling instead of locker doors?
[2012-07-11 03:48:28 -0400] jtimberman: yfeldblum: hm?
[2012-07-11 03:49:47 -0400] flaccid_: has anyone used the application cookbook with chef-solo?
[2012-07-11 03:49:59 -0400] yfeldblum: jtimberman, it would explain mhalligan's symptoms
[2012-07-11 03:50:38 -0400] flaccid_: jtimberman: do you think application cookbook with chef-solo w/ databags would work?
[2012-07-11 03:50:40 -0400] flaccid_: hi btw
[2012-07-11 03:54:05 -0400] yfeldblum: flaccid_, the latest application cookbook no longer requires search, roles, or data bags
[2012-07-11 03:54:33 -0400] flaccid_: yfeldblum: oh cool, readme and wiki doc needs and update or something?
[2012-07-11 03:54:44 -0400] flaccid_: or just basically undocumented atm
[2012-07-11 03:56:22 -0400] yfeldblum: flaccid_, readme on github looks fairly up-to-date
[2012-07-11 03:57:00 -0400] jtimberman: flaccid_: i don't know.
[2012-07-11 03:58:41 -0400] flaccid_: ah yeah thanks yfeldblum its the php quick start that would be nice for an update but the readme is good
[2012-07-11 04:09:31 -0400] nmistry: im experiencing a problem where immediately after bootstrapping a new node there are no attributes
[2012-07-11 04:10:35 -0400] nmistry: the node is registered, client is there, but there is nothing there (runlist, attributes, etc).
[2012-07-11 04:11:28 -0400] nmistry: is that what happens when a bootstrap fails?
[2012-07-11 04:16:57 -0400] yfeldblum: nmistry, no new attributes in what? the node instance that you get by calling `node`? or the node instance that you get from searching the chef-server for the node?
[2012-07-11 04:19:29 -0400] nmistry: knife node show
[2012-07-11 04:20:24 -0400] yfeldblum: nmistry, did the bootstrap fail?
[2012-07-11 04:20:51 -0400] nmistry: nagios recipe is bombing
[2012-07-11 04:21:04 -0400] nmistry: shef has node.default
[2012-07-11 04:21:08 -0400] nmistry: so there are attributes there
[2012-07-11 04:24:19 -0400] q[mrw]: I'm using chef to manage around 200 hosts, knife status is ridiculously slow, anyone have some tips for speeding up searches?
[2012-07-11 04:24:28 -0400] yfeldblum: nmistry, chef-client will only save the final node data to the chef-server after a successful chef-client run (which involves nothing bombing out)
[2012-07-11 04:24:39 -0400] nmistry: ok
[2012-07-11 04:24:54 -0400] nmistry: yea im running chef-cleint -j first-run.json
[2012-07-11 04:24:54 -0400] yfeldblum: nmistry, if the first chef-client run, triggered during a bootstrap, fails, then yes that's what you'll see
[2012-07-11 04:25:05 -0400] nmistry: thanks yfeldblum
[2012-07-11 04:26:45 -0400] nmistry: yfeldblum, how can i debug this situation?
[2012-07-11 04:27:00 -0400] nmistry: its saying that im getting back a nill object, but it should be there
[2012-07-11 04:27:16 -0400] nmistry: can i run the recipe in shef?
[2012-07-11 04:28:49 -0400] yfeldblum: nmistry, sort of, but i rarely use shef; maybe jtimberman has a pointer or two?
[2012-07-11 04:55:50 -0400] Bonkers: say I have a recipe that adds a new nginx server in sites-enabled, how do I tell chef to restart nginx, or does it know somehow?
[2012-07-11 05:00:35 -0400] nmistry: yfeldblum, found a bug that causes it to bomb http://tickets.opscode.com/browse/COOK-769
[2012-07-11 05:00:54 -0400] nmistry: added [nagios][email] to all my users and it now works fine
[2012-07-11 05:21:29 -0400] BryanWB_: ohai chefs!
[2012-07-11 05:48:04 -0400] erikh: jtimberman: you around? I'm seein gsomething awful weird with the nginx cookbook
[2012-07-11 05:50:10 -0400] BryanWB_: reset: around?
[2012-07-11 09:23:50 -0400] lysander: So - I'd like it that if I have a cluster of servers, I can pick a random server in the cluster to receive a change. If the picked server disappears from the cluster, another server gets picked instead.. any ideas ? there are some cronjobs I don't want run on all cluster members.
[2012-07-11 09:24:09 -0400] lysander: does the chef provide an easy interface for something like that ?
[2012-07-11 09:36:31 -0400] vaq: Hello, I just installed chef client and chef server in ubuntu 10.04, however it doesn't seem to install the knife command, what I am missing?
[2012-07-11 09:38:40 -0400] masterkorp: vaq: how did you install the chef ?
[2012-07-11 09:38:49 -0400] masterkorp: with the chef gem ?
[2012-07-11 09:40:28 -0400] vaq: apt-get ubuntu lucid repo
[2012-07-11 09:40:59 -0400] masterkorp: Sorry i know nothing about ubuntu repos
[2012-07-11 09:41:07 -0400] masterkorp:  <-- archlinux user
[2012-07-11 09:43:12 -0400] Mithrandir: vaq: odd.  Try running rehash or hash -r to see if that helps first, and if not, what does dpkg -L chef | grep bin/knife tell you?
[2012-07-11 09:43:48 -0400] vaq: updatedb; locate knife didn't provide any results, I'll try install through gem
[2012-07-11 09:44:13 -0400] cnf: do what Mithrandir said first
[2012-07-11 09:58:35 -0400] vaq: I added the chef lucid repo and it worked.
[2012-07-11 10:18:31 -0400] agentgonzo: Hi all - I could do with some help for getting the runtime of knife down. It uses 100% CPU for about 5-15s on loadup, then runs fine
[2012-07-11 10:18:44 -0400] agentgonzo: Is there any way to stop it hammering the CPU at the start (I have no idea what it is doing)
[2012-07-11 10:18:58 -0400] agentgonzo: Is it that it scans and loads plugins at this time?
[2012-07-11 10:19:57 -0400] agentgonzo: 'knife node list' takes about  5 seconds.
[2012-07-11 10:20:42 -0400] agentgonzo: 'knife cluster show <cluster>' (ironfan plugin) takes about 15 seconds
[2012-07-11 10:29:07 -0400] Zyclops: hi
[2012-07-11 10:29:37 -0400] Zyclops: i've just started reading about chef.. i'm kinda getting the idea.. if you are only going to run 3 or 4 servers
[2012-07-11 10:29:41 -0400] Zyclops: is it still worth using chef?
[2012-07-11 10:30:01 -0400] Zyclops: also i've looked through some recipies and they seem to be much older versions (i.e. postgres 8.4 isntead of postgres 9.1
[2012-07-11 10:34:06 -0400] agentgonzo: If you're going to launch them and leave them I'd say it's not worth doing. If you need repeatabality or do it regularly then I'd say use chef.
[2012-07-11 10:34:55 -0400] Adz: also, if you think you might need more servers in the future. It's quite hard to capture complex hand-built systems into configuration management later
[2012-07-11 10:35:21 -0400] lysander: so any ideas of allowing for "special" servers in a cluster, via chef ? I want one server in the cluster to have a slightly different config file for instance..
[2012-07-11 10:36:03 -0400] agentgonzo: The bit that differs between the 'special' one and the others needs splitting up.
[2012-07-11 10:36:16 -0400] agentgonzo: Separate the two things into different roles so you have foo_master and foo_cluster
[2012-07-11 10:36:43 -0400] lysander: but I don't want to care which server is the master - I just want chef to pick one. if that makes sense ?
[2012-07-11 10:37:07 -0400] lysander: if the picked server dies, chef picks another at the next run
[2012-07-11 10:37:31 -0400] agentgonzo: There is a chef 'announce' protocol to handle things like this - but I've never used it as it seemed a bit flakeys
[2012-07-11 10:41:39 -0400] lysander: can't seem to find anything about that agentgonzo
[2012-07-11 10:44:10 -0400] agentgonzo: Ah - it's not in chef itself, but in the 'silverware' cookbook
[2012-07-11 10:44:23 -0400] Adz: lysander, I have some recipes that do a search for nodes with a particular role, then do something if the name of the first host in the search matches the node name
[2012-07-11 10:45:55 -0400] lysander: mm, that is about halfway what I'm looking for :)
[2012-07-11 10:48:01 -0400] lysander: I don't think this is a unique problem however.
[2012-07-11 10:48:11 -0400] lysander: hence my asking.
[2012-07-11 10:48:40 -0400] lysander: I'd like the "job" distributed and the set server stored somewhere, maybe in a bag, and if the node no longer exists, another gets elected.
[2012-07-11 10:48:51 -0400] agentgonzo: I would have thought that failover scenario would be handled by the individual programmes rather than at the chef level
[2012-07-11 10:48:53 -0400] lysander: random election would be good enough.
[2012-07-11 10:49:05 -0400] agentgonzo: we use zookeeper for leader election
[2012-07-11 10:49:19 -0400] agentgonzo: but may be overkill if you only need a simple case
[2012-07-11 10:49:43 -0400] lysander: yeah, my cases are all simple.
[2012-07-11 10:49:56 -0400] lysander: just change the config slightly and reload the service if you get elected.
[2012-07-11 10:50:08 -0400] lysander: herp to the derp
[2012-07-11 10:57:29 -0400] zts: lysander: you're right that it's not a unique problem, but neither is it one that Chef is designed to solve - it's possible to cobble something together, but nothing exists out of the box
[2012-07-11 10:58:48 -0400] zts: lysander: one issue you'll need to deal with is that a node will still be returned in a Chef search even if it's down, so you'll need to write some code to validate whether the returned nodes are actually available
[2012-07-11 11:38:19 -0400] zoubi: I've put some log in a recipe, and I can't see it when I run chef-client on my machine. What do you think could be the reason?
[2012-07-11 11:38:48 -0400] zoubi: it's in the java cookbook, the oracle recipe
[2012-07-11 11:38:50 -0400] zoubi: I've this http://pastebin.com/Aea5WAGJ
[2012-07-11 11:39:18 -0400] zoubi: I have this log : http://pastebin.com/BNvBP1j8
[2012-07-11 11:39:30 -0400] zoubi: and of course I've set -l debug parameter of chef-client
[2012-07-11 11:40:10 -0400] BryanWB_: zoubi: can't see ur paste, pastebin thinks it is spam
[2012-07-11 11:41:01 -0400] zoubi: even when filling the captcha?
[2012-07-11 11:43:33 -0400] BryanWB_: ugh, dunno, too much work
[2012-07-11 11:44:51 -0400] zoubi: is there anything special to do to see logs?
[2012-07-11 11:46:04 -0400] ashb: zoubi: that's not the right log.
[2012-07-11 11:46:11 -0400] ashb: Chef::Log.info("foo")
[2012-07-11 11:46:46 -0400] zoubi: ashb, what about that http://wiki.opscode.com/display/chef/Resources#Resources-Log ?
[2012-07-11 11:47:11 -0400] ashb: huh new to me
[2012-07-11 11:51:48 -0400] BryanWB_: lysander: i would use the bag_config  for what u r talking about
[2012-07-11 11:51:55 -0400] BryanWB_: c the bag_config cookbook
[2012-07-11 11:55:53 -0400] zoubi: ashb, using Chef::Log.info works just fine
[2012-07-11 11:55:54 -0400] zoubi: thanks
[2012-07-11 12:01:01 -0400] lysander: thanks BryanWB_
[2012-07-11 12:02:17 -0400] BryanWB_: wish agentconzo still around, would love to ask how he is using zookeeper
[2012-07-11 12:42:02 -0400] geekbri: Is it in poor taste to access node.chef_environment from inside of a cookbooks attributes?  My gut says yes.
[2012-07-11 12:45:04 -0400] atomic-penguin: geekbri, no, why would it be?
[2012-07-11 12:46:49 -0400] geekbri: atomic-penguin: I don't know, just doesn't seem natural.
[2012-07-11 12:47:03 -0400] geekbri: atomic-penguin: But I'm doing it, so I guess I wasn't that bothered by it ;)
[2012-07-11 13:04:22 -0400] atomic-penguin: geekbri, Definitely nothing wrong about setting default attributes, based on ohai attributes.  Its kind of made for that.
[2012-07-11 13:27:01 -0400] julien_: We use the latest version of knife, but it looks like we can't get the bootstrap script to copy the encrypted_data_bag_secret. Is there any trick for that? We obviously added it to knife.rb
[2012-07-11 13:27:02 -0400] julien_: :/
[2012-07-11 13:34:47 -0400] julien_: Anyone?
[2012-07-11 13:39:48 -0400] z: are there any known problems with chef-client installed via Omnibus taking a frickin' age to do anything?
[2012-07-11 13:39:52 -0400] dumfries: julien_ what does your bootstrap script look like?
[2012-07-11 13:40:12 -0400] julien_: dumfries: we created one for our debian6 arch
[2012-07-11 13:40:15 -0400] z: I see it doing literally thousands of these:
[2012-07-11 13:40:16 -0400] z: lstat("/opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-10.12.0", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
[2012-07-11 13:40:18 -0400] julien_: should it be in there?
[2012-07-11 13:40:35 -0400] z: https://gist.github.com/3090426
[2012-07-11 13:40:44 -0400] z: ^ example of it taking 15 seconds just to run `chef-client -v`
[2012-07-11 13:40:47 -0400] dumfries: julien_ if that is how you have chosen to distribute your key (on bootstrap).
[2012-07-11 13:41:09 -0400] julien_: dumfries: ooooh, ok, let me try to add that to our bootstrap script
[2012-07-11 13:46:05 -0400] julien_: dumfries: that was exactly that! Thanks a bunch mate!
[2012-07-11 13:46:08 -0400] z: http://paste.ubuntu.com/1086184/ < seemingly why it takes 15+ seconds to do anything including display version. Any ideas how to make it behave?!
[2012-07-11 13:46:27 -0400] dumfries: julien_ no worries, least I can do while waiting at a airport ;)
[2012-07-11 13:47:35 -0400] julien_: :D
[2012-07-11 13:54:23 -0400] julien_: Also, another question: as a matter of facts, we are starting to use chef on an existing infrastructure which brings a couple questions.  For example, we use collectd. Our collected server is up and running, when setting new nodes that use collected:client, chef fails because it can't find any node that runs the server. Now, is it a problem/dangerous to try to use chef to run on an existing configuration? Would this solve our problem? 
[2012-07-11 13:54:24 -0400] julien_: should we setup a new collected server and get rid of the old one (but then it means we have to transfer all the data).
[2012-07-11 13:55:29 -0400] dumfries: julien_ could you not just bring your current configuration into Chef?
[2012-07-11 13:55:53 -0400] julien_: dumfries: I guess I could if I knew how to do so :)
[2012-07-11 13:56:48 -0400] dumfries: well if you understand your current setup it should be straight forward no?
[2012-07-11 13:57:45 -0400] julien_: dumfries: what do you mean?
[2012-07-11 13:58:18 -0400] julien_: dumfries: here's what I'd (tell me if it's crazy): "bootstrap" chef on the existing machine, apply it the collectd-serve recipe
[2012-07-11 13:58:20 -0400] dumfries: I mean if you understand how your current collectd server is setup what is stopping you from descibing that setup in a cookbook?
[2012-07-11 13:58:41 -0400] julien_: dumfries: ha, you mean creating my own cookbook. Well, I guess that would work too
[2012-07-11 13:58:44 -0400] julien_: indeed
[2012-07-11 13:59:27 -0400] dumfries: If you are looking to align your current setup to what the collectd server recipe does you may have some issues, I don't know your exact setup so I am guessing here ;)
[2012-07-11 14:00:08 -0400] julien_: dumfries: default (apt) setup
[2012-07-11 14:00:36 -0400] dumfries: julien_ which cookbook are you using for collectd?
[2012-07-11 14:00:44 -0400] julien_: but you'e right, I'll write our own cookbook, mimicking the community one, hopefully, there shouldn't be too many differences
[2012-07-11 14:00:47 -0400] julien_: community one
[2012-07-11 14:00:56 -0400] julien_: http://community.opscode.com/cookbooks/collectd
[2012-07-11 14:01:18 -0400] dumfries: sure, one sec.
[2012-07-11 14:03:42 -0400] dumfries: All that cookbook is doing is pulling in packages from the platform package provider (apt in your case) and setting up directories.
[2012-07-11 14:03:50 -0400] dumfries: setting up some conf files as well.
[2012-07-11 14:04:56 -0400] dumfries: client determines the server by looking for nodes with collectd::server in its run_list
[2012-07-11 14:07:50 -0400] vaq: Hello, I am trying to knife bootstrap a CentOS 6.2 client from a chef server located on a Debian squeeze machine. When I run the knife bootstrap command it automatically tries to bootstrap the client through apt-get. Isn't the bootstrap command supposed to detect OS?
[2012-07-11 14:09:35 -0400] yfeldblum: z, can you find out how much time is spent in Kernel#require?
[2012-07-11 14:09:43 -0400] mattray: vaq: what version of Chef are you using?
[2012-07-11 14:10:19 -0400] vaq: mattray: Chef Server (API) Version: 0.9.18 - i am using http://apt.opscode.com/ squeeze as repo.
[2012-07-11 14:10:20 -0400] mattray: the default template for before 10.12 was the apt one, 10.12 uses the chef-full by default
[2012-07-11 14:10:25 -0400] mattray: yikes
[2012-07-11 14:10:41 -0400] mattray: vaq: if you're just getting started, switch to 10.12 asap
[2012-07-11 14:11:03 -0400] vaq: mattray: will do, but how is it it installed an old version through your repo?
[2012-07-11 14:11:21 -0400] mattray: vaq: the repos changed with the 0.10 release
[2012-07-11 14:11:22 -0400] mattray: 1 sec
[2012-07-11 14:11:33 -0400] vaq: thank you
[2012-07-11 14:11:33 -0400] mattray: http://apt.opscode.com/dists/squeeze-0.10/
[2012-07-11 14:11:50 -0400] vaq: so that's the latest version?
[2012-07-11 14:11:53 -0400] mattray: yes
[2012-07-11 14:11:57 -0400] vaq: thanks.
[2012-07-11 14:16:10 -0400] z: yfeldblum: Er possibly
[2012-07-11 14:16:24 -0400] yfeldblum: z, which version of ruby?
[2012-07-11 14:16:36 -0400] z: yfeldblum: 10.12 was installed via OMnibus
[2012-07-11 14:16:39 -0400] z: yfeldblum: so whatever Opscode shipped
[2012-07-11 14:17:00 -0400] z: 'full stack' ftw
[2012-07-11 14:17:08 -0400] z: hence why all the strace output is lstat() in /opt/opscode
[2012-07-11 14:27:01 -0400] yfeldblum: z, that does seem odd
[2012-07-11 14:58:17 -0400] zoubi: anyone would know why my attributes keep desperatly their default values, despite I override them in the role? http://pastebin.com/Ezyy2JsS
[2012-07-11 15:04:36 -0400] knuckolls: is the role correctly uploaded to the server?
[2012-07-11 15:06:01 -0400] zoubi: yes
[2012-07-11 15:09:05 -0400] knuckolls: does knife node show -l | less show that the attributes are applied to the node as you'd expect?
[2012-07-11 15:09:06 -0400] zoubi: uh! I've typed knife role from file roles/socorro_complete.rb
[2012-07-11 15:09:30 -0400] zoubi: and then typed: knife node show socorro_complete
[2012-07-11 15:09:40 -0400] zoubi: but the attributes are not visible
[2012-07-11 15:10:02 -0400] knuckolls: re run the chef-client on the node if it's not a daemon
[2012-07-11 15:10:15 -0400] knuckolls: i'm not certain that will matter
[2012-07-11 15:10:44 -0400] zoubi: it does not, I've tried
[2012-07-11 15:11:51 -0400] knuckolls: hm
[2012-07-11 15:11:56 -0400] knuckolls: could be buggin'
[2012-07-11 15:12:09 -0400] yfeldblum: zoubi, in the recipe, you might try showing the merged attributes: Chef::Log.info("\n#{JSON.pretty_generate(node["socorro"].to_hash)}")
[2012-07-11 15:12:27 -0400] zoubi: I am buggin'
[2012-07-11 15:12:40 -0400] zoubi: knife ROLE from file, and not knife node from file
[2012-07-11 15:12:42 -0400] zoubi: :'(
[2012-07-11 15:14:37 -0400] arpit: I have been trying to use application cookbook for rails deployment on ec2 but getting stuck in lot of errors. If I solve one, another occurs. Readme of this cookbook contains some information about deprecated cookbooks and I guess examples are not yet changed. Is there any tutorial which I can follow for new application cookbook?
[2012-07-11 15:16:55 -0400] CharlieSu: Hi.  I'm running Chef on EC2.  This specific instance is a m1.small.  I'm using the latest version of Chef w/ the Omnibus installer.  I'm finding that the simplest chef-client command like 'chef-client -h' is taking a long time to respond.  Any thoughts?    https://gist.github.com/c2e93ab7c4409dc94c5c
[2012-07-11 15:19:12 -0400] CharlieSu: Is is even taking 15 seconds on a m1.large.  Is it just taking a long time to load Ruby?
[2012-07-11 15:21:55 -0400] yfeldblum: CharlieSu, ruby has made significant improvements to the performance of Kernel#require since 1.9.2
[2012-07-11 15:22:49 -0400] CharlieSu: yfeldblum: ok?  Are you saying I don't have those?
[2012-07-11 15:23:28 -0400] CharlieSu: /opt/chef/embedded/bin/ruby -v
[2012-07-11 15:23:29 -0400] CharlieSu: ruby 1.9.2p290 (2011-07-09 revision 32553) [i686-linux]
[2012-07-11 15:23:49 -0400] yfeldblum: CharlieSu, the chef full-stack installer, i believe, installs ruby-1.9.2, but IIRC Kernel#require was improved in ruby-1.9.3
[2012-07-11 15:24:50 -0400] CharlieSu: yfeldblum: ok i see.  Guess i'll be waiting for that
[2012-07-11 15:25:54 -0400] hoover_damm: yep
[2012-07-11 15:26:05 -0400] hoover_damm: also 1.9.3 is development 1.9.2 is stable no?
[2012-07-11 15:26:11 -0400] hoover_damm: it's been awhile since I cared enough so I can be wrong
[2012-07-11 15:26:23 -0400] knuckolls: http://www.ruby-lang.org/en/news/2012/04/20/ruby-1-9-3-p194-is-released/
[2012-07-11 15:27:14 -0400] hoover_damm: that really doesn't answer the question
[2012-07-11 15:27:23 -0400] knuckolls: yeah i was overzealous posting that link
[2012-07-11 15:27:33 -0400] knuckolls: i'm pretty sure it's stable
[2012-07-11 15:27:34 -0400] hoover_damm: CharlieSu, fwiw you can update omnibus-software to use 1.9.3
[2012-07-11 15:27:35 -0400] CharlieSu: Another question.  Can chef-solo be used with a chef server?  I don't want to have to package up my cookbooks.  I'd like to have my server run the normal chef-client every 30 minutes for my base recipe, but I've got another recipe I want to run very often that I want to run under chef-solo so that I can havef it run frequently without affecting the runlist of the server..
[2012-07-11 15:27:40 -0400] hoover_damm: you'll need to add libyaml
[2012-07-11 15:27:43 -0400] hoover_damm: it should work
[2012-07-11 15:27:46 -0400] hoover_damm: i use full-stack with 1.9.3
[2012-07-11 15:27:48 -0400] hoover_damm: but my fork is old
[2012-07-11 15:27:56 -0400] CharlieSu: hoover_damm: i'll wait until it is official
[2012-07-11 15:30:34 -0400] yfeldblum: hoover_damm, i do not believe that ruby uses that type of odd-unstable/even-stable system
[2012-07-11 15:30:34 -0400] CharlieSu: hoover_damm: Understand..  :)
[2012-07-11 15:30:39 -0400] jperry2: anyone know of any good plugins to vim for chef?
[2012-07-11 15:30:52 -0400] jperry2: looking for code snippets when I'm in chef
[2012-07-11 15:30:59 -0400] hoover_damm: yfeldblum, perhaps this question is better suited for -hacking
[2012-07-11 15:31:08 -0400] jperry2: for example if I type cookbook_file it should give me a snippet
[2012-07-11 15:31:39 -0400] knuckolls: hoover_damm: http://www.ruby-lang.org/en/downloads/
[2012-07-11 15:31:44 -0400] knuckolls: The current stable version is 1.9.3.
[2012-07-11 15:33:37 -0400] jtimberman: jperry2: ruby.vim? :)
[2012-07-11 15:33:53 -0400] jtimberman: jperry2: i'm not aware of any snippet stuff specifically for chef.
[2012-07-11 15:35:50 -0400] hoover_damm: https://github.com/cookbooks/hw-chef-emacs-starter-kit
[2012-07-11 15:36:08 -0400] hoover_damm: not really tailored for chef
[2012-07-11 15:36:10 -0400] hoover_damm: but has ruby-mode
[2012-07-11 15:36:11 -0400] hoover_damm: so it's a win
[2012-07-11 15:36:36 -0400] vaq: knife bootstrap IP -i /root/.ssh/id_rsa returns: ERROR: ArgumentError: invalid option(s): keys_only
[2012-07-11 15:37:14 -0400] vaq: am I missing something?
[2012-07-11 15:38:05 -0400] arpit: How can the default recipe be deprecated in application cookbook(https://github.com/opscode-cookbooks/application)?  Doesn't the default recipe run before any other if I include recipe[application]?
[2012-07-11 15:38:26 -0400] knuckolls: vaq: is that the entire bootstrap command you're running?
[2012-07-11 15:38:54 -0400] vaq: knuckolls: knife bootstrap xxxxxxx -u root -i /root/.ssh/id_rsa -c /etc/chef/client.rb -N xxxxx
[2012-07-11 15:39:39 -0400] jtimberman: arpit: with the new LWRPs, you don't use the recipe at all.
[2012-07-11 15:39:52 -0400] jtimberman: arpit: you write "application resources" in your own recipes for standing up your app stack
[2012-07-11 15:40:03 -0400] knuckolls: vaq: i think you mean to use -x instead of -u
[2012-07-11 15:40:13 -0400] knuckolls: could be wrong
[2012-07-11 15:40:36 -0400] vaq: same error.
[2012-07-11 15:40:44 -0400] knuckolls: permissions are correct on id_rsa?
[2012-07-11 15:40:56 -0400] vaq: Indeed it is.
[2012-07-11 15:41:07 -0400] jperry2: yeah I have ruby vim
[2012-07-11 15:41:14 -0400] arpit: jtimberman I have been trying to figure it out from docs since last couple of days and tried few tutorials also but all points to some deprecated recipes. Any tutorial which uses LWRPs and deploys rails stack?
[2012-07-11 15:41:15 -0400] lflux: jtimberman: where's more info on these new LWRPs
[2012-07-11 15:41:18 -0400] jperry2: I'm looking more for chef snippets in chef but I haven't found anything
[2012-07-11 15:41:24 -0400] mattray: vaq: try "knife bootstrap xxxxxxx -VV -i /root/.ssh/id_rsa -N xxxxx"
[2012-07-11 15:41:27 -0400] jperry2: I amy create something for this
[2012-07-11 15:41:31 -0400] jperry2: when it is ready I'll let folks konw
[2012-07-11 15:41:31 -0400] jtimberman: arpit: i don't think there's any tutorials yet.
[2012-07-11 15:41:32 -0400] jperry2: know
[2012-07-11 15:41:48 -0400] jtimberman: lflux: in the readmes of the respective cookbooks (application, application_ruby, etc)
[2012-07-11 15:41:54 -0400] mattray: vaq: the root user is default, as is /etc/chef/client.rb
[2012-07-11 15:42:03 -0400] mattray: vaq: and -VV will add debugging
[2012-07-11 15:42:11 -0400] vaq: mattray: /usr/lib/ruby/1.8/net/ssh.rb:155:in `start': invalid option(s): keys_only (ArgumentError)
[2012-07-11 15:42:25 -0400] mattray: vaq: that's it?
[2012-07-11 15:42:30 -0400] mattray: vaq: what version of chef?
[2012-07-11 15:42:43 -0400] vaq: 10.12.0
[2012-07-11 15:42:44 -0400] arpit: jtimberman: Will try to follow again from README then and will let you know. Thanks.
[2012-07-11 15:42:50 -0400] vaq: mattray: i'll pastebin, once sec.
[2012-07-11 15:42:57 -0400] mattray: with the -VV please
[2012-07-11 15:43:11 -0400] vaq: mattray: http://pastebin.ca/2169716
[2012-07-11 15:43:14 -0400] vaq: that's pastebin from -VV
[2012-07-11 15:43:51 -0400] lflux: jtimberman: ah, thanks
[2012-07-11 15:43:56 -0400] vaq: hmm
[2012-07-11 15:43:57 -0400] mattray: vaq: knife -v
[2012-07-11 15:44:06 -0400] vaq: mattray: without -i it runs without any issues
[2012-07-11 15:44:08 -0400] vaq: even uses the key
[2012-07-11 15:44:18 -0400] mattray: well, that is the default key
[2012-07-11 15:45:00 -0400] mattray: I think -i wasn't the key for 0.9, that's why I'm wondering about the version
[2012-07-11 15:45:41 -0400] zoubi: is it possible to use cookbook_file (or any other chef resource) to copy a set of folders (and files) to a location on the machine recursively?
[2012-07-11 15:45:59 -0400] jtimberman: zoubi: no
[2012-07-11 15:46:06 -0400] jtimberman: zoubi: cookbook_file comes from the cookbook as the source
[2012-07-11 15:46:23 -0400] jtimberman: the only resource that "does a copy" is file with content
[2012-07-11 15:46:50 -0400] zoubi: I don't think you did understand me
[2012-07-11 15:46:50 -0400] jtimberman: file("/target/file") { content IO.read("/source/file") }
[2012-07-11 15:47:06 -0400] jtimberman: but you could use a symlink
[2012-07-11 15:47:10 -0400] jtimberman: with the link resource
[2012-07-11 15:47:15 -0400] jtimberman: rather than copying, which will take longer :)
[2012-07-11 15:47:20 -0400] zoubi: in my cookbook files directory, I have a set of files I'd like to copy, say, in /tmp
[2012-07-11 15:48:01 -0400] zoubi: instead of adding one cookbook_file entry in my recipe for each of the files which need to be copied, I'd like to tell cookbook_file to take all the files in the files folder of the cookbook, and copy them in /tmp
[2012-07-11 15:48:06 -0400] vaq: mattray: works, thank you.
[2012-07-11 15:48:59 -0400] vaq: Is the right method for keeping a configuration file in sync between a client and a server a cookbook template?
[2012-07-11 15:49:09 -0400] jtimberman: zoubi: you can use the remote_directory resource to copy files out of a directory in the cookbook.
[2012-07-11 15:49:37 -0400] jtimberman: gotta run
[2012-07-11 15:50:00 -0400] zoubi: jtimberman, oh thanks, I didn't see this resource before
[2012-07-11 15:58:44 -0400] vaq: I just tried to run a simple ntp cookbook on a node.. it seems to fail with a stacktrace: http://pastebin.ca/2169719
[2012-07-11 16:00:12 -0400] lflux: I seem to have run into a situation where a service is notified in this order: restart, reload immediately. The service is only reloaded instead of restarted.
[2012-07-11 16:00:23 -0400] jeffg: what's the prevailing phone-home interval for chef clients?
[2012-07-11 16:00:40 -0400] lflux: shouldn't it restart instead?
[2012-07-11 16:00:42 -0400] mattray: jeffg: 30 minutes is the default in the chef-client cookbook
[2012-07-11 16:00:57 -0400] lflux: or does chef equate reload with restart?
[2012-07-11 16:01:29 -0400] jeffg: mattray, thanks
[2012-07-11 16:05:51 -0400] jameson: jtimberman: do you know if remote_file can tell if the remote file is different from the local copy (and so it should be downloaded)
[2012-07-11 16:06:06 -0400] jameson: lflux: I believe the reload command depends on the service itself
[2012-07-11 16:06:33 -0400] vaq: I just tried to run a simple ntp cookbook on a node.. it seems to fail with a stacktrace: http://pastebin.ca/2169719 - FATAL: TypeError: can't convert Symbol into Integer
[2012-07-11 16:06:40 -0400] jameson: some services equate reload to a restart, some have internal interfaces to update configurations without restarting the entire process
[2012-07-11 16:07:41 -0400] lflux: jameson: no, as in no restart is fired
[2012-07-11 16:07:56 -0400] lflux: reload and restart are different for postgres.
[2012-07-11 16:08:15 -0400] knuckolls: vaq: i ran into this yesterday and it was a problem with the name i used for my attribute. it was conflicting with an existing attribute. what is your attribute name?
[2012-07-11 16:08:43 -0400] vaq: knuckolls: role[ntp]
[2012-07-11 16:08:44 -0400] lflux: one file notifies a restart, another notifies a reload immediately.
[2012-07-11 16:09:07 -0400] knuckolls: vaq: default.rb:19 what's on that line? does it use an attribute?
[2012-07-11 16:09:07 -0400] lflux: only reload is fired. However, if I switch restart to immediately it fires as well.
[2012-07-11 16:09:38 -0400] vaq: knuckolls:   action[:enable,:start]
[2012-07-11 16:09:44 -0400] knuckolls: hm
[2012-07-11 16:10:37 -0400] vaq: knuckolls: http://pastebin.ca/2169722
[2012-07-11 16:12:21 -0400] knuckolls: vaq: nothing pops out at me
[2012-07-11 16:12:37 -0400] knuckolls: vaq: it's likely something to do with the variable and the template
[2012-07-11 16:13:19 -0400] jameson: lflux: does the logs show that a restart was queued?
[2012-07-11 16:13:43 -0400] vaq: knuckolls: I thought that, but when I eliminate the variable, I get the same error.
[2012-07-11 16:14:08 -0400] knuckolls: pastebin the template?
[2012-07-11 16:14:28 -0400] lflux: jameson: if I was smart I wouldn't have cleared the terminal window with that run...
[2012-07-11 16:14:48 -0400] jameson: :3
[2012-07-11 16:15:29 -0400] jameson: vaq: which ntp cookbook are you using?
[2012-07-11 16:15:44 -0400] vaq: knuckolls: http://pastebin.ca/2169724
[2012-07-11 16:16:18 -0400] vaq: jameson: I created my own using an example.
[2012-07-11 16:16:23 -0400] knuckolls: vaq: sorry i'm stumped. perhaps someone else has a good idea
[2012-07-11 16:17:17 -0400] jameson: vaq: are you on vagrant? ec2?
[2012-07-11 16:17:21 -0400] jameson: and the recipe itself?
[2012-07-11 16:17:42 -0400] jameson: because it different from ntp, can't know what you are doing before/during line 19 that is making it fail
[2012-07-11 16:17:48 -0400] vaq: jameson: no, client is centos 6.2, server is debian 6
[2012-07-11 16:18:00 -0400] vaq: I'll show you the recipe
[2012-07-11 16:18:51 -0400] vaq: jameson: http://pastebin.ca/2169727
[2012-07-11 16:19:07 -0400] lflux: jameson: nope, shows no notification.
[2012-07-11 16:22:44 -0400] vaq: jameson: am I doing something wrong?
[2012-07-11 16:45:56 -0400] dmerrick: is it possible to use the identity_attr (aka the resource "name") inside a resource block?
[2012-07-11 16:46:10 -0400] dmerrick: like if i have
[2012-07-11 16:46:11 -0400] dmerrick: cookbook_file "/tmp/testfile" doend
[2012-07-11 16:46:29 -0400] dmerrick: can i access "/tmp/testfile" inside the block via a variable?
[2012-07-11 16:49:26 -0400] yfeldblum: dmerrick, yes, https://github.com/opscode/chef/blob/master/chef/lib/chef/resource.rb#L319-324
[2012-07-11 16:49:44 -0400] yfeldblum: dmerrick, cookbook_file("/tmp/testfile") { Chef::Log.info(name) }
[2012-07-11 17:06:33 -0400] jameson: vaq: is there a
[2012-07-11 17:06:40 -0400] jameson: vaq: /etc/init.d/ntpd ?
[2012-07-11 17:08:26 -0400] vaq: jameson: I downloaded the ntp cookbook from opscode
[2012-07-11 17:08:31 -0400] vaq: anyway I have one more question
[2012-07-11 17:08:58 -0400] vaq: if a template file is updated at the chef server, will it automatically get pushed to the client later?
[2012-07-11 17:10:00 -0400] jameson: if there is a client daemon running
[2012-07-11 17:10:04 -0400] jameson: it will notice the change and update it
[2012-07-11 17:10:41 -0400] vaq: jameson: will a knife bootstrap initialize a daemon setup?
[2012-07-11 17:13:01 -0400] dmerrick: @yfeldblum thanks!
[2012-07-11 17:14:12 -0400] vaq: I started chef_client with -d running as a daemon now
[2012-07-11 17:14:27 -0400] vaq: is it normal that it has a high cpu load?  772610 root      20   0  199m  30m 3020 S 71.5  0.1   1:27.50 chef-client
[2012-07-11 17:14:37 -0400] vaq: 71%
[2012-07-11 17:15:56 -0400] vaq: doesn't seem to stabilize
[2012-07-11 17:18:56 -0400] jameson: vaq: it should
[2012-07-11 17:19:11 -0400] jameson: vaq: that seems awfully high..
[2012-07-11 17:19:53 -0400] jameson: so service ntpd is failing, probably because the service doesn't exist
[2012-07-11 17:20:22 -0400] vaq: indeed it does, /etc/init.d/ntpd is  there
[2012-07-11 17:20:38 -0400] vaq: I started the client with: chef-client -i 3600 -s 600 -d
[2012-07-11 17:20:45 -0400] vaq: still loading high
[2012-07-11 17:21:06 -0400] vaq: will try to start it with a log file append
[2012-07-11 17:21:07 -0400] jameson: the chef-client daemon just goes to sleep after it runs
[2012-07-11 17:21:31 -0400] jameson: so it will have a high load initially, but it wont stay like that (shouldn't)
[2012-07-11 17:23:13 -0400] jameson: lflux: so there is never a message about "queuing a service :restart" message in the logs?
[2012-07-11 17:23:27 -0400] vaq: jameson: 68%, doesn't go below that
[2012-07-11 17:24:01 -0400] vaq: ohh it just crashed
[2012-07-11 17:24:19 -0400] jameson: :|
[2012-07-11 17:24:51 -0400] vaq: jameson: http://pastebin.ca/2169746
[2012-07-11 17:24:57 -0400] vaq: I guess today is not my lucky day
[2012-07-11 17:26:24 -0400] jameson: so it doesn't seem like the right way
[2012-07-11 17:26:41 -0400] jameson: btw, instead of writing your own, try using the ntp cookbook provided by opscode
[2012-07-11 17:26:53 -0400] vaq: jameson: I did that
[2012-07-11 17:27:02 -0400] jameson: and that's what it just spat out?
[2012-07-11 17:27:36 -0400] vaq: jameson: Nope everything worked just fine, until I daemonized
[2012-07-11 17:27:44 -0400] vaq: I was able to bootstrap ntp without any issues
[2012-07-11 17:28:33 -0400] jameson: vaq: use the chef-client recipe
[2012-07-11 17:28:36 -0400] jameson: to daemonize
[2012-07-11 17:30:38 -0400] vaq: hmm ok
[2012-07-11 17:33:07 -0400] vaq: but
[2012-07-11 17:33:25 -0400] vaq: how would that impact the cpu load, I mean why shouldn't I be able to run the daemon that way
[2012-07-11 17:39:20 -0400] lflux: jameson: http://tickets.opscode.com/browse/COOK-1437
[2012-07-11 17:40:11 -0400] lflux: nothing about queueing in the logs, but the problem was I had services further down the run that depended on the configuration change that failed, thus the whole run failed.
[2012-07-11 17:40:41 -0400] lflux: therefore, https://github.com/opscode-cookbooks/postgresql/pull/6/files
[2012-07-11 17:41:43 -0400] vaq: jameson: I bootstraped my server using the client from http://community.opscode.com/cookbooks/chef-client
[2012-07-11 17:41:57 -0400] vaq: jameson: running as daemon now, through init. Still 70% cpu load
[2012-07-11 17:44:07 -0400] yfeldblum: lflux, don't see how that would change anything
[2012-07-11 17:45:27 -0400] vaq: root      813996 67.8  0.0 201612 29028 ?        Sl   18:45   0:11 /opt/chef/embedded/bin/ruby /usr/bin/chef-client -d -c /etc/chef/client.rb -L /var/log/chef/client.log -P /var/run/chef/client.pid -i 1800 -s 20
[2012-07-11 17:45:54 -0400] lflux: yfeldblum: it does.
[2012-07-11 17:46:27 -0400] vaq: what could cause a high cpu load on a chef client?
[2012-07-11 17:47:28 -0400] lflux: that patch fixes a very real problem for me: stock postgresql.conf in 8.4.4-PGDG rpm doesn't listen on external ip, and I have services in my run list that fail if they can't talk to pg's external IP. Templated postgresql.conf isn't picked up until postgres restarts, which doesn't happen since the services that need Pg fail the whole run.
[2012-07-11 17:48:07 -0400] lflux: yfeldblum: therefore, enable service, template out postgresql.conf, start postgres.
[2012-07-11 17:48:47 -0400] lflux: that should possibly be a restart :immediately now that I think of it.
[2012-07-11 17:50:04 -0400] yfeldblum: lflux, why not move the entire service resource to after the template resource?
[2012-07-11 17:50:34 -0400] lflux: yfeldblum: the service needs to be defined before the template so the template can restart it.
[2012-07-11 17:50:45 -0400] yfeldblum: lflux, that just seems like it should reopen the first service resource and change its action attribute
[2012-07-11 17:51:19 -0400] yfeldblum: lflux, `notifies :restart, "service[postgresql]"` should do the trick with the service resource declared after the template resource
[2012-07-11 17:51:23 -0400] Bonkers: I did: knife ec2 server create ...; knife ec2 server delete ...; Now the node and client still exist, how do I recreate the server? if I do the same knife server create again, I get a 'client already exists' error
[2012-07-11 17:51:35 -0400] yfeldblum: lflux, that's the resource query language
[2012-07-11 17:52:30 -0400] lflux: yfeldblum: hmm, lemme try that instead.
[2012-07-11 17:53:04 -0400] mhalligan: I'm provisioning nodes in virtualbox by bringing up clones of an image then having a script which rms /etc/chef/client and /var/cache/chef/cookbooks/* so that it registers cleanly as a new node in chef. I realize this is stupid as it makes provisioning take many minutes. Any suggestions for a better way of doing this? my image is already "caught up" before I provision it so I feel like there must be an easy way to make this 
[2012-07-11 17:53:04 -0400] mhalligan: 10-second process rather than having chef re-downlaod every object on the initial run
[2012-07-11 18:00:22 -0400] Bonkers: should I not be reusing clients?
[2012-07-11 18:07:44 -0400] knuckolls: Bonkers: i think the newest knife-ec2 knife plugin has a --purge option
[2012-07-11 18:07:49 -0400] knuckolls: to clean up the node and client objects
[2012-07-11 18:08:05 -0400] knuckolls: without it, i've always had to delete the instance, the generated client, and the node
[2012-07-11 18:08:16 -0400] knuckolls: before re-building the instance with the same node name
[2012-07-11 18:09:13 -0400] Bonkers: I did see purge
[2012-07-11 18:09:21 -0400] Bonkers: there's no way to reuse the node data?
[2012-07-11 18:09:30 -0400] Bonkers: is that fundamentally wrong because it tracks the provisioned state?
[2012-07-11 18:10:42 -0400] lflux: yfeldblum: technically that works, but only if the service is started. I reverted to just restarting immediately anyway.
[2012-07-11 18:10:50 -0400] lflux: (instead of the fancy stuff I was doing)
[2012-07-11 18:11:50 -0400] yfeldblum: lflux, that will restart postgresql on every run
[2012-07-11 18:11:55 -0400] miah: moin
[2012-07-11 18:12:02 -0400] lflux: only if the template changes
[2012-07-11 18:12:27 -0400] lflux: er, the contents of the templated file change
[2012-07-11 18:13:06 -0400] yfeldblum: lflux, it will restart postgresql on every run on redhat
[2012-07-11 18:13:07 -0400] lflux: only diff was adding :immediately so it's just changing when in the run postgres is restarted
[2012-07-11 18:13:37 -0400] lflux: er, really?
[2012-07-11 18:14:09 -0400] yfeldblum: lflux, ya
[2012-07-11 18:14:48 -0400] lflux: oh yeah now I see it
[2012-07-11 18:14:49 -0400] lflux: ugh
[2012-07-11 18:15:02 -0400] yfeldblum: lflux, the general pattern is: package -> template -> service, in that order
[2012-07-11 18:16:16 -0400] lflux: there, fixed tha typo.
[2012-07-11 18:16:40 -0400] lflux: now it won't restart every run :)
[2012-07-11 18:16:57 -0400] yfeldblum: lflux, unless you've got a timestamp or something in the template :P
[2012-07-11 18:17:19 -0400] lflux: I don't :)
[2012-07-11 18:17:52 -0400] lflux: yfeldblum: you're probably right about that, however I'm not going to muck around with that right now as I'm patching Other People's Code.
[2012-07-11 18:23:18 -0400] gondoi: does anyone know how I can do something like if node[:chef][:version] < "0.10.10" in a recipe?
[2012-07-11 18:23:55 -0400] spox: if(Gem::Version.new(Chef::VERSION) < Gem::Version.new('0.10.10'))
[2012-07-11 18:30:30 -0400] jhulten: gondoi: You can't compare the string, but you can split the string into major, minor, patch and compare those after converting to integers.
[2012-07-11 18:31:26 -0400] gondoi: i just found version constraint can I do something like a = Chef::VersionConstraint.new(node[:chef][:version]) b = "0.10.10" if a > b
[2012-07-11 18:33:47 -0400] jhulten: Ah. Nice. I didn't know about that.
[2012-07-11 18:35:38 -0400] gondoi: hmm well not sure it works like I expect....
[2012-07-11 18:35:41 -0400] gondoi: but i hope I can use it
[2012-07-11 18:36:01 -0400] gondoi: jtimberman: do you know if I can do something like that?
[2012-07-11 18:37:00 -0400] reset: jtimberman: I heard you were looking for me to rebase pull#1 on MySQL's cookbook. Any news on this? https://github.com/opscode-cookbooks/mysql/pull/1
[2012-07-11 18:38:24 -0400] gondoi: this looks interesting
[2012-07-11 18:38:26 -0400] gondoi: >> Chef::Version.new("0.10.10") > Chef::Version.new("10.12.0")
[2012-07-11 18:38:27 -0400] gondoi: => false
[2012-07-11 18:38:28 -0400] gondoi: >> Chef::Version.new("0.10.10") < Chef::Version.new("10.12.0")
[2012-07-11 18:38:28 -0400] gondoi: => true
[2012-07-11 18:55:38 -0400] cooper: hello chefs.
[2012-07-11 18:55:39 -0400] cooper: ca
[2012-07-11 18:55:42 -0400] cooper: oops.
[2012-07-11 18:55:43 -0400] cooper: ca
[2012-07-11 18:56:04 -0400] cooper: can someone tell me how to use a role inside a recipe?
[2012-07-11 18:56:58 -0400] cooper: so like, if role == webserver then install this package or use this template?
[2012-07-11 18:57:13 -0400] qhartman: I have templates that I need to feed a different set of instance variables depending on the circumstances of the run. I have the variables being put into a hash, and then I'm giving the hash to the template provider on the "variables" line, but it's not working. Any suggestions as how to approach this?
[2012-07-11 18:58:05 -0400] qhartman: I'm just doing "variables my_hash" in the template block. Do I need to wrap the hash somehow?
[2012-07-11 18:58:16 -0400] qhartman: Oh I might have just answered my own question....
[2012-07-11 18:59:30 -0400] cooper: never mindfound it, once again, in the wiki...Recipes#Recipes-Search
[2012-07-11 19:00:41 -0400] qhartman: hm, nope, still getting "NoMethodError: undefined method `my_hash' for Chef::Resource::Template". Is this a scope issue?
[2012-07-11 19:01:46 -0400] c_t: try variables :my_hash => my_hash
[2012-07-11 19:01:53 -0400] jhulten: cooper: Why wouldn't you make that something in the runlist? Or an attribute in the role? You can do what you are asking, I am just wondering.
[2012-07-11 19:02:01 -0400] qhartman: c_t, thanks, I'll try that
[2012-07-11 19:02:14 -0400] jhulten: cooper: You can node.role?("my_role")
[2012-07-11 19:03:19 -0400] cooper: jhulten: dunnoi was trying to create a cookbook that does things for one rolethen decided to make that cookbook do all the things for all the rolesjust have logic in the recipe looking for which role this node is in. make sense?
[2012-07-11 19:03:58 -0400] jhulten: cooper: what is this for and how many different paths are there?
[2012-07-11 19:04:04 -0400] cooper: jhulten: which is more appraisewhat you posted or 'search(:node, "attribute:value")'
[2012-07-11 19:04:20 -0400] cooper: what do you mean by paths?
[2012-07-11 19:04:26 -0400] jhulten: cooper: search will go back to the server. node uses the local object.
[2012-07-11 19:04:42 -0400] jhulten: how many roles do you need to cover in one cookbooks?
[2012-07-11 19:05:01 -0400] qhartman: c_t, looks promising, chef-client run isn't immediately bailing anymore
[2012-07-11 19:05:05 -0400] cooper: jhulten: helpful! :) 3 or 4 roles
[2012-07-11 19:05:19 -0400] c_t: qhartman: it compiles, ship it!
[2012-07-11 19:06:42 -0400] linTest: trying to install a windows package on a windows node; getting a fatal NameError: Cannot find a resource for windows_package
[2012-07-11 19:07:14 -0400] linTest: I've uploads the windows cookbook and the chef_handler cookbook to the chef-server
[2012-07-11 19:08:00 -0400] jhulten: cooper: you might consider a foo::common recipe that is called by foo::role1 or foo::role2. keeps the decision logic in the run list where it is visible in three months when you have forgotten what you did...
[2012-07-11 19:09:32 -0400] cooper: jhulten: ah. makes sense. i forgot more as time goes by :(
[2012-07-11 19:10:16 -0400] jperry2: If I want to store an internal rpm version number in an attribute what would be a sensible default?
[2012-07-11 19:10:33 -0400] jperry2: if its not set it will just be nil and will pull down latest right?
[2012-07-11 19:11:10 -0400] jhulten: I tend towards the highest visibility I can in my cookbooks because I have had to disect them late at night.
[2012-07-11 19:12:32 -0400] cooper: jhulten: i can learn from your pain. ;) thanks. :)
[2012-07-11 19:15:30 -0400] linTest: trying to install a windows package on a windows node; getting a fatal NameError: Cannot find a resource for windows_package
[2012-07-11 19:15:36 -0400] danclien: linTest: did you update your cookbook's metadata.rb file  with a: depends "windows"?
[2012-07-11 19:16:11 -0400] linTest: danclien: no, I didn't know I needed to do that, thx!
[2012-07-11 19:17:20 -0400] danclien: linTest: more info available here: http://wiki.opscode.com/display/chef/Metadata#Metadata-depends
[2012-07-11 19:32:10 -0400] Bonkers: I put default_attributes("nginx" => {"version" => "1.2.2"}) in a role and added the role to the run_list for a node, but the nginx::source recipe still doesn't see the attribute, why?
[2012-07-11 19:35:57 -0400] Bonkers: is this generally the right strategy?
[2012-07-11 19:40:46 -0400] danclien: Bonkers: looks right. did you verify the attributes on the role using knife?
[2012-07-11 19:41:39 -0400] jhulten: Bonkers: Do you have more than one default_attributes statement in the role?
[2012-07-11 19:41:48 -0400] Bonkers: danclien, yes, tried default and override, they show with knife role show and on the opscode website
[2012-07-11 19:41:54 -0400] Bonkers: nope, only one statement
[2012-07-11 19:42:43 -0400] jhulten: Bonkers: how are you accessing the attrib in the recipie?
[2012-07-11 19:42:46 -0400] Bonkers: and the role is getting picked up, because nginx::source is only in the run_list for this role and it's definitely trying to run, but erroring
[2012-07-11 19:42:59 -0400] Bonkers: it's not my recipe, but node[:nginx][:version]
[2012-07-11 19:43:08 -0400] Bonkers: actually, node['nginx']['version']
[2012-07-11 19:44:14 -0400] Bonkers: it doesn't show up on the node on the opscode site, but I assume that's because the run never finished and it updates that after the run
[2012-07-11 19:45:39 -0400] Bonkers: hmm, something very strange is going on
[2012-07-11 19:45:49 -0400] Bonkers: the attribute is getting there
[2012-07-11 19:46:25 -0400] danclien: Bonkers: what's the run_list for your node?
[2012-07-11 19:46:57 -0400] Bonkers: ok, I figured out step #1 of the problem
[2012-07-11 19:47:48 -0400] Bonkers: well this is a bit of an obnoxious recipe
[2012-07-11 19:48:27 -0400] Bonkers: is there a way to dump all attributes as they would be generated in the next run?
[2012-07-11 19:49:00 -0400] amishgeek_: i seem to be locked out of my admin account in chef webui, how do i reset the admin password?
[2012-07-11 19:49:01 -0400] Bonkers: is there debug or pretend run for chef-client?
[2012-07-11 19:49:30 -0400] jtimberman: Bonkers: the beta for 10.14 includes "why-run" mode which is a dry-run implementation we're going to ship in the next release.
[2012-07-11 19:50:29 -0400] jperry2: so I have an override attribute set on a role and it's not being used
[2012-07-11 19:50:40 -0400] jperry2: when I use that role
[2012-07-11 19:51:13 -0400] Bonkers: jtimberman, that seems useful, should I just continue with puts debugging for now?
[2012-07-11 19:51:37 -0400] jperry2: nm
[2012-07-11 20:05:57 -0400] cg: amishgeek_: try this  https://github.com/mvam75/chef_ui_passwd_change/blob/master/chef_webui_password.rb
[2012-07-11 20:08:31 -0400] amishgeek_: thanks, that worked the set_password.rb file i had found/made wasn't working
[2012-07-11 20:08:41 -0400] amishgeek_: this one looks different (the one i found was from 2010)
[2012-07-11 20:21:00 -0400] cg: amishgeek_: np, glad it worked
[2012-07-11 20:21:20 -0400] barefoot: is "search(:node, 'recipe:something*') valid? the search examples show wildcards but not with the recipe keyword
[2012-07-11 20:28:45 -0400] masterkorp: http://farm4.staticflickr.com/3654/3689411471_1996f03a2a_b.jpg
[2012-07-11 20:28:48 -0400] masterkorp: ooops
[2012-07-11 20:34:15 -0400] hoover_damm: masterkorp, you do that every day and you say oops every day
[2012-07-11 20:34:18 -0400] hoover_damm: is it truly oops?
[2012-07-11 20:34:48 -0400] masterkorp: why would i paste that in here then ?
[2012-07-11 20:34:59 -0400] masterkorp: my connection is lagging
[2012-07-11 20:35:44 -0400] cg: its a nice looking bike though
[2012-07-11 20:37:05 -0400] hoover_damm: masterkorp, okay reviewing my irclogs it's really only the 4th picture you pasted and 2nd oops
[2012-07-11 20:37:11 -0400] hoover_damm: sorry :/
[2012-07-11 20:37:24 -0400] masterkorp: hoover_damm: no sorry me
[2012-07-11 20:37:32 -0400] masterkorp: but just in case
[2012-07-11 20:37:36 -0400] masterkorp: that is my bike
[2012-07-11 20:37:41 -0400] masterkorp: nice commuter
[2012-07-11 20:48:21 -0400] hoover_damm: masterkorp, yes it's a nice bike :)
[2012-07-11 21:18:49 -0400] jelder: quick question about using tags
[2012-07-11 21:19:22 -0400] miah: ask questions, not permission to ask them.
[2012-07-11 21:20:01 -0400] yfeldblum: jelder, seems to be taking quite a while to type that question; u sure it's quick?
[2012-07-11 21:20:24 -0400] jelder: i added "mongo_backup_runner" to the tags list on one of my nodes, and i don't see how to search for it
[2012-07-11 21:20:25 -0400] jelder: i added "mongo_backup_runner" to the tags list
[2012-07-11 21:20:36 -0400] jelder: knife search node "tags:mongo_backup_runner"
[2012-07-11 21:20:40 -0400] jelder: returns nothing
[2012-07-11 21:21:18 -0400] yfeldblum: jelder, that's right; u sure it's added? - try `knife node show NODE -a tags`
[2012-07-11 21:21:33 -0400] Guest97663: hi, we're not getting any results when searching for windows nodes by name. we don't have any issues with any linux nodes we register with the chef server.  the odd thing is we see the windows nodes when running knife node list. Anyone seen this before?
[2012-07-11 21:23:26 -0400] jelder: yfeldblum: yes
[2012-07-11 21:25:31 -0400] jelder: yfeldblum: my tags are visible from "knife node show NODE -a tags" but not from "tags:"
[2012-07-11 21:26:28 -0400] jelder: hmm, looks like it juts took opscode a while to catch up
[2012-07-11 21:26:35 -0400] jelder: it's visible now with the same command
[2012-07-11 21:27:14 -0400] miah: iirc, its 'tag' not 'tags'
[2012-07-11 21:27:36 -0400] miah: 'knife search node 'tag:foo'
[2012-07-11 21:27:52 -0400] jelder: tags: is now working
[2012-07-11 21:27:53 -0400] jelder: dunno
[2012-07-11 21:27:56 -0400] yfeldblum: jelder, it's definitely "tags" - i use tags all the time, including searching
[2012-07-11 21:28:05 -0400] yfeldblum: ^ to miah as well
[2012-07-11 21:28:28 -0400] miah: http://wiki.opscode.com/display/chef/Recipes#Recipes-Tags
[2012-07-11 21:28:35 -0400] yfeldblum: jelder, indexing can indeed take some time; searches are always conducted against the index, never against the primary data store
[2012-07-11 21:28:52 -0400] jelder: just have to be more patient
[2012-07-11 21:29:00 -0400] miah: =) or speed up your indexer
[2012-07-11 21:29:20 -0400] jelder: miah: i'm a paying customer, all i can do for now :)
[2012-07-11 21:30:01 -0400] miah: ah i see
[2012-07-11 21:31:54 -0400] yfeldblum: jelder, the best way to speed up the indexer is to keep sending more updates at it as fast as you can - just like you're supposed to keep refreshing the page when the site's down due to ddos
[2012-07-11 21:32:11 -0400] jelder: great advice
[2012-07-11 21:33:18 -0400] jelder: i'm sure opscode's solr instances are tuned for search, not latency
[2012-07-11 21:34:48 -0400] jtimberman: yfeldblum: :P
[2012-07-11 21:35:18 -0400] jtimberman: jelder: yeah, so, there can be a delay, up to a couple minutes, i think. i don't know the exact time frame we say is "reasonable" for indexes on OHC to get updated, though.
[2012-07-11 21:36:24 -0400] flaccid_: anyone ran into Application light-weight resource already initialized -- overriding! with the application cookbook? i'm trying to work out why its occuring
[2012-07-11 21:37:07 -0400] yfeldblum: flaccid_, because you probably declared to application resources with the same name
[2012-07-11 21:38:02 -0400] yfeldblum: jelder, the solr instances are one thing; the indexer is a separate process, and runs off a message queue, so it may take some time for the indexer to get the message and add the data to the solr index
[2012-07-11 21:38:24 -0400] jelder: ah
[2012-07-11 21:39:20 -0400] flaccid_: yfeldblum: only 1 recipe is run which is only declaring 1 applcation resource
[2012-07-11 21:48:46 -0400] flaccid_: yfeldblum: or did i pebkac something? https://github.com/flaccid/cookbooks/blob/master/cookbooks/mediawiki_application/recipes/application.rb#L18
[2012-07-11 21:59:02 -0400] jtimberman: hey chefs, just wanted to let folks know that the libraries/ruby_19_patches.rb monkeypatch is removed from the windows cookbook in v1.3.2, so this should stop wrecking non-Windows systems that pick up the cookbook as a dependency, though you'll need to download the latest windows cookbook or delete the file yourself locally.
[2012-07-11 22:30:19 -0400] Majost: what is the difference between an attibutes file, and attributes defined in metadata.rb?
[2012-07-11 22:30:51 -0400] yfeldblum: Majost, metadata.rb "attributes" are documentation only
[2012-07-11 22:30:57 -0400] Majost: ah
[2012-07-11 22:47:06 -0400] rava: greetings, has anyone a work around for using chef 10's knife bootstrap using the -i flag?
[2012-07-11 22:47:17 -0400] rava: i keep getting ERROR: ArgumentError: invalid option(s): keys_only
[2012-07-11 22:54:19 -0400] jessicab: rava: what are you trying to do with -i? for knife bootstrap its just expecting the location of your key to be sent with that
[2012-07-11 22:56:54 -0400] rava: the identity file for ssh. i'm wrapping bootstrap process for an app that launches and controls ec2 resources
[2012-07-11 22:57:56 -0400] rava: the app has it's own user it runs as specifically for this, and the knife bootsrap command entire works if i don't use -i
[2012-07-11 22:58:27 -0400] rava: except for it doesn't seem to actually want to use sudo for running the template script when passed --sudo
[2012-07-11 23:00:34 -0400] Majost: is there a document of recommended structures for databags? eg: how should one structure encrypted data bags for database passwords
[2012-07-11 23:00:40 -0400] Majost: stuff like that
[2012-07-11 23:03:16 -0400] rava: Majost: it's just a k,v store with nested k,v. any structure that works for that works for your dbags. the only thing i think i would say is to structure it by environments such that you can do a search by the environment and segragate your dev test auth from dev prod
[2012-07-11 23:03:38 -0400] Majost: ah
[2012-07-11 23:09:04 -0400] rava: like i have mine structured so in my recipe's i do: search('auth', 'environment:#{new_reousrce.environment}')
[2012-07-11 23:09:20 -0400] rava: except spelled properly
[2012-07-11 23:11:16 -0400] rava: er, make that: mysql_creds = Chef::EncryptedDataBagItem.load("auth", environment, secret) . I knew that statement seemed wrong :)
[2012-07-11 23:21:06 -0400] rava: isn't bootstrap supposed to push the encrypted data bag file when you provide the option and path in the config file knife uses for bootstrap?
[2012-07-11 23:21:12 -0400] rava: i can't get that working either :/
[2012-07-11 23:22:32 -0400] jessicab: rava:  if you dont use -i it just uses the ssh keys in your ssh agent
[2012-07-11 23:27:19 -0400] rava: right
[2012-07-11 23:28:01 -0400] rava: but the -i flag is there..and should work, but it's broken. any work arounds?
[2012-07-11 23:33:29 -0400] rava: this ticket says it was fixed: http://tickets.opscode.com/browse/CHEF-2971 in 10.8, i'm running 10.12
[2012-07-11 23:34:22 -0400] JasonF: rava: last comment on your link
[2012-07-11 23:34:25 -0400] JasonF: is showing exactly your issue
[2012-07-11 23:35:39 -0400] rava: JasonF: right, still broken. none of my hosts use password auth
[2012-07-11 23:35:55 -0400] JasonF: :(
[2012-07-11 23:36:02 -0400] rava: its just saying that it's broken, nothing helpful there
[2012-07-11 23:36:57 -0400] rava: bootstrap doesn't seem to use sudo either when you pass the --sudo flag
[2012-07-11 23:38:28 -0400] rava: the user running the bootstrap has the needed sudo access, and when i run a rendered version of the bootstrap script as that user manually using sudo, the commands work. gets permissions denied for the template execution when done through bootstrap
[2012-07-11 23:40:10 -0400] rava: screw it, i'll write my own version using fabric. rest easy all.
[2012-07-11 23:44:46 -0400] cakehero: can I install a local package file with the package resource?
[2012-07-11 23:44:58 -0400] cakehero: I am looking at the docs right now but I feel like I'm not understanding it properly
[2012-07-11 23:45:42 -0400] cakehero: just use "source" attribute?
