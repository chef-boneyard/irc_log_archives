[2012-07-16 00:02:52 -0400] hoover_damm: esad, http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2012-07-16 00:03:04 -0400] hoover_damm: esad, I suggest reviewing that ... it halfway explains the differences in attributes
[2012-07-16 00:03:56 -0400] hoover_damm: esad, http://wiki.opscode.com/display/chef/Attributes http://wiki.opscode.com/display/chef/Setting+Attributes+%28Examples%29
[2012-07-16 00:04:16 -0400] hoover_damm: PRK_nz, ruby-mode with emacs is just ine :)
[2012-07-16 00:04:18 -0400] hoover_damm: fine*
[2012-07-16 00:04:24 -0400] PRK_nz: ok, so the run fails if it can't find a matching template file anywhere
[2012-07-16 00:05:08 -0400] hoover_damm: PRK_nz, I haven't really seen anyone create a IDE template for Just Chef... It's more ruby then anything
[2012-07-16 00:05:09 -0400] PRK_nz: hmmm, ignore_failure???? dirty...
[2012-07-16 00:05:47 -0400] PRK_nz: hoover_damn: thanks, any Ruby IDE suggestions then? RubyMine seems ok but just wondering
[2012-07-16 00:05:48 -0400] hoover_damm: ruby-mode on emacs for me does more then I could ever imagine ... with chef
[2012-07-16 00:06:02 -0400] hoover_damm: :( sorry
[2012-07-16 00:06:04 -0400] hoover_damm: only Edit
[2012-07-16 00:06:23 -0400] hoover_damm: or maybe it's the ID part lol ... id10t? ;)
[2012-07-16 00:06:33 -0400] PRK_nz: lol
[2012-07-16 00:06:48 -0400] hoover_damm: PRK_nz, see a bad stackoverlow question http://stackoverflow.com/questions/16991/what-ruby-ide-do-you-prefer
[2012-07-16 00:07:13 -0400] hoover_damm: hopefully that should give you enough options to look at for a few moments
[2012-07-16 00:07:30 -0400] PRK_nz: thanks
[2012-07-16 00:10:25 -0400] PRK_nz: hmm, ignoring failure worked sweet but makes me feel dirty...
[2012-07-16 00:27:18 -0400] hoover_damm: it's very dirty
[2012-07-16 00:27:30 -0400] hoover_damm: or at least so i'm told.  I like to turn it on if something is flakey
[2012-07-16 01:46:13 -0400] timsmith: Question about searching using variables if anyone is around
[2012-07-16 01:46:24 -0400] timsmith: I have a databag with a search query in it
[2012-07-16 01:46:25 -0400] knuckolls_: i'll be here for a bit, what's up
[2012-07-16 01:46:32 -0400] timsmith: that I'd like to load and then do a search
[2012-07-16 01:46:36 -0400] knuckolls_: hm
[2012-07-16 01:46:49 -0400] timsmith: it sounds a bit crazy, but there's a reason
[2012-07-16 01:46:59 -0400] knuckolls_: well thank goodness ruby allows such a thing
[2012-07-16 01:47:36 -0400] knuckolls_: i'd be surprised if what you're trying to accomplish couldn't be solved by attributes, but i understand
[2012-07-16 01:47:41 -0400] knuckolls_: let me point you to some code, hold on
[2012-07-16 01:48:28 -0400] timsmith: I'm trying to extend the nagios cookbook to allow people to create data bags that define host groups based on searches.  It follows the same pattern that's already in place to define services with data bag items
[2012-07-16 01:49:11 -0400] timsmith: so I get the data bag items search(:nagios_hostgroups, '*:*') do |hg|    then I  do the search   search(hg['search_query']) do |n|
[2012-07-16 01:49:38 -0400] knuckolls_: yeah i'm looking for a good example i know of loading code dynamically like that
[2012-07-16 01:49:43 -0400] knuckolls_: that happens to be in the chef codebase
[2012-07-16 01:49:47 -0400] timsmith: then on the node I get this
[2012-07-16 01:49:50 -0400] timsmith: FATAL: URI::InvalidURIError: bad URI(is not URI?): http://chef.beta.dmz:4000/search/:node, 'dmi_system_manufacturer:hp'?q=*:*&sort=X_CHEF_id_CHEF_X%20asc&start=0&rows=1000
[2012-07-16 01:49:52 -0400] knuckolls_: specifically how it loads cookbooks at runtime
[2012-07-16 01:50:03 -0400] timsmith: k thanks
[2012-07-16 01:50:26 -0400] knuckolls_: so you'd load the data from a databag just like regular into a ruby string
[2012-07-16 01:50:43 -0400] knuckolls_: then you'd coherse that into being loadable code into a proc or something like that
[2012-07-16 01:50:48 -0400] knuckolls_: then you run it and collect the output
[2012-07-16 01:51:40 -0400] knuckolls_: https://github.com/opscode/chef/blob/0.10.6-rc/chef/lib/chef/mixin/from_file.rb
[2012-07-16 01:52:04 -0400] knuckolls_: this is the mixin in the chef codebase that loads a file filled with ruby code, and runs it
[2012-07-16 01:52:18 -0400] knuckolls_: the instance_eval and class_eval methods being the ones you should familiarize yourself with
[2012-07-16 01:53:01 -0400] knuckolls_: i mentioned a proc earlier, but those methods are likely the way to go. there might be another way with ruby that's cleaner, but this is what i'm aware of
[2012-07-16 01:53:10 -0400] PRK_nz: hoover_damn: Don't worry, I realised an if node.fqdn type statement wasn't as bad so went with that ;)
[2012-07-16 01:53:45 -0400] timsmith: you know I think I just fixed it
[2012-07-16 01:53:59 -0400] timsmith: fiddled around with quotes
[2012-07-16 01:54:12 -0400] knuckolls_: heh quotes
[2012-07-16 01:54:14 -0400] knuckolls_: they'll get ya
[2012-07-16 01:55:14 -0400] timsmith: it seems to be my downfall
[2012-07-16 01:55:37 -0400] timsmith: search("#{hg['search_query']}") to search(#{hg['search_query']})
[2012-07-16 01:56:10 -0400] knuckolls_: ah you were just storing the query instead of the whole method call
[2012-07-16 01:56:27 -0400] knuckolls_: a cleaner way than my suggestion most certainly ;)
[2012-07-16 01:56:30 -0400] timsmith: yes
[2012-07-16 02:02:48 -0400] PRK_nz: Is there a Chef resource or something similar that can find and replace in a file on regex? Or do I just use a ruby block? This is in a recipe btw.
[2012-07-16 02:05:45 -0400] knuckolls_: prk_nz: there has been discussion of that in the past on the mailing list, the prevailing consensus is that for nearly every occasion you'd want to do that you can solve it cleaner and more maintainable with attributes and templates. if you've got a real need i think perhaps there is a resource out there that came across the mailing list.. i don't know if off the top of my head though, you may need to dig for it
[2012-07-16 02:06:57 -0400] PRK_nz: knuckolls_: Thanks for that. Unfortunately attribs/templates won't work in this case so I'll have a dig around :)
[2012-07-16 02:07:36 -0400] timsmith: knuckolls_: I think I spoke too soon.  I just went from a bad search to bad ruby.  Is there something equiv to `command_output` in bash that can be done in ruby so that the search executes with the result of that variable?
[2012-07-16 02:09:11 -0400] knuckolls_: timsmith: i've gotta go, but i think that code i linked to earlier will help
[2012-07-16 02:09:14 -0400] knuckolls_: best of luck!
[2012-07-16 02:09:25 -0400] timsmith: thanks for the help
[2012-07-16 03:14:53 -0400] retr0h: PRK_nz: I usually stick to attributes w/ templates altho if you must check out augeas
[2012-07-16 03:16:18 -0400] PRK_nz: ret0h: yea, I'd like to but unfortunately the file in questions depends on the version of the app, not the host or platform etc
[2012-07-16 03:16:26 -0400] PRK_nz: I'm thinking I'll use an xml parser
[2012-07-16 03:16:36 -0400] PRK_nz: fyi for a windows node
[2012-07-16 03:43:26 -0400] amagee: how can i write a recipe that executes a python script stored as its own file in the same cookbook?  (ie. not using the "python" resource as i don't want the script's code to be contained in the recipe)
[2012-07-16 03:44:15 -0400] amagee: i could do it if i knew how to get paths for files in the cookbook
[2012-07-16 05:29:39 -0400] Zyclops: hi guys.. ok i've read through chef basics and architecture and I want to start writing some recipes to first setup a server locally in the office
[2012-07-16 05:29:52 -0400] Zyclops: and then another one on ec2 and then 3 on some private infrastructure
[2012-07-16 05:29:59 -0400] Zyclops: the only part i'm confused with, for this development stage
[2012-07-16 05:30:07 -0400] Zyclops: where i'm just working out how to get stuff working
[2012-07-16 05:30:14 -0400] Zyclops: what do i setup the chef server as?
[2012-07-16 05:31:05 -0400] Zyclops: considering i have no where to host it yet.. since i need to setup the servers first
[2012-07-16 05:31:17 -0400] Zyclops: eventually i'll probably be sticking the chef server on EC2
[2012-07-16 05:37:37 -0400] hoover_damm: Zyclops, can you use hosted?
[2012-07-16 05:37:43 -0400] hoover_damm: Zyclops, it's 5 nodes or free
[2012-07-16 05:37:56 -0400] hoover_damm: Zyclops, http://www.opscode.com/hosted-chef/
[2012-07-16 05:39:06 -0400] Zyclops: yeah actually i could start of with that
[2012-07-16 05:39:21 -0400] Zyclops: i assume i can migrate later if i want to
[2012-07-16 06:00:03 -0400] hoover_damm: sort of
[2012-07-16 06:00:11 -0400] hoover_damm: chef-repo lets you reupload your data anywhere
[2012-07-16 06:00:24 -0400] hoover_damm: you might have to migrate / re-bootstrap your nodes if you wanted to leave
[2012-07-16 06:00:35 -0400] hoover_damm: but you can also use chef to orchestrate that move
[2012-07-16 06:00:41 -0400] hoover_damm: so *shrug* ;)
[2012-07-16 06:47:52 -0400] bip: Anyone know how I can upgrade the chef client on a node? chef-client -version shows "Chef: 0.10.8" on one node and "Chef: 10.12.0" on a freshly added node
[2012-07-16 06:47:55 -0400] bip: just running chef-client doesn't seem to take care of it
[2012-07-16 06:49:17 -0400] erikh: bip: knife bootstrap will take your local chef version and install that on the remote server
[2012-07-16 06:51:05 -0400] bip: erikh: So it's safe to "rebootstrap" existing nodes?
[2012-07-16 06:53:37 -0400] BryanWB_: yo chefs!
[2012-07-16 06:58:18 -0400] erikh: bip: usually no.
[2012-07-16 06:58:31 -0400] erikh: BryanWB_: hihi
[2012-07-16 07:06:05 -0400] bip: erikh: Ok, so is there a "safe" way to upgrade chef-client and ohai on existing nodes?
[2012-07-16 07:06:19 -0400] erikh: bip: gem update chef should wrok
[2012-07-16 07:06:34 -0400] erikh: test it first, of course. you may need to switch the ruby that's used.
[2012-07-16 07:06:44 -0400] BryanWB_: erikh: hey dude
[2012-07-16 08:02:54 -0400] Babar: a/w 33
[2012-07-16 08:02:56 -0400] Babar: sorry
[2012-07-16 08:16:42 -0400] reset: BryanWB_: you around?
[2012-07-16 08:30:32 -0400] BryanWB_: reset: yo
[2012-07-16 08:31:23 -0400] reset: how many downloads on average do the foodfight episodes get?
[2012-07-16 08:31:40 -0400] reset: having a meeting at work tomorrow about the show - that's probably why Ivey hasn't accepted
[2012-07-16 08:31:47 -0400] reset: we didn't get signoff yet
[2012-07-16 08:43:02 -0400] masterkorp: I need to install some patches (diff files) what do you recomend ?
[2012-07-16 09:12:55 -0400] artellectual: hey guys
[2012-07-16 09:13:00 -0400] artellectual: having issues with vagrant
[2012-07-16 09:13:09 -0400] artellectual: when running chef-client on it
[2012-07-16 09:13:15 -0400] artellectual: i have my chef-server setup
[2012-07-16 09:13:29 -0400] artellectual: but when i try to boot up my vagrant client for testing
[2012-07-16 09:13:34 -0400] artellectual: i get a strange error
[2012-07-16 09:14:06 -0400] artellectual: [Mon, 16 Jul 2012 09:13:55 +0000] INFO: *** Chef 10.12.0 *** [Mon, 16 Jul 2012 09:13:56 +0000] INFO: Client key /etc/chef/client.pem is not present - registering [Mon, 16 Jul 2012 09:13:56 +0000] INFO: HTTP Request Returned 409 Conflict: Client already exists [Mon, 16 Jul 2012 09:13:57 +0000] INFO: HTTP Request Returned 403 Forbidden: You are not allowed to take this action. [Mon, 16 Jul 2012 09:13:57 +0000] FATAL: Stacktrace dum
[2012-07-16 09:14:11 -0400] artellectual: i already delete the client
[2012-07-16 09:16:42 -0400] artellectual: https://gist.github.com/2845328
[2012-07-16 09:32:15 -0400] Reverand: hi, how many queues is my /chef vhost on rabbitmq supposed to have? (chef 10.10, 1 worker)
[2012-07-16 09:32:51 -0400] Reverand: i got over 1000 queues and the solr java process drains all cpu
[2012-07-16 09:33:08 -0400] Reverand: with 20% software interrupt cpu usage
[2012-07-16 09:33:25 -0400] Reverand: any pointers what happened?
[2012-07-16 10:01:04 -0400] Axsuul: Is there a firewall/iptable cookbook that someone can recommend?
[2012-07-16 10:15:28 -0400] RJ2: trying to write my own LWRP, i get "Cannot find a resource for <lwrp name> on <ubuntu version>"
[2012-07-16 10:16:09 -0400] RJ2: the file with that name exists in resources and providers/, can't see how i should specify a platform. what am i missing?
[2012-07-16 10:16:26 -0400] RJ2: JasonF: any idea? i googled and found you asking the same question last month :)
[2012-07-16 10:19:35 -0400] ranjibd: RJ2, whats your cookbook name and lwrp name? and how you are using it?
[2012-07-16 10:20:08 -0400] RJ2: cookbook name is "irccloud", lwrp name is "erlang_jenkins_release"
[2012-07-16 10:20:53 -0400] RJ2: i thought it looked in the current cookbook, i call it from a recipe in that cookbook like:  erlang_jenkins_release "blah" do ....
[2012-07-16 10:22:28 -0400] ranjibd: yeah
[2012-07-16 10:22:35 -0400] RJ2: cookbooks/irccloud/resources/erlang_jenkins_release.rb  and cookbooks/irccloud/providers/erlang_jenkins_release.rb both exist
[2012-07-16 10:23:04 -0400] ranjibd: can you try with some name that does not have _
[2012-07-16 10:23:27 -0400] RJ2: lots of the built in lwrps have _ in them..
[2012-07-16 10:24:23 -0400] RJ2: will try
[2012-07-16 10:25:37 -0400] RJ2: same: FATAL: NameError: Cannot find a resource for erlangjenkinsrelease on ubuntu version 12.04
[2012-07-16 10:26:09 -0400] RJ2: i confirmed the resource and provider do exist in the chef cache on that node
[2012-07-16 10:26:26 -0400] ashb: irccloud_erlang_jenkins_release
[2012-07-16 10:26:32 -0400] ashb: would be the name I think
[2012-07-16 10:27:06 -0400] RJ2: ashb: ah! that did it
[2012-07-16 10:27:15 -0400] ranjibd: :-)
[2012-07-16 10:27:21 -0400] ashb: i.e. <cookbook>_<lwrp>
[2012-07-16 10:27:37 -0400] RJ2: thanks :D
[2012-07-16 10:38:53 -0400] Adz: does chef have to evaluate ShellOut objects in the compile phase, even if they're specified inside a resource?
[2012-07-16 10:40:49 -0400] Adz: the docs suggest it shouldn't, but it looks like it does by default.
[2012-07-16 10:46:58 -0400] RJ2: is it possible to define a variable in a ruby_block that i can use in other resources further down the recipe? (eg, define a var that i later use in an execute or directory resource) I'm assigning, but they are not visible elsewhere presumably due to scoping
[2012-07-16 10:47:50 -0400] ashb: either have the variable foo=nil just at the top level in the receipe file or store it in node.run_state[:foo] (i think that's where it lives)
[2012-07-16 10:48:00 -0400] RJ2: ashb: thanks
[2012-07-16 10:49:48 -0400] specialsauce: Hey, in the file resource is it pefectly valid to supply the "content" using: content `command`?
[2012-07-16 10:50:33 -0400] ashb: specialsauce: 'valid' yes, but it rings many alarm bells
[2012-07-16 10:51:16 -0400] specialsauce: ashb, i have a uuid i need to assign to a node, and only generate once, that can only be generated by a binary
[2012-07-16 10:51:35 -0400] specialsauce: how would you do that in as chefy way as possible?
[2012-07-16 10:53:38 -0400] ashb: paste what you've got so far
[2012-07-16 10:57:08 -0400] specialsauce: ashb, thanks -  http://pastebin.com/reeqxYqY
[2012-07-16 10:58:49 -0400] ashb: right well first off that would run the program every time even if the file alreayd exists (it just wouldn't update the file)
[2012-07-16 10:59:28 -0400] specialsauce: yeah i can add a not_if for that
[2012-07-16 10:59:29 -0400] ashb: i'd probably do it with the execute resource, use redirection in the command and creates optin
[2012-07-16 10:59:37 -0400] ashb: not_if won't help
[2012-07-16 10:59:41 -0400] specialsauce: ?
[2012-07-16 10:59:48 -0400] ashb: when it 'compiles' the resource it will run the ``
[2012-07-16 11:00:07 -0400] ashb: and *then* chef looks if it should run the resource and write the file
[2012-07-16 11:00:21 -0400] ashb: if magicprogram is quick to run that isn't a problem
[2012-07-16 11:00:26 -0400] ashb: but yeah, use the execute resource
[2012-07-16 11:00:45 -0400] specialsauce: ok, cheers, bit counterintuive tho!
[2012-07-16 11:01:05 -0400] ashb: does the uid have to be generate by that program?
[2012-07-16 11:01:08 -0400] ashb: if not the way i'd do it
[2012-07-16 11:01:34 -0400] ashb: is:
[2012-07-16 11:01:48 -0400] specialsauce: yeah it does unfortunately, i tried creating it manualyl but no dice
[2012-07-16 11:01:56 -0400] ashb: have a default attribugte that sets the node UUID
[2012-07-16 11:02:05 -0400] ashb: and then write the contents of that file based on that attribute
[2012-07-16 11:46:17 -0400] zoubi: does knife bootstrap supports debian squeeze now?
[2012-07-16 12:40:43 -0400] jperry2_: Is there a way to edit a value in a data bag programmatically on the chef server without pulling the data bag down?
[2012-07-16 12:44:34 -0400] zoubi: how should I write a condition to match, on Debian, a platform version of at least 6.0? (up to 6
[2012-07-16 12:44:39 -0400] zoubi: up to 6.0.5
[2012-07-16 12:44:52 -0400] zoubi: cuurently, I have set if platform_version == "6.0"
[2012-07-16 12:45:05 -0400] zoubi: but I have a client which runs on 6.0.5 and the condition fails...
[2012-07-16 12:45:06 -0400] jchome: if node[:platform_version] =~ /^6\..*/
[2012-07-16 12:45:50 -0400] jchome: In Debian you can match on the whole major version as there are no big subversions as in Ubuntu f.e.
[2012-07-16 12:46:07 -0400] yfeldblum: jperry2, indeed, that's the primary way to write data bag items
[2012-07-16 12:46:21 -0400] yfeldblum: jperry2_, ^
[2012-07-16 12:47:03 -0400] yfeldblum: jperry2_, `knife data bag edit BAG ITEM` uses the API, as does `knife data bag from file BAG ITEM.json`
[2012-07-16 12:48:00 -0400] zoubi: thanks jchome
[2012-07-16 12:48:07 -0400] jperry2_: so I can use knife data bag edit BAG ITEM in a rake file?
[2012-07-16 12:48:12 -0400] jperry2_: or ruby script
[2012-07-16 12:48:24 -0400] jperry2_: i don't want to bring up an editor
[2012-07-16 12:48:39 -0400] jperry2_: the ITEM.json approach will update the whole data bag
[2012-07-16 12:48:46 -0400] jperry2_: I want to just update a particular value
[2012-07-16 12:49:04 -0400] jperry2_: for example I have different environments in the data bag file
[2012-07-16 12:49:10 -0400] jperry2_: let me get you an example
[2012-07-16 12:49:49 -0400] jperry2_: http://hastebin.com/senuhovafe
[2012-07-16 12:49:54 -0400] yfeldblum: jperry2_, the API is essentially a GET/PUT/DELETE triple of operations (although the API oddly maintains a difference between creating a new item and rewriting an existing item)
[2012-07-16 12:50:08 -0400] BryanWB_: jperry2_: haven't read all ur messages, but think danryan/spice might meet your needs
[2012-07-16 12:50:49 -0400] jperry2_: BryanWB_ - thanks I'll check it out
[2012-07-16 12:51:03 -0400] jperry2_: in the example I pasted I want to edit just the qa value
[2012-07-16 12:51:09 -0400] jperry2_: without impacting the other values
[2012-07-16 12:51:35 -0400] yfeldblum: jperry2_, so you could write a knife plugin and it could `item = Chef::DataBagItem.load(bag_name, item_name) ; do_something_with(item) ; item.save`
[2012-07-16 12:51:44 -0400] jperry2_: I want to avoid any chance of a value being overwritten
[2012-07-16 12:52:22 -0400] jperry2_: yfeldblum - thanks, I think I'll do that or use the danryan/spice BryanWB suggested
[2012-07-16 12:52:24 -0400] yfeldblum: jperry2_, however, the only API is at the level of the whole item; there is no API for surgical updates, only complete rewrites
[2012-07-16 12:52:32 -0400] jperry2_: okay thats what I figured
[2012-07-16 12:53:04 -0400] jperry2_: hopefully that it will happen so quick the chance of overlap with another environment won't happen but there is a chance
[2012-07-16 12:53:19 -0400] jperry2_: the only way I could avoid this is have only one machine do these updates
[2012-07-16 12:53:28 -0400] jperry2_: since our CI server will be handling these changes
[2012-07-16 12:53:37 -0400] jperry2_: when it builds new rpms and pushes them to a yum repo
[2012-07-16 12:54:30 -0400] ranjibd: jperry2, the apiclient has to be admin
[2012-07-16 12:54:32 -0400] jperry2_: thx for the pointers
[2012-07-16 12:55:46 -0400] yfeldblum: jperry2_, chef-server-api does not expose a way to do any concurrency control; e.g. it does not respect if-match or if-not-modified for optimistic concurrency control, and it does not allow for transactions or locking; to get this type of concurrency control, you will either need to add a service to help with that, or you will need to store the versions in a datastore that either has these concurrency-control properties, or permits you t
[2012-07-16 12:55:47 -0400] yfeldblum: o do atomic surgical updates
[2012-07-16 12:56:18 -0400] jperry2_: yeah thats what I was figuring
[2012-07-16 12:56:29 -0400] yfeldblum: jperry2_, of course, you can simply use, as your form of concurrency control, yelling to the others in the room that you are rewriting the versions data-bag item
[2012-07-16 12:56:30 -0400] jperry2_: could have a rails app with a datastore for all this info
[2012-07-16 12:56:35 -0400] jperry2_: ha
[2012-07-16 12:56:36 -0400] jperry2_: yeah
[2012-07-16 12:56:46 -0400] jperry2_: well its all automatic
[2012-07-16 12:56:54 -0400] jperry2_: our ci server will do everything
[2012-07-16 12:57:16 -0400] jperry2_: any time you check into to this project
[2012-07-16 12:57:18 -0400] yfeldblum: jperry2_, jfyi i like to think about a "data bag" like a mysql table, and a "data bag item" like a record in that table - that sort of sets the frame-of-mind
[2012-07-16 12:57:33 -0400] jperry2_: ah okay good example
[2012-07-16 12:57:52 -0400] jperry2_: yfeldblum - did you see the example I linked
[2012-07-16 12:58:05 -0400] jperry2_: is it okay to have all the environments in the same data bag
[2012-07-16 12:58:29 -0400] jperry2_: if you wanted to avoid this sort of thing each environment could be in a separate file
[2012-07-16 12:58:34 -0400] jperry2_: but might be over kill
[2012-07-16 12:59:23 -0400] jperry2_: for example instead of one file I would have one for each environment per application
[2012-07-16 12:59:27 -0400] yfeldblum: jperry2_, yes i did see it; but i'm explaining the way i think about data bags and data bag items, as compared to each other and as compared to others things that we know about
[2012-07-16 12:59:35 -0400] jperry2_: got it
[2012-07-16 12:59:37 -0400] jperry2_: thanks
[2012-07-16 12:59:59 -0400] yfeldblum: jperry2_, i also don't think about them as "files" living in the chef-repo, but more as data as stored in the chef-server (with the files in the chef-repo there, optionally, to assist)
[2012-07-16 13:00:14 -0400] jperry2_: got it
[2012-07-16 13:00:23 -0400] jperry2_: yeah with our approach we may just store this info on the chef server
[2012-07-16 13:00:28 -0400] jperry2_: rather than use the files
[2012-07-16 13:00:37 -0400] jperry2_: to avoid having to check them in each time we rev the version
[2012-07-16 13:00:42 -0400] jperry2_: which could be several times a day
[2012-07-16 13:01:00 -0400] jperry2_: per application
[2012-07-16 13:01:09 -0400] jperry2_: as it will be a continuous delivery pipeline
[2012-07-16 13:05:55 -0400] remil: got chef-solo running on debian, installed with opscode debian repo, how do I disable the chef-client service ? with  service "chef-client" { action [ :stop, :disable ] } ?
[2012-07-16 13:06:42 -0400] remil: doing so the chef-client process is stopped, but the update-rc.d call does not remove the SXXchef-client symlinks
[2012-07-16 13:07:50 -0400] spoon: got a problem with the users cookbook, all worked for weeks until Sunday then  INFO: HTTP Request Returned 500 Internal Server Error: Net::HTTPServerException: 404 "Not Found" everthing seems to be started, data bag in place.  Not sure where to go to best debug???
[2012-07-16 13:08:33 -0400] Adz: spoon, are you sure solr is running?
[2012-07-16 13:09:50 -0400] spoon: hmm thought it was but seems to hang wehn I try a restart
[2012-07-16 13:11:18 -0400] leifmadsen: anyone happen to know of anyone who has started planning for, or is actively working on, a book for Chef?
[2012-07-16 13:11:56 -0400] leifmadsen: if so I'd like to speak with them about their endeavour
[2012-07-16 13:12:31 -0400] Adz: spoon, if you're running an old version of the chef-client recipe, or running it without the chef-server recipe, it will change the ownership of /var/log/chef and /var/run/chef
[2012-07-16 13:12:32 -0400] asg: leifmadsen: coderanger iirc is working on one for O'Reilly
[2012-07-16 13:12:54 -0400] leifmadsen: asg: thanks, looks like I might already be too late to start on another O'Reilly book :)
[2012-07-16 13:12:57 -0400] leifmadsen: coderanger: ping
[2012-07-16 13:13:16 -0400] Adz: which causes solr to fail to restart. Which it likes to do on Sundays, after the logs rotate.
[2012-07-16 13:13:33 -0400] spoon: <Adz> yep jsut looked in the log - FATAL: Couldn't write to pidfile /var/run/chef/solr.pid, permission denied: Permission denied - /var/run/chef/solr.pid
[2012-07-16 13:13:47 -0400] spoon: <Adz> any ideas on a quick fix?
[2012-07-16 13:13:59 -0400] Adz: chown /var/run/chef to chef:chef and restart solr
[2012-07-16 13:16:13 -0400] spoon: yep looks like solr is started now but still getting the error, any need to restart everything else?
[2012-07-16 13:17:08 -0400] Adz: I can't remember, but it can't hurt
[2012-07-16 13:17:33 -0400] spoon: thanks for pointing me in the right direction I'll chef the chef-client recipie version
[2012-07-16 13:17:54 -0400] Adz: you'll need to run the chef-server recipe too
[2012-07-16 13:18:20 -0400] spoon: ok I'll try and get that in too...
[2012-07-16 13:19:51 -0400] geekbri: ohai chefs
[2012-07-16 13:20:13 -0400] geekbri: Has anybody found a way when using resources inside of a provider to pass on if they have called updated_by_last_action to your own provider?
[2012-07-16 13:21:18 -0400] zoubi: I have an already created and functional node, but I forgot to change its hostname before running chef-client, so it now has a default ubuntu name :(
[2012-07-16 13:21:40 -0400] zoubi: what is the best way to change the machine hostname, and the node / client name on the server?
[2012-07-16 13:23:24 -0400] yfeldblum: geekbri, try this pattern ---> https://gist.github.com/d85be145f3ff824ccc07
[2012-07-16 13:24:16 -0400] yfeldblum: geekbri, it's an example typed from memory and hypothesis, so it may not be exactly correct, but certainly take a look at it
[2012-07-16 13:24:47 -0400] geekbri: yfeldblum: ah I see, that makes sense.  So you basically create a new temporary run context and just check to see if the resource collection has any updated resources in it.
[2012-07-16 13:25:22 -0400] yfeldblum: geekbri, indeed, and most of that example is the machinery & boilerplate & error handling &c. required to make that technique go
[2012-07-16 13:26:11 -0400] geekbri: yfeldblum: yeah now that I see it, it makes sense.  Messy but it seems like a workable solution
[2012-07-16 13:26:38 -0400] geekbri: I'll have to play with this and see if I can get it to work.
[2012-07-16 13:26:41 -0400] yfeldblum: geekbri, messy? :P
[2012-07-16 13:26:57 -0400] geekbri: hehe, well messier than just having some way built in to do it ;-
[2012-07-16 13:26:58 -0400] geekbri: ;)
[2012-07-16 13:27:02 -0400] ranjibd: yfeldblum, nah.. pretty neat
[2012-07-16 13:27:07 -0400] yfeldblum: geekbri, you're much too acclimated to the brevity of ruby ...
[2012-07-16 13:27:34 -0400] geekbri: Sorry when I say messy, I don't mean the code or even the method.  I just meant, it would be even nicer if there was some inherent way to do this, not just a work around.
[2012-07-16 13:27:39 -0400] yfeldblum: hehe
[2012-07-16 13:28:02 -0400] geekbri: I would still pick this over say.... string manipulation in c :-P
[2012-07-16 13:28:03 -0400] yfeldblum: geekbri, this is probably a simpler version of the type of code you'd need to write in java
[2012-07-16 13:28:22 -0400] yfeldblum: geekbri, so for that alone, i'm ok with it
[2012-07-16 13:28:55 -0400] yfeldblum: geekbri, RINJ and all
[2012-07-16 13:28:57 -0400] remil: ok, I had to use  provider Chef::Provider::Service::Insserv on Debian squeeze
[2012-07-16 13:29:00 -0400] geekbri: I'm ok with it, because it looks like it would work
[2012-07-16 13:29:33 -0400] geekbri: I'll play around with this an see what happens
[2012-07-16 13:29:37 -0400] geekbri: thank yfeldblum
[2012-07-16 13:33:26 -0400] geekbri: yfeldblum: so since youre calling converge on the sub context, the providers will actually be taking their actions immediately huh.
[2012-07-16 13:45:06 -0400] yfeldblum: geekbri, provider actions are only ever executed during the containing run-context's convergence phase, not during its "compilation" phase
[2012-07-16 13:45:23 -0400] yfeldblum: geekbri, so it's doing a sub-converge within the parent converge
[2012-07-16 13:48:54 -0400] geekbri: yfeldblum: ah ok,  Yes so that converge only happens when the parents converge happens.  Excellent.
[2012-07-16 13:56:11 -0400] yfeldblum: geekbri, if you are planning to experiment with that pattern, let me know if i made any mistakes in that example?
[2012-07-16 13:57:20 -0400] geekbri: yfeldblum: I already am experimenting.  Will report back with all findings :)
[2012-07-16 13:57:28 -0400] yfeldblum: geekbri, thanks
[2012-07-16 13:58:21 -0400] spoon: <Adz> Thanks for your help chowned the directories and all is good, updated chef-client recipe looking at pulling chef-server appreciate your time
[2012-07-16 13:58:31 -0400] Adz: you're welcome
[2012-07-16 14:15:57 -0400] zoubi: are there already existing solutions to manage multiple chef-servers using a single chef workstation?
[2012-07-16 14:16:26 -0400] dumfries: zoubi I've created shell functions to solve that.
[2012-07-16 14:16:43 -0400] zoubi: is it more work than just updating the keys / client.rb / knife.rb ?
[2012-07-16 14:16:53 -0400] zoubi: dumfries, you have a repo for them?
[2012-07-16 14:17:12 -0400] dumfries: No, they are just simple shell functions.
[2012-07-16 14:17:34 -0400] geekbri: yfeldblum: It doesn't seem to like the resource names when I try to run in the sub context.
[2012-07-16 14:17:42 -0400] geekbri: yfeldblum:  redisio_install[redis-servers] (redisio::install line 24) had an error: NoMethodError: undefined method `user' for #<Chef::RunContext:0xb726746c>
[2012-07-16 14:17:43 -0400] zoubi: dumfries, what do they do?
[2012-07-16 14:19:03 -0400] dumfries: zoubi http://pastebin.com/GBxjiL1U
[2012-07-16 14:19:47 -0400] zoubi: dumfries, thanks
[2012-07-16 14:19:52 -0400] yfeldblum: geekbri, yeah might need to change a few things ... take a look at Chef::Provider#recipe_eval for reference (https://github.com/opscode/chef/blob/master/chef/lib/chef/provider.rb#L160-178)
[2012-07-16 14:19:55 -0400] zts: zoubi: you might also look at knife-block https://github.com/greenandsecure/knife-block/
[2012-07-16 14:19:58 -0400] zoubi: so both of your servers have the same keys?
[2012-07-16 14:20:15 -0400] dumfries: zoubi no that is handled in the configuration file.
[2012-07-16 14:21:32 -0400] zoubi: thanks zts
[2012-07-16 14:21:42 -0400] zoubi: oh yeah dumfries, ok, thanks
[2012-07-16 14:21:49 -0400] dumfries: np
[2012-07-16 14:24:14 -0400] yfeldblum: geekbri, might need to just set @run_context and then in an ensure step unset it, and then don't even need to instance_exec
[2012-07-16 14:24:28 -0400] geekbri: yfeldblum: thats exactly what I was trying right now
[2012-07-16 14:24:53 -0400] geekbri: yfeldblum: I'm assuming there are other things during the creationg of run context that i'd need to setup.
[2012-07-16 14:26:15 -0400] geekbri: yfeldblum: although it is a bit strange to be calling converge on the run_context no?
[2012-07-16 14:26:23 -0400] geekbri: Well I guess only one way to find out
[2012-07-16 14:27:23 -0400] yfeldblum: geekbri, not that i'm aware of; the reason what i just said might work is because Chef::Provider#method_missing knows how to handle methods like #user (the method shortcut for the Chef::Resource::User class) and methods for invoking definitions etc
[2012-07-16 14:28:14 -0400] yfeldblum: geekbri, nope, it's calling #converge on an instance of Chef::Runner
[2012-07-16 14:28:33 -0400] yfeldblum: geekbri, Chef::Runner.new(whatever_run_context_you_like).converge
[2012-07-16 14:29:23 -0400] geekbri: yfeldblum: yeah I guess my concern was, in your example I understood that I was basically calling the runner on a subset of resource.  However if I call the runner on the @run_context, thats not a subset at all, thats got the entire resource_collection.  I suppose though at the top I'll be setting the resource_collection in the @run_context to a new instance that is empty, so it will be ok
[2012-07-16 14:29:34 -0400] geekbri: then after the runner does its thing, I will set the @run_context back to the cached coy
[2012-07-16 14:29:35 -0400] geekbri: copy
[2012-07-16 14:29:58 -0400] yfeldblum: geekbri, that would be true, except for: sub_run_context.resource_collection = Chef::ResourceCollection.new
[2012-07-16 14:30:37 -0400] geekbri: yfeldblum: right but that would be changed to @run_context.resource_collection = Chef::ResourceCollection.new.  Which is fine since we restore the state of the run_context after the provider action is done.
[2012-07-16 14:31:12 -0400] yfeldblum: geekbri, no, what you would do is replace the part that begins with `sub_run_context.instance_exec`
[2012-07-16 14:32:13 -0400] yfeldblum: geekbri, it now goes in a begin/ensure/end block; in the begin, set @run_context = sub_run_context, then declare all your resources, then in the ensure set @run_context = original_run_context (which you will have to capture earlier on)
[2012-07-16 14:32:24 -0400] yfeldblum: geekbri, the rest of it should be the same
[2012-07-16 14:33:00 -0400] zoubi: zts, unfortunately knife-block doesn't work on Windows, because symlink() is not implemented :(
[2012-07-16 14:33:02 -0400] yfeldblum: geekbri, the instance variable @run_context only needs to be set immediately before we start calling resource-instantiation methods, and needs to be unset immediately when we're done calling those methods
[2012-07-16 14:34:49 -0400] geekbri: yfeldblum: I must not be following correctly because if I were to do the changes you suggested the resource I'm calling would be added to the resource collection of the wrong run_context
[2012-07-16 14:35:42 -0400] yfeldblum: geekbri, i updated the gist with the pattern i just described: https://gist.github.com/d85be145f3ff824ccc07
[2012-07-16 14:36:26 -0400] yfeldblum: geekbri, that may work better, if you're willing to give it a try
[2012-07-16 14:36:39 -0400] geekbri: yfeldblum: Ok, I think we were talking about two different ways to do the same thing.  I'm going to throw up a gist of what I'm thinking and I'm curious of your feedback
[2012-07-16 14:39:24 -0400] geekbri: yfeldblum:  https://gist.github.com/a9bb79fdaf99be6ea7ef
[2012-07-16 14:41:16 -0400] geekbri: yfeldblum: except that the new_resource.updated_by_last_action would need to be the cached new_resource
[2012-07-16 14:41:43 -0400] geekbri: yfeldblum: or rather, you'd have to set the cached_run_context to back into @run_context, then call that
[2012-07-16 14:43:33 -0400] yfeldblum: geekbri, it's effectively the same thing (sans comments)
[2012-07-16 14:43:48 -0400] geekbri: yfeldblum: fair enough!  It seemed to make more sense to my brain.
[2012-07-16 14:44:10 -0400] yfeldblum: geekbri, one of the things i like to do is minimize the surface area of disturbances, and i consider the @run_context shuffling to be a disturbance, whose surface area is to be minimized, so that's why i wrote mine the way i did
[2012-07-16 14:44:56 -0400] geekbri: yfeldblum: ok that is a fair point.  My concern was just that I figured by keeping everything running in the current @run_context, you don't have to worry about the situation where something may not be set that should be.
[2012-07-16 14:45:34 -0400] yfeldblum: geekbri, the other thing is i want to be sure to reset @run_context, which is why i only change it inside a begin and am sure to reset it immediately in the corresponding ensure
[2012-07-16 14:45:47 -0400] yfeldblum: geekbri, that gets important if, for example, you have two actions for the same resource
[2012-07-16 14:46:24 -0400] geekbri: yfeldblum: I do lke how you have wrapped the sub_run_context in a begin end, that ensures the state gets set back to its original
[2012-07-16 14:47:40 -0400] geekbri: yfeldblum: I'll go try this new method and see what happens
[2012-07-16 14:47:46 -0400] yfeldblum: geekbri, you also should probably not need to worry about @run_context except for the very specific case of you wanting to use methods like #user and #mount and #cookbook_file - it's only there to provide for those convenience methods, so you only need it set when you are actually calling those convenience methods in your provider code (no need to worry about notifications between the resources etc, that's already taken care of internall
[2012-07-16 14:47:46 -0400] yfeldblum: y even if you've reset the @run_context ivar)
[2012-07-16 14:50:06 -0400] Adz: are ShellOut's always done in the compile phase, even if they're in a resource?
[2012-07-16 14:51:05 -0400] ashb: what kind of Shellouts?
[2012-07-16 14:51:27 -0400] yfeldblum: Adz, yes, but what do you mean by "in a resource"?
[2012-07-16 14:51:45 -0400] Adz: I want to set a template variable to the output of "/usr/bin/php-config5 --extension-dir"
[2012-07-16 14:52:03 -0400] Adz: but it fails on the first run because php isn't present
[2012-07-16 14:52:32 -0400] yfeldblum: Adz, do you not know what the extension dir will be?
[2012-07-16 14:52:52 -0400] Adz: it's a property of the Ubuntu package
[2012-07-16 14:53:23 -0400] ashb: sounds like a use for an ohai php plugin
[2012-07-16 14:53:35 -0400] ashb: then you could do node['language']['php']['extension_dir']
[2012-07-16 14:54:14 -0400] yfeldblum: ashb, that probably wouldn't solve the problem at hand
[2012-07-16 14:54:38 -0400] ashb: not the problem but would be a different way of getting the info without using a shell out
[2012-07-16 14:55:43 -0400] yfeldblum: Adz, but on all the servers that you care about, can you predict what the value will be? will it always be the same value, on all the servers you care about?
[2012-07-16 14:56:30 -0400] Adz: it'll be constant whilst the php package version is unchanged
[2012-07-16 14:57:10 -0400] Adz: I think I'd prefer to converge in two passes than hard-code it though
[2012-07-16 14:57:17 -0400] yfeldblum: Adz, does the dir name include the version number?
[2012-07-16 14:58:08 -0400] Adz: no, it's a datestamp
[2012-07-16 14:59:35 -0400] Adz:  /usr/lib/php5/20090626/ on boxes running Lucid, /usr/lib/php5/20100525/ on boxes running Precise.
[2012-07-16 15:01:08 -0400] yfeldblum: Adz, you could pass a Proc as one of the template resource's variables, and the template ERB could call the proc
[2012-07-16 15:01:38 -0400] yfeldblum: Adz, variables :extension_dir => proc{`/usr/bin/php-config5 --extension-dir`}
[2012-07-16 15:01:57 -0400] yfeldblum: Adz extension_dir = <%= @extension_dir.call %>
[2012-07-16 15:02:18 -0400] ashb: or switch on node.platform_version.to_f
[2012-07-16 15:02:40 -0400] Adz: that sounds good, yfeldblum.
[2012-07-16 15:02:43 -0400] ashb: using value_for_platofmr
[2012-07-16 15:02:46 -0400] ashb: platform
[2012-07-16 15:02:54 -0400] Adz: currently I have  "variables  :extension_dir => Mixlib::ShellOut.new("/usr/bin/php-config5 --extension-dir").run_command.stdout.chomp"
[2012-07-16 15:03:44 -0400] ashb: :extension_dir => value_for_platform( "ubuntu" => { "10.04" => "/usr/lib/php5/20100525/", "9.04" => "/usr/lib/php5/20090626/" } }
[2012-07-16 15:03:46 -0400] yfeldblum: Adz, not a fan of that pattern, would prefer switching on platform_version with multiple hardcoded paths as long as it's well-known what the paths will be in each case
[2012-07-16 15:03:59 -0400] yfeldblum: Adz, as ashb is describing
[2012-07-16 15:04:17 -0400] ashb: (i didn't get the names->versions right cos they always consfuse me so i guesses)
[2012-07-16 15:04:21 -0400] ashb: s/es/ed/
[2012-07-16 15:04:23 -0400] Adz: well, that pattern doesn't work anyway, it runs the shellout too early
[2012-07-16 15:04:39 -0400] yfeldblum: Adz, what ashb is describing is a lot more chef-like
[2012-07-16 15:05:01 -0400] Adz: Ok. I don't know how stable the paths are though.
[2012-07-16 15:05:04 -0400] yfeldblum: Adz, :extension_dir => value_for_platform( "ubuntu" => { "10.04" => "/usr/lib/php5/20100525/", "9.04" => "/usr/lib/php5/20090626/" } }
[2012-07-16 15:05:36 -0400] yfeldblum: Adz, if you can determine that they are stable, the multiple cases would typically be preferable
[2012-07-16 15:06:14 -0400] Adz: Ok, thanks for your help guys.
[2012-07-16 15:19:52 -0400] geekbri: yfeldblum: so far so good with this pattern.  have more testing to do though
[2012-07-16 15:20:03 -0400] yfeldblum: geekbri, excellent
[2012-07-16 15:23:33 -0400] geekbri: yfeldblum: awesome, totally looks like it works just fine.
[2012-07-16 15:23:49 -0400] geekbri: yfeldblum: this is a great pattern.  I had asked this question on the mailing list, so I'll go ahead and answer it and link to your gist.
[2012-07-16 15:24:06 -0400] yfeldblum: geekbri, ok
[2012-07-16 15:52:12 -0400] zoubi: I'd like to try to implement the missing feature of the metadata, related to the supports property not being (currently) used
[2012-07-16 15:52:24 -0400] zoubi: what do you think would be the best way to start?
[2012-07-16 15:54:13 -0400] ashb: zoubi: lets start with asking what you want to get out of it?
[2012-07-16 15:54:43 -0400] knuckolls: also if that's in line with what opscode might have planned for it, are there any jira tickets, etc?
[2012-07-16 16:01:32 -0400] zoubi: ashb: currently, if in the metadata of a cookbook, I set supports 'ubuntu', '= 10.04' and I install the cookbook on, say, a Debian Squeeze, I can
[2012-07-16 16:09:54 -0400] jasond: what's the best way to get the status of each step in a chef-solo run?
[2012-07-16 16:10:55 -0400] knuckolls: jasond: i use chef-server but i assume chef-solo has report handlers as well. http://wiki.opscode.com/display/chef/Exception+and+Report+Handlers
[2012-07-16 16:10:59 -0400] knuckolls: is that what you're looking for?
[2012-07-16 16:11:11 -0400] Zenigor: I'm still having a heck of a time using the knife rackspace gem. Each and every time i spin up and bootstrap a server via the gem, I get rackspace build error tickets stating apt-get is being locked up, presumably by knife / chef. After speaking with rackspace, they told me to have chef sleep for 20mins before beginning the bootstrap process. Is anyone else running into this?
[2012-07-16 16:17:28 -0400] jasond: knuckolls: looks like it.  thanks.
[2012-07-16 16:51:36 -0400] maruq: hi guys
[2012-07-16 16:51:54 -0400] maruq: is there a preferred cookbook for /et/chosts ?
[2012-07-16 16:52:24 -0400] maek: If I have an attribute in my attributes/default.rb set to 'default' I should be able to edit the node and in the override section set a new value for that attribute correct?
[2012-07-16 16:52:44 -0400] maek: maruq: dns ;)
[2012-07-16 16:52:52 -0400] maruq: there's a "hosts-awareness" cookbook, which has 5 stars, but no details
[2012-07-16 16:53:12 -0400] maruq: maek: yeah, that's probably the other way of doing it
[2012-07-16 16:53:49 -0400] maruq: I think DNS would be more correct though
[2012-07-16 16:54:07 -0400] maek: yeah, Id argue its *the* way and filling out a hosts file is the other way
[2012-07-16 16:54:15 -0400] ttilley: maek: if something has a public and private IP, you probably want nodes in your cluster to use the private IP.
[2012-07-16 16:54:26 -0400] maek: but that doesnt really help if you cant get dns up quickly.
[2012-07-16 16:54:44 -0400] ttilley: maek: every node in my cluster has a hosts entry for a singular domain just for that reason
[2012-07-16 16:54:46 -0400] maek: ttilley: true, just spouting rhetoric. There is always reasons why you need something out of the norm
[2012-07-16 16:54:52 -0400] maruq: maek: yeah, that's sort of the problem
[2012-07-16 16:55:23 -0400] maruq: "hosts-awareness" cookbook looks decent, but zero docs on what to provide
[2012-07-16 16:55:25 -0400] maek: maruq: what we used to use was a template that was populated via search for all nodes in the same env and then just iterate over it and the entry
[2012-07-16 16:55:44 -0400] maruq: maek: that sounds like a good solution
[2012-07-16 16:55:55 -0400] maruq: would probably do what I need quite well
[2012-07-16 16:56:19 -0400] maek: especially if its not the default ip. you can ask for what ever ohai attribute you need
[2012-07-16 16:56:54 -0400] maruq: yep, cool thanks
[2012-07-16 16:57:05 -0400] maruq: I'll have a bash & see what I come up with
[2012-07-16 17:02:20 -0400] hoover_damm: marwood, any reason you choose not to use /etc/hosts.d?
[2012-07-16 17:02:30 -0400] hoover_damm: and try and manage a file unncessarily?
[2012-07-16 17:03:49 -0400] maek: hoover_damm: he bailed
[2012-07-16 17:07:42 -0400] hoover_damm: lol
[2012-07-16 17:08:56 -0400] julien___: hi! Does anyone use the gem attribute parameter for the application_ruby cookbook? We have trouble specifying a gem version with it :/
[2012-07-16 17:09:10 -0400] maek: hoover_damm: I didnt know hosts had a .d structure. TIL :)
[2012-07-16 17:09:43 -0400] julien___: rails do
[2012-07-16 17:09:43 -0400] julien___:     gems {'skates' => { 'version' => '0.5.9' }}
[2012-07-16 17:09:45 -0400] julien___:   end
[2012-07-16 17:09:47 -0400] julien___: Results in
[2012-07-16 17:09:47 -0400] julien___: FATAL: SyntaxError: /var/chef/cache/cookbooks/firehoser-ruby/recipes/default.rb:47: syntax error, unexpected tASSOC, expecting '}'
[2012-07-16 17:09:48 -0400] julien___:     gems {'skates' => { 'version' => '0.5.9' }}
[2012-07-16 17:09:49 -0400] julien___: Which is odd, because this is IIRC, a vlid ruby syntax
[2012-07-16 17:13:00 -0400] thom: bang in in parens
[2012-07-16 17:14:28 -0400] julien___: thom: thanks.. that works
[2012-07-16 17:23:44 -0400] coderanger: leifmadsen: LordCope is the one writing the book (and already released one on TDD w/ Chef)
[2012-07-16 17:24:06 -0400] leifmadsen: coderanger: gotcha, thanks
[2012-07-16 17:24:13 -0400] leifmadsen: LordCope is on IRC?
[2012-07-16 17:24:58 -0400] coderanger: Not at the moment it seems
[2012-07-16 17:32:37 -0400] jperry2_: BryanWB - the spice library worked great
[2012-07-16 17:32:39 -0400] jperry2_: thanks
[2012-07-16 17:36:45 -0400] hoover_damm: maek, lots of things have a .d
[2012-07-16 17:36:50 -0400] hoover_damm: maek, sysctl does, hosts does
[2012-07-16 17:37:02 -0400] hoover_damm: maek, same with limits
[2012-07-16 17:37:16 -0400] hoover_damm: maek, so it makes the whole prospect of 'lets rewrite a file in ruby' so much more stupid
[2012-07-16 17:37:23 -0400] hoover_damm: when you can do it in a way that is less insane
[2012-07-16 17:37:29 -0400] hoover_damm: and a lot cleaner
[2012-07-16 17:54:10 -0400] geekbri: hoover_damm: you ever had a problem when trying to kill a process you've started with bluepill by launching it in a bash shell ?
[2012-07-16 17:54:37 -0400] vaq: Hello, I use remote (http://wiki.opscode.com/display/chef/Resources#Resources-RemoteDirectory) to copy a directory and it's files. However it seems that chef by default set's permissions as "-rw-r--r--" how do I tell chef not to alter the permission on the directory and it's files during transfer?
[2012-07-16 17:55:38 -0400] knuckolls: vaq: well in that link in the documentation there's the files_mode attribute, would that not work?
[2012-07-16 17:56:24 -0400] vaq: knuckolls: I want to keep the permissions the files/directory already has, I don't want to alter them doing copy, since the files within the directory have different permissions.
[2012-07-16 17:56:38 -0400] knuckolls: makes sense
[2012-07-16 17:56:49 -0400] vaq: during copy*
[2012-07-16 17:57:08 -0400] knuckolls: worse case you can use a bash/execute statement to rsync with the keep permissions flag. there is perhaps a cleaner way to do it
[2012-07-16 17:58:02 -0400] vaq: knuckolls: yes, but then again, my chef clients run every 1800 sec and sync files, that would mean I need to cron a permission change.. that's a nasty hack
[2012-07-16 17:58:51 -0400] vaq: but, the question is.. why do chef enforce 644, when the file in the repo has other permission settings?
[2012-07-16 17:58:57 -0400] vaq: [Mon, 16 Jul 2012 12:52:24 -0500] INFO: cookbook_file[/etc/sudoers] mode changed to 644
[2012-07-16 17:59:32 -0400] vaq: -r--r----- 1 0 0 46 Jul 16 13:33 files/default/etc/sudoers
[2012-07-16 17:59:40 -0400] knuckolls: vaq: hm? i don't see the need for the cron stuff. rsync with this flag should pull over exactly what you're looking for and keep it up to date every time the chef-client runs.
[2012-07-16 17:59:42 -0400] knuckolls: -p, --perms                 preserve permissions
[2012-07-16 18:00:22 -0400] vaq: I don't want to use another client for syncing files, when chef has a function for it.
[2012-07-16 18:00:35 -0400] knuckolls: right, i suppose i meant if it comes to that ;)
[2012-07-16 18:01:05 -0400] vaq: Just found this http://tickets.opscode.com/browse/CHEF-2691?page=com.atlassian.jira.plugin.system.issuetabpanels%3Achangehistory-tabpanel :(
[2012-07-16 18:03:10 -0400] vaq: I guess I do need to do a hack then.
[2012-07-16 18:03:32 -0400] knuckolls: well
[2012-07-16 18:03:36 -0400] knuckolls: https://github.com/opscode/chef/blob/master/chef/lib/chef/resource/remote_directory.rb
[2012-07-16 18:04:21 -0400] knuckolls: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/remote_directory.rb
[2012-07-16 18:04:39 -0400] knuckolls: might be worth looking into just fixing the ticket and submitting a pull request
[2012-07-16 18:06:51 -0400] hoover_damm: geekbri, hrm... that doesn't make sense care to explain it more?
[2012-07-16 18:06:57 -0400] vaq: ye
[2012-07-16 18:07:12 -0400] hoover_damm: geekbri, i mean you should be able to kill a process started by bluepill by doing kill proc and then bluepill will do whatever
[2012-07-16 18:07:20 -0400] hoover_damm: geekbri, restart or ignore based on your pill
[2012-07-16 18:08:40 -0400] geekbri: hoover_damm: yeah, so basically i have this bluepill process thats being stop/started in a cookbook.  I noticed that even thought it claimed to being stopped it was stunning running and new ones were being launched.  I had to wrap the launch command for the process in a bash -c '' because I needed to source a file before I ran it.  When I try to use source in start_command with bluepill it whines about source (leads me to assume its using sh).
[2012-07-16 18:08:40 -0400] geekbri:  It kills teh bash process that wraps the command, but not the process that was spawned by it.
[2012-07-16 18:09:01 -0400] geekbri: hoover_damm: of course if i copy and paste that exact start command myself, then issue it a sigkill, sigterm, or sighup, it works just fine.
[2012-07-16 18:16:28 -0400] hoover_damm: weird
[2012-07-16 18:16:32 -0400] hoover_damm: LC_ALL="C" change it somehow?
[2012-07-16 18:21:20 -0400] geekbri: hoover_damm: i'll try doing that and see what happens
[2012-07-16 18:23:07 -0400] hoover_damm: geekbri, I don't use the bluepill lwrp as much as I should... I did observe some double loading of bluepill daemons but I couldn't determine if that was my fail or what
[2012-07-16 18:23:41 -0400] hoover_damm: geekbri, and do remember when you bluepill load file.pill it should quit the old daemon and start a new one... that can have interesting side effects i you run chef-client a few times very fast
[2012-07-16 18:23:57 -0400] geekbri: hoover_damm: the CB isn't the issue I don't think.  This is something with bluepill itself.  I find it odd that if i send ill signals to the bash shell when i run it myself its fine.  but the bash shell run by bluepill... it kills the shell but not the process spawned by it
[2012-07-16 18:24:16 -0400] hoover_damm: geekbri, basically I stopped using the lwrp itself and redid the load by hand and it seemed to work
[2012-07-16 18:24:26 -0400] hoover_damm: I don't have access to that code any longer
[2012-07-16 18:24:31 -0400] hoover_damm: as i don't work for that client
[2012-07-16 18:24:48 -0400] geekbri: I'll goof around, I just know you said you've used bluepill so I thought you might have some input.  I'll try the LC_ALL thing
[2012-07-16 18:24:52 -0400] hoover_damm: huh you have a bash shell in bluepill?
[2012-07-16 18:25:00 -0400] hoover_damm: you should gist up that pill
[2012-07-16 18:25:05 -0400] geekbri: hoover_damm: will in one second.
[2012-07-16 18:25:08 -0400] hoover_damm: i bet your problem is more with the pill and the pattern your doing
[2012-07-16 18:27:17 -0400] geekbri: hoover_damm: https://gist.github.com/3124143
[2012-07-16 18:27:23 -0400] geekbri: hoover_damm: I'm willing to be that is true too :)
[2012-07-16 18:29:18 -0400] hoover_damm: lol
[2012-07-16 18:29:21 -0400] hoover_damm: stop sourcing activate
[2012-07-16 18:29:25 -0400] hoover_damm: geekbri, you can set the environment on that right
[2012-07-16 18:29:26 -0400] geekbri: hoover_damm: I have to.
[2012-07-16 18:29:29 -0400] hoover_damm: geekbri, no you don't
[2012-07-16 18:29:40 -0400] geekbri: thats not virtual envs activate.
[2012-07-16 18:29:44 -0400] hoover_damm: VIRTUAL_ENV="/opt/graphite/.venv"
[2012-07-16 18:29:44 -0400] hoover_damm: export VIRTUAL_ENV
[2012-07-16 18:29:44 -0400] hoover_damm: _OLD_VIRTUAL_PATH="$PATH"
[2012-07-16 18:29:45 -0400] hoover_damm: PATH="$VIRTUAL_ENV/bin:$PATH"
[2012-07-16 18:29:48 -0400] hoover_damm: oh
[2012-07-16 18:29:49 -0400] hoover_damm: doh
[2012-07-16 18:30:08 -0400] geekbri: yeah, the unfortunate truth is, thats a temporary hack.  basically that is part of our application, another chef recipe is generate a file that gets sourced
[2012-07-16 18:30:29 -0400] geekbri: I can probably hack it up to generate the entries again myself from node attributes, but i was trying to avoid it, as this solution is only temporary till something gets moved.
[2012-07-16 18:30:44 -0400] geekbri: But yeah youre right i dont HAVE to, but for now i'd sure like to, to save myself a butt ton of work :)
[2012-07-16 18:31:42 -0400] geekbri: I'll just go do it the hard way, since I know it will work :)
[2012-07-16 18:31:54 -0400] hoover_damm: ouch yeah try and hack around activate
[2012-07-16 18:31:57 -0400] hoover_damm: the bash is blocking you
[2012-07-16 18:32:00 -0400] hoover_damm: and adding a layer of stupidity
[2012-07-16 18:32:42 -0400] geekbri: Yeah, well surprise surprise, I had this stuff all ready to go, until the person who wrote the stuff realized they needed parts of another project that hadn't been separated out yet.  So of course I look like the blocker now even though I'm not really :-P
[2012-07-16 18:32:54 -0400] geekbri: ill do what you said though
[2012-07-16 18:37:35 -0400] maek: so confused. Im trying to change a node attribute being set by a cookbook on a single node and Ive changed it under default and override and it keeps getting deleted from the override section and reverted in the default section. Something Im missing?
[2012-07-16 18:37:41 -0400] karsten: Is there a good simple command to check/verify knife configuration is set up properly?  The wiki suggests "run a simple knife command" which ... isn't eminantly scriptable.
[2012-07-16 18:37:55 -0400] maek: knife node list
[2012-07-16 18:38:52 -0400] maek: karsten: you could make a client and then delete the client
[2012-07-16 18:40:57 -0400] j|: mike_the_man || mikeT_HeMan
[2012-07-16 18:43:26 -0400] karsten: maek: is there a cononical way that 'knife node list' fails?
[2012-07-16 18:43:34 -0400] karsten: s/cononical/canonical/
[2012-07-16 18:43:56 -0400] knuckolls: karsten: if you don't have any nodes it might not show anything, you should have clients though. try knife client list
[2012-07-16 18:44:21 -0400] maek: karsten: does exit code not tell you?
[2012-07-16 18:44:44 -0400] karsten: Hrm.
[2012-07-16 18:46:31 -0400] karsten: Background:  we're using chef under a number of different environments. I'm in Ubuntu (others are Slack, Debian, and Cygwin/Windows).  Looking at a shell configuration for RVM + chef + git that we can invoke (via a bash function) and test for success/failure.
[2012-07-16 18:47:07 -0400] karsten: type rvm | head -1 | grep -q '^rvm is a function$' && echo "RVM OK' || echo "RVM misconfigured"
[2012-07-16 18:47:10 -0400] karsten: ... for example
[2012-07-16 18:47:18 -0400] karsten: Tests rvm.
[2012-07-16 18:47:45 -0400] karsten: I've got a distro-installed version of knife/chef (which I should probably get rid of).
[2012-07-16 18:48:14 -0400] geekbri: knife node status "*:*" ?
[2012-07-16 18:48:38 -0400] geekbri: sorry no node inthere, just knife status "*:*"
[2012-07-16 18:48:46 -0400] hoover_damm: i always get burned on shell tricks eventually
[2012-07-16 18:48:56 -0400] geekbri: I always get burned on shell tricks.
[2012-07-16 18:48:58 -0400] karsten: hoover_damm: What's your suggestion?  I'm not happy with it, but nothing else seems to work / gets us to where we want to be.
[2012-07-16 18:49:09 -0400] hoover_damm: karsten, os x? brew
[2012-07-16 18:49:13 -0400] karsten: s/not happy/not entirely happy/
[2012-07-16 18:49:20 -0400] karsten: hoover_damm: Debian / Ubuntu.
[2012-07-16 18:49:30 -0400] hoover_damm: karsten, why are you using rvm on debian/ubuntu?
[2012-07-16 18:49:36 -0400] hoover_damm: karsten, because it's always out of date?
[2012-07-16 18:49:52 -0400] karsten: hoover_damm: Because the distro packages aren't sufficiently current.
[2012-07-16 18:49:53 -0400] geekbri: jtimberman has a good blog post about rolling your own ruby packages on ubuntu/deb
[2012-07-16 18:49:58 -0400] geekbri: using fp
[2012-07-16 18:49:59 -0400] geekbri: m
[2012-07-16 18:50:35 -0400] hoover_damm: karsten, there's alternatives... you can build your own package like me and use the qa packages
[2012-07-16 18:50:53 -0400] hoover_damm: karsten, http://packages.qa.debian.org/r/ruby1.9.1.html
[2012-07-16 18:51:05 -0400] geekbri: karsten: http://jtimberman.posterous.com/debianubuntu-package-for-ruby-192-with-fpm
[2012-07-16 18:51:05 -0400] karsten: hoover_damm: At this point suggesting a change would probably get me fired.  We've gone the RVM route.
[2012-07-16 18:51:14 -0400] geekbri: well then, rvm it is :)
[2012-07-16 18:51:17 -0400] karsten: But thanks for the links.
[2012-07-16 18:51:30 -0400] hoover_damm: karsten, building ruby properly would get you fired? oh dear
[2012-07-16 18:51:35 -0400] hoover_damm: karsten, hope you can find a saner job soon
[2012-07-16 18:52:07 -0400] karsten: hoover_damm: No.  Backtracking from what's a currently working config on a very late project would be the problem.
[2012-07-16 18:52:24 -0400] hoover_damm: karsten, heh rvm/rbenv is such a annoying problem to work with
[2012-07-16 18:52:36 -0400] geekbri: +1
[2012-07-16 18:52:49 -0400] hoover_damm: great for development and local use
[2012-07-16 18:52:52 -0400] hoover_damm: horrible on servers
[2012-07-16 18:52:59 -0400] karsten: hoover_damm: As I said: I'm not entirely happy with it.  It seems to get the job done.  If we can swap it out later so much the better.
[2012-07-16 18:53:15 -0400] karsten: Fortunately we only seem to need it for desktop/workstation node use. Not on servers.
[2012-07-16 18:53:21 -0400] hoover_damm: the problem is the whole pattern of using shell to install rubies and swap it out
[2012-07-16 18:53:22 -0400] hoover_damm: is weak
[2012-07-16 18:53:35 -0400] hoover_damm: grab ruby source, ./configure --prefix=/some/path && make install
[2012-07-16 18:53:37 -0400] atomic-penguin: with the windows_package provider, can I pass a custom uninstall command?
[2012-07-16 18:53:39 -0400] karsten: hoover_damm: The official Chef guidance was to use RVM from what I could see.
[2012-07-16 18:54:09 -0400] hoover_damm: basically the problem I have with RVM is you have to take steps to fix sudo so it doesn't haunt you
[2012-07-16 18:54:13 -0400] karsten: And it's not as if Ruby packaging for Debian hasn't had its warts:  http://www.lucas-nussbaum.net/blog/?p=617
[2012-07-16 18:54:20 -0400] hoover_damm: and then your process management such as monit or bluepill
[2012-07-16 18:54:22 -0400] hoover_damm: becomes even harder
[2012-07-16 18:54:32 -0400] atomic-penguin: Maybe, I should use a windows_batch, or execute resource
[2012-07-16 18:54:40 -0400] hoover_damm: I realize i'm the bearer of bad news
[2012-07-16 18:54:46 -0400] karsten: hoover_damm: I haven't had to use sudo -- but then, I'm doing a local single-useronly install of rvm.
[2012-07-16 18:54:52 -0400] hoover_damm: and yes Debian's packaging has its warts
[2012-07-16 18:54:58 -0400] hoover_damm: that's why i linked you to the debian package source
[2012-07-16 18:55:03 -0400] hoover_damm: so you can comment out the patchy warts
[2012-07-16 18:55:06 -0400] hoover_damm: and have a wart free deb
[2012-07-16 18:55:48 -0400] hoover_damm: there's also ppa's as well that can provide ruby
[2012-07-16 18:55:58 -0400] karsten: What's that old saying?  "They can't take the hypocrisy out of Christmas, it's the only part I enjoy".
[2012-07-16 18:56:07 -0400] karsten: Dittos warts and Debian packages.
[2012-07-16 18:56:22 -0400] sascha_d: atomic-penguin you could try the custom installer type with options
[2012-07-16 18:56:41 -0400] sascha_d: I don't have an actual answer for you.  Just ideas though :)
[2012-07-16 19:00:55 -0400] geekbri: using rvm isn't so terrible if you are using it on a per user basis.  If you are trying to install a shared .rvm installation where users can have their own gemsets, in my experience... that is a disaster
[2012-07-16 19:01:09 -0400] rcotoni: yes
[2012-07-16 19:01:11 -0400] rcotoni: it isn't meant for that
[2012-07-16 19:01:26 -0400] geekbri: it 'can do it' supposedly, I highly recommend not trying it.
[2012-07-16 19:03:53 -0400] karsten: hoover_damm: If I'm reading jtimberman right -- that's a Debian-specific solution, correct?  We're multi-platform here.  RVM seems to be a fit, even if a wonky one.
[2012-07-16 19:03:59 -0400] karsten: bbl.
[2012-07-16 19:04:25 -0400] geekbri: you can use FPM to build rpm packages as well.
[2012-07-16 19:04:51 -0400] hoover_damm: karsten, you use rpm too?
[2012-07-16 19:04:53 -0400] hoover_damm: poor thing
[2012-07-16 19:05:04 -0400] geekbri: the process of creating .rp
[2012-07-16 19:05:19 -0400] geekbri: .rpm's and .deb's both suck equally.  Its pretty crummy that they are both still such a massive pain
[2012-07-16 19:06:31 -0400] jtoft: Is there anyway to get a provider to act like a definition re: attributes?
[2012-07-16 19:06:59 -0400] jtoft: by that I mean, is there a way to make a provider take undefined attributes, and pass them to a params hash?
[2012-07-16 19:17:41 -0400] atomic-penguin: sascha_d, yeah I tried that
[2012-07-16 19:17:58 -0400] sascha_d: windows is a strange and mysterious world
[2012-07-16 19:18:10 -0400] sascha_d: the last person I worked with on chef/windows opted to exec the hell out of everything
[2012-07-16 19:18:20 -0400] sascha_d: and I can't even get upset about it
[2012-07-16 19:19:07 -0400] karsten: hoover_damm: There are some CentOS and RHEL boxes, though we're mostly getting away from them.  Mostly Mac, Debian, Ubuntu, Slack, and Windows.
[2012-07-16 19:19:31 -0400] karsten: hoover_damm: I *don't* use RPM-based distros if I can help it.
[2012-07-16 19:19:47 -0400] hoover_damm: karsten, ouch you poor thing
[2012-07-16 19:20:01 -0400] hoover_damm: then perhaps rvm/rbenv is acceptable
[2012-07-16 19:20:02 -0400] hoover_damm: :(
[2012-07-16 19:20:14 -0400] geekbri: so basically you just need to automate the installation of chef so engineers can interact with the chef server?
[2012-07-16 19:20:19 -0400] karsten: hoover_damm: What's your preferred poison?
[2012-07-16 19:20:24 -0400] karsten: geekbri: Yes.
[2012-07-16 19:20:43 -0400] karsten: geekbri: for values of "automate" equating largely to "follow the instructions on this Wiki page".
[2012-07-16 19:21:06 -0400] geekbri: karsten: why not just have them install it to the system ruby and save yourself the headache.  AFter all, its not YOUR machine :)
[2012-07-16 19:21:44 -0400] hoover_damm: karsten, dunno
[2012-07-16 19:21:54 -0400] karsten: geekbri: Because that lacks features we need to interact with AWS.  Trust me, that was my first approach.  it failed pretty massively.
[2012-07-16 19:22:15 -0400] karsten: hoover_damm: all technology sucks.  Some sucks less.  I'm relatively happy with the suck-factor of Debian myself.
[2012-07-16 19:22:23 -0400] karsten: geekbri: Hence the RVM approach.
[2012-07-16 19:23:01 -0400] geekbri: karsten: what we do here is we just have an "ops" repo with a .rvmrc file, a Gemfile, and some knife.rb.example files
[2012-07-16 19:23:28 -0400] geekbri: karsten: users just install rvm, checkout the repo, change into the directory, bundle install, rename the example file with a handfull of changes and they are off and running
[2012-07-16 19:23:55 -0400] geekbri: I mean I might have left out a step or two, but thats basically the gist of it
[2012-07-16 19:24:00 -0400] karsten: geekbri: That's what we're aiming for, more or less.
[2012-07-16 19:24:18 -0400] geekbri: karsten: so where is your hiccup?
[2012-07-16 19:25:49 -0400] karsten: geekbri: Most recently, a bunch of stuff relating to shell environment and, mostly, authentication tokens.  Chef, RVM, git, AWS.  Also using vagrant.
[2012-07-16 19:25:50 -0400] geekbri: I was of the opinion everybody here should just use their knife via a vagrant VM so I wouldn't have to deal with all the platform differences but I got voted off on that one :-P
[2012-07-16 19:26:22 -0400] karsten: geekbri: That's actually something that's occured to me -- also to use vagrant for engineering test environments as well.
[2012-07-16 19:26:51 -0400] geekbri: Well if you come across a specific issue let me know, i might be able to provide some guidance.
[2012-07-16 19:27:13 -0400] karsten: geekbri: How long have you been using chef, and on what sort of hosting environment (ec2, bare metal, ... ?)
[2012-07-16 19:27:34 -0400] karsten: geekbri: I think I've just unkinked the most recent blockers.  Now to actually start defining / modifying some roles.
[2012-07-16 19:27:35 -0400] geekbri: karsten: we use hosted chef (although we did have our own server for a while).  I've been using chef for..... um. 7 months?  We currently use Ec2
[2012-07-16 19:27:56 -0400] geekbri: I've built some plugins on top of knife to automate the creation of our servers based on yml file definitions as well
[2012-07-16 19:28:03 -0400] karsten: OK.  We're about four months into development.
[2012-07-16 19:28:30 -0400] geekbri: when I say "we" I basically mean "me".  There are other engineers here, and they use knife and chef, but they aren't responsible for it
[2012-07-16 19:28:36 -0400] geekbri: they just use it to interact now and again :-P
[2012-07-16 19:29:54 -0400] karsten: Team of 4 principles here, (ops), another 7 or so (eng & QA) who'll be playing with it once we've got something just shy of criminally insane set up.
[2012-07-16 19:54:14 -0400] senilegenius: hello all.
[2012-07-16 19:54:15 -0400] senilegenius: i would like to upgrade my chef server instancebut now sure how since i installed some time ago from rbel6 repo.
[2012-07-16 19:54:20 -0400] senilegenius: any tips in migrating from a chef-server v0.10.6 install using rbel6 repo to usingi dunnoinstall via boostrap?
[2012-07-16 19:55:07 -0400] geekbri: dont shut down the old one till you know the new one works ! ;)
[2012-07-16 19:57:18 -0400] senilegenius: geekbri: heh. it's the same one! :) physical box-wise. guessing bootstrap process installs into /opt/chef now like the client does, right?
[2012-07-16 19:57:39 -0400] geekbri: I have'nt used the omnibus yet, so i can't say.
[2012-07-16 19:59:58 -0400] dwhsix: is there a rails quickstart that uses omnibus?  I had so much trouble switching to 10.12 with an existing project, would be nice to have a reference project to look at...
[2012-07-16 20:02:02 -0400] lawrenceseattle: can I specify the chef environment of a node in node json?  I'm running chef solo.  didn't find an obvious way to do so.
[2012-07-16 20:04:10 -0400] knuckolls: lawrenceseattle: i'm not so sure that environments exist in chef-solo at all. i could be proven wrong though...
[2012-07-16 20:04:49 -0400] lawrenceseattle: Looks like if I just monkey patched chef-solo to pass on environment on the command line it would probably work
[2012-07-16 20:06:13 -0400] lawrenceseattle: looks like you can specify environment in nodes with ruby
[2012-07-16 20:11:37 -0400] erratic: http://pastie.org/4267960
[2012-07-16 20:11:57 -0400] erratic: how could I add a conditional to keep it from nilling on nil class
[2012-07-16 20:13:16 -0400] knuckolls: break up the method chain into variables and test to see .length != nil or 0 before working with the returned data
[2012-07-16 20:13:54 -0400] knuckolls: or use the inline if syntax, || or something like that.
[2012-07-16 20:14:00 -0400] ssd7: Ohai Chefs!
[2012-07-16 20:14:12 -0400] erratic: hi chickenscratch
[2012-07-16 20:14:30 -0400] jtimberman: ssd7: ohai!
[2012-07-16 20:14:45 -0400] erratic: ohai2u
[2012-07-16 20:15:43 -0400] erratic: knuckolls Im not sure how I would do that with something like this can you give me an example
[2012-07-16 20:15:48 -0400] erratic: I'm no rubyist
[2012-07-16 20:19:22 -0400] knuckolls: erratic: i just ripped it apart into variables you can fool with. i didn't add the logic but i showed you where it would go
[2012-07-16 20:19:23 -0400] knuckolls: https://gist.github.com/eb6e1587391d50e41935
[2012-07-16 20:19:27 -0400] knuckolls: hope that's helpful
[2012-07-16 20:19:47 -0400] erratic: cool thank you
[2012-07-16 20:20:05 -0400] erratic: ah I see
[2012-07-16 20:25:51 -0400] karsten: How do I see what pemfile knife is using?
[2012-07-16 20:26:09 -0400] karsten: outside our chef repo, knife works as advertised.  Inside it doesn't.
[2012-07-16 20:26:20 -0400] jtoft: cat ~/.chef/knife.rb
[2012-07-16 20:26:30 -0400] jtimberman: karsten: i wrote a knife plugin (knife-config gem) to provide that :)
[2012-07-16 20:26:36 -0400] karsten: The error is "Faile to authenticate ... with key ..."
[2012-07-16 20:26:47 -0400] karsten: jtimberman: Hey, you're famous.
[2012-07-16 20:26:52 -0400] jtimberman: aw shucks
[2012-07-16 20:27:02 -0400] jtimberman: ;)
[2012-07-16 20:27:05 -0400] karsten: jtimberman: rvm install knife-config-gem?
[2012-07-16 20:27:14 -0400] jtimberman: gem install knife-config
[2012-07-16 20:27:34 -0400] karsten: (we're using rvm, I'm on ubuntu 11.10).
[2012-07-16 20:27:40 -0400] qhartman: I'm trying to set a cookbook attribute like this 'default[:my_cookbook][:my_attribute] = "#{node[:my_other_env_attribute]}Modifier"' but chef complains of Nilclass problem on that line even though :my_other_env_attribute is set. What am I doing wrong?
[2012-07-16 20:27:58 -0400] karsten: jtimberman: ERROR:  Could not find a valid gem 'knife-config-gem' (>= 0) in any repository
[2012-07-16 20:28:06 -0400] jtimberman: knife-config
[2012-07-16 20:28:06 -0400] karsten: Doh!
[2012-07-16 20:28:17 -0400] jtimberman: negative!
[2012-07-16 20:28:33 -0400] karsten: Wouldn't a negative idiot make me worse that stupid?
[2012-07-16 20:28:49 -0400] karsten: Um.  Usage links/tips?
[2012-07-16 20:29:24 -0400] jtimberman: knife config --help
[2012-07-16 20:29:49 -0400] jtimberman: The readme is here: http://rubydoc.info/gems/knife-config/1.1.0/file/README.md
[2012-07-16 20:29:50 -0400] karsten: Danke
[2012-07-16 20:29:57 -0400] jtimberman: (rubydoc.info is a great site)
[2012-07-16 20:31:49 -0400] mhalligan: my git-fu is pretty weak and https://github.com/cookbooks/about doesn't actually work
[2012-07-16 20:31:54 -0400] karsten: Cool. That shows me the client key file, which is what I'm hunting for.
[2012-07-16 20:32:04 -0400] mhalligan: is there a better place to figure out the cookbook workflow?
[2012-07-16 20:38:57 -0400] qhartman: found the answer to my above question. thanks.
[2012-07-16 20:57:55 -0400] erratic: anyone seen this?
[2012-07-16 20:57:56 -0400] erratic: http://pastie.org/4268196
[2012-07-16 20:58:12 -0400] erratic: I keep chowning the solr directory and it keeps getting changed back
[2012-07-16 20:58:14 -0400] erratic: why
[2012-07-16 20:58:45 -0400] jtoft: You probably have some other recipe that modifies it in your dependency/include chain
[2012-07-16 20:59:01 -0400] erratic: ./var/log/chef?
[2012-07-16 20:59:21 -0400] erratic: drwxr-xr-x  2 root      root       4096 Jul 16 08:59 chef
[2012-07-16 20:59:38 -0400] erratic: Im talking about having to change it back to chef:chef
[2012-07-16 20:59:43 -0400] erratic: for logs on the chef server
[2012-07-16 20:59:49 -0400] erratic: what cookbook would do that
[2012-07-16 21:23:04 -0400] karsten: Lunchtime.
[2012-07-16 21:23:16 -0400] karsten: ... and back (helps to hit <enter>).
[2012-07-16 21:23:30 -0400] erratic: was about to say
[2012-07-16 21:23:31 -0400] erratic: you're fired
[2012-07-16 21:23:32 -0400] karsten: jtimberman: Thanks, your gem unearthed the problem.
[2012-07-16 21:23:43 -0400] karsten: erratic: Don't give 'em any ideas.
[2012-07-16 21:24:41 -0400] karsten: erratic: I'm goofing off more efficiently.
[2012-07-16 21:24:44 -0400] Urocyon: anyone working with knife/vsphere integration?  I see what looks like a vsphere plugin on github.  Anyone got an opinion on using it?
[2012-07-16 21:25:23 -0400] mkmkmk: hey all
[2012-07-16 21:35:40 -0400] erratic: anyone got a good vagrant doc to suggest?
[2012-07-16 21:36:55 -0400] miketheman: vagrantup.com ?
[2012-07-16 21:42:10 -0400] karsten: miketheman: Nope.
[2012-07-16 21:42:20 -0400] karsten: erratic: Tell me when you find it.
[2012-07-16 21:46:48 -0400] karsten: One of the bits I'm a bit confused over is how Vagrant and Chef play WRT directory structures.  Do I build/launch vagrant instances from within a given Chef repo?
[2012-07-16 21:47:04 -0400] karsten: Where Chef repo == git repo tree for my chef project.
[2012-07-16 21:50:10 -0400] knuckolls: karsten
[2012-07-16 21:50:11 -0400] knuckolls: https://github.com/garrettux/knife-vagrant
[2012-07-16 21:50:23 -0400] knuckolls: let knife create your vms and bootstrap them
[2012-07-16 21:50:48 -0400] cwj: neat
[2012-07-16 21:52:02 -0400] knuckolls: disclaimer: i've never used that plugin, i use knife-ec2 and knife-euca and it serves the same purpose for vagrant
[2012-07-16 21:52:50 -0400] miah: i just use veewee to build vagrant boxes
[2012-07-16 21:53:16 -0400] miah: there are tons of 'vagrant for teams' type docs out there
[2012-07-16 21:54:17 -0400] cwj: yes i have been using veewee also
[2012-07-16 21:57:40 -0400] ashb: hmmm how do i convert a string into a tuple of just one string
[2012-07-16 21:57:55 -0400] ashb: totally the wrong channel for python support.
[2012-07-16 21:57:57 -0400] ashb: carry on
[2012-07-16 22:12:18 -0400] miah: karsten: i use librarian to manage my vagrant repositories so that i can test / dev certain roles / cookbooks. so no. i don't use the same repo as i use for my chef repo. but i use the same cookbooks.
[2012-07-16 22:17:01 -0400] Majost: I am having an issue using encrypted data bags, following the examples provided on the opscode wiki.
[2012-07-16 22:17:35 -0400] Majost: when I try to use an element of the retrieved object, it seems to pass the entire object
[2012-07-16 22:18:52 -0400] Majost: nm
[2012-07-16 22:18:54 -0400] Majost: just got it
[2012-07-16 22:18:55 -0400] Majost: hah
[2012-07-16 22:25:33 -0400] mhalligan: the python cookbook seems a bit weird. I'm not quite sure why it seems to install pip using easy_install by default with no attempt to install from system packages
[2012-07-16 22:25:49 -0400] mhalligan: does anyone know what the logic is there? on ubuntu 12.04 I'm struggling a lot with this one
[2012-07-16 22:26:20 -0400] miah: i think most people use pip with virtualenv
[2012-07-16 22:26:30 -0400] miah: because system packages generally = shitboxes
[2012-07-16 22:26:45 -0400] mhalligan: miah: these packages seem just as shitty
[2012-07-16 22:26:57 -0400] mhalligan: like they're missing command-line options the cookbook expects :/
[2012-07-16 22:27:03 -0400] miah: please fix =)
[2012-07-16 22:27:13 -0400] doomviking: mmm shitboxes
[2012-07-16 22:27:20 -0400] miah: last i used the python thing (with my graphite cookbook) it worked fine in ubuntu.. but never tested it in rhel
[2012-07-16 22:27:33 -0400] mhalligan: miah: which version?
[2012-07-16 22:29:11 -0400] karsten: knuckolls: We're using vagrant and knife, though I'm not entirely sure how the two do their magic.
[2012-07-16 22:29:43 -0400] karsten: We've been using veewee to build the boxes (or our consultant is).
[2012-07-16 22:31:36 -0400] karsten: Jamarty: Oh, there you are.
[2012-07-16 22:32:06 -0400] karsten: embarassingly stupid question:  cheffy way to set hostname on a node?
[2012-07-16 22:33:46 -0400] mattray: karsten: what kind of box?
[2012-07-16 22:33:55 -0400] karsten: Ubuntu / Debian.
[2012-07-16 22:34:04 -0400] mattray: karsten: I tend to let the cloud provider name them for me :)
[2012-07-16 22:34:10 -0400] karsten: catting a value to /etc/hostname and running 'hostname' as root would be a decent provider.
[2012-07-16 22:34:22 -0400] mattray: and I wrote a name randomizer for knife-hp and knife-openstack
[2012-07-16 22:34:40 -0400] mattray: since they require named nodes
[2012-07-16 22:35:07 -0400] erratic: http://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Inside_a_Balut_-_Embryo_and_Yolk.jpg/200px-Inside_a_Balut_-_Embryo_and_Yolk.jpg
[2012-07-16 22:35:30 -0400] karsten: We'd like the hostname to be the chef node name.  Unless that's a really bad idea.
[2012-07-16 22:36:16 -0400] miah: mhalligan: hrm. i was doing my testing in April?
[2012-07-16 22:36:26 -0400] mattray: karsten: nothing wrong with that
[2012-07-16 22:36:56 -0400] mattray: miah: how's the dhcp stuff coming?
[2012-07-16 22:38:03 -0400] miah: mattray: been busy in nagios hell. will come back to it later.
[2012-07-16 22:38:15 -0400] mattray: no rush, just curious
[2012-07-16 22:38:19 -0400] miah: possibly later today
[2012-07-16 22:38:26 -0400] miah: but i ran into a fun problem that is going to take some code to fix
[2012-07-16 22:38:30 -0400] mattray: I'm off to OSCON, so I'm useless this week
[2012-07-16 22:38:53 -0400] mattray: fun problem? Feel free to send it to me in an email, looking for something to think about on the plane
[2012-07-16 22:38:58 -0400] miah: so, basically. dhcp configuration needs comma's and "'s in appropriate places, for _certain_ options.
[2012-07-16 22:39:13 -0400] miah: and the cookbook doesn't currently handle this
[2012-07-16 22:39:23 -0400] mattray: :) it wasn't done
[2012-07-16 22:39:26 -0400] miah: right
[2012-07-16 22:39:37 -0400] miah: so, i started taking a look at that.. but i didnt write any code over the weekend
[2012-07-16 22:39:41 -0400] mhalligan: miah: thanks. seems to be more specific to older versions of ubuntu. I'll wrap the uglines with a case statement then put some new hotness for 12.04
[2012-07-16 22:42:11 -0400] mattray: miah: I'm off, be back around here on Monday.
[2012-07-16 22:42:14 -0400] miah: ok
[2012-07-16 22:42:22 -0400] miah: i'll drop you a email later, and probably continue coding
[2012-07-16 22:42:26 -0400] miah: enjoy your week =)
[2012-07-16 22:43:28 -0400] mattray: thanks
[2012-07-16 22:52:06 -0400] erratic: Uploading apache2             [1.1.4]
[2012-07-16 22:52:11 -0400] erratic: I DID IT YAAAAAAAAAAAAAAAAAAAAAAAAAAAY
[2012-07-16 22:52:34 -0400] erratic: \/b
[2012-07-16 22:56:43 -0400] vluther: how do I make an action in a recipe run before something else?
[2012-07-16 22:57:05 -0400] vluther: I currently have the action before the action I want to run, but it doesn't seem to be taking
[2012-07-16 22:57:22 -0400] knuckolls_: vluther: paste the code somewhere?
[2012-07-16 22:57:42 -0400] skmidry: I'm trying to build chef from the git master as given in http://wiki.opscode.com/display/chef/Installing+Chef+from+HEAD
[2012-07-16 22:57:58 -0400] skmidry: When trying to build ohai, I keep getting "undefined local variable or method `ohai' for main:Object"
[2012-07-16 22:59:07 -0400] vluther: @knuckolls_ https://gist.github.com/3125612
[2012-07-16 23:00:16 -0400] knuckolls_: yeah it should do the first resource before the second
[2012-07-16 23:00:21 -0400] knuckolls_: paste the logs that show that it's not doing that?
[2012-07-16 23:00:28 -0400] vluther: ooo i found the issue
[2012-07-16 23:00:32 -0400] vluther: epel 7 is already installed
[2012-07-16 23:02:26 -0400] skmidry: trace log at http://pastebin.com/XJFBcHRw
[2012-07-16 23:07:45 -0400] erratic: carrots
[2012-07-16 23:20:03 -0400] masterkorp: j ruby-lang
[2012-07-16 23:25:52 -0400] karsten: Who at opscode would I petition for higher contrast on webpages?  E.g.: http://community.opscode.com/chat/chef/2012-06-14
[2012-07-16 23:26:13 -0400] karsten: Font color: #767676.  Should be #000.
[2012-07-16 23:26:20 -0400] erratic: I know a guy who works for the design company that made that
[2012-07-16 23:26:22 -0400] Bonkers: I imagine your time would be better spend with greasmonkey
[2012-07-16 23:26:34 -0400] Bonkers: spent*
[2012-07-16 23:26:40 -0400] karsten: Bonkers: chrome?
[2012-07-16 23:26:46 -0400] vluther: what's the easiest way to rename a chef node? I spun up a test server, that seems to be working fine, rather than deleting this node, and making a new one.. I'd like to just rename the node
[2012-07-16 23:26:52 -0400] Bonkers: chrome supports greasemonkey natively
[2012-07-16 23:27:02 -0400] Bonkers: chrome extensions are almost exactly greasemonkey scripts
[2012-07-16 23:27:04 -0400] karsten: Bonkers: I'm increasingly viewing pages with the developer tools window open and overridding / rewriting stuff.
[2012-07-16 23:28:08 -0400] karsten: And the actual problem:  just 'vagrant up'd a box. Get "HTTP Request Returned 401 Unauthorized: Failed to authenticate. Ensure that your client key is valid.".
[2012-07-16 23:28:13 -0400] karsten: What do I need to be checking?
[2012-07-16 23:28:25 -0400] vluther: karsten: the .pem file
[2012-07-16 23:28:31 -0400] vluther: in /etc/chef/
[2012-07-16 23:28:42 -0400] karsten: vluther: On the vagrant instance?
[2012-07-16 23:28:55 -0400] vluther: yep
[2012-07-16 23:29:00 -0400] karsten: vluther: There's no pemfile there.
[2012-07-16 23:29:18 -0400] vluther: that's why you're not authorized :)
[2012-07-16 23:29:29 -0400] vluther: is there a client.rb ?
[2012-07-16 23:29:35 -0400] karsten: And here I was thinking it was my orange socks.
[2012-07-16 23:30:12 -0400] vluther: i'm not an expert, but i've usually needed a validation.pem file and a client.pem file
[2012-07-16 23:30:13 -0400] karsten: I found one in /tmp/vagrant-chef-1/
[2012-07-16 23:30:28 -0400] vluther: before the chef-client runs, see what else broke
[2012-07-16 23:30:35 -0400] karsten: Yeah, I'm a bit unclear on how to make the vagrant instance have all the bits that it needs.
[2012-07-16 23:30:36 -0400] vluther: something that's supposed to bootstrap the box is not
[2012-07-16 23:30:43 -0400] karsten: Um.  Where am I looking?  Logs somewhere?
[2012-07-16 23:30:44 -0400] vluther: how are you doing the bootstrap?
[2012-07-16 23:31:04 -0400] karsten: We have a base image that's based on Ubuntu.
[2012-07-16 23:31:42 -0400] vluther: is this a chef-solo thing?
[2012-07-16 23:31:46 -0400] vluther: or a managed chef?
[2012-07-16 23:31:51 -0400] vluther: i'm only familiar with managed chef
[2012-07-16 23:32:07 -0400] karsten: chef solo, I believe.  The box attempts to run 'chef-client'
[2012-07-16 23:32:37 -0400] vluther: ok, so when it runs chef-client it tries to register itself to some box
[2012-07-16 23:32:47 -0400] vluther: what box is it trying to talk to? the one that's returning a 401?
[2012-07-16 23:33:38 -0400] karsten: vluther: that's our chef server, an AWS instance.
[2012-07-16 23:34:14 -0400] karsten: bbiam
[2012-07-16 23:37:14 -0400] karsten: back
[2012-07-16 23:38:45 -0400] karsten: Hrm ... there are pointers to my ~/.chef/validation.pem files in my Vagrantfile.
[2012-07-16 23:39:04 -0400] karsten: That's our AWS PEMfile.
[2012-07-16 23:40:42 -0400] karsten: http://paste.debian.net/179424/ client.rb from the Vagrant instance.
[2012-07-16 23:42:05 -0400] karsten: http://paste.debian.net/179425/ Vagrantfile
[2012-07-16 23:46:17 -0400] vluther: hmm weird, http://tickets.opscode.com/browse/CHEF-2796 says this is fixed.. but when i run chef-client on 0.10.12 it fails
[2012-07-16 23:52:43 -0400] Majost: How do I force a string (password in this case) to be quoted? Currently I am using the rabbitmq cookbook -- and when it creates the user it shells out, which seems to barf on the password
[2012-07-16 23:52:57 -0400] Majost: presumably due to special characters in the password
[2012-07-16 23:54:17 -0400] JasonF: probably use "\"password\""
[2012-07-16 23:54:22 -0400] JasonF: but that's a guess. ymmv
[2012-07-16 23:55:02 -0400] Majost: the password is retrieved via an encrypted data bag
[2012-07-16 23:55:10 -0400] Majost: eg:   password mq_bag[:passwd]
[2012-07-16 23:56:03 -0400] Majost: actually
[2012-07-16 23:56:07 -0400] Majost: that seems to have fixed it
[2012-07-16 23:56:30 -0400] Majost: I had it as: mq_bag["passwd"] before
