[2012-08-29 00:00:55 -0400] _0x783czar: Majost: oo, that's a bit trickier... is your client daemonized?
[2012-08-29 00:01:49 -0400] Majost: _0x783czar: no
[2012-08-29 00:02:01 -0400] Majost: I found the root password, so I was able to su
[2012-08-29 00:02:21 -0400] Majost: but chef-client -o did something which scared the crap out of me
[2012-08-29 00:02:33 -0400] Majost: it removed all the other cookbooks from the node runlist
[2012-08-29 00:03:35 -0400] _0x783czar: Majost: permanently?
[2012-08-29 00:04:51 -0400] yfeldblum: _0x783czar, `knife ssh` provides plenty of additional functionality on top of ssh and `knife cookbook site vendor` provides plenty of additional functionality on top git
[2012-08-29 00:05:46 -0400] _0x783czar: Majost: as I understood, if you executed it as: chef-client -o RUNLIST_ITEM, it would execute that as if it were the only thing in the runlist.  But I guess I was mistaken...
[2012-08-29 00:06:11 -0400] _0x783czar: yfeldblum: gottcha
[2012-08-29 00:07:47 -0400] _0x783czar: Does anyone know of a good way to namespace cookbooks?  My CTO wants to know if we can have a structrue like COOKBOO_NAMESPACE::COOKBOOK::RECIPE
[2012-08-29 00:08:30 -0400] _0x783czar: I saw that you can specify any path for the recipe or cookbook you're adding, but it seems messy.
[2012-08-29 00:08:43 -0400] yfeldblum: _0x783czar, e.g., `knife ssh` is knife-search + knife-node-show + ssh-in-a-for-loop; `knife cookbook site vendor` is wget + tar -xf + complex-git-dance
[2012-08-29 00:09:10 -0400] _0x783czar: yfeldblum: cool
[2012-08-29 00:14:21 -0400] stuartrexking: hoover_damm: I just tested the binstubs flag on bundle exec and it does not install the gems (do a bundle install). I am still unclear on how to install those gems in the context of the application_ruby unicorn lwrp.
[2012-08-29 00:15:05 -0400] stuartrexking: I need to run bundle install after my repo has been cloned, but before unicorn is started.
[2012-08-29 00:15:30 -0400] stuartrexking: I might try using the before_restart block.
[2012-08-29 00:15:41 -0400] stuartrexking: And execute a command to bundle install
[2012-08-29 00:30:54 -0400] hoover_damm: stuartrexking, ... --path
[2012-08-29 00:31:07 -0400] hoover_damm: stuartrexking, you don't install gems into the system gems when you use the --path parameter
[2012-08-29 00:31:15 -0400] hoover_damm: stuartrexking, it installs gems into a GEM_HOME
[2012-08-29 00:32:23 -0400] stuartrexking: I think I have confused myself. I have a gemfile, which lists the dependencies for my project. When I run bundle exec, for the first time, those dependencies don't exist on the system - they have not been installed.
[2012-08-29 00:32:48 -0400] stuartrexking: how does bundle exec know to bootstrap / install the dependencies?
[2012-08-29 00:33:22 -0400] stuartrexking: Or does the installation NEED to happen before running bundle exec?
[2012-08-29 00:38:28 -0400] makerbreaker: can i in some way pass command line arguments to a recipe i am applying to a node's runlist?
[2012-08-29 00:39:39 -0400] makerbreaker: ie....  knife node run list add mydomain.com "recipe[nginx]"  (custom domain => something.com, adduser => custom_user)
[2012-08-29 00:39:42 -0400] makerbreaker: or something of that nature
[2012-08-29 00:48:13 -0400] miah: makerbreaker: attributes
[2012-08-29 00:49:02 -0400] makerbreaker: so, i can specify attributes on the command line
[2012-08-29 01:01:58 -0400] richleland: does anyone know if knife-openstack plays nice w/Rackspace's OpenStack?
[2012-08-29 01:02:11 -0400] miah: makerbreaker: no. use roles.
[2012-08-29 01:03:09 -0400] richleland: I've tried knife-rackspace and replacing the auth_url w/the openstack url as well as knife-openstack with the proper credentials
[2012-08-29 01:03:35 -0400] makerbreaker: miah, can i create roles on the fly?
[2012-08-29 01:03:38 -0400] richleland: no dice - so wondering if either I've got my knife config fubar'd or the functionality just isn't there yet
[2012-08-29 01:03:58 -0400] miah: knife role create
[2012-08-29 01:04:32 -0400] miah: you can specify output file, or just create them by hand in the dsl or json
[2012-08-29 01:05:22 -0400] hoover_damm: stuartrexking, you mean there's no unicorn gem in your gemfile?
[2012-08-29 01:07:19 -0400] makerbreaker: miah, thanks
[2012-08-29 01:14:24 -0400] yfeldblum: hoover_damm, no unicorns in the gemfile?! what about the mongrels and the pumas?!
[2012-08-29 01:17:13 -0400] ssd7: richleland: Mattray would know more, but if you use -VV you might coax some more information out of it that would help debug.
[2012-08-29 01:20:44 -0400] richleland: ssd7 thx - definitely seeing a Fog exception
[2012-08-29 01:30:06 -0400] hoover_damm: yfeldblum, dunno i use jboss
[2012-08-29 01:50:00 -0400] gondoi: is apt.opscode.com not the current way anymore? I ask because it doesn't have 10.12
[2012-08-29 02:01:38 -0400] jtimberman: gondoi: i see 10.12 in main
[2012-08-29 02:01:46 -0400] jtimberman: http://apt.opscode.com/pool/main/c/chef/
[2012-08-29 02:03:03 -0400] gondoi: ahh okay.. i was looking at the wrong disto package file
[2012-08-29 02:03:18 -0400] gondoi: also, the apt location is misleading precise-0.10 :D
[2012-08-29 02:03:35 -0400] gondoi: thanks jtimberman
[2012-08-29 02:28:51 -0400] hoover_damm: jtimberman, how's 12.04.1 feeling?
[2012-08-29 02:29:00 -0400] hoover_damm: jtimberman, it's a few bumps here
[2012-08-29 02:29:23 -0400] hoover_damm: I was suprised at libssl jumping from 1.0.0 to 1.0.1 with an aesni patch
[2012-08-29 02:29:28 -0400] hoover_damm: hehe
[2012-08-29 02:38:30 -0400] reset: anyone a know a way to get at the PATH of the shell executing chef-client
[2012-08-29 02:38:43 -0400] reset: to update it with requirements of software just installed
[2012-08-29 02:39:35 -0400] erikh: post execution?
[2012-08-29 02:39:51 -0400] reset: during execution
[2012-08-29 02:40:17 -0400] erikh: $PATH? Maybe I'm misunderstanding.
[2012-08-29 02:40:46 -0400] erikh: I guess you could do some ugliness in client.rb if that's too early
[2012-08-29 02:40:52 -0400] reset: the execute resource doesn't seem to use the same shell that chef-client is executing in
[2012-08-29 02:41:36 -0400] reset: no, this is for the case when you install software that requires modifications to the environment before it will work properly
[2012-08-29 02:41:43 -0400] erikh: ah, execute uses ... exec IIRC
[2012-08-29 02:41:48 -0400] erikh: which may not propogate the environment
[2012-08-29 02:41:51 -0400] miah: yay excuses!
[2012-08-29 02:41:51 -0400] erikh: vs. bash, for example
[2012-08-29 02:42:02 -0400] reset: let me try bash then
[2012-08-29 02:42:43 -0400] erikh: this is one of those murky areas where there are like 15 C calls which might be used, some of them working one way and others working another way
[2012-08-29 02:43:15 -0400] erikh: the exec/system/spawn pantheon in POSIX is staggeringly large for what it actually does
[2012-08-29 02:43:37 -0400] reset: nah, bash didn't work either
[2012-08-29 02:43:53 -0400] erikh: hmmmmmmmmm
[2012-08-29 02:43:59 -0400] erikh: can you submit an example of what's happening?
[2012-08-29 02:45:09 -0400] jtimberman: hoover_damm: fine so far
[2012-08-29 02:45:17 -0400] jtimberman: hoover_damm: i only have two systems that i manage :)
[2012-08-29 02:45:25 -0400] reset: chef-client executes in a shell. That then goes and executes resources. A resource to install a piece of software requiring environment changes is installed. This software is then later used in another recipe. The other recipe attempts to use the software but the shell of the current executing chef-client does not have the environment changes you've attempted to make via Bash/Exec/Script
[2012-08-29 02:45:29 -0400] jtimberman: its great for testing ubuntu cookbook stuff.
[2012-08-29 02:45:46 -0400] erikh: ahhhhhhhh
[2012-08-29 02:45:49 -0400] jtimberman: reset: re your earlier question about couchdb, getting through the cookbook tickets that are merged for release is still ongoing
[2012-08-29 02:46:07 -0400] erikh: reset: ok, so the problem is that you've got environment that you want to merge up during converge time
[2012-08-29 02:46:09 -0400] reset: jtimberman: thanks, trying to clean up some of our forks here
[2012-08-29 02:46:15 -0400] jtimberman: reset: *nods*
[2012-08-29 02:46:23 -0400] reset: erikh: yes
[2012-08-29 02:46:32 -0400] jtimberman: trust me i don't want you maintaining extra forks any more than you do!
[2012-08-29 02:46:34 -0400] reset: jtimberman: you ever run into this? (what Erik and I are talking about)
[2012-08-29 02:46:54 -0400] erikh: the best suggestion I can make there is to evaluate the environment changes via a notify or something
[2012-08-29 02:47:03 -0400] jtimberman: ENV['PATH']?
[2012-08-29 02:47:09 -0400] erikh: the problem, as I'm sure you're aware, is that the child's environment is not available to the parent
[2012-08-29 02:47:23 -0400] erikh: exec/system/spawn/etc all rely on forking to make that happen
[2012-08-29 02:47:27 -0400] reset: that won't work since you can only notify resources
[2012-08-29 02:47:36 -0400] erikh: notify a ruby_block
[2012-08-29 02:48:13 -0400] reset: hmm let me try that
[2012-08-29 02:48:25 -0400] erikh: basically make the ruby_block populate ENV based on the contents of a file, or something
[2012-08-29 02:48:38 -0400] erikh: maybe a .bashrc or something you're already using... shell env is not hard to parse
[2012-08-29 02:49:10 -0400] erikh: that's really the best suggestion I can offer. maybe you'll get lucky with something better.
[2012-08-29 02:49:37 -0400] erikh: oh, be sure to notify :create, not :run etc ... ruby_block is weird that way.
[2012-08-29 02:50:03 -0400] reset: yep yep
[2012-08-29 02:50:05 -0400] reset: let me give this a shit
[2012-08-29 02:50:13 -0400] erikh: just be sure to wipe after
[2012-08-29 02:51:26 -0400] miah: how do you use those three shells?
[2012-08-29 02:52:17 -0400] reset: erikh: worked. check it
[2012-08-29 02:52:25 -0400] erikh: \o/
[2012-08-29 02:52:44 -0400] reset: https://gist.github.com/3506345
[2012-08-29 02:52:53 -0400] reset: prior to this had exec/bash for the ruby_block stuff
[2012-08-29 02:52:55 -0400] reset: wasn't working
[2012-08-29 02:52:57 -0400] erikh: very nice. relying on chef, too
[2012-08-29 02:53:39 -0400] reset: what do you mean, "relying on chef'?
[2012-08-29 02:54:18 -0400] erikh: well, I thought you were evaulating .bashrc or something
[2012-08-29 02:54:28 -0400] erikh: I see you're using attributes there, which is much better.
[2012-08-29 02:54:30 -0400] miah: you're using a bash resource, you could just set the environment there..
[2012-08-29 02:55:02 -0400] erikh: that isn't the root of the problem though, he has a child process that creates the environment and propogates it to the parent.
[2012-08-29 02:55:09 -0400] erikh: *needs to
[2012-08-29 02:55:33 -0400] reset: erikh: oh yeah I understand now. This is a refactor of the rbenv cookbook
[2012-08-29 02:55:41 -0400] erikh: cool
[2012-08-29 02:55:42 -0400] reset: it's supposed to be highly configurable and extensive
[2012-08-29 02:55:48 -0400] reset: can't be hardcoding shit like a scrub
[2012-08-29 02:55:54 -0400] erikh: I actually did a similar cookbook at around the same time for wildfire
[2012-08-29 02:55:57 -0400] erikh: bummed that I couldn't release it.
[2012-08-29 02:56:04 -0400] reset: I haven't touched this since November
[2012-08-29 02:56:09 -0400] reset: or Decembter
[2012-08-29 02:56:14 -0400] reset: really needs work...
[2012-08-29 02:56:18 -0400] erikh: hrm
[2012-08-29 02:56:25 -0400] erikh: maybe after I find a new job I can jump in.
[2012-08-29 02:56:52 -0400] erikh: for now though, no code until funemployment ends.
[2012-08-29 02:56:54 -0400] reset: miah: you can't set it there because that will spawn a child process. I need the environment of the shell executing chef-client manipulated
[2012-08-29 02:57:07 -0400] miah: oh.
[2012-08-29 02:57:07 -0400] reset: nah this will be a one night refactor, but I appreciate it
[2012-08-29 02:57:13 -0400] erikh: np
[2012-08-29 02:57:18 -0400] reset: just a constant annoyance when I go to do something with a ruby app
[2012-08-29 02:57:26 -0400] reset: have to fix some things in the artifact cookbook too
[2012-08-29 02:58:50 -0400] reset: what happened at the old workplace?
[2012-08-29 02:58:53 -0400] reset: with the*
[2012-08-29 02:58:57 -0400] erikh: eh, I'll tell you elsewhere
[2012-08-29 02:59:03 -0400] erikh: it's pretty fucked to say the least.
[2012-08-29 02:59:25 -0400] reset: ah that sucks
[2012-08-29 03:04:14 -0400] hoover_damm: usually is
[2012-08-29 03:06:08 -0400] hoover_damm: never lost a job and had it not suck
[2012-08-29 03:54:20 -0400] hoover_damm: what's a working lvm cookbook?
[2012-08-29 03:56:38 -0400] stuartrexking: hoover_damm: I am still frustratingly struggling to get application_ruby unicorn to install gems.
[2012-08-29 03:57:02 -0400] stuartrexking: Also, now I am seeing a 403 when trying to bootstrap on hosted chef.
[2012-08-29 03:57:16 -0400] stuartrexking: It's all falling down around me.
[2012-08-29 03:57:30 -0400] hoover_damm: unfortunately i've never used application_ruby
[2012-08-29 03:57:36 -0400] hoover_damm: python here the past 6months
[2012-08-29 03:57:51 -0400] stuartrexking: I setup a very similar environment with python and didn't have any issues.
[2012-08-29 03:58:57 -0400] stuartrexking: I have forked the opscode repos and could make changes, but what I attempting to do should be pretty common, so I am surprised if the cookbooks don't support it.
[2012-08-29 03:59:25 -0400] hoover_damm: most people are bundler friendly now
[2012-08-29 03:59:56 -0400] stuartrexking: I am using bundler, which is why I am confused.
[2012-08-29 04:00:01 -0400] hoover_damm: they don't install gems except bundler
[2012-08-29 04:00:10 -0400] stuartrexking: That is what I have.
[2012-08-29 04:00:24 -0400] hoover_damm: so then you should have a line in application_ruby to do bundle install
[2012-08-29 04:00:27 -0400] hoover_damm: on your application
[2012-08-29 04:01:35 -0400] stuartrexking: If you look at the runit script here https://github.com/opscode-cookbooks/application_ruby/blob/master/templates/default/sv-unicorn-run.erb it's quite clear that bundler is not using binstubs or path like you suggested.
[2012-08-29 04:01:46 -0400] stuartrexking: On my application? In my source?
[2012-08-29 04:02:18 -0400] stuartrexking: Bundler docs say to add this line require "bundler/setup", but it's not clear in the docs what it does.
[2012-08-29 04:02:19 -0400] hoover_damm: i don't use that unicorn cookbook
[2012-08-29 04:13:19 -0400] yfeldblum: stuartrexking, what's it not doing that it should be doing?
[2012-08-29 04:13:30 -0400] stuartrexking: Installing the gems in my Gemfile
[2012-08-29 04:13:33 -0400] Loof: So, if I understand this right... one part of the run list keeps the rest from running
[2012-08-29 04:13:58 -0400] yfeldblum: stuartrexking, what have you got so far?
[2012-08-29 04:14:15 -0400] yfeldblum: Loof, not that i'm aware of
[2012-08-29 04:14:29 -0400] Loof: so if I create a run list /w a few recipies that set up a server... and the last one adds it to my load balancer... I can be assured that servers which don't pass the basic prep... won't get added to the LB?
[2012-08-29 04:15:55 -0400] stuartrexking: yfeldblum: https://gist.github.com/2a068f2f70ea70d47dc9
[2012-08-29 04:16:20 -0400] yfeldblum: Loof, chef will run those recipes which are listed in the expanded run-list, and won't run recipes that are not listed in the expanded run-list
[2012-08-29 04:16:34 -0400] stuartrexking: The app is cloned, but the gems in the Gemset file in the root of my app are never installed.
[2012-08-29 04:16:44 -0400] yfeldblum: Loof, (it will run any recipe which can be traced to a recipe in the expanded run-list via `include_recipe` though)
[2012-08-29 04:17:15 -0400] stuartrexking: I can't see anything in the cookbook that would initiate an install of the Gems. If it's supposed to happen, then I assume there is some convention in the code I have missed.
[2012-08-29 04:17:49 -0400] stuartrexking: If it's not supposed to happen, I would be surprised, given how common Gemfiles / bundler are, and that the runit script uses bundler exec
[2012-08-29 04:19:26 -0400] stuartrexking: The rails section of the application_ruby cookbook indicates that it will install dependencies. The unicorn section does not.
[2012-08-29 04:20:44 -0400] yfeldblum: stuartrexking, the `rails` lightweight provider does a `bundle install`, but the `unicorn` lightweight provider does not; therefore, stick a `rails` block in your code?
[2012-08-29 04:22:09 -0400] stuartrexking: Ok. Still, it seem very unusual that the unicorn LWRP does not bundle install.
[2012-08-29 04:22:15 -0400] yfeldblum: stuartrexking, also there's no reason for binstubs when the assumption is that you're installing gems globally, as root, into the system ruby
[2012-08-29 04:22:36 -0400] yfeldblum: stuartrexking, au contraire - it would be weird if it did
[2012-08-29 04:22:48 -0400] stuartrexking: Really? Can you elaborate?
[2012-08-29 04:24:00 -0400] stuartrexking: I have installed a system ruby using fnichols rvm cookbook during the client run. Would this be the ruby that root would use to install the gems further in the run?
[2012-08-29 04:24:03 -0400] yfeldblum: stuartrexking, why would it go there? - it's always weird to put X into Y unless there's a specific reason to put X into Y, and i don't know of a specific reason here
[2012-08-29 04:24:55 -0400] Loof: Hmm, I thought that chef would abort on error
[2012-08-29 04:25:15 -0400] stuartrexking: The reason is the same as that for the rails LWRP. bundler is a common tool. Why do it for rails, but not unicorn?
[2012-08-29 04:25:19 -0400] yfeldblum: stuartrexking, possibly ... i try not to dabble with installing a system ruby via rvm though
[2012-08-29 04:25:39 -0400] Loof: so if I've got 4 recipes... and the 4th one attaches the server to the LB... then if 3 was app deployment...and that fails in some way
[2012-08-29 04:25:44 -0400] stuartrexking: How do you suggest installing a system (non chef) ruby that root will use?
[2012-08-29 04:25:48 -0400] yfeldblum: stuartrexking, deploying the rails app is the centerpiece; deploying a unicorn-based start script is an optional extra
[2012-08-29 04:25:49 -0400] Loof: I can count on the 4th not running
[2012-08-29 04:26:04 -0400] stuartrexking: yfeldblum: I see.
[2012-08-29 04:26:09 -0400] yfeldblum: stuartrexking, i typically do it with `apt-get install`
[2012-08-29 04:26:13 -0400] stuartrexking: Ok.
[2012-08-29 04:26:29 -0400] stuartrexking: yfeldblum: Thanks for your help. You have given me some other options to try.
[2012-08-29 04:26:42 -0400] stuartrexking: Now to figure out the 403 from opscode hosted chef...
[2012-08-29 04:28:20 -0400] yfeldblum: stuartrexking, but i typically install an app-specific ruby using rvm and and run the app with that copy of ruby
[2012-08-29 04:28:48 -0400] stuartrexking: Do you do that using the application_ruby cookbook, or do you cut your own?
[2012-08-29 04:29:19 -0400] yfeldblum: stuartrexking, i don't use the opscode-cookbooks/application cookbook; i've got my own which knows how to do app-specific rubies
[2012-08-29 04:29:31 -0400] stuartrexking: Ok. Thanks again.
[2012-08-29 04:30:26 -0400] yfeldblum: stuartrexking, but i may be familiar enough with it to answer some people's questions or point others in the direction of answers
[2012-08-29 04:30:46 -0400] stuartrexking: For sure.
[2012-08-29 04:30:53 -0400] yfeldblum: stuartrexking, 403 from knife or from the chef-client?
[2012-08-29 04:30:59 -0400] stuartrexking: both
[2012-08-29 04:31:13 -0400] stuartrexking: Debug logs don't say anything specific
[2012-08-29 04:31:23 -0400] stuartrexking: I can knife status, but can't knife bootstrap
[2012-08-29 04:31:48 -0400] yfeldblum: stuartrexking, how far can you go in knife bootstrap?
[2012-08-29 04:32:04 -0400] stuartrexking: it's the request to get the cookbook versions.
[2012-08-29 04:36:59 -0400] yfeldblum: stuartrexking, is the node & client registered?
[2012-08-29 04:37:16 -0400] stuartrexking: They were, I just removed them to try again.
[2012-08-29 04:43:19 -0400] stuartrexking: yfeldblum: Removing the node and client made no difference.
[2012-08-29 04:43:43 -0400] stuartrexking: Now getting a 401.
[2012-08-29 04:43:45 -0400] stuartrexking: Weird.
[2012-08-29 04:47:08 -0400] stuartrexking: Cleaned up according to the docs. Trying again...
[2012-08-29 04:49:41 -0400] ssd7: Ohai Chefs!
[2012-08-29 04:50:55 -0400] stuartrexking: Damn. Still getting the 403
[2012-08-29 04:53:01 -0400] stuartrexking: Nothing obvious in the stacktrace.
[2012-08-29 05:00:00 -0400] flaccid_: is matt ray in ths chan by any chance? if so his nick?
[2012-08-29 05:01:58 -0400] ssd7: flaccid_: I don't think he is around at the moment.  Anything I can help with?
[2012-08-29 05:02:22 -0400] flaccid_: oh i'm just doing some updates to his squid cookbook, just wanted to give him a heads up on pull and see if i'm doing it ok
[2012-08-29 05:02:58 -0400] flaccid_: you can't use value_for_platform in attributes to set defaults?
[2012-08-29 05:04:19 -0400] flaccid_: this basically ssd7 https://github.com/flaccid/squid-cookbook/blob/master/recipes/default.rb#L21
[2012-08-29 05:04:55 -0400] flaccid_: in particular stuff like the join on #L58
[2012-08-29 05:07:20 -0400] yfeldblum: flaccid, the file is already a gigantic wtf! for using normal-level attributes everywhere in the attributes file instead of default-level attributes, and then secondarily for sticking attributes computed from other non-ohai attributes in the attributes file
[2012-08-29 05:07:48 -0400] yfeldblum: flaccid, oh wait nvm that's not an attributes file
[2012-08-29 05:08:10 -0400] yfeldblum: flaccid, you can use value_for_platform for sure
[2012-08-29 05:08:20 -0400] flaccid_: um yeah, i'm not actually deviating much from matt's original here
[2012-08-29 05:08:44 -0400] flaccid_: node['squid']['config_file'] = File.join(node['squid']['config_dir'], node['squid']['service_name'], '.conf') though, i couldn't do after that though
[2012-08-29 05:09:05 -0400] yfeldblum: flaccid_, sorry, i misread the file at first and i take back that earlier comment
[2012-08-29 05:09:16 -0400] flaccid_: you think i could literally move line 22-58 to attributes/default.rb?
[2012-08-29 05:09:31 -0400] flaccid_: i mean i can try it again, but it error'd last time
[2012-08-29 05:09:39 -0400] yfeldblum: flaccid_, although most of those should be done at the default level probably, but w/e
[2012-08-29 05:09:49 -0400] flaccid_: i wanted to do them at the default level
[2012-08-29 05:09:54 -0400] flaccid_: i'll move it again and get you the error
[2012-08-29 05:10:57 -0400] ssd7: flaccid_: I don't think you can use value_for_platform iirc, but I would still move them to an attribute file
[2012-08-29 05:11:03 -0400] ssd7: just use a case statement or something similar
[2012-08-29 05:11:26 -0400] ssd7: Also, like yfeldblum mentions, I would really try to do as much at the default level as possible.
[2012-08-29 05:11:42 -0400] flaccid_: thats what i did try to do :)
[2012-08-29 05:11:46 -0400] yfeldblum: flaccid_, well, i don't know if this is supported for the future (probably not), but there is always this: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/language.rb#L98-109
[2012-08-29 05:12:49 -0400] yfeldblum: flaccid_, instead of trying to call value_for_platform in the attributes file, which is not available, you use the same one-liner implementation that delegates to another class that is available
[2012-08-29 05:13:33 -0400] yfeldblum: flaccid_, or just use a case expression as ssd7 suggests, since that's canonical ruby and also, coincidentally, pretty simple
[2012-08-29 05:13:51 -0400] flaccid_: i'm not sure i'm smart enough to understand what you mean
[2012-08-29 05:14:33 -0400] flaccid_: i can do a case on the node['platform'] and then i guess nest case on node['platform']['version']
[2012-08-29 05:14:58 -0400] flaccid_: all the above isn't documented though thus why i'm in this situation
[2012-08-29 05:15:29 -0400] yfeldblum: flaccid_, http://pastie.org/private/nsod0nrkzzirpvxhgpiw
[2012-08-29 05:16:16 -0400] flaccid_: ah yeah thanks, thats what i thought from ssd7
[2012-08-29 05:16:57 -0400] flaccid_: value_for_platform to appears to be more suited for attributes and not recipes considering how much it is used on node attributes
[2012-08-29 05:17:14 -0400] flaccid_: *inconsistent*
[2012-08-29 05:20:26 -0400] flaccid_: going to double make sure i can't use value_for_platform though :)
[2012-08-29 05:21:30 -0400] ssd7: Yeah, to be honest, I'm not completely happy with any of the few patterns I've seen with the right way for dealing with supporting multiple platforms in a single cookbook.
[2012-08-29 05:21:44 -0400] flaccid_: hmm i got a feeling its just the joinging i can't do coz of the data types Re-raising exception: TypeError - can't convert Chef::Node::Attribute into String
[2012-08-29 05:22:16 -0400] flaccid_: i will leave the others in attributes/default.rb and put just node['squid']['config_file'] = File.join(node['squid']['config_dir'], node['squid']['service_name'], '.conf') in recipe
[2012-08-29 05:22:17 -0400] yfeldblum: flaccid_, not sure what "joinging" is
[2012-08-29 05:22:22 -0400] flaccid_: and yeah ssd7 i agree with you
[2012-08-29 05:23:36 -0400] flaccid_: this will probably work as long as you set the node attribute in the defaults still its not not a missing method
[2012-08-29 05:24:01 -0400] tylerflint: hi everyone
[2012-08-29 05:24:33 -0400] tylerflint: I'm currently delving into chef and am very impressed
[2012-08-29 05:24:51 -0400] tylerflint: at this point I'm mostly researching...
[2012-08-29 05:25:38 -0400] tylerflint: and as I'm digging, it seems chef is mostly meant for initial configuration
[2012-08-29 05:25:55 -0400] tylerflint: is chef a good tool for updating systems and packages?
[2012-08-29 05:26:03 -0400] flaccid_: 'initial configuration' is kind of a term for the past :)
[2012-08-29 05:26:11 -0400] flaccid_: tylerflint: sure is
[2012-08-29 05:26:25 -0400] tylerflint: great to hear
[2012-08-29 05:26:52 -0400] tylerflint: I've been reading lots of guides, not surprised I missed it
[2012-08-29 05:27:33 -0400] tylerflint: I think my initial understanding is flawed, hopefully someone can point me in a better direction. Here's what I think I understand:
[2012-08-29 05:28:12 -0400] tylerflint: it seems that recipes are run when a recipe is added to a run list
[2012-08-29 05:28:42 -0400] tylerflint: that does make sense
[2012-08-29 05:29:11 -0400] tylerflint: how would I use a recipe that updates something to a newer version?
[2012-08-29 05:29:37 -0400] flaccid_: that 'something' is probably a resource, so it really depends what that 'something' is
[2012-08-29 05:29:48 -0400] tylerflint: ok, that makes sense
[2012-08-29 05:30:07 -0400] tylerflint: so a resource, let's say I install something popular, like apache or redis
[2012-08-29 05:30:25 -0400] tylerflint: something that will be installable via yum or aptitude easily
[2012-08-29 05:30:46 -0400] tylerflint: then a few months down the road decide to update that package
[2012-08-29 05:31:03 -0400] tylerflint: is the right line of thinking that I should try to re-run the recipe?
[2012-08-29 05:31:30 -0400] flaccid_: tylerflint: pretty much, look at the Package resource on the Resources page of the wiki
[2012-08-29 05:32:05 -0400] niklasswe: hllo  a stupid question.. I have just installed chef-server, and wondering if I should create an directory in /etc/chef/ called cookbooks or where should i put the recipet?
[2012-08-29 05:33:02 -0400] flaccid_: ssd7, yfeldblum yeah if value_for_platform is used in default attributes, node attribute values are going to come out as Chef::Node::Attribute and not be usable without processing. thanks for the advice, i'll go the case in attributes
[2012-08-29 05:33:25 -0400] tylerflint: so I saw that, I noticed the :upgrade action...
[2012-08-29 05:33:50 -0400] tylerflint: would I create an "upgrade" recipe?
[2012-08-29 05:33:58 -0400] flaccid_: yes upgrade action will work fine, keeping in mind the package needs to be updated in your package manager's repos
[2012-08-29 05:34:28 -0400] flaccid_: won't need to if the recipe already does it
[2012-08-29 05:35:14 -0400] tylerflint: so how can a recipe be re-run after the initial run list has been completed?
[2012-08-29 05:35:28 -0400] flaccid_: you just run chef again
[2012-08-29 05:35:37 -0400] tylerflint: oh
[2012-08-29 05:35:57 -0400] flaccid_: you can take a more general approach too and upgrade all system packages e.g. https://github.com/flaccid/cookbooks/blob/master/cookbooks/system/recipes/upgrade_packages.rb
[2012-08-29 05:35:59 -0400] tylerflint: ooooh
[2012-08-29 05:36:58 -0400] tylerflint: so chef is meant to be run at any time
[2012-08-29 05:37:17 -0400] tylerflint: and it will run the entire run list again?
[2012-08-29 05:37:32 -0400] flaccid_: yes
[2012-08-29 05:37:57 -0400] tylerflint: that makes a lot more sense
[2012-08-29 05:38:24 -0400] flaccid_: idempotent
[2012-08-29 05:38:43 -0400] tylerflint: got it, big word
[2012-08-29 05:39:07 -0400] flaccid_: so like, your 2nd run might be like watching the matrix for 3 seconds as opposed to 3 minutes..
[2012-08-29 05:39:25 -0400] tylerflint: so the trick is to ensure that certain parts of the recipe won't try to run again
[2012-08-29 05:39:56 -0400] flaccid_: yeah so the core resources do this for, e.g. package resource and when you design yourself just try to do the same thing
[2012-08-29 05:39:58 -0400] tylerflint: I think I read something about setting an attribute on the node after certain critical tasks have run
[2012-08-29 05:40:02 -0400] flaccid_: it can be as simple as using only_if in a resource for example
[2012-08-29 05:40:30 -0400] tylerflint: ok that makes sense
[2012-08-29 05:41:30 -0400] tylerflint: so I'd mostly only need to do that if I don't use package, and instead a custom compilation or something similar?
[2012-08-29 05:42:51 -0400] ssd7: tylerflint: Right, in most cases the chef resources know how to evalutate the current state and only take action if necessary
[2012-08-29 05:43:19 -0400] ssd7: For cases where there is no automatic way to do that (such as execute resource that compiles something from source) not_if and only_if can be used.
[2012-08-29 05:43:33 -0400] flaccid_: yeah pretty much, there are best practices but its important to use core chef and existing cookbooks first
[2012-08-29 05:43:34 -0400] tylerflint: that's fantastic
[2012-08-29 05:44:35 -0400] flaccid_: days are gone of an inline procedural shell script repeating every command
[2012-08-29 05:45:17 -0400] tylerflint: I sure hope so
[2012-08-29 05:46:51 -0400] tylerflint: so in regards to when the run list runs...
[2012-08-29 05:47:18 -0400] tylerflint: from what I understand if the node has chef running as a daemon, it will run whenever the recipes are updated?
[2012-08-29 05:47:55 -0400] tylerflint: I'm trying to search the wiki for more info on this aspect but am not having much luck
[2012-08-29 05:48:28 -0400] flaccid_: chef clients don't run daemons
[2012-08-29 05:48:48 -0400] flaccid_: ssd7 can probably better answer on the options to get a node to reconverge
[2012-08-29 05:49:39 -0400] niklasswe: hllo  a stupid question.. I have just installed chef-server, and wondering if I should create an directory in /etc/chef/ called cookbooks or where should i put the recipet? I have follow the instruction on the wiki-pages..
[2012-08-29 05:50:34 -0400] flaccid_: nntr niklasswe
[2012-08-29 05:52:06 -0400] ssd7: tylerflint: When chef-client runs as a daemon, it simply starts a run at some preset interval
[2012-08-29 05:52:30 -0400] ssd7: there is no "push" mechanism currently to trigger a run on cookbook update
[2012-08-29 05:52:44 -0400] tylerflint: I see
[2012-08-29 05:53:02 -0400] tylerflint: nor with knife?
[2012-08-29 05:53:26 -0400] flaccid_: sorry i meant in context as server. my bads.
[2012-08-29 05:53:38 -0400] ssd7: Currently, the canonical way to set of client runs with knfie would be: knife ssh 'role:*' 'sudo chef-client'
[2012-08-29 05:53:53 -0400] ssd7: the 'role:*' is a search that could be replaced with other searches
[2012-08-29 05:54:03 -0400] flaccid_: you need to knife ssh to get a reconverge?
[2012-08-29 05:54:39 -0400] ssd7: flaccid_: tylerflint Well, if you are running as a daemon or as cron, you can also just wait, and chef-client will run whenver you have it set to run
[2012-08-29 05:54:46 -0400] tylerflint: ok I think I see, so running chef-client on a node triggers a reconverge
[2012-08-29 05:54:52 -0400] ssd7: tylerflint: Yup
[2012-08-29 05:55:06 -0400] tylerflint: knife ssh 'role:*' some command
[2012-08-29 05:55:20 -0400] tylerflint: is a clever way of running a command on multiple nodes
[2012-08-29 05:55:24 -0400] ssd7: right
[2012-08-29 05:55:34 -0400] tylerflint: ha, that is slick
[2012-08-29 05:55:40 -0400] flaccid_: thats the same as chef-solo
[2012-08-29 05:55:48 -0400] flaccid_: whats teh point of running chef-client as a daemon if it doesn't reconverge, or does it?
[2012-08-29 05:55:56 -0400] ssd7: flaccid_: It does
[2012-08-29 05:56:10 -0400] tylerflint: I think the need for both is useful
[2012-08-29 05:56:15 -0400] flaccid_: k tis all sweet then
[2012-08-29 05:56:19 -0400] ssd7: flaccid_: But not in response to anything that happened on the server.
[2012-08-29 05:56:50 -0400] tylerflint: for instance, there may be a new recipe that we want to be around for a few hours after the update, and then routine system updates can just happen whenever
[2012-08-29 05:57:17 -0400] tylerflint: that's great
[2012-08-29 05:57:28 -0400] tylerflint: you guys have been very helpful
[2012-08-29 05:58:49 -0400] flaccid_: the role method is the best strategy here to encapsulate. if you really do need to make a nodes recipes dynamic, do it with roles around it so you can change roles and not the run_list manual..
[2012-08-29 06:01:06 -0400] ssd7: tylerflint: glad we could help :)
[2012-08-29 06:01:34 -0400] tylerflint: this is great stuff. I've got to run for now, but I'm sure I'll be back on tomorrow
[2012-08-29 06:01:41 -0400] tylerflint: thanks again
[2012-08-29 06:08:18 -0400] flaccid_: pleasure tylerflint
[2012-08-29 07:10:29 -0400] hugespoon: hello, im quite new to chef and im curious about two things, 1) is chef a good use case for managing several disparate infrastructures that while having the same basic components (i.e. mysql server, nginx, apache, mail server) but need customized configurations for each infrastructure? and 2) is the best way for me to integrate chef into existing machines (chef-client installs) without possibly mangling what may be in place (already install
[2012-08-29 07:16:32 -0400] flaccid_: hugespoon: 1. yes 2. get the node into chef, just don't run any recipes that change the stuff you don't want changed
[2012-08-29 07:17:18 -0400] ares_cz: hi, I experience chef client to consume gigabytes of memory on 1 of ~200 servers during random chef run on random instruction, nothing interesting in chef client log so far, any hint how to find out a cause?
[2012-08-29 07:22:22 -0400] hugespoon: flaccid_: thanks for the help, but in re: 2, wouldnt installing chef possibly conflict or break with existing installations of things like ruby? if you mean just make alternate packages if i want to avoid that on bootstrap, it can be done, but im just trying to make sure i dont reinvent the wheel so to speak
[2012-08-29 07:24:36 -0400] flaccid_: not if you install chef via omnibus installer
[2012-08-29 07:26:58 -0400] hugespoon: flaccid_: ah thanks, this is exactly what i would need!
[2012-08-29 07:29:19 -0400] flaccid_: coolios hugespoon
[2012-08-29 08:12:19 -0400] niklasswe: any guide how i create my own motd recipes ?
[2012-08-29 08:29:35 -0400] flaccid_: niklasswe: there is probably motd cookbook/recipe out there. if not learn the template resource
[2012-08-29 09:01:24 -0400] jerem`: it it permits to aptitude update repositories within chef recipe ?
[2012-08-29 09:20:34 -0400] anentropic: anyone know about the deploy resource?  from the src code it looks like the migrate and restart actions should occur on every deploy but I'm finding they don't... possibly related to initial deploy failing and having to be restarted
[2012-08-29 09:20:58 -0400] anentropic: is it possible some magic to do with converging is preventing them from running (thinks they already happened?)
[2012-08-29 09:21:04 -0400] anentropic: ?
[2012-08-29 09:24:47 -0400] ringods: jerem: have you looked into the apt cookbook?
[2012-08-29 09:25:06 -0400] ringods: anentropic: can't help you. Never used the deploy resource...
[2012-08-29 09:25:42 -0400] jerem`: ringods: into the apt cookbook ? what do you mean ?
[2012-08-29 09:26:17 -0400] anentropic: ringods: I'm regretting it too. been nearly two weeks of pain. never thought I'd have to read so deep in the chef source just to get a django stack up and running and still be struggling
[2012-08-29 09:26:20 -0400] jerem`: I only need to update my repositories
[2012-08-29 09:26:22 -0400] ringods: jerem: well, you want to update package repositories if I understand your request
[2012-08-29 09:27:14 -0400] ringods: jerem: do you want to add or remove additional apt sources?
[2012-08-29 09:27:25 -0400] jerem`:   notifies :run, resources(:execute => "apt-get update"), :immediately
[2012-08-29 09:27:50 -0400] jerem`: ringods: both possible
[2012-08-29 09:28:05 -0400] ringods: are you using the apt cookbook?
[2012-08-29 09:28:10 -0400] jerem`: no
[2012-08-29 09:29:06 -0400] jerem`: i gonna look it
[2012-08-29 09:29:07 -0400] ringods: jerem: please do. the apt cookbook contains LWRP for adding apt repositories
[2012-08-29 09:29:08 -0400] ringods: https://github.com/opscode-cookbooks/apt
[2012-08-29 09:29:14 -0400] jerem`: thanks
[2012-08-29 09:29:21 -0400] ringods: and signalling the apt-get update.
[2012-08-29 09:37:52 -0400] jerem`: ringods: thx it's working
[2012-08-29 09:38:23 -0400] ringods: jerem: you're welcome.
[2012-08-29 09:51:03 -0400] meineerde: anentropic: the deploy resource remembers the state of the last deploy (probably in /var/cache/chef/revision-deploys)
[2012-08-29 09:51:35 -0400] meineerde: anentropic: iirc it is updated rather early
[2012-08-29 09:51:55 -0400] meineerde: anentropic: you can force a full deployment eh time by using action :force_deploy instead of action:deploy
[2012-08-29 09:52:48 -0400] anentropic: meineerde: thanks for the tip.  I'm running under vagrant and solo, not immediately sure how to use a different action
[2012-08-29 09:53:24 -0400] meineerde: anentropic: well, when you setup the deploy resource in your recipe, you can set the action with its attribute
[2012-08-29 09:54:35 -0400] anentropic: meineerde: I made the mistake of trying to use the application resource, which adds another layer of confusion
[2012-08-29 09:54:55 -0400] meineerde: ah, then you can set force_deploy: true in your data bag
[2012-08-29 09:54:59 -0400] meineerde: anentropic: ^^
[2012-08-29 09:55:55 -0400] anentropic: meineerde: thanks I'll try that. I just found the chef src inside my vm so I'm putting some logging in which will hopefully shed some light too
[2012-08-29 09:56:47 -0400] meineerde: anentropic: I found the application cookbook way too opinionated on one side and way to generic on the other, which is a bad combination.
[2012-08-29 09:57:07 -0400] meineerde: anentropic:  In the end, I rolled my own "template" system :)
[2012-08-29 09:58:41 -0400] anentropic: meineerde: yes, being entirely new to Chef I wanted to piggyback on some existing best practice cookbooks but have since discovered cookbooks are not extensible, the opscode cookbooks are undocumented and have no issue trackers in github, and I'd have been better off rolling my own from scratch
[2012-08-29 09:59:06 -0400] anentropic: I'm having one last try to make it work today before ditching the past week's efforts to do just that
[2012-08-29 09:59:28 -0400] meineerde: anentropic: the opscode cookbooks are bug-trackerd on http://tickets.opscode.com/browse/COOK
[2012-08-29 10:00:39 -0400] meineerde: anentropic: I personally found the opscode cookbooks in a rather good documentation state (with the notable exception of the application cookbook which lacks some detailed usage examples)
[2012-08-29 10:02:25 -0400] anentropic: meineerde: the application and application_python cookbooks are the main ones I've been using. there's basic docs for attributes etc but none of the gotchas or explanation of what is going on behind the scenes which would be useful;
[2012-08-29 10:03:26 -0400] meineerde: anentropic: I just noticed that my knowledge of the application cookbook is kinda outdated. What I know mainly comes from ruby deployments
[2012-08-29 10:07:17 -0400] ringods: anentropic: if you refer to Opscode Cookbooks (http://github.com/opscode-cookbooks), they all have their issue tracking in Jira on http://tickets.opscode.com/browse/COOK
[2012-08-29 10:07:47 -0400] anentropic: ringods: thanks, never realised that
[2012-08-29 10:08:14 -0400] ringods: anentropic: well, that should be documented in each cookbook's README file. :-)
[2012-08-29 10:09:16 -0400] anentropic: ringods: apparently not... glad I didn't just miss the obvious
[2012-08-29 10:09:42 -0400] nacer: hi guys and girls
[2012-08-29 10:10:09 -0400] nacer: it seem passenger_apache2 cookbook is broken with the new omnibus installer
[2012-08-29 10:11:22 -0400] ringods: nacer: I still stay away from the Omnibus installer. It also has issues with ruby_shadow library for the users cookbook. Too much open issues due to the embedded ruby setup and cookbooks not up to date to use it. I stick to Chef Ubuntu packages for the moment.
[2012-08-29 10:11:56 -0400] nacer: ringods: yup, passenger cookbook use some languages[:ruby] attribute
[2012-08-29 10:12:08 -0400] nacer: ringods: so my passenger setup try to use the embeded ruby version :)
[2012-08-29 10:14:20 -0400] anentropic: meineerde: going back to this tip "you can set force_deploy: true in your data bag" ...I'm not currently using a databag, will that work in a node json?
[2012-08-29 10:14:53 -0400] meineerde: anentropic: yeah, the application cookbook used to be configured with data bags only. they don't do that anymore...
[2012-08-29 10:17:46 -0400] meineerde: anentropic: but I think you can do this: application "foo" do; action :force_deploy; end
[2012-08-29 10:18:10 -0400] anentropic: ah, thanks
[2012-08-29 10:59:43 -0400] anentropic: meineerde:  it's: application "foo" do; force true; end   ...gets me a little further
[2012-08-29 11:01:15 -0400] meineerde: anentropic: I think this depends on the exact version of the cookbook you are using, iirc they are currently working on it much. I had a look at the current master on github
[2012-08-29 11:01:53 -0400] anentropic: meineerde: ok, I cloned my copy last week :)
[2012-08-29 11:02:38 -0400] meineerde: anentropic: that should be fine... But in the end, I haven't use the application cookbook since more than a year. so I'm probably no authority there :)
[2012-08-29 11:03:23 -0400] anentropic: meineerde: that's cool, with a bit of logging and the tip about doing a force_deploy I have finally made some progress
[2012-08-29 12:42:21 -0400] bram__:  /7
[2012-08-29 12:47:09 -0400] jtimberman: ringods, anentropic: The CONTRIBUTING file in our cookbooks indicates where the ticket tracker is, and has a link to the "how to contribute" document on the wiki.
[2012-08-29 12:47:46 -0400] ringods: jtimberman: didn't know that as I don't contribute to all cookbooks...
[2012-08-29 12:47:59 -0400] jtimberman: :)
[2012-08-29 12:49:48 -0400] ringods: Joshua, now that I have you here. If a ticket is reopened, how can I get it processed again for review? Ticket in this case is COOK-1379
[2012-08-29 12:54:35 -0400] jtimberman: ringods: we're still getting through the backlog of resolved unreviewed tickets
[2012-08-29 12:54:42 -0400] jtimberman: sorry its taking so long too many awesome contributors :)
[2012-08-29 12:56:17 -0400] gyre007: I have the following in my cookbook attributes: default[:org][:db_name] = "db_#{node[:org][:environment]}"...I'm overriding node[:org][:environment] in the Environment setting it to some value...however when the recipe is run, the override is not happening...uhh
[2012-08-29 12:56:34 -0400] ringods: jtimberman: not officially asking you to review the ticket now, but as a Mac user, if you have to set default attributes for paths, do you prefer unix standard paths (/var, /etc) on mac, or Mac like paths (/Library/Preferences, /Library/Logs) ?
[2012-08-29 12:58:38 -0400] dwinter: So all my guys who know chef are at burningman, and I need to change 1 line in 1 recipe, but its a version of a cookbook in a specific environment on hosted chef("zaas" cookbook version 0.0.1) . I have made the change on my workstation, in chef-repo/zaas-0.0.1, but when i try to 'knife cookbook upload aaas -E Development" it says it cannot find the cookbook in the path. I assume this is because the "zaas" cookbook was downloaded as zaas-0.0.1. help?
[2012-08-29 12:59:19 -0400] geekbri: dwinter: you can just put it in your cookbooks directory and rename it zaas
[2012-08-29 12:59:21 -0400] caleb_: My chef run is bombing out on a bash script resource. chef makes a file in /tmp/chef-script-randomstr. It looks like that file is deleted. Is there anyway to keep that file around so I can inspect it?
[2012-08-29 13:00:10 -0400] dwinter: how do I know it will go back into hosted chef as the correct version? the upload command for knife doesn't take a version definition?
[2012-08-29 13:00:19 -0400] dwinter: and thanks.
[2012-08-29 13:01:51 -0400] gyre007: dwinter you might want to check the path you have set in knife.rb
[2012-08-29 13:02:53 -0400] gyre007: why is debugging chef such a pain :(
[2012-08-29 13:07:48 -0400] geekbri: gyre007: the same reason debugging everything else is a pain :)
[2012-08-29 13:09:37 -0400] gyre007: it DOES look that the override attributes in Environment do not seem to be working mmm
[2012-08-29 13:09:41 -0400] gyre007: #nothappy :)
[2012-08-29 13:11:03 -0400] Jay_Levitt: The postfix cookbook looks for an attribute 'domain' that isn't defined on my server.  I tried defining it in default_attributes in my role, but I still get "ArgumentError: Attribute domain is not defined!" Where does this usually come from?
[2012-08-29 13:12:13 -0400] gyre007: when is the Overriding actually happening ?
[2012-08-29 13:16:02 -0400] gyre007: and why can't I log anything in attributes/default.rb ??
[2012-08-29 13:16:13 -0400] gyre007: I'd like to see what are some attributes set to....
[2012-08-29 13:16:16 -0400] gyre007: is there any way ?
[2012-08-29 13:17:06 -0400] jtimberman: ringods: aren't a lot of the "unix" paths symlinked?
[2012-08-29 13:17:26 -0400] jtimberman: ringods: i don't know if i have a strong preference... we often use the unix style paths for chef things, like /var/chef, /opt/chef, /etc/chef
[2012-08-29 13:18:06 -0400] ringods: jtimberman: I also use unix style paths on Linux, but on a Mac, I prefer to do it the Mac way.
[2012-08-29 13:18:33 -0400] jtimberman: the mac way is probably a better idea for managing services running on os x :)
[2012-08-29 13:19:32 -0400] jtimberman: ringods: one of the principles of chef is that you know the infrastructure you're managing better than chef, so you tell it what you want.
[2012-08-29 13:19:47 -0400] jtimberman: and using sane defaults that make it easy to reason about
[2012-08-29 13:20:17 -0400] jtimberman: so as long as such things are captured in attributes separating the details (how, data) from the pattern (what, recipes)
[2012-08-29 13:23:38 -0400] Jay_Levitt: Hmm.. I've changed the node's run_list to a role that doesn't include postfix, but running chef-client still tries to load postfix.. why might that be?
[2012-08-29 13:24:59 -0400] Jay_Levitt: Oh, specifically it is loading the attributes file from the cookbook
[2012-08-29 13:25:13 -0400] Jay_Levitt: I guess because it's already cached the fact that it needed the postfix cookbook?
[2012-08-29 13:32:04 -0400] Jay_Levitt: chef-client --log_level debug doesn't really tell me how it decided which cookbooks to load in 'INFO: Loading cookbooks [...,postfix,...].  Can I tell it how it depsolved that? DId it come from Hosted Chef?
[2012-08-29 13:41:19 -0400] j|: good bloody morning
[2012-08-29 13:41:42 -0400] masterkorp: j|: woke up with the period ?
[2012-08-29 13:41:48 -0400] j|: haha
[2012-08-29 13:41:51 -0400] j|: nice.
[2012-08-29 13:41:57 -0400] masterkorp: :S
[2012-08-29 13:41:59 -0400] masterkorp: :S
[2012-08-29 13:42:03 -0400] masterkorp: :D
[2012-08-29 13:42:07 -0400] j|: no, buttttttt IF I did
[2012-08-29 13:42:17 -0400] j|: meh. My brain can't come up with anything witty yet
[2012-08-29 13:42:22 -0400] j|: more coffee is needed still
[2012-08-29 13:42:34 -0400] j|: :P
[2012-08-29 13:42:37 -0400] JoshuaMiller: When wit is lacking, apply profanity
[2012-08-29 13:42:52 -0400] j|: fucking fuct fuck fuck-a-roo!
[2012-08-29 13:43:05 -0400] JoshuaMiller: Ta-da!
[2012-08-29 13:44:02 -0400] j|: meh. okay. to work we go. thank you for helping me relieve my ADHD.
[2012-08-29 13:44:07 -0400] j|: ;)
[2012-08-29 13:47:46 -0400] Jay_Levitt: yfeldblum: If postfix is in my Cheffile, and in my DEPENDENCIES section of Cheffile.lock, does that mean it will be loaded on all nodes whether they need it or not?
[2012-08-29 13:49:26 -0400] yfeldblum: Jay_Levitt, it means that running librarian-chef install will download and copy the postfix cookbook to the ./cookbooks/postfix
[2012-08-29 13:49:41 -0400] Jay_Levitt: yfeldblum: hmm.. ok, so that's not affecting the run_list.. damn
[2012-08-29 13:49:56 -0400] Jay_Levitt: somehow chef-client is deciding to load the postfix cookbook
[2012-08-29 13:51:12 -0400] Jay_Levitt: Actually, it's not even in my run_list, it's just in my "Loading cookbooks" list
[2012-08-29 13:51:45 -0400] Jay_Levitt: OH!  It's in my own cookbook metadata.
[2012-08-29 13:52:44 -0400] Jay_Levitt: Damn, I wish we had more granular dependencies.
[2012-08-29 13:53:49 -0400] geekbri: yfeldblum: just FYI i was at the chef-boston meetup last night, and somebody was expressing how they wished librarian-chef not only allowed you to handle pulling down cookbooks and deps, but somehow would also handle committing cookbooks to git as well
[2012-08-29 13:53:58 -0400] geekbri: I'm not sure that really makes sense to me to have librarian handle that
[2012-08-29 13:54:07 -0400] geekbri: but it was on their wishlist
[2012-08-29 13:55:11 -0400] yfeldblum: geekbri, heh, not going to happen ... librarian-chef will not be wrapping every useful tool with a slower, cruder approximation!
[2012-08-29 13:55:39 -0400] geekbri: yfeldblum: oh I agree with you.  managing cookbooks it git you know... can be done pretty simply just with git :)
[2012-08-29 13:55:53 -0400] geekbri: I think librarian-chef is good at what it does, act like bundler but for cookbooks :)
[2012-08-29 14:07:45 -0400] tohava: I want to have the same resource in several recipes
[2012-08-29 14:07:48 -0400] tohava: what is the best way to do this?
[2012-08-29 14:08:01 -0400] yfeldblum: Jay_Levitt, chef is not going to run any recipes from any depended-on cookbooks
[2012-08-29 14:08:28 -0400] Jay_Levitt: yfeldblum: yeah, it wasn't the recipe running, it was a problem in postfix's attributes list - which gets parsed when the cookbook is loaded at all
[2012-08-29 14:08:46 -0400] yfeldblum: tohava, make a recipe that is included in the other recipes, or make a definition
[2012-08-29 14:08:54 -0400] Jay_Levitt: Somehow my node doesn't have the 'domain' attribute, and postfix's attributes/default.rb expects it to exist
[2012-08-29 14:12:21 -0400] Jay_Levitt: I'm assuming it's something ohai would normally detect, but I'm on a VPC instance and those are weird, I guess
[2012-08-29 14:22:06 -0400] Zenigor: I am looking to upgrade my chef server from ubuntu 11.04 to 12.04 LTS. I will be building the new VM and uploading all cookbooks, etc before I tear down the old chef server. Question is, do I need to re-bootstrap all my current servers or am I able to just re-run chef-client and bind them to the new chef server? If I am able to rebind them, will they lose their current config and setup during the rebind?
[2012-08-29 14:36:46 -0400] Leitz: Back to trying to get a chef-server to run on CentOS/RHEL. So far I've not gotten anywhere. That easily could be operator error but the gecode stuff kinda bugs me.
[2012-08-29 14:44:18 -0400] jmartin: hello, i was curious if there was a better way to do this sort of check within a cookbook?  "case node['platform_version'].to_i"
[2012-08-29 14:44:36 -0400] jmartin: it seems to cooperate on standard bootstrap installations but not on an omnibus installation of chef-client
[2012-08-29 14:50:40 -0400] anentropic: how does one send actions to a service resource which is set up by another recipe?
[2012-08-29 14:50:56 -0400] anentropic: i.e from within a recipe to a service in another recipe
[2012-08-29 14:57:51 -0400] jmartin: even more strangely, in shef on the node itself, node[:platform_version].to_i (or .to_f) both work as expected, so im not sure why this is an issue within a recipe?
[2012-08-29 15:05:43 -0400] gyre007: Is there any way how I can quickly find out what role is particular cookbooks recipe in ?
[2012-08-29 15:05:49 -0400] gyre007: I mean quick way
[2012-08-29 15:06:05 -0400] gyre007: i could iterate over all roles and list their runlist...
[2012-08-29 15:13:19 -0400] gondoi: i'm having issues with running chef via the omnibus installer and rvm on the system
[2012-08-29 15:13:23 -0400] gondoi: has anyone else seen this?
[2012-08-29 15:15:43 -0400] yfeldblum: gyre007, you should probably enumerate the roles and look at their run-lists then
[2012-08-29 15:17:32 -0400] gyre007: yfeldblum, you mean iterate over them
[2012-08-29 15:24:17 -0400] yfeldblum: gyre007, in ruby we have Enumerable and Enumerator
[2012-08-29 15:24:39 -0400] gyre007: yfeldblum, in bash we have for :)
[2012-08-29 15:24:50 -0400] yfeldblum: gyre007, that sounds slow
[2012-08-29 15:25:03 -0400] gyre007: well I suck at ruby so ... :)
[2012-08-29 15:25:18 -0400] yfeldblum: gyre007, are you good at parsing json data structures with bash?
[2012-08-29 15:25:31 -0400] gyre007: haha no
[2012-08-29 15:25:40 -0400] gyre007: but Im good at grepping the output :)
[2012-08-29 15:28:18 -0400] JoshuaMiller: Can anyone explain why this square peg isn't fitting correctly into this round hole?
[2012-08-29 15:28:44 -0400] JoshuaMiller: Nevermind, I'll just force it.
[2012-08-29 15:28:55 -0400] jmartin: exactly, you arent pushing hard enough
[2012-08-29 15:29:44 -0400] yfeldblum: gyre007, Chef::Role.list.select{|name| Chef::Role.load(name).run_list.include?("my-cookbook::my-recipe")}
[2012-08-29 15:30:18 -0400] yfeldblum: JoshuaMiller, in this type of case, you need to use a glass hammer
[2012-08-29 15:31:44 -0400] jmartin: yfeldblum: you wouldnt happen to have any idea why platform_version.to_f (or to_i) gives me a TypeError with omnibus installer would you?
[2012-08-29 15:32:26 -0400] jmartin: ohai platform_version on the node returns "6.3" (as i would expect)
[2012-08-29 15:33:02 -0400] yfeldblum: jmartin, nope
[2012-08-29 15:33:07 -0400] yfeldblum: jmartin, what's the backtrace?
[2012-08-29 15:33:43 -0400] jmartin: yfeldblum: one moment please, i just reverted to a clean snapshot, will provie very shortly
[2012-08-29 15:33:48 -0400] jmartin: provide*
[2012-08-29 15:34:01 -0400] Leitz: Any idea what these failures mean and how I get around them?  http://pastebin.com/BRezuacq
[2012-08-29 15:34:24 -0400] Leitz: Trying to install chef(-server) on a CentOS machine.
[2012-08-29 15:36:27 -0400] jmartin: yfeldblum: http://pastebin.com/mCrXfKic
[2012-08-29 15:36:49 -0400] jmartin: Leitz: the latest epel is 6-7 not 6-5
[2012-08-29 15:37:01 -0400] jmartin: try having it grab the 6-7 rpm, should go through
[2012-08-29 15:38:08 -0400] Leitz: Lemme see if I can find where that's configured.
[2012-08-29 15:39:44 -0400] gwaldo: I posted a question to ServerFault regarding knife (on Win7) inconsistently reading my ~\.chef\knife.rb config : http://serverfault.com/q/422545/50875
[2012-08-29 15:41:01 -0400] gwaldo: Basically, in some locations within my home dir, everything is on local disk; none of them are mapped/mounted from a remote server.
[2012-08-29 15:41:15 -0400] jmartin: Leitz: i believe it will be in a file in bootstrap-latest.tar.gz (if that is what you are using to install chef-server)
[2012-08-29 15:43:03 -0400] Leitz: jmartin, yup. However I'm on a CentOS 6 box.
[2012-08-29 15:43:07 -0400] Leitz: Still looking.
[2012-08-29 15:44:08 -0400] jmartin: Leitz: yah its gonna be here cookbooks/yum/attributes/default.rb
[2012-08-29 15:44:19 -0400] jmartin: if you extract the bootstrap, correct 6-5 to 6-7
[2012-08-29 15:44:25 -0400] jmartin: and then package back up
[2012-08-29 15:46:04 -0400] yfeldblum: jmartin, where's this sssd cookbook?
[2012-08-29 15:46:34 -0400] jmartin: yfeldblum: just local one i wrote, i can provide the relevant lines if you want
[2012-08-29 15:46:59 -0400] yfeldblum: jmartin, line 33 and maybe some surrounding lines would be cool
[2012-08-29 15:48:45 -0400] jmartin: yfeldblum: http://pastebin.com/1REhR2by
[2012-08-29 15:48:57 -0400] jmartin: line 33 is the if node[
[2012-08-29 15:50:23 -0400] Leitz: jmartin, it's moving forward.
[2012-08-29 15:50:55 -0400] Leitz: Might want to suggest someone change http://wiki.opscode.com/display/chef/Installing+Chef+Client+on+CentOS  too, as the latest rubygems is .24.
[2012-08-29 15:53:29 -0400] yfeldblum: jmartin, do you have any lines anywhere that assign `node = ...`?
[2012-08-29 15:54:30 -0400] jmartin: yfeldblum: no, although i think i actually pasted you the wrong lines! (was looking in the wrong version of the recipe)
[2012-08-29 15:55:45 -0400] jmartin: yfeldblum: the following is line 32,33,34 (follows immediately after my last paste) http://pastebin.com/B71FSrNp
[2012-08-29 15:56:33 -0400] yfeldblum: jmartin, stick a space between `action` and `[`
[2012-08-29 15:58:20 -0400] jmartin: yfeldblum: DOH! thank you sir
[2012-08-29 15:59:02 -0400] jmartin: hrm i guess the different ruby versions caused it to work on one and not on the omnibus
[2012-08-29 15:59:57 -0400] yfeldblum: jmartin, possibly; there were some subtle parser changes between ruby-1.8 and ruby-1.9
[2012-08-29 16:02:09 -0400] yfeldblum: jmartin, i'm not sure why opscode hasn't allowed writing `action :enable, :start` ... but w/e ...
[2012-08-29 16:03:38 -0400] _0x783czar: So, I'm pretty new to Chef, and have been assigned to study up on it for implementation in our company.  I've played around with it quite a bit and I have two questions that I have not been able to find answers to yet.  1) What (if any) tools are available for testing out cookbooks before implementing them  2) Is there a way to roll back cookbook configurations (I'm guessing no since their changes will already have been made to the syst
[2012-08-29 16:05:31 -0400] jmartin: 0x783czar: i believe that in 10.14 a dry-run mode is coming, but for now i just use VMs and snapshot them for my own testing
[2012-08-29 16:05:49 -0400] jmartin: snapshot, run recipe, revert to snapshot etc
[2012-08-29 16:06:37 -0400] _0x783czar: jmartin: yes that's what I've been using to play around with it so far.
[2012-08-29 16:06:53 -0400] jtimberman: yfeldblum: automatically make a comma separated list of actions an array?
[2012-08-29 16:07:03 -0400] jtimberman: yfeldblum: or, just make it an array behind the scenes
[2012-08-29 16:07:41 -0400] jtimberman: _0x783czar: test-kitchen is what we're moving to for performing tests on cookbooks before running them in a staging/preprod environment.
[2012-08-29 16:08:16 -0400] jtimberman: there's no "roll back" built in. what you'd need to do is make a contra recipe that does the opposite thing, removing other recipe's resources.
[2012-08-29 16:08:40 -0400] yfeldblum: def action(*args) ; args.size == 0 ? @action : (@action = Array(args)) ; end
[2012-08-29 16:08:42 -0400] jtimberman: i recommend vagrant for testing if you're not using something else for testing purposes.
[2012-08-29 16:08:44 -0400] cheeseplus: _0x783czar: there is foodcritic for lint testing as well
[2012-08-29 16:08:54 -0400] yfeldblum: jtimberman, ^ is for u
[2012-08-29 16:08:59 -0400] jtimberman: yfeldblum: I gathered :D
[2012-08-29 16:09:03 -0400] jmartin: damn you ruby 1.9! breaking more things, can i not iterate over a string in an erb file? i.e. "<% node['krb5']['default_realm_kdcs'].each do |kdc_server| -%>"
[2012-08-29 16:09:15 -0400] yfeldblum: jmartin, that's correct
[2012-08-29 16:09:32 -0400] yfeldblum: jmartin, what does iterating over a string even mean?
[2012-08-29 16:09:55 -0400] jtimberman: jmartin: Array(node['krb5']['default_realm_kdcs']).each
[2012-08-29 16:10:02 -0400] jmartin: ah yes
[2012-08-29 16:10:06 -0400] jmartin: thats what i meant really
[2012-08-29 16:10:08 -0400] jmartin: my apologies
[2012-08-29 16:10:08 -0400] jmartin: haha
[2012-08-29 16:10:09 -0400] jtimberman: of course if its an array already
[2012-08-29 16:10:15 -0400] jtimberman: you might need to flatten it :)
[2012-08-29 16:10:29 -0400] jmartin: i dont think it is already (giving me errors about it being a string)
[2012-08-29 16:10:30 -0400] jtimberman: but duck typing here has pitfalls.
[2012-08-29 16:10:44 -0400] _0x783czar: jtimberman: OK, sounds good, thank-you.
[2012-08-29 16:10:46 -0400] jtimberman: i'd explicitly make the data something you can sanely process.
[2012-08-29 16:11:30 -0400] yfeldblum: jmartin, String#each in ruby-1.8 splits the string by $/ ("\n") and iterates over the resulting array
[2012-08-29 16:11:49 -0400] jmartin: ah right
[2012-08-29 16:12:02 -0400] yfeldblum: jmartin, just do node['krb5']['default_realm_kdcs'].lines.each in ruby-1.9
[2012-08-29 16:12:02 -0400] _0x783czar: cheeseplus: foodcritic? is that some sort of test program for recipes?
[2012-08-29 16:12:09 -0400] _0x783czar: googling right now
[2012-08-29 16:12:20 -0400] yfeldblum: jmartin, since String#each seems to be removed from ruby-1.9
[2012-08-29 16:13:04 -0400] yfeldblum: jmartin, ruby-1.8 also has String#lines, so using #lines makes it portable
[2012-08-29 16:13:54 -0400] jtimberman: http://acrmp.github.com/foodcritic/ - lint checker for cookbooks
[2012-08-29 16:14:00 -0400] jtimberman: its awesome.
[2012-08-29 16:14:14 -0400] jmartin: yfeldblum: thank you sir
[2012-08-29 16:15:00 -0400] _0x783czar: cheeseplus: I found it, thanks.
[2012-08-29 16:15:15 -0400] cheeseplus: sorry, didn't get my growl notif ;)
[2012-08-29 16:15:46 -0400] _0x783czar: cheeseplus: no worries, thanks again
[2012-08-29 16:17:00 -0400] Jay_Levitt: Any EC2 VPC users?  When I spin up new instances on my public subnet with "knife ec2 server create", they don't have elastic IPs yet, so they can't get out to the Internet to fetch the bootstrap code, talk to chef server, etc..
[2012-08-29 16:22:15 -0400] ranjibd: Jay_Levitt, yes
[2012-08-29 16:22:27 -0400] ranjibd: Jay_Levitt, do you have vpn?
[2012-08-29 16:22:40 -0400] ranjibd: or do you have a NAT box in the public subnet ?
[2012-08-29 16:23:15 -0400] Jay_Levitt: ranjibd: No VPN, and I wouldn't usually want a NAT box in the public subnet.. I guess what I want is NAT at bootstrap time, until it gets all the way through and can assign itself an IP?
[2012-08-29 16:23:29 -0400] ranjibd: i temporarily (till the elastic ip is assigned) change the default gateway to a NAT box
[2012-08-29 16:24:06 -0400] Jay_Levitt: How do you accomplish that at server creation time? Or do you go do it by hand each time?
[2012-08-29 16:24:12 -0400] ranjibd: Jay_Levitt, the nat box has to be in public subnet right? if you want to instances its natting to reach out to internet
[2012-08-29 16:24:36 -0400] Loof: I'm struggling with a newbie issue... I'm trying to use the aws cookbook and when I follow the example I get - ERROR: NameError: Cannot find a resource for aws_elastic_lb on ubuntu version 12.04
[2012-08-29 16:24:52 -0400] Jay_Levitt: ranjibd: sorry, I jumped over what you said, right to what you implied - point it at the NAT at first
[2012-08-29 16:25:01 -0400] Loof: What's the right way to pull a LWRP into your own recipe?
[2012-08-29 16:25:28 -0400] _rc: Loof: specify depends "aws" in your metadata.rb
[2012-08-29 16:25:30 -0400] Jay_Levitt: loof, your cookbook might need a metadata.rb that shows it "depends" on
[2012-08-29 16:25:45 -0400] ranjibd: my bootstrap template has `ip route change` at the beginning .. since i use the same bootstrap script for non -vpc instances also i put it under an if  (ping 8.8.8.8 check if its reachable, if not change the  default route)
[2012-08-29 16:26:11 -0400] Jay_Levitt: ranjibd: oh, right - I forgot we can provide our own bootstrap templates.  I'll copypasta the standard one and do just that.
[2012-08-29 16:26:54 -0400] ranjibd: the elastic ip on the other hand is assigned via a resource , which notifies an execute statement that removes any explicit default routes if present..so that takes care of removal of the route once elastic ip is assigned
[2012-08-29 16:27:09 -0400] Jay_Levitt: beautiful.
[2012-08-29 16:28:20 -0400] Loof: _rc: I did that
[2012-08-29 16:28:42 -0400] ranjibd: Loop.. do you have include_recipe "aws" inside your recipes. depends generally ensures its downloaded
[2012-08-29 16:29:02 -0400] Loof: I did both
[2012-08-29 16:30:02 -0400] ranjibd: Loof, can you run chef-client with -l debug and pastebin the output ?
[2012-08-29 16:30:50 -0400] _0x783czar: jtimberman: So would you say that Test-Kitchen is currently production level?  Or are we still in a beta?
[2012-08-29 16:32:05 -0400] jtimberman: _0x783czar: its a testing tool.
[2012-08-29 16:32:06 -0400] Loof: ranjibd: I am looking at the debug output...not terribly useful since it's the resource catch-all that barfed: /usr/lib/ruby/vendor_ruby/chef/resource_platform_map.rb:126:in `get'
[2012-08-29 16:32:27 -0400] jtimberman: don't be fooled by the non 1.0 release version :)
[2012-08-29 16:32:40 -0400] jtimberman: that said, there are probably bugs and improvements to be made.
[2012-08-29 16:32:48 -0400] jtimberman: http://tickets.opscode.com/browse/KITCHEN
[2012-08-29 16:33:04 -0400] jtimberman: but it certainly "works" (as intended) and many people are successfully using it in their own workflow.
[2012-08-29 16:33:17 -0400] jmartin: i take it chef template resource does not a provide a way to set selinux security contexts on a file?
[2012-08-29 16:33:27 -0400] _0x783czar: jtimberman: awesome, glad to hear it.
[2012-08-29 16:35:28 -0400] Loof: Ok... so I need to depend on the cookbook 'aws' (done), include the recipe 'aws' (done)
[2012-08-29 16:36:01 -0400] Loof: This should then work:     aws_elastic_lb "elb" do
[2012-08-29 16:36:03 -0400] Loof: ...
[2012-08-29 16:36:03 -0400] Loof: end
[2012-08-29 16:36:25 -0400] Loof: Let me try something dumb
[2012-08-29 16:36:42 -0400] ranjibd: jmartin, yeah.. sean 0 meara had done some initial works .. i was testing it.. but could not got time to work further
[2012-08-29 16:37:17 -0400] jmartin: ranjibd: thanks for confirming
[2012-08-29 16:37:42 -0400] ranjibd: jmartin, its a long due requirement .. specially for us who run lot of rel derivatives.. but the support will require patching core file resource to support security contexts
[2012-08-29 16:38:11 -0400] Loof: ugh
[2012-08-29 16:38:13 -0400] Loof: I got it
[2012-08-29 16:38:20 -0400] Loof: I updated the aws cookbook a while back
[2012-08-29 16:38:23 -0400] Loof: but it was never uploaded
[2012-08-29 16:38:26 -0400] Loof: just installed
[2012-08-29 16:38:30 -0400] Loof: That did it
[2012-08-29 16:40:19 -0400] Loof: I figured I was missing something totally obvious...and I was :P
[2012-08-29 16:40:32 -0400] Loof: Anyways, another best practice question... in case someone has a smart idea about it
[2012-08-29 16:40:42 -0400] Loof: I've got a recipe to bring my service 'online'
[2012-08-29 16:40:48 -0400] Loof: (add it to the LB)
[2012-08-29 16:40:55 -0400] Loof: And another to take it 'offline'
[2012-08-29 16:41:02 -0400] Loof: Is there any way to make these mutually exclusive
[2012-08-29 16:41:12 -0400] Loof: or some smart way to handle offline vs online in a clear way
[2012-08-29 16:41:25 -0400] Loof: I considered an attribute... but setting that and monitoring that is less than obvious
[2012-08-29 16:41:49 -0400] Loof: I don't want to have environments for 'online' and 'offline' for each... that seems ugly
[2012-08-29 16:42:02 -0400] Leitz: jmartin, looks like an error with gecode building or gcc?  Really long, check lines 7-12 from the bottom. http://pastebin.com/gsKC37QX
[2012-08-29 16:43:26 -0400] Loof: Is there maybe an anti-pattern for a run list... i.e. if this is NOT in the run list... or when this is -removed- from the run list
[2012-08-29 16:43:56 -0400] Loof: i.e.... a recipe that if it's been added to the run list before...and is no longer on the run list... something happens
[2012-08-29 16:44:00 -0400] makerbreakr: anyone use chef and rackspace extensively?
[2012-08-29 16:44:22 -0400] makerbreakr: I am maving some issues, with boostrapping, in that after I create a server, knife times out and fails
[2012-08-29 16:44:33 -0400] makerbreakr: so I have to re-run the boostrap manually
[2012-08-29 16:44:42 -0400] yfeldblum: makerbreaker, so delete the server and try again?
[2012-08-29 16:45:21 -0400] makerbreakr: ya, I need to be able to automate this though in a script, and I have no way to really get feedback
[2012-08-29 16:45:53 -0400] jmartin: Leitz: tried checking here? http://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo#InstallingChefServerusingChefSolo-CentOS%2FRHELInstallationNotes
[2012-08-29 16:46:20 -0400] jmartin: perhaps use that other bootstrap? i dont think i had such an error when doing an install (mine is on cent 6.3)
[2012-08-29 16:48:39 -0400] Loof: Sheesh, this code is lame
[2012-08-29 16:48:54 -0400] Loof: It's not checking if the server is already on the ELB... it just adds it every time chef wakes up
[2012-08-29 16:49:17 -0400] Loof: Bah, I'm going to need to write my own provider using fog sometime soon :P
[2012-08-29 16:49:23 -0400] Loof: Oh well, one more thing for the TODO list :)
[2012-08-29 16:49:50 -0400] jmartin: Leitz: ah, one thing i notice, what version of GCC do you have?
[2012-08-29 16:51:49 -0400] gyre007: how do I access hostname in environment ? I mean I need to override an attribute which should contain a hostname of the machine...
[2012-08-29 16:53:28 -0400] gyre007: there should be a way how to access ohai's attributes
[2012-08-29 16:53:30 -0400] Jay_Levitt: kid-fears
[2012-08-29 16:53:45 -0400] gyre007: from withing the environment\s json file
[2012-08-29 16:53:52 -0400] jtimberman: gyre007: do it in a recipe
[2012-08-29 16:54:27 -0400] gyre007: jtimberman, I could...I could even do it in attributes file...was just thinking that it would've been more elegant to do it in env
[2012-08-29 16:54:44 -0400] gyre007: and its not messing things up in the attributes files...
[2012-08-29 16:55:06 -0400] gyre007: with if conditions...based on env :(
[2012-08-29 16:55:13 -0400] jtimberman: yeah. do that in a recipe.
[2012-08-29 16:55:22 -0400] jtimberman: not in an attributes file
[2012-08-29 16:55:30 -0400] jtimberman: and you can't do it in the environment so definitely not there :)
[2012-08-29 16:55:59 -0400] Loof: makerbreakr: So it's trying to configure itself on boot and fails... but works if you do it over ssh?  Or are you starting the instance /w knife and it times out trying to connect to your new server before it bootstraps?
[2012-08-29 16:56:26 -0400] makerbreakr: it loks like it is timing out
[2012-08-29 16:56:27 -0400] gyre007: jtimberman, how about template ?
[2012-08-29 16:57:16 -0400] gyre007: I guess the override would be to node[:hostname] then ?
[2012-08-29 16:58:20 -0400] Loof: jtimberman: Well, you theoretically could if you had some magic in your bashrc on the remote box... but I doubt that's what he wants to do :)
[2012-08-29 16:58:31 -0400] jtimberman: you can't override automatic attributes, such as the node['hostname']
[2012-08-29 16:58:46 -0400] gyre007: no I dont want to override automatic attributes
[2012-08-29 16:58:47 -0400] Loof: gyre007: ohai will take precidence
[2012-08-29 16:58:50 -0400] jtimberman: :)
[2012-08-29 16:58:54 -0400] jtimberman: gyre007: whats the use case?
[2012-08-29 16:58:57 -0400] gyre007: I want to use them to set other attributes
[2012-08-29 16:59:10 -0400] Loof: It's not that you couldn't... it's that any automatic attribute is a higher precidence than normal ones
[2012-08-29 16:59:11 -0400] gyre007: need tom initialize one attribute to something like  blah_hostname_blah
[2012-08-29 16:59:13 -0400] gyre007: simples
[2012-08-29 16:59:43 -0400] jmartin: jtimberman: im fairly new to chef, and while my existing recipe works for me, as its my first real go it just screams 'hacky' to me, is there a cookbook you would recommend as a sort of style guide?
[2012-08-29 16:59:45 -0400] gyre007: thats why im asking how do I access ohai's hostname attr so that i can USE it to set another attribute which will be in the template
[2012-08-29 16:59:47 -0400] Loof: gyre007: You can do that in attributes default['foo'] = 'blah_' + node['hostname'] + '_blah'
[2012-08-29 17:00:06 -0400] gyre007: Loof, jtimberman recommends recipe
[2012-08-29 17:00:19 -0400] gyre007: so it's node['hostname'] im after...ok
[2012-08-29 17:00:23 -0400] Loof: For something that simple, you can do that in either place
[2012-08-29 17:00:31 -0400] Loof: Let me look
[2012-08-29 17:01:08 -0400] Loof: Yep :hostname or 'hostname' either should work
[2012-08-29 17:02:28 -0400] gyre007: cheers
[2012-08-29 17:04:40 -0400] jtimberman: gyre007: attributes can be accessed in multiple ways (long story), node['hostname'], node[:hostname] and node.hostname all work.
[2012-08-29 17:05:05 -0400] jtimberman: we recommend node['hostname'] because it is the least surprising to people who aren't totally familiar with ruby
[2012-08-29 17:05:18 -0400] jtimberman: jmartin: foodcritic has a number of style checks that may be helpful.
[2012-08-29 17:05:29 -0400] jmartin: jtimberman: oh, very nice
[2012-08-29 17:05:32 -0400] jmartin: thank you
[2012-08-29 17:06:03 -0400] jtimberman: if you want to check your ruby coding style, the "tailor" gem encapsulates a lot of "Ruby Community Style Guide" practices.
[2012-08-29 17:06:15 -0400] jtimberman: it complains a lot about my code so I don't use it ;)
[2012-08-29 17:06:43 -0400] gyre007: mm changed the recipe...reran it and nothing has changed...will dig into it
[2012-08-29 17:07:18 -0400] Loof: gyre007: What do you mean 'nothing changed'?
[2012-08-29 17:07:31 -0400] gyre007: that config where it should be going...anyways...
[2012-08-29 17:07:36 -0400] Loof: (BTW, did you remember to upload it... I forgot that a lot at 1st)
[2012-08-29 17:07:36 -0400] yfeldblum: gyre007, computed attribute defaults which depend on other non-ohai attribute values should be computed in recipes; computed attribute defaults which depend only on ohai attributes may be computed in the attributes file
[2012-08-29 17:08:06 -0400] yfeldblum: gyre007, and `hostname` comes from ohai
[2012-08-29 17:08:12 -0400] makerbreakr: this is the error i get when running knife rackspace server create: https://gist.github.com/3515711
[2012-08-29 17:08:25 -0400] Loof: yfeldblum: Wouldn't that apply to any 'automatic' attribute... like the ec2 cookbook?
[2012-08-29 17:09:15 -0400] yfeldblum: Loof, which ec2 cookbook?
[2012-08-29 17:11:20 -0400] Leitz: jmartin, gcc and gcc-c++ 4.4.6. Updated to latest RPM from CentOS this AM.
[2012-08-29 17:13:14 -0400] jmartin: Leitz: ok, im gonna give an install a try myself, one moment while i revert this VM
[2012-08-29 17:14:11 -0400] Leitz: jmartin, thanks! I don't mind helping test but still don't know what problems are operator error and which are bugs.
[2012-08-29 17:14:23 -0400] Leitz: Don't forget to change the rubygems version.
[2012-08-29 17:15:28 -0400] jmartin: Leitz: yeah, i wont, my own recent install did the same
[2012-08-29 17:15:35 -0400] jmartin: 1.8.24 that is
[2012-08-29 17:17:09 -0400] Leitz: Also, my SELinux is disabled from the get-go.
[2012-08-29 17:21:30 -0400] jmartin: Leitz: ok, chef-solo run is going now
[2012-08-29 17:22:28 -0400] KarlHungus: i have an ordering issue :(
[2012-08-29 17:22:59 -0400] KarlHungus: user resources can set zsh as the shell. so before i converge them, i include the zsh cookbook
[2012-08-29 17:23:13 -0400] KarlHungus: the zsh cookbook requires the pw cookbook (on fbsd)
[2012-08-29 17:23:34 -0400] KarlHungus: zsh calls a LWRP in my pw cookbook to register the new shell as a valid shell for users
[2012-08-29 17:23:57 -0400] KarlHungus: but since many shells register, i delay the /etc/pw.conf template until the end of the run
[2012-08-29 17:24:24 -0400] KarlHungus: so when the user resource is converged, it bombs because zsh is installed, but not yet a valid shell choice
[2012-08-29 17:25:05 -0400] KarlHungus: and because it bombs, the delayed template is never called =)
[2012-08-29 17:25:27 -0400] KarlHungus: what to do?
[2012-08-29 17:26:23 -0400] Loof: yfeldblum: There's an ec2 cookbook that provides AWS/EC2 metadata as automatic attributes
[2012-08-29 17:26:34 -0400] Loof: yfeldblum: I've not done much with it yet other than install it :P :)
[2012-08-29 17:26:38 -0400] yfeldblum: Loof, where is it?
[2012-08-29 17:27:51 -0400] Loof: http://community.opscode.com/cookbooks/ec2
[2012-08-29 17:28:45 -0400] jmartin: Leitz: still going, compiling gecode on this VM takes a while it seems
[2012-08-29 17:29:34 -0400] yfeldblum: Loof, i don't know where you're finding these automatic-level attributes; i'm only seeing normal-level attributes
[2012-08-29 17:31:26 -0400] Leitz: jmartin, no worries. If it matters, here are the gems I have on the machine. It's a new build and fairly unused. http://pastebin.com/Eps9LKxk
[2012-08-29 17:33:46 -0400] Loof: yfeldblum: Might be a bad assumption on my part based on the description: Manage EC2 metadata as attributes
[2012-08-29 17:34:11 -0400] Loof: yfeldblum: I've only been using Chef a couple of days, so a few things are still hazy
[2012-08-29 17:34:34 -0400] yfeldblum: Loof, no worries
[2012-08-29 17:35:15 -0400] KarlHungus: was the original question how to set a node attribute based on another node attribute so it can be used in a template?
[2012-08-29 17:38:24 -0400] jmartin: Leitz: seems gecode went through just fine for me
[2012-08-29 17:38:46 -0400] jmartin: i followed these instructions to install chef-solo
[2012-08-29 17:38:48 -0400] jmartin: http://wiki.opscode.com/display/chef/Installing+Chef+Client+on+CentOS
[2012-08-29 17:39:07 -0400] KarlHungus: jmartin: i *highly* recommend using the omnibus packages
[2012-08-29 17:39:28 -0400] KarlHungus: http://www.opscode.com/chef/install/
[2012-08-29 17:39:40 -0400] jmartin: KarlHungus: yah, im using them myself, but i believe that Leitz was not using it and is having an issue
[2012-08-29 17:39:52 -0400] jmartin: i just did an install to test
[2012-08-29 17:40:44 -0400] jmartin: Leitz: yep, everything went through, completed for me, this VM is a 6.3 netinstall i did in the past 48 hours, with nothing on it touched
[2012-08-29 17:41:09 -0400] jmartin: but! use the omnibus and you may have much better luck
[2012-08-29 17:42:10 -0400] Leitz: jmartin, one of my co-workers, who knows a lot more about chef than I, wonders if there's a -devel rpm.
[2012-08-29 17:42:58 -0400] jmartin: well, i didnt do anything but a basic minimal install IIRC of centos 6.3
[2012-08-29 17:43:09 -0400] jmartin: and then followed the instructions exactly
[2012-08-29 17:45:17 -0400] jmartin: jtimberman: happen to have seen any issues with utilizing foodcritic and encoding problems?
[2012-08-29 17:46:28 -0400] awgross|flashman: Anyone have a good solution to mocking AWS EBS apis when testing in Vagrant?
[2012-08-29 17:47:25 -0400] awgross|flashman: it seems you can add new block devices to a VM with virtual box, curious if it can be done from within the VM
[2012-08-29 17:48:40 -0400] jmartin: anyone seen something like the following? http://pastebin.com/4N69r4rH
[2012-08-29 17:48:58 -0400] KarlHungus: jmartin: yes
[2012-08-29 17:49:16 -0400] jmartin: KarlHungus: is there a fix of sorts that im not finding via google?
[2012-08-29 17:49:18 -0400] KarlHungus: i fixed it in 1.9+ by open the file with mode 'rb' instead of just r
[2012-08-29 17:49:51 -0400] jmartin: KarlHungus: you wouldnt happen to have a patch somewhere would you?
[2012-08-29 17:49:55 -0400] KarlHungus:     ::File.open(INDEX_PATH, "rb").each_line do |line|
[2012-08-29 17:50:15 -0400] KarlHungus: this is in a library we use to manage package indexing in freebsd
[2012-08-29 17:52:13 -0400] KarlHungus: jmartin: that specific error looks like a UTF-8 char crept into your ssh cookbook
[2012-08-29 17:52:37 -0400] jmartin: KarlHungus: oh, so its a problem with my cookbook not foodcritic?
[2012-08-29 17:52:40 -0400] jmartin: ah k
[2012-08-29 17:56:53 -0400] Leitz: jmartin, we backed up a bit. I've removed the CentOS ruby rpms and installed the Omnibus stuff. Just started the run.
[2012-08-29 17:57:20 -0400] KarlHungus: Leitz: you'll be very glad you made that decision
[2012-08-29 17:57:55 -0400] KarlHungus: Leitz: from a config management perspective, it makes a lot of sense to keep the dependencies for the CM tool isolated from the system the CM tool is managing
[2012-08-29 17:58:04 -0400] miah: moin
[2012-08-29 17:58:29 -0400] KarlHungus: Leitz: otherwise chef could update something it depended on, and fail in the process (eventual consistency) and then be unable to run until the dep is manually resolved
[2012-08-29 17:59:49 -0400] Leitz: Hey KarlHungus. Normally I'm more happy to use the system stuff, except where only one thing will use the binaries. Since there's nothing else I want Ruby for on the server, this should work.
[2012-08-29 18:00:56 -0400] KarlHungus: Leitz: in this case, its smart to NOT use the system stuff to support the tool that manages the system stuff =)
[2012-08-29 18:01:09 -0400] KarlHungus: otherwise you can wind up in a checken/egg situation
[2012-08-29 18:01:13 -0400] jmartin: KarlHungus: hrm, i think this is a foodcritic problem of sorts
[2012-08-29 18:01:28 -0400] jmartin: KarlHungus: no matter what directory i point to, same error
[2012-08-29 18:02:41 -0400] KarlHungus: jmartin: odd. i'm not sure what it would be then
[2012-08-29 18:05:40 -0400] jmartin: KarlHungus: yep, very strange indeed :-/
[2012-08-29 18:06:39 -0400] jmartin: KarlHungus: ah, https://github.com/cucumber/gherkin/issues/192
[2012-08-29 18:07:24 -0400] KarlHungus: wow, thats a hackish "fix" ;)
[2012-08-29 18:07:34 -0400] jmartin: indeed
[2012-08-29 18:07:41 -0400] jmartin: there is a pull request from this morning though
[2012-08-29 18:08:17 -0400] KarlHungus: yep. forces utf-8 during the file open. esentially the same as use rb like i do
[2012-08-29 18:08:29 -0400] KarlHungus: cool!
[2012-08-29 18:09:58 -0400] atomic-penguin: Hmm, having a bit of trouble with 'kitchen ssh', https://gist.github.com/3516389.  Anyone else seen this problem?
[2012-08-29 18:15:56 -0400] atomic-penguin: Of course google only shows my gists :(
[2012-08-29 18:17:47 -0400] jmartin: atomic-penguin: ahoy, i have a fix for one of your cookbooks i do believe
[2012-08-29 18:18:02 -0400] atomic-penguin: jmartin, ahoy, great!
[2012-08-29 18:18:29 -0400] jmartin: https://github.com/atomic-penguin/cookbook-krb5/blob/master/templates/default/krb5.conf.erb <-- line 18, yfeldblum pointed out that this should do a .lines.each instead
[2012-08-29 18:18:40 -0400] jmartin: as it breaks in 1.9+
[2012-08-29 18:22:55 -0400] atomic-penguin: jmartin, works for me on 1.9.2-p180
[2012-08-29 18:23:15 -0400] atomic-penguin: jmartin, do you mean a 1.9.3+
[2012-08-29 18:24:32 -0400] jmartin: atomic-penguin: most likely
[2012-08-29 18:24:40 -0400] jmartin: atomic-penguin: latest omnibus installer seems to trip it up
[2012-08-29 18:25:08 -0400] jmartin: complains that String#each doesnt exist anymore IIRC
[2012-08-29 18:26:20 -0400] atomic-penguin: Line #18 isn't a string
[2012-08-29 18:26:26 -0400] atomic-penguin: Its an array
[2012-08-29 18:26:43 -0400] jmartin: hrm, perhaps i modified my attribute incorrectly..
[2012-08-29 18:27:05 -0400] atomic-penguin: That would probably do it
[2012-08-29 18:27:19 -0400] jmartin: doh
[2012-08-29 18:27:22 -0400] jmartin: i certainly did :(
[2012-08-29 18:27:27 -0400] jmartin: fail, my apologies
[2012-08-29 18:27:53 -0400] atomic-penguin: If you have RR records, you certainly don't need to change it either.  You could leave it empty and let the DNS lookup work its magic
[2012-08-29 18:30:37 -0400] jmartin: atomic-penguin: yeah, its a hodgepodge test environment so i just specified to be safe
[2012-08-29 18:31:22 -0400] atomic-penguin: It is probably best to set at least 2, in case of DNS failure
[2012-08-29 18:35:28 -0400] jmartin: atomic-penguin: now to learn to use databags
[2012-08-29 18:36:37 -0400] atomic-penguin: jmartin, you just getting started with chef, or been using it a while?
[2012-08-29 18:37:31 -0400] jmartin: atomic-penguin: brand new, but it seems intuitive enough that i was able to cobble together an LDAP + KRB5 config that joins me to an AD domain
[2012-08-29 18:37:53 -0400] jmartin: on cent5/6
[2012-08-29 18:38:22 -0400] jmartin: or rather, doesnt join me, but allows me to authenticate
[2012-08-29 18:40:42 -0400] jmartin: atomic-penguin: i need to clean up the cookbook like crazy though, such as using databags etc
[2012-08-29 18:42:10 -0400] atomic-penguin: jmartin, so did you override the krb5.authconfig line to enable LDAP capability for pam?
[2012-08-29 18:42:28 -0400] atomic-penguin: jmartin, or was that another recipe perhaps?
[2012-08-29 18:43:41 -0400] jmartin: i didnt override, i basically just ran authconfig another time in my glob of a recipe
[2012-08-29 18:43:44 -0400] jmartin: to enable sssd
[2012-08-29 18:43:49 -0400] jmartin: (which is what im using)
[2012-08-29 18:44:28 -0400] atomic-penguin: Maybe that could be abstracted out, into a separate authconfig, or pam cookbook.
[2012-08-29 18:44:43 -0400] atomic-penguin: I kind of made mine centered around krb5, 'cause that is all we use here.
[2012-08-29 18:47:23 -0400] jmartin: atomic-penguin: yeah, honestly my current recipe while it works is messy
[2012-08-29 18:47:32 -0400] jmartin: im sure i could abstract certain parts out a bit
[2012-08-29 18:48:10 -0400] atomic-penguin: jmartin, send me a link to your messy bits, maybe I can figure out a better way to handle authconfig/pam configuration
[2012-08-29 18:53:57 -0400] ryker: is it possible to install an msi package such as nsclient++ in windows using chef?
[2012-08-29 18:54:00 -0400] jmartin: atomic-penguin: http://pastebin.com/fnzvYu1F <-- behold the hacky mess, especially the kinit portion :-/
[2012-08-29 18:54:48 -0400] Rudd-XXX: hello everyone
[2012-08-29 18:54:54 -0400] Rudd-XXX: i have a few quetstions about opscode chef
[2012-08-29 18:55:27 -0400] sascha_d: ryker: yes theoretically
[2012-08-29 18:55:37 -0400] Rudd-XXX: i have a git repo with chef-repo in it
[2012-08-29 18:55:51 -0400] Rudd-XXX: am I supposed to upload this repo to the chef server's repository path?
[2012-08-29 18:56:03 -0400] sascha_d: ryker... there's a windows cookbook in the community cookbook collection that has a windows_package resource
[2012-08-29 18:56:04 -0400] Rudd-XXX: how does the repo, the server and knife come together?
[2012-08-29 18:56:51 -0400] ryker: sascha_d: ty. i just searched the cookbooks for 'windows' and got 4 pages of results, but somehow missed that one.
[2012-08-29 18:56:56 -0400] manuel__: ok
[2012-08-29 18:56:59 -0400] manuel__: this thing died on me
[2012-08-29 18:57:06 -0400] manuel__: so how do how does the repo, the server and knife come together?
[2012-08-29 18:57:23 -0400] manuel__: if I push an update to the repo, will chef  server automatically pick changes up?
[2012-08-29 18:58:05 -0400] ryker: sascha_d: ha. right at the top of the list.  thanks again
[2012-08-29 18:58:07 -0400] manuel__: hello?
[2012-08-29 18:58:15 -0400] sascha_d: ryker... sure
[2012-08-29 18:59:01 -0400] cheeseplus: manuel__: pushing to a repo doesn't trigger anything automatically
[2012-08-29 18:59:09 -0400] ryker: manuel__: your repo and the chef server have no ties at all.  your repo is just for source code control
[2012-08-29 18:59:11 -0400] ryker: :)
[2012-08-29 18:59:18 -0400] manuel__: ok
[2012-08-29 18:59:34 -0400] cheeseplus: manuel__: you push cookbooks or databags or roles to the server from knife
[2012-08-29 18:59:42 -0400] jmartin: knife cookbook upload <cookbook> will push your cookbooks to the server
[2012-08-29 18:59:48 -0400] manuel__: so how do I use knife to wire up my git post-receive hook?
[2012-08-29 18:59:57 -0400] manuel__: i don't get it
[2012-08-29 19:00:02 -0400] manuel__: knife cookbook upload <cookbook> works
[2012-08-29 19:00:04 -0400] manuel__: I get that part
[2012-08-29 19:00:22 -0400] manuel__: the part that I don't understand is why do I need to upload the cookbook if the server already has it in its git repo /var/chef-repo ?
[2012-08-29 19:01:07 -0400] manuel__: am I confused somehow that the repo path I configured during chef server setup has nothing to do with my own repo?
[2012-08-29 19:02:42 -0400] manuel__: so the chef server itself has no need to have the git repo contents?
[2012-08-29 19:04:34 -0400] cheeseplus: manuel__: it typically but not necessarily will, you'll upload it via knife
[2012-08-29 19:04:54 -0400] manuel__: upload to where?  to the directory?  to the api?
[2012-08-29 19:04:58 -0400] manuel__: this is very confusing
[2012-08-29 19:05:10 -0400] manuel__: i read the entire architecture in the wiki
[2012-08-29 19:05:15 -0400] manuel__: still don't get it
[2012-08-29 19:06:00 -0400] cheeseplus: the chef-server database
[2012-08-29 19:06:06 -0400] manuel__: ah ok
[2012-08-29 19:06:26 -0400] cheeseplus: so via the API
[2012-08-29 19:06:32 -0400] manuel__: so how do I use knife to upload the entirety of a chef-repo that I have locally (or on my git server)?
[2012-08-29 19:06:41 -0400] manuel__: I don't want to upload "just one cookbook".  I want the entire thing.
[2012-08-29 19:06:48 -0400] manuel__: to be submitted to the chef database.
[2012-08-29 19:07:01 -0400] manuel__: my goal is to have a git server where I push my config changes in chef-repo
[2012-08-29 19:07:07 -0400] manuel__: and this git server just does all the knife work for me
[2012-08-29 19:08:34 -0400] jmartin: instead of specifying cookbook
[2012-08-29 19:08:35 -0400] jmartin: use -a
[2012-08-29 19:08:43 -0400] manuel__: and that uploads everything,  right?
[2012-08-29 19:08:50 -0400] ryker: manuel__: you can also use rake install to upload everything
[2012-08-29 19:08:52 -0400] manuel__: if I update a cookbook, will that cause all clients to re-run the cookbook?
[2012-08-29 19:08:59 -0400] manuel__: ahhh rake install
[2012-08-29 19:09:00 -0400] manuel__: good!
[2012-08-29 19:09:04 -0400] ryker: manuel__: have you taken a look at the chef basics page? http://wiki.opscode.com/display/chef/Chef+Basics
[2012-08-29 19:09:29 -0400] manuel__: i have
[2012-08-29 19:10:04 -0400] manuel__: i am working with ec2
[2012-08-29 19:10:07 -0400] ryker: manuel__: no. uploading a cookbook doesn't trigger anything.  chef uses pull methodology.  the clients request info from the server when chef-client is run.  usually around once an hour
[2012-08-29 19:10:32 -0400] manuel__: usually?  do I assume that chef-client is already setup to run automatically when I have knife bootstrapped a box?
[2012-08-29 19:11:11 -0400] ryker: manuel__: i'm not sure. i don't use the knife bootstrap command.  maybe someone else can answer that.
[2012-08-29 19:11:32 -0400] manuel__: k
[2012-08-29 19:11:49 -0400] cheeseplus: chef-client does not run automatically out of the box via knife bootstrap unless you run the "chef-client" cookbook as part of the bootstrap
[2012-08-29 19:11:50 -0400] rb1980: if ift apa
[2012-08-29 19:11:55 -0400] jmartin: ^
[2012-08-29 19:12:03 -0400] rb1980: (sorry)
[2012-08-29 19:13:46 -0400] cheeseplus: manuel__: correction - well it will run once but not necessarily as a daemon
[2012-08-29 19:13:59 -0400] manuel__: ok
[2012-08-29 19:14:52 -0400] manuel__: is there a recipe that will allow my machines to generate a /etc/hosts with all the hosts registered on my chef server available to it?
[2012-08-29 19:16:27 -0400] cheeseplus: manuel__: there is something like http://powdahound.com/2010/07/dynamic-hosts-file-using-chef
[2012-08-29 19:16:58 -0400] jmartin: http://community.opscode.com/cookbooks/autoetchosts
[2012-08-29 19:17:22 -0400] jmartin: that cookbook expands on the idea from cheeseplus' URL
[2012-08-29 19:17:35 -0400] cheeseplus: jmartin: that is actually the one I was looking for since I actually use it
[2012-08-29 19:17:41 -0400] cheeseplus: my googling failed me
[2012-08-29 19:20:06 -0400] manuel__: awsesome
[2012-08-29 19:20:40 -0400] manuel__: let's assume for catastrophe purposes that my chef server dies
[2012-08-29 19:20:52 -0400] manuel__: and i don't have a backup
[2012-08-29 19:20:58 -0400] manuel__: (silly, but just a hypothetical)
[2012-08-29 19:21:08 -0400] manuel__: how do I go about reconfiguring all nodes that I know of, to join the infrastructure?
[2012-08-29 19:24:22 -0400] angrybit: Quick question.  I just did a fresh install of chef client on a brand new EC2 64bit Linux box.  On running chef-client -v, I spike at 100% CPU usage for about 15 seconds, before getting any output.  Is this a known issue?
[2012-08-29 19:25:35 -0400] ryker: angrybit: try doing /opt/chef/embedded/bin/gem update --system
[2012-08-29 19:27:21 -0400] ryker: manuel__: if your chef server is completely gone and no way to get anything back, you would have to delete /etc/chef/client.pem on each node and run chef-client again to have it work with the new server. (assuming the new chef server has the same ip/dns as what's in the client.rb file)
[2012-08-29 19:27:35 -0400] manuel__: excellent
[2012-08-29 19:27:40 -0400] manuel__: that is good enough
[2012-08-29 19:28:16 -0400] ryker: actually, you'd need to redistribute the new validation.pem file as well to each client, since that will change as well with the new server
[2012-08-29 19:28:53 -0400] angrybit: ryker: Thanks; that helped a lot.  RubyGems was updated and it now takes 2 seconds to load the chef client.  Should this be standard procedure when deploying Chef to a new box?
[2012-08-29 19:29:27 -0400] manuel__: what about the role information?
[2012-08-29 19:29:30 -0400] manuel__: will that be lost too?
[2012-08-29 19:29:33 -0400] ryker: angrybit: there is a reported issue for that, so until it gets fixed, yeah.
[2012-08-29 19:30:01 -0400] angrybit: ryker: Thanks.
[2012-08-29 19:30:17 -0400] ryker: manuel__: yes, all of your role information is on the server.  how important that is, depends on how you use chef and what your chef code looks like
[2012-08-29 19:30:46 -0400] ryker: i have a base role for all servers, which runs a recipe that inspects the server and adds appropriate roles.
[2012-08-29 19:31:11 -0400] ryker: so, it's not a big deal if a node gets deleted and has to have chef-client installed again.
[2012-08-29 19:31:49 -0400] ryker: manuel__: you would have to figure out what works best for your environment and how you would recover from something like that
[2012-08-29 19:32:06 -0400] ryker: obviously, best thing is, make sure you chef server is backed up. :)
[2012-08-29 19:32:22 -0400] manuel__: agreed
[2012-08-29 19:34:18 -0400] ryker: angrybit: apparently that problem is already fixed in the soon to be released 10.14. http://tickets.opscode.com/browse/CHEF-2871
[2012-08-29 19:34:30 -0400] jmartin: hrm is it possible to select a data bag in a recipe for use only when the node is part of a specific environment?
[2012-08-29 19:35:56 -0400] kcb_: what's a good example of a cookbook that uses mixlib::shellout?
[2012-08-29 19:36:13 -0400] angrybit: ryker: Thanks.  I'll keep an eye on it.  To clarify, the omnibus installs its own Ruby ENV and RubyGem and does not use the system Ruby or RubyGem, correct?
[2012-08-29 19:36:28 -0400] ryker: angrybit: correct
[2012-08-29 19:36:47 -0400] yfeldblum: jmartin, not sure what that question means
[2012-08-29 19:37:09 -0400] angrybit: ryker: Is that the preferred method, or is it better to install chef-client as a gem on the system ruby?
[2012-08-29 19:37:19 -0400] cheeseplus: jmartin: node.chef_environment
[2012-08-29 19:37:30 -0400] jmartin: yfeldblum: im probably phrasing this wrong
[2012-08-29 19:37:35 -0400] jmartin: cheeseplus: oh nice
[2012-08-29 19:37:46 -0400] cheeseplus: just do a conditional on the node['chef_environment']
[2012-08-29 19:38:14 -0400] ryker: angrybit: not sure.  i would imagine it's just a matter of personal preference.
[2012-08-29 19:39:25 -0400] jmartin: cheeseplus: would it be easier to simply set an environment attribute to point to the name of the databag i want to use?
[2012-08-29 19:39:41 -0400] cheeseplus: jmartin: I was actually typing exactly that out
[2012-08-29 19:39:42 -0400] yfeldblum: cheeseplus, chef_environment is not a node attribute, so only `node.chef_environment` will work, not `node["chef_environment"]`
[2012-08-29 19:39:45 -0400] angrybit: ryker: gotcha.  it seems like the omnibus installer gets a little weird with RVM.  I wonder if installed at the system level and setting rvm to use the system ruby (when needed) would be a better approach.  I'll play with it.  thanks.
[2012-08-29 19:40:21 -0400] yfeldblum: jmartin, if you think of data-bags as like mysql tables and data-bag items as like records in a table, then that seems like a weird question
[2012-08-29 19:40:58 -0400] yfeldblum: jmartin, you wouldn't have a "_default" table and a "production" table and a "qa" table in a database
[2012-08-29 19:41:11 -0400] smcg: does omnibus have everything needed to run chef-solo?
[2012-08-29 19:41:45 -0400] cheeseplus: smcg: yep
[2012-08-29 19:42:41 -0400] jmartin: yfeldblum: this is true, but i was simply thinking of trying to keep things segregated as the environments are totally disparate as opposed to 'versions' of the same thing
[2012-08-29 19:43:18 -0400] jmartin: but your analogy clarifies things a bit
[2012-08-29 19:43:27 -0400] smcg: so once I install omnibus, what would be the absolute minimum number of steps to run a cookbook located at some url
[2012-08-29 19:44:27 -0400] cheeseplus: chef-solo -c ~/solo.rb -j ~/node.json  -r http://www.example.com/chef-solo.tar.gz
[2012-08-29 19:44:46 -0400] yfeldblum: jmartin, chef-environments do not actually offer any isolation, so you may want to rethink that a bit ...
[2012-08-29 19:45:09 -0400] cheeseplus: smcg: that is right from the wiki, you'd want to have ~/solo.rb and ~/node.json configured
[2012-08-29 19:45:47 -0400] cheeseplus: yfeldblum: but you can do per_env_run lists and setting cookbook versions (if multiple are stored on the server)
[2012-08-29 19:45:54 -0400] yfeldblum: jmartin, using chef-environments for segregation seems to me to be like using a hair dryer to open a car door
[2012-08-29 19:45:55 -0400] smcg: does solo.rb and node.json have to be located there, or is that just an example?
[2012-08-29 19:46:00 -0400] cheeseplus: so wouldn't that offer some islolation?
[2012-08-29 19:46:06 -0400] yfeldblum: cheeseplus, no
[2012-08-29 19:47:14 -0400] jordane: smcg: they can be located wherever, just use the -c and -j flags to tell chef-solo where they are located.
[2012-08-29 19:47:15 -0400] yfeldblum: cheeseplus, which is the trouble, of course, because it appears to kind of offer something that could be interpreted as looking vaguely like segregation or isolation
[2012-08-29 19:47:19 -0400] Loof: I'm trying to use knife ec2 create... and it doesn't seem to be creating the client & node in chef
[2012-08-29 19:47:28 -0400] Loof: The bootstrap fails /w failure to auth
[2012-08-29 19:47:53 -0400] Loof: There's a client.pem there, so presumably it came from somewhere
[2012-08-29 19:48:03 -0400] cheeseplus: yfeldblum: I follow, those features feel like an approximation of isloation
[2012-08-29 19:48:06 -0400] Loof: the client.rb looks right as well
[2012-08-29 19:48:23 -0400] jmartin: yfeldblum: so in order to achieve isolation id just need to have separate chef-server's for each environment
[2012-08-29 19:48:44 -0400] yfeldblum: cheeseplus, that's right, and it's not hard
[2012-08-29 19:49:23 -0400] cheeseplus: smcg: an example, it could use the default solo.rb in /etc/chef
[2012-08-29 19:50:42 -0400] cheeseplus: smcg: and you can put the json_attribs in solo.rb
[2012-08-29 19:50:57 -0400] smcg: cheeseplus: I installed chef and it did not create /etc/chef
[2012-08-29 19:53:18 -0400] yfeldblum: to be fair, chef-environments offer demonstrable benefits, and are certainly useful in any variety of cases ... it's just a mistake to think that "segregation" is among the numerous actual benefits when it's not
[2012-08-29 19:54:41 -0400] cheeseplus: smcg: what os?
[2012-08-29 19:55:37 -0400] smcg: ubuntu 11.10 server
[2012-08-29 19:55:57 -0400] smcg: cheeseplus: ubuntu 11.10 server
[2012-08-29 19:56:03 -0400] Loof: Ugh
[2012-08-29 19:56:14 -0400] Loof: I'm pretty sure it's because I have an /etc/chef/client.pem there
[2012-08-29 19:56:31 -0400] Loof: Is there any way to tell bootstrap and/or ec2 create to force a new cert
[2012-08-29 19:58:48 -0400] jmartin: remove the cert on purpose in your bootstrap script?
[2012-08-29 19:58:51 -0400] jmartin: hacky
[2012-08-29 20:01:13 -0400] cheeseplus: smcg: there doesn't necessarily need to be anything in /etc/chef
[2012-08-29 20:02:11 -0400] smcg: cheeseplus: you had mentioned that there was a default solo.rb, so I was trying to find it
[2012-08-29 20:02:28 -0400] cheeseplus: that is the default location, it doesn't exist there by default
[2012-08-29 20:02:38 -0400] cheeseplus: so chef-solo will look there first
[2012-08-29 20:03:00 -0400] cheeseplus: if now, you can just use the "-c config" option
[2012-08-29 20:03:04 -0400] cheeseplus: not*
[2012-08-29 20:05:49 -0400] urbanphoton: Has anyone recently tried to work with installing OpenStack using the Opscode cookbooks?
[2012-08-29 20:06:17 -0400] urbanphoton: The newest documentation on the Opscode site is years old and involves a data bag no longer in the current repos
[2012-08-29 20:06:50 -0400] urbanphoton: Instead, the most recent changes seem to be in Opscode employee Matt Ray's personal repo
[2012-08-29 20:07:11 -0400] urbanphoton: The recipes and roles now target the Essex release
[2012-08-29 20:07:28 -0400] urbanphoton: However there has been zero updates to the documentation for the roles
[2012-08-29 20:08:47 -0400] cheeseplus: urbanphoton: I'd wager the best you'll find would be in Matt Ray's repo
[2012-08-29 20:10:10 -0400] urbanphoton: That's what I'm working with, I've just run into a few problems with the RabbitMQ and Nova network configuration and was wondering if anyone had some personal experience
[2012-08-29 20:10:56 -0400] cheeseplus: urbanphoton: if you can catch mattray in here I can almost guarantee he does
[2012-08-29 20:11:18 -0400] manuel__: rake install seems like it does not upload the environments specified in environments/*.rb
[2012-08-29 20:11:21 -0400] manuel__: what gives?
[2012-08-29 20:11:28 -0400] urbanphoton: Good to know he stops by, I'll hang out then, thanks cheeseplus
[2012-08-29 20:12:11 -0400] cheeseplus: manuel__: it may just be all cookbooks, never tried to upload more than that
[2012-08-29 20:12:22 -0400] manuel__: the environments do not get created
[2012-08-29 20:12:31 -0400] manuel__: root@cloudcontroller:/home/ubuntu/cloud-configuration/chef-repo# rake install
[2012-08-29 20:12:31 -0400] manuel__: ** Updating your repository
[2012-08-29 20:12:31 -0400] manuel__: * No SCM configured, skipping update
[2012-08-29 20:12:32 -0400] manuel__: Uploaded 0 cookbook.
[2012-08-29 20:12:58 -0400] manuel__: root@cloudcontroller:/home/ubuntu/cloud-configuration/chef-repo# ls environments/
[2012-08-29 20:12:58 -0400] manuel__: operations.rb  README.md
[2012-08-29 20:13:04 -0400] manuel__: operations did not get updated
[2012-08-29 20:13:15 -0400] manuel__: did not even get created
[2012-08-29 20:13:28 -0400] cheeseplus: I guess rake install doesn't upload anything more than cookbooks then
[2012-08-29 20:14:09 -0400] cheeseplus: knife environment from file environments/operations.rb
[2012-08-29 20:14:10 -0400] manuel__: huh?  the documentations explicitly state otherwise
[2012-08-29 20:15:07 -0400] cheeseplus: well either they don't or there is a problem with the file
[2012-08-29 20:15:07 -0400] smcg: what needs to be in node.json for chef-solo?
[2012-08-29 20:15:11 -0400] manuel__: Environments created through this mechanism get compiled to JSON, and then are loaded in to the Chef Server. (We never execute ruby code directly on the chef server!) Each time you rake install your Chef Repository, we will re-compile the corresponding JSON and store it in the chef server.
[2012-08-29 20:15:42 -0400] manuel__: ideas?
[2012-08-29 20:16:17 -0400] cheeseplus: manuel__: if you try "knife environment from file environments/operations.rb" you can see if there is an error
[2012-08-29 20:17:07 -0400] manuel__: let me try that
[2012-08-29 20:17:23 -0400] manuel__: no error
[2012-08-29 20:17:27 -0400] manuel__: it said updated environment operations
[2012-08-29 20:18:03 -0400] manuel__: well that worked
[2012-08-29 20:19:19 -0400] manuel__: how do I enroll the same machine that has chef server as a chef client?
[2012-08-29 20:19:27 -0400] manuel__: you know, so I can run the stuff directly
[2012-08-29 20:19:30 -0400] manuel__: through chef
[2012-08-29 20:19:33 -0400] manuel__: yo dawg
[2012-08-29 20:19:36 -0400] manuel__: :-)
[2012-08-29 20:22:05 -0400] cheeseplus: manuel__: you can bootstrap it just like any node
[2012-08-29 20:22:37 -0400] cheeseplus: http://wiki.opscode.com/display/chef/Workstation+Setup
[2012-08-29 20:24:06 -0400] manuel__: [Wed, 29 Aug 2012 20:23:06 +0000] INFO: Client key /etc/chef/client.pem is not present - registering
[2012-08-29 20:24:06 -0400] manuel__: [Wed, 29 Aug 2012 20:23:06 +0000] INFO: HTTP Request Returned 404 Not Found: Cannot load node localhost
[2012-08-29 20:24:16 -0400] manuel__: why does chef client believe that my machine is localhost?
[2012-08-29 20:25:25 -0400] cheeseplus: manuel__: is that it
[2012-08-29 20:25:29 -0400] cheeseplus: s hostname?
[2012-08-29 20:26:29 -0400] manuel__: no
[2012-08-29 20:26:33 -0400] manuel__: its hostname is cloudcontroller
[2012-08-29 20:26:57 -0400] manuel__: is it doing some sort of reverse dns resolution?
[2012-08-29 20:27:28 -0400] cheeseplus: if you've got localhost in /etc/hosts then it's probably getting it from there
[2012-08-29 20:27:42 -0400] cheeseplus: if this is the same as the server
[2012-08-29 20:27:44 -0400] manuel__: grrr
[2012-08-29 20:29:55 -0400] manuel__: [Wed, 29 Aug 2012 20:29:44 +0000] INFO: Client key /etc/chef/client.pem is not present - registering
[2012-08-29 20:29:55 -0400] manuel__: [Wed, 29 Aug 2012 20:29:44 +0000] INFO: HTTP Request Returned 404 Not Found: Cannot load node cloudcontroller
[2012-08-29 20:31:11 -0400] manuel__: ok this worked
[2012-08-29 20:31:12 -0400] manuel__: thanks!
[2012-08-29 20:31:13 -0400] manuel__: :-)
[2012-08-29 20:31:20 -0400] manuel__: you guys have some great software on your hands
[2012-08-29 20:31:32 -0400] manuel__: the docs are a bit lacking still
[2012-08-29 20:31:45 -0400] manuel__: there are key details (the type of "assumed info") missing in the docs
[2012-08-29 20:31:56 -0400] manuel__: but once those key details are discovered
[2012-08-29 20:31:58 -0400] manuel__: it's pretty good
[2012-08-29 20:32:30 -0400] smcg: cheeseplus: what needs to be in node.json for chef-solo?
[2012-08-29 20:33:39 -0400] manuel__: is there any way I can create a node in the webui and then launch it as an ec2 instance without having to use knife byh and?
[2012-08-29 20:36:00 -0400] manuel__: if I add a cookbook to a _default environment, is it available (inherited) for other environments as well?
[2012-08-29 20:43:05 -0400] miah: cookbooks are available to all environments unless restricted by the environment
[2012-08-29 20:46:25 -0400] freerobby: Is there a best practice for handling chef recipes that require a linux restart?
[2012-08-29 20:46:36 -0400] freerobby: Other than to output a warning of some sort? Feels dirty.
[2012-08-29 20:49:35 -0400] freerobby: Or, are there any other examples of such cookbooks that anybody knows of?
[2012-08-29 20:56:17 -0400] jawong: in the main cheffile, why would i ever use a role "vagrant", rather than just adding a recipe "vagrant_main"?
[2012-08-29 20:56:31 -0400] jawong: or role web vs recipe web?
[2012-08-29 21:00:26 -0400] smcg: so I am trying to run chef-solo to run a cookbook from a url, just "chef-solo -r [my-url]". But it doesn't seem to be downloading anything, and then chef yells at me for not having any cookbooks
[2012-08-29 21:02:24 -0400] cheeseplus: jawong: roles  can set or override attributes
[2012-08-29 21:02:39 -0400] cheeseplus: a role can also include a run list of many recipes
[2012-08-29 21:02:43 -0400] jawong: ah
[2012-08-29 21:03:07 -0400] cheeseplus: so a role of web could include dozens of recipes
[2012-08-29 21:06:48 -0400] jawong: doesn't the vagrant_main also run dozens of recipes, though?
[2012-08-29 21:08:56 -0400] cheeseplus: smcg: did you configure solo.rb or nodes.json?
[2012-08-29 21:09:11 -0400] cheeseplus: smcg: nodes.json will include your run_list
[2012-08-29 21:10:09 -0400] smcg: cheeseplus: um, I saw 2 different syntaxes, one was recipes: [ recipe1, recipe2 ]
[2012-08-29 21:10:15 -0400] cheeseplus: jawong: as a cookbook, it could contain dozen but that doesn't mean they run them all
[2012-08-29 21:10:24 -0400] jameson1: freerobby: there is one restart recipe on github. but generally even from a sysadmin perspective, the best you can do is give a warning, and restart gracefully.
[2012-08-29 21:10:35 -0400] smcg: the other had the run_list
[2012-08-29 21:10:52 -0400] freerobby: jameson1: thanks.
[2012-08-29 21:11:12 -0400] jameson1: smcg: I recommend run_list, because you can include other roles
[2012-08-29 21:11:15 -0400] jameson1: instead a long list of recipes
[2012-08-29 21:11:26 -0400] yfeldblum: freerobby, why do you need to restart?
[2012-08-29 21:11:38 -0400] jameson1: ^
[2012-08-29 21:12:11 -0400] smcg: ok, turns out I had a file path in solo.rb incorrect
[2012-08-29 21:12:23 -0400] smcg: but now I am getting an error
[2012-08-29 21:12:25 -0400] freerobby: yfeldblum: updating various settings in /etc/security/limits.conf
[2012-08-29 21:13:05 -0400] smcg: is it ok if I pm someone  a stacktrace?
[2012-08-29 21:13:08 -0400] cheeseplus: smcg: use gist or pastebin for your error
[2012-08-29 21:13:50 -0400] smcg: https://gist.github.com/ca866ff4d6932340695e
[2012-08-29 21:15:40 -0400] smcg: I also put my config file contents in there
[2012-08-29 21:20:51 -0400] cheeseplus: smcg: that tarball is several cookbooks
[2012-08-29 21:22:28 -0400] smcg: cheeseplus: oh. how bout that. I got it from opscode-cookbooks/tomcat, and downloaded it as tar.gz
[2012-08-29 21:22:52 -0400] miah: why cant https://github.com/miah/nagios/blob/refactor/definitions/nagios_conf.rb#L34 find https://github.com/miah/nagios/blob/refactor/recipes/server.rb#L38
[2012-08-29 21:26:05 -0400] smcg: oh i'm dumb, apparently I downloaded the entire opscode cookbooks repo
[2012-08-29 21:28:20 -0400] smcg: cheeseplus: but I still get the same "can't convert nil to String" error when I point to the correct tar.gz
[2012-08-29 21:31:14 -0400] jawong: ah, that makes sense.  so the role defines what's run inside the cookbook
[2012-08-29 21:31:47 -0400] cheeseplus: jawong: roles are just arbitrary containers
[2012-08-29 21:31:54 -0400] cheeseplus: a cookbook can include several recipes
[2012-08-29 21:32:05 -0400] yfeldblum: miah, good question
[2012-08-29 21:37:36 -0400] miah: i think i figured out a path that its failing in my recipe structure
[2012-08-29 21:37:39 -0400] miah: testing now
[2012-08-29 21:38:35 -0400] miah: i also just started building out my test-kitchen for this cookbook. will be interesting to see that thing chug along.
[2012-08-29 21:44:16 -0400] angrybit: i have a general question about chef architecture.  let's say i have a recipe to add a sysadmin user to my node.  presumably, i would store the user details, including public key, in a data bag.  let's say I add this user to one node, and then update the user's public key in the data bag, then add the user to a different node.  how am i warned that the users on the two nodes are out of sync, or how do i avoid this situation?
[2012-08-29 21:45:25 -0400] yfeldblum: angrybit, by running chef-client on the first node periodically?
[2012-08-29 21:46:59 -0400] thehar: how to avoid drift. opinions flow.
[2012-08-29 21:48:19 -0400] btm: A RC gem and Omnibus packages are available for #opschef 10.14.0. Test it out. http://lists.opscode.com/sympa/arc/chef/2012-08/msg00383.html
[2012-08-29 21:55:47 -0400] angrybit: yfeldblum: would that Just Work?  in the scenario described the only thing that would change is the data bag.  i assume i would need to create a specific recipe to run periodically that makes sure the data on the node (in this case authorized keys) match what's in the data bag.
[2012-08-29 21:56:20 -0400] cheeseplus: angrybit: I do something similar with our sudoers cookbook
[2012-08-29 21:56:48 -0400] btm: angrybit: when you say "add the user" you mean using a user resource in Chef, not doing so by hand, right?
[2012-08-29 21:56:49 -0400] cheeseplus: chef runs periodically and while it doesn't use a databag, looks up which users are in an LDAP group, and adds or removes them from sudo
[2012-08-29 21:57:15 -0400] yfeldblum: angrybit, no, it wouldn't Just Work - you have to write the code that fetches the data-bag items in the data-bag, declares corresponding resources, fiddles anything else that needs to be fiddled, and figures out by some mechanism what users are old and need to be deleted
[2012-08-29 21:57:19 -0400] angrybit: btm: sorry, i meant add a system user to the node.  not adding a chef user.
[2012-08-29 21:58:22 -0400] angrybit: yfeldblum: thanks.  that's what i figured.  i'm setting up chef for the first time in a small subset of our environment and trying to wrap my head around the Right Way to do things.
[2012-08-29 21:59:44 -0400] btm: angrybit: ah. you should use Chef to add the users to the node, don't do it by hand. Manage the entire user as a single resource.
[2012-08-29 22:00:05 -0400] btm: angrybit: then you periocially run chef on every node, and when you do, you know the user is the same everywhere.
[2012-08-29 22:00:10 -0400] yfeldblum: angrybit, IMO the "Right Way" is to think of recipes as though they were programs that you run in order to get done what you need done, and data-bags as mysql tables whose records can be enumerated, fetched, and searched at will by your recipes ...
[2012-08-29 22:01:24 -0400] angrybit: yfeldblum: that makes perfect sense.
[2012-08-29 22:02:06 -0400] angrybit: along a similar vein, using chef for something like nightly DB of file system backups probably doesn't make sense.  rather, i should be using chef to install my custom back script and cron job for the script.  would you agree?
[2012-08-29 22:02:16 -0400] angrybit: DB or*
[2012-08-29 22:02:16 -0400] yfeldblum: angrybit, with a caveat that: the things that recipes do being to query data from multiple places and to declare resources that, *after the recipe is finished running*, chef compares against the system and changes the system to bring it into line with the resources
[2012-08-29 22:04:38 -0400] yfeldblum: angrybit, that's right, you can use chef to drop scripts and cron them up (or just leave them there to be invoked manually over ssh), but you probably don't want to use chef to run those scripts
[2012-08-29 22:05:00 -0400] _0x783czar: is a default recipe require in a cookbook?
[2012-08-29 22:05:06 -0400] yfeldblum: _0x783czar, no
[2012-08-29 22:05:12 -0400] _0x783czar: yfeldblum: thanks
[2012-08-29 22:05:32 -0400] yfeldblum: _0x783czar, but most people will put one in anyway and leave it just a blank file
[2012-08-29 22:05:50 -0400] angrybit: yfeldblum: i think i understand.  but to be clear, if the recipe has been run once previously (i.e. I added the user via a recipe 1 year ago) and today I update the user's shell in the data-bag, the node has no way of knowing that the shell for the already existing user should be updated.
[2012-08-29 22:06:46 -0400] _0x783czar: yfeldblum: good to know
[2012-08-29 22:07:11 -0400] angrybit: unless of course i write a recipe that explicitly compares the user's configuration on the node against the expected config in the data-bag.
[2012-08-29 22:07:51 -0400] yfeldblum: angrybit, you declare a user resource with the up-to-date info (including the up-to-date shell, as well as all the other info such as name, uid, gid, pubkey, etc); then after your recipe is finished running, chef will inspect the state of the system and compare it to what you declared in the resources (possibly derived from information in data-bag items) and change the system to bring it into line with the resources that you declared in
[2012-08-29 22:07:52 -0400] yfeldblum: the recipes
[2012-08-29 22:08:04 -0400] jtimberman: for example, opscode's mysql cookbook, default includes the client recipe
[2012-08-29 22:08:47 -0400] _0x783czar: jtimberman: OK that makes sense
[2012-08-29 22:08:49 -0400] yfeldblum: jtimberman, that's because opscode is a bunch of oraclehuggers isn't it
[2012-08-29 22:09:23 -0400] angrybit: yfeldblum: so i should think of a user as a resource?  i think that's my mistake.  i was thinking of a user only as the output of a recipe (i.e., creating a user on the node).  i didn't think of it as a resource.
[2012-08-29 22:09:53 -0400] jawong: so i'm trying to use the rbenv from riotgames - and it's dying on the following message - /bin/mkdir: cannot create directory `/opt/rbenv/versions/1.9.3-p194': Permission denied
[2012-08-29 22:10:00 -0400] yfeldblum: angrybit, http://wiki.opscode.com/display/chef/Resources#Resources-User
[2012-08-29 22:10:19 -0400] jawong: How do i set permissions in chef so rbenv from riotgames works?
[2012-08-29 22:11:23 -0400] angrybit: yfeldblum: thanks.  was looking at that exact page, actually.  the interplay between recipes and resources is still fuzzy to me.  no need to expound though.  i'll continue digging through the docs for the moment.
[2012-08-29 22:11:28 -0400] yfeldblum: angrybit, you can use normal ruby to search and fetch data from other places (such as data bag items) and use if-else conditionals and loops and local variables and other constructs to set up the user resource declarations how you want them to be
[2012-08-29 22:12:51 -0400] yfeldblum: angrybit, a recipe is ruby code whose proper purpose is: to look at the node's attributes, to fetch and query data from other sources, and to declare multiple resources representing the state of the system as it ought to be; once the recipes have run, chef will look at the actual resources the recipes have declared and use that as the goalpost when updating the system
[2012-08-29 22:12:52 -0400] jmartin: to access an attribute in an execute resource command would something like ' command "echo" + node['greeting'] ' result in 'echo contentsofattribute' being executed?
[2012-08-29 22:14:19 -0400] yfeldblum: jmartin, yes
[2012-08-29 22:14:22 -0400] jmartin: http://pastebin.com/NK9sqwRL <-- for more clarity
[2012-08-29 22:14:23 -0400] jmartin: ah ok
[2012-08-29 22:14:26 -0400] jmartin: thanks
[2012-08-29 22:14:57 -0400] yfeldblum: jmartin, ruby doesn't automatically add a space when you use + to concatenate strings
[2012-08-29 22:15:13 -0400] angrybit: yfeldblum: thanks for that clarification.  i have more questions, of course, but i don't want to impose on your good nature.  you've been a great help already.
[2012-08-29 22:15:26 -0400] yfeldblum: angrybit, feel free to ask away
[2012-08-29 22:16:39 -0400] jtimberman: yfeldblum: lol
[2012-08-29 22:17:10 -0400] jtimberman: postgresql does the same :P
[2012-08-29 22:17:12 -0400] angrybit: thanks.  this is a similar question, perhaps, but a more simple form.  if i specify an installed package should be version X and run chef-client on the node, the package will be updated to the appropriate version.  if i manually downgrade the package (not using chef) and then re-run chef-client (without adding anything to the run list) what will happen?
[2012-08-29 22:17:48 -0400] jtimberman: jmartin: you should use command "echo #{node['greeting']}"
[2012-08-29 22:18:06 -0400] angrybit: the root of the question is whether chef keeps track of the changes it has made, or whether it inspects the state of the system each time it's run.
[2012-08-29 22:18:49 -0400] yfeldblum: angrybit, chef inspects the state of the system each time it's run
[2012-08-29 22:19:38 -0400] yfeldblum: angrybit, and compares the state that it found to the state that the recipes have declared by means of declaring multiple resources
[2012-08-29 22:19:53 -0400] angrybit: yfeldblum: got it.  it takes a while to break out of the mindset of just running dumb scripts on servers and actually understand that chef is state aware.
[2012-08-29 22:21:56 -0400] yfeldblum: angrybit, e.g., https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/user.rb#L121-134
[2012-08-29 22:22:46 -0400] yfeldblum: angrybit, that's the top-level chef code that handles user resources
[2012-08-29 22:22:58 -0400] carlp: Greetings! Does anyone know of the existance of any redis-sentinel cookbooks?
[2012-08-29 22:24:43 -0400] angrybit: yfeldblum: thanks for that link.  it's nice to see the user attributes it compares and inspects for changes.
[2012-08-29 22:24:45 -0400] yfeldblum: angrybit, which delegates to https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/user/useradd.rb on debianoids
[2012-08-29 22:25:58 -0400] angrybit: do you find you have to create custom providers often, for what you do?
[2012-08-29 22:27:09 -0400] yfeldblum: angrybit, not too often; most of the time, the providers that ship with chef do what needs to be done
[2012-08-29 22:28:05 -0400] yfeldblum: angrybit, but if you want to have a new type of abstraction, usually something higher-level than files, users, and mounts, you might want to make your own resource and provider classes to implement that abstraction
[2012-08-29 22:28:32 -0400] yfeldblum: angrybit, most people might make a few of those as they get more familiar with chef
[2012-08-29 22:29:10 -0400] angrybit: yfeldblum: yeah, i'm trying to think of something i may want to abstract out as a provider, but as i work in a pretty homogeneous environment, nothing is springing to mind.
[2012-08-29 22:29:16 -0400] yfeldblum: angrybit, they often end up being highly-specific for their infrastructures and therefore not generic or shareable, but sometimes they're generic and shareable
[2012-08-29 22:30:52 -0400] angrybit: yfeldblum: i suppose something like adding a web server to a load balancer could be abstracted out as a provider.  given that i use both amazon load balancing and LVS.
[2012-08-29 22:31:29 -0400] yfeldblum: angrybit, maybe - or you might just want to declare a set of builtin resources in a loop
[2012-08-29 22:32:24 -0400] angrybit: yfeldblum: that makes sense.  thanks again for all your help.
[2012-08-29 22:32:46 -0400] yfeldblum: angrybit, i don't recommend that people jump to making their own resource & provider classes - it's better to think long and hard about exactly what the right abstraction is first
[2012-08-29 22:34:01 -0400] yfeldblum: angrybit, after due reflection, make 'em, but don't jump to making 'em
[2012-08-29 22:35:01 -0400] angrybit: yfeldblum: understood.  sage advice.
[2012-08-29 22:35:19 -0400] miah: totally good advice =)
[2012-08-29 22:45:01 -0400] _0x783czar: is there a command to upload everything in your chef repo to the server?
[2012-08-29 22:56:40 -0400] yfeldblum: _0x783czar, while useful, i'm not sure such a command would be very correct
[2012-08-29 22:56:47 -0400] yfeldblum: _0x783czar, but you can check out knife-essentials
[2012-08-29 22:59:24 -0400] _0x783czar: yfeldblum: makes sense, just checking
[2012-08-29 23:14:39 -0400] hashpuppy_: how do you guys get started w/ chef?  do i just setup an ubuntu openbox vm and use chef in standalone mode?
[2012-08-29 23:19:36 -0400] jessicab: hashpuppy_: probably the easiest and most documented is just running chef-client, with hosted chef or your own chef server http://wiki.opscode.com/display/chef/Fast+Start+Guide you could also use chef-solo though if you wanted to run it without a server.. but might be a bit confusing if youre just starting with chef http://wiki.opscode.com/display/chef/Chef+Solo
[2012-08-29 23:20:32 -0400] hashpuppy_: thanks
[2012-08-29 23:20:59 -0400] mjreed: chef > node.platform
[2012-08-29 23:20:59 -0400] mjreed:  => "ubuntu"
[2012-08-29 23:21:00 -0400] mjreed: chef > node.platform?("centos")
[2012-08-29 23:21:00 -0400] mjreed:  => "centos"
[2012-08-29 23:21:06 -0400] mjreed: shouldn't that second call return false?
[2012-08-29 23:22:35 -0400] hoover_damm: o
[2012-08-29 23:22:37 -0400] hoover_damm: no*
[2012-08-29 23:22:48 -0400] hoover_damm: mjreed, node.platform.include?("centos")
[2012-08-29 23:22:58 -0400] mjreed: so what's Node#platform? for
[2012-08-29 23:23:06 -0400] hoover_damm: mjreed, but likely that's what you want values_for_platform
[2012-08-29 23:23:35 -0400] mjreed: the cookook I'm using has node.platform?("centos", "redhat", "freebsd")
[2012-08-29 23:23:51 -0400] mjreed: I modified to to say %w<centos redhat freebsd>.include? node.platform
[2012-08-29 23:23:58 -0400] mjreed: but I'm still curious what the platform? method is intended for
[2012-08-29 23:25:57 -0400] mjreed: ah.
[2012-08-29 23:26:09 -0400] mjreed: it appears to be a method_missing hack
[2012-08-29 23:26:26 -0400] mjreed: node.anything?(blah) => node.anything || blah
[2012-08-29 23:26:40 -0400] hoover_damm: mjreed, http://wiki.opscode.com/display/chef/Cookbooks
[2012-08-29 23:26:45 -0400] hoover_damm: i'm pretty sure that's bad code
[2012-08-29 23:26:51 -0400] hoover_damm: you should open a bug on that cookbook
[2012-08-29 23:27:06 -0400] miah: node.platform displays the nodes platform.
[2012-08-29 23:27:18 -0400] miah: oh platform?
[2012-08-29 23:27:30 -0400] hoover_damm: miah, node.platform?"miahridesapony"
[2012-08-29 23:27:34 -0400] miah: ya
[2012-08-29 23:27:48 -0400] hoover_damm: now your platform is pony like
[2012-08-29 23:27:49 -0400] hoover_damm: !
[2012-08-29 23:28:01 -0400] miah: yay i got a pony for my birthday! thank you daddy damm!
[2012-08-29 23:28:46 -0400] hoover_damm: knowing I just spent a thousand dollars on my grandaughter ...
[2012-08-29 23:29:11 -0400] hoover_damm: a little under, mom doesn't want to leave utah yet
[2012-08-29 23:29:28 -0400] hoover_damm: and they won't let the kid go to preschool because her mom isn't a good mormon
[2012-08-29 23:29:40 -0400] hoover_damm: so send down some stuff so she can read and learn and not fail :)
[2012-08-29 23:40:28 -0400] yfeldblum: mjreed, you're looking for https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/language.rb#L111-128
[2012-08-29 23:40:37 -0400] yfeldblum: mjreed, which is not a method on Chef::Node
[2012-08-29 23:41:31 -0400] yfeldblum: mjreed, also, Chef::Node is designed to mimic Hash, and you cannot use a Hash like `my_hash.platform?("centos")` when what you mean is `my_hash["platform"] == "centos"`
[2012-08-29 23:41:57 -0400] mjreed: yfeldblum: not my code. just trying to fix it. :)
[2012-08-29 23:42:06 -0400] mjreed: OK, so platform? without the node. in front of it should work
[2012-08-29 23:42:21 -0400] yfeldblum: mjreed, yes
[2012-08-29 23:46:01 -0400] mjreed: ah, but this is inside a template, so the mixin methods aren't there.
[2012-08-29 23:46:10 -0400] yfeldblum: mjreed, that's right
[2012-08-29 23:46:10 -0400] mjreed: I think I'll stick with my array.include? approach.
[2012-08-29 23:46:36 -0400] mjreed: Thanks for the tips, yfeldblum.
[2012-08-29 23:47:28 -0400] yfeldblum: mjreed, no probs
[2012-08-29 23:58:43 -0400] _0x783czar: yfeldblum: can I abort a recipe just like any other ruby script?  (i.e. abort())  Or is there a more elegant way to do so in Chef?
