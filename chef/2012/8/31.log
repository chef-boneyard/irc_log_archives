[2012-08-31 00:00:10 -0400] jtimberman: syphon: latest chef-client cookbook supports installing gems to use in client.rb
[2012-08-31 00:00:59 -0400] jtimberman: syphon: if you want to just install a gem to use for chef elsewhere in your cookbooks, then put it in a recipe, the chef_gem resource will do that. if you needa gem for your application, the gem_package resource will do that (you'll need a recipe to install your ruby)
[2012-08-31 00:01:04 -0400] masterkorp: cheeseplus: once i had a couch in my house
[2012-08-31 00:01:25 -0400] masterkorp: lazy bastard always used all the space in the living room and did nothing all day
[2012-08-31 00:01:27 -0400] syphon: I need the gem for chef itself (the gem is required to use Splunk as a handler)
[2012-08-31 00:01:37 -0400] syphon: so the gem needs to be installed before Chef even runs
[2012-08-31 00:01:45 -0400] cheeseplus: masterkorp: did it keep multiple versions until you forcibly compacted it?
[2012-08-31 00:01:58 -0400] syphon: but it sounds like the chef-client cookbook does what I need anyway
[2012-08-31 00:02:15 -0400] jtimberman: syphon: yeah, chef_gem will do that
[2012-08-31 00:02:18 -0400] cheeseplus: syphon: ahh, sorry didn't catch the part that it was a handler - do what jtimberman said then
[2012-08-31 00:02:24 -0400] jtimberman: syphon: and the chef-client cookbook has that now :)
[2012-08-31 00:02:24 -0400] masterkorp: cheeseplus: no i just trew it away
[2012-08-31 00:02:43 -0400] masterkorp: cheeseplus: he was a bastard always pushing me to lay down and do nothing
[2012-08-31 00:02:51 -0400] masterkorp: such a bad influence
[2012-08-31 00:03:00 -0400] cheeseplus: couches are for earners
[2012-08-31 00:06:39 -0400] jtimberman: http://lists.opscode.com/sympa/arc/chef/2012-08/msg00414.html
[2012-08-31 00:16:12 -0400] jtimberman: leifmadsen: http://tickets.opscode.com/browse/CHEF-3405?focusedCommentId=26728#comment-26728
[2012-08-31 00:16:50 -0400] xmltok: I'm trying to write a chef handler, but it doesnt appear to be running. I'm using the chef_handler cookbook, which is supposed to automatically run the JsonFile report, but that doesnt appear to be running either. So I don't think its my handler code. Aside from installign the cookbook and adding it to my role, what else needs to be done?
[2012-08-31 00:32:36 -0400] Majost1: is it possible to lock the root account from a role?
[2012-08-31 00:32:47 -0400] Majost1: or would I need to create a recipe for that
[2012-08-31 00:39:18 -0400] leifmadsen: jtimberman: ohai :)
[2012-08-31 00:39:42 -0400] leifmadsen: jtimberman: just responded to your request for info on CHEF-3405 fyi
[2012-08-31 01:56:23 -0400] jtimberman: leifmadsen: cheers
[2012-08-31 02:07:01 -0400] zts: xmltok: the default recipe in the chef_handler cookbook doesn't install any handlers - can you confirm that you put recipe[chef_handler::json_file] on your run_list?
[2012-08-31 02:09:55 -0400] xmltok: that was my problem
[2012-08-31 02:59:31 -0400] AdamAFlynn: I'm trying to make a LWRP that configures new upstart services
[2012-08-31 02:59:56 -0400] AdamAFlynn: setup is pretty simple... template and logrotate_app resources inside the :create action
[2012-08-31 03:00:20 -0400] AdamAFlynn: and a service resource (with provider Chef::Provider::Service::Upstart) to define what it supports & enable it
[2012-08-31 03:00:58 -0400] AdamAFlynn: but the notifies block in the template to restart the service doesn't seem to work
[2012-08-31 03:01:09 -0400] AdamAFlynn: getting NoMethodError: undefined method `run_action' for "service[sweeper]":String
[2012-08-31 03:01:58 -0400] AdamAFlynn: (execution is delayed, so the service resource in the provider is hit before I get that error)
[2012-08-31 03:02:38 -0400] AdamAFlynn: I assume it has something to do with the order of execution and service[sweeper] not being available at the time of the notifies
[2012-08-31 03:03:16 -0400] AdamAFlynn: any best practices on how to get around that?
[2012-08-31 03:04:06 -0400] AdamAFlynn: (can pastebin the whole thing if that helps)
[2012-08-31 03:19:05 -0400] zts: AdamAFlynn: yes please (pastebin)
[2012-08-31 03:20:30 -0400] AdamAFlynn: actually, I think I just figured it out
[2012-08-31 03:20:34 -0400] AdamAFlynn: used a subscribe to the template
[2012-08-31 03:20:37 -0400] AdamAFlynn: instead of a notify to the service
[2012-08-31 03:20:44 -0400] AdamAFlynn: looks to be working
[2012-08-31 03:20:59 -0400] AdamAFlynn: thanks though zts
[2012-08-31 03:21:30 -0400] zts: no problem, glad I could help :)
[2012-08-31 03:40:50 -0400] chenxu: sorry to ask again... anyone here handling rate-limiting issues?
[2012-08-31 03:40:54 -0400] chenxu: for hosted chef?
[2012-08-31 03:53:31 -0400] zts: chenxu: what kind of rate-limiting issues?
[2012-08-31 03:54:16 -0400] chenxu: zts: I need to run a demo with 1000 nodes...
[2012-08-31 03:54:26 -0400] chenxu: zts: of coz, I'd like chef to automatically configure them
[2012-08-31 03:54:46 -0400] chenxu: zts: now most of the chef-client runs would fail with connection time-out
[2012-08-31 03:55:03 -0400] chenxu: zts: not sure if I hit a scale limit, or am rate limited by opscode
[2012-08-31 03:55:18 -0400] chenxu: zts: I have an account with hosted chef btw
[2012-08-31 03:55:56 -0400] zts: chenxu: I think you'll need to open a ticket for that - while some opscode staff are in this channel (although usually not at this time of day), support for the commercial products mostly happens elsewhere
[2012-08-31 03:56:07 -0400] chenxu: zts: yeah, I just did
[2012-08-31 03:56:42 -0400] chenxu: zts: I tried many things to reduce churn, like not checking in at the same time, update every 15min+a random delay of 10min, reduce api calls, etc
[2012-08-31 03:56:55 -0400] chenxu: zts: apparently, still too many calls...
[2012-08-31 03:57:33 -0400] chenxu: I set up my own chef-server, but it couldn't scale to handle 1000 nodes...
[2012-08-31 04:38:41 -0400] AdamAFlynn: zts: another (hopefully quick) question for you
[2012-08-31 04:39:00 -0400] AdamAFlynn: any way to make chef ignore an error starting a service?
[2012-08-31 04:39:54 -0400] AdamAFlynn: ah, think I answered my own question again... ignore_failure
[2012-08-31 05:23:19 -0400] jtimberman: chenxu: email support@opscode.com
[2012-08-31 05:23:36 -0400] jtimberman: chenxu: its post office hours for us, but someone should respond tomorrow
[2012-08-31 05:23:36 -0400] chenxu: jtimberman: thx
[2012-08-31 05:23:49 -0400] chenxu: I am switching to pssh for now...
[2012-08-31 05:57:47 -0400] harry8906: testing...
[2012-08-31 06:05:35 -0400] harry8906: hey is there any chef..?
[2012-08-31 06:06:25 -0400] harry8906: want to konw some concepts about chef.
[2012-08-31 06:09:05 -0400] harry8906: i have written a recipe for instaalling java(open jdk), i can run that on my own machine using chef-solo -c config/solo.rb -j config/node.json command, but i want the recipe to remote machine. how to do this
[2012-08-31 06:11:08 -0400] philwo: harry8906: you copy everything to the remote server (using rsync or scp), login there using ssh and run the same command
[2012-08-31 06:11:56 -0400] harry8906: philow: do i need to have remote machine installed chef.
[2012-08-31 06:12:50 -0400] philwo: yes.
[2012-08-31 06:13:38 -0400] harry8906: is this a chef-solo problem or chef server?
[2012-08-31 06:14:51 -0400] harry8906: sorry for the basic q's, i am fresher for chef, just started last week..!
[2012-08-31 06:16:36 -0400] philwo: harry8906: you need to install chef on the server in any way.. it doesn't matter if you use chef-solo or chef server
[2012-08-31 06:16:48 -0400] philwo: but if you use chef-server, you don't have to copy the cookbooks and json manually
[2012-08-31 06:16:53 -0400] philwo: because chef can download it from chef-server
[2012-08-31 06:17:27 -0400] harry8906: k..
[2012-08-31 06:17:41 -0400] philwo: i usually just use chef-solo. it is much simpler :)
[2012-08-31 06:19:50 -0400] harry8906: yeah.. but i have one doubt, if i have to configure 100 machines then, should we install chef on all the machines
[2012-08-31 06:20:52 -0400] harry8906: i mean it's bit contradictory to term automation. :)
[2012-08-31 06:25:48 -0400] zts: harry8906: not really, puppet, chef, cfengine, bcfg2, etc etc all require tools installed on the server being managed.  There's a few other tools that will ssh to the remote server and run commands, but they are unusual
[2012-08-31 06:26:40 -0400] zts: if you are using an automatic system to build the machines (eg kickstart, FAI), you will install chef as part of that process
[2012-08-31 06:27:06 -0400] zts: for existing systems, you can use "knife bootstrap" to install and configure chef on a system you already have
[2012-08-31 06:33:16 -0400] harry8906: zts: i dont know about automatic system, i have only chef installed on my computer, and i need to install jdk on other remote computer using chef, i have written recipe for that, but i didn't know how to do that, as @philwo said i am gonna try that
[2012-08-31 06:37:21 -0400] harry8906: zts: hey, is it a fact.. we have a overhead of installing hef on machines that we wand to build in exchange of automation?
[2012-08-31 06:54:48 -0400] tmichael: getting an error when i try to do require: FATAL: LoadError: no such file to load
[2012-08-31 06:54:58 -0400] tmichael: but okay in irb
[2012-08-31 06:55:01 -0400] tmichael: todd: irb(main):001:0> require 'snmp'
[2012-08-31 06:55:01 -0400] tmichael: [6:22pm] todd: => true
[2012-08-31 08:21:26 -0400] rBEL:  /win 2
[2012-08-31 09:37:54 -0400] stephenking: ohai
[2012-08-31 09:38:10 -0400] stephenking: I have a question about node[platform_version]..
[2012-08-31 09:38:24 -0400] stephenking: it returns "testing" on debian wheezy
[2012-08-31 09:38:59 -0400] stephenking: is this an ohai bug? or is there any other way to figure out, whether it's a debian newer than squeeze?
[2012-08-31 09:39:23 -0400] stephenking: I'm running chef 0.10.8 (because of inside vagrant.. and I don't know, how I could ugrade this chef)
[2012-08-31 10:08:30 -0400] stephenking: anybody already using debian wheezy?
[2012-08-31 10:13:39 -0400] jopz: hello
[2012-08-31 10:14:02 -0400] jopz: I have installed git package in my chef client
[2012-08-31 10:14:31 -0400] jopz: but after installation when i type knife search node 'git'
[2012-08-31 10:14:36 -0400] jopz: it shows
[2012-08-31 10:14:45 -0400] jopz: 0 items found
[2012-08-31 10:14:53 -0400] jopz: please help me out of this
[2012-08-31 10:15:03 -0400] jopz: did i miss anything
[2012-08-31 10:15:08 -0400] jopz: ??
[2012-08-31 10:16:36 -0400] stephenking: see http://wiki.opscode.com/display/chef/Search you have to specify "attribute:value"
[2012-08-31 10:16:53 -0400] stephenking: have you installed git via a git cookbook through chef?
[2012-08-31 10:17:01 -0400] jopz: yes
[2012-08-31 10:18:04 -0400] stephenking: so it should be sth like "knife node search "run_list:recipe[git]", shouldn't it? but I'm unsure about the correct syntax of the search query
[2012-08-31 10:19:54 -0400] stephenking: knife search node "run_list:role\[virtualized\]"
[2012-08-31 10:20:13 -0400] stephenking: so it would be recipe\[git\] for you
[2012-08-31 10:20:37 -0400] jopz: let me try
[2012-08-31 10:20:58 -0400] stephenking: ah.. but it doesn't search in the expanded run list.. so the recipe has to be applied directly to the host AFAIK
[2012-08-31 10:20:59 -0400] _rc: stephenking: I'd use recipes:git or roles:virtualised
[2012-08-31 10:21:11 -0400] stephenking: ah, nice to know!
[2012-08-31 10:21:47 -0400] stephenking: rememering.. recipe vs. recipes means unexpanded vs. expanded run list, doesn't it?
[2012-08-31 10:22:02 -0400] _rc: yes
[2012-08-31 10:22:40 -0400] jopz: Thanks. It worked
[2012-08-31 10:22:43 -0400] jopz: :)
[2012-08-31 11:45:19 -0400] harry8906: someone said that, to setup a new remote  system using chef we need to install chef on that machine also, can we aytomate this chef installation on the remote machine
[2012-08-31 11:45:35 -0400] harry8906: *automate
[2012-08-31 11:46:26 -0400] leifmadsen: harry8906: well you could either use knife from your workstation to "bootstrap" chef onto the server (node), or you could install it as part of your installation of the server itself via kickstart or preseed (RHEL or Ubuntu, respectively)
[2012-08-31 12:23:41 -0400] leifmadsen: huh, that's strange... can't install chef --pre via the centos6-gems file I have...
[2012-08-31 13:15:10 -0400] richleland: is there a way (besides just manually) to have "knife cookbook site install" install something from another repo? for example - say I don't want the default postgresql cookbook, but I want another one someone has made some solid upgrades to.
[2012-08-31 13:15:25 -0400] richleland: I could just do the branching/etc. manually - but curious if there is a better/smarter way
[2012-08-31 13:24:43 -0400] geekbri: richleland: you should look into librarian-chef and berkshelf
[2012-08-31 13:26:29 -0400] richleland: geekbri perfect - thanks!
[2012-08-31 13:26:45 -0400] geekbri: richleland: no problemo.  I've been using librarian for a long time with success.  Haven't had a free moment to explore berkshelf yet
[2012-08-31 13:30:21 -0400] richleland: geekbri so have you completely stopped using knife cookbook site install then?
[2012-08-31 13:30:30 -0400] geekbri: richleland: yeah
[2012-08-31 13:30:35 -0400] richleland: because with librarian it looks like I wouldn't need it
[2012-08-31 13:30:39 -0400] richleland: awesome
[2012-08-31 13:31:24 -0400] geekbri: richleland: I just update my Cheffile then librarian-install
[2012-08-31 13:37:04 -0400] richleland: geekbri so another question for you - with knife cookbook site install I could just make whatever mods I wanted to the cookbooks and merge things when there was a new version of the cookbook available
[2012-08-31 13:37:09 -0400] richleland: how does librarian handle that
[2012-08-31 13:37:22 -0400] richleland: I don't see a mention of that workflow
[2012-08-31 13:37:46 -0400] geekbri: richleland: I have a directory called "site-cookbooks" which is part of my cookbooks path.  Any cookbook I want my own modifications of I just put in that directory.  The only caveat being of course you have to managed the dependencies for it yourself
[2012-08-31 13:38:30 -0400] richleland: ah ok - so basically if it's a cookbook you don't plan to tweak, it goes in cookbooks (managed by librarian)
[2012-08-31 13:38:39 -0400] richleland: otherwise, it goes in site-cookbooks
[2012-08-31 13:38:55 -0400] geekbri: richleland: well, or if you are going to manage it through a git repository you could put it in the Cheffile
[2012-08-31 13:39:11 -0400] geekbri: I think librarian can do local paths too
[2012-08-31 13:39:22 -0400] geekbri: although I haven't tried because i either have stuff in site-cookbooks, or git
[2012-08-31 13:39:25 -0400] geekbri: or the community site
[2012-08-31 13:40:18 -0400] lewjg: librarian can take a local path for a cookbook
[2012-08-31 13:40:43 -0400] lewjg: You can have a folder in your setup with your modified cookbooks
[2012-08-31 13:40:53 -0400] lewjg: Leave them out of your cookbooks path in knife
[2012-08-31 13:40:58 -0400] richleland: ok see I like that setup
[2012-08-31 13:41:02 -0400] lewjg: and just let librarian move them in, handling dependencies
[2012-08-31 13:41:08 -0400] geekbri: there ya go
[2012-08-31 13:41:12 -0400] geekbri: that works too
[2012-08-31 13:41:23 -0400] geekbri: that makes it so you don't have to worry about handling the deps yourself
[2012-08-31 13:41:34 -0400] geekbri: I think when i started using librarian it didn't support local paths like that
[2012-08-31 13:42:10 -0400] geekbri: that of course means whenever you edit a cookbook locally you'll have to do librarian install or librarian update before you upload it
[2012-08-31 13:42:16 -0400] geekbri: which isn't a huge deal, just something to be aware of
[2012-08-31 13:42:21 -0400] richleland: right
[2012-08-31 13:43:36 -0400] geekbri: if they sit in a dir that is in your cookbook path and not managed by librarian you can skip that step for uploading them, but then you have to manage deps yourself
[2012-08-31 13:44:09 -0400] yfeldblum: librarian-chef can do local paths, including absolute paths and relative paths (relative from the project root, usually the directory containing the Cheffile)
[2012-08-31 13:45:23 -0400] geekbri: pssh we already established that yfeldblum :-P
[2012-08-31 13:45:32 -0400] yfeldblum: cookbook "nagios", :path => "cookbook-forks/nagios"
[2012-08-31 13:45:46 -0400] yfeldblum: geekbri, carry on!
[2012-08-31 13:45:49 -0400] geekbri: hehe
[2012-08-31 13:50:15 -0400] j|: good morning, kitten.
[2012-08-31 13:58:19 -0400] gyre007: if i have more than one version of cookbook...how do I tell some other cookbook's recipe to use the latest one ??
[2012-08-31 13:59:15 -0400] matschaffer: gyre007: pretty sure that'd be the environment's job
[2012-08-31 13:59:27 -0400] gyre007: mm
[2012-08-31 13:59:43 -0400] matschaffer: although it's possible that the cookbook's metadata can specify
[2012-08-31 13:59:47 -0400] matschaffer: never tried it myself
[2012-08-31 14:00:13 -0400] matschaffer: oh yeah
[2012-08-31 14:00:15 -0400] matschaffer: gyre007: http://wiki.opscode.com/display/chef/Metadata#Metadata-depends
[2012-08-31 14:01:08 -0400] gyre007: cheers matschaffer
[2012-08-31 14:02:07 -0400] richleland: geekbri man librarian just made my day - THANK YOU
[2012-08-31 14:02:11 -0400] richleland: this is so much easier to manage now
[2012-08-31 14:02:36 -0400] geekbri: richleland: you should thank yfeldblum not me, he wrote it :)
[2012-08-31 14:02:51 -0400] geekbri: he left I think though
[2012-08-31 14:03:23 -0400] gyre007: hmm strange...I have rabbitmq cookbook which requires APT > 1.4.4 I have metadata.rb of RabbitMQ set to that but the recipe is failing because it can't find a resource...which is there
[2012-08-31 14:06:01 -0400] gyre007: it fails with Cannot find a resource matching execute[apt-get update] (did you define it first?)
[2012-08-31 14:06:28 -0400] matschaffer: gyre007: might wanna try `depends "dogs", "> 1.0"` in your metadata (re earlier version question)
[2012-08-31 14:06:42 -0400] gyre007: dogs ?
[2012-08-31 14:07:04 -0400] gyre007: the resourse is defined in the latest APT cookbook and is usde like this: http://pastebin.com/PfDZfTeW
[2012-08-31 14:07:18 -0400] gyre007: it looks like this bit is failing: resources(:execute => "apt-get update")
[2012-08-31 14:13:04 -0400] gyre007: what am I missing...mmm
[2012-08-31 14:16:57 -0400] gyre007: there's gotta be something wrong with that cookbook mmm
[2012-08-31 14:17:10 -0400] gyre007: the APT
[2012-08-31 14:17:56 -0400] matschaffer: gyre007: the dogs bit was just the example from http://wiki.opscode.com/display/chef/Metadata#Metadata-depends
[2012-08-31 14:18:31 -0400] gyre007: matschaffer, ive done that
[2012-08-31 14:18:51 -0400] gyre007: depends           "apt", ">= 1.4.4"
[2012-08-31 14:19:03 -0400] matschaffer: as for the resource thing, do you include the recipe that defines the resource before the notifies?
[2012-08-31 14:20:04 -0400] wamilton: for some reason, trying to generate a client config with `knife configure client ./` gives me this: "ERROR: Errno::ENOENT: No such file or directory - /Users/ME/code/mychef/.chef/ORGANIZATION-validator.pem", but the file is definitely there. What gives?
[2012-08-31 14:20:14 -0400] gyre007: should I include apt recipe ?
[2012-08-31 14:21:29 -0400] gyre007: let's see
[2012-08-31 14:24:14 -0400] gyre007: interesting...that seems to have helped...
[2012-08-31 14:24:50 -0400] gyre007: thanks matschaffer
[2012-08-31 14:24:57 -0400] matschaffer: gyre007: no problem!
[2012-08-31 14:25:28 -0400] matschaffer: yeah, notifications are order-dependent. Though TBH I'm a little surprised the apt_repository resource doesn't handle the updating for you
[2012-08-31 14:25:38 -0400] matschaffer: seems like the sort of thing it'd do
[2012-08-31 14:28:59 -0400] wamilton: I deleted my ORGANIZATION-validator client, recreated it, updated it's perms per bottom of this page, http://wiki.opscode.com/display/chef/Troubleshooting+and+Technical+FAQ and still get an error about the client not existing when going to regenerate the validator key for the organization, but it downloads the ORGANIZATION-validator client key with no problem
[2012-08-31 14:37:25 -0400] rocket: is there a way to totally automate the knife configure -i    ?
[2012-08-31 14:40:35 -0400] hashpuppy: where can i read more about the advantages and disadvantages of push vs pull
[2012-08-31 14:42:14 -0400] hashpuppy: also, are any of you guys using chef-solo + mcollective over chef-server?
[2012-08-31 14:42:23 -0400] hashpuppy: and if so, why?
[2012-08-31 14:43:04 -0400] jtimberman: hashpuppy: http://www.infrastructures.org/bootstrap/pushpull.shtml
[2012-08-31 14:43:16 -0400] hashpuppy: thanks :)
[2012-08-31 14:44:52 -0400] hashpuppy: good read
[2012-08-31 14:44:57 -0400] KarlHungus: is there a place in my knife.rb where I can set default flags for knife sub-commands?
[2012-08-31 14:45:20 -0400] KarlHungus: specifically, i want to set '--branch develop' for 'cookbook site vendor'
[2012-08-31 14:46:17 -0400] rocket: jtimberman: is there a way to provide all of the answers for a knife configure from the command line?
[2012-08-31 14:46:35 -0400] rocket: eg I am trying to run the knife configure -i from a script
[2012-08-31 14:46:48 -0400] yfeldblum: rocket, scripting knife is ... odd
[2012-08-31 14:47:03 -0400] rocket: yfeldblum: its just for an initial setup thing
[2012-08-31 14:47:19 -0400] geekbri: I prefer to write knife plugins over wrapping knife with bash or whatever
[2012-08-31 14:47:29 -0400] rocket: basically I am boot strapping the infrastructure
[2012-08-31 14:50:42 -0400] auduny: Bl.
[2012-08-31 14:54:11 -0400] autif: I am using ark for unzipping some tar files. So I have a recipe that does this. However, when I want to upgrade, I update the recipe - change the 'url' and 'cheksum' fields and run chef client - which runs, but it does not replace the old files with new ones. Here is the simple recipe https://gist.github.com/3554031 - Is this expected behavior? How can I "upgrade" and app using ark? Thanks
[2012-08-31 14:55:35 -0400] jtimberman: rocket: i wrote 'knife-config' gem that will display all the chef configuration options
[2012-08-31 14:55:44 -0400] jtimberman: rocket: since it is a knife plugin, it represents what the current knife.rb has.
[2012-08-31 14:56:02 -0400] jtimberman: I wrote about it here: http://jtimberman.housepub.org/blog/2012/03/25/knife-config-plugin/
[2012-08-31 14:58:24 -0400] hashpuppy: ok, so stupid question.  how do the chef clients do the pulls from chef server.  is it on demand?  or does it poll at some defined interval?
[2012-08-31 14:59:17 -0400] hashpuppy: chef clients being the nodes (just making sure i've got the terminology right)
[2012-08-31 14:59:24 -0400] paulmooring: hashpuppy: unless you run chef-client on the node it will never contact the server
[2012-08-31 15:00:00 -0400] paulmooring: obviously if you set up cron on chef-client as a daemon it will run as often as you specify
[2012-08-31 15:04:19 -0400] rocket: jtimberman: how can I use whats in the configuration information to automate it?  do I write a dummy knife.rb file to start? and then run knife configure -i to get the user.pem file from the server?
[2012-08-31 15:07:42 -0400] yfeldblum: rocket, not sure why you need to automate knife.rb ...
[2012-08-31 15:08:17 -0400] yfeldblum: rocket, chef-server doesn't use a knife.rb file, and neither does chef-client, chef-solo, etc
[2012-08-31 15:08:58 -0400] rocket: yfeldblum: I am trying to automate getting an initial user key
[2012-08-31 15:10:41 -0400] rocket: yfeldblum: I can then use that key to continue my scripted setup..
[2012-08-31 15:12:10 -0400] rocket: yfeldblum: I have worked around my issue with expect .. I am using this as a way to boot strap an entire infrastructure from a single script
[2012-08-31 15:49:35 -0400] leifmadsen: I noticed on this page:  http://wiki.opscode.com/display/chef/Libraries  the use of @node in the examples, which in Chef 10.12.0, gives a warning that it will be removed in future versions. Does it make sense I just remove the @ from the examples?
[2012-08-31 16:14:55 -0400] haidangwa: happy Friday before 3-day weekend everybody! Just a quick question, I am trying to execute some ruby code inside an only_if conditional on an execute resource. The recipe runs on Windows Server 2008 R2 servers only, and I only want the execute resource to run if a certain Windows service exists. The only_if conditional is using the win32-service gem to check the existence of the Windows service, and also if the service is configured the way I expect it to b
[2012-08-31 16:26:05 -0400] _pabst_: Question - I have my workstation set up, if I run knife client list, I get the expected list of clients. If I run knife bootstrap client.domain.com -x username - I get an error stating the validation file doesn't exist, if I stat the validation file, it is there and the current user has access any ideas?
[2012-08-31 16:30:22 -0400] jessicab: _pabst_: knife client list actually uses your client key, you might want to check the config to make sure the path to the validation key is good
[2012-08-31 16:31:12 -0400] luckymike: _pabst_: is there already a client on the chef-server with the same name?
[2012-08-31 16:31:38 -0400] jessicab: _pabst_: you could also test it with a command like this if you wanted - knife client list -u chef-validator -k .chef/validation.pem, although youd want to change the path at the end there to whatever you have set in your config
[2012-08-31 16:31:49 -0400] _pabst_: jessicab: Thanks for your response. I have checked the path, it is good. As a matter of fact, when I ran stat I copied the path from the error message to be sure. Just to be sure and clear, the validation.pem key should be the same file that I find in /etc/chef on the server?
[2012-08-31 16:32:02 -0400] _pabst_: bootstrapping works fine from the server, just not from the workstation
[2012-08-31 16:33:28 -0400] haidangwa: _pabst_: the validation.pem that your new client node needs to use is unique to the org that it belongs. It's not the same file as you find in /etc/chef on the server. If you can't locate the validation.pem for your org, then you'll need to regenerate it.
[2012-08-31 16:33:29 -0400] jessicab: _pabst_: yep, should just be that file in /etc/chef on the server
[2012-08-31 16:34:02 -0400] jessicab: _pabst_: oh.. i figured you were talking about open source though? its a bit different if youre on hosted, like hes mentioning ^^
[2012-08-31 16:34:09 -0400] _pabst_: I am talking about open source
[2012-08-31 16:34:25 -0400] _pabst_: Thanks you for the clarification though, I guess I should have been more specific
[2012-08-31 16:35:29 -0400] _pabst_: ok, I apologize, it is a filesystem problem I believe, not a chef problem
[2012-08-31 16:35:32 -0400] _pabst_: thanks for the help though
[2012-08-31 16:35:49 -0400] bitpimp: what are some advantages of chef over puppet?
[2012-08-31 16:38:16 -0400] _pabst_: yup I got it working, 100% my typo, even after I said "I cut an paste" and all that jazz, i must have been lying
[2012-08-31 16:38:35 -0400] _pabst_: feel like an idiot now, thank you so much again jessicab and haidangwa
[2012-08-31 16:38:44 -0400] haidangwa: np
[2012-08-31 16:39:04 -0400] jessicab: _pabst_: heh no worries at all, we all make silly mistakes sometimes :P
[2012-08-31 16:39:33 -0400] _pabst_: I'm  supposed to be on vacation. Wife wasn't feeling well and laid down, so I decided to come fool around some more
[2012-08-31 16:42:43 -0400] jessicab: bitpimp: probably the biggest one is being able to use ruby code when needed, and not just restricted to the resources and providers already prebuilt into chef.. ive never used puppet, but thats what ive heard
[2012-08-31 16:47:47 -0400] _pabst_: Ive used puppet in the past, just started using chef for a new company, so far I love chef over puppet, I can't exactly give technical detail as to why yet, it just seems to run smoother and make more sense, and yes, the ruby is a big contributor although I haven't run much into that
[2012-08-31 16:47:59 -0400] _pabst_: it seems less resource intensive to be honest
[2012-08-31 16:48:18 -0400] _pabst_: it, makes more sense, if you will
[2012-08-31 16:48:48 -0400] _pabst_: quick question, then I have to get back to the honey do list
[2012-08-31 16:49:20 -0400] _pabst_: when I, knife bootstrap a node and get it all set up in the chef server, does the chef-client run on an interval of some sort to "check in" with the chef server?
[2012-08-31 16:49:36 -0400] _pabst_: if so, what is that default interval?
[2012-08-31 16:49:57 -0400] leifmadsen: _pabst_: only when you install the chef-client recipe book -- doesn't do it automatically via bootstrap
[2012-08-31 16:50:07 -0400] bitpimp: jessicab: thx.  doing a write up on puppet and chef (not puppet vs. chef) and just pointing out the nice features of each.
[2012-08-31 16:50:13 -0400] leifmadsen: otherwise, you can do it via knife ssh with "sudo chef-client"
[2012-08-31 16:50:36 -0400] _pabst_: awesome thank you. I will look at installing that recipe book.
[2012-08-31 16:52:57 -0400] cheeseplus: bitpimp: community is a big advantage of chef vs puppet imo
[2012-08-31 16:59:58 -0400] bitpimp: cheeseplus: how so?
[2012-08-31 17:00:36 -0400] bitpimp: cheeseplus: is one community more helpful than the other (not wanting to start a debate... just trying to pick a few good features of each tool)
[2012-08-31 17:06:53 -0400] bitpimp: cheeseplus: I was going to put the puppet community as being it's strong card (more than 700 irc members and lots of books)... but my take on Chef was that it's slower to grok but more powerful when you do.
[2012-08-31 17:08:59 -0400] geekbri: Chef is nice because it doesn't go out of its way to intentionally restrict what you can do
[2012-08-31 17:10:30 -0400] bitpimp: geekbri: ok...
[2012-08-31 17:10:42 -0400] geekbri: Puppet does :)
[2012-08-31 17:11:42 -0400] z: bitpimp: when both are operated in a client-server fashion, the Mutual TLS approach to client validation with Puppet makes it *very* difficult to scale out your server. Active/passive failover is easy enough with DRBD. with Chef you're using the Mixlib stuff which is just public/private crypto, with the public keys stored in a database (CouchDB today, MySQL soon with erchef) and thats *super* well understood in terms of how to scale
[2012-08-31 17:12:56 -0400] z: bitpimp: the Puppet Labs guys have some kind of 'seed master' solution which they often implement in PSE and that means your SPOF is restricted to registering *new* clients, and once a client is online its fairly well HA and scale-out-able
[2012-08-31 17:14:07 -0400] z: bitpimp: but IME the only way to 'solve' it with *true* HA (active/active[/active]) is to replicate /var/lib/puppet/ssl and bodge all servers into thinking they're the same from an SSL identity perspective. That's *extremely* ugly in comparison to how easy Chef makes it
[2012-08-31 17:14:09 -0400] bitpimp: z: wait... are you saying puppet is harder to scale out?
[2012-08-31 17:14:23 -0400] z: yes.
[2012-08-31 17:14:26 -0400] z: very much harder.
[2012-08-31 17:14:39 -0400] bitpimp: z: ok I understand...
[2012-08-31 17:15:03 -0400] bitpimp: (btw my question crossed your third post, lol)
[2012-08-31 17:15:49 -0400] bitpimp: z: I'll put that in the write up, something to the effect of chef being more robust for scaling scenarios.
[2012-08-31 17:16:20 -0400] bitpimp: a big diff seems to be that you don't have to use a ruby DSL, but rather just straight ruby, in chef.
[2012-08-31 17:16:22 -0400] z: I ripped out Puppet and replaced it with Chef in a previous role. I concede, you likely won't encounter issues until you have hundreds of nodes, but when you're in the thousands you will *definitely* hit them, and IMHO it was a lot easier to scale-out all the "little" components (chef-server-api, webui, expander, CouchDB soon to be MySQL) than it was to make Puppet do big stuff
[2012-08-31 17:17:31 -0400] z: That's also true, although new[er] versions of Puppet do make it easier to break out, IMO (again) the flexibility of Resources/Providers and Libraries within Chef cookbooks and ability to specify dependencies in metadata is both powerful and flexible
[2012-08-31 17:18:43 -0400] z: I suppose while I'm yapping, I could also point out that Puppet is compiling manifests server-side and then sending them to the client. Convergence is handled by two graphs representing current state and desired state, and its often quite tricky to say "I want things done in *precisely* this order"
[2012-08-31 17:19:39 -0400] z: chef-client is figuring a lot more stuff out *client* side (reducing or removing potential server bottlenecks) and is just walking through the run_list which is a series of Roles and Recipes, making the order of things much easier to predict and ultimately control
[2012-08-31 17:20:00 -0400] geekbri: bitpimp: that is what I was trying to say earlier :)
[2012-08-31 17:20:16 -0400] bitpimp: geekbri, z: this was awesome, thanks!
[2012-08-31 17:20:34 -0400] z: np
[2012-08-31 17:21:53 -0400] gyre007: I'm running a following query and don't get what im doing wrong... knife search node "role:sensu_server AND environment:bfg" -> it returns 0 items...yet when I run only knife search node "role:sensu_server" it returns sensu server which IS in bfg environment so I dont understand why the first query doesnt return antyhing
[2012-08-31 17:23:02 -0400] gyre007: http://pastebin.com/XkpAYnmJ
[2012-08-31 17:23:06 -0400] gyre007: #clueless
[2012-08-31 17:23:07 -0400] gyre007: :)
[2012-08-31 17:23:43 -0400] paulmooring: gyre007: try chef_environment
[2012-08-31 17:23:55 -0400] paulmooring: rather than environment that is
[2012-08-31 17:24:02 -0400] gyre007: ah
[2012-08-31 17:24:07 -0400] gyre007: paulmooring, just tried that
[2012-08-31 17:24:08 -0400] Leitz: Does the Omnibus install get you chef-server?
[2012-08-31 17:24:09 -0400] gyre007: works
[2012-08-31 17:24:12 -0400] gyre007: awesome
[2012-08-31 17:26:02 -0400] z: Leitz: not yet
[2012-08-31 17:26:10 -0400] z: Leitz: omnibus chef-server is coming though from what I hear
[2012-08-31 17:26:10 -0400] paulmooring: Leitz: there is not currently an omnibus installer for Chef Server
[2012-08-31 17:26:32 -0400] z: you can put your own together easily enough too, all the Omnibus stuff is on GitHub
[2012-08-31 17:29:19 -0400] gyre007:  when I find a node via search...can I accesss it's ohai attributes somehow....particularly ip would be nice ;)
[2012-08-31 17:30:07 -0400] paulmooring: gyre007: Some attributes are saved along with the node object, others are not check the wiki for details
[2012-08-31 17:30:37 -0400] paulmooring: but the short answer is run `knife node show NODENAME -Fj` to see what's available on the server
[2012-08-31 17:32:55 -0400] storme|away: how do i configure knife.rb to know my cookbook path? cookbook_dir doesn't seem to do it
[2012-08-31 17:33:17 -0400] stormerider: i just want to be able to do "knife cookbook upload blah"
[2012-08-31 17:33:29 -0400] jordane: stormerider: cookbook_path = [ '/path/one' , '/path/two' ]
[2012-08-31 17:33:31 -0400] jonlives: stormerider: cookbook_path
[2012-08-31 17:33:34 -0400] gyre007: if node show returns IP then it must be accessible via search
[2012-08-31 17:33:38 -0400] gyre007: just dunno how
[2012-08-31 17:33:47 -0400] stormerider: aha, thanks.
[2012-08-31 17:34:10 -0400] Leitz: paulmooring, am I reading the OpsCode site correctly that I need to use chef-solo to build a chef server?
[2012-08-31 17:34:20 -0400] jonlives: gyre007: knife search node "ip_address:'192.168.*'"
[2012-08-31 17:34:30 -0400] paulmooring: Leitz: you don't *need* to but it's easier
[2012-08-31 17:34:34 -0400] Leitz: I'm easily confused and most of last Friday was spent not being able to install chef-solo.
[2012-08-31 17:34:38 -0400] jtimberman: Leitz: there are different ways to install Chef server depending on your platform and/or preferences.
[2012-08-31 17:34:45 -0400] gyre007: jonlives, nah I need to find a node by role and then check its IP
[2012-08-31 17:34:59 -0400] jordane: gyre007: search(args).map do |n|, n will then be a node object
[2012-08-31 17:35:01 -0400] paulmooring: gyre007: in a recipe?
[2012-08-31 17:35:07 -0400] jtimberman: the chef-solo way is just one of those methods
[2012-08-31 17:35:13 -0400] Leitz: Easy is good at the moment. I'm on CentOS 6 and my preference is to understand the basics.  :)
[2012-08-31 17:35:14 -0400] gyre007: paulmooring, yup
[2012-08-31 17:35:17 -0400] rocket: does anyone know if there is a cookbook that will deploy openstack essex?
[2012-08-31 17:35:17 -0400] jordane: gyre007: and has attributes accessible at n[:some_attribute]
[2012-08-31 17:35:28 -0400] jonlives: gyre007: if node[:ip_address] == "foo"
[2012-08-31 17:35:58 -0400] jtimberman: Leitz: do you want to understand the basics about running a chef server, or about managing your infastructure with Chef? If the latter, Opscode Hosted Chef is a good option as it doesn't require setting up a server :)
[2012-08-31 17:36:18 -0400] paulmooring: so you want to use search to return an array of nodes
[2012-08-31 17:36:33 -0400] Leitz: jtimberman, both. Some folks I work with use Chef a lot and I need to be able to support them.
[2012-08-31 17:36:37 -0400] gyre007: jonlives, jordane doesnt seem to be the case
[2012-08-31 17:36:44 -0400] Leitz: Or at least not look stupid when they talk.  :)
[2012-08-31 17:36:49 -0400] gyre007: http://pastebin.com/fdT96KLE
[2012-08-31 17:36:56 -0400] paulmooring: gyre007: I would highly recommended checking out that wiki page I linked, it has a using search in recipes section that explains it nicely
[2012-08-31 17:37:23 -0400] gyre007: paulmooring, you didnt link anything :)
[2012-08-31 17:37:27 -0400] gyre007: i cant see any link
[2012-08-31 17:38:01 -0400] paulmooring: http://wiki.opscode.com/display/chef/Search
[2012-08-31 17:38:24 -0400] paulmooring: check out "Using Search in Recipes"
[2012-08-31 17:39:08 -0400] gyre007: cheers
[2012-08-31 17:39:16 -0400] behemphi1: I appear to have found a bug in knife bootstrap.  On Ubuntu 10.04 when I bootstrap I get the following error when it tries to install Ruby Shadow:
[2012-08-31 17:39:16 -0400] behemphi1: You have to install development tools first.
[2012-08-31 17:39:42 -0400] behemphi1: I did a search but cannot find this talked about.  Has this been seen before?
[2012-08-31 17:39:49 -0400] Leitz: paulmooring, is there a chance that low memory could kill the cc1plus build of chef-server? I'm running 1/2 G in a server.
[2012-08-31 17:40:21 -0400] bitpimp: What are chef recipes written in?
[2012-08-31 17:40:30 -0400] bitpimp: are they in Ruby as well?
[2012-08-31 17:40:33 -0400] behemphi1: @bitpimp
[2012-08-31 17:40:34 -0400] Leitz: bitpimp, sort of.
[2012-08-31 17:40:43 -0400] behemphi1: yes they are ruby with a DSL that is ruby like
[2012-08-31 17:40:46 -0400] bitpimp: sorry... I realize I should google this.
[2012-08-31 17:40:51 -0400] bitpimp: ok
[2012-08-31 17:40:51 -0400] gyre007: paulmooring, its gotta be simpler...its a simple search...i got the node just need to extract IP :)
[2012-08-31 17:40:55 -0400] Leitz: They are in a Ruby Domain Specific Language (DSL).
[2012-08-31 17:41:08 -0400] bitpimp: ok
[2012-08-31 17:41:11 -0400] Leitz: bitpimp, you can add Ruby to chef recipeis too.
[2012-08-31 17:41:23 -0400] gyre007: i have the result in my hands...just dont know how to extract particular info from it
[2012-08-31 17:41:36 -0400] bitpimp: :-)
[2012-08-31 17:41:43 -0400] paulmooring: gyre007: the search() function returns an array of node objects, then the ip should be in nodes[0][:ip]
[2012-08-31 17:41:51 -0400] behemphi1: * me too
[2012-08-31 17:41:52 -0400] syphon: does anyone know of an example of using the chef-client cookbook to set up a handler? (splunk_handler, specifically). It requires a custom gem and someone yesterday told me the cookbook could handle that
[2012-08-31 17:42:05 -0400] bitpimp: I thought one of the chef advantages is that you can write configurations in Ruby.
[2012-08-31 17:42:19 -0400] bitpimp: but I guess it's a Ruby DSL.
[2012-08-31 17:42:31 -0400] Leitz: bitpimp, you can add straight Riby to your stuff.
[2012-08-31 17:42:35 -0400] Leitz: Riby/Ruby
[2012-08-31 17:42:50 -0400] Leitz: If you know Ruby you're probably miles ahead.
[2012-08-31 17:43:17 -0400] jtimberman: bitpimp: specifically, Chef recipes are an internal Ruby DSL. They're always Ruby, whether you're using the DSL for resources and other helper methods, or whether you're writing raw ruby directly.
[2012-08-31 17:45:04 -0400] yfeldblum: bitpimp, real easy to "drop down" into normal ruby
[2012-08-31 17:46:02 -0400] Leitz: Now that I'm back to building a chef server I recall what happened before. It choked on the gecode build for some reason.
[2012-08-31 17:46:03 -0400] jtimberman: Puppet does have a Ruby DSL, but it is not the default, and it isn't widely used - most people stick to the external Puppet DSL instead.
[2012-08-31 17:46:17 -0400] gyre007: paulmooring, so search is returning an array...
[2012-08-31 17:46:19 -0400] yfeldblum: bitpimp, nead to read a file on the server? just drop down to normal ruby code: IO.read("/path/to/file")
[2012-08-31 17:46:41 -0400] yfeldblum: gyre007, indeed, #search returns an array ...
[2012-08-31 17:46:44 -0400] rocket: I personally hate the puppet dsl
[2012-08-31 17:47:00 -0400] bitpimp: ok... and sorry for all the questions... what are some recent improvements to Chef (within the last year) and what's exciting on the immediate roadmap?  (and then I'll leave you alone... until I start using Chef, of course)  :-)
[2012-08-31 17:47:03 -0400] yfeldblum: paulmooring, #search returns an array, but not necessarily of node objects (only of node objects if the first argument is :node
[2012-08-31 17:47:07 -0400] gyre007: yfeldblum, i see...but the IP is not available under :ip symbol
[2012-08-31 17:47:27 -0400] yfeldblum: gyre007, try nodes[0]["ipaddress"]
[2012-08-31 17:48:03 -0400] gyre007: BINGO!
[2012-08-31 17:48:10 -0400] gyre007: and the winner is yfeldblum ! :)
[2012-08-31 17:48:11 -0400] paulmooring: gyre007: are you new to ruby?
[2012-08-31 17:48:18 -0400] gyre007: paulmooring, yep
[2012-08-31 17:48:37 -0400] gyre007: docs are saying you dont need muchn knowledge...I can see that thats just nonsense :)
[2012-08-31 17:49:12 -0400] wamilton: gyre007: ruby is a very big language
[2012-08-31 17:49:18 -0400] paulmooring: gyre007: you might want to get a little more comfortable w/ ruby, but something like `nodes.each { |n| some_method(n[:ip]) } might be what you want
[2012-08-31 17:49:36 -0400] yfeldblum: bitpimp, a DSL for custom resources & providers ... partitioning groups of nodes by environment (useful e.g. for partitioning nodes by EC2 region or datacenter name)
[2012-08-31 17:49:40 -0400] paulmooring: you need to iterate through the array and act on each node object individually
[2012-08-31 17:50:13 -0400] yfeldblum: gyre007, you don't need much ruby for the simplistic stuff ... the more complex your recipes & the more data-driven they are, the more ruby you'll want to know
[2012-08-31 17:50:48 -0400] yfeldblum: gyre007, but you can usually learn enough ruby as you go
[2012-08-31 17:51:14 -0400] jtimberman: bitpimp: in the last ~year: environments and cookbook version constraints (0.10.0 may 2011), windows platform support and improvements (like NTFS file ACLs, and more), omnibus installation packages (full stack packages), and in 10.14 a "dry run" mode called "why-run" (release candidate is available)
[2012-08-31 17:52:08 -0400] bggo: Helo guys, I was wondering how can I get an atribute value inside one of my roles, is it possible?
[2012-08-31 17:52:20 -0400] yfeldblum: bggo, what do you mean by "get"?
[2012-08-31 17:52:29 -0400] jtimberman: bitpimp: roadmap-ish things: migration from couchdb and ruby api to mysql/postgresql and erlang api (big change for chef 11), reporting improvements (started in 10.14 with output formatters), more platforms supported for client omnibus installer, chef-server omnibus installer.
[2012-08-31 17:52:59 -0400] yfeldblum: bggo, remember, roles are supposed to be pure data and no code - all the code goes in cookbooks
[2012-08-31 17:53:13 -0400] jtimberman: bitpimp: lots more information on the topic in this video from our CTO at ChefConf: http://www.youtube.com/watch?v=Lv89JG81-9M&feature=plcp
[2012-08-31 17:54:01 -0400] bggo: @yfeldblum ... thanks man... if in teory I can't have code into roles.... i'll think another way to do ... =D
[2012-08-31 17:55:01 -0400] yfeldblum: bggo, no probs ... and maybe we can even give you some ideas if you want to say a little bit more about what you're trying to accomplish
[2012-08-31 17:55:37 -0400] syphon: Anyone know how to get the chef-client cookbook to set up report and exception handlers? I can't seem to find a way to get it to insert somewhat custom lines into the client.rb
[2012-08-31 17:57:09 -0400] jtimberman: syphon: i don't think that's entirely well supported yet, and the chef_handler cookbook is where much of that would be done right now.
[2012-08-31 17:58:38 -0400] syphon: Hmm, it seems like it'd be really easy to simple add "report_handlers << \"<%= node["chef_client"]["report_handlers"] %>\"" to the template to get it to do what I need
[2012-08-31 17:58:48 -0400] bggo: @yfeldblum, ... I was just thinking in "get" node[:ipaddress] value to use it inside a role.
[2012-08-31 17:58:53 -0400] syphon: but as always, the quick and easy fix isn't likely to be the BEST fix :)
[2012-08-31 17:59:47 -0400] miah: moin
[2012-08-31 18:00:02 -0400] yfeldblum: bggo, what did you want to do with it in the role?
[2012-08-31 18:00:51 -0400] bitpimp: is chef switching to Erlang at it's core?
[2012-08-31 18:02:44 -0400] _0x783czar: Is there a way in Chef to add a user to groups other than their primary one?
[2012-08-31 18:03:00 -0400] bggo: I think I just thinking in the wrong way ..... The main ideia were have my 2 bind servers listening ports only in its owns ips. ...
[2012-08-31 18:03:42 -0400] bggo: So .. I just realise that his can be done by the template. =D @yfeldblum ... Really thanks
[2012-08-31 18:03:51 -0400] yfeldblum: bggo, no probs
[2012-08-31 18:05:10 -0400] yfeldblum: bitpimp, no, not the core ... the server API is switching from a JSON-over-HTTP API written in ruby to ... a compatible JSON-over-HTTP api written in erlang ... so not much difference from the perspective of anything that counts
[2012-08-31 18:10:11 -0400] jtimberman: indeed.
[2012-08-31 18:11:24 -0400] c_t: They considered moving to JSON-over-SMTP, but decided it would be too awesome to implement
[2012-08-31 18:12:10 -0400] c_t: that and changing the chef configuration files to look like sendmail.cf
[2012-08-31 18:13:03 -0400] c_t: $R>>>$$E$T$R
[2012-08-31 18:16:18 -0400] mhalligan: I seem to remember there was a cookbook to make it easy to generate self-signed certificates, anyone remember what it was?
[2012-08-31 18:20:03 -0400] bitpimp: what can I cite as a download link for chef?  I see lots of repo links, etc, but is there a tarball or the like anywher?
[2012-08-31 18:23:13 -0400] kallistec: bitpimp: for the omnibus (e.g. full stack) chef client packages: http://www.opscode.com/chef/install/
[2012-08-31 18:23:59 -0400] kallistec: bitpimp: right now it just gives you instructions to run a shell script, but we're going to upgrade that page to list the packages for the curl | bash averse
[2012-08-31 18:25:05 -0400] kallistec: also, it's not hard to reverse engineer the script, it basically just hits a URL that points you at the correct version/iteration of the package for your OS and architecture
[2012-08-31 18:25:05 -0400] jtimberman: bitpimp: http://www.opscode.com/chef/install
[2012-08-31 18:25:14 -0400] jtimberman: oh kallistec said that ><
[2012-08-31 18:25:20 -0400] jtimberman: i should take him off ignore ;)
[2012-08-31 18:26:07 -0400] kallistec: too bad I'm nicer than holoway, he'd boot you for that :P
[2012-08-31 18:27:10 -0400] jtimberman: lol
[2012-08-31 18:27:37 -0400] jtimberman: yeah but he'd hug afterward anyway
[2012-08-31 18:28:06 -0400] kallistec: wisdom
[2012-08-31 18:28:33 -0400] jtimberman: you'd just hand me a jaegerbomb
[2012-08-31 18:28:43 -0400] Loof: I'm running into a bootstrap issue... I'm using the aws cookbook, which needs the right_aws installed... chef is installing itself /w ruby 1.9.x in /opt/embedded... system ruby is 1.8.x
[2012-08-31 18:28:53 -0400] Loof: So, the gem cookbook installs it /w system ruby for 1.8
[2012-08-31 18:29:05 -0400] Loof: and chef can't see/use the gem... under 1.9
[2012-08-31 18:29:08 -0400] Loof: so my bootstrap fails
[2012-08-31 18:29:54 -0400] Loof: I'm not even sure how to solve it... upgrading system ruby to 1.9 doesn't seem viable at the moment
[2012-08-31 18:30:12 -0400] Loof: the chef install on boot is going through the install.sh from opscode
[2012-08-31 18:30:41 -0400] kallistec: Loof: update your cookbook to use chef_gem resource
[2012-08-31 18:30:41 -0400] Loof: I the system package for chef would be fine... or maybe I can use the ubuntu gem install for chef
[2012-08-31 18:30:58 -0400] kallistec: or, use a different bootstrap script that installs chef the way you're familiar with
[2012-08-31 18:31:32 -0400] Loof: Well, the problem I have is that my snapshot has chef 10.8 and it needs 10.12... this is likely to be something which happens again in the future
[2012-08-31 18:31:46 -0400] Loof: so I want the bootstrap to handle upgrading chef to a named version... which it does
[2012-08-31 18:32:05 -0400] Loof: I don't really care -which- way I upgrade chef... just trying to follow what appears to be the 'best practice' or at least he default practice :P
[2012-08-31 18:32:24 -0400] jtimberman: speaking of Chef Server Erlang port: http://www.opscode.com/blog/2012/08/31/test-drive-the-chef-11-server-preview/
[2012-08-31 18:33:36 -0400] Loof: Why is an erlang port exciting? :)
[2012-08-31 18:33:42 -0400] kallistec: Loof: from now on, default will be the "omnibus" packages which bundle chef and all deps under /opt/chef, but installing from gems or apt repo is fine if that's what you want
[2012-08-31 18:34:16 -0400] Loof: What I want is for it to work as painlessly as possible and for it to magically handle all future upgrades :D
[2012-08-31 18:34:52 -0400] Loof: So if I upgrade my chef server... I just wake up chef client on every node...and the 1st thing it does is upgrade itself
[2012-08-31 18:34:58 -0400] jtimberman: Loof: http://www.youtube.com/watch?v=FRFekZrLNas
[2012-08-31 18:35:17 -0400] kallistec: Loof: are you just starting out, or do you have chef already deployed?
[2012-08-31 18:35:47 -0400] Loof: kallistec: Just starting out on EC2
[2012-08-31 18:36:02 -0400] Loof: I've got a recipe that configures and manages my app... doesn't even handle system packages yet
[2012-08-31 18:36:18 -0400] Loof: This is to automate deployment initially...and that part works on it's own
[2012-08-31 18:36:40 -0400] kallistec: Loof: then I'd go with the omnibus packages, it's the minimum amount of fuss to get chef working
[2012-08-31 18:37:29 -0400] Loof: If system chef packages _AND_ the omnibus chef client is installed... that sounds like asking for trouble
[2012-08-31 18:37:51 -0400] Loof: I've got system chef installed now... in prep for moving to chef management
[2012-08-31 18:38:44 -0400] Loof: One important question... if I continue using system chef... will chef_gem 'do the right thing'?
[2012-08-31 18:39:06 -0400] kallistec: yeah, chef_gem should work for all cases
[2012-08-31 18:39:38 -0400] jtimberman: yup
[2012-08-31 18:40:02 -0400] jtimberman: its entire purpose is to install the gem into the Ruby environment that Chef itself is running in, so it can be used by Chef within the same run (or subsequent runs)
[2012-08-31 18:41:17 -0400] Loof: So it's a bug in the aws cookbook... yay :P
[2012-08-31 18:41:18 -0400] Loof: :)
[2012-08-31 18:42:04 -0400] Loof: And what will chef_gem do when we switch to erchef ;D hehehe
[2012-08-31 18:42:11 -0400] jtimberman: it won't change.
[2012-08-31 18:42:14 -0400] jtimberman: erchef is the chef server only
[2012-08-31 18:42:18 -0400] jtimberman: the client will remain a RubyGem
[2012-08-31 18:42:31 -0400] schisamo: speaking of erchef :) http://www.opscode.com/blog/2012/08/31/test-drive-the-chef-11-server-preview/
[2012-08-31 18:42:39 -0400] jtimberman: schisamo: I linked that already sir! :D
[2012-08-31 18:42:51 -0400] jtimberman: (but its so awesome that bears repeating)
[2012-08-31 18:43:09 -0400] Loof: jtimberman: I was joking... but hopefully that will revive the crossplatform work... given that we've got a %99 perl team and a couple of people who've toyed with ruby
[2012-08-31 18:43:13 -0400] Loof: a perl cookbook would be ideal
[2012-08-31 18:43:21 -0400] schisamo: (lol) sorry been down in an erlang hole.
[2012-08-31 18:43:26 -0400] stormerider: *headdesk*
[2012-08-31 18:43:27 -0400] stormerider: so
[2012-08-31 18:43:40 -0400] erikh: congrats on the release of erchef
[2012-08-31 18:43:45 -0400] erikh: well, pre-release!
[2012-08-31 18:43:49 -0400] stormerider: a pruning script that i have to detect dead aws nodes, when adjusted, wiped out my entire node list.
[2012-08-31 18:43:55 -0400] trobrock: If I have a run list that looks like: role[web],role[application] and role[web] runs the nginx cookbook should it be ok to rely on a node attribute set by the nginx cookbook in a recipe within role[web]?
[2012-08-31 18:43:55 -0400] hoover_damm: schisamo, don't worry about it... repeat it as often as you want :) because it's new and people join all the time
[2012-08-31 18:43:57 -0400] kallistec: Loof: it's not really possible to make other languages first class citizens in Chef
[2012-08-31 18:44:12 -0400] stormerider: is there a way to recover that, or do i need to ssh in to each of them and fix it manually?
[2012-08-31 18:44:19 -0400] jtimberman: Loof: we have a perl cookbook..
[2012-08-31 18:44:25 -0400] Loof: erlang seems kinda cool... but the key thing is event driven & decoupled code... you can do that /w other languages... the copy on write is cool
[2012-08-31 18:44:25 -0400] erikh: just curious, how far out do you guys expect chef 11 to be?
[2012-08-31 18:44:37 -0400] Loof: jtimberman: cookbooks written in perl
[2012-08-31 18:44:41 -0400] jtimberman: ah right
[2012-08-31 18:44:47 -0400] schisamo: erikh: no clue on that one..not too far out though.
[2012-08-31 18:44:52 -0400] hoover_damm: Loof, you can use the script interperter to write perl
[2012-08-31 18:44:56 -0400] hoover_damm: Loof, not really the same
[2012-08-31 18:45:02 -0400] jtimberman: like, there's proof of concept code out there by Adam, but like kallistec said, its not a first class citizen.
[2012-08-31 18:45:04 -0400] stormerider: ah, crap. im using the chef-client cookbook that removes the validation key. manual intervention is probably the order of the day. joy.
[2012-08-31 18:45:05 -0400] Loof: kallistec: There's a proof of concept if you look... but it doesn't handle attributes
[2012-08-31 18:45:08 -0400] Loof: etc. etc.
[2012-08-31 18:45:17 -0400] schisamo: Also for those that are interested the erchef deb was built with this branch of omnibus-chef: https://github.com/opscode/omnibus-chef/tree/OC-1835/erchef-integration
[2012-08-31 18:45:35 -0400] Loof: hoover_damm: No, we're talking about an actual perl-chef integration for writing cookbooks...
[2012-08-31 18:45:49 -0400] erikh: you mean a reimplementation of chef-client more or less
[2012-08-31 18:46:03 -0400] Loof: jtimberman: Yes, but if ruby is now the 'external' language... and erlang is the main...
[2012-08-31 18:46:20 -0400] Loof: it forces them to decouple from ruby... and thus MAY make writing clients in other languages easier
[2012-08-31 18:46:38 -0400] erikh: well, it's API driven, always has been
[2012-08-31 18:46:45 -0400] Loof: Honestly, the couchdb stuff in the video was more interesting
[2012-08-31 18:46:48 -0400] jtimberman: The language of the chef-server is largely irrelevant as far as client-side things are concerned.
[2012-08-31 18:46:50 -0400] hoover_damm: Loof, you are free to implement your own client
[2012-08-31 18:46:57 -0400] erikh: check out Chef::REST for an example. most of the client code goes through that.
[2012-08-31 18:47:02 -0400] jtimberman: and by largely i mean completely :)
[2012-08-31 18:47:23 -0400] kallistec: Loof: the erlang stuff is on the server side only. the client is still 100% ruby program
[2012-08-31 18:47:25 -0400] hoover_damm: Loof, but I wouldn't expect Opscode to bust out other languages anytime soon :) They have lots of good stuff in their brains
[2012-08-31 18:47:27 -0400] jtimberman: you could write a python API server for chef and run ruby-based chef-client against it.
[2012-08-31 18:47:58 -0400] jtimberman: etc etc
[2012-08-31 18:48:00 -0400] erikh: isn't that what pychef does?
[2012-08-31 18:48:04 -0400] hoover_damm: erikh, no
[2012-08-31 18:48:12 -0400] hoover_damm: erikh, pychef is just an api wrapper so we can talk to chef
[2012-08-31 18:48:12 -0400] jtimberman: erikh: ;)
[2012-08-31 18:48:13 -0400] hoover_damm: erikh, easily
[2012-08-31 18:48:25 -0400] erikh: well yeah, but you could implement a python client atop that.
[2012-08-31 18:48:30 -0400] hoover_damm: sure
[2012-08-31 18:48:35 -0400] Jay_Levitt: jtimberman: is it ok if I blatantly copy your authenticated-postfix code and claim it as my own so I can transfer the copyright back to opscode for a pull request?
[2012-08-31 18:48:44 -0400] schisamo: erikh: you are thinking of https://github.com/coderanger/commis
[2012-08-31 18:48:46 -0400] trobrock: I have a setup similar to: https://gist.github.com/3557235 with a run_list of role[web],role[application], but I am getting a failure on line 1 of the application recipe because the nginx node attribute is not set, am I not able to reply on it being set at that point?
[2012-08-31 18:48:54 -0400] erikh: oh, very cool
[2012-08-31 18:48:58 -0400] jtimberman: Jay_Levitt: lolwut?
[2012-08-31 18:49:22 -0400] Jay_Levitt: jtimberman: your postfix cookbook links to your blog post for an example of how to use encrypted data bags to store the postfix smtp secret
[2012-08-31 18:49:29 -0400] jtimberman: Jay_Levitt: oh
[2012-08-31 18:49:36 -0400] Jay_Levitt: jtimberman: And I says to myself, self, I says, why not put that in the cookbook?
[2012-08-31 18:50:18 -0400] hawkeye: question about bootstrapping a windows node
[2012-08-31 18:50:26 -0400] jtimberman: Jay_Levitt: you mean this bit: smtp_sasl = encrypted_data_bag_item("secrets", "postfix")
[2012-08-31 18:50:32 -0400] Jay_Levitt: jtimberman: yeah, that bit
[2012-08-31 18:50:42 -0400] jtimberman: and the library: https://gist.github.com/2364164
[2012-08-31 18:50:47 -0400] Jay_Levitt: jtimberman: exactly
[2012-08-31 18:50:50 -0400] erikh: trobrock: what error are you seeing precisely? can you gist that too?
[2012-08-31 18:51:11 -0400] jtimberman: i think i had a ticket about adding that to Chef::Recipe
[2012-08-31 18:51:24 -0400] trobrock: erikh: TypeError: can't convert nil into String
[2012-08-31 18:52:16 -0400] erikh: hrm. have you tested to ensure that node['nginx']['conf_dir'] is set?
[2012-08-31 18:52:27 -0400] Jay_Levitt: it'd be good if it was, and/or if there were a "community helper" type cookbook we could all depend on
[2012-08-31 18:52:31 -0400] Jay_Levitt: though that can easily turn into Ruby Facets
[2012-08-31 18:52:37 -0400] jtimberman: indeed, i did: http://tickets.opscode.com/browse/CHEF-2522
[2012-08-31 18:53:08 -0400] Guest61665: when I bootstrap a windows node - client.rb is not created at c:\chef, so I am not able to run chef-client successfully. How do I push a proper client.rb to the node? Is this something the bootstrapper should've done?
[2012-08-31 18:53:15 -0400] trobrock: erikh: I had my cookbooks running with it previously, but I had been building the cookbook so the nginx recipe ran before this application cookbook even existed
[2012-08-31 18:53:47 -0400] Jay_Levitt: jtimberman: yeah, you should go poke Bryan
[2012-08-31 18:54:04 -0400] erikh: trobrock: do you have anything in nginx's attributes that set this?
[2012-08-31 18:54:17 -0400] erikh: cookbooks/nginx/attributes/default.rb # or similar
[2012-08-31 18:55:39 -0400] rocket: jtimberman: uhoh .. whats up with virtualbox?
[2012-08-31 18:56:08 -0400] leifmadsen: afternoon all -- I have a node that is not setting the FQDN attribute, but I believe is an automatic attribute set via ohai. Just curious what I might look at doing to make sure it gets set?
[2012-08-31 18:56:12 -0400] paulmooring: rocket: in my experience it about what goes down with virtualbox
[2012-08-31 18:56:15 -0400] paulmooring: x
[2012-08-31 18:56:25 -0400] rocket: :p
[2012-08-31 18:56:57 -0400] trobrock: erikh: Actually now that im thinking about it I think that attribute might come from an nginx recipe, not attributes. Let me try one of the actualy attributes
[2012-08-31 18:57:02 -0400] Jay_Levitt: If I can freely create EC2 instances to test out recipes, is there an example to using the VirtualBox/test_kitchen approach?
[2012-08-31 18:57:04 -0400] rocket: paulmooring: thats true .. I am working on setting up my own openstack cluster for testing etc .. bringing up and down vms inside that etc ..
[2012-08-31 18:59:14 -0400] jtimberman: rocket: shutting down virtual machine guests in virtualbox on OS X *frequently* causes the OS to kernel panic and crash
[2012-08-31 19:00:25 -0400] jtimberman: i'm doing a lot of testing with test-kitchen, which by default will spawn 4 virtual machines (centos 5, centos 6, ubuntu 10, ubuntu 12), each of which has a random chance of panicking just to do cookbook testing :)
[2012-08-31 19:01:27 -0400] rocket: jtimberman: I have found that I can run openstack inside a vmware fusion or vmware wkstation vm  and not have significant slow downs in the nested vms
[2012-08-31 19:01:40 -0400] hoover_damm: jtimberman, good thing test-kitchen can use things other then virtualbox :) you just have to code it
[2012-08-31 19:01:58 -0400] leifmadsen: I've had pretty good luck with virtualbox on linux, but never tried on OSX
[2012-08-31 19:02:05 -0400] leifmadsen: then again, I don't use OSX on my macbook pro :)
[2012-08-31 19:02:51 -0400] hoover_damm: virtualbox likely works best on stock kernels and stock distros
[2012-08-31 19:02:53 -0400] hoover_damm: which counts me out
[2012-08-31 19:03:28 -0400] paulmooring: hoover_damm: I used it for a while on gentoo w/ a custom kernel
[2012-08-31 19:04:04 -0400] hoover_damm: paulmooring, i'd just write a lxc adapter and be done
[2012-08-31 19:04:06 -0400] hoover_damm: tbh
[2012-08-31 19:04:16 -0400] hoover_damm: so much easier and you can test so much more
[2012-08-31 19:04:35 -0400] hoover_damm: more is subjective in this context
[2012-08-31 19:05:26 -0400] javawidget: hey guys...
[2012-08-31 19:05:36 -0400] javawidget: I have a question for you...
[2012-08-31 19:05:40 -0400] martinisoft: jtimberman: to double check, for my patch to a cookbook, I just mark the ticket as "Resolved" with "Fixed" as the resolution?
[2012-08-31 19:07:14 -0400] javawidget: I have a load balancer recipe for haproxy that needs to search for nodes that have a specific role (the application servers that will be in the pool)
[2012-08-31 19:07:28 -0400] javawidget: I'm doing this at the moment:
[2012-08-31 19:07:34 -0400] javawidget: app_servers = search(:node, "role:message_anyone_server")
[2012-08-31 19:07:40 -0400] javawidget: This works.
[2012-08-31 19:07:43 -0400] javawidget: However..
[2012-08-31 19:08:09 -0400] javawidget: what I want to do is put the value of role in a recipe..
[2012-08-31 19:08:14 -0400] javawidget: sorry..
[2012-08-31 19:08:16 -0400] javawidget: I mean.
[2012-08-31 19:08:28 -0400] javawidget: I want to put the value of the role to search for in an attribute
[2012-08-31 19:08:40 -0400] javawidget: app_servers = search(:node, "roles:#{node[:app_pool_role]}")
[2012-08-31 19:08:47 -0400] javawidget: This does not work.
[2012-08-31 19:09:24 -0400] thedeeno: how do a send a notification from a lwrp action?
[2012-08-31 19:10:12 -0400] javawidget: Can anyone help me get the value of the attribute node[:app_pool_role] into my search recipe?
[2012-08-31 19:10:42 -0400] barefoot: javawidget: where are you currently defining :app_pool_role ?
[2012-08-31 19:11:46 -0400] javawidget: I'm defining that in the role
[2012-08-31 19:12:19 -0400] leifmadsen: disregard, found out my own issue. Hostname I set was not in /etc/hosts, which caused hostname -f to fail.
[2012-08-31 19:12:50 -0400] javawidget: because I'll have different roles that will match different applications, I thought it made most sense to set that attribute in the role.
[2012-08-31 19:13:18 -0400] barefoot: seems like you want to search for the attr not the role?
[2012-08-31 19:13:27 -0400] javawidget: And actually.. I really want to search for application servers that have the role (as set in the attribute) within the current environment
[2012-08-31 19:14:06 -0400] javawidget: I'm searching for "role:<value of the attribute on the current node>"
[2012-08-31 19:14:40 -0400] javawidget: if I use: app_servers = search(:node, "role:message_anyone_server")
[2012-08-31 19:15:14 -0400] javawidget: (ie, hard code the name of the role) It works
[2012-08-31 19:15:22 -0400] leifmadsen: did you check if your node attribute returns anything?
[2012-08-31 19:15:33 -0400] javawidget: but: app_servers = search(:node, "roles:#{node[:app_pool_role]}")
[2012-08-31 19:15:39 -0400] javawidget: that doesn't work
[2012-08-31 19:15:41 -0400] leifmadsen: Chef::Log.info("My attribute: #{node['foobar']}")
[2012-08-31 19:16:09 -0400] leifmadsen: sounds like an invalidly set attribute then
[2012-08-31 19:16:29 -0400] javawidget: OK...  the syntax is correct, right?
[2012-08-31 19:16:32 -0400] jtimberman: martinisoft: yes
[2012-08-31 19:16:47 -0400] martinisoft: cool, thanks jtimberman
[2012-08-31 19:16:47 -0400] jtimberman: martinisoft: a link to a pull request is helpful, but you can just link to your branch
[2012-08-31 19:16:58 -0400] martinisoft: I think I did that too
[2012-08-31 19:16:58 -0400] leifmadsen: javawidget: that's easy to determine in your Chef::Log test
[2012-08-31 19:17:04 -0400] martinisoft: if not I can add it to mine
[2012-08-31 19:17:16 -0400] martinisoft: actually, did both it seems
[2012-08-31 19:17:27 -0400] javawidget: Awesome. Thanks @leifmadsen
[2012-08-31 19:22:09 -0400] thedeeno: maybe it's not possible to send notifications from withing resources?
[2012-08-31 19:22:43 -0400] thedeeno: I'd want to delay restart a service behind the scenes in my provider but I can't figure out how
[2012-08-31 19:22:48 -0400] Jay_Levitt: EC2 folks: My new VPC instance doesn't have an 'fqdn' attribute, while a regular EC2 instance does.  I recall seeing a bunch of discussion around this, and around a new ['cloud'] section of node attributes.. what's the scoop?
[2012-08-31 19:24:10 -0400] leifmadsen: Jay_Levitt: I just ran into an issue like that with vagrant, in which my hostname was not the lead value in /etc/hosts for 127.0.0.1
[2012-08-31 19:24:32 -0400] leifmadsen: fwiw
[2012-08-31 19:26:38 -0400] javawidget: Hmmmm..
[2012-08-31 19:26:39 -0400] javawidget: Ok..
[2012-08-31 19:26:53 -0400] javawidget: so, the value is there.. the attribute is being set properly.
[2012-08-31 19:27:14 -0400] Jay_Levitt: leifmadsen: hmm, I don't think that's it.. my EC2 host doesn't have the hostname in /etc/hosts either.  I suspect a bootstrap problem
[2012-08-31 19:27:28 -0400] javawidget: app_servers = search(:node, "role:#{node[:app_pool_role]}")
[2012-08-31 19:27:38 -0400] javawidget: That just doesn't work.
[2012-08-31 19:28:17 -0400] leifmadsen: and a Chef::Log.info directory above it shows valid data from the attribute?
[2012-08-31 19:28:25 -0400] javawidget: It does
[2012-08-31 19:28:38 -0400] javawidget: [Fri, 31 Aug 2012 19:25:22 +0000] INFO: app_pool_role: message_anyone_server
[2012-08-31 19:28:47 -0400] leifmadsen: because that's the only explanation I can think of since if just replacing the attribute with static data works, it should work
[2012-08-31 19:29:23 -0400] javawidget: is #{node[:app_pool_role]} correct?
[2012-08-31 19:29:26 -0400] leifmadsen: might want to pastebin or gist your actual recipe section
[2012-08-31 19:29:49 -0400] leifmadsen: syntax looks ok if that attribute actually exists
[2012-08-31 19:30:13 -0400] Jay_Levitt: hmm, looks like knife has some workarounds to get 'fqdn' on ec2 hosts, but I bet Chef recipes don't benefit from it: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/status.rb#L66
[2012-08-31 19:31:05 -0400] javawidget: here's my recipe:
[2012-08-31 19:31:06 -0400] javawidget: http://pastebin.com/mz5UYYnV
[2012-08-31 19:31:16 -0400] javawidget: super simple.
[2012-08-31 19:32:12 -0400] example42: if i have a custom recipe in one cookbook that is including an opscode recipe from another cookbook, do I need to install both cookbooks, or just my custom one?
[2012-08-31 19:37:03 -0400] smurfy: has anyone ever seen chef create an empty /usr/bin/gcc file on centps ?
[2012-08-31 19:37:09 -0400] smurfy: centos even
[2012-08-31 19:58:34 -0400] Jay_Levitt: Anyone know ohai hints?  http://tickets.opscode.com/browse/OHAI-310 implies I'm supposed to create /etc/chef/ohai/hints/ec2.json so ohai knows where it is.  I've created the file, but re-running ohai still shows no 'fqdn' attribute.  Did this need to be present at bootstrap, or should ohai pick up the file on the fly?
[2012-08-31 20:01:39 -0400] example42: does anyone have a good strategy for handling ec2 instances that start/stop and get new IPs?  http://community.opscode.com/questions/104
[2012-08-31 20:02:00 -0400] kallistec: Jay_Levitt: even with the hint file, the ec2 info will be in node[:ec2] or node[:cloud]
[2012-08-31 20:02:21 -0400] kallistec: node[:fqdn] comes from `hostname --fqdn`
[2012-08-31 20:04:06 -0400] Jay_Levitt: kallistec: ah, yeah.. I thought maybe the hint was intended to tell ohai to pull node[:fqdn] from node[:ec2] instead.
[2012-08-31 20:04:32 -0400] Jay_Levitt: I guess the real problem is why hostname --fqdn is broken on Ubuntu VPC hosts.  (answer: because /etc/resolv.conf points to the non-existent 10.0.0.2, but why on earth does it do that?)
[2012-08-31 20:05:58 -0400] kallistec: Jay_Levitt: I don't have any experience with VPC, so no idea there. As for the fqdn thing, we have a strong aversion to making ohai give you a little white lie about the hostname, even if it's convenient sometimes
[2012-08-31 20:06:31 -0400] Jay_Levitt: kallistec: that's understandable, I just misread the ticket
[2012-08-31 20:06:40 -0400] Jay_Levitt: (News flash: wishful thinking affects reading skills)
[2012-08-31 20:07:02 -0400] jtimberman: fyi: i just released aws cookbook v 0.100.2, which switches the gem installation to chef_gem.
[2012-08-31 20:07:07 -0400] jtimberman: don't remember who was having trouble with that earlier
[2012-08-31 20:07:24 -0400] cwj: fyi: thanks jtimberman
[2012-08-31 20:07:27 -0400] cwj: :D
[2012-08-31 20:07:37 -0400] jtimberman: cwj: :)
[2012-08-31 20:07:46 -0400] cwj: it wasn't me but thanks anyway
[2012-08-31 20:10:58 -0400] Jay_Levitt: I remember the convo, but can't find it in the archives either. ah well.
[2012-08-31 20:12:36 -0400] Jay_Levitt: any strong reason to switch to omnibus right now if the gem install is working? I'm waiting for the 10.14 pg-gem stuff to get shaken out.. sounds like chef does its thing but the cookbook doesn't yet, IIUC
[2012-08-31 20:15:30 -0400] kallistec: Jay_Levitt: if it's working for you and managing chef's deps isn't causing you pain, no reason to switch
[2012-08-31 20:15:50 -0400] kallistec: we'll keep publishing gems for the foreseeable future
[2012-08-31 20:15:54 -0400] Jay_Levitt: kallistec: yeah, I *think* it's working, tho I'm sure someday a chef_gem vs gem vs rvm_gem will screw me up :)
[2012-08-31 20:16:12 -0400] kallistec: chef_gem should work fine on non-omnibus
[2012-08-31 20:16:25 -0400] Jay_Levitt: ah, good
[2012-08-31 20:16:44 -0400] Jay_Levitt: I just ran into the surprise that I need to install the chef gem, even though the binstubs are there, since I'm using systemwide rvm
[2012-08-31 20:16:51 -0400] Jay_Levitt: and of course the chef gem isn't installed there
[2012-08-31 20:29:18 -0400] jtimberman: considering that omnibus packages have chef installed as a gem, keeping it released as a gem on its own shouldn't change :)
[2012-08-31 20:29:21 -0400] jtimberman: kallistec: ^
[2012-08-31 20:32:25 -0400] kallistec: I think it pulls down the git source and then builds a gem so we can make demo builds for in-progress features, but gems are super easy to ship and work fine for people who already have ruby in their stack
[2012-08-31 20:35:23 -0400] kallistec: https://github.com/opscode/omnibus-software/blob/master/config/software/chef.rb
[2012-08-31 20:41:35 -0400] Jay_Levitt: ok, I figured out the fqdn problem... does a chef bootstrap run check ohai continuously (in which case I can solve this with the "hostsfile" cookbook) or do I need to fix /etc/resolv.conf in the bootstrap template?
[2012-08-31 20:53:30 -0400] kallistec: Jay_Levitt: ohai only runs once unless you use the ohai resource to refresh it
[2012-08-31 20:53:43 -0400] Jay_Levitt: kallistec: ok.  resolv.conf is simple enough, and I'm appending a line, so I'll just do it that way
[2012-08-31 20:53:51 -0400] Jay_Levitt: I was trying to be all proper.
[2012-08-31 21:13:24 -0400] stormerider: blah. so i have a user in a databag that has group entries, but isnt getting added to the groups. i can't tell if this is a custom cookbook or one that my former cosysadmin downloaded from opscode.
[2012-08-31 21:17:05 -0400] jan0232: i want to change the current environments PATH variable temporarily for a block of chef code something like: ENV['PATH] = ""  but only for a few commands is there a neat way to do that??
[2012-08-31 21:18:04 -0400] jan0232: right now i'm doing:  tmp_path = ENV['PATH'] ; ENV['PATH'] = xyz; . . ENV['PATH'] = tmp_path
[2012-08-31 21:20:51 -0400] Maniacal: does anyone know if 10.12.0 has an issue with deep merge.  I am trying send some data that should not merge, which worked under 0.10.4.  but with 10.12.0 it's actually putting "!merge:" into the array instead of seeing that and acting accordingly
[2012-08-31 21:21:42 -0400] Maniacal: before I go and revert to the old client wanted to see if there's something I'm missing.  docs seem to be the same as before
[2012-08-31 21:24:38 -0400] yfeldblum: jan0232, if you need it for shell-out, you can pass `:environment => {"PATH" => "xyz:#{ENV["PATH"]}` as an option
[2012-08-31 21:25:28 -0400] yfeldblum: jan0232, if you need it for an execute resource, you can set the `environment` attribute of the resource
[2012-08-31 21:26:40 -0400] jan0232: yfeldblum: ok. i need it for a recipe that uses the "rbenv" recipe somehow the rbenv_gem command doesn't work for a jruby install because some PATH settings are missing
[2012-08-31 21:28:03 -0400] yfeldblum: jan0232, because you're installing the java runtime in the same chef-client run?
[2012-08-31 21:28:05 -0400] jan0232: i'm using the rbenv recipe (https://github.com/RiotGames/rbenv-cookbook) to install multiple ruby versions and i want the "bundler" gem to be available in each
[2012-08-31 21:30:27 -0400] yfeldblum: jan0232, https://github.com/RiotGames/rbenv-cookbook/blob/master/recipes/default.rb#L78-85
[2012-08-31 21:30:28 -0400] jan0232: yfeldblum: yes i am, but i don't think that's my problem. the problem is for the bundler gem to get installed in jruby properly, i need to add /opt/rbenv/shims to the PATHat least during the rbenv_gem command because the "gem" script does "!#/bin/env jruby" or somethingand the jruby executable can't be foundwell, and that is under /opt/rbenv/shims
[2012-08-31 21:31:08 -0400] jan0232: yfeldblum: yes. that code snipped is where i got the idea to tweak the ENV['PATH'] myself...
[2012-08-31 21:31:23 -0400] yfeldblum: jan0232, so you should be fine right?
[2012-08-31 21:33:18 -0400] jan0232: yfeldblum: hm yes it seems to work once i add ENV['PATH'] = "#{node[:rbenv][:root]}/bin:#{ENV['PATH']}"   however, that comes with other side-effects like "gem_package" defaulting not to the chef_gems, but to the current globally set rbenv ruby so i need to save the previous PATH settings and reset them once i'm done.
[2012-08-31 21:33:37 -0400] jan0232: but yea..it works...
[2012-08-31 21:34:33 -0400] yfeldblum: jan0232, well, i don't use those broken ways of using rbenv and rvm
[2012-08-31 21:35:34 -0400] jan0232: yfeldblum: there is no better way is there?? i need multiple ruby versionsi'm hosting a jruby and a ruby app side by side
[2012-08-31 21:36:01 -0400] jan0232: it works greatjust rbenv and those PATHs are a pain sometimes
[2012-08-31 21:36:37 -0400] yfeldblum: jan0232, fnichol/chef-rvm works fine most of the time
[2012-08-31 21:36:53 -0400] stormerider: is there a way to see the merged runlist/etc for a node?
[2012-08-31 21:37:17 -0400] yfeldblum: jan0232, couple that with liberal use of the rvm gem and loading rvm and switching to that ruby when shelling out
[2012-08-31 21:39:41 -0400] Maniacal: I tried to roll back to 0.10.4 and that broke something else.  back on 10.12.0.  I'll ask again for the new joins - does anyone know if deep merging is broken in 10.12.0?  I'm wasn't able to find an open ticket on it
[2012-08-31 21:40:15 -0400] Maniacal: or if possibly the language of it changed.  because "!merge:" is no longer working
[2012-08-31 21:45:13 -0400] Maniacal: looks like it doesn't work in 0.10.10 either.  this is frustrating.
[2012-08-31 21:50:09 -0400] jan0232: yfeldblum: would there be a chef-way to run a group of commands as a certain user? also inheriting all user specific env settings..as if the user himself would have logged into a ssh session?
[2012-08-31 21:52:15 -0400] jan0232: yfeldblum: hmm.. maybe with a simple "execute block"
[2012-08-31 21:55:37 -0400] yfeldblum: jan0232, generally not advisable, but you can have a bash script resource that is wrapped in su --login
[2012-08-31 22:01:11 -0400] kallistec: updated http://www.opscode.com/chef/install/ now shows you where to download the package for the `curl | bash` averse
[2012-08-31 22:04:37 -0400] scottwb: Hi. I am having "ERROR: Errno::ECONNRESET: Connection reset by peer" problems trying to upload a specific cookbook to Hosted Chef. Other cookbooks are fine. There's not much else to go off of here. Seems like the hosted chef server is cutting the connection halfway through upload. This is with the php cookbook from the community site install. Kinda in an urgent spot - hoping someone can throw me a lifeline while I continue to google thi
[2012-08-31 22:23:33 -0400] zuhaib: I have a VM that has two nics, and I want the IPv4 of eth1, whats the easiest way doing that
[2012-08-31 22:26:40 -0400] stormerider: is there a way to tell if a group already exists on the system?
[2012-08-31 22:34:38 -0400] juliancdunn: stormerider: why do you need to do that
[2012-08-31 22:34:47 -0400] juliancdunn: the provider won't create it if it already exists
[2012-08-31 22:36:58 -0400] stormerider: ah, i think i found the problem. he had append: false, so create was not adding anything to it after the fact. so i thought i had to do a check between create and modify.
[2012-08-31 22:40:03 -0400] yfeldblum: zuhaib, `ip address show #{dev}`.lines.map(&:strip).grep(/^inet /).first.split(/\s+/)[1].gsub(/\/\d+$/, '')
[2012-08-31 22:41:46 -0400] yfeldblum: zuhaib, and yes, that's ruby ...
[2012-08-31 22:43:29 -0400] illcomputing: wait wouldn't ohai have gathered all the eth addresses?
[2012-08-31 22:44:47 -0400] yfeldblum: illcomputing, yes
[2012-08-31 22:47:04 -0400] yfeldblum: illcomputing, zuhaib, node["network"]["interfaces"]["eth1"]["addresses"] contains useful information
[2012-08-31 22:47:37 -0400] illcomputing: I really want knife to have some kind of xquery for json functionality...
[2012-08-31 22:47:44 -0400] hoover_damm: yfeldblum, now how can I access the actual ip?
[2012-08-31 22:47:45 -0400] zuhaib: yeah I see but it has all the address, i just need the ipv4 one
[2012-08-31 22:47:48 -0400] hoover_damm: yfeldblum, to be quite honest
[2012-08-31 22:47:51 -0400] zuhaib: and using .first while works sometimes, not always
[2012-08-31 22:47:53 -0400] zuhaib: as its a hash
[2012-08-31 22:48:00 -0400] illcomputing: knife node show network.interfaces.eth1[0]
[2012-08-31 22:48:00 -0400] hoover_damm: yfeldblum, we use 1.9 and it's a Chef::Node::Attribute
[2012-08-31 22:48:15 -0400] zuhaib: I am just going to use this: https://gist.github.com/1040543
[2012-08-31 22:48:20 -0400] hoover_damm: chef > node["network"]["interfaces"]["eth0"]["addresses"].class => Chef::Node::Attribute
[2012-08-31 22:49:18 -0400] hoover_damm: I personally feel this pain and I really don't want to complicate it with helpers
[2012-08-31 22:49:58 -0400] hoover_damm: chef > node["network"]["interfaces"]["eth0"]["addresses"].first => ["00:25:90:72:2D:DF", {"family"=>"lladdr"}]
[2012-08-31 22:50:15 -0400] hoover_damm: if you go for the first item it's a string, second it's an array
[2012-08-31 22:50:24 -0400] hoover_damm: not even close to my ip
[2012-08-31 22:51:36 -0400] hoover_damm: and if you look at it with pp it's obvious why you can't but meh
[2012-08-31 23:05:03 -0400] jwbnyc: Trying to use the apt cookbook v1.4.6 to make a new version of the hudon cookbook: need to add the hudson distro to apt, but chef-client says NameError: Cannot find a resource for apt_repository on ubuntu version 12.04
[2012-08-31 23:06:41 -0400] juliancdunn: hoover_damm: isn't the IP the entry with family => "inet4"
[2012-08-31 23:15:06 -0400] yfeldblum: hoover_damm, right, i said "contains useful information"
[2012-08-31 23:15:26 -0400] yfeldblum: hoover_damm, i would start with a #to_hash and then i would do some loops & checks and stuff
[2012-08-31 23:32:50 -0400] hoover_damm: yfeldblum, i think this is related to the iproute2 stuff
[2012-08-31 23:32:53 -0400] hoover_damm: vs ifconfig
[2012-08-31 23:33:18 -0400] hoover_damm: yfeldblum, I can enumerate to get all information, but I cannot directly access said data
[2012-08-31 23:33:21 -0400] hoover_damm: which is groan
[2012-08-31 23:33:31 -0400] hoover_damm: then you end up adding if's here and there to compensate
[2012-08-31 23:33:53 -0400] hoover_damm: acceptable but
[2012-08-31 23:37:14 -0400] yfeldblum: hoover_damm, zomg writing code is hard ... let's go shopping
[2012-08-31 23:38:25 -0400] timsmith: is there a way to search for nodes that are running a particular version of chef?
[2012-08-31 23:38:28 -0400] hoover_damm: yfeldblum, indeed, I am going to now.
[2012-08-31 23:38:30 -0400] hoover_damm: off to petsmart
[2012-08-31 23:39:00 -0400] yfeldblum: hoover_damm, :)
[2012-08-31 23:41:16 -0400] yfeldblum: hoover_damm, node["network"]["interfaces"]["eth1"]["addresses"].to_hash.find{|k, v| v["family"] == "inet"}.first
[2012-08-31 23:53:08 -0400] zuhaib: node["network"]["interfaces"]["eth1"]["addresses"].to_hash.find{|k, v| v["family"] == "inet"}.first .... I just added the ohai plugin and boom, now I can get my eht1 address easy
