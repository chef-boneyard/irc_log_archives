[2012-08-30 00:03:54 -0400] storme|away: ohai... common question, im sure... sun java on ubuntu 12.04, what's the right way to handle this?
[2012-08-30 00:06:33 -0400] storme|away: ah, there's a java cookbook to handle it. nevermind, thanks. :)
[2012-08-30 00:16:21 -0400] mhalligan: is anyone familiar with the knife bootstrap stuff? I'm trying to figure out why/how it generates the client configuration inputs onto the node
[2012-08-30 00:17:09 -0400] mhalligan: (rather, why it generates the client configuration that it does, which seems to ignore almost everything in my local knife.rb)
[2012-08-30 00:30:24 -0400] hashpuppy_: stupid question, but if half our servers are in the dmz, where should the chef server be?
[2012-08-30 00:56:06 -0400] williamherry: I already installed rails use gem install rails, and I can see rails from gem list, but rails command is not available, more step should I do?
[2012-08-30 01:36:12 -0400] tspencer: Hello!  I've got a chef-server setup and a bunch of chef-clients going.  This is great, but I am having a hard time figuring out how to apply a recipe to all my hosts.  Surely there's some clever way of saying "everybody's run_list should have this in it", or "everybody who is CentOS should run this".
[2012-08-30 01:36:38 -0400] tspencer: Would anybody here be interested in telling me what I'm missing?  :-)
[2012-08-30 01:38:19 -0400] tspencer: Hmm.  Seems as if it's after-hours at the moment.  :-)  I'll be back to ask again later.
[2012-08-30 01:40:00 -0400] jessicab: tspencer - might just want to setup some roles for that? assign all the centos nodes to a role, then you could just add to the role as its needed
[2012-08-30 01:40:25 -0400] jessicab: shrugs, it can take people a few to respond even in the middle of the day :P
[2012-08-30 01:46:22 -0400] yfeldblum: tspencer, the real answer is: no, because there has got to be an escape hatch for the people that do that to undo it anyway
[2012-08-30 01:46:38 -0400] yfeldblum: tspencer, but most people will have a role named "base" where all the common stuff is
[2012-08-30 01:47:50 -0400] yfeldblum: tspencer, and they will either start every node's run-list with "role[base]" and then continue on with the rest of the node's run-list, or if they are doing a setup where each node has a run-list of one top-level role which might delegate then each top-level role starts its run-list with "role[base]"
[2012-08-30 01:55:23 -0400] makerbreaker: hi, is this a problem with the cookbook ro ruby?
[2012-08-30 01:55:23 -0400] makerbreaker: https://gist.github.com/3521594
[2012-08-30 01:59:00 -0400] storme|away: im trying to use the java cookbook to install the oracle JDK on ubuntu and im not seeing how to get javac recognized via /etc/alternatives
[2012-08-30 01:59:09 -0400] storme|away: do i have to snap the symlinks myself?
[2012-08-30 02:00:11 -0400] yfeldblum: makerbreaker, did you try following the helpful hint in the error output to retry the command with the -VV flag?
[2012-08-30 02:00:27 -0400] makerbreaker: i did, it didnt help me too much
[2012-08-30 02:01:01 -0400] makerbreaker: same basic ":String (NoMethodError)
[2012-08-30 02:02:07 -0400] yfeldblum: makerbreaker, what's your knife.rb look like?
[2012-08-30 02:05:25 -0400] makerbreaker: https://gist.github.com/3521658
[2012-08-30 02:07:49 -0400] yfeldblum: makerbreaker, any problems with any other knife commands?
[2012-08-30 02:08:21 -0400] makerbreaker: doesnt appear so
[2012-08-30 02:08:25 -0400] makerbreaker: ie, list
[2012-08-30 02:08:57 -0400] yfeldblum: makerbreaker, what about knife-cookbook-upload?
[2012-08-30 02:10:26 -0400] makerbreaker: i can delete
[2012-08-30 02:10:35 -0400] makerbreaker: well..i couldnt, but i gave myself admin
[2012-08-30 02:10:38 -0400] makerbreaker: then i could
[2012-08-30 02:13:05 -0400] makerbreaker: hrm
[2012-08-30 02:13:11 -0400] makerbreaker: knife configure
[2012-08-30 02:13:15 -0400] yfeldblum: makerbreaker, but what about `knife cookbook upload`?
[2012-08-30 02:13:20 -0400] makerbreaker: seemed to have fixed things so far
[2012-08-30 02:15:13 -0400] makerbreaker: ya, all fixed.
[2012-08-30 02:15:14 -0400] makerbreaker: od
[2012-08-30 02:15:15 -0400] makerbreaker: odd*
[2012-08-30 02:15:50 -0400] makerbreaker: oh...i guess i was missing the brackets in my knife.rb
[2012-08-30 02:15:54 -0400] makerbreaker: in the first gist
[2012-08-30 02:16:52 -0400] yfeldblum: makerbreaker, `knife cookbook site install` is working now?
[2012-08-30 02:17:05 -0400] makerbreaker: ya, the knife.rb in the first gist, didnt have brackets
[2012-08-30 02:17:10 -0400] makerbreaker: s'all good
[2012-08-30 02:17:32 -0400] makerbreaker: ty
[2012-08-30 02:27:00 -0400] tspencer: Ah, I'm back, thanks for the answers!  However, what I'm looking for is something that can dynamically apply cookbooks/recipes to hosts without me having to do anything.
[2012-08-30 02:27:27 -0400] tspencer:  Like if I were to spin up 100 new AWS nodes, I'd like those nodes to start getting configured without me having to add them to a role.
[2012-08-30 02:29:01 -0400] yfeldblum: tspencer, why?
[2012-08-30 02:29:22 -0400] yfeldblum: tspencer, why not just do the same thing, but add "role[base]" to all the run-lists?
[2012-08-30 02:30:29 -0400] tspencer: Because it involves me having to actively do something.  :-)  I'd much rather nodes figure out what they are supposed to do and then just do it.
[2012-08-30 02:33:05 -0400] tspencer: I guess I could set up a couple more workstation hosts besides my laptop and run a cron job that does that.  That just seems so...  baroque.
[2012-08-30 02:35:24 -0400] tspencer: Perhaps I'm just not getting something.  I've done this with cfengine in the past.  It was easy to put in stuff there that said "if you have this attribute, then make sure that XYZ is the way it's supposed to be".
[2012-08-30 02:35:36 -0400] tspencer: I guess I assumed that it would be easy to do that with chef as well.
[2012-08-30 02:38:41 -0400] makerbreaker: oh man
[2012-08-30 02:38:47 -0400] makerbreaker: i just discovered knife ssh
[2012-08-30 02:38:49 -0400] makerbreaker: sick.
[2012-08-30 02:40:03 -0400] zts: tspencer: how are you spinning up the nodes?  Or rather, how are the nodes added to Chef?
[2012-08-30 02:40:47 -0400] tspencer: The nodes are provisioned through RightScale, and the nodes are added to chef by setting up and running chef-client.
[2012-08-30 02:41:41 -0400] zts: tspencer: sorry, I meant what's the mechanism that chef-client is setup and run?  Is it scripted on first boot, "knife bootstrap", etc?
[2012-08-30 02:42:01 -0400] zts: since you're using RightScale, I presume it's fairly automated :)
[2012-08-30 02:42:44 -0400] yfeldblum: makerbreaker, glad i could help!
[2012-08-30 02:43:46 -0400] tspencer: The mechanism is basically, gem install chef; cp $INSTALL_DIR/{validation.pem,client.rb} /etc/chef/ ; set up cron job that runs chef-client every 30 minutes.
[2012-08-30 02:44:58 -0400] zts: tspencer: you could certainly have a recipe which pushes other recipes onto the run_list based on some criteria, but you still have the problem of getting that recipe onto the run_list in the first place
[2012-08-30 02:44:59 -0400] jessicab: tspencer: if you used the knife-ec2 plugin youd just have to add -r "role[base]" to the server create command to add the role when its created
[2012-08-30 02:46:27 -0400] zts: tspencer: I've previously had a scripted first boot which put certain roles in the run_list based on the node's hostname (eg, if the hostname matched "www\d+", put "role[webserver]" on the run_list)
[2012-08-30 02:47:02 -0400] tspencer: zts: How would you do that?  AFAIK, the client can't add stuff to the run_list, can it?
[2012-08-30 02:47:15 -0400] tspencer: To the chef-server run_list, that is.
[2012-08-30 02:48:00 -0400] zts: tspencer: sure it can, let me find an example (unless someone beats me to it)
[2012-08-30 02:48:33 -0400] tspencer: jessicab: We use Rackspace for a lot of our backends, with Rightscale doing the provisioning.  IIRC, those knife plugins did the provisioning directly, no?  If so, that wouldn't fly (yet...  :-)
[2012-08-30 02:49:24 -0400] zts: tspencer: here's the opposite, removing a recipe from the run_list: http://hectcastro.me/2012/03/31/running-chef-recipes-once.html
[2012-08-30 02:49:27 -0400] jessicab: tspencer: ah sorry, misread, knife-rackspace should work the same though.. it also has the -r switch for adding to a run list when you create the server
[2012-08-30 02:49:58 -0400] zts: I think you may have a few more hoops to jump through if you want to add things onto the run list and have them run immediately, but it's easy if you're happy to wait for the next run
[2012-08-30 02:51:03 -0400] zts: tspencer: it's all possible.  Just be aware that you'll be doing things differently to most people, so you may have more work to do it that way
[2012-08-30 02:51:06 -0400] tspencer: I'm ok with some delay, just so long as it's automatic.  I really don't want to have to be running knife all the time to add/remove nodes from roles.  That's just way too tedious.
[2012-08-30 02:51:20 -0400] zts: indeed
[2012-08-30 02:51:23 -0400] zts: but you don't have to use knife
[2012-08-30 02:51:40 -0400] zts: you can also supply json to the initial run of chef_client to set the run_list, and that's the route that I've gone down
[2012-08-30 02:52:43 -0400] tspencer: Hmm.  The client can add/remove stuff from it's run_list?
[2012-08-30 02:53:04 -0400] tspencer: Ah, that's what you are showing at that URL.
[2012-08-30 02:53:10 -0400] tspencer: Well, that could do it.
[2012-08-30 02:54:10 -0400] tspencer: Still seems odd that I can't just make a recipe and somehow tell it to apply itself to all nodes which have an attribute of X.  :-)
[2012-08-30 02:55:12 -0400] zts: Yeah, that doesn't fit the Chef model
[2012-08-30 02:55:34 -0400] zts: You could do that as a one off - use "knife exec" to search for all the nodes that have a particular attribute, and push your recipe onto the run list
[2012-08-30 02:55:43 -0400] tspencer: That's definitely going to make it harder to operate at scale.
[2012-08-30 02:56:02 -0400] zts: I would suggest it means that you need to approach the problem differently
[2012-08-30 02:56:27 -0400] tspencer: Hey, I'm all ears.  :-)  I keep thinking that I must be missing the paradigm here.  :-)
[2012-08-30 02:57:21 -0400] zts: Bear in mind that the chef server is simply a repository of data - it doesn't drive anything itself
[2012-08-30 02:57:53 -0400] jessicab: tspencer: well once you have the base role added to all nodes, itd be easy to write a recipe in it that just checks if platform = centos do this stuff.. doesnt help you much now, but it will be a ton easier once that parts done
[2012-08-30 02:58:04 -0400] tspencer: Right.  I was expecting the chef-client to be able to use the search functionality to find recipes that fit it's particular attributes, and then slurp them down and run them.
[2012-08-30 02:58:36 -0400] zts: Sure, but how would you tell chef-client what those criteria are in the first place? :)
[2012-08-30 02:59:25 -0400] tspencer: Well, it would use all attributes.  :-)  Or download all cookbooks and then search through them for things that applied.  Something.
[2012-08-30 03:00:45 -0400] tspencer: I just don't want to have to be managing roles a couple thousand nodes which are changing all the time myself.
[2012-08-30 03:01:06 -0400] tspencer: s/roles/roles for/
[2012-08-30 03:01:14 -0400] zts: I've got a standup in a few minutes, so sorry if I go quiet
[2012-08-30 03:01:25 -0400] tspencer: np. You've been a great help!
[2012-08-30 03:01:29 -0400] zts: could you talk a little bit more about your exact scenario?
[2012-08-30 03:01:44 -0400] zts: eg, after a node is commissioned, would its role memberships tend to change?
[2012-08-30 03:02:09 -0400] tspencer: No, but nodes are commissioned and decommissioned quite regularly.
[2012-08-30 03:02:37 -0400] zts: that's not a problem
[2012-08-30 03:02:49 -0400] zts: note that adding a node to a role doesn't involve changing that role at all
[2012-08-30 03:03:03 -0400] tspencer: So if I do this right, I might be relaunching most of my nodes on a weekly basis.
[2012-08-30 03:03:31 -0400] tspencer: This means that every week, I'll have N new nodes to deal with.
[2012-08-30 03:03:51 -0400] tspencer: Where N could be a lot of machines.
[2012-08-30 03:04:41 -0400] zts: If you know what the role memberships need to be at instance creation time, it shouldn't be hard to automate that node registration process to do what you want
[2012-08-30 03:05:02 -0400] zts: you'll also need some other process to delete defunct nodes+clients from your chef server
[2012-08-30 03:06:30 -0400] zts: Let's run with the idea that you have a recipe which looks at some attributes of the node to decide what other roles/recipes to add - what are the things it would be looking at?
[2012-08-30 03:06:39 -0400] tspencer: Yeah.  If I can get them all into a base role upon startup, I think I can leverage it from there, because I can do what jessicab suggested, keying off of attributes of the host (hostname, environment, etc) to add it to additional roles.
[2012-08-30 03:08:04 -0400] zts: back in 5 mins
[2012-08-30 03:08:05 -0400] jessicab: tspencer: its pretty easy to add to a run list when you create a node, you could just send it the json with the run_list in it for example.. with the chef-client -j path_to_json command
[2012-08-30 03:09:33 -0400] jessicab: tspencer: the json is just as simple as something like this for that too - { "run_list":[ "role[base]" ] }
[2012-08-30 03:10:12 -0400] tspencer: Perfect!  Thanks!  I saw the -j option a ways back, but hadn't looked at it too hard.
[2012-08-30 03:11:10 -0400] tspencer: I think that's enough to get me going.  It still boggles my mind that there's no way to make all hosts of type X do recipe Y right out of the box, but this will do.  :-)
[2012-08-30 03:40:23 -0400] meisen: Does anyone actually hang out in the kitchen at 8:40pm PST?
[2012-08-30 03:43:43 -0400] hoover_damm: sometimes
[2012-08-30 03:44:20 -0400] meisen: ... seems pretty quiet!
[2012-08-30 03:47:50 -0400] hoover_damm: only for the moment
[2012-08-30 04:04:28 -0400] yfeldblum: jessicab, or: --run-list "role[base]"
[2012-08-30 04:05:09 -0400] yfeldblum: meisen, chef's gone; kitchen's serving hot dogs, nachos, and wings
[2012-08-30 04:05:47 -0400] jessicab: yfeldblum: hm.. its late, but i could of sworn -j was the only good way to do it with chef-client.. he wasnt using a knife plugin
[2012-08-30 04:07:03 -0400] hoover_damm: -j really is
[2012-08-30 04:07:11 -0400] hoover_damm: but also remember -j overwrites your node with what -j has
[2012-08-30 04:07:24 -0400] hoover_damm: new node, to modify the runlist it won't matter
[2012-08-30 04:08:20 -0400] jessicab: yea.. -o does that right now too, but i think i saw that was a bug somewhere
[2012-08-30 04:11:32 -0400] yfeldblum: jessicab, ah yes that's true with chef-client
[2012-08-30 05:30:44 -0400] Loof: Anyone know of a smart way to deal with bootstrapping a server that already has a client.pem in place (from the snapshot/old server)?
[2012-08-30 05:31:23 -0400] Loof: The issue is... if I delete it on bootstrap... things work, but if I have to re-run bootstrap it dies saying that I'm not permitted to sign up the same client
[2012-08-30 05:31:51 -0400] Loof: If I don't delete it... bootstrap doesn't create the client entry and thus bootstrap fails
[2012-08-30 05:35:52 -0400] yfeldblum: Loof, you can clear out the old data in the chef server with `knife client delete NAME ; knife node delete NAME`
[2012-08-30 05:38:37 -0400] Loof: yfeldblum: I can... what I'm trying to do is be able to create an ec2 instance and bootstrap it cleanly
[2012-08-30 05:38:50 -0400] Loof: Delete works... but it's not smart
[2012-08-30 05:38:59 -0400] Loof: I'd really like to delete only if the client doesn't exist
[2012-08-30 05:44:00 -0400] yfeldblum: Loof, you can certainly script it in ruby much more cleanly
[2012-08-30 05:45:53 -0400] yfeldblum: Loof, or you can catch the stdout and grep for the expected error message resulting from attempting to delete a client or node that isn't present on the server (knife does a DELETE but the server gives a 404)
[2012-08-30 05:55:48 -0400] Loof: yfeldblum: Maybe I should add a new bootstrap context for client_exists and node_exists
[2012-08-30 05:56:11 -0400] Loof: I guess you really shouldn't be bootstrapping an already bootstrapped server most of the time
[2012-08-30 05:56:40 -0400] yfeldblum: Loof, not sure what you mean by that, but IMO you *should* be able to rebootstrap a server because it *is* needed from time to time
[2012-08-30 05:56:56 -0400] yfeldblum: Loof, not nearly as often as another chef-client run, to be sure, but from time to time
[2012-08-30 06:01:12 -0400] Loof: yfeldblum: Then 'lib/chef/knife/core/boostrap_context.rb' really should have an entry for client & node exists
[2012-08-30 06:01:27 -0400] Loof: that way the template can do the right thing if we're already set up
[2012-08-30 06:03:29 -0400] yfeldblum: Loof, at any rate, i think all administration should be done via knife or a knife-like app, but not via bootstrap
[2012-08-30 06:04:12 -0400] Loof: yfeldblum: Hmm, 'knife' but not 'knife bootstrap'? Eh?
[2012-08-30 06:06:06 -0400] Loof: I'm not sure what you mean... but it's rather late for me, so maybe best to deal with it tomorrow
[2012-08-30 06:06:53 -0400] Loof: Basically my overall issue is that I set up an instance... get it tested... then snapshot it and create an AMI
[2012-08-30 06:07:27 -0400] Loof: that's used to start the new prod servers... chef is used to make sure that all of the configurations are right for the environment
[2012-08-30 06:07:59 -0400] yfeldblum: Loof, `knife bootstrap` runs on your workstation and prepares a bootstrap script, which it SCP's to the server and triggers
[2012-08-30 06:08:20 -0400] Loof: Yep, I realize that
[2012-08-30 06:08:36 -0400] Loof: This is part of 'knife ec2 create'
[2012-08-30 06:08:45 -0400] Loof: it create a new instance... and then bootstraps it
[2012-08-30 06:09:05 -0400] yfeldblum: Loof, so `knife bootstrap` might take a flag on the command line to determine whether to reuse the existing node/client or whether to delete & recreate them, but that aspect of it should be done on the workstation before the bootstrap script is triggered on the server, rather than being done in the bootstrap script on the server
[2012-08-30 06:09:07 -0400] Loof: which is useful... because this new instance is a new client+node
[2012-08-30 06:09:45 -0400] Loof: Exactly... and I erased the client.pem using a custom boostrap template
[2012-08-30 06:10:23 -0400] Loof: So, if we were to have a way to be 'smart' about it... passing into the context of that template if the client exists on the chef server, or not... for instance
[2012-08-30 06:10:30 -0400] Loof: then I could delete it only if the client is unknown
[2012-08-30 06:10:40 -0400] Loof: But... maybe there's a smarter way to handle all of this
[2012-08-30 06:10:47 -0400] Loof: I'm wondering if the client has to be unique
[2012-08-30 06:10:51 -0400] Loof: node obviously has to be
[2012-08-30 06:10:59 -0400] Loof: but why couldn't all stage servers use the same client?
[2012-08-30 06:22:17 -0400] yfeldblum: Loof, technically, because some parts of the chef code assume node-name == client-name; philosophically, because two users don't share the same account or the same password
[2012-08-30 07:25:19 -0400] riccardotacconi: Hi I am getting this error
[2012-08-30 07:25:19 -0400] riccardotacconi: ERROR: Fog::Compute::AWS::NotFound: The key pair '/Users/riccardotacconi/.ssh/mykey.pem' does not exist
[2012-08-30 07:25:51 -0400] riccardotacconi: when running
[2012-08-30 07:25:51 -0400] riccardotacconi: knife ec2 server create -G default -I ami-7000f019 -f m1.small -S mykey -i ~/.ssh/mykey.pem -x ubuntu -d ubuntu10.04-gems-qs -r 'role[base]' -c ./config/knife.rb
[2012-08-30 07:26:07 -0400] riccardotacconi: the key exists
[2012-08-30 07:59:05 -0400] williamherry: cookbook mysql fail on centos, when run mysql -uroot -p'sss' << /etc/mysql_grants.sql
[2012-08-30 07:59:46 -0400] flaccid_: dang
[2012-08-30 08:53:10 -0400] vladi: Hi , I've just  started to work with chef  and recipies .How to define in recipe a  Linux server should be rebooted ?
[2012-08-30 09:38:51 -0400] ukandrewtaylor: Hi, I'm new to Chef and Ruby and I'm having some problems understanding order of execution. My specific issue is currently with https://github.com/fnichol/chef-rvm_passenger/blob/master/recipes/apache2.rb - The ruby block on line 35 executes after the apache_module lwrp on 73. I think this is because of how the run list is built. Anyone able to help me figure it out
[2012-08-30 09:40:35 -0400] vladi_: I've just  started to work with  chef reciies . How to define in the one server's reboot  action ?
[2012-08-30 09:42:56 -0400] jerem`: i'm looking to replace value by a variable in a file using sed in bash resource. Is it possible ?
[2012-08-30 09:43:17 -0400] ukandrewtaylor: jerem`: yes but it's a hack!
[2012-08-30 09:43:27 -0400] ukandrewtaylor: jerem`: let me see if i can find the code
[2012-08-30 09:44:43 -0400] ukandrewtaylor: http://pastebin.com/s6Aa6NmB
[2012-08-30 09:44:48 -0400] ukandrewtaylor: jerem`: ^
[2012-08-30 09:44:59 -0400] jerem`: here is my try
[2012-08-30 09:45:00 -0400] jerem`: http://ziirish.info/y/rBdgu
[2012-08-30 09:45:56 -0400] ukandrewtaylor: in my example node[:util][:sed_replace_string] would contain s/search/replace/g for example
[2012-08-30 09:47:12 -0400] jerem`: thanks i gonna try it
[2012-08-30 09:49:10 -0400] ukandrewtaylor: :)
[2012-08-30 09:51:46 -0400] ringods: I just upgraded my chef server by updating the gems and restarting the services. After that, any registration of new nodes/clients fails using the chef-validator credentials.
[2012-08-30 09:52:20 -0400] ringods: I already tried regenerating the keys for chef-validator, but to no avail. Anyone knows how to get out of this situation?
[2012-08-30 09:52:51 -0400] ukandrewtaylor: ringods: is the date time set correctly? What error do you get?
[2012-08-30 09:53:54 -0400] ringods: ukandrewtaylor: all my existing clients still work fine. there is no clock drift. Error I get is "Authentication failed". Same error in the logs on server side.
[2012-08-30 09:57:36 -0400] ukandrewtaylor: ringods: how are you bootstrapping the new nodes? with knife?
[2012-08-30 09:58:31 -0400] ringods: nothing different from the past days. I'm using vagrant to test my adapted cookbooks before taking them into produciton. The only thing different is that I upgraded Chef on the server and on my existing nodes this morning.
[2012-08-30 09:59:11 -0400] ringods: the existing setup (nodes+server) still behave as expected. Only registering new clients via chef-validator doesn't seem to work anymore.
[2012-08-30 09:59:32 -0400] ringods: using knife agains the server with *my* credentials works fine...
[2012-08-30 10:00:59 -0400] ringods: After a few times getting the authentication failure, I noticed in the chef web ui that the chef-validator is not an admin. However, making chef-validator an admin didn't resolve my problem
[2012-08-30 10:04:51 -0400] riccardotacconi: when I try to register a chef-client it does not create client.pem
[2012-08-30 10:05:15 -0400] riccardotacconi: in the management console I see the client and its public key
[2012-08-30 10:09:35 -0400] jerem`: using this code I get an "TypeError : Can't convert string into interger" :
[2012-08-30 10:09:35 -0400] jerem`: gserver = search(:node, "(role:cfm-server OR roles:cfm-server)") gserver = gserver['ipaddress']
[2012-08-30 10:14:23 -0400] jerem`: ok pb solved
[2012-08-30 10:17:23 -0400] jimcrofty: I folks, I'm bootstrapping Linux nodes. One of the recipes renames the node (joining it to an AD domain). This works fine but as the node is renamed subsequent chef-client runs fail. Any ideas on the best way to approach fixing this?
[2012-08-30 10:17:49 -0400] ringods: jimcrofty: fix your node name in client.rb
[2012-08-30 10:19:51 -0400] jimcrofty: ringods: thanks! no coffee yet this morning... pretty sure the chef-client cookbook can do this.
[2012-08-30 10:25:57 -0400] riccardotacconi: when I run knife ec2 server create
[2012-08-30 10:26:06 -0400] riccardotacconi: I get ERROR: Fog::Compute::AWS::NotFound: The key pair 'mykey.pem' does not exist
[2012-08-30 10:26:08 -0400] riccardotacconi: always
[2012-08-30 10:26:13 -0400] riccardotacconi: any idea why
[2012-08-30 10:26:52 -0400] riccardotacconi: any help?
[2012-08-30 10:28:11 -0400] riccardotacconi: ?
[2012-08-30 10:34:47 -0400] riccardotacconi: where can I find some help?
[2012-08-30 11:42:34 -0400] ringods: still struggling with chef-validator authentication. Anyone out here with any knowledge on this?
[2012-08-30 11:46:15 -0400] _rc: ringods: it's better if you just ask the question
[2012-08-30 11:48:10 -0400] ringods: _rc: I have an existing setup with chef server and a set of nodes under chef control. Everything worked flawlessly. This morning, I upgraded all systems (nodes + chef server) to Chef 10.12.0 by updating the gems and restarting the processes. From then on, every access that requires chef-validator fails.
[2012-08-30 11:48:39 -0400] ringods: All the existing nodes connect without problem. Knife access using personal credentials also work perfectly. Only chef-validator....
[2012-08-30 11:49:34 -0400] _rc: And what error message, a 401?
[2012-08-30 11:50:28 -0400] ringods: yep, 401
[2012-08-30 11:50:28 -0400] _rc: upgrading shouldn't have invalidated your authenticator cert
[2012-08-30 11:51:02 -0400] _rc: so you can verify it is an the autheticator cert the server trusts
[2012-08-30 11:51:07 -0400] _rc: or generate a new one
[2012-08-30 11:52:03 -0400] ringods: _rc: because I had the authentication errors, I also tried regenerating the keys for chef-validator and saved the private key part in validation.pem. Still nothing
[2012-08-30 11:52:33 -0400] _rc: ringods: is that cert an admin cert?
[2012-08-30 11:52:53 -0400] ringods: _rc: then I noticed in the webui that chef-validator was not an admin which made me enable chef-validator as an admin. Still nothing
[2012-08-30 11:53:28 -0400] ringods: _rc: which btw I found weird. chef-validator worked perfectly before the chef upgrade
[2012-08-30 11:57:05 -0400] _rc: I agree, sounds weird
[2012-08-30 12:00:51 -0400] ringods: _rc: but no further ideas or suggestions?
[2012-08-30 12:01:00 -0400] maruq: hey cheffers
[2012-08-30 12:01:44 -0400] maruq: lazy web: is there a cookbook that deals with formatting devices (Ubuntu)?
[2012-08-30 12:02:13 -0400] _rc: ringods: no, but I don't claim any expertise at this, I was hoping someone smarter would jhump in once you started asking
[2012-08-30 12:04:54 -0400] maruq: eg. a mkfs cookbook
[2012-08-30 12:33:22 -0400] niklasswe: hello,  I running this knife bootstrap -d centos6-rbel IP and it installing everything.. but after I get this error messages..
[2012-08-30 12:33:28 -0400] niklasswe: INFO: Client key /etc/chef/client.pem is not present - registering
[2012-08-30 12:34:02 -0400] ashb: niklasswe: that's an INFO nor an ERROR
[2012-08-30 12:35:59 -0400] luckysideburn: hi guys!
[2012-08-30 12:36:16 -0400] niklasswe: ashb: I also got this.. FATAL: Net::HTTPServerException: 401 "Unauthorized", and shouldnt bootstrap copy the client.pem to the target?
[2012-08-30 12:36:48 -0400] luckysideburn: I'm writing a recipe, and i need to copy id_rsa.pub and id_rsa on /home/fooman/.ssh/  .. could you please suggest me the best way for do this?
[2012-08-30 12:39:37 -0400] jwitrick: bootstrap will configure client.pem. Part of the bootstrap process involves the validation.pem file (or what ever validator client you choose).
[2012-08-30 12:39:40 -0400] ringods: nikklaswe: join the club. This morning, I upgraded my Chef server to 10.12.0 and since then have the same problem
[2012-08-30 12:40:11 -0400] ashb: is your /etc/chef/validation.pem right?
[2012-08-30 12:40:12 -0400] jwitrick: I have had issues in the past after upgrading where couchdb, and/or rabbitmq fail to run successfully.
[2012-08-30 12:40:17 -0400] ashb: are the times between server and client close?
[2012-08-30 12:41:01 -0400] jwitrick: make sure both couchdb and rabbitmq are running. If either of those are not running you will not be able to access the server using the api.
[2012-08-30 12:41:38 -0400] ringods: jwitrick: in my case all clients *except* chef-validator work correctly
[2012-08-30 12:43:45 -0400] niklasswe: ashb: yeah the /etc/chef/validation.pem (on server) and on the client are the same
[2012-08-30 12:43:51 -0400] niklasswe: and the clock are in sync.
[2012-08-30 12:44:32 -0400] wonko_be: hey all - what is the way to go to "test" cookbooks? I'm looking for something that runs from a CI server, and will run cucumber features/scenario's in vagrant-instances that are created and teared down on the fly
[2012-08-30 12:45:01 -0400] niklasswe: ashb: ashb but it looks like it hasnt create the "client" when I running knife client list I cant find the new client I trying to bootstrap
[2012-08-30 12:45:08 -0400] wonko_be: i've looked at a couple of things, and tried some stuff myself, but I can't shake the feeling that "somebody must have done this before"
[2012-08-30 12:45:18 -0400] ashb: niklasswe: well yes with that error I'd be surprised if it hat
[2012-08-30 12:50:20 -0400] maruq: wonko_be: there's a few things there ChefCucumber, Chefspec, RspecChef
[2012-08-30 12:50:39 -0400] maruq: wonko_be: Opscode also released test-kitchen recently: https://github.com/opscode/test-kitchen
[2012-08-30 12:51:14 -0400] maruq: wonko_be: I don't know if there's really a consensus yet I'd so go with whatever works for you
[2012-08-30 12:57:54 -0400] wonko_be: I'll check out test-kitchen - seems to be most along the lines I'm looking for
[2012-08-30 12:58:55 -0400] ringods: wonko_be: and google the Vagrant group. There is some vagrant action on tear-down to remove the Vagrant client and node
[2012-08-30 12:59:18 -0400] ringods: wonko_be: and succes on Oct 14 with the elections. :-)
[2012-08-30 13:01:23 -0400] wonko_be: to bad test-kitches seems to focus on single cookbooks - I need a "bigger" perspective: some hosts, a couple of roles applied, see if a single webbpage comes through the complete stack
[2012-08-30 13:13:17 -0400] ringods: wonko_be: you already found the multi-vm vagrant setup right?
[2012-08-30 13:15:33 -0400] wonko_be: ringods: i still need to look at the details
[2012-08-30 13:16:15 -0400] maruq: ringods: multi-vm vagrant stuff? can't you just do that in the vagrant file?
[2012-08-30 13:16:40 -0400] ringods: wonko_be, maruq: http://jtimberman.housepub.org/blog/2012/03/18/multivm-vagrantfile-for-chef/
[2012-08-30 13:17:50 -0400] ringods: maruq: yes, you can do that in a single vagrant file, but you would be surprised how few people read *all* the vagrant documentation. :-)
[2012-08-30 13:18:14 -0400] wonko_be: ringods: yeah, running multiple vagrants from a single file isn't the problem
[2012-08-30 13:18:20 -0400] maruq: ringods: yeah, I was going to say it was right there in the docs!
[2012-08-30 13:18:41 -0400] wonko_be: I even hacked something togehter with vagrant, sahara and cucumber this morning which kind of starts off what I want
[2012-08-30 13:18:45 -0400] maruq: ringods: using it + chef to create developer envs that are the same as the servers ;)
[2012-08-30 13:18:58 -0400] wonko_be: but I had the feeling "I'm not the first one trying this"
[2012-08-30 13:20:03 -0400] wonko_be: starting a vagrant, snapshotting it, applying some recipes, doings some assertions, rolling back and starting the next scenario
[2012-08-30 13:20:09 -0400] wonko_be: etc...
[2012-08-30 13:21:23 -0400] wonko_be: all the rspec based stuff is to complicated in terms of writing tests, and my fellow sysadmins will spend to much time trying to write the correct test ... gheskin would be the way to go I think
[2012-08-30 13:25:07 -0400] yfeldblum: wonko_be, you know that you can have helper methods in rspec that serve exactly the same purpose as step definitions in cucumber
[2012-08-30 13:25:37 -0400] wonko_be: yfeldblum: nope, I'm no rspec specialist
[2012-08-30 13:26:00 -0400] wonko_be: if you have some first pointer to start from, a basic example somewhere,... feel free to share
[2012-08-30 13:26:52 -0400] wonko_be: I was looking along the paths of cuken/aruba/cucumber-nagios to get a basic language assembled to do common assertions
[2012-08-30 13:27:19 -0400] yfeldblum: wonko_be, uh ... write a module with some methods (the conventional place to put it is in spec/support), include the module in the spec (describe ABCD do ; include MyModule ; it "should xyz" ...) and use the methods
[2012-08-30 13:28:32 -0400] yfeldblum: wonko_be, of course i have an example :D ... https://github.com/applicationsonline/librarian/blob/master/spec/functional/chef/cli_spec.rb and https://github.com/applicationsonline/librarian/blob/master/spec/support/cli_macro.rb
[2012-08-30 13:29:07 -0400] yfeldblum: wonko_be, defining a method in a module: https://github.com/applicationsonline/librarian/blob/master/spec/support/cli_macro.rb#L84-88
[2012-08-30 13:29:23 -0400] yfeldblum: wonko_be, including the module in a spec: https://github.com/applicationsonline/librarian/blob/master/spec/functional/chef/cli_spec.rb#L3-10
[2012-08-30 13:29:40 -0400] yfeldblum: wonko_be, using the method in a spec: https://github.com/applicationsonline/librarian/blob/master/spec/functional/chef/cli_spec.rb#L37-44
[2012-08-30 13:30:36 -0400] yfeldblum: wonko_be, hope that all helps
[2012-08-30 13:30:40 -0400] wonko_be: yfeldblum: thx
[2012-08-30 13:31:11 -0400] yfeldblum: wonko_be, after all, It's Just Ruby
[2012-08-30 13:31:16 -0400] wonko_be: yeah
[2012-08-30 13:32:07 -0400] wonko_be: but knowing that some of my fellow sysadmins have already some issues producing good cookbooks/recipes, due to the fact that they aren't really programmers, but sysadmins, I believe that gheskin is much more suited to have them write tests, than rspec's
[2012-08-30 13:33:32 -0400] makerbreakr: if I have a chef recipe that installs postgres, and sets the postgres password
[2012-08-30 13:33:38 -0400] makerbreakr: how would you actually get that password?
[2012-08-30 13:33:46 -0400] yfeldblum: wonko_be, gherkin*
[2012-08-30 13:33:48 -0400] makerbreakr: in a safe manner.
[2012-08-30 13:34:13 -0400] wonko_be: yfeldblum: indeed, i tried to sound smart, I keep refering to it as "the cucumber language"
[2012-08-30 13:34:35 -0400] wonko_be: but that would have made me look stupid amongst trained ruby/chef people :S
[2012-08-30 13:35:00 -0400] jmartin: makerbreakr: is the postgres password predefined in a databag or something?
[2012-08-30 13:35:20 -0400] yfeldblum: wonko_be, i don't think gherkin is either intended or useful for people who have trouble writing software ... the useful things here could be practice and feedback
[2012-08-30 13:35:31 -0400] makerbreakr: jmartin, i was thinking of randomly generating it
[2012-08-30 13:35:58 -0400] makerbreakr: I have a rails app, that spins up a server on rackspace, based on a custom image
[2012-08-30 13:36:14 -0400] yfeldblum: makerbreaker, save it to the node; save it to a file with 0400 owned by root, etc
[2012-08-30 13:36:21 -0400] makerbreakr: that image has chef-client and runs on boot
[2012-08-30 13:37:13 -0400] makerbreakr: i need to get that password to a remote user though
[2012-08-30 13:37:16 -0400] wonko_be: yfeldblum: that would be the ideal situation, but we don't have the time, and the testing should be as easy as possible for a newbie, so they don't have an excuse to do it
[2012-08-30 13:37:19 -0400] yfeldblum: wonko_be, they *will* need to write step definitions anyway, and lots of them; all cucumber does is put a non-useful abstraction in their way
[2012-08-30 13:37:24 -0400] wonko_be: *to not do it
[2012-08-30 13:37:49 -0400] wonko_be: yfeldblum: the intention is to have most of the steps already layed out for them (cuken, aruba, ...)
[2012-08-30 13:38:02 -0400] wonko_be: and the setting up and tearing down vagrant instances
[2012-08-30 13:38:05 -0400] makerbreakr: ok, I think what ill do is send the user a link ones the VM spins up, to set their postgres password, and then call the CHEF api from the rails app
[2012-08-30 13:38:20 -0400] makerbreakr: does that make sense?
[2012-08-30 13:38:34 -0400] yfeldblum: wonko_be, and all of that is also easier done in Just Plain Ruby
[2012-08-30 13:39:06 -0400] wonko_be: yfeldblum: ... if you know ruby well. And exactly there lies the problem
[2012-08-30 13:40:00 -0400] jmartin: wonko_be: at some point they will have to learn SOMETHING
[2012-08-30 13:40:23 -0400] wonko_be: they will, but I want them to invest their time first in writing sane and good recipes
[2012-08-30 13:41:05 -0400] yfeldblum: wonko_be, you don't have to be a ruby expert to write this - https://github.com/applicationsonline/librarian/blob/master/spec/functional/chef/cli_spec.rb#L36-60
[2012-08-30 13:41:47 -0400] maruq_: actually, random question - can anyone speak to how erchef will change things?
[2012-08-30 13:42:05 -0400] yfeldblum: wonko_be, given a few examples and a little bit of docs on the methods available (such as cli!, write_file!, pwd, and have_file)
[2012-08-30 13:42:26 -0400] maruq_: It's just the server internals changing, right? everything will still be json over http(s) ?
[2012-08-30 13:42:32 -0400] yfeldblum: maruq_, yes
[2012-08-30 13:42:42 -0400] maruq: clients will still speak ruby, so no need to change cookbooks
[2012-08-30 13:42:51 -0400] yfeldblum: maruq, that's right
[2012-08-30 13:43:26 -0400] maruq: yfeldblum: so end result = faster, less memory, more stable, but still compatible with ruby clients
[2012-08-30 13:43:46 -0400] wonko_be: nope, but you have to be a moron not to be able to write something like this http://pastie.org/4616432, which doesn't give them the excuse not to write the test "as they don't understand it", or "it is to hard"
[2012-08-30 13:43:48 -0400] maruq: I guess you'll need chef 11, but that's normal past major versions couldn't speak
[2012-08-30 13:44:04 -0400] maruq: well, it wasn't really recommended
[2012-08-30 13:44:27 -0400] wonko_be: yfeldblum: you don't have to convince me that my life would be better if all my fellow sysadmins would be highly skilled ruby developers
[2012-08-30 13:44:46 -0400] wonko_be: i just want to make sure they don't have excuses not to do it
[2012-08-30 13:45:10 -0400] wonko_be: and yes, more trained people will write new step definitions and extra tests
[2012-08-30 13:45:49 -0400] wonko_be: but that is all a bit out of the scope - I was looking for some existing CI-for-chef-cookbooks
[2012-08-30 13:48:59 -0400] yfeldblum: wonko_be, http://pastie.org/private/cfee81yn8bynfxruir6t5g
[2012-08-30 13:52:57 -0400] wonko_be: yfeldblum: i know how it can look, you don't have to convince me
[2012-08-30 13:53:39 -0400] wonko_be: it even doesn't matter what I will eventually use, I just wanted to know if somebody did this + vagrant + CI
[2012-08-30 14:00:12 -0400] geekbri: brightcove gave a talk at the last chef-boston meetup about how they use vagrant and minitest handler with their CI environment
[2012-08-30 14:00:36 -0400] geekbri: there are actually 2 food fight podcasts about it as well, let me see if i can dig them up
[2012-08-30 14:00:47 -0400] wonko_be: geekbri: ah, would be nice
[2012-08-30 14:01:15 -0400] geekbri: looks like they haven't posted the slideshow for it yet :).
[2012-08-30 14:01:27 -0400] geekbri: If you are in the boston area it looks like the september meetup is going to be about CI with chef :)
[2012-08-30 14:01:41 -0400] geekbri: wonko_be: also, check out the newly released test-kitchen
[2012-08-30 14:02:40 -0400] wonko_be: geekbri: europe here ...
[2012-08-30 14:02:53 -0400] geekbri: ahh yes, that would be a bit of a schelp :)
[2012-08-30 14:02:56 -0400] geekbri: schlep
[2012-08-30 14:03:12 -0400] jmartin: geekbri: im totally new to chef, im wondering what you would consider a 'full stack' environment to include, chef-server, git repo, and test kitchen?
[2012-08-30 14:03:19 -0400] jmartin: test-kitchen*
[2012-08-30 14:03:46 -0400] geekbri: well full stack environment for CI?
[2012-08-30 14:04:03 -0400] jmartin: geekbri: just a general deployment
[2012-08-30 14:04:53 -0400] jmartin: right now ive just been testing in a somewhat hodgepodge environment and id like to clean up and deploy something where in "most" cases im not gonna kick myself for not having set it up, i.e. the server, source control, and a test bed
[2012-08-30 14:05:29 -0400] jmartin: and do automatic foodcritic on recipe updates etc
[2012-08-30 14:06:13 -0400] Jay_Levitt: There's something I'm missing about node names and knife ssh; why doesn't it find my bastion node here? https://gist.github.com/295b6e59b552c89e77bc
[2012-08-30 14:06:38 -0400] jmartin: Jay_Levitt: try adding -a ipaddress to that
[2012-08-30 14:06:43 -0400] geekbri: well that question really depends a lot on what the companies stack looks like.  For the operational side of stuff ideally when somebody pushes to a certain branch you'd spin up a chef server, populate it with all the roles, databags, cookbooks etc, run all the tests, then spin it down
[2012-08-30 14:07:05 -0400] Jay_Levitt: jmartin: ah, that worked.. but why?
[2012-08-30 14:07:27 -0400] jmartin: Jay_Levitt: that grabs the ipaddress attribute, im guessing the hostname doesnt resolve?
[2012-08-30 14:07:38 -0400] jmartin: at least locally
[2012-08-30 14:07:49 -0400] Jay_Levitt: jmartin: probably not, it's a VPC host inside EC2.. I guess the error message is just misleading
[2012-08-30 14:07:58 -0400] Jay_Levitt: since it DID return a node from search, it just couldn't connect to it
[2012-08-30 14:09:07 -0400] jmartin: geekbri: that would be fine for me, hardware isnt a problem, so an 'ideal' setup is what im striving for
[2012-08-30 14:14:18 -0400] jmartin: geekbri: would test-kitchen suffice for that final piece?
[2012-08-30 14:14:38 -0400] jmartin: of spin up a server, load it all, run tests, spin down?
[2012-08-30 14:15:37 -0400] geekbri: jmartin: test kitchen is for bringing up isolated test environments with vagrant
[2012-08-30 14:16:09 -0400] geekbri: there are also vagrant base boxes to go along with test-kitchen
[2012-08-30 14:16:20 -0400] maruq: geekbri, jmartin: I so can't wait for test-kitchen + vagrant2
[2012-08-30 14:16:42 -0400] geekbri: I can't wait for when vagrant gets to the point where it can use something beyond virtualbox :)
[2012-08-30 14:16:58 -0400] maruq: geekbri: that's what I was referring to ;)
[2012-08-30 14:17:06 -0400] geekbri: Yeah well I'm not holding my breath on that one.
[2012-08-30 14:17:20 -0400] geekbri: I imagine it'll take a while
[2012-08-30 14:17:32 -0400] maruq: It's probably a while away, but they've started uncoupling the core
[2012-08-30 14:17:42 -0400] jmartin: ill take test-kitchen + openstack or VMware ;)
[2012-08-30 14:17:54 -0400] geekbri: or test-kitchen plus ec2 !
[2012-08-30 14:17:55 -0400] geekbri: wooo!
[2012-08-30 14:18:14 -0400] maruq: geekbri, jmartin: launch ALL the EC2 instances!
[2012-08-30 14:18:28 -0400] geekbri: spend ALL the venture capital!
[2012-08-30 14:18:43 -0400] geekbri: tagged: things not to say in a board meeting
[2012-08-30 14:19:20 -0400] maruq: geekbri: the trick is to spend all the VCs money in ways that sound like it's for "progress"
[2012-08-30 14:21:15 -0400] jmartin: sadly, i get no VC money
[2012-08-30 14:23:12 -0400] maruq: jmartin: how do you party?
[2012-08-30 14:23:42 -0400] jmartin: maruq: party? whats that?
[2012-08-30 14:23:43 -0400] jmartin: hah
[2012-08-30 14:23:44 -0400] maruq: jmartin: actually, making own money is way better if you can get there
[2012-08-30 14:32:28 -0400] j|: mornings.
[2012-08-30 14:32:42 -0400] jmartin: j|: greetings
[2012-08-30 14:33:23 -0400] j|: used to work with a guy who would alwasy start his emails off with "Greeting,"
[2012-08-30 14:33:32 -0400] j|: One, singular greeting.
[2012-08-30 14:33:45 -0400] j|: always made me smirk. :P
[2012-08-30 14:33:58 -0400] jmartin: hah
[2012-08-30 14:34:29 -0400] smcg: multiple greetings are superfluous
[2012-08-30 14:34:58 -0400] jmartin: however, multiple salutations are quite alright
[2012-08-30 14:35:56 -0400] smcg: I prefer to be heralded by at least 4 trumpeteers
[2012-08-30 14:36:03 -0400] smcg: any fewer means they aren't sincere
[2012-08-30 14:36:29 -0400] j|: bugles?
[2012-08-30 14:37:06 -0400] niklasswe: how should fix this problem... http://pastebin.com/7x5PZkfn
[2012-08-30 14:38:37 -0400] smcg: niklasswe: http://wiki.opscode.com/display/chef/Common+Errors
[2012-08-30 14:41:04 -0400] Jay_Levitt: Is there a plugin that teaches "knife ec2 server delete" how to delete by node name, not instance ID?
[2012-08-30 14:42:35 -0400] smcg: so I am still having this problem from yesterday, just trying to run one simple cookbook with chef-solo https://gist.github.com/ca866ff4d6932340695e
[2012-08-30 14:43:57 -0400] smcg: i'm guessing it's a problem with my solo.rb or node.json config files
[2012-08-30 14:44:38 -0400] wonko_be: cookbooks_path = Array(Chef::Config[:cookbook_path]).detect{|e| e =~ /\/cookbooks\/*$/ }
[2012-08-30 14:44:49 -0400] wonko_be: this evaluates to nil
[2012-08-30 14:45:06 -0400] smcg: I am aware
[2012-08-30 14:45:27 -0400] jmartin: right, you need to fix that
[2012-08-30 14:45:41 -0400] wonko_be: 1.9.3-p194 :002 > File.join(nil, "..")
[2012-08-30 14:45:41 -0400] wonko_be: TypeError: can't convert nil into String
[2012-08-30 14:45:45 -0400] jmartin: cookbook path is only /var/chef-solo ?
[2012-08-30 14:45:46 -0400] wonko_be: there you go
[2012-08-30 14:45:54 -0400] smcg: what should it be?
[2012-08-30 14:46:13 -0400] jmartin: it looks to me like you are searching for 'cookbooks' inside the cookbook_path
[2012-08-30 14:46:19 -0400] jmartin: im no rubyist
[2012-08-30 14:46:27 -0400] jmartin: but id try adding /var/chef-solo/cookbooks
[2012-08-30 14:46:30 -0400] jmartin: see if it works?
[2012-08-30 14:46:47 -0400] smcg: I believe I did and it didn't even get as far as before
[2012-08-30 14:48:54 -0400] smcg: well /var/chef-solo/cookbooks directory does not exist
[2012-08-30 14:49:02 -0400] smcg: so pointing it to that seems silly?
[2012-08-30 14:49:09 -0400] smcg: also it downloaded the cookbook to /var/chef-solo
[2012-08-30 14:49:32 -0400] jmartin: right, because thats where you set the cookbook path id assume
[2012-08-30 14:49:46 -0400] jmartin: or did it do that when you had it set to /var/chef-solo/cookbooks ?
[2012-08-30 14:51:02 -0400] smcg: the /var/chef-solo/cookbooks directory never existed
[2012-08-30 14:51:08 -0400] smcg: I did manually create it at some point
[2012-08-30 14:54:45 -0400] smcg: ok, i'm going to just create a fresh vm and try this again
[2012-08-30 14:54:48 -0400] smcg: vms are cheap
[2012-08-30 14:54:59 -0400] geekbri: just like the vodka I drink
[2012-08-30 14:55:24 -0400] jameson2: libraries?
[2012-08-30 14:55:33 -0400] jameson2: ?libraries
[2012-08-30 14:56:44 -0400] maruq: postgresql recipe why you define a "dir" attribute, yet still hardcode the location in your templates? :(
[2012-08-30 14:58:54 -0400] j|: geekbri: Gordon's cheap, or rubbing alcohol cheap?
[2012-08-30 14:59:43 -0400] smcg: in my experience the people who buy cheap vodka are alcoholics or college students, or both. just sayin.
[2012-08-30 15:00:09 -0400] jmartin: in my experience, college student == alcoholic
[2012-08-30 15:01:22 -0400] Jay_Levitt: I have a recipe which does "include_recipe 'postgresql::server'". Its metadata.rb has "depends 'postgresql'" in it.  I've uploaded the cookbook. Yet when bootstrap gets to the include_recipe portion, it complains "CookbookNotFound: Cookbook postgresql not found."
[2012-08-30 15:02:26 -0400] thedeeno1: what strategies are you using to deal with managing 1 configuration file from multilpe recipes?
[2012-08-30 15:02:47 -0400] thedeeno1: or even multiple cookbooks
[2012-08-30 15:03:22 -0400] jmartin: what single configuration file would require multiple recipes/cookbooks?
[2012-08-30 15:06:07 -0400] geekbri: j|: fleishmans baby!
[2012-08-30 15:06:59 -0400] smcg: ok. brand new chef installation, same solo.rb configuration as before, and I get the nil error again
[2012-08-30 15:07:01 -0400] maruq: Jay_Levitt: Is the cookbook explicitly called "postgresql"? I was d/l-ing it via librarian-chef & calling it "postgres", which failed
[2012-08-30 15:07:25 -0400] Jay_Levitt: maruq: yeah, it's definitely "postgresql"
[2012-08-30 15:07:51 -0400] maruq: hmm where are you pulling it from?
[2012-08-30 15:07:59 -0400] Jay_Levitt: maruq: This used to work until I had my role[base] start depending on a role[mini_base] (it's role[base] that has the postgres dependency.. the dependencies seem simple enough but I'm sure I screwed thatup
[2012-08-30 15:08:12 -0400] Jay_Levitt: maruq: cookbook 'postgresql', git: 'https://github.com/patientslikeme/chef-postgresql', ref: '287ad59'
[2012-08-30 15:09:45 -0400] maruq: Jay_Levitt: that seems strange. I'm doing the same with opscode's version (from github) & it works fine
[2012-08-30 15:10:04 -0400] maruq: Jay_Levitt: I can't see any obvious differences in how it's called
[2012-08-30 15:10:37 -0400] Jay_Levitt: maruq: yeah, I've obviously refactored the role wrong - I just can't see how.  Comparing old and new, they look identical.. I'm creating a new instance using my previous chef-repo just to see that it still works
[2012-08-30 15:11:27 -0400] maruq: Jay_Levitt: can you try and upload the cookbook again, just to be sure it's there?
[2012-08-30 15:11:35 -0400] Jay_Levitt: maruq: already did that :(
[2012-08-30 15:11:57 -0400] maruq: Jay_Levitt: does the previous role definition work?
[2012-08-30 15:12:17 -0400] thedeeno1: jmartin: if I have services which need to edit pg_hba.conf for example
[2012-08-30 15:12:22 -0400] Jay_Levitt: maruq: we'll see, it's bootstrapping now.  (I guess I could have reused the instance, oh well)
[2012-08-30 15:12:42 -0400] Jay_Levitt: thedeeno1: I have a fork of postgresql that lets you specify pg_hba.conf entries in node attributes
[2012-08-30 15:12:43 -0400] thedeeno1: for postgresql*
[2012-08-30 15:13:00 -0400] Jay_Levitt: https://github.com/patientslikeme/chef-postgresql
[2012-08-30 15:13:05 -0400] maruq: thedeeno1: I've got a second cookbook called "postgres-hacks" that I use to put my own configs in place
[2012-08-30 15:13:06 -0400] thedeeno1: Jay_Levitt: nice, checking it out...
[2012-08-30 15:13:41 -0400] Jay_Levitt: no docs yet, but check out the bottom of attributes/default.rb and do what it does!
[2012-08-30 15:13:50 -0400] jmartin: maruq: wouldn't it be better to have your recipes modify/create data bags
[2012-08-30 15:13:56 -0400] maruq: Jay_Levitt, thedeeno1: anyone got one that lets you specify the "dir" correctly? opscode one hardcodes things in templates
[2012-08-30 15:14:11 -0400] jmartin: then your postgres recipe would just operate on those bags no matter what
[2012-08-30 15:14:39 -0400] maruq: jmartin: yes, but that I'd need to refactor the postgresql cookbook to enable a lot of that
[2012-08-30 15:14:41 -0400] Jay_Levitt: maruq: I don't see it hardcoding the dir, there's a [:postgresql][:dir] attribute
[2012-08-30 15:15:10 -0400] Jay_Levitt: maruq: and interesting.. my old cookbook and role DO install postgres correcly
[2012-08-30 15:15:37 -0400] jmartin: Jay_Levitt: DIFF!
[2012-08-30 15:15:46 -0400] jmartin: diff all the files
[2012-08-30 15:15:50 -0400] Jay_Levitt: ALL the files!
[2012-08-30 15:15:52 -0400] maruq: Jay_Levitt: templates/default/debian.postgresql.conf.erb hardcodes a lot of stuff to "/var/lib/postgresql/blah"
[2012-08-30 15:16:17 -0400] jmartin: ah
[2012-08-30 15:17:10 -0400] Jay_Levitt: maruq: yeah, you're right.. seems like someone should submit a pull request that defines data_dir and conf_dir instead of just dir :)
[2012-08-30 15:17:44 -0400] maruq: Jay_Levitt: yep, got a few hacks to make when I find some free time
[2012-08-30 15:18:15 -0400] Urocyon: Nice, Jay_Levitt.  I was contemplating how I would handle pg_hba entries.
[2012-08-30 15:18:34 -0400] Jay_Levitt: Urocyon: I'm submitting it as soon as I squash the commits and add some docs
[2012-08-30 15:18:52 -0400] Jay_Levitt: fnichol already has a pull request open (which I based this on) but that version uses an array, and it's hard to get the order of entries you want
[2012-08-30 15:18:59 -0400] Urocyon: I was contemplating making an lwrp for it.
[2012-08-30 15:19:22 -0400] Jay_Levitt: That'd be even nicer, of course :)
[2012-08-30 15:20:46 -0400] Jay_Levitt: OK, so here I am hacking away at my chef-repo and re-uploading roles and cookbooks to try to debug something.  In the real world, I don't want this to affect my production servers.  To do this properly, would I create a new organization? And if so, how do I specify what organization I'm using when I use knife?
[2012-08-30 15:22:50 -0400] Urocyon: Jay_Levitt: i did that at one point, a while back.   Well, a long while back, just before they split up the cookbooks.
[2012-08-30 15:23:08 -0400] Urocyon: Jay_Levitt: if you want to take a look I have it here: https://github.com/sfiggins/cookbooks/tree/COOK-1064/postgresql
[2012-08-30 15:23:25 -0400] Urocyon: I haven't tried folding it into the newer version yet.
[2012-08-30 15:24:21 -0400] Jay_Levitt: Oo, that's nice.. yeah, we should collaborate, I'd really like the postgres config to be All Modularish
[2012-08-30 15:24:25 -0400] Urocyon: Splitting the directories though, meant changes to how things worked currently, like if you were depending on the dir attribute, and so I think they balked at it.
[2012-08-30 15:25:01 -0400] Urocyon: http://tickets.opscode.com/browse/COOK-1064
[2012-08-30 15:25:16 -0400] Jay_Levitt: Well, you could say that if conf_dir and data_dir aren't set, then we'll set conf_dir = dir, and data_dir = the old defaults
[2012-08-30 15:25:20 -0400] Urocyon: I got side tracked at that point.
[2012-08-30 15:25:46 -0400] maruq: Jay_Levitt, Urocyon: I don't see a problem with one "dir" attribute as such, just need it to be honoured ;)
[2012-08-30 15:26:12 -0400] Jay_Levitt: maruq: you wouldn't want your config to move from /etc to /var tho, nor your data to move the other way
[2012-08-30 15:26:44 -0400] maruq: Jay_Levitt: hmm.. I guess kind of true
[2012-08-30 15:26:45 -0400] Jay_Levitt: Urocyon: there was also someone else who did a master/slave version of the cookbook, I didn't bookmark it since I don't need that yet
[2012-08-30 15:26:57 -0400] Urocyon: hoover_damm: I believe.
[2012-08-30 15:27:07 -0400] maruq: Jay_Levitt: I'm more sticking everything on an EBS RAID.
[2012-08-30 15:27:23 -0400] Jay_Levitt: maruq: so you've moved the default .conf files into /var then?
[2012-08-30 15:27:39 -0400] maruq: Jay_Levitt: Got all the fun parts of that going, then broke at postgresql
[2012-08-30 15:27:43 -0400] Urocyon: maruq: I had split the conf directory because I was planning on using a different EBS for data and pg_logs.
[2012-08-30 15:28:16 -0400] maruq: Jay_Levitt: no, I just went with whatever the postgresql cookbook gives you
[2012-08-30 15:28:26 -0400] Jay_Levitt: maruq: ah, then you already have separate data and conf dirs
[2012-08-30 15:28:32 -0400] Jay_Levitt: conf goes in /etc/postgresql, data in /var/lib/something
[2012-08-30 15:28:39 -0400] maruq: Jay_Levitt: I'm experimenting with things now.
[2012-08-30 15:29:06 -0400] maruq: Urocyon: any real reason for splitting things on to separate EBSes?
[2012-08-30 15:29:35 -0400] Urocyon: maruq, performance.
[2012-08-30 15:29:43 -0400] Urocyon: Keep your data and pg_logs separate.
[2012-08-30 15:30:05 -0400] maruq: Urocyon: okay, that makes sense
[2012-08-30 15:30:08 -0400] Urocyon: I didn't get that into the cookbook changes I linked above, but it was my plan to add it.
[2012-08-30 15:30:15 -0400] Jay_Levitt: Performance: solved. (I'm hoping)
[2012-08-30 15:30:33 -0400] Urocyon: I was going to have ephemeral for OS, and then different ebs volumes for my data/logs.
[2012-08-30 15:30:41 -0400] maruq: Urocyon: you could also go provisioned IOPS EBS
[2012-08-30 15:31:02 -0400] Urocyon: maruq: it wasn't an option when I was working on this.
[2012-08-30 15:31:03 -0400] Jay_Levitt: Provisioned IOPS only affects streaming speeds, tho, not small transactions
[2012-08-30 15:31:25 -0400] Urocyon: but: you still might want two iops ebs volumes.
[2012-08-30 15:31:46 -0400] maruq: Urocyon, Jay_Levitt: hmm yeah, makes sense.
[2012-08-30 15:32:12 -0400] maruq: Urocyon, Jay_Levitt: current stuff is only really for internal testing, but probably want that for production
[2012-08-30 15:32:15 -0400] Jay_Levitt: I think provisioned iops + EBS-optimized is "way better" but still nowhere near "hardware".  I'm going to experiment once we actually pul the trigger on the physical box, though
[2012-08-30 15:32:29 -0400] Urocyon: I've heard mixed things about weather or not to raid your ebs volumes but I never got around to really testing it for myself.
[2012-08-30 15:32:45 -0400] Jay_Levitt: I recommend Datapipe, they seem to be the only Equinix reseller that'll lease you single servers at Equinix
[2012-08-30 15:32:59 -0400] Urocyon: Yeah, if you really need throughput, you aren't going to beat arrays of ssds.
[2012-08-30 15:33:28 -0400] Jay_Levitt: (We also need it because we have patient data, and everyone wants to be able to go pet, I mean audit, the database)
[2012-08-30 15:34:09 -0400] thedeeno1: jmartin: was thinking databags too, it's just a little strange that the same databag is available site-wide while these config files really should be specified per node.
[2012-08-30 15:34:23 -0400] maruq: Jay_Levitt: yeah, the petting zoo is always fun
[2012-08-30 15:34:48 -0400] maruq: Jay_Levitt: why is my DB completely locked up? Oh some random just ran a join across every table!
[2012-08-30 15:35:07 -0400] Jay_Levitt: hehe, yep
[2012-08-30 15:35:36 -0400] maruq: Jay_Levitt: that's what read replicas or better yet, generated reports are for
[2012-08-30 15:35:51 -0400] Urocyon: Recently I ended up moving off of the postgresql cookbook and writing my own because I'm working with supporting rhea 6.3, and we want postgresql 9.1.  I couldn't figure out a good way to hack that into the postgresql cookbook..
[2012-08-30 15:36:10 -0400] Jay_Levitt: maruq: no, I mean they want to be able to point auditors at a physical machine in a data center and say 'This is where all patient data is securely stored'
[2012-08-30 15:36:17 -0400] Jay_Levitt: There is still a lot of FUD about data at rest in the cloud.
[2012-08-30 15:36:38 -0400] maruq: Jay_Levitt: oh right. yeah data laws are hell
[2012-08-30 15:36:57 -0400] maruq: Jay_Levitt: I'm in Germany man, do they have data laws!
[2012-08-30 15:37:22 -0400] Jay_Levitt: Actually we're not HIPPA compliant, but we're trying to move in that direction.  And there are some who say HIPPA simply can't be done properly in the cloud, and no inspector should ever approve such a thing (though they do)(
[2012-08-30 15:37:36 -0400] Jay_Levitt: So, easy solution - we get a physical box, we make compliance folks happy, AND we get performance.
[2012-08-30 15:39:04 -0400] maruq: Jay_Levitt: I'm sort of thinking similar things do we go for EU/German compliance, in that all data must be in EU. Or do we go for fault-tolerance & go multi-region
[2012-08-30 15:39:32 -0400] Jay_Levitt: Are there multiple AWS regions in EU?
[2012-08-30 15:39:38 -0400] Jay_Levitt: or at least multi AZ?
[2012-08-30 15:39:53 -0400] maruq: Jay_Levitt: multiple AZ's, only one region
[2012-08-30 15:41:19 -0400] jmara: maruq: If you push data to AWS, even if the data is in the EU it stays under federal US Law isn't it?
[2012-08-30 15:42:15 -0400] rgsteele: How can you specify node_name on the CLI as an argument to knife?  I cannot find documentation for the syntax anywhere, and forgot to write it down the one time I managed to figure i tout.
[2012-08-30 15:42:17 -0400] rgsteele: It was something like "node_name:foo.example.tld", or { "node_name": "foo.example.tld" }, or similar (obviously, those don't work)
[2012-08-30 15:42:21 -0400] maruq: jmara: I don't know enough about data laws to answer. from speaking with them, I believe since it's hosted in EU, it falls under EU laws
[2012-08-30 15:43:35 -0400] kryptek: Jay, Mckesson Pharmacy Systems has a software platform that runs in the cloud
[2012-08-30 15:43:49 -0400] awgross|flashman: Anyone have some good resources for running Chef spec/minitest tests on Jenkins and/or using jenkins to mint version numbers for cookbooks?
[2012-08-30 15:43:51 -0400] kryptek: Not sure about EU specifically, but HIPA compliance isn't a problem there
[2012-08-30 15:45:21 -0400] rgsteele: I just want to test what a node can see with knife, without setting up all the .chef stuff for a user on the box.  I know it works when you provide node_name in the aforementioned quirky json-like syntax as an argument to knife.
[2012-08-30 15:47:51 -0400] maruq: alright, going to head home guys. catch you tomorrow
[2012-08-30 15:48:57 -0400] rgsteele: Oh well, it's taking too much time to figure it out.  Guess I'll just set up knife configs.
[2012-08-30 16:02:21 -0400] Jay_Levitt: kryptek: yeah, it was more a philosophical argument that there's nothing Mckesson could do that *ought to* pass HIPAA, but that auditors are being too lax.
[2012-08-30 16:33:17 -0400] j|: hrm.. knife cookbook site install chef-server gives an interesting error
[2012-08-30 16:33:33 -0400] j|: ERROR: IOError: Cannot open or read /Users/me/chef-dev/cookbooks/gecode/metadata.rb!
[2012-08-30 16:33:52 -0400] j|: try to install gecode cookbook first. same error. :P
[2012-08-30 16:34:17 -0400] j|: disk not full... oy vey.
[2012-08-30 16:35:00 -0400] jmartin: j|: not a semaphore issue either right?
[2012-08-30 16:36:40 -0400] j|: wouldn't know which lockfile to check.
[2012-08-30 16:38:08 -0400] j|: jmartin: which semaphore?
[2012-08-30 16:39:40 -0400] j|: lsof doesn't report any open files in the fir
[2012-08-30 16:39:48 -0400] j|: in the fir or even in the directory
[2012-08-30 16:40:01 -0400] j|: damn directories are growing fur.
[2012-08-30 16:43:22 -0400] j|: any ideas as to why installing a cookbook would complain that it can't read it's own metadata.rb file before its even installed.. ?
[2012-08-30 16:44:22 -0400] j|: hrm, test installing a different cookbook goes okay.
[2012-08-30 16:45:02 -0400] jordane: does the file exist and/or have correct permissions?
[2012-08-30 16:45:09 -0400] j|: doesn't exist.
[2012-08-30 16:45:15 -0400] j|: its what I'm trying to install
[2012-08-30 16:46:20 -0400] j|: meh. maybe I try to just grab the file from github, add it to the cookbooks repo and then try again..
[2012-08-30 16:48:11 -0400] hoover_damm: Jay_Levitt, you get your postgres replication working?
[2012-08-30 16:48:19 -0400] Jay_Levitt: hoover_damm: wasn't trying to!
[2012-08-30 16:48:33 -0400] hoover_damm: Jay_Levitt, ahh okay :)
[2012-08-30 16:48:56 -0400] Jay_Levitt: hoover_damm: I was having some trouble with the postgresql cookbook not being found, I'm wolf-fence-debugging it now...
[2012-08-30 16:49:07 -0400] Jay_Levitt: someoene else mentioned your name about something but I forget what :)
[2012-08-30 16:49:14 -0400] hoover_damm: Jay_Levitt, because I have my own cookbook
[2012-08-30 16:49:29 -0400] Jay_Levitt: hoover_damm: oh, is it your cookbook that's a fork of postgresql with replication included?
[2012-08-30 16:49:34 -0400] hoover_damm: Jay_Levitt, long story short, I used to work for Engine Yard and created many cookbooks there... when I left I rewrote them and open sourced them
[2012-08-30 16:50:04 -0400] Jay_Levitt: hoover_damm: I mentioned that to Urocyon, we were talking about "stuff we'd like to fix in the pg cookbook" in general.
[2012-08-30 16:50:40 -0400] hoover_damm: Jay_Levitt, my postgresql cookbook sets the shared memory to 25% of your memory pool.. and the effective cache size to 80%
[2012-08-30 16:50:53 -0400] hoover_damm: Jay_Levitt, it requires my sysctl cookbook because I haven't used others...
[2012-08-30 16:51:10 -0400] hoover_damm: Jay_Levitt, it supports replication, defaults to having the wal directory separated from the data
[2012-08-30 16:51:20 -0400] hoover_damm: Jay_Levitt, so you can put the data and wal contents on separate disks
[2012-08-30 16:51:20 -0400] Jay_Levitt: hoover_damm: ah, nice.. maybe we should all have a nice hackathon on that cookbook.
[2012-08-30 16:51:24 -0400] hoover_damm: Jay_Levitt, absolutely suggested to do that
[2012-08-30 16:51:25 -0400] Jay_Levitt: I'm not using replication yet
[2012-08-30 16:51:42 -0400] hoover_damm: Jay_Levitt, you should absolutely split up the load of the data and the wal, it's about a 80x boost in performance (no joke)
[2012-08-30 16:51:55 -0400] Jay_Levitt: hoover_damm: really, good to know
[2012-08-30 16:52:00 -0400] hoover_damm: which my cookbook defaults
[2012-08-30 16:52:06 -0400] hoover_damm: https://github.com/damm/postgresql
[2012-08-30 16:52:41 -0400] Jay_Levitt: hoover_damm: With your brains, and my.. suggesting we do stuff... we'll go far together.
[2012-08-30 16:53:29 -0400] hoover_damm: indeed
[2012-08-30 16:53:38 -0400] hoover_damm: Jay_Levitt, basically this is the one issue i'm aware of https://github.com/damm/postgresql/issues/2
[2012-08-30 16:53:42 -0400] hoover_damm: Jay_Levitt, that I need to fix
[2012-08-30 16:54:11 -0400] hoover_damm: I admit I did want to automate replication
[2012-08-30 16:54:17 -0400] hoover_damm: but that's impossible
[2012-08-30 16:54:26 -0400] hoover_damm: you can automate it for x cloud, or y cloud
[2012-08-30 16:54:29 -0400] hoover_damm: but not for everyone
[2012-08-30 16:55:07 -0400] Jay_Levitt: hoover_damm: I think that's ok, I'd just like to see the pg cookbook at a point where everyone doesn't have to fork it just to use it
[2012-08-30 16:55:32 -0400] Jay_Levitt: Maybe we can think about ways to use LWRPs to make replication more configurable
[2012-08-30 16:55:35 -0400] hoover_damm: Jay_Levitt, try mine... I don't install the pg gem...
[2012-08-30 16:55:57 -0400] hoover_damm: Jay_Levitt, feel free to submit pulls, the cookbook is on the community site
[2012-08-30 16:56:03 -0400] Jay_Levitt: hoover_damm: oh, I didn't mean that, I meant the fact that the templates aren't very flexible, and a lot of stuff is hardcoded
[2012-08-30 16:56:05 -0400] hoover_damm: and I have no reason to not keep supporting it there
[2012-08-30 16:56:19 -0400] hoover_damm: Jay_Levitt, heh, that's the problem with CM
[2012-08-30 16:56:21 -0400] hoover_damm: and config files
[2012-08-30 16:56:34 -0400] hoover_damm: Jay_Levitt, we should be using sed more instead of owning the complete config file
[2012-08-30 16:57:12 -0400] hoover_damm: Jay_Levitt, or something better so we don't have to write an erb template of the config file... just have it update it right without that chore of a hour of moving a 8000 line config file into a bunch of <%= @a's %>
[2012-08-30 16:57:13 -0400] Jay_Levitt: Hm, not sure I agree - I think we can own it, turn it into a hash, and move the defaults into attributes
[2012-08-30 16:57:44 -0400] hoover_damm: basically I'd suggest using, if you want to reinvent the wheel feel free i'm just not interested
[2012-08-30 16:57:45 -0400] Jay_Levitt: eg https://github.com/patientslikeme/chef-postgresql/blob/master/templates/default/pg_hba.conf.erb
[2012-08-30 16:57:56 -0400] hoover_damm: hehe
[2012-08-30 16:58:00 -0400] hoover_damm: yeah pg_hba is fun :)
[2012-08-30 17:00:17 -0400] Jay_Levitt: man, I hope erchef means no more "hosted chef hangs at :00 and :30"
[2012-08-30 17:13:53 -0400] hoover_damm: hosted chef has run erlang for quite some time
[2012-08-30 17:15:21 -0400] cassianoleal: anyone using cucumber-chef who knows how to increase the timeout between "cucumber-chef setup" and a successful SSH connection to the test lab?
[2012-08-30 17:15:31 -0400] Jay_Levitt: hoover_damm: well, there go my hopes.
[2012-08-30 17:15:44 -0400] Jay_Levitt: I hope unspecified future thingies mean no more "hosted chef hangs at :00 and :30"
[2012-08-30 17:16:06 -0400] hoover_damm: Jay_Levitt, as I love couchdb and I think it's awesome... I blame mysql
[2012-08-30 17:16:19 -0400] Jay_Levitt: reasonable.
[2012-08-30 17:16:33 -0400] Jay_Levitt: As a postgresql fan, I too blame mysql.
[2012-08-30 17:16:52 -0400] hoover_damm: I learned something stupid... people love relational databases based on coast
[2012-08-30 17:16:56 -0400] hoover_damm: west cost is more mysql centric
[2012-08-30 17:17:00 -0400] hoover_damm: east cost is more postgres centric
[2012-08-30 17:17:04 -0400] Jay_Levitt: Boys II Men, ABC, BBD.
[2012-08-30 17:17:08 -0400] hoover_damm: stupid generalization
[2012-08-30 17:18:57 -0400] cassianoleal: hoover_damm: in Brazil we don't have a west coast  does it mean we all use postgres?
[2012-08-30 17:19:26 -0400] manuel__: hahaha
[2012-08-30 17:19:28 -0400] manuel__: good point
[2012-08-30 17:19:35 -0400] cassianoleal: :)
[2012-08-30 17:23:18 -0400] Jay_Levitt: OK, is there *some* way to get a list of ec2 instance IDs along with node names?
[2012-08-30 17:23:34 -0400] Jay_Levitt: I want to delete a bunch of servers but "knife ec2 server delete" wants instance IDs
[2012-08-30 17:24:00 -0400] Jay_Levitt: knife node list -V doesn't show any details
[2012-08-30 17:25:12 -0400] miah: moin
[2012-08-30 17:25:14 -0400] jameson2: i use a mix of knife ec2 server list + knife node list + knife node show []  to do that
[2012-08-30 17:25:51 -0400] Jay_Levitt: miah: moin?
[2012-08-30 17:26:04 -0400] miah: http://en.wikipedia.org/wiki/Moin
[2012-08-30 17:26:18 -0400] Jay_Levitt: ah, greeting and salutations
[2012-08-30 17:28:07 -0400] Jay_Levitt: jameson2: that'd work.. how do I get deep-nested attributes like ['ec2']['instance_id']?
[2012-08-30 17:29:09 -0400] yfeldblum: Jay_Levitt, you could write a knife plugin to delete an ec2 server by node name ...
[2012-08-30 17:29:34 -0400] Jay_Levitt: yfeldblum: oh, and I will, but not today :) I'm already three 'whys' off my real task
[2012-08-30 17:32:26 -0400] Jay_Levitt: knife node show play1 -a ec2/instance_id
[2012-08-30 17:32:26 -0400] Jay_Levitt: ec2/instance_id:
[2012-08-30 17:33:54 -0400] jameson1: InstanceID= `knife node show play1 | grep Instance | cut -d' ' -f3` ?
[2012-08-30 17:35:00 -0400] Jay_Levitt: jameson1: ah, that'd work with the --long output
[2012-08-30 17:35:52 -0400] rb1980: Hi all... question:  Is there a quick/easy way to pull down the entire hosted chef repo in bulk to a new management host?
[2012-08-30 17:36:29 -0400] jameson1: use a a repo that has a copy of the entire hosted-chef repo
[2012-08-30 17:36:46 -0400] jameson1: (e.g. everything but AWS creds are in a chef-repo in github)
[2012-08-30 17:37:16 -0400] illcomputing: y
[2012-08-30 17:37:30 -0400] jameson1: n
[2012-08-30 17:37:34 -0400] illcomputing: doh
[2012-08-30 17:37:39 -0400] illcomputing: wrong terminal. ;-)
[2012-08-30 17:38:56 -0400] illcomputing: hey, if you guys change a role on one of your nodes, do you edit the node.json file for it and then 'knife node from file node.json' or do you add the role with knife and then 'knife show node blah -Fj > node.json'?
[2012-08-30 17:39:06 -0400] illcomputing: or something completely different?
[2012-08-30 17:39:48 -0400] rb1980: so can you clarify: I have not created a git repo for my chef-repo. are you saying one already exists if I am on hosted chef?
[2012-08-30 17:39:48 -0400] illcomputing: i've found that when I do the 'knife node from file.json' chef temporarily loses the node's ip address and other info..
[2012-08-30 17:40:09 -0400] illcomputing: one already exists for hosted chef
[2012-08-30 17:40:19 -0400] rb1980: ah, cool. how do i find that?
[2012-08-30 17:40:53 -0400] illcomputing: er sorry.. misunderstood
[2012-08-30 17:41:00 -0400] illcomputing: no.. hosted chef hasn't created one for you...
[2012-08-30 17:42:22 -0400] rb1980: ah, ok. so assuming my management station that held my (only) local copy of my repo dies and I need to build a new one... how to download everything from hosted chef to a new local copy
[2012-08-30 17:42:52 -0400] illcomputing: thats interesting...
[2012-08-30 17:42:55 -0400] illcomputing: I don't know if you can
[2012-08-30 17:43:25 -0400] yfeldblum: illcomputing, why are you doing `knife node from file` in the first place?
[2012-08-30 17:43:50 -0400] illcomputing: well, I want to have a local copy of the config for that node...
[2012-08-30 17:44:10 -0400] yfeldblum: illcomputing, you either use `knife node run_list add` and `knife node run_list remove`
[2012-08-30 17:44:23 -0400] yfeldblum: illcomputing, if you want to have a local copy then sure, take backups or whatever
[2012-08-30 17:44:28 -0400] illcomputing: ahh
[2012-08-30 17:44:46 -0400] illcomputing: I guess I wanted a record of the state of things before I changed things...
[2012-08-30 17:44:55 -0400] illcomputing: so I could recreate the state of everything
[2012-08-30 17:45:02 -0400] illcomputing: and it's all version controlled
[2012-08-30 17:45:19 -0400] meisen: Anyone experiencing Hosted Chef connection issues? I am getting connection failures to Hosted Chef all of a sudden
[2012-08-30 17:45:28 -0400] yfeldblum: illcomputing, but doing that with node.json's in git for every node is the wrong tool for the job ...
[2012-08-30 17:45:31 -0400] jameson1: rb1980: ^ you could push the entire repo to github, and pull it to new-management stations
[2012-08-30 17:46:10 -0400] illcomputing: yfeldblum: what's the proper way to do it?
[2012-08-30 17:46:15 -0400] j|: yfeldblum: yea, well that was my bad advice
[2012-08-30 17:46:17 -0400] j|: :)
[2012-08-30 17:46:19 -0400] Jay_Levitt: meisen: I have been getting them intermittently all morning
[2012-08-30 17:46:20 -0400] jameson1: and then all you would have to do is get the client.pem + knife.rb back
[2012-08-30 17:46:21 -0400] yfeldblum: illcomputing, the chef-server is supposed to be the central database with the data in it ... treat it like it's a database
[2012-08-30 17:46:27 -0400] illcomputing: hrmm
[2012-08-30 17:46:36 -0400] yfeldblum: illcomputing, treat knife like it's a CLI tool to interact with the database
[2012-08-30 17:46:41 -0400] j|: yea, but what about infrastructure as code?
[2012-08-30 17:46:55 -0400] meisen: Jay_Levitt: Are you accessing from EC2?
[2012-08-30 17:47:03 -0400] j|: not infrastructure as database.
[2012-08-30 17:47:14 -0400] Jay_Levitt: meisen: from both home and ec2
[2012-08-30 17:47:15 -0400] yfeldblum: j|, "Infra As Code" =/= "15,000 individual nodes' data stored in git"
[2012-08-30 17:47:43 -0400] j|: yfeldblum: why
[2012-08-30 17:48:09 -0400] yfeldblum: j|, because A and B are not the same thing in almost every case where you pull A and B out of a hat
[2012-08-30 17:48:12 -0400] j|: if I change a node I want a record of that happening and if something goes wrong I want to be able to revert it easily
[2012-08-30 17:48:23 -0400] j|: so.. how else can I do that?
[2012-08-30 17:48:44 -0400] j|: yfeldblum: you lost me?
[2012-08-30 17:49:00 -0400] yfeldblum: j|, that's understandable, and there are various ways to do it, but they typically involve writing some extra tools
[2012-08-30 17:50:04 -0400] j|: well I'm open to better ways of doing it, I just haven't put in enough time yet to sniff out the better answers
[2012-08-30 17:50:20 -0400] illcomputing: root
[2012-08-30 17:50:23 -0400] j|: but I don't want 8 admins all 'knife node edit'
[2012-08-30 17:50:29 -0400] illcomputing: fah
[2012-08-30 17:50:36 -0400] hoover_damm: cassianoleal, you have an east side and a west side... it's not the same as America
[2012-08-30 17:50:46 -0400] illcomputing: jl: yes!
[2012-08-30 17:50:51 -0400] hoover_damm: cassianoleal, but i'm sure you could make generalizations based on random statements easily
[2012-08-30 17:51:34 -0400] jtimberman: node data isn't code
[2012-08-30 17:51:37 -0400] leifmadsen: afternoon all, just upgraded to chef 10.14.0.rc.1 on a client for testing, and I'm getting this in my existing minitest specs after a run:  ArgumentError: wrong number of arguments (1 for 2)
[2012-08-30 17:51:42 -0400] yfeldblum: j|, why not? aren't they all admins with the responsibility for maintaining infra?
[2012-08-30 17:51:56 -0400] jtimberman: the main thing you care about for nodes in chef is their run list, not their individual attributes.
[2012-08-30 17:52:00 -0400] yfeldblum: j|, or perhaps some of them aren't admins after all, but are e.g. writing cookbooks
[2012-08-30 17:52:04 -0400] jtimberman: as far as storing anything in version control goes.
[2012-08-30 17:52:09 -0400] j|: yfeldblum: yea, but if something gets screwey how am I going to track it / fix it
[2012-08-30 17:52:11 -0400] Jay_Levitt: hoover_damm: in my experience it's only west coast folk that make sweeping generalizations like that.
[2012-08-30 17:52:25 -0400] hoover_damm: Jay_Levitt, that's not what the east coast says
[2012-08-30 17:52:26 -0400] cassianoleal: hoover_damm: we do have both sides, same as _the rest of_ America, and any other continent for that matter ;)
[2012-08-30 17:52:32 -0400] j|: jtimberman: so, whats the correct way to think of it then?
[2012-08-30 17:52:38 -0400] jtimberman: Jay_Levitt: plenty of people across the country make sweeping generalizations.
[2012-08-30 17:52:41 -0400] jtimberman: look, i just made one :)
[2012-08-30 17:52:42 -0400] hoover_damm: cassianoleal, exactly :)
[2012-08-30 17:52:47 -0400] Jay_Levitt: jtimberman: think harder :)
[2012-08-30 17:52:47 -0400] yfeldblum: j|, the same way you track and fix problems with any other database-backed software?
[2012-08-30 17:53:08 -0400] leifmadsen: verbose output of the error I ran into at: https://gist.github.com/3535371
[2012-08-30 17:53:09 -0400] j|: nodes are just transient and roles + env == the info I need
[2012-08-30 17:53:12 -0400] j|: ?
[2012-08-30 17:53:13 -0400] jtimberman: j|: whats the use case?
[2012-08-30 17:53:21 -0400] Jay_Levitt: jtimberman: I've lived on the east coast all my life, and never seen ANYONE here make a sweeping generalization.
[2012-08-30 17:53:22 -0400] yfeldblum: jtimberman, nah you didn't, because "plenty" could mean 20 out of 300,00,000
[2012-08-30 17:53:23 -0400] j|: yfeldblum: meh.
[2012-08-30 17:53:24 -0400] jtimberman: like, why care about nodes so much?
[2012-08-30 17:53:30 -0400] meisen: Jay_Levitt: Have created a ticket with Opscode, http://status.opscode.com/ is not showing any known issue.
[2012-08-30 17:53:33 -0400] cassianoleal: hoover_damm: one big and overused generalization is to call the US America, and US natives Americans
[2012-08-30 17:53:45 -0400] cassianoleal: if you know what I mean :)
[2012-08-30 17:53:50 -0400] hoover_damm: cassianoleal, LOL I do
[2012-08-30 17:53:50 -0400] yfeldblum: j|, no, nodes are either transient or permanent as you see fit - but as data, not code
[2012-08-30 17:53:51 -0400] jtimberman: treat your nodes (servers) like cattle, not pets.
[2012-08-30 17:54:12 -0400] hoover_damm: jtimberman, shovel the data and force them to accept it? don't offer it and hope they accept it?
[2012-08-30 17:54:13 -0400] yfeldblum: j|, data goes in the database, and code goes in the codebase (and gets managed with git)
[2012-08-30 17:54:15 -0400] j|: jtimberman: lost me with the cattle.
[2012-08-30 17:54:24 -0400] jtimberman: you actually care about the service(s) they provide, not all the information about them. the information is useful for other purposes such as inventory tracking, IP information, etc.
[2012-08-30 17:54:25 -0400] Jay_Levitt: yeah, me too... suburban vegetarian
[2012-08-30 17:54:28 -0400] j|: yfeldblum: mkay. you're staring to get through to me.
[2012-08-30 17:54:51 -0400] jtimberman: is the argument about storing node data in git?
[2012-08-30 17:55:00 -0400] hoover_damm: I think I might have actually gotten what jtimberman meant
[2012-08-30 17:55:03 -0400] hoover_damm: weird
[2012-08-30 17:55:22 -0400] j|: well, lets not call it an argument seeing as I have no opinion other than I want to figure out a better way and haven't yet.
[2012-08-30 17:55:31 -0400] Jay_Levitt: siri, remind me to get drunk and tip over nodes tonight
[2012-08-30 17:55:37 -0400] illcomputing: hahah
[2012-08-30 17:55:47 -0400] jtimberman: Jay_Levitt: i think that voids the warranty.
[2012-08-30 17:56:06 -0400] j|: can I get shrooms out of node dung patties?
[2012-08-30 17:56:10 -0400] yfeldblum: j|, treat node data as pure data, because it is pure data ... you can certainly build out some additional workflows or some additional knife plugins to track changes to node data if knife and chef-server-api don't provide the visibility & history you're looking for
[2012-08-30 17:56:30 -0400] cwj: j|: if so i smell a serious business opportunity
[2012-08-30 17:56:39 -0400] cwj: also, dung
[2012-08-30 17:57:08 -0400] j|: yea, you smell the dung.. but everyone has their thing.. it's okay..
[2012-08-30 17:57:22 -0400] erikh: wait, am I missing poop jokes?
[2012-08-30 17:57:24 -0400] illcomputing: I think I'm getting the 'pet vs cattle' idea.. that's actually quite helpful
[2012-08-30 17:57:34 -0400] j|: yfeldblum: okay..
[2012-08-30 17:58:21 -0400] erikh: fwiw I prefer to treat node data (although this isn't always possible) as something that doesn't need to be backed up
[2012-08-30 17:58:29 -0400] erikh: leaving the important configuration to roles and data bags.
[2012-08-30 17:58:37 -0400] erikh: (which are kept in git)
[2012-08-30 17:58:42 -0400] erikh: dunno if that helps or not.
[2012-08-30 17:59:06 -0400] yfeldblum: j|, the way i think of it, chef is a gigantic database-backed application that configures your whole infrastructure
[2012-08-30 17:59:14 -0400] j|: erikh: yea, I guess that fits more. we're trying to put everything in recipes, roles and environments, so the node is just the end result of an application of those.. so why keep track of it specially.
[2012-08-30 17:59:17 -0400] yfeldblum: j|, and key to it is to figure out what's code and what's data
[2012-08-30 17:59:37 -0400] erikh: j|: right, nodes need mutable data, but that doesn't mean you need to care about it. :)
[2012-08-30 17:59:50 -0400] j|: yfeldblum: this is a useful model of thinking that hadn't hit me yet.
[2012-08-30 17:59:59 -0400] erikh: anyhow, *poof*
[2012-08-30 18:00:28 -0400] j|: erikh: yea, I pick up what you're putting down. thx.
[2012-08-30 18:01:20 -0400] yfeldblum: erikh, i personally consider data-bag items to be data, and don't think they need to be kept in git ... some maybe which *must* be common across all copies of your infrastructure, which can be said to be "seed" data, but not other data-bag items which may vary from one incarnation of the infrastructure to another and which therefore are not seed data
[2012-08-30 18:01:51 -0400] miah: it depends on if you are _writing_ into your data_bags from your systems
[2012-08-30 18:01:52 -0400] j|: yfeldblum: yea, it makes sense. I'm doing the couch recipes for our couch nodes now and obviously I'm not going to stick all of the couch files / docs into a repo
[2012-08-30 18:02:11 -0400] miah: i mean, you can ignore data bags totally and just use another key value store directly. data bags just make that easier.
[2012-08-30 18:02:19 -0400] j|: as far as seperating code and data
[2012-08-30 18:02:27 -0400] miah: because its other architecture you don't have to setup / understand
[2012-08-30 18:02:28 -0400] j|: at least that helps me think about it anyway.
[2012-08-30 18:02:33 -0400] thedeeno1: yfeldblum, erikh, this gets even more obvious when you're using encrypted data bags. Often you explicitly don't want to values in data bags to be in source control
[2012-08-30 18:02:51 -0400] miah: just store the encrypted databag in git
[2012-08-30 18:02:55 -0400] miah: that way you can recover it at any time
[2012-08-30 18:03:15 -0400] yfeldblum: miah, e.g., data-bag items describing applications ... not in git, even though they're only ever written to by an admin via knife or similar, because they will not be the same from incarnation to incarnation of the infra
[2012-08-30 18:03:16 -0400] miah: sure, you dont want to store the plain text version of that
[2012-08-30 18:03:29 -0400] miah: yfeldblum: yup
[2012-08-30 18:03:31 -0400] thedeeno1: miah: true
[2012-08-30 18:03:52 -0400] miah: im surprised there isn't a "good" zookeeper cookbook that handles most of this yet
[2012-08-30 18:04:33 -0400] yfeldblum: miah, it's just `KNIFE_ENV=qa knife data bag edit apps my-cool-app` to change that application data-bag item in the qa infrastructure, but that doesn't go into source control
[2012-08-30 18:05:35 -0400] Jay_Levitt: belatedly:
[2012-08-30 18:05:38 -0400] Jay_Levitt: http://pastie.org/4617846
[2012-08-30 18:05:58 -0400] yfeldblum: Jay_Levitt, nice
[2012-08-30 18:06:14 -0400] Jay_Levitt: er, more portable:
[2012-08-30 18:06:16 -0400] Jay_Levitt: http://pastie.org/4617851
[2012-08-30 18:06:29 -0400] Jay_Levitt: dammit:
[2012-08-30 18:06:31 -0400] Jay_Levitt: http://pastie.org/4617853
[2012-08-30 18:07:12 -0400] yfeldblum: miah, frequent backups of the chef-server's database are nearly as good for recovery as git
[2012-08-30 18:07:17 -0400] Jay_Levitt: still bugs me that I can't figure out how to get the attribute name from "knife node show $1 -a something"
[2012-08-30 18:08:13 -0400] yfeldblum: Jay_Levitt, use ruby? :D
[2012-08-30 18:08:19 -0400] j|: Jay_Levitt: you can get rid of the grep by using -a ec2.instance-id instead of grep instnace-if
[2012-08-30 18:08:28 -0400] Jay_Levitt: jl: a period! that's the one thing I hadn't tried
[2012-08-30 18:08:48 -0400] j|: heh, that's pretty much what I said the first time someone showed me that.
[2012-08-30 18:08:58 -0400] Jay_Levitt: j|: no, wait, not working:
[2012-08-30 18:09:02 -0400] Jay_Levitt: knife node show play2 -a ec2.instance_id
[2012-08-30 18:09:02 -0400] Jay_Levitt: ec2.instance_id:
[2012-08-30 18:09:24 -0400] j|: dunno, worky for me.
[2012-08-30 18:10:00 -0400] j|: and its obviously ec2 as the next line uses the ec2 plugin
[2012-08-30 18:10:13 -0400] j|: run ohai on the node | grep 'i-'
[2012-08-30 18:10:25 -0400] Jay_Levitt: j|: right, that's the correct hierarchy, I just couldn't figure out how to spell the "instance_id under ec2" part
[2012-08-30 18:10:34 -0400] j|: er, pipe through less then search for i-
[2012-08-30 18:10:38 -0400] Jay_Levitt: oh, must be a zsh thing.. if I quote the period, it works
[2012-08-30 18:10:42 -0400] j|: aahh
[2012-08-30 18:10:43 -0400] j|: zsh
[2012-08-30 18:10:45 -0400] Jay_Levitt:  knife node show fake-play7 -a 'ec2.instance_id'
[2012-08-30 18:10:45 -0400] Jay_Levitt: ec2.instance_id:  i-8ac53ff0
[2012-08-30 18:11:12 -0400] Jay_Levitt: wtf... no, now it works with or without quotes
[2012-08-30 18:11:20 -0400] j|: hahaah. awesome.
[2012-08-30 18:11:31 -0400] j|: love those types of problems.
[2012-08-30 18:11:37 -0400] j|: :P
[2012-08-30 18:11:47 -0400] Jay_Levitt: ohhh, play2 is a node without an instance attached, I think, it never got thru bootstrap.
[2012-08-30 18:12:35 -0400] juliancdunn: quick question: can you have more than one not_if or only_if block per resource?
[2012-08-30 18:13:26 -0400] leifmadsen: hmmm, going to need to do more separate testing with chef 10.14.0.rc.1 with minitest because it appears to be super busted on my servers now
[2012-08-30 18:17:58 -0400] Jay_Levitt: c'mon, opscode, timeouts and it's not even at :00/:30?
[2012-08-30 18:18:22 -0400] thedeeno: anyone have a cookbook which installs gems from a git repo?
[2012-08-30 18:19:47 -0400] jcran: thedeeno: could gem install bundler, write a Gemfile and execute bundle install
[2012-08-30 18:21:04 -0400] miah: yfeldblum: also true =)
[2012-08-30 18:22:45 -0400] jtimberman: Jay_Levitt: sorry about that - we're aware and going to have an update for status.opscode.com
[2012-08-30 18:22:55 -0400] Jay_Levitt: jtimberman: yay!
[2012-08-30 18:23:02 -0400] Jay_Levitt: I was gonna go node-tipping soon
[2012-08-30 18:23:08 -0400] jtimberman: lol
[2012-08-30 18:23:41 -0400] j|: you're making me hungry
[2012-08-30 18:23:49 -0400] j|: node burger sounds good right about now.
[2012-08-30 18:23:56 -0400] c_t: gah
[2012-08-30 18:24:00 -0400] c_t: damn it, now I'm hungry
[2012-08-30 18:24:12 -0400] c_t: "Please excuse the downtime, our team was out getting snacks."
[2012-08-30 18:24:20 -0400] j|: hahah! yes!
[2012-08-30 18:24:45 -0400] c_t: "Please excuse the downtime, our ops guys were frying eggs and bacon on the old P4s."
[2012-08-30 18:24:48 -0400] jtimberman: Jay_Levitt: https://twitter.com/opscode_status/statuses/241240000937721856
[2012-08-30 18:25:03 -0400] Jay_Levitt: thanks jtimberman :)
[2012-08-30 18:27:07 -0400] jtimberman: Jay_Levitt: so hopefully will be resolved soon :)
[2012-08-30 18:27:24 -0400] jmartin: burger is no good
[2012-08-30 18:27:26 -0400] jmartin: chicken and waffles
[2012-08-30 18:28:31 -0400] j|: chicken and waffles...
[2012-08-30 18:28:53 -0400] jmartin: everyone thinks it will be terrible, but it is oh so delicious
[2012-08-30 18:28:57 -0400] j|: jmartin: there's a place by my apartment that sells waffles like that.
[2012-08-30 18:29:05 -0400] j|: I thought that sounds... weird..
[2012-08-30 18:29:12 -0400] j|: choffles.
[2012-08-30 18:29:16 -0400] jmartin: buy some
[2012-08-30 18:29:19 -0400] jmartin: you will enjoy
[2012-08-30 18:29:32 -0400] j|: jmartin: I have a problem with chicken.
[2012-08-30 18:29:40 -0400] jmartin: oh
[2012-08-30 18:29:42 -0400] jmartin: well
[2012-08-30 18:29:45 -0400] j|: jmartin: read more than I should have about chicken meat production.
[2012-08-30 18:29:56 -0400] jmartin: never find out how the sausage is made
[2012-08-30 18:30:00 -0400] jmartin: because its all quite gross
[2012-08-30 18:30:00 -0400] j|: and I can't UNread it
[2012-08-30 18:30:03 -0400] jmartin: no matter what food
[2012-08-30 18:30:16 -0400] Jay_Levitt: yeah, that's how I became a vegetarian
[2012-08-30 18:30:29 -0400] Jay_Levitt: I was 13 and realized "wait... when mom defrosts lamb chops, that red stuff is not 'meat juice'"
[2012-08-30 18:30:29 -0400] jmartin: but you are killing the vegetables!
[2012-08-30 18:30:39 -0400] j|: yea, but sausage I knew about since I was a child, so I've had years to become okay with eating ground up parts wrapped in intestine.
[2012-08-30 18:30:47 -0400] Jay_Levitt: some vegetables need killin'.
[2012-08-30 18:30:59 -0400] jmartin: Jay_Levitt: as do some tasty tasty animals
[2012-08-30 18:31:11 -0400] j|: :)
[2012-08-30 18:31:14 -0400] jmartin: j|: i think they use cellulose wrapping now?
[2012-08-30 18:31:18 -0400] jmartin: either way
[2012-08-30 18:31:20 -0400] jameson1: Jay_Levitt: that red stuff is the blood from the ex husband and you were helping her cover up a murder
[2012-08-30 18:31:26 -0400] Jay_Levitt: OMG
[2012-08-30 18:31:36 -0400] j|: wow.
[2012-08-30 18:31:41 -0400] Jay_Levitt: and dad is his evil twin Bo?
[2012-08-30 18:31:54 -0400] jameson1: no, there is a famous short story
[2012-08-30 18:32:03 -0400] Jay_Levitt: oh, missed the ref :/
[2012-08-30 18:32:16 -0400] j|: good to know about Bo though.
[2012-08-30 18:32:20 -0400] jameson1: about a wife who uses a frozen lamb chop to murder her husband, and then serves the detectives the lamb chops
[2012-08-30 18:32:27 -0400] jmartin: hah
[2012-08-30 18:32:48 -0400] Jay_Levitt: that's hilarious that I've never heard that before
[2012-08-30 18:32:54 -0400] Jay_Levitt: (since lamb chops are always the example I use)
[2012-08-30 18:33:09 -0400] jameson1: Lamb to the Slaughter is the name of the short-story
[2012-08-30 18:39:01 -0400] geekbri: I like my food to be mysterious
[2012-08-30 18:39:04 -0400] geekbri: it adds adventure to my life
[2012-08-30 18:40:55 -0400] Jay_Levitt: whoa.. my postgresql dependency problem went away and AFAICT it must have been that I forgot to upload a cookbook at some point.
[2012-08-30 18:41:13 -0400] niklasswe: hmm When I trying to run this knife bootstrap <ip> -d centos6-rbel i get this error messages..http://pastebin.com/w7TRHD5c
[2012-08-30 18:41:20 -0400] Jay_Levitt: dammit, I want better repo-to-server syncing.
[2012-08-30 18:42:03 -0400] niklasswe: but if im running knife client create <name> and copy the private key to the machine and after that running boostrap its wokring..
[2012-08-30 18:51:46 -0400] jameson3: is there a place where I can get the changelogs since version 10.X
[2012-08-30 19:02:06 -0400] leifmadsen: if I have a file that I want to add a "require" to, and I want to point it at the Chef cache path, what attribute/setting might I use?
[2012-08-30 19:09:57 -0400] geekbri: leifmadsen: Chef::Config[:file_cache_path]
[2012-08-30 19:11:16 -0400] leifmadsen: geekbri: thank you very much
[2012-08-30 19:11:18 -0400] geekbri: np
[2012-08-30 19:12:35 -0400] niklasswe: any id how i should fix this.. http://pastebin.com/w7TRHD5c ?
[2012-08-30 19:13:03 -0400] jmartin: ensure a valid client key?
[2012-08-30 19:13:11 -0400] jmartin: hehe
[2012-08-30 19:13:24 -0400] niklasswe: I can use bootstrap if i running knife client create <client>
[2012-08-30 19:13:36 -0400] niklasswe: and then copy the private key to the host
[2012-08-30 19:13:39 -0400] jessicab: niklasswe: theres some tips on this page - http://wiki.opscode.com/display/chef/Common+Errors#CommonErrors-401Unauthorized%28usingvalidatorAPIclient%29
[2012-08-30 19:14:26 -0400] niklasswe: jessicab: I have look on them, but the bootstrap doesnt create any client ceritifcate..?
[2012-08-30 19:14:40 -0400] jessicab: pretty sure knife client create uses your key, not the validation.pem to create it
[2012-08-30 19:15:13 -0400] fu-jobu: hallo
[2012-08-30 19:15:19 -0400] jessicab: niklasswe: hm.. im not sure what you mean? when you bootstrap itll try to create the client with the orgs validator and then itll save the client pem on that node
[2012-08-30 19:16:00 -0400] jessicab: niklasswe: sorry, substitute validation.pem for org validator there.. forgot you were on open source
[2012-08-30 19:16:14 -0400] fu-jobu: I've set a variable in one of my roles as 'override_attribute', so that i can populate this in a shared template
[2012-08-30 19:16:51 -0400] fu-jobu: however, the template does not seem to find the variable
[2012-08-30 19:16:59 -0400] niklasswe: jessicab: I mean.. if I running the bootstrap i install all rubygems and chef-client.. and after that i get this error messages..
[2012-08-30 19:17:06 -0400] fu-jobu: chef-client complains that it does not exist
[2012-08-30 19:17:58 -0400] jessicab: niklasswe: it sounds like your validation.pem is bad, youll just want to replace it.. that page i linked has some tips on how to do that
[2012-08-30 19:18:00 -0400] niklasswe: but if I running knife client create my_node so it generate a certificate an i manully copy the client.pem to my_node and after that running knife bootstrap its working.
[2012-08-30 19:20:56 -0400] niklasswe: jessicab: okey thanks :) I just notify that the validation.pem is wrong on my new host
[2012-08-30 19:22:58 -0400] jessicab: niklasswe: nah, it would actually be your validation.pem on your workstation thats bad.. pretty sure knife client create uses your client key, not the validation pem
[2012-08-30 19:24:11 -0400] hashpuppy: i'm about to create a chef server.  the specs don't have to be too fancy for this, right?  1GB of memory and 30GB should be more than enough, right?
[2012-08-30 19:24:26 -0400] hashpuppy: and will i need HA for this and two of these?
[2012-08-30 19:25:13 -0400] fu-jobu: in my template, I reference it like so
[2012-08-30 19:25:14 -0400] fu-jobu: <%= node['override_attributes']['newrelic']['app_name'] %>
[2012-08-30 19:27:14 -0400] jtimberman: hashpuppy: depends on the frequency of convergence of the nodes you're managing, e.g. "converges per hour"
[2012-08-30 19:27:21 -0400] hashpuppy: low
[2012-08-30 19:27:23 -0400] jordane: fu-jobu: you should reference it just as node['newrelic']['app_name']
[2012-08-30 19:28:02 -0400] jordane: fu-jobu: the override_attributes is just a special way of setting the priority of an attribute. you can read more about how attributes work here http://wiki.opscode.com/display/chef/Attributes
[2012-08-30 19:29:41 -0400] niklasswe: jessicab: so I can remove the all and try to recreate it?
[2012-08-30 19:31:24 -0400] jessicab: niklasswe: yea, that link i posted gives some good directions on replacing it.. you could also test it if you wanted with something like this -  knife client list - u chef-validator -k .chef/validation.pem
[2012-08-30 19:31:37 -0400] jessicab: that would force it to use the validation pem instead for the request
[2012-08-30 19:32:14 -0400] jessicab: you may need to edit the end though to the correct path to your validation pem
[2012-08-30 19:37:55 -0400] niklasswe: hmm now have i change both validation.pem and webui.pem
[2012-08-30 19:42:35 -0400] _0x783czar: So I've got an issue.  I'm trying to preform a git clone in one of my recipies.  However I get a prompt to accept the RSA key which stops the execution of my recipe.  Any ideas for a way to get past this?
[2012-08-30 19:52:57 -0400] miah: copy the rsa host keys to the host prior to running your clone
[2012-08-30 19:53:57 -0400] fu-jobu: jordane: thanks, I will try that now
[2012-08-30 19:57:48 -0400] CharlieSu: Is there a good recipe for changing a hostname on a box?
[2012-08-30 19:58:20 -0400] krisk: hi folks. I'm trying to understand and implement deployment using chef or puppet, but I'm really struck how (apparently most/all) the recipes are written, so that they don't honor distribution defaults/differences and using .erb templates is kinda.. suboptimal. if you wanna have a look I wrote a short article and a chef recipe that implements it more flexible and with intelligent defaults (like dust-deploy).
[2012-08-30 19:58:27 -0400] krisk: https://github.com/kechagia/sshd-chef-cookbook/blob/master/deployrant.md
[2012-08-30 19:58:31 -0400] krisk: feeback appreciated. thx
[2012-08-30 19:59:57 -0400] krisk: and help :)
[2012-08-30 20:01:16 -0400] cheeseplus: krisk: setting default attributes in attributes/default.rb (or others) for chef is the best-practice approache
[2012-08-30 20:01:53 -0400] fu-jobu: jordane: that worked, thanks!
[2012-08-30 20:02:01 -0400] fu-jobu: jordane: now, should I use default_attribute or override_attribute at role level?
[2012-08-30 20:02:44 -0400] cheeseplus: krisk: example: https://github.com/cheeseplus/riak-chef-cookbook/blob/master/attributes/default.rb
[2012-08-30 20:03:41 -0400] jordane: fu-jobu: generally you should use the lowest one that works. So use default_attribute, and use override_attribute when you need to.
[2012-08-30 20:04:32 -0400] krisk: cheeseplus: yes, that's what I implemented here https://github.com/kechagia/sshd-chef-cookbook/blob/master/attributes/default.rb
[2012-08-30 20:05:07 -0400] krisk: but.. why aren't at least the official cookbooks using intelligent defaults? all sshd cookbooks e.g. I found, they had an erb-template where you could dynamically assign the port - that's it.
[2012-08-30 20:05:42 -0400] krisk: Is there a point that I'm missing?
[2012-08-30 20:05:48 -0400] fu-jobu: jordane: thank you very much!
[2012-08-30 20:06:59 -0400] cheeseplus: krisk: cookbooks are community maintained so it can be hit and miss
[2012-08-30 20:07:30 -0400] cheeseplus: most of the platform specific stuff is abstracted to providers
[2012-08-30 20:07:40 -0400] leifmadsen: I suppose the point is, "patches welcome!" :)
[2012-08-30 20:07:53 -0400] cheeseplus: krisk: exactly what leifmadsen said!
[2012-08-30 20:08:02 -0400] krisk: cheeseplus: Ok. But there's no "reason" why people are not doing it more "intelligent" it's just general lazyness? I kinda can't believe, that I'm the only one that is annoyed by this.
[2012-08-30 20:08:24 -0400] leifmadsen: I wouldn't say lazyness, but the fact all of this is pretty new, and standards haven't been developed yet
[2012-08-30 20:08:37 -0400] leifmadsen: it's a continuing process of development and enhancement
[2012-08-30 20:08:40 -0400] krisk: :) glad to contribute, I just wanted to make shure that there's not a reason that I'm missing, or some other approach that makes more sense, before I start re-implementing everything
[2012-08-30 20:08:40 -0400] cheeseplus: ^^
[2012-08-30 20:08:59 -0400] leifmadsen: reason being, no one else has been bothered enough to do it yet :)
[2012-08-30 20:09:01 -0400] cheeseplus: krisk: with regard to your cookbook, you should avoid logic in the attributes
[2012-08-30 20:09:22 -0400] cheeseplus: krisk: http://wiki.opscode.com/display/chef/Cookbook+Style+Guide+Draft
[2012-08-30 20:09:28 -0400] cheeseplus: logic should be in recipes
[2012-08-30 20:10:04 -0400] krisk: mmh, yeah I'm sure that the code is not that clean, I also wanted to have 2 methods in the recipe, but it's not possible apparently, and I wasn't sure where to put it.
[2012-08-30 20:10:23 -0400] krisk: the problem then is, that you cannot override the attributes in your node/role config, right?
[2012-08-30 20:10:43 -0400] leifmadsen: you can
[2012-08-30 20:10:47 -0400] krisk: well I could check if they are set and stuff. was just a quick thought to put it there, thanks for the feedback, will have a look at the guide
[2012-08-30 20:11:10 -0400] Pushnell1: can I use omnibus knife to create cookbooks for vagrant?  'knife cookbook create test' in my vagrant dir says "WARNING: No knife configuration file found", then tells me it is creating the cookboks etc, but I can find any new files in the current dir.
[2012-08-30 20:11:16 -0400] leifmadsen: krisk: http://wiki.opscode.com/display/chef/Attributes  <-- once I understand attribute precedence it all became a lot clearer
[2012-08-30 20:11:30 -0400] jmartin: Pushnell1: does your knife.rb exist?
[2012-08-30 20:11:33 -0400] leifmadsen: s/understand/understood
[2012-08-30 20:11:40 -0400] krisk: 2 more (more or less related questions). how can I create a "general" cookbook, and then have multiple installations use the same cookbook, but different templates, without having to modify it? or is that kinda not the way it's meant to be?
[2012-08-30 20:12:18 -0400] Pushnell1: jmartin: not in the current dir.  I don't need any of my global config here, I'm just playing with vagrant.
[2012-08-30 20:13:02 -0400] leifmadsen: krisk: the directory structure of the templates directory has built ins for distros and distro versions, or you wrap it in standard ruby code with case statements and the like
[2012-08-30 20:14:43 -0400] cheeseplus: krisk: you want to be as general as possible and case for OSes only when necessary
[2012-08-30 20:15:01 -0400] krisk: Yes, that's exactly what I'm trying to do
[2012-08-30 20:15:10 -0400] krisk: leifmadsen: didn't know about that. Is there documentation about this?
[2012-08-30 20:15:12 -0400] cheeseplus: krisk: override_attributes or roles
[2012-08-30 20:15:21 -0400] leifmadsen: krisk: ya, just in the templates resources documentation
[2012-08-30 20:15:30 -0400] krisk: must have missed that
[2012-08-30 20:15:34 -0400] cheeseplus: krisk: http://wiki.opscode.com/display/chef/Attributes
[2012-08-30 20:15:54 -0400] leifmadsen: http://wiki.opscode.com/display/chef/Templates#Templates-TemplateLocationSpecificity
[2012-08-30 20:16:03 -0400] leifmadsen: linked from http://wiki.opscode.com/display/chef/Resources#Resources-Template
[2012-08-30 20:16:05 -0400] Jay_Levitt: ranjibd: are you around? I tried adding your suggestion to my bootstrap template, but I must be doing it wrong - the output is just the "usage: sudo" help text.
[2012-08-30 20:16:06 -0400] cheeseplus: understanding attribute precedence is key
[2012-08-30 20:16:08 -0400] krisk: thanks.
[2012-08-30 20:16:23 -0400] Jay_Levitt: http://pastie.org/4618479
[2012-08-30 20:16:24 -0400] Jay_Levitt: http://pastie.org/pastes/create
[2012-08-30 20:16:29 -0400] leifmadsen: cheeseplus: heck ya -- incredibly important especially if you have any intentions of overriding or using environments, etc
[2012-08-30 20:16:31 -0400] cheeseplus: krisk: set sane defaults in the attributes but people will override them with either node or role atttributes
[2012-08-30 20:16:54 -0400] cheeseplus: you can also merge attributes which can be awesome or terrifying depending
[2012-08-30 20:16:58 -0400] krisk: so last thing.. I am a little concerned: I have the impression that every node in the chef ecosystem can retrieve every configuration of every node. Is there a way to restrict that? The only thing i found in this area is the encrypted data bag.
[2012-08-30 20:17:32 -0400] krisk: cheeseplus: that's what I'm doing in my recipe, don't I?
[2012-08-30 20:17:34 -0400] cheeseplus: why are you worried about this?
[2012-08-30 20:18:30 -0400] chenxu_: folks... anyone I can chat to about my servers being rate-limited?
[2012-08-30 20:18:47 -0400] krisk: Well, since this gives away a lot of information, that potentially can be exploited in future attacks. especially since there's e.g. production database credentials can be retrieved from all ondes, even from staging or testing environments. and I want to maintain *all the things* (insert meme) with chef, not only a few services..
[2012-08-30 20:19:19 -0400] cheeseplus: krisk: you are setting all your attributes in one big block for sshd, I'd break them out so you can tune each value
[2012-08-30 20:20:03 -0400] cheeseplus: krisk: for secret stuff, encrypted databags
[2012-08-30 20:20:19 -0400] cheeseplus: otherwise being able to query data on the chef server is one of the strengths
[2012-08-30 20:21:02 -0400] cheeseplus: you're already giving it root ;)
[2012-08-30 20:21:22 -0400] krisk: cheeseplus: I didn't quite figure out how I can deploy automatically with encrypted data bags, since I'd have to set a password manually right?
[2012-08-30 20:21:40 -0400] krisk: cheeseplus: yeah, well. that's why I usually still prefer the push method dust uses... :)
[2012-08-30 20:22:04 -0400] cheeseplus: it's a trade off
[2012-08-30 20:23:11 -0400] cheeseplus: you can put the password in the databag but I've not ever played with them
[2012-08-30 20:23:34 -0400] krisk: well.. the encrypted data bags are step 2 for me
[2012-08-30 20:24:13 -0400] Pushnell1: Can I use omnibus knife to create a cookbook for vagrant?  (I don't need any knife configuration, I just want it to splat out a blank cookbook structure)
[2012-08-30 20:24:14 -0400] krisk: so I guess there's nothing that particularly speaks against my "intelligent distribution default" approach, that's good to know. And I guess I need to basically implement all recipes myself, or migrate them from dust.
[2012-08-30 20:25:32 -0400] Jay_Levitt: the encrypted data bag secret gets dropped into /etc/chef at bootstrap time
[2012-08-30 20:26:01 -0400] leifmadsen: has anyone tested minitest-chef-handler with chef 10.14.0.rc.1 and the mysql cookbook (v 1.3.0)?  it appears to be balking on the helpers.rb file
[2012-08-30 20:26:14 -0400] leifmadsen: Report handler MiniTest::Chef::Handler raised #<NameError: uninitialized constant Helpers>
[2012-08-30 20:26:24 -0400] cheeseplus: krisk: ideally the distribution default is abstracted to the providers but if not you can do it yourself
[2012-08-30 20:26:52 -0400] krisk: Jay_Levitt: so knife takes care of that?
[2012-08-30 20:27:15 -0400] krisk: cheeseplus: would I even have a provider in my case?
[2012-08-30 20:27:34 -0400] cheeseplus: krisk: I was referencing the internal providers
[2012-08-30 20:27:45 -0400] Jay_Levitt: krisk: yep, afaict, as long as it's called "encrypted_data_bag_secret" - check the bootstrap template, e.g. "ubungu12.04-gems.erb" in the chef gem, and you'll see it gets copied over
[2012-08-30 20:29:28 -0400] krisk: Jay_Levitt: that sounds pretty good, thanks for the hint
[2012-08-30 20:29:54 -0400] krisk: So I guess: in theory I could place everything, all configuration in encrypted databags, for each single node, or at least each environment?
[2012-08-30 20:30:18 -0400] krisk: cheeseplus: mmh, I guess I'm not deep enough into chef, never heard about internal providers, or how to extend them
[2012-08-30 20:31:14 -0400] Jay_Levitt: krisk: yeah, just realized that "encrypted_data_bag" variable is set in knife.rb, so you could write a wrapper around knife/plugin inside of knife that sets it up however you want - per node, per environment, whatever - when you create the server.
[2012-08-30 20:32:28 -0400] Sbotman: Just wondering if somebody knows how to load my Role attributes within shef?
[2012-08-30 20:33:25 -0400] krisk: Jay_Levitt: Ok. That helps a lot, thanks.
[2012-08-30 20:34:12 -0400] smcg: sigh. is it just me or do chef's cooking terms and metaphors become grating very fast?
[2012-08-30 20:34:37 -0400] jordane: smcg: pun intended?
[2012-08-30 20:34:55 -0400] illcomputing: hahah
[2012-08-30 20:34:56 -0400] jmartin: zing
[2012-08-30 20:34:59 -0400] smcg: no, actually
[2012-08-30 20:35:55 -0400] Jay_Levitt: see, you're one of us now
[2012-08-30 20:36:13 -0400] smcg: it's just my opinion. I doubt opscode is going to change their whole branding because of me.
[2012-08-30 20:36:23 -0400] smcg: but if they did, I would be very impressed.
[2012-08-30 20:36:33 -0400] niklasswe: hmm maybe is better if I setup chef-server from scratch again..
[2012-08-30 20:44:05 -0400] Sbotman: I'm trying to debug one of my recipes, but it's depending on attributes that are set but the role. Loading the recipe is no problem, but how can I simply load these attributes into my current debug (shef -z) environment? any one an idea?
[2012-08-30 20:50:27 -0400] Sbotman: Oke, found it but I assume this can be done easier...
[2012-08-30 20:52:06 -0400] ranjibd: Jay_Levitt, can you share the change route part of the bootstrap script ?
[2012-08-30 20:52:20 -0400] Jay_Levitt: ranjibd: yeah, see pastie:
[2012-08-30 20:52:35 -0400] Jay_Levitt: http://pastie.org/4618635
[2012-08-30 20:54:17 -0400] ranjibd: Jay_Levitt, u have basic -c ' at the top of the bootstrap script ? knife ec2 execute the script wrapped in sude
[2012-08-30 20:54:26 -0400] ranjibd: *sudo
[2012-08-30 20:55:09 -0400] trobrock: I am having some troubles using the subscribe capabilities on a resource. I have this code: https://gist.github.com/3540684 and am getting `FATAL: Chef::Exceptions::ResourceNotFound: Cannot find a resource matching directory[/var/apps/outright_app/current/log] (did you define it first?)` Seems like it is defined just like the examples on the wiki
[2012-08-30 20:55:16 -0400] Jay_Levitt: yeah, full template:
[2012-08-30 20:55:18 -0400] Jay_Levitt: http://pastie.org/4618651
[2012-08-30 20:55:54 -0400] Jay_Levitt: Oh! I've added a blank line between 'sudo' and 'bash', haven't i.
[2012-08-30 20:57:03 -0400] leifmadsen: not sure if anyone is interested, but getting multiple issues with minitest and chef on the 10.14.0.rc.1, so would ideally like ot get the issue triaged prior to full release of chef 10.14.0. If anyone is interested, issue is at CHEF-3405
[2012-08-30 21:00:00 -0400] jtimberman: leifmadsen: does that work with 10.12 too?
[2012-08-30 21:00:05 -0400] Jay_Levitt: ranjibd: ok, I guess I need to delete the default route before creating one, eh?
[2012-08-30 21:00:35 -0400] leifmadsen: jtimberman: it worked with 0.10.8 -- an issue in 0.10.10 caused the tests to begin failing due to the owner/group/mode returning nil
[2012-08-30 21:00:46 -0400] leifmadsen: which was supposed to be fixed in 10.14.0 :)
[2012-08-30 21:00:52 -0400] leifmadsen: so they do work on 0.10.8
[2012-08-30 21:01:45 -0400] jtimberman: k :)
[2012-08-30 21:02:23 -0400] angrybit: Well, I'm spun up a new ec2 instance using chef / knife ec2.  I guess that's a good first step.  Now to figure out how to add user accounts using chef...
[2012-08-30 21:02:29 -0400] angrybit: I've*
[2012-08-30 21:02:33 -0400] leifmadsen: jtimberman: this is the issue I was hoping to test :)   http://tickets.opscode.com/browse/CHEF-3235
[2012-08-30 21:03:38 -0400] jmartin: angrybit: use the user resource
[2012-08-30 21:03:56 -0400] jmartin: angrybit: http://wiki.opscode.com/display/chef/Resources#Resources-User
[2012-08-30 21:04:25 -0400] angrybit: jmartin: thanks.  i've been going through the bootstrap guide. http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide
[2012-08-30 21:04:33 -0400] ranjibd: yeah
[2012-08-30 21:04:39 -0400] ranjibd: ip route change
[2012-08-30 21:11:17 -0400] angrybit: Regarding adding users to a fresh EC2 instance...  I'm trying to wrap my head around all the terminology.  I have 3 sysadmin users that need to be added to all instances that are created.  I need a *cookbook* to store the *recipe* that adds each of these users.  The users are a *resource*.  Am I correct so far?
[2012-08-30 21:15:24 -0400] jmartin: the user resource can be used to create the users on the system
[2012-08-30 21:15:28 -0400] jmartin: yes
[2012-08-30 21:16:11 -0400] angrybit: how should i think about structuring cookbooks?  should i have lots of cookbooks, or just a few?
[2012-08-30 21:17:17 -0400] jmartin: well its all just my opinion, but if you have many smaller cookbooks, you can likely combine them in new interesting ways
[2012-08-30 21:17:21 -0400] jmartin: i like granularity
[2012-08-30 21:17:36 -0400] jmartin: but there are ways to do that within a cookbook too
[2012-08-30 21:17:43 -0400] jmartin: there is a default recipe
[2012-08-30 21:17:48 -0400] jmartin: and there can be other recipes in the book
[2012-08-30 21:17:59 -0400] jmartin: that get called when necessary
[2012-08-30 21:18:07 -0400] angrybit: for something like adding users, should i create my own recipe or use an existing cookbook/recipe like the ones from 37 signals?
[2012-08-30 21:18:53 -0400] angrybit: ok.  so you'd structure cookbooks for configuration of specific services.  a ntp cookbook, an apache cookbook, a users cookbook, etc?
[2012-08-30 21:21:34 -0400] angrybit: jmartin: do you find you custom write most of your cookbooks or are you able to find community cookbooks to suit your needs?
[2012-08-30 21:22:23 -0400] jmartin: angrybit: do not be mistaken, im no wizard, honestly there are cookbooks out there for a lot of stuff, and at the worst it can be a basis for your own custom version
[2012-08-30 21:23:11 -0400] angrybit: jmartin: gotcha.  i'm trying to figure out if for something simple, like adding a few users, i should start with writing my own recipe from scratch or if i should use the opscode user cookbook instead.
[2012-08-30 21:23:30 -0400] jmartin: angrybit: just write one for testing
[2012-08-30 21:23:32 -0400] jmartin: it wont be that hard
[2012-08-30 21:23:35 -0400] jmartin: and will get you used to writing one
[2012-08-30 21:23:46 -0400] angrybit: jmartin: thanks for the tip.  that seems like a good idea.
[2012-08-30 21:24:08 -0400] cheeseplus: I use a community one up until the point that I've rewritten large parts of it
[2012-08-30 21:24:11 -0400] cheeseplus: then I do a PR
[2012-08-30 21:24:13 -0400] cheeseplus: ;)
[2012-08-30 21:24:26 -0400] jmartin: exactly
[2012-08-30 21:24:36 -0400] jmartin: although my first one was something not out there already
[2012-08-30 21:24:57 -0400] jmartin: but it did leverage a few that are out there
[2012-08-30 21:25:57 -0400] angrybit: simple question, but for your own cookbooks, do you name them in such a way that they will not conflict with future community cookbooks you may choose to use?  for example, "angrybit-users" instead of "users".
[2012-08-30 21:26:52 -0400] jmartin: angrybit: most likely they would conflict and you would only use one or the other
[2012-08-30 21:27:18 -0400] jmartin: but again, im not that much of a chef wizard, just trying to be helpful
[2012-08-30 21:28:15 -0400] angrybit: jmartin: thanks.  you're doing a good job of it.  :-)
[2012-08-30 21:42:33 -0400] jameson3: anyone here familiar with the MOUNT resource?
[2012-08-30 21:42:53 -0400] jameson3: or know a cute way to get the status of a mount-ed device without having to escape to bash
[2012-08-30 21:47:08 -0400] miah: is there a object passed to lwrps that contain a list/hash of all the attributes?
[2012-08-30 21:49:46 -0400] rBEL: jameson3: what you are able to do is check wether the mounted device is listed in your filesystem attribute
[2012-08-30 21:50:25 -0400] jameson3: rBEL: using mounted ?
[2012-08-30 21:51:01 -0400] rBEL: jameson3: login into the web ui of your chef server and open the info of your node
[2012-08-30 21:51:14 -0400] rBEL: below of the page you have all kind of attributes set for this node
[2012-08-30 21:51:21 -0400] jameson3: i was hoping to do programmically from inside of chef
[2012-08-30 21:51:22 -0400] rBEL: included the filesystem attribute
[2012-08-30 21:51:24 -0400] jameson3: like from a recipe
[2012-08-30 21:51:45 -0400] rBEL: you are able to write ruby code in your recipe :)
[2012-08-30 21:52:03 -0400] rBEL: which checks the values in the filesystem attribute
[2012-08-30 21:52:04 -0400] jameson3: so there is a node[:filesystem] or something like that?
[2012-08-30 21:52:07 -0400] rBEL: yes
[2012-08-30 21:52:14 -0400] rBEL: it's an array of values
[2012-08-30 21:52:25 -0400] rBEL: take a look in the webui
[2012-08-30 21:52:59 -0400] rBEL: or check by command line: knife node edit <nodename>
[2012-08-30 21:55:13 -0400] jameson3: coo~, thank you
[2012-08-30 21:55:27 -0400] rBEL: np
[2012-08-30 21:55:52 -0400] rBEL: as you are able to see, you have many attributes whom are containing alot of info :)
[2012-08-30 21:57:28 -0400] rBEL: miah: can you explain yourself a bit better?
[2012-08-30 21:57:42 -0400] trobrock: Am I making a wrong assumption somewhere here: https://gist.github.com/3540684 or is that code supposed to be deleting the directory? Seems like the execute should confirm the file deletion, but fails
[2012-08-30 21:58:53 -0400] rBEL: trobrock: action :delete in a directory resource will delete the directory
[2012-08-30 21:59:20 -0400] trobrock: rBEL: Running that code in a recipe does not result in the directory being deleted
[2012-08-30 21:59:52 -0400] miah: hrm. my guess is there would be a new_resources.attributes
[2012-08-30 22:00:43 -0400] rBEL: trobrock: does that directory contains other directories and/or files
[2012-08-30 22:00:54 -0400] trobrock: one file
[2012-08-30 22:01:13 -0400] rBEL: if yes try to add 'recursive true' aswell
[2012-08-30 22:01:57 -0400] kombatunit:      Hi, I'm getting this error: Failure/Error: chef_run.file(conf_file).should be_owned_by('root', 'root')        expected nil to be owned by "root" and "root"
[2012-08-30 22:02:42 -0400] kombatunit: similar syntax works fine on directories and it matches https://github.com/acrmp/chefspec
[2012-08-30 22:02:56 -0400] trobrock: rBEL: fails with recursive true also, would it matter if the file inside the directory was a hidden file?
[2012-08-30 22:03:07 -0400] rBEL: it should not
[2012-08-30 22:03:43 -0400] rBEL: any info in the chef run?
[2012-08-30 22:05:20 -0400] trobrock: rBEL: I added the chef output to the gist : https://gist.github.com/3540684
[2012-08-30 22:06:28 -0400] rBEL: why are you using the execute for?
[2012-08-30 22:06:56 -0400] rBEL: comment it and make first sure the chef run is being runned succesful
[2012-08-30 22:07:07 -0400] trobrock: rBEL: it is debugging for now, what I'm really trying to do it remove the directory and replace it with a symlink, but that command fails with "log is already a directory"
[2012-08-30 22:09:57 -0400] trobrock: rBEL: Figured it out... /var/apps/outright_app/current is a symlink pointing to /var/apps/outright_app/gitdeploy, guess the directory resource doesn't handle symlinks too well
[2012-08-30 22:11:06 -0400] ssi: anyone have any good strategies for determining whether a file has changed?
[2012-08-30 22:11:28 -0400] ssi: I'm writing an LWRP to pull stuff from a maven repository, and I'm trying to figure out the best way to handle its idempotency
[2012-08-30 22:11:35 -0400] cheeseplus: checksums?
[2012-08-30 22:11:55 -0400] rBEL: trobrock: odd
[2012-08-30 22:11:56 -0400] ssi: checksums generically are good, yes, but... store them in a node attribute?  in a file alongside the target file?
[2012-08-30 22:12:18 -0400] ssi: just trying to get a feel for what good practice is that others are using
[2012-08-30 22:12:33 -0400] cheeseplus: I might toss them in databags
[2012-08-30 22:13:00 -0400] ssi: databag wouldn't be my favorite option in this case, as I'm in a very very big organization and I don't want to pollute
[2012-08-30 22:13:50 -0400] trobrock: rBEL: yes I already had an issue today where referring to a directory resource in a subscribes line like: resources(:directory => "/some/path") didnt work, thinking maybe that was also related to the path being a symlink
[2012-08-30 22:14:11 -0400] rBEL: i will have to try this tomorrow in the office
[2012-08-30 22:14:26 -0400] rBEL: didnt experienced this yet
[2012-08-30 22:14:33 -0400] rBEL: so i'm not able to confirm :)
[2012-08-30 22:15:03 -0400] cheeseplus: trobrock: what chef version?
[2012-08-30 22:15:24 -0400] cheeseplus: I know 10.10 had a broke subscribes for file
[2012-08-30 22:17:14 -0400] rBEL: miah: could be, sounds logic
[2012-08-30 22:19:44 -0400] awgross|flashman: kombatunit: that is a bug in chefspec/chef right now, just have to set the test as a skip for now
[2012-08-30 22:20:39 -0400] awgross|flashman: kombatunit: https://github.com/acrmp/chefspec/issues/31
[2012-08-30 22:21:07 -0400] awgross|flashman: kombatunit: its related to a regression in chef 0.10.10/0.10.12, it should be fixed in cehf 0.10.14
[2012-08-30 22:27:03 -0400] jameson3: ssi: why not leave a breadcrumb on the machine once you've install stuff with maven
[2012-08-30 22:27:25 -0400] jameson3: and have a installer that checks the breadcrumb file if it exists
[2012-08-30 22:28:00 -0400] jameson3: the breadcrumbing would be a script outside of chef.
[2012-08-30 22:30:13 -0400] trobrock: cheeseplus: 10.12.0
[2012-08-30 22:30:40 -0400] ssi: jameson3: that's sort of what I'm working on now
[2012-08-30 22:30:49 -0400] angrybit: can data bags be an arbitrary depth, or only one level deep (directory structure).  e.g. /users/admin/username.json
[2012-08-30 22:31:07 -0400] ssi: I'm having the LWRP create filename.md5 file alongside the downloaded artifact (which is already downloading to /var/cache/chef)
[2012-08-30 22:31:24 -0400] ssi: and then it'll check that md5 file before deciding to try to re-unpack
[2012-08-30 22:31:53 -0400] ssi: maven will already manage whether or not to pull from server or from local repository, but I need a way to know whether it's changed so I know to re-unpack and everything else
[2012-08-30 22:35:24 -0400] ssi: hm... I'm concerned about this though, cause I don't know if the recipes that use this resource will be able to accurately know whether or not the resource unpacked
[2012-08-30 22:42:08 -0400] _0x783czar: is there a way to add a user to a group (other than their primary) using the user resource
[2012-08-30 22:42:13 -0400] jameson3: you should create the md5 after the resource unpacks
[2012-08-30 22:43:41 -0400] ssi: yeah that's what I'm doing
[2012-08-30 22:43:47 -0400] ssi: well so what I mean is,
[2012-08-30 22:44:10 -0400] ssi: in a recipe that uses this resource, I want to be able to do template substitutions on files within the unpacked archive
[2012-08-30 22:44:17 -0400] ssi: but I only want those to happen if the unpack happened
[2012-08-30 22:44:43 -0400] ssi: but the unpack resource is going to do some work either way (attempting to fetch from maven, checking if the file has a new checksum, and optionally unpacking)
[2012-08-30 22:45:23 -0400] ssi: so I would guess any notifications that the unpack resource sends are going to get sent either way
[2012-08-30 22:45:26 -0400] ssi: but I'm not really sure
[2012-08-30 22:45:46 -0400] ssi: some of this is still kinda deep magic to me :/
[2012-08-30 22:58:11 -0400] angrybit: i'm working on a recipe for creating users.  if i want to add sysadmin users to all servers, but normal users to only dev servers, what's the proper way to structure my recipes?  should i have 2 recipes that do two different searches?  or should i have a second recipe that i pass an attribute (or something) into to define which users should be created.
[2012-08-30 22:59:36 -0400] bluepojo: We use databag entries
[2012-08-30 22:59:38 -0400] bluepojo: for users
[2012-08-30 22:59:52 -0400] bluepojo: and have a users recipe that creates the users
[2012-08-30 23:00:06 -0400] bluepojo: we define groups on the user detail hashes
[2012-08-30 23:00:12 -0400] bluepojo: the recipe can add certain groups to the node
[2012-08-30 23:00:31 -0400] bluepojo: it also has a field for public keys for authentication
[2012-08-30 23:00:47 -0400] bluepojo: these are for human users, which is I think what you're asking
[2012-08-30 23:00:52 -0400] bluepojo: angrybit: ^
[2012-08-30 23:09:57 -0400] angrybit: bluepojo: correct, these are for human users.
[2012-08-30 23:11:09 -0400] angrybit: bluepojo: so do you have one recipe that searches the data bags for all users that are in group X and another recipe that search for all users in group Y?  or do you use some sort of attribute (or something) to determine which groups need to be added to a server
[2012-08-30 23:11:34 -0400] yfeldblum: angrybit, either way is fine
[2012-08-30 23:12:58 -0400] angrybit: one recipe seems more DRY.  i think that would be my preferred approach.  but then my hurdle is how, programmatically, do i determine which groups of users to install.  should i drive it off of the role of the node?
[2012-08-30 23:13:05 -0400] _0x783czar: yfeldblum: do you know how I can set up a users contact info with the User resource?
[2012-08-30 23:13:30 -0400] _0x783czar: whois yfeldblum
[2012-08-30 23:13:54 -0400] _0x783czar: oops, yes I did just try and "whois" you
[2012-08-30 23:14:20 -0400] yfeldblum: _0x783czar, the attributes that Chef::Resource::User recognizes are listed here: https://github.com/opscode/chef/blob/master/chef/lib/chef/resource/user.rb
[2012-08-30 23:15:22 -0400] yfeldblum: _0x783czar, i'm not sure what you mean by "contact info"
[2012-08-30 23:15:58 -0400] angrybit: i'm looking at the 37signals user cookbook and the opscode user cookbook.  it seems like both iterate over a data bag in a hard coded manner.  the former, over all users in the data bag.  the latter, over all users in the data bag who are part of the "sysadmins" group.
[2012-08-30 23:16:27 -0400] _0x783czar: yfeldblum: Office, phonenumber etc.  the way I would with the useradd command.
[2012-08-30 23:17:56 -0400] yfeldblum: _0x783czar, not that i'm aware of, but you could put it in the comment
[2012-08-30 23:18:28 -0400] yfeldblum: angrybit, indeed
[2012-08-30 23:19:33 -0400] yfeldblum: angrybit, there's also fnichol's user cookbook: https://github.com/fnichol/chef-user/blob/master/recipes/data_bag.rb
[2012-08-30 23:20:34 -0400] angrybit: yfeldblum: interesting.  so in this recipe, there is an array of user account names that are associated with a node and that's what drives the account creation.
[2012-08-30 23:21:25 -0400] yfeldblum: angrybit, indeed
[2012-08-30 23:22:08 -0400] yfeldblum: angrybit, there are many different strategies for how to decide what users go on what servers ... each one is better for some uses and worse for others, of course, but i shouldn't have to say that
[2012-08-30 23:22:46 -0400] jtimberman: ohai chefs, in case you're not on the mailing list (and you should be! :D), new version of test-kitchen, 0.5.4 released: http://lists.opscode.com/sympa/arc/chef/2012-08/msg00413.html
[2012-08-30 23:23:43 -0400] joemiller: any sane way to recursively deploy templates? similar to remote_directory but w/ templates. or any way to enumerate templates in a cookbook?
[2012-08-30 23:24:01 -0400] angrybit: yfeldblum: thanks.  i'm trying to think through the ramifications of one approach vs another in our ecosystem.  with the flexibility of Chef, i want to make sure i'm doing something in a Good Way rather than just doing it because i'm able.
[2012-08-30 23:24:56 -0400] yfeldblum: joemiller, you can certainly enumerate templates in a cookbook, and indeed there are multiple parts of chef-client and of knife that need to do just that (and you can look at knife-essentials too)
[2012-08-30 23:25:29 -0400] yfeldblum: joemiller, but if you spend some time looking at the source code for the template resource and provider classes, that should help
[2012-08-30 23:25:32 -0400] joemiller: i suppose i could do some globbing using the current recipe's __FILE__ to find the "../templates" dir..
[2012-08-30 23:25:39 -0400] joemiller: yfeldblum: ok
[2012-08-30 23:25:49 -0400] krawek: hi guys, whats the best way to generate a ssh key using chef?
[2012-08-30 23:25:58 -0400] yfeldblum: joemiller, no don't do that __FILE__ thing ...
[2012-08-30 23:26:08 -0400] joemiller: yfeldblum: even for chef-solo?
[2012-08-30 23:26:27 -0400] yfeldblum: joemiller, there is no guarantee whatsoever that it would work
[2012-08-30 23:26:39 -0400] masterkorp: VROOOOOOMMMMM
[2012-08-30 23:26:53 -0400] joemiller: yfeldblum: ok
[2012-08-30 23:26:56 -0400] masterkorp: sorry that was a stupidity attack
[2012-08-30 23:27:11 -0400] yfeldblum: joemiller, i'm pretty sure it won't work: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/template.rb#L104
[2012-08-30 23:27:35 -0400] yfeldblum: joemiller, familiarize yourself with that file as well as this one: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/template.rb
[2012-08-30 23:27:57 -0400] joemiller: already there. no good ideas yet tho ;)
[2012-08-30 23:28:36 -0400] joemiller: maybe extend Chef::Resource::RemoteDirectory to create a 'remote_template_directory" resource. hrm
[2012-08-30 23:29:36 -0400] angrybit: does the search interface allow search arrays within a data bag item?  For example, if I have { "vehicle": ["car", "plane"] } can i search(:foo, "vehicle:plane")?
[2012-08-30 23:30:05 -0400] yfeldblum: joemiller, nah just do a loop ...
[2012-08-30 23:31:59 -0400] yfeldblum: angrybit, i believe yes
[2012-08-30 23:32:22 -0400] angrybit: yfeldblum: thanks.
[2012-08-30 23:32:30 -0400] angrybit: what's the best way to test a recipe?  can you do a try run?
[2012-08-30 23:32:34 -0400] angrybit: dry run*
[2012-08-30 23:35:02 -0400] yfeldblum: angrybit, it's weird, but here you go: http://wiki.opscode.com/display/chef/Search#Search-NestedFields
[2012-08-30 23:35:18 -0400] yfeldblum: angrybit, run it on a test server?
[2012-08-30 23:35:28 -0400] yfeldblum: angrybit, on some public cloud?
[2012-08-30 23:35:45 -0400] yfeldblum: angrybit, or even locally, in virtualbox w/ vagrant?
[2012-08-30 23:36:12 -0400] angrybit: yfeldblum: thanks for that link on searching.  as for testing, i didn't know if chef had any built in testing capabilities.  i guess not :-)
[2012-08-30 23:36:24 -0400] jtimberman: angrybit: there will be a "dry run" feature in Chef 10.14, which has a release candidate available.
[2012-08-30 23:36:46 -0400] angrybit: jtimberman: thanks. i'll look at the docs for that version to see what it will look like.
[2012-08-30 23:37:03 -0400] jtimberman: http://lists.opscode.com/sympa/arc/chef/2012-08/msg00383.html
[2012-08-30 23:37:24 -0400] jtimberman: but "dry run" modes are no substitute for *actually running* a configuration management system :)
[2012-08-30 23:37:34 -0400] jtimberman: since operating system state changes have side effects
[2012-08-30 23:37:51 -0400] jtimberman: (package installed -> service started (or not), for example)
[2012-08-30 23:38:46 -0400] angrybit: jtimberman: certainly.  but it's nice to have something to at least check your syntax and make sure you're not doing anything too wrong.
[2012-08-30 23:38:56 -0400] joemiller: coming from the puppet world tho, i find many good uses for dry run
[2012-08-30 23:39:39 -0400] masterkorp: joemiller: i dont like it dry
[2012-08-30 23:39:46 -0400] masterkorp: too much friction
[2012-08-30 23:39:53 -0400] joemiller: use lube
[2012-08-30 23:40:25 -0400] jtimberman: angrybit: syntax checking is as simple as 'knife cookbook test COOKBOOK'
[2012-08-30 23:40:33 -0400] jtimberman: angrybit: and you can run a "lint" check with foodcritic.
[2012-08-30 23:40:50 -0400] jtimberman: masterkorp: ...
[2012-08-30 23:40:53 -0400] angrybit: jtimberman: thank you.  that's quite helpful.
[2012-08-30 23:40:53 -0400] jtimberman: joemiller: ...
[2012-08-30 23:41:01 -0400] hoover_damm: there's always ruby -c
[2012-08-30 23:41:09 -0400] hoover_damm: if you need to evaluate an erb template
[2012-08-30 23:41:10 -0400] masterkorp: jtimberman: what i was talking about my bicycle chain
[2012-08-30 23:41:15 -0400] hoover_damm: erb -x file.erb | ruby -c
[2012-08-30 23:42:14 -0400] joemiller: same here
[2012-08-30 23:42:37 -0400] syphon: what's the Best Practice way of manipulating a node's client.rb? Specifically, I want to make sure all my nodes are properly configured to use the Splunk Handler, which requires a 'gem install' and a few lines added to chef's client.rb
[2012-08-30 23:43:08 -0400] syphon: right now I simply use a 'onboard_chef.sh' script which handles it all, but obviously that won't work if I use knife to bootstrap nodes
[2012-08-30 23:44:23 -0400] masterkorp: syphon: the chef cookbook can do that
[2012-08-30 23:44:49 -0400] syphon: is the cookbook just named 'chef'?
[2012-08-30 23:45:25 -0400] syphon: someone else mentioned 'chef_client' and 'chef_handler'. All of the different options are why I'm asking for the best way to do it :)
[2012-08-30 23:45:33 -0400] masterkorp: syphon: https://github.com/opscode-cookbooks/chef-client
[2012-08-30 23:46:09 -0400] masterkorp: we still use the old one where i work
[2012-08-30 23:46:25 -0400] syphon: what's the older one?
[2012-08-30 23:46:38 -0400] tolland: anyone want a contract job working on a deployment project to AWS for for a non-trivial printing company?
[2012-08-30 23:47:14 -0400] masterkorp: syphon: this is probably what you want
[2012-08-30 23:47:50 -0400] syphon: ugh, doesn't support Windows
[2012-08-30 23:47:58 -0400] syphon: I'm afraid that's a deal breaker :(
[2012-08-30 23:48:31 -0400] jtimberman: syphon: what doesn't support windows
[2012-08-30 23:48:59 -0400] syphon: oh wait, it has two different 'supported platform' lists, one says Windows, the other does not
[2012-08-30 23:49:01 -0400] _0x783czar: yfeldblum: Hey, just so you know.  The finger information which you normally set with chfn can be set in the comment by using it as a comma delimited string.  So: FULL_NAME,OFFICE,OFFICE_PHONE,HOME_PHONE.  And that will set up all the finger information.
[2012-08-30 23:49:16 -0400] _0x783czar: just figured it out by trying a few things
[2012-08-30 23:49:53 -0400] yfeldblum: _0x783czar, cool
[2012-08-30 23:51:23 -0400] cheeseplus: that moment when Chef Server dies, you panic, and then realize it's just because CouchDB ate all the diskspace
[2012-08-30 23:53:38 -0400] syphon: would the chef-client cookbook handle installing a gem, or would I have to write another cookbook to do that?
[2012-08-30 23:56:28 -0400] cheeseplus: what gem?
[2012-08-30 23:56:54 -0400] syphon: splunk_handler
[2012-08-30 23:57:05 -0400] masterkorp: cheeseplus: freaking chouces always using all the space
[2012-08-30 23:57:36 -0400] cheeseplus: I mean you could obviously edit it the cookbook to do so syphon but you'd want another cookbook to do that ideally
[2012-08-30 23:57:42 -0400] cheeseplus: or make it part of your bootstrap template
[2012-08-30 23:58:03 -0400] cheeseplus: masterkorp: yea, totally panicked late in the day because I was getting EOFErrors
[2012-08-30 23:58:38 -0400] cheeseplus: chef-server is a kvm server and someone didnt't give it much space, surprising it didn't blow up before now
