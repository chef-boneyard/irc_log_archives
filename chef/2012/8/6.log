[2012-08-06 00:00:30 -0400] Liku: yfeldblum: Hi again :) I got an error when wrote at erb file  <%= node['test']['rest']['fest'].join(" ") %> . Chef::Mixin::Template::TemplateError: can't convert String into Integer
[2012-08-06 00:00:31 -0400] yfeldblum: r1chelt, you're trying to run chef-client on a server somewhere, and you have configured chef-client on that server to think that the corresponding chef-server is at chef.myhost.de:4000, but chef-client checked and there's no chef-server at that URL
[2012-08-06 00:01:32 -0400] yfeldblum: Liku, i believe `node["test"]["rest"]` returns an Array, and you can only index into an Array with Integer indexes, not with String indexes
[2012-08-06 01:17:43 -0400] rayrod2030: what's the best way to handle software firewalls in chef?  firewall cookbook?  Where is best to group together rules for a particular server role?
[2012-08-06 01:45:01 -0400] hoover_damm: rayrod2030, iptables?
[2012-08-06 01:45:35 -0400] rayrod2030: yeah I'm creating cookbooks for each server role using the lwrp from the firewall cookbook.
[2012-08-06 01:45:43 -0400] rayrod2030: to group the rules
[2012-08-06 01:46:01 -0400] hoover_damm: http://community.opscode.com/cookbooks/simple_iptables
[2012-08-06 01:46:04 -0400] hoover_damm: looks fantastic
[2012-08-06 01:47:12 -0400] hoover_damm: http://community.opscode.com/cookbooks/firewall looks pretty good too i guess
[2012-08-06 01:47:22 -0400] hoover_damm: there's a ufw cookbook as well that opscode wrote
[2012-08-06 01:47:34 -0400] yfeldblum: reusing third-party cookbooks is cheating
[2012-08-06 01:47:43 -0400] cwj: wat
[2012-08-06 01:48:26 -0400] yfeldblum: so is using any of the resource or providers that ship with chef
[2012-08-06 01:48:28 -0400] yfeldblum: write your own!
[2012-08-06 01:49:08 -0400] cwj: :)
[2012-08-06 01:49:31 -0400] rayrod2030: yeah I'm using firewall
[2012-08-06 01:55:15 -0400] hoover_damm: yfeldblum, then let me cheat on my wife every night
[2012-08-06 01:55:31 -0400] hoover_damm: yfeldblum, because I don't have the time nor patience to code every chef cookbook from scratch
[2012-08-06 01:55:47 -0400] hoover_damm: and if I did... who's to say I was any more right then the guy to the left?
[2012-08-06 02:36:17 -0400] HashNuke: hey guys, I get this error "No such file or directory - /etc/chef/validation.pem" when I try to bootstrap an ec2 instance using knife. (I'm not using chef-server)
[2012-08-06 03:09:53 -0400] tigris: does anyone know if http://community.opscode.com/cookbooks/nginx is actively maintained? i am finding different problem with it almost every day and wondering if it's worth keeping fixing it or create new from scratch
[2012-08-06 03:11:42 -0400] paulmooring: tigris: It is yes
[2012-08-06 03:13:27 -0400] paulmooring: that being said, if an issue doesn't have a ticket on tickets.opscode.com it might be ignored
[2012-08-06 03:14:07 -0400] tigris: paulmooring: today i decided to try my chef setup on a brand new ubuntu box, lots of failing stuff in the nginx recipe that didn't show up before because i'd previously installed nginx manually before running nginx::source recipe
[2012-08-06 03:14:29 -0400] tigris: so a few things in there depend on directories existing or the /etc/init.d/nginx service existing etc
[2012-08-06 03:16:00 -0400] paulmooring: tigris: I would guess the case of nginx being installed outside of Chef first has not been thoroughly tested/accounted for yet
[2012-08-06 03:17:02 -0400] paulmooring: As you can probably imagine, basically everything is always automated through Chef internally at Opscode
[2012-08-06 03:17:03 -0400] tigris: paulmooring: sorry, i didn't mean outside of chef, i meant using the default nginx recipe vs the ::source version
[2012-08-06 03:17:27 -0400] paulmooring: oh, like you switch the node from nginx::default to nginx::source
[2012-08-06 03:17:36 -0400] tigris: correct
[2012-08-06 03:17:50 -0400] tigris: it works fine if you swap... but if you start with ::source from scratch, lots of fails
[2012-08-06 03:18:24 -0400] paulmooring: so on a new/clean system source fails, but if you use the default first it will succeed?
[2012-08-06 03:18:30 -0400] paulmooring: and on what distro?
[2012-08-06 03:18:37 -0400] tigris: correct, ubuntu
[2012-08-06 03:18:49 -0400] paulmooring: 12.04?
[2012-08-06 03:18:50 -0400] bawt: 12.04 is LTS, yay!
[2012-08-06 03:19:26 -0400] tigris: 12.04... the problem is, firstly in the http_geoip_module, it expects /etc/nginx/conf.d to exist, which it does not by default
[2012-08-06 03:19:48 -0400] tigris: then the problem is http_realip_module expects to be able to reload nginx after installing a template, but the service does not exist yet
[2012-08-06 03:20:14 -0400] tigris: I can fix all these problems, but as I mentioned, I am finding different problem every day, my pull request on github is getting quite large
[2012-08-06 03:20:19 -0400] tigris: https://github.com/opscode-cookbooks/nginx/pull/18
[2012-08-06 03:22:46 -0400] paulmooring: tigris: Do you have an account on tickets.opscode.com?
[2012-08-06 03:23:41 -0400] tigris: paulmooring: would that be what I created in order to create http://tickets.opscode.com/browse/COOK-1483 ?
[2012-08-06 03:23:49 -0400] tigris: if so, then yes
[2012-08-06 03:24:06 -0400] paulmooring: tigris: probably so, you filled out a CLA?
[2012-08-06 03:24:51 -0400] tigris: paulmooring: no
[2012-08-06 03:25:03 -0400] paulmooring: if you want the details on how to get this accepted check out this page: http://wiki.opscode.com/display/chef/How+to+Contribute
[2012-08-06 03:25:08 -0400] zts: tigris: I don't use the nginx cookbook, but I'm confused by your comment about http_realip_module - that recipe defines the nginx service before the template which does 'notifies' - what is the actual failure you are seeing?
[2012-08-06 03:25:59 -0400] tigris: zts: it defines the service, but there is no /etc/init.d/nginx file at this point, since these module recipes are being included before the source is compiled
[2012-08-06 03:26:15 -0400] paulmooring: but the tl;dr is we review resolved tickets in Jira (tickets.opscode.com), so if you fill out the CLA and mark that ticket resolved (with a link to your github pull) we'll check it out in our weekly code reviews
[2012-08-06 03:26:18 -0400] tigris: so the failure is "FATAL: Errno::ENOENT: service[nginx] (nginx::http_realip_module line 28) had an error: Errno::ENOENT: No such file or directory - /etc/init.d/nginx status"
[2012-08-06 03:27:14 -0400] paulmooring: and the CLA is super easy, there's a link on that page and it only takes 2 minutes or so to look it over and sign it
[2012-08-06 03:28:04 -0400] tigris: paulmooring: cool, i'll take a look... some of my fixes for the recipe are straight forward, others are not, i'd rather not submit those until someone takes a closer look
[2012-08-06 03:28:39 -0400] tigris: e.g. at some point chef must have changed from md5 checksums for remote files, yet all the nginx default attributes for checksums are still md5
[2012-08-06 03:28:44 -0400] tigris: that is a very easy fix
[2012-08-06 03:30:38 -0400] paulmooring: tigris: make sure you mark that ticket resolved as well
[2012-08-06 03:30:39 -0400] zts: tigris: hm, do you have the source recipe on your run list before the http_realip_module?
[2012-08-06 03:30:55 -0400] paulmooring: also many thanks community contributors make me super happy
[2012-08-06 03:32:21 -0400] tigris: zts: i don't include the realip recipe at all, i add it to the array of node['nginx']['source']['modules']
[2012-08-06 03:33:09 -0400] zts: tigris: ah sorry, I understand now
[2012-08-06 03:34:20 -0400] zts: reason I ask is that if the service resource is checking for the init script during the compile phase, that sounds like a bug with the resource to me
[2012-08-06 03:35:03 -0400] zts: but I'll test that for myself when I have some time
[2012-08-06 03:39:14 -0400] zts: Nah, you're right.  The source recipe includes the module recipes earlier than it sorts out the init stuff, so it would still be broken during the compile phase.  I guess the right fix is for the module recipes to use the new-style notifies syntax, so that they don't have to declare the service themselves
[2012-08-06 03:47:25 -0400] tigris: zts: i am not sure that will work either, the module recipes need to be included before compilation so they can set some compile time arguments, but they also need the ability to reload (the currently non-existing) service should the templates change due to node variables changing
[2012-08-06 03:48:01 -0400] tigris: you can't even specify a :delayed action for a service that doesn't yet exist
[2012-08-06 03:48:35 -0400] jtimberman: tigris: its "actively" maintained, in that we're still catching up on the back log of *all* COOK tickets.
[2012-08-06 03:49:01 -0400] jtimberman: also, i hate that nginx doesn't do dynamic module loading, and requires compiling if you want to do anything interesting :/
[2012-08-06 03:49:15 -0400] zts: tigris: you can if you use the new-style notifies syntax
[2012-08-06 03:49:34 -0400] zts: tigris: the difference is that the old style (which you see in that recipe) only works if service[nginx] has already been declared
[2012-08-06 03:49:44 -0400] zts: tigris: the new style will resolve the dependency later
[2012-08-06 03:49:50 -0400] hoover_damm: jtimberman, didn't ezra publish a super nginx cookbook at one point?
[2012-08-06 03:49:52 -0400] hoover_damm: heh
[2012-08-06 03:50:43 -0400] hoover_damm: jtimberman, you have my sympathies
[2012-08-06 03:50:52 -0400] jtimberman: hoover_damm: i don't know
[2012-08-06 03:51:12 -0400] hoover_damm: jtimberman, pretty sure he did at one point... but that is history
[2012-08-06 03:51:23 -0400] hoover_damm: nginx moves just about as fast as redis
[2012-08-06 03:51:33 -0400] hoover_damm: really too fast
[2012-08-06 03:52:00 -0400] jtimberman: well
[2012-08-06 03:52:18 -0400] jtimberman: thats a separate issue, that people always want the latest bleeding edge.
[2012-08-06 03:52:20 -0400] tigris: jtimberman: i thought that was what everybody *loved* about nginx over apache? compile everything in to make it faster :)
[2012-08-06 03:52:21 -0400] jtimberman: :)
[2012-08-06 03:52:46 -0400] hoover_damm: jtimberman, well bleeding edge / bleeding modules
[2012-08-06 03:52:49 -0400] hoover_damm: it feels about the same
[2012-08-06 03:52:51 -0400] hoover_damm: the burn that is
[2012-08-06 03:53:20 -0400] jtimberman: :)
[2012-08-06 04:04:18 -0400] jtimberman: tigris: yeaaaaah. i haven't even tried to benchmark to see if that is remotely an issue at this point.
[2012-08-06 04:08:03 -0400] hoover_damm: jtimberman, like spdy :)
[2012-08-06 04:08:13 -0400] hoover_damm: jtimberman, i'll stick to javascript hell with graphite
[2012-08-06 04:09:02 -0400] tigris: paulmooring: i've submitted that CLA thing and created individual tickets for all the small bugs i've found... if you can point me at some docs on how to attach patches to the ticket and resolve, i'll fly at it
[2012-08-06 04:10:53 -0400] ssd7: Ohai Chefs!
[2012-08-06 04:19:29 -0400] atomic-penguin: tigris, timberman is merge master for about 200 cookbooks (essentially that many distinct projects).  It takes a bit of time to get even trivial changes reviewed and merged.
[2012-08-06 04:55:41 -0400] stuartrexking: I have a resource that is not being notified by the notifies command in a template resource. How do I start to debug this? Here is a copy of the recipe https://gist.github.com/aee3be3f8a7fce34afb4
[2012-08-06 05:13:21 -0400] BryanWB_: ohai chefs!
[2012-08-06 05:16:34 -0400] stuartrexking: Is there a recommended way to poll a service to see if it's come up? I am using the jenkins cookbook from fnichol and I want to poll jenkins for a 200 http status so I know once it's up.
[2012-08-06 05:16:44 -0400] stuartrexking: Is there a better way?
[2012-08-06 05:18:19 -0400] tigris: stuartrexking: i believe your jenkins_job resource would only be notified if the template changes, i'd need to see the debug output of your run
[2012-08-06 05:19:00 -0400] stuartrexking: tigris: Thanks. I manage to work that out. Now I need to make sure Jenkins has actually started before attempting to do the job update.
[2012-08-06 05:19:05 -0400] tigris: stuartrexking: in regards to polling, are you talking about within a recipe, or just in general? e.g. a service like monit?
[2012-08-06 05:19:39 -0400] tigris: i've not used jenkins, does it take a while to come up?
[2012-08-06 05:19:44 -0400] stuartrexking: Recipe. Polling might not be the best technique. I just need to check that jenkins has started before trying to update jenkins_job.
[2012-08-06 05:19:53 -0400] stuartrexking: It takes a little while.
[2012-08-06 05:20:09 -0400] tigris: most daemons i've seen won't return until it's started
[2012-08-06 05:20:44 -0400] tigris: i.e. the jenkins service that is starting shouldn't just be triggering a start that will happen at some time in the future, it should block while it starts
[2012-08-06 05:21:21 -0400] tigris: but, i believe the correct way in chef is to use the "subscribes" function
[2012-08-06 05:22:19 -0400] stuartrexking: Thanks, I will take a look at that.
[2012-08-06 05:24:29 -0400] tigris: chefs, what would be the best way to set a variable inside of node.run_state based on the outcome of some shell command on the server?
[2012-08-06 05:25:16 -0400] tigris: ruby_block? node.run_state['my_stuff'] = `some_command` ?
[2012-08-06 05:35:21 -0400] stuartrexking: tigris: the problem with Jenkins is that the daemon returns but the server is not available until it's finished it's own initialization steps.
[2012-08-06 05:41:33 -0400] tigris: stuartrexking: IMO that is a problem with the daemon, i'm no chef expert so dunno how you can handle that in chef other than a ruby block that sleeps for 1 second on loop until some PID file exists
[2012-08-06 06:40:01 -0400] tigris: chefs, how do i mark http://tickets.opscode.com/browse/COOK-1525?focusedCommentId=25867#comment-25867 as resolved?
[2012-08-06 06:53:48 -0400] railsraider: i wrote a library that connects to a database using active record, how can i install active record before that require 'active-record'
[2012-08-06 06:54:38 -0400] railsraider: i can do the ugly meta data that will run before and call another cookbook just to install it but yack, there has to be a better way
[2012-08-06 07:07:37 -0400] railsraider: I'm basically looking for what to do when a library requires a gem that isn't install yet, i can not use the gem_package cause chef-client  is not aware of the Gem Package Resource yet
[2012-08-06 07:18:26 -0400] tigris: libraries are the first thing loaded, i'm no expert but I dunno if you're gonna be able to get chef to do anything before loading your library
[2012-08-06 07:18:47 -0400] tigris: http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2012-08-06 07:19:58 -0400] tigris: can you wrap the guts of your library in a begin/rescue so that it compiles gracefully if A/R does not yet exist?
[2012-08-06 07:41:33 -0400] railsraider: tigris: so can i just use back ticks with a simple gem install activerecord?
[2012-08-06 07:42:49 -0400] tigris: railsraider: no but you can use the "execute" provider
[2012-08-06 07:42:52 -0400] tigris: err, resource
[2012-08-06 07:43:12 -0400] railsraider: tigris: resources are not loaded before libraries
[2012-08-06 07:43:39 -0400] tigris: railsraider: although i was thinking you would wrap your library in begin/rescue, then you can use gem_package like normal and call your library after the gem_package, it should get inside the begin block when you run it
[2012-08-06 07:44:22 -0400] tigris: from your recipe you would call `gem_package "activerecord"` and then sometime after that call the method in your library
[2012-08-06 07:44:50 -0400] railsraider: can't, my  lib is establishing a connection to active record
[2012-08-06 07:45:10 -0400] railsraider: so it yells that constant ActiveRecord is not found
[2012-08-06 07:45:26 -0400] railsraider: i'll just put it in a meta.rb
[2012-08-06 07:45:35 -0400] railsraider: separate recipe yack
[2012-08-06 07:45:47 -0400] railsraider: just to install active record
[2012-08-06 07:48:09 -0400] tigris: https://gist.github.com/7bf34fe66f58358d83a6 is what i was thinking
[2012-08-06 08:41:59 -0400] cnf: how do i backup / restore my client/nodes in chef?
[2012-08-06 08:43:30 -0400] bahman2000: backup like full data backup?
[2012-08-06 08:43:55 -0400] cnf: I can restore cookbooks and roles and databags from git
[2012-08-06 08:44:02 -0400] bahman2000: yup
[2012-08-06 08:44:06 -0400] cnf: but how do i get all my clients back in case of disaster?
[2012-08-06 08:44:56 -0400] bahman2000: backup the data
[2012-08-06 08:45:21 -0400] bahman2000: config is in cookbooks and in git
[2012-08-06 08:46:04 -0400] _rc: cnf: with the backup plugin from knife-hacks. https://github.com/stevendanna/knife-hacks/blob/master/plugins/backup_export.rb
[2012-08-06 08:46:07 -0400] cnf: the clients are not
[2012-08-06 08:46:35 -0400] cnf: _rc: does that backup your clients?
[2012-08-06 08:46:58 -0400] _rc: it backs up your nodes.  if that's what you mean by clients, yes
[2012-08-06 08:47:08 -0400] cnf: no, i mean clients
[2012-08-06 08:47:08 -0400] _rc: if you mean the client certs, no
[2012-08-06 08:47:30 -0400] cnf: if i restore to a new chef servers, none of my clients can connect
[2012-08-06 08:48:01 -0400] _rc: the certs then
[2012-08-06 08:49:03 -0400] cnf: so how do people backup (and restore) those?
[2012-08-06 08:50:48 -0400] royh: cnf: on a per server basis.
[2012-08-06 08:51:00 -0400] cnf: royh: yes, but HOW?
[2012-08-06 08:51:04 -0400] royh: cnf: you can make the servers regeneretate a cert if you lose it
[2012-08-06 08:51:12 -0400] royh: cnf: how do you normally do backups?
[2012-08-06 08:51:27 -0400] cnf: that depends
[2012-08-06 08:51:50 -0400] royh: ok. do it according to any policy you have on backups
[2012-08-06 08:52:09 -0400] bahman2000: :)
[2012-08-06 08:52:30 -0400] cnf: if you don't know, just say you don't know...
[2012-08-06 08:52:37 -0400] bahman2000: i imagine that your client.pem have to be backed up to re-authenticate, no?
[2012-08-06 08:52:59 -0400] royh: bahman2000: no that's the pem file for the client that has already authenticated.
[2012-08-06 08:53:07 -0400] cnf: bahman2000: those are on the clients
[2012-08-06 08:53:24 -0400] royh: validation.pem is generally the name on the pem you need to regenerete a certificate
[2012-08-06 08:53:44 -0400] royh: but then you need to delete the certificate from the client in your chef server too
[2012-08-06 08:54:13 -0400] cnf: so how do you restore your client list to your chef-server after a recovery?
[2012-08-06 08:54:16 -0400] cnf: that is the question
[2012-08-06 08:54:21 -0400] bahman2000: why regenerate? if you use the same validation.pem and client.pem, while server keys are the same, server will recognize this new client as old client
[2012-08-06 08:54:54 -0400] royh: bahman2000: true. it depends on your needs. i just listed two alternatives :)
[2012-08-06 08:55:42 -0400] royh: cnf: less facepalming over people trying to help might be a good thing to do if you want help...
[2012-08-06 08:55:54 -0400] bahman2000: so my clients go up in smoke, i want to bring them back: if i have validation and client pems backed up; same for server, i'm good, no?
[2012-08-06 08:56:02 -0400] cnf: royh: i have yet to see any actual help
[2012-08-06 08:56:32 -0400] royh: cnf: knife client create or backup the database
[2012-08-06 08:56:34 -0400] bahman2000: cnf this is private chef we're talking about?
[2012-08-06 08:56:52 -0400] cnf: bahman2000: yes
[2012-08-06 08:57:31 -0400] bahman2000: def backup the db
[2012-08-06 08:57:44 -0400] royh: bahman2000: yes.
[2012-08-06 09:00:12 -0400] royh: bahman2000: http://wiki.opscode.com/display/chef/Backing+Up+Chef+Server#BackingUpChefServer-ExportobjectsfromtheChefserver
[2012-08-06 09:00:26 -0400] bahman2000: cnf ^ :)
[2012-08-06 09:00:40 -0400] royh: you can also just bootstrap a new server.
[2012-08-06 09:01:09 -0400] royh: you don't need the client.pem in order to get the "same" server back if you have all the recipe, databags, etc. backed up
[2012-08-06 09:02:01 -0400] bahman2000: royh how will server know what node is what then?
[2012-08-06 09:02:36 -0400] royh: bahman2000: what do you mean? the server holds all the data on what is what. the server fetches that information from the server when you run chef-client on the clients
[2012-08-06 09:03:07 -0400] royh: intuitively you know this already: if you change a run list on the server the clients automatically gets this information on the next run.
[2012-08-06 09:03:14 -0400] cnf: yes, already read that
[2012-08-06 09:03:25 -0400] bahman2000: royh if i don't have same validator and client pem on client then it will register as a new client not the old one with existing runlists
[2012-08-06 09:03:43 -0400] royh: bahman2000: with the same fqdn it will be the same server...
[2012-08-06 09:04:05 -0400] royh: of course it all depends on your bootstrapper
[2012-08-06 09:05:20 -0400] bahman2000: royh - your scenario is server dead, clients still alive and you're trying to rebuild just server :) ?
[2012-08-06 09:06:28 -0400] royh: if your bootstrapper installs chef-client (and all needed deps), copies over the validation.pem file and deletes the current client.pem from the server all you need to do is to run chef-client and it will reauth, get the old run-list, fetch all the recipes it from the server and do it's normal job.
[2012-08-06 09:06:43 -0400] royh: bahman2000: no. this is in the case where a client dies.
[2012-08-06 09:07:07 -0400] royh: bahman2000: if the client is still alive but the server isn't you need a backup of the server database.
[2012-08-06 09:07:23 -0400] royh: bahman2000: restore it and you're back to business.
[2012-08-06 09:07:30 -0400] bahman2000: royh so as long as fqdn is the same client will be recognized
[2012-08-06 09:07:54 -0400] royh: bahman2000: unless your bootstrapper does something crazy, like deleting a node that already exists etc.
[2012-08-06 09:08:08 -0400] royh: but you need to make sure the server is set up for a client to reauth
[2012-08-06 09:08:26 -0400] royh: you do this by deleting the certficate for the client on the server.
[2012-08-06 09:08:47 -0400] royh: knife client delete <fqdn>
[2012-08-06 09:09:06 -0400] royh: this is very different from knife node delete <fqdn> (the latter being what you DONT want to do)
[2012-08-06 09:09:58 -0400] bahman2000: anyway i was just curious on cnf's behalf, here seeking some help with recipe[sql_server::server] :) anyone has experience?
[2012-08-06 09:10:08 -0400] royh: running chef-client (with validation.pem) installed on the server after removing the client from the chef server will make it regenerate a certficiate, register with the server and resume normal operation (get cookboks, runlists, roles, databags, etc)
[2012-08-06 09:10:13 -0400] royh: and run of course
[2012-08-06 09:10:36 -0400] royh: oh ok.
[2012-08-06 09:10:56 -0400] royh: well the issue of backing up your server can be quite complicated, although it doesn't have to
[2012-08-06 09:11:13 -0400] royh: the documentation on this area isn't the best. i had to figure it out the hard way through trial and error.
[2012-08-06 09:17:31 -0400] bahman2000: does anyone have sql_server opscode cookbook experience?
[2012-08-06 09:17:53 -0400] jimcrofty: hi all, i've got an issue where windows chef nodes aren't returned by 'knife search node' commands (except where the query is *:*)
[2012-08-06 09:18:21 -0400] jimcrofty: i've done a bit of digging and it appears to be a solr issue. i've rebuild indexes but that hasn't helped.
[2012-08-06 09:18:50 -0400] jimcrofty: There's a gist @ https://gist.github.com/3272471 highlighting the issue.
[2012-08-06 09:18:59 -0400] jimcrofty: Any ideas how I go about debugging this?
[2012-08-06 09:21:52 -0400] bahman2000: jimcrofty no but maybe you know how to get the opscode sql_server cookbook running :) ?
[2012-08-06 09:23:30 -0400] jimcrofty: was going to look at that, but extending our chef use to windows isn't looking good right now with this search issue :)
[2012-08-06 09:24:51 -0400] bahman2000: jimcrofty ima try search
[2012-08-06 09:27:59 -0400] bahman2000: jimcrofty i did this  knife search node "fqdn:EC2*" and it works?
[2012-08-06 09:29:38 -0400] bahman2000: jimcrofty this works too knife search node "platform:windows*"
[2012-08-06 09:31:18 -0400] jimcrofty: bahman2000, tried 'platform:windows', nothing. ditto on an fqdn search.
[2012-08-06 09:32:03 -0400] bahman2000: jimcrofty it works for me but not for you? odd
[2012-08-06 09:32:05 -0400] jimcrofty: windows nodes are only being returned on a wildcard search *:*. anything  more specific, fqdn, name, platform, roles, etc and they aren't returned in the results.
[2012-08-06 09:32:22 -0400] jimcrofty: linux nodes are fine though.
[2012-08-06 09:32:32 -0400] jimcrofty: baffling!
[2012-08-06 09:33:13 -0400] bahman2000: jimcrofty i keep trying and it keeps working...
[2012-08-06 09:34:35 -0400] jimcrofty: lucky you :)
[2012-08-06 09:35:42 -0400] jimcrofty: The node data is on solr but isn't returned by most queries. so I'm guessing the problem is with solr itself, either in query execution or in the indexing of the node data.
[2012-08-06 09:37:35 -0400] jimcrofty: the server and all clients are running 10.12. think I'll spin up fresh server and see if the problem is reproducable.
[2012-08-06 09:38:07 -0400] bahman2000: jimcrofty fwiw i'm using hosted chef
[2012-08-06 09:38:55 -0400] zts: jimcrofty: you may be hitting this bug: http://tickets.opscode.com/browse/CHEF-2346
[2012-08-06 09:39:42 -0400] jimcrofty: zts: no, tried the maxFieldLength changes and index rebuild. no change.
[2012-08-06 09:40:35 -0400] jimcrofty: guess I could try increasing maxFieldLength even more. windows nodes do seem to have a lot of ohai data (not sure if that's indexed the same)
[2012-08-06 09:41:38 -0400] jimcrofty: anyone know how up to date open source chef is compared to the hosted version? does it lag by much?
[2012-08-06 09:43:55 -0400] bahman2000: if i were to guess i'd say open source is ahead of hosted?
[2012-08-06 09:52:04 -0400] bahman2000: schisamo asleep?
[2012-08-06 10:02:47 -0400] kernelPanik: Hi guys! :)
[2012-08-06 10:03:22 -0400] kernelPanik: I'm using tomcat cookbook... could you please let me know hot to set a different network port for tomcat ?
[2012-08-06 10:03:29 -0400] kernelPanik: *how
[2012-08-06 10:04:06 -0400] bahman2000: kernelPanik this one https://github.com/opscode-cookbooks/tomcat ?
[2012-08-06 10:05:42 -0400] kernelPanik: thanks <bahman2000> ,  so I can put in my attributes  node["tomcat"]["port"] = 'xxxx'  ... right?
[2012-08-06 10:06:13 -0400] bahman2000: kernelPanik i imagine it's best to do it as attributes in a role rather than in cookbook
[2012-08-06 10:07:04 -0400] kernelPanik: right! ok thanks
[2012-08-06 10:07:10 -0400] bahman2000: there is a Usage part on the page, shows how to set java_options, use similar syntax to set the port
[2012-08-06 10:20:24 -0400] cpasmoi: does chef-client uses a specific environment ?
[2012-08-06 10:20:52 -0400] cpasmoi: seems like the same command success in bash but not via chef-client
[2012-08-06 10:21:35 -0400] cpasmoi: futhermore, a redirecting log features doesn't work via chef-client
[2012-08-06 10:23:36 -0400] jimcrofty: cpasmoi: use '-L, --logfile LOGLOCATION' rather than redirection
[2012-08-06 10:24:41 -0400] cpasmoi: chef-client -L ?
[2012-08-06 10:25:04 -0400] jimcrofty: chef-client -L /path/to/some/logfile.log
[2012-08-06 10:25:15 -0400] cpasmoi: oh nevermind, there was a user rights issue :)
[2012-08-06 10:25:19 -0400] jimcrofty: :)
[2012-08-06 10:25:22 -0400] cpasmoi: ok, thank you jimcrofty
[2012-08-06 10:26:24 -0400] cpasmoi: btw the scripts 'echo' isn't shown by the chef client
[2012-08-06 10:26:40 -0400] cpasmoi: (but that's not a problem anymore, as the logging feature works)
[2012-08-06 10:28:23 -0400] jimcrofty: don't echo/puts from recipes. use Chef::Log.info("Some info output") instead
[2012-08-06 10:28:42 -0400] jimcrofty: where info can be info, warn, debug, etc
[2012-08-06 10:29:05 -0400] cpasmoi: oh, nice
[2012-08-06 10:30:12 -0400] jimcrofty: you can then select log verbosity in chef-client with the --log_level switch
[2012-08-06 10:32:27 -0400] cpasmoi: and I guess I can change it in /etc/chef/client.rb ( http://wiki.opscode.com/display/chef/Chef+Configuration+Settings#ChefConfigurationSettings-logoutput ) \o/
[2012-08-06 10:47:15 -0400] railsraider: i've set override_attirbutes in a role but they are not applied in the recipe, i get undefined method []
[2012-08-06 10:47:46 -0400] railsraider:  "users::admin" => { "ssh_keys_folder" => "app-server", "ssh_keys" => ["id_rsa", "id_rsa.pub", "id_dsa", "id_dsa.pub",  "known_hosts"] }
[2012-08-06 10:47:56 -0400] railsraider: node['users:admin']['ssh_keys'].each do | sshfile |
[2012-08-06 10:48:19 -0400] railsraider: nm
[2012-08-06 10:48:27 -0400] railsraider: doh
[2012-08-06 11:03:03 -0400] kyank: Getting this error when running chef-client:
[2012-08-06 11:03:04 -0400] kyank: HTTP Request Returned 401 Unauthorized: Failed to authenticate as avalancheau-validator. Synchronize the clock on your host.
[2012-08-06 11:03:24 -0400] kyank: According to http://wiki.opscode.com/display/chef/Common+Errors this happens when your client machines clock is off by more than 15 minutes.
[2012-08-06 11:03:34 -0400] kyank: But the clock on the client is accurage.
[2012-08-06 11:03:41 -0400] kyank: *accurate
[2012-08-06 11:03:52 -0400] kyank: This is with Hosted Chef, BTW.
[2012-08-06 11:04:54 -0400] kyank: Any suggestions for how I might fix this?
[2012-08-06 11:11:25 -0400] workmad3: kyank: have you checked that your timezone is set correctly?
[2012-08-06 11:15:53 -0400] maruq: hi guys
[2012-08-06 11:16:26 -0400] maruq: I'm trying to use knife ec2 to launch some nodes & seem to be hitting "ERROR: Fog::Compute::AWS::Error: AuthFailure => AWS was not able to validate the provided access credentials"
[2012-08-06 11:16:56 -0400] bahman2000: kyank what does your hostname -f say ?
[2012-08-06 11:17:02 -0400] maruq: I've set the  knife[:aws_ssh_key_id] in knife.rb, and specify -S in the call
[2012-08-06 11:17:06 -0400] maruq: any ideas?
[2012-08-06 11:17:26 -0400] maruq: I know there used to be an issue with knife ec2 calling eu-west-1 region, is that still the case?
[2012-08-06 11:19:05 -0400] bahman2000: maruq you did all this http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide ?
[2012-08-06 11:20:44 -0400] maruq: bahman2000: I believe so, yes. that was the guide I was following
[2012-08-06 11:21:03 -0400] railsraider: kyank:  it refers to the machine you run knife from so just sync them
[2012-08-06 11:21:26 -0400] bahman2000: kyank i had those issues when hostname -f was resolving to localhost
[2012-08-06 11:22:33 -0400] bahman2000: maruq either you missed something or you using wrong credentials...
[2012-08-06 11:22:44 -0400] bahman2000: maruq this bit specifically http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide#EC2BootstrapFastStartGuide-Step2%253AConfigureAWSsettingsandtheknife.rbfile
[2012-08-06 11:22:48 -0400] maruq: bahman2000: things work fine if I ec2-run-instances, then knife bootstrap, but I'd like to eliminate a few steps ;)
[2012-08-06 11:24:41 -0400] bahman2000: maruq you have knife[:aws_secret_access_key] in knife.rb ?
[2012-08-06 11:24:54 -0400] maruq: yep
[2012-08-06 11:25:43 -0400] bahman2000: maruq your key_pair.pem in the right place?
[2012-08-06 11:26:07 -0400] maruq: @bahman I have aws_access_key_id, aws_secret_access_key, aws_ssh_key_id defined
[2012-08-06 11:26:57 -0400] maruq: @bahman it's in my ~/.ec2, which I'm passing in with -i option
[2012-08-06 11:27:08 -0400] bahman2000: maruq so you do -i ~/.ssh/key_pair_name.pem in ec2 server create?
[2012-08-06 11:27:36 -0400] maruq: bahman2000: yes. well, I point to .ec2, but yes
[2012-08-06 11:27:48 -0400] bahman2000: maruq i suspect it's got to be in ~/.ssh/ since it's ssh...
[2012-08-06 11:28:21 -0400] maruq: bahman2000: ok, symlinks away!
[2012-08-06 11:29:07 -0400] maruq: bahman2000: nope, still failed
[2012-08-06 11:29:29 -0400] bahman2000: maruq permissions on the key_pair_name.pem ?
[2012-08-06 11:29:49 -0400] bram__: .7
[2012-08-06 11:29:49 -0400] maruq: bahman2000: just chmod 400-ed them ;)
[2012-08-06 11:32:03 -0400] bahman2000: maruq review the definitions in knife.rb , :aws_ssh_key_id should be keypair name without .pem, re-copy-paste the :aws_access_key_id and :aws_secret_access_key
[2012-08-06 11:34:20 -0400] maruq: bahman2000: hmm, just changed everything so that pem name matched the -S flag & the aws_ssh_key_id value, still no go
[2012-08-06 11:34:30 -0400] maruq: bahman2000: might try a new key & see what happens
[2012-08-06 11:34:57 -0400] bahman2000: maruq just for kicks copy the key to ~/.ssh/ :)
[2012-08-06 11:36:58 -0400] kyank: bahman2000: hostname -f on my host machine gives Sentience.local (the hostname of my Mac).
[2012-08-06 11:38:04 -0400] bahman2000: kyank you timesynced and time zone is correct?
[2012-08-06 11:38:20 -0400] maruq: bahman2000: new key, in ~/.ssh, chmod 400. still get errors :(
[2012-08-06 11:38:39 -0400] kyank: bahman2000: Time is synced. Time zone is correct on my host.
[2012-08-06 11:39:04 -0400] kyank: bahman2000: On my vagrant guest the time zone is UTC, whereas my host is on AEST.
[2012-08-06 11:39:22 -0400] kyank: bahman2000: The times are correct for each time zone, however.
[2012-08-06 11:39:25 -0400] bahman2000: maruq you update knife.rb right :) ?
[2012-08-06 11:40:34 -0400] bahman2000: kyank which one is your target node, your mac or vagrant?
[2012-08-06 11:40:56 -0400] kyank: vagrant is the node.
[2012-08-06 11:41:05 -0400] bahman2000: kyank hostname -f on vag
[2012-08-06 11:41:05 -0400] kyank: My Mac is the hostthe knife workstation.
[2012-08-06 11:41:31 -0400] kyank: bahman2000: The problem does not occur if I use the precise32 base box (which has chef 0.10.10 on it); however, I need chef 10.12. So I launched the precise32 base box without provisioning, installed chef 10.12 using the Omnibus installer, and did a sudo apt-get update && sudo aptitude safe-upgrade while I was at it.
[2012-08-06 11:41:57 -0400] kyank: bahman2000: I then packaged the box and tried to provision it. Thats when I encounter this error.
[2012-08-06 11:42:25 -0400] bahman2000: kyank that error is either timezone issue or hostname -f not resolving to fqdn on target node issue
[2012-08-06 11:42:28 -0400] maruq: bahman2000: yup, updated the knife.rb & passed things in via -i & -S
[2012-08-06 11:43:11 -0400] kyank: bahman2000: hostname -f on the node gives appname-vm
[2012-08-06 11:43:20 -0400] kyank: (where appname is the name of my app)
[2012-08-06 11:43:41 -0400] kyank: As specified in my Vagrantfile.
[2012-08-06 11:43:56 -0400] bahman2000: kyank make it resolve to fqdn
[2012-08-06 11:44:12 -0400] kyank: Its a vagrant VM. It has no fqdn.
[2012-08-06 11:45:10 -0400] kyank: Im guessing something in the aptitude safe-upgrade broke things. Im going to try building a box without that.
[2012-08-06 11:45:29 -0400] maruq: bahman2000: updated chef gem & knife ec2 gems, still no dice :(
[2012-08-06 11:45:54 -0400] bahman2000: maruq you're getting the same error?
[2012-08-06 11:45:55 -0400] maruq: I have things running through knife bootstrap, but it'd be nice to have knife ec2 if possible
[2012-08-06 11:46:27 -0400] maruq: bahman2000: yep. ERROR: Fog::Compute::AWS::Error: AuthFailure => AWS was not able to validate the provided access credentials
[2012-08-06 11:47:08 -0400] maruq: bahman2000: command looks like: knife ec2 server create -I ami-e901069d -x ubuntu --region eu-west-1 -Z eu-west-1a -G www-group -r "recipe[chef-client]" -T Name=testnode -i ~/.ssh/knife.pem -S knife
[2012-08-06 11:47:29 -0400] bahman2000: maruq i've done this at least a dozen times today: knife ec2 server create -I ami-c941efa0 --flavor t1.micro --availability-zone us-east-1c -i ~/.ssh/bahman2000key.pem -S bahman2000key
[2012-08-06 11:49:14 -0400] bahman2000: maruq you asked about the zone issue, it might still be the case, try different zone?
[2012-08-06 11:49:24 -0400] maruq: bahman2000: just ran that with my us-east-1 keys, still get the error
[2012-08-06 11:50:45 -0400] bahman2000: maruq i suspect it's the :aws_access_key_id and :aws_secret_access_key issue in your knife.rb. key id is NOT knife, right?
[2012-08-06 11:51:22 -0400] railsraider: I have no idea why the chef is not trying to follow my instructions as admin user and insisting on installing bundle as root http://pastie.org/private/c6aljd8bn1erq4cdqhjg
[2012-08-06 11:52:02 -0400] bahman2000: railsraider because of sudo su?
[2012-08-06 11:52:17 -0400] workmad3: I was about to ask about that too :)
[2012-08-06 11:52:42 -0400] railsraider: nope, it is admin when i ask whoami
[2012-08-06 11:52:47 -0400] maruq: bahman2000: I think it's that I was trying to be smart & pull values from my ENV. If I hardcode them, your example works
[2012-08-06 11:52:55 -0400] railsraider: this resource was working before
[2012-08-06 11:53:01 -0400] workmad3: railsraider: also, removing the Gemfile.lock, doing a bundle update and then trying a bundle install --deployment won't work
[2012-08-06 11:53:01 -0400] railsraider: i never touched it
[2012-08-06 11:53:16 -0400] workmad3: railsraider: that will cause bundler to complain
[2012-08-06 11:53:54 -0400] railsraider: i tried to add the bundle init cause i want the most up to date gems in the GemFile
[2012-08-06 11:53:59 -0400] railsraider: doesn't work
[2012-08-06 11:54:13 -0400] railsraider: willing to try anything you say
[2012-08-06 11:54:30 -0400] workmad3: railsraider: if you want to do a deployment install with bundler, you don't want to mess around with the gemfile
[2012-08-06 11:54:53 -0400] railsraider: ok
[2012-08-06 11:54:57 -0400] workmad3: railsraider: a deployment install is meant to use gem versions that are known to work (which is why it requires your Gemfile.lock to be committed and unchaged)
[2012-08-06 11:55:01 -0400] railsraider: i'll delete that line
[2012-08-06 11:55:21 -0400] kyank: bahman2000: FYI, not running aptitude safe-upgrade on my box fixed the problem for me. Time zones and times are the same. Bizarre.
[2012-08-06 11:56:37 -0400] workmad3: railsraider: if all you want to do is a bundle install... that entire script should really just be 'bundle install --deployment --path ...', with a user of "admin", a cwd of current_path and an interpreter of "bash" (and your only_if)
[2012-08-06 11:57:25 -0400] railsraider: k, looks like its working, i do remember that when it was done some gems were missing
[2012-08-06 11:59:15 -0400] bahman2000: kyank glad it worked :)
[2012-08-06 11:59:31 -0400] bahman2000: maruq nice :)
[2012-08-06 11:59:34 -0400] maruq: bahman2000: looks like it's working for my keys too. I had the secret & access keys being pulled from env, if I hardcode it works
[2012-08-06 12:04:23 -0400] railsraider: workmad3: thanks man, it works now, hopefully won't yell at me for missing gems
[2012-08-06 12:05:42 -0400] bahman2000: anyone familiar with sql_server cookbook ?
[2012-08-06 12:05:59 -0400] forestbird: when I use knife bootstrap, how will I update the chef-client later?
[2012-08-06 12:09:02 -0400] bahman2000: forestbird with a cookbook :)
[2012-08-06 12:09:30 -0400] forestbird: bahman2000: hmm, yeah. stupid question :
[2012-08-06 12:09:31 -0400] maruq: bahman2000: all looking good to me now. thanks ;)
[2012-08-06 12:10:12 -0400] bahman2000: maruq lucky you, i still can't figure out my problems :)
[2012-08-06 12:10:47 -0400] maruq: bahman2000: anything I can help with?
[2012-08-06 12:11:37 -0400] bahman2000: maruq can't seem to get https://github.com/opscode-cookbooks/sql_server to work
[2012-08-06 12:13:54 -0400] maruq: bahman2000: ah that sucks. Unfortunately my things are linux/mac only at the sec. I can try and take a look later tonight (after hours) though
[2012-08-06 12:22:02 -0400] bahman2000: maruq no biggie, i'll figure it out :)
[2012-08-06 12:22:36 -0400] maruq: bahman2000: good luck!
[2012-08-06 12:22:46 -0400] bahman2000: maruq you too :)
[2012-08-06 12:31:38 -0400] cnf: anyone have a nice cookbook for Cyrus?
[2012-08-06 12:36:02 -0400] cnf: or some other imap server cookbook
[2012-08-06 12:37:51 -0400] bahman2000: cnf postfix?
[2012-08-06 12:38:07 -0400] cnf: bahman2000: imap, not smtp
[2012-08-06 12:38:16 -0400] bahman2000: riiight
[2012-08-06 12:40:07 -0400] cnf: there is a difference
[2012-08-06 12:48:30 -0400] cnf: there should be more cookbooks for games, as well ^^;
[2012-08-06 12:50:03 -0400] bahman2000: cnf :)
[2012-08-06 12:50:10 -0400] cnf: stuff like steam etc
[2012-08-06 12:50:29 -0400] bahman2000: deploy a private could of steams lol
[2012-08-06 12:50:36 -0400] bahman2000: cloud
[2012-08-06 12:50:57 -0400] cnf: nah, just to make my home reinstall of my game pc easier
[2012-08-06 12:52:41 -0400] bahman2000: cnf windows_package resource won't work?
[2012-08-06 12:52:49 -0400] cnf: idno
[2012-08-06 12:52:52 -0400] cnf: never tried it
[2012-08-06 12:52:56 -0400] bahman2000: cnf http://wiki.opscode.com/display/chef/Opscode+LWRP+Resources#OpscodeLWRPResources-windows
[2012-08-06 13:12:23 -0400] railsraider: I am trying to make a library that will be connecting to an external database using active record, how can i install all the gems that needed for the library?
[2012-08-06 13:14:51 -0400] sampikesley: hey kids
[2012-08-06 13:15:01 -0400] sampikesley: I'm looking at cucmber-chef
[2012-08-06 13:15:17 -0400] sampikesley: what's the smallest EC2 node type it will realistically run on?
[2012-08-06 13:20:50 -0400] forestbird: where can I find some hints on how to organize an infrastructure? using env, roles, data bags etc. - i mean i'm looking for some advice from someone that has plenty of experience of how not to do it...
[2012-08-06 13:21:55 -0400] yfeldblum: forestbird, i think we all have different ways, and some of mine might be considered heretical
[2012-08-06 13:35:42 -0400] railsraider: yfeldblum: i wanna write my own library that connects to a database using active record any idea how to install the gem from the library?
[2012-08-06 13:36:20 -0400] yfeldblum: railsraider, prefer to install the gem in a recipe, and to put in your readme that this is a requirement for using the library
[2012-08-06 13:36:42 -0400] railsraider: k, thanks
[2012-08-06 14:06:58 -0400] forestbird: how about using the standard chef-repo.git? is that working out well over time?
[2012-08-06 14:08:17 -0400] yfeldblum: forestbird, it's not standard
[2012-08-06 14:08:25 -0400] yfeldblum: forestbird, it's a sample repo
[2012-08-06 14:09:11 -0400] yfeldblum: forestbird, i personally have no use for it though
[2012-08-06 14:09:34 -0400] forestbird: yfeldblum: ok, well, i'll just try it and see
[2012-08-06 14:30:50 -0400] zoubi: does chef-client auto-updates the machine by itself?
[2012-08-06 14:31:11 -0400] zoubi: I have local modifucations on a client which are overwritten by the default ones of the recipe
[2012-08-06 14:32:45 -0400] ashb: zoubi: yes, thats the whole point of chef
[2012-08-06 14:33:07 -0400] ashb: it makes the machine into the state defined by the recipes
[2012-08-06 14:33:38 -0400] zoubi: ashb, yeah, I get that, but after I install the machine using a recipe, is it supposed to restore to the recipe's default automatically?
[2012-08-06 14:33:42 -0400] zoubi: I guess not
[2012-08-06 14:33:55 -0400] ashb: is chef-client running as a deamon?
[2012-08-06 14:34:15 -0400] ashb: if so it will run in the background every 30mins and put it back to the state described in the recipes
[2012-08-06 14:34:46 -0400] zoubi: that's my problem then
[2012-08-06 14:35:01 -0400] ashb: i suggest not making local changes
[2012-08-06 14:35:11 -0400] zoubi: how can I disable this? (but leave the chef-client daemon running in the background)
[2012-08-06 14:35:46 -0400] ashb: you can't
[2012-08-06 14:36:00 -0400] stormerider: so, i have a question about using knife ec2. if i start an instance like that, it spins it up and bootstraps chef, and allows me to specify an initial run list to work with (which is nice). however, if i do a simple "chef-client" run afterwards it uses a blank runlist, i have to do "chef-client -j /etc/chef/first-run.json" or whatever that file is named.
[2012-08-06 14:36:31 -0400] zoubi: ashb :( and how I can disable the daemon?
[2012-08-06 14:36:31 -0400] stormerider: is there a way to get further chef runs to use the original runlist, or do i have to attach it to the node?
[2012-08-06 14:36:41 -0400] ashb: zoubi: its a standard unix service
[2012-08-06 14:47:44 -0400] yfeldblum: zoubi, how about ... experiment from within chef, instead of experimenting directly on the servers?
[2012-08-06 14:48:31 -0400] zoubi: yfeldblum, what you mean?
[2012-08-06 14:49:13 -0400] yfeldblum: zoubi, "<zoubi> I have local modifucations on a client" don't do that
[2012-08-06 15:09:39 -0400] cnf: hmm, weird errors again
[2012-08-06 15:10:14 -0400] cnf: https://github.com/opscode-cookbooks/openldap/blob/master/attributes/default.rb#L19 gives me NoMethodError: undefined method `length' for nil:NilClass
[2012-08-06 15:10:25 -0400] cnf: and i have no idea where that domain thing is supposed to be set
[2012-08-06 15:14:55 -0400] yfeldblum: cnf, node["domain"] is nil
[2012-08-06 15:15:34 -0400] yfeldblum: cnf, and i can't see where it's supposed to be set either
[2012-08-06 15:16:23 -0400] cnf: well, at least it's not just me, then :P
[2012-08-06 15:16:53 -0400] cnf: hmm
[2012-08-06 15:17:03 -0400] ashb: possibly /etc/hosts not set correctly?
[2012-08-06 15:17:12 -0400] cnf: yfeldblum: i just need to set :domain => 'somestring' in my attributes, no?
[2012-08-06 15:17:45 -0400] yfeldblum: cnf, it may be an ohai attribute
[2012-08-06 15:17:51 -0400] cnf: hmz
[2012-08-06 15:18:46 -0400] ashb: cnf: what does hostname -f say?
[2012-08-06 15:18:49 -0400] sascha_d: ohai domain will give you the answer
[2012-08-06 15:18:55 -0400] sascha_d: it is an ohai attr
[2012-08-06 15:19:11 -0400] cnf: ohai domain errors
[2012-08-06 15:19:22 -0400] sascha_d: mine is "local" if that helps :)
[2012-08-06 15:19:47 -0400] sascha_d: have to look at the source code to find out what it's parsing
[2012-08-06 15:20:11 -0400] ashb: cnf: for me a year or two back I had to manually edit /etc/hosts on a new EC2 instance
[2012-08-06 15:20:25 -0400] cnf: ashb: that just sucks
[2012-08-06 15:21:11 -0400] ashb: i never looked into it enough - the bootstrap template can probably be made to do it
[2012-08-06 15:21:53 -0400] cnf: hmm, yeah i don't know how ohai gets the domain name
[2012-08-06 15:21:55 -0400] cnf: :/
[2012-08-06 15:22:16 -0400] sascha_d: https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/hostname.rb
[2012-08-06 15:22:35 -0400] sascha_d: it's parsing the fqdn
[2012-08-06 15:23:21 -0400] cnf: and where does it get that?
[2012-08-06 15:23:34 -0400] geekbri: https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/linux/hostname.rb
[2012-08-06 15:23:40 -0400] geekbri: That is where its snagging the hostname from
[2012-08-06 15:24:02 -0400] geekbri: (Assuming you are using linux, if not switch that linux directory to whaterver you are using)
[2012-08-06 15:24:16 -0400] cnf: hmz
[2012-08-06 15:25:44 -0400] sascha_d: so if your fqdn has no mid level domain name, there could be issues
[2012-08-06 15:26:12 -0400] cnf: indeed
[2012-08-06 15:26:14 -0400] sascha_d: Mine parsed to "local" from "Saschas-MacBook-Air.local"
[2012-08-06 15:27:07 -0400] cnf: silly cookbook
[2012-08-06 15:27:39 -0400] cnf: anyway thanks
[2012-08-06 15:27:44 -0400] cnf: i'll look at it again tomorrow
[2012-08-06 15:51:49 -0400] skidx: hey all.. question.. I just finished http://www.jasongrimes.org/2012/06/deploying-a-lamp-application-with-chef-vagrant-and-ec2-3-of-3/ .. really loved it!! very easy to follow, and learned tons... I now want to set up a cookbook for ec2 windows... but really not finding a lot of info on it.. does anyone know a good walk through on this? From what I read so far, you have to issue a command after
[2012-08-06 15:51:49 -0400] skidx: it comes up to boottrap it using winrm... is this the case? mostly just want to install mysql, iis, and pull one git website down..
[2012-08-06 15:53:21 -0400] Pavel: ERROR: NoMethodError: undefined method `[]' for nil:NilClass has anyone seen this error before from the client?
[2012-08-06 15:53:40 -0400] jtimberman: Pavel: most commonly that is a node attribute that wasn't defined.
[2012-08-06 15:54:01 -0400] skidx: I did yesterday.. I found I had commas after the last entry in a json file.. removed them and it fixed it
[2012-08-06 15:54:19 -0400] yfeldblum: Pavel, when asking about an error you're seeing, you should always show the full backtrace too
[2012-08-06 15:54:36 -0400] jtimberman: via a link to a pastie, pastebin or gist thing :)
[2012-08-06 15:54:40 -0400] jtimberman: rather than pasting the whole thing here.
[2012-08-06 15:55:41 -0400] Doc_X: but typically, when you see "undefined method 'whatever' for nil:NilClass", it means whatever you're operating on likely hasn't been initialized properly (i.e. doesn't have a value in it)
[2012-08-06 15:55:45 -0400] Doc_X: that's typicaly ruby
[2012-08-06 15:58:56 -0400] Pavel: thanks guys, can you talk about "node attribute" what is that and where is that set?
[2012-08-06 15:59:28 -0400] Pavel: it was working last night, not sure what changed
[2012-08-06 15:59:33 -0400] paigeat: any idea why with chef 0.10.10 / vagrant / ubuntu 12.04 I would be having problems with Chef::Client::SANE_PATHS ?
[2012-08-06 16:00:33 -0400] Pavel: here is the stack trace http://pastie.org/4400486
[2012-08-06 16:02:16 -0400] jtimberman: Pavel: /var/chef/cache/cookbooks/deploy/recipes/svn.sync.rb:16:in `from_file'
[2012-08-06 16:02:49 -0400] jtimberman: Pavel: look at that line, or the block that line is in.
[2012-08-06 16:03:06 -0400] Pavel: ok
[2012-08-06 16:14:25 -0400] jameson_: :q
[2012-08-06 16:14:29 -0400] jameson_: this isn't vim..
[2012-08-06 16:19:10 -0400] thehar: lulz
[2012-08-06 16:22:27 -0400] cwj: passwords in here, everything else in that other window
[2012-08-06 16:24:16 -0400] geekbri: Sorry we will need your CC#, expiration date, and CCV code in order to confirm that this isn't a vim window
[2012-08-06 16:24:18 -0400] geekbri: please paste them here.
[2012-08-06 16:32:09 -0400] stormerider: anyone have a chance to look at my question, or should i repaste it? (dont want to spam channel)
[2012-08-06 16:35:17 -0400] jwitrick: stormerider: what do you mean 'further chef runs' ?
[2012-08-06 16:38:35 -0400] stormerider: so if i kick off chef client manually it has a blank runlist. im not sure if the daemon is still running on the original first-run runlist or not, not really familiar enough with chef to know how to find out, either
[2012-08-06 16:40:41 -0400] jwitrick: so with chef you should be able to manually run chef time and time again, with the exact same run list. How did you do your 'first-run' ?  I have run into the issue when im bootstraping a node where there is an error running chef, and the run_list is never applied back to the chef-server.
[2012-08-06 16:44:54 -0400] cdracars: trying to do a not_if if a table in a database exists.  How would I do that?
[2012-08-06 16:55:39 -0400] cdracars: trying to do a not_if if a table in a database exists.  How would I do that?
[2012-08-06 16:57:28 -0400] joonas: hi there, does anyone here happen to have experience getting postgresql set up with chef? Specifically, I'm having trouble getting the 'pg' gem installed which is required by the database cookbook
[2012-08-06 16:57:48 -0400] joonas: for whatever reason, it's not detecting libpq, even though I've all required packages installed
[2012-08-06 16:58:14 -0400] joonas: essentially, I'm running in to http://tickets.opscode.com/browse/COOK-1406
[2012-08-06 16:58:28 -0400] yfeldblum: not_if { db.has_table?("my_table") }
[2012-08-06 17:01:27 -0400] addisonj: quick question, so I am reusing a recipe across many roles in the same environment (it is for bootstrapping different apps). Because of that, it seems environment attributes can't be used because they apply to all the uses of that recipe in the environment, so does it make sense to make tiered roles? so myapp and then prod-myapp, staging-myapp?
[2012-08-06 17:02:21 -0400] forestbird: shouldn't bootstrap have started chef-client as a daemon or something?
[2012-08-06 17:02:29 -0400] forestbird: *knife bootstrap
[2012-08-06 17:03:05 -0400] stormerider: jwitrick: via knife ec2 create
[2012-08-06 17:03:18 -0400] stormerider: sorry, juggling a lot of balls atm, slow responses
[2012-08-06 17:08:28 -0400] cdracars: yfeldblum: do i need to specify the database
[2012-08-06 17:08:58 -0400] yfeldblum: cdracars, you need to specify all of the code between the braces (curly brackets)
[2012-08-06 17:10:00 -0400] cdracars: yfeldblum: so just the my_table to the table I am searching for what if there are two databases with the same table as is the case i have
[2012-08-06 17:10:30 -0400] yfeldblum: cdracars, in my example, i'm showing where the code goes, not what the code should be
[2012-08-06 17:10:55 -0400] cdracars: yfeldblum: thanks
[2012-08-06 17:24:03 -0400] paigeat: chef-server::rubygems-install doesn't install knife?
[2012-08-06 17:24:18 -0400] paigeat: nor does it install rubygems
[2012-08-06 17:24:20 -0400] paigeat: how does that work
[2012-08-06 17:25:44 -0400] hoover_damm: with magic pixie dust
[2012-08-06 17:25:46 -0400] hoover_damm: from elfs
[2012-08-06 17:26:15 -0400] Urocyon: comes with cookies?
[2012-08-06 17:26:18 -0400] hoover_damm: paigeat, chef-server::rubygems-install should install chef-server via rubygems not apt or (yum)
[2012-08-06 17:26:22 -0400] hoover_damm: obviously not yum
[2012-08-06 17:26:28 -0400] hoover_damm: but added for ..
[2012-08-06 17:27:32 -0400] hoover_damm: not sure why it would even touch ruby let alone rubygems... that should be done before you run that cookbook
[2012-08-06 17:54:57 -0400] awgross{flashma1: Anyone seen the issue where the Mail Handler for Chef-Client sends 100+ messages on failed run when running as a service, but only 1 (proper result) when run from the command line?
[2012-08-06 17:56:56 -0400] smw_: Can anyone tell me the syntax I would use if I want to call the package resource on multiple packages?
[2012-08-06 17:57:13 -0400] smw_: some sort of for each loop
[2012-08-06 17:57:28 -0400] smw_: I am very new to ruby
[2012-08-06 17:59:13 -0400] miah: myarray = %w(pkg1 pkg2 pkg3 pkg4)
[2012-08-06 17:59:27 -0400] miah: myarray.each { |pkg| package pkg }
[2012-08-06 17:59:59 -0400] smw_: miah, thanks
[2012-08-06 18:00:13 -0400] smw_: if I were to remove the %w, would I then need to add "" to each item?
[2012-08-06 18:00:33 -0400] yfeldblum: smw_, package "pkg1" ; package "pkg2" ; package "pkg3" (replace ; with newline if you like)
[2012-08-06 18:01:09 -0400] smw_: ?
[2012-08-06 18:01:17 -0400] smw_: yfeldblum, I don't understand
[2012-08-06 18:03:08 -0400] yfeldblum: smw_, http://pastie.org/private/hjtqt75bl3bnexkes0dja
[2012-08-06 18:04:18 -0400] smw_: yfeldblum, yeah, I need to do package pkg do action :install; end for all values of
[2012-08-06 18:04:30 -0400] smw_: I just don't want to repeat that entire thing 20 times
[2012-08-06 18:04:37 -0400] miah: you dont need to specify :install since its the default
[2012-08-06 18:04:55 -0400] smw_: really? interesting
[2012-08-06 18:05:17 -0400] miah: %w() is just ruby string literal. you can still do myarray = ['pkg1', 'pkg2', 'pkg3', 'pkg4'] if you'd like.. but its more typing =)
[2012-08-06 18:05:47 -0400] awgross{flashma1: smw_: yet another way to do it
[2012-08-06 18:05:48 -0400] awgross{flashma1: https://gist.github.com/a8b07feb500385529c4c
[2012-08-06 18:05:53 -0400] miah: http://wiki.opscode.com/display/chef/Resources#Resources-Package
[2012-08-06 18:05:57 -0400] miah: ^- install is default
[2012-08-06 18:06:31 -0400] smw_: awgross{flashma1, excellent, that makes more sense to me from my python background :-)
[2012-08-06 18:06:33 -0400] miah: awgross{flashma1: also.. %w(foo1 foo2 foo3).each ....
[2012-08-06 18:06:44 -0400] smw_: miah, thanks for teaching me that syntax also :-)
[2012-08-06 18:06:46 -0400] geekbri: miah: +1 that is what i do frequently
[2012-08-06 18:07:00 -0400] miah: i'd rather work with an array, because i can manage that
[2012-08-06 18:07:01 -0400] awgross{flashma1: yep miah just providing an alternative (Im also from a python background so it seems more natural to me)
[2012-08-06 18:07:25 -0400] geekbri: That syntax of course calls apart if you need to install a specific version of said packages, then you will need to do things differently :)
[2012-08-06 18:07:27 -0400] miah: and i can do fun things like this
[2012-08-06 18:07:28 -0400] miah: https://github.com/miah/chef-collectd/blob/master/recipes/_install_from_source.rb#L23
[2012-08-06 18:07:29 -0400] geekbri: calls = falls
[2012-08-06 18:08:04 -0400] smw_: where is gem_package defined?
[2012-08-06 18:08:05 -0400] JasonBox: hrm, full stack has ruby shadow?
[2012-08-06 18:08:08 -0400] awgross{flashma1: true geekbri
[2012-08-06 18:08:15 -0400] smw_: I can't find it in http://wiki.opscode.com/display/chef/Resources
[2012-08-06 18:08:26 -0400] awgross{flashma1: smw_: its one of the defaults that is a subset of package
[2012-08-06 18:08:28 -0400] smw_: an example shows up, but I want to know if installing is default
[2012-08-06 18:08:37 -0400] smw_: awgross{flashma1, what?
[2012-08-06 18:08:40 -0400] awgross{flashma1: smw_: http://wiki.opscode.com/display/chef/Resources#Resources-Package
[2012-08-06 18:08:48 -0400] awgross{flashma1: you can just call it
[2012-08-06 18:09:08 -0400] awgross{flashma1: be aware though, if you need the gem during the chef run, there is a different way to do it
[2012-08-06 18:09:10 -0400] smw_: right now I am doing gem_package "bundle" do action :install
[2012-08-06 18:09:15 -0400] miah: smw_: look at the provider section..
[2012-08-06 18:09:18 -0400] smw_: can this be simplified?
[2012-08-06 18:09:21 -0400] miah: yes
[2012-08-06 18:09:49 -0400] miah: package 'foo' do provider Chef::Provider::Package::Rubygems end
[2012-08-06 18:10:07 -0400] smw_: this is simpler than what I posted? lol
[2012-08-06 18:10:12 -0400] paigeat: anybody here tried making a chef server using vagrant and chef-solo?
[2012-08-06 18:10:25 -0400] miah: gem_package and package with the provider specified do the same thing
[2012-08-06 18:10:33 -0400] miah: but.. i dont like to rely on using gem_package
[2012-08-06 18:10:39 -0400] smw_: miah, ah, interesting
[2012-08-06 18:10:44 -0400] miah: i think its less clear what i'm doing
[2012-08-06 18:10:54 -0400] miah: its more obvious that i'm working with the package resource by using 'package'
[2012-08-06 18:11:29 -0400] miah: also, i dont tend to use gem package provider much because i use rbenv / rvm
[2012-08-06 18:11:48 -0400] miah: but, i do use the package provider with multiple distros and i prefer to still use 'package' rather than distro specific options.
[2012-08-06 18:13:40 -0400] paigeat: I see a potential problem with how chef-server is getting installed by vagrant / chef-solo
[2012-08-06 18:14:08 -0400] tolland: there is a cheftalk forum;
[2012-08-06 18:14:10 -0400] tolland: http://www.cheftalk.com/f/
[2012-08-06 18:14:12 -0400] paigeat: that may explain why its not working...
[2012-08-06 18:14:17 -0400] tolland: buts its about real chef-ing
[2012-08-06 18:14:36 -0400] tolland: i think it would be funny to start a chef-chef topic there
[2012-08-06 18:18:27 -0400] miah: i dont
[2012-08-06 18:19:23 -0400] rmcl: hi
[2012-08-06 18:20:07 -0400] rmcl: newb question: if I created a role in the opscode platform web interface can I download it with chef into the roles folder of my repo as json?
[2012-08-06 18:20:11 -0400] beandip: Anyone here able to get the jruby cookbook to work under ubuntu 12.04?
[2012-08-06 18:20:27 -0400] beandip: I keep having it crap out complaining that JAVA_HOME is not definted
[2012-08-06 18:20:27 -0400] yfeldblum: rmcl, yes
[2012-08-06 18:20:40 -0400] miah: rmcl: knife role show <role> -Fj > role.json
[2012-08-06 18:21:27 -0400] paigeat: damn
[2012-08-06 18:21:48 -0400] rmcl: miah: that did it, thanks!
[2012-08-06 18:21:59 -0400] flaccid_: beandip: probably a bug
[2012-08-06 18:23:46 -0400] beandip: flaccid_: yarp
[2012-08-06 18:24:00 -0400] beandip: I'm just confused wether it's in the jva cookbook or the jruby cookbook
[2012-08-06 18:25:27 -0400] flaccid_: beandip: debug mode will show in the stacktrace
[2012-08-06 18:25:35 -0400] miah: doesnt the java cookbook install jruby? at the very lease.. the rbenv or rvm cookbooks should.
[2012-08-06 18:25:52 -0400] miah: i havent tried yet though
[2012-08-06 18:26:57 -0400] jaylevitt: Anyone using postfix sasl_auth? main.cf.erb expects to have a smtp_tls_CAfile present, but that would only exist if I was using my own certs...
[2012-08-06 18:27:49 -0400] beandip: flaccid_: All I see in debug is that the java cookbook successfully executes:
[2012-08-06 18:27:52 -0400] beandip: [Mon, 06 Aug 2012 18:19:02 +0000] INFO: ruby_block[set-env-java-home] called
[2012-08-06 18:27:54 -0400] beandip: [Mon, 06 Aug 2012 18:19:02 +0000] INFO: Processing ruby_block[update-java-alternatives] action nothing (java::openjdk line 43)
[2012-08-06 18:27:56 -0400] beandip:  and further down....
[2012-08-06 18:28:24 -0400] beandip: => Fetching jruby source
[2012-08-06 18:28:27 -0400] beandip: # Build jruby from source targeted at 1.9 - patch that, yo.
[2012-08-06 18:28:29 -0400] beandip: Error: JAVA_HOME is not defined correctly.
[2012-08-06 18:28:30 -0400] beandip:   We cannot execute /usr/lib/jvm/java-6-openjdk//bin/java
[2012-08-06 18:28:33 -0400] beandip: then it craps out
[2012-08-06 18:28:48 -0400] stormerider: doesn't action nothing mean it doesn't actually fire? (still a newb, likely to be wrong)
[2012-08-06 18:29:55 -0400] awgross{flashma1: stormerider: yes, it is available to be notified however, pretty common pattern
[2012-08-06 18:30:10 -0400] beandip: ahhh
[2012-08-06 18:30:13 -0400] beandip: sigh
[2012-08-06 18:30:31 -0400] stormerider: right, so in this case, it means that it's there but needs to be signalled to fire, correct?
[2012-08-06 18:30:46 -0400] flaccid_: beandip: prolly jruby cookbook. it should be sourcing or setting JAVA_HOME for the build
[2012-08-06 18:31:43 -0400] awgross{flashma1: stormerider: yes, check out https://gist.github.com/92ebb63991d766289394
[2012-08-06 18:31:53 -0400] awgross{flashma1: a cleansed version of one of my scripts that uses the pattern
[2012-08-06 18:32:04 -0400] awgross{flashma1: mostly stolen from the Opscode examples
[2012-08-06 18:33:41 -0400] stormerider: for some reason it doesnt want to open links via click, i hae to right click and open link. need to fix that at some point.
[2012-08-06 18:34:12 -0400] stormerider: awgross{flashma1: perfect, that's what I was thinking of. bookmarking, if you dont mind.
[2012-08-06 18:34:51 -0400] awgross{flashma1: no problem, here is the link to the opscode doc that gave me the example http://wiki.opscode.com/display/chef/Resources#Resources-RemoteFile
[2012-08-06 18:34:56 -0400] awgross{flashma1: its the second example in the section
[2012-08-06 18:36:33 -0400] stormerider: awgross{flashma1: in the gist, is the URL for the package intended to be like that, or was that a typo?
[2012-08-06 18:39:26 -0400] awgross{flashma1: stormerider: its just a dummy url
[2012-08-06 18:41:06 -0400] stormerider: ah, ok. i thought with the } in there that you were using it as an attribute
[2012-08-06 18:41:35 -0400] stormerider: so used to Puppet that working with Chef feels very... overwhelming sometimes as a learning curve.
[2012-08-06 18:42:11 -0400] paigeat: this is weird
[2012-08-06 18:42:19 -0400] paigeat: I installed chef-server with vagrant and chef-solo
[2012-08-06 18:42:35 -0400] paigeat: and its installed ok but the init scripts point to /usr/bin/chef-server
[2012-08-06 18:42:43 -0400] paigeat: root@ChefServer:~# which chef-server
[2012-08-06 18:42:50 -0400] paigeat: ./usr/sbin/chef-server
[2012-08-06 18:42:54 -0400] paigeat: its in sbin...
[2012-08-06 18:43:37 -0400] paigeat: do people not use the init scripts rather daemontools or some other weird thing?
[2012-08-06 18:48:53 -0400] miah: runit ftw.
[2012-08-06 18:48:55 -0400] paigeat: . /usr/sbin/chef-server -> /opt/vagrant_ruby/bin/chef-server
[2012-08-06 18:49:20 -0400] paigeat: miah is that what you use?
[2012-08-06 18:49:38 -0400] paigeat: Im wondering if it'll solve my prob though
[2012-08-06 18:50:18 -0400] paigeat: because I tried bluepill and it didn't like what I have going on either... init is at least creating a symlink at some point granted its a symlink from sbin and not bin like it should be
[2012-08-06 18:51:36 -0400] paigeat: screw it I'll try it and see what it does real quick
[2012-08-06 18:52:57 -0400] paigeat: http://pastie.org/4401283
[2012-08-06 18:55:56 -0400] awgross{flashma1: paigeat: i know I have had issues with chef-client installing in different places on different distros / versions of same distro.  There is a part of chef that attempts to search all of these locations and use the best one, but i know it was having issues at one point
[2012-08-06 18:56:14 -0400] awgross{flashma1: paigeat: my solution was to just symlink wherever it ended up to the proper location on bootstrap
[2012-08-06 18:56:58 -0400] paigeat: yeah... I'm really looking hard for a way to do this with as few pit stops as possible though
[2012-08-06 18:58:00 -0400] paigeat: its got something to do with the fact that vagrant installs its own ruby ...
[2012-08-06 18:58:20 -0400] paigeat: and while vagrant is running it uses that and any ruby stuff that gets installed goes into vagrant's ruby
[2012-08-06 18:59:17 -0400] paigeat: it reminds me of python_virtualenv
[2012-08-06 18:59:59 -0400] akraut: Hey folks, I'd love some opinions on something.
[2012-08-06 19:00:06 -0400] akraut: Suppose I'm deploying several clusters that are all "prod" environment.
[2012-08-06 19:00:11 -0400] akraut: How do I keep them independent, but still use environments?
[2012-08-06 19:00:17 -0400] akraut: ie: A UK prod, a US prod, etc.
[2012-08-06 19:00:23 -0400] paigeat: miah btw http://pastie.org/4401307
[2012-08-06 19:00:41 -0400] paigeat: no time to investigate it I gotta fix some php stuff
[2012-08-06 19:00:50 -0400] paigeat: really wanna figure this out though
[2012-08-06 19:00:52 -0400] hoover_damm: akraut, use tags for regions? or locations?
[2012-08-06 19:01:13 -0400] hoover_damm: akraut, that's unfortunate but environments really don't know anythiing about location and to have to create several production environments for different dc's
[2012-08-06 19:01:19 -0400] hoover_damm: akraut, :( does not make me happy
[2012-08-06 19:01:21 -0400] geekbri: Anybody here used the package resource to install their own deb, and have it install the blasted thing ever single time instead of checking if its already there ?
[2012-08-06 19:01:40 -0400] akraut: hoover_damm: Yeah, that's what I'm running into. :-/
[2012-08-06 19:02:36 -0400] sascha_d: akraut... is there something in their host name or ohai data that sets data center servers apart from one another?
[2012-08-06 19:04:14 -0400] sascha_d: akraut... I wrote an ohai plugin that parses a host name because a client had encoded host names. We set environments (this is before Chef envs) based on information in the hostname
[2012-08-06 19:04:47 -0400] awgross{flashma1: geekbri: can you elaborate, i use dpkg provider to install
[2012-08-06 19:05:01 -0400] awgross{flashma1: geekbri: although I only have it triggered from a remote file check to see if a new version is out
[2012-08-06 19:05:17 -0400] awgross{flashma1: geekbri: before that it would attempt to install every time it ran
[2012-08-06 19:05:17 -0400] akraut: sascha_d: that might work. right now there's a "deployment ID" that is used, but that's still set manually.
[2012-08-06 19:05:55 -0400] geekbri: awgross{flashma1: I'm install monit via a .deb, unfortunately it seems like the package resource is doing an install of it every time it runs, even if the package is installed already.
[2012-08-06 19:06:04 -0400] sascha_d: so the trick is to either use ohai to detect your location as that attribute gets set really early in the chef run, or you can set the attribute when you bootstrap maybe
[2012-08-06 19:06:12 -0400] geekbri: awgross{flashma1: I checked in the provider, and it looks like it should be noop'ing if its installed already though
[2012-08-06 19:06:21 -0400] sascha_d: akrautor even network ranges
[2012-08-06 19:06:33 -0400] paigeat: ooooo
[2012-08-06 19:06:34 -0400] sascha_d: something that's unique about servers in one DC vs the other
[2012-08-06 19:06:39 -0400] paigeat: I think I found it
[2012-08-06 19:10:06 -0400] awgross{flashma1: geekbri: not sure whats going on there, can always force it to not run with a not_if condition
[2012-08-06 19:10:23 -0400] awgross{flashma1: geekbri: i didnt audit the .deb i was using to make sure it would noop
[2012-08-06 19:10:26 -0400] geekbri: awgross{flashma1: yeah I was trying to avoid that, as the package resource should be smart enough to do that without my help
[2012-08-06 19:18:24 -0400] tolland: can i update a run list from a recipe?
[2012-08-06 19:18:32 -0400] tolland: can i so that immediately, so other nodes see it?
[2012-08-06 19:21:19 -0400] serverchief: Hi
[2012-08-06 19:21:28 -0400] awgross{flashma1: tolland: Im sure you could since you can run arbitrary code, you could certainly just shell_out a command to run knife if you wanted to, although the entire setup seems against the way chef is structure
[2012-08-06 19:21:33 -0400] awgross{flashma1: tolland: what are you trying to do?
[2012-08-06 19:21:52 -0400] workmad3: tolland: yes, and sort of
[2012-08-06 19:21:56 -0400] serverchief: i'm trying to install chef-server using the wiki instructions on rhel5.8, and get the error FATAL: Errno::ENOENT: No such file or directory - /usr/lib/ruby/gems/1.8/gems/chef-10.12.0/distro/redhat/etc/init.d/chef-solr
[2012-08-06 19:22:03 -0400] serverchief: has anyone seen this?
[2012-08-06 19:22:19 -0400] tolland: this is just a hack to setup a demo aws cloud
[2012-08-06 19:22:23 -0400] workmad3: tolland: I'd be dubious about that sort of setup though
[2012-08-06 19:22:40 -0400] tolland: i want to create singleton instances of nagios::server... etc
[2012-08-06 19:23:17 -0400] tolland: so have the instances check search("node", "role:nagios\:\:server") and add it if it missing
[2012-08-06 19:23:18 -0400] workmad3: tolland: generally, I'd suggest you set things up to converge over a couple of runs rather than try to get everything somehow resolved in one run across multiple nodes
[2012-08-06 19:23:27 -0400] tolland: yes, I see that
[2012-08-06 19:24:01 -0400] tolland: i have a config that will push a knife out, so I can execute knife as the chef-client
[2012-08-06 19:24:20 -0400] ryker: shouldn't the chef omnibus installer create symlinks to chef-client so it's in the path?  Omnibus installer just installed chef-10.12.0-1.el6.x86_64.rpm and it didn't create any symlinks to chef-client which is under /opt/chef.
[2012-08-06 19:24:36 -0400] smw_work: How do you use knife with chef-solo?
[2012-08-06 19:25:06 -0400] mattray: smw_work: you don't
[2012-08-06 19:25:15 -0400] smw_work: I am attempting a knife cookbook delete -pa ruby, but I get ERROR: Your private key could not be loaded
[2012-08-06 19:25:25 -0400] mattray: smw_work: knife is for talking to the chef-server API
[2012-08-06 19:25:33 -0400] smw_work: mattray, so how do I delete my cookbook in my repo?
[2012-08-06 19:26:14 -0400] geekbri: Meh, if I write a method, toss it in a module in the Libraries directory for my cookbook.. then load it... there is no reasonable way to use that method inside of a block that gets passed to the only_if or not_if guards it there?
[2012-08-06 19:26:29 -0400] ryker: smw_work: with chef-solo your cookbooks are on your filesystem.  So you can just rm -rf the cookbook you want to delete.
[2012-08-06 19:26:32 -0400] mattray: smw_work: just remove it? I don't use solo
[2012-08-06 19:26:36 -0400] ashb: ryker: not necessarily - so long as the init script (or similar) can run it that's all that it needs to do
[2012-08-06 19:26:43 -0400] geekbri: I'd have to open up the Chef::Resource::Package class and include it there wouldn't i.
[2012-08-06 19:27:04 -0400] smw_work: mattray, I want to remove the vendor whatever that it also installed...
[2012-08-06 19:27:14 -0400] mattray: oh, in git?
[2012-08-06 19:27:22 -0400] smw_work: mattray, yes, knife acts on git too
[2012-08-06 19:27:32 -0400] mattray: gotcha
[2012-08-06 19:27:39 -0400] mattray: git branch to list the branches
[2012-08-06 19:27:43 -0400] ryker: ashb: it used to create symlinks.  I guess they removed that feature.
[2012-08-06 19:27:54 -0400] smw_work: mattray, I want to tell knife to not phone home (chef server)
[2012-08-06 19:27:58 -0400] ashb: ryker: https://gist.github.com/1325982 might be of use to you
[2012-08-06 19:28:08 -0400] smw_work: mattray, how does that help?
[2012-08-06 19:28:26 -0400] mattray: smw_work: well, it's not really unless you have it defined in your knife.rb
[2012-08-06 19:28:48 -0400] mattray: knife cookbook site vendor is just downloading the cookbook from the community site and vendor-branching it
[2012-08-06 19:29:09 -0400] mattray: use knife cookbook site download
[2012-08-06 19:29:19 -0400] mattray: that'll just give you the tarball, no git branch
[2012-08-06 19:29:21 -0400] smw_work: mattray, "ERROR: Your private key could not be loaded from /etc/chef/client.pem"
[2012-08-06 19:29:37 -0400] smw_work: mattray, I want the vendor branching
[2012-08-06 19:29:50 -0400] smw_work: but now  I want to remove a cookbook I ended up never using
[2012-08-06 19:30:51 -0400] mattray: smw_work: yeah, you'll have to use git to delete that branch
[2012-08-06 19:30:52 -0400] ryker: ashb: thx, but I just need a symlink to chef-client in my path, so i can run it at the command line easily.  Not a biggie.  I can just create one.  I was just surprised when chef-client wasn't in my path after a fresh install.
[2012-08-06 19:31:01 -0400] smw_work: mattray, ok, thanks
[2012-08-06 19:31:37 -0400] mattray: smw_work: knife cookbook site install assumes you want stuff in git if you're using git
[2012-08-06 19:31:47 -0400] mattray: smw_work: so use knife cookbook site download to avoid that
[2012-08-06 19:31:58 -0400] smw_work: I did want it in git
[2012-08-06 19:32:06 -0400] smw_work: I just want to remove it because I ended up never using it
[2012-08-06 19:32:10 -0400] mattray: ok, well there's no remove :(
[2012-08-06 19:32:19 -0400] mattray: at least, through knife
[2012-08-06 19:32:34 -0400] smw_work: I swear, chef-solo is made to not work on purpose :-P
[2012-08-06 19:32:46 -0400] mattray: smw_work: we use it every day
[2012-08-06 19:32:56 -0400] mattray: to install chef server ;)
[2012-08-06 19:33:28 -0400] smw_work: heh
[2012-08-06 19:33:43 -0400] geekbri: I am dev'ing with chef-solo as we speak :)
[2012-08-06 19:33:54 -0400] mattray: private chef's configuration is all managed with chef solo
[2012-08-06 19:34:15 -0400] smw_work: mattray, my point is that chef-solo was not made for real use. Tools that should work do not work as well because it fails to connect to the chef server
[2012-08-06 19:34:23 -0400] yfeldblum: smw_work, git rm -rf cookbooks/cookbook-i-dont-use ; knife cookbook delete cookbook-i-dont-use
[2012-08-06 19:34:33 -0400] mattray: smw_work: sounds like a bug in knife's behavior really
[2012-08-06 19:34:45 -0400] smw_work: mattray, I agree
[2012-08-06 19:35:03 -0400] smw_work: yfeldblum, um... it does not work without a chef server
[2012-08-06 19:35:04 -0400] mattray: because knife was designed to work with chef server and remote apis
[2012-08-06 19:35:22 -0400] yfeldblum: smw_work, works for me ...
[2012-08-06 19:35:27 -0400] mattray: but it should do some stuff
[2012-08-06 19:35:41 -0400] yfeldblum: smw_work, ah sorry misread that
[2012-08-06 19:37:20 -0400] geekbri: Isn't there a Knife-solo gem somebody made for using knife with chef-solo ?
[2012-08-06 19:37:53 -0400] geekbri: Can't speak to it too much as I haven't used it but looks you might want to consider this: https://github.com/matschaffer/knife-solo
[2012-08-06 19:38:26 -0400] stormerider: just out of curiosity, is there any way to support knife downloading cookbooks into a SVN repo vs. a git repo?
[2012-08-06 19:39:14 -0400] jtimberman: stormerider: not built in to any knife commands.
[2012-08-06 19:39:55 -0400] mattray: stormerider: knife cookbook site install just downloads the cookbook, doesn't check it in automatically
[2012-08-06 19:39:57 -0400] stormerider: ok, fair enough, thanks.
[2012-08-06 19:40:03 -0400] mattray: stormerider: if you're using SVN
[2012-08-06 19:40:44 -0400] stormerider: i cant remember which knife cookbook subcommand i used atm but it refused to do anything because i wasnt using a git repo.
[2012-08-06 19:41:05 -0400] stormerider: will have to test more.
[2012-08-06 19:41:07 -0400] jtimberman: mattray: knife cookbook site vendor and install are the same thing.
[2012-08-06 19:41:08 -0400] workmad3: stormerider: knife cookbook site install maybe?
[2012-08-06 19:41:26 -0400] stormerider: (and bug atlassian about getting git support implemented already...)
[2012-08-06 19:41:51 -0400] jtimberman: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/cookbook_site_vendor.rb
[2012-08-06 19:42:43 -0400] joonas: geekbri: I'm using knife-solo, it works alright
[2012-08-06 19:43:46 -0400] yfeldblum: smw_work, you can also try librarian-chef, which accomplishes a similar goal but without needing to have a chef-server
[2012-08-06 19:44:01 -0400] jsnapp: jtimberman, i have a question about recent commits to the users cookbook that revert a previous fix i made .. should i email you or discuss here or post somewhere else?
[2012-08-06 19:44:12 -0400] smw_work: libertarian chef... nice name
[2012-08-06 19:44:33 -0400] stormerider: is there a good write-up/breakdown of the various chef tools like berkshelf, librarian, etc.?
[2012-08-06 19:44:36 -0400] tolland: i dont mind the nodes converging over a few runs, but generally i need to declare the singleton instances somewhere atomically,
[2012-08-06 19:44:45 -0400] tolland: or something else in the recipe to check that
[2012-08-06 19:44:48 -0400] jtimberman: jsnapp: hum?
[2012-08-06 19:45:24 -0400] jtimberman: stormerider: only one i know of is this: http://christian-trabold.de/librarian-chef-vs-berkshelf
[2012-08-06 19:46:21 -0400] jsnapp: jtimberman: my fix was minor but necessary .. it was merged here https://github.com/opscode-cookbooks/users/commit/a6fa67e235038b4d5a4ccb767dcdcfe327db29b0
[2012-08-06 19:46:45 -0400] jsnapp: but then got lost here https://github.com/opscode-cookbooks/users/commit/22e5fdf8e9d5215847fd66757a1f7d1e5c3d60f6
[2012-08-06 19:47:27 -0400] jsnapp: jtimberman: so i wonder what i should do to get it back .. open a new ticket and pull request? reopen old ticket?
[2012-08-06 19:48:34 -0400] jsnapp: jtimberman: aside from that i'd also like to know how that particular commit affects the use of the chef-solo-search cookbook ... seems like it would break it's useful capability of searching databags even when using chef-solo
[2012-08-06 19:50:04 -0400] jtimberman: jsnapp: oh, sorry about that! Let me look
[2012-08-06 19:51:21 -0400] skidx: hi all.. another question... so, trying to make a ec2 ami for windows I can bring up and deploy stuff on.. I installed freesshd, and actually connected when I ran the create command after it was brought online.. but.. I get this error.. "AllowDesktopAccess failed" and it disconnects... is there a way around this?
[2012-08-06 19:53:03 -0400] skidx: I suspect it gets that error because the user account is not logged in to the desktop? would a auto login of the user of the user fix this?
[2012-08-06 19:54:53 -0400] skidx: if anyone could point me in the right direction.. I would really appreciate it :)
[2012-08-06 20:04:28 -0400] mattray: stormerider: both librarian and berkshelf have been on Food Fight
[2012-08-06 20:06:31 -0400] stormerider: mattray: food fight? not familiar with it. kind of got thrown into the chef ecosystem by my former cosysadmin when we started working more with AWS, and then he left so im playing catch-up.
[2012-08-06 20:06:50 -0400] mattray: foodfightshow.org
[2012-08-06 20:07:00 -0400] stormerider: mattray: thanks :)
[2012-08-06 20:08:12 -0400] geekbri: Anybody have an idea why I would be getting a 401 "Unauthorized" from the chef server from my newly restored laptop.  I'm using the same client.pem on two different machines.  On one machine chef-client runs fine, on the other machine I get unauthorized.
[2012-08-06 20:12:25 -0400] jtimberman: jsnapp: fixed it.
[2012-08-06 20:12:26 -0400] jtimberman: :)
[2012-08-06 20:14:13 -0400] atomic-penguin: I'm buried up to my neck in enterprise-y projects that don't work
[2012-08-06 20:14:28 -0400] beandip: So, I'm having an issue with the java cookbook under ubuntu 12.04 64bit
[2012-08-06 20:14:42 -0400] beandip: I seems the cookbook is not setting JAVA_HOME correctly
[2012-08-06 20:14:56 -0400] atomic-penguin: Basically ship a broken tomcat application, mysql and java rpms, and a 1,000 line shell script
[2012-08-06 20:15:09 -0400] beandip: looking through the code, I see that there's nothing in the default attributes for the ubuntu platform, so Ichanged that
[2012-08-06 20:15:12 -0400] atomic-penguin: Big-ass shell script which doesn't work to install it all
[2012-08-06 20:15:21 -0400] beandip: however, chef-client runs and returns the same thing as before
[2012-08-06 20:15:34 -0400] beandip: my question now is, where does chef look when setting the platform?
[2012-08-06 20:15:36 -0400] atomic-penguin: Why can't they just give me a freaking jar file and sql file
[2012-08-06 20:15:54 -0400] beandip: I want to find out if chef is somehow seeing ubuntu 12.04 64 bit as something else
[2012-08-06 20:16:34 -0400] beandip: 22through ohai, right?
[2012-08-06 20:19:17 -0400] jsnapp: jtimberman: great, thanks for the quick fix ... my other question is related to that same commit .. doesn't the "Check before using server-specific features" effectively prevent any use of chef-solo-search cookbook with this cookbook?
[2012-08-06 20:19:53 -0400] jtimberman: jsnapp: uh, it might. i'm not familiar with 'chef-solo-search'
[2012-08-06 20:20:44 -0400] jsnapp: jtimberman: https://github.com/edelight/chef-solo-search
[2012-08-06 20:21:00 -0400] mattray: beandip: it gets set by ohai, you can run ohai directly on the boxes to see what it's generating
[2012-08-06 20:21:24 -0400] jsnapp: i find it a useful cookbook ... when added to a chef-repo it gives the ability to search databags even with chef-solo
[2012-08-06 20:21:37 -0400] jtimberman: neat
[2012-08-06 20:21:48 -0400] jtimberman: i don't know if that will work with the users lwrp or not.
[2012-08-06 20:21:50 -0400] jsnapp: it's README documentation uses the users cookbook heavily as an example
[2012-08-06 20:22:13 -0400] jsnapp: i imagine that it won't work with the checks in place
[2012-08-06 20:22:19 -0400] jsnapp: just wondering
[2012-08-06 20:22:33 -0400] beandip: yeah
[2012-08-06 20:22:39 -0400] beandip: fuck it's generating the right info
[2012-08-06 20:23:03 -0400] beandip: has anyone else gotten the java cookbook to work properly under ubuntu 12.04 64bit?
[2012-08-06 20:24:31 -0400] jsnapp: jtimberman: do you think the check for chef-solo in the users cookbook are nonnegotiable?  I wonder how many others are using chef-solo-search that would be affected
[2012-08-06 20:25:33 -0400] jsnapp: jtimberman: duh, never mind about the chef-solo-search README .. it doesn't actually use the users cookbook as an example
[2012-08-06 20:26:18 -0400] jsnapp: still though the chef-solo-search functionality should be broken now for the users cookbook so i'm still wondering if those checks are nonnegotiable
[2012-08-06 20:26:42 -0400] jtimberman: jsnapp: i wouldn't say its non-negotiable. I'm sure that FC003 was created without knowledge (or use case?) of the chef-solo-search cookbook. today is the first i've heard of it myself.
[2012-08-06 20:27:30 -0400] jtimberman: we don't have authoritative control over the foodcritic project, and merely input good style and practices based on our experience with Chef, training users, and seeing patterns emerge in the community.
[2012-08-06 20:27:45 -0400] jsnapp: yeah, i don't know how long it's been around off hand ... i started using it about 5 months ago ... pretty useful specifically in regards to the users cookbook
[2012-08-06 20:28:01 -0400] jtimberman: in any kind of project, linting is often "best practice checking"
[2012-08-06 20:28:07 -0400] jtimberman: in my observatio
[2012-08-06 20:28:33 -0400] jtimberman: i beileve foodcritic can do exclusion of particular rules
[2012-08-06 20:29:05 -0400] ranjibd: yeah..like cucmber tags
[2012-08-06 20:29:25 -0400] ranjibd: s/cucmber/cucumber/
[2012-08-06 20:30:06 -0400] jsnapp: right, but it seems the linting actually drove those recent commits ... i mean having a warning that you're using chef-solo wouldn't be so bad but it's disappointing when good, available functionality gets taken away
[2012-08-06 20:32:39 -0400] spokrandt: ql at all?
[2012-08-06 20:43:28 -0400] beandip: Who here uses berkshelf?
[2012-08-06 20:44:13 -0400] jsnapp: jtimberman: so do you have any recommendation about the chef-solo-search and users cookbook? do i just open a ticket and pull request that reverts the checks for chef-solo if I want this considered?
[2012-08-06 20:44:18 -0400] joevandyk: what was that chef tool that let me pull in random cookbooks? something like bundler for chef
[2012-08-06 20:44:36 -0400] joevandyk: for chef-solo
[2012-08-06 20:48:10 -0400] mattray: joevandyk: librarian or berkshelf
[2012-08-06 20:48:25 -0400] joevandyk: mattray: thanks!
[2012-08-06 20:52:05 -0400] ivey: beandip: i help write berkshelf does that count? i mean, i use it, too
[2012-08-06 20:52:35 -0400] erikh: heh, I'm still trying to find the time to integrate it at work
[2012-08-06 20:52:38 -0400] erikh: I am a sad developer
[2012-08-06 20:53:13 -0400] ivey: erikh: instead of librarian or instead of nothing?
[2012-08-06 20:53:26 -0400] erikh: knife cookbook upload, baby
[2012-08-06 20:53:48 -0400] ivey: we've been having lots of success teaching various app devs how to write cookbooks on their own, using Berkshelf
[2012-08-06 20:53:51 -0400] erikh: I had some custom sync tools at my last place, but they're owned by that company
[2012-08-06 20:53:56 -0400] erikh: cool
[2012-08-06 20:54:37 -0400] ivey: lusis thinks some of what we're doing is heresy so I may have to drive up to atlanta to show him how awesome it is
[2012-08-06 20:54:45 -0400] erikh: haha
[2012-08-06 20:54:58 -0400] erikh: I can't say I agree with all of it either, but that's another topic
[2012-08-06 21:11:22 -0400] LarsN: pardon the extremely dumb question that will follow, but I'm looking at the documentation https://github.com/mattray/knife-hp and am at the step of setting up my knife.rb file.  i'm certain i'm doing it wrong as when i run knife afterwards I get the following error: http://pastie.org/4402004
[2012-08-06 21:11:52 -0400] LarsN: would someone be able to either point me at enough documentation for me to correct my own idiocy, or perhaps just point out what I'm doing wrong?  I'm up for either. :)
[2012-08-06 21:11:57 -0400] mattray: LarsN: yeah, I gotcha
[2012-08-06 21:12:08 -0400] mattray: LarsN: that attribute didn't get merged into fog
[2012-08-06 21:12:21 -0400] mattray: the HP maintainer seems to be ignoring my pull requests :/
[2012-08-06 21:12:41 -0400] mattray: and I haven't gone back and cleaned it up yet
[2012-08-06 21:12:45 -0400] mattray: let me dig up a patch
[2012-08-06 21:12:46 -0400] LarsN: oh, the HP_TENANT attribute, got it.
[2012-08-06 21:13:11 -0400] LarsN: Thanks mattray.
[2012-08-06 21:13:30 -0400] joemiller: can i set a variable on the node hash from a ruby_block ?
[2012-08-06 21:13:38 -0400] joemiller: and have later resources use that..
[2012-08-06 21:14:09 -0400] mattray: LarsN: https://github.com/mattray/knife-hp/commit/e0c97d0d01430db646d82ec71a702df4a367533a is the patch
[2012-08-06 21:14:33 -0400] mattray: essentially the HP docs call it one thing, I submitted a patch for fog to match that and the patch didn't get rolled in yet
[2012-08-06 21:15:25 -0400] mattray: and yes, I need to find some time to actually release knife-hp to rubygems
[2012-08-06 21:16:15 -0400] LarsN: no worries, the documentation was good enough to get me this far.  and I'm 98% ruby ignorant.
[2012-08-06 21:16:23 -0400] LarsN: which is a testiment to the documentation.
[2012-08-06 21:16:52 -0400] jaylevitt: Just submitted my first cookbook pull request.. am I really supposed to mark it "resolved"? That seems like it'd get taken off anybody's plate to look at: http://tickets.opscode.com/browse/COOK-1531
[2012-08-06 21:17:07 -0400] mattray: jaylevitt: yeah, resolved means there's a ready patch
[2012-08-06 21:17:30 -0400] jaylevitt: mattray: ok, I was confused by (what's probably the JIRA default) explanation of the "resolved" status
[2012-08-06 21:17:46 -0400] mattray: jaylevitt: open, resolved, closed
[2012-08-06 21:17:54 -0400] jaylevitt: ah! there's another secret step.
[2012-08-06 21:17:55 -0400] mattray: and the cookbook review adds "triaged"
[2012-08-06 21:18:51 -0400] mattray: and closed when merged to master for release
[2012-08-06 21:19:13 -0400] mattray: so usually jtimberman is doing that for cookbooks
[2012-08-06 21:19:15 -0400] jcran: where would be the best place to start for "super simple" cookbooks such as pulling down a git repository or adding a service ?
[2012-08-06 21:19:40 -0400] jcran: and do y'all suggest using vagrant for initial testing?
[2012-08-06 21:23:55 -0400] mattray: jcran: vagrant works pretty well for getting started
[2012-08-06 21:24:19 -0400] mattray: jcran: essentially it's just rolling out vms, so if that's your workflow that works too
[2012-08-06 21:26:55 -0400] jcran: mattray: k, thanks
[2012-08-06 21:27:28 -0400] mattray: jcran: feel free to ask questions, most people are happy to help when they're not too busy
[2012-08-06 21:28:15 -0400] stormerider: should knife ec2 create add the run-list you specify to the node on the chef server, or is that something that only knife bootstrap does?
[2012-08-06 21:28:18 -0400] jcran: one other quick thing - some recipes reference others - does that recipe need to be available under the same dir structure? https://github.com/opscode-cookbooks/tomcat/blob/master/recipes/default.rb
[2012-08-06 21:28:31 -0400] jcran: ^^ tomcat references java for example
[2012-08-06 21:28:41 -0400] ivey: for vagrant, yes
[2012-08-06 21:28:45 -0400] jcran: assuming chef-solo
[2012-08-06 21:29:07 -0400] joonas: I swear to god installing the 'pg' gem should be easier
[2012-08-06 21:29:15 -0400] ivey: it needs to be in the cookbooks_path but you can have multiple dirs in there
[2012-08-06 21:29:15 -0400] joonas: esp since the 'database' cookbook requires it
[2012-08-06 21:29:26 -0400] jcran: ivey: perfect, thanks!
[2012-08-06 21:30:03 -0400] erikh: apt-get install libpq-dev; gem install pg
[2012-08-06 21:30:21 -0400] erikh: might be libpq5-dev. can't remember.
[2012-08-06 21:31:01 -0400] mattray: stormerider: knife ec2 server create will take the -r from the CLI, there is no run list waiting for that box on the server
[2012-08-06 21:31:24 -0400] mattray: stormerider: you can always modify the run list after bootstrap
[2012-08-06 21:34:12 -0400] stormerider: mattray: i think im asking the opposite question. i want to spin up a new node on EC2 with a given run list and then have knife tell the server to attach that to the given node after it's registered.
[2012-08-06 21:34:39 -0400] stormerider: as it stands, if i check the node after it's up and running it has no runlist on the chef server
[2012-08-06 21:34:54 -0400] mattray: stormerider: oh, you can totally pass a run list at creation
[2012-08-06 21:35:24 -0400] mattray: stormerider: knife ec2 server create -S mray -G default -x ubuntu -I ami-4721882e -f m1.small -r 'recipe[annoyances],role[base],role[users],role[target]'
[2012-08-06 21:35:28 -0400] erikh: yeah, but what I think he's asking is how to preserve that runlist
[2012-08-06 21:35:36 -0400] stormerider: erikh: exactly
[2012-08-06 21:35:46 -0400] mattray: stormerider: that -r with the comma-separated list works
[2012-08-06 21:35:56 -0400] erikh: but it doesn't save it to the node, iirc?
[2012-08-06 21:36:06 -0400] mattray: yes, assuming the chef-client run succeeds
[2012-08-06 21:36:11 -0400] erikh: hrm.
[2012-08-06 21:36:22 -0400] mattray: if it fails it loses the run list
[2012-08-06 21:36:26 -0400] PRK_nz: Hi, I'm just trying to figure out some things in https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap/centos5-gems.erb . Where should the likes of first_boot be set so this works?
[2012-08-06 21:36:48 -0400] stormerider: ill have to look into that, then, because that wasnt what was happening for me the other day when i was testing, but im not sure i checked once i got the run to succeed.
[2012-08-06 21:37:03 -0400] mattray: PRK_nz: unless you really, really want to use gems, use https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap/chef-full.erb instead
[2012-08-06 21:37:07 -0400] stormerider: but failing = lost may have just been the issue
[2012-08-06 21:37:07 -0400] erikh: yeah, I haven't ever had that work for me either, but I'm using custom bootstrap stuff.
[2012-08-06 21:37:09 -0400] stormerider: thanks!
[2012-08-06 21:37:17 -0400] mattray: PRK_nz: assuming Chef 10.12
[2012-08-06 21:37:38 -0400] mattray: stormerider: yeah, if it fails, nothing gets saved, which is annoying
[2012-08-06 21:38:00 -0400] PRK_nz: mattray: no sorry, 0.10.8
[2012-08-06 21:38:12 -0400] mattray: PRK_nz: chef-full became the default with 0.10.10
[2012-08-06 21:38:55 -0400] PRK_nz: Imattray: I see. I see a chef_version though, will that still work if set to 0.10.8?
[2012-08-06 21:39:54 -0400] mattray: PRK_nz: the -j will populate the first_boot.json if that's what you want
[2012-08-06 21:40:06 -0400] mattray: PRK_nz: knife bootstrap -h
[2012-08-06 21:41:31 -0400] PRK_nz: mattray: Sorry, what does -h do? (can't see it in man page)
[2012-08-06 21:41:43 -0400] mattray: -h is help
[2012-08-06 21:41:56 -0400] PRK_nz: oh, duh, sorry :S
[2012-08-06 21:43:00 -0400] PRK_nz: So what exactly is templating out that bootstrap file? knife.rb?
[2012-08-06 21:44:55 -0400] PRK_nz: mattray: sorry, didn't tag you, question above ;)
[2012-08-06 21:45:42 -0400] mattray: PRK_nz: knife's bootstrap is taking that -j and passing it into the first-boot.json
[2012-08-06 21:46:46 -0400] mattray: PRK_nz: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap.rb#L110
[2012-08-06 21:47:49 -0400] PRK_nz: mattray: oh, bootstrap.rb! Thanks for that
[2012-08-06 21:48:10 -0400] mattray: that's trunk, I assume much hasn't changed there since 0.10.8
[2012-08-06 21:50:56 -0400] smw_work: Hi all, I wrote a ruby function that checks if a condition is met. I would like to run a command (using execute?) that only runs if the function returns false. How can I do this?
[2012-08-06 21:51:51 -0400] PRK_nz: mattray: so one more thing, where would I set the likes of chef_version? In knife.rb?
[2012-08-06 21:52:41 -0400] mattray: PRK_nz: "--bootstrap-version VERSION  The version of Chef to install"
[2012-08-06 21:52:46 -0400] mattray: with bootstrap
[2012-08-06 21:53:03 -0400] mattray: smw_work: http://wiki.opscode.com/display/chef/Resources#Resources-ConditionalExecution
[2012-08-06 21:53:04 -0400] PRK_nz: awesome, thanks
[2012-08-06 21:54:07 -0400] smw_work: mattray, thanks
[2012-08-06 22:03:30 -0400] smw_work: mattray, how do I define the method?
[2012-08-06 22:03:41 -0400] smw_work: mattray, when I just put it in the recipe, it did not work
[2012-08-06 22:04:40 -0400] smw_work: FATAL: NoMethodError: execute[install_juggernaut] (sparqlight::juggernaut line 19) had an error: NoMethodError: undefined method `npm_installed?' for Chef::Resource::Execute
[2012-08-06 22:05:08 -0400] mattray: smw_work: you'd put it in a library in your cookbook
[2012-08-06 22:05:19 -0400] smw_work: ok
[2012-08-06 22:09:05 -0400] smw_work: mattray, it works, thanks
[2012-08-06 22:15:57 -0400] joonas: hoover_damm: have you figured out how to solve the PQconnectdb() problem with installing 'pg' gem?
[2012-08-06 22:16:27 -0400] joonas: I was trying to use your postgresql cookbook, but that's the part I'm stuck on, it can't find PQconnectdb() even though libpq is installed and all
[2012-08-06 22:17:10 -0400] hoover_damm: joonas, omnibus?
[2012-08-06 22:17:29 -0400] joonas: hoover_damm: I'm guessing so, new to chef :)
[2012-08-06 22:17:36 -0400] joonas: using chef-solo here
[2012-08-06 22:17:59 -0400] hoover_damm: joonas, using the chef-full installer it installs a ruby that does not link against the 'system' openssl library
[2012-08-06 22:18:05 -0400] joonas: aha
[2012-08-06 22:18:07 -0400] hoover_damm: joonas, links against it's own.  Anywho that really isn't the issue
[2012-08-06 22:18:27 -0400] hoover_damm: joonas, the issue is that it's not the same soname(base?) as the system typically so you can't get it to link against libpq
[2012-08-06 22:18:36 -0400] hoover_damm: joonas, using a regular ubuntu12.04-gems template
[2012-08-06 22:18:50 -0400] joonas: ok
[2012-08-06 22:19:05 -0400] hoover_damm: system ruby, system rubygems
[2012-08-06 22:19:09 -0400] hoover_damm: then pg will link up right
[2012-08-06 22:19:43 -0400] hoover_damm: It sucks that the whole linker debacle hasn't really gotten a heck of a lot cleaner since ... I don't know... last time I cared was DragonFlyBSD
[2012-08-06 22:20:38 -0400] joonas: alright, so I need to rework some steps, and hopefully that'll fix this then
[2012-08-06 22:22:11 -0400] hoover_damm: Matt didn't solve that whole linkage debacle through VFS by now did he?
[2012-08-06 22:24:15 -0400] beandip: Can anyone recommend a good writeup or tutorial on managing chef through source rather than knife?
[2012-08-06 22:44:00 -0400] Majost: So the new version of RabbitMQ on Ubuntu 12.04 seems to fail to create the /var/run/rabbitmq directory when it is installed via chef
[2012-08-06 22:44:11 -0400] Majost: is this a known issue?
[2012-08-06 22:44:23 -0400] Majost: rabbitmq-server (2.8.5-1) to be specific
[2012-08-06 22:44:36 -0400] mattray: Majost: probably, I'm working with 2.8.5-1 right now
[2012-08-06 22:44:50 -0400] mattray: and have patches into master
[2012-08-06 22:45:18 -0400] Majost: ah... any expected release timeframe?
[2012-08-06 22:45:50 -0400] Majost: for the patches that is
[2012-08-06 22:46:17 -0400] mattray: Majost: probably within the week if things work as expected
[2012-08-06 22:47:05 -0400] Majost: excellent, thanks! =)
[2012-08-06 22:50:00 -0400] tolland: anything i do to the run list for a node seems to get blatted at the end of the client run
[2012-08-06 22:50:30 -0400] tolland: is there a "model" cookbook that deals with server pools
[2012-08-06 22:56:20 -0400] smw_work: jtimberman, are you here? Would you mind fielding a question about the god cookbook? The cookbook installed god to /usr/local/bin/god but /etc/service/god/run points to /usr/bin/god.
[2012-08-06 22:57:09 -0400] miah: god probably installs shims in /usr/bin
[2012-08-06 22:57:19 -0400] smw_work: shims?
[2012-08-06 22:57:37 -0400] beandip: hard links
[2012-08-06 22:57:38 -0400] miah: shims / symlinks / wrapper scripts that point to the real location
[2012-08-06 22:57:48 -0400] smw_work: /usr/bin/god does not exist
[2012-08-06 22:57:48 -0400] miah: ok
[2012-08-06 22:57:57 -0400] smw_work: it is causing god to not be run :-\
[2012-08-06 22:58:15 -0400] miah: fix it?
[2012-08-06 22:58:43 -0400] smw_work: is there a place to report a bug to the opscode cookbooks?
[2012-08-06 22:58:53 -0400] smw_work: (https://github.com/opscode/cookbooks)
[2012-08-06 22:58:54 -0400] hoover_damm: smw_work, tickets.opscode.com
[2012-08-06 22:58:59 -0400] smw_work: thanks
[2012-08-06 22:59:05 -0400] hoover_damm: smw_work, and btw you should be using github.com/opscode-cookbooks/
[2012-08-06 22:59:10 -0400] hoover_damm: the cookbooks/ repo is deprecated
[2012-08-06 22:59:13 -0400] hoover_damm: old style
[2012-08-06 22:59:38 -0400] smw_work: ok
[2012-08-06 23:00:34 -0400] jtimberman: http://wiki.opscode.com/display/chef/How+to+Contribute+to+Opscode+Cookbooks
[2012-08-06 23:01:08 -0400] smw_work: jtimberman, thanks
[2012-08-06 23:02:00 -0400] smw_work: jtimberman, any ideas why this would happen though?
[2012-08-06 23:11:22 -0400] jtimberman: smw_work: an incorrect assumption in the template
[2012-08-06 23:11:36 -0400] jtimberman: cookbooks/god/templates/default/sv-god-run.erb hardcodes /usr/bin/god
[2012-08-06 23:12:41 -0400] smw_work: jtimberman, http://tickets.opscode.com/browse/COOK-1533
[2012-08-06 23:13:09 -0400] smw_work: jtimberman, the cookbook installed god though. So shouldn't it know to look in /usr/bin/local?
[2012-08-06 23:13:19 -0400] smw_work: in theory it put it there
[2012-08-06 23:14:31 -0400] hoover_damm: smw_work, rubygems generally shoves crap in /usr/bin
[2012-08-06 23:14:37 -0400] hoover_damm: smw_work, only recently has that started to change
[2012-08-06 23:14:47 -0400] smw_work: ok, that makes sense
[2012-08-06 23:14:55 -0400] jtimberman: and that practice varies by method of Ruby installation
[2012-08-06 23:14:56 -0400] jtimberman: https://github.com/opscode-cookbooks/god/blob/master/templates/default/sv-god-run.erb#L6
[2012-08-06 23:15:03 -0400] hoover_damm: smw_work, stock rubygems will drop it in /usr/local/bin ... debian rubygems can put it in /usr/bin still reinstall rubygems
[2012-08-06 23:15:04 -0400] jtimberman: thats the thing telling it to use /usr/bin/god
[2012-08-06 23:15:10 -0400] hoover_damm: smw_work, it's weird
[2012-08-06 23:15:16 -0400] hoover_damm: smw_work, and annoying
[2012-08-06 23:15:19 -0400] smw_work: if I were to make a fix to it, how would I make it cross platform?
[2012-08-06 23:15:37 -0400] smw_work: Is there any way to anticipate where a binary will land when gems is run?
[2012-08-06 23:15:38 -0400] hoover_damm: PATH=/usr/local/bin:/usr/bin
[2012-08-06 23:15:39 -0400] hoover_damm: god
[2012-08-06 23:15:52 -0400] hoover_damm: don't overthink it
[2012-08-06 23:15:54 -0400] smw_work: right
[2012-08-06 23:16:04 -0400] smw_work: any reason to even set the path?
[2012-08-06 23:16:16 -0400] hoover_damm: no
[2012-08-06 23:16:37 -0400] smw_work: ok, I guess I will make a patch
[2012-08-06 23:16:55 -0400] hoover_damm: smw_work, and if there is a reason you can always use which... `which chef-client`
[2012-08-06 23:16:56 -0400] hoover_damm: lame
[2012-08-06 23:16:58 -0400] jtimberman: Gem.bin_dir shold have the right location for the binaries.
[2012-08-06 23:17:03 -0400] hoover_damm: but man it's less lame
[2012-08-06 23:17:15 -0400] hoover_damm: jtimberman, should ... if users break the ubuntu rubygems and reinstall it
[2012-08-06 23:17:21 -0400] hoover_damm: jtimberman, that gets a little wonky
[2012-08-06 23:17:23 -0400] jtimberman: i thought i had a ticket somewhere to update this across our cookbooks that use gem binaries
[2012-08-06 23:17:36 -0400] smw_work: jtimberman, if I wanted my patch accepted, what should I do?
[2012-08-06 23:17:50 -0400] smw_work: jtimberman, remove /usr/bin and just call god?
[2012-08-06 23:18:02 -0400] jtimberman: contributing?
[2012-08-06 23:18:02 -0400] bawt: contributing is http://wiki.opscode.com/display/chef/How+to+Contribute
[2012-08-06 23:18:02 -0400] smw_work: or use gem.bin_dir/god?
[2012-08-06 23:18:07 -0400] smw_work: jtimberman, yes
[2012-08-06 23:18:20 -0400] stormerider: as a disabled person, please dont use lame like that.
[2012-08-06 23:18:47 -0400] smw_work: jtimberman, , I am not asking how, I am asking what would be accepted. What are the conventions?
[2012-08-06 23:18:58 -0400] hoover_damm: smw_work, node['languages']['ruby']['bin_dir']
[2012-08-06 23:19:09 -0400] smw_work: ok
[2012-08-06 23:19:14 -0400] hoover_damm: smw_work, should provide the actual path to where it should land
[2012-08-06 23:19:41 -0400] hoover_damm: the loophole of rubygems reinstallation always has it's quirks
[2012-08-06 23:19:42 -0400] smw_work: hoover_damm, the question is which should I use?
[2012-08-06 23:20:16 -0400] hoover_damm: smw_work, i'd still use god over spoonfeeding it
[2012-08-06 23:20:20 -0400] hoover_damm: smw_work, trust the shell
[2012-08-06 23:20:34 -0400] smw_work: hoover_damm, same. I guess that is what I will do
[2012-08-06 23:21:37 -0400] smw_work: thanks for the help everyone
[2012-08-06 23:21:41 -0400] jtimberman: smw_work: wel, it depends actually.
[2012-08-06 23:21:56 -0400] smw_work: jtimberman, ?
[2012-08-06 23:21:57 -0400] bawt: jtimberman, is the wiki wrong? because i don't have /etc/service.d on karmic
[2012-08-06 23:22:13 -0400] hoover_damm: bawt, forget ?
[2012-08-06 23:22:14 -0400] bawt: couldn't find keyword ?
[2012-08-06 23:22:26 -0400] jtimberman: see, there's two ways to use Ruby where Chef is concerned. There's Ruby for Chef Itself, and there's Ruby For Your Application. Historically these were often the same Ruby, and just using Gem.bin_dir would do the right thing (it resolves to the bin dir of the ruby environment executing Chef).
[2012-08-06 23:22:42 -0400] jtimberman: bawt: forget jtimberman,
[2012-08-06 23:22:42 -0400] bawt: okay
[2012-08-06 23:23:17 -0400] jtimberman: smw_work: The "full stack" package of Chef keeps Chef in its own Ruby environment, and you'd use it to install the Ruby you want for your application, which is the likely scenario if you're using God.
[2012-08-06 23:23:26 -0400] jtimberman: so Gem.bin_dir wouldn't be appropriate.
[2012-08-06 23:23:49 -0400] smw_work: ok
[2012-08-06 23:23:58 -0400] jtimberman: i'd make it an attribute in the god cookbook (node.default['god']['bin_dir']), defaulting to Gem.bin_dir, and allow the user to override it.
[2012-08-06 23:24:33 -0400] joevandyk: chef documentation site is down?
[2012-08-06 23:24:40 -0400] joevandyk:                                                                                                                                                                                     http://wiki.opscode.com/display/chef/Resources
[2012-08-06 23:24:42 -0400] joevandyk: 502 error
[2012-08-06 23:24:44 -0400] jtimberman: joevandyk: apparently
[2012-08-06 23:24:46 -0400] LarsN: I think I may have found a flaw in a readme.  http://pastie.org/4402559
[2012-08-06 23:25:03 -0400] LarsN: https://github.com/mattray/knife-hp  on this age.
[2012-08-06 23:25:09 -0400] LarsN: s/age./page/
[2012-08-06 23:25:17 -0400] hoover_damm: why do all the sysctl cookbooks modify /etc/sysctl.conf still?
[2012-08-06 23:25:22 -0400] hoover_damm: dammit
[2012-08-06 23:25:28 -0400] hoover_damm: fine
[2012-08-06 23:25:33 -0400] jtimberman: hoover_damm: because not every distribution supports /etc/sysctl.conf.d?
[2012-08-06 23:25:42 -0400] jtimberman: (is that a thing? I don't even know)
[2012-08-06 23:25:43 -0400] smw_work: jtimberman, may I ask what is wrong with just saying "god" and hoping it finds it? I could also add a custom node.default['god']['binary']
[2012-08-06 23:25:58 -0400] smw_work: jtimberman, so if you don't specify a binary, it will use "god"
[2012-08-06 23:26:20 -0400] jtimberman: smw_work: in system startup scripts, it is a matter of best practice to use absolute paths, or explicitly set the $PATH.
[2012-08-06 23:26:30 -0400] jtimberman: smw_work: because they are often executed as root.
[2012-08-06 23:26:40 -0400] hoover_damm: jtimberman, actually they do
[2012-08-06 23:27:02 -0400] hoover_damm: jtimberman, a great majority of distros do support a variety of .d directories most people are unaware of
[2012-08-06 23:27:11 -0400] hoover_damm: jtimberman, I wouldn't call it arcane ... just untaught
[2012-08-06 23:27:19 -0400] jtimberman: often undocumented.
[2012-08-06 23:27:26 -0400] hoover_damm: 100% in this case on ubuntu
[2012-08-06 23:27:32 -0400] hoover_damm: but if you go into 12.04 and check out the README
[2012-08-06 23:27:35 -0400] hoover_damm: it tells you more then enough
[2012-08-06 23:27:55 -0400] jtimberman: i had to go delving through the changelogs in sudo to find which version of the package supported the includes, and match that with the version of ubuntu it was available.
[2012-08-06 23:27:59 -0400] hoover_damm: and to be able to write /etc/sysctl.d/11-syncookies_off.conf and /etc/sysctl.d/12_..
[2012-08-06 23:28:02 -0400] hoover_damm: is so much more win
[2012-08-06 23:28:06 -0400] smw_work: jtimberman, ok, I will do it the way you said and submit it later today
[2012-08-06 23:28:06 -0400] hoover_damm: then having to rewrite /etc/sysctl.conf
[2012-08-06 23:28:19 -0400] smw_work: jtimberman, thanks for the help :-)
[2012-08-06 23:28:39 -0400] jtimberman: smw_work: no, thank you :)
[2012-08-06 23:28:56 -0400] jtimberman: it seems that tickets.opscode.com and wiki.opscode.com are being upgraded right now btw.
[2012-08-06 23:29:21 -0400] jtimberman: http://status.opscode.com/post/28866004141/bug-tracker-and-wiki-maintenance
[2012-08-06 23:29:30 -0400] smw_work: good to know
[2012-08-06 23:36:30 -0400] stuartrexking: What's the best technique for polling a server to confirm once it's up. I am installing Jenkins using the reciper from fnichol. The service daemon returns, but Jenkins is not available until it's completed it's own initialization. I can poll using http. Jenkins (jetty) returns a 503 until it's ready after which it returns a 200. How do I manage this from a recipe? Is there a better way that polling?
[2012-08-06 23:37:26 -0400] jtimberman: stuartrexking: are you looking to test that the recipe worked, or do you need the server up before you can continue configuring something else in your Chef run?
[2012-08-06 23:37:46 -0400] jtimberman: if the former, i think the minitest handler cookbook that btm has worked on is a good candidate for testing.
[2012-08-06 23:38:24 -0400] jtimberman: http://community.opscode.com/cookbooks/minitest-handler
[2012-08-06 23:39:57 -0400] jtimberman: if the latter, a ruby_block can do that, see an example here, where we wait for a named pipe: https://github.com/opscode-cookbooks/runit/blob/master/definitions/runit_service.rb#L139-145
[2012-08-06 23:41:12 -0400] c_t: eesh, api.opscode.com's been a little touchy today
[2012-08-06 23:41:30 -0400] mhalligan: has anyone run into an issue with hosted chef where your user is unable to modify any other users / clients?
[2012-08-06 23:42:37 -0400] mhalligan: (and your validation client no longer has permissions to doanything)
[2012-08-06 23:42:42 -0400] c_t: I think the user in question needs to have admin rights
[2012-08-06 23:42:51 -0400] c_t: assuming I read that correctly'
[2012-08-06 23:43:06 -0400] mhalligan: c-t: aye, and until about 45 minutes ago it did
[2012-08-06 23:43:11 -0400] joonas: hoover_damm: your advice regarding the bootstrap templates worked flawlessly, thanks :)
[2012-08-06 23:43:41 -0400] c_t: mhalligan: I've also noticed api.opscode.com having a bit of trouble connecting today, fwiw
[2012-08-06 23:44:35 -0400] mhalligan: c_t: what sort of errors? what I'm getting is "403 forbidden" via chef client, and "Permission denied. You do not have permission to delete this client. (Error 22020)" when I try to do any operations on the website
[2012-08-06 23:44:36 -0400] mhalligan: similar?
[2012-08-06 23:48:10 -0400] c_t: mhalligan: The exact error has scrolled away, but it was complaining about not being able to connect to api.opscode.com
[2012-08-06 23:48:23 -0400] c_t: not a 403 error, I'm afraid
[2012-08-06 23:48:28 -0400] mhalligan: c-t: ah, different then, I can connect to api.opscode.com, I just can't do anything afterwards
[2012-08-06 23:48:29 -0400] mhalligan: :(
[2012-08-06 23:48:32 -0400] c_t: more along the lines of connection refused or something
[2012-08-06 23:48:44 -0400] c_t: oh, I can connect much of the time, just not every time
[2012-08-06 23:49:35 -0400] mhalligan: yeah, definitely a different error that one sounds better and less insipid
[2012-08-06 23:50:04 -0400] mhalligan: this is the nail in the coffin for me, not being able to fix my own problems means I need to leave hosted chef :/
[2012-08-06 23:50:31 -0400] mhalligan: I'm sure it's something to do with client certificates, but there doesn't seem to be a way to create a neew certificate and add it to a user
[2012-08-06 23:54:08 -0400] stuartrexking: jtimberman: Sorry, I got called away. Thanks for that. Will try that.
[2012-08-06 23:55:18 -0400] jessicab: c_t: its normal to see some issues connecting on the hour and half hour to the api, but it should retry and not actually effect the chef run at all btw
