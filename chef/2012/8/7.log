[2012-08-07 00:03:34 -0400] zuhaib: Can someone give me a quick rundown how create_if_missing works for templates and file, does it check if the file with the sane make exist or does it does it get hash?
[2012-08-07 00:03:56 -0400] zuhaib: s/sane make/same name/
[2012-08-07 00:06:18 -0400] silk: appears to test if the file exists
[2012-08-07 00:06:45 -0400] silk:        if ::File.exists?(@new_resource.path)
[2012-08-07 00:07:42 -0400] zuhaib: Thanks silk, i just so happen to stumble on the same code.  Sucks as it changes what I wanted to do but thats ok
[2012-08-07 00:09:56 -0400] beandip: Is anyone managing their chef environment as pure code in git?
[2012-08-07 00:10:04 -0400] beandip: If so, I'd like to pick their brain a bit
[2012-08-07 00:11:45 -0400] zuhaib: We do, but its noting fancy.
[2012-08-07 00:11:55 -0400] zuhaib: Also use the old style of roles as env
[2012-08-07 00:12:03 -0400] beandip: ah
[2012-08-07 00:12:26 -0400] beandip: I'm sort of curious how to go about creating new cloud instances when using infrastructure as code model
[2012-08-07 00:12:51 -0400] beandip: I've been using the knife ec2 plugin to create and detroy nodes as needed
[2012-08-07 00:13:39 -0400] beandip: but moving toward infrastructure as pure code, I'm trying to figure out how to do the same without using knife ec2 plugin to create new nodes
[2012-08-07 00:14:04 -0400] beandip: or am I completely confused on the workflow for this?
[2012-08-07 00:14:54 -0400] zuhaib: well since your using AWS you can create servers with chef using AWS pure API and Userdata by including the stuff required to bootstrap the server in it
[2012-08-07 00:15:03 -0400] zuhaib: but you still need something to trigger the creating of the server
[2012-08-07 00:15:05 -0400] joevandyk: Why would installing cabal-dev tell me that the haskell-platform package will be broken? https://gist.github.com/a565ed1e7f01be4a7db6
[2012-08-07 00:15:10 -0400] joevandyk: oops, wrong channel
[2012-08-07 00:15:24 -0400] zuhaib: so it needs to be something like aws autoscale or your own tool
[2012-08-07 00:16:29 -0400] zuhaib: but I dont see how "infrastructure as pure code" and deploying with knife ec2 relate to each other
[2012-08-07 00:16:31 -0400] hoover_damm: joevandyk, lol I was looking at that going huh
[2012-08-07 00:17:12 -0400] beandip: well, I may be a bit confused
[2012-08-07 00:23:27 -0400] joevandyk: a few years ago, i was trying to make a postgres chef cookbook that setup a database and users. didn't make much progress. anyone know of a good cookbook that does that sort of thing?
[2012-08-07 00:24:54 -0400] hoover_damm: joevandyk, the database cookbook should work for postgres or mysql
[2012-08-07 00:25:00 -0400] hoover_damm: joevandyk, check out the community site
[2012-08-07 00:32:04 -0400] Tombar: quick question regarding knife esx, the --vm-disk path is local or remote?
[2012-08-07 00:48:09 -0400] miah: guh. why do i always find the fun problems?
[2012-08-07 00:48:11 -0400] miah: https://gist.github.com/3280056
[2012-08-07 00:53:09 -0400] miah: oh i know
[2012-08-07 00:53:11 -0400] miah: im a derpy
[2012-08-07 00:54:23 -0400] hoover_damm: darn and I was gonna look
[2012-08-07 00:56:06 -0400] miah: HA HA
[2012-08-07 00:56:14 -0400] miah: im not going to give you more ammo to tease me ;)
[2012-08-07 00:57:29 -0400] hoover_damm: miah, i'm actually not in a mood to tease anyone
[2012-08-07 01:20:23 -0400] ssd7: Ohai Chefs!
[2012-08-07 01:47:00 -0400] skidx: Hi all, another question... I made a custom ami for windows, to bring up new instances on demand... installed the chef.msi, installed freesshd not as a service and set it to start on login, and used sysinternals application autologin.exe to auto login the administrator on start up... when I issue the command to bring up a new instance, it does connect to the freesshd shell now, and no longer give
[2012-08-07 01:47:00 -0400] skidx: me errors about not being able to interact with the desktop... but now gives the following error.. "Unable to execute command or shell on remote system: Failed to Execute process." Can anyone thing of something I am missing?
[2012-08-07 01:48:24 -0400] skidx: thing = think
[2012-08-07 02:31:41 -0400] hoover_damm: s3 hitting the skidmarks tonight?
[2012-08-07 02:32:04 -0400] hoover_damm: just getting retries always on uploads
[2012-08-07 02:32:05 -0400] hoover_damm: which is odd
[2012-08-07 03:16:22 -0400] jameson: mm
[2012-08-07 03:16:27 -0400] jameson: anyone here with vagrant experience
[2012-08-07 03:16:31 -0400] jameson: know what the host ip address would be?
[2012-08-07 03:16:55 -0400] jameson: i'm using 192.168.56.XXX for my images with host_only config
[2012-08-07 03:27:04 -0400] ssd7: jameson: Might have better luck in #vagrant, but I would potentially just try vagrant ssh and then see from where you are logged in.
[2012-08-07 03:27:51 -0400] jameson: yeah, I just realized I should be doing that
[2012-08-07 03:27:56 -0400] jameson: found 10.0.2.2
[2012-08-07 03:30:07 -0400] jameson: I couldn't ssh into the box because I was locking myself out via iptables >_<
[2012-08-07 03:30:11 -0400] jameson: hurr.
[2012-08-07 03:49:07 -0400] hoover_damm: lol
[2012-08-07 04:07:35 -0400] miah: hi
[2012-08-07 04:13:37 -0400] ssd7: heya
[2012-08-07 04:15:10 -0400] martinisoft: hiya
[2012-08-07 06:30:21 -0400] HashNuke: Hey all
[2012-08-07 06:31:15 -0400] HashNuke: I generated a kitched using knife. And added some cookbooks. I've also added them to the run_list in my node's json file. How and where do I set attributes? I found no example of this.
[2012-08-07 06:31:38 -0400] joonas: HashNuke: in the node's json file :o
[2012-08-07 06:31:58 -0400] joonas: if you are talking chef-solo
[2012-08-07 06:32:18 -0400] HashNuke: joonas: yes
[2012-08-07 06:33:02 -0400] HashNuke: joonas: this is my node's json file https://gist.github.com/3282407 right now.
[2012-08-07 06:33:14 -0400] joonas: yup
[2012-08-07 06:33:26 -0400] HashNuke: joonas: So where do I set attributes for cookbooks?
[2012-08-07 06:33:43 -0400] joonas: right there, next to the run_list
[2012-08-07 06:33:47 -0400] joonas: what are you looking to set?
[2012-08-07 06:34:10 -0400] HashNuke: joonas: The attributes for ruby_build.
[2012-08-07 06:34:16 -0400] joonas: say you wanted to set something for the nginx, you could just set "nginx": { "dir": ... }
[2012-08-07 06:34:56 -0400] joonas: oh, hmm
[2012-08-07 06:35:32 -0400] HashNuke: joonas: This looks right? https://gist.github.com/3282407
[2012-08-07 06:36:11 -0400] joonas: yup
[2012-08-07 06:36:32 -0400] HashNuke: I just couldnt find any example of specifying attributes in the node's json file. So was confused as to whether that goes inside the run_list or outside of it or in some other file.
[2012-08-07 06:36:36 -0400] HashNuke: joonas: Thanks!
[2012-08-07 06:36:57 -0400] joonas: HashNuke: yeah, I find the documentation a little hard to traverse/find
[2012-08-07 06:37:14 -0400] joonas: coming from some other projects where everything is much easier to find :)
[2012-08-07 06:37:52 -0400] joonas: luckily the nodes/*.json is simple once you get it
[2012-08-07 06:37:56 -0400] HashNuke: joonas: haha ya :) especially with most people not specifying clearly if their blog post is for chef-server or for chef-solo
[2012-08-07 06:38:34 -0400] joonas: HashNuke: btw, if you are just starting out, I'd recommend looking in to http://berkshelf.com/ and https://github.com/applicationsonline/librarian
[2012-08-07 06:38:50 -0400] HashNuke: joonas: Yes I'm using librarian. That makes me smile.
[2012-08-07 06:38:52 -0400] joonas: I just found out about them today
[2012-08-07 06:39:17 -0400] HashNuke: joonas: Librarian is a life-saver. I dont have to mess with git submodules and maintain them.
[2012-08-07 06:39:31 -0400] joonas: I can't really decide which to pick, both have features I like and dislike :P
[2012-08-07 06:39:50 -0400] HashNuke: joonas: As long as it works :)
[2012-08-07 06:40:19 -0400] HashNuke: I had used chef a few months back with vagrant (the config was simple in the Vagrantfile). So I've been struggling with getting started with chef again for a production server
[2012-08-07 06:40:36 -0400] joonas: I was using puppet before w/ vagrant
[2012-08-07 06:40:42 -0400] joonas: but I figured it was just too much of a hassle
[2012-08-07 06:40:57 -0400] joonas: though, I can't say chef has made my life any easier when dealing with the pg gem :)
[2012-08-07 06:41:24 -0400] HashNuke: haha
[2012-08-07 06:41:38 -0400] joonas: I'm sure it will though once I get the hang of things
[2012-08-07 06:42:10 -0400] HashNuke: Is there a way I don't have to enter passwords in files/attributes? I want to share this kitchen with my friends so that they can se this to setup their servers.
[2012-08-07 06:42:32 -0400] HashNuke: Oh dont bother with that question.
[2012-08-07 06:43:01 -0400] joonas: HashNuke: I'm sure there is, but I don't know the answer to that yet
[2012-08-07 06:43:03 -0400] joonas: not with chef-solo :)
[2012-08-07 06:43:50 -0400] HashNuke: I'll have to read about data bags. seems like that may help.
[2012-08-07 06:44:16 -0400] joonas: well what do ya know :)
[2012-08-07 06:44:25 -0400] joonas: didn't realize data bags were available w/ chef-solo to
[2012-08-07 06:44:26 -0400] joonas: too*
[2012-08-07 06:44:36 -0400] joonas: that's cool
[2012-08-07 06:44:36 -0400] HashNuke: The last time i checked it is.
[2012-08-07 06:44:37 -0400] HashNuke: somebody's put up this - https://github.com/barcampbangkok/chef-repo/wiki/Managing-Sensitive-Passwords
[2012-08-07 06:45:24 -0400] joonas: it's been a long while since I last played with chef :)
[2012-08-07 07:51:38 -0400] railsraider: i am trying to use encrypted data bags, but the secret key is not being downloaded to the new node
[2012-08-07 07:51:55 -0400] railsraider: how can i tell chef client to look for the key in the chef server
[2012-08-07 08:13:10 -0400] ranjibd__: railsraider, u r suppose to copy over the secret file during  bootstrap
[2012-08-07 08:13:20 -0400] ranjibd__: its not stored in chefserver
[2012-08-07 08:13:22 -0400] railsraider: ranjibd__: how?
[2012-08-07 08:13:33 -0400] ranjibd__: take a look at the bootstrap scripts
[2012-08-07 08:13:40 -0400] ranjibd__: just like the validation.pem
[2012-08-07 08:13:43 -0400] railsraider: I'm suppose to patch my gem template bootstrap?
[2012-08-07 08:14:09 -0400] ranjibd__: if is does not include the secret file copy statements.. then you should
[2012-08-07 08:14:09 -0400] railsraider: k
[2012-08-07 08:14:25 -0400] railsraider: i see
[2012-08-07 08:14:26 -0400] railsraider: thanks
[2012-08-07 08:14:49 -0400] ranjibd__: going out for a smoke.. will be back in 20 min., ping me if you need any thing
[2012-08-07 08:25:13 -0400] bahman2000: schisamo asleep?
[2012-08-07 08:25:37 -0400] bahman2000: anyone here have experience with sql_server cookbook?
[2012-08-07 08:47:02 -0400] stuartrexking: I am seeing this error on 10.12 https://gist.github.com/229600980dd7d6ccb598 I think it's related to http://tickets.opscode.com/browse/CHEF-3218 which has a workaround. How exactly would I implement that workaround?
[2012-08-07 08:52:49 -0400] stuartrexking: by changing disable_gzip to default as true in rest.rb I don't get the error. How would I do this from HTTP Request resource?
[2012-08-07 09:55:39 -0400] HashNuke: does anybody else have problems with installing postgresql on ec2?
[2012-08-07 09:55:49 -0400] HashNuke: not ec2 but using chef in general.
[2012-08-07 10:12:34 -0400] tigris: hi chefs!
[2012-08-07 10:12:42 -0400] cpasmoi: hi :)
[2012-08-07 10:12:52 -0400] tigris: after assigning a ticket to me, ala http://tickets.opscode.com/browse/COOK-1523
[2012-08-07 10:13:00 -0400] tigris: what is the next step?
[2012-08-07 11:19:20 -0400] forestbird: how am I supposed to manage users/groups? there is a users cookbook that cannot handle passwords. then there is a user cookbook that can handle passwords but not groups.... any ideas?
[2012-08-07 11:19:37 -0400] forestbird: or should I just reinvent the wheel and write it myself?
[2012-08-07 11:41:18 -0400] xerxas: Hi all !
[2012-08-07 11:42:51 -0400] xerxas: http_request allows me to set some request headers, but I can't seem to find a way to get response headers
[2012-08-07 11:43:18 -0400] xerxas: is there a way to get response headers and notifiy if I match some headers (actually the ETag headers in my case)
[2012-08-07 11:43:36 -0400] sampikesley: forestbird: I rolled my own. Made extensive use of databags
[2012-08-07 11:47:32 -0400] cwj: forestbird: opscode user cookbook can be patched pretty easily to support passwords
[2012-08-07 11:47:38 -0400] cwj: i need to finish my pull request for that
[2012-08-07 11:48:50 -0400] cwj: this works but has not been accepted for merge because i need to rework it to use chef_gem
[2012-08-07 11:48:51 -0400] cwj: https://github.com/needle-cookbooks/chef-opscode-users/tree/COOK-937
[2012-08-07 11:49:02 -0400] forestbird: ok, thx
[2012-08-07 12:05:47 -0400] sampikesley: has anybody got cucumber-chef 2.0.x to work?
[2012-08-07 12:06:18 -0400] sampikesley: it's spinning up an EC2 node, but then it sits at "Bootstrapping AWS EC2 instance..." forever
[2012-08-07 12:14:42 -0400] railsraider: any recommendations per memcached cookbook / platform?
[2012-08-07 12:14:54 -0400] railsraider: should i install it on 12.04?
[2012-08-07 13:34:38 -0400] jsnapp: ohai chefs, given that ubuntu shadow passwords are hashed using sha-512 do you think it's reasonable to store them plaintext in a users databag?
[2012-08-07 13:54:39 -0400] cnf: damnit, apt-only cookbooks suck ^^;
[2012-08-07 13:54:40 -0400] cpasmoi: jsnapp, is your databag accessed / accessible by a lot of people ?
[2012-08-07 13:55:08 -0400] cpasmoi: Hum in fact, I keep the ssh authorized keys in roles, so... :x
[2012-08-07 13:55:31 -0400] cnf: ssh keys are public keys
[2012-08-07 13:55:39 -0400] cpasmoi: yup
[2012-08-07 13:55:54 -0400] cnf: so it doesn't matter they are, you know... public
[2012-08-07 13:56:07 -0400] cpasmoi: I know
[2012-08-07 13:56:48 -0400] cnf: anyone know a cookbook for openldap on redhat/centos, btw?
[2012-08-07 13:57:19 -0400] cpasmoi: I don't
[2012-08-07 13:57:38 -0400] cpasmoi: perhaps you can manage to modify the apt one ?
[2012-08-07 14:00:51 -0400] cnf: pft, that's almost rewriting it
[2012-08-07 14:02:05 -0400] jsnapp: cpasmoi, no the databag wouldn't be accessed by many people ... i think realistically the threat is low ... just wondering what others thought
[2012-08-07 14:03:13 -0400] cnf: jsnapp: i don't use passwords
[2012-08-07 14:03:25 -0400] cnf: jsnapp: so no need for passwords in my databags
[2012-08-07 14:03:32 -0400] cpasmoi: Well I guess that if you use password instead of keys, that's good for you
[2012-08-07 14:03:55 -0400] cnf: jsnapp: ssh-keys, and you are all set :P
[2012-08-07 14:07:03 -0400] jsnapp: cnf: i use ssh-keys too but what about console access for a single user as a last resort? what do you do for that?
[2012-08-07 14:07:38 -0400] cnf: jsnapp: "as a last resort"?
[2012-08-07 14:07:59 -0400] cnf: a last resort for what?
[2012-08-07 14:08:33 -0400] cnf: jsnapp: also, users can still set a password, once they have sshed in, i just don't set them with chef
[2012-08-07 14:08:33 -0400] cpasmoi: when you don't have the key on you ?
[2012-08-07 14:08:54 -0400] cnf: cpasmoi: mine is on my phone
[2012-08-07 14:08:56 -0400] cnf: and my ipad
[2012-08-07 14:08:59 -0400] cnf: and my laptop :P
[2012-08-07 14:09:01 -0400] jsnapp: cnf: what if you can't access the server using ssh for some reason.  at least you could have a single user with a password that could get console access
[2012-08-07 14:09:19 -0400] cnf: jsnapp: how often does that happen to you?
[2012-08-07 14:09:35 -0400] cpasmoi: hum, guys
[2012-08-07 14:09:55 -0400] cpasmoi: I think the first question was about hashed password on chef databags
[2012-08-07 14:10:12 -0400] cpasmoi: not on the interest of having password for jsnapp
[2012-08-07 14:10:14 -0400] cnf: yes, and things progressed
[2012-08-07 14:10:45 -0400] jsnapp: cnf: i understand you don't set them with chef but the user resource has the password attribute and i'm wondering if it's reasonable to leave it plaintext in the databag
[2012-08-07 14:11:14 -0400] cpasmoi: I guess we could simply say "ssh keys on chef is a better way, even if you have password"
[2012-08-07 14:11:27 -0400] cnf: you can always use encrypted data bags
[2012-08-07 14:11:53 -0400] jaylevitt: mattray: Unless you want to use postgresql, which doesn't work with omnibus yet!
[2012-08-07 14:12:27 -0400] jsnapp: cnf: thanks, i'm aware of encrypted databags but that's not my question ... so are you indirectly saying that your opinion is it's not safe to leave them plaintext
[2012-08-07 14:12:29 -0400] cpasmoi: Cost = time to secure information * how much you'd lost if the information is get
[2012-08-07 14:12:42 -0400] Zenigor: Which nginx cookbook works correctly with Ubuntu 12.04 LTS?
[2012-08-07 14:13:00 -0400] cnf: jsnapp: "safe" is a relative term, but i wouldn't no
[2012-08-07 14:13:18 -0400] jsnapp: cnf: ok, thanks
[2012-08-07 14:38:32 -0400] jaylevitt: Postfix's default TLS cache directory has changed since Postfix 2.5 (current is 2.9), so the postfix cookbook sets up the caches incorrectly.  Should I add an ohai plugin to check the postfix version? If so, is that something I can do from within the cookbook? Or should I just update the postfix cookbook to use the new location, on the assumption anyone still using old postfix is using an old cookbook?
[2012-08-07 14:46:52 -0400] BryanWB_: ohai chefs!
[2012-08-07 14:47:16 -0400] jaylevitt: Or thirdly, is ohai overkill and it's fine to say version = shellout!('postconf mail_version') in a recipe?
[2012-08-07 14:48:42 -0400] _rc: if ohai already killed it for you...
[2012-08-07 14:49:50 -0400] jaylevitt: :) I'm just not sure what the proper way is to have a cookbook recipe take different actions depending on the version of the (e.g. postfix) binary that's installed
[2012-08-07 14:50:00 -0400] jaylevitt: since postfix's config requirements have changed
[2012-08-07 14:51:08 -0400] addisonj: hrm... whats the best way to do this: I want to know the current commit of a various app servers I have running. Ohai plugin?
[2012-08-07 14:56:15 -0400] jperry2: hey guys
[2012-08-07 14:56:25 -0400] jperry2: I'm using vagrant in combination with chef-server
[2012-08-07 14:56:38 -0400] jperry2: the vagrant box I'm spinning up isn't setting any ohai attributes on the node
[2012-08-07 14:56:56 -0400] jperry2: anyone see this before?
[2012-08-07 14:57:27 -0400] jperry2: This is the beginning info
[2012-08-07 14:57:28 -0400] jperry2: http://hastebin.com/demiciyemi.vbs
[2012-08-07 14:57:40 -0400] jperry2: of the output from the "vagrant up"
[2012-08-07 14:58:07 -0400] jperry2: I am using chef 10.12.0
[2012-08-07 14:58:40 -0400] jperry2: I do have a failure where in the attributes file we are trying to access the node[chef_environment] attribute
[2012-08-07 14:58:55 -0400] jperry2: that should be set before the attribute files are parsed right?
[2012-08-07 15:00:28 -0400] ranjibd: jperry2, how you are assigning the run list?
[2012-08-07 15:00:39 -0400] ranjibd: -j /etc/chef/firstboot.json ..?
[2012-08-07 15:00:51 -0400] jperry2: @ranjibd, I am setting the run list in the Vagrantfile
[2012-08-07 15:01:58 -0400] ranjibd: im not sure how vagrant passes the firstboot json. but ideally -j <something> should be there
[2012-08-07 15:02:12 -0400] jperry2: it runs this command
[2012-08-07 15:02:12 -0400] jperry2: chef-client -c /tmp/vagrant-chef-1/client.rb -j /tmp/vagrant-chef-1/dna.json
[2012-08-07 15:03:27 -0400] ranjibd: check that dna.json whats inside it?
[2012-08-07 15:07:51 -0400] jperry2: yeah environment isn't set in there
[2012-08-07 15:07:59 -0400] jperry2: weird as I'm setting it from the Vagrantfile
[2012-08-07 15:08:02 -0400] jperry2: per the documentation
[2012-08-07 15:09:50 -0400] maruq: hi guys
[2012-08-07 15:10:15 -0400] maruq: I seem to be having some fun with subscriptions to deploy_revision resources
[2012-08-07 15:10:30 -0400] jperry2: @ranjibd - It's set in the client.rb
[2012-08-07 15:11:30 -0400] maruq: subscribes :restart, resources(:deploy_revision => "/var/www/my_app"), :immediately seems to fail asking if I created the resource first
[2012-08-07 15:12:08 -0400] maruq: for some reason that seems to run before the recipe it subscribes too, despite me declaring the other one first in run_list
[2012-08-07 15:13:37 -0400] dpetzel: mattray, you around?
[2012-08-07 15:13:48 -0400] mattray: dpetzel: si
[2012-08-07 15:13:49 -0400] jperry2: @ranjibd - So the node does have the Environment set.  Do default attribute files have access to node[:chef_environment]
[2012-08-07 15:14:07 -0400] dpetzel: hey I had a question on knife openstack if you have a few moments?
[2012-08-07 15:19:26 -0400] jperry2: @ranjibd, nm, looks like it should have been node.chef_environment
[2012-08-07 15:19:31 -0400] jperry2: things are working now
[2012-08-07 15:20:04 -0400] mattray: dpetzel: sure, afaik it's mostly working
[2012-08-07 15:20:07 -0400] ranjibd: jperry2, what was wrong ?
[2012-08-07 15:20:28 -0400] ranjibd: only the chef_environment?
[2012-08-07 15:20:33 -0400] jperry2: yeah
[2012-08-07 15:20:39 -0400] jperry2: accessing it incorrectly
[2012-08-07 15:20:44 -0400] dpetzel: mattray, working very well actually.. The challenge I have is that we have a private openstack implementation, and all images, are set such that you have to change password on first logon
[2012-08-07 15:21:12 -0400] mattray: dpetzel: custom bootstrap needed?
[2012-08-07 15:21:12 -0400] dpetzel: so I get all the way to bootstrapping and then get hung up on th einstance asking for a password change. Is there a way I can provide the "new" password and have it get past that?
[2012-08-07 15:21:13 -0400] ranjibd: maruq, use the other syntax
[2012-08-07 15:21:38 -0400] ranjibd: "deploy_revision[/var/ww/ww]"
[2012-08-07 15:21:46 -0400] mattray: dpetzel: where is it hanging? when installing chef?
[2012-08-07 15:21:58 -0400] mattray: dpetzel: or can it not even ssh in the first time?
[2012-08-07 15:22:18 -0400] dpetzel: mattray, custom bootstrap maybe.. I'm not sure to be honest. Im treading new terrotiry here. It hangs before installing chef, it can establish the SSH connection using the user name and key-pair, but our instances force a password change at initial connection
[2012-08-07 15:22:36 -0400] mattray: dpetzel: oh dear, that does sound troublesome
[2012-08-07 15:22:46 -0400] dpetzel: mattray,  indeed :)
[2012-08-07 15:24:04 -0400] dpetzel: mattray, so I'm basically wondering if there is a native way to supply the value of the new password, or do I need to look at a custom template?
[2012-08-07 15:24:19 -0400] mattray: dpetzel: I'm reading the bootstrap code to see
[2012-08-07 15:24:28 -0400] dpetzel: mattray, cool, thanks
[2012-08-07 15:26:27 -0400] maruq: ranjibd: tried that, still get the error
[2012-08-07 15:26:59 -0400] maruq: it doesn't seem to run any of my other recipes, just dies before anything else gets run
[2012-08-07 15:27:43 -0400] dpetzel: mattray, pretty sure you understand what Im saying, but in case actual output is useful at all: http://pastebin.com/73Q2X6By
[2012-08-07 15:32:08 -0400] maruq: ah, I think it's the supervisord cookbook trying to be smart & call a run_action before anything exists
[2012-08-07 15:32:57 -0400] maruq: then me subscribing to a resource that doesn't exist then
[2012-08-07 15:39:28 -0400] mattray: dpetzel: I don't know, you may have to run a password change before attempting the bootstrap
[2012-08-07 15:39:47 -0400] mattray: dpetzel: maybe even a custom openstack_server_create.rb
[2012-08-07 15:40:04 -0400] mattray: dpetzel: an extra command right here, before the bootstrap https://github.com/mattray/knife-openstack/blob/0.6.0/lib/chef/knife/openstack_server_create.rb#L251
[2012-08-07 15:40:12 -0400] mattray: dpetzel: just using keypairs doesn't work?
[2012-08-07 15:40:50 -0400] dpetzel: mattray, no the keypairs allows you to login without using a password, just fine. Its just a the local policy on the image insists you change the password (you know the one youre not using anyway.... :( )
[2012-08-07 15:41:22 -0400] mattray: dpetzel: yeah, I'm guessing just firing a ssh -c passwd newpassword
[2012-08-07 15:41:26 -0400] mattray: dpetzel: or somesuch
[2012-08-07 15:41:29 -0400] dpetzel: mattray, so once the "password expired flag" has been cleare the keypair works fine
[2012-08-07 15:41:59 -0400] dpetzel: mattray, OK, I'll monkey with, but wanted to see if you had a solution in mind before I started mucking with code :)
[2012-08-07 15:42:06 -0400] mattray: sorry, not really
[2012-08-07 15:42:32 -0400] dpetzel: mattray, no worries, the plugin is really great, I just need to work around some internal decisions :)
[2012-08-07 15:42:59 -0400] mattray: dpetzel: let me know if you come up with something elegant that potentially has reuse
[2012-08-07 15:49:36 -0400] maruq: yep, it's looking like I was trying to subscribe from a resource that's run during compilation. Is there a way to do that?
[2012-08-07 16:09:37 -0400] dpetzel: mattray, If I get some re-usable, I will certainly let you know, thanks again for your help
[2012-08-07 16:21:43 -0400] paigeat: just curious has anyone here ever written a bootstrap template that uses chef-solo to bootstrap a server instead of chef-client
[2012-08-07 16:22:49 -0400] erikh: well part of the bootstrapping process is creating the client certificate and node entry
[2012-08-07 16:23:03 -0400] erikh: if you're going to use chef-solo to provision, there are some good helper tools like knife-solo
[2012-08-07 16:23:07 -0400] erikh: and spatula
[2012-08-07 16:23:18 -0400] erikh: (but I think knife-solo is just spatula v2)
[2012-08-07 16:23:27 -0400] paigeat: which I wanna do but I don't want to create a relationship with the client from the environment I am bootstrapping from?
[2012-08-07 16:24:03 -0400] paigeat: basically I'd be using knife rackspace to spin up a fresh chef server
[2012-08-07 16:24:05 -0400] erikh: well, what are you trying to accomplish with chef-solo that chef-client can't do for you?
[2012-08-07 16:24:13 -0400] erikh: oh, don't want to create
[2012-08-07 16:24:19 -0400] erikh: yeah, look at knife-solo
[2012-08-07 16:24:35 -0400] burris: I think stuff is named chef/knife/spatula not because of the recipe metaphor but because you take perverse pleasure in seeing us struggle to google stuff
[2012-08-07 16:24:57 -0400] paigeat: erikh see the problem is the rackspace stuff is built into knife and knife is like a userland tool for chef-server environments by design
[2012-08-07 16:24:59 -0400] erikh: as for node vivication it shouldn't be too hard to script that yourself
[2012-08-07 16:25:03 -0400] burris: forgot the ;-)
[2012-08-07 16:25:27 -0400] erikh: paigeat: actually knife never *needs* to talk to a server, it just prefers to
[2012-08-07 16:25:28 -0400] paigeat: but I figured out I can customise the bootstrap process that knife rackspace uses so
[2012-08-07 16:25:33 -0400] paigeat: I'll have it use chef-solo :)
[2012-08-07 16:25:43 -0400] erikh: yeah, you might just want to write a knife plugin
[2012-08-07 16:29:17 -0400] paigeat: my chef-server in my testing environment is being built from vagrant... which is kind of weird I have a set of cookbooks that chef-solo uses to do that and once it has chef-client, chef-solo is intializing the knife configuration and sourcing all of the real cookbooks, and role json files into the new chef-server
[2012-08-07 16:29:31 -0400] paigeat: in other words I'm having chef-solo run 'chef-client' via execute?
[2012-08-07 16:29:37 -0400] paigeat: I'm wondering if thats a bad idea
[2012-08-07 16:29:46 -0400] paigeat: it seems to work perfectly
[2012-08-07 16:30:53 -0400] chip-: It's just fine.
[2012-08-07 16:31:57 -0400] paigeat: yeah I started worrying that maybe there's some env variables or something that get set by chef-solo that knife or chef-client might try to overwrite
[2012-08-07 16:35:01 -0400] bporterfield: howdy - new to chef and trying to understand something. I'm creating ec2 instances w/knife and they register with hosted chef immediately. I then associate an elastic IP address with the instance, which changes the public DNS & IP of the instance. After this, knife can no longer ssh into the instance. I understand why knife can no longer find the instance - the values it uses to find the server are now wrong - but I don't underst
[2012-08-07 16:36:12 -0400] jessicab: bporterfield: your question cut off at "- but I don't underst"
[2012-08-07 16:36:27 -0400] bporterfield: but I don't understand how to update the node data on chef-server or locally so that knife can work again with the node, or if I should be even trying to do that?
[2012-08-07 16:39:14 -0400] jessicab: bporterfield: im pretty sure if you run chef-client on the node again it should update it's ip.. can you just ssh into it normally and run it, or setup chef-client as a daemon when youre bootstrapping it so it updates itself?
[2012-08-07 16:39:47 -0400] paigeat: jessicab Im wondering if he has to do this often enough that it's inconvienent
[2012-08-07 16:40:12 -0400] paigeat: it is easy to get off in the weeds thinking about solutions to problems that aren't really problems
[2012-08-07 16:41:10 -0400] bporterfield: jessicab: i have sshed in and run chef-client, but it doesn't seem to update the node for knife locally. let me try again to make sure I'm correct.
[2012-08-07 16:41:40 -0400] jessicab: well, just setting up to run as a daemon wouldnt be a manual process each time, if you just changed that in the bootstrap file.. ive never tested that or anything, but you can just add command line options to the bootstrap file
[2012-08-07 16:41:44 -0400] paigeat: in any case bporterfield, if I had to make a suggestion I'd say I don't think chef-client will finish executing if the ssh connection dies
[2012-08-07 16:42:25 -0400] paigeat: that is if you're using knife ssh,
[2012-08-07 16:43:05 -0400] bporterfield: thanks paigeat, however i don't associate the ip until after the first chef-client run is complete so my issue is not chef-client halting, but trying to use knife again after the new elastic ip is associated
[2012-08-07 16:43:22 -0400] paigeat: I'd say try to (pseudo example) knife ssh -exec 'screen changeip_and_run_chef_clientscript.sh'
[2012-08-07 16:43:33 -0400] paigeat: if you have screen...
[2012-08-07 16:43:42 -0400] paigeat: or just make that a cron job
[2012-08-07 16:45:27 -0400] paigeat: you know
[2012-08-07 16:45:39 -0400] paigeat: one sec I might have a better suggestion
[2012-08-07 16:46:29 -0400] paigeat: I've heard people talk alot about it this
[2012-08-07 16:46:43 -0400] paigeat: I think Ive heard someone talk about doing stuff like you're describing with it.. http://rundeck.org/
[2012-08-07 16:47:44 -0400] paigeat: personally.. I'd just make a run-once shell script and make a cron for it in a chef-recipe
[2012-08-07 16:48:14 -0400] paigeat: that way all the work I need done gets done in one run
[2012-08-07 16:49:14 -0400] paigeat: another thing you could do is if you're using chef-client::cron just change the checkin frequency which would be crazy if you have a lot of stuff checking in but
[2012-08-07 16:49:30 -0400] paigeat: think you can change the checkin frequency with init too
[2012-08-07 16:49:58 -0400] bporterfield: im not sure that would address my issue - i want to be able to use knife with the node after I've associated the elasic ip. it doesn't seem like these possibilities would address that?
[2012-08-07 16:53:35 -0400] jessicab: bporterfield: running chef-client again didnt update it?
[2012-08-07 16:53:55 -0400] paigeat: well if you don't know the address in the context you are running knife, chef-client will run eventually on the machine and update the json
[2012-08-07 16:53:56 -0400] bporterfield: jessicab: just finished testing and apparently it does update it, i was incorrect. that works for me!
[2012-08-07 16:55:00 -0400] bporterfield: paigeat: I see, you're saying that if i have chef-client run eventually, it will update the node's info. I was not thinking that would work because I was under the impression that running chef-client on the node did not update the node data, but it does appear to (just tested). thanks
[2012-08-07 16:55:37 -0400] paigeat: oh sure :) my pleasure
[2012-08-07 16:55:44 -0400] paigeat: sorry that was confusing
[2012-08-07 17:05:36 -0400] paigeat: the thing I have to think about is how am I going to automate my database servers
[2012-08-07 17:05:55 -0400] paigeat: because I don't want to recreate them everytime I redeploy a different chef environment
[2012-08-07 17:06:18 -0400] paigeat: chef environment being chef server, memcache, apache cluster,
[2012-08-07 17:06:40 -0400] paigeat: the mysql servers configure iptables to allow addresses of machines belonging to certain roles to connect
[2012-08-07 17:07:20 -0400] paigeat: I need to figure out how I'm going to automate moving database servers into a new chef environment without downtime or having to recreate them
[2012-08-07 17:11:07 -0400] paigeat: I need to figure out the load balancer too, I'm going to have ssl termination done there
[2012-08-07 17:11:51 -0400] paigeat: I dont understand ssl, Im guessing the IP address shouldn't be getting changed for it
[2012-08-07 17:29:48 -0400] hoover_damm: replication?
[2012-08-07 17:29:49 -0400] bawt: replication is basicallly one REST call I think to initiate it
[2012-08-07 17:36:24 -0400] bahman2000: hurho chefs
[2012-08-07 17:37:06 -0400] bahman2000: is there a way to get the role.rb's out of hosted chef? knife role create doesn't seem to keep them in roles/
[2012-08-07 17:38:26 -0400] hippiehacker: bahman2000: knife rode edit foo -e cat > roles/foo.rb
[2012-08-07 17:38:35 -0400] hippiehacker: s/rode/role/
[2012-08-07 17:39:34 -0400] hippiehacker: or 'knife role show -Fj Foo > roles/Foo.rb'
[2012-08-07 17:39:48 -0400] bahman2000: haha of course :)
[2012-08-07 17:40:21 -0400] bahman2000: except it's in json
[2012-08-07 17:44:34 -0400] hippiehacker: yea > role/Foo.json 8)
[2012-08-07 17:45:28 -0400] bahman2000: hippiehacker ok looked up Output Formats, thanks!
[2012-08-07 17:45:49 -0400] hippiehacker: np!
[2012-08-07 17:46:28 -0400] hoover_damm: this is why I use knife-essentials
[2012-08-07 17:46:45 -0400] hippiehacker: hoover_damm: good call
[2012-08-07 17:46:45 -0400] hoover_damm: makes pulling in the json format and working with hosted and pulling stuff down quite a pleasure
[2012-08-07 17:47:02 -0400] hoover_damm: knife show roles/foo.json > foo.json
[2012-08-07 17:50:34 -0400] j|: I have a workflow question. I'm setting up apache and want it to have different settings in security depending on the environment. Would people recommend that I modify the template to look for the environmentally set attribute or should this be done in the cookbook? Also, if the answer is cookbook, then should the logic be added to the attributes defaults or to the recipe? (or, have I missed something fundamental entirely..?)
[2012-08-07 17:51:35 -0400] bahman2000: roles?
[2012-08-07 17:51:36 -0400] bawt: roles is http://wiki.opscode.com/display/chef/Roles or nestable. For example, every server type I manage has a few common reqs, so I have role[company-server], role[server-type-one], role[server-type-two], etc.
[2012-08-07 17:51:58 -0400] bahman2000: bawt hehe
[2012-08-07 17:52:14 -0400] j|: bahman2000: was that "roles?" directed at me?
[2012-08-07 17:52:39 -0400] bahman2000: j| i think so :)
[2012-08-07 17:52:46 -0400] j|: yea, so there is a role
[2012-08-07 17:53:15 -0400] j|: but I want the role to still show have different apache settings based on an environment attribute I've set
[2012-08-07 17:55:00 -0400] j|: and I'm not sure where to put the logic that checks the environment. in the recipe, in the attributes in the cookbook or put some logic in the template itself, which is actually what I want to change. I'd think stick it in the template as that's what I want to change, but then the question is when I'm looking for something later, don't I jsut want to look at the recipe and see what's going on without having to cross-correlate the template?
[2012-08-07 17:55:37 -0400] j|: or is that over thinking it and I should just stick it in a top-down approach to what makes the most sense to the current problem I'm trying to solve. I guess the issue is what will be easier to remember later
[2012-08-07 17:56:54 -0400] gregp76: Hi all
[2012-08-07 17:57:04 -0400] gregp76: having issues with snmpd.conf.erb
[2012-08-07 17:57:17 -0400] gregp76: if node[:dmi][:system][:product_name] == "Dell
[2012-08-07 17:57:35 -0400] j|: a template is the easiest and most straight forward thing to change as that's what I want to alter in the end, but I don't think I want to get into a habit of modifying templates if the same changes can be modified in a recipe as it seems that later on I'm going to probably go to look at the recipe first. Or maybe attributes and just put the logic in the attributes there. Or I might could stick it in an environmental override attribute perhaps, but that
[2012-08-07 17:57:35 -0400] j|: isn't really very memorable either.
[2012-08-07 17:57:38 -0400] hoover_damm: gregp76, all records?
[2012-08-07 17:57:41 -0400] gregp76: brings back Chef::Mixin::Template::TemplateError undefined error
[2012-08-07 17:57:42 -0400] j|: I think I'm thinking too much?
[2012-08-07 17:58:26 -0400] martinisoft: If I had chef installed via omnibus back on 0.10.8, but now on 10.12.0, and I've got two chef installs it seems, one in /opt/chef and one in /opt/opscode
[2012-08-07 17:58:42 -0400] gregp76: http://pastebin.com/BLcHHHxU
[2012-08-07 17:58:42 -0400] martinisoft: should I delete the /opt/opscode folder?
[2012-08-07 17:58:43 -0400] hoover_damm: gregp76, node['dmi'] for my supermicro board is node['dmi']['system']['all_records'][0]['Manufacturer']
[2012-08-07 17:59:04 -0400] bahman2000: j| i'm going to vote for role attributes
[2012-08-07 17:59:30 -0400] gregp76: thanks -  will try
[2012-08-07 17:59:33 -0400] hoover_damm: gregp76, the attribute you listed should work but that's ugly in a template
[2012-08-07 17:59:48 -0400] hoover_damm: gregp76, you should try and avoid putting logic in erb templates
[2012-08-07 17:59:51 -0400] hoover_damm: gets ugly fast
[2012-08-07 17:59:57 -0400] bahman2000: j| but i know squat :)
[2012-08-07 18:00:04 -0400] gregp76: i didn't - it's fromm the recipe
[2012-08-07 18:00:09 -0400] gregp76: :)
[2012-08-07 18:00:24 -0400] hoover_damm: gregp76, well basically there's no dmi on that system
[2012-08-07 18:00:31 -0400] hoover_damm: gregp76, it's looking for the product name of the board
[2012-08-07 18:00:39 -0400] hoover_damm: chef > node[:dmi][:system][:product_name] => "X9DR3-F"
[2012-08-07 18:00:42 -0400] hoover_damm: for example
[2012-08-07 18:00:45 -0400] hoover_damm: yours is completely nil
[2012-08-07 18:00:49 -0400] hoover_damm: which means ohai dmi is empty
[2012-08-07 18:00:55 -0400] hoover_damm: gregp76, dmidecode installed?
[2012-08-07 18:00:57 -0400] gregp76: yup - what's the good way to avoid thos
[2012-08-07 18:00:59 -0400] gregp76: this?
[2012-08-07 18:01:12 -0400] gregp76: dmidecode is there
[2012-08-07 18:01:17 -0400] hoover_damm: actually if node.has_key?("dmi")
[2012-08-07 18:01:24 -0400] hoover_damm: then you might want to check the length
[2012-08-07 18:02:20 -0400] hoover_damm: gregp76, http://wiki.opscode.com/display/chef/Templates
[2012-08-07 18:02:57 -0400] gregp76: thanks will try
[2012-08-07 18:03:15 -0400] hoover_damm: gregp76, dmidecode returning nothing?
[2012-08-07 18:03:43 -0400] gregp76: # dmidecode 2.11
[2012-08-07 18:03:43 -0400] gregp76: # No SMBIOS nor DMI entry point found, sorry.
[2012-08-07 18:03:47 -0400] gregp76: yup
[2012-08-07 18:04:05 -0400] hoover_damm: :(
[2012-08-07 18:04:09 -0400] hoover_damm: ouch
[2012-08-07 18:04:35 -0400] j|: bahman2000: well, thing is, at least the way I'm thinking of roles (which seems to match the chef docs) is that a role is a specific functional piece of our companys infrastructure.. what I mean is that a role, to me, is a way of specifying a specific functionality in the scope of how we have our systems broken up by function
[2012-08-07 18:04:46 -0400] j|: so the role is the same in dev and in production
[2012-08-07 18:05:02 -0400] j|: but I want the dev one to just have things like traceenable = On
[2012-08-07 18:05:10 -0400] j|: and the prod one to have it off
[2012-08-07 18:05:19 -0400] j|: which seems like what environments are for
[2012-08-07 18:05:34 -0400] hoover_damm: gregp76, chef > if node.has_key?("dmi") && node['dmi']['system'].length > 1
[2012-08-07 18:05:34 -0400] hoover_damm: chef ?> node[:dmi][:system][:product_name]
[2012-08-07 18:05:48 -0400] j|: so, I created the environments, and set a default attribute in the environment that identifies all nodes within the environment
[2012-08-07 18:05:58 -0400] hoover_damm: gregp76, that's likely a better way to verify not only the key exists and it has some keys in it
[2012-08-07 18:06:29 -0400] j|: I could also make different run lists based on the environments, but it really is the SAME run list, just with a tweak of settings at the level of the apache config
[2012-08-07 18:06:42 -0400] gregp76: hoover_damm, can you clarify this syntax?
[2012-08-07 18:06:49 -0400] gregp76: chef ?> node[:dmi][:system][:product_name]
[2012-08-07 18:07:24 -0400] j|: meh. I guess this is a TMTOWTDI issue
[2012-08-07 18:07:28 -0400] j|: I hate that.
[2012-08-07 18:07:35 -0400] j|: :P
[2012-08-07 18:07:51 -0400] j|: anwyay. thanks for offering your help.
[2012-08-07 18:08:49 -0400] gregp76: i think if have this figured out
[2012-08-07 18:08:57 -0400] ranjibd: vops
[2012-08-07 18:08:59 -0400] hoover_damm: gregp76, your syntax... i wouldn't call product_name
[2012-08-07 18:09:22 -0400] gregp76: i mean the "chef ?> " part
[2012-08-07 18:09:25 -0400] hoover_damm: product_name lists the model # for the motherboard of my supermicro server
[2012-08-07 18:09:27 -0400] hoover_damm: gregp76, oh that's shef
[2012-08-07 18:09:34 -0400] gregp76: anyway i can check if that's virtual
[2012-08-07 18:09:53 -0400] hoover_damm: if node.has_key?("dmi")
[2012-08-07 18:10:00 -0400] gregp76: [root@cheftest036 ~]# ohai | grep -A2 virtual
[2012-08-07 18:10:01 -0400] gregp76:   "virtualization": {
[2012-08-07 18:10:02 -0400] gregp76:     "role": "guest",
[2012-08-07 18:10:02 -0400] gregp76:     "system": "xen"
[2012-08-07 18:10:07 -0400] gregp76: i got it
[2012-08-07 18:10:09 -0400] bahman2000: j| you're right, environments...
[2012-08-07 18:10:18 -0400] hoover_damm: it's better to test if dmi exists or not, then the other
[2012-08-07 18:10:23 -0400] gregp76: ok
[2012-08-07 18:11:09 -0400] hoover_damm: basically I try to keep my 'checks' to be as simple as possible because there's nothing saying that DMI won't appear in VM's someday
[2012-08-07 18:11:14 -0400] hoover_damm: and will have populated data you will want
[2012-08-07 18:11:17 -0400] bahman2000: j| and cookbook versions imho
[2012-08-07 18:11:32 -0400] hoover_damm: and if it does, my check won't break you
[2012-08-07 18:11:42 -0400] hoover_damm: it'll just suddenly work there
[2012-08-07 18:13:26 -0400] j|: bahman2000: yea, the cookbook versions I think are useful for when I'm testing cookbooks
[2012-08-07 18:13:37 -0400] j|: but not for something that I always want to be a certain way.
[2012-08-07 18:16:49 -0400] j|: hoover_damm: you always have good advice. Anything to offer on that one?
[2012-08-07 18:17:55 -0400] hoover_damm: j|, override ?
[2012-08-07 18:18:15 -0400] hoover_damm: j|, just assign node['debugmode']="on" in 'staging' and 'off' in production
[2012-08-07 18:18:23 -0400] hoover_damm: and that should trigger whatever you want to make it work
[2012-08-07 18:18:59 -0400] j|: role-based override-level attribute?
[2012-08-07 18:19:03 -0400] hoover_damm: yup
[2012-08-07 18:19:07 -0400] hoover_damm: or env
[2012-08-07 18:19:10 -0400] rayrod2030: do you guys check in .chef files to your source control?
[2012-08-07 18:19:13 -0400] rayrod2030: like checksums?
[2012-08-07 18:20:27 -0400] j|: so basically, what bahman2000 said like 10 minutes ago before I vomited out my own confusion into the channel.
[2012-08-07 18:20:56 -0400] j|: *cough*.. hmm. well, then. doobee doo..
[2012-08-07 18:21:38 -0400] bahman2000: j| hoover_damm why not data bags that feed attributes based on env?
[2012-08-07 18:21:51 -0400] bahman2000: to the cookbook
[2012-08-07 18:22:56 -0400] hoover_damm: bahman2000, data bags are json 'description' files to be populated with data generally to be pulled in by recipes
[2012-08-07 18:23:27 -0400] hoover_damm: bahman2000, having them turn on or off something based on the environment feels a bit slippery... chef-run -E staging ... has to fetch the databag to know to turn it on or off
[2012-08-07 18:25:26 -0400] j|: yea, you're both actually right. Sometimes I think I can't even see the most obvious solution when its staring me in the face because I become way too specific in my understandings of things maybe. I dunno. Whatever the reasons, thanks for guiding me back one step closer to sanity.
[2012-08-07 18:26:23 -0400] hoover_damm: j|, entirely what it is
[2012-08-07 18:26:40 -0400] hoover_damm: j|, we get specific in our direction and that direction is not 'directly' possible
[2012-08-07 18:26:48 -0400] hoover_damm: j|, so we rack our brains trying to find a intersecting route
[2012-08-07 18:27:42 -0400] gregp76: hoover_damm, how can i check for key inside key?
[2012-08-07 18:27:54 -0400] hoover_damm: j|, the inner voice doesn't aliways kick in saying 'wrong way, turn left'
[2012-08-07 18:27:56 -0400] hoover_damm: always*
[2012-08-07 18:27:58 -0400] martinisoft: Ah figured it out, /opt/opscode is for private chef installs and is no longer there in the new omnibus installer
[2012-08-07 18:28:00 -0400] j|: yea.. I'm actually going to walk away from the desk and go think about that. That's coffee-break worthy of a thought.
[2012-08-07 18:28:08 -0400] gregp76: if node.has_key?("dmi"."all_records")
[2012-08-07 18:28:10 -0400] hoover_damm: gregp76, if node['dmi']['system']['product_name'] == 'Dell'?
[2012-08-07 18:28:17 -0400] gregp76: or similar
[2012-08-07 18:28:20 -0400] hoover_damm: huh
[2012-08-07 18:28:37 -0400] hoover_damm: if node.has_key?("dmi") && if node['dmi']['all_records'] > 1
[2012-08-07 18:28:43 -0400] gregp76: because "dmi" exists
[2012-08-07 18:28:51 -0400] hoover_damm: right then you need to check for length
[2012-08-07 18:28:53 -0400] gregp76: this one brings null
[2012-08-07 18:28:56 -0400] hoover_damm: or check the actual value
[2012-08-07 18:29:05 -0400] hoover_damm: so > length?
[2012-08-07 18:30:04 -0400] gregp76: > 1 brings null - retesting
[2012-08-07 18:31:05 -0400] gregp76:  63: <% if node.has_key?("dmi") && node['dmi']['all_records'] > 1  %>
[2012-08-07 18:31:11 -0400] gregp76: Chef::Mixin::Template::TemplateError (undefined method `>' for nil:NilClass) on line #63:
[2012-08-07 18:31:32 -0400] gregp76: it is null
[2012-08-07 18:31:58 -0400] hoover_damm: .length
[2012-08-07 18:31:59 -0400] hoover_damm: sorry
[2012-08-07 18:32:04 -0400] hoover_damm: yeah that's nil'ni'
[2012-08-07 18:32:17 -0400] hoover_damm: so you shouldn't be getting true on node.has_key?("dmi")
[2012-08-07 18:32:25 -0400] hoover_damm: fire up shef and run node['dmi']
[2012-08-07 18:34:05 -0400] pcn: ohai chef
[2012-08-07 18:34:23 -0400] pcn: Quick question - I've got an installation on an aws AMI that pre-installs nscd.conf, but doesn't install nscd (will fix later, etc.).
[2012-08-07 18:34:49 -0400] pcn: It doesn't seem that if I install telling apt to use the existing file, that this is recorded as a selection for ncsd.
[2012-08-07 18:35:08 -0400] pcn: Is there a way to tell chef to just use the existing file with the package resource?
[2012-08-07 18:36:01 -0400] hoover_damm: pcn, put it there before you install?
[2012-08-07 18:36:27 -0400] hoover_damm: pcn, basically from my last communique from Debian they mentioned that dropping the configuration files in /etc before you install the package is becoming the behavior they want
[2012-08-07 18:36:31 -0400] gregp76: chef > node['dmi']
[2012-08-07 18:36:32 -0400] gregp76:  => #<Chef::Node::Attribute @normal={...}, @current_normal=nil, @default={...}, @current_default=nil, @override={...}, @current_override=nil, @automatic={...}, @current_automatic={"dmidecode_version"=>"2.11"}, @current_nesting_level=["dmi"], @auto_vivifiy_on_read=false, @set_unless_value_present=false, @set_type=nil, @has_been_read=false>
[2012-08-07 18:36:52 -0400] gregp76: chef > node['dmi'].length
[2012-08-07 18:36:53 -0400] gregp76:  => 1
[2012-08-07 18:37:03 -0400] pcn: hoover_damm: The file is there, so the installation is bombing because it's asking if I want to overwrite or keep the already-installed file
[2012-08-07 18:37:11 -0400] jtimberman: gregp76: do, node['dmi'].to_hash
[2012-08-07 18:37:16 -0400] gregp76: chef > node['dmi']['all_records']
[2012-08-07 18:37:17 -0400] gregp76:  => nil
[2012-08-07 18:37:28 -0400] hoover_damm: gregp76, trippy... usually don't see dmi on hosts without it
[2012-08-07 18:37:35 -0400] gregp76: chef > node['dmi'].to_hash
[2012-08-07 18:37:36 -0400] gregp76:  => {"dmidecode_version"=>"2.11"}
[2012-08-07 18:37:46 -0400] jtimberman: so thats why its "1"
[2012-08-07 18:37:53 -0400] gregp76: this is xen VM
[2012-08-07 18:37:53 -0400] hoover_damm: > 2
[2012-08-07 18:37:53 -0400] hoover_damm: lol
[2012-08-07 18:38:03 -0400] gregp76: hehe
[2012-08-07 18:38:06 -0400] hoover_damm: so we record the version
[2012-08-07 18:38:07 -0400] hoover_damm: doh
[2012-08-07 18:38:08 -0400] jtimberman: gregp76: your if statement should check for existence of the all_records key under dmi
[2012-08-07 18:38:21 -0400] hoover_damm: jtimberman, he's just the user...
[2012-08-07 18:38:38 -0400] gregp76: :)
[2012-08-07 18:39:02 -0400] gregp76: i'll open a COOK
[2012-08-07 18:39:06 -0400] jtimberman: gregp76: something like this: <% if node.attribute?("dmi") && node['dmi'].attribute?("all_records") -%>
[2012-08-07 18:39:11 -0400] jtimberman: which cookbook is this in?
[2012-08-07 18:40:24 -0400] jtimberman: I see snmpd.conf.erb in the backscroll... Opscode doesn't publish an SNMP cookbook.
[2012-08-07 18:41:09 -0400] bahman2000: pcn so you want something like an --assumeno yum option?
[2012-08-07 18:41:26 -0400] pcn: bahman2000: in this case, I think so
[2012-08-07 18:41:51 -0400] pcn: Since it's not a selection, it doesn't seem to produce a response that I can put into a response file, unless I missed something
[2012-08-07 18:56:40 -0400] pcn: bahman2000: I'm taking the opposite approach, ssh'ing out, 'echo O | sudo apt-get install nscd'
[2012-08-07 18:56:58 -0400] pcn: Both ways are crummy and not easily well-automated.  E.g. how do you run a system if /etc/nscd.conf goes away at the wrong time?
[2012-08-07 18:57:29 -0400] bahman2000: pcn you're assuming all systems are apt-get what if yum? mv is cross-platform ;)
[2012-08-07 18:57:47 -0400] mattray: I'm getting a lot of api timeouts and retries, anyone else?
[2012-08-07 18:57:56 -0400] pcn: yum/rpm doesn't often inquire about your preferences during an installation.
[2012-08-07 18:58:28 -0400] pcn: mattray: a couple, nothing out of the ordinary
[2012-08-07 18:59:36 -0400] geekbri: mattray: I'm getting API timesout at the moment as well
[2012-08-07 19:00:14 -0400] geekbri: mattray: mine seem to have resolved themselves speedily for now :)
[2012-08-07 19:03:35 -0400] geekbri: mattray: Maybe it seems like its not such a resolved issue :)
[2012-08-07 19:04:32 -0400] pcn: Still lots of timeouts, but after a 1 second back-down, the calls are usually succeeding.
[2012-08-07 19:04:43 -0400] mattray: yeah, support is looking into it
[2012-08-07 19:08:10 -0400] jsnapp: jtimberman: so i confirmed that the FC003 commit to users cookbook prevents chef-solo databag search functionality that the chef-solo-search AND littlechef cookbooks provide ... just wondering if the kind of changes FC003 made to users cookbook will be routine for other cookbooks that rely on databag search?
[2012-08-07 19:12:49 -0400] gregp76: matching manufacturer looks strange
[2012-08-07 19:13:03 -0400] gregp76: chef > node[:dmi][:system][:manufacturer]
[2012-08-07 19:13:03 -0400] gregp76:  => "Dell Inc."
[2012-08-07 19:13:05 -0400] gregp76: chef > node[:dmi][:system][:manufacturer] =~ /dell/
[2012-08-07 19:13:06 -0400] gregp76:  => nil
[2012-08-07 19:13:07 -0400] gregp76: chef > node[:dmi][:system][:manufacturer] =~ /Dell/
[2012-08-07 19:13:08 -0400] gregp76:  => 0
[2012-08-07 19:13:31 -0400] gregp76: am i supposed to get "0" on positive match?
[2012-08-07 19:13:47 -0400] yfeldblum: String#=~ returns the index in the string of the matched substring (or nil, if there was no match)
[2012-08-07 19:14:16 -0400] ssd7: For reference: http://www.ruby-doc.org/core-1.9.3/String.html#method-i-3D-7E
[2012-08-07 19:14:48 -0400] gregp76: thanks
[2012-08-07 19:15:08 -0400] yfeldblum: gregp76, also, 0 is considered "truthy" in ruby ... `if 0 then "true!" else "false!" end` will evaluate to "true!" for example
[2012-08-07 19:15:31 -0400] gregp76: got it
[2012-08-07 19:17:50 -0400] Twirrim: 'truthy'? That's a scary concept :D
[2012-08-07 19:18:08 -0400] yfeldblum: jsnapp, this is the same problem we faced when running JavaScript in the browser, and wishing to test whether a feature was available ... Chef should really expose a method `#search_available?` or something like that which we can use to decide whether or not to use search
[2012-08-07 19:19:17 -0400] yfeldblum: Twirrim, just shorthand for: "if pressed (coerced), would this be true or false?"
[2012-08-07 19:20:55 -0400] mattray: dpetzel: did that pull request fix your issue?
[2012-08-07 19:21:08 -0400] stormerider: just got an email about the opscode community summit in october. is that a free event or?
[2012-08-07 19:21:19 -0400] dpetzel: mattray, no that was a seperate issue
[2012-08-07 19:21:41 -0400] mattray: dpetzel: ahh, could you open a bug on tickets.opscode.com and assign it to me? that'll help get it tracked
[2012-08-07 19:21:58 -0400] dpetzel: mattray, from what I can, my issue would have to get addressed in https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/ssh.rb since from what I can that is the code that handles the login code
[2012-08-07 19:22:11 -0400] dpetzel: mattray, the plugin doesnt have access to the console output to detect the prompt right?
[2012-08-07 19:22:32 -0400] mattray: dpetzel: don't think so, it's non-interactive in the bootstrap
[2012-08-07 19:23:03 -0400] dpetzel: mattray, that was the conclusion I cam to as well, so I couldnt come up with a way in the plugin to do in. I will open a bug though
[2012-08-07 19:25:24 -0400] mattray: stormerider: I can't remember if it was free or cheap, like $100
[2012-08-07 19:26:00 -0400] mattray: more details coming on the 15th I guess
[2012-08-07 19:29:36 -0400] dpetzel: mattray, KNIFE_OPENSTACK-8, let me know if you need any more info. Thanks
[2012-08-07 19:30:24 -0400] mattray: thanks
[2012-08-07 19:36:27 -0400] jameson_: mm, does the hosted-chef server never change it's ip addr?
[2012-08-07 19:37:50 -0400] chip-: Use a name.
[2012-08-07 19:38:37 -0400] jameson_: node.hosted_chef ?
[2012-08-07 19:38:44 -0400] jtimberman: jameson_: api.opscode.com should always point to the right thing.
[2012-08-07 19:38:58 -0400] ssd7: jameson_: We are currently dns round-robin'd across two address (184.106.28.80 and 184.106.28.81).  We don't change them often and will likely announce when we do, but you should use api.opscode.com wherever possible.
[2012-08-07 19:39:02 -0400] pulsejc: can I specify for a role to use a recipe from a specific cookbook version?
[2012-08-07 19:39:08 -0400] jtimberman: chef_server_url "https://api.opscode.com/organizations/YOURORGNAME"
[2012-08-07 19:39:21 -0400] jtimberman: ssd7: :D
[2012-08-07 19:39:31 -0400] jameson_: jtimberman, ssd7: ah thanks
[2012-08-07 19:39:37 -0400] jameson_: i'll point it at api.opscode.com
[2012-08-07 19:40:18 -0400] paigeat: https://github.com/holland-backup/holland anyone here used this before?
[2012-08-07 19:43:37 -0400] smw: jtimberman, hey. We were talking about finding a binary after it is installed using gem. It appears node[:languages][:ruby][:bin_dir] points to /usr/bin, not /usr/local/bin
[2012-08-07 19:44:24 -0400] smw: jtimberman, I think the only way to do it is to declare the path and then let the shell find it. Give up trying to locate the binary manually.
[2012-08-07 19:51:49 -0400] bdot_: hi guys,
[2012-08-07 19:51:57 -0400] bdot_: anyone saw this error before: Merb::ControllerExceptions::Forbidden
[2012-08-07 19:52:38 -0400] bdot_: knife threw this error when trying to upload a cookbook
[2012-08-07 19:52:47 -0400] bdot_: this is weird
[2012-08-07 19:53:01 -0400] bdot_: I'm using the validator key in knife.rb
[2012-08-07 19:53:48 -0400] ranjibd: bdot_, u need an admin client
[2012-08-07 19:53:59 -0400] ranjibd: else u wont be able to do write operations
[2012-08-07 19:54:30 -0400] bdot_: I have granted the admin permission for this client.
[2012-08-07 19:59:11 -0400] bdot_: I double-checked the permission for the client.
[2012-08-07 19:59:16 -0400] bdot_: it has all admin permissions.
[2012-08-07 19:59:29 -0400] bdot_: why still not able to upload cookbook?
[2012-08-07 20:05:39 -0400] knuckolls: i'd like to be able to have a staging environment that mimics my production environment. is anyone doing this? i'm curious about how you route urls to the correct environment. i'd prefer to have to only say i want to see stage.subdomain.domain.com to visit the staging area but whatever works
[2012-08-07 20:15:28 -0400] hoover_damm: smw, what's wrong with which
[2012-08-07 20:15:32 -0400] hoover_damm: smw, `which god`
[2012-08-07 20:15:57 -0400] hoover_damm: smw, I guess there is no good pattern here only bad patterns
[2012-08-07 20:35:22 -0400] beandip: I'm having issues with the logstash::agent role in the community logstash cookbook: http://pastebin.com/GHfgfy0X
[2012-08-07 20:35:34 -0400] beandip: seems like it's looking for a missing template file
[2012-08-07 20:35:49 -0400] beandip: the pastbin is my chef-client output
[2012-08-07 20:38:37 -0400] pcn: beandip does your node data have node['logstash']['agent']?
[2012-08-07 20:39:43 -0400] ranjibd: bdot_, validation client is a special one .. im not sure you have to browse through the chef server api code to check if making validator client as admin will work or not.. but it does sound wrong thing to do. why you are not creating a separate admin client?
[2012-08-07 20:40:45 -0400] ranjibd: knuckolls, we use node.chef_environment to generate the url or to restrict the searches
[2012-08-07 20:41:42 -0400] bdot_: Ranjibd, i have been using the same instance as admin and also validating new nodes.
[2012-08-07 20:42:10 -0400] bdot_: not sure what's the difference and why need to have two saperate nodes for those roles.
[2012-08-07 20:43:50 -0400] beandip: pcn, here's my node:http://pastebin.com/GzXJ8KXk
[2012-08-07 20:45:16 -0400] beandip: I have a role called monitoring that contains the logstash::agent
[2012-08-07 20:45:38 -0400] beandip: do I need to apply logstash::agent directly to the node's runlist rather than calling it through a role?
[2012-08-07 20:45:39 -0400] kesor: i'm trying to fix a bug with chef not doing ohai reloads, but need to know a bit more about how providers are loaded in the exec. path . can someone help?
[2012-08-07 20:46:18 -0400] kesor: beandip: it depends if you want it in a role, or for a specific node.
[2012-08-07 20:46:50 -0400] beandip: I want it for a role
[2012-08-07 20:46:54 -0400] beandip: kesor
[2012-08-07 20:46:55 -0400] kesor: then add it to a role.
[2012-08-07 20:47:03 -0400] beandip: here's that I'm running into:
[2012-08-07 20:47:19 -0400] beandip: http://pastebin.com/GHfgfy0X
[2012-08-07 20:47:35 -0400] beandip: s/that/what
[2012-08-07 20:48:19 -0400] kesor: looks like you don't have the node['logstash']['agent']['inputs'] attribute defined, it should probably be part of the cookbook's attributes/default.rb file or something.
[2012-08-07 20:48:56 -0400] kesor: or maybe the logstash::agent cookbook expects you to define that attribute you can do that in the role as well.
[2012-08-07 20:49:09 -0400] kesor: its usually explained in the cookbook readme, if it has one.
[2012-08-07 20:51:24 -0400] kesor: anyone with chef internals experience around? been trying to fix this chef bug for hours and would appreciate some help.
[2012-08-07 20:52:43 -0400] yfeldblum: kesor, nope, they only work 1-hour days over at opscode, but ask anyway
[2012-08-07 20:55:26 -0400] kesor: http://pastie.org/4407936 I'm trying to do ohai action :reload, but it doesnt stick
[2012-08-07 20:55:51 -0400] kesor: although the providers/ohai.rb does it correctly, when I'm back in the cookbook - the old value is still present.
[2012-08-07 20:56:51 -0400] paigeat: I need to go vaccum the cat
[2012-08-07 20:57:02 -0400] pcn: beandip: I'm thinking the same thing as kesor, but you need full node data, not just the summary.  You can force a dump, or use shef to confirm that the node['logstash']['agent'] is/isn't there at different points in the run
[2012-08-07 20:59:41 -0400] kesor: is it me doing something wrong, or is that a bug with chef?
[2012-08-07 21:00:36 -0400] kesor: and if it is a bug with chef, I need some help fixing it  since I can't trace the root of the problem.
[2012-08-07 21:05:31 -0400] gmcinnes1: Does chef client have a lie-to-me mode yet?
[2012-08-07 21:05:52 -0400] kesor: pretend mode?
[2012-08-07 21:06:00 -0400] spox: whyrun
[2012-08-07 21:06:06 -0400] fooforge: kesor: Can't help with debugging at the moment, but this'd be related: http://tickets.opscode.com/browse/OHAI-388 Might be worth watching the ticket.
[2012-08-07 21:06:19 -0400] Randm: gmcinnes1: no
[2012-08-07 21:06:32 -0400] kesor: fooforge: yeah, i've seen the ticket. and I want to fix the bug :)
[2012-08-07 21:07:11 -0400] kesor: because that bug has been bugging me for a month and its time to do something about it.
[2012-08-07 21:08:48 -0400] yfeldblum: kesor, when you declare a resource, you set the name and attributes at compile time, but the resource is only acted upon at converge time
[2012-08-07 21:09:35 -0400] yfeldblum: kesor, in your example, you declare a resource of type `log` with a name that you compute after declaring the ohai resource, but before its reload action is run
[2012-08-07 21:09:37 -0400] kesor: yfeldblum: oh, so it could be a case of next-in-line resources/providers remembering their old ohai attributes and thats why they show the old values?
[2012-08-07 21:09:58 -0400] kesor: yfeldblum: makes sense
[2012-08-07 21:10:46 -0400] kesor: yfeldblum: can I force a recompile from ohai:reload ?
[2012-08-07 21:11:20 -0400] yfeldblum: kesor, no
[2012-08-07 21:12:06 -0400] kesor: yfeldblum: hmm, how about updating contexts of foreign providers/resources?
[2012-08-07 21:12:19 -0400] yfeldblum: kesor, doubtful
[2012-08-07 21:12:57 -0400] yfeldblum: kesor, it looks like you're trying to do something opposite of how chef is designed to work
[2012-08-07 21:13:25 -0400] kesor: yfeldblum: I kinda thought the whole purpose of ohai action :reload was to do this.
[2012-08-07 21:14:00 -0400] kesor: since it doesn't do it then actual reload only happens on the next chef run, which makes the :reload obsolete anyway.
[2012-08-07 21:14:02 -0400] jtimberman: kesor: you mean rebuild the resource collection, or the attributes?
[2012-08-07 21:14:20 -0400] kesor: i mean update the attributes for the next-in-line steps that are going to be executed.
[2012-08-07 21:14:44 -0400] yfeldblum: kesor, in chef, your recipes (ruby code) declare a list of resources and assigns their attributes; once all of your recipes have finished executing, chef inspects the list of resources you have declared and invokes their actions one after the other
[2012-08-07 21:15:18 -0400] yfeldblum: kesor, it looks like you're not declaring all your resources with all their attributes up front
[2012-08-07 21:15:58 -0400] kesor: yfeldblum: i'm not declaring them at all, i'm relying on ohai attributes
[2012-08-07 21:16:15 -0400] yfeldblum: kesor, recipes are not a step-by-step affair; they're an all-at-once declaration affair followed by an all-at-once convergence affair
[2012-08-07 21:16:30 -0400] evilantnie: I had a power outage on a previously working node over the weekend... when trying to boot it back up, it started running it's run_list but now gets a 403 when trying to write node data back to the chef server.  What could be going on here?
[2012-08-07 21:16:40 -0400] kesor: yfeldblum: is there a purpose for "ohai action :reload" then?
[2012-08-07 21:17:40 -0400] yfeldblum: kesor, of course - e.g., if you want to save to the chef-server the fact that there's a new ruby, and you want to save that in the same run that installed ruby in the first place
[2012-08-07 21:18:23 -0400] jtimberman: kesor: have you pastd your recipe somewhere?
[2012-08-07 21:25:03 -0400] kesor: why is http://wiki.opscode.com broken and only https working? :/
[2012-08-07 21:25:50 -0400] jtimberman: kesor: I'm able to access http://wiki.opscode.com
[2012-08-07 21:26:14 -0400] kesor: strange, its broken for me on two different computers and in two different locations (isps)
[2012-08-07 21:26:27 -0400] miah: do you live in china?
[2012-08-07 21:27:39 -0400] kesor: no. now tested it and it works with curl, but broken with chrome :/
[2012-08-07 21:28:11 -0400] kesor: oh. works with chrome incognito mode.
[2012-08-07 21:28:12 -0400] kesor: bah
[2012-08-07 21:28:21 -0400] kesor: must be a b0rked cookie or something
[2012-08-07 21:28:22 -0400] jtimberman: i went in chrome normal mode just fine O.o
[2012-08-07 21:28:25 -0400] gmcinnes1: borked cookies or something?
[2012-08-07 21:28:33 -0400] kesor: :)
[2012-08-07 21:29:00 -0400] gmcinnes1: great minds think alike!
[2012-08-07 21:29:33 -0400] kesor: cleared cookies, now works fine :)
[2012-08-07 21:29:45 -0400] kesor: silly chrome synchronizing b0rked cookies.
[2012-08-07 21:30:14 -0400] jtimberman: oh fun yeah
[2012-08-07 21:30:17 -0400] kesor: interesting it worked fine with https
[2012-08-07 21:39:42 -0400] kesor: so, is there a best-practice or some pattern that can be used to update a resource, say ruby, and in the same chef run depend on it within other resources like say gem_package?
[2012-08-07 21:40:45 -0400] dcrosta: is there documentation anywhere on how to write an scm resource provider for use with application/deploy_revision?
[2012-08-07 21:41:04 -0400] dcrosta: or should i just crib from the git provider?
[2012-08-07 21:42:53 -0400] mattray: kesor: http://wiki.opscode.com/display/chef/Resources#Resources-Notifications
[2012-08-07 21:43:18 -0400] mattray: dcrosta: you want to add an scm provider?
[2012-08-07 21:43:31 -0400] kesor: mattray: notifications is not it.
[2012-08-07 21:44:23 -0400] dcrosta: mattray: yeah -- actually, sort of. i want to fake one that uses a vagrant shared folder (where the shared folder itself is under source control, but outside of the vm). tell me if that sounds too crazy
[2012-08-07 21:44:26 -0400] mattray: kesor: not sure I understand the question
[2012-08-07 21:45:20 -0400] mattray: dcrosta: you could probably crib notes from the Mercurial cookbook
[2012-08-07 21:45:22 -0400] mattray: dcrosta: https://github.com/opscode-cookbooks/mercurial/blob/master/providers/default.rb
[2012-08-07 21:45:36 -0400] dcrosta: mattray: neat, thanks
[2012-08-07 21:45:59 -0400] kesor: mattray: for example, I have a recipe that installed a new ruby in /usr/local/bin and a new /usr/local/bin/gem. Then the next recipe is using gem_package to install some gems, and it is using ohai's languages/ruby/gem_bin which is not the new one but the old one.
[2012-08-07 21:46:14 -0400] mattray: kesor: ahh
[2012-08-07 21:47:13 -0400] kesor: mattray: and from what I understand it happens because when all the cookbooks are loaded, gem_package is loaded with the gem_bin specified (at the very start). and any changes afterwards during the run do not affect it anymore, even with ohai:reload.
[2012-08-07 21:47:26 -0400] mattray: kesor: you want to use gem_binary I think with the gem_package resource
[2012-08-07 21:47:58 -0400] mattray: kesor: I _believe_ that's what it's for
[2012-08-07 21:47:58 -0400] kesor: mattray: I don't want to be explicit about it, and I don't want to modify off-the-shelf cookbooks that use it  I just want to hint them to use the new gem binary without running chef twice.
[2012-08-07 21:48:06 -0400] mattray: yup
[2012-08-07 21:48:14 -0400] mattray: kesor: you want the shell ruby, not the chef ruby
[2012-08-07 21:48:33 -0400] mattray: http://wiki.opscode.com/display/chef/Resources#Resources-Package
[2012-08-07 21:48:57 -0400] kesor: mattray: so how do I update gem_package to use the new one during the same run?
[2012-08-07 21:50:36 -0400] mattray: kesor: I believe the build-essential cookbook can build the gem https://github.com/opscode-cookbooks/build-essential
[2012-08-07 21:50:49 -0400] mattray: kesor: with the compiletime attribute
[2012-08-07 21:50:59 -0400] mattray: so the gem gets built, then is available later
[2012-08-07 21:50:59 -0400] kesor: mattray: this makes no sense.
[2012-08-07 21:51:09 -0400] mattray: kesor: well, I'm using it with chef_gem
[2012-08-07 21:51:17 -0400] mattray: and I assume it works with gem_package
[2012-08-07 21:51:23 -0400] mattray: you use build-essential to build the gem
[2012-08-07 21:51:42 -0400] kesor: what gcc/make/etc.. has to do with anything? :/
[2012-08-07 21:51:51 -0400] mattray: kesor: how are you building your gems?
[2012-08-07 21:52:22 -0400] mattray: (with C extensions)
[2012-08-07 21:52:37 -0400] kesor: it is irrelevant to the discussion, it does not matter if the gems are built or not built.
[2012-08-07 21:52:58 -0400] mattray: I thought you were trying to build gems for use later in your run?
[2012-08-07 21:53:01 -0400] dougnaka: Hi all, I am trying to install chef-server in ubuntu 10.04 and 12.04, running into the same problem in both, when starting chef-expander I receive the error "FATAL: Chef is not a class (TypeError)"
[2012-08-07 21:53:19 -0400] dougnaka: it looks like it's used as a Method in chef-expander but is a class in Chef
[2012-08-07 21:53:21 -0400] kesor: mattray: that is not really the problem I am describing. nevermind.
[2012-08-07 21:53:28 -0400] dougnaka: I can't find anyone else having the same problem via google
[2012-08-07 21:53:37 -0400] mattray: kesor: sorry :/
[2012-08-07 21:55:02 -0400] siezer: kesor do you mean, "how can I make sure a gem is intalled at compile time, so its available at converge time?"
[2012-08-07 21:55:24 -0400] kesor: siezer: exactly.
[2012-08-07 21:55:24 -0400] siezer: gem_packge "whatever" do action :install end.run_action(:install)
[2012-08-07 21:55:46 -0400] kesor: siezer: but I don't want to modify off-the-shelf cookbooks like you just described, I want them to just work.
[2012-08-07 21:56:34 -0400] kesor: siezer: so how can I install the "gem" binary during compile time, so that during converge all the other resources get the newly installed "gem" binary from ohai/languages/ruby ?
[2012-08-07 21:58:12 -0400] siezer: are you using an omnibus installed chef?
[2012-08-07 21:58:27 -0400] kesor: siezer: its a vagrant one, but its the same, it has its own path.
[2012-08-07 21:58:42 -0400] kesor: in production i do knife bootstrap, so I think its omnibus
[2012-08-07 22:00:13 -0400] siezer: chef-client -v ?
[2012-08-07 22:00:52 -0400] kesor: 10.12.0
[2012-08-07 22:01:31 -0400] siezer: ls -la /opt/opscode/embedded/bin/gem?
[2012-08-07 22:02:17 -0400] kesor: siezer: no such thing, but I have /opt/vagrant_ruby/bin/gem
[2012-08-07 22:02:28 -0400] siezer: hrm
[2012-08-07 22:02:47 -0400] kesor: siezer: do you know how I can install a package during compile?
[2012-08-07 22:03:13 -0400] kesor: siezer: at first I wanted to fix this: http://pastie.org/4407936  but now you've given me an idea how I can avoid the problem.
[2012-08-07 22:03:20 -0400] siezer: you can install anything during compile by using that .end.run_action(:install) trick
[2012-08-07 22:03:42 -0400] kesor: i'll test it now
[2012-08-07 22:03:48 -0400] beandip: pcn and kesor thanks for the help earlier
[2012-08-07 22:03:51 -0400] beandip: you sorted me out
[2012-08-07 22:05:33 -0400] kesor: siezer: nice! it worked :)
[2012-08-07 22:05:45 -0400] Bonkers: if node.nginx.version is set on a node, should changing the value in a role file in override_attributes and rerunning chef-client replace that value?
[2012-08-07 22:06:12 -0400] kesor: Bonkers: it should, but the cookbook has bugs in that area so it wont.
[2012-08-07 22:07:02 -0400] jtimberman: siezer: its /opt/chef in 10.12.
[2012-08-07 22:07:11 -0400] siezer: jtimberman wat
[2012-08-07 22:07:11 -0400] jtimberman: siezer: so we don't conflict with /opt/opscode for private chef installs.
[2012-08-07 22:07:14 -0400] siezer: ah
[2012-08-07 22:07:31 -0400] Bonkers: kesor, hmm, I'm not even seeing the value change for some reason though, i've already heavily modified the cookbooks since I've noticed many bugs
[2012-08-07 22:07:33 -0400] kesor: siezer: check it out, http://pastie.org/4408236  it worked properly.
[2012-08-07 22:07:37 -0400] jtimberman: i believe the 10.12 release annoucnement inclkuded that
[2012-08-07 22:07:53 -0400] siezer: kesor *highfive*
[2012-08-07 22:08:14 -0400] kesor: siezer: although it looks like a very very very ugly hack., but it seems justified here for some reason.
[2012-08-07 22:08:26 -0400] Bonkers: a simple 'puts node.nginx.version' at the top of the recipe shows the old version
[2012-08-07 22:09:18 -0400] kesor: Bonkers: if I remember correctly it was hardcoded improperly in the attributes/default.rb file. although i might be mistaken.
[2012-08-07 22:09:19 -0400] jtimberman: kesor: managing ruby applications with chef is tricky :)
[2012-08-07 22:09:41 -0400] siezer: kesor yea.. a lot of times you'll need to load rubygems in the compile phase that are needed by various libraries and things in your run list
[2012-08-07 22:09:55 -0400] siezer: ^ what jtimberman said, ironically enough.
[2012-08-07 22:09:59 -0400] kesor: jtimberman: as long as the recipe that installs ruby has these .run_action(:stuff) in them  it makes it more manageable.
[2012-08-07 22:10:09 -0400] Bonkers: kesor, the URL generation based on the version number was, but not the version number itself
[2012-08-07 22:10:53 -0400] martinisoft: jtimberman: if I had omnibus installed back in 0.10.8 and it was /opt/opscode, but now /opt/chef in 10.12, can I remove the /opt/opscode folder?
[2012-08-07 22:11:00 -0400] kesor: Bonkers: try and see if its hardcoded into the node as well, like knife node show  might be when you change it in the role it does not affect the role.
[2012-08-07 22:11:08 -0400] jtimberman: martinisoft: yes as long as you don't have something else pointing to that path for some reason.
[2012-08-07 22:11:30 -0400] kesor: Bonkers: i mean does not affect the run.
[2012-08-07 22:11:30 -0400] dougnaka: Anyone see this error before http://pastie.org/4408259
[2012-08-07 22:11:34 -0400] martinisoft: nope, the new installer made new symlinks in /usr/bin to the new chef install
[2012-08-07 22:12:07 -0400] kesor: dougnaka: looks like chef-solr has a typo
[2012-08-07 22:12:21 -0400] dougnaka: kesor: would that be in /etc/chef/solr.rb?
[2012-08-07 22:12:39 -0400] martinisoft: is there any way to debug a cookbook's run? having trouble using the user cookbook, doesn't seem to be applying my users data bag items :(
[2012-08-07 22:12:41 -0400] Bonkers: kesor, nope, not there, it is in node.automatic_attributes though during the recipe run
[2012-08-07 22:13:12 -0400] kesor: Bonkers: oh  right, its because nginx has this ugly nasty ohai plugin it places in /etc/chef/plugins.
[2012-08-07 22:13:35 -0400] Bonkers: do all automatic attributes win out?
[2012-08-07 22:13:41 -0400] Bonkers: just rereading the auto attrs page...
[2012-08-07 22:13:41 -0400] kesor: yes. always
[2012-08-07 22:14:05 -0400] kesor: and nginx cookbook hardcodes the existing version of nginx into auto attrs
[2012-08-07 22:14:10 -0400] kesor: via the ohai plugin
[2012-08-07 22:14:30 -0400] jtimberman: martinisoft: chef-client -l debug
[2012-08-07 22:14:44 -0400] Bonkers: so basically what you're saying is I'm about to add node.nginx.desired_version
[2012-08-07 22:15:02 -0400] kesor: Bonkers: I created a pull request for that in the chef-nginx repo 
[2012-08-07 22:15:21 -0400] jtimberman: dougnaka: what are the contents of the version.rb file? is the first line actuall class Cef ?
[2012-08-07 22:15:32 -0400] kesor: Bonkers: https://github.com/opscode-cookbooks/nginx/pull/14
[2012-08-07 22:15:37 -0400] Bonkers: kesor, heh, awesome, I've changed enough of this that it'll be fast enough with the PR
[2012-08-07 22:15:39 -0400] jtimberman: Sounds like something mangled that, because from the 10.12.0 tag in the source, it is class Chef.
[2012-08-07 22:15:41 -0400] Bonkers: I'd have ot merge too much other stuff
[2012-08-07 22:15:59 -0400] kesor: Bonkers: I would recommend going over the other pull requests as well, there are about 18 of them  mostly nasty bugs.
[2012-08-07 22:16:01 -0400] dougnaka: jtimberman: http://pastie.org/4408284
[2012-08-07 22:16:15 -0400] martinisoft: jtimberman: awesome! thanks :)
[2012-08-07 22:16:44 -0400] Bonkers: kesor, I've actually got nginx working fully after quite some digging. Probably should have looked there first though. I'm just working on adding in SPDY support right now and that means my first every nginx upgrade
[2012-08-07 22:18:15 -0400] kesor: Bonkers: the nginx::source recipe is not a great one, I wasted quite a bit of time fixing it to work properly  was compiling-in passenger. when time allows I would really love to just make me a dpkg from it and beam it up into some ppa.
[2012-08-07 22:18:23 -0400] Bonkers: so I suppose this line was just a joke 'node.automatic_attrs['nginx']['version'] == node['nginx']['version']' hehe, since it's always true
[2012-08-07 22:19:03 -0400] Bonkers: kesor, that sort of solution wouldn't really be feasible for me, that doesn't allow changing config flags and such, it really needs just a big of cleaning, a lot of the config flag adding is pretty broken too
[2012-08-07 22:19:05 -0400] kesor: Bonkers: I just think that whoever wrote it didn't have a clue.
[2012-08-07 22:19:18 -0400] Bonkers: I've encountered a bunch of that really
[2012-08-07 22:19:24 -0400] Bonkers: I rewrote all of the bluepill stuff
[2012-08-07 22:19:50 -0400] Bonkers: but once I got it all working, it's actually quite nice
[2012-08-07 22:19:57 -0400] Bonkers: and now I know too much about chef
[2012-08-07 22:20:01 -0400] kesor: unfortunately most of the really bad cookbooks have quite a lot of pull requests, but opscode don't like to merge-in things that dont have a consent form signed and a jira ticket opened  so pull requests are your friend.
[2012-08-07 22:20:13 -0400] jtimberman: its pretty hard to deal with nginx not having dynamic module support, and requiring compiling everything you might want to enable on the system.
[2012-08-07 22:20:17 -0400] Majost: Pardon my newbieness; is there a Ruby construct or library chef uses for the additive attribute defininations? eg: node['myApp']['var1']['subvar1'] -- where subvar1 is a child of the first two. It's something I would like to steal for non-chef ruby stuff.
[2012-08-07 22:20:55 -0400] jtimberman: the nginx::source recipe tries to allow for as much dynamic configuration as may be reasonable to expect out of such software.
[2012-08-07 22:21:24 -0400] Bonkers: jtimberman, and all of that works, if it's done right, the code is just plain broken
[2012-08-07 22:21:28 -0400] jtimberman: we have a number of resolved tickets with pull requests outstanding, and simply haven't gotten to them in our code review meetings.
[2012-08-07 22:21:34 -0400] kesor: jtimberman: yeah, I actually loved the concept of configure_flags it has.
[2012-08-07 22:21:35 -0400] Bonkers: maybe it worked in an older version of chef, I haven't been around long enough to know
[2012-08-07 22:23:19 -0400] spox: Majost: https://github.com/opscode/chef/blob/master/chef/lib/chef/node/attribute.rb
[2012-08-07 22:23:42 -0400] jtimberman: Wow. So, in five months, nginx has gone from 1.0.14 -> 1.2.3 as stable.
[2012-08-07 22:23:51 -0400] hoover_damm: jtimberman, sucks huh
[2012-08-07 22:24:18 -0400] hoover_damm: jtimberman, personally it's a breath of fresh air to not have to care :) because nginx is just crazy lately
[2012-08-07 22:24:24 -0400] hoover_damm: jtimberman, it's worse then redis almost
[2012-08-07 22:24:40 -0400] jtimberman: 1.1.19 is the version in ubuntu 12.04.
[2012-08-07 22:24:50 -0400] joonas: So sometimes my knife cook runs fail with chef-solo and I'm left behind with a bunch of crap in the chef-solo folder that's owned by root
[2012-08-07 22:24:57 -0400] kesor: jtimberman: 1.2 got stable just a couple of days ago
[2012-08-07 22:25:06 -0400] joonas: so the next time I run knife cook again for that server, it fails while checking cookbook syntax
[2012-08-07 22:25:14 -0400] Majost: hoover_damm: The versioning discussion reminds me, It looks like ruby-pg is adding official support for 9.2
[2012-08-07 22:25:20 -0400] jtimberman: Bonkers: so is your issue that the version attribute change doesn't get you the right version installed?
[2012-08-07 22:25:23 -0400] jtimberman: via a role
[2012-08-07 22:25:24 -0400] joonas: so I'm wondering, is there any way I could run something that would clean up that mess that's left behind when the run fails?
[2012-08-07 22:25:25 -0400] jtimberman: for example
[2012-08-07 22:26:07 -0400] Majost: spox: thanks. =)
[2012-08-07 22:26:19 -0400] kesor: jtimberman: i got an explanation of that problem in my pull request, https://github.com/opscode-cookbooks/nginx/pull/14
[2012-08-07 22:26:22 -0400] Bonkers: jtimberman, yes, that was the particular one I was asking about
[2012-08-07 22:45:09 -0400] yfeldblum: jtimberman, 1 non-patch-level stable version bump in five months?
[2012-08-07 22:45:39 -0400] jtimberman: yfeldblum: 1.0.x -> 1.2.x?
[2012-08-07 22:46:40 -0400] yfeldblum: jtimberman, right
[2012-08-07 22:47:55 -0400] beandip: I'm getting errors that bundler requires RubyGems 1.3.6 on an buntu 10.04 system
[2012-08-07 22:48:04 -0400] hoover_damm: LOL
[2012-08-07 22:48:06 -0400] hoover_damm: i love that error
[2012-08-07 22:48:13 -0400] beandip: hoover_damm: any pointers?
[2012-08-07 22:48:18 -0400] hoover_damm: beandip, ruby -v and let's see what you got
[2012-08-07 22:48:29 -0400] hoover_damm: beandip, you have too little information for me to know off hand
[2012-08-07 22:48:41 -0400] yfeldblum: jtimberman, i'm under the impression that even-minor releases are stable, and patch-level releases are fixes rather than features
[2012-08-07 22:48:45 -0400] beandip: well
[2012-08-07 22:48:55 -0400] beandip: I installed the rvm cookbook
[2012-08-07 22:49:05 -0400] beandip: and asked it to install ree 1.8.7
[2012-08-07 22:49:09 -0400] hoover_damm: nevermind I said anything you said RVM.
[2012-08-07 22:49:19 -0400] beandip: so root on the node I get:
[2012-08-07 22:49:27 -0400] beandip: root@graylog00:~# ruby -v
[2012-08-07 22:49:29 -0400] beandip: ruby 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux]
[2012-08-07 22:49:57 -0400] hoover_damm: rvm use ree... rvm rubygems latest
[2012-08-07 22:49:59 -0400] hoover_damm: might fix it
[2012-08-07 22:50:09 -0400] beandip: but before I installed the rvm cookbook
[2012-08-07 22:50:11 -0400] hoover_damm: basically wayne should be patching rubygems to point to the proper binpath
[2012-08-07 22:50:28 -0400] beandip: root@graylog00:~# gem -v
[2012-08-07 22:50:29 -0400] hoover_damm: ree is bizzare because it occupies the same space
[2012-08-07 22:50:30 -0400] beandip: 1.3.5
[2012-08-07 22:50:32 -0400] hoover_damm: and yet it's not ruby
[2012-08-07 22:50:34 -0400] hoover_damm: right
[2012-08-07 22:50:34 -0400] martinisoft: data bags (at least when made in hosted chef) are available to all nodes, right?
[2012-08-07 22:50:36 -0400] beandip: hmmm
[2012-08-07 22:50:37 -0400] hoover_damm: it installs 1.3.5 by default
[2012-08-07 22:50:49 -0400] hoover_damm: so it looks like that error was right
[2012-08-07 22:50:53 -0400] hoover_damm: you installed ree, you got 1.3.5
[2012-08-07 22:50:57 -0400] hoover_damm: next?
[2012-08-07 22:50:58 -0400] bawt: next is 0.9.10
[2012-08-07 22:52:22 -0400] yfeldblum: martinisoft, yes
[2012-08-07 22:52:38 -0400] yfeldblum: martinisoft, including, available to all nodes in all chef-environments
[2012-08-07 22:53:00 -0400] martinisoft: ah gotcha
[2012-08-07 22:53:18 -0400] beandip: hoover_damm: lol, before I mentioned rvm, how were you going to suggest I takle the error?
[2012-08-07 22:53:36 -0400] beandip: because I can always back the rvm recipe out of the role if there's a better way to solve
[2012-08-07 22:53:58 -0400] yfeldblum: rvm is always the solution to all technical problems
[2012-08-07 22:54:07 -0400] yfeldblum: toaster shorted? shoulda used rvm
[2012-08-07 22:54:12 -0400] martinisoft: have no idea why this cookbook isn't applying then, debug mode doesn't mention anything either :(
[2012-08-07 22:54:19 -0400] yfeldblum: i hear hoover_damn disagrees
[2012-08-07 22:54:35 -0400] yfeldblum: martinisoft, what does your recipe look like?
[2012-08-07 22:54:50 -0400] jonzobrist: Hello all, I am trying to run chef-server, have tried on ubuntu 10.04 and 12.04, have tried ruby 1.9.1/1.9.3 ( was just on as @dougnaka) Here is my Ubuntu 12.04 install version, here is my bash set of commands to install ruby, rubygems, gecode, chef all from source except the gems all from rubygems... http://pastie.org/4408437
[2012-08-07 22:54:52 -0400] martinisoft: using this one -> https://github.com/fnichol/chef-user
[2012-08-07 22:55:10 -0400] sascha_d: I think I saw a blue set that's attached
[2012-08-07 22:55:20 -0400] yfeldblum: martinisoft, what's in your node's run-list?
[2012-08-07 22:55:21 -0400] sascha_d: oh god, sorry, wrong I"M window
[2012-08-07 22:56:48 -0400] martinisoft: yfeldblum: ubuntu::default, build-essential::default, openssl::default, omnibus_updater, chef-client::default, chef-client::delete_validation, user::data_bag, git::default
[2012-08-07 22:57:02 -0400] martinisoft: thats from knife node show
[2012-08-07 22:57:49 -0400] yfeldblum: martinisoft, what does `knife data bag show users` say?
[2012-08-07 22:58:25 -0400] martinisoft: my name, thats the item name
[2012-08-07 23:00:16 -0400] martinisoft: http://cl.ly/image/0p2I4511283X <- the output of those commands to show the data bag
[2012-08-07 23:00:28 -0400] martinisoft: as far as I can tell, I have it all laid out ;x
[2012-08-07 23:01:12 -0400] yfeldblum: martinisoft, what about `knife node show NODE -a users`?
[2012-08-07 23:01:45 -0400] martinisoft: just says: users:
[2012-08-07 23:02:49 -0400] yfeldblum: martinisoft, from the readme, "The data bag recipe will iterate through a list of usernames defined in node['users'] (by default) and attempt to pull in the user's information from the data bag item."
[2012-08-07 23:03:44 -0400] martinisoft: hmmm DOH! think I missed that, so am I understanding that I have to add it as a node attribute?
[2012-08-07 23:03:55 -0400] hoover_damm: beandip, basically the easiest way to make me tune out is to mention rvm.
[2012-08-07 23:04:16 -0400] beandip: lol, why's that?
[2012-08-07 23:04:39 -0400] yfeldblum: martinisoft, yes
[2012-08-07 23:04:45 -0400] yfeldblum: hoover_damm, rvm
[2012-08-07 23:05:11 -0400] martinisoft: yfeldblum: ah, thanks a bunch! new to this terminology with node attributes and data bags
[2012-08-07 23:07:44 -0400] beandip: yfeldblum: you're going to break him
[2012-08-07 23:08:12 -0400] martinisoft: w00t, worked :D
[2012-08-07 23:08:24 -0400] yfeldblum: beandip, he'll be alright
[2012-08-07 23:13:07 -0400] hoover_damm: yfeldblum, I heard a rumor that facebook is buying foodcritic? it appears to be hurting their advertising
[2012-08-07 23:19:55 -0400] flaccid_: lol
[2012-08-07 23:20:15 -0400] stormerider: who the frack sent me 13 individual pieces of mail from the same address? *boggle*
[2012-08-07 23:22:51 -0400] stormerider: should have guessed. bill collector.
[2012-08-07 23:23:29 -0400] stormerider: er sorry, wrong channel.
[2012-08-07 23:27:35 -0400] flaccid_: joonas: you can use node attributes in recipes if thats what you mean
[2012-08-07 23:35:12 -0400] cwj: TIL: the init script packaged with supervisord by ubuntu is fundamentally broken
[2012-08-07 23:35:33 -0400] cwj: i.e. it cannot successfully restart the service without being modified
[2012-08-07 23:36:09 -0400] cwj: chef to the rescue
[2012-08-07 23:36:51 -0400] spokrandt: is it possible to get a different systems ip from within a recipe.    say of your syslog server to define the address to send messages in a client?
[2012-08-07 23:37:15 -0400] yfeldblum: spokrandt, yes, using search
[2012-08-07 23:37:30 -0400] yfeldblum: spokrandt, if you're using chef-client & chef-server
[2012-08-07 23:37:47 -0400] spokrandt: cool thanks for the pointer
