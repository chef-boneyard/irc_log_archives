[2012-06-28 00:07:01 -0400] kallistec: Twirrim: how are you creating the instances?
[2012-06-28 00:07:45 -0400] Twirrim: knife ec2 server create -r "role[role]"..<snip>... -N foo.bar.baz
[2012-06-28 00:08:18 -0400] kallistec: Twirrim: so you're trying to change the hostname in /etc/hosts then?
[2012-06-28 00:08:27 -0400] Twirrim: What is in N seems to end up in /etc/chef/client.rb as node_name, and the servers register themselves with the system like that.
[2012-06-28 00:08:41 -0400] Twirrim: *register themselves with chef
[2012-06-28 00:09:00 -0400] kallistec: yes, that's what the client and node objects will be named
[2012-06-28 00:09:56 -0400] Twirrim: Yup, but it's not an attribute I can call, and the server doesn't end up with it as the hostname.  This is CentOS 6.2, in case that helps.  As far as I can see CentOS looks like it might be a bit special when it comes to hostnames.
[2012-06-28 00:10:10 -0400] Twirrim: I should possibly have put that special in quotes..
[2012-06-28 00:10:26 -0400] kallistec: Twirrim: yeah, if you want to change the hostname, you need to manage /etc/hosts with chef
[2012-06-28 00:10:40 -0400] kallistec: there could be a cookbook on the community site that does that
[2012-06-28 00:11:09 -0400] kallistec: also, it's helpful to use a DNS provider with an API if you're doing something like this
[2012-06-28 00:11:17 -0400] kallistec: dnsimple or dynect
[2012-06-28 00:11:59 -0400] kallistec: but chef won't change the hostname automatically, you're getting it via dhcp from ec2's dhcp servers
[2012-06-28 00:12:12 -0400] Twirrim: we do DNS in house with bind, I'm not planning on pushing DNS off to a provider any time soon but we're looking at switching to PowerDNS which'll get me a nice database backend.
[2012-06-28 00:12:53 -0400] kallistec: you could manage your DNS with Chef using search in that case to get the same effect
[2012-06-28 00:14:27 -0400] kallistec: Twirrim: anyway, we use this at opscode: https://github.com/opscode-cookbooks/dynect/blob/master/recipes/ec2.rb
[2012-06-28 00:14:31 -0400] hoover_damm: Twirrim, good idea!
[2012-06-28 00:14:40 -0400] Aaton: anyone know a cookbook that uses the node name to look up a data bag based on that name?
[2012-06-28 00:14:40 -0400] kallistec: you could just rip out the dynect bits
[2012-06-28 00:14:45 -0400] hoover_damm: Twirrim, https://xs.powerdns.com/icann-powerdns/
[2012-06-28 00:14:57 -0400] hoover_damm: Twirrim, powerdns's author posted that today
[2012-06-28 00:15:53 -0400] flaccid_: https://github.com/flaccid/cookbooks_public/blob/master/cookbooks/rs_utils/recipes/setup_hostname.rb for hostname ; https://github.com/flaccid/cookbooks/blob/master/cookbooks/resolver/recipes/default.rb for resolvers/search
[2012-06-28 00:17:39 -0400] Twirrim: thanks hoover_damm , that's interesting.  And thanks flaccid_ :)
[2012-06-28 00:18:07 -0400] jameson: Aaton: can't you just use node[:name]?
[2012-06-28 00:18:38 -0400] hoover_damm: Twirrim, the author of powerdns is a good source of knowledge
[2012-06-28 00:22:33 -0400] Twirrim: It's been a number of years since I last used it, but where I did it made a huge difference on the workload the resolvers could handle, irrespective of the extra abilities having a database backend provided us.
[2012-06-28 00:28:29 -0400] hoover_damm: Twirrim, powerdns is freaking awesome all over
[2012-06-28 00:28:37 -0400] hoover_damm: Twirrim, so you won't get anything but a +1 all around from me
[2012-06-28 00:30:27 -0400] williamherry: how to make chef client use other node name to registry rather than FQDN, is node_name in client.rb or some thing?
[2012-06-28 00:35:23 -0400] Twirrim: williamherry: yup, in the end of /etc/chef/client.rb add the line: node_name "foo.bar.baz"
[2012-06-28 00:35:37 -0400] williamherry: Twirrim, thank you
[2012-06-28 00:35:40 -0400] Twirrim: of whatever name it is you want :D
[2012-06-28 01:28:34 -0400] Majost: how do I specify a specific version of a gem with gem_package?
[2012-06-28 01:30:18 -0400] hoover_damm: gem "pg" do
[2012-06-28 01:30:21 -0400] hoover_damm: version "1.2.0"
[2012-06-28 01:30:24 -0400] hoover_damm: action :install
[2012-06-28 01:30:24 -0400] hoover_damm: end
[2012-06-28 01:30:34 -0400] hoover_damm: ^^ Majost
[2012-06-28 01:33:18 -0400] Majost: thanks
[2012-06-28 01:34:33 -0400] Majost: hoover_damm: I think I may have identified an incompatibility with ruby pg and postgres-9.1 -- but its probably user error.. nevertheless, I am going to try to force a version of the pg gem
[2012-06-28 01:34:57 -0400] hoover_damm: Majost, yeah I noticed the same thing... :(
[2012-06-28 01:35:20 -0400] hoover_damm: Majost, had no regressions with python stuff and as i'm only dealing with python lately
[2012-06-28 01:35:26 -0400] hoover_damm: i didn't dig deeper
[2012-06-28 01:35:42 -0400] Majost: I'll see what I can do, and send a patch
[2012-06-28 01:42:16 -0400] Majost: hoover_damm: do you happen to know what version of ruby pg is working for you?
[2012-06-28 01:46:37 -0400] hoover_damm: no
[2012-06-28 01:46:40 -0400] hoover_damm: didn't figure it out
[2012-06-28 01:46:57 -0400] hoover_damm: Majost, does this happen on 12.04?
[2012-06-28 01:47:28 -0400] Majost: hoover_damm: yep
[2012-06-28 01:55:43 -0400] jessicab: there was this info we got the other day, that perhaps chef_gem would fix the issues with the postgresql cookbook not installing the pg gem.. im not too convinced honestly, but its an idea - http://tickets.opscode.com/browse/COOK-1391
[2012-06-28 02:01:35 -0400] hoover_damm: jessicab, yeah this is just an issue with the gem not linking right
[2012-06-28 02:02:17 -0400] hoover_damm: it can't find PQconnectdb()
[2012-06-28 02:02:28 -0400] hoover_damm: which is strange because the python and other drivers do indeed work
[2012-06-28 02:03:42 -0400] jessicab: hm weird, havent heard of that one
[2012-06-28 02:06:09 -0400] msf: 201:55 <jessicab> there was this info we got the other day, that perhaps chef_gem would fix the issues with the postgresql cookbook not installing the pg gem.. im not too convinced  honestly, but its an idea - http://tickets.opscode.com/browse/COOK-1391
[2012-06-28 02:11:26 -0400] Majost: jessicab: its a problem with the pg gem for sure
[2012-06-28 02:11:33 -0400] hoover_damm: -lms/libpq
[2012-06-28 02:11:35 -0400] hoover_damm: huh
[2012-06-28 02:11:37 -0400] Majost: yeah
[2012-06-28 02:11:50 -0400] hoover_damm: jessicab, some weird regression likely with pg_config
[2012-06-28 02:11:52 -0400] hoover_damm: is my guess
[2012-06-28 02:12:25 -0400] Majost: well the other problem is that I cant seem to override the values by specifying the paths directly.
[2012-06-28 02:16:19 -0400] hoover_damm: the problem is /usr/lib/libpq.so.5.4 lacks PQconnect
[2012-06-28 02:17:42 -0400] hoover_damm: Majost, fwiw i'm using the ppa on natty with this cookbook (as you may be aware) and it has the same regression
[2012-06-28 02:17:51 -0400] hoover_damm: Majost, as i'm using backports of 12.04's 9.1
[2012-06-28 02:18:16 -0400] hoover_damm: Majost, my next question would be did you find any lp bugs
[2012-06-28 02:18:16 -0400] hoover_damm: ?
[2012-06-28 02:18:39 -0400] Majost: haven't checked
[2012-06-28 02:20:19 -0400] hoover_damm: i'd file a bug
[2012-06-28 02:20:22 -0400] hoover_damm: because honestly it should work
[2012-06-28 02:21:01 -0400] williamherry: does knife ssh use /etc/hosts? I already set node's IP in that, it still say Name or service not known
[2012-06-28 02:23:59 -0400] williamherry: I can ssh to the node with node name
[2012-06-28 02:27:54 -0400] hoover_damm: Majost, and you have libpq-dev installed right?
[2012-06-28 02:27:59 -0400] hoover_damm: obviously
[2012-06-28 02:28:20 -0400] hoover_damm: strange that regression hit both the backports and the official 12.04 release
[2012-06-28 02:28:40 -0400] williamherry: finger it out, it try to connect to a node's FQDN not node name
[2012-06-28 02:42:17 -0400] Majost: it doesn't seem to be an Ubuntu issue
[2012-06-28 02:43:39 -0400] Majost: I downloaded the source packaged for 0.12.0 and diffed it between the gem 0.12.0 source -- not surprisingly, nothing really differs
[2012-06-28 02:43:53 -0400] Majost: and the ubuntu package doesn't apply any packages
[2012-06-28 02:44:12 -0400] Majost: but I can build the package on the same box without issues, whereas the same version gem fails
[2012-06-28 02:44:47 -0400] hoover_damm: and the ubuntu pg package
[2012-06-28 02:44:48 -0400] hoover_damm: should work no?
[2012-06-28 02:44:55 -0400] Majost: so this is expressly an issue with the gem -- though I haven't figured out why one compiles and the other doesn't
[2012-06-28 02:45:00 -0400] hoover_damm: i mean if you use ubuntu ruby
[2012-06-28 02:45:11 -0400] hoover_damm: sounds like you've had better luck then me
[2012-06-28 02:45:34 -0400] Majost: yeah -- I am not sure how to make chef use the system version of ruby though
[2012-06-28 02:45:36 -0400] Majost: heh
[2012-06-28 02:45:41 -0400] Majost: <--- newb
[2012-06-28 02:46:35 -0400] hoover_damm: hrm does it work with system ruby?
[2012-06-28 02:46:40 -0400] hoover_damm: i don't install ruby
[2012-06-28 02:46:48 -0400] Majost: I don't either...
[2012-06-28 02:46:49 -0400] hoover_damm: i just use omnibus i couldn't determine if that was part of it
[2012-06-28 02:47:03 -0400] hoover_damm: the pg gem was not a part of my deployment
[2012-06-28 02:47:23 -0400] hoover_damm: we ruled that bug out as 'we don't care'
[2012-06-28 02:47:32 -0400] Majost: yeah -- I can exclude it, but then the create user and other crap fails because I cant interface with it from chef.
[2012-06-28 02:47:42 -0400] hoover_damm: psycopg2 worked
[2012-06-28 02:47:50 -0400] Majost: hrm
[2012-06-28 02:47:51 -0400] hoover_damm: which made me feel the error was on the gem
[2012-06-28 02:48:04 -0400] hoover_damm: lol
[2012-06-28 02:48:13 -0400] hoover_damm: i guess I could give crappy code
[2012-06-28 02:48:36 -0400] Majost: ah
[2012-06-28 02:49:00 -0400] Majost: nah -- I want this to work, because I am gonna write a cookbook which will inevitably depend on it
[2012-06-28 02:49:16 -0400] hoover_damm: yeah these are just the shellouts
[2012-06-28 02:50:05 -0400] hoover_damm: https://gist.github.com/f6d470ff40247a2b0959
[2012-06-28 02:50:15 -0400] hoover_damm: nothing to oogle over
[2012-06-28 02:50:59 -0400] Majost: I may end up going that way in the end
[2012-06-28 02:51:07 -0400] Majost: but it all goes back to -- "it should work."
[2012-06-28 02:51:26 -0400] Majost: I don't mind working on it... just is annoying. heh
[2012-06-28 02:51:30 -0400] hoover_damm: fwiw 9.1 on gentoo pg gem
[2012-06-28 02:51:31 -0400] hoover_damm: works
[2012-06-28 02:51:32 -0400] hoover_damm: out of the box
[2012-06-28 02:51:46 -0400] Majost: good to know
[2012-06-28 02:52:06 -0400] hoover_damm: hakunin may also have some input on this
[2012-06-28 02:52:08 -0400] hoover_damm: dunno if he hit it or not
[2012-06-28 02:52:53 -0400] Majost: yeah, it didn't sound like he did -- but I hadn't fully realized the problem when I talked to him earlier
[2012-06-28 02:53:44 -0400] hakunin: Majost: hey what's up?
[2012-06-28 02:53:55 -0400] hoover_damm: hakunin, installing the pg gem?
[2012-06-28 02:54:16 -0400] Majost: you didn't happen to run into a problem with getting the gem to work by any chance?
[2012-06-28 02:55:33 -0400] hakunin: Majost: frankly i haven't got a chance to run the recipe further, after i had a permission issue. had to leave, just came back
[2012-06-28 02:55:41 -0400] Majost: ah
[2012-06-28 02:55:43 -0400] hakunin: now gonna fix permission problem
[2012-06-28 02:55:48 -0400] hakunin: and try see if i can go on
[2012-06-28 02:55:58 -0400] hakunin: Majost: however, i used opscode postgres recipe before
[2012-06-28 02:56:09 -0400] hakunin: and pg running perfectly, the gem, everything, my whole project ran
[2012-06-28 02:56:25 -0400] Majost: yeah, I am seeing the issue with both the opscode postgres cookbook and hoover_damm's
[2012-06-28 02:56:38 -0400] hakunin: Majost: i think the difference is how we're setting up our initial ruby
[2012-06-28 02:56:39 -0400] Majost: hakunin: you running 12.04?
[2012-06-28 02:56:43 -0400] Majost: ah
[2012-06-28 02:57:05 -0400] hakunin: Majost: im' setting up a single ruby 1.9.3-p194 via roundsman, which uses ruby-build
[2012-06-28 02:57:14 -0400] hakunin: Majost: no rvm, rbenv or any such things
[2012-06-28 02:57:55 -0400] hakunin: Majost: yea 12.04
[2012-06-28 02:59:25 -0400] hakunin: Majost: also for creating pg users i use something similar to what hoover_damm showed
[2012-06-28 02:59:30 -0400] Majost: hakunin: I am not sure what I am using exactly... I am just bootstrapping the box and using whatever chef is dropping in
[2012-06-28 02:59:36 -0400] hoover_damm: hakunin, basically /usr/lib/libpq.so.5.4 seems to lack PQconect from 12.04
[2012-06-28 02:59:46 -0400] hoover_damm: hakunin, this also is in the backport as well
[2012-06-28 02:59:58 -0400] hoover_damm: hakunin, so when trying to get the gem to work with 12.04 we seem to be not having luck
[2012-06-28 03:00:03 -0400] hakunin: Majost: i made this idempotent template that works well, and allows you to define users right there https://gist.github.com/3c92cbf490ae93e7ddee
[2012-06-28 03:00:48 -0400] hakunin: Majost: you should look through roundsman source code and check what packages it installs, it might simply be a package missing
[2012-06-28 03:01:03 -0400] hakunin: Majost: add a custom cookbook in which you declare that package and have it run before postgres
[2012-06-28 03:01:29 -0400] hakunin: Majost: it's just one file https://github.com/iain/roundsman/blob/master/lib/roundsman/capistrano.rb
[2012-06-28 03:02:29 -0400] hakunin: %w(git-core curl build-essential bison openssl libreadline6 libreadline6-dev zlib1g zlib1g-dev libssl-dev libyaml-dev libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev vim wget tree)
[2012-06-28 03:02:32 -0400] hakunin: Majost: ^
[2012-06-28 03:04:01 -0400] Majost: huh
[2012-06-28 03:04:05 -0400] hakunin: Majost: have you tried looking at this? http://community.opscode.com/cookbooks/ruby_build
[2012-06-28 03:04:20 -0400] Majost: I have not
[2012-06-28 03:05:00 -0400] hakunin: Majost: this is by 37signals guy
[2012-06-28 03:07:06 -0400] hakunin: i'm gonna continue running the postgres script until i hopefully get it to execute correclty
[2012-06-28 03:07:20 -0400] hakunin: if i see this i'll let you know
[2012-06-28 03:08:49 -0400] Majost: thanks!
[2012-06-28 03:08:58 -0400] Majost: I need to head home... I poke at this more tomorrow
[2012-06-28 03:09:00 -0400] Majost: ttyl
[2012-06-28 03:25:51 -0400] jameson: hakuin: I think you can reduce that package line... build-essentials can be installed via build-essentials recipe, pullyout the libc-dev, autoconf, bison
[2012-06-28 03:26:05 -0400] jameson: a few less lines :3
[2012-06-28 03:31:16 -0400] gchristensen: hi, do data-bags under a category have to follow a similar set? ie : game/banned-players.json, game/banned-ip.json, game/ops.json, game/whitelist.json - these would have different types of data in them, is that acceptable? or should these be maintained differently?
[2012-06-28 03:32:20 -0400] jameson: it's your choice
[2012-06-28 03:32:38 -0400] jameson: you would be the one who knows how those datas are handled
[2012-06-28 03:32:49 -0400] jameson: data_bag either returns the entire bag
[2012-06-28 03:32:56 -0400] jameson: or data_bag_item which returns 1 item from the bag
[2012-06-28 03:33:05 -0400] gchristensen: right
[2012-06-28 03:33:08 -0400] jameson: as a Chef::DataBagObject
[2012-06-28 03:34:16 -0400] gchristensen: and if the databag doesn't exist, will it return no data? or error out
[2012-06-28 03:34:28 -0400] gchristensen: howdy vluther
[2012-06-28 03:34:36 -0400] jameson: uh
[2012-06-28 03:34:41 -0400] jameson: i believe it returns nil
[2012-06-28 03:34:43 -0400] vluther: hola
[2012-06-28 03:34:44 -0400] vluther: brb
[2012-06-28 03:34:51 -0400] gchristensen: wonderful. thank you jameson
[2012-06-28 03:35:01 -0400] jameson: let me check that
[2012-06-28 03:35:02 -0400] jameson: :|
[2012-06-28 03:36:13 -0400] jameson: actually
[2012-06-28 03:36:16 -0400] jameson: it looks like it throws an error
[2012-06-28 03:37:05 -0400] gchristensen: either way makes sense I suppose.
[2012-06-28 03:37:13 -0400] gchristensen: thank you for your input
[2012-06-28 03:41:25 -0400] cheeseplus: gchristensen: what game?
[2012-06-28 03:42:16 -0400] gchristensen: cheeseplus: setting up a minecraft server for a client... I don't get it, but the's paying :P
[2012-06-28 03:45:27 -0400] jameson: lolwut
[2012-06-28 03:46:13 -0400] gchristensen: lolindeed
[2012-06-28 03:48:16 -0400] cescalante: okay guys i'm sure I'm missing something
[2012-06-28 03:48:28 -0400] cescalante: ec2 via knife on OS X
[2012-06-28 03:48:38 -0400] jameson: works
[2012-06-28 03:48:40 -0400] cescalante: I keep getting an error that my search returns no nodes
[2012-06-28 03:48:57 -0400] jameson: what command? and did the node get finished installing
[2012-06-28 03:49:01 -0400] cescalante: even when using -a and specifing the the address
[2012-06-28 03:49:09 -0400] jameson: you are doing
[2012-06-28 03:49:14 -0400] jameson: try knife ec2 server list
[2012-06-28 03:49:26 -0400] cescalante: jameson: strangest thing
[2012-06-28 03:49:34 -0400] cescalante: jameson: works outside of my chef-repo
[2012-06-28 03:49:40 -0400] cescalante: jameson: inside of it returns blank
[2012-06-28 03:49:51 -0400] jameson: do you have a .chef in your chef-repo
[2012-06-28 03:49:56 -0400] jameson: and a .chef/ in ~/
[2012-06-28 03:50:04 -0400] cescalante: jameson: yes
[2012-06-28 03:50:14 -0400] jameson: are the knife.rb the same
[2012-06-28 03:50:26 -0400] jameson: as with both the pems?
[2012-06-28 03:50:39 -0400] cescalante: jameson: no, when I put the amazon vars in the chef-repo it says they are invalid
[2012-06-28 03:50:48 -0400] cescalante: jameson: it only sees them in the ~/
[2012-06-28 03:51:01 -0400] jameson: :|
[2012-06-28 03:51:04 -0400] jameson: that's odd
[2012-06-28 03:51:13 -0400] jameson: i have a similar setup
[2012-06-28 03:51:31 -0400] jameson: try copying over ~/.chef/knife.rb to your chef-repo/.chef/knife.rb
[2012-06-28 03:51:37 -0400] jameson: make a backup before you do
[2012-06-28 03:52:05 -0400] cescalante: jameson: I've tried every combo under the sun trying to get the knife.rb to match or to eliminate the ~/.chef all together
[2012-06-28 03:52:23 -0400] cescalante: jameson: it will not recognize it from the .chef in repo
[2012-06-28 03:53:44 -0400] jameson: so in the repo
[2012-06-28 03:53:45 -0400] jameson: it hangs
[2012-06-28 03:53:51 -0400] jameson: but outside the repo it works fine
[2012-06-28 03:56:00 -0400] cescalante: jameson: outside the repo I get different errors
[2012-06-28 03:56:14 -0400] cescalante: jameson:  Cannot sign the request without a client name, check that :node_name is assigned
[2012-06-28 03:56:30 -0400] jameson: did this used to work?
[2012-06-28 03:56:52 -0400] jameson: we are only running `knife ec2 server list` right?
[2012-06-28 03:57:10 -0400] cescalante: jameson: oh yes, inside it returns nothing
[2012-06-28 03:57:15 -0400] cescalante: jameson: outside I get my list of vms
[2012-06-28 03:57:50 -0400] jameson: and knife node list outside the the repo returns all the nodes?
[2012-06-28 03:58:05 -0400] jameson: you are using chef server right?
[2012-06-28 03:58:07 -0400] cescalante: jameson: yes
[2012-06-28 03:58:13 -0400] cescalante: jameson: I'm using hosted
[2012-06-28 03:58:17 -0400] jameson: ok
[2012-06-28 03:58:41 -0400] jameson: but even outside the repo 'knife node show NODE_NAME' returns that error?
[2012-06-28 04:01:08 -0400] cescalante: jameson: plot thickens. It hates being in any directory with .chef in it
[2012-06-28 04:01:17 -0400] cescalante: jameson: it won't work inside of ~/ either
[2012-06-28 04:01:46 -0400] jameson: what doesn't work
[2012-06-28 04:02:03 -0400] jameson: can you paste-bin the commands, the outputs
[2012-06-28 04:04:20 -0400] cescalante: jameson: https://gist.github.com/7c2cedc88712cbf7b497
[2012-06-28 04:05:34 -0400] cescalante: jameson: ~/Dropbox/knife and ~/ both have .chef/knife.rb in them
[2012-06-28 04:05:42 -0400] jameson: and client.pem
[2012-06-28 04:05:48 -0400] jameson: er.
[2012-06-28 04:05:55 -0400] jameson: ORG.pem and ORG-validator.pem ?
[2012-06-28 04:06:03 -0400] cescalante: jameson: yes
[2012-06-28 04:06:12 -0400] jameson: and they are all identical
[2012-06-28 04:06:17 -0400] cescalante: jameson: actually mine is user and validator
[2012-06-28 04:06:29 -0400] jameson: they should be called
[2012-06-28 04:06:34 -0400] jameson: ORG.pem, ORG-validator.epm
[2012-06-28 04:06:35 -0400] cescalante: jameson: its whatever opscode told me to put there
[2012-06-28 04:06:43 -0400] jameson: where ORG Is the organization name
[2012-06-28 04:06:48 -0400] jameson: i think or was it user name
[2012-06-28 04:06:55 -0400] jameson: using the same name :|
[2012-06-28 04:07:35 -0400] jameson: USERNAME.pem and ORGANIZATION-validator.pem
[2012-06-28 04:08:28 -0400] cescalante: jameson: last scenario you described is what mine is
[2012-06-28 04:08:41 -0400] cescalante: jameson: do I need on a /etc/client.pem on my workstation?
[2012-06-28 04:08:51 -0400] jameson: uh..
[2012-06-28 04:08:57 -0400] jameson: if you are running the workstation as a node
[2012-06-28 04:08:58 -0400] jameson: yes
[2012-06-28 04:09:01 -0400] cescalante: jameson: not
[2012-06-28 04:09:04 -0400] jameson: is it USERNAME.pem ?
[2012-06-28 04:09:09 -0400] cescalante: jameson: yes
[2012-06-28 04:09:12 -0400] jameson: or YOUR_ACTUAL_USER_NAME.pem
[2012-06-28 04:09:18 -0400] cescalante: jameson: my actual
[2012-06-28 04:09:23 -0400] cescalante: jameson: and my actual org name
[2012-06-28 04:09:26 -0400] jameson: :|
[2012-06-28 04:09:27 -0400] jameson: hrm
[2012-06-28 04:09:32 -0400] cescalante: jameson: so tidrion.pem and beyond9-validator.pem
[2012-06-28 04:09:41 -0400] jameson: are they the same?
[2012-06-28 04:09:43 -0400] jameson: diff them
[2012-06-28 04:09:56 -0400] jameson: or copy from dropbox/ to the other 2
[2012-06-28 04:10:00 -0400] cescalante: jameson: no
[2012-06-28 04:10:05 -0400] jameson: they should all be the same ~_~
[2012-06-28 04:10:06 -0400] cescalante: jameson: they are different I'm 90% sure
[2012-06-28 04:10:42 -0400] jameson: if the pem files are differnt you are not going to get the same results ~_~
[2012-06-28 04:10:57 -0400] jameson: one authenticates with the chef-server, the other authenticates nodes
[2012-06-28 04:13:32 -0400] cescalante: jameson: made them match no joy
[2012-06-28 04:13:54 -0400] cescalante: jameson: they are generated separately
[2012-06-28 04:14:41 -0400] jameson: uh..
[2012-06-28 04:14:52 -0400] jameson: the username.pem can be differnet
[2012-06-28 04:14:58 -0400] jameson: but the validator.pem should be same i believe
[2012-06-28 04:47:09 -0400] jameson: :| being up late makes me almost usless in helping people ~_~
[2012-06-28 05:50:28 -0400] jameson: cescalante: glad getting the ip addres worked, enjoy
[2012-06-28 05:50:31 -0400] jameson: now to bed
[2012-06-28 05:50:33 -0400] jameson: zzzzz
[2012-06-28 06:05:17 -0400] hakunin: hoover_damm: hey you around?
[2012-06-28 06:20:33 -0400] hakunin: wow I think it's actually a big in Chef
[2012-06-28 06:22:22 -0400] hakunin: when using "directory" resource, the recursively-created directories don't get owner/group set in the resource
[2012-06-28 07:04:16 -0400] jameson: hakunin: that's definetly a bug/issue
[2012-06-28 07:04:27 -0400] BryanWB_: ohai chefs!
[2012-06-28 07:04:38 -0400] jameson: hakunin: looks like chef does -p then does chmod on the last directory
[2012-06-28 07:04:44 -0400] jameson: instead of recursively calling itself
[2012-06-28 07:04:50 -0400] jameson: oh u
[2012-06-28 07:59:51 -0400] hakunin: jameson: great...
[2012-06-28 08:00:38 -0400] jameson: so.. there should be a ticket about t hat
[2012-06-28 08:00:45 -0400] jameson: surprising that no one has caught it till now?
[2012-06-28 08:08:31 -0400] hakunin: jameson: so you confirmed this by checking source code?
[2012-06-28 08:09:18 -0400] hakunin: jameson: i'm not actually sure it's unintentional, think about it
[2012-06-28 08:10:13 -0400] hakunin: jameson: if /a/b exists and you're creating /a/b/c <-- the c directory, then calling a directory resource recursively with owner/group passed in will cause a/b to be attempting to alter ownership
[2012-06-28 08:11:03 -0400] hakunin: unless you add a not_if { File.directory?(...) } to the recursive call, checking for existence of itself
[2012-06-28 08:11:05 -0400] jameson: well look at it from the intent of the directory
[2012-06-28 08:11:31 -0400] jameson: er.
[2012-06-28 08:11:36 -0400] jameson: the recursive version would
[2012-06-28 08:11:41 -0400] jameson: split on \
[2012-06-28 08:11:45 -0400] jameson: and check each directory
[2012-06-28 08:11:59 -0400] jameson: as it builds
[2012-06-28 08:12:17 -0400] jameson: but the source code
[2012-06-28 08:12:18 -0400] hakunin: yeah it's implementable, just thought maybe the simpler implementation was intentional
[2012-06-28 08:13:25 -0400] hakunin: jameson: also keep in mind  if /a/b happens to exist and be owned by root then you recursively create /a/b/c/d <-- the c and d will be owned by your given user and a/b will remain root. or should a/b be altered to be given user too?
[2012-06-28 08:13:50 -0400] jameson: if you follow mkdir oncvention
[2012-06-28 08:13:53 -0400] jameson: only the new directories
[2012-06-28 08:14:16 -0400] hakunin: i see, so i guess there's a more desirable behavior
[2012-06-28 08:14:23 -0400] hakunin: following mkdir
[2012-06-28 08:15:35 -0400] hakunin: jameson: for now will have to implement a workaround in my fork of postgres cookbook
[2012-06-28 08:17:21 -0400] jameson: or
[2012-06-28 08:17:30 -0400] jameson: you will have to make each dir :|
[2012-06-28 08:18:10 -0400] jameson: chef/lib/provider/directory.rb#L57
[2012-06-28 08:18:25 -0400] jameson: just enforces, does not su and mkdir -p
[2012-06-28 08:18:38 -0400] hakunin: jameson: could you full url?
[2012-06-28 08:20:28 -0400] jameson: huh
[2012-06-28 08:20:30 -0400] jameson: head is fixed
[2012-06-28 08:20:36 -0400] jameson: but not in 10.12
[2012-06-28 08:20:50 -0400] jameson: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/directory.rb
[2012-06-28 08:21:27 -0400] hakunin: nice
[2012-06-28 08:21:32 -0400] hakunin: ish
[2012-06-28 08:26:08 -0400] jameson: actually
[2012-06-28 08:26:09 -0400] jameson: it doesn't
[2012-06-28 08:28:48 -0400] jameson: yup
[2012-06-28 08:28:53 -0400] jameson: it uses ruby mkdir_p
[2012-06-28 08:28:57 -0400] jameson: as the calling user
[2012-06-28 08:29:18 -0400] jameson: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/directory.rb#L100
[2012-06-28 08:30:03 -0400] jameson: they should be able to adapt the assert call to either 1. recursively do mkdir, or 2. switch user
[2012-06-28 08:30:13 -0400] jameson: they as in opscode
[2012-06-28 09:08:32 -0400] msf: jameson: the issue is with the call to Chef::Prvoider::File.set_all_access_controls
[2012-06-28 09:08:43 -0400] msf: which does not behave recursively
[2012-06-28 09:10:32 -0400] BryanWB_: msf: hey buddy!
[2012-06-28 09:10:50 -0400] msf: hey man :-)
[2012-06-28 09:10:54 -0400] msf: how's it going
[2012-06-28 09:11:09 -0400] BryanWB_: msf: fine, spending quality time w/ Elasticsearch and logstash
[2012-06-28 09:11:19 -0400] msf: oh boy :-P
[2012-06-28 09:11:53 -0400] msf: this directory thing is a fun bug
[2012-06-28 09:17:41 -0400] jameson: msf: that wasn't the line, it's 100
[2012-06-28 09:18:03 -0400] jameson: when it calls mkdir_p, it calls it as the runner (root) instead of the owner (whatever you want)
[2012-06-28 09:18:14 -0400] msf: yes it calls it as the runner
[2012-06-28 09:18:22 -0400] msf: and then it calles set_all_access_controls
[2012-06-28 09:18:30 -0400] msf: which sets the permissions on the top level directory
[2012-06-28 09:18:36 -0400] msf: but not on anything below it
[2012-06-28 09:18:36 -0400] jameson: what if
[2012-06-28 09:18:40 -0400] jameson: right
[2012-06-28 09:18:52 -0400] jameson: we are talking about /opt/local/somedir/someotherdir/
[2012-06-28 09:19:06 -0400] jameson: somedir is owned by root
[2012-06-28 09:19:16 -0400] jameson: while someotherdir was like a config, data, log dir
[2012-06-28 09:19:31 -0400] jameson: so we can't write to the somedir as a user (say a postgres daemon)
[2012-06-28 09:20:32 -0400] jameson: it's when chef-client finishes, and a daemon does things in the recursively created directory things break
[2012-06-28 09:20:53 -0400] msf: yeah
[2012-06-28 09:21:04 -0400] msf: I don't have an easy answer for you
[2012-06-28 09:21:22 -0400] jameson: saimplest would be to do the same lambda, and call mkdir
[2012-06-28 09:21:27 -0400] jameson: instead of mkdir_p
[2012-06-28 09:21:50 -0400] jameson: and do some thing like in the validation function
[2012-06-28 09:21:58 -0400] msf: or implement a set_all_access_controls that behaves recursively
[2012-06-28 09:22:07 -0400] jameson: which wont work
[2012-06-28 09:22:14 -0400] jameson: you need to know what directory was there before you created it
[2012-06-28 09:22:28 -0400] msf: uh
[2012-06-28 09:22:38 -0400] jameson: basically :recursive would call action_create recursively, instead of doing mkdir_p
[2012-06-28 09:25:19 -0400] railsraider: i have an attribute default['deploy']['enable-bundle-install'] = "false" and in the script resource at the end   only_if node['deploy']['enable-bundle-install'] == "true"
[2012-06-28 09:25:26 -0400] railsraider: bundle install still runs
[2012-06-28 09:28:27 -0400] railsraider: i can't get that to work
[2012-06-28 09:32:43 -0400] jameson: i thought only_if was checked at the end of the run?
[2012-06-28 09:33:15 -0400] jameson: *is probably wrong
[2012-06-28 09:35:29 -0400] railsraider: seems like its not being honored for script, so I'm trying now action:nothing on the script and a execute block with subscribe
[2012-06-28 09:40:34 -0400] zts: railsraider: it should be - only_if { node['deploy']['enable-bundle-install'] == "true" }
[2012-06-28 09:40:54 -0400] railsraider: i tried that too
[2012-06-28 09:41:44 -0400] railsraider: i ended up doing a excute block with subscribe
[2012-06-28 09:58:37 -0400] railsraider: can anyone please tell me why this is not working? http://www.pastie.org/private/2z0hfxtyqsxcn77s6he9lq    i want to run bundle install when set to true and skip when set to false
[2012-06-28 10:01:24 -0400] jatan: railsraider, and the value isn't set I gather?
[2012-06-28 10:01:44 -0400] jatan: if it's set as reported in line 1
[2012-06-28 10:01:52 -0400] jatan: that's the expected behaviour
[2012-06-28 10:02:37 -0400] thom: railsraider: s/subscribes/notifies/ on the trigger
[2012-06-28 10:02:59 -0400] thom: you want to send a message from the trigger to the bash resource, not the other way round
[2012-06-28 10:04:22 -0400] railsraider: thanks
[2012-06-28 10:20:49 -0400] sawyer: when using knife-solo and chef-solo, is it possible to send variables from the command line that will be available to the cookbooks/recipes?
[2012-06-28 10:21:22 -0400] sawyer: if i set environment variables when running knife-solo, will they be available to the recipes?
[2012-06-28 10:31:33 -0400] dkannan: sawyer: i do not think so. if you are using knife-solo. you can overwrite the Chef::Knife::Cook.cook method
[2012-06-28 10:32:04 -0400] dkannan: sawyer: also you can put your config in data-bags. which are accessible using chef-solo
[2012-06-28 10:32:49 -0400] sawyer: dkannan, the thing is: i want to be able to run knife-solo once as integration (simply check services exist, packages are installed, etc.) and once as deployment (copy new files, restart app, etc.)
[2012-06-28 10:33:32 -0400] sawyer: the second run could break connections for running applications, and i can't run it continuously, right? so i thought i could use a variable on the command line to indicate "this time you can restart the service"
[2012-06-28 10:33:38 -0400] sawyer: but i can't find *anything* that allows that
[2012-06-28 10:33:50 -0400] sawyer: any help is more than welcome :)
[2012-06-28 10:34:47 -0400] dkannan: sawyer: chef is indempotent. so you can run it multiple times
[2012-06-28 10:35:22 -0400] dkannan: what it means is that, when you run chef repeatedly. it will check that integration is correct
[2012-06-28 10:35:55 -0400] zts: sawyer: the most chef-y way is to write your recipes such that the service is only restarted if the configuration changes, rather than restarting it during every run
[2012-06-28 10:40:50 -0400] sawyer: zts, that was one of the thoughts i had
[2012-06-28 10:40:53 -0400] sawyer: i think this is what i'll do
[2012-06-28 10:41:03 -0400] sawyer: zts, dkannan, thanks :)
[2012-06-28 11:35:34 -0400] williamherry: does service resource type support xinetd service like rsync? seems not work to me
[2012-06-28 11:37:20 -0400] williamherry: oh, suck stupid question
[2012-06-28 12:13:46 -0400] flashingpumpkin: hey guys. what cookbooks / recipes would you recommend when dealing with postgres. eg, installation, setup, users, databases, pg_hba, replication?
[2012-06-28 12:23:41 -0400] jameson: flashingpumpkin: ask hoover_damm :3
[2012-06-28 12:54:43 -0400] wubino: What hosting options are available for chef?
[2012-06-28 13:58:09 -0400] staticisrupflo: I installed a chef server via Bootstrap (10.12.0). Problem is the server does not start in the rabbitmq log this message occurs: https://gist.github.com/3011536 . Any ideas?
[2012-06-28 14:05:57 -0400] gchristensen: for some reason, when I upload my cookbook, a template file doens't go with it prop-list.erb. is there a way to determine why it isn't being downloaded (or uploaded?) other templates in the same directory work fine
[2012-06-28 14:13:06 -0400] geekbri: If you say... make 2 calls to the directory resource with different parameters, is it a last one wins situation ?
[2012-06-28 14:25:30 -0400] bhenerey: i'm wondering where a bunch of "DEBUG: Platform ubuntu not found, using all defaults. (Unsupported platform?)" is coming from
[2012-06-28 14:27:12 -0400] Oct: geekbri: probably, provided you know which one is run last
[2012-06-28 14:49:28 -0400] japage: I was wondering if anyone has any suggestions about how I should run chef-client on my chef server? As I have it now, it seems to be breaking solr
[2012-06-28 14:50:07 -0400] japage: right now I am using the chef-client cookbook...
[2012-06-28 15:00:15 -0400] aucecil: 10
[2012-06-28 15:17:23 -0400] hoover_damm: geekbri, first resource is used
[2012-06-28 15:17:40 -0400] hoover_damm: geekbri, at least that was the case in 0.6
[2012-06-28 15:18:09 -0400] hoover_damm: geekbri, I've duplicated my resources from time to time and it always proved to me that I was thinking too quick and didn't make the resource right ;)
[2012-06-28 15:18:53 -0400] cakehero: Is there a reason why you'd use the VIM cookbook instead of just installing vim with the package provider?
[2012-06-28 15:18:56 -0400] hoover_damm: geekbri, in 0.10 I believe I had 2 directoy resources named the same way in the redis cookbook and it works right.  But I could be completely full of foo
[2012-06-28 15:19:25 -0400] hoover_damm: well that's your first mistake... installing vim ;)
[2012-06-28 15:19:49 -0400] cakehero: hoover_damm heh
[2012-06-28 15:19:55 -0400] geekbri: hoover_damm: I'm experiencing a bug where I think whats worng is that too different cookbooks are calling the directory resource on the same DIR, and the proper permissions and user/group never seem to get set
[2012-06-28 15:20:30 -0400] hoover_damm: cakehero, honestly that cookbook really just installs vim is installed.  I'd think it'd have some .vim stuff but no
[2012-06-28 15:20:45 -0400] hoover_damm: cakehero, it just automates getting the enhanced vim installed
[2012-06-28 15:20:46 -0400] drrk: cakehero: it's selects the right package name for yourt platform for you?
[2012-06-28 15:21:06 -0400] hoover_damm: cakehero, remember that's part of automation.  Writing cookbooks that work for 50 distros
[2012-06-28 15:21:19 -0400] hoover_damm: you never know when you'll switch distros and you don't want to have to rewrite your cookbooks
[2012-06-28 15:21:22 -0400] hoover_damm: highly unlikely
[2012-06-28 15:21:27 -0400] hoover_damm: but stranger things have happened?
[2012-06-28 15:21:32 -0400] cakehero: but doesn't the package provider work for different distros, too?
[2012-06-28 15:21:39 -0400] hoover_damm: it does
[2012-06-28 15:21:44 -0400] hoover_damm: the package names are different per distro
[2012-06-28 15:22:04 -0400] hoover_damm: cakehero, https://github.com/opscode-cookbooks/vim/blob/master/recipes/default.rb#L23-L26
[2012-06-28 15:22:23 -0400] cakehero: k
[2012-06-28 15:22:28 -0400] hoover_damm: cakehero, yes package 'vim' works.  But this goes an extra step and takes steps to protect against multiple distros
[2012-06-28 15:22:31 -0400] hoover_damm: not a huge win
[2012-06-28 15:22:35 -0400] cakehero: right
[2012-06-28 15:22:41 -0400] cakehero: Luckily we can't afford RHEL
[2012-06-28 15:22:42 -0400] hoover_damm: this is a bit cleaner
[2012-06-28 15:22:52 -0400] hoover_damm: never say never
[2012-06-28 15:22:56 -0400] hoover_damm: its coming back
[2012-06-28 15:23:02 -0400] cakehero: I meant it's too pricey
[2012-06-28 15:23:08 -0400] hoover_damm: rhel summit is still on no?
[2012-06-28 15:23:26 -0400] geekbri: hoover_damm: aint nothin wrong with installin' vim!
[2012-06-28 15:23:28 -0400] geekbri: vimstallin
[2012-06-28 15:23:29 -0400] hoover_damm: yep it is
[2012-06-28 15:23:52 -0400] hoover_damm: geekbri, and nothing wrong with using values_for_platform to create a cookbook that works on more then 1 platform
[2012-06-28 15:24:00 -0400] geekbri: hehe
[2012-06-28 15:24:08 -0400] geekbri: Sure isn't, I do that in many of my cookbooks :-P
[2012-06-28 15:24:11 -0400] jperry2: anyone use any tools/plugins to get a chef server running locally really fast?
[2012-06-28 15:24:30 -0400] jperry2: and to have it push all your cookbooks to the server automatically?
[2012-06-28 15:25:11 -0400] cwj: someone published a knife server plugin the other day that seems to be aimed at bootstrapping chef server on a machine
[2012-06-28 15:25:16 -0400] cwj: i havent tried it though
[2012-06-28 15:25:21 -0400] jperry2: what is the name of it?
[2012-06-28 15:25:53 -0400] cwj: http://fnichol.github.com/knife-server/
[2012-06-28 15:26:36 -0400] jperry2: only for ec2 though
[2012-06-28 15:26:42 -0400] jperry2: I was hoping for something local with vagrant
[2012-06-28 15:26:51 -0400] jperry2: maybe I can change it a little
[2012-06-28 15:26:54 -0400] cwj: im sure pull requests are accepted
[2012-06-28 15:27:03 -0400] jperry2: yeah I may have to work vagrant into it
[2012-06-28 15:27:06 -0400] jperry2: thx for the pointer
[2012-06-28 15:27:09 -0400] jperry2: I'll check it out
[2012-06-28 15:27:12 -0400] cwj: np
[2012-06-28 15:31:46 -0400] cmceldowney: in recipes, what is returned if no nodes are returned from search? I'm getting FATAL: NoMethodError: undefined method `count' for nil:NilClass when I try to use count on the results from search if nothing is returned
[2012-06-28 15:33:12 -0400] juliancdunn: "nil" is returned
[2012-06-28 15:33:24 -0400] juliancdunn: so you can check for "nil?" before you start trying to invoke methods on it
[2012-06-28 15:37:42 -0400] nicholasr-bf: You can use    (result || []) so that it turns the nil into an emty array...
[2012-06-28 15:38:08 -0400] nicholasr-bf: empty even...
[2012-06-28 15:38:17 -0400] cmceldowney: thx much. will test.
[2012-06-28 15:42:21 -0400] postwait: how do I find my local node's name inside of a role?
[2012-06-28 15:42:59 -0400] postwait: node[:hostname] doesn't work -- it says node isn't defined.
[2012-06-28 15:47:27 -0400] cwj: i dont think you can access node attributes inside a role
[2012-06-28 15:47:33 -0400] cwj: what are you trying to accomplish?
[2012-06-28 15:47:52 -0400] hoover_damm: geekbri, it's a mortal sin to install vim without installing emacs
[2012-06-28 15:47:59 -0400] hoover_damm: geekbri, a hellworthy sin ;)
[2012-06-28 15:48:10 -0400] postwait: every node has a filesystem with its hostname in it.
[2012-06-28 15:48:42 -0400] postwait: I need to be able to interpolate a string from within a role so it can create a role-based sub filesystem within it.
[2012-06-28 15:49:07 -0400] postwait: So if I on a node call "node1", I'll have a filesystem call data/set/node1
[2012-06-28 15:49:16 -0400] cmceldowney: juliancdunn: tried this and still getting .count undefined... http://pastebin.com/cwrp4quw any thoughts?
[2012-06-28 15:49:31 -0400] cwj: so can you do the interpolation inside a recipe called by the role, instead of in the role itself?
[2012-06-28 15:49:33 -0400] postwait: and if I have a role called voodoo that needs a "voodoo" filesystem, it will need to be placed under that parent.
[2012-06-28 15:49:52 -0400] postwait: my recipe is just a filesystem recipe.
[2012-06-28 15:50:35 -0400] postwait: if my role is voodoo, I want to use a zfs recipe to create "data/set/#{node[:hostname]}/voodoo"
[2012-06-28 15:50:57 -0400] postwait: seems reasonable, I don't want to have to making recipes everytime I need to know who I am.
[2012-06-28 15:53:04 -0400] cwj: put this in a role: default[:myfilesytemattribute] = "voodoo"
[2012-06-28 15:53:04 -0400] cwj: put this in a recipe: someresource "data/set/#{node[:hostname]}/#{node[:myfilesystemattribute]"}"
[2012-06-28 15:53:25 -0400] cwj: er minus the extraneous quote
[2012-06-28 15:53:46 -0400] cwj: i could be wrong but i dont think you are going to have any luck trying to get at node automatic attrs inside a role
[2012-06-28 15:53:47 -0400] postwait: but then any time I want to have a slightly different interpolation, I'd have to create another recipe
[2012-06-28 15:54:09 -0400] postwait: That's kinda nuts.
[2012-06-28 15:54:18 -0400] postwait: So, I should move it out to my node definition.
[2012-06-28 15:54:54 -0400] postwait: seems better to unreusably specify it there than have a wicked proliferation of silly recipies.
[2012-06-28 15:58:00 -0400] cmceldowney: all. still having issues with return from search in recipe. .nil? not working, so getting fatal error trying to use method .count
[2012-06-28 15:59:56 -0400] cwj: cmceldowney: looks like you deleted your pastebin post
[2012-06-28 16:00:29 -0400] cmceldowney: cwj: here you go: http://pastebin.com/59g46ik3
[2012-06-28 16:05:24 -0400] cwj: well when i try nfs_server = search(:node, "roles:nfs-server") in shef i am getting an empty array back instead of nil
[2012-06-28 16:06:30 -0400] cwj: but i would just do 'unless nfs_server.nil?'
[2012-06-28 16:06:37 -0400] cwj: should be the same as what you are doing though
[2012-06-28 16:10:32 -0400] cwj: http://pastebin.com/YR76nt7B
[2012-06-28 16:10:34 -0400] cwj: if that helps
[2012-06-28 16:17:35 -0400] cmceldowney: cwj: Thanks much. Turns out the issue was that despite re-uploading the cookbook, chef server wasn't storing/updating the recipe, so I was checking the same code logic over and over again.
[2012-06-28 16:17:46 -0400] cwj: ah
[2012-06-28 17:00:39 -0400] upgrayedd: i don't see a place in the node attributes to determine the environment of a node
[2012-06-28 17:00:55 -0400] upgrayedd: is there a way to figure it out in a recipe?
[2012-06-28 17:03:41 -0400] jdsanders: Hi all - what's the most idiomatic way to append to a file?
[2012-06-28 17:03:51 -0400] jdsanders: The file resource seems to only support overwriting
[2012-06-28 17:04:43 -0400] bradgignac: cat ORIGINAL ADDITIONAL > ORIGINAL?
[2012-06-28 17:04:48 -0400] bradgignac: jdsanders: ^^
[2012-06-28 17:04:57 -0400] bradgignac: not sure how idiomatic that is
[2012-06-28 17:05:48 -0400] jdsanders: thanks, yeah, my initial thought was basically: command "echo 'blahblah' >> file"
[2012-06-28 17:05:55 -0400] jdsanders: but thought there might be a more cheffy way
[2012-06-28 17:06:32 -0400] leifmadsen: just use the File stuff in ruby?
[2012-06-28 17:07:00 -0400] bradgignac: leifmadsen: +1
[2012-06-28 17:07:32 -0400] leifmadsen: chef doesn't have a DSL like Puppet so you can just use native code :)
[2012-06-28 17:10:27 -0400] JasonF: Is there a way, when writing your own provider/resource with LWRP to specify the platforms it'll work on? I keep getting "Cannot find a resource for [recipename] on ubuntu version 12.04"
[2012-06-28 17:10:37 -0400] JasonF: or is there a common mistake I might be making that'd present that error.
[2012-06-28 17:15:03 -0400] jdsanders: leifmadsen: you could make the same argument for the entire file resource - so why should creating a file be a resource, but appending to a file be a "just use a shell command or ruby, duh"?
[2012-06-28 17:15:22 -0400] leifmadsen: you could certainly make that argument
[2012-06-28 17:16:02 -0400] jdsanders: it seems to me that you could take that argument all the way to a "what am i even using chef for" point
[2012-06-28 17:16:16 -0400] gmcinnes: You guys write some nice code, man.
[2012-06-28 17:16:19 -0400] jdsanders: so i guess the question is, where is that line?
[2012-06-28 17:16:52 -0400] leifmadsen: jdsanders: at the point where the amount of effort involved to do something is no longer beneficial to using a framework like chef in the first place I suppose
[2012-06-28 17:17:02 -0400] leifmadsen: in which case you're back to the old way of writing your own scripts
[2012-06-28 17:17:10 -0400] jdsanders: yeah, fair enough
[2012-06-28 17:17:28 -0400] leifmadsen: I'm not opposed to someone provided a patch to the file resource to allow appending of data :)
[2012-06-28 17:17:36 -0400] jdsanders: i guess in this case, it seems to me that appending is a common enough thing that I think it would make sense as an action
[2012-06-28 17:17:43 -0400] jdsanders: fair enough
[2012-06-28 17:17:45 -0400] jdsanders: I may do that
[2012-06-28 17:17:46 -0400] leifmadsen: I don't disagree
[2012-06-28 17:17:47 -0400] jdsanders: thanks for chatting
[2012-06-28 17:17:53 -0400] leifmadsen: it does seem to make sense ;)
[2012-06-28 17:18:37 -0400] leifmadsen: I have some experience with early projects and wanting to do everything in custom resources. In asterisk we have this problem in the dialplan of, "well, at what point do you just say you have access to executing an AGI, why do we even bother providing hooks in the dialplan at all?"
[2012-06-28 17:19:26 -0400] leifmadsen: I'm not saying in this particular case that's the issue (because I think an append action makes sense), but you always have to evaluate what people want to do with how much extra complexity you're actually adding
[2012-06-28 17:20:06 -0400] jdsanders: for sure
[2012-06-28 17:20:07 -0400] leifmadsen: when a native method exists, and isn't likely that much more complex. That's where documentation and best practices comes into play with examples of how to do common tasks
[2012-06-28 17:20:24 -0400] leifmadsen: it's a constantly growing discussion that needs to happen for each aspect that someone determines they need to handle
[2012-06-28 17:20:40 -0400] jdsanders: yep, which is, after all, the question i came here to ask - "what is the best practice"
[2012-06-28 17:20:49 -0400] leifmadsen: and your point about, "where is the line?" is valid
[2012-06-28 17:21:08 -0400] jdsanders: yeah but not a black and white thing, just has to be a discussion
[2012-06-28 17:21:33 -0400] leifmadsen: I'm very new to the project, so I have no idea heh. I had to write the contents of a data bag to a file last night, and I ended up using the File.open(...) stuff in ruby... now was that a best practice or a hack? Unknown to me :)
[2012-06-28 17:21:38 -0400] leifmadsen: jdsanders: agreed
[2012-06-28 17:23:19 -0400] leifmadsen: I think when you start getting into obscure or customer/client specific tasks, and start just adding them because it solved one persons problem, you get into a problem. The project should provide hooks into common tasks, and figure out ways of solving odd problems without having to provide custom hooks inside the project itself.
[2012-06-28 17:23:32 -0400] yfeldblum: jdsanders, the question to be asked is: does the abstraction of "resource" fit like a glove around your favorite use case? or will it be full of holes?
[2012-06-28 17:23:48 -0400] leifmadsen: That seems to be the way we've moved Asterisk -- you can't just put in every line of code that satisfies a particular persons interest because then it's only useful in that specific scenario
[2012-06-28 17:23:58 -0400] leifmadsen: yfeldblum: +1
[2012-06-28 17:24:55 -0400] jdsanders: yfeldblum: thank you, that will be my question to myself henceforth
[2012-06-28 17:32:36 -0400] yfeldblum: the abstraction of "resource" in chef is that of declaring up-front what the resource's complete final state is desired to be
[2012-06-28 17:33:09 -0400] yfeldblum: you write down a list of resources and their states, give that list to chef, and then chef changes your system so that the system matches the resources you gave to chef
[2012-06-28 17:34:04 -0400] yfeldblum: you don't write down what the changes are supposed to be; you write down what the final state is supposed to be
[2012-06-28 17:34:47 -0400] yfeldblum: now of course there needs to be code behind the scenes that inspects the system and determines whether it matches the declared final state of the resource, and other code that changes the system to bring it into line with the declared final state of the resource
[2012-06-28 17:35:18 -0400] yfeldblum: both types of code belong in providers, whether they ship with chef, whether they're in a cookbook you depend on, or whether you write them
[2012-06-28 17:35:58 -0400] yfeldblum: the first type belongs in your override of Chef::Provider#load_current_resource, and the second type belongs in methods in your provider class whose names start with "action_"
[2012-06-28 17:48:22 -0400] cakehero: Can I send output to the screen easily during a chef run?
[2012-06-28 17:49:47 -0400] leifmadsen: Chef::Log ?
[2012-06-28 17:50:35 -0400] sandfish8: How does one intentionally halt a chef run and throw an exception  message ?  It's escaping me....
[2012-06-28 17:51:36 -0400] cwj: raise
[2012-06-28 17:51:46 -0400] cwj: probably want to log a message first though
[2012-06-28 17:51:57 -0400] cwj: Chef::Log.fatal("onoes!")
[2012-06-28 17:51:57 -0400] cwj: raise
[2012-06-28 17:52:34 -0400] swolf: can i file a bug against one of the opscode cookbooks?
[2012-06-28 17:52:36 -0400] sandfish8: ah that was it, Chef::Log.fatal.  Thanks cwj
[2012-06-28 17:52:56 -0400] grantr: so when are we going to have a knife-google-compute plugin?
[2012-06-28 17:53:01 -0400] swolf: or are the chef jira tickets only for the chef core
[2012-06-28 17:53:02 -0400] cwj: swolf: yep, tickets.opscode.com
[2012-06-28 17:53:10 -0400] swolf: cwj: thx
[2012-06-28 17:53:14 -0400] cwj: the COOK project is cookbooks
[2012-06-28 17:55:03 -0400] swolf: also, what is the best forum for 'suggestions' for cookbooks?  i've made some additions modifictions to the windows packages and powershell resources, but i'm new to github so i don't really know the protocol.
[2012-06-28 17:55:20 -0400] cheeseplus: swolf: pull requests
[2012-06-28 17:55:46 -0400] cheeseplus: fork the code from the existing cookbook, make you changes, then file a pull request
[2012-06-28 17:55:59 -0400] cheeseplus: s/you/your
[2012-06-28 17:56:25 -0400] cheeseplus: swolf: https://help.github.com/articles/using-pull-requests
[2012-06-28 17:57:35 -0400] swolf: cheeseplus: just found that article meself.  thx though.  don't i need permissions or something to push my changes to the repository?  should also be noted that i'm new to git; i've really only used svn before
[2012-06-28 17:58:09 -0400] cheeseplus: swolf: when you fork, you clone the existing repo
[2012-06-28 17:58:20 -0400] swolf: oh nvm now i see instructions about this fork above, doh.  awesome, thanks
[2012-06-28 17:58:41 -0400] cwj: if you are trying to contribute to opscode cookbooks you need to sign a CLA and post your pull requests to existing tickets
[2012-06-28 17:58:52 -0400] cwj: http://wiki.opscode.com/display/chef/How+to+Contribute+to+Opscode+Cookbooks
[2012-06-28 17:59:01 -0400] cheeseplus: oh yea, don't forget that part
[2012-06-28 17:59:13 -0400] cheeseplus: I just got my signed card for signing the CLA :D
[2012-06-28 17:59:15 -0400] swolf: right on.  cool
[2012-06-28 17:59:57 -0400] gmcinnes: aw. I want a card, but everything is so perfect I don't know what to contribute :)
[2012-06-28 18:00:17 -0400] cheeseplus: gmcinnes: you don't actually have to contribute, just sign
[2012-06-28 18:00:19 -0400] cheeseplus: hehe
[2012-06-28 18:00:41 -0400] gmcinnes: o rly.
[2012-06-28 18:00:43 -0400] gmcinnes: ok.
[2012-06-28 18:06:34 -0400] Twirrim: is it possible to return the output from something like execute or bash or similar to a variable?
[2012-06-28 18:07:47 -0400] Twirrim: probably the better way to express that is I want to run something on the end machine, grab the value and use that in a template.
[2012-06-28 18:07:58 -0400] hakunin: hoover_damm: hey, so i'm stuck again at "Ran /bin/bash --login -c 'LC_ALL= /etc/init.d/postgresql start' returned 1", " * The PostgreSQL server failed to start. Please check the log output."
[2012-06-28 18:08:08 -0400] hakunin: hoover_damm: and the log is nowhere to be found, i can't even tell where it should be
[2012-06-28 18:09:39 -0400] hakunin: hoover_damm: according to the config it should be in PG_DATA/pg_log, but i don't see it there
[2012-06-28 18:13:32 -0400] geekbri: hoover_damm: luckily I know the most important emacs command around.  meta x meta c
[2012-06-28 18:23:33 -0400] swolf: how do i get the return code from an execute.run_action(:run) call?
[2012-06-28 18:26:09 -0400] rottmanj: Anyone know of an up to date tutorial/example of how to provision and deploy a rails application with nginx and unicorn?
[2012-06-28 18:26:50 -0400] hoover_damm: hakunin, the log is in pg_data
[2012-06-28 18:27:01 -0400] hoover_damm: hakunin, it's a csv log
[2012-06-28 18:27:09 -0400] hoover_damm: hakunin, so checkout the csv that it dumped
[2012-06-28 18:27:27 -0400] hoover_damm: hakunin, if there was no csv dumped.  then you need to su - postgres then pgctl -D /etc/postgresql/9.1 start
[2012-06-28 18:27:30 -0400] hoover_damm: and try an dfigure it out
[2012-06-28 18:43:19 -0400] hakunin: hoover_damm: i suspect it's a permission issue with exactly the log writing
[2012-06-28 18:43:58 -0400] hoover_damm: could be
[2012-06-28 18:44:18 -0400] hakunin: hoover_damm: last night jameson was here, confirmed that recursive directory is broken in chef, creates only last directory with the given owner/group
[2012-06-28 18:44:34 -0400] hakunin: so i made a workaround for creating data dir
[2012-06-28 18:45:44 -0400] hoover_damm: hakunin, eww
[2012-06-28 18:45:53 -0400] hoover_damm: hakunin, i hadn't realized that was busted
[2012-06-28 18:46:37 -0400] hakunin: hoover_damm: right now /mnt/postgresql is postgres:postgres, /mnt/postgresql/9.1 is postgres:postgres, /mnt/postgresql/9.1/data is postgres:root, and everything inside is postgres:root
[2012-06-28 18:46:38 -0400] jasond: what's the best way to find a node's CPU architecture?
[2012-06-28 18:47:39 -0400] hoover_damm: hakunin, weird... i haven't had this issue with 0.10.8
[2012-06-28 18:48:07 -0400] hoover_damm: hakunin, the only regression I had with this was the wal directory not being owned properly personally
[2012-06-28 18:48:15 -0400] hoover_damm: hakunin, so your chasing down a whole new barrel that i've never had
[2012-06-28 18:48:49 -0400] swolf: where is this only_if/not_if stuff defined in source?  i'm trying to figure out how to how to use execute.not_if("command") in a lwrp that uses it under the hood
[2012-06-28 18:48:50 -0400] hoover_damm: I admit freely that I still run 0.10.8 because I haven't gotten my ass around to building 0.10.12 omnibus installers
[2012-06-28 18:49:00 -0400] hoover_damm: and we rock our own omnibus packages
[2012-06-28 18:49:31 -0400] swolf: its like i assign a command to execute.not_if in the line before execute.run_action(:run) and the actualy execute never runs, no matter if the not_if command returns 0 or 1
[2012-06-28 18:49:58 -0400] swolf: actual*.  why do I always fricken' append a y to that word...
[2012-06-28 18:51:05 -0400] hakunin: hoover_damm: i just use the stuff in roundsman for installing chef, it works perfect with 10.12.0
[2012-06-28 18:51:32 -0400] hoover_damm: hakunin, i'll stick to omnibus :)
[2012-06-28 18:51:49 -0400] hoover_damm: hakunin, i've written my own build systems before.  I have no desire to go down that path again
[2012-06-28 18:52:10 -0400] hakunin: hoover_damm: but considering that i have everything owned by postgres, i don't get why the log wouldn't be created, regardless of running init.d by root or postgres
[2012-06-28 18:52:37 -0400] hakunin: hoover_damm: also why do you run /bin/bash --login -c 'LC_ALL= /etc/init.d/postgresql start' instead of using the service resource?
[2012-06-28 18:52:53 -0400] hoover_damm: hakunin, because I want postgres to be in UTF-8 and not C?
[2012-06-28 18:53:15 -0400] nathenharvey: jasond:  you can use node['kernel']['machine']
[2012-06-28 18:53:18 -0400] hoover_damm: hakunin, if your new to Chef you maybe unaware that by default the execute/bash/script resources set LC_ALL="C" which can have some undesireable side effects
[2012-06-28 18:53:40 -0400] hoover_damm: Opscode did this for a completely valid reason
[2012-06-28 18:54:06 -0400] hakunin: hoover_damm: i see
[2012-06-28 18:54:08 -0400] hakunin: interesting
[2012-06-28 18:54:13 -0400] hakunin: yeah i am new
[2012-06-28 18:54:31 -0400] hakunin: i'm pro with ruby, but not with chef
[2012-06-28 18:54:36 -0400] hakunin: which helps at least a little
[2012-06-28 18:54:42 -0400] hakunin: to solve my own problems
[2012-06-28 18:54:43 -0400] hoover_damm: hurts actually
[2012-06-28 18:54:55 -0400] doomviking: eh
[2012-06-28 18:55:11 -0400] hoover_damm: previous job made me aware of how some pro rubyists can do some really awkward 'DRY' things
[2012-06-28 18:55:15 -0400] hoover_damm: that are anything but DRY
[2012-06-28 18:55:36 -0400] hakunin: hoover_damm: that's a stage on the way to pro
[2012-06-28 18:55:37 -0400] hoover_damm: perhaps you are the exception
[2012-06-28 18:55:47 -0400] hoover_damm: hakunin, true
[2012-06-28 18:56:12 -0400] hoover_damm: one of my most favorite examples is how someone used a library to dry up a erb template
[2012-06-28 18:56:35 -0400] hoover_damm: an erb template had 4-5 different if statements.  So they moved the if statements to a library and just told chef to export the library to the erb template
[2012-06-28 18:56:36 -0400] hakunin: hoover_damm: i saw a bunch of things in your cookbooks that i could reduce by tons of characters, but thought having it in your face explicit like that wasn't a big deal
[2012-06-28 18:56:44 -0400] hoover_damm: and then run the logic in the erb template
[2012-06-28 18:56:46 -0400] hoover_damm: sure it was dryer
[2012-06-28 18:56:54 -0400] hoover_damm: but oh my god troubleshooting it
[2012-06-28 18:57:21 -0400] hoover_damm: hakunin, I stopped trying to reduce to make my code pretty about 6months ago
[2012-06-28 18:57:27 -0400] geekbri: I have a coworker who is always trying to write crazy ruby .each's in places where I dont think they should go
[2012-06-28 18:57:30 -0400] geekbri: like attribute files
[2012-06-28 18:57:31 -0400] hoover_damm: hakunin, and resolved to provide a working solution and not care so much
[2012-06-28 18:57:43 -0400] hoover_damm: .each in attributes? lol
[2012-06-28 18:57:59 -0400] geekbri: yeah.
[2012-06-28 18:58:15 -0400] hakunin: hoover_damm: you were asking the other day if writing depends 'foo'; depends 'bar'; would work in place of %w( foo bar ).each {|e| depends e} <- i think it's better to write them out rather than in a loop
[2012-06-28 18:58:19 -0400] hoover_damm: hakunin, it should be noted that i've been using modern chef for 4 months now
[2012-06-28 18:58:27 -0400] hoover_damm: hakunin, so I'm coming back to all the cool things I can do
[2012-06-28 18:58:41 -0400] hoover_damm: hakunin, being stuck with 0.6 for 2 years kinda made me do lots of bad crap
[2012-06-28 19:00:07 -0400] hakunin: hoover_damm: sucks
[2012-06-28 19:00:45 -0400] hoover_damm: hakunin, indeed I really enjoyed having real roles and attributes
[2012-06-28 19:00:54 -0400] hoover_damm: that were not so eh
[2012-06-28 19:03:15 -0400] hakunin: i don't use chef's roles atm, all i do is tell it to run runlists, that's it.
[2012-06-28 19:03:35 -0400] hoover_damm: your still solo right?
[2012-06-28 19:03:38 -0400] hakunin: yeah
[2012-06-28 19:03:43 -0400] hakunin: my roles are defined outside of chef, it'd be redundant
[2012-06-28 19:03:47 -0400] hoover_damm: you should really get used to roles
[2012-06-28 19:03:58 -0400] hoover_damm: and tags
[2012-06-28 19:04:07 -0400] hoover_damm: and chef_environment
[2012-06-28 19:04:13 -0400] hoover_damm: (which doesn't work in solo)
[2012-06-28 19:04:28 -0400] hoover_damm: or did they fix that? ;)
[2012-06-28 19:04:29 -0400] nathenharvey: no
[2012-06-28 19:04:46 -0400] nathenharvey: sorryignore my "no"  wrong window
[2012-06-28 19:05:57 -0400] hakunin: i don't see the need in having anything more complex than telling which runlists to run on which hosts, where runlists are defined by roles on the outside. the attribute overrides are also coming from outside, based on roles.
[2012-06-28 19:06:58 -0400] hakunin: maybe we're not "there" yet in our size
[2012-06-28 19:09:33 -0400] hoover_damm: hakunin, you'll get there
[2012-06-28 19:09:34 -0400] hakunin: hoover_damm: i just switched to ubuntu user, and tried running /bin/bash --login -c 'LC_ALL= /etc/init.d/postgresql start'
[2012-06-28 19:09:37 -0400] hoover_damm: and you'll end up re-doing it
[2012-06-28 19:09:43 -0400] hakunin: hoover_damm: it immediately said chmod: changing permissions of `/var/run/postgresql': Operation not permitted
[2012-06-28 19:09:53 -0400] hoover_damm: hakunin, huh? why would you do that?
[2012-06-28 19:10:04 -0400] hakunin: hoover_damm: to figure out why it's not working
[2012-06-28 19:10:09 -0400] hoover_damm: hakunin, that isn't going to help
[2012-06-28 19:10:11 -0400] hakunin: chef is running as ubuntu user
[2012-06-28 19:10:15 -0400] hoover_damm: hakunin, su - postgres
[2012-06-28 19:10:20 -0400] hoover_damm: hakunin, and try and start postgres manually
[2012-06-28 19:11:02 -0400] hoover_damm: /usr/lib/postgresql/9.1/bin/pg_ctl -D /etc/postgresql/9.1/main/ start
[2012-06-28 19:11:48 -0400] hakunin: hoover_damm: if i try to start postgres with either sudo or postgres, i get a long wait, and then the message that something went wrong, check the log file. the log file doesn't exist
[2012-06-28 19:11:59 -0400] hakunin: doesn't matter which one of those
[2012-06-28 19:12:51 -0400] hakunin: hoover_damm: ok running the line you gave me gave some output
[2012-06-28 19:12:52 -0400] c_t: can postgres write to the directory that should hold the log file?
[2012-06-28 19:13:02 -0400] hoover_damm: hakunin, good gist it?
[2012-06-28 19:13:08 -0400] hakunin: c_t: owned by postgres, yes
[2012-06-28 19:14:19 -0400] hakunin: hoover_damm: https://gist.github.com/b198c9602fffb257b50d
[2012-06-28 19:14:23 -0400] hoover_damm: debian/ubuntu uses perl wrappers and move's pg_ctl out of the way
[2012-06-28 19:14:26 -0400] hoover_damm: so you can't use it
[2012-06-28 19:14:36 -0400] hoover_damm: and they configure the layout in a way that is not a standard postgresql layout
[2012-06-28 19:14:50 -0400] hoover_damm: hakunin, so your shm stuff isn't configured
[2012-06-28 19:14:55 -0400] hoover_damm: hakunin, more sysctl stuff
[2012-06-28 19:15:01 -0400] hakunin: hoover_damm: i'm using your recipe and your sysctl
[2012-06-28 19:15:16 -0400] hoover_damm: hakunin, what does kernel.sem show?
[2012-06-28 19:15:28 -0400] hoover_damm: and shmmax?
[2012-06-28 19:15:59 -0400] hoover_damm: hakunin, I kinda had to do some kernel.sem modifications in order to create enough semaphores for 65535 connections to postgresql
[2012-06-28 19:16:00 -0400] hakunin: hoover_damm: not sure how to check. your recipe kernel_sem is "4096 6553555 1600 65535"
[2012-06-28 19:16:18 -0400] hoover_damm: hakunin, sysctl -a | grep kernel.shmmax
[2012-06-28 19:16:37 -0400] hakunin: this whole sysctl stuff is completely 100% black magic to me
[2012-06-28 19:16:39 -0400] hakunin: checking
[2012-06-28 19:16:48 -0400] hoover_damm: hakunin, if your doing this on a small box
[2012-06-28 19:16:53 -0400] hoover_damm: it maybe not enough resources to start
[2012-06-28 19:16:59 -0400] hoover_damm: hakunin, c1.medium/m1.small on ec2 should be enough
[2012-06-28 19:17:10 -0400] hoover_damm: but if you run it with like 256meg vagrant
[2012-06-28 19:17:16 -0400] hoover_damm: might not work
[2012-06-28 19:17:42 -0400] hoover_damm: sysctl -p
[2012-06-28 19:17:45 -0400] hoover_damm: try and start it again
[2012-06-28 19:18:05 -0400] hakunin: can't run sudo sysctl -a | grep kernel.shmax, wtf
[2012-06-28 19:18:12 -0400] hoover_damm: kernel.shmmax
[2012-06-28 19:18:21 -0400] hoover_damm: spelling counts
[2012-06-28 19:18:36 -0400] hoover_damm: root@ip-10-10-29-58:/var/lib/postgresql/9.1/data# sysctl -a | grep kernel.shmmax
[2012-06-28 19:18:36 -0400] hoover_damm: error: permission denied on key 'vm.compact_memory'
[2012-06-28 19:18:36 -0400] hoover_damm: kernel.shmmax = 15740428288
[2012-06-28 19:18:37 -0400] hakunin: kernel.shmmax = 1733210112
[2012-06-28 19:18:57 -0400] hakunin: yeah got it
[2012-06-28 19:19:01 -0400] hakunin: ^
[2012-06-28 19:19:14 -0400] hakunin: i'm running on ec2 small
[2012-06-28 19:19:17 -0400] hoover_damm: hrm
[2012-06-28 19:19:31 -0400] hoover_damm: kernel.shmmax is too small
[2012-06-28 19:19:33 -0400] hoover_damm: for what your allocating
[2012-06-28 19:20:02 -0400] hoover_damm: hakunin, drop max_connections
[2012-06-28 19:20:05 -0400] hoover_damm: hakunin, down to say 2k
[2012-06-28 19:20:25 -0400] hoover_damm: hakunin, and then try again.... i'd suggest overriding it in chef.json but as your solo do whatever
[2012-06-28 19:20:37 -0400] hoover_damm: hakunin, you don't have enough memory to pull off that many connections and you really don't need 65535
[2012-06-28 19:20:47 -0400] hoover_damm: postgresql users are generally happy wtih 500 / 2000
[2012-06-28 19:20:49 -0400] hoover_damm: max_connections
[2012-06-28 19:20:59 -0400] hoover_damm: but I aimed very high
[2012-06-28 19:21:07 -0400] hoover_damm: higher then you can allocate
[2012-06-28 19:21:15 -0400] hakunin: hoover_damm: in the past i've successfully run with kernel.shmmax=1610612736 and max_connections=100
[2012-06-28 19:21:28 -0400] hoover_damm: kernel.shmmax needs tobe 3705782272 or higher
[2012-06-28 19:21:49 -0400] hoover_damm: basically 4gigs of ram
[2012-06-28 19:21:52 -0400] hoover_damm: m1.medium
[2012-06-28 19:22:18 -0400] hakunin: 1.7 on small
[2012-06-28 19:22:37 -0400] hakunin: ok so drop max_connections to 2k, sec
[2012-06-28 19:23:10 -0400] hakunin: running chef
[2012-06-28 19:23:41 -0400] mbiven: exit
[2012-06-28 19:23:43 -0400] hakunin: couldn't start, may not be low enough
[2012-06-28 19:24:43 -0400] hakunin: hoover_damm: confirmed that indeed max_conn changed in the config file, but postgres still failed to start
[2012-06-28 19:25:03 -0400] hakunin: hoover_damm: shouldn't i also change shmmax?
[2012-06-28 19:25:56 -0400] hoover_damm: hakunin, you need to see the error...
[2012-06-28 19:26:00 -0400] hakunin: gonna try to run it as postgres again to see it
[2012-06-28 19:26:42 -0400] hakunin: oh shoot
[2012-06-28 19:27:05 -0400] hoover_damm: hakunin, https://github.com/damm/postgresql/blob/master/attributes/default.rb#L89-L90
[2012-06-28 19:27:07 -0400] hakunin: hoover_damm: it's actually running, but the chef threw another error
[2012-06-28 19:27:21 -0400] hoover_damm: let me know when you figure that out?
[2012-06-28 19:27:50 -0400] hakunin: hoover_damm: yeah i think the original problem is fixed and postgres is running, this is unrelated error
[2012-06-28 19:27:56 -0400] hakunin: gonna fix it now
[2012-06-28 19:30:06 -0400] cakehero: How should I manage a configuration file for nginx w/Chef?
[2012-06-28 19:30:15 -0400] cakehero: Do I make my own template or use one from the cookbook?
[2012-06-28 19:30:29 -0400] cakehero: This is my first time attempting something like this (so far I've just been installing - not configuring)
[2012-06-28 19:36:31 -0400] jlight: where you get the template from doesn't matter, right? as long as you change it to be what you need in the end. I'm not sure I understand what you're asking.
[2012-06-28 19:39:34 -0400] cakehero: jlight sup
[2012-06-28 19:39:41 -0400] cakehero: okay so
[2012-06-28 19:39:43 -0400] cakehero: I have an nginx cookbook
[2012-06-28 19:40:06 -0400] cakehero: which installs nginx and also installs its config files (so I can access the web server and see 'Welcome to nginx!")
[2012-06-28 19:40:32 -0400] cakehero: Now I want to add a vhost configuration to my server, which I usually do in /etc/nginx/sites-available/. Should I just make my own template + recipe for this?
[2012-06-28 19:40:36 -0400] cakehero: I'll want to add a few of them
[2012-06-28 19:40:42 -0400] hakunin: cakehero: if the attributes that the cookbook provides give you enough flexibility to change the template to what you need  you can just set attributes, that's it. if you need more flexibility in the template, you can make your own template, in your own cookbook (name it like nginx_config or something) and have it run after nginx.
[2012-06-28 19:40:45 -0400] jlight: right. default community site nginx cookbook I assume?
[2012-06-28 19:40:48 -0400] hakunin: cakehero: yes just yourown recipe here
[2012-06-28 19:40:51 -0400] cakehero: hakunin okay cool
[2012-06-28 19:40:55 -0400] cakehero:  jlight  yes
[2012-06-28 19:41:22 -0400] jlight: hakunun, cool.
[2012-06-28 19:41:54 -0400] cwj: nginx cookbook also provides a definition for nginx_site which can be used in your own cookbooks
[2012-06-28 19:42:24 -0400] cakehero: cwj looking at it now
[2012-06-28 19:43:36 -0400] cakehero: okay so if I have two vhosts, I'll use the same sweet template w/different data
[2012-06-28 19:44:13 -0400] cakehero: okay very cool
[2012-06-28 19:44:41 -0400] hakunin: hoover_damm: was there a reason you didn't leave any ident auth method for local users?
[2012-06-28 19:44:53 -0400] hakunin: only md5
[2012-06-28 19:45:36 -0400] hakunin: hoover_damm: i'm getting an error trying to use psql to run my sql script as postgres, because i didn't give it password : )
[2012-06-28 19:46:15 -0400] hakunin: i'm using bash resource to run it, so just saying user "postgres" doesn't work anymore
[2012-06-28 19:48:39 -0400] hakunin: hoover_damm: i would propose adding this line in pg_hba in your cookbook: local all postgres ident
[2012-06-28 19:48:56 -0400] hakunin: gonna add in my fork
[2012-06-28 19:58:15 -0400] Jay_Levitt: In reality, how agnostic are chef recipes to Red Hat vs Debian/Ubuntu flavors? Am I going to have more friction w/one vs. the other?
[2012-06-28 19:59:04 -0400] yfeldblum: Jay_Levitt, most of the core resources have providers that either support both, or have a provider to support one and another provider to support the other
[2012-06-28 19:59:27 -0400] yfeldblum: Jay_Levitt, many of the cookbooks out there, however, are independently biased toward one or the other, and fewer support both equally
[2012-06-28 19:59:56 -0400] Jay_Levitt: ah, so I should start building and then discover which bias my cookbooks have
[2012-06-28 20:00:20 -0400] cheeseplus: yep
[2012-06-28 20:00:21 -0400] yfeldblum: Jay_Levitt, not going to tell you what you should do in this case, but yes certainly you could do that
[2012-06-28 20:00:39 -0400] hakunin: Jay_Levitt: in my experience i seem to be seeing more debian/ubuntu
[2012-06-28 20:00:40 -0400] cheeseplus: Jay_Levitt: in my experience, there is a greater ubuntu/debian bias
[2012-06-28 20:00:44 -0400] cheeseplus: wow
[2012-06-28 20:00:45 -0400] hakunin: lol
[2012-06-28 20:00:57 -0400] Jay_Levitt: hakunin: cheeseplus: In your experience are you the same person?
[2012-06-28 20:01:10 -0400] Jay_Levitt: :)
[2012-06-28 20:01:45 -0400] cheeseplus: lol
[2012-06-28 20:01:50 -0400] Jay_Levitt: I have a vague bias for Ubuntu these days but our managed-server provider leans towards RHEL, so I'm debating.
[2012-06-28 20:02:16 -0400] yfeldblum: opscode-written cookbooks are often biased towards debianoid; but the entire universe of possibility is not limited to opscode-written cookbooks, and the underlying chef engine actually supports both much more equally than do various opscode-written cookbooks
[2012-06-28 20:02:16 -0400] cheeseplus: Jay_Levitt: the community definitely seems more supportive of ubuntu, so it's a good way to lean
[2012-06-28 20:02:37 -0400] Jay_Levitt: cheeseplus: And that's probably even more true in the Ruby/Rails world, right?
[2012-06-28 20:02:37 -0400] miah: derpology
[2012-06-28 20:02:55 -0400] yfeldblum: miah, howdy
[2012-06-28 20:03:12 -0400] cheeseplus: after many, many years in enterprisey stuff where RHEL/CentOS was king I'm glad to leave it behind (except for testing of course)
[2012-06-28 20:03:22 -0400] cwj: honorary master of derpology
[2012-06-28 20:03:35 -0400] Jay_Levitt: I think that's why they favor it.. they mentioned something about SAN support in RHEL
[2012-06-28 20:03:43 -0400] cheeseplus: I got my minor in underwater derp weaving
[2012-06-28 20:04:10 -0400] cheeseplus: Jay_Levitt: that I can confirm but that's just cause SAN providers suck
[2012-06-28 20:04:23 -0400] yfeldblum: Jay_Levitt, hmm, i wonder how many rails apps actually care what OS they are running on? especially when the devs run osx and the prod boxes are some linux distro anyway
[2012-06-28 20:05:28 -0400] cheeseplus: I'm always happy to go in and add anything centOS specific given my experience there, I just wouldn't choose it
[2012-06-28 20:06:19 -0400] Jay_Levitt: yfeldblum: I'm thinking more about gems that accidentally depend on the newest libwhatever which CentOS doesn't have
[2012-06-28 20:06:24 -0400] cheeseplus: related how is SmartOS support in Chef these days?
[2012-06-28 20:06:57 -0400] yfeldblum: Jay_Levitt, fair enough
[2012-06-28 20:07:15 -0400] Jay_Levitt: (And homebrew on Mac makes Ubuntu packaging look conservative)
[2012-06-28 20:14:25 -0400] syphon: Not-Chef-Related Questions: I'm writing an nginx app to route traffic between multiple back-end web apps (based off of URL rules). What should i name it?
[2012-06-28 20:14:57 -0400] syphon: if the name weren't already taken at my company, I'd name it 'switchboard' (so you see what kind of name I'm looking for)
[2012-06-28 20:15:34 -0400] cheeseplus: intertubes
[2012-06-28 20:15:39 -0400] Jay_Levitt: dyno manifold!
[2012-06-28 20:15:50 -0400] jlight: sewer
[2012-06-28 20:16:12 -0400] Jay_Levitt: We used to have servers called "BERPs": Back-End Routing Process
[2012-06-28 20:16:22 -0400] syphon: hahaha
[2012-06-28 20:16:25 -0400] syphon: I like Berp
[2012-06-28 20:16:30 -0400] Jay_Levitt: you can imagine what other servers that leads to
[2012-06-28 20:16:39 -0400] syphon: I need to pick something I think has a reasonable chance of being adopted
[2012-06-28 20:16:47 -0400] syphon: otherwise my creativity will be lost to the world :(
[2012-06-28 20:16:56 -0400] syphon: (my 'creativity' = polling IRC for ideas)
[2012-06-28 20:17:04 -0400] jlight: :)
[2012-06-28 20:17:39 -0400] c_t: this is the year 2012
[2012-06-28 20:17:40 -0400] Jay_Levitt: names tend to come in thematic bursts.. e.g. acts_as_* in the rails community
[2012-06-28 20:17:52 -0400] c_t: everyone picks names that don't really have much to do with anything
[2012-06-28 20:17:53 -0400] Jay_Levitt: we used to have a whole bunch of ThisMan/ThatMan servers, where man = manager
[2012-06-28 20:18:22 -0400] Jay_Levitt: Then there's acronyms..
[2012-06-28 20:18:34 -0400] c_t: I want to call something "windowless_van" someday
[2012-06-28 20:18:45 -0400] c_t: haven't come up with a project to actually go with the name though
[2012-06-28 20:19:27 -0400] Jay_Levitt: ...you could make a virtualized networking appliance with fixed-size TCP buffers and call it windowless_vlan?
[2012-06-28 20:20:18 -0400] sernin: ... dont forget to tip your waitress. Jay_Levitt will be here all week.
[2012-06-28 20:20:28 -0400] Jay_Levitt: THANKYOUGOODNIGHT
[2012-06-28 20:21:19 -0400] jlight: could be a kernel module that steals fork()ed children and overwrites their process space with an executable image other than the one that was actually exec()'d
[2012-06-28 20:21:29 -0400] syphon: bah, I ran "BERP" by my coworkers and they all shot it down
[2012-06-28 20:21:37 -0400] syphon: bunch of jerks
[2012-06-28 20:21:44 -0400] jlight: oh, that's a good name
[2012-06-28 20:22:01 -0400] jlight: see if they like that one.
[2012-06-28 20:22:10 -0400] Jay_Levitt: "bunch of jerks"?
[2012-06-28 20:22:14 -0400] jlight: MyCoworkersAreABunchOfJerks-1.0
[2012-06-28 20:22:18 -0400] jlight: hehe
[2012-06-28 20:22:27 -0400] Jay_Levitt: Yeah, then you're moving the Overton window.. suddenly BERP isn't so bad
[2012-06-28 20:22:44 -0400] c_t: routing_sodomy_and_the_lash
[2012-06-28 20:22:46 -0400] Jay_Levitt: Let's see, we also had Overseer, Switchboard, Switcher, net_mux..
[2012-06-28 20:23:04 -0400] jlight: Overlord
[2012-06-28 20:23:08 -0400] hakunin: syphon: inhuman trafficker
[2012-06-28 20:23:12 -0400] jlight: hahaha
[2012-06-28 20:23:17 -0400] jlight: awesome
[2012-06-28 20:23:22 -0400] Jay_Levitt: yeah, traffic_light?
[2012-06-28 20:31:00 -0400] jlight: trying to follow the cookbook, recipe guide that uses NTP (http://wiki.opscode.com/display/chef/Guide+to+Creating+A+Cookbook+and+Writing+A+Recipe)
[2012-06-28 20:31:16 -0400] jlight: are there known issues with that guide?
[2012-06-28 20:32:40 -0400] jlight: I'm actually more interested in learning how to debug what I screwed up rather than a quickfix.
[2012-06-28 20:34:10 -0400] jlight: ERROR: NoMethodError: undefined method `ntp' for Chef::Resource::Template
[2012-06-28 20:34:20 -0400] jlight: so I look at the stack trace
[2012-06-28 20:34:24 -0400] jlight: see it loads the recipe
[2012-06-28 20:34:36 -0400] hoover_damm: hakunin, I really dislike that local all postgres ident crud
[2012-06-28 20:34:53 -0400] hoover_damm: hakunin, I find it ugh... if I want to lock it down I do md5... I find ident to be an 'error'
[2012-06-28 20:35:10 -0400] hoover_damm: hakunin, and wether you use md5 or trust... is a tuneable option
[2012-06-28 20:35:11 -0400] hakunin: hoover_damm: isn't it immensely helpful to be able to run sql as postgres without additional headaches?
[2012-06-28 20:35:42 -0400] hoover_damm: using ident bothers me because most servers dont' use ident anymore
[2012-06-28 20:35:55 -0400] hoover_damm: md5 allows you to specify the user and password to gain entry
[2012-06-28 20:36:22 -0400] hoover_damm: but if your on ec2 your security zone is secured so there is very little benefit from over-hyping your security internally unless you have social engineering problems.
[2012-06-28 20:36:32 -0400] hoover_damm: or have your own vlan or secured network.
[2012-06-28 20:36:44 -0400] jlight: how / where do the Chef::Resource::Template objects get created?
[2012-06-28 20:36:45 -0400] hoover_damm: (note: rackspace is a shared network, except their new product)
[2012-06-28 20:37:52 -0400] hakunin: hoover_damm: hm i'm not familiar too many nuances on the subject, i was just trying to run an .sql file via psql and it told me that apparently postgres, THE user of postgres, cannot connect to THE postgres, because it needs a password, so yeah that seemed like overkill. I understand extra security measures, but this is beginning to stand in the way of productivity and such. :)
[2012-06-28 20:39:33 -0400] hoover_damm: hakunin, :) set your default to 'trust'
[2012-06-28 20:39:41 -0400] hoover_damm: hakunin, then you can just do psql -U postgres and win
[2012-06-28 20:40:16 -0400] hoover_damm: security should be paramount.  But it should you can build walls around stupidity.  Countries do it? ;)
[2012-06-28 20:40:23 -0400] hakunin: hoover_damm: other than that  everything finally worked. i wouldn't be able to do even begin dipping my toe in this shmmmax mess without your help, very much appreciated
[2012-06-28 20:40:53 -0400] hoover_damm: s/it//
[2012-06-28 20:41:22 -0400] hoover_damm: hakunin, :) I hope you spent less then 3 days on this
[2012-06-28 20:41:33 -0400] hakunin: hoover_damm: 2 days on switching to your recipe
[2012-06-28 20:42:15 -0400] hoover_damm: hakunin, excellent better then me!
[2012-06-28 20:42:26 -0400] hoover_damm: that's all I could ever hope for
[2012-06-28 20:43:13 -0400] hakunin: hoover_damm: i'm not gone though, i still have resque/redis/etc on the way. and to think i was considering going with elastic search vs postgres built-in search. screw it, postgres built in it is. we're in danger of losing investment over this delay
[2012-06-28 20:44:34 -0400] yfeldblum: hakunin, why isn't your app responsible for the content of the postgres db?
[2012-06-28 20:45:06 -0400] hakunin: yfeldblum: i run psql to create some users
[2012-06-28 20:45:14 -0400] hakunin: yfeldblum: idempotently
[2012-06-28 20:49:02 -0400] pdeschen: hi
[2012-06-28 20:49:55 -0400] pdeschen: I have a json base role definition which overrides attributes from some recipe
[2012-06-28 20:50:26 -0400] pdeschen: for some reasons, attributes values does not seems be overridden
[2012-06-28 20:51:06 -0400] pdeschen: what puzzles me is that "it used to work 
[2012-06-28 20:53:36 -0400] hoover_damm: hakunin, 4 days is what it took for postgresql
[2012-06-28 20:53:46 -0400] hoover_damm: hakunin, you shaved 2 days off :) that's all
[2012-06-28 20:53:57 -0400] hoover_damm: hakunin, anywho elasticsearch is dandy... don't forget resque-pool
[2012-06-28 20:54:04 -0400] hoover_damm: redis you can find in my github
[2012-06-28 20:54:41 -0400] hoover_damm: hakunin, resque-pool has chef recipes in the examples/ folder
[2012-06-28 20:55:09 -0400] hoover_damm: and remember take a deep breath and take your time.  Rushing will lead to errors
[2012-06-28 21:00:14 -0400] hakunin: hoover_damm: thanks! i am planning to use resque-pool definitely
[2012-06-28 21:00:18 -0400] hakunin: hoover_damm: thanks for pointers
[2012-06-28 21:02:03 -0400] swolf: man, this should be this hard.  i'm simply trying to do an only_if with the powershell resource, using a powershell command, and it is simply not working.  furthermore, i simply_can_not get damn exec to work with my powershell script
[2012-06-28 21:02:17 -0400] swolf: what sucks is the best way to do some crap, like certificate store management, is with powershell
[2012-06-28 21:02:37 -0400] swolf: but its such a hack to do from ruby
[2012-06-28 21:02:52 -0400] swolf: has anyone used the chilkat ruby libraries for doing windows stuff?
[2012-06-28 21:03:02 -0400] swolf: shouldnt* be this hard.  fml...
[2012-06-28 21:06:08 -0400] cheeseplus: swolf: have you already set the security policies in powershell to not be so onerous?
[2012-06-28 21:06:22 -0400] cheeseplus: i.e. SetExecutionPolicy
[2012-06-28 21:11:13 -0400] j-v-e: good evening gentlemen
[2012-06-28 21:11:48 -0400] j-v-e: I seem to be having troubles with the `support` feature of the user resource. I can't get the resource to create a homedir for my user
[2012-06-28 21:11:55 -0400] j-v-e: here's the code: https://gist.github.com/da85a06f800b8af6e20e
[2012-06-28 21:18:35 -0400] workmad3: j-v-e: supports :manage_home => true, ..., not supports {:manage_home => true, ...}
[2012-06-28 21:18:53 -0400] workmad3: j-v-e: or, optionally, supports(:manage_home ...) or supports({:manage_home ...})
[2012-06-28 21:19:38 -0400] workmad3: j-v-e: the particular case you have there though is an edge-case of ruby syntax where it's taking the {} as defining a code block (that then contains a syntax error) instead of a hash
[2012-06-28 21:21:01 -0400] j-v-e: nice, thanks workmad3 :)
[2012-06-28 21:21:31 -0400] j-v-e: I wrongly copied/pasted the syntax from http://wiki.opscode.com/display/chef/Resources#Resources-User
[2012-06-28 21:26:09 -0400] hoover_damm: woops... tripped a breaker
[2012-06-28 21:26:11 -0400] hoover_damm: lol
[2012-06-28 21:40:42 -0400] syphon: Does chef have a native way to copy whole directories down (either as a cookbook_file or remote_file) or do I need to use execute to do that?
[2012-06-28 21:58:59 -0400] Aaton: using the full-stack installer i notice that if I populate /etc/chef with a client.rb before running the install.sh it gets over written. Problem with that is I have some http_proxy info and other setting defined.
[2012-06-28 22:02:26 -0400] jessicab: aaton - if you dont want it to do that, you could always just edit the bootstrap file.. make a custom one without that
[2012-06-28 22:05:01 -0400] yfeldblum: syphon, remote_directory
[2012-06-28 22:05:42 -0400] Aaton: if I was doing it that way... I'm iPXE loading ubuntu and using a preseed/late_command script to down load the install.sh and run it. I do this so I get the dhcp ip of the new machine into chef. Its not the official way for sure.
[2012-06-28 22:55:15 -0400] swolf: cheeseplus: ya.  seems like my problem is i can't get exit codes out of my powershell script.  if it executes, then the only_if block equivocates to true, regardless of exit code within the powershell script
[2012-06-28 22:55:24 -0400] swolf: cheeseplus:  took me awhile to confirm that behavior though
[2012-06-28 22:58:03 -0400] swolf: it's quite unfortunate.  i think i can work around it by adding a powershell_only_if block
[2012-06-28 22:58:10 -0400] swolf: to execute powershell code in the only if block
[2012-06-28 23:01:02 -0400] miah: hi
[2012-06-28 23:03:10 -0400] j-v-e: "The EncryptedDataBagItem class is a read-only wrapper that decrypts data bag item values on the fly."
[2012-06-28 23:03:22 -0400] j-v-e: Does that mean that encrypted data bags are read only ?
[2012-06-28 23:03:55 -0400] jordane: j-v-e: if an encrypted data bag was read only, how could you write one in the first place?
[2012-06-28 23:04:28 -0400] j-v-e: well, from a recipe I mean
[2012-06-28 23:04:43 -0400] jordane: ah, sorry. :\
[2012-06-28 23:04:50 -0400] jordane: I completely misunderstood the question
[2012-06-28 23:06:13 -0400] jordane: j-v-e: as I understand it, they are. But I could be wrong.
[2012-06-28 23:06:14 -0400] j-v-e: yeah, I have to store some data across multiple chef runs, and I'd rather do it inside an encrypted databag if possible. It's security information
[2012-06-28 23:06:40 -0400] j-v-e: I usually use attributes for that, but they are "publicly" accessible...
[2012-06-28 23:06:59 -0400] j-v-e: I could also use a local static file, but that wouldn't scale
[2012-06-28 23:07:27 -0400] ashb: j-v-e: the wrapper might be read only but the encryption is symetric so you can probably change it relatively easily
[2012-06-28 23:08:30 -0400] ashb: if you look at the encrypted data bag in the chef webui you can see how it stores things
[2012-06-28 23:08:53 -0400] ashb: (you can do something similar and store encrypted node attrs)
[2012-06-28 23:10:06 -0400] javawidget: how do you create an encrypted databag?
[2012-06-28 23:10:18 -0400] ashb: wiki: data bags?
[2012-06-28 23:10:30 -0400] ashb: javawidget: http://wiki.opscode.com/display/chef/Encrypted+Data+Bags
[2012-06-28 23:10:47 -0400] javawidget: sorry... thanks :)
[2012-06-28 23:10:54 -0400] ashb: nps
[2012-06-28 23:11:29 -0400] j-v-e: ashb: yeah, I was thinking using the symetric key and AES to encrypt my attributes
[2012-06-28 23:11:36 -0400] swolf: ok.  so if you execute a powershell script with 'exec' in ruby, you don't get back powershell exit codes.  however with 'system' you do get back powershell exit codes.  huzzah!
[2012-06-28 23:11:44 -0400] ashb: fairly sure thats all the data bag wrappers do
[2012-06-28 23:11:50 -0400] j-v-e: or just concatenate the value with the secret and store the hash. that's one way but that'd work
[2012-06-28 23:17:51 -0400] hakunin: sigh
[2012-06-28 23:17:57 -0400] hakunin: diminishing returns...
[2012-06-28 23:18:03 -0400] hakunin: "(nginx::source line 56) had an error: Chef::Exceptions::EnclosingDirectoryDoesNotExist: Cannot create a file at /tmp/roundsman/cache/nginx-1.2.1.tar.gz because the enclosing directory (/tmp/roundsman/cache) does not exist"
[2012-06-28 23:18:24 -0400] hakunin: immediately ssh into the server  directory totally exists
[2012-06-28 23:18:54 -0400] hakunin: WHY
[2012-06-28 23:18:58 -0400] hakunin: WHY ME
[2012-06-28 23:20:17 -0400] hakunin: oh actually
[2012-06-28 23:20:19 -0400] hakunin: lol
[2012-06-28 23:20:26 -0400] hakunin: it might really not have existed
[2012-06-28 23:20:34 -0400] hakunin: because chef-stacktrace.out goes in there
[2012-06-28 23:20:39 -0400] hakunin: so the error might-have created it
[2012-06-28 23:20:50 -0400] hakunin: sigh
[2012-06-28 23:25:34 -0400] syphon: are any of you guys familiar with the nginx cookbook? I want to see what you think about the implications of a change I'm considering trying to push back up to the community site
[2012-06-28 23:25:47 -0400] miah: syphon: i am, lets see
[2012-06-28 23:25:57 -0400] syphon: I don't have one prepared yet, I just want to discuss it
[2012-06-28 23:26:30 -0400] syphon: it's pretty simple though. I want to add a "not_if file.exists" cause to the template "nginx.conf" call
[2012-06-28 23:26:42 -0400] syphon: it fixes a bug I'm struggling with, and I can't think of a reason someone wouldn't want this
[2012-06-28 23:27:16 -0400] miah: what is the bug you're experiencing
[2012-06-28 23:27:29 -0400] syphon: what happens, the nginx cookbook installs nginx and then creates nginx.conf. THEN I have another cookbook which changes that file. The end result is an nginx install that runs my app
[2012-06-28 23:27:40 -0400] miah: ya
[2012-06-28 23:27:46 -0400] syphon: well what happens is the nginx cookbook ALWAYS resets that file back to default and restarts the service
[2012-06-28 23:27:53 -0400] miah: so, that would fix it. but i dont think it would be the right fix
[2012-06-28 23:28:07 -0400] miah: the nginx_site definition isn't idempotent
[2012-06-28 23:28:08 -0400] syphon: but in its default state, that file conflicts with my overlays and nginx won't restart
[2012-06-28 23:28:14 -0400] miah: yup
[2012-06-28 23:28:37 -0400] syphon: yeah, my change tries to make it idempotant (but I don't think it fully does)
[2012-06-28 23:28:41 -0400] miah: its because nobody clearly defined the default behavior cookbooks should have. in that, they should install your services but _not_ configure them.
[2012-06-28 23:29:11 -0400] miah: certainly include functionaly to make it configurable, but making the assumption that people want a 'default' site in their nginx.conf is bad
[2012-06-28 23:29:37 -0400] miah: im working on some fixes for the nginx cookbook now
[2012-06-28 23:29:59 -0400] ashb: didn't nginx_site used to also optionally render a template?
[2012-06-28 23:30:04 -0400] ashb: or was that something I just added to my copy?
[2012-06-28 23:30:42 -0400] miah: optionally? no.
[2012-06-28 23:30:53 -0400] miah: commons.rb adds a default site configuration
[2012-06-28 23:30:56 -0400] syphon: miah: but that's what I'm saying. the cookbook *already* assumes they want a default nginx.conf. I'm making it so that it won't do so
[2012-06-28 23:31:31 -0400] miah: syphon: no, you're making it not do that _if_ the file already exists. i'm changing the default behavior entirely in that a 'nginx.conf' isn't installed
[2012-06-28 23:31:43 -0400] syphon: oh I see
[2012-06-28 23:31:44 -0400] ashb: miah: https://gist.github.com/3014717
[2012-06-28 23:32:19 -0400] miah: ashb: interesting
[2012-06-28 23:32:31 -0400] ashb: miah: not sure where it came from - I don't remember writting it
[2012-06-28 23:32:37 -0400] ashb: acutally let me look at my git log
[2012-06-28 23:32:41 -0400] miah: =)
[2012-06-28 23:32:42 -0400] williamherry: I am try to understand bootstrap script, I am guessing that <%= start_chef %> seems like a magic function, maybe it is a script or some thing, where can I find that, or where can I find more info about bootstrap
[2012-06-28 23:33:10 -0400] miah: https://github.com/opscode-cookbooks/nginx/blob/master/recipes/commons.rb breaks most things :P
[2012-06-28 23:33:29 -0400] ashb: miah: oh no that was something I wrote about 2 years ago
[2012-06-28 23:33:31 -0400] ashb: go figure :)
[2012-06-28 23:33:32 -0400] miah: williamherry: <%= => is erb / erbus / templating function
[2012-06-28 23:33:42 -0400] miah: erubis
[2012-06-28 23:33:43 -0400] miah: even
[2012-06-28 23:34:10 -0400] syphon: miah: so I'm gonna avoid making any changes to the nginx cookbook for now, since it looks like you have your eyes on it already :)
[2012-06-28 23:34:14 -0400] miah: ya
[2012-06-28 23:34:19 -0400] miah: github.com/miah/nginx
[2012-06-28 23:34:25 -0400] miah: i'll be hacking on it tonight
[2012-06-28 23:34:34 -0400] miah: i am working on fixing a bug in our percona-install fork at the moment
[2012-06-28 23:35:21 -0400] syphon: alternately, if there was an easy way to make nginx not automatically restart (since i reload it with my custom cookbook anyway), that would solve my use case
[2012-06-28 23:35:26 -0400] syphon: that was the other fix I was considering
[2012-06-28 23:35:44 -0400] miah: ill fix it correctly, no worries
[2012-06-28 23:35:57 -0400] syphon: thyanks
[2012-06-28 23:36:54 -0400] ashb: miah: the other change I had was s/restart/reload/ but that looks like its already been made
[2012-06-28 23:37:09 -0400] williamherry: miah, so it's calling that function, where can I find that function, or the directly question, the client.rb file use bootstrap created are not correct(server's url is localhost), how do I fix that?
[2012-06-28 23:44:14 -0400] miah: start_chef should be defined in the template
[2012-06-28 23:44:33 -0400] miah: bootstrap?
[2012-06-28 23:44:33 -0400] bawt_: bootstrap is setting up your system to use Chef. You can 'bootstrap' a Chef RubyGems installation to install a Chef server, or use the knife bootstrap subcommand on new clients.
[2012-06-28 23:44:39 -0400] miah: bawt_: sometimes i hate you
[2012-06-28 23:44:58 -0400] miah: http://wiki.opscode.com/display/chef/Custom+Knife+Bootstrap+Script
[2012-06-28 23:45:01 -0400] miah: reads that
[2012-06-28 23:45:23 -0400] miah: since thats what i assume you are talking about since you are saying bootstrap script
[2012-06-28 23:45:30 -0400] miah: but code examples (gits, nopaste etc please) help
[2012-06-28 23:47:23 -0400] msf: williamherry: start_chef is defined in chef/lib/chef/knife/core/bootstrap_context.rb
[2012-06-28 23:51:19 -0400] williamherry: msf, thanks
[2012-06-28 23:54:44 -0400] ashb: miah: do you want me to submit a ticket for the nginx_site :source param?
