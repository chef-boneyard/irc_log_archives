[2012-06-15 00:03:02 -0400] ssd7_: Ohai Chefs
[2012-06-15 00:13:43 -0400] c_t: ohai
[2012-06-15 00:19:36 -0400] hoover_damm: terryjfundak, yeah I upgraded to the Quad Core late 2011 Macbook Pro Model
[2012-06-15 00:19:47 -0400] hoover_damm: terryjfundak, had a 2008 Macbook Pro that was just dogging me
[2012-06-15 00:20:08 -0400] hoover_damm: I'll likely wait for the 13" Retina Display before I upgrade again
[2012-06-15 00:20:49 -0400] hoover_damm: 13" retina on the road sounds dreamy paired up to a decent 27" to use on a desk
[2012-06-15 00:21:13 -0400] terryjfundak: hoover_damn: Love my Mac's and use them too long sometimes..... Time to send this dog to the kids...
[2012-06-15 00:21:59 -0400] hoover_damm: terryjfundak, my lady got mine
[2012-06-15 00:23:36 -0400] hoover_damm: we all use hardware until it cries for mercy
[2012-06-15 00:23:40 -0400] hoover_damm: that's how we return our investment
[2012-06-15 00:25:00 -0400] terryjfundak: I didn't consider the retina.... too many pixel per sq inch for my eye to see that tiny type.....
[2012-06-15 00:25:53 -0400] terryjfundak: but it is a nice clean clear screen....
[2012-06-15 00:30:22 -0400] hoover_damm: i'm not sure
[2012-06-15 00:43:13 -0400] williamherry: I don't understand why chef did not add push support, it don't need to do lot things, just sent a signal to client that some thing changes
[2012-06-15 00:45:11 -0400] williamherry: client will not need to run every minute to check what changes, which a lot of them are waste cpu power
[2012-06-15 00:58:40 -0400] maek: is there an omnibus installer for chef server?
[2012-06-15 01:01:49 -0400] yfeldblum: williamherry, by what mechanism do you think the chef-server-api should know that something changed?
[2012-06-15 01:02:32 -0400] yfeldblum: williamherry, remembering that, in the Chef world, the configuration of a given node is actually calculated on that node and by that node, not on the chef-server-api
[2012-06-15 01:03:58 -0400] yfeldblum: williamherry, note that the Chef world differs from other CM worlds such as Puppet, where in those worlds the configuration of a given node is calculated on the central CM server or master, and so the master is able to know immediately when the configuration of a given node has changed
[2012-06-15 01:11:28 -0400] williamherry: chef-server don't need to know what changed, it can just send a signal to all client when I upload something, I am totally new to system admin, if some thing I said to make you upset, sorry for that, ^)^
[2012-06-15 01:12:39 -0400] miah: you'd have to coordinate it, as you can have multiple chef servers
[2012-06-15 01:16:18 -0400] yfeldblum: williamherry, not upset, don't worry :P
[2012-06-15 01:16:50 -0400] yfeldblum: williamherry, when you upload something, the configuration of most nodes will *not* change; why should they receive that signal?
[2012-06-15 01:17:24 -0400] yfeldblum: williamherry, correspondingly, when no-one uploads anything at all, the configuration of some nodes *might* change
[2012-06-15 01:17:47 -0400] yfeldblum: williamherry, so we've got false positives and false negatives going on in the Chef world
[2012-06-15 01:18:46 -0400] yfeldblum: williamherry, if you think about your infrastructure with chef more as a loosely-connected, often-disconnected distributed system, you won't go far wrong
[2012-06-15 01:18:59 -0400] yfeldblum: williamherry, add in eventually-consistent
[2012-06-15 01:19:30 -0400] yfeldblum: williamherry, so the idea is to write your recipes respecting these facts
[2012-06-15 01:22:40 -0400] williamherry: yfeldblum, ok, thank you then
[2012-06-15 01:24:42 -0400] yfeldblum: williamherry, on the whole, it's harder, but more reliable
[2012-06-15 01:27:44 -0400] hoover_damm: so dumb question.  How do you reference node attributes in an atribute file? let's say node[:carbon][:cache][port][:local_data_dir] and I want to node.set[:carbon][:cache][port][:local_data_dir]=node[:carbon][:storage_dir] + "whisper#{port}"
[2012-06-15 01:29:00 -0400] hoover_damm: I used to think that example would work but the reality is the storage_dir prolly isn't set when that runs
[2012-06-15 01:35:39 -0400] yfeldblum: hoover_damm, prefer to use mostly static defaults in attributes files, because the type of thing you're thinking about can sometimes be difficult and sometimes impossible to support correctly
[2012-06-15 01:36:41 -0400] hoover_damm: yfeldblum, yeah i'm thinking of setting it in the recipe
[2012-06-15 01:36:44 -0400] hoover_damm: which would be possible
[2012-06-15 01:36:56 -0400] yfeldblum: hoover_damm, yep, that's the approach
[2012-06-15 01:37:18 -0400] hoover_damm: hrm the attribute could provide the base then
[2012-06-15 01:37:19 -0400] hoover_damm: that's fine
[2012-06-15 01:37:21 -0400] hoover_damm: :D
[2012-06-15 01:37:37 -0400] hoover_damm: just some baseports, baselevel attributes
[2012-06-15 01:37:53 -0400] hoover_damm: max_updates_per_second, max_cache_size... things that likely will be mapped to each carbon-cache
[2012-06-15 01:37:59 -0400] hoover_damm: and not different on each
[2012-06-15 01:38:25 -0400] hoover_damm: btw what's with graph databases lately?
[2012-06-15 01:38:28 -0400] hoover_damm: seems like a dime a dozen
[2012-06-15 01:59:42 -0400] Cope: hoover_damm: the other think to be careful of is that you don't get tripped up by merge order; in general it's best to do any dynamic attr setting late - ie in the recipe.
[2012-06-15 02:03:11 -0400] leifmadsen: huzzuh!
[2012-06-15 02:03:25 -0400] leifmadsen: worked around a bunch of stuff and I can finally chef_gem :D
[2012-06-15 02:04:50 -0400] hoover_damm: eh you still do work arounds in ubuntu.  It's just you share the work arounds more
[2012-06-15 02:04:54 -0400] hoover_damm: so it's not so painful
[2012-06-15 02:05:11 -0400] leifmadsen: ya, I have a few things I need to submit to the opscode cookbooks now :D
[2012-06-15 02:05:20 -0400] hoover_damm: with el5/6 it's like a sin to work around for some people
[2012-06-15 02:05:31 -0400] leifmadsen: chef-full rpm needs some tweaks too since 'gem' isn't linked anywhere in the standard path
[2012-06-15 02:05:56 -0400] Cope: leifmadsen: that's deliberate
[2012-06-15 02:06:00 -0400] leifmadsen: really?
[2012-06-15 02:06:07 -0400] Cope: i agree this isn't a solved problem though
[2012-06-15 02:06:08 -0400] leifmadsen: it seemed to "just work" when I built a similar install for ubuntu
[2012-06-15 02:06:29 -0400] Cope: gem should be in the embedded/bin path
[2012-06-15 02:06:37 -0400] Cope: and not symlinked at install time
[2012-06-15 02:06:42 -0400] leifmadsen: build-essential, link, chef_gem "mysql", then mysql::server, then database cookbook caused things to work
[2012-06-15 02:06:52 -0400] Cope: the only things we put in the standard path are the core chef tools
[2012-06-15 02:06:52 -0400] leifmadsen: Cope: ya it was in that location
[2012-06-15 02:06:57 -0400] leifmadsen: just not accessible
[2012-06-15 02:07:02 -0400] Cope: right
[2012-06-15 02:07:28 -0400] leifmadsen: so it's expected any tool I want to use I should link first?
[2012-06-15 02:07:34 -0400] leifmadsen: or am I doing it wrong? :)
[2012-06-15 02:07:47 -0400] hoover_damm: wait your using the omnibus ruby to power web apps?
[2012-06-15 02:07:50 -0400] Cope: it's expected that shef, chef-client, chef-solo and knife should be on your path
[2012-06-15 02:07:58 -0400] Cope: and nothing else
[2012-06-15 02:08:04 -0400] hoover_damm: or did I get that wrong?
[2012-06-15 02:08:21 -0400] leifmadsen: hoover_damm: me?
[2012-06-15 02:08:46 -0400] leifmadsen: i'm using chef and ruby to configure the system in preparation for a php based web application
[2012-06-15 02:08:49 -0400] hoover_damm: ^^ leifmadsen
[2012-06-15 02:08:55 -0400] hoover_damm: oh okay
[2012-06-15 02:08:58 -0400] leifmadsen: :)
[2012-06-15 02:09:32 -0400] hoover_damm: leifmadsen, the Ubuntu setup is more used/tested and ironed out better
[2012-06-15 02:09:34 -0400] hoover_damm: that's all I can say
[2012-06-15 02:09:46 -0400] leifmadsen: it's obvious that is the case based on the documentation :)
[2012-06-15 02:09:50 -0400] hoover_damm: I loathe Ubuntu to the core
[2012-06-15 02:09:57 -0400] leifmadsen: unfortunately our webapp was developed on centos
[2012-06-15 02:10:03 -0400] hoover_damm: but that's because I'm a Gentoo user who wants every option I can
[2012-06-15 02:10:09 -0400] leifmadsen: that being said, I use Fedora on my desktop
[2012-06-15 02:10:21 -0400] leifmadsen: oh you're one of those
[2012-06-15 02:10:25 -0400] leifmadsen: <G>
[2012-06-15 02:10:26 -0400] hoover_damm: and don't wanna write a debian package when I start licking the yellow bus
[2012-06-15 02:11:19 -0400] leifmadsen: Cope: but it's so easy... look at the material!
[2012-06-15 02:11:23 -0400] hoover_damm: yes please stop trolling Gentoo it's lame
[2012-06-15 02:11:52 -0400] leifmadsen: I think I missed the gentoo trolling
[2012-06-15 02:12:12 -0400] hoover_damm: There isn't any yet :) but it's come and go
[2012-06-15 02:12:16 -0400] leifmadsen: heh
[2012-06-15 02:12:25 -0400] leifmadsen: gentoo trolling is so 2010
[2012-06-15 02:15:07 -0400] hoover_damm: 2005..2010 but yeah
[2012-06-15 02:15:56 -0400] leifmadsen: heh
[2012-06-15 02:19:00 -0400] coderanger: lusis: Are you guys going to need any help setting up for devopsdays? I can haul stuff around :)
[2012-06-15 02:19:05 -0400] coderanger: (woo being local)
[2012-06-15 02:21:52 -0400] williamherry: does chef have some monitor feature, for instance, when some recipe go wrong, adms can know that as soon as possible
[2012-06-15 02:22:46 -0400] coderanger: williamherry: Check out handlers, and error handlers in particular
[2012-06-15 02:23:10 -0400] coderanger: We ship some basic ones for email and IRC I think, there are ones for hipchat, basecamp, jabber, splunk, etc etc
[2012-06-15 02:27:07 -0400] williamherry: coderanger, thanks, email may enough for me
[2012-06-15 02:35:14 -0400] amagee: hey i'd like to use the "mount" resource to add an s3fs fuse mount to /etc/fstab, but it doesn't seem to be able to write the fstab line in the syntax I need: http://dpaste.com/759831/
[2012-06-15 02:37:58 -0400] coderanger: amagee: use fstype "fuse" and make options into an array I think
[2012-06-15 02:38:08 -0400] Cope: amagee: options should be an arrary
[2012-06-15 02:38:11 -0400] coderanger: and then dump 0 pass 0
[2012-06-15 02:38:31 -0400] Cope: and what coderanger said
[2012-06-15 02:38:46 -0400] coderanger: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/mount/mount.rb#L147
[2012-06-15 02:44:22 -0400] amagee: ok cool will try that
[2012-06-15 02:49:41 -0400] terryjfundak: Hey coderanger: if that is devopsdays after velocity in santa clara.... then I could help too...
[2012-06-15 02:50:14 -0400] amagee: ah yup, that seemed to work, thanks coderanger and Cope :)
[2012-06-15 02:51:17 -0400] amagee: oh btw, according to the docs, options is an "array or string"
[2012-06-15 03:07:29 -0400] Cope: amagee: yes, a one element arrary can be treated as a string
[2012-06-15 03:10:03 -0400] hoover_damm: eh
[2012-06-15 03:10:08 -0400] hoover_damm: i still do .first on a one element array
[2012-06-15 03:10:19 -0400] hoover_damm: you'd be suprised how ["something"] poops out at you
[2012-06-15 04:05:25 -0400] hoover_damm: oh it's just my luck a bunch of instances in us-east-1c start freaking out
[2012-06-15 04:18:32 -0400] silk: we lost 2 in our 1d
[2012-06-15 04:18:46 -0400] silk: but its not all of the nodes in -1d
[2012-06-15 04:18:52 -0400] hoover_damm: it's ebs volumes
[2012-06-15 04:18:58 -0400] hoover_damm: it's nothing to do with the ec2 instances themselves
[2012-06-15 04:19:08 -0400] silk: thats not what im seeing
[2012-06-15 04:19:16 -0400] hoover_damm: one of our scribe instances is a instance based AMI
[2012-06-15 04:19:17 -0400] silk: and the 2 nodes are instance-stores
[2012-06-15 04:19:23 -0400] hoover_damm: so scribed is currently oopsing
[2012-06-15 04:19:29 -0400] hoover_damm: as it can't write to the EBS volume
[2012-06-15 04:19:37 -0400] hoover_damm: our EBS based instances I just cannot login to
[2012-06-15 04:19:42 -0400] hoover_damm: they're up, but the load is through the roof
[2012-06-15 04:20:07 -0400] hoover_damm: our stuff in ELB was auto dropped out thankfully
[2012-06-15 04:20:17 -0400] hoover_damm: i think our haproxy stuff in us-east-1c is cool
[2012-06-15 04:20:20 -0400] hoover_damm: as that's writing to ephemeral
[2012-06-15 04:24:59 -0400] hoover_damm: and we're not dropping traffic
[2012-06-15 04:25:05 -0400] hoover_damm: stupid cloud
[2012-06-15 04:36:58 -0400] hoover_damm: oh yay, it's upped to ebs volumes
[2012-06-15 04:37:00 -0400] hoover_damm: and internet!
[2012-06-15 04:37:03 -0400] hoover_damm: woohoo!
[2012-06-15 05:46:56 -0400] ampledata: know any funny jokes?
[2012-06-15 05:47:04 -0400] ampledata: i mean about something other than aws
[2012-06-15 05:52:40 -0400] williamherry: centos5-gems seems not work, It try to connect to production.cf.rubygems.org, which is nothing there
[2012-06-15 06:04:30 -0400] BryanWB_: ohai chefs!
[2012-06-15 06:11:40 -0400] hoover_damm: ampledata, wanna blow some steam? poke a hole in the cloud
[2012-06-15 06:13:22 -0400] senthilr: the cloud is already borken
[2012-06-15 06:13:26 -0400] hoover_damm: http://funnyjokesandlaughs.files.wordpress.com/2011/08/2011-08-16-this-is-your-privacy-online-500x328.jpg
[2012-06-15 06:13:26 -0400] senthilr: https://twitter.com/rakesh314/status/213495804168642561
[2012-06-15 06:13:47 -0400] hoover_damm: LOL
[2012-06-15 06:15:07 -0400] hoover_damm: strange
[2012-06-15 06:15:15 -0400] hoover_damm: it appears this instance has really bad slow writes
[2012-06-15 06:15:19 -0400] hoover_damm: 20 i/ops a second
[2012-06-15 06:15:24 -0400] hoover_damm: with 87% utilization
[2012-06-15 06:17:46 -0400] Randm: probably someone else chewing I/O on your storage
[2012-06-15 06:17:55 -0400] Randm: hence netflix's chaosmonkey
[2012-06-15 06:19:10 -0400] hoover_damm: lol prolly
[2012-06-15 07:53:56 -0400] BryanWB_: is there an lwrp for managing ulimits in /etc/security/limits.conf?
[2012-06-15 08:08:00 -0400] hoover_damm: No, that should be done before chef.
[2012-06-15 08:08:09 -0400] hoover_damm: ^^ BryanWB_
[2012-06-15 08:16:12 -0400] ampledata: hoover do u ever sleep?
[2012-06-15 08:29:17 -0400] williamherry: hi, how to change interval time in centos, I can change that on ubuntu by modify /etc/default/chef-client, but it don't exist in centos, I create one manually, chef-client doesn't use it
[2012-06-15 08:37:26 -0400] saschagehlich: hey
[2012-06-15 08:37:30 -0400] Cope: williamherry: use the chef-client cookbook and set node["chef_client"]["interval"]
[2012-06-15 08:38:17 -0400] saschagehlich: when I'm creating a user with the following code, the user will be locked (= "!" in /etc/shadow instead of "*") - how can I avoid that? https://gist.github.com/389d841df099a37c8819
[2012-06-15 08:42:18 -0400] williamherry: Cope, Thank you, too much need to learn,^)^
[2012-06-15 08:45:22 -0400] williamherry: Cope, should I modify attributes/default.rb?,
[2012-06-15 09:29:38 -0400] Cope: williamherry: yep, that's right
[2012-06-15 09:30:01 -0400] Cope: saschagehlich: what platform / version ?
[2012-06-15 09:45:24 -0400] saschagehlich: Cope: debian squeeze
[2012-06-15 10:17:28 -0400] viraptor: hi all, does anyone know if there's any known / published patch to enable data bag item caching, so that in one chef-client run they're not requested multiple times?
[2012-06-15 11:53:06 -0400] specialsauce: ohai chefs. is there a good method yet for manaing "templates" where you need to substitute multiple lines rather than individual config values?
[2012-06-15 11:54:44 -0400] yfeldblum: specialsauce, ERB
[2012-06-15 11:54:57 -0400] yfeldblum: specialsauce, why do you need multiple lines?
[2012-06-15 11:56:04 -0400] yfeldblum: viraptor, use a local variable
[2012-06-15 11:57:06 -0400] specialsauce: yfeldblum: i have some JSON files I need to configure that basically contain an array of hashes. I want the array to be of size n where n is the number of hosts the file provides configuration for
[2012-06-15 11:58:43 -0400] specialsauce: yfeldblum, do you know of an example cookbook that uses such a technique? I'm using erb templates, but only substituting single values until now
[2012-06-15 11:58:59 -0400] viraptor: @yfeldblum: that would work in a simple case, but I'm interested in a situation where 7 different recipes will request the same item in a single run
[2012-06-15 12:03:09 -0400] viraptor: specialsauce: I guess you're looking for something like: <% for x in @your_template_variable %>the host is <%= x %> with values <% for k,v in x %> key: <%= k %> value: <%= v %> <% end %> <% end %>
[2012-06-15 12:03:35 -0400] viraptor: (split across lines as needed)
[2012-06-15 12:05:47 -0400] specialsauce: viraptor, i don't see that working in json since each config section is multiple lines
[2012-06-15 12:06:30 -0400] rgsteele: What precedence level to attrs get set to if you don't specify one explicitly?  E.g., lines 42-43 of https://github.com/opscode-cookbooks/openldap/blob/master/attributes/default.rb
[2012-06-15 12:06:31 -0400] rgsteele: normal?
[2012-06-15 12:06:32 -0400] bawt_: normal is what you set on the node by editing it
[2012-06-15 12:06:51 -0400] viraptor: specialsauce: not sure what you're trying to achieve - an example in pastebin would be helpful :)
[2012-06-15 12:07:10 -0400] specialsauce: viraptor: ok sure, will do,  2 mins
[2012-06-15 12:07:18 -0400] rgsteele: And, is it valid to reference the attrs without said prefix?  E.g., line 60 just uses openldap[:server] instead of node[:openldap][:server]
[2012-06-15 12:07:51 -0400] yfeldblum: viraptor, possibly use a global variable, or possibly an accessor method which works through node.run_state
[2012-06-15 12:08:16 -0400] rgsteele: I just haven't seen that before, I'm not really sure if it's a recommended to follow such a paradigm.
[2012-06-15 12:08:41 -0400] yfeldblum: rgsteele, yes, normal, but unfortunately that's usually not what you want to use
[2012-06-15 12:09:18 -0400] yfeldblum: rgsteele, it is, but only within an attributes file, because `self` in an attributes file is set up to be the node
[2012-06-15 12:09:43 -0400] rgsteele: yfeldblum: Gotcha, thanks.  I'll stick to being explicit, I think.
[2012-06-15 12:09:46 -0400] yfeldblum: rgsteele, but that's a terribly confusing practice to do, so don't use it
[2012-06-15 12:09:53 -0400] rgsteele: Yep, exactly :)
[2012-06-15 12:09:58 -0400] rgsteele: Thanks again
[2012-06-15 12:10:21 -0400] yfeldblum: rgsteele, use `default["openldap"]["server"] = "asdf"` or even `node.default["openldap"]["server"] = "asdf"`
[2012-06-15 12:10:36 -0400] yfeldblum: rgsteele, but since the `node` is implicit because `self` is the `node`, they're the same thing
[2012-06-15 12:10:42 -0400] yfeldblum: rgsteele, in an attributes file only
[2012-06-15 12:11:04 -0400] yfeldblum: rgsteele, also, prefer strings over symbols for node attributes
[2012-06-15 12:11:41 -0400] rgsteele: yfeldblum: Cool.  Why the preference over symbols?  And, philosophically speaking, why provide symbols as an option if they're not recommended?
[2012-06-15 12:12:15 -0400] yfeldblum: rgsteele, symbols are, apparently, cool - or were cool when they were first writing chef
[2012-06-15 12:12:58 -0400] rgsteele: Heh
[2012-06-15 12:13:06 -0400] specialsauce: viraptor: http://pastebin.com/6BVbBXVX
[2012-06-15 12:13:28 -0400] specialsauce: i want to build a JSON config file using the template mechanism to stick on disk of some clients
[2012-06-15 12:13:55 -0400] specialsauce: but although in that example there are 2 hosts, I need to support n hosts flexibly using results of search etc
[2012-06-15 12:14:24 -0400] specialsauce: but although I know how to pass vars in to use as values, I'm not sure if a mechanism exists to build dynamic blocks in a template file
[2012-06-15 12:14:30 -0400] yfeldblum: rgsteele, symbols are great for things like method names, keyword arguments, etc: `define_method(:say_hi) { puts "hi" }`
[2012-06-15 12:15:09 -0400] yfeldblum: rgsteele, `def run_fast(options = { }) ; speed = options[:speed] || 6 ; ... end ; run_fast(speed: 12)`
[2012-06-15 12:15:13 -0400] viraptor: specialsauce: actually if it's all json, you may be more luckly just creating a file resource with a hash serialised to json format - otherwise you're going to go through hell with getting the "," separators right (since they cannot be at the end)
[2012-06-15 12:16:12 -0400] yfeldblum: specialsauce, if you want to build a JSON config file, you can use the `file` resource and set the `content` attribute to `JSON.dump(data)`
[2012-06-15 12:16:14 -0400] viraptor: specialsauce: file "something" do ; content serialize_to_json(my_stuff) ; end
[2012-06-15 12:16:32 -0400] specialsauce: viraptor: ok, cheers, i'll take a look into that
[2012-06-15 12:16:34 -0400] viraptor: what he said ;)
[2012-06-15 12:16:40 -0400] specialsauce: yfeldblum, thanks
[2012-06-15 12:17:04 -0400] yfeldblum: specialsauce, you will have a problem, however, in that for most JSON libraries, they do not order the keys in any particular order, so the file contents in terms of bytes may change from one run to the next, even though the semantic content, that is the file contents in terms of meaning, remains the same
[2012-06-15 12:17:17 -0400] specialsauce: gah, ok
[2012-06-15 12:17:30 -0400] yfeldblum: specialsauce, so you'll need to look into some tricks out there to force the JSON serialization of objects to sort the keys
[2012-06-15 12:18:00 -0400] yfeldblum: that is a huge major failing of some of these libraries ...
[2012-06-15 12:18:07 -0400] yfeldblum: specialsauce, what ruby are you using?
[2012-06-15 12:18:12 -0400] yfeldblum: specialsauce, on the nodes?
[2012-06-15 12:18:22 -0400] specialsauce: on the clients, 1.8.7, on the server 1.9.2 iirc
[2012-06-15 12:19:23 -0400] yfeldblum: specialsauce, one thing you can do: recursively duplicate the entire object structure; for Hash instances in the object structure, after duplicating them, on the duplicate, redefine the #each method on that instance
[2012-06-15 12:20:18 -0400] yfeldblum: def new_hash_instance.each ; keys.each{|k| yield(k, self[k])} ; end
[2012-06-15 12:20:30 -0400] yfeldblum: def new_hash_instance.each ; keys.sort.each{|k| yield(k, self[k])} ; end
[2012-06-15 12:20:32 -0400] yfeldblum: second one
[2012-06-15 12:21:38 -0400] yfeldblum: that *may* work, depending on the JSON library (whether it calls #each to enumerate the items in the Hash, or whether it calls an underlying C function instead)
[2012-06-15 12:24:44 -0400] specialsauce: yfeldblum, ok thanks, its a big file so i diodn't really want to serialise the entire thing but I  will take a look
[2012-06-15 12:39:31 -0400] viraptor: yfeldblum: run_state is exactly what I needed, thanks
[2012-06-15 12:48:21 -0400] yfeldblum: viraptor, don't abuse it :P
[2012-06-15 12:50:02 -0400] viraptor: yfeldblum: I'll try not to... althoug hif it works, I'll probably submit a patch: http://pastebin.com/HtREyRSm
[2012-06-15 12:51:02 -0400] yfeldblum: viraptor, that's probably a bad idea
[2012-06-15 12:51:24 -0400] viraptor: ok, what's bad?
[2012-06-15 12:51:56 -0400] rgsteele: Hm... does Chef support using heredoc's for attr values (for those special cases where it's useful)?
[2012-06-15 12:52:21 -0400] rgsteele: I know I can use heredoc's in a recipe, just not sure if I can use it to define an attr.
[2012-06-15 12:53:51 -0400] yfeldblum: viraptor, (1) caching should typically be explicit, (2) the run-state shouldn't accumulate giant wads of data without anybody telling it to, (3) doesn't help with search, (4) if data bag item fetch is slow, fix the chef-server-api; the chef-client is running hundreds of tests against the filesystem and various system resources, so one would expect that to dwarf data bag item fetches
[2012-06-15 12:56:31 -0400] yfeldblum: (5) that would likely not work well with projections
[2012-06-15 12:57:51 -0400] yfeldblum: (6) high-level APIs can use transparent caching; low-level APIs shouldn't be magical
[2012-06-15 12:59:00 -0400] viraptor: yfeldblum: 1,2) hence the ..._cached suffix, 3) true, but unless I cache everything that would never be possible to achieve, 4) with 500+ hosts, it's the server time I'm worried about, not the client ;)
[2012-06-15 12:59:46 -0400] yfeldblum: viraptor, scale the server?
[2012-06-15 13:00:50 -0400] yfeldblum: viraptor, it's fine for you to cache things all the way to the moon; i'm just saying it's not a good idea to do that by default for everyone
[2012-06-15 13:01:47 -0400] yfeldblum: viraptor, so it's only the patch to chef itself that i don't like; go nuts with the run-state in your own recipes, though
[2012-06-15 13:02:35 -0400] viraptor: fair enough - I do it by reopening the right classes in my own cookbook/libraries - just thought it may be useful for others
[2012-06-15 13:03:56 -0400] yfeldblum: viraptor, make it a library file in a cookbook
[2012-06-15 13:04:41 -0400] yfeldblum: viraptor, also, didn't see the _cached before, whoops
[2012-06-15 14:18:10 -0400] ddosia: hello guys, i have little misunderstooding how to run tasks. I made chef-server, bootstraped client, it showed through `knife node list`, add quick_start recipe to it, and nothing happened on client.
[2012-06-15 14:19:08 -0400] agosse: did you run chef-client on the client?
[2012-06-15 14:19:45 -0400] ddosia: no
[2012-06-15 14:20:09 -0400] agosse: try doing that
[2012-06-15 14:20:18 -0400] ddosia: i should manualy run it, or it could be run as a daemon?
[2012-06-15 14:20:30 -0400] ddosia: i thought bootstrap will do this for me
[2012-06-15 14:24:40 -0400] workmad3: ddosia: either... if you don't mind your nodes updating without prompting, then daemonised chef-client is your friend... if you'd rather they only ran on demand, then manual chef-client
[2012-06-15 14:25:27 -0400] workmad3: ddosia: the knife ssh command is your friend for manual runs :)
[2012-06-15 14:26:32 -0400] ddosia: as far as i understood correctly, if i demonize chef-client, all changes will be applied only once?
[2012-06-15 14:26:49 -0400] geekbri: anybody else been getting a ton of Chef::Exceptions::Exec: apt-get -q -y install xorg=1:7.5+6ubuntu3.1 returned 100, expected 0  messages?
[2012-06-15 14:27:39 -0400] geekbri: obviously not necessarily for xorg, but just in general?
[2012-06-15 14:27:45 -0400] workmad3: ddosia: it'll run the chef-client every X minutes (30 by default, iirc) and do a complete chef run
[2012-06-15 14:28:41 -0400] workmad3: ddosia: so it'll run through all your run list and apply all the resources defined... the resources themselves should be idempotent, so they'll decide if they need to run or not based on current system state, so in effect only the stuff that needs to run will be
[2012-06-15 14:29:11 -0400] ddosia: workmad3: does it mean, that if my client node in role `web', it will reinstall all web stuff every 30 min?
[2012-06-15 14:29:14 -0400] workmad3: ddosia: the same is true no matter how you run the chef-client
[2012-06-15 14:29:53 -0400] workmad3: ddosia: no, it'll run the recipes in your web role, but something like 'package "apache" ' will only install apache if it isn't already installed
[2012-06-15 14:30:07 -0400] workmad3: ddosia: 'package "apache" ' is a resource
[2012-06-15 14:30:38 -0400] ddosia: ok, thnks guys
[2012-06-15 14:31:22 -0400] ddosia: i hope chef will make my life more easy then now ><
[2012-06-15 14:31:41 -0400] workmad3: ddosia: the reason it's important to keep that in mind though is that with certain resources, like script executions, you need to have provided an 'only_if' or 'not_if' parameter to the resource otherwise it'll run every time (and potentially not be idempotent)
[2012-06-15 14:33:26 -0400] ddosia: got it
[2012-06-15 14:34:52 -0400] dispalt: is there a way to set gem_binary globally?
[2012-06-15 14:38:08 -0400] viraptor: geekbri: try to run it manually - most likely you have some dependencies resulting in a question from apt-get, so it defaults to 'stop now'... if you don't care add option --force-yes to the package block
[2012-06-15 14:44:04 -0400] geekbri: viraptor: Yeah running it manually always seems to fix it.  It has happened with a couple different random packages (open-jdk and xorg are two I can think of off hand)
[2012-06-15 14:44:29 -0400] geekbri: viraptor: wouldn't it spit out if there was a dependency issue though?
[2012-06-15 14:53:04 -0400] viraptor: geekbri: depends what happened when you run it manually - did you not get any question at all?
[2012-06-15 14:53:17 -0400] geekbri: viraptor: no questions, installed just fine.
[2012-06-15 14:53:33 -0400] viraptor: alternatively maybe apt-get update was running at the same time and you run into lock contention - apt-get will just fail in that case
[2012-06-15 14:54:11 -0400] geekbri: hrm, I dont think that was the case, but its hard to tell as the error isn't very descriptive.
[2012-06-15 14:55:59 -0400] LinuxHorn: how do i say in a recipe:  if node[:attribute1] equals "something" and node[:attribute2] equals something then do "this"?
[2012-06-15 14:58:14 -0400] viraptor: LinuxHorn: if node[:attribute1] == "something" && node[:attribute2] == "something" ....
[2012-06-15 14:58:31 -0400] LinuxHorn: so && is or?
[2012-06-15 14:58:37 -0400] LinuxHorn: in bash && is and
[2012-06-15 14:58:40 -0400] LinuxHorn: weird
[2012-06-15 14:58:55 -0400] viraptor: you said "node[:attribute1] equals "something" and node[:attribute2] equals something"
[2012-06-15 14:58:59 -0400] viraptor: I don't see or in there...
[2012-06-15 14:59:01 -0400] LinuxHorn: oops
[2012-06-15 14:59:03 -0400] LinuxHorn: meant OR :)
[2012-06-15 14:59:07 -0400] viraptor: ||
[2012-06-15 14:59:11 -0400] LinuxHorn: thx
[2012-06-15 15:01:00 -0400] viraptor: geekbri: you can also find the apt-get result in /var/log/apt/history.log* - if you look for the right time, you may work out what the problem was
[2012-06-15 15:02:10 -0400] geekbri: viraptor: good call, i'll do that.
[2012-06-15 16:03:45 -0400] agosse: typo at the bottom of http://wiki.opscode.com/display/chef/Recipes
[2012-06-15 16:04:01 -0400] agosse: "Chef::Log.fatal{'Something bad happened and I want to stop')"
[2012-06-15 16:04:21 -0400] agosse: (somewhat ironically)
[2012-06-15 16:05:56 -0400] geekbri: that is pretty funny.
[2012-06-15 16:20:33 -0400] geekbri: "Install packages using the new hotness in Python package management...pip. Yo dawg...easy_install is so 2009, you better ask your local Pythonista if you don't know! The usage semantics are like that of any normal package provider."  - opscode wiki
[2012-06-15 16:20:37 -0400] geekbri: love it.
[2012-06-15 16:23:38 -0400] hoover_damm: It's too bad there isn't a fixcloud cookbook that can fix all problems due to cloud provider oopses
[2012-06-15 16:23:48 -0400] agosse: +1
[2012-06-15 16:24:18 -0400] hoover_damm: otherwise I get to figure out how to recover 167 instances manually
[2012-06-15 16:24:20 -0400] hoover_damm: weeee
[2012-06-15 16:24:25 -0400] juliancdunn: % knife fixcloud aws us-east-1d
[2012-06-15 16:24:45 -0400] hoover_damm: gotta enable force i/o options
[2012-06-15 16:24:55 -0400] hoover_damm: and reboot the instance afterwards because it's usually oopsed so hard it's not funny
[2012-06-15 16:25:04 -0400] hoover_damm: at least so far for me.
[2012-06-15 16:25:32 -0400] Gurpartap: Can I query chef server to make me ec2 instances and provision them with cookbooks?
[2012-06-15 16:25:49 -0400] Gurpartap: (I'm starting to use chef)
[2012-06-15 16:27:02 -0400] Gurpartap: https://github.com/opscode/knife-ec2 sounds like the tool I need, but I want an API against it, instead of CLI
[2012-06-15 16:27:18 -0400] geekbri: juliancdunn: As much as the individual package manager per language is super annoying sometimes, I still think its better than the situation we had before where none of them had it and people were just doing whatever.
[2012-06-15 16:29:46 -0400] yfeldblum: hoover_damm, make new instances and retire the old?
[2012-06-15 16:36:23 -0400] geekbri: Gurpartap: I dont know of any REST api that acts like knife, but you could certainly write one!
[2012-06-15 16:40:45 -0400] Gurpartap: geekbri: right. i might as well just call the ruby code directly in my app
[2012-06-15 16:41:33 -0400] geekbri: yarrrrrr
[2012-06-15 16:45:55 -0400] thehar: Morning chefs.
[2012-06-15 16:48:28 -0400] hoover_damm: yfeldblum, yep
[2012-06-15 16:48:34 -0400] hoover_damm: yfeldblum, just no point in trying to fix it
[2012-06-15 16:55:56 -0400] pwf: in a resource block, user has no affect on the not_if right?
[2012-06-15 16:56:15 -0400] pwf: you have to specify :user in the not_if attribute?
[2012-06-15 17:07:59 -0400] ashb: pwf: that sounds right
[2012-06-15 17:08:59 -0400] pwf: ugh people always gotta be breakin my code
[2012-06-15 17:09:17 -0400] pwf: yeah it's correct ashb, but the not_if is wrong
[2012-06-15 17:09:38 -0400] pwf: i thought it was because it was running as the wrong user, but nope
[2012-06-15 17:11:34 -0400] pwf: so how can i do a not_if that will run it if the output of the command is nothing
[2012-06-15 17:11:45 -0400] pwf: like if i want to do something if grep doesn't match
[2012-06-15 17:11:49 -0400] pwf: grep will return 0 right?
[2012-06-15 17:13:50 -0400] pwf: nevermind, it returns 1
[2012-06-15 17:13:51 -0400] paulmooring: pwf: `echo "a" | grep -q "a" ; echo $?` => 0
[2012-06-15 17:14:12 -0400] paulmooring: so 0 means match was found
[2012-06-15 17:15:59 -0400] ssd7: You can use -v to invert that logic
[2012-06-15 17:16:49 -0400] pwf: the not_if was running a psql command, and expecting it to return 1 if the result was empty
[2012-06-15 17:17:02 -0400] pwf: so i just took the where clause from it and turned it into a gerp
[2012-06-15 17:17:05 -0400] pwf: *grep
[2012-06-15 17:17:10 -0400] pwf: which will indeed return 1 if it's missing
[2012-06-15 17:18:31 -0400] paulmooring: ssd7: keep in mind in terms of bash logic 0 means success, so `if $(some_cmd | grep -q "search_term") ; then do_this ; fi` expects you to not invert it
[2012-06-15 17:27:06 -0400] hoover_damm: don't you wish you could do something like not_if :process_running => /^foobar/
[2012-06-15 17:27:28 -0400] hoover_damm: it's gotta be one of the biggest things we run into, and how we handle the not_if on processes and file management
[2012-06-15 17:27:31 -0400] hoover_damm: is very personal
[2012-06-15 17:27:38 -0400] ashb: hoover_damm: pgrep ?
[2012-06-15 17:27:59 -0400] hoover_damm: ashb, no more like internal process searching / matching built into chef
[2012-06-15 17:28:07 -0400] ashb: ah right
[2012-06-15 17:28:15 -0400] hoover_damm: ashb, so your not having to spawn out and pipe a bunch of goo together and hope it sticks
[2012-06-15 17:28:36 -0400] hoover_damm: ever done not_if 'ldd sometfile | grep not not found'
[2012-06-15 17:28:37 -0400] hoover_damm: I have
[2012-06-15 17:28:38 -0400] hoover_damm: it's nasty
[2012-06-15 17:29:33 -0400] ashb: hoover_damm: you can't check for the existance of the files instead?
[2012-06-15 17:30:37 -0400] hoover_damm: ashb, honestly I could chain not_if's
[2012-06-15 17:31:02 -0400] hoover_damm: not_if { :file_exists?("/path/to/foobar"), :process_running?("collectd") }
[2012-06-15 17:31:16 -0400] hoover_damm: just thinking out loud
[2012-06-15 17:31:29 -0400] hoover_damm: pardon the smell
[2012-06-15 17:48:46 -0400] robix: 'knife data bag from file <dbag> <path>' isn't creating a data bag if it doesn't exist.  Is this normal or am I doing something wrong?
[2012-06-15 17:53:08 -0400] ashb: robix: normal. that will only create data bag items, not the data bag itself
[2012-06-15 18:06:12 -0400] miah: hi
[2012-06-15 18:08:47 -0400] robix: ok, thanks.  The docs are a bit confusing.
[2012-06-15 18:10:48 -0400] bluepojo: How can I install chef-server with the omnibus? Is there a way as straight forward as the client install?
[2012-06-15 18:11:17 -0400] siezer: bluepojo thats on its way
[2012-06-15 18:11:23 -0400] bluepojo: got it
[2012-06-15 18:11:28 -0400] siezer: right now the easiest way is through ubuntu packages
[2012-06-15 18:11:50 -0400] bluepojo: cool, I'll use an ubuntu image then.
[2012-06-15 18:11:57 -0400] bluepojo: thanks
[2012-06-15 18:12:07 -0400] siezer: private chef is already omnibussed if you want to evaluate that
[2012-06-15 18:12:40 -0400] bluepojo: we are already in the process of getting private chef this is for a test suite for a tool that talks to chef server
[2012-06-15 18:12:53 -0400] bluepojo: I want to spin up a fresh chef-server with vagrant for the test run
[2012-06-15 18:13:58 -0400] bluepojo: if I could use private chef for that, that'd be even better
[2012-06-15 18:18:54 -0400] siezer: if you've already got the eval set up you should be able to just slice yourself off an org
[2012-06-15 18:21:23 -0400] bluepojo: that makes sense Can I create organizations via API?
[2012-06-15 18:22:06 -0400] bluepojo: the tool is a cloud provisioner dudes say "I want an environment that does X". The tool provisions VMs from a cloud, creates a new environment in chef and bootstraps the nodes into that environment with the right runlist.
[2012-06-15 18:22:35 -0400] bluepojo: some time later they have a full production-like environment running the software they wanted to test.
[2012-06-15 18:23:47 -0400] siezer: pretty sure. lunchtime. brb
[2012-06-15 18:35:22 -0400] Gurpartap: Can a single cookbook install multiple instances of the same program on the same machine?
[2012-06-15 18:35:41 -0400] Gurpartap: Like, each instance can have a different port, but the binary program is the same
[2012-06-15 18:36:17 -0400] Gurpartap: Anyone?
[2012-06-15 18:38:54 -0400] barefoot: sure, why not? its all in what you tell the cb to do right?
[2012-06-15 18:39:24 -0400] Gurpartap: barefoot: OK. How would I pass attributes dynamically to each cookbook "run" ?
[2012-06-15 18:40:10 -0400] barefoot: define dynamically?
[2012-06-15 18:40:14 -0400] Gurpartap: All I could find had an attributes file making it hardcoded
[2012-06-15 18:40:35 -0400] Gurpartap: Suppose I have to provision 10 instances of a cookbook, each having a different variable (e.g. port)
[2012-06-15 18:40:56 -0400] Gurpartap: I would want to act on each of these instances individually,
[2012-06-15 18:41:04 -0400] barefoot: pull the info from a data_bag?
[2012-06-15 18:41:12 -0400] Gurpartap: so something like, "install this cookbook with port 1234"
[2012-06-15 18:41:16 -0400] Gurpartap: hmm
[2012-06-15 18:41:57 -0400] Gurpartap: With that I would have to have a data bag for every instance?
[2012-06-15 18:41:57 -0400] bluepojo: you could check the box to see what ports are already used in a given port range and pick the next available one
[2012-06-15 18:42:28 -0400] Gurpartap: which box?
[2012-06-15 18:42:30 -0400] bluepojo: rather than using attributes at all
[2012-06-15 18:42:37 -0400] bluepojo: the box that you're installing 10 instances of an app to it
[2012-06-15 18:42:42 -0400] bluepojo: or if they're different boxes
[2012-06-15 18:42:46 -0400] Gurpartap: That's not my question mate
[2012-06-15 18:42:50 -0400] barefoot: no, just one data_bag with all of the unique info, then loop over the required info and write templates or something
[2012-06-15 18:43:38 -0400] bluepojo: or, you can use search to get all the boxes with that role and figure out which ports are currently being used and pick the next available one
[2012-06-15 18:43:50 -0400] bluepojo: same idea, mate.
[2012-06-15 18:44:03 -0400] Gurpartap: bluepojo: I have a separate database elsewhere, which keeps track of available ports on each server
[2012-06-15 18:44:14 -0400] bluepojo: then talk to the database and ask it
[2012-06-15 18:44:34 -0400] Gurpartap: What I'd like to do is, let this separate app that I have, send a call to chef to provision "instance with port x" on server y
[2012-06-15 18:45:19 -0400] Gurpartap: Man, I'm not looking to see which port is available. But make chef act on the port I have decided on
[2012-06-15 18:45:36 -0400] Gurpartap: Hence my query about "setting attribute for a cookbook, dynamically"
[2012-06-15 18:45:50 -0400] Gurpartap: Is Ohai related to this?
[2012-06-15 18:47:26 -0400] bluepojo: the app could write to the databag and have a map of nodes to port numbers, then, when the node runs chef-client, it picks up that value and uses it.
[2012-06-15 18:47:37 -0400] bluepojo: it's not a direct parameter
[2012-06-15 18:47:39 -0400] bluepojo: but it works
[2012-06-15 18:47:51 -0400] barefoot: or just use remote_file on a script that generates the info
[2012-06-15 18:48:03 -0400] barefoot: seems like you are overthinking it
[2012-06-15 18:48:15 -0400] bluepojo: unless there's a reason this 3rd party app needs to pick port numbers
[2012-06-15 18:48:25 -0400] bluepojo: I'd just have it autodetect what port it should use
[2012-06-15 18:49:14 -0400] bluepojo: it's not a great idea to make your infrastructure depend on an outside app to function at all.
[2012-06-15 18:52:10 -0400] Gurpartap: bluepojo: This app is what decides when and which instance to provision, hence the hierarchy.
[2012-06-15 18:52:47 -0400] Gurpartap: bluepojo: In other words, I'm trying to use chef to orchestrate my servers to provision my software service on demand
[2012-06-15 18:52:59 -0400] erikh: chef, powering botnets worldwide
[2012-06-15 18:53:18 -0400] leifmadsen: erikh: +1 :)
[2012-06-15 18:53:31 -0400] barefoot: hehe
[2012-06-15 18:53:47 -0400] leifmadsen: yo dawg, we heard you like to provision with chef, so we put some chef in your chef botnet
[2012-06-15 18:59:08 -0400] miketheman: that's what brought down aws, amiright?
[2012-06-15 18:59:37 -0400] geekbri: I just figured somebody tripped on a power cord
[2012-06-15 19:00:01 -0400] geekbri: maybe the same guy who brought down both routers during the great cloudpocalypse of 2011
[2012-06-15 19:00:25 -0400] miketheman: I think it was the janitor, finding somewhere to plug in the vacuum
[2012-06-15 19:00:36 -0400] geekbri: hey man, a data centers gotta be clean!
[2012-06-15 19:03:38 -0400] sivy: how do I delete chef's local cache so I can make sure that it gets the latest data from the platform?
[2012-06-15 19:04:23 -0400] miketheman: sivy: typically somewhere like /var/chef/cahce - see your /etc/client.rb for anything non-default
[2012-06-15 19:04:30 -0400] miketheman: sorry - /var/chef/cache
[2012-06-15 19:04:43 -0400] sivy: got it
[2012-06-15 19:06:07 -0400] nmistry: how do you use Mount to add a non device like proc / cgroup / tmpfs to fstab and mount it?
[2012-06-15 19:07:37 -0400] miketheman: nmistry: how is that different? the device name is foo, the fstype is bar
[2012-06-15 19:07:59 -0400] nmistry: Chef::Exceptions::Mount: Device cgroup does not exist
[2012-06-15 19:08:07 -0400] nmistry: Chef::Exceptions::Mount: Device proc does not exist
[2012-06-15 19:08:13 -0400] miketheman: aha
[2012-06-15 19:08:24 -0400] nmistry: they dont have a file on disk
[2012-06-15 19:08:59 -0400] nmistry:  /dev/proc and /dev/cgroup
[2012-06-15 19:09:47 -0400] nmistry: device "proc", fstype "proc" does not work, and gives me the above error
[2012-06-15 19:10:41 -0400] nmistry: ideas?
[2012-06-15 19:13:31 -0400] nmistry: maybe i pass in /dev/null
[2012-06-15 19:15:34 -0400] nmistry: nope
[2012-06-15 19:21:16 -0400] pwf: so i want people to be able to define a variable number of backup cron jobs with various parameters defined in attributes
[2012-06-15 19:21:45 -0400] pwf: i was just going to have a 'backups' attribute, which would be a dictionary of various backup plans to make into cron jobs
[2012-06-15 19:22:00 -0400] pwf: but i'm not sure how to clean up old cron jobs if they get removed from the attribute
[2012-06-15 19:22:21 -0400] pwf: how can i list the current cron jobs?
[2012-06-15 19:25:19 -0400] pwf: or am i doing this in just a horrible, backwards way
[2012-06-15 19:30:06 -0400] nmistry: no ideas, oh well.
[2012-06-15 19:31:07 -0400] tolland: ive made a bunch of changes to some cookbooks, what are my options for staged rollout? can i fix my prod boxes to some particular cookbook version, or am I looking at just shutting down chef-client on the prod boxes until I am happy to roll out?
[2012-06-15 19:31:27 -0400] chip-: tolland: Environments are the answer.
[2012-06-15 19:31:33 -0400] pwf: if you're using environments you can freeze them
[2012-06-15 19:31:53 -0400] pwf: i've moved away from using environments though, and have separate chef servers for my 'environments'
[2012-06-15 19:32:04 -0400] pwf: that way the new code isn't even on the same box
[2012-06-15 19:32:16 -0400] chip-: I love environments. They're great for so many things
[2012-06-15 19:32:41 -0400] chip-: global attribute storage, so roles can remain generic
[2012-06-15 19:32:54 -0400] tolland: chip-: really, i was sitting on the bog thinking the opposite, what indeed are they good for? (hence i need to learn some about environemnts)
[2012-06-15 19:32:56 -0400] chip-: instead of "projectMySQL" you can have a generic mysql role with all the attributes for that project stored in the environment
[2012-06-15 19:33:14 -0400] chip-: Lets you keep your roles very very generic in your design pattern, which is good
[2012-06-15 19:33:25 -0400] chip-: environments + tags can take care of your snowflake cases.
[2012-06-15 19:33:30 -0400] chip-: ("Beautiful Unique Snowflakes")
[2012-06-15 19:33:52 -0400] chip-: env
[2012-06-15 19:33:56 -0400] chip-: Gah sorry
[2012-06-15 19:34:06 -0400] tolland: are there any tools to generate reporting off tags?
[2012-06-15 19:34:30 -0400] chip-: environments also make great search boundaries (Find all nodes in this environment running MySQL slaves and auto configure a proxy in front of them)
[2012-06-15 19:34:44 -0400] chip-: and you can use them to do staged rollout of cookbooks.
[2012-06-15 19:35:13 -0400] chip-: Pin a version of a cookbook to an environment and then upload it with knife cookbook upload --freeze, and the cookbook remains frozen. The next person to upload has to increment or force-override
[2012-06-15 19:35:40 -0400] tolland: right, thats my use case right now. I have lots of changes to my tomcat cookbook, but I have to make sure it doesn't f... do anything adverse to the prod instances
[2012-06-15 19:35:42 -0400] chip-: In conclusion, Environments are a misunderstood and under-utilized but completely awesome part of Chef and you should use them.
[2012-06-15 19:36:02 -0400] pwf: the only reason i don't like environments is you can't have versioned roles
[2012-06-15 19:36:05 -0400] chip-: The only thing I don't like is that I feel the implementation of per-environment run lists is inelegant.
[2012-06-15 19:36:14 -0400] pwf: someone has already fucked something up by updating a role here
[2012-06-15 19:36:50 -0400] chip-: pwf: Per-environment run lists in the roles, and keep non-default attributes out of roles and put them in environments.
[2012-06-15 19:37:23 -0400] chip-: Always use knife foo from file instead of knife foo edit, keep your roles as json docs in the chef-repo, and you've got versioned roles
[2012-06-15 19:37:35 -0400] miah: yup
[2012-06-15 19:37:37 -0400] chip-: although I agree versioned roles that could be frozen similar to the cookbooks would be a welcome feature
[2012-06-15 19:38:17 -0400] miah: i dont think that roles really need a 'version'. the problem is mostly one around workflow.
[2012-06-15 19:38:24 -0400] chip-: (seriously I wish there were a way on the server side to disable "knife foo edit"
[2012-06-15 19:38:44 -0400] chip-: also, if you've identified a problem with enforcing Chef workflows, Etsy probably wrote a knife plugin that fixes it already
[2012-06-15 19:38:47 -0400] chip-: not even making this up.
[2012-06-15 19:39:22 -0400] jhayden: anyone up for a knife ec2 server list question?
[2012-06-15 19:39:40 -0400] miah: knife spork = ftw
[2012-06-15 19:40:07 -0400] chip-: jhayden: 'sup
[2012-06-15 19:40:27 -0400] chip-: Haven't had a chance to dig too much into spork but I got really excited about it at the conf
[2012-06-15 19:40:40 -0400] jhayden: knife client list works so I know com between my workstation and seever is ok
[2012-06-15 19:40:48 -0400] jhayden: when I issue knife ec2 server list
[2012-06-15 19:41:04 -0400] jhayden: i get ERROR: Excon::Errors::ProxyParseError: Proxy is invalid
[2012-06-15 19:41:13 -0400] jhayden: no clue
[2012-06-15 19:41:13 -0400] chip-: afaik knife ec2 server list doesn't actually talk to your chef server at all.
[2012-06-15 19:41:16 -0400] chip-: it goes straight to ec2
[2012-06-15 19:41:55 -0400] jhayden: checked my shell env and blanked out all proxy references
[2012-06-15 19:42:22 -0400] chip-: I've got knife-ec2 0.5.12, fog 1.3.1, chef 0.10.10
[2012-06-15 19:42:29 -0400] jhayden: do you know what port its trying to communicate over?
[2012-06-15 19:42:47 -0400] chip-: I think just 80 & 443.
[2012-06-15 19:43:26 -0400] jhayden: I've got the same versions
[2012-06-15 19:43:27 -0400] chip-: you have knife[:aws_access_key_id]  and knife[:aws_secret_access_key] defined in your .chef/knife.rb file?
[2012-06-15 19:43:34 -0400] jhayden: yes
[2012-06-15 19:44:08 -0400] chip-: Workin' over here, even for machines in 1b.
[2012-06-15 19:44:15 -0400] chip-: (from osx)
[2012-06-15 19:44:34 -0400] jhayden: ok, freaked company has ANOTHER effen proxy I don't know about!
[2012-06-15 19:44:36 -0400] jhayden: ;-)
[2012-06-15 19:44:42 -0400] chip-: gg
[2012-06-15 19:45:39 -0400] jhayden: ok, thx I think I may call it an afternoon
[2012-06-15 19:51:49 -0400] jhayden: found it!
[2012-06-15 19:52:01 -0400] jhayden: same set up as you chip
[2012-06-15 19:52:36 -0400] jhayden: even though I exported http_proxy="", my system some how still thought it had a proxy
[2012-06-15 19:53:10 -0400] jhayden: I edited .bash_profile and commented out the proxy defs
[2012-06-15 19:53:22 -0400] jhayden: closed the shell and opened a new one
[2012-06-15 19:53:28 -0400] jhayden: and voila, it worked
[2012-06-15 19:54:25 -0400] chip-: excellent.
[2012-06-15 19:55:18 -0400] jhayden: switching between environments to avoid proxies gets very confusing
[2012-06-15 20:05:57 -0400] sivy: if i'm having issues with a chef run can I safely rm -fr /var/cache/chef/cookbooks/*
[2012-06-15 20:06:00 -0400] sivy: and re-run?
[2012-06-15 20:07:47 -0400] tolland: i was previously using environment to store my region or datacentre
[2012-06-15 20:08:38 -0400] tolland: but it seems that as its the only place to freeze the version, that it is required
[2012-06-15 20:09:41 -0400] tolland: do I end up with development-AZ1 and production-AZ1 etc?, or is there a more appropriate structure/attribute for those values?
[2012-06-15 20:27:10 -0400] gpapilion: ss
[2012-06-15 20:27:56 -0400] geekbri: STATE  Recv-Q Send-Q Local Address:port Peer Address:Port
[2012-06-15 21:15:47 -0400] vindy: If one of the readmes says you need to set something like node['users'] = ['hsolo']
[2012-06-15 21:15:55 -0400] vindy: Does that go in a recipe or can it go into a role?
[2012-06-15 21:18:43 -0400] mattray: vindy: role is good
[2012-06-15 21:19:23 -0400] vindy: @mattray thanks.  Would you have an example of how this would look in the role file?
[2012-06-15 21:20:16 -0400] mattray: vindy: https://github.com/mattray/chef-fundamentals-repo/blob/master/roles/users.rb#L8
[2012-06-15 21:21:05 -0400] vindy: Thanks.  Looks like you're using the opscode users cookbook.  I've been trying to get fnichol's user one working.
[2012-06-15 21:21:31 -0400] mattray: oh yeah
[2012-06-15 21:21:39 -0400] mattray: that was just an example I grabbed, coincidence
[2012-06-15 21:25:14 -0400] vindy: @mattray, so something like https://gist.github.com/2938775 would do what I'm wanting for his?
[2012-06-15 21:26:47 -0400] mattray: vindy: drop the node, it's implicit. Like this: https://gist.github.com/2938778
[2012-06-15 21:29:12 -0400] vindy: Hrm.  Still no luck actually getting it to add the user.
[2012-06-15 21:33:07 -0400] vindy: Thanks @mattray I'll keep messing with it for a bit
[2012-06-15 21:49:49 -0400] mrRobinson: anyone know how i can take this: knife exec -E 'nodes.all { |n| n.delete("some_command_complete"); n.save() }'
[2012-06-15 21:49:49 -0400] mrRobinson: and have it apply to just one node i specify instead of going through all nodes?
[2012-06-15 22:16:23 -0400] tolland: jpackage appears to be broken for centos 6.2, but the tomcat recipe seems to depend on it
[2012-06-15 22:54:29 -0400] littleidea: if you do a search from a node, do the results include that node?
[2012-06-15 23:01:53 -0400] Mithrandir: littleidea: yes
[2012-06-15 23:02:10 -0400] Mithrandir: well, if you search for something where the current node is part of the result set, obviously.
[2012-06-15 23:02:27 -0400] Mithrandir: if your node is called a and you search for nodes named b, it won't be there. :-)
[2012-06-15 23:03:27 -0400] littleidea: so is code like this going to add the server twice? once as the localhost, once as the fqdn?
[2012-06-15 23:03:31 -0400] littleidea: servers = []
[2012-06-15 23:03:32 -0400] littleidea: if node[:recipes].include? "foo"
[2012-06-15 23:03:32 -0400] littleidea:   servers << "localhost"
[2012-06-15 23:03:32 -0400] littleidea: else
[2012-06-15 23:03:32 -0400] littleidea:   search(:node, 'recipes:"foo"') do |server|
[2012-06-15 23:03:33 -0400] littleidea:     servers << server["fqdn"]
[2012-06-15 23:03:33 -0400] littleidea:   end
[2012-06-15 23:03:33 -0400] littleidea: end
[2012-06-15 23:03:46 -0400] Mithrandir: looks like it
[2012-06-15 23:04:12 -0400] littleidea: super
