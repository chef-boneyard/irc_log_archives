[2012-06-06 00:43:50 -0400] excalq: Using deploy resource's "restart_command" I want to pass an ENV while I run that command, "FOO=true /etc/init.d/unicorn restart" won't work though... (tries to actually run a command "FOO..."
[2012-06-06 00:48:02 -0400] excalq: nvm, put the ENV in the /etc/init.d script
[2012-06-06 01:45:02 -0400] flaccid_: jtimberman or anyone.. i'm looking at http://community.opscode.com/cookbooks/django but not seeing a link to its source home. i'd like to clarify that please
[2012-06-06 01:46:16 -0400] flaccid_: its not in https://github.com/opscode-cookbooks/
[2012-06-06 01:48:24 -0400] miah: iirc, you can just use the application cookbook
[2012-06-06 01:48:26 -0400] flaccid_: not in https://github.com/opscode/cookbooks/ either. has this been deprecated?
[2012-06-06 01:48:49 -0400] miah: https://github.com/opscode-cookbooks/application
[2012-06-06 01:49:02 -0400] miah: it sets up django with gunicorn
[2012-06-06 01:51:34 -0400] flaccid_: k thanks, but whats happening with the existing django cookbook? its src is not even findable
[2012-06-06 01:59:00 -0400] miah: deprecated maybe?
[2012-06-06 01:59:31 -0400] flaccid_: thats what it looks like
[2012-06-06 02:11:36 -0400] jtimberman: flaccid_: yeah that is one that we deprecated months ago
[2012-06-06 02:12:02 -0400] flaccid_: k thanks, would be cool if you could note that on the cookbooks site. just use application cookbook per miah ?
[2012-06-06 02:12:23 -0400] flaccid_: in my case its just meant to be the most simple available community chef solution so to speak
[2012-06-06 03:19:12 -0400] amagee: hey, just wondering what's considered best practice for copying ssl certificates to new nodes being setup by chef?
[2012-06-06 03:20:15 -0400] yfeldblum: scp?
[2012-06-06 03:22:17 -0400] amagee: in a recipe? or outside of chef?
[2012-06-06 03:22:52 -0400] miah: amagee: https://github.com/atomic-penguin/cookbook-certificate
[2012-06-06 03:23:30 -0400] amagee: ah yeah, i was thinking of something like that
[2012-06-06 03:26:28 -0400] amagee: thanks!
[2012-06-06 03:28:13 -0400] flaccid_: in the application cookbook readme, it says "The following cookbooks are available at this time:" application_java etc. where are these are is it an error?
[2012-06-06 03:28:41 -0400] miah: i think that doc just needs some updates
[2012-06-06 03:29:40 -0400] flaccid_: yeah the example on shows rails and stuff
[2012-06-06 03:29:47 -0400] flaccid_: need to work out a django example shortly
[2012-06-06 03:30:05 -0400] miah: ya
[2012-06-06 03:30:17 -0400] miah: i am heading home soon, i might be able to help in a hour or two
[2012-06-06 03:30:55 -0400] flaccid_: kkk thanks miah
[2012-06-06 04:20:33 -0400] rayrod2030: anybody have a good ubuntu 12.04 bootstrap template?
[2012-06-06 04:51:11 -0400] rayrod2030: anybody have issues with the ubuntu repos in the precise aws ami?
[2012-06-06 04:52:35 -0400] flaccid_: nope
[2012-06-06 04:53:00 -0400] flaccid_: i think i'm booting another one of those now, hmm probably will use rs mirrors though not ubuntus..
[2012-06-06 05:00:38 -0400] rayrod2030: found this thread: https://forums.aws.amazon.com/thread.jspa?threadID=95616
[2012-06-06 05:00:42 -0400] rayrod2030: issue is still happening
[2012-06-06 05:02:05 -0400] flaccid_: not good. i'd just use rs mirror
[2012-06-06 05:05:54 -0400] flaccid_: rayrod2030: http://cf-mirror.rightscale.com/ubuntu_daily/latest
[2012-06-06 05:06:31 -0400] rayrod2030: thanks man
[2012-06-06 05:06:44 -0400] flaccid_: np
[2012-06-06 05:11:40 -0400] amagee: hey i've made a new chef server and have been trying to get my workstation to be a client on it.. i've got knife working fine, but i'm running into trouble getting chef-client working: http://dpaste.com/755840/
[2012-06-06 05:12:48 -0400] amagee: i might be confused about knife clients vs chef clients still
[2012-06-06 05:13:25 -0400] rayrod2030: knife uses a client key to talk to chef-server.
[2012-06-06 05:13:38 -0400] rayrod2030: chef-client uses a client key to talk to chef-server as well
[2012-06-06 05:13:45 -0400] amagee: and it's the same key?
[2012-06-06 05:13:53 -0400] rayrod2030: not usually no
[2012-06-06 05:14:12 -0400] rayrod2030: you usually create a client key for yourself that you use with knife.
[2012-06-06 05:14:25 -0400] rayrod2030: you create that key on your chef server and then copy it over to your workstation for use with knife.
[2012-06-06 05:14:47 -0400] amagee: yes
[2012-06-06 05:15:24 -0400] amagee: oh i think i see what's happened
[2012-06-06 05:15:38 -0400] amagee: so i should have deleted /etc/chef/client.pem and created a new one with knife configure client
[2012-06-06 05:16:04 -0400] amagee: rather than thinking that /etc/chef/client.pem should have been the client key created on the server?
[2012-06-06 05:16:55 -0400] amagee: ah it's created on the initial run of chef-client, not by knife configure; that makes even more sense
[2012-06-06 05:17:04 -0400] rayrod2030: right
[2012-06-06 05:17:12 -0400] rayrod2030: because it's a unique key for your node.
[2012-06-06 05:17:37 -0400] rayrod2030: and it's created using the node name
[2012-06-06 05:18:08 -0400] rayrod2030: so yes the bootstrap process and the initial chef-client run puts it in /etc/chef
[2012-06-06 05:19:56 -0400] amagee: got it
[2012-06-06 05:19:58 -0400] amagee: thanks!
[2012-06-06 05:20:42 -0400] justsee: anyone used the new application cookbooks, such as application_rails? There don't appear to be any examples or code to actually create databases.
[2012-06-06 05:20:59 -0400] justsee: sorry that should be application_ruby
[2012-06-06 05:21:54 -0400] justsee: I see an old database cookbook with methods, so I suppose I could use that to add db creation for apps. I just expected the database block in a rails config app would handle creation as well, but apparently not.
[2012-06-06 05:27:38 -0400] flaccid_: justsee: i brought this issue up here just earlier
[2012-06-06 05:30:43 -0400] justsee: flaccid_: oh right, will have a run through the logs. I'm thinking for an app cookbook I'll just define an initial db creation method using database cookbook for now.
[2012-06-06 05:31:09 -0400] flaccid_: i'm not sure if application is meant to cover database stuff, but its readme needs an update
[2012-06-06 05:38:48 -0400] jtimberman: justsee: you use a database parameter under the rails sub-resource
[2012-06-06 05:38:58 -0400] jtimberman: justsee: i have some code, give me a moment to gist it
[2012-06-06 05:40:41 -0400] jtimberman: justsee: flaccid_: found a gist, https://gist.github.com/2784164
[2012-06-06 05:40:56 -0400] flaccid_: thanks y!
[2012-06-06 05:41:00 -0400] flaccid_: *y0
[2012-06-06 05:41:16 -0400] flaccid_: still need a django example though :)
[2012-06-06 05:42:51 -0400] justsee: jtimberman: oh, I've already got an app deploying fine based on the new syntax. Afaik the database block generates the database.yml, but there's nothing to create user/database for my PostgreSQL db.
[2012-06-06 05:43:19 -0400] justsee: So I'm assuming I'll just have to create a separate block in the bespoke app recipe to do the user / db creation.
[2012-06-06 05:51:59 -0400] jtimberman: justsee: oh that
[2012-06-06 05:52:00 -0400] jtimberman: justsee: yeah
[2012-06-06 05:52:11 -0400] jtimberman: justsee: put the database creation as another thing your recipe does after the deploy
[2012-06-06 05:52:26 -0400] jtimberman: justsee: the database cookbook's resources may be helpful if you're using a supported database.
[2012-06-06 05:54:41 -0400] rayrod2030: flaccid_ when I try to use those right scale mirrors I get an error Err http://ec2-us-east-mirror.rightscale.com precise/universe Sources 404  Not Found [IP: 174.129.253.100 80]
[2012-06-06 05:56:45 -0400] justsee: jtimberman: ah thanks, wasn't entirely clear from the READMEs / examples. Either way nice to have the new app deployment approach available!
[2012-06-06 05:58:39 -0400] flaccid_: rayrod2030: looks like you put in the wrong url
[2012-06-06 06:00:54 -0400] rayrod2030: flaccid_: same issue: Err http://cf-mirror.rightscale.com precise/main Sources
[2012-06-06 06:00:54 -0400] rayrod2030:   404  Not Found [IP: 204.246.169.202 80]
[2012-06-06 06:01:08 -0400] flaccid_: are you using entries like deb http://cf-mirror.rightscale.com/ubuntu_daily/latest precise main restricted multiverse universe ?
[2012-06-06 06:01:19 -0400] rayrod2030: my source.list file has entries like this: deb http://cf-mirror.rightscale.com/ubuntu_daily/latest/ precise main
[2012-06-06 06:02:07 -0400] flaccid_: deb http://cf-mirror.rightscale.com/ubuntu_daily/latest precise main
[2012-06-06 06:02:20 -0400] flaccid_: i don't think we mirror the source pkgs though. but this works fine for me..
[2012-06-06 06:03:02 -0400] rayrod2030: flaccid_: that was it.  Thanks!
[2012-06-06 06:03:08 -0400] flaccid_: coolio
[2012-06-06 06:03:51 -0400] rayrod2030: you work for rightscale/
[2012-06-06 06:03:52 -0400] rayrod2030: ?
[2012-06-06 06:04:16 -0400] flaccid_: yes
[2012-06-06 06:04:51 -0400] rayrod2030: ah cool.  the company I work for has a few of our clients set up on right scale.
[2012-06-06 06:05:12 -0400] flaccid_: nice
[2012-06-06 06:10:45 -0400] flaccid_: jtimberman: do you think i should post to the mailing list regarding my ohai reload issue where it doesn't reload? the log output clearly shows it reloaded before referencing node['fqdn'] which shows the old hostname still
[2012-06-06 06:10:56 -0400] flaccid_: or maybe straight but it
[2012-06-06 06:10:58 -0400] flaccid_: *bug
[2012-06-06 06:18:38 -0400] rayrod2030: what's the best way to go about setting the rs mirror as my default?  bootstrap, apt cookbook or template?
[2012-06-06 06:18:48 -0400] rayrod2030: or custom ami?
[2012-06-06 06:18:54 -0400] flaccid_: using rightscale :)
[2012-06-06 06:19:14 -0400] flaccid_: but i guess you could set it up with apt cookbook
[2012-06-06 06:33:13 -0400] jtimberman: flaccid_: yeah, post to the list please, i'm off to sleep :)
[2012-06-06 06:33:20 -0400] jtimberman: cheers!
[2012-06-06 06:33:30 -0400] flaccid_: thanks y0; gnight
[2012-06-06 06:56:39 -0400] BryanWB_: ohai chefs!
[2012-06-06 07:06:18 -0400] flaccid_: iaho
[2012-06-06 07:08:10 -0400] BryanWB_: flaccid_: say hi to caryp for me at rightscale, nice guy
[2012-06-06 07:08:36 -0400] flaccid_: will pass on now :)
[2012-06-06 07:09:46 -0400] flaccid_: good ol midnight pacific time, yesterday hehe
[2012-06-06 12:01:42 -0400] rgsteele: If one wishes to manage a symlink, but there's an existing directory which must be moved out of the way first, what's the recommended approach?  Use a script resource to handle everything?  Use a script resource to (re)move the directory prior to processing a link resource?  None of the above?
[2012-06-06 12:04:51 -0400] behemphi: Is this a one time operatoin?
[2012-06-06 12:06:25 -0400] behemphi: As a general rule I shy away from writing script b/c error handling and such becomes alot less useful.  So my knee jerk reaction is to say, use knife ssh or knife exec to move the directory.  Then include the link resource in the recipe that will run repeatedly over time
[2012-06-06 12:07:57 -0400] rgsteele: behemphi: Yes, should be one-time
[2012-06-06 12:08:16 -0400] BryanWB_: behemphi: yo!
[2012-06-06 12:08:33 -0400] behemphi: @ByranWB_ oy!
[2012-06-06 12:08:56 -0400] BryanWB_: behemphi: o/
[2012-06-06 12:10:56 -0400] behemphi: @rgsteele, so this is a problem I think about occasionally b/c I only run the client for a new software release.  So, occasionally I have some sort of maintenance task to perform (such as you describe).  So I sort it out so that my recipe is what I want to happen ever after and I make it as "chefy" as possible  (avoid script, bash etc).  I then work out what needs to be done before and after the release on a one-time basis and 
[2012-06-06 12:11:28 -0400] behemphi: I hope that helps a bit.  I would be keen to hear what the gurus have to ask about your situation and suggest as well!
[2012-06-06 12:12:13 -0400] BryanWB_: behemphi: i just use knife ssh if its truly a one-time task, like to clean up a mistake or previous action made by me
[2012-06-06 13:07:05 -0400] hippieha`: ping
[2012-06-06 13:07:14 -0400] behemphi: pong?
[2012-06-06 13:15:36 -0400] hippiehacker: ohai chefs, wasn't Venus was beautiful and she strode past the great fire in the sky?
[2012-06-06 13:18:41 -0400] BryanWB_: hippiehacker: hey buddy!
[2012-06-06 13:18:52 -0400] hippiehacker: BryanWB_: mornin!
[2012-06-06 13:19:09 -0400] BryanWB_: behemphi: dude ,  am a little hurt u didn't return my high-five ;p
[2012-06-06 13:26:34 -0400] yfeldblum:  please, none of these latin names
[2012-06-06 13:43:47 -0400] BryanWB_: y, lets keep it greek ;)
[2012-06-06 13:55:48 -0400] CharlieSu: hippiehacker: yes Venus was awesome.
[2012-06-06 13:56:07 -0400] CharlieSu: hippiehacker: did you get any pictures?  I setup a pinhole projector at my house and was able to see it very well.
[2012-06-06 14:39:14 -0400] CharlieSu: If I'm using the Omnibus installer but want to pin to a particular version say '0.10.8' can I just edit the 'release_version=' line of http://s3.amazonaws.com/opscode-full-stack/install.sh ?
[2012-06-06 14:42:47 -0400] zts: CharlieSu: you can do "install.sh -v 0.10.8"
[2012-06-06 14:46:45 -0400] CharlieSu: zts: interesting..  When I do my knife-ec2 bootstrap I have a line in a spinner script that looks like this   '--template-file #{ENV['CHEF_HOME']}/templates/sledgehammer_app_omnibus.erb \'    How can I add that param there?
[2012-06-06 14:48:19 -0400] CharlieSu: zts: looks like I can set knife_config[:bootstrap_version]
[2012-06-06 14:50:58 -0400] joshuag: is there any more documentation on using the new application_ruby cookbook other than its readme?
[2012-06-06 14:51:51 -0400] ctrabold: Hi! Is there a limit for OHAI data on the server side (open source chef-server, not hosted chef, with nginx as proxy)? I get 500 Internal Server Error but Nginx doesn't complain. So I (wild) guess it's merb that's complaining?
[2012-06-06 14:53:52 -0400] zts: CharlieSu: yeah, that (or --bootstrap-version) should work for knife bootstrap - I'd imagine it'll work for ec2 bootstrap too
[2012-06-06 14:59:07 -0400] ctrabold: failed-run-data.json is 538K
[2012-06-06 15:01:02 -0400] phantasm66: hello, can a service resource have multiple 'subscribe' lines?
[2012-06-06 15:01:10 -0400] phantasm66: ie: subscribes :reload, resources("cookbook_file[some_file]", "cookbook_file[some_other_file]") :delayed
[2012-06-06 15:01:16 -0400] phantasm66: and then another like so:
[2012-06-06 15:01:52 -0400] phantasm66: subscribes :restart, resources("package[some_pkg]") :delayed
[2012-06-06 15:02:34 -0400] yfeldblum: phantasm66, yes
[2012-06-06 15:02:43 -0400] phantasm66: cool.. thanks
[2012-06-06 15:03:18 -0400] yfeldblum: phantasm66, i believe Chef::Resource#subscribes just adds a notification to the other resource
[2012-06-06 15:04:28 -0400] myusuf3: hi everyone
[2012-06-06 15:04:48 -0400] myusuf3: I currently have a reciepe that I use for install system level python packages
[2012-06-06 15:04:53 -0400] myusuf3: using package resource
[2012-06-06 15:04:55 -0400] myusuf3: my question is
[2012-06-06 15:05:31 -0400] myusuf3: I want to be able to upgrade packages and if i am unable to install said package
[2012-06-06 15:05:54 -0400] rdz: hi all. i'm having a hard time getting started. I have chef-server up and running and would like to run the client on a different node. however, i don't understand which key file to copy from server to the node. any help?
[2012-06-06 15:06:04 -0400] kamabe_: is there a standard for using dashes or underscores in LWRP resources?
[2012-06-06 15:07:11 -0400] rdz: the documentation says: "After installation, you should move your validation client's private key onto the node and copy it to /etc/chef/validation.pem." can someone parse that for me?
[2012-06-06 15:10:36 -0400] rdz: got it.. server:/etc/chef/validation.pem -> node:/etc/chef/validation.pem
[2012-06-06 15:15:17 -0400] agentgonzo: Hi all.
[2012-06-06 15:15:42 -0400] agentgonzo: Is there any way for a chef recipe/attributes to determine ubuntu versions (ie set a property to be one value for 10.04 and another for 11.10)?
[2012-06-06 15:16:22 -0400] agentgonzo: I've found the bits to set it based on OS but that seems to just distinguish between ubuntu/redhat etc and not between ubuntu versions.
[2012-06-06 15:17:10 -0400] paulmooring: agentgonzo: did you check the platform_version attribute?
[2012-06-06 15:19:54 -0400] ctrabold: Solution: it was a encoding problem (had funky chars in ohai data)
[2012-06-06 15:21:20 -0400] paulmooring: node['platform_version'] gives back 12.04 for me on precise, also node['lsb'] has id, codename, release, and description as sub-attributes if you want more than just that
[2012-06-06 15:21:39 -0400] agentgonzo: paulmooring - I hadn't found that (docs aren't exactly great) - it looks like it's what I'm after.
[2012-06-06 15:21:44 -0400] agentgonzo: Thanks. I'll give it a try
[2012-06-06 15:22:14 -0400] paulmooring: agentgonzo: fyi, you can run `ohai` at the command line and grep for what you're looking for most of the time
[2012-06-06 15:23:10 -0400] sascha_d: you can also use the key you're looking for as an argument
[2012-06-06 15:23:30 -0400] sascha_d: ohai platform_version should give you just that
[2012-06-06 15:23:45 -0400] paulmooring: sascha_d: his problem was he didn't know the key :)
[2012-06-06 15:23:50 -0400] sascha_d: o :)
[2012-06-06 15:24:05 -0400] sascha_d: yes I've spent long times browsing node data
[2012-06-06 15:24:41 -0400] sascha_d: I pipe ohai through less, often
[2012-06-06 15:25:54 -0400] paulmooring: I pipe it through more with the sole purpose of 1 upping you
[2012-06-06 15:26:48 -0400] paulmooring: which is ironic because less has more than more
[2012-06-06 15:35:03 -0400] rayrod2030: the hedgehog's chef cookbooks.  Reliable?
[2012-06-06 15:37:32 -0400] lflux: ohai chefs
[2012-06-06 15:37:42 -0400] CharlieSu: ohai
[2012-06-06 15:37:48 -0400] lflux: how do I access the http_proxy configuration set in client.rb inside a recipe
[2012-06-06 15:38:06 -0400] lflux: Trying to use the python cookbook, but it doesn't use the proxy configuration set for chef.
[2012-06-06 15:38:48 -0400] CharlieSu: lflux: knife_config[:boostrap_proxy]   ?
[2012-06-06 15:39:21 -0400] paulmooring: lflux: you might need to verify this but Chef::Config['http_proxy'] I think
[2012-06-06 15:39:39 -0400] lflux: CharlieSu: it's not on the knife side, it's on the client side
[2012-06-06 15:40:00 -0400] lflux: i e the node needs to use a proxy to download stuff, which is set in client.rb (via knife bootstrap --proxy)
[2012-06-06 15:40:33 -0400] lflux: paulmooring: i'll give it a go
[2012-06-06 15:41:05 -0400] UForgotten: so in a recipe, I want to do something depending on an ohai attribute
[2012-06-06 15:41:27 -0400] paulmooring: if that's not it you can just run Chef::Config in a shed session and look at which option you're looking for
[2012-06-06 15:41:43 -0400] lflux: paulmooring: I could do that as well.
[2012-06-06 15:41:53 -0400] lflux: been a few weeks since I've worked on my cheffery
[2012-06-06 15:42:34 -0400] UForgotten: I have tried if :node['machine'] == "i686" and if node['machine'] == "i686" then but neither things get done.  ohai shows machine is "i686", what am I doing wrong?
[2012-06-06 15:44:37 -0400] paulmooring: UForgotten: nodep'kernel']['machine']
[2012-06-06 15:44:41 -0400] mwagner72: Anyone in MN doing Chef consulting?
[2012-06-06 15:45:01 -0400] paulmooring: or node['kernel']['machine']
[2012-06-06 15:45:21 -0400] UForgotten: paulmooring: thanks.
[2012-06-06 15:45:31 -0400] paulmooring: welcome
[2012-06-06 15:47:04 -0400] ska: Is there a shorewall cookbook for debian?
[2012-06-06 15:50:28 -0400] paulmooring: ska: looks like the shore wall cookbook I can find only supports centos right now
[2012-06-06 15:52:39 -0400] ska: ya, me too. Couldnt find other.
[2012-06-06 15:52:46 -0400] ska: Is it hard to modify?
[2012-06-06 15:53:08 -0400] paulmooring: ska: I wouldn't think so but I haven't used that cookbook before
[2012-06-06 15:54:56 -0400] paulmooring: ska: I think the main reason for that is the shorewall package
[2012-06-06 16:05:46 -0400] ILessThanThreeU: NERF
[2012-06-06 16:14:17 -0400] ssd7: Ohai Chefs!
[2012-06-06 16:14:31 -0400] rayrod2030: hai
[2012-06-06 16:16:08 -0400] rayrod2030: http://www.dweebist.com/wp-content/uploads/2009/07/ohai-480x420.jpg
[2012-06-06 16:57:57 -0400] joshuag: hi
[2012-06-06 16:58:13 -0400] joshuag: any ideas on this when using application_ruby: NameError: uninitialized constant Chef::Resource::ApplicationBase
[2012-06-06 17:00:38 -0400] ssd7: Hrm, so I have an idea of what it might be.  In the log do you definitely see the application cookbook also being synced?
[2012-06-06 17:01:16 -0400] ssd7: (Chef::Resource::Application lives in the application cookbook which the application_ruby cookbook should depend on)
[2012-06-06 17:01:51 -0400] ssd7: joshuag: ^
[2012-06-06 17:01:51 -0400] joshuag: yeah i've included that one also in the metadata.rb
[2012-06-06 17:02:01 -0400] joshuag: checking logs
[2012-06-06 17:02:05 -0400] rocket: what does this error mean when I am trying to include a recipe in a providor
[2012-06-06 17:02:13 -0400] rocket:  Cannot find a resource for include_recipe  ??
[2012-06-06 17:02:23 -0400] joshuag: yeah so from the logs:
[2012-06-06 17:02:32 -0400] joshuag: [Wed, 06 Jun 2012 17:41:03 +0200] INFO: Storing updated cookbooks/application/recipes/default.rb in the cache.
[2012-06-06 17:02:34 -0400] joshuag: etc...
[2012-06-06 17:02:37 -0400] rocket: I have added the dependant cookbook in the metadata.rb file and uploaded it
[2012-06-06 17:03:02 -0400] pwf: so we're gonna have each dev use their own 'organization' for testing cookbooks and such on
[2012-06-06 17:03:15 -0400] ssd7: rocket: Mind posting the log and the snippet of the recipe that is failing somewhere like gist.github.com?
[2012-06-06 17:03:15 -0400] pwf: but how do we easily re-use nodes between organizations
[2012-06-06 17:03:17 -0400] rocket:  include_recipe "rabbitmq"    thats the offending line
[2012-06-06 17:03:32 -0400] pwf: like how can one dev machine be registered as a client on different organizations
[2012-06-06 17:03:59 -0400] pwf: just backup the client key before bootstrapping it into the new org?
[2012-06-06 17:04:05 -0400] ssd7: joshuag: So, I'm wondering if it is related to this: http://tickets.opscode.com/browse/CHEF-2903  I think the same problem will apply to libraries
[2012-06-06 17:04:08 -0400] pwf: then swap it out when we want to go back?
[2012-06-06 17:05:51 -0400] joshuag: ssd7: best idea for a workaround?
[2012-06-06 17:06:15 -0400] ssd7: pwf: I'm not sure I /completely/ understand your use case.  But the way I've seen lots of people handle multiple orgs is either having different cookbook repos for each org with the relavent config or use an environment variable and then write your knife.rb to look at that environment variable
[2012-06-06 17:06:27 -0400] rocket: ssd7: https://gist.github.com/2883325
[2012-06-06 17:06:52 -0400] pwf: yeah the knife stuff all works great
[2012-06-06 17:07:06 -0400] pwf: but say i bootstrap a dev machine using my own organization
[2012-06-06 17:07:07 -0400] withnale: when loading a databag from a json file, is there any way to have multiple ids from the same file?
[2012-06-06 17:07:13 -0400] ssd7: joshuag: Probably best to confirm what is going on first.  Perhaps by adding some "puts 'Now loading application/library/default.rb'" type lines in the various library files and seeing the order they are loading in
[2012-06-06 17:07:15 -0400] pwf: and then another dev wants to use it wiht his organization
[2012-06-06 17:07:21 -0400] joshuag: ok
[2012-06-06 17:07:28 -0400] pwf: when he bootstraps it, my key will get wiped out right?
[2012-06-06 17:08:00 -0400] pwf: so when i want to use it with my organization again, i'll have to delete my node/client and bootstrap again?
[2012-06-06 17:09:07 -0400] ska: paulmooring: your last statement got cut off, i think.
[2012-06-06 17:09:08 -0400] ssd7: pwf: Hmm.  So there are some ways you could probably get around it by having multiple configs&keys on the server side as well
[2012-06-06 17:09:33 -0400] joshuag: ssd7: in the logs it's showing application_ruby loading then application
[2012-06-06 17:10:06 -0400] paulmooring: ska: the shore wall package includes the yum::peel recipe, that needs to be cleaned up with a platform check
[2012-06-06 17:10:23 -0400] paulmooring: I didn't see much distro-specific stuff in there
[2012-06-06 17:10:31 -0400] ssd7: joshuag: Yeah, I'm guessing that is the problem then.  I'm not very familiar with those cookbooks so I don't have the work around off hand.  Would you mind filing a COOK bug?
[2012-06-06 17:10:56 -0400] joshuag: ssd7: ok. yeah
[2012-06-06 17:12:16 -0400] ssd7: rocket: Ahh, I see.  I haven't ever tried to use include_recipe from there.  My hunch is that that function isn't available from inside a LWRP provider like that.
[2012-06-06 17:12:37 -0400] rocket: thats what I am thinking now too .. it would be nice to be able to have it there though :)
[2012-06-06 17:12:56 -0400] rocket: I can work around it .. trying to move it to the recipe itself ..
[2012-06-06 17:13:49 -0400] spox: rocket: node.include_recipe 'fubar'
[2012-06-06 17:14:06 -0400] spox: probably in the load_current_resource
[2012-06-06 17:14:51 -0400] ssd7: yeah, you can probably also just include the right mixin
[2012-06-06 17:15:27 -0400] ssd7: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/language_include_recipe.rb
[2012-06-06 17:15:54 -0400] rocket: now I am lost .. I still pretty new to this .. :p
[2012-06-06 17:17:34 -0400] yfeldblum: pwf, what are you trying to accomplish?
[2012-06-06 17:17:52 -0400] pwf: i pretty much answered my own question...
[2012-06-06 17:18:01 -0400] pwf: not sure how to describe it another way
[2012-06-06 17:18:14 -0400] pwf: i guess i will try though
[2012-06-06 17:18:31 -0400] yfeldblum: pwf, also, whatever you were describing, i'm not sure i understood the details exactly, but it doesn't sound like a good idea to me
[2012-06-06 17:18:39 -0400] pwf: so each dev has their own opscode organization for testing on, so they don't trample other dev cookbooks
[2012-06-06 17:18:44 -0400] pwf: and roles, etc
[2012-06-06 17:18:44 -0400] yfeldblum: pwf, why?
[2012-06-06 17:18:52 -0400] pwf: because people were breaking things
[2012-06-06 17:18:59 -0400] yfeldblum: pwf, why not have a local copy of chef-server-api running?
[2012-06-06 17:19:20 -0400] yfeldblum: pwf, on devs' own workstations?
[2012-06-06 17:19:20 -0400] pwf: because it's easier to create an opscode account?
[2012-06-06 17:19:29 -0400] pwf: that was recommended to me yesterday
[2012-06-06 17:19:42 -0400] ska: paulmooring: thanks
[2012-06-06 17:19:48 -0400] pwf: either way, we have a set number of dev machines that we can use for testing
[2012-06-06 17:19:53 -0400] pwf: can't be easily virtualized
[2012-06-06 17:20:12 -0400] asmedrano: can i get chef-client not to run in intervals?
[2012-06-06 17:20:16 -0400] yfeldblum: pwf, that really constrains you ...
[2012-06-06 17:20:31 -0400] pwf: so when another dev needs to work with one of those machines, and it's associated with my local (or my opscode) organization
[2012-06-06 17:20:41 -0400] pwf: they can just bootstrap and override my client key right
[2012-06-06 17:20:49 -0400] pwf: and that will register the machine with their organization
[2012-06-06 17:20:59 -0400] pwf: if we need to move to local chef-server api that's no big deal
[2012-06-06 17:21:00 -0400] yfeldblum: pwf, why are there shared dev machines that are not devs' own workstations?
[2012-06-06 17:21:28 -0400] pwf: because they're macs, and try as i might i cannot get vagrant working well with osx
[2012-06-06 17:22:34 -0400] pwf: regardless, we have to share them, and we'll just have to delete nodes on our personal 'organizations' every time we switch
[2012-06-06 17:22:43 -0400] pwf: but that shouldn't really be an issue
[2012-06-06 17:23:02 -0400] ssd7: joshuag: I'm trying to work out a workaround, but I'm not sure it will pretty.
[2012-06-06 17:23:10 -0400] yfeldblum: pwf, ok, so that may be an issue, but it's a lot easier of an issue to solve than the one you're creating for yourself by destroying all sense of isolation
[2012-06-06 17:23:37 -0400] pwf: well before we were all using the same chef server
[2012-06-06 17:23:37 -0400] ssd7: rocket: My real advice would be that you probably want a design that avoids calling include_recipe from a provider.
[2012-06-06 17:23:42 -0400] pwf: so this is a lot more isolation than we had
[2012-06-06 17:24:00 -0400] pwf: for actual testing we're going to wipe the machines and start fresh
[2012-06-06 17:24:16 -0400] yfeldblum: pwf, that's true, but what you're thinking about is zero isolation like before but also more complexity and more room for problems to creep in
[2012-06-06 17:24:37 -0400] joshuag: ssd7: ok
[2012-06-06 17:25:03 -0400] yfeldblum: pwf, fix setting up vagrant on your macs - in the end, that will be many times simpler for everyone involved
[2012-06-06 17:25:29 -0400] pwf: vagrant works fine ON the macs, it's virtualizing os x that's the problem
[2012-06-06 17:25:40 -0400] geekbri: Are there any good docs out there for setting up a chef server in a redundant manner?
[2012-06-06 17:26:00 -0400] pwf: it kernel panics all the time
[2012-06-06 17:26:05 -0400] yfeldblum: pwf, ah ok, why do you need to virtualize os x? the application involved works only on os x?
[2012-06-06 17:26:11 -0400] pwf: yep
[2012-06-06 17:26:23 -0400] pwf: part of the project requirements
[2012-06-06 17:26:28 -0400] pwf: i'm certainly not happy with it
[2012-06-06 17:26:31 -0400] pwf: but that's the way it is
[2012-06-06 17:26:38 -0400] yfeldblum: pwf, do you really have to virtualize dev boxes?
[2012-06-06 17:27:02 -0400] pwf: no we don't, we're sharing the actual machines we have
[2012-06-06 17:27:14 -0400] pwf: for other servers, yeah we're virtualizing and it's super easy and awesome
[2012-06-06 17:27:24 -0400] yfeldblum: pwf, why not have devs dev on their own macs on the metal?
[2012-06-06 17:27:42 -0400] pwf: idk i guess i can ask purchasing, but we already have lots of macs
[2012-06-06 17:27:48 -0400] pwf: just slightly more devs than macs
[2012-06-06 17:27:59 -0400] yfeldblum: pwf, or they can pair :P
[2012-06-06 17:28:08 -0400] pwf: true
[2012-06-06 17:28:14 -0400] pwf: we actually haven't even run into this yet
[2012-06-06 17:28:16 -0400] pwf: i'm just thinking ahead
[2012-06-06 17:28:36 -0400] yfeldblum: pwf, ultimately what i'm saying is, if you do things the Wrong Way because you run into one roadblock, now you have two problems, not zero
[2012-06-06 17:29:54 -0400] yfeldblum: pwf, and what you were thinking of doing would have added complexity while lowering isolation (because a false sense of isolation is less isolation than no isolation at all)
[2012-06-06 17:31:08 -0400] yfeldblum: pwf, jfyi, i'm a fan of isolation ... there's a reason i wrote librarian-chef with a strong set of isolation guarantees built in ... so i may be prejudiced here :P
[2012-06-06 17:33:01 -0400] pwf: the only isolation missing is that devs will be using dev machines with different organizations occasionally
[2012-06-06 17:33:28 -0400] pwf: QA and production machines are stuck with our QA/production chef-server-api and hosted chef organization
[2012-06-06 17:35:45 -0400] yfeldblum: pwf, right, but that's the false sense of isolation that devs get ... it's isolation most of the time, when they remember, but not isolation when someone forgets to do something ... this system is really easy to break by anybody who had a bad date last night or whatnot, rather than being tolerant of innocent human failures
[2012-06-06 17:36:11 -0400] pwf: much better than the isolation we had sharing organizations
[2012-06-06 17:36:18 -0400] pwf: if i could get us our own dev machines, i would
[2012-06-06 17:36:25 -0400] pwf: but i think this is the best i can do with what we have
[2012-06-06 17:36:39 -0400] pwf: and right now we only have 3 people doing chef things and 4 dev servers
[2012-06-06 17:36:41 -0400] yfeldblum: pwf, maybe, but maybe not, because then nobody assumed that there was any isolation at all, so they would be more cognizant of what to do
[2012-06-06 17:36:45 -0400] pwf: so we probably won't run into this
[2012-06-06 17:46:40 -0400] pbogunovich: hello, does anyone know how to clear the cookbook cache on a chef server?
[2012-06-06 17:46:57 -0400] withnale: if I want to write a teeny/tiny helper ruby def in my cookbook, is it possible in a definitions/*.rb file?
[2012-06-06 17:48:34 -0400] ssd7: joshuag: still around?
[2012-06-06 17:48:47 -0400] joshuag: ssd7: yep stil here
[2012-06-06 17:50:43 -0400] ssd7: joshuag: Sorry, false alarm.  What I though might work doesn't seem too :(
[2012-06-06 17:51:34 -0400] joshuag: lol
[2012-06-06 17:51:35 -0400] joshuag: drat
[2012-06-06 17:51:46 -0400] joshuag: how come no one's seen this before?
[2012-06-06 17:52:00 -0400] ssd7: joshuag: Those cookbooks were only recently rewritten
[2012-06-06 17:52:27 -0400] joshuag: ssd7: yeah. that part's been fun since the beginning the docs are also 'light'
[2012-06-06 17:52:28 -0400] ssd7: also, I believe that in some versions of ruby application will pretty much always end up before applicatioN_ruby
[2012-06-06 17:53:03 -0400] ssd7: joshuag: are you on 1.8 or 1.9?
[2012-06-06 17:53:31 -0400] hoover_damm: CHEF-2903 is interesting... I never expected to see a Regression from CERT-2011-003 to do that
[2012-06-06 17:53:41 -0400] joshuag: ssd7: 1.9.3
[2012-06-06 17:53:42 -0400] hoover_damm: but I half expected it to change things
[2012-06-06 17:58:02 -0400] jelder: question regarding cookbook versions in opscode hosted chef
[2012-06-06 17:58:42 -0400] jelder: https://manage.opscode.com/cookbooks/java/ only lists 1.1.0
[2012-06-06 17:59:03 -0400] jelder: but the current is 1.5.0, and 1.1.0 can't install oracle's jvm
[2012-06-06 17:59:18 -0400] jelder: how do use a different version?
[2012-06-06 17:59:56 -0400] hoover_damm: jelder, grab it from cookbooks.opscode.com?
[2012-06-06 18:00:06 -0400] hoover_damm: jelder, github.com/opscode-cookbooks/ has the current cookbooks
[2012-06-06 18:00:07 -0400] pwf: gotta grab it from the site jelder: http://wiki.opscode.com/display/chef/Managing+Cookbooks+With+Knife#ManagingCookbooksWithKnife-CookbookSite
[2012-06-06 18:00:15 -0400] pwf: you can do it with knife
[2012-06-06 18:01:40 -0400] cooper: hi all.
[2012-06-06 18:01:43 -0400] cooper: how does one get into a situation where knife search does not seem to be telling the truth? :)
[2012-06-06 18:01:48 -0400] cooper: when i run knife search node "NOT role:base" 1 node comes back and it has role[base] as its run_list!
[2012-06-06 18:01:51 -0400] cooper: https://gist.github.com/2883621
[2012-06-06 18:02:05 -0400] matschaffer: cooper: I find roles: is safer than role:
[2012-06-06 18:02:07 -0400] matschaffer: not entirely sure why
[2012-06-06 18:02:16 -0400] hoover_damm: he's doing not role
[2012-06-06 18:02:17 -0400] hoover_damm: lol
[2012-06-06 18:02:59 -0400] jelder: knife cookbook site install java 1.5.0 && knife cookbook upload java
[2012-06-06 18:03:04 -0400] jelder: wow, that worked beautifully
[2012-06-06 18:03:06 -0400] jelder: thanks guys!
[2012-06-06 18:03:12 -0400] hoover_damm: cooper, search(:node, "roles: NOT bob")
[2012-06-06 18:03:12 -0400] cooper: matschaffer: i'll give that a try
[2012-06-06 18:03:13 -0400] hoover_damm: should work
[2012-06-06 18:04:42 -0400] jflowers: what is the latest version of Chef for Windows?
[2012-06-06 18:04:45 -0400] jflowers: 0.10.8?
[2012-06-06 18:04:46 -0400] bawt_: 0.10.8 is up with some windows shell_out fixes: http://www.opscode.com/blog/2011/12/15/chef-0-10-8-released/
[2012-06-06 18:04:51 -0400] cooper: hoover_damm: hrm. never tried running knife search like thatwhat's the correct syntax on the command line? (this isn't in a recipe)
[2012-06-06 18:05:03 -0400] cooper: getting of course, -bash: syntax error near unexpected token `('
[2012-06-06 18:05:06 -0400] hoover_damm: knife search node "NOT roles:foobar"
[2012-06-06 18:05:10 -0400] hoover_damm: cooper, ^^
[2012-06-06 18:05:21 -0400] Mithrandir: bawt_: forget 0.10.8
[2012-06-06 18:05:21 -0400] bawt_: okies!
[2012-06-06 18:05:52 -0400] jflowers: the reason I ask is the install doc says the latest version is 0.10.10
[2012-06-06 18:06:46 -0400] cooper: hoover_damm: oh no! now i get two nodes in that list.
[2012-06-06 18:06:49 -0400] pwf: is it bad that an RSA private key shows up when running 'ps -ef | grep chef' on a machine while it's being bootstrapped with knife
[2012-06-06 18:07:00 -0400] pwf: that's my validator key right
[2012-06-06 18:07:03 -0400] jflowers: here is the link to the install doc http://wiki.opscode.com/display/chef/Installing+Chef+Client+on+Windows
[2012-06-06 18:07:04 -0400] cooper: hoover_damm: is this not the proper run to add a role to a node:  knife node run_list add $HOSTS "role[base]"
[2012-06-06 18:07:08 -0400] pwf: that was just... surprising
[2012-06-06 18:07:24 -0400] hoover_damm: cooper, that's not indexed until the node either saves it's runlist
[2012-06-06 18:07:29 -0400] hoover_damm: or completes a chef-client run
[2012-06-06 18:07:46 -0400] cooper: hoover_damm: yup, and then i run chef-client on that host
[2012-06-06 18:07:54 -0400] hoover_damm: and it should get indexed right
[2012-06-06 18:08:13 -0400] hoover_damm: search(:node, "NOT roles:base")
[2012-06-06 18:08:17 -0400] hoover_damm: in shef
[2012-06-06 18:09:09 -0400] cooper: hrm. i've done the exact same thing w/ over 40 hosts and now i'm just running into this issue.
[2012-06-06 18:10:05 -0400] hoover_damm: I had some thought the other day of making a recipe determine if it was the first node in this role
[2012-06-06 18:10:09 -0400] hoover_damm: that failed miserably
[2012-06-06 18:10:39 -0400] hoover_damm: search(:node, "roles: #{node.role.first} AND chef_environment:#{node.chef_environment}") ... so didn't work
[2012-06-06 18:11:14 -0400] cooper: hoover_damm:  :) did you figure out how to do it in the end?
[2012-06-06 18:11:19 -0400] hoover_damm: no
[2012-06-06 18:11:32 -0400] hoover_damm: cooper, I gaveup as that pattern wasn't requested in the end
[2012-06-06 18:11:46 -0400] hoover_damm: cooper, basically the node.roles at that point wasn't valid and I had to find the roles based off the runlist
[2012-06-06 18:12:31 -0400] hoover_damm: adding node.save fixed it so the second run would work.  I imagine a few Opscode employee's know how to pull it off
[2012-06-06 18:12:47 -0400] hoover_damm: I just stopped trying as it wasn't requested
[2012-06-06 18:16:26 -0400] jflowers: Anyone have an idea why I would be geting this error:
[2012-06-06 18:16:28 -0400] jflowers: NoMethodError: undefined method `chef_gem' for #<Chef::Provider::WindowsZipfile:0x446f6d0>
[2012-06-06 18:17:39 -0400] jflowers: just trying to use the windows_zipfile resource
[2012-06-06 18:17:51 -0400] pwf: what's the recipe look like
[2012-06-06 18:18:22 -0400] cooper: hoover_damm: heh. i give up much sooner than that usually. lol
[2012-06-06 18:19:17 -0400] jflowers: windows_zipfile "c:/Program Files" do
[2012-06-06 18:19:17 -0400] jflowers:   source node['springsource_sts']['source']
[2012-06-06 18:19:17 -0400] jflowers:   action :unzip
[2012-06-06 18:19:17 -0400] jflowers:   not_if {::File.exists?("c:/Program Files/springsource/sts-2.9.2.RELEASE/STS.exe")}
[2012-06-06 18:19:18 -0400] jflowers: end
[2012-06-06 18:20:01 -0400] yfeldblum: jflowers, chef_gem is from chef-0.10.10+
[2012-06-06 18:20:08 -0400] jflowers: ahh
[2012-06-06 18:20:14 -0400] hoover_damm: cooper, basically I need to save the runlist and have it reloaded before that would work right
[2012-06-06 18:20:33 -0400] cooper: hoover_damm: ran chef-client on that second node and now all nodes *except the original one* show up whether i'm doing "role:base" or "roles:base"
[2012-06-06 18:20:33 -0400] hoover_damm: there's several ugly ways I can think of doing that
[2012-06-06 18:20:44 -0400] jflowers: so how do I get my hands on that version, 0.10.10?
[2012-06-06 18:21:04 -0400] jflowers: I can find that version on the wiki
[2012-06-06 18:21:09 -0400] cooper: so only one node is  not getting indexed? i restarted chef-solr on the chef server but that didn't make any difference
[2012-06-06 18:21:11 -0400] hoover_damm: cooper, run node.save on that node and try again?
[2012-06-06 18:21:15 -0400] hoover_damm: in shef -z
[2012-06-06 18:21:20 -0400] hoover_damm: no need to run chef-client
[2012-06-06 18:21:43 -0400] hoover_damm: cooper, and run shef -z on that client if it helps.
[2012-06-06 18:21:53 -0400] jflowers: this link is 0.10.8 http://opscode.com/chef/install.msi
[2012-06-06 18:21:54 -0400] cooper: hoover_damm: ah! ok.
[2012-06-06 18:23:25 -0400] jflowers: well that link redirects to this on, but still it is version 0.10.8: http://s3.amazonaws.com/opscode-full-stack/windows/chef-client-latest.msi
[2012-06-06 18:24:43 -0400] cooper: hoover_damm:  looks like node.save worked in shef but that node still shows up when i do "NOT roles:base" and does not show up, of course, when i do "roles:base"
[2012-06-06 18:24:44 -0400] cooper: very odd
[2012-06-06 18:26:16 -0400] cooper: this might be a nice tidbitthis one host is also my workstation that i'm working from (knife, chef repo, etc)
[2012-06-06 18:26:24 -0400] cooper: but wouldn't think that would matter
[2012-06-06 18:29:29 -0400] knuckolls___: how can i pull in the provided resources from a cookbook without running a recipe?
[2012-06-06 18:29:39 -0400] jflowers: Okay google helped me find the installer, but it is hard to know if this is the latest ot not: https://s3.amazonaws.com/opscode-full-stack/windows/chef-client-0.10.10-3.msi
[2012-06-06 18:30:11 -0400] knuckolls___: we were attempting to do this with include_recipe, but that's going to run the recipe. i just want the resources.
[2012-06-06 18:31:11 -0400] hoover_damm: cooper, what's the roles on this node?
[2012-06-06 18:31:12 -0400] hoover_damm: or runlist?
[2012-06-06 18:31:37 -0400] cooper: Run List:    role[base]
[2012-06-06 18:31:37 -0400] cooper: Roles:       base
[2012-06-06 18:31:38 -0400] cooper: Recipes:     yum, user-mgmt, chef-client, ntp
[2012-06-06 18:31:54 -0400] cooper: same as the other 42 nodes
[2012-06-06 18:34:41 -0400] cwj: i know this is a vagrant specific question but i havent gotten any response in #vagrant: is there a way to get vagrant to execute some code (i.e. delete the chef client and node for the vm) when vagrant destroy is run?
[2012-06-06 18:36:40 -0400] hoover_damm: cooper, i meant by running it in shef... shef -z and then node.run_list and node.roles
[2012-06-06 18:36:58 -0400] hoover_damm: cooper, you can do b=Chef::Node.load("something")
[2012-06-06 18:37:10 -0400] hoover_damm: if you want to view the node in shef manually
[2012-06-06 18:42:07 -0400] hasrb: Is there any kind of Knife environment variables you can set for a specific Chef repo? For instance always setting "-a ec2.public_hostname" for a specific project.
[2012-06-06 18:42:28 -0400] hasrb: or does it need to be typed every time?
[2012-06-06 18:44:48 -0400] cooper: hoover_damm: very helpful. :)  chef >  node.run_list  => role[base]   chef > node.roles => ["base"]  chef > node  => <Chef::Node:0x1e3e51c@name="bastion-1">
[2012-06-06 18:44:51 -0400] sascha_d: I create different knife.rb files for each disparate env
[2012-06-06 18:45:17 -0400] sascha_d: if I'm using the same env long enough, I symlink knife.rb to some-env.rb
[2012-06-06 18:45:34 -0400] cooper: so in shed that node shows up as having the correct role in run_list and rolesif i'm understanding that correctly
[2012-06-06 18:46:50 -0400] hoover_damm: cooper, so it sounds like you have the right role
[2012-06-06 18:46:57 -0400] cooper: hoover_damm:  chef > search(:node, "NOT roles:base")  => [node[bastion-1]]
[2012-06-06 18:47:05 -0400] cooper: makes no sense
[2012-06-06 18:47:05 -0400] hoover_damm: cooper, although if it says node.roles is ["base"] it sounds like it's putting roles into an array
[2012-06-06 18:47:23 -0400] hoover_damm: hrm, it is an array now
[2012-06-06 18:47:23 -0400] hoover_damm: nm
[2012-06-06 18:47:49 -0400] cooper: lol
[2012-06-06 18:48:02 -0400] hoover_damm: cooper, your own server
[2012-06-06 18:48:03 -0400] hoover_damm: ?
[2012-06-06 18:48:12 -0400] cooper: yes
[2012-06-06 18:48:56 -0400] hoover_damm: try and reindex
[2012-06-06 18:49:15 -0400] hoover_damm: also we're only talking 40 nodes right? not huge?
[2012-06-06 18:50:22 -0400] cooper: hoover_damm: correct. but how do i reindex? :S sorryfairly n00b.
[2012-06-06 18:51:24 -0400] cooper: ahknife indexsec...
[2012-06-06 18:55:11 -0400] cooper: hoover_damm: hrm. reindexed successfullybut still same issue :(  https://gist.github.com/2883889
[2012-06-06 18:55:27 -0400] cooper: i'm going to delete the role and re-add it. hrm.
[2012-06-06 19:00:48 -0400] werdnativ: my app was not updating /etc/init.d and runit jobs, how can I get it to regenerate this: https://github.com/opscode-cookbooks/application_ruby/blob/master/providers/unicorn.rb#L47
[2012-06-06 19:01:15 -0400] cooper: hoover_damm: removing role and re-adding role from/to didn't help. i'm at a loss. :(
[2012-06-06 19:01:26 -0400] werdnativ: I tried deleting /etc/sv/myapp and /etc/init.d/myapp but they're not coming back when I re-run chef
[2012-06-06 19:03:24 -0400] werdnativ: before_deploy gets called, but I don't see before_restart in the log.
[2012-06-06 19:12:03 -0400] hoover_damm: cooper, remove role, run chef, add role, run chef... not there?
[2012-06-06 19:12:13 -0400] hoover_damm: cooper, is the node that it's not finding itself?
[2012-06-06 19:12:27 -0400] hoover_damm: nm on that last part
[2012-06-06 19:12:29 -0400] cooper: hoover_damm: run chef-client, right?
[2012-06-06 19:12:47 -0400] hoover_damm: cooper, well node.save
[2012-06-06 19:13:18 -0400] cooper: hoover_damm:  ah. kk. let me try thatbefore just did remove/add then ran chef-client
[2012-06-06 19:13:32 -0400] joshuag: ssd7: no luck?
[2012-06-06 19:15:32 -0400] myusuf3: with the git resource
[2012-06-06 19:16:01 -0400] myusuf3: does the directory need to exist?
[2012-06-06 19:16:04 -0400] cooper: hoover_damm:  what does node.save do exactly?
[2012-06-06 19:17:02 -0400] hoover_damm: cooper, posts the current node to the chef server which then stores it in couchdb
[2012-06-06 19:17:45 -0400] pbogunovich: Hello, I recently upgraded my chef-server from 0.10.8 to 0.10.10 and all went well, except when I create a new node using knife ec2 server create, the provisioning fails. In "/var/cache/chef/chef-stacktrace.out" on the new node i get the following stacktrace https://gist.github.com/2884036. Has anyone seen something like this before?
[2012-06-06 19:19:27 -0400] hoover_damm: cooper, http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2012-06-06 19:23:23 -0400] cooper: hoover_damm:  thx for linki've seen it before but it's a lot more relevant (and thus more helpful) now
[2012-06-06 19:24:57 -0400] cooper: hoover_damm: i removed role using knife, ran node.save in shef on that server, re-added role with knife, ran chef-client on that server (when i ran node.save it cleared out the role for that node on the chef server).
[2012-06-06 19:27:06 -0400] pbogunovich: i think that my issue has something to do w/ the caching of cookbooks
[2012-06-06 19:27:07 -0400] cooper: in shef and with knife roles, run_list, and recipes all look correct (and just like the other nodes). after running chef-clientand all the recipes running for that base role,  that one host still shows up in knife search and shef with "NOT roles:base". sigh.
[2012-06-06 19:27:22 -0400] cooper: hoover_damm:  ^^
[2012-06-06 19:27:45 -0400] hoover_damm: cooper, and has expander already indexed this role?
[2012-06-06 19:27:52 -0400] hoover_damm: also what version of chef is this?
[2012-06-06 19:28:56 -0400] hoover_damm: if your on 0.10.8 you may want to check out your solr config in  /var/lib/chef/solr/conf/solrconfig.xml and make sure maxFieldLength is higher then 10000
[2012-06-06 19:29:09 -0400] myusuf3: anyone is git to   deploy code?
[2012-06-06 19:29:12 -0400] cooper: hoover_damm:  chef version 0.10.8; how can i verify if the expander has indexed this role.
[2012-06-06 19:29:13 -0400] myusuf3: use*
[2012-06-06 19:29:14 -0400] hoover_damm: such as 100000 and then restart solr, rebuild your index
[2012-06-06 19:29:24 -0400] hoover_damm: cooper, then you actually need to do what I just said
[2012-06-06 19:29:24 -0400] cooper: kkchecking. thanks hoover_damm
[2012-06-06 19:29:26 -0400] hoover_damm: if your on 0.10.8
[2012-06-06 19:29:45 -0400] cooper: kkthanks for hanging with me on this issue :)
[2012-06-06 19:29:59 -0400] hoover_damm: this is fixed in 0.10.10 afaik
[2012-06-06 19:34:17 -0400] myusuf3: hoover_damm i have a git deployment question with chef
[2012-06-06 19:34:37 -0400] myusuf3: i am specificying a directory for the repository to be cloned into
[2012-06-06 19:34:59 -0400] myusuf3: but the directory doesn't exsist? will the git reciepe create the directory?
[2012-06-06 19:35:05 -0400] myusuf3: i am getting the following error.
[2012-06-06 19:35:36 -0400] myusuf3: enclosing directory doesn't exsist
[2012-06-06 19:41:11 -0400] yfeldblum: myusuf3, just add another `directory` resource just before the `git` resource
[2012-06-06 19:45:00 -0400] dpetzel: anyone up for helping a newb with minitest-chef-handler?
[2012-06-06 19:51:13 -0400] cooper: hoover_damm:  w00t. i changed that setting in solrconfig.xml, restarted chef-solr, rebuilt indexand viola all nodes show up having that base role
[2012-06-06 19:51:30 -0400] dpetzel: Im attempting to write my first test with minitest-chef-handler and Im getting NoMethodError: undefined method `assert_path_exists'. All I did was copy the fstab example from https://github.com/calavera/minitest-chef-handler/blob/v0.4.0/examples/spec_examples/files/default/tests/minitest/example_test.rb
[2012-06-06 19:56:20 -0400] iamsmrtk: dpetzel: What does the full stack trace say?
[2012-06-06 19:57:02 -0400] coderanger: Reminder that there is an OHC maintenance window in 4 minutes :-)
[2012-06-06 19:57:07 -0400] dpetzel: iamsmrtk: I actually just figured out. Im an idiot and cant read the 3 include lines, I only did the require :(
[2012-06-06 19:57:13 -0400] coderanger: (expected downtime is ~1 second)
[2012-06-06 19:57:28 -0400] iamsmrtk: dpetzel: It happens to the best of us :)
[2012-06-06 19:57:46 -0400] iamsmrtk: Hey all, I'm trying to get the dev environment set up per the
[2012-06-06 19:57:47 -0400] iamsmrtk:    ideas?
[2012-06-06 19:57:47 -0400] iamsmrtk:    instructions on github but I'm running into a "No such file or
[2012-06-06 19:57:47 -0400] iamsmrtk:    directory - /etc/chef/server.rb" even after a rake install. Any
[2012-06-06 20:00:47 -0400] the_: hrm
[2012-06-06 20:01:40 -0400] aslan: hey guys if i set a variable like my_databag = data_bag_item('x','y') shouldn't the variable be available to recipes that are included in to this recipe ?
[2012-06-06 20:03:08 -0400] coderanger: Yes
[2012-06-06 20:05:14 -0400] aslan: coderanger: somehow its not
[2012-06-06 20:05:37 -0400] iamsmrtk: Anyone have an idea why a "rake install" in the source from github doesn't install a server.rb file?
[2012-06-06 20:06:18 -0400] coderanger: aslan: please pastebin the recipe code
[2012-06-06 20:06:45 -0400] coderanger: iamsmrtk: The dev env setup wouldn't be installing a server, so it wouldn't touch any server related files
[2012-06-06 20:06:47 -0400] aslan: coderanger: ok
[2012-06-06 20:07:56 -0400] iamsmrtk: coderanger: That makes sense but when I try to run "rake dev" it complains about not being able to find /etc/chef/server.rb
[2012-06-06 20:08:13 -0400] coderanger: iamsmrtk: I am unfamiliar with that command, what guide are you following?
[2012-06-06 20:09:30 -0400] iamsmrtk: coderanger: Just the one on chef's github page but the command is technically not in the guide. It's just one of the rake tasks listed when you run "rake -T"
[2012-06-06 20:10:21 -0400] coderanger: iamsmrtk: Thats probably for developing chef, not developing using chef :)
[2012-06-06 20:11:57 -0400] iamsmrtk: coderanger: If I understand you correctly, that's what I'm going for :). I want to make some changes to the webui and want a dev instance of chef running.
[2012-06-06 20:12:20 -0400] aslan: coderanger: here it is https://gist.github.com/2884426
[2012-06-06 20:13:04 -0400] coderanger: aslan: Please pastebin the actual code, not an edited version
[2012-06-06 20:13:37 -0400] coderanger: aslan: However to answer your question, include_recipe doesn't make local variables available
[2012-06-06 20:13:37 -0400] aslan: coderanger: those lines were copied from the recipe
[2012-06-06 20:14:02 -0400] aslan: coderanger: oh ok ... that answers the question. so how do you pass around local variables?
[2012-06-06 20:14:48 -0400] coderanger: In general you don't, but node.run_state is a global scratch Hash you can use if needed
[2012-06-06 20:14:56 -0400] coderanger: See also, why global variables are bad :)
[2012-06-06 20:15:46 -0400] aslan: coderanger: i just thought of dumping the data bag into the node object ... thanks for the hint
[2012-06-06 20:22:40 -0400] iamsmrtk: coderanger: Ok, I caved and installed chef through my OS's repo and it's gotten a bit further. Now it's complaining about missing files (a gem that I do have installed). Here's the stack trace http://pastebin.com/PabfqVuZ. Any ideas?
[2012-06-06 20:32:41 -0400] FreeFries: my chef server seems to be horribly screwed up. Is there an easy way to dump all the data to start from scratch? I copied the couchdb file over to a new server and I think that's what killed it
[2012-06-06 20:33:14 -0400] FreeFries: every time I run knife cookbook upload different files are missing from the cookbooks when it tries to run the actual recipe
[2012-06-06 20:33:17 -0400] FreeFries: s
[2012-06-06 20:33:47 -0400] FreeFries: so I'll run it once and file AF1 is missing from users, run it a second time and file BG3 is missing from sshd
[2012-06-06 20:34:16 -0400] FreeFries: (where AF1 and BG3 are the hashes of the files)
[2012-06-06 20:34:32 -0400] iamsmrtk: FreeFries: I've had luck in the past by deleting /var/lib/couchdb/chef.couch and restarting the chef server.
[2012-06-06 20:34:33 -0400] FreeFries: couchdb has the checksum, but the /var/cache/chef/sandboxes does not
[2012-06-06 20:35:08 -0400] FreeFries: will that re-create it? or I'll have to manually go back through and re-add all the clients and such?
[2012-06-06 20:35:52 -0400] iamsmrtk: FreeFries: That will blow everything out, clients, nodes, etc. Do you just want to get rid of the cookbook?
[2012-06-06 20:36:06 -0400] FreeFries: I'd like to make it work
[2012-06-06 20:36:24 -0400] FreeFries: I have about 30 clients+nodes, so not the end of the world if I have to re-create them
[2012-06-06 20:36:32 -0400] FreeFries: but not my first choice ;)
[2012-06-06 20:36:40 -0400] iamsmrtk: FreeFries: Have you tried deleting the cookbook and re-adding it?
[2012-06-06 20:36:44 -0400] FreeFries: yes
[2012-06-06 20:37:09 -0400] FreeFries: I've deleted every cookbook and re-added them all...random files appear to be missing from different cookbooks every time
[2012-06-06 20:37:55 -0400] iamsmrtk: FreeFries: Hrm, that's rather curious. I'm out of ideas.
[2012-06-06 20:38:02 -0400] FreeFries: so for example, I'll delete everything, upload, and the users cookbook is missing checksum ABC, delete everything, reupload, and now sshd is missing checksum BBE, do it again and users is missing the file
[2012-06-06 20:38:31 -0400] FreeFries: the checksums are in couchdb, but not in /var/cache/chef/sandboxes
[2012-06-06 20:40:17 -0400] FreeFries: my disk is not full, and I'm not getting any errors when I upload
[2012-06-06 20:42:53 -0400] FreeFries: if I blow the chef.couch file, what do I need to do to re-initialize my initial client? run through the standard install stuff?
[2012-06-06 20:52:30 -0400] iamsmrtk: FreeFries: It'll just need to connect again but you'll have to worry about validation keys and stuff being regenerated.
[2012-06-06 20:57:03 -0400] FreeFries: such a useful error message: HTTP Request Returned 500 Internal Server Error: kill
[2012-06-06 20:57:09 -0400] FreeFries: when I try to start a server, heh
[2012-06-06 20:58:00 -0400] FreeFries: (when it tries to hit couch)
[2012-06-06 20:58:03 -0400] iamsmrtk: FreeFries: heh, when starting the chef server?
[2012-06-06 20:58:17 -0400] FreeFries: yep
[2012-06-06 20:58:41 -0400] FreeFries: chef seems to be quite a pain when trying to restore it from a backup
[2012-06-06 20:58:44 -0400] FreeFries: or my backups are just wrong
[2012-06-06 20:59:16 -0400] iamsmrtk: FreeFries: I hear that, I've had tons of issues with it myself =/
[2012-06-06 21:01:25 -0400] Freek: Hey all, what is the best way to distribute the secret file to nodes when using encryted data bags (I figured each node needs it to decrypt the information). Having it done with a recipe almost seems to defeat the point I would think.
[2012-06-06 21:01:50 -0400] FreeFries: iamsmrtk: the problem here seems to be with couchdb
[2012-06-06 21:02:05 -0400] FreeFries: it's not starting up, when I load the web interface it's giving some random error
[2012-06-06 21:02:46 -0400] FreeFries: some "default authentication error, infinity" when retrieving a list of all documents
[2012-06-06 21:03:28 -0400] iamsmrtk: FreeFries: so did you blow out chef.couch?
[2012-06-06 21:04:27 -0400] FreeFries: that's next on my list
[2012-06-06 21:04:36 -0400] FreeFries: I did, restarted chef server but not couch
[2012-06-06 21:04:49 -0400] FreeFries: then killed couch, restored the old chef.couch, and now couch won't restart
[2012-06-06 21:05:06 -0400] FreeFries: so I'm about to get rid of it completely...I just remove it and touch a new chef.couch file, righT?
[2012-06-06 21:06:28 -0400] iamsmrtk: FreeFries: You shouldn't even need to touch a chef.couch file, it should do it automatically with couchdb running and starting up the chef server.
[2012-06-06 21:18:32 -0400] qurve: Evening gents.
[2012-06-06 21:19:17 -0400] qurve: erikh: Are you here by chance?
[2012-06-06 21:19:28 -0400] erikh: qurve: yes
[2012-06-06 21:19:51 -0400] qurve: Hey man, I was just looping back to that example you gave me a week or so ago to have servers remove themselves from chef.
[2012-06-06 21:19:58 -0400] qurve: (In my case when instances get terminated on ec2)
[2012-06-06 21:20:03 -0400] qurve: https://gist.github.com/c4133da90105b36ad4cf
[2012-06-06 21:20:19 -0400] erikh: it's working for us; is there a problem with it?
[2012-06-06 21:20:22 -0400] qurve: Is there anything I'd need to change about that to have it work with hosted chef?
[2012-06-06 21:20:30 -0400] qurve: No, I just finally got to the point where I want to test it :)
[2012-06-06 21:20:43 -0400] erikh: nope, the magic bits are the runlevel script that get installed
[2012-06-06 21:20:45 -0400] qurve: But I wasn't sure if it was geared towards chef-server in any way.
[2012-06-06 21:20:46 -0400] erikh: we're on hosted chef as well.
[2012-06-06 21:20:48 -0400] qurve: ok.
[2012-06-06 21:21:20 -0400] erikh: yeah it works a lot better than I expected it to
[2012-06-06 21:21:26 -0400] erikh: which is a bonus.
[2012-06-06 21:21:32 -0400] qurve: What is the value for -s?
[2012-06-06 21:21:41 -0400] erikh: the chef server
[2012-06-06 21:21:53 -0400] qurve: Which for hosted chef is what, api.opscode.com?
[2012-06-06 21:21:53 -0400] erikh: e.g., https://manage.opscode.com/.....
[2012-06-06 21:21:57 -0400] erikh: err, api
[2012-06-06 21:21:58 -0400] erikh: sorry
[2012-06-06 21:22:08 -0400] qurve: OK, gotcha, so that's the full URL including the org, etc.
[2012-06-06 21:22:09 -0400] qurve: Thanks.
[2012-06-06 21:22:11 -0400] erikh: right.
[2012-06-06 21:22:22 -0400] erikh: I'll be in and out, but ping me if you need anything else
[2012-06-06 21:22:25 -0400] qurve: Word, going to give this a try now and see what happens.
[2012-06-06 21:22:58 -0400] qurve: Did you create a custom cookbook just to do this or is there a good existing cookbook to utilize for these kinds of things?
[2012-06-06 21:23:03 -0400] qurve: Basically managing rc scripts.
[2012-06-06 21:23:09 -0400] erikh: yeah, I just did it custom
[2012-06-06 21:23:14 -0400] qurve: Ok, thanks again.
[2012-06-06 21:23:19 -0400] erikh: it's a part of an internal cookbook.
[2012-06-06 21:24:10 -0400] qurve: Arg, just thought of one more question
[2012-06-06 21:24:18 -0400] qurve: Does this just delete the node or will it clear out the 'client' too?
[2012-06-06 21:25:42 -0400] qurve: OK, my brain is on idiot today, please ignore me.
[2012-06-06 21:25:44 -0400] qurve: And thank you.
[2012-06-06 21:25:52 -0400] erikh: yeah it clears the client too
[2012-06-06 21:26:01 -0400] qurve: Reading comprehension is not my strong point today it appears.
[2012-06-06 21:26:05 -0400] erikh: you're not being a bother, feel free to ask more questions.
[2012-06-06 21:26:24 -0400] qurve: I have this all like 99% set up at this point, it's pretty sick :)
[2012-06-06 21:26:33 -0400] erikh: oh the autoscaling and all that?
[2012-06-06 21:26:36 -0400] qurve: I implemented metric-based up/down scaling today.
[2012-06-06 21:26:46 -0400] erikh: niiiice
[2012-06-06 21:26:51 -0400] qurve: Yeah, I had autoscaling set up, but only for min/max so it would regenerate dead servers.
[2012-06-06 21:26:54 -0400] erikh: using the autoscaling tools?
[2012-06-06 21:26:56 -0400] qurve: Today I popped in alarms
[2012-06-06 21:27:05 -0400] erikh: ah with cloudwatch?
[2012-06-06 21:27:11 -0400] qurve: Yeah, it's silly cool.
[2012-06-06 21:27:21 -0400] erikh: cloudwatch is only so much monitoring-wise
[2012-06-06 21:27:27 -0400] erikh: checkout scoutapp.com -- it's pretty sick
[2012-06-06 21:27:46 -0400] qurve: After this my last major problem to solve is shared persistent file storage for the load balanced web servers.
[2012-06-06 21:27:52 -0400] qurve: Which I have put off because it just sucks.
[2012-06-06 21:28:03 -0400] qurve: As far as I can tell, there really just isn't a good way to do it, you have to choose between least-bad.
[2012-06-06 21:29:50 -0400] qurve: OK, so I ran your script manually and it complained about not finding a knife config, but successfully deleted the node/client.
[2012-06-06 21:29:55 -0400] qurve: Should I even care about the warning?
[2012-06-06 21:29:59 -0400] erikh: oh, ha
[2012-06-06 21:30:07 -0400] erikh: yeah that should be fine
[2012-06-06 21:30:10 -0400] qurve: (this is the only reason the machines would use knife)
[2012-06-06 21:30:23 -0400] erikh: feel free to drop one in if you feel otherwise
[2012-06-06 21:30:45 -0400] qurve: Doesn't seem to be necessary really.
[2012-06-06 21:30:51 -0400] qurve: One less thing to process.
[2012-06-06 21:31:09 -0400] qurve: My cloud-init time is already like 2-3 minutes so the more I can shave off, the better.
[2012-06-06 21:31:17 -0400] erikh: hrm. maybe bootstrapping chef nodes on tethered phone intertubes was a bad idea
[2012-06-06 21:32:25 -0400] freecandy: What?
[2012-06-06 21:32:26 -0400] bawt_: What is best practice for deploying applications in a continuous integration environment? I have a java web application as a war file. I have a chef configured node with java, jetty and others services required. We currently use Jenkins to build and host deployment artifacts. My options, as I see it are to 1. Have a deployment recipe to ssh on the Jenkins box and pull the latest war and deploy that. 2. Use the Jenkins API to download
[2012-06-06 21:32:38 -0400] freecandy: What am I doing here? You people can't cook for shit.
[2012-06-06 21:32:53 -0400] erikh: he apparently isn't a meth user
[2012-06-06 21:36:57 -0400] qurve: Is there any way to retrieve a nodes name from within the node itself?
[2012-06-06 21:37:15 -0400] qurve: I'm actually curious if I can escape without needing a cookbook for this node cleanup, since it really only applies in ec2
[2012-06-06 21:39:11 -0400] mattray: qurve: node.name
[2012-06-06 21:39:24 -0400] qurve: I mean from the command line.
[2012-06-06 21:39:48 -0400] qurve: Basically erikh gave me the idea to put a shutdown script into rcd.0 that does knife node delete ...
[2012-06-06 21:40:14 -0400] qurve: But he's installing that script through a cookbook which writes the script out using node.name, I'm curious if I can bypass the need for a cookbook since it only applies in amazon.
[2012-06-06 21:40:14 -0400] mattray: qurve: grep node_name /etc/chef/client.rb
[2012-06-06 21:40:45 -0400] qurve: Hrm, my client.rb on my instance doesn't have a node_name in it.
[2012-06-06 21:41:59 -0400] hoover_damm: it doesn't have to
[2012-06-06 21:42:09 -0400] hoover_damm: it's only added if you add --node-name or -N in knife
[2012-06-06 21:42:28 -0400] qurve: Gotcha.
[2012-06-06 21:42:51 -0400] qurve: ALternatively, is there a reasonable way to only run a cookbook for both a role AND an environment?
[2012-06-06 21:43:21 -0400] qurve: Basically, I only want to bootstrap the delete_node_on_shutdown cookbook if the node is in production OR staging and in the webserver role.
[2012-06-06 21:43:34 -0400] qurve: (Basically, don't install the auto-delete script in the dev env)
[2012-06-06 21:43:48 -0400] hasrb: Is this "notifies :restart, resources(:service => "nginx")" the old format of this "notifies :restart, 'service[nginx]'"?
[2012-06-06 21:44:30 -0400] mattray: qurve: there are environment-specific run lists available in roles
[2012-06-06 21:44:38 -0400] tarrant: Is there a way to do a 'knife search node' and only search attributes that are manually defined?
[2012-06-06 21:44:41 -0400] qurve: I think I just found the docs on that, thank you.
[2012-06-06 21:44:50 -0400] tarrant: i.e. the output of knife node edit?
[2012-06-06 21:44:59 -0400] qurve: It appears you guys have thought of most everything :)
[2012-06-06 21:45:15 -0400] mattray: qurve: we get good feedback from our users
[2012-06-06 21:45:52 -0400] mattray: tarrant: not that I'm aware of, by the time it gets to search I don't believe it's available
[2012-06-06 21:46:03 -0400] tarrant: Cool thanks.
[2012-06-06 21:51:22 -0400] qurve: Chef::Exceptions::InvalidEnvironmentRunListSpecification: _default key is required in env_run_lists.
[2012-06-06 21:51:32 -0400] qurve: Do I just have to do '_default' => {}
[2012-06-06 21:51:34 -0400] qurve: er []
[2012-06-06 21:53:11 -0400] mattray: qurve: I believe you define a regular run list and that gets picked up by _default
[2012-06-06 21:53:22 -0400] mattray: and then use env_run_lists
[2012-06-06 21:53:23 -0400] mattray: http://wiki.opscode.com/display/chef/Roles#Roles-envrunlists
[2012-06-06 21:53:37 -0400] qurve: Yeah, I have a normal run list for the role, and specifically for staging/production I just want to pop on one additional cookbook.
[2012-06-06 21:53:52 -0400] qurve: It let me upload the role once I added a '_default' => [] key to the env_run_lists
[2012-06-06 21:53:56 -0400] qurve: We'll see if it works shortly.
[2012-06-06 21:54:41 -0400] mattray: I haven't used that, but I didn't think you had to define a _default. You have a gist for the role?
[2012-06-06 21:55:17 -0400] qurve: It appears there is an open issue for this: http://tickets.opscode.com/browse/CHEF-2636
[2012-06-06 21:55:50 -0400] mattray: qurve: well there you go
[2012-06-06 21:55:53 -0400] qurve: http://pastebin.com/4QtD9arS
[2012-06-06 21:55:57 -0400] qurve: There's the setup I'm testing now.
[2012-06-06 21:57:15 -0400] qurve: This really is one of the most helpful irc channels around.
[2012-06-06 22:01:35 -0400] qurve: It does however appear that if you do a env_run_lists then run_list is ignored.
[2012-06-06 22:01:37 -0400] qurve: easy to work around.
[2012-06-06 22:02:24 -0400] mattray: well, _default is getting applied
[2012-06-06 22:02:34 -0400] qurve: Oh, now this makes more sense.
[2012-06-06 22:02:51 -0400] mattray: that needs to be cleaned up, hence the ticket
[2012-06-06 22:02:53 -0400] qurve: I think I must have worn my dumbass pants today.
[2012-06-06 22:03:37 -0400] mattray: nah, you're into a fairly new feature that not a lot of people touch
[2012-06-06 22:04:09 -0400] qurve: Chef is fantastic, the learning curve is a little steep (just started last week) but once you wrap your head around all the nouns and what they do, it's very, very slick.
[2012-06-06 22:04:22 -0400] miah: yay
[2012-06-06 22:04:38 -0400] chip-: Has anyone used the fnichol chef-jenkins cookbook to set up a Jenkins slave?
[2012-06-06 22:05:01 -0400] miah: qurve: mattray you can just define _default in env_run_lists, no need to do a run_list AND env_run_lists
[2012-06-06 22:05:16 -0400] qurve: Yeah, that's what I just switched it to.
[2012-06-06 22:05:19 -0400] qurve: Worked perfectly.
[2012-06-06 22:05:28 -0400] qurve: erikh: Your script worked excellently.
[2012-06-06 22:05:30 -0400] miah: awesome. i've used env_run_lists a bunch for the past year
[2012-06-06 22:05:34 -0400] miah: they worked well
[2012-06-06 22:05:53 -0400] qurve: One tip you may be able to make yours better is ditch the -s <chef server url> and just replace it with a -c /etc/chef/client.rb or wherever it is.
[2012-06-06 22:06:04 -0400] qurve: One less variable floating around.
[2012-06-06 22:06:36 -0400] erikh: qurve: I tried to get that to work, but I don't remember the circumstances of why it didn't.
[2012-06-06 22:06:47 -0400] qurve: Hrm, it just worked for me once.
[2012-06-06 22:07:05 -0400] qurve: I just sniped down a server and it disappeared from the manage console, waiting for another one to start up to test it again :)
[2012-06-06 22:07:28 -0400] erikh: it depends on how the box was terminated.
[2012-06-06 22:07:40 -0400] erikh: if it received a shutdown "halt" signal, it will get executed.
[2012-06-06 22:07:48 -0400] erikh: if it just got powered off, well, I can't do much about that.
[2012-06-06 22:07:57 -0400] qurve: Yeah, I expect that there will be some stragglers now and then.
[2012-06-06 22:08:06 -0400] qurve: But this should clean up after auto-scaling, which is my main concern.
[2012-06-06 22:08:18 -0400] erikh: yeah, we haven't seen a machine yet not get cleaned up by it
[2012-06-06 22:08:19 -0400] qurve: Was a very clever solution, not one I would have thought of myself.
[2012-06-06 22:08:23 -0400] erikh: which is most excellent
[2012-06-06 22:08:31 -0400] erikh: wyld stallyns rules.
[2012-06-06 22:08:47 -0400] yfeldblum: qurve, it looks like you need to either set run_list or set a env_run_lists with a "_default" key, but if you skip run_list and set env_run_lists without a "_default" key that may be problematic
[2012-06-06 22:08:49 -0400] chip-: Alternately, anyone have a different cookbook that can be used to automatically provision Jenkins slaves?
[2012-06-06 22:09:09 -0400] qurve: yfeldblum: Yeah I switched it over to that and it worked like a charm, thank you.
[2012-06-06 22:09:21 -0400] yfeldblum: chip-, i'm working on the "chef-read-my-mind-automatically-cookbook" cookbook
[2012-06-06 22:09:55 -0400] chip-: yfeldblum: The "provision a server" part of this works great, and I'm assuming I'm just doing it wrong for the slave provisioning: https://github.com/fnichol/chef-jenkins
[2012-06-06 22:10:59 -0400] yfeldblum: chip-, i don't know anything about that cookbook
[2012-06-06 22:11:17 -0400] werdnativ: new_resource.cookbook_name is a symbol;  template resource's "cookbook" needs a string is this a bug?
[2012-06-06 22:12:10 -0400] werdnativ: https://github.com/opscode-cookbooks/application_nginx/blob/master/providers/nginx_load_balancer.rb#L41 using it like this, it gets passed to template as a symbol and complains...
[2012-06-06 22:12:33 -0400] erikh: qurve: $boss just gave me the ok to open-source that stuff and some other monitoring work i've done
[2012-06-06 22:12:43 -0400] erikh: so I'll let you know when the official cookbook is around
[2012-06-06 22:12:57 -0400] qurve: Rad.
[2012-06-06 22:13:27 -0400] ssd7: joshuag: Sorry, got pulled away. and then had some network issues.  Unfortunately, I don't have a create solution.  Basically, you want to call Kernel.load on the library file in the application cookbook before you do include Chef::Resource::ApplicationBase.  If you have access to the run_context (an internal chef data structure) from the library file it would be easy to pull out the path to that file, but I don't think you have access to the run_context there.
[2012-06-06 22:14:48 -0400] miah: ~.
[2012-06-06 22:15:11 -0400] miah: lulz. sorry.
[2012-06-06 22:20:19 -0400] erikh: miah: runaway ssh?
[2012-06-06 22:21:04 -0400] miah: i didnt feel like waiting for the network to recover (sometimes the network at noisebridge is awful)
[2012-06-06 22:21:31 -0400] qurve: erikh: Just tested this a few more times, works perfectly, thanks one last time.
[2012-06-06 22:21:47 -0400] erikh: yeah!
[2012-06-06 22:21:47 -0400] qurve: I think I have this stack fully working top-to-bottom now.
[2012-06-06 22:21:51 -0400] erikh: yay
[2012-06-06 22:21:58 -0400] qurve: Now if it just didn't depend on Ruby, womp womp.
[2012-06-06 22:22:00 -0400] jespada: chip-, take a look: https://github.com/heavywater/chef-jenkins
[2012-06-06 22:22:06 -0400] erikh: miah: is that the place with the payphone with the access code thingy at the front?
[2012-06-06 22:22:10 -0400] erikh: a friend told me about it.
[2012-06-06 22:22:19 -0400] qurve: It's hilarious, almost all of the dev I do is rails dev, and the first time I use Chef is for deploying a network of PHP sites.
[2012-06-06 22:22:24 -0400] miah: well, yes.
[2012-06-06 22:22:34 -0400] miah: noisebridge.net
[2012-06-06 22:23:19 -0400] erikh: wow, busy place
[2012-06-06 22:23:26 -0400] erikh: I should find time.
[2012-06-06 22:23:33 -0400] miah: yes
[2012-06-06 22:23:44 -0400] qurve: Do any of you guys by chance have a better solution than an EC2 exposing an EBS store over NFS to the load-balanced web servers for shared persistent file storage?
[2012-06-06 22:23:46 -0400] miah: sometimes its cool to work from here
[2012-06-06 22:24:02 -0400] qurve: I gotta figure out how to get a load-balanced wordpress blog to persist it's file uploads.
[2012-06-06 22:24:03 -0400] erikh: qurve: not really.
[2012-06-06 22:24:10 -0400] miah: why do your load balanced web servers need shared storage?
[2012-06-06 22:24:19 -0400] erikh: you could use some other database-alike for it.
[2012-06-06 22:24:19 -0400] miah: ah
[2012-06-06 22:24:23 -0400] qurve: miah, because blog authors have to upload media and crap
[2012-06-06 22:24:27 -0400] miah: you could direct uploads to a specific server?
[2012-06-06 22:24:30 -0400] miah: also.. fuck wordpress
[2012-06-06 22:24:31 -0400] erikh: ^
[2012-06-06 22:24:35 -0400] erikh: heh
[2012-06-06 22:24:45 -0400] qurve: Don't have to convince me, this is the software I have to support for the time being :)
[2012-06-06 22:24:50 -0400] miah: ya =)
[2012-06-06 22:24:58 -0400] miah: i have just had bad experiences with it
[2012-06-06 22:25:04 -0400] chip-: jespada: awesome.
[2012-06-06 22:25:10 -0400] miah: its designed about as well as php
[2012-06-06 22:25:13 -0400] qurve: Right now my idea is to have a m1.small with an EBS exposed over NFS and all of the web servers will mount that and trick wordpress by symlinking /wp-content/uploads to the NFS share.
[2012-06-06 22:25:34 -0400] qurve: I just don't have a lot of experience with wordpress and don't know if that will be reliable enough.
[2012-06-06 22:25:39 -0400] miah: it wont
[2012-06-06 22:25:41 -0400] qurve: It's very, very low-write and fairly low-read.
[2012-06-06 22:25:49 -0400] miah: anytime you add nfs to the picture reliablity goes away
[2012-06-06 22:25:55 -0400] qurve: I just can't believe Amazon hasn't solved this problem yet.
[2012-06-06 22:25:57 -0400] erikh: esp. on linux
[2012-06-06 22:26:01 -0400] erikh: oh!
[2012-06-06 22:26:02 -0400] erikh: s3
[2012-06-06 22:26:02 -0400] chip-: miah: I'd use an S3 bucket with CDN turned on, write some code that redirects the links to go directly to S3, and enjoy my free CDN.
[2012-06-06 22:26:03 -0400] erikh: durrr
[2012-06-06 22:26:10 -0400] miah: chip-: ^^^
[2012-06-06 22:26:16 -0400] qurve: erikh: The question is how to get the files onto s3.
[2012-06-06 22:26:23 -0400] qurve: I can get a wordpress plugin, but that only solves my wordpress problem.
[2012-06-06 22:26:24 -0400] miah: there are wordpress modules that do it
[2012-06-06 22:26:26 -0400] erikh: bastion host + s3sync
[2012-06-06 22:26:35 -0400] qurve: Next time I have another piece of code I'll have to come up with some other hack.
[2012-06-06 22:26:52 -0400] miah: http://wordpress.org/extend/plugins/amazon-s3-simple-upload-form/
[2012-06-06 22:26:53 -0400] miah: poof
[2012-06-06 22:27:15 -0400] miah: then just turn on cloudfront and actually get 'cdn' like services =)
[2012-06-06 22:27:29 -0400] qurve: Yeah, I've looked at a few of these, but I was hoping I could come up with a generic solution that was more software-independent.
[2012-06-06 22:27:36 -0400] qurve: I use cloudfront for all the other assets.
[2012-06-06 22:27:47 -0400] qurve: It's just these stupid wordpress uploads I gotta sort out.
[2012-06-06 22:27:50 -0400] chip-: Wordpress with shared wp-content requires you to do all kinds of painful fakery anyway
[2012-06-06 22:27:54 -0400] miah: yup
[2012-06-06 22:28:18 -0400] qurve: How so chip?
[2012-06-06 22:28:21 -0400] chip-: I really have to turn Lion autocorrect off one of these days. Fuckery.
[2012-06-06 22:28:24 -0400] miah: qurve: shared persistant storage = hard problem
[2012-06-06 22:28:32 -0400] qurve: Yeah.
[2012-06-06 22:28:42 -0400] qurve: Harder than I imagined.
[2012-06-06 22:28:50 -0400] chip-: qurve: You have to add some stuff to wp-config.php that says "I'm not storing wp-content in wordpress/wp-content anymore, it's on /nas/wp-content"
[2012-06-06 22:29:08 -0400] chip-: because if you just symlink /wordpress/wp-content then you run into the hell of a thousand php path resolutions
[2012-06-06 22:29:15 -0400] miah: move all the blogs to octopress and be happy =)
[2012-06-06 22:29:21 -0400] chip-: miah: ^^^
[2012-06-06 22:29:30 -0400] qurve: Actually, for all the other blogs I plan to do that.
[2012-06-06 22:29:41 -0400] qurve: But this one needs to be part of the main infrastructure since there is querying between the pieces of code.
[2012-06-06 22:30:57 -0400] chip-: jespada: Have you used this cookbook?
[2012-06-06 22:31:19 -0400] chip-: jespada: I'd love to see some example roles/run lists if you can share.
[2012-06-06 22:31:36 -0400] chip-: jespada: This is awesome though, thanks.
[2012-06-06 22:35:02 -0400] jespada: chip-, I did.. just yesterday , https://gist.github.com/2885254
[2012-06-06 22:35:18 -0400] jespada: this is a basic role example
[2012-06-06 22:35:54 -0400] jespada: just one jenkins server, without slaves
[2012-06-06 22:36:29 -0400] jespada: i'm working in one for sonar and apache archiva..too will put out there
[2012-06-06 22:47:00 -0400] jespada: chip-, that gist with a role example is for this cookbook: https://github.com/jespada/chef-jenkins
[2012-06-06 22:47:24 -0400] blitzrage: has anyone else noticed that when installing chef-server via gems that, on ubuntu 12.04 (at least) the /etc/init.d script contains a link to /usr/bin/chef-server when the binary is actually installed in /usr/sbin/chef-server ?
[2012-06-06 22:47:33 -0400] jespada: just a fork with some littles tweaks
[2012-06-06 22:48:04 -0400] chip-: jessicab: Gotcha. Was hoping for a slave role. :)
[2012-06-06 22:48:09 -0400] chip-: whoops mis-send
[2012-06-06 23:59:44 -0400] syphon: hey guys, what's the recommended way to run a Perl script with a cookbook? Where in the cookbook's folder structure should I put it, and how should I use the 'script' resource to invoke it?
