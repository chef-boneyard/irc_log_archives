[2012-06-09 00:00:48 -0400] werdnativ: apparently the resque cookbook depends on "ironfan" (i.e. "cluster_chef"), what is? Anything else for it without that dependency, I'm just running chef-solo for now...
[2012-06-09 00:30:18 -0400] anpl: hi
[2012-06-09 00:31:20 -0400] anpl: How cani tell chef to install only chef 0.10.8 gem on bootstrapping
[2012-06-09 00:31:50 -0400] anpl: is it possible to put it under some erb file than passing through knife command
[2012-06-09 00:39:05 -0400] miah: anpl: write a custom bootstrap template
[2012-06-09 00:40:54 -0400] anpl: miah: thanks
[2012-06-09 00:41:43 -0400] anpl: I have gem install chef -v=0.10.8 specified in bootsrap template
[2012-06-09 00:42:07 -0400] anpl: but I prefer  some organized manner to specify that
[2012-06-09 00:42:13 -0400] anpl: what would be best
[2012-06-09 00:43:27 -0400] hoover_damm: you can specify prereleases
[2012-06-09 00:43:50 -0400] hoover_damm: but the actual version you bootstrap really isn't an option
[2012-06-09 00:44:03 -0400] hoover_damm: oh wait i lied
[2012-06-09 00:44:05 -0400] hoover_damm: --bootstrap-version
[2012-06-09 00:44:36 -0400] anpl: you mean specify this with knife boot strap command?
[2012-06-09 00:45:36 -0400] hoover_damm: bootstrap or knife ec2 server create
[2012-06-09 00:45:37 -0400] hoover_damm: correct
[2012-06-09 00:45:58 -0400] anpl: Thanks hoover_damm
[2012-06-09 15:27:57 -0400] simonjj: does anyone in here know how to have a template file outside of the cookbook ?
[2012-06-09 16:19:54 -0400] edness: morning, anyone seen this issue with chef-solr  : Mixlib::ShellOut::ShellCommandFailed: service[chef-solr] (chef-server::rubygems-install line 220) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '5'
[2012-06-09 16:20:28 -0400] jayd3e_: is there a cookbook out there for putting ssh keys on github?
[2012-06-09 16:20:42 -0400] jayd3e_: to allow users to push
[2012-06-09 16:31:06 -0400] miah: not that i know of. but github does have an api, so you could make one.
[2012-06-09 16:59:43 -0400] jayd3e_: miah: I guess I'm curious as to how people automate the cloning of private github repos
[2012-06-09 16:59:47 -0400] jayd3e_: using cheg
[2012-06-09 16:59:50 -0400] jayd3e_: chef*
[2012-06-09 17:03:35 -0400] hoover_damm: jayd3e_, using deploy keys?
[2012-06-09 17:08:32 -0400] jayd3e_: hoover_damm: so here is the full story.  I'm using vagrant and then provisioning it with chef.  So this chef script will get run on multiple people's computers.  Therefore if I were to use deploy keys, then everyone would be committing under the same username, which obviously won't work
[2012-06-09 17:08:49 -0400] jayd3e_: am I right in saying that?
[2012-06-09 17:09:01 -0400] hoover_damm: your right
[2012-06-09 17:09:21 -0400] hoover_damm: then you need to get the input to ask for a username and password
[2012-06-09 17:09:35 -0400] hoover_damm: ruby_block "enter password for git" do
[2012-06-09 17:09:37 -0400] hoover_damm: block do
[2012-06-09 17:09:50 -0400] hoover_damm: $icky_password=gets
[2012-06-09 17:09:51 -0400] hoover_damm: end
[2012-06-09 17:09:51 -0400] hoover_damm: end
[2012-06-09 17:09:58 -0400] hoover_damm: then pass $icky_password to the password field
[2012-06-09 17:10:12 -0400] hoover_damm: likely the worst example I can think of
[2012-06-09 17:10:17 -0400] hoover_damm: but the easiest path maybe?
[2012-06-09 17:10:59 -0400] hoover_damm: to be nicer perhaps printf "enter your password" and then do the gets
[2012-06-09 17:11:11 -0400] hoover_damm: don't forget to toss a .chomp somewhere as you don't want the \n in the password
[2012-06-09 17:14:28 -0400] jayd3e_: hoover_damm: gotcha, kk thanks
[2012-06-09 17:41:36 -0400] miah: deploy keys only allow _pull_
[2012-06-09 17:41:44 -0400] miah: so nobody can commit as the same user with a deploy key
[2012-06-09 18:17:49 -0400] eherot: hey what's a quick way to see the current Chef version from within a recipe?
[2012-06-09 18:18:45 -0400] spox: Chef::VERSION
[2012-06-09 18:18:57 -0400] eherot: ah thanks
[2012-06-09 18:19:03 -0400] eherot: is there an object that breaks it up into segments?
[2012-06-09 18:19:25 -0400] ashb: probably something in the RubyGems gem that'll do it
[2012-06-09 18:19:37 -0400] eherot: hmm, good point
[2012-06-09 18:19:41 -0400] eherot: thx
[2012-06-09 18:19:54 -0400] eherot: why can't all of my open source projects' irc channels be so helpful (on a Saturday no less)?
[2012-06-09 18:20:04 -0400] spox: Gem::Version.new(Chef::VERSION)
[2012-06-09 18:20:20 -0400] spox: and that will let you do proper version comparisons and all that
[2012-06-09 18:20:48 -0400] spox: + #segments will likely be the bit you want to break it down
[2012-06-09 18:21:08 -0400] eherot: maybe I should just ask if ther'es a shorthand way to say "do not run this block if running on chef >= 0.10.10"
[2012-06-09 18:21:46 -0400] ashb: i'd take it back a step further - why do you care about he chef version vs a something else?
[2012-06-09 18:22:01 -0400] spox: unless(Gem::Version.new(Chef::VERSION) >= Gem::Version.new('0.10.10')) # do stuff
[2012-06-09 18:22:28 -0400] eherot: I have this cookbook that patches a bug in the dpkg provider (causing it to reinstall openssl over and over again) but the fix doesn't apply to 0.10.10 (and doens't work on the omnibus installer anyway).
[2012-06-09 18:27:44 -0400] miah: eherot: do you have a bug id on that?
[2012-06-09 18:28:37 -0400] eherot: CHEF-1752
[2012-06-09 18:28:51 -0400] miah: awesome thanks
[2012-06-09 18:29:23 -0400] eherot: was originally introduced in some version of 0.9, then fixed, then re-introduced later on somehow when that provider was significantly re-vamped in 0.10
[2012-06-09 18:29:44 -0400] miah: yay regression
[2012-06-09 18:29:47 -0400] eherot: at least I think.  I didn't end up having as much time to spend poking around at it when it cropped up again
[2012-06-09 18:29:49 -0400] eherot: yeah
[2012-06-09 18:29:54 -0400] eherot: it's a tricky one
[2012-06-09 18:30:18 -0400] eherot: but in general it looks like people are trying to be way too specific with the package versioning regexp in debian
[2012-06-09 18:31:18 -0400] eherot: what's funny is that there is a policy doc out there somewhere specifically defining how debian packages work and it looks like whomever wrote this either didn't read it or misunderstood it
[2012-06-09 18:31:22 -0400] eherot: (trying to find it now)
[2012-06-09 18:31:35 -0400] eherot: i think this is it http://www.debian.org/doc/debian-policy/ch-controlfields.html
[2012-06-09 18:31:53 -0400] eherot: basically they outline exactly which characters are allowed/expected
[2012-06-09 18:32:14 -0400] eherot: anyway ':' was on their list but not chef's
[2012-06-09 18:32:33 -0400] eherot: To summarize. :-)
[2012-06-09 18:32:57 -0400] miah: interesting
[2012-06-09 18:33:03 -0400] eherot: I probably wouldn't have bothered fixing it except that logwatch likes to send a list of every time a package has been reinstalled on a machine and it was spamming me.
[2012-06-09 18:33:39 -0400] eherot: it's my sole contribution to the core chef project but it got me a nice little hand-signed card and a sticker :-)
[2012-06-09 18:33:42 -0400] spox: annoyance is such a strong motivator :)
[2012-06-09 18:33:54 -0400] eherot: spox: haha, it really is.
[2012-06-09 18:34:04 -0400] eherot: spox: sad to say.
[2012-06-09 18:35:07 -0400] spox: so it looks like the omnibus RPM package for 5.7 doesn't have chef in it
[2012-06-09 18:41:44 -0400] spox: ah, tricky gem_package
[2012-06-09 18:46:18 -0400] eherot: spox: my least favorite provider
[2012-06-09 18:46:44 -0400] eherot: I always kinda feel like I'm going down a chicken-and-egg rabbit hole
[2012-06-09 19:07:16 -0400] jayd3e_: hoover_damm: there doesn't seem to be a password attribute for the 'git' deploy command
[2012-06-09 19:19:34 -0400] eherot: Is it just me or are gem_package resources sometimes evaluated after, say, user resources even if they come first in the recipe?
[2012-06-09 19:21:52 -0400] eherot: I have gem_package "ruby-shadow" on line 22 of a recipe but line 260 ("user USER do") is still failing with "You must have ruby-shadow installed for password support!"
[2012-06-09 19:22:14 -0400] eherot: (this is with 0.10.10)
[2012-06-09 19:22:35 -0400] eherot: unsurprisingly, it works fine if I run chef-client a second time, but unfortunately that kills the bootstrap process.
[2012-06-09 19:22:35 -0400] zts: eherot: use chef_gem instead of gem_package
[2012-06-09 19:22:55 -0400] eherot: zts: does that work on pre-0.10.10?
[2012-06-09 19:23:13 -0400] spox: eherot: it does if you add the chef_gem cookbook
[2012-06-09 19:23:23 -0400] eherot: hmmm...thx
[2012-06-09 19:24:10 -0400] zts: thats probably the best solution.  Otherwise, you need to force gem_package to run in the compile phase, and then called Gem.clear_paths
[2012-06-09 19:25:04 -0400] zts: example here - http://wiki.opscode.com/display/chef/Evaluate+and+Run+Resources+at+Compile+Time
[2012-06-09 19:25:26 -0400] eherot: yeah I looked into doing that for another cookbook and decided it was better to just work around it
[2012-06-09 19:25:36 -0400] eherot: (i.e. a bit scary)
[2012-06-09 19:26:50 -0400] eherot: hmm.is the chef_gem resource smart enough to figure out whether or not I'm on omnibus?
[2012-06-09 19:27:08 -0400] zts: yeah
[2012-06-09 19:27:12 -0400] zts: it will do the right thing
[2012-06-09 19:27:32 -0400] eherot: sweet.
[2012-06-09 19:28:11 -0400] eherot: actually I think the reason I have this constraint in here is that when not using omnibus, the apt libshadow-ruby1.8 is sufficient
[2012-06-09 19:28:34 -0400] eherot: so might as well leave it in I suppose
[2012-06-09 19:29:11 -0400] eherot: (also vastly limits the scope of where this change will be run, heh)
[2012-06-09 19:37:03 -0400] lusis: Anyone else seen chef_handler resources always showing as an updated resource at the end of each run despite not changing anything?
[2012-06-09 19:37:22 -0400] lusis: looks like nagios-nrpe-server does the same thing
[2012-06-09 19:37:29 -0400] lusis: something is up with those resources
[2012-06-09 19:44:49 -0400] hoover_damm: jayd3e_, lol http you embed the user and password in the uri
[2012-06-09 19:45:10 -0400] jayd3e_: k
[2012-06-09 19:52:21 -0400] eherot: not really a chef question but does anyone know why Gem.bindir might bewrong (and how I might fix it)?
[2012-06-09 19:52:31 -0400] eherot: wrong as in the bin for gem is not there
[2012-06-09 20:08:30 -0400] hoover_damm: eherot, someone removed it?
[2012-06-09 20:08:49 -0400] eherot: don't know.  Seems unlikely they did it with rm if they did
[2012-06-09 20:08:56 -0400] eherot: more likely a conflict between gem and apt
[2012-06-09 20:09:04 -0400] hoover_damm: which can cause the rm
[2012-06-09 20:09:05 -0400] hoover_damm: :/
[2012-06-09 20:09:15 -0400] hoover_damm: what rubygems are you rocking? debianized?
[2012-06-09 20:09:16 -0400] eherot: gem environment shows a value for EXECUTABLE DIRECTORY that doesn't exist.
[2012-06-09 20:09:23 -0400] eherot: yeah
[2012-06-09 20:09:34 -0400] hoover_damm: oof
[2012-06-09 20:09:42 -0400] hoover_damm: try and install regular rubygems on top to remove those debian patches
[2012-06-09 20:09:59 -0400] eherot: just purged it and reinstalled it with a supposedly full config reinstall and no dice
[2012-06-09 20:10:27 -0400] eherot: well the thing is other systems in our environment use debian rubygems without this weirdness and I don't want this one to be an outlier
[2012-06-09 20:10:56 -0400] eherot: (and of course this is also a system that violates my usual model of "don't build anything in ec2 that can't easily be rebuilt by chef in 5 minutes")
[2012-06-09 20:11:52 -0400] hoover_damm: well if you use the regular bootstraps
[2012-06-09 20:11:58 -0400] hoover_damm: you didn't exactly have regular debian rubygems
[2012-06-09 20:12:05 -0400] hoover_damm: or once upon a time that was the case
[2012-06-09 20:12:42 -0400] eherot: problem is this machine had chef added to it after the fact.
[2012-06-09 20:12:50 -0400] eherot: hmmmaybe I can just re-bootstrap chef on it
[2012-06-09 20:15:18 -0400] hoover_damm: hrm, dammit I think runit let me run out of disk space
[2012-06-09 20:17:09 -0400] hoover_damm: or powercycle it and it'll be up faster
[2012-06-09 20:17:31 -0400] hoover_damm: that is a hard problem with graphite and it's verbose logging
[2012-06-09 20:17:35 -0400] hoover_damm: lol
[2012-06-09 20:18:01 -0400] eherot: ctrl + C ;-)
[2012-06-09 20:18:17 -0400] hoover_damm: what do you do when control C fails?
[2012-06-09 20:18:31 -0400] hoover_damm: and control Z
[2012-06-09 20:18:41 -0400] hoover_damm: and ^\
[2012-06-09 20:18:55 -0400] hoover_damm: and you lack sysreq
[2012-06-09 20:19:32 -0400] hoover_damm: you do have ipdu access so you can powercycle it that way... and as it's a raid card with cache eh you might loose a little data
[2012-06-09 20:20:04 -0400] hoover_damm: but that has always been my annoyance with linux.  I never had this problem with BSD.  Fill up root and you can still login
[2012-06-09 20:20:10 -0400] hoover_damm: fill up root on linux? and it depends
[2012-06-09 20:23:11 -0400] ssd7: Ohai Chefs
[2012-06-09 20:23:44 -0400] eherot: hoover_damm: hmm, most of our systems you fill up the root partition and you just get a multitude of login errors.  Other ones usually you don't any error at all.
[2012-06-09 20:23:45 -0400] hoover_damm: the weird part for me is we started running collectd on our emr jobs
[2012-06-09 20:23:50 -0400] hoover_damm: fills up a lot of disk space
[2012-06-09 20:24:01 -0400] eherot: mr is good for that ;-)
[2012-06-09 20:24:03 -0400] hoover_damm: eherot, well it depends on the user.
[2012-06-09 20:24:19 -0400] eherot: unprivileged
[2012-06-09 20:24:39 -0400] hoover_damm: right
[2012-06-09 20:24:43 -0400] eherot: i have however had that problem on other distros
[2012-06-09 20:25:01 -0400] hoover_damm: it started with redhat 7.2 for me
[2012-06-09 20:25:08 -0400] hoover_damm: I really don't recall it better then that
[2012-06-09 20:25:22 -0400] eherot: yeah I seem to remember the centos cluster at my previous job being a bit less tolerant of a full disk
[2012-06-09 20:32:00 -0400] hoover_damm: yep
[2012-06-09 20:32:15 -0400] hoover_damm: this was a temporary disk flucuation due to 2 emr jobs spinning up and spamming / for a moment
[2012-06-09 20:32:20 -0400] hoover_damm: once the server rebooted runit rotated the logs
[2012-06-09 20:32:22 -0400] hoover_damm: and all was peachy
[2012-06-09 20:32:26 -0400] hoover_damm: LOL
[2012-06-09 20:33:24 -0400] hoover_damm: hrm, emr job down to 6gig a day
[2012-06-09 20:33:28 -0400] hoover_damm: well that's not bad
[2012-06-09 20:33:51 -0400] hoover_damm: that's 82 instances boote dup for the job :) lol
[2012-06-09 20:33:59 -0400] JasonBox: emr?
[2012-06-09 20:34:05 -0400] hoover_damm: elastic map reduce
[2012-06-09 20:34:09 -0400] hoover_damm: aka elastic hadoop
[2012-06-09 20:35:11 -0400] hoover_damm: I'm trying to fine tune my storage schema for EMR for maximum retention of days... they don't like it when I tell them they can only keep x days if they do the default collectd retention
[2012-06-09 20:35:22 -0400] hoover_damm: and it's mainly because of that extra wasted space that's preallocated
[2012-06-09 20:36:06 -0400] hoover_damm: maybe s3fs for archiving instead
[2012-06-09 20:36:07 -0400] hoover_damm: lol
[2012-06-09 20:36:10 -0400] hoover_damm: that could work
[2012-06-09 20:36:52 -0400] hoover_damm: otherwise you boot up 160 instances in 2 days... you do the math
[2012-06-09 20:42:58 -0400] JasonBox: Indeed
[2012-06-09 20:52:15 -0400] hoover_damm: basically hard questions for awkward situations
[2012-06-09 20:52:24 -0400] hoover_damm: once we move to a non elastic hadoop cluster it won't be awkward
[2012-06-09 21:00:07 -0400] eherot: I think I stumbled upon CHEF-2848 https://gist.github.com/2902578
[2012-06-09 21:00:31 -0400] eherot: does anyone know if there is actually a way to use ruby-shadow on chef 0.10.10 without having to do anything manually during bootstrap?
[2012-06-09 21:08:55 -0400] zts: eherot: I had to deal with that this morning, and have ended up installing build-essential before doing the chef bootstrap.  I think the right answer, for ruby-shadow, is that it really should be shipped in the omnibus builds (but I haven't created a ticket for that yet)
[2012-06-09 21:10:43 -0400] eherot: zts: agreed.  It looks like my solution is going to be to install ruby-dev1.8 which, although it gets the job done, also kind of breaks the whole "omnibus" model and definitely installs lots of stuff that prod servers shouldn't require
[2012-06-09 21:38:48 -0400] eherot: grr, and it still wants to go through and run chef_gem before running the package install for ruby1.8-dev
[2012-06-09 21:39:00 -0400] eherot: zts: did you install build-essentials manually?
[2012-06-09 22:33:12 -0400] cjs226: anyone using the s3_file cookbook?  I'm receiving "ERROR: Chef::Exceptions::ResourceNotFound: Cannot find a resource matching file[/tmp/cjs.trigger] (did you define it first?)" when I try to use notifications.
