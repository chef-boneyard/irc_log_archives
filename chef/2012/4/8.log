[2012-04-08 00:12:56 -0400] hoover_damm: UForgotten, use chef-server
[2012-04-08 00:13:00 -0400] hoover_damm: that's the easy way
[2012-04-08 00:20:14 -0400] UForgotten: hoover_damm: not an option. its ludicrously expensive.
[2012-04-08 00:21:24 -0400] UForgotten: hoover_damm: if there was an option for a local community server for free, I would do it in a heartbeat.
[2012-04-08 00:25:02 -0400] hoover_damm: UForgotten, the cost pays for itself
[2012-04-08 00:25:16 -0400] hoover_damm: UForgotten, if your on Amazon, we are talking about a single m1.medium instance
[2012-04-08 00:25:24 -0400] hoover_damm: you can get away with a small instance but it's slow
[2012-04-08 00:25:37 -0400] hoover_damm: 5 nodes or less is free on Hosted chef
[2012-04-08 00:27:01 -0400] UForgotten: this is significantly more than that. which is why paying opscode hosted chef is too expensive.
[2012-04-08 00:27:27 -0400] hoover_damm: totally
[2012-04-08 00:27:34 -0400] hoover_damm: I have a clientn who uses a 4gig instance on rackspace
[2012-04-08 00:27:42 -0400] hoover_damm: costs them a little under 200$/month for it
[2012-04-08 00:27:48 -0400] hoover_damm: and they host 60+nodes
[2012-04-08 00:27:59 -0400] hoover_damm: to try and pay the opscode equivilent is not in their desire
[2012-04-08 00:28:24 -0400] UForgotten: I'm confused.
[2012-04-08 00:28:41 -0400] UForgotten: I thought you could not run a chef server that was not opscode. that is what I was asking.
[2012-04-08 00:28:49 -0400] hoover_damm: totally can
[2012-04-08 00:29:05 -0400] hoover_damm: you are free to host your own chef server, or to purchase a private chef server managed for you
[2012-04-08 00:29:14 -0400] hoover_damm: the only cost is your server cost
[2012-04-08 00:29:20 -0400] UForgotten: I could not find any info on the website on that!
[2012-04-08 00:29:45 -0400] hoover_damm: http://wiki.opscode.com/display/chef/Installing+Chef+Server
[2012-04-08 00:30:07 -0400] UForgotten: they sure dont make that easy to find
[2012-04-08 00:30:41 -0400] UForgotten: thank you
[2012-04-08 00:31:13 -0400] UForgotten: thats what I was getting at about running a community version. just browsing the site it only leads you towards purchasing hosted chef server
[2012-04-08 00:33:02 -0400] hoover_damm: totally does
[2012-04-08 07:03:47 -0400] coderanger: opscode.com is about the commercial products, just use the wiki if you want FOSS info
[2012-04-08 08:07:04 -0400] Null_route: Hi guys -
[2012-04-08 08:07:43 -0400] Null_route: How would I write a recipe block which will do a .each on a node's tags?
[2012-04-08 08:08:29 -0400] Null_route: something simple like node["tags"].each probably...
[2012-04-08 08:28:56 -0400] coderanger: Yahr
[2012-04-08 09:07:45 -0400] Null_route: Hi guys -
[2012-04-08 09:07:50 -0400] Null_route: silly ruby question
[2012-04-08 09:08:08 -0400] Null_route: what does the ":" mean in variable names?
[2012-04-08 09:08:11 -0400] Null_route: default[:gateways][:install_dir]
[2012-04-08 09:08:21 -0400] Null_route: why do those have colons?
[2012-04-08 09:09:17 -0400] renchap: its a symbol
[2012-04-08 09:09:46 -0400] renchap: http://www.troubleshooters.com/codecorn/ruby/symbols.htm
[2012-04-08 09:10:17 -0400] Null_route: cool!
[2012-04-08 09:10:19 -0400] Null_route: thanks renchap
[2012-04-08 09:58:09 -0400] jacobat: How would I go about setting up a load balancer that balances to a set of web servers? I am thinking I could search for servers with the given role, take the IP's of those servers and generate a load balancer config from that. Sounds reasonable?
[2012-04-08 10:38:00 -0400] coderanger: jacobat: search(:node, 'roles:webserver').map{|n| n['ipaddress']}
[2012-04-08 10:53:26 -0400] jacobat: coderanger: I was wondering if it is a sensible way to do it
[2012-04-08 10:54:30 -0400] ranjibd: jacobat, whats wrong with the above snipplet. ?
[2012-04-08 10:55:13 -0400] jacobat: Nothing I assume. But my question was if it was a sensible way to do it or if there was a better way.
[2012-04-08 10:55:43 -0400] jacobat: I'm new to chef so I'm not quite sure if I'm missing anything obvious
[2012-04-08 10:59:43 -0400] jacobat: I would like a setup where I can easily add or remove backends from the load balancer
[2012-04-08 13:56:01 -0400] sampikesley: I doubt many of you are here today
[2012-04-08 13:56:02 -0400] sampikesley: but
[2012-04-08 13:57:06 -0400] sampikesley: I have a template that uses a value from at attribute file 'default[foo] = "bar"'
[2012-04-08 13:57:34 -0400] sampikesley: first chef-client run, it gets picked up correctly and that value appears as "bar" in template-generated file
[2012-04-08 13:57:36 -0400] sampikesley: fine
[2012-04-08 13:57:38 -0400] sampikesley: all is good
[2012-04-08 13:57:39 -0400] sampikesley: however
[2012-04-08 13:58:02 -0400] sampikesley: I then change that value in the attribute file, so 'default[foo] = "tomato"'
[2012-04-08 13:58:19 -0400] sampikesley: actually 'default["foo"] = "tomato"'
[2012-04-08 13:58:25 -0400] sampikesley: and rerun it
[2012-04-08 13:58:31 -0400] sampikesley: and I get the old value still
[2012-04-08 13:59:12 -0400] sampikesley: I've tried deleting the file before the run, deleting cached files, I've checked on the server WebUI and it has the updated value
[2012-04-08 13:59:46 -0400] sampikesley: I've grepped through the files on the client and the workstation and I cannot find the "bar" string anywhere
[2012-04-08 13:59:53 -0400] sampikesley: and yet still it comes back
[2012-04-08 13:59:58 -0400] sampikesley: any ideas what I'm missing?
[2012-04-08 14:01:19 -0400] asg: sampikesley: did you re-upload the cookbook after the change? Also, do you have cookbook versions pinned in an environment?
[2012-04-08 14:06:09 -0400] sampikesley: reupload, yes
[2012-04-08 14:06:13 -0400] sampikesley: no version pinning
[2012-04-08 14:08:35 -0400] asg: sampikesley: maybe run chef-client with -l debug to see if anything obvious pops up. Otherwise, I'm not sure where the issue could be.
[2012-04-08 14:12:30 -0400] asg: sampikesley: also, check that the node doesn't have an old 'normal' or 'override' variable of the same name; those have higher precidence than 'default' and persist on a node even if cookbooks that originally set them with default parameters are removed. 'knife node show <foo> -Fj' will let you see all node data.
[2012-04-08 14:30:46 -0400] sampikesley: yeah
[2012-04-08 14:30:47 -0400] sampikesley: shit
[2012-04-08 14:31:05 -0400] sampikesley: found it as a 'normal' attribute there
[2012-04-08 14:31:15 -0400] sampikesley: how can I nuke this?
[2012-04-08 14:31:23 -0400] sampikesley: it must've got nailed in on the first run
[2012-04-08 14:33:16 -0400] asg: sampikesley: you can remove it with knife node edit
[2012-04-08 14:33:45 -0400] sampikesley: ah
[2012-04-08 14:33:47 -0400] sampikesley: No
[2012-04-08 14:33:52 -0400] sampikesley: I think I understand now
[2012-04-08 14:34:12 -0400] sampikesley: changed attribute file to 'normal['foo'] = 'tomato''
[2012-04-08 14:34:14 -0400] sampikesley: and it works
[2012-04-08 14:34:18 -0400] sampikesley: thanks :)
[2012-04-08 14:34:32 -0400] asg: you're welcome
[2012-04-08 14:35:03 -0400] sampikesley: yurp
[2012-04-08 14:35:11 -0400] sampikesley: several things just becams emuch clearer :)
[2012-04-08 15:38:03 -0400] jacobat: Why does "Processing remote_file[http://nginx.org/download/nginx-1.0.14.tar.gz] action create" take several seconds to run on each client run? Does it contact the remote server over and over?
[2012-04-08 16:09:10 -0400] benner: I have question: if node is compromised so using chef api, bad guy can do whole infrastructure search?
[2012-04-08 16:15:17 -0400] ranjibd: jacobat, have you specified the checksum?
[2012-04-08 16:15:35 -0400] ranjibd: i guess it will download and chef the file every time other wise
[2012-04-08 16:16:00 -0400] ranjibd: benner, yes.
[2012-04-08 16:16:04 -0400] jacobat: ranjibd: It's straight out of the official cookbook repository I believe
[2012-04-08 16:16:32 -0400] jacobat: https://github.com/opscode-cookbooks/nginx/blob/master/recipes/source.rb
[2012-04-08 16:16:41 -0400] jacobat: It seems there's no checksum
[2012-04-08 16:18:36 -0400] ranjibd: remote_file?
[2012-04-08 16:18:37 -0400] bawt: remote_file is http://wiki.opscode.com/display/chef/Resources#Resources-RemoteFile
[2012-04-08 16:19:44 -0400] jacobat: Does this mean that anyone that uses that recipe will keep on hammering the nginx site?
[2012-04-08 16:20:47 -0400] ranjibd: i have a feeling so.. :-0(
[2012-04-08 16:21:08 -0400] jacobat: That sounds like a bad idea :)
[2012-04-08 16:21:35 -0400] ranjibd: you can add , not_if {File.exists?src_filepath}
[2012-04-08 16:21:40 -0400] ranjibd: and that should fix it
[2012-04-08 16:21:50 -0400] jacobat: Sure... or change the action to create_if_missing I guess
[2012-04-08 16:22:05 -0400] ranjibd: yup, that would be much cleaner
[2012-04-08 16:22:26 -0400] ranjibd: benner, as of now, theres only one level of authorization in chef apiclients
[2012-04-08 16:22:31 -0400] ranjibd: either admin, or not
[2012-04-08 16:22:52 -0400] ranjibd: but all can search the infra data, thats there in solr
[2012-04-08 16:24:26 -0400] jacobat: ranjibd: Thanks for the help :-)
[2012-04-08 16:29:53 -0400] terryjfundak: jtimberman: Is this webpage http://jtimberman.posterous.com/managing-my-workstations-with-chef still the definitive how to for best practices for a Mac OS X Lion build for a new machine? Any work around for the Xcode dependency or a better way to bootstrap the build the process as in a "NetInstall"  recipe or a "NetRestore" from a raw untouched Apple image.. or better . Anyone got a project to put the image straight from a Software Update Serve
[2012-04-08 16:29:54 -0400] terryjfundak: even via the same mechanism that Apple uses to build a machine via IPv6 back to the master image - ie. Lion Recovery Disk ( a minimum starting point, I think)?
[2012-04-08 16:45:40 -0400] ashb: terryjfundak: re Xcode: you can get just hte 'Command Line Tools for Xcode' which is much smaller
[2012-04-08 16:48:57 -0400] ashb: 170mb rather than 3gb
[2012-04-08 16:53:22 -0400] terryjfundak: ashb: It appears that Joshua Timberman said: Joshua Timberman responded:
[2012-04-08 16:53:22 -0400] terryjfundak: Nathan, I tried that at first on my iMac w/ Lion, but because I switched to installing Emacs from homebrew w/ Cocoa, I had to install Xcode in order to have the headers for the GUI bits.
[2012-04-08 16:55:09 -0400] terryjfundak: So I was wondering if others had gotten clever ideas to move the build process back towards Apples servers.. or a better plan.
[2012-04-08 16:55:32 -0400] terryjfundak: Anyone got a better starting recipe?
[2012-04-08 16:56:48 -0400] ashb: ah
[2012-04-08 16:56:52 -0400] ashb: can't help then, sorry
[2012-04-08 17:38:40 -0400] jtimberman: terryjfundak: its not a "definitive" anything. it is the approach i use for my own systems, though the blog itself is now at jtimberman.housepub.org, and i'll be making another post there on the topic at some point in the future.
[2012-04-08 17:39:42 -0400] terryjfundak: thanx. I'm working my ideas also....
[2012-04-08 18:02:24 -0400] abstrusenick: I'm using chef-solo and keep getting no ruby in PATH/CONFIG
[2012-04-08 18:03:09 -0400] ranjibd: abstrusenick, have you bootstrapped the node?
[2012-04-08 18:03:16 -0400] abstrusenick: yes i did
[2012-04-08 18:03:20 -0400] ranjibd: can you pastebin your error?
[2012-04-08 18:03:27 -0400] ranjibd: which template you used?
[2012-04-08 18:06:41 -0400] abstrusenick: https://gist.github.com/2338833
[2012-04-08 18:07:20 -0400] abstrusenick: getting diff error now
[2012-04-08 18:13:27 -0400] abstrusenick: ranjibd: https://gist.github.com/2338884
[2012-04-08 18:13:45 -0400] abstrusenick: I'm using chef-solo
[2012-04-08 18:17:02 -0400] ranjibd: something is wrong
[2012-04-08 18:17:14 -0400] ranjibd: u cant use search in chef-solo
[2012-04-08 18:18:18 -0400] ranjibd: whats in your runlist ?
[2012-04-08 18:18:20 -0400] abstrusenick: i used the recipes from community site
[2012-04-08 18:18:37 -0400] ranjibd: which recipes?
[2012-04-08 18:18:48 -0400] abstrusenick: https://gist.github.com/2338916
[2012-04-08 18:18:55 -0400] ranjibd: u cant use all the recipes.. specifically those which uses search
[2012-04-08 18:19:23 -0400] abstrusenick: how do i know which one supports chef-solo?
[2012-04-08 18:20:36 -0400] ranjibd: abstrusenick,  http://stackoverflow.com/questions/9882074/how-do-i-create-user-account-by-chef-solo
[2012-04-08 18:21:28 -0400] ranjibd: abstrusenick, theres no direct way, but its standard practice to check the chef run mode (solo or client/server), but it depends upon the cookbook writers to enforce this
[2012-04-08 18:21:49 -0400] ranjibd: otherwise u can grep for `search` inside the cookbook
[2012-04-08 18:31:28 -0400] abstrusenick: so if there is search method call, i can't use that recipe?
[2012-04-08 18:36:20 -0400] ranjibd: yeah
[2012-04-08 19:30:20 -0400] jtgiri_: hello, I am trying to find the Ip address for nagios server in a recipe, I am doing this http://pastebin.com/LhGPGBHE, but mon_host doesn't seem to get IP address. If I do the same query with knife it works fine , any ideas ?
[2012-04-08 21:01:15 -0400] hoover_damm: knife exec -E 'nodes.transform("*:*") {|n| puts "name: #{n.name} #{n.ec2.instance_id}"}' | sort -n
[2012-04-08 21:01:18 -0400] hoover_damm: is there an easier way to do this?
[2012-04-08 21:01:45 -0400] hoover_damm: I thought search node ec2.instance_id would work or ec2_instance_id but clearly I suck at solr this morning
[2012-04-08 21:02:30 -0400] eugenmayer: Hello. Trying to deploy a cookbook a employee wrote, but iam getting stuck
[2012-04-08 21:03:24 -0400] eugenmayer: he is using data-bags to fetch node-specfic data, which sounds very wrong to me. I guess those needs to be saved in the node-attributes, as databags are rather the global-attributes, right?
[2012-04-08 21:03:55 -0400] eugenmayer: http://pastie.org/3751996
[2012-04-08 21:04:09 -0400] eugenmayer: how would i actually get data from the current node, the reciepe gets deployed to?
[2012-04-08 21:05:03 -0400] eugenmayer: currently, iam looking at http://wiki.opscode.com/display/chef/Cookbook+Fast+Start+Guide
[2012-04-08 21:19:22 -0400] z: eugenmayer: That's not actually all that awful. It's just allowing you to take an original /etc/hosts and add on a series of data contained within a data bag.
[2012-04-08 21:20:07 -0400] eugenmayer: z: yes, but i want 2 things. Pull 3/4 vars out of a databag ( globals ) and pull 3/4 vars from the node (clientip, hostname )
[2012-04-08 21:20:17 -0400] eugenmayer: it does not make any sense having databags for each client
[2012-04-08 21:20:54 -0400] z: well the chances are the node was already setup in /etc/hosts and will be contained in /etc/hosts.kw.orig
[2012-04-08 21:21:38 -0400] z: if it was written by an employee, ping them?
[2012-04-08 21:26:53 -0400] hoover_damm: pinging the employee is the best bet
[2012-04-08 21:28:58 -0400] eugenmayer: z: he actually moved on to a new job and is unavail. Iam just overtaking here to finish this small task
[2012-04-08 21:29:42 -0400] eugenmayer: i guess i have to read more docs to go on. More or less iam look on how to fetch "the current nodes vars." instead of "the attribs auf databag X"
[2012-04-08 21:33:13 -0400] hoover_damm: search is likely a better manner
[2012-04-08 21:33:16 -0400] hoover_damm: then both of your patterns
[2012-04-08 21:33:59 -0400] z: eugenmayer: Are you using this with Hosted Chef, do you have an internal server, or is this running under chef-solo?
[2012-04-08 21:34:09 -0400] eugenmayer: internal server
[2012-04-08 21:34:13 -0400] hoover_damm: nodes.transform("*:*") {|n| puts "#{n.ec2.private_ipv4.first} #{n.name} #{n.tags}" }
[2012-04-08 21:34:26 -0400] eugenmayer: hoover_damm: that was for me?
[2012-04-08 21:34:58 -0400] hoover_damm: eugenmayer, setup an hash and pop it into that if you want, and then pass the hash to the template
[2012-04-08 21:35:03 -0400] hoover_damm: and then just iterate through it
[2012-04-08 21:35:09 -0400] hoover_damm: my_hosts=Hash.new
[2012-04-08 21:35:42 -0400] hoover_damm: nodes.transform("*:*") {|n| my_hosts << n}
[2012-04-08 21:35:49 -0400] hoover_damm: and you'll have a lot of data to sort through
[2012-04-08 21:36:10 -0400] eugenmayer: z: why are you asking?
[2012-04-08 21:36:11 -0400] hoover_damm: but it should be very easy to iterate that in a erb template and just own /etc/hosts completely
[2012-04-08 21:36:32 -0400] hoover_damm: it's possible to only own part of the file, or rewrite certain parts
[2012-04-08 21:36:33 -0400] eugenmayer: well, actually iam overrideing the /etc/hosts file. So taking over completely
[2012-04-08 21:36:37 -0400] hoover_damm: but it's harder to control the whole output
[2012-04-08 21:36:44 -0400] eugenmayer: yes, naturally. I undestand
[2012-04-08 21:36:53 -0400] hoover_damm: not everyone does :) so that's why I said it
[2012-04-08 21:40:51 -0400] benner: ranjibd_: so only one solution to solve this problem is to use many chef servers?
[2012-04-08 21:42:47 -0400] eugenmayer: hoover_damm: iam currently rather writing deb packages with debconf to deal with all those tasks and i kinda also like this. Sure, you dont have all the meta data centralized in one place (chef) so iam trying to move to this new approach. What i basically want to do is: http://pastie.org/3752175
[2012-04-08 21:49:04 -0400] eugenmayer: actually, iam thinking, thats a very classic issue to deal with chef. right. We need node-context wars (or roles) and global stuff. We overtake the whole etc/hosts file, so not partially. Could you maybe just point me at docs i should read? My problem is, i dived into chef 2 years ago, then i had to deal with other things and hired an employee the last year, but he could not finish it. I guess i have to deal with it myself now and fres
[2012-04-08 21:53:20 -0400] eugenmayer: looks like http://wiki.opscode.com/display/chef/Cookbook+Fast+Start+Guide basically covers it all, the only thing iam not sure about is, what attributes mean
[2012-04-08 21:54:43 -0400] eugenmayer: are those the attributes a node can set? are those "attributes" overriden by the most inner context? (or if not, global databags). Iam just suprised our employe really directly fetching from a databag, vars like clientip or hostname which are individual for every node and writing down in the docs "create a databag for each node"
[2012-04-08 21:56:08 -0400] z: eugenmayer: As you've already spotted, Chef is quite flexible :) Its possible (and not that hard) to programmatically generate [encrypted] data bags, and I know at least a couple of places do that when server(s) are installed or spun up.
[2012-04-08 21:56:59 -0400] z: e.g; Documenting that each node needs a manually created one is a bit kipper-ish, but if the long-term intent was to automate the data bags. Meh.
[2012-04-08 21:57:38 -0400] eugenmayer: maybe, but thats not my intentetions and its horrible to maintain
[2012-04-08 21:57:55 -0400] eugenmayer: as i cant overlook all the vars of a node, but need to find its databags and all this.
[2012-04-08 21:58:47 -0400] eugenmayer_: Switching to ip*d :)
[2012-04-08 22:00:24 -0400] eugenmayer: z iam not going to waste your time here. Just trying to start with the right idea. Sure, i need to go through some docs deeply. but maybe you could jump start me with this single question
[2012-04-08 22:01:17 -0400] eugenmayer: In templates, how are attributes ( nodes, roles ) and maybe even databags "exposed". Do i need to manually "import" them, or are they, like in the fast_start examle, available like this attribute (daily message)#
[2012-04-08 22:01:43 -0400] z: your example actually covers this one...
[2012-04-08 22:01:47 -0400] z: http://pastie.org/3751996
[2012-04-08 22:01:56 -0400] z: http://wiki.opscode.com/display/chef/Data+Bags
[2012-04-08 22:02:03 -0400] eugenmayer: maybe i have missread it. I will read through it slowly once again.
[2012-04-08 22:02:43 -0400] z: so in this line...
[2012-04-08 22:02:43 -0400] z: data = data_bag_item('kwnodes', node.name)
[2012-04-08 22:02:56 -0400] z: you are pulling the data bag "item" with node.name out from 'kwnodes'
[2012-04-08 22:03:07 -0400] eugenmayer: yes some databag is explicitly included. Thats clear
[2012-04-08 22:03:20 -0400] z: and then the next two lines (clientip, clienthostname) reference that
[2012-04-08 22:03:30 -0400] eugenmayer: Yes, undestood that
[2012-04-08 22:03:35 -0400] z: data['clientip'] is effectively pulling node.name['clientip']
[2012-04-08 22:03:47 -0400] z: well, sorry, that could be misread :)
[2012-04-08 22:03:59 -0400] eugenmayer: wait. Maybe iam missing something
[2012-04-08 22:04:12 -0400] z: sorry thats my *very* poor explanation :)
[2012-04-08 22:04:26 -0400] eugenmayer: What i read there is, that data is pulled from the databag, but no vars are pulled from the node-context, right?
[2012-04-08 22:04:33 -0400] z: that is correct
[2012-04-08 22:04:59 -0400] eugenmayer: ok, iam rather interested in how i access "node attributes"
[2012-04-08 22:05:01 -0400] z: what you could do is
[2012-04-08 22:05:44 -0400] z: clientip = @ohai.get_interface_ip("eth0")
[2012-04-08 22:06:02 -0400] z: which I think would avoid you needing to add info about every host to that databag
[2012-04-08 22:06:40 -0400] eugenmayer: no, wait. This needs to be set manually mostly
[2012-04-08 22:06:50 -0400] eugenmayer: or wait, not really
[2012-04-08 22:06:57 -0400] eugenmayer: actually it would be
[2012-04-08 22:07:15 -0400] z: so to edit node attributes you can just do 'knife node edit <blah>'
[2012-04-08 22:07:17 -0400] eugenmayer: "maintain_ip = @ohai.get_interface_ip("maintainbr0")
[2012-04-08 22:07:32 -0400] z: and if you store your nodes in Git or similar you can 'knife node from file blahblah.json'
[2012-04-08 22:07:46 -0400] eugenmayer: _how to access node attributes in the template_ :)
[2012-04-08 22:07:48 -0400] z: http://wiki.opscode.com/display/chef/Attributes#Attributes-NodeAttributes
[2012-04-08 22:08:16 -0400] z: if node.chef.attribute?("webui_enabled") # set up webui stuff
[2012-04-08 22:08:17 -0400] z: end
[2012-04-08 22:08:22 -0400] z: ^ somethign like that
[2012-04-08 22:08:34 -0400] eugenmayer: z++
[2012-04-08 22:08:39 -0400] eugenmayer: great!!! Thank you
