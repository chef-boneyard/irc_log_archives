[2012-01-03 11:23:00 -0500] matti: :)
[2012-01-03 11:27:00 -0500] oponder: I broke my chef. He doesn't want to cook anymore.
[2012-01-03 11:28:00 -0500] oponder: Should compiling gecode take more than 10 minutes?
[2012-01-03 11:28:00 -0500] matti: Am, seems rather long.
[2012-01-03 11:29:00 -0500] oponder: This is what i'm getting when I try to start my chefserver (sudo chef-server -N -e production): http://pastie.org/3117807
[2012-01-03 11:29:00 -0500] oponder: so I tried making sure everything was up to date
[2012-01-03 11:29:00 -0500] oponder: by following this guide: http://wiki.opscode.com/display/chef/Upgrading+Chef+0.9.x+to+Chef+0.10.x
[2012-01-03 11:30:00 -0500] oponder: and then I thought maybe my rubygems version was _too_ up to date, so I downgraded it to 1.7.2, which is what I see in the dependency list somewhere else in the chef setup guide
[2012-01-03 11:30:00 -0500] oponder: if anyone recognizes the error in the pastie, and remembers what they did to fix it, i'd be much obliged
[2012-01-03 11:37:00 -0500] oponder: hmm, i had to bring my rubygem version all the way down to 1.3.7
[2012-01-03 11:45:00 -0500] matti: oponder: There is a ticket log against this issue: http://tickets.opscode.com/browse/CHEF-2138
[2012-01-03 11:45:00 -0500] matti: Oh.
[2012-01-03 11:45:00 -0500] matti: You know ;]
[2012-01-03 11:45:00 -0500] oponder: :) thanks matti
[2012-01-03 11:45:00 -0500] matti: Since your comment on the bottom ;p
[2012-01-03 11:51:00 -0500] oponder: Im thinking of changing my nick to just Oliver
[2012-01-03 11:51:00 -0500] oponder: oponder sounds kinda irish or something
[2012-01-03 11:51:00 -0500] oponder: ey o'ponder
[2012-01-03 11:51:00 -0500] oponder: nothing against the Irish
[2012-01-03 11:52:00 -0500] matti: Hehe
[2012-01-03 11:53:00 -0500] matti: I wonder.
[2012-01-03 11:53:00 -0500] matti: http://tickets.opscode.com/browse/OHAI-295 could be boosted by https://github.com/kwilczynski/facter-facts/blob/master/lxc.rb
[2012-01-03 12:04:00 -0500] laurent\: qcgroup = resolution.exec('cat /proc/1/cgroup 2> /dev/null')
[2012-01-03 12:04:00 -0500] laurent\: YUK
[2012-01-03 12:16:00 -0500] matti: laurent\: Why? Because it is using cat?
[2012-01-03 12:17:00 -0500] matti: laurent\: There is a common pattern which dictated against using IO.read on /proc in Facter / Ruby (citation needed).
[2012-01-03 12:18:00 -0500] matti: wb oponder
[2012-01-03 12:22:00 -0500] matti: wb oponder
[2012-01-03 12:22:00 -0500] matti: Ops.
[2012-01-03 12:22:00 -0500] oponder: thanks and thanks
[2012-01-03 12:23:00 -0500] oponder: how much ram do you guys put on your chef server boxes?
[2012-01-03 12:23:00 -0500] oponder: I feeling like 512 isn't cutting it now that I've also put the nagios server on there
[2012-01-03 12:32:00 -0500] laurent\: matti: yep, i'd love to know why
[2012-01-03 12:33:00 -0500] matti: laurent\: Older versions of Ruby (1.8.x) had issues reading /proc entires.
[2012-01-03 12:33:00 -0500] matti: laurent\: They literally hung on these psudo-files.
[2012-01-03 12:33:00 -0500] matti: *pseudo
[2012-01-03 12:33:00 -0500] matti: laurent\: Since a lot of people is using ancient things like RHEL and CentOS and so on.
[2012-01-03 12:34:00 -0500] matti: laurent\: Which quite often have 1.8.4, 1.8.6 etc.
[2012-01-03 12:34:00 -0500] matti: laurent\: People used to open a lot of tickets against Facter hanging.
[2012-01-03 12:34:00 -0500] matti: laurent\: And it was traced to this particular problem.
[2012-01-03 12:35:00 -0500] matti: laurent\: It boils down to the sheer fact, that IO.read is more complex under the hood -- Ruby is trying to spent as fever time on blocking IO as possible and wraps-around a lot of magic there.
[2012-01-03 12:35:00 -0500] matti: laurent\: And it used to be broken.
[2012-01-03 12:35:00 -0500] matti: laurent\: Modern versions does not suffer from this.
[2012-01-03 12:36:00 -0500] matti: laurent\: In other words: combination of kernel bug, Ruby issue with IO.read and hanging Facter made people use things like "cat" and "grep".
[2012-01-03 12:36:00 -0500] matti: laurent\: This is sadly the reason, why Facter tends to take long time to run, quite often.
[2012-01-03 12:37:00 -0500] matti: laurent\: I do agree that it is not-quite-pretty, but it does the job and fits within the common pattern / approach.
[2012-01-03 12:38:00 -0500] laurent\: ok, thx for your answer. i don't what facter is tho, guess it's a puppet thing
[2012-01-03 12:39:00 -0500] matti: Oh sorry.
[2012-01-03 12:39:00 -0500] matti: Its the equivalent of Ohai in Puppet.
[2012-01-03 12:39:00 -0500] laurent\: oh ok.
[2012-01-03 12:41:00 -0500] matti: :)
[2012-01-03 12:42:00 -0500] matti: laurent\: Concerning the LXC detection -- I was more about combining detection vectors in order to make it work better and detect more :)
[2012-01-03 12:42:00 -0500] laurent\: i'd love to find references to that kind of patterns. would be valuable info. didn't know of this one, for now i guess i will stop replacing exec cat by io.read :)
[2012-01-03 12:42:00 -0500] matti: laurent\: With modern kernels and recent Ruby it should not be a problem.
[2012-01-03 12:43:00 -0500] matti: laurent\: There are a few tickets about that in Puppet Labs's Redmine if you fancy to entertain yourself :)
[2012-01-03 12:44:00 -0500] laurent\: yeah but as you said it's nice to think about the poor guys running rhel5 and all :-)
[2012-01-03 12:44:00 -0500] matti: Its troublesome.
[2012-01-03 12:44:00 -0500] matti: Even for developers.
[2012-01-03 12:44:00 -0500] matti: I had number of tickets "this breaks for me ..." opened on github.
[2012-01-03 12:45:00 -0500] laurent\: ok. about the lxc detection i'm also interested as i'm running a bunch of them
[2012-01-03 12:45:00 -0500] matti: Just to find out that Ruby version was from the time when Matz was young and beautiful.
[2012-01-03 12:45:00 -0500] laurent\: lol
[2012-01-03 12:45:00 -0500] matti: :>
[2012-01-03 12:48:00 -0500] laurent\: it's difficult to rely on lxc tools, their syntax have changed a lot lately
[2012-01-03 13:02:00 -0500] `brendan: good morning folks
[2012-01-03 13:12:00 -0500] matti: Hey w00 :)
[2012-01-03 13:54:00 -0500] smith3v: Hi, all
[2012-01-03 14:07:00 -0500] binbasti: hi. i have a problem with the deployment of a rails app. somehow before_symlink.rb isn't executed at all, but before_restart and after_restart work fine. can someone give me a hint how to debug this?
[2012-01-03 14:42:00 -0500] binbasti: ah got it. wasn't executed because before_symlink is defined in the rails recipe
[2012-01-03 14:58:00 -0500] dyer: jtimberman, u around ?
[2012-01-03 14:58:00 -0500] dyer: Have a question have the Dynect cookbook u created
[2012-01-03 15:00:00 -0500] maxrabin: Hi, whenever I run `knife ssh` with any QUERY it returns "FATAL: No nodes returned from search!" no matter what the query is. I can do `knife search` and see my servers, but not with ssh. Any ideas?
[2012-01-03 15:07:00 -0500] ashb: what search are you trying?
[2012-01-03 15:20:00 -0500] maxrabin: anything!
[2012-01-03 15:20:00 -0500] maxrabin: but even `knife ssh role:webserver uptime`
[2012-01-03 15:20:00 -0500] maxrabin: or `knife ssh name:* uptime`
[2012-01-03 15:32:00 -0500] BryanWB: atomic-penguin, hope u r enjoying today's weather
[2012-01-03 15:32:00 -0500] atomic-penguin: It sucks
[2012-01-03 15:33:00 -0500] atomic-penguin: I can feel the electric bill exploding
[2012-01-03 15:33:00 -0500] atomic-penguin: I only have electric heat pump.  Should really get some gas logs to cut it down.
[2012-01-03 15:34:00 -0500] BryanWB: atomic-penguin, sorry to hear that , i left Boone 14 hours ago, my wife is still there and says it is incredibly freaking cold
[2012-01-03 15:34:00 -0500] atomic-penguin: An average daily temp of 50 through December was awesome though
[2012-01-03 15:34:00 -0500] BryanWB: my kind of weather ;)
[2012-01-03 15:34:00 -0500] atomic-penguin: What the incredible cold?
[2012-01-03 15:35:00 -0500] BryanWB: atomic-penguin, no, 50 F and above ;)
[2012-01-03 15:35:00 -0500] atomic-penguin: Yes that
[2012-01-03 15:35:00 -0500] atomic-penguin: I did get a sweet programmable wi-fi thermostat that has helped with the heating/cooling bill though
[2012-01-03 15:36:00 -0500] atomic-penguin: Its already payed for itself, since I installed it this summer
[2012-01-03 15:41:00 -0500] bourke: Could anyone point me to where I can read more on the datastructure used for chef attributes?  Googling "ruby mash" doesn't seem to give much..
[2012-01-03 15:43:00 -0500] BryanWB: bourke, hmm, maybe try the rdoc documentation?
[2012-01-03 15:43:00 -0500] BryanWB: it might be in here somewhere http://rubydoc.info/gems/chef/0.10.8/Chef
[2012-01-03 15:45:00 -0500] bourke: BryanWB: thanks ill have a poke around there.  Main reason Im asking is I have some packages that I have a list of attributes that need to be processed in a specific order, but the mash seems to be un-ordered
[2012-01-03 15:46:00 -0500] BryanWB: bourke, some packages? could u be more specific?
[2012-01-03 15:46:00 -0500] bourke: BryanWB: Sorry didnt type that very well.  Basically I have a list of packages to be installed specified in attributes
[2012-01-03 15:46:00 -0500] bourke: then a recipe reads that list and uses the package resource to install them
[2012-01-03 15:47:00 -0500] bourke: (these are apt packages)
[2012-01-03 15:47:00 -0500] bourke: but say I need package A to be installed before package B.  Specifiying them in that order in the attributes isn't working
[2012-01-03 15:47:00 -0500] BryanWB: bourke, hmm, maybe make that list an array?
[2012-01-03 15:48:00 -0500] BryanWB: rather than hash, as hashes and hash derivatives are unordered by nature
[2012-01-03 15:48:00 -0500] bourke: BryanWB: Just what I was thinking :) Dont suppose you have any examples of using arrays in Chef rather than mashes/hashes ?
[2012-01-03 15:48:00 -0500] bourke: Or is it pretty much the same..
[2012-01-03 15:49:00 -0500] BryanWB: bourke:   node['some_val']['my_packages_in_order'] = [ 'pkg1', 'pkg2', 'pkg3' ]
[2012-01-03 15:50:00 -0500] bourke: BryanWB: Gotcha, thanks a lot
[2012-01-03 15:50:00 -0500] BryanWB: node['some_val']['my_packages_in_order'].each do package         # will install packages in order
[2012-01-03 15:50:00 -0500] bourke: Perfect
[2012-01-03 16:05:00 -0500] jtimberman: dyer: I didn't create that cookbook, but I'm happy to help if I can :)
[2012-01-03 16:17:00 -0500] bourke: BryanWB: Would you mind taking a glance at this? http://pastie.org/3119163 My Ruby's not great.. Chef is giving an 'undefined method keys' on line 9
[2012-01-03 16:17:00 -0500] bourke: which makes me think my 'packages' attribute is not iterable. Though it works in irb..
[2012-01-03 16:22:00 -0500] jtimberman: bourke: you'reu sing an array of arrays
[2012-01-03 16:22:00 -0500] jtimberman: you probably want a hash
[2012-01-03 16:22:00 -0500] rrichardsr3: re: testing - it would be good if we could use some form of cloud mock ;)
[2012-01-03 16:22:00 -0500] jtimberman: .keys is not a method of Array, but it is of Hash (or Mash, which is what Chef Node attributes use)
[2012-01-03 16:23:00 -0500] jtimberman: Mash is *like* Hash.
[2012-01-03 16:23:00 -0500] bourke: jtimberman: yes, unfortunately I need the ordering preserved though. That's why BryanWB suggested I try an array
[2012-01-03 16:23:00 -0500] bourke: though he didnt know I need to store multiple values for each entry..
[2012-01-03 16:23:00 -0500] rrichardsr3: Seeking knowledge - are there any formal approaches (aka discussed/posted examples) on planning an automation strategy?
[2012-01-03 16:24:00 -0500] BryanWB: rrichardsr3, argh, not yet afaik
[2012-01-03 16:24:00 -0500] rrichardsr3: as most formal IT shops wants documentation and project plans
[2012-01-03 16:24:00 -0500] rrichardsr3: BryanWB: hadnt seen any - was just curious - thanks
[2012-01-03 16:25:00 -0500] BryanWB: rrichardsr3, for me, i started by re-implementing my shell scripts for setting up new servers w/ chef
[2012-01-03 16:25:00 -0500] BryanWB: rrichardsr3, then to configuring application stack
[2012-01-03 16:25:00 -0500] BryanWB: and i made a plan for my mgrs accordingly
[2012-01-03 16:26:00 -0500] rrichardsr3: BryanWB: sounds reasonable. Im currently trying to document every little thing that is needed in one environment im working with. Lots of little pieces. Spreadsheet seems to work. lol do this, then do this heh
[2012-01-03 16:26:00 -0500] BryanWB: rrichardsr3, that's what i did
[2012-01-03 16:27:00 -0500] rrichardsr3: BryanWB: ok cool - then im not crazy ;) (yet)
[2012-01-03 16:27:00 -0500] bourke: jtimberman: Its strange for example I can do this in the ruby interpreter: http://pastie.org/3119225
[2012-01-03 16:27:00 -0500] BryanWB: rrichardsr3, i also recommend bringing in an external trainer to teach team about chef, who should coincidentally reaffirm that your strategy was the right one
[2012-01-03 16:28:00 -0500] BryanWB: that's my "pointy headed boss" strategy
[2012-01-03 16:28:00 -0500] rrichardsr3: BryanWB: heh good idea
[2012-01-03 16:28:00 -0500] jtimberman: bourke: Right. .each is a valid method, but not .keys
[2012-01-03 16:28:00 -0500] jtimberman: hence "undefined method keys"
[2012-01-03 16:29:00 -0500] bourke: So where abouts is chef calling .keys? As Im attempting to use .each in my recipe..
[2012-01-03 16:29:00 -0500] jtimberman: oh.
[2012-01-03 16:30:00 -0500] matti: Hey jtimberman :)
[2012-01-03 16:30:00 -0500] jtimberman: matti: hi!
[2012-01-03 16:31:00 -0500] cwj: bourke: here's an idea for you, which i have not tested https://gist.github.com/1555647
[2012-01-03 16:33:00 -0500] bourke: cwj: ok cool. Though that's using hashes right?  So you can't be guaranteed foo will be installed before bar
[2012-01-03 16:37:00 -0500] cwj: bourke: yeah thats true, i guess i was assuming the ordering of phases was more important than the ordering of packages within phases, which may not be true
[2012-01-03 16:37:00 -0500] bourke: cwj: yeah, originally the order of phases was enough.  Though Im running into cases where package Y won't install before package X
[2012-01-03 16:38:00 -0500] cwj: which package manager/distribution are you working with?
[2012-01-03 16:38:00 -0500] bourke: apt
[2012-01-03 16:38:00 -0500] bourke:  /ubuntu
[2012-01-03 16:39:00 -0500] BryanWB: OT, is it worth the trouble to move from gnu screen to tmux?
[2012-01-03 16:39:00 -0500] cwj: because you have dependencies that need to be resolved correctly, you might try using some command resources to call dpkg --set-selections with the list of packages you need
[2012-01-03 16:39:00 -0500] cwj: then let apt-get or aptitude resolve it
[2012-01-03 16:40:00 -0500] cwj: instead of iterating over a list of packages with a package resource
[2012-01-03 16:40:00 -0500] cwj: but i havent tried that myself, so maybe there's a problem with that idea
[2012-01-03 16:40:00 -0500] arkadyan: I suspect I'm missing something basic, but when I bootstrap a new server one of the first things it does is update rails to the latest version and I don't want it to. I've tried setting attributes in my environment definition, and in the attributes of the cookbook I made for my rails project, all to no avail. Any pointers on a better place to be looking?
[2012-01-03 16:41:00 -0500] BryanWB: cwj, good piont, apt should resolve all the dependencies, making this a non'issue
[2012-01-03 16:43:00 -0500] cwj: BryanWB: re: screen vs. tmux, i like tmux quite a bit more, but i was never a "screen power user"
[2012-01-03 16:44:00 -0500] cwj: bbl
[2012-01-03 17:01:00 -0500] dyer: jtimberman, thanks, so question, will update create teh record if it doesnt exist?  Also any dependable way to clean up a record once an instance is removed?
[2012-01-03 17:02:00 -0500] dyer: for example, if I scale up to 10 instances w/ round robin a records, when an instance is torn down I would love that instances a record to be removed not sure if the recipe provides any means to do that
[2012-01-03 17:04:00 -0500] dyer: Hrm, also I am not sure why I am getting this:
[2012-01-03 17:04:00 -0500] dyer: [Tue, 03 Jan 2012 12:03:11 -0500] FATAL: DynectRest::Exceptions::RequestFailed: dynect_rr[node1-ext] (dynect::ec2 line 44) had an error: DynectRest::Exceptions::RequestFailed: Request failed: ERROR INVALID_REQUEST API-A - Unknown resource A (Requested URI: /REST/A/beta.test.net/node1-ext.beta.test.net)
[2012-01-03 17:05:00 -0500] rykr30: Question: Say I wanted to use uuidtools or another gem within a recipe.  How would I get the gem installed and how would I require it?
[2012-01-03 17:05:00 -0500] jtimberman: dyer: ah.. I probably write a knife plugin that wraps up ec2 instance, node, client and DNS deletes in one command.
[2012-01-03 17:06:00 -0500] dyer: k, I'll let the perculate
[2012-01-03 17:06:00 -0500] dyer: trying to figure out why its doing /REST/A, pretty sure that should eb ARecord
[2012-01-03 17:06:00 -0500] jtimberman: I don't know what that error is from.
[2012-01-03 17:07:00 -0500] dyer: from dynect_rest
[2012-01-03 17:18:00 -0500] CharlieSu: Does a zabbix-proxy and a zabbix-server  need to be the same version?  I have a proxy running 1.8.1 and i'm about to upgrade my server to 1.8.10
[2012-01-03 17:21:00 -0500] cwj: bourke: did you see my suggestion about using dpkg --set-selections instead of iterating over a list of packages?
[2012-01-03 17:22:00 -0500] bourke: cwj: yes thanks for that. Had a look but I think I may be stuck with the same problem in that I need to generate the file to feed --set-selections in a certain order.  I think I can work around the problem for now by simply juggling my install phases.
[2012-01-03 17:23:00 -0500] bourke: i would be interested to know however, why chef was throwing the 'keys' error when trying to do a .each on a 2d array
[2012-01-03 17:23:00 -0500] bourke: as I think if I could just iterate that structure I had originally it would be problem solved
[2012-01-03 17:24:00 -0500] cwj: --set-selections doesn't need to be in order. you provide a static file, or generate it, feed that into dpkg --set-selections and then use aptitude or apt-get to resolve the list of packages that should be installed
[2012-01-03 17:25:00 -0500] bourke: ok that may be useful then
[2012-01-03 17:28:00 -0500] dyer: question, where is the node name picked up from ? node.fqdn returns the fqdn, as expected, but when I register against chef its getting just the hostname
[2012-01-03 17:32:00 -0500] ssd7: dyer:  def node_name
[2012-01-03 17:32:00 -0500] ssd7:       name = Chef::Config[:node_name] || ohai[:fqdn] || ohai[:hostname]
[2012-01-03 17:36:00 -0500] dyer: argh, hostname returns the fqdn but hostname -f returns just the hostname ( node1 )
[2012-01-03 17:49:00 -0500] dyer: any chance Adam Jacob, the guy who wrote this cookbook, is around?
[2012-01-03 17:49:00 -0500] miketheman: dyer: what's all this?
[2012-01-03 17:49:00 -0500] miketheman: I'm curious
[2012-01-03 17:49:00 -0500] dyer: I am trying to use the dynect cookbook
[2012-01-03 17:49:00 -0500] dyer: having some issues
[2012-01-03 17:50:00 -0500] miketheman: it's all going base its information based of the metadat ohai reported back
[2012-01-03 17:52:00 -0500] miketheman: so on the target system, compare `ohai fqdn` `vs hostname -f` and `ohai hostname` vs `hostname -s`
[2012-01-03 17:53:00 -0500] dyer: nah, past that
[2012-01-03 17:54:00 -0500] dyer: having issues getting it working in general
[2012-01-03 17:54:00 -0500] miketheman: ah
[2012-01-03 17:54:00 -0500] dyer: Changing dynect_rr[node1-ext] rdata from {"address"=>"107.20.96.55"} to {"address"=>"107.20.96.54"}
[2012-01-03 17:54:00 -0500] dyer: I have 404 Resource Not Found: {"status": "failure", "data": null, "job_id": null, "msgs": [{"INFO": "Unknown resource A (Requested URI: /REST/A/beta._________.net/node1-ext.beta.____.net/20065385)", "SOURCE": "API-A", "ERR_CD": "INVALID_REQUEST", "LVL": "ERROR"}]} with 404
[2012-01-03 17:55:00 -0500] miketheman: ah, so api call on their end isn't being happy.
[2012-01-03 17:55:00 -0500] dyer: Not sure why its going to /REST/A, that should be ARecord according to the Dyn docs
[2012-01-03 17:55:00 -0500] dyer: https://api2.dynect.net/REST/ARecord/<zone>/<fqdn>/
[2012-01-03 17:55:00 -0500] miketheman: might be a bug in dynect_rest gem
[2012-01-03 17:55:00 -0500] dyer: dont think so, I was using the dynect gem in my deployment script before
[2012-01-03 17:56:00 -0500] dyer: worked fine, but I wanted to move this into chef rather then manually handling it via a deploy script  wrote
[2012-01-03 17:57:00 -0500] jslatts: anyone ever have issues with chef-solr crashing?
[2012-01-03 17:59:00 -0500] dyer: worked fine, but I wanted to move this into chef rather then manually handling it via a deploy script  wrote
[2012-01-03 17:59:00 -0500] dyer: the end game here is to create two hostname for each instances, node1.beta.foo.com and node1-ext.beta.foo.com
[2012-01-03 18:03:00 -0500] ssd7: dyer: hmm.  A quick look at the provider code and the dynect_rest code suggests you might be able to hack around this by changing your record type to "ARecord" rather than "A"
[2012-01-03 18:03:00 -0500] dyer: yea, thats what I am doing now
[2012-01-03 18:03:00 -0500] tolland: i have some nodes in an openstack cloud which dont have any access to their public facing addresses, that information is available from another system.
[2012-01-03 18:03:00 -0500] dyer: Seems like there are a few issues w/ the cookbook
[2012-01-03 18:03:00 -0500] dyer: thats kinda why I was hopeing to catch him here
[2012-01-03 18:04:00 -0500] tolland: I can set an attribute on these nodes such as public-ipv4 but these values wont be used in cookbooks like munin and nagios, is there some way to work that situation sensibly?
[2012-01-03 18:05:00 -0500] dyer: [root@node1 chef]# curl -s checkip.dyndns.org|sed -e 's/.*Current IP Address: //' -e 's/<.*$//'
[2012-01-03 18:05:00 -0500] dyer: 107.20.96.54
[2012-01-03 18:07:00 -0500] ssd7: tolland: Is there any data in the node's cloud attribute?  cloud.public_hostname or cloud.public_ipv4 for instance?
[2012-01-03 18:07:00 -0500] ssd7: bah, sorry, may have misread your message.
[2012-01-03 18:11:00 -0500] dyer: Hrm, ssd7, so I think I see whats happening, but I am not sure exactly why.  In the LWRC ( https://gist.github.com/9d83902c3ffc99d8d231
[2012-01-03 18:11:00 -0500] dyer:  ) I am using :update, which looks like it will update the record if it exists otherwise it will create it. In this case the record does exist, and just needs to be udpated.  This is where it seems to be defaulting to the default /REST/A behavior having troubling nailing down exactly WHY this is happening
[2012-01-03 18:14:00 -0500] tolland: ssd7: actually no I dont have those attributes, is there some ohai plugin or cookbook that i need to push out?
[2012-01-03 18:15:00 -0500] ssd7: tolland: I /thought/ there was an openstack plugin but I was mistaken now that I'm looking at ohai
[2012-01-03 18:16:00 -0500] tolland: dyer: yeah, I can get the public ip address, i guess i need to know how to over ride the ip address that chef server is seeing the client as so it can set munin.conf correctly.
[2012-01-03 18:17:00 -0500] dyer: could you override it  ?
[2012-01-03 18:17:00 -0500] dyer: node.automatic_attrs
[2012-01-03 18:18:00 -0500] dyer: node.automatic_attrs["dirty_ass_hack"] = `curl -s checkip.dyndns.org|sed -e 's/.*Current IP Address: //' -e 's/<.*$//'`
[2012-01-03 18:20:00 -0500] dyer: argh, this is driving me #$%$ mad, really wish I could get a handle on what the $%#$% this cookbook is doing...
[2012-01-03 18:22:00 -0500] dyer: Can anyone tell me where @new_resource is comming from here ? https://gist.github.com/5dcbe1d4b37b0ccd41d0
[2012-01-03 18:25:00 -0500] ssd7: @new_resource is from your resource declaration in the recipe
[2012-01-03 18:26:00 -0500] dyer: Not seeing this sorry but I have never done a LWRP.
[2012-01-03 18:26:00 -0500] dyer: so decyphering one is slow going...
[2012-01-03 18:28:00 -0500] ssd7: So for instance, new_resource.ttl is going to be whatever you set the ttl attribute to in your recipe.  Otherwise it will be the default value or nil if there is no default value
[2012-01-03 18:29:00 -0500] dyer: so new_resource is something specific to LWRP ?
[2012-01-03 18:29:00 -0500] dyer: it juse seems to appear out of thin air in this lwrp
[2012-01-03 18:30:00 -0500] cwj: yes, its specific to providers in LWRPs
[2012-01-03 18:30:00 -0500] ssd7: Yes, it is built up from the resource description in the recipe and then can be used inside providers
[2012-01-03 18:31:00 -0500] dyer: this recipe by default seems to want to do /REST/A, which is not valid in the DynECT API, it should be ARecord. When I use dynect_rr in my recipe I set the record_type to "ARecord" which seems to be working.  The problem is :update looks to see if the record exists, and if to does its reverting back to A
[2012-01-03 18:31:00 -0500] dyer: I need to fix that and get it to use ARecord, not A
[2012-01-03 18:31:00 -0500] dyer: and I cant follow the code to figure out how to fix the LWRP
[2012-01-03 18:31:00 -0500] dyer: as it stands now this LWRP is not functional
[2012-01-03 18:33:00 -0500] cwj: i dont use their service, nor that cookbook, but from your description it sounds like dynect changed their API
[2012-01-03 18:34:00 -0500] dyer: yes, the LWRP seems out of date
[2012-01-03 18:34:00 -0500] dyer: https://gist.github.com/de70cf811a87ad83ead5  The problem seems to be between lines 72-76
[2012-01-03 18:35:00 -0500] dyer: I just dont understand where its getting "A" record again
[2012-01-03 18:35:00 -0500] tolland: so I can see that munin:: server is going to write the ipaddress attribute into the munin.conf file, and that its going to be a local 10.x.x.x address, the munin server is on another network, as is the chef-server, hence for these nodes I need to override ipaddress in a persistent way
[2012-01-03 18:35:00 -0500] cwj: dyer: have you pryed open the dynect_rest gem? i am guessing that is what really needs updating
[2012-01-03 18:35:00 -0500] dyer: Here is my recipe ( https://gist.github.com/168f5802df40493d190a ), please notice how I am setting record_type to "ARecord"
[2012-01-03 18:36:00 -0500] dyer: cwj, I am using it manually and it works fine
[2012-01-03 18:36:00 -0500] dyer: I never saw this behavior until I started using the LWRP
[2012-01-03 18:37:00 -0500] cwj: are you sure you're using the same version of the gem on your chef-client node as you are in your manual tests?
[2012-01-03 18:37:00 -0500] ssd7: dyer: I think I see.  So, it is pullting in the current resource whcih has record_type set to A and then never updating that with the value from new_resource.
[2012-01-03 18:37:00 -0500] ssd7: hrmm. no. nvm
[2012-01-03 18:37:00 -0500] dyer: cwj, yes, I just confirmed
[2012-01-03 18:37:00 -0500] dyer: 0.4.0
[2012-01-03 18:39:00 -0500] cwj: bbl, luncho
[2012-01-03 18:46:00 -0500] jondot2: hi guys. is there a dashboard for chef like puppet's dashboard?
[2012-01-03 18:47:00 -0500] tolland: chef-server-webui
[2012-01-03 18:48:00 -0500] jondot2: thanks
[2012-01-03 18:48:00 -0500] dyer: ssd7, doesn't the author of this lwrp and gem work at opscode?
[2012-01-03 18:49:00 -0500] tolland: jondot2: gem install chef-server-webui
[2012-01-03 18:49:00 -0500] dyer: Adam Jacob ?
[2012-01-03 18:49:00 -0500] bawt: Adam Jacob is better with email than I am lol
[2012-01-03 18:50:00 -0500] jondot2: im just sniffing around chef in order to evaluate whats needed to use it for our infra, i'm wondering - does it have a solution for the case where i want to change configuration (application configuration) on one of my servers?
[2012-01-03 18:51:00 -0500] ssd7: dyer: Yes Adam Jacob does wok at opscode.  http://www.opscode.com/team/  But he is a pretty busy guy. His irc name is holoway and he jumps in here when he has some spare time.
[2012-01-03 18:52:00 -0500] dyer: ssd7, understood, just making quite the scene here at starbucks (banging keyboard, occasional explitive, ect ) on what I would think would be a pretty straight forward issue for the author
[2012-01-03 18:53:00 -0500] gmcinnes: happy new year chefs.
[2012-01-03 18:53:00 -0500] thehar: yes!
[2012-01-03 18:53:00 -0500] dyer: :)
[2012-01-03 18:54:00 -0500] gmcinnes: is anyone aware of a users recipe that manages ~/.ssh/authorized_keys ?
[2012-01-03 18:55:00 -0500] atomic-penguin: gmcinnes, there should be a template for it in the opscode/users cb
[2012-01-03 18:55:00 -0500] ssd7: gmcinnes: I think the user cookbook has a template that hanldes that
[2012-01-03 18:56:00 -0500] dyer: holoway, if there is any chance you have a second to help me w/ this it would be much appreciated
[2012-01-03 18:56:00 -0500] gmcinnes: My particular use case is that I have a backup machine that gets backups pushed to it from others.  To do that it needs to know the public keys from the users on the other machines.
[2012-01-03 18:56:00 -0500] gmcinnes: ok. let me check again.  I didn't think it did.
[2012-01-03 18:57:00 -0500] dyer: @holoway, incase you have not been following I am having one hell of a time getting your LWRP working. It seems to be calling /REST/A rather then /REST/ARecord on an update action.
[2012-01-03 18:57:00 -0500] ssd7: dyer: Unfortunately my time is split atm, but you can also file a ticket as help.opscode.com and we'll be able to take a closer look.
[2012-01-03 19:07:00 -0500] dyer: ssd7, ticket opened http://help.opscode.com/discussions/problems/1061-dynect-lwrp-does-not-work
[2012-01-03 19:07:00 -0500] dyer: I have to step away for about 20 mins
[2012-01-03 19:33:00 -0500] mostlygeek: do i need to sync up my data_bag/ folder to hosted chef before I can use it on nodes?
[2012-01-03 19:34:00 -0500] jtimberman: mostlygeek: you need to upload the data bag items to the Chef Server, yes.
[2012-01-03 19:34:00 -0500] jtimberman: knife data bag from file BAGNAME ITEMNAME.json
[2012-01-03 19:34:00 -0500] jtimberman: will upload data_bags/BAGNAME/ITEMNAME.json
[2012-01-03 19:34:00 -0500] mostlygeek: is there a way to sync everything?
[2012-01-03 19:35:00 -0500] mostlygeek: erg, sync up all the databags w/ one command?
[2012-01-03 19:37:00 -0500] jtimberman: there's a rake task for it.
[2012-01-03 19:37:00 -0500] jtimberman: rake -T
[2012-01-03 19:37:00 -0500] jtimberman: will show you the tasks.
[2012-01-03 19:38:00 -0500] mostlygeek: ahh rake databag:upload_all
[2012-01-03 19:38:00 -0500] mostlygeek: jtimberman: thanks! :)
[2012-01-03 19:44:00 -0500] jtimberman: mostlygeek: sure thing. i do it so infrequently that I forget. normally i only have to update a single data bag item at a time.
[2012-01-03 19:53:00 -0500] Matthaeus: Hello.  I'm an idiot and chef-managed my chef server, which cheerfully blew away my validation.pem file.  I know I can't recover it, but how would I go about generating a new one so that knife bootstrap will work again?
[2012-01-03 19:55:00 -0500] WoOh: sup
[2012-01-03 19:55:00 -0500] atomic-penguin: Matthaeus, take the delete_validation recipe out of the server's run_list and restart your chef-server
[2012-01-03 19:56:00 -0500] 15SAAQ9GY: Quick question, if I want to search on a node attribute (in this case postfix:relayhost), what's the syntax?
[2012-01-03 19:56:00 -0500] chip-: damn
[2012-01-03 19:57:00 -0500] chip-: and do I have to specify whether it's in default or override or the source of inheritance?
[2012-01-03 19:58:00 -0500] mostlygeek: for ssh (git) deployments, can I just put the private key in a single string, with no \n, ie: deleting new lines altogether?
[2012-01-03 19:59:00 -0500] bemu: mostlygeek: Pretty sure you need \n's
[2012-01-03 20:00:00 -0500] bdha: So I'm dropping a config file in my base role, and then in another role, trying to consume it with File.open.
[2012-01-03 20:00:00 -0500] bdha: Is there a reason that File.open would break ordering?
[2012-01-03 20:04:00 -0500] Matthaeus: atomic_penguin:  1.  It's not in the run-list, and 2. would that regenerate the certificate?
[2012-01-03 20:04:00 -0500] mostlygeek: w
[2012-01-03 20:04:00 -0500] mostlygeek: oops
[2012-01-03 20:05:00 -0500] Matthaeus: Huh, I guess it is in the run-list.  How'd that happen?
[2012-01-03 20:08:00 -0500] atomic-penguin: Matthaeus, restarting the server should regen the validation key
[2012-01-03 20:08:00 -0500] CharlieSu: I have a lot of nodes that all run the exact same cookbook with just a few attribute variations.  I've been making unique roles that override these attributes or using the webui to do it.  How can I bring up a node without using a uniq role or manually overriding the attribute(gets losts) ?  Can I specify a json structure to do this that represents the node in some way?
[2012-01-03 20:09:00 -0500] Matthaeus: atomic-penguin: That worked.  Thank you!
[2012-01-03 20:09:00 -0500] atomic-penguin: Matthaeus, at least it does on 0.10.x, not sure it does on <= 0.9
[2012-01-03 20:09:00 -0500] |shad0w|: it does on .9 as well
[2012-01-03 20:10:00 -0500] atomic-penguin: I remember having to remove it from couchdb at one point, can't remember what version
[2012-01-03 20:10:00 -0500] |shad0w|: hmm, I might have had to do that before the restart
[2012-01-03 20:10:00 -0500] |shad0w|: someone lost our validation pem the other day too ....
[2012-01-03 20:12:00 -0500] Matthaeus: So, would this be related to the "ERROR: TypeError: can't convert false into String" I get when trying to knife bootstrap now?
[2012-01-03 20:13:00 -0500] ssd7: Matthaeus: Do you have a .chef directory?
[2012-01-03 20:13:00 -0500] |shad0w|: did you replace the validation pem with the new one?
[2012-01-03 20:14:00 -0500] Matthaeus: Fixed it.  I'd pointed knife.rb at a different validation.pem
[2012-01-03 20:15:00 -0500] ssd7: cool
[2012-01-03 20:29:00 -0500] miah: moin
[2012-01-03 20:32:00 -0500] Matthaeus: Okay, idiot question number 2:  How the hell do I prevent /var/run/chef and /var/log/chef from occasionally being owned by root?  When this happens, chef-solr and chef-expander die horribly and none of my searches work.  I'm running Ubuntu 10.04.3 LTS
[2012-01-03 20:41:00 -0500] miah: Matthaeus: fix chef-client
[2012-01-03 20:41:00 -0500] miah: its in the chef-client cookbook
[2012-01-03 20:42:00 -0500] miah: i've noticed this same issue as well and corrected my version locally
[2012-01-03 20:43:00 -0500] Matthaeus: It's in chef-client cookbook?
[2012-01-03 20:44:00 -0500] Matthaeus: That's obnoxious.
[2012-01-03 20:46:00 -0500] miah: yes
[2012-01-03 20:47:00 -0500] miah: Matthaeus: https://github.com/opscode/cookbooks/blob/master/chef-client/recipes/config.rb#L30
[2012-01-03 20:49:00 -0500] jtimberman: Matthaeus: Chef itself can be used to ensure that the directories have the correct permissions.
[2012-01-03 20:49:00 -0500] Matthaeus: Yup.  I'm in the process of modifying the recipe to fix the permissions issue.
[2012-01-03 20:49:00 -0500] miah: yes, but chef server cookbooks have conflicting permissions
[2012-01-03 20:50:00 -0500] jtimberman: well
[2012-01-03 20:50:00 -0500] miah: if you run chef-client cookbook on a chef server you get some fun issues
[2012-01-03 20:50:00 -0500] jtimberman: it sounds like Matthaeus installed chef from a package.
[2012-01-03 20:50:00 -0500] jtimberman: Matthaeus: is that true? what platform are you using?
[2012-01-03 20:50:00 -0500] miah: nah
[2012-01-03 20:50:00 -0500] miah: i see this problem in ubuntu *
[2012-01-03 20:50:00 -0500] miah: jtimberman: look at the link
[2012-01-03 20:51:00 -0500] Matthaeus: jtimberman:  I used the bootstrap method on this server, and just installed from a package then bootstrapped on another server.  Both servers showed the same issue after adding the chef-client recipe to the chef-server
[2012-01-03 20:51:00 -0500] Matthaeus: jtimberman: Using Ubuntu 10.04.3 LTS
[2012-01-03 20:53:00 -0500] jtimberman: miah: ah
[2012-01-03 20:53:00 -0500] jtimberman: yeah
[2012-01-03 20:53:00 -0500] jtimberman: thats unsane :)
[2012-01-03 20:54:00 -0500] jtimberman: sorry about that.
[2012-01-03 20:54:00 -0500] jtimberman: hmm.
[2012-01-03 20:55:00 -0500] miah: no problemo
[2012-01-03 20:56:00 -0500] jtimberman: i remember this being rather annoying to think about, because there's two different cookbooks, either of which may (or may not) be used on a particular system (like a chef server itself)
[2012-01-03 20:57:00 -0500] Matthaeus: It's not really clear which are to be used for which, unless I missed something.
[2012-01-03 20:58:00 -0500] miah: the chef-client may want to check if the chef-server attributes are set on the node and if so iterate over a different list
[2012-01-03 20:58:00 -0500] miah: or just chgrp to chef and set write on chef-client as well
[2012-01-03 21:07:00 -0500] mconigliaro: hey guys, i'm trying out the deploy resource for the first time, and i'm trying to figure out the best way to run some commands after the initial deploy only.
[2012-01-03 21:08:00 -0500] mconigliaro: is that what before_symlink does? or does that run every time to update the 'current' symlink and stuff like that?
[2012-01-03 21:08:00 -0500] jbz: mconigliaro: before_symlink runs after every actual git deployment but before it makes the symlinks.
[2012-01-03 21:08:00 -0500] mconigliaro: yeah, so every deploy
[2012-01-03 21:08:00 -0500] mconigliaro: i basically just want a way to run rake db:setup
[2012-01-03 21:09:00 -0500] mconigliaro: i figure this must be pretty common
[2012-01-03 21:09:00 -0500] mconigliaro: or am i doing something totally wrong?
[2012-01-03 21:09:00 -0500] cwj: you will probably need to make use of a not_if { FIle.exists?("/foo/rake.lock") on the resources you only want to run at first deploy
[2012-01-03 21:09:00 -0500] cwj: then you can remove the lock file if/when you need it to run again
[2012-01-03 21:09:00 -0500] mconigliaro: yeah, i was thinking that...
[2012-01-03 21:10:00 -0500] mconigliaro: ok, ill try that. thanks!
[2012-01-03 21:17:00 -0500] ryker: anyone have any experience using the chef-handler-mail gem? https://github.com/kisoku/chef-handler-mail
[2012-01-03 21:17:00 -0500] ryker: I get this error: FATAL: LoadError: no such file to load -- chef/handler/mail.rb
[2012-01-03 21:17:00 -0500] ryker: I assume it's because mail.rb isn't located in the chef gem directory
[2012-01-03 21:18:00 -0500] ryker: it's in it's own gem directory
[2012-01-03 21:18:00 -0500] jtimberman: ryker: what do you have in the client.rb?
[2012-01-03 21:18:00 -0500] ryker: but I see many other examples which use the same syntax for source for chef_handler
[2012-01-03 21:18:00 -0500] ryker: Do I need something in the client.rb?  I thought chef_handler dynamically loaded it?
[2012-01-03 21:19:00 -0500] ryker: I just have a recipe with what was recommended at the github page for the gem at the url I posted above
[2012-01-03 21:19:00 -0500] jtimberman: okay, what does your chef_handler resource look like? :)
[2012-01-03 21:20:00 -0500] ryker: exactly like the usage section of: https://github.com/kisoku/chef-handler-mail
[2012-01-03 21:20:00 -0500] ryker: although, i noticed that I had to use arguments instead of 'args' as they have on the page.
[2012-01-03 21:20:00 -0500] ryker: unless this was my mistake.
[2012-01-03 21:21:00 -0500] miah: http://wiki.opscode.com/display/chef/Exception+and+Report+Handlers
[2012-01-03 21:21:00 -0500] miah: ?
[2012-01-03 21:22:00 -0500] ryker: miah: I read through all of that.  but looking at the chef_handler provider, it looks like it dynamically adds the new handler
[2012-01-03 21:23:00 -0500] ryker: i actually already had my own custom email handler working since before the chef_handler cookbook was available. I thought I would give the chef_handler cookbook and this chef-handler-mail gem a try.
[2012-01-03 21:26:00 -0500] ryker: jtimberman: this is what I have in a recipe for this: https://gist.github.com/d643f87a6f970ee44536
[2012-01-03 21:26:00 -0500] ryker: the chef run output is there too
[2012-01-03 21:31:00 -0500] jtimberman: ryker: for the resource
[2012-01-03 21:31:00 -0500] jtimberman: use this
[2012-01-03 21:31:00 -0500] jtimberman: chef_handler "Chef::Handler::Mail" do
[2012-01-03 21:32:00 -0500] ryker: ah, I didn't realize the name attribute was special
[2012-01-03 21:32:00 -0500] ryker: ty.  i'll give that a try
[2012-01-03 21:34:00 -0500] ryker: jtimberman: got the exact same error message
[2012-01-03 21:36:00 -0500] ssd7: dyer: Just a heads up that I'm active in IRC again if you want to do any debugging in realtime.  Thanks for adding all that info to the ticket.  Sorry to seemingly ask questions you've already answered, but I like making sure we are on the same page.
[2012-01-03 21:36:00 -0500] dyer: ssd7, no worries at all
[2012-01-03 21:37:00 -0500] dyer: might sound a litte short in the tickets, mainly because I am on a conference call where our CTO is repeatidly kicking my team in the balls
[2012-01-03 21:37:00 -0500] dyer: makes for a great mood
[2012-01-03 21:37:00 -0500] dyer: ;)
[2012-01-03 21:37:00 -0500] ryker: jtimberman: ran chef-client with -l debug and pasted the relevant output in the gist here: https://gist.github.com/d643f87a6f970ee44536
[2012-01-03 21:43:00 -0500] jtimberman: ryker: ah, hmm.
[2012-01-03 21:45:00 -0500] ryker: jtimberman: were you just clearing your throat?  ;)
[2012-01-03 21:47:00 -0500] jtimberman: ryker: poking in irb
[2012-01-03 21:48:00 -0500] jtimberman: the chef_handler lwrp takes the "source" parameter, and if it doesn't end with .rb, appends .rb to it
[2012-01-03 21:48:00 -0500] jtimberman: then it does a load on that file.
[2012-01-03 21:48:00 -0500] jtimberman: so what's happening when you install the gem
[2012-01-03 21:48:00 -0500] jtimberman: is the file is off in the installed gem location
[2012-01-03 21:49:00 -0500] jtimberman: like /usr/lib/ruby/1.8/gems/blahblah/chef-handler-mail
[2012-01-03 21:49:00 -0500] jtimberman: what version of ruby do you have and how do you install it?
[2012-01-03 21:49:00 -0500] jtimberman: and rubygems
[2012-01-03 21:50:00 -0500] ryker: ruby 1.9.2p180 and gems 1.3.7 on centos 5.6 installed from source
[2012-01-03 21:51:00 -0500] ryker: so isn't it just that I need to specify the full path to the where the gem is?  instead of just chef/handler/mail ?
[2012-01-03 21:51:00 -0500] jtimberman: yeah :-|
[2012-01-03 21:51:00 -0500] jtimberman: because its using 'load' instead of 'require'
[2012-01-03 21:52:00 -0500] jtimberman: https://github.com/opscode/cookbooks/blob/master/chef_handler/providers/default.rb#L32
[2012-01-03 21:52:00 -0500] ryker: ok.  that was the first thing I thought, but all of other handlers I find say to do the same thing.
[2012-01-03 21:52:00 -0500] ryker: my next handler I was going to add is chef-gelf
[2012-01-03 21:52:00 -0500] ryker: is has 'chef/gelf' for the source.
[2012-01-03 21:52:00 -0500] ryker: which I assume will fail also
[2012-01-03 21:52:00 -0500] ssd7: dyer: What field are you trying to update when you run this recipe.  From the stacktrace it appears that it is actually attempting to create a new record.
[2012-01-03 21:53:00 -0500] ryker: jtimberman: https://github.com/jellybob/chef-gelf.  Seems like that would fail to load also.
[2012-01-03 21:53:00 -0500] ryker: if you look at their usage section
[2012-01-03 21:54:00 -0500] dyer: ssd7, what do u mean "field" ?
[2012-01-03 21:56:00 -0500] ssd7: dyer: Sorry, I meant resource attribute.  From everything I am seeing, the debug log you posted look as if line 30 here: https://gist.github.com/35950b0ae3901c54b454 wasn't changed to 'ARecord'.
[2012-01-03 21:56:00 -0500] dyer: Here is the recipe --> https://gist.github.com/10ea2e649a05b1cf21d2
[2012-01-03 21:56:00 -0500] dyer: oh, thats old
[2012-01-03 21:56:00 -0500] dyer: sorry
[2012-01-03 21:58:00 -0500] jtimberman: ryker: can you modify in your chef_handler/providers/default.rb, remove line 31? looks like this file_name << ".rb" unless file_name =~ /.*\.rb$/
[2012-01-03 21:58:00 -0500] dyer: creating a new instance to get you fresh logs
[2012-01-03 21:58:00 -0500] jtimberman: and try again
[2012-01-03 21:58:00 -0500] amfred: Hi there - I'm kind of new to Chef, so please be kind.  :-)  I'm trying to write code that I can call from multiple recipes.  Can I get some debug help with it?
[2012-01-03 21:59:00 -0500] ssd7: dyer: I think I may know why your previous code using the library may work.  It seems the gem does have some code to translate A->ARecord: https://github.com/adamhjk/dynect_rest/blob/master/lib/dynect_rest.rb#L131  The provider just isn't using it.
[2012-01-03 21:59:00 -0500] ryker: jtimberman: sure.  i'll give it a try.
[2012-01-03 22:00:00 -0500] dyer: Yea, you know I did see that
[2012-01-03 22:00:00 -0500] dyer: thought it might be a factor, but then I had to go into the meeting from hell and lost track of it
[2012-01-03 22:01:00 -0500] amfred: I have utility code to publish information back to a build server as the installation is proceeding.  I started out just writing a Ruby class, module DevopsUtilities, class Chef::Recipe::BuildSystem, in libraries/devops_utilities.rb.  I can call my BuildSystem's publish_event method from my Chef recipes, but within my publish_event method I can't use the Chef::Provider::Execute method.  I get an error, FATAL: NoMethodError: undefined method `execute
[2012-01-03 22:01:00 -0500] ryker: jtimberman: no change.  same error message
[2012-01-03 22:01:00 -0500] amfred: Darned :P
[2012-01-03 22:01:00 -0500] amfred: : P
[2012-01-03 22:02:00 -0500] jtimberman: :\
[2012-01-03 22:02:00 -0500] mib_mib: can someone explain why I would want to create a chef recipe for my ec2 instance instead of just installing everything then creating a new AMI that i can boot directly?
[2012-01-03 22:04:00 -0500] jbz: mib_mib: Well, because then whenever anything changes in terms of your software or the distro you have to recreate the AMI.
[2012-01-03 22:04:00 -0500] jbz: And managing AMIs suuuuuuucks.
[2012-01-03 22:04:00 -0500] jtimberman: ryker: hmm
[2012-01-03 22:04:00 -0500] jtimberman: ryker: in your recipe
[2012-01-03 22:04:00 -0500] jtimberman: before the chef_handler resource
[2012-01-03 22:04:00 -0500] jtimberman: require 'chef/handler/mail'
[2012-01-03 22:04:00 -0500] jbz: mib_mib: Also, AMIs aren't usable across different EC2 regions
[2012-01-03 22:05:00 -0500] mib_mib: jbz: really? thats weird
[2012-01-03 22:05:00 -0500] jtimberman: and restore that line in the provider/default.rb
[2012-01-03 22:05:00 -0500] amfred: mib_mib:  We're using Chef for cases where we might want to change the system config multiple times in a week.
[2012-01-03 22:05:00 -0500] mib_mib: jbz: didnt know that. Are there any other options besides chef?
[2012-01-03 22:05:00 -0500] jbz: mib_mib: Nope.  They're region-specific (not availability zone, region).
[2012-01-03 22:05:00 -0500] cwj: nor are AMIs usable outside of EC2, like if you wanted to set up your system/service on rackspace, linode or under your desk
[2012-01-03 22:06:00 -0500] jbz: Indeed, what amfred and cwj said.  If you have a chef recipe set that works for you, you can easily reurpose it to work on whatever.
[2012-01-03 22:06:00 -0500] mib_mib: Thats cool. Is it basically the standard for ec2 then?
[2012-01-03 22:06:00 -0500] jbz: The major disadvantage of chef vs. AMI on EC2 is that using a custom AMI means you can bring up nodes much, much faster, so if you're doing autoscaling it's sometimes better to use AMIs.
[2012-01-03 22:07:00 -0500] jtimberman: there's no reason why you can't bake an ami with common parts of your systems bundled into the image.
[2012-01-03 22:07:00 -0500] jtimberman: like, if every system needs emacs, you don't want to install all those packages every time on every new instance :)
[2012-01-03 22:07:00 -0500] amfred: mib_mib: You can also store your recipes in source control.
[2012-01-03 22:08:00 -0500] jtimberman: but there's potential hazards to the "golden image" methodology, as mentioned above.
[2012-01-03 22:08:00 -0500] jbz: jtimberman: Heh, yeah.  Except the jump in maintenance from 'no AMIs' to 'partial AMIs' is huge.
[2012-01-03 22:08:00 -0500] ryker: jtimberman: well, that seems to have worked and the chef_handler is loaded.  But at the end of the chef run I get, FATAL: NoMethodError: undefined method `run_report_safely' for #<Mail::Message:0x00000004517300>.  I assume that's a problem with the gem that I'll have to look into.
[2012-01-03 22:08:00 -0500] jbz: Mostly due to multiregion stuff.
[2012-01-03 22:09:00 -0500] mib_mib: Im moving from a single vps to ec2. The thing i'm not looking forward to is constantly updating recipes, i.e. if i install a ruby gem, i have to specifically add it to the recipe right
[2012-01-03 22:09:00 -0500] jbz: We build all our cookbook sets atop the alestic ubuntu images, mostly because they maintain AMIs of those in the various regions.
[2012-01-03 22:09:00 -0500] jbz: mib_mib: not necessarily, not.
[2012-01-03 22:09:00 -0500] jbz: mib_mib: We handle gem installs by having a 'gem list' attribute in our roles.
[2012-01-03 22:10:00 -0500] jbz: The cookbook itself just loads the attribute's contents and then installs all the gems in the array.
[2012-01-03 22:10:00 -0500] jbz: So that way, we can not only avoid having to update the cookbook, but the same cookbook is usable for different roles.
[2012-01-03 22:10:00 -0500] mib_mib: it would be nicer if it grabbed the source code, read my gemfile, and got what it needed =D
[2012-01-03 22:10:00 -0500] jbz: mib_mib: If you're using git, it can do that.
[2012-01-03 22:10:00 -0500] mib_mib: i gotcha
[2012-01-03 22:10:00 -0500] jbz: Our application deployment cookbook uses the deploy resource, and as part of its 'before restart' phase it runs a 'bundle update.'
[2012-01-03 22:10:00 -0500] mib_mib: so these are basically my only 2 options right? ami or chef?
[2012-01-03 22:11:00 -0500] jtimberman: ryker: yeah that doesn't look like a Chef exception.
[2012-01-03 22:11:00 -0500] ryker: jtimberman: thx for helping me figure this out.
[2012-01-03 22:11:00 -0500] jbz: Not at all.  See puppet, or cfengine...
[2012-01-03 22:11:00 -0500] amfred: So, I'll post my Ruby class and maybe someone can tell me why it's not finding the execute resource.  I feel like I'm just missing something small.
[2012-01-03 22:11:00 -0500] jtimberman: ryker: sure, sorry for that bit of hassle. seems that the loaded gem for the handler needs to be required before the lwrp loads it.
[2012-01-03 22:11:00 -0500] amfred: module DevopsUtilities
[2012-01-03 22:11:00 -0500] amfred: class Chef::Recipe::BuildSystem
[2012-01-03 22:11:00 -0500] amfred:   def initialize(repository_url, activity_id, parent_activity_id, build_result_uuid, build_password, deploy_dir, dir_group, dir_owner)
[2012-01-03 22:11:00 -0500] jbz: You could even use straight scripts, inserted into the userdata
[2012-01-03 22:11:00 -0500] jtimberman: awkward, and can probably be streamlined.
[2012-01-03 22:12:00 -0500] jtimberman: ryker: can you open a bug in the COOK project, chef_handler component that the provider should begin/rescue a require or something?
[2012-01-03 22:12:00 -0500] ryker: jtimberman: I thought that might be the case, but I used require 'chef-handler-mail' instead of 'chef/handler/mail', which didn't work.
[2012-01-03 22:12:00 -0500] ryker: jtimberman: sure thing
[2012-01-03 22:13:00 -0500] amfred: Well, that was bad timing.  I'm back on.
[2012-01-03 22:13:00 -0500] jtimberman: ryker: thanks!
[2012-01-03 22:13:00 -0500] jtimberman: amfred: please gist / pastie the code :)
[2012-01-03 22:13:00 -0500] amfred: I guess IRC doesn't like multi-line pastes
[2012-01-03 22:14:00 -0500] amfred: I don't know how to do that, heh.  Did you see what I did send?
[2012-01-03 22:14:00 -0500] jtimberman: gist.github.com
[2012-01-03 22:14:00 -0500] jtimberman: paste it in there, then post the link here.
[2012-01-03 22:14:00 -0500] amfred: ah
[2012-01-03 22:15:00 -0500] mib_mib: ok cool, will it be pretty quick to get a recipe working?
[2012-01-03 22:15:00 -0500] mib_mib: to say install ruby and a few other things
[2012-01-03 22:15:00 -0500] amfred: private or public gist?
[2012-01-03 22:16:00 -0500] amfred: https://gist.github.com/e0afca7da8757bae3733  << does that work?
[2012-01-03 22:16:00 -0500] jbz: mib_mib: Well.  You can get something working pretty fast, yes.  The question is how much refactoring you'll need to do later.  I would recommend you concentrate not on keeping everything in one cookbook, but on trying to stick to prewritten cookbooks from the community site - that is probably your best route to a quick implementation, and one that is more maintainable.
[2012-01-03 22:17:00 -0500] mib_mib: but i have a specific environment, ruby 1.9, rails 3.0.2 etc
[2012-01-03 22:17:00 -0500] jbz: mib_mib: It's also worth doing a bit of thinking in advance how you're going to handle configuration information - via role attributes?  Via node attributes?  Via environments?  Etc.
[2012-01-03 22:17:00 -0500] jbz: mib_mib: Most of the cookbooks on the community site will let you specify versions using attributes.
[2012-01-03 22:17:00 -0500] mib_mib: jbz: okay i need to do some reading to understand then i'll be back
[2012-01-03 22:18:00 -0500] mib_mib: jbz: thanks for help
[2012-01-03 22:18:00 -0500] thehar: 4/win 12
[2012-01-03 22:18:00 -0500] thehar: fail
[2012-01-03 22:19:00 -0500] amfred: So if anyone's kind enough to look at my code, the reason I used class Chef::Recipe::BuildSystem is that it seems to allow my chef recipes to use my class.   And the reason I used       Chef:: Provider::Execute "publish" do   is that     execute "publish" do     wasn't working either.
[2012-01-03 22:20:00 -0500] jbz: mib_mib: You're welcome.  Don't hesitate to bounce back with questions.
[2012-01-03 22:23:00 -0500] ryker: jtimberman: actually run_report_safely is part of chef.  https://github.com/opscode/chef/blob/master/chef/lib/chef/handler.rb#L70
[2012-01-03 22:30:00 -0500] jtimberman: ryker: ah. i don't know why it would have an error on that though
[2012-01-03 22:30:00 -0500] jtimberman: i need to run
[2012-01-03 22:30:00 -0500] amfred: Anyone have any idea what's up with my code?
[2012-01-03 22:30:00 -0500] amfred: I'll wait for a while if someone can take a look.
[2012-01-03 22:31:00 -0500] amfred: Otherwise, it's just about the end of the day here.
[2012-01-03 22:31:00 -0500] ryker: jtimberman: cool.  thx again for the help
[2012-01-03 22:33:00 -0500] mostlygeek: does anybody have a good link for the deploy resource, using git and ssh? i'm not sure what should go in the ssh-wrapper. I have a private ssh key, but not sure wehre to reference it
[2012-01-03 22:34:00 -0500] cwj: mostlygeek: https://gist.github.com/1042972
[2012-01-03 22:35:00 -0500] cwj: where @node[:deploy][:key_path] is the absolute path to the key file installed prior to deployment
[2012-01-03 22:36:00 -0500] jessicab: amfred - more info on what youre trying to do might be helpful.. seems like youre trying to use chef libraries in arbitrary ruby code outside of chef?
[2012-01-03 22:37:00 -0500] mostlygeek: cwj: in the deploy resource docs it says to create a databag with the key in it... should i write that key to a file first, and then use the wrapper script?
[2012-01-03 22:37:00 -0500] cwj: putting the key in a databag is just one way to do it
[2012-01-03 22:37:00 -0500] amfred: Well, I'm just trying to write utility methods I can access from any of my recipes
[2012-01-03 22:38:00 -0500] cwj: the key has to come from somewhere, if i were you i would focus on making the deploy resource work with an ssh wrapper script, then tackle how to get the key into place
[2012-01-03 22:38:00 -0500] amfred: The doc on creating LWRPs was hard to follow, so I thought I Ruby class might work
[2012-01-03 22:38:00 -0500] cwj: i store mine as an encrypted data bag item
[2012-01-03 22:39:00 -0500] jessicab: amfred - if youre using ruby code in a recipe, youll want to put it in a ruby_block, and use the execute resource in a separate block most likely
[2012-01-03 22:39:00 -0500] mostlygeek: cwj: when running a recipe, how does it decrypt the databag for the node? (not so clear on this)
[2012-01-03 22:41:00 -0500] amfred: jessicab:  Let me show you how I'm calling it now
[2012-01-03 22:41:00 -0500] amfred: If you reload the gist link I think you'll see the 2 files
[2012-01-03 22:42:00 -0500] amfred: I want to be able to call this utility code from several recipe files
[2012-01-03 22:43:00 -0500] amfred: Normally 1 recipe might call publish_event several times
[2012-01-03 22:43:00 -0500] cwj: mostlygeek: chef-client retrieves a key from somewhere (a file on disk or some remote uri) and uses that key to decrypt the encrypted data bag payload.
[2012-01-03 22:43:00 -0500] cwj: its another key distribution problem
[2012-01-03 22:43:00 -0500] mostlygeek: hmm... ok. what do you think about using cookbook_files to distribute the key?
[2012-01-03 22:44:00 -0500] jessicab: amfred - im honestly not that great with ruby, you might want to post this to the mailing list if you dont get a better answer here.. but it seems like in the recipe youd want to put the build system lines inside of a ruby_block resource
[2012-01-03 22:44:00 -0500] cwj: mostlygeek: well it really depends on what kind of protection you are looking for when using encrypted data bag items.
[2012-01-03 22:44:00 -0500] jessicab: amfred - more info on it is in the wiki - http://wiki.opscode.com/display/chef/Resources#Resources-RubyBlock
[2012-01-03 22:45:00 -0500] mostlygeek: cwj: using the encrypted data bag seems good to keep Opscode from getting that key :)
[2012-01-03 22:45:00 -0500] cwj: mostlygeek: for example, i use opscode's hosted chef platform, and in my case i am looking for encrypted data bags to help protect against a scenario where compromise of the hosted chef platform leads to passwords used by my recipes being made available in plain text
[2012-01-03 22:45:00 -0500] amfred: jessicab:  OK.  I'll check that out and see what I can do with it.  Thanks for the tip.  (I'm pretty new to Ruby and Chef myself - coming from a Java/Python background.  Limp limp.)
[2012-01-03 22:46:00 -0500] cwj: so in my case, using a cookbook file does not really help -- the file in my cookbook containing the key would be uploaded to hosted chef platform
[2012-01-03 22:47:00 -0500] mostlygeek: right, cool. i'll worry about the security after i get it working then ;) thanks cwj
[2012-01-03 22:50:00 -0500] schism: bizarre. hardy and chef-client 10.4 are not playing nice for me
[2012-01-03 22:51:00 -0500] schism: RangeError: -54 out of char range
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/gems/1.8/gems/uuidtools-2.1.2/lib/compat/securerandom.rb:172:in `chr'
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/gems/1.8/gems/uuidtools-2.1.2/lib/compat/securerandom.rb:172:in `random_number'
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/1.8/resolv.rb:532:in `random'
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/1.8/resolv.rb:549:in `rangerand'
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/1.8/resolv.rb:581:in `bind_random_port'
[2012-01-03 22:51:00 -0500] schism: /usr/lib/ruby/1.8/resolv.rb:636:in `initialize'
[2012-01-03 22:52:00 -0500] schism: chef runs randomly fail
[2012-01-03 22:54:00 -0500] schism: 10.2 works fine
[2012-01-03 22:55:00 -0500] schism: followed the stack trace diffing between 10.2 and 10.4
[2012-01-03 22:56:00 -0500] schism: application.rb added "require 'socket'"
[2012-01-03 22:57:00 -0500] schism: that's it, except for a few methods om run_context.rb that weren't being called
[2012-01-03 23:14:00 -0500] mostlygeek: I'm using the Deploy resource, but get a "Errno:ENOENT ... no such file or directory - git clone ..." anybody ever seen this?
[2012-01-03 23:16:00 -0500] defghanistan: Hello, I am working on a windows knife client (I know) and am getting a an EDITOR environment variable error when trying to edit an environment even though "EDITOR" is set to an .exe editor. Any ideas?
[2012-01-03 23:18:00 -0500] defghanistan: Can I set editor in knife.rb?
[2012-01-03 23:38:00 -0500] defghanistan: I've googled and tried everything I can think of, knife still thinks my EDITOR environment variable is not set. Any help would be much appreciated.
[2012-01-03 23:39:00 -0500] laurent\: knife --editor ?
[2012-01-03 23:40:00 -0500] mattray: defghanistan: env | grep EDITOR
[2012-01-03 23:41:00 -0500] defghanistan: This is on a windows knife client
[2012-01-03 23:41:00 -0500] defghanistan: SET EDITOR returns with a value of the path to the .exe
