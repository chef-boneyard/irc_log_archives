[2012-01-09 08:41:00 -0500] tolland: first boot.json doesn't seem to stick.
[2012-01-09 08:42:00 -0500] tolland: is there some way to give the node its role during its registration phase?
[2012-01-09 08:44:00 -0500] tolland: i could presumably have the run_list update the node roles, but it seems to miss the opportunity
[2012-01-09 09:42:00 -0500] matti: workmad3: :)
[2012-01-09 09:42:00 -0500] workmad3: hey matti :) you're hanging out in here too now eh?
[2012-01-09 09:43:00 -0500] matti: workmad3: I am in the Chef camp now.
[2012-01-09 09:43:00 -0500] matti: workmad3: Is that bad? :)
[2012-01-09 09:44:00 -0500] workmad3: nope, chef is awesome :)
[2012-01-09 09:45:00 -0500] matti: workmad3: If you know Ruby, there is no better choice :)
[2012-01-09 11:07:00 -0500] lflux: is anyone using the database resources in https://github.com/opscode/cookbooks/tree/master/database ? I'm getting syntax errors just following the example configuration
[2012-01-09 11:09:00 -0500] workmad3: lflux: I'm using them... only just switched to them though, so I'm probably not going to be able to help too much
[2012-01-09 11:10:00 -0500] lflux: it barfs on the connection configuration.
[2012-01-09 11:10:00 -0500] lflux: https://gist.github.com/1582526 is the recipe i'm using
[2012-01-09 11:11:00 -0500] lflux: and the error is "syntax error, unexpected tASSOC, expecting '}'" at "connection { :host => "127.0.0.1", :port => 5432, :..."
[2012-01-09 11:11:00 -0500] workmad3: lflux: ah, you just hit a ruby oddity... you need to do connection({...})
[2012-01-09 11:11:00 -0500] lflux: ugh.
[2012-01-09 11:12:00 -0500] lflux: why the hell isn't that documented
[2012-01-09 11:12:00 -0500] workmad3: it is... but it's part of the ruby language, not chef
[2012-01-09 11:12:00 -0500] workmad3: as for why they use it as an example... not a clue I'm afraid
[2012-01-09 11:12:00 -0500] lflux: yeah I meant in the recipe documentation.
[2012-01-09 11:13:00 -0500] lflux: thanks! that worked
[2012-01-09 11:13:00 -0500] lflux: i'll submit a diff for that.
[2012-01-09 11:14:00 -0500] workmad3: lflux: :) it's entirely possible that it just wasn't considered... I read through that a few times before I used the recipe, didn't even notice the error and when I used it automatically with corrected syntax :)
[2012-01-09 13:04:00 -0500] `brendan: morning all
[2012-01-09 14:15:00 -0500] zefer: I'm using 'knife-ec2 server create' and have AWS credentials in an encrypted data bag on the chef server. How can I make the ec2 bootstrap able to read the encrypted data bag, without compromising the contents or the data bag's secret key?
[2012-01-09 14:22:00 -0500] will231: hi, i wondered if anyone can help me with a quick question?
[2012-01-09 14:22:00 -0500] will231: i want to distribute different apache2.conf files to nodes depending on their roles
[2012-01-09 14:23:00 -0500] will231: i realise you can do this through the template, but thought it would be better to have the config files in a seperate directory, and just have includes another specific file rather than the config in the template file its self?
[2012-01-09 14:24:00 -0500] will231: is that a better idea? how would i distribute specific versions of a file to specific nodes based on their role?
[2012-01-09 14:25:00 -0500] BryanWB: will231: perhaps better to apply different recipes per role
[2012-01-09 14:26:00 -0500] BryanWB: role: front_end_proxy  would have recipe  apache::proxy , and role: lamp_server    would get apache::mod_php  or something like that
[2012-01-09 14:27:00 -0500] will231: a recipe specific to the role that would over ride the default config and write those specific files?
[2012-01-09 14:28:00 -0500] will231: kyeah, i have a role with the correct recipes, but i want to change the config of say apache::proxy depending on attributes of a node it is applied to
[2012-01-09 14:31:00 -0500] BryanWB: then use an erb template for the config file, i think that will be more sane
[2012-01-09 14:32:00 -0500] BryanWB: you also can use control logic in the recipe to determine what values u pass to the templated files
[2012-01-09 14:32:00 -0500] will231: thats what i thought initially... but i didnt like the idea of putting every config into that file, thought it could come unmanageable and too big
[2012-01-09 14:33:00 -0500] BryanWB: i guess then have several .erbs and if node['some_attrib'] == 'foo   ; ... ; elsif node['some_attrib'] == 'baz' ; .....; end
[2012-01-09 14:34:00 -0500] will231: ahh boo and baz would be the different .erbs?
[2012-01-09 14:34:00 -0500] will231: that sounds more favorable
[2012-01-09 14:34:00 -0500] will231: easier to manage...
[2012-01-09 14:37:00 -0500] will231: bryanWB: if i did such an if statement, how would i tell it to look in the other erb?
[2012-01-09 14:38:00 -0500] will231: something that would say: include cachingconf.erb
[2012-01-09 14:38:00 -0500] BryanWB: if statement_1 ; template  foo.erb ; elsif statement_2   template baz.erb ; end
[2012-01-09 14:38:00 -0500] will231: ahhh :D
[2012-01-09 14:38:00 -0500] will231: cheers
[2012-01-09 14:38:00 -0500] will231: sorry for being a noob
[2012-01-09 14:39:00 -0500] BryanWB: np homez
[2012-01-09 15:18:00 -0500] laurent\: hmm before i start searching, do you know where the get the action name in the load_current_resource of a provider ?
[2012-01-09 15:23:00 -0500] laurent\: nm, i should have guessed :)
[2012-01-09 15:25:00 -0500] yfeldblum: laurent\, you should not need the action in load_current_resource
[2012-01-09 15:26:00 -0500] laurent\: i know, but let's say it's a polymorphic resource ! :)
[2012-01-09 15:27:00 -0500] yfeldblum: what does that mean?
[2012-01-09 15:36:00 -0500] will231: how can i test my template files?
[2012-01-09 15:37:00 -0500] BryanWB: will231: run the recipe ;)
[2012-01-09 15:37:00 -0500] will231: haha, it doesent work :P
[2012-01-09 15:37:00 -0500] will231: is there a way i can run the recipe and see the output of the template?
[2012-01-09 15:39:00 -0500] BryanWB: probably can run it in shef somehow
[2012-01-09 15:40:00 -0500] yfeldblum: on a vagrant box or a temporary/dev cloud server?
[2012-01-09 15:40:00 -0500] will231: is there a way to see the result of funning the specific erb file though?
[2012-01-09 15:41:00 -0500] will231: *running
[2012-01-09 15:46:00 -0500] will231: is there a way i can run this as a ruby script on the host node to validate it?
[2012-01-09 15:46:00 -0500] will231: <% if node[:role] == "mpop" -%>
[2012-01-09 15:48:00 -0500] lflux: Use shef
[2012-01-09 15:49:00 -0500] lflux: it drops you into an IRB shell where it has that object loaded
[2012-01-09 15:52:00 -0500] will231: so i could just run something like m = node[:role] == "mpop"
[2012-01-09 15:52:00 -0500] will231: puts m?
[2012-01-09 15:52:00 -0500] will231: sorry for my poor ruby skills
[2012-01-09 15:52:00 -0500] WoOh: Hm it's pretty interesting.  Under FreeBSD all package "something" fails due to "`package_name': Unexpected form for PKGNAME variable in..."
[2012-01-09 15:53:00 -0500] WoOh: And as I saw there was a lot's of bug reports about it. What is the easiest way to fix it?
[2012-01-09 15:53:00 -0500] lflux: will231: yes.
[2012-01-09 15:53:00 -0500] lflux: might want to parenthesize but that works.
[2012-01-09 15:57:00 -0500] yfeldblum: laurent\, load_current_resource should create a resource instance reflecting what pre-exists on the node
[2012-01-09 15:59:00 -0500] laurent\: yeah makes sense, i'll find a nicer way
[2012-01-09 16:01:00 -0500] zefer: To answer my own question r.e. how to bootstrap with an encrypted data bag key, the solution is easy as of Chef 0.10.6. Simply include the path to the local key file in knife.rb and the bootstrapping will write it to the server at /etc/chef/encrypted_data_bag_secret. See http://comments.gmane.org/gmane.comp.sysutils.chef.user/2492 :)
[2012-01-09 16:02:00 -0500] will231: when i do: node[:platform] => "ubuntu" then when i do: node[:roles] => []
[2012-01-09 16:03:00 -0500] will231: when i type just node it only returns the name and not all attributes
[2012-01-09 16:07:00 -0500] lflux: does it have any roles?
[2012-01-09 16:08:00 -0500] lflux: that you can also check with 'knife node show <node>'
[2012-01-09 16:08:00 -0500] lflux: (i'm not an expert at chef either :) )
[2012-01-09 16:09:00 -0500] will231: when i do knife node show **** i get Roles: mpop
[2012-01-09 16:09:00 -0500] will231: it has the roles as it assigns the cookbooks and recipies
[2012-01-09 16:10:00 -0500] will231: but for some reason i cant query attributes of the node apart from fqdn?
[2012-01-09 16:13:00 -0500] workmad3: will231: try node.roles
[2012-01-09 16:13:00 -0500] workmad3: will231: or node["roles"]
[2012-01-09 16:13:00 -0500] will231: node.roles  => []
[2012-01-09 16:13:00 -0500] will231: node["roles"]  => []
[2012-01-09 16:13:00 -0500] workmad3: will231: hmm, as far as the node is concerned, it has no roles
[2012-01-09 16:13:00 -0500] will231: but hostname and fqdn return the right data...
[2012-01-09 16:14:00 -0500] workmad3: (at least, during the chef client run, it has no roles)
[2012-01-09 16:14:00 -0500] will231: which is strange because chef is applying them
[2012-01-09 16:14:00 -0500] will231: at chef client run it installs everyting and works :|
[2012-01-09 16:14:00 -0500] will231: except it cant see the roles in the template or in shef?
[2012-01-09 16:15:00 -0500] will231: arnt the attributes kept in a json somewhere?
[2012-01-09 16:16:00 -0500] will231: when i run node.roles on my chef server it still doesent return anything
[2012-01-09 16:16:00 -0500] will231: does it work for any of you?
[2012-01-09 16:16:00 -0500] workmad3: will231: you should be running that on the client that has that role
[2012-01-09 16:16:00 -0500] will231: yeah i did
[2012-01-09 16:17:00 -0500] will231: but it doesent display it, so i tried it on another node
[2012-01-09 16:17:00 -0500] workmad3: will231: and node.roles works fine for me in many recipes
[2012-01-09 16:17:00 -0500] will231: tbf that one has no roles, so it is right not to return anything heh
[2012-01-09 16:17:00 -0500] binbasti: hi
[2012-01-09 16:17:00 -0500] workmad3: will231: also, to check for a role, you should do 'node.roles.include?("role_name") ' afaik
[2012-01-09 16:17:00 -0500] binbasti: i have a problem with an instance that doesn't seem to be in the search index anymore on the opscode platform
[2012-01-09 16:17:00 -0500] workmad3: not 'node.role == '
[2012-01-09 16:18:00 -0500] binbasti: is there a way to trigger it being indexed immediately?
[2012-01-09 16:18:00 -0500] will231: okay
[2012-01-09 16:18:00 -0500] will231: ahh because there could be more than one role
[2012-01-09 16:19:00 -0500] workmad3: will231: yeah, and .roles returns an array, which will never be == to a string :)
[2012-01-09 16:19:00 -0500] will231: is it not returning it because its an array? it should do...
[2012-01-09 16:19:00 -0500] workmad3: will231: I've never had a problem with .roles, as I said... don't know what's going on :/
[2012-01-09 16:21:00 -0500] will231: yeah, its really weird
[2012-01-09 16:21:00 -0500] necromancer: hi cheffers
[2012-01-09 16:22:00 -0500] will231: will probably end up being due to some sort of stupidity, on my part
[2012-01-09 16:22:00 -0500] will231: but it should work
[2012-01-09 16:22:00 -0500] will231: is there a way to query the roles on the node other than the irb?
[2012-01-09 16:22:00 -0500] Damm: node[:roles]
[2012-01-09 16:22:00 -0500] Damm: running node:roles => [] creates an empty object
[2012-01-09 16:22:00 -0500] Damm: err node[:roles] => []
[2012-01-09 16:22:00 -0500] workmad3: will231: ah, I'm trying shef on one of my servers and it's doing the same... but when I run shef, it tells me it's running standalone with no server and an empty run list...
[2012-01-09 16:23:00 -0500] will231: i was running node[:roles] the => [] was the result
[2012-01-09 16:24:00 -0500] workmad3: will231: try running 'shef
[2012-01-09 16:24:00 -0500] workmad3: will231: try running 'shef -z' with sudo
[2012-01-09 16:24:00 -0500] workmad3: (hit return too early)
[2012-01-09 16:26:00 -0500] will231: works with -z :)
[2012-01-09 16:26:00 -0500] will231: didnt realise it was acting as solo with no config
[2012-01-09 16:26:00 -0500] necromancer: hey guys, i'm using Vagrant with Chef and i'm trying to debug this issue... https://gist.github.com/4d151b2d8126f7cbfa5e
[2012-01-09 16:26:00 -0500] necromancer: that error at the very end of the log
[2012-01-09 16:27:00 -0500] necromancer: what's weird is that it errors out on this line -- define :elocal_site, { :enable => true, :rails_env=> "#{node[:chef_environment]}", :require_htaccess=>true, :wordpress_url=>nil, :standalone => "" } do
[2012-01-09 16:27:00 -0500] necromancer: but there are calls to node[] earlier in the file that it doesn't have a problem with
[2012-01-09 16:28:00 -0500] workmad3: necromancer: gist the recipe as well?
[2012-01-09 16:29:00 -0500] will231: workmad3: <% if node.roles.include?("mpop") -%> "nextline then config file content" <% end -%> still doesent insert the stuff?
[2012-01-09 16:29:00 -0500] necromancer: workmad3: i am a bit of a novice (just started last week lol)...this is a rb file in the folder definitions/, would that be considered a "recipe"?
[2012-01-09 16:30:00 -0500] workmad3: necromancer: gist it :) it's not a recipe, but it's the point of interest ;)
[2012-01-09 16:30:00 -0500] necromancer: workmad3: ok https://gist.github.com/caa80a5e5eabb49ae6da, i was in the process of doing it just curious as to the terminology of chef :)
[2012-01-09 16:31:00 -0500] workmad3: necromancer: ah, you're using the node[] in the default params list, not in the define body... that'll be the problem
[2012-01-09 16:32:00 -0500] necromancer: workmad3: ahhh so node[] is only available in the callback huh?
[2012-01-09 16:32:00 -0500] workmad3: necromancer: the body of the define has access to the node... outside of the body, you don't (or so your error is telling you)
[2012-01-09 16:32:00 -0500] necromancer: well
[2012-01-09 16:32:00 -0500] necromancer: that makes things interesting ;)
[2012-01-09 16:33:00 -0500] workmad3: necromancer: rails_env = params[:rails_env] || node[:chef_environment]
[2012-01-09 16:33:00 -0500] workmad3: not that interesting ;)
[2012-01-09 16:33:00 -0500] necromancer: lol thanks
[2012-01-09 16:33:00 -0500] necromancer: workmad3: so params[] is available in the global scope of my recipe file, but node[] is only available in the callback of define()?
[2012-01-09 16:34:00 -0500] workmad3: necromancer: no... params[] is available in the block of your define
[2012-01-09 16:34:00 -0500] necromancer: workmad3: oh
[2012-01-09 16:34:00 -0500] workmad3: necromancer: I was giving you a snippet to put at the top of the block ;)
[2012-01-09 16:34:00 -0500] necromancer: workmad3: oh is the first block passed to define() defining the vars in params[]?
[2012-01-09 16:36:00 -0500] WoOh: sorry for bugging with the freebsd stuff, I just had to upgrade.
[2012-01-09 16:42:00 -0500] will231: workmad3: cheers for the help! there were errors in my ruby syntax.
[2012-01-09 16:43:00 -0500] will231: one more question... you will always need ruby and its associated dependencies on a node to run chef as the recipies and templates are all ruby files right?
[2012-01-09 16:44:00 -0500] will231: you couldent compile chef-client could you?
[2012-01-09 16:45:00 -0500] will231: its one thing that kindof annoys me about chef compared to something like cfengine, chef has alot more dependencies assosiated?
[2012-01-09 16:46:00 -0500] workmad3: will231: you need ruby installed, yes... it's not a problem for me because pretty much everything I set up uses ruby in some form :)
[2012-01-09 16:47:00 -0500] lflux: at least ruby isn't used by yum, that would have made it interesting to install on centos
[2012-01-09 16:49:00 -0500] will231: hmm, yeah i was working on placement as part of my uni course somewhere that was deploying cfengine because of too many dependencies... but then again, they ran 500+ instances of freebsd so minimal was the pattern
[2012-01-09 16:49:00 -0500] will231: well because chef and puppet had too many dependencies
[2012-01-09 16:49:00 -0500] ukio: ohai
[2012-01-09 16:50:00 -0500] lflux: I was worried about that too, but knife bootstrap works well enough for me to build a VM to build off of.
[2012-01-09 16:51:00 -0500] workmad3: will231: that's the point where I'd build automated OS installers that included chef ;)
[2012-01-09 17:03:00 -0500] ukio: one thing I don't understand about chef's idempotence:
[2012-01-09 17:03:00 -0500] ukio: when i add say a file resource to a recipe, the next tmie i run chef client that file is created
[2012-01-09 17:04:00 -0500] ukio: when i later on decide this was a bad idea, and i remove the file resource from the recipe, would that previously created file be removed?
[2012-01-09 17:06:00 -0500] ukio: i gues not, right? so running the same recipe would leave the system in two different states, depending on whether the previous version of that recipe (which created the file) had been run or not.
[2012-01-09 17:09:00 -0500] mostlygeek: ukio: chef != perfect.
[2012-01-09 17:09:00 -0500] mostlygeek: :)
[2012-01-09 17:10:00 -0500] laurent\: you can also remove files with the file resource :)
[2012-01-09 17:11:00 -0500] carljm: ukio: no chef recipe can fully represent everything about the state of a system, else it would be a VM image :-)
[2012-01-09 17:11:00 -0500] itwasntandy: ukio: what chef mean by idempotence is that each time you run it, everything will be run in the same order.
[2012-01-09 17:11:00 -0500] carljm: you just need to make sure it represents the bits of state you care about - that can easily include making sure a given file is absent.
[2012-01-09 17:11:00 -0500] itwasntandy: ukio: if you make changes, the onus is on you to ensure you clean up after youself
[2012-01-09 17:12:00 -0500] ukio: @carljm: the VM image comparison is nice :-)
[2012-01-09 17:13:00 -0500] ukio: think i understood it now how idempotence is meant in this context
[2012-01-09 17:13:00 -0500] ukio: thanks :-)
[2012-01-09 17:13:00 -0500] carljm: itwasntandy: idempotence does not mean that every time you run it, things are done in the same order
[2012-01-09 17:13:00 -0500] ukio: (listening)
[2012-01-09 17:15:00 -0500] itwasntandy: carljm: in part it does. it means each time you run things, assuming nothing has changed, you will get the same results.
[2012-01-09 17:15:00 -0500] carljm: it means what idempotent means: "can be applied multiple times without changing the result beyond the initial application" (http://en.wikipedia.org/wiki/Idempotence)
[2012-01-09 17:15:00 -0500] itwasntandy: yes, I did maths at uni I know what it means
[2012-01-09 17:16:00 -0500] carljm: that isn't really related to the order in which recipes are applied (though they should be applied in the same order each time unless you change something)
[2012-01-09 17:16:00 -0500] itwasntandy: however practically it means it needs to respect the order of the recipe.
[2012-01-09 17:17:00 -0500] ukio: another thing i was wondering about in this regard:
[2012-01-09 17:17:00 -0500] carljm: in any case, ukio's question isn't really about idempotence at all, it's just about the fact that chef recipes aren't all-encompassing. so by removing a file resource you aren't declaring that the file should not exist, you are declaring that you don't care whether that file exists.
[2012-01-09 17:17:00 -0500] carljm: if you care that it does not exist, you need to have a resource specifying that.
[2012-01-09 17:17:00 -0500] itwasntandy: the caveat being, that it is possible for some providers to not be idempotent.
[2012-01-09 17:18:00 -0500] itwasntandy: sure
[2012-01-09 17:19:00 -0500] ukio: yep, actually the context of my question was how to handle the fact that cookbooks evolve by time (and sometimes you start removing things from a cookbook). however, the discussion made idempotence more clear to me as well! :-)
[2012-01-09 17:22:00 -0500] ukio: question in the same direction: if you are using data bags to manage bags of stuff, is there any way to know when stuff is removed?
[2012-01-09 17:22:00 -0500] ukio: e.g. consider the sysadmins recipe in the users cookbook
[2012-01-09 17:22:00 -0500] ukio: https://github.com/opscode/cookbooks/blob/master/users/recipes/sysadmins.rb
[2012-01-09 17:23:00 -0500] ukio: afaik the idea is to manage the bag of sysadmin users
[2012-01-09 17:23:00 -0500] ukio: adding a new user / sysadmin makes sure it creates this guys home folder etc
[2012-01-09 17:23:00 -0500] iroller: Hey opscode guys, can you help me a please? knife search problem : https://gist.github.com/1583983
[2012-01-09 17:24:00 -0500] ukio: what if one of the sysadmins gets hit by a bus? is removing him from the databag enough?
[2012-01-09 17:24:00 -0500] iroller: What am I doing wrong?
[2012-01-09 17:24:00 -0500] jtimberman: ukio: the users cookbook doesn't (yet) handle removing users.
[2012-01-09 17:25:00 -0500] iroller: ukio: afaik there is no automatic user removing from all the servers after deleting from data bag
[2012-01-09 17:25:00 -0500] jtimberman: COOK-623 has something to address that iirc, and its on the list of things to merge.
[2012-01-09 17:25:00 -0500] ukio: @jtimberman: is there any way to handle removals from a databag in a specific way?
[2012-01-09 17:26:00 -0500] ukio: @jtimberman: its not about that specific cookbook, just about the general possibility of doing this in a comfortable way
[2012-01-09 17:27:00 -0500] jtimberman: ukio: you would have to account for that in the code.
[2012-01-09 17:27:00 -0500] jtimberman: but to make it aware that something *was* there and isn't now, is tricky
[2012-01-09 17:28:00 -0500] jtimberman: the approach in COOK-623 is to have an additional field in the data bag items that says what to do with the user (create or remove iirc)
[2012-01-09 17:29:00 -0500] ukio: yeah i see, but looking at how its done for COOK-623 definitely helps, thanks for the pointer!
[2012-01-09 17:32:00 -0500] iroller: @jtimberman: hey, could you please look into my gist? I really don't understand why some of my IP addresses are not searchable
[2012-01-09 17:45:00 -0500] ssd7: iroller: Are you absolutely sure fqdn is set on the node that should be returned from search?
[2012-01-09 17:46:00 -0500] iroller: @ssd7: absolutely
[2012-01-09 17:46:00 -0500] iroller: @ssd7: there is no output at all, even a newline btw
[2012-01-09 17:47:00 -0500] ssd7: iroller: Ahh, ok.  I infered there might be a newline from the gist, hence the question.  Let me read more closely with that in mind.  Also, does the following return the exected results: knife search node 'addresses:10.10.0.80'
[2012-01-09 17:49:00 -0500] iroller: @ssd7: sorry for confusing. Your command gives '0 items found'
[2012-01-09 17:49:00 -0500] iroller: and 'knife search node 'network_interfaces_*_addresses:10.10.0.80'' gives the output I want
[2012-01-09 17:50:00 -0500] iroller: for some of my nodes your command works fine: knife search node 'addresses:10.10.0.82' => 1 items found
[2012-01-09 17:54:00 -0500] ssd7: Interesting.  You can try forcing the node to be reindexed by re-saving it and then waiting a minute or two: knife exec -E 'n = nodes.show('nodename'); n.save'
[2012-01-09 17:55:00 -0500] ladyjane_95136: http://pastebin.com/bP9ss3EH
[2012-01-09 17:55:00 -0500] mostlygeek: how do i get a resource to only run once, ie: i only want nginx to be reloaded once after all recipes have run. i used notify but these queue up and nginx can be reloaded multiple times
[2012-01-09 17:55:00 -0500] ladyjane_95136: Hey guys,  I went to upgrade chef from 9 to 10 and am getting solr errors when attempting to reindex
[2012-01-09 17:55:00 -0500] ladyjane_95136: with knife
[2012-01-09 17:56:00 -0500] iroller: @ssd7: ok, will do it now
[2012-01-09 18:00:00 -0500] iroller: @ssd7: doesn't help :( any other ideas?
[2012-01-09 18:06:00 -0500] ssd7: iroller: Unforutnately not at the moment, but my attention is a bit split at the moment.  I would maybe do knife node show NODENAME -a network.interfaces and look for any odd differences between the one that is broken and one that isn't
[2012-01-09 18:10:00 -0500] ranjibd: ladyjane_95136, may be your api client needs re registration
[2012-01-09 18:10:00 -0500] iroller: @ssd7: I don't see any odd difference...
[2012-01-09 18:10:00 -0500] ladyjane_95136: oh  thanks ranji  I'll try that
[2012-01-09 18:18:00 -0500] rrichardsr3: any major issues with using the application cookbook with postgresql instead of mysql? I was going to plugin an nginx+passenger cookbook i hacked as well
[2012-01-09 18:21:00 -0500] defghanistan: I am trying to configure my firewall/proxies to allow a node to do an intial chef-client run and register with the opscode platform. Can anyone elaborate on what actually happens when this goes through? Alternatively a link to some detailed documentation would work, I can only find basic info.
[2012-01-09 18:22:00 -0500] ranjibd: defghanistan, its all outbound traffic
[2012-01-09 18:23:00 -0500] defghanistan: ranjibd: Thank you, but is it 443? Is it going over ssh? Is it possible to get this to work through a proxy or will the proxy fail because of the node specific information?
[2012-01-09 18:23:00 -0500] ranjibd: chef client checks if it can find the client.pem, if yes uses that to start a communication with the chef server , if client.pem is not found then chef client  checks if a validation.pem is available, it uses that to register itself
[2012-01-09 18:23:00 -0500] ranjibd: no.. https
[2012-01-09 18:23:00 -0500] ranjibd: sorry
[2012-01-09 18:24:00 -0500] ranjibd: 4000 , http ,
[2012-01-09 18:25:00 -0500] ranjibd: you should be able to get it through proxy
[2012-01-09 18:25:00 -0500] ranjibd: but i have never tried
[2012-01-09 18:25:00 -0500] ranjibd: but i can assert that its all outbound traffic, that too on port 4000 of the opscode server , and its http
[2012-01-09 18:28:00 -0500] bemu: Does anyone know if you can set: deleteOnTermination on EBS volume creation, as opposed to after the fact? Further, is doing it at either time supported by the right_aws gem? It doesn't seem that way on a cursory review of the code, but wanted to check.
[2012-01-09 18:36:00 -0500] Damm: bemu, that's really only for AMI root's
[2012-01-09 18:36:00 -0500] Damm: bemu, you want to delete the EBS root when you terminate the instance
[2012-01-09 18:36:00 -0500] bemu: You can set it for post-creation volumes as well.
[2012-01-09 18:36:00 -0500] Damm: and some people don't want to
[2012-01-09 18:36:00 -0500] Damm: right, not sure that triggers
[2012-01-09 18:36:00 -0500] bemu: It just doesn't seem that the right_aws gem supports this?
[2012-01-09 18:36:00 -0500] Damm: you know amazon
[2012-01-09 18:36:00 -0500] Damm: right_aws is ooold
[2012-01-09 18:36:00 -0500] Damm: older then hornbeck's asscrack
[2012-01-09 18:36:00 -0500] bemu: :(
[2012-01-09 18:37:00 -0500] Damm: I know that's a dumb joke in here
[2012-01-09 18:37:00 -0500] Damm: but I giggled
[2012-01-09 18:37:00 -0500] bemu: Whyyyy does the AWS cookbook still use it?
[2012-01-09 18:37:00 -0500] Damm: bemu, no one re-wrote aws to use fog
[2012-01-09 18:37:00 -0500] Damm: bemu, worst excuse ever huh
[2012-01-09 18:37:00 -0500] bemu: Heheh.
[2012-01-09 18:37:00 -0500] jtimberman: defghanistan: you'll need port 443 to "api.opscode.com" and "s3.amazonaws.com"
[2012-01-09 18:37:00 -0500] jtimberman: defghanistan: s3 is used for storing cookbooks.
[2012-01-09 18:38:00 -0500] bemu: I can't complain. I'm happy there is this much done!
[2012-01-09 18:38:00 -0500] jtimberman: port 4000 is not used for Opscode Hosted Chef.
[2012-01-09 18:39:00 -0500] bemu: ohh, fog does have this feature, btw.
[2012-01-09 18:39:00 -0500] bemu: https://github.com/fog/fog/blob/master/lib/fog/aws/models/compute/volume.rb#L14
[2012-01-09 18:40:00 -0500] bemu: https://github.com/fog/fog/blob/master/lib/fog/aws/models/compute/volumes.rb#L25
[2012-01-09 18:40:00 -0500] defghanistan: jtimberman: Thank you for the info
[2012-01-09 18:40:00 -0500] necromancer: hey i'm getting a strange error when running my chef scripts... https://gist.github.com/1e45b5ed1bd32806609b
[2012-01-09 18:43:00 -0500] bemu: Damm: So how much work would it be to create an ubuntu image for HVM on US West?
[2012-01-09 18:45:00 -0500] ranjibd: jtimberman, sorry .. forgot its opscode .. i was thinking about normal chef servers :-0/
[2012-01-09 18:45:00 -0500] dodizzle: just doscovered "not_if" life is good
[2012-01-09 19:02:00 -0500] Damm: bemu, that's the problem they don't list them... so unless you can find a linux hvm ami to convert
[2012-01-09 19:02:00 -0500] Damm: bemu, you want ubuntu to make one... otherwise you're stuck paying windows license
[2012-01-09 19:02:00 -0500] Damm: bemu, because they have HVM Windows AMI's but not Linux in some regions
[2012-01-09 19:02:00 -0500] bemu: Gotcha.
[2012-01-09 19:20:00 -0500] WoOh: Hm is it possible to define configure args for source install from ports? WITH_* ?
[2012-01-09 19:29:00 -0500] necromancer: hey guys, can anyone using the postgresql cookbook possibly help me out with this one? https://gist.github.com/bd9e2979ed05f68bdda6
[2012-01-09 19:39:00 -0500] jtimberman: necromancer: I don't see that resource in postgresql::server_debian
[2012-01-09 19:40:00 -0500] thehar: jtimberman: are you coming to our hack day?
[2012-01-09 19:41:00 -0500] necromancer: thanks jtimberman
[2012-01-09 19:41:00 -0500] jtimberman: thehar: the one in SF? Unfortunately I have to fly back that Friday.
[2012-01-09 19:41:00 -0500] thehar: sad
[2012-01-09 19:41:00 -0500] jtimberman: (I'm teaching Chef Fundamentals that week :D)
[2012-01-09 19:41:00 -0500] thehar: in sf!
[2012-01-09 19:42:00 -0500] jtimberman: necromancer: if it is one you or someone you work with added to your local copy, you'll probably need to create the directory beforehand
[2012-01-09 19:44:00 -0500] necromancer: jtimberman: yeah...now i have to figure out what dir i can put it in that the vagrant user has access to :)
[2012-01-09 19:46:00 -0500] dj_ryan: hi chefers, a question on an error
[2012-01-09 19:47:00 -0500] dj_ryan: https://gist.github.com/1584579
[2012-01-09 19:48:00 -0500] dj_ryan: there we go
[2012-01-09 19:48:00 -0500] dj_ryan: basically our SA had removed the collectd plugin, now this (him iah!)
[2012-01-09 19:48:00 -0500] dj_ryan: (hi miah)
[2012-01-09 20:07:00 -0500] tolland: is there a directive to check a particular file out of svn and use that in config?
[2012-01-09 20:07:00 -0500] Urocyon: How do you get a node's current environment?
[2012-01-09 20:07:00 -0500] tolland: also, i think i asked this before, but can i use a svn as a source for a template or do I need a LWRP for that?
[2012-01-09 20:10:00 -0500] Urocyon: tolland: not sure what you are asking.  Do you mean rather than putting a file in your cookbook, you want it to just pull a file from some other repository and use that as a template?
[2012-01-09 20:11:00 -0500] jhulten: tolland: AFAIK templates must be in the templates directory and ship with the cookbook. if you want to pull them from an outside source you will need to build a new resource...
[2012-01-09 20:11:00 -0500] mkent_: Urocyon, node.chef_environment
[2012-01-09 20:11:00 -0500] Urocyon: mkent_: thanks.  It wasn't showing up in my node attributes, so I wasn't sure that would work.
[2012-01-09 20:12:00 -0500] mkent_: ;)
[2012-01-09 20:14:00 -0500] Urocyon: Is there a way to say "there can be only 1 node with this role in a given environment"?
[2012-01-09 20:16:00 -0500] Urocyon: Or maybe something like a command that says, "if other nodes already exist with this role, remove that role from their run list."
[2012-01-09 20:17:00 -0500] Urocyon: hmmm, maybe that's something better done by whatever provisions my servers.
[2012-01-09 20:52:00 -0500] ardell: anybody know whether chef-solo can be run without sudo privileges?
[2012-01-09 20:55:00 -0500] workmad3: ardell: it can... if you only want to make changes that your user can manage
[2012-01-09 21:01:00 -0500] ardell: workmad3: cool thanks
[2012-01-09 21:36:00 -0500] jondot2: hi guys. i want to see if chef covers a use case that i was thinking about
[2012-01-09 21:37:00 -0500] jondot2: we had a Redis instance taken down by a defunct EC2 instance. since Redis failover is quite a bad story, we had to manually configure our failover scenario over EC2.
[2012-01-09 21:37:00 -0500] jondot2: i'm wondering, if chef is able to be given a workflow script that would reconfigure EC2 itself. for exampe: given a stopped instance X, remove it from elastic IP, spin up a new instance, attach it to that IP.
[2012-01-09 21:38:00 -0500] jondot2: or is it the wrong tool for this?
[2012-01-09 21:40:00 -0500] mattray: jondot2: in a Chef-managed scenario, your other nodes would have known about the Redis instance by search
[2012-01-09 21:40:00 -0500] mattray: jondot2: so when you brought up a replacement, you wouldn't need the same IP
[2012-01-09 21:41:00 -0500] mattray: you could, but not required
[2012-01-09 21:41:00 -0500] jondot2: how would the nodes know to search other nodes? via ec2 api?
[2012-01-09 21:41:00 -0500] mattray: (and yes, Chef is the right tool for that)
[2012-01-09 21:41:00 -0500] mattray: jondot2: through the Chef server
[2012-01-09 21:41:00 -0500] mattray: all the nodes check into the server, the server exposes them for search
[2012-01-09 21:42:00 -0500] jondot2: aha. interesting. sorry for not knowing this myself, i just started getting into chef - but for now only chef-solo.
[2012-01-09 21:42:00 -0500] jondot2: so what happens if the chef server falls down?
[2012-01-09 21:43:00 -0500] workmad3: jondot2: you get emails @ 2am
[2012-01-09 21:43:00 -0500] jondot2: :)
[2012-01-09 21:43:00 -0500] mattray: jondot2: your machines don't change until the server is back
[2012-01-09 21:43:00 -0500] siezer: use hostes chef and opscode gest the emails instead
[2012-01-09 21:43:00 -0500] siezer: s/hostes/hosted/
[2012-01-09 21:43:00 -0500] mattray: jondot2: which is what makes Hosted Chef attractive with SLAs
[2012-01-09 21:44:00 -0500] workmad3: I use my own chef server :)
[2012-01-09 21:44:00 -0500] mattray: workmad3: then you own your SLAs :)
[2012-01-09 21:44:00 -0500] jondot2: i see. ok, but then when you say 'search' what would that mean in reality?
[2012-01-09 21:44:00 -0500] mattray: http://wiki.opscode.com/display/chef/Search
[2012-01-09 21:44:00 -0500] workmad3: jondot2: just that... the chef server maintains a solr index of all the nodes that have contacted it
[2012-01-09 21:44:00 -0500] siezer: yep
[2012-01-09 21:44:00 -0500] workmad3: jondot2: and you can query that in recipes to get information
[2012-01-09 21:44:00 -0500] mattray: and all their attributes
[2012-01-09 21:44:00 -0500] siezer: lets you pull off some slickery too: https://bitly.com/
[2012-01-09 21:45:00 -0500] mattray: "give me all the nodes with 4 gigs of RAM running Node.js"
[2012-01-09 21:45:00 -0500] jondot2: hm. but this is during provisioning time?
[2012-01-09 21:45:00 -0500] siezer: any time
[2012-01-09 21:45:00 -0500] mattray: jondot2: chef-solo is essentially one-shot
[2012-01-09 21:46:00 -0500] mattray: jondot2: chef with a server is continual updates
[2012-01-09 21:46:00 -0500] jondot2: so even in my application code, i can rely on locating other nodes?, for instance, say i'm in my rails app and i'm initializing ActiveRecord - i can make rails contact the chef server instead?
[2012-01-09 21:46:00 -0500] mattray: yes
[2012-01-09 21:46:00 -0500] mattray: those applications are reading configuration files, which can be managed with Chef
[2012-01-09 21:47:00 -0500] mattray: update to the config file, restart the service to get the changes. But only when there are changes
[2012-01-09 21:47:00 -0500] jondot2: ah. interesting. so in case a node crashes, chef can discover it, then overwrite configurations over every application that reference that node, and restart the applications? that makes sense?
[2012-01-09 21:48:00 -0500] jondot2: ah, you just said that
[2012-01-09 21:50:00 -0500] mattray: yup
[2012-01-09 21:52:00 -0500] jondot2: ok then, i guess thats the 'configuration management part'
[2012-01-09 21:52:00 -0500] jondot2: thanks, i'll have to read up on it
[2012-01-09 22:35:00 -0500] imorg: hello to all members of the IRC, I am new here and green to chef too :)
[2012-01-09 22:35:00 -0500] bemu: Is it possible to get a node's chef_environment at compile time?
[2012-01-09 22:36:00 -0500] ssd7: bemu: Yeah, it should just be there in node.chef_environment, are you seeing somethign that indicates it isn't?
[2012-01-09 22:37:00 -0500] imorg: I am trying to populate a template based on conditions, I have tried these 2 options.
[2012-01-09 22:37:00 -0500] imorg: <% if @params[:components_active] = "publisherapi" then -%>
[2012-01-09 22:37:00 -0500] imorg: [publisherapi.publisher_database]
[2012-01-09 22:37:00 -0500] imorg: args.forshare = 0
[2012-01-09 22:37:00 -0500] imorg: [publisherapi.database.postgres.primary]
[2012-01-09 22:37:00 -0500] imorg: args.dns = dbname=publisher_prd user=postgres host=sgpublisher.storage.ny1.daylife.com
[2012-01-09 22:37:00 -0500] imorg: <% end -%>
[2012-01-09 22:38:00 -0500] Damm: why are you trying to grok @params in a template?
[2012-01-09 22:38:00 -0500] imorg: on this case it will apply even if the variable is different
[2012-01-09 22:38:00 -0500] ssd7: You have an assignment (=) rather than a test (==) in your if statement
[2012-01-09 22:39:00 -0500] miah: has anybody built a cookbook for stud? (i'm feeling lazy)
[2012-01-09 22:39:00 -0500] imorg: how should I do it?
[2012-01-09 22:39:00 -0500] Damm: miah, why would you want to use stud?
[2012-01-09 22:39:00 -0500] bemu: ssd7: yah, accessing it in a provider.
[2012-01-09 22:39:00 -0500] miah: Damm: or another ssl terminator
[2012-01-09 22:39:00 -0500] bemu: ssd7: But I'm going to change the logic, so not a problem.
[2012-01-09 22:39:00 -0500] miah: pound is being weird
[2012-01-09 22:39:00 -0500] Damm: miah, nginx
[2012-01-09 22:40:00 -0500] miah: maybe
[2012-01-09 22:40:00 -0500] Damm: miah, you might need to configure nginx ssl sessions or caching to get it
[2012-01-09 22:40:00 -0500] Damm: miah, but the old stunnel/pound/stud gag
[2012-01-09 22:40:00 -0500] Damm: miah, can I just say it's a bad pattern that I think people should stop?
[2012-01-09 22:40:00 -0500] miah: you can
[2012-01-09 22:40:00 -0500] imorg: @Damm: I am trying the param because is the only thing that will change on my template
[2012-01-09 22:40:00 -0500] miah: so, i was using ELB for ssl termination since haproxy doesn't do ssl
[2012-01-09 22:41:00 -0500] miah: but elb is a pos
[2012-01-09 22:41:00 -0500] Damm: miah, elb is a piece of shit and yes haproxy doesn't work and tproxy is a joke
[2012-01-09 22:41:00 -0500] miah: haproxy works fine enough
[2012-01-09 22:41:00 -0500] Damm: miah, right
[2012-01-09 22:41:00 -0500] Damm: but not for giving you ssl ips
[2012-01-09 22:41:00 -0500] miah: i need to investigate varnish
[2012-01-09 22:41:00 -0500] miah: ya
[2012-01-09 22:41:00 -0500] miah: =)
[2012-01-09 22:41:00 -0500] bemu: miah: You could put nginx in front of haproxy...
[2012-01-09 22:41:00 -0500] Damm: and if you need ssl ips you need to stop looking for hacks and just do it right the first time
[2012-01-09 22:42:00 -0500] bemu: :P
[2012-01-09 22:42:00 -0500] miah: hah
[2012-01-09 22:42:00 -0500] Damm: bemu, oh you mean do it right?
[2012-01-09 22:42:00 -0500] miah: i think "do it right" is subjective
[2012-01-09 22:42:00 -0500] miah: nginx would probably work fine though
[2012-01-09 22:42:00 -0500] bemu: I use haproxy and nginx. haproxy has better load balancing algorithms. nginx has more features.
[2012-01-09 22:43:00 -0500] Damm: miah, everything is subjective when people reinvent the shed/wheel every 30cycles
[2012-01-09 22:43:00 -0500] bemu: and I always run nginx on application servers.
[2012-01-09 22:43:00 -0500] miah: there are usually reasons people reinvent the wheel though
[2012-01-09 22:43:00 -0500] bemu: what I use at the proxy level just depends on requirements.
[2012-01-09 22:43:00 -0500] Damm: damn ubuntu ami's don't work well for hvm conversion
[2012-01-09 22:44:00 -0500] Damm: grub couldnt' see anything past sda
[2012-01-09 22:44:00 -0500] dj_ryan: one major issue with our setup is we dont want store-and-forward for posts
[2012-01-09 22:44:00 -0500] bemu: I'll go nginx -> haproxy if I need to do things haproxy can't. Otherwise I'll use haproxy.
[2012-01-09 22:44:00 -0500] Damm: :/
[2012-01-09 22:44:00 -0500] miah: right
[2012-01-09 22:44:00 -0500] miah: nginx doesnt deal with streaming very well
[2012-01-09 22:44:00 -0500] Damm: miah, the problem I find is there are not enough 'best practices' and enough 'good practices' that people waffle
[2012-01-09 22:44:00 -0500] Damm: until their panties fall out
[2012-01-09 22:44:00 -0500] bemu: Well, it does, it just needs to be massaged. a lot.
[2012-01-09 22:44:00 -0500] yfeldblum: miah, yep, very frustrating :(
[2012-01-09 22:44:00 -0500] miah: my panties are well attached
[2012-01-09 22:44:00 -0500] Damm: lol
[2012-01-09 22:45:00 -0500] bemu: I put multi-gig uploads through multiple layers of nginx, but it took a lot of testing.
[2012-01-09 22:45:00 -0500] defghanistan: Just brought up IRC to see panty detachment- not bad for monday at 2:45pm
[2012-01-09 22:45:00 -0500] yfeldblum: bemu, it doesn't support streaming downward, so far as i can see
[2012-01-09 22:45:00 -0500] bemu: Not sure about that.
[2012-01-09 22:45:00 -0500] yfeldblum: bemu, when it's a reverse proxy
[2012-01-09 22:46:00 -0500] yfeldblum: bemu, doesn't support streaming responses from upstream thru nginx to the client
[2012-01-09 22:46:00 -0500] bemu: oh, right.
[2012-01-09 22:46:00 -0500] bemu: That's why they always warn you against using progress bars based on as much.
[2012-01-09 22:46:00 -0500] yfeldblum: can't download large files which are delivered by the back-end application
[2012-01-09 22:47:00 -0500] bemu: wait, why?
[2012-01-09 22:47:00 -0500] yfeldblum: you can use x-accel-redirect, but i mean without that
[2012-01-09 22:47:00 -0500] bemu: What happens?
[2012-01-09 22:47:00 -0500] defghanistan: Anyway: Trying to troubleshoot why my Windows knife client keeps yelling at me about no editor environment variable set for "EDITOR" when it is very clearly set? Is there a way to force knife to always use X for an editor? I tried settting "EDITOR" in knife.rb
[2012-01-09 22:48:00 -0500] yfeldblum: because nginx buffers the entire response from the back-end, which can take a while (say N seconds); then if nginx is configured to timeout after K seconds of no bytes being transferred, if K < N, nginx 503's the response
[2012-01-09 22:48:00 -0500] bemu: ah yeah, but you just need to change your tiemouts.
[2012-01-09 22:48:00 -0500] bemu: That's what I had to play around with a lot.
[2012-01-09 22:49:00 -0500] yfeldblum: that's a hack; nginx needs to support streaming responses from back-ends
[2012-01-09 22:49:00 -0500] bemu: Well, one of the things.
[2012-01-09 22:49:00 -0500] bemu: Yeah, has been said for years.
[2012-01-09 22:49:00 -0500] bemu: :/
[2012-01-09 22:49:00 -0500] yfeldblum: i need the first bytes to flow instantaneously
[2012-01-09 22:49:00 -0500] bemu: Gotcha.
[2012-01-09 22:50:00 -0500] yfeldblum: i'm out, latez
[2012-01-09 22:50:00 -0500] bemu: Later.
[2012-01-09 22:51:00 -0500] miah: yfeldblum, bemu ya, and that sucks if your company does online file sharing =)
[2012-01-09 22:51:00 -0500] bemu: Used to.
[2012-01-09 22:54:00 -0500] patcon: anyone know whether a simple bash resource would need any special approach if a command is both in the "code" resource attr and also in the not_if ruby block as %x[ ] ?
[2012-01-09 22:54:00 -0500] patcon: seems to just be failing unless i add random sleep's, and i'm baffled
[2012-01-09 22:54:00 -0500] patcon: tried "command && wait $?" too, but no dice, only sleeps work
[2012-01-09 23:14:00 -0500] Brad_K: so this is driving me absolutely flippin' batty.
[2012-01-09 23:15:00 -0500] Brad_K: i uploaded a new version of a cookbook to Hosted Chef, and everything but the templates render through to a chef-client just fine.  But the templates aren't being updated.
[2012-01-09 23:19:00 -0500] siezer: gist the template?
[2012-01-09 23:21:00 -0500] Brad_K: siezer: see https://gist.github.com/ee812de0496fd8af7102
[2012-01-09 23:21:00 -0500] Brad_K: this is from the monit cookbook.
[2012-01-09 23:22:00 -0500] siezer: temlpate looks fine...
[2012-01-09 23:24:00 -0500] Brad_K: right.  and the previous version of the template (the only change being on line 9, where it used to say "local0" instead of "Local0" rendered through okay.  of course, monit barfed on that config, which is why i changed the template to what it is now, and then tried to get it to re-render.
[2012-01-09 23:24:00 -0500] Brad_K: but i've done the knife cookbook upload, and when that didn't get the template to re-render, i even bumped the version number for the cookbook in metadata.rb.  the bumped version number came through, but not the updated template.
[2012-01-09 23:28:00 -0500] mattray: Brad_K: perhaps you've locked it down in an environment?
[2012-01-09 23:29:00 -0500] Brad_K: no, there is one recipe in this cookbook that i've locked down to the production & staging environments, but that's it.  none of the templates.
[2012-01-09 23:30:00 -0500] Brad_K: and i haven't frozen any of our environments.
[2012-01-09 23:46:00 -0500] mattray: Brad_K: delete your cookbook and re-upload?
[2012-01-09 23:53:00 -0500] Brad_K: sorry, i was talking to some co-workers.
[2012-01-09 23:54:00 -0500] Brad_K: do you mean delete the cookbook from the hosted chef server and re-upload?  i'll give that a try....
