[2012-01-04 09:13:00 -0500] maxrabin: Hi. Knfe ssh isn't finding any nodes. No matter how I formulate the query, it alwyas says "FATAL: No nodes returned from search!". I know that knife can find the nodes b/c when I do `knife search node name:*` it finds the nodes. Any ideas?
[2012-01-04 09:37:00 -0500] maxrabin: Another question: I'm setting up nfs on one node to serve to ther nodes. The server has role nfs_server and the clients have role webserver. I'm using http://community.opscode.com/cookbooks/nfs and in the example nfs_server.rb it exports to 10.0.0.0 - I want instead to populate the file with one line per webserver. How do I do that?
[2012-01-04 09:38:00 -0500] maxrabin: and of course put in the ip address of each webserver on a different line
[2012-01-04 10:10:00 -0500] maxrabin: How do I set attributes based on a  search? I'd like to set an attribute to be an array of strings that contain the ip addresses of nodes with  a specific role. Thanks.
[2012-01-04 10:33:00 -0500] BryanWB: ohai chefs!
[2012-01-04 10:33:00 -0500] BryanWB: happy new year! buon anno!
[2012-01-04 11:14:00 -0500] nacer: ohai
[2012-01-04 11:14:00 -0500] nacer: oh Farzy
[2012-01-04 11:15:00 -0500] nacer: \o/ http://pastebin.com/XWqBtRWW first LWRP, it's really easy
[2012-01-04 11:58:00 -0500] BryanWB: nacer: congrats
[2012-01-04 12:02:00 -0500] laurent\: is there a simple way to expand recipes, roles and attributes on a node without having to run chef-client on the node ?
[2012-01-04 12:04:00 -0500] BryanWB: laurent\: that is a great question, i think that shef will get u most of the way there but won't expand roles unfortunately
[2012-01-04 12:04:00 -0500] BryanWB: maybe spice can do it?
[2012-01-04 12:05:00 -0500] laurent\: spice ? what's that ? :)
[2012-01-04 12:06:00 -0500] laurent\: spice, chef, recipe, cookbook, knife, .... that's funny but that's not helping when using search engines :)
[2012-01-04 12:24:00 -0500] BryanWB: laurent\: sorry, afk for a while
[2012-01-04 12:24:00 -0500] BryanWB: https://github.com/danryan/spice
[2012-01-04 12:24:00 -0500] laurent\: thanks
[2012-01-04 12:24:00 -0500] BryanWB: spice lets u interact directly w/ chef-server
[2012-01-04 12:25:00 -0500] BryanWB: like shef but u don't have to chef gem installed
[2012-01-04 12:26:00 -0500] laurent\: ok. if there is no simple way to do it i'd rather do it with shef then
[2012-01-04 12:32:00 -0500] BryanWB: laurent\: shef can't apply roles to node object
[2012-01-04 12:32:00 -0500] BryanWB: spice is pretty trivial to use
[2012-01-04 12:33:00 -0500] erikh: the chef api by itself isn't terribly hard either
[2012-01-04 12:33:00 -0500] erikh: but you do have to read some source code.
[2012-01-04 12:36:00 -0500] laurent\: BryanWB: why shef wouldn't be able to it ?
[2012-01-04 12:40:00 -0500] BryanWB: shef doesn't apply properties inherited from roles to the node object
[2012-01-04 12:40:00 -0500] BryanWB: s/properties/attributes/
[2012-01-04 12:47:00 -0500] laurent\: BryanWB: in what mode ? i don't see why i would be able to do it with a shef or knife script
[2012-01-04 12:48:00 -0500] laurent\: s/would/wouldn't/
[2012-01-04 12:48:00 -0500] BryanWB: laurent\: in client mode
[2012-01-04 12:58:00 -0500] jondot2: hi guys. what is the relationship between chef and capistrano?
[2012-01-04 12:58:00 -0500] laurent\: BryanWB: ok, do you have any reference (wiki, ticket) to this ? (shef no applying attributes from roles to nodes)
[2012-01-04 12:59:00 -0500] BryanWB: adam jacob told me so on chef ML
[2012-01-04 12:59:00 -0500] BryanWB: and I experienced it to my discomfort
[2012-01-04 12:59:00 -0500] laurent\: ok :)
[2012-01-04 13:06:00 -0500] laurent\: BryanWB: ok, i'm just working around the limitation with something like this : a=Chef::Node.load(nodename); a.override_attrs.merge!(a.expand!.override_attrs); a.save
[2012-01-04 13:06:00 -0500] BryanWB: nice
[2012-01-04 13:08:00 -0500] maxrabin: Hi all, I'm trying to get chef set up and `knife ssh`isn't finding my nodes. I know it should be able to because when I can do `knife search` and  I find them but `knife ssh id:* uptime` or `knife ssh name:* uptime` aren't working. Any ideas?
[2012-01-04 13:16:00 -0500] BryanWB: maxrabin: have u tried putting quotes around the 'id:*'  ?
[2012-01-04 13:17:00 -0500] maxrabin: BryanWB same result
[2012-01-04 13:18:00 -0500] BryanWB: argh, no idea then
[2012-01-04 13:18:00 -0500] maxrabin: thx
[2012-01-04 13:47:00 -0500] judu: Hello
[2012-01-04 13:48:00 -0500] judu: Can someone explain to me (or point me a link out) how knife configuration work ?
[2012-01-04 13:48:00 -0500] judu: (And chef's too)
[2012-01-04 13:48:00 -0500] tightwork: I'm trying to work with the knife-openstack plugin. I have a single node openstack diablo setup, and It seems to work and creates a VM calling knife openstack server create -I ami-0000002 -f m1.small --openstack-api-endpoint 'http://172.16.0.21:8773/services/Cloud', although it fails bootstrapping Chef because it is attempting to ssh into the fixed range IP. Ideally it should allocate a floating IP. Anyone familiar with using chef an
[2012-01-04 13:48:00 -0500] tightwork: d openstack? Overall this is the real deal right here and really exciting,
[2012-01-04 13:49:00 -0500] judu: If I run knife, where does it look for configuration by default? Is there a main conf file?
[2012-01-04 13:49:00 -0500] tightwork: judu: generally ~/.chef/knife.rb is the best place per user
[2012-01-04 13:55:00 -0500] judu: Ok. So if I run knife, it looks first in ~/.chef/knife.rb
[2012-01-04 13:55:00 -0500] judu: Beside that, I could not find (I may be too low to find it) what configuration I can put in knife.rb.
[2012-01-04 14:15:00 -0500] dwhsix: is there a way to include a role as part of another one?  or bad practice?  I'll explain:
[2012-01-04 14:15:00 -0500] dwhsix: I current have a 'queue' role
[2012-01-04 14:16:00 -0500] Mithrandir: you can put a role in a run list of another role
[2012-01-04 14:16:00 -0500] dwhsix: ah
[2012-01-04 14:16:00 -0500] dwhsix: you beat me to it that would work
[2012-01-04 14:16:00 -0500] dwhsix: Mithrandir: thx!
[2012-01-04 14:16:00 -0500] dwhsix: is it run_list("role[rolename]") ?
[2012-01-04 14:17:00 -0500] Mithrandir: I think it's ok to do it, but you should be careful about how you build it so it's not a house of cards.
[2012-01-04 14:17:00 -0500] Mithrandir: dunno, I tend to edit json by hand
[2012-01-04 14:17:00 -0500] dwhsix: nod
[2012-01-04 14:17:00 -0500] Mithrandir: where it's role[foo] instead of recipe[foo]
[2012-01-04 14:18:00 -0500] laurent\: maxrabin: does it give any clue if you run "knife ssh -VV id:* uptime" ?
[2012-01-04 14:18:00 -0500] dwhsix: I need to add queue-primary and queue-secondary roles I'm inclined to stick w/ a more classic way, not do the "include" will experiement
[2012-01-04 14:18:00 -0500] maxrabin: DEBUG: Using configuration from /root/.chef/knife.rb
[2012-01-04 14:18:00 -0500] maxrabin: DEBUG: Signing the request as dev
[2012-01-04 14:18:00 -0500] maxrabin: DEBUG: Sending HTTP Request via GET to ec2-107-22-38-104.compute-1.amazonaws.com:4000/search/node
[2012-01-04 14:18:00 -0500] maxrabin: FATAL: No nodes returned from search!
[2012-01-04 14:30:00 -0500] richleland: anyone have an issue where the knife-ec2 commands bomb out randomly?
[2012-01-04 14:30:00 -0500] richleland: I always have to run it several times before it'll go through the entire process properly
[2012-01-04 14:30:00 -0500] lflux: hi
[2012-01-04 14:31:00 -0500] lflux: I'm having problems with gem_package. Apparently it doesn't read /etc/gemrc for my proxy settings
[2012-01-04 14:31:00 -0500] lflux: anyone else run into this?
[2012-01-04 14:36:00 -0500] Brad_K: richleland: i've had problems with the knife rackspace commands bombing out sometimes because of API problems on their end.  but most of my problems with executing knife have been a result of me trying to do something while i am not in the correct directory structure.
[2012-01-04 14:37:00 -0500] richleland: Brad_K this happens to me pretty much every time I run knife ec2 - bombs out sometimes during instantiation, sometimes durring ssh connect, sometimes during bootstrap
[2012-01-04 14:37:00 -0500] Brad_K: lflux: are you using the omnibus install of chef-client, or did you install via some other method?
[2012-01-04 14:38:00 -0500] lflux: I bootstrapped it from head a couple weeks back
[2012-01-04 14:38:00 -0500] richleland: just curious if this is some kind of known issue and if so where the issue lies
[2012-01-04 14:38:00 -0500] lflux: not sure what "omnibus" install means (kinda new at this)
[2012-01-04 14:38:00 -0500] Brad_K: richleland: no, i can't say that i've ever seen a problem like that before.
[2012-01-04 14:39:00 -0500] lflux: Brad_K: I've set gem: http-proxy http://proxy:3128 in gemrc. works when installing gems manually on the node, but when I run strace against the client it tries to connect directly to the rubygems server
[2012-01-04 14:39:00 -0500] Brad_K: lflux: what i call "omnibus" is more accurately called the "full stack installer", and it gives you a version of chef-client with its own embedded Ruby, ruby gems, and everything else that is necessary for Chef to run.
[2012-01-04 14:40:00 -0500] lflux: I just used knife bootstrap
[2012-01-04 14:40:00 -0500] lflux: so yeah it installed all RPMs and gems and ruby and everything
[2012-01-04 14:41:00 -0500] lflux: not sure about embedded, it pulled in the ruby from yum.
[2012-01-04 14:41:00 -0500] Brad_K: the "omnibus" install uses one big hairy rpm that includes everything, and doesn't use smaller packages.  that is, if you're installing it on a machine that uses rpm.
[2012-01-04 14:41:00 -0500] lflux: yeah it wasn't that.
[2012-01-04 14:42:00 -0500] lflux: thing is the knife bootstrap got the gem proxy correct.
[2012-01-04 14:42:00 -0500] lflux: but not gem_package in recipes
[2012-01-04 14:42:00 -0500] Brad_K: if your chef and all the stuff it uses got installed in /opt/opscode/embedded, then you're running the "Full Stack Install".
[2012-01-04 14:42:00 -0500] lflux: definitely not that. (but it sounds intriguing)
[2012-01-04 14:43:00 -0500] Brad_K: lflux: dunno.  sounds like an environment problem, but i don't know where to tell you to start debugging beyond that.
[2012-01-04 14:43:00 -0500] lflux: I see an open bug, http://tickets.opscode.com/browse/CHEF-2835 about it
[2012-01-04 14:43:00 -0500] lflux: but not sure if the pull req fixes it, or where to set Gem.configuration["gem"] that https://github.com/VictorLowther/chef/tree/vlowther-really-honor-gemrc talks about
[2012-01-04 14:46:00 -0500] Brad_K: lflux: i'm not really a ruby programmer, and i don't work for the company.  if you're not able to read the code that is contained in that pull request and determine whether or not it actually fixes the problem, then you're probably best off waiting for one of the "real" ruby programmers to show up, and/or an opscode employee that might be more familiar with this bug.
[2012-01-04 14:47:00 -0500] Brad_K: i mean, what i read at https://github.com/VictorLowther/chef/commit/fad20a5020b5889dee291a798e4ab261f27c2b75 seems plausible to me, but i can't really say anything more than that.
[2012-01-04 14:48:00 -0500] lflux: Seems that way to me too, but I don't know in which file to put Gem.configuration["gem"] :)
[2012-01-04 14:49:00 -0500] Brad_K: that patch is against chef/lib/chef/provider/package/rubygems.rb
[2012-01-04 14:49:00 -0500] Brad_K: so, if you do a recursive find on your system for that filename, you can try doing the patch manually.
[2012-01-04 14:50:00 -0500] Brad_K: of course, that would need to be done on each chef-client machine where you're having this problem.
[2012-01-04 14:51:00 -0500] lflux: i'll try that patch, reading it more it will pull the config from the gemrc.
[2012-01-04 14:52:00 -0500] Brad_K: make sure to save the old version of that file before you apply the monkey-patched version.  if the patch doesn't work, then you can easily back out.
[2012-01-04 14:53:00 -0500] lflux: patching I understand, it's ruby that i'm not so sure about.
[2012-01-04 14:53:00 -0500] lflux: (also vmware snapshots)
[2012-01-04 14:54:00 -0500] Brad_K: fair enough.  good luck!  feel free to update the ticket with your experience, once you test the patch.
[2012-01-04 14:56:00 -0500] ukio: hey guys
[2012-01-04 14:56:00 -0500] ukio: happy new year!
[2012-01-04 14:57:00 -0500] Brad_K: happy new year to you, too!
[2012-01-04 14:59:00 -0500] BryanWB: yeah! buon anno a tutti!
[2012-01-04 15:01:00 -0500] tightwork: schisamo: You are the author of knife-openstack. Could you lend me a hand? I have a single node openstack I can run knife openstack server create and a server is created, although bootstrap fails because it is attempting to ssh into the fixed private range instead of a public floating IP? Ideally it seems the plugin should associate the vm to a floating IP
[2012-01-04 15:19:00 -0500] richleland: jtimberman random places - instantiation, bootstrapping, ssh
[2012-01-04 15:19:00 -0500] jtimberman: richleland: okay.... log output?
[2012-01-04 15:20:00 -0500] richleland: jtimberman most frequently though I get the Net::SSH::AuthenticationFailed error
[2012-01-04 15:21:00 -0500] richleland: jtimberman occassionally it'll get to Bootstrapping Chef on... part and just hang with no chef run output
[2012-01-04 15:22:00 -0500] richleland: jtimberman it's really random - but I'm always guaranteed to have to run it more than once, most of the time at least three times
[2012-01-04 15:22:00 -0500] richleland: jtimberman I'll run the knife cmd, bomb, terminate, rinse, repeat...
[2012-01-04 15:33:00 -0500] jtimberman: richleland: For Net::SSH authentication issues, I recommend loading your AWS ssh key(s) in your local ssh-agent.
[2012-01-04 15:33:00 -0500] jtimberman: Are you using AWS VPC?
[2012-01-04 15:33:00 -0500] richleland: no on VPC
[2012-01-04 15:34:00 -0500] richleland: I just point to the key file with the knife CLI flag
[2012-01-04 15:38:00 -0500] ukio: hey guys, i'm just getting started with chef hands-on wise. so far i have read through a series of blog posts and parts of the opscode wiki, which all were very helpful. i think i got the big picture, but i'm still having some questions on the conceptual level (probably easy ones for you :-)). anyone willing to help me out?
[2012-01-04 15:39:00 -0500] jtimberman: richleland: okay, well, without log output of whats going on i can only make vague guesses.
[2012-01-04 15:39:00 -0500] jonlives: ukio: best just to ask, and people who know will hopefully answer :)
[2012-01-04 15:39:00 -0500] richleland: jtimberman I hear ya - the log output is that basic though
[2012-01-04 15:39:00 -0500] richleland: jtimberman hold up let me get you a gist
[2012-01-04 15:39:00 -0500] Brad_K: ukio: ask away.  i'm sure that someone here will be able to answer your questions, albeit perhaps not necessarily immediately.
[2012-01-04 15:40:00 -0500] ukio: okay, cool :-)
[2012-01-04 15:41:00 -0500] richleland: jtimberman https://gist.github.com/1560608
[2012-01-04 15:42:00 -0500] jtimberman: richleland: and you can ssh to that instance using the public fqdn with that ssh key?
[2012-01-04 15:43:00 -0500] jtimberman: you can get more information from knife with -V or -VV
[2012-01-04 15:43:00 -0500] richleland: jtimberman yep
[2012-01-04 15:43:00 -0500] jtimberman: does knife bootstrap to that IP work?
[2012-01-04 15:43:00 -0500] jtimberman: knife bootstrap IPADDRESSORFQDN -r yourrunlist -i sshkey -N instance-id
[2012-01-04 15:44:00 -0500] richleland: haven't tried that - it's not that specific box per se, I'll run that knife ec2 create command and if it bombs I just terminate and re-run
[2012-01-04 15:44:00 -0500] richleland: jtimberman but yeah I can give that a whirl next time I run into this issue
[2012-01-04 15:44:00 -0500] richleland: jtimberman I've was able to successfully run the command on the 6th try
[2012-01-04 15:45:00 -0500] richleland: s/I've/I/
[2012-01-04 15:45:00 -0500] jtimberman: richleland: Often when I see that repeatedly, the instance is "up" and SSHd is running, but the host keys aren't generated and it bails out.
[2012-01-04 15:45:00 -0500] ukio: first question is about the workflow of developing recipes. i suspect it is something like (1) code recipe, (2) test (e.g. locally using vagrant), (3) commit changes, (4) upload to chef server using knife
[2012-01-04 15:46:00 -0500] richleland: jtimberman yeah I mean it's not a huge deal for me or anything, I can rinse & repeat, it was more curiosity than anything
[2012-01-04 15:46:00 -0500] jtimberman: richleland: I have in my ~/.ssh/config: Host ec2*compute-1.amazonaws.com
[2012-01-04 15:46:00 -0500] jtimberman: StrictHostKeyChecking no
[2012-01-04 15:46:00 -0500] richleland: jtimberman so if it's that the box isn't actually read, I'm not sure there's an ideal way to handle it
[2012-01-04 15:47:00 -0500] richleland: hmm, perhaps I'll add that
[2012-01-04 15:47:00 -0500] richleland: jtimberman and you've not run into this same issue?
[2012-01-04 15:47:00 -0500] jtimberman: not often anymore :)
[2012-01-04 15:47:00 -0500] ukio: is the idea to always upload new recipes via knife? or is it also common to have the chef server read the latest recipes straight from git?
[2012-01-04 15:47:00 -0500] jtimberman: we've added a sleep in the knife ec2 command.
[2012-01-04 15:48:00 -0500] jtimberman: i see it happen with RHEL systems quite often thoguh.
[2012-01-04 15:48:00 -0500] jtimberman: at least, RHEL systems that are m1.small or t1.micro. m1.large rarely and c1.medium occassinoally
[2012-01-04 15:48:00 -0500] lflux: Is there a way I can spec global options for a resource on a node?
[2012-01-04 15:48:00 -0500] alexrecarey: Hi, I'm having some problems giving roles to servers with knife once they are up. I ran the command knife node run_list add  i-14d9b576 "roles[base_server]". I have a role called "base_server". Well, when I run knife node show, it shows "recipe[recipe[roles[base_server]]]" in the Run List section, instead of roles. When I run knife node run_list remove i-14d9b576 "roles[base_server]" to try to remove it, it actualy ADDS more roles, and t
[2012-01-04 15:48:00 -0500] alexrecarey: he result is recipe[recipe[roles[base_server]]]. what am I doing wrong?
[2012-01-04 15:49:00 -0500] lflux: say so gem_package always has the gem_binary set to a specific value on each a node?
[2012-01-04 15:49:00 -0500] Brad_K: ukio: yeah, the only way to get new recipes and roles uploaded to chef is via knife.
[2012-01-04 15:49:00 -0500] Brad_K: at least, so far as i know.
[2012-01-04 15:50:00 -0500] alexrecarey: trying to remove the entries from the node run list just makes the run list larger. It's recipe[recipe[recipe[recipe[roles[base_server]]]]] now...
[2012-01-04 15:51:00 -0500] jtimberman: ukio: I use Chef Server (Opscode Hosted Chef) nearly exclusively, and really don't do much with Solo (or Vagrant). My workflow is: write cookbooks, upload to Chef Server, launch EC2 / Rackspace instance in non-prod environment to test. Fix bugs/make changes, upload and rerun Chef.
[2012-01-04 15:51:00 -0500] Brad_K: alexrecarey: don't try to add "roles[whatever]".  add "role[whatever]".  the "s" is important.  also, don't try to add more than one role or recipe at a time.  i have never been able to get that to work.  if you need to reset back to normal, do a "knife node edit" and wipe out all the stuff you don't want, then re-add.
[2012-01-04 15:51:00 -0500] alexrecarey: aha great! thanks Brad_K
[2012-01-04 15:52:00 -0500] jtimberman: once a node converges and fully runs chef-client w/o error, then i terminate that instance, launch a new one and verify that the whole thing completes.
[2012-01-04 15:52:00 -0500] ukio: is there a way to release a recipe in a single step, i.e. including test/commit/tag/upload?
[2012-01-04 15:52:00 -0500] jtimberman: depending on the scope of what i'm writing, that may take 5 minutes, or may take 30.
[2012-01-04 15:52:00 -0500] jonlives: jtimberman: surely you mean you use environments? ;)
[2012-01-04 15:52:00 -0500] jtimberman: I commit changes to my git repository when things are working.
[2012-01-04 15:52:00 -0500] jtimberman: jonlives: i use environments, yes.
[2012-01-04 15:52:00 -0500] jonlives: that's alright then :p
[2012-01-04 15:53:00 -0500] alexrecarey: by the way, I'm using git for VC is it "better" to put your modifications in site-cookbooks, or just modify the original cookbooks and git will take care of the updates?
[2012-01-04 15:53:00 -0500] ukio: i'm used to the release plugin in maven (totally different world), which does exactly this,
[2012-01-04 15:53:00 -0500] jtimberman: ukio: there isn't anything built into knife that does that all in one command.
[2012-01-04 15:53:00 -0500] jonlives: alexrecarey: these days you should prob use cookbook versioning and environments :)
[2012-01-04 15:53:00 -0500] jtimberman: site-cookbooks are deprecated.
[2012-01-04 15:53:00 -0500] richleland: jtimberman thanks for the help - I'll see if I can tweak some stuff locally
[2012-01-04 15:53:00 -0500] jtimberman: it will probably toss you a message.
[2012-01-04 15:53:00 -0500] gmcinnes: o are they. hmm.
[2012-01-04 15:54:00 -0500] jtimberman: at least, the "shadowing" feature of them.
[2012-01-04 15:54:00 -0500] ukio: it makes the release process explicit, reproducible and less error prone than doing it manually, so i was wondering whether there was something similar with chef/knife...
[2012-01-04 15:54:00 -0500] gmcinnes: preferred approach is now just git merging?
[2012-01-04 15:54:00 -0500] alexrecarey: ok thanks, it still talks about site cookbooks in the wiki...
[2012-01-04 15:54:00 -0500] Brad_K: ukio: there is a way to integrate chef with jenkins, iirc.  that should allow you to create a similar workflow to what you're used to.
[2012-01-04 15:54:00 -0500] Brad_K: alex
[2012-01-04 15:55:00 -0500] Brad_K: alexrecarey: i just download the cookbooks, then make whatever changes i need to make to them in order to get them to do what i need.
[2012-01-04 15:55:00 -0500] ukio: ok, that is good to know
[2012-01-04 15:57:00 -0500] Brad_K: alexrecarey: in my experience, the cookbooks are just a starting point for helping you to get something that actually works for you.  some cookbooks are quite complete and need very litte (if any) modifications, while others are more of a skeleton that needs to have a lot of meat put onto it.
[2012-01-04 15:57:00 -0500] ukio: so can i say that the chef server acts like a maven repository? (i.e. it serves the published binaries)
[2012-01-04 15:58:00 -0500] jtimberman: no
[2012-01-04 15:58:00 -0500] jtimberman: not exactly :)
[2012-01-04 15:58:00 -0500] ukio: jtimberman: it can do more
[2012-01-04 15:58:00 -0500] Brad_K: ukio:  my description would be that the chef server is a repository for chef recipes, which are executable code in one form or another (mostly ruby, but also bash blocks and whatever else you might throw in).
[2012-01-04 15:59:00 -0500] gmcinnes: Brad_K: agreed. If anything some of the cookbooks go too far in the direction of abstraction for my liking.  I find they try to be all things to all people, and suffer from too much complexity as a result
[2012-01-04 15:59:00 -0500] gmcinnes: ymmv of course :)
[2012-01-04 15:59:00 -0500] jtimberman: The Chef Server provides a data store for information about your nodes, the roles they serve and arbitrary data that you create about your infrastructure. Cookbooks are like packages of infrastructure management components that the nodes download to become the roles they are meant to be.
[2012-01-04 15:59:00 -0500] Brad_K: ukio: of course, it's also a repository for chef templates, files, and a bunch of other resources that are used by chef recipes.
[2012-01-04 15:59:00 -0500] alexrecarey: yes some of the cookbooks are really complex
[2012-01-04 15:59:00 -0500] alexrecarey: specialy when you just want to keep some files in order :)
[2012-01-04 15:59:00 -0500] jtimberman: some of the cookbooks are meant to resemble libraries and primitives.
[2012-01-04 15:59:00 -0500] jtimberman: like 'application' and 'database'
[2012-01-04 16:00:00 -0500] ukio: ok, i'm coming from a java background, so there i had binaries, but that doesn't really make sense in the ruby world :-)
[2012-01-04 16:00:00 -0500] jtimberman: others are specific purpose, like 'apache2' or 'haproxy'
[2012-01-04 16:00:00 -0500] jtimberman: ukio: Right.
[2012-01-04 16:00:00 -0500] jtimberman: ukio: cookbooks contain a number of components, most relevant are "recipes" which are the descriptions of what should be configured on the system.
[2012-01-04 16:00:00 -0500] jtimberman: recipes contain resources like template, package, service that are declarative interfaces to those system resources.
[2012-01-04 16:01:00 -0500] jtimberman: chef handles taking care of the details given the input in the recipe.
[2012-01-04 16:01:00 -0500] alexrecarey: I managed to wipe the run list from the server using knife node edit, but I'm still having problems adding a role. This is the command I use: knife node run_list add i-14d9b576 "role[base_server]". It goes into the run_list instead of the role...
[2012-01-04 16:01:00 -0500] jtimberman: alexrecarey: you told it to modify the run list
[2012-01-04 16:01:00 -0500] ukio: jtimberman: ok, but uploading a cookbook to the chef server is the publishing mechanism, right?
[2012-01-04 16:01:00 -0500] jtimberman: ukio: Yes.
[2012-01-04 16:01:00 -0500] alexrecarey: jtimberman: how can I tell it to add a role to the server?
[2012-01-04 16:01:00 -0500] jtimberman: ukio: "knife cookbook upload" is an API call to the cookbook endpoint.
[2012-01-04 16:02:00 -0500] jtimberman: alexrecarey: the run list contains roles or recipes.
[2012-01-04 16:02:00 -0500] jtimberman: alexrecarey: do you mean the "roles" attribute of the node?
[2012-01-04 16:02:00 -0500] jtimberman: you don't modify that directly, it is automatically expanded by chef.
[2012-01-04 16:02:00 -0500] alexrecarey: that is right, I would like to say that this particular node's role is "base_server"
[2012-01-04 16:02:00 -0500] jtimberman: alexrecarey: you did
[2012-01-04 16:02:00 -0500] jtimberman: :)
[2012-01-04 16:03:00 -0500] jtimberman: thats what the run list says
[2012-01-04 16:03:00 -0500] alexrecarey: I guess I expected it to be in the roles: section and not the run_list: section
[2012-01-04 16:03:00 -0500] jtimberman: it won't show up in the "roles" list until chef runs
[2012-01-04 16:03:00 -0500] alexrecarey: I see, that explains everything!
[2012-01-04 16:03:00 -0500] jtimberman: during the chef run, the run list is expanded for the roles and recipes.
[2012-01-04 16:04:00 -0500] jtimberman: all the roles expanded out (including roles in other roles' run lists) for recipes.
[2012-01-04 16:04:00 -0500] alexrecarey: thanks for the help
[2012-01-04 16:04:00 -0500] jtimberman: that full list of roles is the 'roles' attribute on the node.
[2012-01-04 16:04:00 -0500] jtimberman: :)
[2012-01-04 16:04:00 -0500] ukio: jtimberman: ok, then this is my analogon to a maven repo, which is also about publishing artifacts (although in a more generic sense, i.e. could jars, xml, whatever file - but not specifically cookbooks)
[2012-01-04 16:06:00 -0500] rrichardsr3: I frequently get the following error when launching an ec2 instance via knife. Any assistance would be appreciated https://gist.github.com/1560697
[2012-01-04 16:06:00 -0500] rrichardsr3: not sure if its my config, network or bad luck
[2012-01-04 16:06:00 -0500] rrichardsr3: i can run the same command again and it will work usually
[2012-01-04 16:08:00 -0500] rrichardsr3: heh, the power of posting the question helped me solve the problem
[2012-01-04 16:08:00 -0500] rrichardsr3: nevermind :)
[2012-01-04 16:08:00 -0500] jtimberman: huh
[2012-01-04 16:09:00 -0500] jtimberman: maybe ec2 is having latency / performance issues. richeland was having that problem earlier.
[2012-01-04 16:09:00 -0500] ukio: @jtimberman: another concept in maven are SNAPSHOT versions, meaning the latest stuff built from trunk / master branch, which could be something totally different if you download it three days later. i.e. 0.1-SNAPSHOT means just one snapshot (the most recent build) on the way to the  0.1 release. once you are ready to release, you would create a tag with the 0.1 version, and continue with 0.2-SNAPSHOT on trunk/master. (the maven-release-pl
[2012-01-04 16:10:00 -0500] jtimberman: ukio: the nearest analogy to that in Chef is "environments" where you can assign a version of a cookbook to a particular environment.
[2012-01-04 16:10:00 -0500] alexrecarey: if I update the definition of a role by editing the file, i then have to run knife role from file FILE, to upload it. I have just done so, and re-run the chef client on my node, but the node does not add the new cookbooks I added to the role...
[2012-01-04 16:10:00 -0500] ukio: @jtimberman: is there something like an unstable / volatile snapshot version in chef too? or is the chef server intended to serve only stable / released cookbooks?
[2012-01-04 16:10:00 -0500] jtimberman: e.g., "in production, use apache2 version 1.2.2"
[2012-01-04 16:10:00 -0500] jtimberman: you have to manage the version of the cookbook in the metadata though
[2012-01-04 16:11:00 -0500] jtimberman: then in "development" you can have no version assigned, and systems in that environment will download the latest released cookbook (so you would have to increment the version in the metadata)
[2012-01-04 16:12:00 -0500] ukio: so unless a cookbook version is frozen, i can override it without warning when uploading with knife, right?
[2012-01-04 16:13:00 -0500] Brad_K: ukio: yes, you can, if you don't take appropriate precautions.
[2012-01-04 16:13:00 -0500] Brad_K: you need to get in the habit of updating the versions of your cookbooks, and for each environment deciding which version(s) of which cookbooks are appropriate.
[2012-01-04 16:14:00 -0500] Brad_K: we're not there yet, and we've already been bitten a couple of times.
[2012-01-04 16:14:00 -0500] ukio: when you are using cookbook xyz v1.1 from the chef server, would you expect or even rely on the fact that you the the same thing every time?
[2012-01-04 16:14:00 -0500] jonlives: ukio: I wrote a plugin designed to avoid a lot of these issues, including an auto-freezing upload: https://github.com/jonlives/knife-spork
[2012-01-04 16:14:00 -0500] Brad_K: i'm hoping that a chef/jenkins integration would help make that more automatic.
[2012-01-04 16:16:00 -0500] rrichardsr3: jtimberman: righto, i just had it occur again and i thought i discovered the issue (didnt ssh-add the keypair before running).
[2012-01-04 16:17:00 -0500] ukio: hmm... i thought there is maybe an implicit convention that even release numbers mean "stable release" and odd ones mean "snapshot version"
[2012-01-04 16:18:00 -0500] Brad_K: ukio: some projects use a scheme like that, yes.  but it is most definitely NOT universal.
[2012-01-04 16:18:00 -0500] ukio: i was thinking this because i'm on chef 0.10.0 and the next version is 0.10.2
[2012-01-04 16:18:00 -0500] jtimberman: ukio: yeah... I have a java deficiency, so I don't know how best to map the analogy
[2012-01-04 16:18:00 -0500] jtimberman: the current version of Chef is 0.10.8
[2012-01-04 16:18:00 -0500] Brad_K: sometimes numbers get skipped in the middle.  so, the current version of chef is 0.10.8.
[2012-01-04 16:18:00 -0500] jtimberman: You should use that.
[2012-01-04 16:19:00 -0500] ukio: @jtimberman: i'm having the ruby deficieny.. :-)
[2012-01-04 16:20:00 -0500] ukio: good to know, i'll switch to taht!
[2012-01-04 16:20:00 -0500] ukio: so i can fairly assume that 0.10.8 is frozen, right?
[2012-01-04 16:20:00 -0500] alexrecarey: role files, if written in ruby is it correct to add various roles each in a new line? When you get to run_list [ "recipe[1]", "recipe[2]", "recipe[3]"], because I think my role file is not being read correctly
[2012-01-04 16:20:00 -0500] jtimberman: it is released.
[2012-01-04 16:20:00 -0500] ukio: @jtimberman: and i guess you are currently developing on 0.10.9 in your master branch?
[2012-01-04 16:20:00 -0500] Brad_K: 0.10.8 is pretty solid.  much better than 0.10.4, which was the previous widely-used version (0.10.6 got skipped).
[2012-01-04 16:20:00 -0500] jtimberman: correct
[2012-01-04 16:21:00 -0500] jtimberman: 0.10.6 wasn't skipped :).
[2012-01-04 16:21:00 -0500] jtimberman: but we made a quick release shortly after to correct a bug on Windows.
[2012-01-04 16:21:00 -0500] rrichardsr3: is it common practice to run a chef-client recipe to upgrade itself or is it risky?
[2012-01-04 16:21:00 -0500] Brad_K: it was released and then very quickly replaced by 0.10.8.
[2012-01-04 16:21:00 -0500] jtimberman: rrichardsr3: It can be done, but there's some things to be aware of.
[2012-01-04 16:21:00 -0500] rrichardsr3: jtimberman: thought so. im using the opscode platform if that makes a difference
[2012-01-04 16:21:00 -0500] Brad_K: in my book, that means that 0.10.6 was effectively skipped, as far as the rest of the community is concerned.
[2012-01-04 16:21:00 -0500] jtimberman: rrichardsr3: mainly, if you're running chef-client as a daemon, you'll need to make sure the service is restarted gracefully and without conflicting with a possible running chef-client of a different veresion.
[2012-01-04 16:21:00 -0500] jtimberman: Brad_K: :D
[2012-01-04 16:22:00 -0500] jtimberman: rrichardsr3: that authentication error is happening before chef is even involved.
[2012-01-04 16:22:00 -0500] rrichardsr3: ah right - that could be baaaad thanks
[2012-01-04 16:22:00 -0500] jtimberman: rrichardsr3: the knife ec2 server create is the equivalent of, "ec2run, wait, ssh to new instance, run commands to install chef and register with chef server"
[2012-01-04 16:23:00 -0500] jtimberman: rrichardsr3: i generally run chef upgrades out of band through knife ssh.
[2012-01-04 16:23:00 -0500] rrichardsr3: jtimberman: yes it seems to happen when the connection to execute the chef code occurs
[2012-01-04 16:23:00 -0500] jtimberman: but i only have 5 real systems that i manage (I'm not in operations at Opscode)
[2012-01-04 16:23:00 -0500] jtimberman: rather, i'm not involved directly in operations :)
[2012-01-04 16:24:00 -0500] rrichardsr3: ive currently got about 4 on opscode, but im a developer on other projects as well. Call me nuts.
[2012-01-04 16:24:00 -0500] ukio: @jtimberman: so how is your internal development workflow at opscode? assuming your cookbook metadata in master is on 0.10.9, when you make changes and want to test them, do you knife upload this cookbook to an internal chef server?
[2012-01-04 16:24:00 -0500] ukio: @jtimberman: and always overwrite this version if you have new changes to test?
[2012-01-04 16:26:00 -0500] ukio: @jtimberman: if that is the case, then you would explicitly name your 0.10.9 version a SNAPSHOT version in maven land, because you can get something totally different everytime you access it
[2012-01-04 16:27:00 -0500] jtimberman: oh
[2012-01-04 16:27:00 -0500] jtimberman: we don't tie cookbooks to the same version as Chef.
[2012-01-04 16:27:00 -0500] ukio: makes sense
[2012-01-04 16:28:00 -0500] ukio: then it was just a bad example
[2012-01-04 16:28:00 -0500] ukio: so i'm more interested in a sensible cookbook development workflow
[2012-01-04 16:28:00 -0500] ukio: sorry for confusing that with chef development
[2012-01-04 16:29:00 -0500] Brad_K: there's lots of moving pieces here.  i wouldn't be embarassed or apologize for not completely understanding how everything fits together right off the bat.
[2012-01-04 16:29:00 -0500] jtimberman: Totally
[2012-01-04 16:29:00 -0500] jtimberman: :)
[2012-01-04 16:29:00 -0500] jtimberman: gotta run
[2012-01-04 16:30:00 -0500] ukio: the gaps in the chef versions only led me to the assumption that there is a difference between even and odd versions (in terms of a convention i'm not familiar with)
[2012-01-04 16:32:00 -0500] alexrecarey: I am trying to upload the following role file, and knife returns "Updated Role base_server!" but when I log into the hosted chef web interface, it shows me that the role is empty (has no recipes)
[2012-01-04 16:32:00 -0500] gmcinnes: am I right in thinking that setting default_unless['foo'] in an attribute file should only set the key and value on a node if the key doesn't exist?
[2012-01-04 16:33:00 -0500] alexrecarey: name "base_server"
[2012-01-04 16:33:00 -0500] alexrecarey: description "Base server role"
[2012-01-04 16:33:00 -0500] alexrecarey: run_list
[2012-01-04 16:33:00 -0500] alexrecarey:    [
[2012-01-04 16:33:00 -0500] alexrecarey:      "recipe[motd-tail]",
[2012-01-04 16:33:00 -0500] alexrecarey:      "recipe[yum]"
[2012-01-04 16:33:00 -0500] alexrecarey: ]
[2012-01-04 16:33:00 -0500] alexrecarey: both recipes are available in the chef-server
[2012-01-04 16:34:00 -0500] gmcinnes: the use case is that I would like to set a random time for a backup sequence to start on a node, if and only if one hasn't been set already
[2012-01-04 16:34:00 -0500] ukio: but @jtimberman: thanks for your help! i will have to dig a bit deeper concerning a "cookbook development workflow". would be interested to hear how other people handle this...
[2012-01-04 16:36:00 -0500] Brad_K: alexrecarey: here's one of our role definitions:
[2012-01-04 16:36:00 -0500] Brad_K: name "ihiji_base"
[2012-01-04 16:36:00 -0500] Brad_K: description "Default run_list for machines belonging to ihiji with shorewall firewall rules (other than repo)"
[2012-01-04 16:36:00 -0500] Brad_K: run_list(
[2012-01-04 16:36:00 -0500] Brad_K:   "role[base]",
[2012-01-04 16:36:00 -0500] Brad_K:   "role[yumrepo]"
[2012-01-04 16:36:00 -0500] Brad_K: )
[2012-01-04 16:37:00 -0500] Brad_K: note that we use parenthesis around our run_list definition, and not square brackets.  i think this makes a difference.
[2012-01-04 16:37:00 -0500] alexrecarey: ill try that
[2012-01-04 16:38:00 -0500] Brad_K: gmcinnes: i'm not entirely sure how the "default_unless" stuff works.
[2012-01-04 16:39:00 -0500] Brad_K: one thing i've learned about chef is that there are many complexities here, and i've only started to scratch the surface.  so, i'm starting to get an idea of just how much about chef that i don't know.
[2012-01-04 16:39:00 -0500] alexrecarey: Brad_K: it gives me a syntax error roles/base_server.rb:5: syntax error, unexpected ',', expecting ')'
[2012-01-04 16:40:00 -0500] Brad_K: alexrecarey: you put that into a file, and then did a "knife role from file FILENAME"?
[2012-01-04 16:41:00 -0500] alexrecarey: Brad_K: Brad, thanks, the problem seemed to be that the ( has to be on the same line as run_list
[2012-01-04 16:41:00 -0500] Brad_K: okay, that might do it.  i'm certainly not a ruby expert.  didn't know that it was pedantic about that kind of thing.  ;-(
[2012-01-04 16:46:00 -0500] mconigliaro: is anyone here using the deploy resource for deploying a rails app?
[2012-01-04 16:47:00 -0500] mconigliaro: i think i must be missing something here
[2012-01-04 16:47:00 -0500] dyer: Morning everyone!
[2012-01-04 16:47:00 -0500] dyer: Question regarding knife-ec2 if anyone has a second, wondering what the --node-name attribute actually does?
[2012-01-04 16:48:00 -0500] dyer: oh, I just figured it out ;)
[2012-01-04 16:48:00 -0500] gmcinnes: I'm a little confused about how Attributes work.  When I go to the hosted chef server I can see all the Attributes for a node, but when I choose "Edit" I can only see a small subset
[2012-01-04 16:48:00 -0500] gmcinnes: Which ones are "editable"?  What's the difference?
[2012-01-04 16:49:00 -0500] dyer: personally I never set attributes on a role
[2012-01-04 16:49:00 -0500] dyer: err, sorry, mispoke
[2012-01-04 16:49:00 -0500] dyer: I never set attributes on a node, I use roles
[2012-01-04 16:50:00 -0500] dyer: node has roles, which are made up of override attributes and recipes
[2012-01-04 16:50:00 -0500] gmcinnes: In this case I want each node to have a different semi-random value.
[2012-01-04 16:51:00 -0500] gmcinnes: use case is that they are doing push backups to a central server, and I don't want them all going off at once and slaying the server.
[2012-01-04 16:52:00 -0500] dyer: interval + rand
[2012-01-04 16:53:00 -0500] gmcinnes: well yeah, but its a per node config, not per role, so it seems to belong more logically in the cookbook's attribute file
[2012-01-04 16:53:00 -0500] dkingofpa: ukio:  I use the librarian gem to manage cookbooks in a project.  I develop new cookbooks separately to a point they are ready to be managed by librarian, then I include them in my Cheffile as a git clone.  After which, I just develop within the librarian managed cookbooks folder (being careful not to clean the folder with un-committed changes).  https://github.com/applicationsonline/librarian
[2012-01-04 16:55:00 -0500] alexrecarey: I am getting the following error when running "rate update_cookbooks" ERROR: Chef::Exceptions::CookbookNotFoundInRepo: Cannot find a cookbook named apt; did you forget to add metadata to a cookbook? (http://wiki.opscode.com/display/chef/Metadata). The funny thing is I have no cookbook named apt, and no file named apt either
[2012-01-04 17:02:00 -0500] ukio: @dkingofpa: thanks! i will take a look at it, have to leave for today...
[2012-01-04 17:02:00 -0500] ukio: bye guys!
[2012-01-04 17:07:00 -0500] gmcinnes: ssd7: got a sec? I'm trying to use an attributes file to set a node attribute if and only if it hasn't already been set on the chef server.  But it doesn't seem to be working. It's storing a new version every time.
[2012-01-04 17:08:00 -0500] tightwork: Ah, some headway with my chef/openstack private cloud.. needed to set auto floating public IP addresses. Thats good and knife is attempting to ssh to a real IP although the ssh keyfile was never inserted...openstack_ssh_key_id 'mykey.pem' is not correct?
[2012-01-04 17:25:00 -0500] yfeldblum: dkingofpa, that's an interesting approach; but i don't think i would recommend it because librarian-chef copying the .git directory isn't a feature (it's definitely not documented) so it shouldn't be depended on: indeed, i may choose to make the installation a touch more intelligent at some point, e.g., by getting rid of the .git directory, pregenerating metadata.json files for 0.9, things of that sort, rather than just a simple `c
[2012-01-04 17:25:00 -0500] yfeldblum: p -r`
[2012-01-04 17:26:00 -0500] yfeldblum: dkingofpa, the real question, though, is how to factor out cookbooks that should be their own repos and give them automated tests, so that one can write a cookbook with tests, safe in the knowledge that one can prove it works without having to pull open one's organization's chef-repo
[2012-01-04 17:27:00 -0500] ssd7: gmcinnes: Are you using default_unless or some custom logic?
[2012-01-04 17:28:00 -0500] yfeldblum: dkingofpa, i develop site-specific cookbooks in the chef-repo/site-cookbooks directory, and i do not add those to Cheffile (i add their dependencies to Cheffile instead)
[2012-01-04 17:43:00 -0500] irkenInvader: If I am using the opscode/cookbooks/application cookbook, and following the recommendations in the README.md I have created a my_app cookbook that includes the application cookbook, where is the right place to, or how can I, customize the list of shared/dirs that get symlinked during the application recipe?  More specifically, I want to create a shared/private directory that will get symlinked to current/private after the recipe is compl
[2012-01-04 17:44:00 -0500] gmcinnes: ssd7: I'm using default_unless at the moment, but it doesn't seem to be working as I'd expect, so maybe its the wrong thing.
[2012-01-04 17:46:00 -0500] c_t: Question for the masses: any percona users around?
[2012-01-04 17:52:00 -0500] ssd7: gmcinnes: Hmm.  Attribute precendence can sometimes trip people up.  If you put together a gist with the relevant facts, we can take a look.
[2012-01-04 18:08:00 -0500] gpapilon: I was looking at this issue: http://tickets.opscode.com/browse/CHEF-2812 and was wondering if this was expected behavior or a bug?
[2012-01-04 18:17:00 -0500] dyer: Question, should omnibus still be using 10.4 ?
[2012-01-04 18:20:00 -0500] jtimberman: dyer: you can rerun the install.sh script to install the latest version
[2012-01-04 18:20:00 -0500] jtimberman: or you can download it from the s3 bucket directly
[2012-01-04 18:20:00 -0500] jtimberman: s3.amazonaws.com/opscode-full-stack
[2012-01-04 18:21:00 -0500] dyer: hrm ok I was just using knife ec2 create ( https://gist.github.com/867bdd63641c48bb917a )
[2012-01-04 18:21:00 -0500] dyer: figured it would install the latest
[2012-01-04 18:22:00 -0500] dwhsix: if I need API access to hte chef server (e.g. I want to change a node's role programmatically), what's the best way?  I assume there's something higher-level than talking straight to the REST API?
[2012-01-04 18:22:00 -0500] tightwork: dwhsix: https://github.com/danryan/spice
[2012-01-04 18:22:00 -0500] dyer: dwhsix, I used Spice before
[2012-01-04 18:22:00 -0500] dyer: hehe
[2012-01-04 18:23:00 -0500] tightwork: working with it right now :)
[2012-01-04 18:23:00 -0500] dyer: same here, pretty nice
[2012-01-04 18:23:00 -0500] dwhsix: sweet
[2012-01-04 18:23:00 -0500] dwhsix: thx
[2012-01-04 18:23:00 -0500] tightwork: you are welcome
[2012-01-04 18:25:00 -0500] dwhsix: altho it occurs to me maybe what I'm thinking isn't the best way to do this here's the scoop:
[2012-01-04 18:25:00 -0500] dwhsix: this is part of failover strategy, which in this case needs to be explicit
[2012-01-04 18:25:00 -0500] dwhsix: 2 nodes, with some the same role, one is primary, otehr secondary (cold standby)
[2012-01-04 18:26:00 -0500] dwhsix: 2rd node handles the alarm, and what I wan tto do is swap the roles on those other two nodes
[2012-01-04 18:26:00 -0500] dwhsix: ultimately, really, change elastic IP to point to the secondary
[2012-01-04 18:27:00 -0500] dwhsix: sort of seemed like doing it via roles made sense, but now I'm not so sure
[2012-01-04 18:28:00 -0500] gmcinnes: ssd7:  Sorry about the delay: https://gist.github.com/1561356
[2012-01-04 18:32:00 -0500] tightwork: Ah weird... I provision VM with openstack-knife.. my chef server I manually built and allocated IP of 172.16.25.1. knifed out a server from an AMI and it used that IP, connected and bootstrapped. Strange thing is, it still built a new VM.
[2012-01-04 18:33:00 -0500] tightwork: Its appears to not like the fact I allocated an ip from the range already
[2012-01-04 18:33:00 -0500] tightwork: arg
[2012-01-04 18:41:00 -0500] miah: moin
[2012-01-04 18:51:00 -0500] dodizzle: how can a node have an empty FQDN ?
[2012-01-04 18:53:00 -0500] gmcinnes: ls
[2012-01-04 18:53:00 -0500] jtimberman: gmcinnes: cookbooks/ data_bags/ roles/
[2012-01-04 18:53:00 -0500] jtimberman: or was that not what you were expecting?
[2012-01-04 18:53:00 -0500] jtimberman: :)
[2012-01-04 18:53:00 -0500] gmcinnes: :)
[2012-01-04 18:53:00 -0500] tightwork: girls_gone_wild.avi
[2012-01-04 18:54:00 -0500] gmcinnes: pish posh.
[2012-01-04 18:54:00 -0500] gpapilon: jtimberman: can you provide some insight as to if this is a bug or expected behavior: http://tickets.opscode.com/browse/CHEF-2812?
[2012-01-04 18:56:00 -0500] bitmonk: yah jtimberman it's pretty wierd (2812) we have an execute block which has a creates, and a not_if - the not_if keeps us from tromping some old-style configuration if it's present.  this block no longer runs under any circumstance, unless we remove the not_if.
[2012-01-04 18:56:00 -0500] ssd7: gmcinnes: I think I know the problem.
[2012-01-04 18:56:00 -0500] gmcinnes: do tell
[2012-01-04 18:57:00 -0500] gmcinnes: I'm open to the fact that I might be trying to do this in a completely bass ackwards way too
[2012-01-04 18:57:00 -0500] bitmonk: new behaviour with 0.10.8
[2012-01-04 18:57:00 -0500] ssd7: Default attribute are basically rebuild from scratch at the beginning of each chef client run
[2012-01-04 18:58:00 -0500] jtimberman: gpapilon: i'm more curious why one would use "execute" to touch a file, instead of the "file" resource with action :create
[2012-01-04 18:58:00 -0500] ssd7: I believe the key features of default_unless is to prevent merging/overwriting of attributes set elsewhere.  I think what you are going to want to do, is make it a "normal" attribute.
[2012-01-04 18:58:00 -0500] jtimberman: file("/tmp/somefile") { action :create }
[2012-01-04 18:58:00 -0500] gpapilon: thats just the example, we create KVM images.
[2012-01-04 18:59:00 -0500] bitmonk: so we have creates /var/blah/root.raw, not_if /var/blah/old_style_img.qcow2
[2012-01-04 18:59:00 -0500] gmcinnes: ssd7: so at the start of a chef-client run any default attributes stored on the server are wiped out?
[2012-01-04 18:59:00 -0500] alexrecarey: is there any way to have a cookbook depend on a particular recipe of another cookbook? or can it only depend on other cookbooks?
[2012-01-04 18:59:00 -0500] jtimberman: i'd use not_if { ::File.exists?("/target/filename") }
[2012-01-04 18:59:00 -0500] jtimberman: alexrecarey: only the cookbook
[2012-01-04 18:59:00 -0500] alexrecarey: thanks!
[2012-01-04 18:59:00 -0500] jtimberman: alexrecarey: we don't have per-recipe dependencies
[2012-01-04 19:00:00 -0500] jtimberman: that has been discussed and there may be a ticket tho
[2012-01-04 19:01:00 -0500] ssd7: gmcinnes: Check it out: https://github.com/opscode/chef/blob/master/chef/lib/chef/client.rb#L247
[2012-01-04 19:01:00 -0500] gpapilon: jtimberman: the issue is that the each step in the block defining the resource uses the same reference to a single not_if array.
[2012-01-04 19:01:00 -0500] ssd7: That function does what it says on the tin: https://github.com/opscode/chef/blob/master/chef/lib/chef/node.rb#L419
[2012-01-04 19:02:00 -0500] gmcinnes: ssd7: Hmm. Interesting. Thanks so much for that.
[2012-01-04 19:02:00 -0500] gmcinnes: ssd7: That is not what I expected.
[2012-01-04 19:02:00 -0500] gpapilon: so resource_collection[0].not_if == resource_collection[1].not_if
[2012-01-04 19:03:00 -0500] gpapilon: each run appends to the not_if array (or the only_if array).
[2012-01-04 19:03:00 -0500] ssd7: gmcinnes: Indeed.  I tried to clarify attribute persistence a bit here: http://wiki.opscode.com/display/chef/Attributes#Attributes-AttributePersistence
[2012-01-04 19:04:00 -0500] gmcinnes: cool.
[2012-01-04 19:04:00 -0500] gpapilon: you get not_if[0] == ::File.exists?("/target/filename1"), not_if[1] == ::File.exists?("/target/filename2") and so on.
[2012-01-04 19:04:00 -0500] gpapilon: the second resource never executes because it fails the first test.
[2012-01-04 19:07:00 -0500] gmcinnes: ssd7_: You guys are awesome.  Thanks.
[2012-01-04 19:07:00 -0500] ssd7_: Thanks :)
[2012-01-04 19:11:00 -0500] tmichael: using apache2 community cook; tailored for our needs; want to maintain sync with upstream so I can get version updates.  what's the best way to go about doing this?
[2012-01-04 19:11:00 -0500] tmichael: i remember this brought up at summit, but didn't get a solution
[2012-01-04 19:14:00 -0500] dwhsix: suggestions as to why my knife search query is not giving expected results for a node w/ 2 roles? https://gist.github.com/a8609d24ee70baa91128
[2012-01-04 19:17:00 -0500] dwhsix: seems to be because I'm trying to filter also on environment...
[2012-01-04 19:23:00 -0500] dwhsix: searching in chef DOES work, doesn't it? ;-)
[2012-01-04 19:24:00 -0500] dwhsix: aha
[2012-01-04 19:24:00 -0500] dwhsix: it's "roles:<something>", not "role:<something>" - which makes sense
[2012-01-04 19:24:00 -0500] dwhsix: my bad
[2012-01-04 19:24:00 -0500] yfeldblum: correct
[2012-01-04 19:24:00 -0500] yfeldblum: i was just about to note that :P
[2012-01-04 19:25:00 -0500] jtimberman: tmichael: generallly, thats what the "knife cookbook site install" vendoring pattern is used for.
[2012-01-04 19:26:00 -0500] dwhsix: (search needs a "hey dummy" mode for people like me)
[2012-01-04 19:26:00 -0500] tmichael: hmm - haven't looked into that.  thx, as always, for the info/edumucation jtimberman
[2012-01-04 19:35:00 -0500] dodizzle: anyone here using the chef-client cookbook?
[2012-01-04 19:36:00 -0500] dodizzle: I can't get it to adjust the run intercal
[2012-01-04 19:36:00 -0500] dodizzle: make that interval
[2012-01-04 19:37:00 -0500] dyer: Question, when I use knife ec2 can I set the log_location or log_level ?
[2012-01-04 19:38:00 -0500] dodizzle: I've put it in the overrides for both the role and node and it still ignores it
[2012-01-04 19:38:00 -0500] dyer: dodizzle, I am using it
[2012-01-04 19:38:00 -0500] dwhsix: so anybody having any issue with search in https://github.com/danryan/spice ?
[2012-01-04 19:38:00 -0500] dyer: dwhsix, I am using it
[2012-01-04 19:38:00 -0500] dyer: ;)
[2012-01-04 19:38:00 -0500] dodizzle: dyer where did you override the interval?
[2012-01-04 19:38:00 -0500] dyer: looking
[2012-01-04 19:38:00 -0500] dyer: dont think I am
[2012-01-04 19:38:00 -0500] dyer: but I can try
[2012-01-04 19:39:00 -0500] dwhsix: doing a node search one roles, command line knife gives me back 5 as expected, spice says 6 items in result, but last item is nil
[2012-01-04 19:39:00 -0500] dwhsix: weird
[2012-01-04 19:39:00 -0500] dyer: where do u want me to do it
[2012-01-04 19:39:00 -0500] dyer: dwhsix, give me a min
[2012-01-04 19:40:00 -0500] dwhsix: hmm, maybe that's intended behavior, for "multi-page" responses...
[2012-01-04 19:40:00 -0500] dyer: I did write this when I was playing w/ it maybe it will be helpful http://johntdyer.com/index.php/2011/12/12/query-chefs-rest-api-with-spice/
[2012-01-04 19:40:00 -0500] dyer: dodizzle, were do you want me to override it ?
[2012-01-04 19:41:00 -0500] dwhsix: ah, nice, didn't know about :params options
[2012-01-04 19:41:00 -0500] dyer: in a role?
[2012-01-04 19:41:00 -0500] dyer: yea, I didn't either, thats why I wrote that up
[2012-01-04 19:41:00 -0500] dwhsix: but let me see if that behaves any better...
[2012-01-04 19:41:00 -0500] dyer: figured it would help someone else out :)
[2012-01-04 19:41:00 -0500] dwhsix: +1
[2012-01-04 19:42:00 -0500] dodizzle: dyer try overriding it  in a role
[2012-01-04 19:42:00 -0500] dodizzle: then run chef-client
[2012-01-04 19:42:00 -0500] dodizzle: and I'll bet the interval will still be 1800
[2012-01-04 19:43:00 -0500] dyer: k
[2012-01-04 19:43:00 -0500] schism: mkent mkent_ : We'll have a fix and test today.  http://tickets.opscode.com/browse/CHEF-2844
[2012-01-04 19:44:00 -0500] mkent_: beauty :)
[2012-01-04 19:44:00 -0500] dwhsix: dyer: yeah, even using the :params hash, same behavior
[2012-01-04 19:44:00 -0500] dyer: can you pm me a gist of the entire output please
[2012-01-04 19:45:00 -0500] dwhsix: sure, just a sec
[2012-01-04 19:45:00 -0500] gmcinnes: What's the procedure for changing the hostname of a machine managed by chef-client.  Change hostname, delete old client on server, then how do I re-authorize?
[2012-01-04 19:46:00 -0500] dyer: gmcinnes, delete the client.pem
[2012-01-04 19:46:00 -0500] jessicab: gmcinnes - youll also want to delete the old node on the server too dont forget
[2012-01-04 19:46:00 -0500] CharlieSu: Is omnibus going to be the default way of installing chef soon ?  Also, is it quicker than the default bootstrap with rubygems ?
[2012-01-04 19:46:00 -0500] dyer: knife client delete old.hostname.com
[2012-01-04 19:46:00 -0500] dyer: rm /etc/chef/client.pem
[2012-01-04 19:47:00 -0500] dyer: jessicab, just the client, not the node
[2012-01-04 19:47:00 -0500] dyer: right?
[2012-01-04 19:47:00 -0500] jessicab: well, if he doesnt delete its not a big deal, youd just still see it on the node list
[2012-01-04 19:47:00 -0500] jessicab: could be confusing
[2012-01-04 19:47:00 -0500] dyer: true true
[2012-01-04 19:48:00 -0500] dwhsix: dyer: https://gist.github.com/7d9ac4dcc4eb690670e9
[2012-01-04 19:48:00 -0500] dwhsix: lemme know if you need more detail thx
[2012-01-04 19:48:00 -0500] dwhsix: (and didn't need to dm it)
[2012-01-04 19:49:00 -0500] dyer: dwhsix, can you give me the output of just this Spice.connection.get("/search/node", :params => {:q => "roles:queue"})['rows']
[2012-01-04 19:49:00 -0500] dyer: dodizzle, r u on centos?
[2012-01-04 19:50:00 -0500] dyer: or rhel
[2012-01-04 19:50:00 -0500] dwhsix: dyer: https://gist.github.com/c4b3a34737669c737689
[2012-01-04 19:50:00 -0500] dwhsix: you'll need to look at it raw
[2012-01-04 19:51:00 -0500] dyer: dodizzle, just noticed in my cookbook the chef-client template file ( /Users/jdyer/Dropbox/Projects/chef/cookbooks/chef-client/ ) doesnt actually use the interval attribute
[2012-01-04 19:52:00 -0500] gmcinnes: crap. pulled that trigger too soon :)
[2012-01-04 19:52:00 -0500] dodizzle: dyer I'm on ubuntu
[2012-01-04 19:52:00 -0500] CharlieSu: anyone using omnibus that could answer a few questions for me?
[2012-01-04 19:53:00 -0500] dwhsix: dyer: sorry, back, blipped out for moment
[2012-01-04 19:53:00 -0500] dodizzle: do I need to have the recipe edit /etc/default/chef-client instead?
[2012-01-04 19:55:00 -0500] dyer: one sec
[2012-01-04 19:56:00 -0500] dyer: hrm, I am on centos and I can see the interval isnt even in the template
[2012-01-04 19:56:00 -0500] dyer: not sure whats gon in w/ ubuntu, I dont even see it declaired in that init.d script
[2012-01-04 19:57:00 -0500] CharlieSu: btm: you the omnibus guru?
[2012-01-04 20:01:00 -0500] dyer: dwhsix, I am not sure why u r getting that, let me try on mine see i I get the same thing
[2012-01-04 20:01:00 -0500] dwhsix: thx - I can work around it for now, obv I usppose might be something borked in our chef server
[2012-01-04 20:03:00 -0500] dyer: dwhsix, yea, I dont get that nil return
[2012-01-04 20:04:00 -0500] dwhsix: dyer: thx for checking I can file an issue against it not sure I'l have time to investigate further until next week
[2012-01-04 20:04:00 -0500] dyer: dwhsix, checking u out on github, some interesting projects your working on
[2012-01-04 20:04:00 -0500] dwhsix: ;-)
[2012-01-04 20:04:00 -0500] jessicab: charliesu - you could just post them in here, ive messed around with it a tiny bit.. if theyre simple enough i might know the answer.. btm does know a bunch about it though
[2012-01-04 20:05:00 -0500] dyer: we have a guy on our team who is very into open gov type projects
[2012-01-04 20:05:00 -0500] dwhsix: first phase goes live next week or so woohoo
[2012-01-04 20:05:00 -0500] dwhsix: cool - feel free to put him in touch w/ me
[2012-01-04 20:05:00 -0500] dwhsix: my client is hiring ;-)
[2012-01-04 20:05:00 -0500] dyer: I dont want to lose him
[2012-01-04 20:05:00 -0500] dyer: so no
[2012-01-04 20:05:00 -0500] dyer: :P
[2012-01-04 20:06:00 -0500] dwhsix: lol - I know, jk
[2012-01-04 20:06:00 -0500] CharlieSu: jessicab: i'm wondering if there are good bootstrap templates for using it.
[2012-01-04 20:06:00 -0500] CharlieSu: jessicab: and if bootstraping is faster..   Also, will it soon be the default way of installing chef
[2012-01-04 20:07:00 -0500] arthur_kalm: Hello everyone, I'm trying to install the cube cookbook but I'm https://gist.github.com/1561796
[2012-01-04 20:07:00 -0500] arthur_kalm: But there is a metadata.rb file there
[2012-01-04 20:07:00 -0500] arthur_kalm: Not sure why that's happening...
[2012-01-04 20:08:00 -0500] ssd7_: CharlieSu: I believe there is an omnibus bootstrap checked into master.  See: https://raw.github.com/opscode/chef/master/chef/lib/chef/knife/bootstrap/chef-full.erb
[2012-01-04 20:09:00 -0500] jessicab: charliesu - theres def a bootstrap template for it, i think jtimberman wrote it.. and im pretty sure its going to be the preferred way to install chef soon.. but yea, btm would probably be able to answer that question better
[2012-01-04 20:10:00 -0500] btm: CharlieSu: it is in master.
[2012-01-04 20:11:00 -0500] CharlieSu: thanks yall
[2012-01-04 20:14:00 -0500] df11: I see the chef-client service randomly die on machines, any hints on debugging?  Running on vanilla ubuntu ami, 0.10.8 on server and clients.  They just seem to stop mid-run normally.  Restarting the service and they work fine.
[2012-01-04 20:17:00 -0500] yfeldblum: df11, can't magically tell you what it is, but you may want to capture & log the stdout and stderr of the ruby process just in case it's a segfault or something else really nasty
[2012-01-04 20:18:00 -0500] CharlieSu: Any idea why my runlist isn't being expanded correctly ?  https://gist.github.com/07967c905e46f8872129
[2012-01-04 20:20:00 -0500] ssd7: CharlieSu: when you run the command line, try single quoting 'role[base]'
[2012-01-04 20:22:00 -0500] CharlieSu: ssd7: that was it..  not sure why that changed all of the sudden.. i've been using the same knife command for ages
[2012-01-04 20:24:00 -0500] CharlieSu: ssd7: got everythign working..  sure seems a whole heck of  alot faster than the rubygems install
[2012-01-04 20:24:00 -0500] df11: yfeldblum: It is random and only happens occasionally, how can I start the service in that debug state and leave it running?
[2012-01-04 20:26:00 -0500] yfeldblum: df11, you use some shell redirection tricks in the start script which you use to run/start the chef-server-api
[2012-01-04 20:35:00 -0500] yfeldblum: df11, e.g. /etc/init.d/chef-server
[2012-01-04 20:35:00 -0500] yfeldblum: if indeed you are using init.d
[2012-01-04 20:37:00 -0500] arthur_kalm: Hmm, i have a general question. If I download a cookbook that had dependencies, how do I install it? Because when I try to upload it, it says the dependent cookbooks aren't installed
[2012-01-04 20:41:00 -0500] CharlieSu: any idea why this recipe would start failing after I used the omnibus installer?  https://gist.github.com/198ae61c1648726a9b0a
[2012-01-04 20:44:00 -0500] mattray1: arthur_kalm: you can do knife cookbook upload BLAH -d
[2012-01-04 20:44:00 -0500] mattray1: to pull up the dependencies
[2012-01-04 20:45:00 -0500] mattray1: assuming you have them in your cookbook direcotyr
[2012-01-04 20:45:00 -0500] bkmontgomery: Hi everyone. Chef newbie here.  I tried following the Build A Rails Stack guide on a fresh rackspace node, but there seems to be a problem with haproxy and/or unicorn. I'm just getting a 502 Bad Gateway. Here are the steps I followed: https://gist.github.com/1561972 and this is the output from the last time I ran chef-client: https://gist.github.com/1562038   Any ideas?  Thanks in advance.
[2012-01-04 20:47:00 -0500] bkmontgomery: Also, my host doesn't have a FQDN, but is located at http://50.57.185.142/
[2012-01-04 20:49:00 -0500] arthur_kalm: mattray thanks, I'll try that
[2012-01-04 20:51:00 -0500] arthur_kalm: But do you know why I wouldn't be able to site install cube? I'm getting https://gist.github.com/1561796
[2012-01-04 20:51:00 -0500] arthur_kalm: When the metadata.rb file is there
[2012-01-04 20:51:00 -0500] CharlieSu: any idea why this would fail?  https://gist.github.com/198ae61c1648726a9b0a
[2012-01-04 20:55:00 -0500] arthur_kalm: mattray: but with the -d option, it still doesn't actually download and install the dependencies
[2012-01-04 20:56:00 -0500] arthur_kalm: It tries to find them in the path
[2012-01-04 20:59:00 -0500] gmcinnes: ls
[2012-01-04 20:59:00 -0500] gmcinnes: aargh.
[2012-01-04 20:59:00 -0500] gmcinnes: sorry.
[2012-01-04 21:03:00 -0500] mattray: arthur_kalm: you'll have to download the missing dependencies too
[2012-01-04 21:03:00 -0500] dyer: what is "cube" ?
[2012-01-04 21:04:00 -0500] mattray: so if it complains about missing "mysql" for example, knife cookbook site install mysql
[2012-01-04 21:04:00 -0500] arthur_kalm: dyer https://github.com/square/cube
[2012-01-04 21:05:00 -0500] arthur_kalm: Awesome data visualization tool
[2012-01-04 21:06:00 -0500] arthur_kalm: mattray i have been seeing the MySQL one too
[2012-01-04 21:06:00 -0500] arthur_kalm: mattray but it'll be downloaded and installed automatically if the site install worked, right?
[2012-01-04 21:07:00 -0500] mattray: the missing dependencies don't get pulled down
[2012-01-04 21:10:00 -0500] CharlieSu: mattray: do you see anything up with this recipe?  https://gist.github.com/198ae61c1648726a9b0a
[2012-01-04 21:12:00 -0500] siezer: hi
[2012-01-04 21:13:00 -0500] CharlieSu: hi
[2012-01-04 21:15:00 -0500] mattray: CharlieSu: not sure what the issue is. I grepped through a bunch of cookbooks to see if anything jumped out
[2012-01-04 21:15:00 -0500] CharlieSu: mattray: yeah i haven't changed anything at all..  only thing new is that i bootstrapped w/ omnibus instead of my normal rubygems bootstrap
[2012-01-04 21:16:00 -0500] mattray: CharlieSu: interesting. Were you using Ruby 1.8.7 before?
[2012-01-04 21:16:00 -0500] CharlieSu: mattray: yes..
[2012-01-04 21:17:00 -0500] mattray: I wonder if some more knowledgable Rubyist might have an answer related to that? Omnibus is 1.9.1 I believe
[2012-01-04 21:17:00 -0500] silk: Short of setting an attribute for every node that needs it, is there a simple way to persist an offset to a value. i guess for example a cronjob that runs every 30 minutes on 12 hosts, and you want to make sure that there is some variation between each run, within that 30 minutes
[2012-01-04 21:18:00 -0500] jessicab: charliesu - i saw a similar error once where i had to add fancy brackets to get it to run, like ({:username => variable}) didnt get much of a chance to look into why though.. and im not that knowledgeable about ruby yet, but i was told the fancy bracket syntax was wrong
[2012-01-04 21:18:00 -0500] jessicab: not sure what ruby version i was on, but definitely wasnt omnibus chef when i saw it
[2012-01-04 21:20:00 -0500] CharlieSu: jessicab: Ruby allows you to pass a Hash into a function without specifying the {} when it is the last argument in the function call..  If I need to start requiring curley's everywhere I have a ton of refactoring to do.
[2012-01-04 21:20:00 -0500] jessicab: yea, just looked similar.. could be something totally different
[2012-01-04 21:21:00 -0500] CharlieSu: jessicab: it is possible..  i'll have to poke around..  :(
[2012-01-04 21:22:00 -0500] arthur_kalm: mattray ok, good to know, thanks
[2012-01-04 21:22:00 -0500] ssd7: CharlieSu: So, remove the space between variables and the opening paren
[2012-01-04 21:24:00 -0500] yfeldblum: CharlieSu, ssd7's recommendation is correct
[2012-01-04 21:24:00 -0500] CharlieSu: why is that a big deal now?
[2012-01-04 21:25:00 -0500] CharlieSu: i can tell you when i do this it works..          variables ({:username => 'ids_dev', :password => 'integrity'})
[2012-01-04 21:34:00 -0500] ssd7: CharlieSu: jessicab yfeldblum Seems to be something about set or return: https://gist.github.com/1562257
[2012-01-04 21:35:00 -0500] yfeldblum: CharlieSu, because when you do that, you are putting in the braces, which changes the syntax
[2012-01-04 21:36:00 -0500] CharlieSu: ssd7: thanks for the info.. very helpful
[2012-01-04 21:36:00 -0500] ssd7: bah, actually, I think this is just me being sleepy.  Same thing will happen with just about any ruby function i think
[2012-01-04 21:36:00 -0500] yfeldblum: CharlieSu, Ruby's parsing rules are extremely complicated, so you will at times see this type of thing
[2012-01-04 21:36:00 -0500] erikh: ?:??::?:
[2012-01-04 21:36:00 -0500] erikh: valid ruby
[2012-01-04 21:36:00 -0500] yfeldblum: ssd7, `def a(x) x end ; a (:b => 3)`
[2012-01-04 21:38:00 -0500] ssd7: yfeldblum: Yeah, sorry.  Wasn't thinking before.
[2012-01-04 21:38:00 -0500] dyer: question, I have 4 roles that make up a node, and in the second role I install cassandra and in the bottom of the default recipe I call service enable and start for cassandra, will that start up happen immediatly or is it defered until the end of the run like a restart
[2012-01-04 21:40:00 -0500] jbz: dyer:  It will defer unless you use :immediately
[2012-01-04 21:41:00 -0500] dyer: how do I use immediatly on the service resource itself
[2012-01-04 21:41:00 -0500] dyer: ?
[2012-01-04 21:44:00 -0500] jbz: Oh wait, my bad, that's only for notifications.
[2012-01-04 21:46:00 -0500] dyer: ok, so it does happen immediatly ?
[2012-01-04 21:52:00 -0500] dyer: So another question
[2012-01-04 21:52:00 -0500] dyer: In my base role install the chef-client cookbook
[2012-01-04 21:52:00 -0500] dyer: however when I run knife ec2 create its also runnign chef, and there there appears to be a collision there
[2012-01-04 21:53:00 -0500] dyer: meanings chef-client is running two simultaniously
[2012-01-04 21:53:00 -0500] dyer: is there a best practice way to handle this?
[2012-01-04 21:53:00 -0500] yfeldblum: the start action will be executed at the end of the list of scheduled actions (at the end of the execution phase, which comes after the compilation phase where the ruby code of the recipes is executed and the list of resources and their actions is compiled), before any delayed notification actions are executed
[2012-01-04 21:54:00 -0500] yfeldblum: if indeed that resource is at the end of its recipe and that recipe is the last recipe in the run-list :P
[2012-01-04 21:54:00 -0500] dyer: wow,I have no clue what u said there
[2012-01-04 21:56:00 -0500] yfeldblum: the answer is, your recipe code is arbitrary ruby code, and usually you declare a sequence of resources in your ruby code; after all the ruby code from all the recipes is run, then chef will execute each of the actions for each of the resources you declared, in the order you declared them
[2012-01-04 21:56:00 -0500] CharlieSu: when do cookbooks get populated in '/var/chef/cache/cookbooks/'?  When using omnibus, there is nothing there but the directory structure for my cookbooks.  But when using rubygems the directory structure and recipe files are present..  any idea why they'd be missing when using omnibus?
[2012-01-04 22:01:00 -0500] tightwork: so close
[2012-01-04 22:01:00 -0500] tightwork: fok
[2012-01-04 22:07:00 -0500] ssd7: CharlieSu: Hmm.  I don't think omnibus changes that.  Are you sure you haven't set something in client.rb that might be changing where everything is stored?
[2012-01-04 22:11:00 -0500] CharlieSu: ssd7: positive it is no different than my other servers..
[2012-01-04 22:12:00 -0500] CharlieSu: ssd7: it looks like it wanted to work..  the files are just not there, but the directories are..
[2012-01-04 22:14:00 -0500] CharlieSu: ssd7: here is the difference  https://gist.github.com/95ca14d82f227980c3b0
[2012-01-04 22:18:00 -0500] ec2hacker: Should it be possible to clone a chef server (eg creating an ami in ec2) and start up a new host from the clone expect everything to just work? Are their any gotchas?
[2012-01-04 22:19:00 -0500] ssd7: CharlieSu: Does the chef-client run on that node still succeed?
[2012-01-04 22:19:00 -0500] ec2hacker: yes, but the server stuff from other hosts doesn't
[2012-01-04 22:19:00 -0500] ec2hacker: connection problems with rabiit
[2012-01-04 22:21:00 -0500] dyer: Anyone have any ideas on my question about how to prevent two simultanious chef runs ?
[2012-01-04 22:23:00 -0500] fujin: dyer: launch chef from something that prevents it
[2012-01-04 22:23:00 -0500] fujin: maybe the chef client needs a mutex on a logfile or something like that.
[2012-01-04 22:24:00 -0500] fujin: stand corrected then
[2012-01-04 22:24:00 -0500] fujin: mutex on a <something> file
[2012-01-04 22:24:00 -0500] jtimberman: by "rather often" I mean "every couple months or so" :)
[2012-01-04 22:24:00 -0500] bitmonk: we have a wrapper that implements a mutex :)
[2012-01-04 22:24:00 -0500] fujin: I guess most people just don't give a fuck or never encounter any major problems from it -- haven't heard it come up very often
[2012-01-04 22:24:00 -0500] jtimberman: fujin: the "chef needs a lock file to prevent multiple runs" comes up rather often.
[2012-01-04 22:24:00 -0500] jtimberman: i don't know about locking on the log file though
[2012-01-04 22:25:00 -0500] fujin: bitmonk: there you go. winning
[2012-01-04 22:25:00 -0500] bitmonk: it also implements the random delay before runs
[2012-01-04 22:25:00 -0500] fujin: nice
[2012-01-04 22:25:00 -0500] bitmonk: so if you want to run chef, you do 'ps ax | grep sleep' and either, (a) there is a 'sleep' you can kill, or  (b) you can just run 'chef-client'
[2012-01-04 22:25:00 -0500] dyer: where is this wrapper?
[2012-01-04 22:25:00 -0500] bitmonk: i can share
[2012-01-04 22:25:00 -0500] fujin: brilliant
[2012-01-04 22:25:00 -0500] bitmonk: i'll pastebin for now
[2012-01-04 22:26:00 -0500] fujin: we should get a ticket up for this and something built into chef
[2012-01-04 22:26:00 -0500] fujin: ( as well)
[2012-01-04 22:26:00 -0500] bitmonk: my understanding is that the random delay between runs is in chef, or will be soon
[2012-01-04 22:26:00 -0500] bitmonk: http://pastebin.com/P0Hy5QC7
[2012-01-04 22:27:00 -0500] fujin: chef does have splay yes
[2012-01-04 22:27:00 -0500] bitmonk: i also have a nagios check which fires if chef_success is older than N seconds and chef_running doesn't exist
[2012-01-04 22:30:00 -0500] bitmonk: (or if /etc/chef/disabled is older than N seconds, the nagios check displays the contents of that file with a WARN or CRIT)
[2012-01-04 22:30:00 -0500] bitmonk: macros originally wrote this just to do the splay and check for /etc/chef/disabled, i took it from there
[2012-01-04 22:30:00 -0500] bitmonk: just not to be stealing credit :)
[2012-01-04 22:34:00 -0500] macros: I tried calling flock from within chef during the run, tended to not clean up after itself and just led to more problems
[2012-01-04 22:35:00 -0500] fujin: did you clean up in an at_exit block or anything?
[2012-01-04 22:35:00 -0500] fujin: would probably have to add sigint handlers and stuff that cleaned up the flock too
[2012-01-04 22:35:00 -0500] fujin: it wouldn't be too much work to do properly in the Chef::Application class that launches the chef-client
[2012-01-04 22:37:00 -0500] macros: Didn't have a specific clean up, in theory the lock should be released on process exit
[2012-01-04 22:37:00 -0500] macros: Didn't put too much effort into tracking down why it wasn't, easier to handle outside
[2012-01-04 22:37:00 -0500] fujin: word
[2012-01-04 22:38:00 -0500] macros: Was tempted to add a process check into the lock check for freshness
[2012-01-04 22:38:00 -0500] macros: Decided I was wandering down a complexity hole
[2012-01-04 22:38:00 -0500] macros: And started seeing race conditions in my sleep
[2012-01-04 22:38:00 -0500] bitmonk: the lock i implemented in the script assumes the script gets to clean up after itself.  it's not perfect, but it seems to have been working fine for some months across a few hundred boxen.
[2012-01-04 22:38:00 -0500] bitmonk: i agree that it could probably go in ruby, though i do sort of like being able to kill the 'sleep' process to force a chef run. :)
[2012-01-04 22:47:00 -0500] yfeldblum: heh, that's a rather odd way to force a chef run
[2012-01-04 22:48:00 -0500] bitmonk: :)
[2012-01-04 22:49:00 -0500] bkmontgomery: Is there a way to download a specific data bag from a chef server?  Something like "knife cookbook download whatever" but for data bags?
[2012-01-04 22:54:00 -0500] ssd7: For specific data bag items you can do something like: knife data bag show BAG ITEM -Fj > item.json
[2012-01-04 22:56:00 -0500] bkmontgomery: ssd7: cool. That'll work, thanks!
[2012-01-04 23:08:00 -0500] tightwork: zomg batman! me has openstack-knife werkens
[2012-01-04 23:09:00 -0500] tightwork: damn pem file was not chmod 600
[2012-01-04 23:11:00 -0500] bitmonk: having trouble running the chef unit tests on lion (similar on snow leopard) : http://pastebin.com/TLqeiYKc
[2012-01-04 23:11:00 -0500] bitmonk: jtimberman: ? any thoughts? maybe a hard dep crept in that you core contribs tend to have around, but that there isn't a good error for?
[2012-01-04 23:12:00 -0500] bitmonk: originally it told me to install rspec, which i did, now this. :)
[2012-01-04 23:12:00 -0500] ssd7: bitmonk: We recently moved some stuff into the mixlib-shellout gem
[2012-01-04 23:12:00 -0500] ssd7: which you seem to be missing
[2012-01-04 23:12:00 -0500] bitmonk: whereabouts do i get that?
[2012-01-04 23:13:00 -0500] ssd7: It's on rubygems.  If you use bundler you could probably also just do a bundle install
[2012-01-04 23:14:00 -0500] bitmonk: gem install mixlib-shellout didn't find it, but i'll keep trying things i guess..
[2012-01-04 23:15:00 -0500] ssd7: try throwing a --pre on there.
[2012-01-04 23:17:00 -0500] bitmonk: that did it for me on lion, gpapilon on snow leopard is still having trouble, looking closer..
[2012-01-04 23:18:00 -0500] bitmonk: any chance 0.10.8 requires ruby 1.9?
[2012-01-04 23:18:00 -0500] laurent\: or jruby ?
[2012-01-04 23:18:00 -0500] laurent\: none i guess
[2012-01-04 23:19:00 -0500] fujin: I had to install libgecode-dev, then 'bundle', but seems to work..?
[2012-01-04 23:19:00 -0500] fujin: Finished in 23.33 seconds
[2012-01-04 23:19:00 -0500] fujin: 4174 examples, 0 failures, 4 pending
[2012-01-04 23:23:00 -0500] gpapilon: trying that.
[2012-01-04 23:41:00 -0500] macros: Has anyone done a run profiler for chef-client?
[2012-01-04 23:41:00 -0500] macros: Doesn't seem hard to build with the run reporting stuff
[2012-01-04 23:42:00 -0500] gpapilon: I added a handler to report total memory usage post run.
[2012-01-04 23:43:00 -0500] fujin: my runs are always so fast =( never have had to profile it
[2012-01-04 23:43:00 -0500] fujin: I guess one client we went to had really slow chef runs by doing retarded shit
[2012-01-04 23:43:00 -0500] fujin: that would have been good to profile
[2012-01-04 23:43:00 -0500] macros: I'm more interested in what percentage of the time is spent dealing with the package manager
[2012-01-04 23:43:00 -0500] fujin: got ya
[2012-01-04 23:43:00 -0500] macros: My gut says it is the bulk of the runs on a converged system
[2012-01-04 23:53:00 -0500] ec2hacker: Is it possible to register a client on chef server with an existing .pem file? (from my old server)
