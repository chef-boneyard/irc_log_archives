[2012-01-05 09:16:00 -0500] BryanWB: is sourceforge.net down? it is breaking my nagios cookbbook
[2012-01-05 10:14:00 -0500] zykes-: is there a way to schedule commands with sched ?
[2012-01-05 10:14:00 -0500] zykes-: chef
[2012-01-05 10:36:00 -0500] BryanWB: schedule commands? u mean dispatch commands?
[2012-01-05 12:12:00 -0500] _omphe: Total n00b question: I created a node before bootstrapping the actual box with knife.  Now knife can't find it for 'knife ssh' because the IP address attribute seems to be unset on the node.  How can I set this? (Its a box internal to the network w/ no FQDN)
[2012-01-05 12:28:00 -0500] BryanWB: _omphe: does it show up when u do `knife node list`  ?
[2012-01-05 12:30:00 -0500] _omphe: It does, but the FQDN is empty (to be expected) and the IP is empty.
[2012-01-05 12:30:00 -0500] _omphe: when I run `knife node show` that is.
[2012-01-05 12:30:00 -0500] tightwork: How to install all cookbooks? I used to be able to git clone the github repo but that does not seem to be a supported method anymore?
[2012-01-05 12:33:00 -0500] _omphe: I'm going to attempt to delete and re-create/bootstrap my node
[2012-01-05 12:48:00 -0500] `brendan: morning folks
[2012-01-05 12:48:00 -0500] _omphe: SOLVED: I deleted my node, rebootstrapped and then setup the run_list again and all my errors disappeared.  Must remember, in everything Chef: order matters.
[2012-01-05 12:52:00 -0500] laurent\: what do you use to manage your logs (syslogs) and to index/search them ? graylog2 or any alternatives ? issues with mongodb ? any pointer or feedback ? :-)
[2012-01-05 12:53:00 -0500] BryanWB: laurent\: i want to explore graylog2 but havent' gotten around to it yet
[2012-01-05 12:54:00 -0500] BryanWB: the new graylog2 uses elasticsearch instead of mongo
[2012-01-05 13:17:00 -0500] laurent\: BryanWB: oh ok, i'll give it a try then. i've read a lot people complaining about mongodb here :)
[2012-01-05 13:49:00 -0500] dyer: Question, so I had this issue a while ago.. I am using Knife ec2 on CentOS and it seems to be looking for Chef-Client in /usr/bin/chef-client
[2012-01-05 13:49:00 -0500] dyer: bash: line 71: /usr/bin/chef-client: No such file or directory
[2012-01-05 14:07:00 -0500] alexrecarey: hi, I'm having the following problem trying to update a role: knife role from file roles/v10-service-node.rb
[2012-01-05 14:07:00 -0500] alexrecarey: ERROR: ArgumentError: wrong number of arguments (3 for 1)
[2012-01-05 14:07:00 -0500] alexrecarey: any idea what it might be?
[2012-01-05 14:08:00 -0500] oponder: could you pastie.org roles/v10-service-node.rb
[2012-01-05 14:09:00 -0500] oponder: alexrecarey ^
[2012-01-05 14:10:00 -0500] alexrecarey: thanks oponder,  just found the error. The role was using "[" instead of "("
[2012-01-05 14:10:00 -0500] oponder: :)
[2012-01-05 14:10:00 -0500] alexrecarey: It seems I picked up the wrong syntax from some online tutorial :)
[2012-01-05 14:20:00 -0500] dyer: Anyone have any idea what this is about ? Chef::Exceptions::ValidationFailed: Option chef_environment's value ec2_functional_tests% does not match regular expression /^[\-[:alnum:]_]+$/
[2012-01-05 14:21:00 -0500] CharlieSu: ssd7: yes it still completes the Chef run
[2012-01-05 14:26:00 -0500] cjs226: anyone using the route53 cookbook?  I'm trying but running into an error: https://github.com/heavywater/chef-route53/issues/1
[2012-01-05 14:34:00 -0500] dyer: Anyone have any idea what that error is about?
[2012-01-05 14:34:00 -0500] dyer: cjs226, do you have a reproducable test case?
[2012-01-05 14:34:00 -0500] dyer: all I get from that link is "it doesnt work "
[2012-01-05 14:35:00 -0500] cjs226: I'm doing nothing more than the example in the readme :-(
[2012-01-05 14:35:00 -0500] dyer: and on that note, let me elaborate on my issue ;)    I am getting that when I run knife ec2 server create
[2012-01-05 14:36:00 -0500] cjs226: dyer: the error listed is "aws is not a recognized dns provider"
[2012-01-05 14:36:00 -0500] dyer: I think it MAY be case sensitive in FOG
[2012-01-05 14:36:00 -0500] dyer: https://github.com/heavywater/chef-route53/blob/master/providers/record.rb#L22
[2012-01-05 14:38:00 -0500] cjs226: ok, let me try AWS.  1 sec
[2012-01-05 14:39:00 -0500] dyer: Hrm, scratch that
[2012-01-05 14:39:00 -0500] dyer: I just tested
[2012-01-05 14:53:00 -0500] cjs226: bummer
[2012-01-05 14:55:00 -0500] dyer: cjs226, I have never used the route53 cookbook sorry
[2012-01-05 14:55:00 -0500] dyer: thought I might be able to help tough
[2012-01-05 14:56:00 -0500] cjs226: appreciate it
[2012-01-05 14:56:00 -0500] CharlieSu: ssd7: figured it out..  chef-client running under 'runit' was running at the same time as when i was running it manually.. this was a problem because the one running under 'runit' had an empty runlist which would clear out my /var/chef/cache/cookbooks/ directory..  It had nothing to do w/ Omnibus
[2012-01-05 15:06:00 -0500] spyvsspy: I am assuming I need valid certs to use chef?
[2012-01-05 15:06:00 -0500] spyvsspy: Error 107 (net::ERR_SSL_PROTOCOL_ERROR
[2012-01-05 15:06:00 -0500] spyvsspy: anyway I can do testing w/o one?
[2012-01-05 15:07:00 -0500] spyvsspy: nm
[2012-01-05 16:03:00 -0500] miketheman: Annoying discovery this morning.
[2012-01-05 16:03:00 -0500] miketheman: http://tickets.opscode.com/browse/CHEF-2848
[2012-01-05 16:06:00 -0500] CharlieSu: miketheman: yikes..  simple fix though..  Omnibus is great though isn't it?
[2012-01-05 16:08:00 -0500] miketheman: CharlieSu: initial thoughts are: yes, but I'd rather use my system-integrated packages, where possible
[2012-01-05 16:08:00 -0500] miketheman: CharlieSu: simple fix - what?
[2012-01-05 16:11:00 -0500] miketheman: an attempt to install the gem manually via the embedded gem command (should be identical to the gem_package statement) produced: http://pastebin.com/jNpg09Nr
[2012-01-05 16:12:00 -0500] yfeldblum: yo i heard u like packages so i deb packaged ur gem package so u can untargz while u untargz
[2012-01-05 16:12:00 -0500] miketheman: yfeldblum: ha, sure. :)
[2012-01-05 16:13:00 -0500] gmcinnes: wot is the omnibus installer everyone is hyped about?
[2012-01-05 16:13:00 -0500] miketheman: http://www.opscode.com/chef/install/
[2012-01-05 16:13:00 -0500] gmcinnes: well, I mean I'm looking at it. But I don't get it.
[2012-01-05 16:14:00 -0500] yfeldblum: omnibus is a program for creating "fat" installers; the chef full-stack "fat" installer will install chef on your system plus an isolated copy of ruby and other dependencies
[2012-01-05 16:14:00 -0500] gmcinnes: oh. I see.  I think.
[2012-01-05 16:14:00 -0500] gmcinnes: gotcha.
[2012-01-05 16:14:00 -0500] cratchit: fancy
[2012-01-05 16:14:00 -0500] gmcinnes: as opposed to chef bootstrap etc.
[2012-01-05 16:14:00 -0500] miketheman: yes
[2012-01-05 16:14:00 -0500] CharlieSu: gmcinnes: it contains everything needed to run Chef..  It seems much quicker than the rubygems install as well
[2012-01-05 16:14:00 -0500] jtimberman: omnibus?
[2012-01-05 16:14:00 -0500] bawt: omnibus is a project for building full-stack packages for a variety of platforms, and is used to build the 'chef-full' packages downloaded from http://opscode.com/chef/install or with http://opscode.com/chef/install.sh
[2012-01-05 16:14:00 -0500] jtimberman: :)
[2012-01-05 16:15:00 -0500] yfeldblum: this is an alternative to you having a large bootstrap template where you are responsible for installing ruby, rubygems, and the chef and ohai gems
[2012-01-05 16:15:00 -0500] miketheman: jtimberman: YES.
[2012-01-05 16:15:00 -0500] miketheman: yfeldblum: YES.
[2012-01-05 16:15:00 -0500] gmcinnes: gotcha.
[2012-01-05 16:16:00 -0500] miketheman: so why would the embedded package deny me installing a new gem>
[2012-01-05 16:16:00 -0500] miketheman: ?
[2012-01-05 16:16:00 -0500] jtimberman: how does it deny you that?
[2012-01-05 16:17:00 -0500] miketheman: http://pastebin.com/jNpg09Nr
[2012-01-05 16:20:00 -0500] CharlieSu: Is there a way to have 'knife cookbook site install' not do anything with Git?
[2012-01-05 16:22:00 -0500] jtimberman: miketheman: 'shadow' is not the gem you want, fwiw.
[2012-01-05 16:22:00 -0500] jtimberman: miketheman: https://rubygems.org/gems/ruby-shadow
[2012-01-05 16:22:00 -0500] yfeldblum: CharlieSu, are you looking for `knife cookbook site download` ?
[2012-01-05 16:23:00 -0500] CharlieSu: yfeldblum: looks like it.. thanks
[2012-01-05 16:23:00 -0500] jtimberman: miketheman: https://gist.github.com/1565973
[2012-01-05 16:23:00 -0500] yfeldblum: that's right, the gem is named "ruby-shadow" (gem install ruby-shadow) but the require is just "shadow" (require 'shadow')
[2012-01-05 16:25:00 -0500] jtimberman: naming things is hard.
[2012-01-05 16:29:00 -0500] miketheman: jtimberman: doh
[2012-01-05 16:31:00 -0500] miketheman: so now: how do I implement this into a recipe? case[:platform] isn't good enough to detect whether the system has been deployed using the chef-full embedded package
[2012-01-05 16:34:00 -0500] spyvsspy: https://gist.github.com/1566009
[2012-01-05 16:34:00 -0500] spyvsspy: anyone have any suggestions why I  am getting this on my local workstation
[2012-01-05 16:34:00 -0500] spyvsspy: I deployed chef-server also
[2012-01-05 16:35:00 -0500] spyvsspy: I have validation.pem, and client.pem
[2012-01-05 16:35:00 -0500] miketheman: did you run it with "-VV" option?
[2012-01-05 16:38:00 -0500] spyvsspy: header problems?
[2012-01-05 16:38:00 -0500] miketheman: or knife.rb path problems?
[2012-01-05 16:38:00 -0500] spyvsspy: https://gist.github.com/1566027
[2012-01-05 16:39:00 -0500] CharlieSu: I'm moving from the old 'Chef' cookbook to the newer 'chef-client' cookbook for my Ubuntu (Lucid) boxes running on Ec2.  Anyone suggest a particular 'init' style?
[2012-01-05 16:40:00 -0500] miketheman: auto-detect
[2012-01-05 16:40:00 -0500] miketheman: ;)
[2012-01-05 16:40:00 -0500] CharlieSu: miketheman: does it do that fo ryou?
[2012-01-05 16:41:00 -0500] miketheman: CharlieSu: using the chef-full package, chef-client - on maverick, it sets up an init for me
[2012-01-05 16:42:00 -0500] CharlieSu: miketheman: true.. it does that for me as well.  so i guess there is no need to use the chef-client cookbook at all then when using omnibus?
[2012-01-05 16:44:00 -0500] spyvsspy: forgot the friggen http:// in the URL
[2012-01-05 16:45:00 -0500] miketheman: spyvspy: knife.rb?
[2012-01-05 16:45:00 -0500] spyvsspy: ya
[2012-01-05 16:45:00 -0500] miketheman: nice.
[2012-01-05 16:45:00 -0500] spyvsspy: but, not I cant authenticate
[2012-01-05 16:45:00 -0500] spyvsspy: ERROR: Failed to authenticate to http://chef-server.newgrounddigital.com:4000
[2012-01-05 16:46:00 -0500] spyvsspy: even though, I just regenerated the client.pem in the webui
[2012-01-05 16:46:00 -0500] miketheman: that's an entirely different problem
[2012-01-05 16:46:00 -0500] spyvsspy: and then cut/pasted to /home/user/chef-repo/.chef/user.pem
[2012-01-05 16:46:00 -0500] spyvsspy: right, I know, but why wouldnt it be able to validate?
[2012-01-05 16:56:00 -0500] cjs226: anyone using the route53 cookbook?  I'm trying but running into an error: https://github.com/heavywater/chef-route53/issues/1
[2012-01-05 17:00:00 -0500] simon_jj: can someone tell me how I can persist something from a ruby_block outside to be reused elsewhere please
[2012-01-05 17:00:00 -0500] simon_jj: http://pastebin.com/SMN6Hagh
[2012-01-05 17:01:00 -0500] Brad_K: simon_jj: store the result in a data bag?
[2012-01-05 17:04:00 -0500] simon_jj: @Brad_K: all I need is use novarc_contents inside of a template, there is no simpler way than storing it in a data_bag
[2012-01-05 17:04:00 -0500] simon_jj: seems a bit of an overkill to me
[2012-01-05 17:04:00 -0500] Brad_K: it was just an idea.
[2012-01-05 17:04:00 -0500] yfeldblum: simon_jj, do you have recipes that write the novarc file in the first place?
[2012-01-05 17:04:00 -0500] yfeldblum: simon_jj, or how does the novarc file get onto the system originally?
[2012-01-05 17:05:00 -0500] laurent\: simon_jj: have you tried to use a @@class var ?
[2012-01-05 17:06:00 -0500] simon_jj: yes nova_rc is created by a recipes as a result of doing an execute and unzip
[2012-01-05 17:07:00 -0500] laurent\: hmm so the nova_rc doesn't change, doesn't it ?
[2012-01-05 17:08:00 -0500] simon_jj: it changes
[2012-01-05 17:08:00 -0500] yfeldblum: simon_jj, the canonical chef approach (don't know if you'll like this) is to have a copy of the novarc file in your cookbook, and you have a cookbook_file or template resource that copies your cookbook's novarc file over on top of the original
[2012-01-05 17:09:00 -0500] laurent\: and to use default attributes
[2012-01-05 17:10:00 -0500] simon_jj: but a good 30% of the file are dynamic... and even if I'd use a template I would still have to get the contents of dynamic file parts
[2012-01-05 17:10:00 -0500] yfeldblum: if the novarc is a static file, the rest of your cookbook can just make assumptions about what's in it; if the novarc is an ERB template, set up some attributes on your cookbook/recipe with sane defaults, which roles can override as needed, or which the cookbook/recipe can override as needed based on search
[2012-01-05 17:11:00 -0500] yfeldblum: but the idea is to start with all of the data you need as data in chef (attributes, gotten from defaults, from role overrides, or from search within the recipe), and to write out the template based on the data and to use the data whenever you need to configure related things
[2012-01-05 17:11:00 -0500] laurent\: nova_rc i guess it's related to openstack (i've been lurking there but i haven't tested it)
[2012-01-05 17:12:00 -0500] simon_jj: yes nova_rc is openstack auth details
[2012-01-05 17:12:00 -0500] yfeldblum: if you take a look at the postgresql cookbook, you'll see that it does exactly this strategy (https://github.com/opscode/cookbooks/blob/master/postgresql/templates/default/debian.postgresql.conf.erb)
[2012-01-05 17:12:00 -0500] yfeldblum: and this same strategy is followed by very many cookbooks
[2012-01-05 17:15:00 -0500] simon_jj: off I go, thanks a bunch gents
[2012-01-05 17:18:00 -0500] tightwork: why does this happen, isn't mysql a valid gem? INFO: Missing gem 'mysql' ERROR: Running exception handlers
[2012-01-05 17:20:00 -0500] jtimberman: tightwork: its an informational message
[2012-01-05 17:20:00 -0500] jtimberman: tightwork: what happened after "running exception handlers" will indicate what the actual problem is.
[2012-01-05 17:20:00 -0500] jbz: tightwork:  We find that usually when we get that error, the mysql gem failed to install because some of the OS packages it needs to compile its native extensions aren't present.
[2012-01-05 17:21:00 -0500] jbz: tightwork: Try manually installing the mysql gem on the affected system and see what error it pitches you. :)
[2012-01-05 17:22:00 -0500] miketheman: here's one for the gurus. aws ec2 "Linux AMI" is type "amazon" via ohai.
[2012-01-05 17:22:00 -0500] miketheman: they also provide different 'platform_version' results, depending on the generation they have built
[2012-01-05 17:23:00 -0500] miketheman: how would I muck the `case[:platform] = "amazon"`, and make a decision based on the platform_version?
[2012-01-05 17:23:00 -0500] tightwork: jbz: looks like no libmysqlclient, is then run order important? I'm using ubuntu, I know its picky about using apt-get for it's gems too... http://dpaste.com/682175/
[2012-01-05 17:25:00 -0500] tightwork: i set mysql::client first, same prob
[2012-01-05 17:26:00 -0500] jreynolds: tightwork: are you using 64bit Ubuntu?
[2012-01-05 17:27:00 -0500] fearoffish: has anyone seen cookbook dependencies failing before? I have a recipe that 'depends' on another, but it's not pulling it and then failing that I can't find it
[2012-01-05 17:27:00 -0500] fearoffish: ignore that, it's something else that's causing it :)
[2012-01-05 17:28:00 -0500] jbz: tightwork: Yeah, you have to have that installed before you (or Chef) tries to install the mysql gem, otherwise it won't compile.
[2012-01-05 17:29:00 -0500] jbz: tightwork: Actually, I'm not *postiive* that it's mysqlclient you need, it might be one of the -dev packages, but anyway, whatever it is yes it has to be there before Chef tries to install the gem.
[2012-01-05 17:31:00 -0500] spyvsspy: how do you guys deploy your initial image w/o it being a pita?
[2012-01-05 17:31:00 -0500] spyvsspy: an image setup with the pem files installed etc, and a dd of an ISO?
[2012-01-05 17:32:00 -0500] jbz: spyvspy: On hardware, we use knife bootstrap on a 'vanilla install'; on EC2 we use userdata bootstrap scripts to write the requisite pemfiles and configs and install Chef via gems.
[2012-01-05 17:33:00 -0500] bdha: Why not just use bootstrap...?
[2012-01-05 17:33:00 -0500] spyvsspy: do you see any limitations with setting up a server w/ chef, and the appropriate stetup, then taking an imave of it?
[2012-01-05 17:33:00 -0500] fearoffish: we use cloudformation and userdata to run a shell script that bootstraps them
[2012-01-05 17:33:00 -0500] fearoffish: to make a cluster
[2012-01-05 17:34:00 -0500] fearoffish: the cloudformation script creates users, volumes, s3 bucket policies, ec2 instances etc.
[2012-01-05 17:34:00 -0500] fearoffish: then chef bootstraps them all together
[2012-01-05 17:34:00 -0500] jbz: bdha: We have a web-based console to let our engineers manage their own infrastructure - this avoids having to have Chef/EC2 credentials widely dispersed.  Given that, it was easiest to just do the userdata setup (and it avoids having to have an SSH connection for the initial bootstrap).
[2012-01-05 17:34:00 -0500] bdha: jbz: aha.
[2012-01-05 17:39:00 -0500] tightwork: jbz: Yeah it's 64bit.. how can I get the package installed by chef? I'm goin for a whole hands off approach to getting mysql installed, this is a new vm.
[2012-01-05 17:40:00 -0500] jbz: tightwork:  Just put in a 'package' resource just prior to the gem resource which installs the prereq.
[2012-01-05 17:40:00 -0500] spyvsspy: jbz, did you guys build your own webbased console?
[2012-01-05 17:40:00 -0500] jbz: spyvsspy: Yes.  It's a viciously hacked version of Webistrano. :-)
[2012-01-05 17:41:00 -0500] spyvsspy: crap
[2012-01-05 17:41:00 -0500] spyvsspy: ssh :(
[2012-01-05 17:41:00 -0500] jbz: Well, not for the Opscode/EC2 stuff, no
[2012-01-05 17:42:00 -0500] jbz: that's all done using the Chef client libraries or the EC2 REST API.
[2012-01-05 17:42:00 -0500] spyvsspy: to change the state of the phyiscal servers?
[2012-01-05 17:42:00 -0500] jbz: There are three components to the console - the first sets up Amazon AWS resources (EC2, ELBs, RDS)
[2012-01-05 17:42:00 -0500] jbz: that uses the API.
[2012-01-05 17:43:00 -0500] jbz: The second manages Opscode platform resources for the servers
[2012-01-05 17:43:00 -0500] jbz: that also uses a web API.
[2012-01-05 17:43:00 -0500] jbz: Then the original bits are used (in some of our environments) to deploy the code - that uses SSH.
[2012-01-05 17:43:00 -0500] jbz: But our newer environments use Chef deployments, and thus don't need SSH connections.
[2012-01-05 17:43:00 -0500] spyvsspy: ah nice
[2012-01-05 17:43:00 -0500] spyvsspy: I dont really need to deploy code, I just need to serve static files
[2012-01-05 17:44:00 -0500] jbz: Are the static files 'installed' onto your servers, or are they put there by users?
[2012-01-05 17:44:00 -0500] spyvsspy: much less moving parts, and no AWS stuff, just 1500+ physical servers
[2012-01-05 17:44:00 -0500] spyvsspy: a webapp generates (think video playlist) a bunch of files, and the servers just need to download them as appropriate
[2012-01-05 17:45:00 -0500] spyvsspy: each server gets different files/playlists
[2012-01-05 17:45:00 -0500] dyer: Question, can anyone take a look at this chef run and tell me why the _$#$___ cassandra seems to be restarting on the initial deploy ?  ( https://gist.github.com/defe549ad795434e9d5d )
[2012-01-05 17:45:00 -0500] jbz: hmm.  So up until they download those files/playlists, they're all identical...does that download happen once at bootstrap time, or regularly
[2012-01-05 17:46:00 -0500] spyvsspy: jbz, once an hour through rsync
[2012-01-05 17:46:00 -0500] jbz: oh!
[2012-01-05 17:46:00 -0500] spyvsspy: buy my goal is to elimate all ssh traffic, and just use 443
[2012-01-05 17:46:00 -0500] jbz: Ah I see
[2012-01-05 17:46:00 -0500] jbz: well
[2012-01-05 17:46:00 -0500] spyvsspy: they arent identical though
[2012-01-05 17:46:00 -0500] jbz: that sounds like a perfect Chef task
[2012-01-05 17:46:00 -0500] spyvsspy: each server, needs different files
[2012-01-05 17:47:00 -0500] jbz: do the initial config from a common role/runlist
[2012-01-05 17:47:00 -0500] jbz: then have each server have attributes which determine what it downloads
[2012-01-05 17:48:00 -0500] jbz: and you could have the Chef client perform the rsync rather than using cron/etc
[2012-01-05 17:48:00 -0500] spyvsspy: well, my plan now, is to create a "master" ISO, which will be dd'ed when we launch a new server
[2012-01-05 17:48:00 -0500] spyvsspy: there will be a install script on there, that will be run for the inital chef-server interaction
[2012-01-05 17:49:00 -0500] spyvsspy: then a webinterface, to manage the state on the server
[2012-01-05 17:49:00 -0500] jbz: How do you differentiate your servers - i.e. how does each server know its role?  Hostname, or metadata?
[2012-01-05 17:49:00 -0500] tightwork: jbz: isnt that what the mysql recipe should do? I have the mysql mysql::client and mysql::server recipes ...
[2012-01-05 17:49:00 -0500] spyvsspy: I was thinking hostname
[2012-01-05 17:49:00 -0500] spyvsspy: but, at this point, I am relaunching our current system
[2012-01-05 17:49:00 -0500] jbz: tightwork: Those don't install the -dev packages, IIRC.  They install working binaries, but not the files required to compile additional code, which is what the gem install is doing.
[2012-01-05 17:49:00 -0500] dyer: when I launch a server I pass the role in userdata
[2012-01-05 17:50:00 -0500] spyvsspy: right now though, there is a user on the system, that rsyncs with a master server to get the files, then scripts to copy to /var/www to be served up
[2012-01-05 17:50:00 -0500] Brad_K: spyvspy: have you looked at crowbar?  or the work that has been done with installing systems using bittorrent on the back end?
[2012-01-05 17:50:00 -0500] tightwork: ah dam
[2012-01-05 17:50:00 -0500] dyer: chef-client -l debug -L /ect/chec/first-run.log -E production -N webserver1.blah.com
[2012-01-05 17:51:00 -0500] dyer: oh yea, -J first-run.json
[2012-01-05 17:51:00 -0500] Brad_K: dyer: we know what you meant.  ;-)
[2012-01-05 17:51:00 -0500] dyer: you do, he may not
[2012-01-05 17:51:00 -0500] dyer: ;)
[2012-01-05 17:51:00 -0500] dyer: just trying to help :)
[2012-01-05 17:52:00 -0500] Brad_K: okay, then for his benfit, i'm sure you meant "/etc/chef" and not "/ect/chec".  and i'm not sure if you intentionally left out the -S argument as well.
[2012-01-05 17:54:00 -0500] jbz: tightwork:  You're looking for apt pkg libmysqlclient5-dev or similar
[2012-01-05 17:55:00 -0500] mconigliaro: hey chef devs, is this a bug? "nil: command not found" --> https://gist.github.com/1566364
[2012-01-05 17:55:00 -0500] jbz: dyer: Looking at that run, I see cassandra being started once in the service[cassandra] execution
[2012-01-05 17:55:00 -0500] jbz: dyer:  Am I wrong?
[2012-01-05 17:55:00 -0500] mconigliaro: seems like i always have to set the code or command attribute
[2012-01-05 17:55:00 -0500] dyer: Why would it be started twice?
[2012-01-05 17:56:00 -0500] mconigliaro: even though the docs say it should use the resource name for that by default
[2012-01-05 17:56:00 -0500] jbz: dyer: I only see it starting once...
[2012-01-05 17:56:00 -0500] dyer: and if its running, and I manually start it via init.d, I get a warning about it already running
[2012-01-05 17:56:00 -0500] dyer: oh, sorry
[2012-01-05 17:56:00 -0500] dyer: misread
[2012-01-05 17:56:00 -0500] dyer: its starting early in the run and then it restarts
[2012-01-05 17:58:00 -0500] tightwork: jbz: Is this a side effect of using ubuntu 10.04?
[2012-01-05 17:58:00 -0500] jbz: tightwork: It may be a side effect of using Ubuntu, it's not 10.04 specific
[2012-01-05 17:58:00 -0500] jbz: ubuntu's packages don't install the dev stuff (headers, etc) along with the client.
[2012-01-05 17:59:00 -0500] jbz: No matter what distro you use, the gem install of mysql will try to compile native extensions, which means it will need those headers/libs; whether they're there or not by default may differ.
[2012-01-05 17:59:00 -0500] spyvsspy: jbz, so would I have to setup a proxy or something to redirect chef-client requests, if I wanted to use 443
[2012-01-05 17:59:00 -0500] spyvsspy: ?
[2012-01-05 18:00:00 -0500] jbz: spyvsspy: Er, wait, what?  chef-client uses 443 by default...do you mean you can't make 443 requests from your infrastructure?
[2012-01-05 18:00:00 -0500] jbz: hm, at least, I think it uses 443, to be honest...
[2012-01-05 18:00:00 -0500] spyvsspy: hrm...client.rb has 4000
[2012-01-05 18:01:00 -0500] spyvsspy: but Im not sure if I did that or not
[2012-01-05 18:01:00 -0500] dyer: jbz, worst part is I can not reproduce this manually to save my life, only seems to happen when I initially create the instance
[2012-01-05 18:02:00 -0500] jbz: dyer: Ugh I hate that.
[2012-01-05 18:02:00 -0500] dyer: if I blow the dirs, services, ect, away and run chef it works fine
[2012-01-05 18:02:00 -0500] jbz: dyer:  Here's one possibility - how are you installing cassandra?  I wasn't clear (i.e. too lazy to fully wade through that log)
[2012-01-05 18:03:00 -0500] dyer: Pretty straight forward: https://gist.github.com/55cadd56bdb1224b096e
[2012-01-05 18:03:00 -0500] tightwork: jbz: This is a VM on my openstack box, I dont recall this happening to me using rackspace.
[2012-01-05 18:04:00 -0500] jbz: tightwork: Well, it all depends if you have the 'developer' stuff installed on the box.  I dunno how those are configured.  I'd recommend just doing the install of the dev package.  If it's already there, it'll just skip.  No loss.
[2012-01-05 18:05:00 -0500] mostlygeek: what's the best way to download a .tar.gz file (php lib) using chef? should i just run Execute w/ wget or something?
[2012-01-05 18:05:00 -0500] jbz: dyer:  Huh. I dunno, sorry.  Is there somewhere in that debug log which shows it starting the first time?  I only found the service[cassandra] stanza, which shows that the status command thinks it's stopped, so it gets started.
[2012-01-05 18:05:00 -0500] spyvsspy: jbz, open source server is 4000
[2012-01-05 18:05:00 -0500] jbz: spyvsspy: Oh, my bad.  I just use the platform. :-)
[2012-01-05 18:06:00 -0500] miketheman: ERROR: Network Error: Connection refused - Connection refused connecting to api.opscode.com:443
[2012-01-05 18:06:00 -0500] miketheman: just me?
[2012-01-05 18:07:00 -0500] miketheman: nm, intermittent
[2012-01-05 18:08:00 -0500] jbz: miketheman: I get that once in a while, but it usually goes away and doesn't persist past retry
[2012-01-05 18:08:00 -0500] tightwork: jbz: I guess that's my options, re master the golden image or write the prereq
[2012-01-05 18:10:00 -0500] jbz: tightwork: Why not just put it in the chef cookbook?  That's what it's for...
[2012-01-05 18:10:00 -0500] jbz: (unless your machines can't get to an apt repo which has the necessary files easily).
[2012-01-05 18:11:00 -0500] yfeldblum: mostlygeek, the remote_file resource
[2012-01-05 18:11:00 -0500] yfeldblum: mostlygeek, http://wiki.opscode.com/display/chef/Resources#Resources-RemoteFile
[2012-01-05 18:11:00 -0500] tightwork: jbz: this is odd.. I'm looking at mysql/recipes/client.rb and it says when "ubuntu", "debian" ... else %w{mysql-client libmysqlclient-dev}, I just did apt-get install libmysqlclient-dev and gem install mysql and worked fine, I had mysql::client in the run list but still gave me the error?
[2012-01-05 18:12:00 -0500] mostlygeek: yfeldblum: it says it is deprecated
[2012-01-05 18:12:00 -0500] mostlygeek: but still ok to use?
[2012-01-05 18:12:00 -0500] tightwork: ... seems like the code 'should' insteall the libmysqlclient-dev package
[2012-01-05 18:12:00 -0500] yfeldblum: mostlygeek, remote_file is NOT deprecated
[2012-01-05 18:13:00 -0500] yfeldblum: mostlygeek, a particular way of using remote_file IS deprecated, because that same behavior is provided by a different resource ... but that's not what you're trying to do anyway so just ignore that
[2012-01-05 18:14:00 -0500] mconigliaro: anyone know what's going on with this? i couldn't find a bug report anywhere... https://gist.github.com/1566364
[2012-01-05 18:14:00 -0500] mostlygeek: yfeldblum: cool thanks! :D
[2012-01-05 18:18:00 -0500] fearoffish: mconigliaro: have you tried that with an actual command to run?
[2012-01-05 18:18:00 -0500] mconigliaro: fearoffish: yup, it works
[2012-01-05 18:18:00 -0500] mconigliaro: but i shouldnt have to do that
[2012-01-05 18:18:00 -0500] fearoffish: why would you need bash "useless bollox" to work?
[2012-01-05 18:18:00 -0500] mconigliaro: according to the docs, it should use the name of the resource by default
[2012-01-05 18:19:00 -0500] jbz: tightwork: Did you have mysql::client in the run list *before* the mysql gem tried to install?
[2012-01-05 18:19:00 -0500] fearoffish: mconigliaro: hmm, I don't see that in the docs anywhere
[2012-01-05 18:19:00 -0500] mconigliaro: fearoffish: i dont understand the question. 'echo hi' was just a test
[2012-01-05 18:20:00 -0500] mconigliaro: fearoffish: look under script
[2012-01-05 18:20:00 -0500] mconigliaro: "commandName attribute: Name of the command to execute."
[2012-01-05 18:20:00 -0500] fearoffish: yes, name of the command
[2012-01-05 18:20:00 -0500] tightwork: jbz: I did
[2012-01-05 18:20:00 -0500] fearoffish: ah, default value
[2012-01-05 18:20:00 -0500] mconigliaro: command should be set to the name of the resource
[2012-01-05 18:20:00 -0500] mconigliaro: if im reading that correctly
[2012-01-05 18:20:00 -0500] mconigliaro: at least thats how it works for every other resource
[2012-01-05 18:20:00 -0500] fearoffish: maybe that means 'name' literally
[2012-01-05 18:20:00 -0500] fearoffish: not the name you gave it
[2012-01-05 18:21:00 -0500] jbz: tightwork: Hm.  confusing.  So if you do a chef run *without* trying to install the mysql gem (i.e. it completes successfully) does it show the libmysqlclient-dev package as installed?
[2012-01-05 18:21:00 -0500] mconigliaro: in that case, shouldnt the error have been 'name: command not found?'
[2012-01-05 18:21:00 -0500] mconigliaro: i get 'nil: command not found'
[2012-01-05 18:21:00 -0500] fearoffish: hmm yes
[2012-01-05 18:21:00 -0500] mconigliaro: im creating a bug report now
[2012-01-05 18:22:00 -0500] tightwork: jbz: I will create a mysql role with mysql::client first, spin up another vm and see if this happens again just to be sure I didnt pebkac something
[2012-01-05 18:22:00 -0500] jbz: tightwork:  Cool
[2012-01-05 18:23:00 -0500] dyer: jbz, I think I got it
[2012-01-05 18:23:00 -0500] jbz: dyer:  Sup?
[2012-01-05 18:24:00 -0500] dyer: no idea why this would matter, but I decided to do a "  notifies :start, "service[cassandra]", :immediately" right after the last template is rendered in the cassanda recipe
[2012-01-05 18:24:00 -0500] dyer: no idea why that fixed it
[2012-01-05 18:24:00 -0500] dyer: but first test passed
[2012-01-05 18:25:00 -0500] jbz: dyer: Huh.
[2012-01-05 18:25:00 -0500] fearoffish: anyone got a recommendation for an infrastructure testing suite?  I tried cucumber-chef a while ago but it failed to build miserably
[2012-01-05 18:25:00 -0500] dyer: you were giving me a hand w/ the Cassandra issue I was having
[2012-01-05 18:25:00 -0500] dyer: fearoffish, I played around w/ chefspec a little bit
[2012-01-05 18:26:00 -0500] fearoffish: what was your experience like?
[2012-01-05 18:26:00 -0500] dyer: its pretty imature, but that seems to be a constant...
[2012-01-05 18:26:00 -0500] jbz: dyer: Yepyep, glad that worked.  Unsure *why*, but glad it's working!
[2012-01-05 18:27:00 -0500] dyer: I looked at cucumber-chef, but I didnt have time to try and patch it so it would work on open source chef
[2012-01-05 18:28:00 -0500] fearoffish: okay, your experiences line up with mine then...they all suck ;-)
[2012-01-05 18:28:00 -0500] dyer: 100%
[2012-01-05 18:28:00 -0500] fearoffish: now all I need is the time to write one that actually works
[2012-01-05 18:29:00 -0500] dyer: chefspec's only problem, in my limited experence w/ it ,was that it only gave you assertions for a few resources
[2012-01-05 18:29:00 -0500] dyer: and its kind of a bitch to get your head around, at least for me, since I was new to rspec
[2012-01-05 18:29:00 -0500] fearoffish: yeah, it doesn't look very useful at the stage it's at
[2012-01-05 18:30:00 -0500] fearoffish: until I start one, I can't see why it's so hard
[2012-01-05 18:30:00 -0500] dyer: well I guess my point here is that this is a good start
[2012-01-05 18:30:00 -0500] dyer: https://github.com/acrmp/chefspec
[2012-01-05 18:30:00 -0500] fearoffish: start with say vagrant, boot one up, run chef on it with your cookbooks...check it.  done! ;-)
[2012-01-05 18:31:00 -0500] miah: moin
[2012-01-05 18:32:00 -0500] dyer: personally I focus most of my tests in my libraries
[2012-01-05 18:32:00 -0500] dyer: because its the only thing I have been able to tests ;)
[2012-01-05 18:32:00 -0500] fearoffish: heh
[2012-01-05 18:32:00 -0500] miketheman: jtimberman: awesome update on the ticket, thanks
[2012-01-05 18:33:00 -0500] miketheman: Is there a way to determine within a chef run if it is running under the context of the embedded version or system-installed ruby?
[2012-01-05 18:34:00 -0500] jbz: miketheman: You want the ruby it's running under?
[2012-01-05 18:34:00 -0500] miah: you could probably check the config attribute that sets the chef binary path?
[2012-01-05 18:34:00 -0500] fearoffish: you could maybe use RUBY_VERSION
[2012-01-05 18:34:00 -0500] mconigliaro: fearoffish: http://tickets.opscode.com/browse/CHEF-2850
[2012-01-05 18:35:00 -0500] fearoffish: mkay
[2012-01-05 18:35:00 -0500] miah: miketheman: "chef_root": "/usr/lib/ruby/gems/1.8/gems/chef-0.10.4/lib" ?
[2012-01-05 18:36:00 -0500] jtimberman: miketheman: RbConfig::CONFIG['prefix']
[2012-01-05 18:37:00 -0500] miketheman: I'll try all of those, thanks.
[2012-01-05 18:43:00 -0500] CharlieSu: I'm noticing an issue when using OmniBus.  I'm starting my server with a populated runlist using 'knife ec2 server create' and specifying the omnibus template.  However there seems to be a race condition that is occuring.  As the server is being bootstrapped it installs chef-full then continues to install the items in my runlist.  However it looks like a second Chef-client is being started at the same time (from the chef-full 
[2012-01-05 18:47:00 -0500] jtimberman: CharlieSu: do you have 'recipe[chef-client::service]' or 'recipe[chef-client]' in your node's run list?
[2012-01-05 18:47:00 -0500] jtimberman: or in the expanded run list recipes?
[2012-01-05 18:48:00 -0500] CharlieSu: jtimberman: i don't actually
[2012-01-05 18:50:00 -0500] CharlieSu: jtimberman: however it does look like chef-client is being setup w/ runit somehow..  https://gist.github.com/3d808d737b1b50536c4e
[2012-01-05 18:51:00 -0500] CharlieSu: jtimberman: actually it looks like it was being included by a recipe...  let me remove that and see if it fixes it
[2012-01-05 18:55:00 -0500] jtimberman: CharlieSu: yeah, i think whatever is in sledgehammer_app might be doing include_recipe stuff.
[2012-01-05 18:56:00 -0500] dwhsix: I know this is contrary to Best Practices(), but is there a way to run just a single recipe on a node, instead of its whole run list?
[2012-01-05 18:57:00 -0500] dwhsix: short of mod'ing the node def temporarily
[2012-01-05 18:57:00 -0500] dwhsix: ?
[2012-01-05 18:57:00 -0500] miah: dwhsix: shef
[2012-01-05 18:57:00 -0500] CharlieSu: jtimberman: yep.. looks like that was it.. sorry for that..
[2012-01-05 18:59:00 -0500] dwhsix: miah: ah, ok, that might do it thanks!
[2012-01-05 19:06:00 -0500] dwhsix: hmm, shef is installed as part of chef?  I get " rubygems.rb:900:in `report_activate_error': Could not find RubyGem chef (>= 0) (Gem::LoadError)"
[2012-01-05 19:06:00 -0500] jbz: Stupid q:  can I put Chef::Log calls *inside* a resource so they'll fire at execute time not compile time?
[2012-01-05 19:08:00 -0500] bemu: Is Jesse Robbins' email jesse@opscode.com?
[2012-01-05 19:09:00 -0500] bemu: Nevermind, stupid question.
[2012-01-05 19:14:00 -0500] tightwork: Any onboard with knife and openstack ?
[2012-01-05 19:18:00 -0500] rrichardsr3: howdy chefs, is there a way to configure the opscode platform to cleanup nodes that are no longer running?
[2012-01-05 19:18:00 -0500] rrichardsr3: (in the node list on the site)
[2012-01-05 19:20:00 -0500] bemu: rrichardsr3: Not anything I'm aware of. You could create an init service which deleted the client/node itself on shutdown, or you could something external to handle this.
[2012-01-05 19:20:00 -0500] rrichardsr3: bemu: makes sense, thanks
[2012-01-05 19:20:00 -0500] atomic-penguin: BryanWB, you could call your podcast "Modernist Infrastructure".
[2012-01-05 19:24:00 -0500] rrichardsr3: ha this is saving my life today: chef-client -j /etc/chef/first-boot.json
[2012-01-05 19:27:00 -0500] dwhsix: so puzzled: with shef, how would I run just one recipe out of the node's run_list?
[2012-01-05 19:28:00 -0500] thehar: Who is coming to our hack day @ Lookout? :)
[2012-01-05 19:33:00 -0500] bemu: I cross-posted it on SF DevOps as well.
[2012-01-05 19:34:00 -0500] miah: I AM I AM
[2012-01-05 19:38:00 -0500] CharlieSu: Anyone have an idea why this wouldn't work anymore?  I'm now using Ruby 1.9 instead of 1.8..    https://gist.github.com/c36eb992dbb83c83af28
[2012-01-05 19:39:00 -0500] CharlieSu: i don't have any critical thinking skills anymore :)
[2012-01-05 19:42:00 -0500] tboner_: can someone here help me diagnose a nfs permissions thing?  I've outlined it here
[2012-01-05 19:42:00 -0500] tboner_: https://gist.github.com/1566818
[2012-01-05 19:44:00 -0500] jbz: CharlieSu: Er. Maybe enclose the message in parens, so Chef::Log.error("Got Exception in manager action" + e)
[2012-01-05 19:44:00 -0500] jbz: CharlieSu: WAG, though.
[2012-01-05 19:45:00 -0500] dwhsix: so I guess I'm not getting shef if I have a recipe in a cookbook on my server, how can I run that?
[2012-01-05 19:46:00 -0500] CharlieSu: jbz: i'll try that
[2012-01-05 20:12:00 -0500] hikeit: hello! I've made lots 'o progress with the knife-vsphere plugin woo! now i'm poking at some cookbooks
[2012-01-05 20:12:00 -0500] hikeit: is there a way to get test output of a template?
[2012-01-05 20:12:00 -0500] hikeit: (without deploying it to a node)
[2012-01-05 20:13:00 -0500] hikeit: the sudo cookbook is great except that i want passwordless sudo to be enabled on a per-user basis, rather than globally so i need to modify/extend it would love to be able to test as I go
[2012-01-05 20:15:00 -0500] hikeit: (a web search for chef test recipe didn't quite reveal what i was hoping, though it did make me hungry)
[2012-01-05 20:19:00 -0500] yfeldblum: that is one of the pitfalls of using an actual word to name your project
[2012-01-05 20:20:00 -0500] dwhsix: +1
[2012-01-05 20:20:00 -0500] Brad_K: ++
[2012-01-05 20:20:00 -0500] c_t: yfeldblum: there's a libmemcached gem for ruby named, aptly, "memcached"
[2012-01-05 20:20:00 -0500] dwhsix: also when the analogy doesn't go far enough...
[2012-01-05 20:20:00 -0500] dwhsix: chef > cookbook > recipe >  data bag?
[2012-01-05 20:20:00 -0500] c_t: turns out that it's *really difficult* to google
[2012-01-05 20:21:00 -0500] c_t: I guess the cutesy ruby project names are good in that regard
[2012-01-05 20:21:00 -0500] hikeit: my manager tells me it is a good thing they didn't call those "pickles" that is what a packaged hash is called in python
[2012-01-05 20:21:00 -0500] miketheman: I want a gem called 'ruby'
[2012-01-05 20:22:00 -0500] c_t: a gem called 'perl6' would be pretty cool
[2012-01-05 20:22:00 -0500] c_t: it wouldn't be out yet, of course, but it would be coming "real soon now"
[2012-01-05 20:22:00 -0500] c_t: probably should have a gem called "dukenuken4ever" as a dependency
[2012-01-05 20:23:00 -0500] hikeit: so has nobody tested templates without deploying them?
[2012-01-05 20:23:00 -0500] Brad_K: hikeit: that's the only way i've ever tested templates.
[2012-01-05 20:23:00 -0500] dwhsix: ditto, unf
[2012-01-05 20:24:00 -0500] hikeit: 8 months ago, when i was young and dumb and didn't know about chef, i wrote my own templating system that was step 1, make it spit out the template to stdout for testing hope i don't have to repeat that
[2012-01-05 20:24:00 -0500] Brad_K: i usually set up a new role that has never been used anywhere before, and assign that to a guinea-pig machine.  i use that to include the recipes, etc that i need to test.  so long as i don't modify any other cookbooks or recipes in the process, then that isolates that testing to just the one machine.
[2012-01-05 20:25:00 -0500] Brad_K: hikeit: TIMTOWTDI.
[2012-01-05 20:25:00 -0500] Brad_K: sometimes, it's just a simple matter of implementation.  ;-)
[2012-01-05 20:26:00 -0500] hikeit: yeah that would work, but that is like making an update to the file->open box in microsoft word, and to test it you have to do a full rebuild of the entire office suite
[2012-01-05 20:26:00 -0500] Brad_K: Small Matter Of Programming, maybe?
[2012-01-05 20:26:00 -0500] CharlieSu: I've noticed a lot of bugs when going from 1.8 to 1.9 in my cookbooks..  A great example is that the String class no longer has a 'grep' method because it no longer has the Enumerable module...   eeek
[2012-01-05 20:26:00 -0500] dwhsix: hikeit: that's not what MS does?  ;-)
[2012-01-05 20:27:00 -0500] Brad_K: CharlieSu: we found an evil way around that problem.
[2012-01-05 20:27:00 -0500] hikeit: dwhsix: no :] rebuilding the entire suite takes about 8 hours (i used to work on an adjacent project)
[2012-01-05 20:27:00 -0500] dwhsix: (nod) had similar experience at SEBL
[2012-01-05 20:28:00 -0500] Brad_K: but they rebuild the whole thing every night, so you make one change and then wait for the rebuild process, then test it, and make another change and wait for the rebuild process again, ad nauseum, right?  ;-)
[2012-01-05 20:28:00 -0500] dwhsix: but we digress ;-)
[2012-01-05 20:28:00 -0500] Javin: hikeit: I agree it would be nice to have a way to do that. It is hard to pre-check very sensitive config files like sudoers, before deploying and possibly breaking things. I try to use some form of config test before restarting services if such a thing exists.
[2012-01-05 20:28:00 -0500] CharlieSu: Brad_K: care to share?
[2012-01-05 20:28:00 -0500] Brad_K: that's called Continuos Integration, I hear.  ;-)
[2012-01-05 20:29:00 -0500] fujin: you can monkeypatch #grep onto String
[2012-01-05 20:29:00 -0500] fujin: I'd just change usage, tbh
[2012-01-05 20:29:00 -0500] fujin: supply tickets on COOK project
[2012-01-05 20:29:00 -0500] CharlieSu: fujin: yeah i just refactored...
[2012-01-05 20:29:00 -0500] Brad_K: CharlieSu: i found the solution by Googling for it.  something about converting the string to an array, which can then be grep'ed because arrays are enumerable but strings aren't any more.
[2012-01-05 20:29:00 -0500] yfeldblum: hikeit, http://bit.ly/mkgI4q
[2012-01-05 20:30:00 -0500] CharlieSu: Brad_K: yeah i could do that too..   i just switched to 'include?' instead.  However 1.8 doesnt' support RegExp in include? so I had to make a few other changes...
[2012-01-05 20:30:00 -0500] yfeldblum: c_t heh ... there are a bunch of ruby gems that are like that ... but rubygems.org has a search bar just for gems so that's a lot better
[2012-01-05 20:30:00 -0500] fujin: why not just use String#=~
[2012-01-05 20:31:00 -0500] fujin: foo =~ /some shit/
[2012-01-05 20:31:00 -0500] fujin: hell use a regex properly even? :)D
[2012-01-05 20:32:00 -0500] fujin:  /some shit/.match(the_string)
[2012-01-05 20:32:00 -0500] Brad_K: CharlieSu: we stopped worrying about that problem when we decided to start using the Full Stack Installer and chef could bring along whatever version of Ruby they need in order to make all their code work that had to be compatible with the older version of Ruby.
[2012-01-05 20:32:00 -0500] yfeldblum:  /some shit/ === foo
[2012-01-05 20:32:00 -0500] hikeit: continuous integration is great, makes integration testing easy but that doesn't remove the usefulness of unit testing grr.\
[2012-01-05 20:32:00 -0500] CharlieSu: Brad_K: I'm using omnibus now actually.. that is why i'm migrating to 1.9..  how do you specify which version of Ruby it should use?
[2012-01-05 20:33:00 -0500] Brad_K: CharlieSu: you don't.  it's embedded and the path to the binaries etc are embedded in the other code.
[2012-01-05 20:33:00 -0500] fujin: https://github.com/fujin/minitest-cookbook
[2012-01-05 20:33:00 -0500] fujin: write tests and run them.
[2012-01-05 20:33:00 -0500] yfeldblum: hikeit, template("/etc/program.conf") ; ruby_block("log it") { block { Chef::Log.info(File.read("/etc/program.conf")) } }
[2012-01-05 20:34:00 -0500] fujin: https://github.com/fujin/minitest-cookbook/blob/develop/cookbooks/minitest/recipes/examples.rb
[2012-01-05 20:34:00 -0500] gyre007: is there any good book (not e-book) about Chef ?
[2012-01-05 20:36:00 -0500] jtimberman: gyre007: not yet.
[2012-01-05 20:36:00 -0500] jtimberman: Cope is working on a comprehensive "Chef the Definitive Guide"
[2012-01-05 20:36:00 -0500] jtimberman: kind of book
[2012-01-05 20:36:00 -0500] jtimberman: door stop style
[2012-01-05 20:36:00 -0500] jtimberman: you can download a PDF export of the wiki though :)
[2012-01-05 20:36:00 -0500] jtimberman: Its like, 900 pages of PDF goodness.
[2012-01-05 20:37:00 -0500] jtimberman: Cope also wrote "test driven infrastructure with Chef" - 50 page book published by OReilly Media, but it is for a specific topic, and not a comprehensive volume on Chef.
[2012-01-05 20:38:00 -0500] hikeit: fujin: what is minitest-cookbook ?
[2012-01-05 20:38:00 -0500] fujin: tests!
[2012-01-05 20:39:00 -0500] fujin: It's a wrapper around minitest so you can write tests inside of LWRPs.
[2012-01-05 20:39:00 -0500] hikeit: ah
[2012-01-05 20:39:00 -0500] hikeit: so it is a cookbook for minitest
[2012-01-05 20:39:00 -0500] hikeit: i was looking for the other way around
[2012-01-05 20:39:00 -0500] hikeit: (a test of cookbooks)
[2012-01-05 20:40:00 -0500] KarlHungus: freebsd package provider requires every node to have /usr/ports present and up to date so that it can locate the Makefile for a port to determine information about it before calling out to pkg_* to manage it. since i don't have /usr/ports mounted everywhere, what are my options?
[2012-01-05 20:41:00 -0500] fujin: hikeit: you use minitest to write tests for your cookbooks, or your systems or well anything
[2012-01-05 20:41:00 -0500] fujin: I don't really mind. If you write it, I'll run it
[2012-01-05 20:41:00 -0500] fujin: the examples I show should paint a picture
[2012-01-05 20:41:00 -0500] hikeit: ah. i was more thinking that i want to update a recipe that creates a file from a template
[2012-01-05 20:41:00 -0500] KarlHungus: i can a) mount /usr/ports over NFS on every node (gross), b) "fix" the provider for packages to work on freebsd w/o /usr/ports, or c) extend the provider (is this possible?)
[2012-01-05 20:41:00 -0500] hikeit: i want to test the new output of that template
[2012-01-05 20:42:00 -0500] fujin: KarlHungus: install ports everywhere? :)
[2012-01-05 20:42:00 -0500] fujin: you don't have to use the ports tree either, you can use binary pkgs
[2012-01-05 20:43:00 -0500] KarlHungus: fujin: well, thats not exactly true. you can use packages, but you have to have a ports tree available
[2012-01-05 20:43:00 -0500] c_t: jtimberman: you should do everything in your power to make the O'Reilly Chef book have a hagfish as the animal on its cover
[2012-01-05 20:43:00 -0500] KarlHungus: because the provider calls out to make to determine the latest version, and so on
[2012-01-05 20:44:00 -0500] KarlHungus: *most* of the logic in the provider requiring the ports tree can be replaced with pkg_info and the appropriate flags, but determining the latest available package is still tricky with that approach
[2012-01-05 20:44:00 -0500] jtimberman: c_t: I have no power over that at all :)
[2012-01-05 20:45:00 -0500] c_t: then it's easy to do everything in your power
[2012-01-05 20:45:00 -0500] jtimberman: I see what you did there.
[2012-01-05 20:48:00 -0500] fujin: ah fuck freebsd, keep your damn job security away from me
[2012-01-05 20:48:00 -0500] fujin: whenever i talk to someone about that fucking provider they tell me oh it could work this way and that way and
[2012-01-05 20:48:00 -0500] fujin: jump off a bridge
[2012-01-05 20:48:00 -0500] fujin: afk
[2012-01-05 20:48:00 -0500] fujin: supply patches
[2012-01-05 20:49:00 -0500] KarlHungus: fujin: haha =) ok. i can patch it. freebsd offers several ways to manage packages and that can cause some confusion
[2012-01-05 20:50:00 -0500] fujin: maybe split the providers into a ports version and a non-ports pkg info based one
[2012-01-05 20:50:00 -0500] KarlHungus: bleh. i still need to write the damn init scripts for the chef ports too. i thought i had already done that
[2012-01-05 20:50:00 -0500] fujin: there are init scripts for the chef included in the freshports ports for it i think
[2012-01-05 20:50:00 -0500] KarlHungus: chef-server, i mean
[2012-01-05 20:50:00 -0500] fujin: ah yeah :\
[2012-01-05 20:51:00 -0500] KarlHungus: afaik, there aren't any init scripts in that port... since i wrote it =)
[2012-01-05 20:51:00 -0500] dyer: Anyone know why knife ec2 doesnt seem to work w/ Centos ?
[2012-01-05 20:51:00 -0500] fujin: dyer: logs? stack trace?
[2012-01-05 20:52:00 -0500] dyer: fujin, sure, one moment
[2012-01-05 20:52:00 -0500] fujin: ambiguous "doesn't work" can't help anyone help you
[2012-01-05 20:52:00 -0500] fujin: -VV logs from knife ec2 for debug plz
[2012-01-05 20:52:00 -0500] dyer: of coures, understood. I have brought up my issue before
[2012-01-05 20:52:00 -0500] dyer: ec2-50-19-40-160.compute-1.amazonaws.com bash: line 71: /usr/bin/chef-client: No such file or directory
[2012-01-05 20:52:00 -0500] dyer: one sec, I'll get u a full gist
[2012-01-05 20:53:00 -0500] KarlHungus: ooh. thats another issue. bootstrap should probably support installations where PREFIX is something other than /
[2012-01-05 20:54:00 -0500] KarlHungus: i'll bug that too while im at it
[2012-01-05 20:55:00 -0500] fujin: freebsd really needs to adopt more of a "throw away" style of operations
[2012-01-05 20:55:00 -0500] fujin: all of this alternate prefix, read-only mounted root
[2012-01-05 20:55:00 -0500] fujin: it's all bullshit
[2012-01-05 20:55:00 -0500] fujin: throw that shit out of the window. build it again
[2012-01-05 20:56:00 -0500] KarlHungus: base is in /, local stuff in /usr/local. its all pretty well documents. look at man hier
[2012-01-05 20:56:00 -0500] KarlHungus: documented*
[2012-01-05 20:56:00 -0500] fujin: I know it's well documented, I just think the documentation is bullshit
[2012-01-05 20:56:00 -0500] fujin: the premise
[2012-01-05 20:56:00 -0500] fujin: the whole notion
[2012-01-05 20:56:00 -0500] fujin: what is it more secure?
[2012-01-05 20:56:00 -0500] fujin: more easily managed by neckbeards with root prompts?
[2012-01-05 20:57:00 -0500] KarlHungus: don't tell me /opt is more sane...
[2012-01-05 20:57:00 -0500] dyer: https://gist.github.com/f35bae7d9f999042338c
[2012-01-05 20:57:00 -0500] dyer: fujin ^
[2012-01-05 20:57:00 -0500] fujin: i don't use /opt, but on ubuntu when I ship packages they go to /usr/local.
[2012-01-05 20:57:00 -0500] fujin: I just think the way that you get to that same end goal between freebsd and ubuntu, I know which one I prefer
[2012-01-05 20:58:00 -0500] fujin: it's not the fucking alternate prefix compile a billion things, read only mount shit, use fucking mdadm memory backed devices that automatically allocate devices
[2012-01-05 20:58:00 -0500] fujin: its' all tuned for a neckbeard at a prompt - not a systems automation framework
[2012-01-05 20:58:00 -0500] Damm: KarlHungus, FHS will only make you cry
[2012-01-05 20:58:00 -0500] Brad_K: freebsd and mounting things like the root file system or /usr as read-only is not really any different than some of the security enhancements made by SELinux.  both are different from the "everything is wide open, do whatever you want" philosophy.
[2012-01-05 20:58:00 -0500] Damm: but /opt is good for something... usually java crap
[2012-01-05 20:59:00 -0500] fujin: wow seriously? read only mount points similar to selinux contexts?
[2012-01-05 20:59:00 -0500] KarlHungus: fujin: while i don't agree with that sentiment, i will gladly send in patches to make chef work better on freebsd
[2012-01-05 20:59:00 -0500] dyer: @fujin, did you get the gist?
[2012-01-05 20:59:00 -0500] fujin: redhat neckbeards probably love tuning selinux contexts by hand as well
[2012-01-05 20:59:00 -0500] fujin: dyer: yeh looking
[2012-01-05 20:59:00 -0500] dyer: great, just wanted to maeks rue
[2012-01-05 20:59:00 -0500] dyer: sure
[2012-01-05 20:59:00 -0500] atomic-penguin: screw selinux
[2012-01-05 20:59:00 -0500] Brad_K: at a conceptual level, they are not that fundamentally different.  both are security enhancements.
[2012-01-05 21:00:00 -0500] Damm: fujin, redhat doesn't have a lot of neckbeards... only the pythonistas
[2012-01-05 21:00:00 -0500] Damm: fwiw
[2012-01-05 21:00:00 -0500] fujin: Brad_K:  i definitely disagree with that statement
[2012-01-05 21:00:00 -0500] fujin: one is a simple posix mechanism for preventing writes
[2012-01-05 21:00:00 -0500] Brad_K: and speaking as a long-term freebsd fan and a guy with a beard, i am rather offended by some of your remarks.
[2012-01-05 21:00:00 -0500] KarlHungus: i mean... i think its really handy to keep a pristine system and update/manage node specific packages independently
[2012-01-05 21:00:00 -0500] yfeldblum: mhmm ... if one person at one keyboard can mega-security-enhance ten servers out of a thousand, versus merely harden one-thousand servers out of a thousand, guess which version wins the security game
[2012-01-05 21:01:00 -0500] Brad_K: disagreeing with me is one thing.  but being intentionally offensive about it is something else altogether.
[2012-01-05 21:01:00 -0500] fujin: i have a neckbeard. i run freebsd
[2012-01-05 21:01:00 -0500] fujin: i am not offended
[2012-01-05 21:01:00 -0500] yfeldblum: things need to have simple, automatable configurations or APIs
[2012-01-05 21:01:00 -0500] fujin: if you think that the practices developed in freebsd are suitable for configuration management frameworks
[2012-01-05 21:01:00 -0500] fujin: you are definitely wrong
[2012-01-05 21:01:00 -0500] fujin: they are not API b ased
[2012-01-05 21:01:00 -0500] fujin: they are a fucking nightmare
[2012-01-05 21:01:00 -0500] jtimberman: this bikeshed shall be green, and it shall live in /opt
[2012-01-05 21:01:00 -0500] jtimberman: wait, purple.
[2012-01-05 21:02:00 -0500] fujin: ALL OF THE BIKE SHEDS
[2012-01-05 21:02:00 -0500] KarlHungus: red!
[2012-01-05 21:02:00 -0500] Damm: dyer, try /usr/local/bin/chef-client
[2012-01-05 21:02:00 -0500] Damm: dyer, rubygems is using /usr/local/bin to write it's bin-stubs now if i recall
[2012-01-05 21:02:00 -0500] fujin: dyer: looks like you are using the 'ubuntu10.04' bootstrap template on a Redhat node
[2012-01-05 21:02:00 -0500] fujin: dyer: which is partially working, but as you can see, you don't have 'apt-get', etc.. you probably want ot use a Redhat bootstrap template not an Ubuntu one.
[2012-01-05 21:02:00 -0500] dyer: I am actually not specify one or the other, perhaps the ubuntu is the default
[2012-01-05 21:02:00 -0500] fujin: it is the default, yes
[2012-01-05 21:02:00 -0500] atomic-penguin: Thats exactly what /opt is for expensive, and often broken, third-party bikesheds like enterprise backup agents
[2012-01-05 21:02:00 -0500] dyer: k, not sure how to specify rhel
[2012-01-05 21:03:00 -0500] Damm: atomic-penguin, or nasty java shit
[2012-01-05 21:03:00 -0500] fujin: knife ec2 server create --help
[2012-01-05 21:03:00 -0500] fujin: I think it's --template or --bootstrap-template
[2012-01-05 21:03:00 -0500] fujin: or --distro will select the template or some shit
[2012-01-05 21:03:00 -0500] fujin: sec
[2012-01-05 21:03:00 -0500] Mithrandir: jtimberman: spotted, please.
[2012-01-05 21:03:00 -0500] yfeldblum: i use --distro
[2012-01-05 21:03:00 -0500] Damm: atomic-penguin, most distros drop it in /opt to keep oracle happy
[2012-01-05 21:03:00 -0500] fujin: dyer: there's a https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap/centos5-gems.erb
[2012-01-05 21:03:00 -0500] fujin: centos5-gems bootstrap, might work
[2012-01-05 21:04:00 -0500] atomic-penguin: drop it like its opt
[2012-01-05 21:05:00 -0500] hikeit: jtimberman: you're listed as one of the devs of the sudoers cookbook any specific reason you had passwordless set as a global instead of a per-user option? (i.e. have each user and each group be a has instead of a string)
[2012-01-05 21:05:00 -0500] hikeit: s/has/hash/
[2012-01-05 21:05:00 -0500] KarlHungus: oracle deserves to be unhappy, imho
[2012-01-05 21:06:00 -0500] atomic-penguin: KarlHungus, I assure you that the world is not fair, and it doesn't matter how happy Oracle or their customers are.  Larry's yacht is still worth more than everyone's combined salary in this room.
[2012-01-05 21:10:00 -0500] yfeldblum: hikeit, i'm not jtimberman, but i can only assume it's for simplicity; keep in mind that it is expected that the opscode community cookbooks are supposed to work for many people but definitely not all, and it is expected that you will either customize some of those cookbooks to your environment or write your own cookbooks from scratch
[2012-01-05 21:11:00 -0500] dyer: fujin, same thing
[2012-01-05 21:11:00 -0500] dyer: https://gist.github.com/898819388822c043931d
[2012-01-05 21:11:00 -0500] hikeit: on updating them, can we contribute back?
[2012-01-05 21:11:00 -0500] atomic-penguin: contributing?
[2012-01-05 21:11:00 -0500] bawt: contributing is http://wiki.opscode.com/display/chef/How+to+Contribute
[2012-01-05 21:11:00 -0500] hikeit: i.e. if get them to incorporate our changes into the mainline?
[2012-01-05 21:11:00 -0500] hikeit: ah
[2012-01-05 21:11:00 -0500] fujin: dyer: looks like for whatever reason, gems are going to /usr/local and that template expects to find binaries at /usr/bin
[2012-01-05 21:11:00 -0500] fujin: not sure what would cause that
[2012-01-05 21:12:00 -0500] yfeldblum: atomic-penguin, quite curiously, there is often among the non-technical management type an extremely high demand for a false sense of security; oracle is supreme at delivering supply to meet that demand
[2012-01-05 21:13:00 -0500] dyer: yea no idea, frustrating sometimes to ahve to use Centos w/ chef, always an uphill battle
[2012-01-05 21:13:00 -0500] dyer: ;(
[2012-01-05 21:13:00 -0500] atomic-penguin: yfeldblum, at a premium, yes
[2012-01-05 21:14:00 -0500] yfeldblum: atomic-penguin, curiously again, people are often willing to pay an extremely high premium for a false sense of security
[2012-01-05 21:14:00 -0500] atomic-penguin: yfeldblum, sure I'm not disagreeing
[2012-01-05 21:16:00 -0500] fujin: dyer:  just modify the template in your repository
[2012-01-05 21:16:00 -0500] yfeldblum: atomic-penguin, didn't say you are ... i just find that to be, at the same time, both amusing and depressing
[2012-01-05 21:16:00 -0500] fujin: put it in .chef/bootstrap/centos5-custom.erb
[2012-01-05 21:17:00 -0500] dyer: fujin, yes, but I point is that I shouldnt have to do this
[2012-01-05 21:17:00 -0500] dyer: it should really work for centos :)
[2012-01-05 21:17:00 -0500] fujin: want me to do your job for you too?
[2012-01-05 21:17:00 -0500] fujin: it probably does work for centos5.
[2012-01-05 21:17:00 -0500] dyer: this is centos 5
[2012-01-05 21:17:00 -0500] fujin: I have a client right now with centos and chef running everywhere and I'm sure we are using the stock bootstrap templates
[2012-01-05 21:17:00 -0500] fujin: could be mistaken
[2012-01-05 21:18:00 -0500] fujin: if no one fixes it and sub mits it, if everyone went around going "I shouldn't have to do this" nothing would ever get fucking fixed
[2012-01-05 21:18:00 -0500] yfeldblum: atomic-penguin, i wish i knew how we (technical folks) can turn that around
[2012-01-05 21:18:00 -0500] Brad_K: dyer: one of the reasons we switched to using the Full Stack Installer is so that we didn't have to fight battles over where gem puts things.  The embedded version of gem puts them wherever it wants them, and we don't have to worry about it.
[2012-01-05 21:18:00 -0500] fujin: yeh, try the chef-full bootstrap
[2012-01-05 21:18:00 -0500] fujin: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/bootstrap/chef-full.erb
[2012-01-05 21:19:00 -0500] yfeldblum: yes, chef-solo and client-client really *should* be isolated from the rest of the system, and chef-full is an easy way to do that
[2012-01-05 21:19:00 -0500] dyer: ok, ty, I am trying this now
[2012-01-05 21:37:00 -0500] johnmwilliams_: Is there a way to get the git :sync resource to work even if the directory is not empty?
[2012-01-05 21:41:00 -0500] mostlygeek: anybody familiar with the php package manager ? i'm using it to install APC and it answers are few questions wrong, ie: installs APC w/ debugging turn ON
[2012-01-05 21:41:00 -0500] mostlygeek: how do i set it so that it disables APC's internal debugging?
[2012-01-05 21:48:00 -0500] mostlygeek: when i'm installing a pecl package (or anything from source) it asks me for input, is there a way to script this, so I can answer no to the first question?
[2012-01-05 21:50:00 -0500] bkmontgomery: Can anyone using the knife-linode help with something?  I can create a server, but my role is not getting inserted into the node's run_list.  Here's the command I'm using:  knife linode server create -N nodename -L nodename -r "role[ubuntu]"
[2012-01-05 21:51:00 -0500] bkmontgomery: My ubuntu role references the apt, users, and sudo recipes from the community site, and I've got data bags for user data.  Thanks in advance.
[2012-01-05 22:03:00 -0500] zambaboo: hey guys i am wondering if i can create a file from several templates. is this possible using out of the box chef?
[2012-01-05 22:05:00 -0500] yfeldblum: zambaboo, what's the scenario/use-case?
[2012-01-05 22:05:00 -0500] zambaboo: yfeldblum, i have a config file and in certain cases i want it to contain more host specific entries.
[2012-01-05 22:06:00 -0500] zambaboo: i suppose i could save the templated strings to node data and then grab them from there.
[2012-01-05 22:06:00 -0500] zambaboo: but it feels wrong
[2012-01-05 22:06:00 -0500] toddnine: Hey guys.  I'm having an issue with a LWRP where it's not properly picking up a string on the second run.
[2012-01-05 22:07:00 -0500] toddnine: Check out line 258 and 252.  the resource at 258 executes the resource at line 252 https://gist.github.com/1bab4130b066d3809ee4
[2012-01-05 22:07:00 -0500] toddnine: The first time this is invoked, the "raid_dev" variable = md0, the second time, it equals md1
[2012-01-05 22:09:00 -0500] yfeldblum: zambaboo, i would go with that approach; some configurable programs support .d directories for multiple configuration files, so in such cases it would be easier, but i guess not in this case
[2012-01-05 22:09:00 -0500] toddnine: however when a ebs volume is created (on md1) the execute at 252 attempts to create the device on "/dev/md0" instead of "/dev/md1"  I'm pretty sure this is a resource compilation issue, and it's getting set on the first pass, then not re-evaluated when invoked the second time.  Any ideas how to get around this?
[2012-01-05 22:11:00 -0500] zambaboo: yfeldblum, correct, this is not the case. i guess i could build that support in using chef.. something like populating a .d directory with relevant conf files and then catting them to a single file. still feels iffy.
[2012-01-05 22:11:00 -0500] zambaboo: toddnine, where does that raid_dev business come from?
[2012-01-05 22:12:00 -0500] toddnine: It's passed into the method that wraps the resources
[2012-01-05 22:12:00 -0500] yfeldblum: zambaboo, no that's not recommended, because, unless you're really clever, the final config file will be re-generated each time, and if you've got services that restart based on the config file changing, the services will restart on each chef-client run
[2012-01-05 22:12:00 -0500] toddnine: zambaboo:  That's determined automatically, the lwrp looks for the first available point to create the raid device on
[2012-01-05 22:13:00 -0500] zambaboo: toddnine, i bet thats where things go awry, at that automatic bit
[2012-01-05 22:13:00 -0500] toddnine: Nah, it's passed correctly
[2012-01-05 22:13:00 -0500] toddnine:  execute[creating raid device] sh(mdadm --create /dev/md1 --level=0 --raid-devices=10 /dev/sdj1 /dev/sdj10 /dev/sdj2 /dev/sdj3 /dev/sdj4 /dev/sdj5 /dev/sdj6 /dev/sdj7 /dev/sdj8 /dev/sdj9 )
[2012-01-05 22:13:00 -0500] toddnine: The raid device is there on /dev/md1
[2012-01-05 22:14:00 -0500] zambaboo: yfeldblum, in this case it would work, the config file is not read by a daemon
[2012-01-05 22:14:00 -0500] zambaboo: but it still feels wrong
[2012-01-05 22:14:00 -0500] toddnine: It's as if the string command in the format-new-xfs-device execute is only evaluated on the first execution, then it's not evaluated again after that.
[2012-01-05 22:15:00 -0500] zambaboo: it sounds like when you run it the second time it does not find an available device
[2012-01-05 22:15:00 -0500] toddnine: If I run the recipe again it works, simply because the first mount point is configured, and it only needs to format the 2nd one.  So I think it's definitely an issue with getting compiled then it's stuck with the string that was compiled with
[2012-01-05 22:15:00 -0500] zambaboo: i guess im not understanding this well enough, sorry
[2012-01-05 22:15:00 -0500] toddnine: I'm pretty sure it's an issue with resource compilation, I've run into this before
[2012-01-05 22:15:00 -0500] toddnine: LWRPs are quite a clean as recipes yet
[2012-01-05 22:16:00 -0500] zambaboo: toddnine, does raid_device come from the OS or from the node data?
[2012-01-05 22:16:00 -0500] toddnine: both.  If  mapping exists, it just re-attaches it
[2012-01-05 22:16:00 -0500] zambaboo: i would look there
[2012-01-05 22:17:00 -0500] toddnine: if not, it searches for the first available mount point, then uses that mount point
[2012-01-05 22:17:00 -0500] zambaboo: id definitely look at that 'if not' part
[2012-01-05 22:17:00 -0500] toddnine: Do you know how to use temporary node attributes?  I can't seem to find the doc for it on the wiki.  I've used them before to get around compilation issues like this
[2012-01-05 22:17:00 -0500] yfeldblum: if the recipe has two resources of the same type and with the same name, that can be a problem
[2012-01-05 22:18:00 -0500] zambaboo: toddnine, something like this? http://wiki.opscode.com/pages/viewpage.action?pageId=15728818
[2012-01-05 22:18:00 -0500] zambaboo: not exactly your use case
[2012-01-05 22:19:00 -0500] zambaboo: but, 1. set a node. 2. test for presence...
[2012-01-05 22:19:00 -0500] zambaboo: node attribute that is
[2012-01-05 22:21:00 -0500] toddnine: Yeah, already do that, was more aiming for setting the device path to format in a transient node property, however I think I can just change my command to do the "mdadm --create.. && mkfs.xfs ..." in one command
[2012-01-05 22:22:00 -0500] toddnine: it's what I need, just not sure if execute will do it
[2012-01-05 22:26:00 -0500] fujin: toddnine: doing a two phase run like that is asking for trouble, why not just do it all at once?
[2012-01-05 22:26:00 -0500] fujin: that looks so gnarly
[2012-01-05 22:27:00 -0500] fujin: YOU CRAZY JESUS
[2012-01-05 22:27:00 -0500] fujin: https://gist.github.com/961067
[2012-01-05 22:29:00 -0500] toddnine: fujin: Yeah, I've looked at other options.  None of them implement re-attachment
[2012-01-05 22:29:00 -0500] fujin: ??
[2012-01-05 22:29:00 -0500] fujin: you just grab the node data from the other node and chuck it on the new node
[2012-01-05 22:29:00 -0500] fujin: never bothered automating it
[2012-01-05 22:29:00 -0500] toddnine: We don't actually replace the nodes
[2012-01-05 22:29:00 -0500] fujin: I don't even have a client using that currently :\
[2012-01-05 22:29:00 -0500] toddnine: We just shutdown the instance that is the node, then re-boostrap a new instance to replace it
[2012-01-05 22:29:00 -0500] fujin: you move the data around?
[2012-01-05 22:30:00 -0500] toddnine: nah, don't need to
[2012-01-05 22:30:00 -0500] fujin: that is replacing the node dude =P
[2012-01-05 22:30:00 -0500] toddnine: instance A = test-cass-east-1.  shutdown instance A.  instance B becomes test-cass-east-1
[2012-01-05 22:30:00 -0500] fujin: oh ok
[2012-01-05 22:30:00 -0500] toddnine: just re-key the client and use the new key when boostrapping
[2012-01-05 22:32:00 -0500] zambaboo: careful with that thing
[2012-01-05 22:34:00 -0500] fujin: i'd probably just modify the aws_ebs_volume lwrp to store it in a databag
[2012-01-05 22:34:00 -0500] fujin: instead of a node
[2012-01-05 22:34:00 -0500] fujin: easy money
[2012-01-05 22:36:00 -0500] fujin: SHANANANANANANANNANANANAN
[2012-01-05 22:36:00 -0500] fujin: THIS A GUN MAN CREW
[2012-01-05 22:36:00 -0500] fujin: FIRE BURN DEM
[2012-01-05 22:36:00 -0500] toddnine: fujin.  we did that initially, but I found it was actually harder to keep our data clean and organized with environments etc.  It ended up being easier to keep it on the node.
[2012-01-05 22:36:00 -0500] fujin: word
[2012-01-05 22:37:00 -0500] fujin: starts getting pretty complicated
[2012-01-05 22:42:00 -0500] tierra: when using the opscode cookbooks (vendor installed), say you have multiple sites running on (mostly) the same application code... it seems like the application cookbook lets you just create one entry per site in the "apps" databag... however, it also seems to be looking for a cookbook with the same name as the entry in the databag... I have one cookbook for this specific application code with db/config file templates.
[2012-01-05 22:43:00 -0500] jtimberman: tierra: yeah, the pattern is this
[2012-01-05 22:43:00 -0500] jtimberman: tierra: you make an apps data bag entry for the application
[2012-01-05 22:43:00 -0500] jtimberman: tierra: the application cookbook handles: getting the code on the box via some kind of deployment (depending on the app type), and then running it under some web service.
[2012-01-05 22:44:00 -0500] jtimberman: tierra: for example, rails apps deploy all very similar, based on a pattern set forth by capistrano, and then get hosted under a Rack application server (we use Unicorn by default with our rails stacks in that cookbook)
[2012-01-05 22:44:00 -0500] jtimberman: tierra: but that is not necessarily enough for every application.
[2012-01-05 22:45:00 -0500] jtimberman: it doesn't account for things like "oh we need to deploy a spelling library, or connectivity to other backend services"
[2012-01-05 22:45:00 -0500] jtimberman: so thats when a cookbook named for the application comes in, with additional application specific configuration in its recipe(s)
[2012-01-05 22:45:00 -0500] jtimberman: make sense?
[2012-01-05 22:46:00 -0500] tierra: yeah, I understand the need for at least the one application-specific cookbook for stuff like that... for me, I'm working with CakePHP-based app, and you're talking about for stuff like the PECL APC module in my case
[2012-01-05 22:47:00 -0500] tierra: I guess I'm still confused on how I configure multiple sites on the same application
[2012-01-05 22:47:00 -0500] tierra: (to be run on the same web servers)
[2012-01-05 22:48:00 -0500] ckm: Is there a way to make chef-client on windows running as window service?
[2012-01-05 22:49:00 -0500] ckm: as far as I know chef-client -d won't work under windows
[2012-01-05 22:49:00 -0500] ckm: any wrapper solution on this?
[2012-01-05 22:51:00 -0500] fujin: doesn't the windows cookbook do some of that shit?
[2012-01-05 22:51:00 -0500] fujin: or the windows installer? i dunno
[2012-01-05 22:51:00 -0500] fujin: <3 windows
[2012-01-05 22:52:00 -0500] ckm: well, I use winrm to bootstrap window client, that does seems to work in that way
[2012-01-05 22:52:00 -0500] yfeldblum: jtimberman, theoretically, i'm a fan of http://www.12factor.net/
[2012-01-05 22:55:00 -0500] tierra: let me explain what I've done, and maybe someone can point out where I went wrong.... I have one cookbook ("my_app"), and two "app" databag items ("site1" and "site2")... in "site1" databag for example, I have "server_roles" : ["my_app"], and "type": {"my_app": [ "php", ... ]} ... each site databag obviously also secifies it's own git revision (I manage each site currently in it's own git branch just for it's theme files mostly), and it's own ...
[2012-01-05 22:55:00 -0500] tierra: ... database/user/pass and it's own "deploy_to" location...
[2012-01-05 22:57:00 -0500] tierra: so, either how I'm doing this is wrong, or do I really just need to create one completely blank and useless cookbook for each site (which I haven't attempted yet)?
[2012-01-05 22:58:00 -0500] tolland: how do i retrieve an ohai value in a recipe? (rather than the node value which might have been over ridden...?)
[2012-01-05 23:01:00 -0500] jbz: tolland:  You can't override ohai values, they're of precedence 'automatic'
[2012-01-05 23:01:00 -0500] jbz: so the node[:value], if it's populated by ohai, should still be the ohai value.
[2012-01-05 23:07:00 -0500] zambaboo: ssssoooo, any other thoughts on files generated from several templates?
[2012-01-05 23:11:00 -0500] zambaboo: you,
[2012-01-05 23:26:00 -0500] toddnine: hey guys.  I'm testing some knife plugins and having a bit of an issue.  Is there anything wrong with this from Ruby thread perspective?  Occasionally my code just hangs on the thread.join, other times it works fine.
[2012-01-05 23:26:00 -0500] toddnine: https://gist.github.com/c949413d748dac3dd5c6
[2012-01-05 23:26:00 -0500] toddnine: It's to boostrap nodes in parallel, otherwise this would take forever.
[2012-01-05 23:28:00 -0500] yfeldblum: toddnine, it looks fine (if a bit verbose for ruby - sorry, had to throw that in there) ... but it all depends on how Spidertracks::StReplaceNode works
[2012-01-05 23:29:00 -0500] toddnine: yfeldblum: Pretty simple, it's just a wrapper around the ec2 bootstrap
[2012-01-05 23:29:00 -0500] toddnine: it just re-keys the client, then uses the key it downloaded for the knife ec2 boostrap
[2012-01-05 23:30:00 -0500] bakins: I have an LWRP that when I try to pass ignore_failure true to it, I get -- undefined method `ignore_errors'. ideas?
[2012-01-05 23:30:00 -0500] toddnine: It's almost as if the boostrap itself hangs on exist.  The nodes boostrap and initialize perfectly.  It just randomly won't return from the boostrap.
[2012-01-05 23:34:00 -0500] bakins: grrr... git not matching uplaoded cookbook.. sigh...
[2012-01-05 23:38:00 -0500] yfeldblum: toddnine, all i can tell you is that the gist looks fine, so it must be whatever it's calling
[2012-01-05 23:39:00 -0500] toddnine: Yeah, investigating it now.  The StReplaceNode uses a static global temp dir to download the keys to "@@temp_dir" as a singlton, I wonder if that's causing issues when used in threads
[2012-01-05 23:39:00 -0500] yfeldblum: yeah that is a problem, fix it
[2012-01-05 23:40:00 -0500] yfeldblum: globals can kill your multithreading
[2012-01-05 23:42:00 -0500] flaccid: changing timezone basically needs to restart some services, the main one being cron. wondering what the best way to do this is without depending on cron ?
