[2012-01-24 08:11:00 -0500] rweng: BryanWB: With Chef::log i get "NoMethodError: undefined method `log' for Chef:Class"
[2012-01-24 08:23:00 -0500] BryanWB: rweng is that a shell script?
[2012-01-24 08:23:00 -0500] rweng: BryanWB: nope, its a chef recipe called default.rb
[2012-01-24 08:23:00 -0500] BryanWB: sleep ? i don't know if that is in the ruby stdlib
[2012-01-24 08:24:00 -0500] rweng: BryanWB: I tried it before without sleep, just inserted it because I thought maybe the logging is done asynchronously somehow and when I exit right after logging the log message is log
[2012-01-24 08:25:00 -0500] rweng: But nevermind, I dont really need logging for this use case. hope when I get back to it later it will work ;)
[2012-01-24 09:14:00 -0500] bdha: Damm_: I dropped RRD years ago. I use Circonus.
[2012-01-24 10:05:00 -0500] BryanWB: is there any way to access the node object from w/in a role?
[2012-01-24 10:10:00 -0500] ranjibd: BryanWB, i dont think so
[2012-01-24 10:10:00 -0500] BryanWB: looks like it
[2012-01-24 10:10:00 -0500] ranjibd: what you want? you can use chef api to create a role on  the fly and translate  all customization in terms of attributes and run list
[2012-01-24 10:11:00 -0500] BryanWB: i want to put the node's fqdn in an attribute set by the role
[2012-01-24 10:11:00 -0500] ranjibd: the process of creating role can be automated, but at the end u need to manifest it as run list and attributes,,,
[2012-01-24 10:11:00 -0500] ranjibd: i think node's fqdn  is an automatic attribute (from ohai)
[2012-01-24 10:12:00 -0500] ranjibd: u can drop a custom ohai plaugin using a chef recipe, which will override that
[2012-01-24 10:13:00 -0500] ranjibd: BryanWB, how is foodfightshow coming up? when's the next podcast ?
[2012-01-24 10:26:00 -0500] BryanWB: recording on wednesday, talking w/ crowbar gusy
[2012-01-24 10:37:00 -0500] ranjibd: awesome
[2012-01-24 10:38:00 -0500] BryanWB: ranjibd: pls send Qs and items for news section
[2012-01-24 11:38:00 -0500] yfeldblum: BryanWB, roles are static JSON documents, not code, so far as the chef-server and all chef-clients are concerned
[2012-01-24 11:40:00 -0500] yfeldblum: i think of roles as "fixed data"
[2012-01-24 11:50:00 -0500] BryanWB: yfeldblum: good morning!
[2012-01-24 11:50:00 -0500] BryanWB: tks for clarifying
[2012-01-24 11:51:00 -0500] yfeldblum: morning, BryanWB
[2012-01-24 12:00:00 -0500] yfeldblum: so `debootstrap` takes forever
[2012-01-24 12:00:00 -0500] yfeldblum: anybody know of any work going on to make all commands on linux systems complete instantaneously?
[2012-01-24 12:01:00 -0500] iroller: I like Chef 0.10.10 progress :) 27 of 31 issues have been resolved -> 28 of 32 -> 29 of 33 -> 30 of 34...
[2012-01-24 12:02:00 -0500] yfeldblum: i hear releases can always be completed simply by marking all existing issues for the release after next
[2012-01-24 12:37:00 -0500] erikh: heh
[2012-01-24 13:13:00 -0500] `brendan: morning folks
[2012-01-24 13:33:00 -0500] rrichardsr3: morning. stupid question. If i use knife ec2 to create a server with a specific role, what is the best way to 're-run' that role on the same server if i make updates?
[2012-01-24 13:34:00 -0500] rrichardsr3: just hop on the server and run chef-client?
[2012-01-24 13:34:00 -0500] rrichardsr3: (using opscode hosted platform btw)
[2012-01-24 13:35:00 -0500] BryanWB: rrichardsr3:    knife ssh "name:myserver*" chef-client -x your_username -i .chef/some_private_key
[2012-01-24 13:36:00 -0500] rrichardsr3: BryanWB: awesome! thank you
[2012-01-24 13:36:00 -0500] BryanWB: or better  knife ssh "role:foo" chef-client
[2012-01-24 13:36:00 -0500] rrichardsr3: ive seen at times when i run chef-client on the server it unloads all the cookbooks for some reason
[2012-01-24 13:37:00 -0500] rrichardsr3: its like the server hasn't mapped the cookbooks to that server even though i bootstrapped it with the role
[2012-01-24 13:37:00 -0500] BryanWB: if its run_list is empty, it will unload them iirc
[2012-01-24 13:37:00 -0500] BryanWB: the run_list on hosted chef must be empty
[2012-01-24 13:37:00 -0500] rrichardsr3: oh so its using first_boot ?
[2012-01-24 13:37:00 -0500] rrichardsr3: err first_run maybe
[2012-01-24 13:37:00 -0500] BryanWB: yes
[2012-01-24 13:37:00 -0500] BryanWB: sounds like it
[2012-01-24 13:38:00 -0500] rrichardsr3: can you bootstrap without it using first_run?
[2012-01-24 13:38:00 -0500] rrichardsr3: so it never unloads on a chef-client execution? otherwise ive been going into the web dashboard and manually applying the run list again
[2012-01-24 13:39:00 -0500] BryanWB: u need to do knife node edit node_name    # add items to run_list
[2012-01-24 13:40:00 -0500] BryanWB: there isn't an elegant solution for this yet afaik
[2012-01-24 13:40:00 -0500] rrichardsr3: BryanWB: thanks - you are a life saver
[2012-01-24 13:46:00 -0500] lflux_: ohai
[2012-01-24 13:50:00 -0500] brett_h: shef is complaining about an unknown fqdn... but where do I tell chef what it should be?
[2012-01-24 13:52:00 -0500] BryanWB: brett_h: i don't know, but i know it is a common issue, esp. on ec2
[2012-01-24 13:52:00 -0500] brett_h: yeah, I'm on EC2
[2012-01-24 13:52:00 -0500] brett_h: pita
[2012-01-24 13:52:00 -0500] BryanWB: a quick check of the ML may help or just google
[2012-01-24 13:52:00 -0500] BryanWB: i don't know of top my head
[2012-01-24 13:52:00 -0500] brett_h: the FAQ explains why I need one but not how to set it
[2012-01-24 13:52:00 -0500] brett_h: I've googled a bunch :(
[2012-01-24 13:52:00 -0500] brett_h: oh well
[2012-01-24 13:52:00 -0500] BryanWB: hang out, someone  should be able to help shortly
[2012-01-24 13:52:00 -0500] brett_h: anyone happen to know how to get the current environment inside a recipe?
[2012-01-24 13:53:00 -0500] brett_h: node[:environment]? this is what I wanted shef for
[2012-01-24 13:53:00 -0500] brett_h: so I could tinker at the repl :(
[2012-01-24 13:54:00 -0500] BryanWB: node.name works for me
[2012-01-24 13:54:00 -0500] brett_h: name?
[2012-01-24 13:54:00 -0500] bawt: name is not an attribute of the node, its a method on the node object that returns the id of the node
[2012-01-24 13:55:00 -0500] brett_h: I want to get he env
[2012-01-24 13:55:00 -0500] BryanWB: ENV might do it
[2012-01-24 13:56:00 -0500] brett_h: sorry, not the process/ruby ENV :P
[2012-01-24 13:56:00 -0500] brett_h: the chef environment
[2012-01-24 13:56:00 -0500] brett_h: like "production"
[2012-01-24 13:56:00 -0500] BryanWB: chef_environment
[2012-01-24 13:56:00 -0500] brett_h: just alone?
[2012-01-24 13:56:00 -0500] brett_h: or node.chef_environment ?
[2012-01-24 13:56:00 -0500] BryanWB: node["chef_environment"]
[2012-01-24 13:56:00 -0500] brett_h: thanks
[2012-01-24 13:58:00 -0500] brett_h: no dice, hm
[2012-01-24 14:00:00 -0500] brett_h: ah, has to be used as method like bawt said
[2012-01-24 14:54:00 -0500] lusis: yeah it's a bit confusing
[2012-01-24 15:07:00 -0500] jberanek: Random question if folks are around and watching, any recommendations on how to handle deployment of files to an Apache server if you need to mix together files from an infrastructure product with custom development?
[2012-01-24 15:13:00 -0500] lusis: jberanek: the eternal question ;)
[2012-01-24 15:14:00 -0500] lusis: how mixed together are they? Same directory?
[2012-01-24 15:16:00 -0500] jberanek: lusis: The custom files were placed in various directories created for the infrastructure product (in this case Oracle Web Center Interaction, formerly Aqualogic User Interaction, formerly Plumtree Portal)
[2012-01-24 15:17:00 -0500] moos3: is there a way to test a cookbook with out uploading to a server
[2012-01-24 15:18:00 -0500] jberanek: Currently, the infrastructure files are installed via an application installer, while the custom are installed via deployment scripts. I'm running an experiment at my work to introduce Configuration Management tools, so I'm looking for a better way :)
[2012-01-24 15:18:00 -0500] lusis: jberanek: hmmm
[2012-01-24 15:18:00 -0500] veghead:  Any suggestions on the best strategy for moving my chef install from one EC2 instance to another and upgrading from 0.9.14 to 0.10.x in the process?
[2012-01-24 15:19:00 -0500] lusis: jberanek: without knowing how the product lays things out, it's a bit hard to say
[2012-01-24 15:21:00 -0500] lusis: jberanek: if you can get clever with apache configs and give each responsibility its own directory to manage, that works well
[2012-01-24 15:23:00 -0500] jberanek: lusis: I'll have to look if that will be possible. I've also debated on just doing a pre-CM tool step to combine all of the files into a git repository (or similar), then deploying that. (This is of course a pre-cursor to killing the evil infrastructure product until it is dead :) )
[2012-01-24 15:23:00 -0500] lusis: jberanek: heh
[2012-01-24 15:23:00 -0500] lusis: jberanek: yeah sometimes you have to get clever
[2012-01-24 15:23:00 -0500] lusis: jberanek: but if you can find a good place to break the collusion, it will help
[2012-01-24 15:24:00 -0500] lusis: jberanek: the same problem exists in various OS packages to
[2012-01-24 15:24:00 -0500] lusis: it's why I like things like the "foo.d" approach
[2012-01-24 15:25:00 -0500] lusis: where you can just dump overrides and custom stuff to be included
[2012-01-24 15:25:00 -0500] lusis: but in your case that's probably not an option
[2012-01-24 15:25:00 -0500] jberanek: I'll try, the problem is they are colluding the files together so they can use some of the built in portal functionality to resolve the files URL at runtime. They can write a portlet with a statement like "<pt:imagefile url="foo.html">" and the portal knows how to make the url relative to the image server
[2012-01-24 15:25:00 -0500] JasonBox: Actually, it's time for brekfast!
[2012-01-24 15:25:00 -0500] jberanek: +1 for the foo.d directory
[2012-01-24 15:25:00 -0500] jberanek: I enjoy those as well.
[2012-01-24 15:26:00 -0500] JasonBox: Or fo co-managed templates there's the sudo example
[2012-01-24 15:28:00 -0500] jberanek: In truth, this is just another reason I want to get rid of that product, also has the wrong UI model for the product we are producing, creates overhead as it has to proxy and process all of the pages content to do huge find and replace, and from the ops side it has nearly no, non-GUI driven configuration (i.e., no APIs to set it up)
[2012-01-24 15:30:00 -0500] jberanek: lusis: thanks for the help
[2012-01-24 15:30:00 -0500] lusis: jberanek: np. Sorry I couldn't help more. I feel your pain.
[2012-01-24 15:30:00 -0500] lusis: best advise I can give is try and find a place to create just enough gap
[2012-01-24 15:30:00 -0500] lusis: that you can split things up
[2012-01-24 15:31:00 -0500] lusis: if you see saschabates online talk to her as well
[2012-01-24 15:31:00 -0500] lusis: she's got shedloads of experience with more enterprisey stuff
[2012-01-24 15:31:00 -0500] lusis: I've been lucky to avoid it the last 5 years or so
[2012-01-24 15:31:00 -0500] lusis: if not longer
[2012-01-24 15:31:00 -0500] jberanek: Will do, thanks.
[2012-01-24 15:32:00 -0500] jberanek: Yeah, I wish I could avoid the enterprisy stuff as well, but such is the life I lead. We'll see how far I get with my CM experiment, hoping to bring at least a little sanity (and show that we can manage things without just buying whatever Oracle sells us :) )
[2012-01-24 15:32:00 -0500] lusis: every little bit helps
[2012-01-24 15:32:00 -0500] lusis: seriously
[2012-01-24 15:32:00 -0500] lusis: even if it just frees you up to investigate alternatives ;)
[2012-01-24 15:33:00 -0500] jberanek: Exactly.
[2012-01-24 15:34:00 -0500] jberanek: Alright, now that my son is waking up, time to head away. Thanks again.
[2012-01-24 15:34:00 -0500] lusis: later!
[2012-01-24 15:43:00 -0500] JasonBox: heh, enterprisey stuff; which is just code for badly written stuff cobbled together and selected only because of backroom dealing
[2012-01-24 16:22:00 -0500] atomic-penguin: We've got enterprisey stuff out the wazoo.
[2012-01-24 16:24:00 -0500] yfeldblum: chef is enterprisey stuff
[2012-01-24 16:25:00 -0500] yfeldblum: of the future
[2012-01-24 16:25:00 -0500] atomic-penguin: yfeldblum, we're using enterprisey as a derogatory term here
[2012-01-24 16:26:00 -0500] mattray: what's the term for "enterprise stuff that is good"?
[2012-01-24 16:27:00 -0500] sriley: there isnt one
[2012-01-24 16:28:00 -0500] atomic-penguin: mattray, according to yfeldblum, chef ;)
[2012-01-24 16:29:00 -0500] lflux: mattray: I'm convinced there is no such thing
[2012-01-24 16:30:00 -0500] mattray: marketing will be so disappointed ;)
[2012-01-24 16:38:00 -0500] atomic-penguin: http://thedailywtf.com/Articles/Enterprise_SQL.aspx
[2012-01-24 16:40:00 -0500] atomic-penguin: You need a decoder ring to decipher table names in our ERP app
[2012-01-24 16:43:00 -0500] mostlygeek: Hi, i have a service block that never seems to reload Nginx, can anybody tell me what's wrong with it? http://pastebin.com/FZ1XBDxF
[2012-01-24 16:43:00 -0500] __chrisf__: @mostlygeek, reload or restart?
[2012-01-24 16:44:00 -0500] mostlygeek: __chrisf__: reload
[2012-01-24 16:44:00 -0500] mostlygeek: i just want it to reload the configs since i made a few log changes
[2012-01-24 16:51:00 -0500] __chrisf__: haven't done that, does nginx have a reload function?
[2012-01-24 16:51:00 -0500] __chrisf__: I think the service resource supports actions that are supported by the underlying service
[2012-01-24 16:53:00 -0500] ryker: mostlygeek: assuming the nginx script supports reload, you might need to add 'support :reload => true' to that service block.  I'm not sure about that, but it wouldn't hurt to give it a try.
[2012-01-24 16:54:00 -0500] __chrisf__: I briefly looked just now, and I don't see nginx having a reload function in it's InitCtl script
[2012-01-24 16:55:00 -0500] __chrisf__: On another note, has anyone had this error when using "knife ec2 server create": ERROR: Fog::Service::NotFound: The key pair 'mykey' does not exist
[2012-01-24 16:55:00 -0500] mostlygeek: on the console i can sudo /etc/init.d/nginx reload (ubuntu)
[2012-01-24 16:56:00 -0500] mostlygeek: ryker: i'll try adding the supports option
[2012-01-24 16:56:00 -0500] __chrisf__: @mostlygeek: then do as @ryker suggested and add the 'supports : reload => true' to your service definition
[2012-01-24 16:57:00 -0500] ryker: mostlygeek: of course, assuming that works, you'll only want to reload your nginx config when something has actually changed.  You can find lots of examples of that in the wiki
[2012-01-24 16:58:00 -0500] mostlygeek: ryker: nope adding supports didn't work
[2012-01-24 16:58:00 -0500] mostlygeek: it is very strange...
[2012-01-24 16:59:00 -0500] ryker: yes, that is strange. are you really sure that section of code is being executed?  You might want to add a log line right above or below your service block just to confirm.
[2012-01-24 17:00:00 -0500] mostlygeek: ryker: yep pretty sure, I can see it in the run log... Processing service[nginx] action reload (bbi-online-framework::staging line 131)
[2012-01-24 17:02:00 -0500] ryker: sry, not sure what else to check.  maybe someone else here might have an idea.
[2012-01-24 17:02:00 -0500] __chrisf__: ryker: any insights into the Fog::Service::NotFound key error?
[2012-01-24 17:03:00 -0500] ryker: __chrisf__: sry, I've never used fog before
[2012-01-24 17:13:00 -0500] holoway: __chrisf__: my guess is that you haven't created an ec2 key pair named 'mykey'
[2012-01-24 17:13:00 -0500] Damm: everyone created mykey
[2012-01-24 17:13:00 -0500] Damm: and mykey-1
[2012-01-24 17:13:00 -0500] Damm: and mykey-2
[2012-01-24 17:13:00 -0500] Damm: and mykey-3
[2012-01-24 17:14:00 -0500] Damm: and then you delete them realizing what a moron you are and do it right
[2012-01-24 17:14:00 -0500] holoway: how's my curmudgeonly SA doing?
[2012-01-24 17:15:00 -0500] JasonBox: heh
[2012-01-24 17:21:00 -0500] vkroll: hi all, just a short question: we are allready doing contiunous integration with hudson, now I want to deploy the builds generated there via chef, is there a best practise how to do it? Or kind of documentation?
[2012-01-24 17:21:00 -0500] vkroll: I read a lot at opscode today but have not found such things
[2012-01-24 17:21:00 -0500] ranjibd: vkroll, which stack you are on? rails? java? .net
[2012-01-24 17:21:00 -0500] vkroll: perl
[2012-01-24 17:22:00 -0500] vkroll: with catalyst framework
[2012-01-24 17:22:00 -0500] vkroll: but we have to deploy a lot of perl modules etc
[2012-01-24 17:22:00 -0500] ranjibd: whats your  build artifact ?
[2012-01-24 17:22:00 -0500] vkroll: normally hudson generates tarballs
[2012-01-24 17:23:00 -0500] ranjibd: ok,, and how you want to transport the tarball?
[2012-01-24 17:24:00 -0500] ranjibd: does hudson slave runs on the system where you plan to deploy ?
[2012-01-24 17:24:00 -0500] vkroll: no
[2012-01-24 17:24:00 -0500] vkroll: I want hudson to "say to" chef-server about the new build
[2012-01-24 17:24:00 -0500] ranjibd: if its perl.. and you are using some source control.. you can use the `deploy` resource
[2012-01-24 17:24:00 -0500] ranjibd: vkroll, you can tell hudson to trigger a chef run on the system where you want to deploy
[2012-01-24 17:25:00 -0500] vkroll: via knife ssh -- yes
[2012-01-24 17:25:00 -0500] thehar: also i would move over ot jenkins
[2012-01-24 17:25:00 -0500] ranjibd: and in that target system you can have a recipe that uses the deploy resource to ...
[2012-01-24 17:25:00 -0500] thehar: the project is more advanced
[2012-01-24 17:26:00 -0500] vkroll: thehar: i am not sure which of them we use :-)
[2012-01-24 17:26:00 -0500] thehar: hehe
[2012-01-24 17:26:00 -0500] vkroll: so, if I understand you correctly I have to start reading here: http://wiki.opscode.com/display/chef/Deploy+Resource#DeployResource-DeployResource
[2012-01-24 17:26:00 -0500] jbz: vkroll: You could also have the Hudson server a chef cookbook which added the current build number to an attribute and saved state back to the chef server, then anything which wanted to deploy could search for the 'current build' from the Hudson server.
[2012-01-24 17:26:00 -0500] ranjibd: the particular revision that jenkins has certified green. can be stored in a data bag,, which jenkins can write everytime it gets a green build
[2012-01-24 17:27:00 -0500] vkroll: hmm, ok, are there any docs, where I can read about it? I just started reading about chef yesterday, so ... sorry, if it sounds a little "childish"
[2012-01-24 17:27:00 -0500] ranjibd: if you dont want ssh/knife to invoke the chef run.. you can just rewrite the data bag.. and wait till next chef run,,, and the deploy will be automatically happen in.. but this will introduce certain delay
[2012-01-24 17:27:00 -0500] ranjibd: deploy?
[2012-01-24 17:27:00 -0500] bawt: deploy is http://wiki.opscode.com/display/chef/Deploy+Resource
[2012-01-24 17:28:00 -0500] ranjibd: vkroll, ^^^
[2012-01-24 17:28:00 -0500] vkroll: ranjibd: ok, I found this page :-) I have to read it more intensivly
[2012-01-24 17:28:00 -0500] ranjibd: DO IT
[2012-01-24 17:29:00 -0500] vkroll: I will -- started yesterday with chef and read the oreilly book yesterday evening
[2012-01-24 17:30:00 -0500] ranjibd: welcome to the community that.. keep reading the wiki.. ask question if you get stuck..
[2012-01-24 17:31:00 -0500] ranjibd: s/that/then/
[2012-01-24 17:31:00 -0500] vkroll: thank you
[2012-01-24 17:46:00 -0500] __chrisf__: @Damm Thanks for the constructive feedback never mind they key isn't actually called mykey. @holoway: The key definitely exists, at the right --dentitfy-file path and with the right ssh-key name, unless I've misunderstood something. I even deleted and recreated a new key with the same name. I have another key which I can use perfectly fine, but when I switch to this key, I have issues.
[2012-01-24 17:50:00 -0500] ank: Where do folks like to put EBS volume creation/attachment? An extra recipe in the aws cookbook, in it's own recipe? It feels like something that belongs in a role but I can't define resources there
[2012-01-24 17:50:00 -0500] ranjibd: __chrisf__, how you have created the key? using webui?
[2012-01-24 17:51:00 -0500] veghead: Trying to figure out the best way to move a 0.9.14 Chef server from one EC2 instance to another *and* upgrade to 0.10.x in the process. Is it backing up the data using the Knife Exec script, backing up Couchd db and backing up the the checksum_path? Restoring all of those on the new server? And then bootstrapping  Chef 0.10?
[2012-01-24 17:52:00 -0500] ranjibd: veghead, just backup the couchdb
[2012-01-24 17:52:00 -0500] cwj: ank: i think the most flexible approach is to copy a provider like https://gist.github.com/961067 into your copy of the aws cookbook and modify as needed
[2012-01-24 17:52:00 -0500] ranjibd: and validation and webui private key
[2012-01-24 17:52:00 -0500] __chrisf__: @ranjibd yes
[2012-01-24 17:53:00 -0500] ranjibd: __chrisf__, wont work then. there a bug..use the vaildation key  or webui as ur client key and set the node name to chef-validato or webui in ur knife
[2012-01-24 17:53:00 -0500] veghead: ranjibd: that's it? Do I backup the couchdb, restore it on the new system and *then* bootstrap Chef 0.10.x? Or install Chef 0.10.x on the system, shutdown Chef & Couch, restore the couch backup and restart everything?
[2012-01-24 17:53:00 -0500] ranjibd: and use knife to create an admin client ,, and proceed with it
[2012-01-24 17:54:00 -0500] veghead: What about the validation.pem?
[2012-01-24 17:54:00 -0500] veghead: I have roughly 90 clients...
[2012-01-24 17:54:00 -0500] ranjibd: install the new chef server.. stop couch.. rsync the old couch with --delete
[2012-01-24 17:54:00 -0500] ranjibd: and restart it
[2012-01-24 17:54:00 -0500] ank: cwj: nice, I've actually used that provider. But it still requires an accompanying recipe I guess. I'll look into that approach more
[2012-01-24 17:54:00 -0500] veghead: ranjibd: Gotcha.
[2012-01-24 17:55:00 -0500] ranjibd: also change the validation key and webui key. and then point one node to the new server . if things work fine.. ur done
[2012-01-24 17:55:00 -0500] ranjibd: veghead, what?
[2012-01-24 17:55:00 -0500] veghead: ranjibd: you mean replace the validation key on the new server with the validation key from the old server?
[2012-01-24 17:56:00 -0500] cwj: ank: you're not going to be able to get away from needing a recipe to set up the volumes, but at least you can modify the provider to accept whatever variables you want to provide as role attributes
[2012-01-24 17:57:00 -0500] ranjibd: veghead, yeah
[2012-01-24 17:58:00 -0500] ank: cwj: yeah, I think that's what I need is just to expose some attributes for volume-id/snapshot-id that I can use in the role. thx!
[2012-01-24 17:58:00 -0500] veghead: ranjibd: thanks! i'll give it a shot.
[2012-01-24 17:58:00 -0500] ranjibd: see the public part is stored in couch which you are changing anyway..
[2012-01-24 18:00:00 -0500] rogernolan: HI, I'm chef neophyte :-( I'm having trouble with the Nagios recipe on my (Nagios) server node.
[2012-01-24 18:01:00 -0500] rogernolan: It's running on Ubuntu Natty and when chef-client runs, it barfs (I think) trying to find the other nodes.:
[2012-01-24 18:01:00 -0500] rogernolan: [Tue, 24 Jan 2012 17:37:54 +0000] INFO: HTTP Request Returned 400 Bad Request: invalid search query: 'hostname:[* TO *] AND app_environment:' Parse error at offset: 37 Reason: Expected one of AND, OR, NOT, ?, \, ", (, [, { at line 1, column 39 (byte 39) after :
[2012-01-24 18:01:00 -0500] mostlygeek: I have a ruby_block, how do I call chef resources within it? I downloaded a txt file w/ paths to other files that need to be downloaded later..
[2012-01-24 18:02:00 -0500] rogernolan: which I'm guessing is reserv'rb:29 nodes = search(:node, "hostname:[* TO *] AND app_environment:#{node[:app_environment]}")
[2012-01-24 18:02:00 -0500] rogernolan: but then I'm lost
[2012-01-24 18:09:00 -0500] ranjibd: mostlygeek, u mean notify?
[2012-01-24 18:09:00 -0500] ranjibd: mostlygeek, the ruby block is inside a chef recipe? or a vanilla ruby script ?
[2012-01-24 18:10:00 -0500] ranjibd: rogernolan, why you need the hostname:[* TO *]
[2012-01-24 18:11:00 -0500] ranjibd: rogernolan, any reason not to use only "app_environment:#{node[:app_environment]}"
[2012-01-24 18:11:00 -0500] rogernolan: ranjibd, This is the vanilla nagios recipe
[2012-01-24 18:11:00 -0500] ranjibd: rogernolan, ok..
[2012-01-24 18:12:00 -0500] ranjibd: rogernolan, ahh.. i think that attribute does not exist
[2012-01-24 18:12:00 -0500] ranjibd: check if app_environment exist for that node
[2012-01-24 18:12:00 -0500] ranjibd: knife node show node_name -a app_environment
[2012-01-24 18:12:00 -0500] mostlygeek: ranjibd: the ruby block contains code that opens the file, reads the links, and downloads them from S3.
[2012-01-24 18:13:00 -0500] mostlygeek: not sure how to make this work ... using the DSL...
[2012-01-24 18:14:00 -0500] ranjibd: ruby_block?
[2012-01-24 18:14:00 -0500] bawt: ruby_block is http://wiki.opscode.com/display/chef/Resources#Resources-RubyBlock
[2012-01-24 18:14:00 -0500] ranjibd: notify?
[2012-01-24 18:14:00 -0500] bawt: notify is http://wiki.opscode.com/display/chef/Resources#Resources-Meta
[2012-01-24 18:15:00 -0500] ranjibd: use notify in the ruby_block resource to run/create the other resource,,,
[2012-01-24 18:15:00 -0500] damienj: good morning part two :)
[2012-01-24 18:15:00 -0500] mostlygeek: ranjibd: i actually need to download a bunch of files, i guess that would work too? with multiple notifies?
[2012-01-24 18:16:00 -0500] damienj: Wondering how to get around this? "You must override load_current_resource", on trying to do a package resource
[2012-01-24 18:16:00 -0500] damienj: rhel5.4
[2012-01-24 18:16:00 -0500] rogernolan: ranjibd: correct. looks like the configuration of the whole client is missing :-(
[2012-01-24 18:17:00 -0500] ranjibd: mostlygeek, yeah..
[2012-01-24 18:17:00 -0500] damienj: do I need to update chef if I am getting "You must override load_current_resource"? or do i have an incomplete/corrupt configuration of chef?
[2012-01-24 18:18:00 -0500] ranjibd: mostlygeek, remember the execute family of resources(including bash and ruby_block) is not idempotent ,, u might add a not_if{File.exists?('path of the file u want to download')}  , to make it idempotent
[2012-01-24 18:18:00 -0500] ranjibd: idempotent?
[2012-01-24 18:20:00 -0500] mostlygeek: what i'm trying to do is, download a manifest file (txt), parse it, create a local directory and download files referenced in that file. What is a good way to accomplish that?
[2012-01-24 18:22:00 -0500] cwj: mostlygeek: have you considered storing the manifest in a data bag? then you could iterate over the data bag with remote_file resources
[2012-01-24 18:23:00 -0500] mostlygeek: cwj: nope, i will read more about using data bags. are they a good way to pass data around between resources?
[2012-01-24 18:24:00 -0500] cwj: mostlygeek: yes, and for sharing info between nodes
[2012-01-24 18:25:00 -0500] mostlygeek: cwj: databags are fairly static right? during run time, I want to download the file and process it... is this a good use case?
[2012-01-24 18:27:00 -0500] cwj: mostlygeek: if i understand what you are asking, i think it is a very good use case
[2012-01-24 18:28:00 -0500] mostlygeek: do the databags stop existing after the chef run is complete?
[2012-01-24 18:29:00 -0500] jbz: mostlygeek: Databags exist on the server independent of the chef client run.
[2012-01-24 18:29:00 -0500] cwj: no they persist on the server
[2012-01-24 18:29:00 -0500] jbz: mostlygeek: They are not as good as attributes for passing around info between resources, because modifying them on the server is nontrivial for a client run
[2012-01-24 18:30:00 -0500] jbz: (for example, most node clients won't have permission to change them unless you explicitly change that)
[2012-01-24 18:30:00 -0500] jbz: mostlygeek: However, if you use node attributes, those are saved to the server at the conclusion of every successful run, so unless the particular attribute you use is overwritten earlier in the run by an ohai value or an override attribute, it will be available next run
[2012-01-24 18:31:00 -0500] jbz: .sorry, long-winded.  In short - if you want to pass info between two resources in a run, on the same client, I'd use attributes not databags.  If you want to pass info *to* a client from another source, and have it be more of a 'reference value', I'd use databags.
[2012-01-24 18:31:00 -0500] jespada: guys any clue why some nodes could be registered 2 times on the chef server.. as nodeXX.domain and also as nodeXX ?
[2012-01-24 18:32:00 -0500] jespada: open source chef not hosted
[2012-01-24 18:32:00 -0500] mostlygeek: jbz: thanks i'll try using attributes for passing some data round
[2012-01-24 18:33:00 -0500] cwj: mostlygeek: here's an example-ish https://gist.github.com/1671761
[2012-01-24 18:34:00 -0500] cwj: the manifest.json would be a data bag item uploaded to a databag called "apps"
[2012-01-24 18:38:00 -0500] mkent_: damienj, can you gist the context of that error? snippet from the failing recipe and some debug output
[2012-01-24 18:38:00 -0500] damienj: mkent__: sure ty, hold on
[2012-01-24 18:39:00 -0500] holoway: jespada: are you canging their hostnames?
[2012-01-24 18:41:00 -0500] jespada: holoway, not at all..
[2012-01-24 18:41:00 -0500] JasonBox: chef too fantastic for words
[2012-01-24 18:41:00 -0500] JasonBox: Surely my most fun activity
[2012-01-24 18:42:00 -0500] damienj: mkent__: https://gist.github.com/1671799
[2012-01-24 18:43:00 -0500] Brad_K: folks  anyone know if opscode is having host/timeout issues again?
[2012-01-24 18:43:00 -0500] holoway: jespada: that would be the prime cause - basically it selects its node name from what ohai reports
[2012-01-24 18:44:00 -0500] jespada: holoway, I know .. but in others servers it selects from the fqdn attribute
[2012-01-24 18:45:00 -0500] jespada: holoway,  not from the hostname, right?
[2012-01-24 18:45:00 -0500] mkent_: damienj, that's odd, i'd guess changing package to yum_package would fix it but i'm not sure why package isn't loading the correct provider in the first place
[2012-01-24 18:45:00 -0500] mkent_: what do "ohai platform" and platform_version return?
[2012-01-24 18:46:00 -0500] Brad_K: jespada: typically, what gets put into the fqdn attribute is what ohai found from the hostname, and if the vendor doesn't set the hostname value correctly, then you have to do some work to fix that afterwards.
[2012-01-24 18:46:00 -0500] damienj: mkent__: good call, i think that is the problem:
[2012-01-24 18:46:00 -0500] holoway: jespada: that's what I'm saying - there isn't any magic in what chef is doing. it goes Chef::Config[:node_name] || ohai[:fqdn] || ohai[:hostname]
[2012-01-24 18:46:00 -0500] damienj: on the one that is broken, it returns: "redhatenterpriseserver", on the one that works, it returns "redhat"
[2012-01-24 18:47:00 -0500] mkent_: aha cute
[2012-01-24 18:47:00 -0500] siezer: redhatenterpriseserver ?
[2012-01-24 18:47:00 -0500] siezer: what version of redhat?
[2012-01-24 18:47:00 -0500] ranjibd: jespada, holoway any chance you passed the -N flag also in a chef run
[2012-01-24 18:47:00 -0500] mkent_: damienj, can you add the contents of /etc/redhat-release to the gist?
[2012-01-24 18:48:00 -0500] mkent_: on the broken one of course
[2012-01-24 18:49:00 -0500] damienj: mkent__: sure, one meoment
[2012-01-24 18:49:00 -0500] mkent_: also the output of  "lsb_release -a"  if it's installed
[2012-01-24 18:50:00 -0500] jespada: holoway, Brad_K ok then I think.. found the problem.. I also run containers inside those host .. each lxc container with as another node.. so maybe there is a problem..checking..
[2012-01-24 18:50:00 -0500] jespada: holoway, Brad_K tks btw
[2012-01-24 18:50:00 -0500] Brad_K: jespada: you're welcome!
[2012-01-24 18:51:00 -0500] damienj: mkent_: I just added the contents of /etc/redhat-release to the gist link
[2012-01-24 18:51:00 -0500] mkent_: damienj, thanks, last one is the output of  "lsb_release -a"  if it's installed
[2012-01-24 18:52:00 -0500] jespada: ranjibd, not in my case ( -N)
[2012-01-24 18:54:00 -0500] damienj: mkent_: ok lsb_release -a is in there :) (btw: ty for taking time!)
[2012-01-24 18:55:00 -0500] mkent_: np :) okay so that's an interesting distributor id
[2012-01-24 18:55:00 -0500] damienj: right it doesn't seem to conform
[2012-01-24 18:56:00 -0500] damienj: but the other server that is running rhel5.6 does work, and it also appears to be same distributor id (I'm adding to gist now)
[2012-01-24 18:57:00 -0500] damienj: ok updated with working rhel5.6
[2012-01-24 18:58:00 -0500] mkent_: what version of ohai are you running, that looks to be fixed in >= 0.6.8
[2012-01-24 18:58:00 -0500] mkent_: http://tickets.opscode.com/browse/OHAI-301
[2012-01-24 18:59:00 -0500] damienj: looks lke 0.6.6
[2012-01-24 18:59:00 -0500] damienj: maybe all I need is an updated ohai
[2012-01-24 18:59:00 -0500] mkent_: there you go :)
[2012-01-24 18:59:00 -0500] mkent_: latest has some good fixes
[2012-01-24 18:59:00 -0500] damienj: ahh and the one that works is 0.6.10
[2012-01-24 19:00:00 -0500] damienj: mkent__: ROCK!
[2012-01-24 19:01:00 -0500] mkent_: :D
[2012-01-24 19:11:00 -0500] ank: anyone else have intermittent issues with hosted chef? Is there a status page somewhere?
[2012-01-24 19:12:00 -0500] ank: nvm, found http://status.opscode.com
[2012-01-24 19:13:00 -0500] Andorbal: Has anyone run into problems registering windows machines with Chef?
[2012-01-24 19:13:00 -0500] Brad_K: ank: thanks!  i saw these problems last night, but i didn't know they were continuing today.
[2012-01-24 19:13:00 -0500] Andorbal: I was able to get one registered last week, but now when I try on new instances, I get a 409 followed by a 403 on the client
[2012-01-24 19:35:00 -0500] l1x: Error 101 (net::ERR_CONNECTION_RESET): The connection was reset.
[2012-01-24 19:35:00 -0500] l1x: status.opscode.com throws this
[2012-01-24 19:48:00 -0500] KarlHungus: is cucumber-chef useful? or dead? or what?
[2012-01-24 19:48:00 -0500] __chrisf__: trying to execute "knife ec2 server create" to target AWS USWEST (N. Cali) and getting "ERROR: You have not provided a valid image (AMI) value.  Please note the short option for this value recently changed from '-i' to '-I'." I have triple checked the AMI, even launched an instance through the Management Console. Same command with appropriate AMI for USEAST works just fine. I'm using (-I, -i, -Z, -f, -x, -S, -G, -r)
[2012-01-24 19:49:00 -0500] jbz: __chrisf__: AMIs are not consistent across AWS regions.
[2012-01-24 19:50:00 -0500] jbz: __chrisf__: Double check that there's a version of the AMI you want on the us-west region. It will have a different AMI ID if it exists.
[2012-01-24 19:50:00 -0500] __chrisf__: @jbz: I know, I use USEast Ubuntu 11.10 32bit for Virgina, USWest for N.Cali as per Alestic
[2012-01-24 19:50:00 -0500] jbz: Oh, sorry, you said you checked, my bad.
[2012-01-24 19:51:00 -0500] jbz: I wonder if the options are consistent across region endpoints or if they let 'em get outta sync :-P
[2012-01-24 19:51:00 -0500] jbz: So it's saying it doesn't like -i
[2012-01-24 19:52:00 -0500] __chrisf__: Earlier today I had Fog complaining my key didn't exist, but I realized Fog doesn't suppert US-WEST-2, so I decided to play with US-WEST-1. Got new keys, triple checked it all, now have this issue
[2012-01-24 19:52:00 -0500] jbz: hm
[2012-01-24 19:52:00 -0500] __chrisf__: I'm using -i for the identity, -I for the image
[2012-01-24 19:52:00 -0500] __chrisf__: I'm running the exact command for USEast (with appropriate AMI, ssh-key name, and identity file) as we speak, works like a charm, has for months
[2012-01-24 19:53:00 -0500] __chrisf__: USWest, no dice
[2012-01-24 19:53:00 -0500] jbz: bleah.
[2012-01-24 19:53:00 -0500] __chrisf__: yea, that's what I said
[2012-01-24 19:54:00 -0500] jbz: That might be worth hitting AWS support with.
[2012-01-24 19:56:00 -0500] __chrisf__: you think their API could be causing the issue, not reporting AMIs correctly?
[2012-01-24 20:00:00 -0500] jbz: I dunno.  It's also possible that the two endpoints are doing different things vis-a-vis the command options
[2012-01-24 20:00:00 -0500] jbz: I'd try to extract or reconstruct the AWS API call that knife is making in both cases, and try to run it manually from the CLI client against both region endpoints and see if it works on both
[2012-01-24 20:00:00 -0500] jbz: or if it responds differently.  If different, SUPPORT. :-)
[2012-01-24 20:01:00 -0500] jbz: We've had problems like that with AWS before.
[2012-01-24 20:03:00 -0500] __chrisf__: okay, one thing I just realized is that I'm not explicitly stating --region
[2012-01-24 20:03:00 -0500] __chrisf__: that could be causing issues
[2012-01-24 20:03:00 -0500] __chrisf__: let me check
[2012-01-24 20:04:00 -0500] __chrisf__: hah, indeed that solves this problem. You apparently must provide the --region flag, -Z or --availability-zone is not sufficient in any region other than USEast
[2012-01-24 20:05:00 -0500] jbz: ahhhhhh
[2012-01-24 20:05:00 -0500] jbz: Drat them for having inconsistent region behavior. :-P
[2012-01-24 20:10:00 -0500] yfeldblum: perhaps useast is the default region?
[2012-01-24 20:18:00 -0500] ranjibd: yeah
[2012-01-24 20:21:00 -0500] mattray: yuck, jpackage cookbook calls 'yum clean all'. My automated yum proxy cookbook needs to get in gear
[2012-01-24 20:23:00 -0500] jaimef: anyone ever store the node structure to a json file for diff purposes?
[2012-01-24 20:24:00 -0500] mattray: jaimef: only works for ruby 1.9, 1.8 returns unordered json
[2012-01-24 20:25:00 -0500] jaimef: mattray: thanks
[2012-01-24 20:25:00 -0500] mattray: did you run into that? drove me nuts awhile back
[2012-01-24 20:25:00 -0500] jaimef: not yet.
[2012-01-24 20:25:00 -0500] yfeldblum: mattray, what does 1.9 return? so far as i'm aware, there's no specific order there either (since the insertion order is unspecified)
[2012-01-24 20:25:00 -0500] jaimef: usually dump it for irb debugging
[2012-01-24 20:25:00 -0500] mattray: yfeldblum: it consistently returns the same json
[2012-01-24 20:26:00 -0500] mattray: yfeldblum: no specific ordering, but always the same
[2012-01-24 20:26:00 -0500] mattray: somewhere in ruby I'm sure it's getting applied
[2012-01-24 20:27:00 -0500] yfeldblum: jaimef, what i do is i've got a knife plugin which monkey-patches enough things to permit dumping any object as YAML, such that the keys of every hash or sub-hash etc. are sorted
[2012-01-24 20:31:00 -0500] yfeldblum: jaimef, it also lets me `knife KIND from file FILE.yml` and `knife KIND edit NAME -Fy`
[2012-01-24 20:38:00 -0500] yfeldblum: mattray, it was actually causing me some problems a while back (0.9) w/ cookbooks' metadata.json and the version of ruby running knife and the version of ruby running the remote chef-server
[2012-01-24 20:38:00 -0500] yfeldblum: mattray, never figured it out; haven't seen it since upgrading to 0.10
[2012-01-24 21:14:00 -0500] Guest55461: hi, does anyone know if data bags are cached somewhere on a chef-solo installation?
[2012-01-24 21:14:00 -0500] Guest55461: i have created and used data bags successfully, but if i try to make any changes to the json they are not reflected if i re run the recipe
[2012-01-24 21:31:00 -0500] carlp: Greetings! Is there a way to check if a node is assigned a role within a recipe?  For example "If this node is part of role x then assign version variable version_x, otherwise assign version variable version_y"
[2012-01-24 21:32:00 -0500] mattray: carlp: you can look at the node.run_list
[2012-01-24 21:32:00 -0500] mattray: there are methods off of that to help you out, shef is a good way to explore them
[2012-01-24 21:33:00 -0500] chrisftw: if node.run_list.include?("role_x")  (wild guess)
[2012-01-24 21:33:00 -0500] siezer: carlp another strategy is to leave some "evidence" that the recipe has ran in the node object like set['node][
[2012-01-24 21:33:00 -0500] siezer: er
[2012-01-24 21:33:00 -0500] carlp: mattray: thanks, I'll check that out
[2012-01-24 21:33:00 -0500] siezer: worry
[2012-01-24 21:33:00 -0500] siezer: node.set[:munin][:client] = true
[2012-01-24 21:34:00 -0500] siezer: which can be searched for with munin_clients = search(:node, "munin_client:true")
[2012-01-24 21:34:00 -0500] carlp: siezer: Yeah, the problem is I have a package version set in the override attributes of the environment, but I need to use a different variable if the node is part of a specific role.
[2012-01-24 21:35:00 -0500] siezer: aha.
[2012-01-24 21:38:00 -0500] jespada: question: is there any way to tell the chef-client not to start after the installation (as a daemon in debian for instance) ?
[2012-01-24 21:39:00 -0500] mattray: jespada: chances are good the debian package is starting itself up. You can use the service restart to :stop and :disable
[2012-01-24 21:42:00 -0500] carlp: jespada: yes, by default the debian and ubuntu packages auto-start the service
[2012-01-24 21:42:00 -0500] jespada: mattray, ok but i was thinking in something like: pree-seed the chef config (client.rb for instance) with a value like start=no or something like that.. and when the package is installed will read that config
[2012-01-24 21:43:00 -0500] jespada: carlp, can I have not to autostart?
[2012-01-24 21:45:00 -0500] carlp: jespada: Doesn't look like it.  We install the package and then either immediately stop it, or have chef re-configure it via a recipe.  Kinda a bummer, really
[2012-01-24 21:47:00 -0500] jespada: presume that.. but thought maybe some of the master here have some dark stuff ;)
[2012-01-24 21:47:00 -0500] jespada: well carlp mattray tks you guys..
[2012-01-24 21:52:00 -0500] miah: moin
[2012-01-24 22:03:00 -0500] mleinart: any good cookbook examples of setting up a simple rack app? looking for a starting point
[2012-01-24 22:09:00 -0500] Urocyon: I'd like to populate a variable in a recipe based on a command executed on the node.  (specifically, I want to grab the output of pg_config --sharedir)
[2012-01-24 22:09:00 -0500] Urocyon: Would someone here point me to the right tool for the job?
[2012-01-24 22:09:00 -0500] holoway: Urocyon: foo = `pg_config --sharedir`
[2012-01-24 22:10:00 -0500] Urocyon: backticks, really?
[2012-01-24 22:10:00 -0500] Urocyon: I never tried backticks in a recipe.
[2012-01-24 22:10:00 -0500] holoway: Urocyon: if you really just want the value of that at compile time? sure
[2012-01-24 22:10:00 -0500] holoway: Urocyon: if you want it at run time, you need to put it in a ruby_block
[2012-01-24 22:11:00 -0500] Urocyon: well, that was my next question, is when does it get run.  Because if it runs before postgres is installed that's going to generate an error.
[2012-01-24 22:11:00 -0500] holoway: Urocyon: what are you trying to do, exactly?
[2012-01-24 22:11:00 -0500] holoway: where do you want to be able to re-use that value?
[2012-01-24 22:11:00 -0500] holoway: and in what context?
[2012-01-24 22:11:00 -0500] Urocyon: I want to pull a template from a the pg share dir, and use it to create a database.
[2012-01-24 22:12:00 -0500] Urocyon: I was going to use it in the database cookbook's postgresql_database resource.
[2012-01-24 22:13:00 -0500] Urocyon: to set the value of template in that resource.
[2012-01-24 22:14:00 -0500] Urocyon: oh wait... rats, probably not template.
[2012-01-24 22:15:00 -0500] Urocyon: nevermind, just realized that's not where I need the value.  I can use it later in a script, probably.
[2012-01-24 22:15:00 -0500] holoway: you are welcome :)
[2012-01-24 22:18:00 -0500] gpapilion: btm: are you around?
[2012-01-24 22:22:00 -0500] mostlygeek: when doing a notifies :restart, "services[nginx]", does there need to be a service resource defined within that recipe, or can it be anywhere?
[2012-01-24 22:22:00 -0500] jbz: mostlygeek: It has to have been defined somewhere in the runlist prior to that call.
[2012-01-24 22:22:00 -0500] jbz: But that could be in a different recipe.
[2012-01-24 22:24:00 -0500] mostlygeek: jbz: thanks.
[2012-01-24 22:25:00 -0500] bitmonk: anyone know of ubuntu precise chef 0.10 packages in the works? upstream is putting together a new LTS with chef 0.8 in mainline. :/
[2012-01-24 22:26:00 -0500] holoway: bitmonk: use the opscode repo
[2012-01-24 22:26:00 -0500] bitmonk: doesn't appear to be anything for precise yet
[2012-01-24 22:29:00 -0500] jstump: Anyone know what a valid aws_ssh_key_id value is? I've tried using the name and the fingerprint to no avail.
[2012-01-24 22:30:00 -0500] jstump: Should be noted that I'm using an IAM account.
[2012-01-24 22:30:00 -0500] Damm: ec2-describe-keypairs
[2012-01-24 22:31:00 -0500] Damm: ^ jstump it should show KEYPAIR <name> fingerprint
[2012-01-24 22:31:00 -0500] Damm: the id is the name in this case
[2012-01-24 22:31:00 -0500] jstump: Damm: Thanks for the tip. I'll give that a shot and see what happens.
[2012-01-24 23:25:00 -0500] jstump: Damm: No key pairs are returned by that command. This user is an IAM user FWIW.
[2012-01-24 23:25:00 -0500] jstump: Damm: Despite me having a key in the IAM console (when logged in as my root account).
[2012-01-24 23:25:00 -0500] jstump: Anyone have any pointers for using knife / OpsCode with an IAM user per chance?
[2012-01-24 23:54:00 -0500] jtimberman: bitmonk: oneiric packages should "just work"
[2012-01-24 23:54:00 -0500] jtimberman: from our repo
[2012-01-24 23:55:00 -0500] bitmonk: seems to..
