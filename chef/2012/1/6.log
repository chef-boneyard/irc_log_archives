[2012-01-06 08:33:00 -0500] BryanWB: can anybody out there w/ ubuntu 11.04 test installing openjdk-7 for me?
[2012-01-06 08:34:00 -0500] BryanWB: i have 11.10 and suspect that there is a subtle difference b/w the openjdk packages on the ubuntu versions
[2012-01-06 10:42:00 -0500] ukio: hi folks!
[2012-01-06 10:43:00 -0500] ukio: quick question: i have tried to sudo apt-get install chef=0.10.4-1, but it seems to be not present in the repository
[2012-01-06 10:44:00 -0500] ukio: are the 'oudtated' patch versions of chef removed from the apt repositories?
[2012-01-06 10:45:00 -0500] ukio: 'apt-cache show chef' shows only 0.8.16 and 0.10.8, but not 0.10.4 anymore
[2012-01-06 10:46:00 -0500] ukio: is there any way to install 0.10.4 via apt-get? do i need to enable a different repository?
[2012-01-06 13:15:00 -0500] BryanWB: jtimberman, I should be ready to send a pull request for the java cookbook in a couple hours but am running into very strange errors w/ the openjdk packages on ubuntu. at this point not sure whether my ubunut vm is screwed up or if it is the packages
[2012-01-06 13:19:00 -0500] itwasntandy: out of interest why are you using the openjdk packages? I've avoided them ever having some pretty funky experiences with them a few years ago.
[2012-01-06 13:20:00 -0500] BryanWB: itwasntandy: i actually don't use them at all but they were in the java cookbook, which I have rewritten
[2012-01-06 13:20:00 -0500] BryanWB: itwasntandy: i may need to use the java_ark lwrp to install them instead
[2012-01-06 13:20:00 -0500] BryanWB: itwasntandy: but not actually a use case for me as my team uses the oracle jdk
[2012-01-06 13:25:00 -0500] itwasntandy: yeh, we use the sun/oracle jdk too.
[2012-01-06 13:27:00 -0500] BryanWB: do u have a recipe for installing it?
[2012-01-06 13:27:00 -0500] BryanWB: mine is here https://github.com/bryanwb/cookbooks/tree/master/java
[2012-01-06 13:27:00 -0500] BryanWB: itwasntandy: ^^
[2012-01-06 13:31:00 -0500] itwasntandy: nope, I just stick the rpm inour yum repo (we're a centos/rhel shop), and that works well enough for now
[2012-01-06 13:31:00 -0500] itwasntandy: guess you don't have that option on ubuntu as there are no debs, although should be fairly easy using fpm to produce some.
[2012-01-06 13:37:00 -0500] BryanWB: itwasntandy: where do u get the rpm?
[2012-01-06 13:37:00 -0500] itwasntandy: from: http://www.java.com/en/download/manual.jsp
[2012-01-06 13:38:00 -0500] itwasntandy: linux x64 rpm
[2012-01-06 13:38:00 -0500] itwasntandy: downloads as a shell script which when you run, extracts the rpm
[2012-01-06 13:38:00 -0500] BryanWB: i looked for that 4evar and could never find it, fuck me
[2012-01-06 13:38:00 -0500] itwasntandy: :)
[2012-01-06 13:39:00 -0500] BryanWB: itwasntandy: but iirc, it doesn't update the symlink for /usr/bin/java , correct?
[2012-01-06 13:39:00 -0500] BryanWB: and installs to /usr/java/
[2012-01-06 13:39:00 -0500] itwasntandy: seems to
[2012-01-06 13:39:00 -0500] itwasntandy: lrwxrwxrwx 1 root root 26 Nov 30 06:26 /usr//bin/java -> /usr/java/default/bin/java
[2012-01-06 13:41:00 -0500] BryanWB: well, i use my java_ark lwrp for other purposes as well, such as installing tomcat and maven. perhaps it would be useful to u
[2012-01-06 13:42:00 -0500] itwasntandy: thanks
[2012-01-06 14:28:00 -0500] ssd7: Ohai Chefs
[2012-01-06 14:36:00 -0500] ukio: stupid question: what does ohai stand for? something like "oh, hi!"? :-)
[2012-01-06 14:38:00 -0500] ssd7: ukio: I'm unsure if that was the original intent, but that is how people tend to use it :)
[2012-01-06 14:40:00 -0500] ukio: ah, look here: http://www.urbandictionary.com/define.php?term=ohai
[2012-01-06 14:40:00 -0500] ukio: that might explain it :)
[2012-01-06 14:40:00 -0500] BryanWB: ssd7: morning
[2012-01-06 14:40:00 -0500] ukio: maybe thats what a node says to the chef server when it comes up
[2012-01-06 14:41:00 -0500] dyer: morning ssd
[2012-01-06 14:59:00 -0500] ssd7_: Mornin' BryanWB & dyer
[2012-01-06 15:04:00 -0500] brettweavnet: Whats the best way to store secret credentials in chef?  Encrypted databag?
[2012-01-06 15:05:00 -0500] ssd7_: brettweavnet: Encrypted databags is the best option at the moment, yes.
[2012-01-06 15:06:00 -0500] brettweavnet: ssd7_: Thanks
[2012-01-06 15:10:00 -0500] fearoffish: okay, what's the easiest way to see the recipe dependency tree
[2012-01-06 15:10:00 -0500] fearoffish: something is including a recipe i don't want and I can't find it
[2012-01-06 15:11:00 -0500] fearoffish: grep isn't helping this time
[2012-01-06 15:11:00 -0500] CharlieSu: Is there any way to ensure that when i include the chef-client recipe on a server that I'm bootstrapping, that it doesn't try to run it while the original bootstrap is occuring?
[2012-01-06 15:11:00 -0500] fearoffish: CharlieSu: it's idempotent so shouldn't matter?
[2012-01-06 15:14:00 -0500] jtimberman: fearoffish: during the chef run
[2012-01-06 15:14:00 -0500] fearoffish: jtimberman: hey mate :)
[2012-01-06 15:14:00 -0500] jtimberman: fearoffish: you can peek at node[:seen_recipes]
[2012-01-06 15:14:00 -0500] fearoffish: does that tell me what depended on it?
[2012-01-06 15:14:00 -0500] jtimberman: debug output might have clues about whats going on too
[2012-01-06 15:15:00 -0500] jtimberman: no, just a list
[2012-01-06 15:15:00 -0500] fearoffish: arf.
[2012-01-06 15:15:00 -0500] fearoffish: I know it's included
[2012-01-06 15:15:00 -0500] yfeldblum: CharlieSu, are you talking about the actual bootstrap or the first chef-client run that the bootstrap triggers?
[2012-01-06 15:15:00 -0500] fearoffish: i want to know why!  hehe
[2012-01-06 15:15:00 -0500] fearoffish: I'll run debug and see if there's something in there
[2012-01-06 15:16:00 -0500] CharlieSu: when i do an ec2 server create with an initial runlist that takes a while to install it does matter if it is idempotent.  If the chef-client recipe is installed w/ the runit 'init' style and then other recipes are being installed at the same time there will be a problem if the runit manage chef-client runs because the initial chef run isn't complete so the node has an empty runlist.  which then causes the runit managed chef-cl
[2012-01-06 15:18:00 -0500] CharlieSu: so basically my base role includes chef-client, but when bootstrapping i'm also applying a bunch of other recipes as well.  the concern is that the runit managed chef-client will create a race condition with the chef-client that is spawned during bootstrap.
[2012-01-06 15:19:00 -0500] jtimberman: fearoffish: debug will show when the recipe is getting included, roughly
[2012-01-06 15:19:00 -0500] jtimberman: so there might be context around that.
[2012-01-06 15:19:00 -0500] fearoffish: jtimberman: I see the big scary hashes....copy and pasting for better formatting now :)
[2012-01-06 15:19:00 -0500] jtimberman: that context might be useful to put debuggery information about what the seen_recipes list is
[2012-01-06 15:21:00 -0500] fearoffish: got it, thanks mate
[2012-01-06 15:23:00 -0500] hroarke: Does github.com/cookbooks have any official relationship with Opscode?
[2012-01-06 15:26:00 -0500] jtimberman: hroarke: no
[2012-01-06 15:26:00 -0500] jtimberman: that's a community effort.
[2012-01-06 15:27:00 -0500] hroarke: jtimberman: thx
[2012-01-06 15:27:00 -0500] jtimberman: we're planning to split up the cookbooks repository at some point, but i don't have a date on when that will be yet.
[2012-01-06 15:30:00 -0500] CharlieSu: Is there a better way for testing for this?     if node[:apache][:allowed_openids]    ?    I'm getting 'NoMethodError - undefined method `[]' for nil:NilClass'
[2012-01-06 15:31:00 -0500] thom: creating data bags from cookbooks is actually my favourite thing ever
[2012-01-06 15:31:00 -0500] ssd7: Unfortunately: if ! node[:apahce].nil? && node[:apache][:allowed_openids]
[2012-01-06 15:31:00 -0500] ssd7: modulo typos.
[2012-01-06 15:32:00 -0500] CharlieSu: ssd7: so you have to test for apache first ?
[2012-01-06 15:32:00 -0500] dyer: Question, anyone have any idea why this is bitching at me ?
[2012-01-06 15:32:00 -0500] dyer:   default[:bind9][:masters] = search(:node,"role:bind_master").select{|e| e.ec2['placement_availability_zone'].start_with?(node.ec2['placement_availability_zone'][0..-2])}.collect{|e| e.ec2["local_ipv4"]}
[2012-01-06 15:33:00 -0500] dyer: ./var/chef/cache/cookbooks/bind9/attributes/default.rb:24:in `block in from_file': undefined method `ec2' for :node:Symbol (NoMethodError)
[2012-01-06 15:33:00 -0500] dyer: works fine in shef
[2012-01-06 15:33:00 -0500] ssd7: CharlieSu: Yes.  However...one sec.
[2012-01-06 15:33:00 -0500] fearoffish: dyer: use a pastie service next time, please ;-)
[2012-01-06 15:33:00 -0500] dyer: generally I would for anything over 2 lines
[2012-01-06 15:33:00 -0500] dyer: but ok, 1 line limit, got it ;)
[2012-01-06 15:33:00 -0500] fearoffish: it hurts my eyes for anything over 1 :)
[2012-01-06 15:34:00 -0500] dyer: roger roger
[2012-01-06 15:35:00 -0500] fearoffish: I use aws cloudformation to create my instances, and userdata runs chef-solo to install chef-client, and then I use chef-client to run against the opscode server.
[2012-01-06 15:35:00 -0500] fearoffish: My question is, once I've run chef-client will it remember my roles or will I always need to -j roles.json?
[2012-01-06 15:35:00 -0500] fearoffish: having run it once, looking on the opscode web console I see no roles or recipes for that node, so I assume I'm missing something.  Do I *have* to knife bootstrap it?
[2012-01-06 15:36:00 -0500] fearoffish: it clearly registers the nodes just fine
[2012-01-06 15:38:00 -0500] ssd7: CharlieSu: Sorry, I though I might have an example with a bit terser syntax, but I don't.
[2012-01-06 15:39:00 -0500] ssd7: CharlieSu: But in general, I don't know a way to get around testing for intermediate keys in a case like that.
[2012-01-06 15:40:00 -0500] dyer: fearoffish, is thre already a node registered by that name ?
[2012-01-06 15:40:00 -0500] fearoffish: dyer: no, I delete it every time
[2012-01-06 15:41:00 -0500] CharlieSu: ssd7: thanks!
[2012-01-06 15:42:00 -0500] CharlieSu: ssd7: i find it strange that it only started becoming a problem when i upgraded from ruby 1.8 to 1.9
[2012-01-06 15:44:00 -0500] ssd7: CharlieSu: Hmm.  Are you sure nothing else changed about the same time.  As far as I know you would get the same error in both 1.8 and 1.9.
[2012-01-06 15:44:00 -0500] CharlieSu: ssd7: well i've moved to omnibus..  but nothing else has changed that i know of.  i'm fairly certain unless Git is lying to me
[2012-01-06 15:45:00 -0500] ssd7: fearoffish: When you ran chef-client and found that it hadn't saved the roles and recipes, are you sure that the run finished without error?
[2012-01-06 15:45:00 -0500] fearoffish: ssd7: good question, I think it did but can't be sure
[2012-01-06 15:46:00 -0500] fearoffish: ssd7: so as long as you're saying it *should* save those, I'm happy debugging further happy knowing I'm on the right path :)
[2012-01-06 15:46:00 -0500] fearoffish: thanks
[2012-01-06 15:47:00 -0500] ssd7: fearoffish: Yes, at the end of the chef-client run it should save all node data back to the server, including the run_list.  If it doesn't complete, however, or if there is a permission problem on the final save (Hosted Chef issue, mostly) then the save won't happen since in 0.10+ we only save at the end.
[2012-01-06 15:50:00 -0500] fearoffish: ssd7: thanks for the info
[2012-01-06 15:50:00 -0500] fearoffish: another question!
[2012-01-06 15:51:00 -0500] fearoffish: if I have a role file with an override_attribute in it, is there a reason that might include a recipe of the same name?
[2012-01-06 15:52:00 -0500] fearoffish: I just removed a role that had no run_list set in it, just a single override_attribute, and the recipe I was having problems with (it installed it and I couldn't figure out why) is no longer installed
[2012-01-06 15:52:00 -0500] fearoffish: in short, a role with just an override attribute, when removed, stopped installing a recipe
[2012-01-06 15:53:00 -0500] fearoffish: I find this odd, and can't explain it because I thought only a 'depends' could do that
[2012-01-06 15:53:00 -0500] fearoffish: there's a small possibility that there's a conditional somewhere in our recipes that includes it instead, but I can't find one
[2012-01-06 15:55:00 -0500] dyer: Anyone have a chance to take a look at the exception I was getting ?
[2012-01-06 16:00:00 -0500] fearoffish: ignore my issue, it would seem I told it to run that recipe for that environment...even though I'm sure I deleted it.
[2012-01-06 16:29:00 -0500] miketheman: another amazon linux ami #fail
[2012-01-06 16:30:00 -0500] miketheman: the default syslog package installed is sysklogd, and trying the rsyslog recipe dumps out a conflict
[2012-01-06 16:30:00 -0500] miketheman: Error:  file /etc/logrotate.d/syslog from install of rsyslog-4.6.2-1.6.amzn1.x86_64 conflicts with file from package sysklogd-1.4.1-46.8.amzn1.x86_64
[2012-01-06 16:31:00 -0500] miketheman: seems like the only "sane" way to process this package's swap-out with rsyslog is via `yum shell` - to tell it to a) add rsyslog; b) remove sysklogd; in the same action
[2012-01-06 16:31:00 -0500] jbz: miketheman: You can't just put a remove and an install in order?
[2012-01-06 16:32:00 -0500] miketheman: if I try a `yum remove sysklogd` - the dependency tree is CRAY problematic
[2012-01-06 16:32:00 -0500] jbz: ahhh.
[2012-01-06 16:32:00 -0500] miketheman: some ~50 packages
[2012-01-06 16:32:00 -0500] miketheman: from ntp to emacs, sendmail to perl-Git. :S
[2012-01-06 16:32:00 -0500] jbz: ...wow,
[2012-01-06 16:32:00 -0500] jbz: fail.
[2012-01-06 16:32:00 -0500] miketheman: yep
[2012-01-06 16:33:00 -0500] jtimberman: yay package management systems.
[2012-01-06 16:33:00 -0500] jtimberman: creating dependencies where there are none.
[2012-01-06 16:33:00 -0500] miketheman: yes.
[2012-01-06 16:33:00 -0500] jtimberman: also, fuck cups :)
[2012-01-06 16:33:00 -0500] jtimberman: and that it is a dependency of lsb-base or whatever. :-|
[2012-01-06 16:33:00 -0500] miketheman: surprisingly, does not depend on a syslog daemon
[2012-01-06 16:33:00 -0500] jtimberman: no, you can just spool the logs to the printer.
[2012-01-06 16:34:00 -0500] miketheman: I prefer to Google CloudPrint. ;)
[2012-01-06 16:34:00 -0500] miketheman: https://github.com/armooo/cloudprint
[2012-01-06 16:34:00 -0500] miketheman: hah
[2012-01-06 16:34:00 -0500] miketheman: anyways.
[2012-01-06 16:35:00 -0500] miketheman: is chef's yum_package provider smart enough to process two commands, a la yum shell?
[2012-01-06 16:35:00 -0500] mkent_: miketheman,  that's odd, rsyslog should use Obsoletes to take over for sysklogd
[2012-01-06 16:35:00 -0500] mkent_: rpm -q --obsoletes rsyslog show anything for that package?
[2012-01-06 16:35:00 -0500] mkent_: er, rpm -qp --obsoletes foo.rpm or the yum equivalent
[2012-01-06 16:36:00 -0500] mkent_: yum_package can't do more than one thing at a time no
[2012-01-06 16:37:00 -0500] miketheman: mkent: sadness.
[2012-01-06 16:38:00 -0500] miketheman: mkent: not sure on the obsoletes view via yum, looking further
[2012-01-06 16:38:00 -0500] mkent_: this should work though - we used chef to replace sysklog with rsyslog a few months ago for all our centos 5 servers
[2012-01-06 16:39:00 -0500] mkent_: tried yum upgrade? believe only that will handle obsoletes
[2012-01-06 16:39:00 -0500] miketheman: did you launch new instances?
[2012-01-06 16:39:00 -0500] miketheman: yum upgrade rsyslog: Package(s) rsyslog available, but not installed.
[2012-01-06 16:40:00 -0500] miketheman: documented solutions show using yum shell to resolve this. http://www.thatsgeeky.com/2011/02/upgrading-sysklog-to-rsyslog/ http://wiki.rsyslog.com/index.php/Install_rsyslog_with_yum
[2012-01-06 16:40:00 -0500] CharlieSu: miketheman: do you have a cloudprint ready printer?  If so which one?  I've been looking into this
[2012-01-06 16:40:00 -0500] jbz: miketheman:  Can you install it with a force and then remove sysklogd?
[2012-01-06 16:41:00 -0500] miketheman: CharlieSu: nope, just a dalliance thought. I have an AirPrint one at home
[2012-01-06 16:41:00 -0500] miketheman: jbz: I will try
[2012-01-06 16:43:00 -0500] miketheman: hah. Q: How can I force yum to install something like rpm --nodeps --force can?
[2012-01-06 16:43:00 -0500] miketheman: A: You can't, and you shouldn't. yum won't allow you to shoot yourself in the foot like rpm will.
[2012-01-06 16:43:00 -0500] jbz: sigh.
[2012-01-06 16:43:00 -0500] jbz: "This is why it's *better* than RPM!!!"
[2012-01-06 16:44:00 -0500] miketheman: well, I'm sure it's saved more than one person from making bad decisions
[2012-01-06 16:44:00 -0500] mkent_: ah sorry miketheman we are using a backported version of rsyslog. the best solution to make chef happy is to rebuild that package with "Obsoletes: sysklogd", then yum upgrade sysklogd will pull it in as a replacement
[2012-01-06 16:44:00 -0500] mkent_: or so some script block voodoo to get yum shell going :)
[2012-01-06 16:44:00 -0500] miketheman: mkent: I'm not gonna rebuild the package, probably going with yum shell script voodoo
[2012-01-06 16:45:00 -0500] jbz: miketheman:  Have you used fpm?  It makes package building...MUCH MUCH nicer.
[2012-01-06 16:46:00 -0500] miketheman: jbz: yes, and it's awesome. but still not an option, b/c that increases the pieces of self-hosted stuff we have to maintain
[2012-01-06 16:46:00 -0500] miketheman: whereas a yum shell script should be "cleaner"
[2012-01-06 16:46:00 -0500] fearoffish: today is full of fail for me
[2012-01-06 16:47:00 -0500] jbz: Understood.
[2012-01-06 16:47:00 -0500] fearoffish: in my attributes file I set default[:postgresql][:dir] = "/etc/postgresql/#{node[:postgresql][:version]}/main", and I set that variable in a role...the variable is 9.1
[2012-01-06 16:47:00 -0500] miketheman: despite all linux ami crap being a whole lotta fail
[2012-01-06 16:47:00 -0500] fearoffish: when it hits the recipe, the dir is set to 9.0 (the default) not the 9.1 that it should be
[2012-01-06 16:47:00 -0500] jbz: miketheman: I lost that fight, and once you lose it, additional bits of packaging aren't a big deal. ;-)
[2012-01-06 16:47:00 -0500] fearoffish: what did I miss?
[2012-01-06 16:48:00 -0500] mkent_: good luck miketheman, if you get yum shell going and can share the solution i'd be interested, sounds handy :)
[2012-01-06 16:48:00 -0500] miketheman: mkent: sure
[2012-01-06 16:48:00 -0500] miketheman: jbz: it's once you've cracked the barrier, more cracks make their way in much faster
[2012-01-06 16:52:00 -0500] fearoffish: yep, totally confused.  I Chef::Log.info the postgresql version and it shows as 9.1, but in the attributes file when it sets the postgres dir, it uses the 9.0 that is set in the default attributes of the recipe, therefore ignoring the role default attributes
[2012-01-06 16:53:00 -0500] fearoffish: what did I miss?
[2012-01-06 16:53:00 -0500] jbz: fearoffish: Is it possible it's an ordering problem?  i.e. the variable you're building in the defaults is built prior to loading the role variable?
[2012-01-06 16:54:00 -0500] jbz: So even though the role variable gets overridden, it's too late?
[2012-01-06 16:54:00 -0500] fearoffish: is that possible? precedence should take order here
[2012-01-06 16:54:00 -0500] jbz: Precedence isn't the same as ordering
[2012-01-06 16:54:00 -0500] fearoffish: default attributes in a role should always be used above recipe ones
[2012-01-06 16:54:00 -0500] jbz: default attributes in a role should always be used above recipe ones *when the two conflict*
[2012-01-06 16:54:00 -0500] fearoffish: hmm, okay, ordering I'm unaware of then
[2012-01-06 16:55:00 -0500] jbz: I'm not saying this is what's happening, just that it's possible
[2012-01-06 16:55:00 -0500] jbz: try setting the default variable (version) in the defaults file but building the other variable in the recipe
[2012-01-06 16:55:00 -0500] fearoffish: it does make sense though
[2012-01-06 16:55:00 -0500] fearoffish: okay
[2012-01-06 16:56:00 -0500] jbz: Since it 'knows' that default attribtues will be overridden by later ones, it might be 'building' all the default attributes from the file before starting the load of the role ones
[2012-01-06 16:56:00 -0500] fearoffish: sounds silly to me, but feasible ;-)
[2012-01-06 16:57:00 -0500] kallistec: fearoffish: yeah, you can't really compute values in attributes files based on other attributes
[2012-01-06 16:57:00 -0500] fearoffish: ahh
[2012-01-06 16:57:00 -0500] kallistec: the role attributes are applied to the default later in the chef run
[2012-01-06 16:58:00 -0500] fearoffish: so computed ones should always be in a recipe
[2012-01-06 16:58:00 -0500] fearoffish: gotcha
[2012-01-06 16:58:00 -0500] kallistec: yep
[2012-01-06 16:58:00 -0500] fearoffish: thanks
[2012-01-06 16:58:00 -0500] jbz: whew I wasn't talking out my rear. :-)
[2012-01-06 16:58:00 -0500] jbz: ...or I was, but got lucky.
[2012-01-06 16:58:00 -0500] kallistec: you can set them as default attributes if you like with node.default[:foo] = "bar"
[2012-01-06 17:02:00 -0500] fearoffish: kallistec: from a recipe?
[2012-01-06 17:02:00 -0500] fearoffish: I just went with node[:rar
[2012-01-06 17:02:00 -0500] kallistec: fearoffish: yeah, basically in an attribute file we do some ruby magic that's the same as if you had `node.` in front of everything (`node` is `self`)
[2012-01-06 17:03:00 -0500] fearoffish: aha, context
[2012-01-06 17:03:00 -0500] fearoffish: righteo, thanks
[2012-01-06 17:03:00 -0500] kallistec: so all the default, default_unless, and so on are available in recipes, you just need to specify `node` as the receiver
[2012-01-06 17:10:00 -0500] dyer: Hello, I am having an issue with chef, I am hoping someone can help me with. I am installing our app server and afterward I install the chef-client recipe.  So there is the initial chef-client run which does the intial deploy and then the last thing is does is depoy chef-client and start it.  so essentually there are two chef runs right after each other.  The problem is that one file seems to be recognized as different between
[2012-01-06 17:10:00 -0500] dyer:  those two runs ( xmpp.xml ) and so the second run does another restart of the app server, which is presenting a problem for us.   Nothing is changing this file on our end at all   I have logs here for both runs and the backup version of the xmpp.xml https://gist.github.com/62cb214a6243232182ec
[2012-01-06 17:11:00 -0500] dyer: the first run replaces the "Vanilla" xmpp.xml w/ a chef'erized one, but it looks like the second run sees the prestine xmpp.xml file and replaces it again
[2012-01-06 17:11:00 -0500] dyer: any help would be WONDERFUL
[2012-01-06 17:12:00 -0500] jbz: dyer: Any reason you're doing the chef-client cookbook *second*?
[2012-01-06 17:12:00 -0500] ukio: ohai!
[2012-01-06 17:12:00 -0500] jbz: We always make sure to run chef-client *first*, ensuring it does the whole pivot and etc. with as clean/untouched a system as possible...
[2012-01-06 17:13:00 -0500] jbz: We have a generic->specific runlist philosophy, and since *every* node runs chef-client, it's part of the 'base' role that runs first.
[2012-01-06 17:14:00 -0500] miketheman: GAH. Apparently, this is all part of AWS Linux AMI fail, as they replaced sysklogd with rsyslog at some point on newer AMI instances
[2012-01-06 17:14:00 -0500] miketheman: (sorry to derail current convo)
[2012-01-06 17:14:00 -0500] jbz: (i's IRC.  If you can't maintain a conversation stack, you shouldn't be here. :-) )
[2012-01-06 17:15:00 -0500] jbz: ohai ukio!
[2012-01-06 17:15:00 -0500] cwj: dyer: probably need to gist the recipe and template for generating xmpp.xml
[2012-01-06 17:15:00 -0500] miketheman: United Kingdom Input/Output?
[2012-01-06 17:16:00 -0500] dyer: how can I use chef-client first and have it use these parameters ( chef-client -j /etc/chef/first-boot.json -L /etc/chef/first-boot.log --node-name node1.testing.voxeolabs.net --environment ec2_rayo_functional_tests )
[2012-01-06 17:17:00 -0500] dyer: cwj: https://gist.github.com/0dd70a85481084395b4c
[2012-01-06 17:17:00 -0500] ukio: hey guys, how do you get a "base OS install" on an ESX server which you can then knife bootstrap? for local development with vagrant i'm using VeeWee to build the "base OS install". Ideally I would want to use that for bootstrapping a base OS install on the ESX server too. Anyone having done that already, or having a similar problem?
[2012-01-06 17:18:00 -0500] miketheman: ukio: depending on the distro, cobbler https://fedorahosted.org/cobbler/
[2012-01-06 17:20:00 -0500] miketheman: ok, seems like amazon got smart and obsoleted sysklog with rsyslog in the 2011.02 edition.
[2012-01-06 17:20:00 -0500] miketheman: (ref https://aws.amazon.com/amazon-linux-ami/2011.02-release-notes/)
[2012-01-06 17:21:00 -0500] jbz: dyer:  You're using a vanilla chef-client cookbook?
[2012-01-06 17:21:00 -0500] miketheman: most of my instances were hand-built on a prior version, so terminating/relaunching isn't an option at this time
[2012-01-06 17:21:00 -0500] dyer: jbz, what I have been doing is using Fog to provision the instance, and then via userdata pass in the runlist ( first-boot.json ) and start chef-client w/ the node name, env, and runlist
[2012-01-06 17:22:00 -0500] jbz: yep that's what we do
[2012-01-06 17:22:00 -0500] dyer: jbz, for the most part, few mods to for centos, to get me interval as an attribute, and make loglevel adjustable
[2012-01-06 17:22:00 -0500] itwasntandy: miketheman: you mean its not all templated in chef, enabing you to rebuild it all in seconds? :(
[2012-01-06 17:22:00 -0500] ukio: @miketheman: thanks, will have a look at it! wondering if i could reuse the veewee definitions i use for local development with vagrant, so that the dev and prod environments are as close as possible
[2012-01-06 17:22:00 -0500] jbz: dyer:  So your question is how to preserve the node-name and the environment?
[2012-01-06 17:22:00 -0500] miketheman: itwasntandy: it will be, soon enough!
[2012-01-06 17:23:00 -0500] dyer: yea, the base role sets the hostname and registers the new instance w/ dns
[2012-01-06 17:23:00 -0500] miketheman: itwasntandy: this is why startups _eventually_ hire ops peeps
[2012-01-06 17:23:00 -0500] itwasntandy: heh
[2012-01-06 17:24:00 -0500] jbz: dyer:  We set [:chef-client][:environment] in the attributes file (first-boot.json in your example)
[2012-01-06 17:24:00 -0500] miketheman: ukio: since most of veewee definitions are of the kickstart/pre-seed nature, it should be a pretty painless transformation
[2012-01-06 17:24:00 -0500] jbz: can you set the nodename there too?
[2012-01-06 17:24:00 -0500] jbz: You're not limited to runlist.
[2012-01-06 17:24:00 -0500] dyer: ok, just not sure how to do that per node
[2012-01-06 17:25:00 -0500] jbz: ah, yeah.  We generate the userdata and attribs file from a console.
[2012-01-06 17:25:00 -0500] jbz: (automagically).
[2012-01-06 17:25:00 -0500] dyer: not sure I follow that last statement
[2012-01-06 17:25:00 -0500] dyer: can you elaborate a bit
[2012-01-06 17:25:00 -0500] jbz: Sorry.  I mean that we have code generating the userdata for each instance we bring up and customizing it.
[2012-01-06 17:26:00 -0500] jbz: So it writes customized attributes files with custom values.
[2012-01-06 17:26:00 -0500] miketheman: anyone have a quick sample of the "correct" way to execute a resource, only if a package is *not* installed?
[2012-01-06 17:27:00 -0500] dyer: yea, that part still doesnt make much sense to me
[2012-01-06 17:27:00 -0500] jbz: miketheman:  I only know how to do it expensively (have a not_if dpkg -l | grep <package>, basically)
[2012-01-06 17:27:00 -0500] dyer: how can I pass that in, do I write it to a file or something?
[2012-01-06 17:27:00 -0500] jbz: dyer: Oh!  Um, you're writing out a first-boot.json?  Or is that part of your AMI?
[2012-01-06 17:28:00 -0500] dyer: I am writing to it
[2012-01-06 17:28:00 -0500] jbz: OK, 1 sec, let me gist one of ours
[2012-01-06 17:29:00 -0500] dyer: Here is my deployer script in Fog: https://gist.github.com/7595307f339d5e92ae3e
[2012-01-06 17:30:00 -0500] jbz: dyer:  OK, not that different.  Let me tweak and post, 1 minute.
[2012-01-06 17:32:00 -0500] jbz: dyer:  Your script seems to already be setting the environment inside the bootstrap?
[2012-01-06 17:33:00 -0500] dyer: jbz, yea, here is my bootstrap https://gist.github.com/6357312f11788c1a5a25
[2012-01-06 17:34:00 -0500] dyer: ok, but thats my question, how do I set that at all, that part is not clear to me
[2012-01-06 17:34:00 -0500] jbz: OK I see.  Your script is using those values to generate the actual command line
[2012-01-06 17:34:00 -0500] jbz: Ah, also, I forgot one thing:  We don't set the nodename in the attributes file.  We set the nodename by writing out an /etc/chef/client.rb from the userdata, which contains "node_name   <value>".
[2012-01-06 17:34:00 -0500] jbz: (among all the other stuff.)
[2012-01-06 17:35:00 -0500] dyer: the only way I know how to get data from my machine into the chef runtime is to use first-boot.json, or via environments, roles, or cookbooks
[2012-01-06 17:35:00 -0500] jbz: nope, you can also use client.rb
[2012-01-06 17:36:00 -0500] dyer: for just node_name ?
[2012-01-06 17:36:00 -0500] jbz: if you set the nodename in client.rb, then the first time the client is run it will attempt to register with the chef server using that node_name value.
[2012-01-06 17:36:00 -0500] dyer: ok
[2012-01-06 17:36:00 -0500] jbz: Well, if you're running the chef-client, it loads a bunch of stuff from client.rb.  The two fields we use are the node_name and 'json_attribs' which tells it which json file to use for first run.
[2012-01-06 17:36:00 -0500] dyer: do I do that thru chef-client cookbook or do I use like sed in my bootstrap to add that
[2012-01-06 17:37:00 -0500] jbz: You're already doing that, but you're doing it in the command line.
[2012-01-06 17:37:00 -0500] dyer: I guess I could just append it to client.rb
[2012-01-06 17:37:00 -0500] dyer: ah, ok
[2012-01-06 17:37:00 -0500] jbz: We write out the entire client.rb as part of our bootstrap (userdata) prior to installing chef.
[2012-01-06 17:37:00 -0500] jbz: (er, prior to running it.)
[2012-01-06 17:37:00 -0500] dyer: yea, I got ya
[2012-01-06 17:38:00 -0500] jbz: So, to recap:  If you put the node_name into the client.rb and the environment into the first-boot.json *before * you run chef, all will work.
[2012-01-06 17:38:00 -0500] dyer: in firstboot.json ? thought env would go in client.rb ?
[2012-01-06 17:38:00 -0500] dyer: http://wiki.opscode.com/display/chef/Chef+Configuration+Settings#ChefConfigurationSettings-environment
[2012-01-06 17:38:00 -0500] jbz: Yep you can put it there.
[2012-01-06 17:39:00 -0500] jbz: Oh right, sorry, yes, we put it there.  We *also* put it into the chef-client attributes so that the client install works properly.
[2012-01-06 17:39:00 -0500] jbz: Dunno if your chef-client needs that.
[2012-01-06 17:39:00 -0500] jbz: Sorry, I know I'm a bit scattered here.
[2012-01-06 17:40:00 -0500] dyer: k, yea, that makes sense
[2012-01-06 17:40:00 -0500] dyer: probably shuld be in the environent json
[2012-01-06 17:40:00 -0500] dyer: and node specific stuff goes in thru the bootstrap and into client.rb
[2012-01-06 17:40:00 -0500] jbz: Right, so it's in  client.rb so that that first run of chef happens in the proper environment, and it's in the json so that the chef-client cookbook sets up subsequent runs properly.
[2012-01-06 17:40:00 -0500] jbz: Yep
[2012-01-06 17:41:00 -0500] dyer: can you rephrase that last statment, to make sure I got it
[2012-01-06 17:41:00 -0500] dyer: I think we are on the same page but not %100
[2012-01-06 17:41:00 -0500] dyer: maybe 90%
[2012-01-06 17:41:00 -0500] jbz: Heh all my fault
[2012-01-06 17:41:00 -0500] jbz: so there are two things we're writing out:
[2012-01-06 17:42:00 -0500] jbz: 1) we're writing out config data so that the first (non-chef-client cookbook configured) chef client run goes properly, and that goes into client.rb and first-boot.json.  The environment data and the node_name go into client.rb.
[2012-01-06 17:43:00 -0500] jbz: 2) then we're also putting attribute data into first-boot.json which is for our version of the chef-client *cookbook* which includes the environment we want the node to run in under subsequent, chef-client *cookbook*-controlled client runs.
[2012-01-06 17:43:00 -0500] jbz: ...damn it, that was probably more confusing.
[2012-01-06 17:43:00 -0500] dyer: yea
[2012-01-06 17:43:00 -0500] dyer: let me tell you what I have
[2012-01-06 17:43:00 -0500] jbz: kk
[2012-01-06 17:43:00 -0500] dyer: and you can correct that
[2012-01-06 17:43:00 -0500] miketheman: since I don't want to have the recipe drop to command to do a not_if?(`rpm -qa | grep mypackage`), can I use something from the Chef::Provider::Package::Yum::YumCache? I'm looking at the installed_version method, and I'm not understanding it
[2012-01-06 17:45:00 -0500] dyer: so I have a ton of environments, but here we are talking about ec2_rayo_functional_tests, which is comprised of 4 nodes w/ varying roles.   I am going to pass in these nodes run list into first-boot.json, like I have been doing.  I am then going to write into client.rb  the following:
[2012-01-06 17:45:00 -0500] dyer: json_attribs
[2012-01-06 17:45:00 -0500] dyer: node_name
[2012-01-06 17:45:00 -0500] dyer: I am then going to set the actual environment in the environment file for chef client.
[2012-01-06 17:46:00 -0500] dyer: is that correct?
[2012-01-06 17:47:00 -0500] jbz: dyer:  You also need to set 'environment     ec2_rayo_functional_tests' in the client.rb
[2012-01-06 17:47:00 -0500] dyer: ok
[2012-01-06 17:48:00 -0500] dyer: then I just install chef-client first
[2012-01-06 17:48:00 -0500] jbz: Here, see if this helps, it's the section of our ec2 userdata boot script which writes out client.rb and our version of first-boot.json:  https://gist.github.com/1571626
[2012-01-06 17:48:00 -0500] dyer: and all should be merry, pink unicorns, rainbows, and all that jazz
[2012-01-06 17:48:00 -0500] jbz: Note that in our runlist, the first cookbook that runs is the chef-client cookbook.
[2012-01-06 17:49:00 -0500] dyer: yep
[2012-01-06 17:49:00 -0500] jbz: That will also name the node based on its role + its EC2 instance ID.
[2012-01-06 17:50:00 -0500] dyer: k
[2012-01-06 17:50:00 -0500] jbz: I gotta learn to just paste code rather than try to explain it, I'm sort of ass at explaining. :-)
[2012-01-06 17:50:00 -0500] dyer: Where is the rest of your run list
[2012-01-06 17:50:00 -0500] dyer: no worries,  am w/ u now :)
[2012-01-06 17:50:00 -0500] dyer: even before the code, but it did help :)
[2012-01-06 17:50:00 -0500] jbz: Oh - that initial runlist contains the role we're running the node under, and we stick the rest of our runlist into that role.
[2012-01-06 17:50:00 -0500] dyer: here:     "<%= chef_role_as_runlist %>" ?
[2012-01-06 17:50:00 -0500] jbz: Exactly
[2012-01-06 17:51:00 -0500] dyer: can you past an example of that line rendered
[2012-01-06 17:51:00 -0500] jbz: so let's say that node was 'foo-sandbox-app'
[2012-01-06 17:51:00 -0500] dyer: paste
[2012-01-06 17:51:00 -0500] jbz: oh
[2012-01-06 17:51:00 -0500] jbz: yeah, one sec
[2012-01-06 17:51:00 -0500] miketheman: mkent: you around to explain yumcache?
[2012-01-06 17:52:00 -0500] jbz: dyer:  OK, added a rendered example attribs file to https://gist.github.com/1571626
[2012-01-06 17:52:00 -0500] jbz: in that example, there's a role on the chef server named "locke-validation-app" which contains the rest of the runlist.
[2012-01-06 17:53:00 -0500] dyer: awesome
[2012-01-06 17:53:00 -0500] dyer: let me run w/ this for a bit
[2012-01-06 17:53:00 -0500] jbz: Hope it helps!
[2012-01-06 17:53:00 -0500] dyer: refactor some jazz on my side and get back to u if I have any questions
[2012-01-06 17:53:00 -0500] dyer: yes it does
[2012-01-06 17:53:00 -0500] jbz: We just have our console app modify the role runlist from that point on so the actual node runlist doesn't change.
[2012-01-06 17:53:00 -0500] dyer: think this is exactly were I have been hung up on
[2012-01-06 17:53:00 -0500] jbz: Here's the catch:
[2012-01-06 17:53:00 -0500] jbz: (yes, there is a catch!)
[2012-01-06 17:53:00 -0500] dyer: oh shit
[2012-01-06 17:53:00 -0500] mkent_: miketheman, your trying to avoid running rpm -qa?
[2012-01-06 17:53:00 -0500] dyer: first born?
[2012-01-06 17:53:00 -0500] miketheman: yeah.
[2012-01-06 17:53:00 -0500] dyer: you cant have him
[2012-01-06 17:54:00 -0500] jbz: Since Chef 0.10, chef stopped saving node state until the completion of a successful run
[2012-01-06 17:54:00 -0500] miketheman: mkent: unless using the yumcache class is more expensive
[2012-01-06 17:54:00 -0500] jbz: so if the runlist bombs on the first client run of the node, it will *keep running* (because we've pivoted to the chef-client service as the first action) but it will from that point on have an *empty runlist on the server*
[2012-01-06 17:54:00 -0500] mkent_: shouldn't be, one sec
[2012-01-06 17:54:00 -0500] jbz: so you have to rescue the node by logging in an restarting the chef service, which re-reads the attribs file for the first run again.
[2012-01-06 17:55:00 -0500] dyer: ok
[2012-01-06 17:55:00 -0500] miketheman: mkent: tried `foo = Chef::Provider::Package::Yum::YumCache.installed_version("rsyslog")`
[2012-01-06 17:55:00 -0500] miketheman: mkent: got a NoMethod
[2012-01-06 17:55:00 -0500] jbz: We intend to address this by writing a 'pre-run handler' which saves the node state before it tries to converge but after it loads the attribs file.
[2012-01-06 17:55:00 -0500] dyer: So one more question, whats the benifit of having the instance id in the hostname
[2012-01-06 17:55:00 -0500] miketheman: mkent: but I can see that it exists: https://github.com/opscode/chef/blob/0.10.8/chef/lib/chef/provider/package/yum.rb#L827-829
[2012-01-06 17:56:00 -0500] jbz: dyer: Oh, purely so that if we have to go manually diagnose stuff, we can do it more easily with the EC2 console and chef-console open.  Also, we have many nodes with each project/env/role, so the instance ID disambiguates them.
[2012-01-06 17:56:00 -0500] jbz: That triplet is used to define a particular *cloud* on our setup
[2012-01-06 17:56:00 -0500] jbz: so we might have five nodes in the cloud.
[2012-01-06 17:57:00 -0500] dyer: k, I'll keep that in mind
[2012-01-06 17:57:00 -0500] mkent_: miketheman, how about: Chef::Provider::Package::Yum::YumCache.instance.installed_version("rsyslog") ?
[2012-01-06 17:57:00 -0500] dyer: so far I have been using metadata for that
[2012-01-06 17:57:00 -0500] dyer: tags
[2012-01-06 17:57:00 -0500] jbz: yeah
[2012-01-06 17:57:00 -0500] jbz: but the nodename has to differ so that they can all register with the chef server.
[2012-01-06 17:57:00 -0500] jbz: Can't register duped nodenames.
[2012-01-06 17:58:00 -0500] dyer: well yea, we have been using subdomains
[2012-01-06 17:58:00 -0500] jbz: oh, sorry - we're not using hostnames as chef server nodenames.
[2012-01-06 17:59:00 -0500] dyer: node1.beta.domain.com, node1.staging.domain.com, ect
[2012-01-06 17:59:00 -0500] dyer: oh, I am
[2012-01-06 17:59:00 -0500] dyer: any problem w/ that route
[2012-01-06 17:59:00 -0500] jbz: We had too much trouble getting Ubuntu to not use the stupid internal Amazon IPs as hostnames.
[2012-01-06 17:59:00 -0500] dyer: yea, Ubuntu,...
[2012-01-06 17:59:00 -0500] jbz: When the Alestic AMIs come up, they've already set their hostname, and it's not always consistent how.
[2012-01-06 17:59:00 -0500] dyer: Wish we could use ubuntu
[2012-01-06 18:00:00 -0500] miketheman: mkent: cool, do I have to use this in the context of a ruby block?
[2012-01-06 18:00:00 -0500] jbz: So we decided that our chef node names wouldn't be hostnames.
[2012-01-06 18:00:00 -0500] dyer: right on
[2012-01-06 18:00:00 -0500] jbz: Thus we didn't have to rely on ohai or ubuntu being consistent.  Plus, we get to have human-readable role-based info in the nodename.
[2012-01-06 18:00:00 -0500] mkent_: yeah not_if { Chef::Provider::Package::Yum::YumCache.instance.installed_version("rsyslog") } should cover it i think
[2012-01-06 18:01:00 -0500] miketheman: w00t.
[2012-01-06 18:01:00 -0500] miketheman: thanks
[2012-01-06 18:01:00 -0500] dyer: k, while I have your attention
[2012-01-06 18:01:00 -0500] dyer: unrelated question, if you dont mind
[2012-01-06 18:01:00 -0500] jbz: sure
[2012-01-06 18:02:00 -0500] dyer: https://gist.github.com/caaaf699b2cdc54b6c44
[2012-01-06 18:03:00 -0500] dyer: So I have that as my attributes file, my goal is to make slave DNS servers set the maste to any role:bind_master in the same region
[2012-01-06 18:03:00 -0500] dyer: but its giving me this when I run i t
[2012-01-06 18:03:00 -0500] dyer: ./var/chef/cache/cookbooks/bind9/attributes/default.rb:24:in `block in from_file': undefined method `ec2' for :node:Symbol (NoMethodError)
[2012-01-06 18:03:00 -0500] dyer: the search works fine in shef -z
[2012-01-06 18:03:00 -0500] dyer: just not int he attributes fles
[2012-01-06 18:03:00 -0500] dyer: files
[2012-01-06 18:07:00 -0500] mkent_: dyer, in your "start_with?" maybe try node['ec2']['placement_availability_zone'] ?
[2012-01-06 18:09:00 -0500] dyer: I did, same behavior
[2012-01-06 18:10:00 -0500] dyer: [Fri, 06 Jan 2012 13:10:07 -0500] FATAL: NoMethodError: undefined method `ec2' for :node:Symbol
[2012-01-06 18:11:00 -0500] BryanWB: all, i wrote a sudo lwrp, comments appreciated https://github.com/bryanwb/cookbooks/blob/master/sudo/README.md
[2012-01-06 18:12:00 -0500] BryanWB: it has a much simpler api than the previous version i came up with
[2012-01-06 18:15:00 -0500] jkyle: I'm playing with the knife exec command to fetch specific attributes. I fashioned this after the wiki page examples:
[2012-01-06 18:16:00 -0500] jkyle: knife exec -E 'nodes.search("role:somerole") { |n| puts n.network.interfaces.eth0.addresses}'
[2012-01-06 18:16:00 -0500] miketheman: for those interested in my results (mkent, jbz, others) - here's a gist to handle this. https://gist.github.com/1571737
[2012-01-06 18:16:00 -0500] jbz: sorry, dyer, 1 sec on phone
[2012-01-06 18:17:00 -0500] jkyle: the return that I get is not a string though, but a #<Chef::Node::Attribute:0x10a1545b8>. Is there a way to get a pretty print of that attribute? like {:foo => bar, :bah => baz}
[2012-01-06 18:18:00 -0500] mkent_: very cool, thanks miketheman
[2012-01-06 18:19:00 -0500] tierra: in the opscode application cookbook, if it loads multiple applications of the same type, does it ignore already applied recipes?
[2012-01-06 18:19:00 -0500] defghanistan: I am trying to bootstrap some boxes and they are choking on: client.pem is not present, registering: and then the connection is refused 5 times by api.opscode.com. I assume this is an issue with my knife client but I cant figure out where. I just requested a new pem key from opscode platform and threw that into my .chef, is this the validator for my org or what?
[2012-01-06 18:20:00 -0500] jkyle: I tried the to_json method, but it has no effect
[2012-01-06 18:20:00 -0500] jtimberman: tierra: chef only loads a recipe one time, so the application cookbook as it is written right now cannot be used to deploy multiple applications on the same system.
[2012-01-06 18:20:00 -0500] jkyle: to_hash prints out a flat string "foobarbahbaz"
[2012-01-06 18:20:00 -0500] ssd7: defghanistan: When you say the connection was refused, what do you mean?  Are you receiving a specific error? ECONNREFUSED?
[2012-01-06 18:20:00 -0500] jessicab: defghanistan - sounds like youre having issues connecting actually.. you should see a 403 or 401 error if it was the validator key
[2012-01-06 18:21:00 -0500] tierra: thanks jtimberman
[2012-01-06 18:21:00 -0500] jtimberman: tierra: coderanger has done some work to convert the cookbook to use a lightweight resource/provider to achieve multiple-app functionality
[2012-01-06 18:21:00 -0500] jtimberman: COOK-634 is the ticket tracking that effort.
[2012-01-06 18:21:00 -0500] BryanWB: defghanistan: u have the kewlest irc nic evar
[2012-01-06 18:21:00 -0500] tierra: that's what I was just going to ask next (if LWRP were only able to be run multiple times)
[2012-01-06 18:22:00 -0500] jtimberman: making it a resource means it can be used more flexibly
[2012-01-06 18:22:00 -0500] tierra: jtimberman: any idea where his work is or if it's available to look at?
[2012-01-06 18:22:00 -0500] defghanistan: Exact error: ERROR: Connection refused connecting to api.opscode.com:443 for /organizations/(companyname)/clients, retry 1/5
[2012-01-06 18:22:00 -0500] jtimberman: tierra: http://github.com/coderanger/cookbooks/tree/COOK-634 if i recall correctly
[2012-01-06 18:22:00 -0500] jtimberman: i believe the ticket has a link to the branch
[2012-01-06 18:22:00 -0500] tierra: thanks
[2012-01-06 18:22:00 -0500] defghanistan: But if it's refusing the connection aren't I getting out to opscode? Like this isn't a proxy issue, right?
[2012-01-06 18:24:00 -0500] jessicab: defghanistan - usually that means it just cant reach us, could be a firewall or something blocking the traffic
[2012-01-06 18:25:00 -0500] defghanistan: jessicab: Thank you, I'll try moving these boxes into DMZ.
[2012-01-06 18:25:00 -0500] BryanWB: good night all
[2012-01-06 18:25:00 -0500] spyvsspy: can anyone point me to a resource, on how to create a json file to use with boostrap?
[2012-01-06 18:25:00 -0500] spyvsspy: I cant find any docs on the site
[2012-01-06 18:26:00 -0500] jkyle: the queries also don't like when I attempt to index the ip address in a query like so: { |n| puts n[:network][:interfaces][:interfaces][:eth0][:addresses]["10.4.45.20"][:broadcast]}
[2012-01-06 18:26:00 -0500] jkyle: ERROR: knife encountered an unexpected error
[2012-01-06 18:26:00 -0500] jkyle: This may be a bug in the 'exec' knife command or plugin
[2012-01-06 18:28:00 -0500] jkyle: is that  bug I should file?
[2012-01-06 18:29:00 -0500] dajia: Hey, all.  I'm working on a custom ohai plugin.  Where do I put it so that ohai can find it?
[2012-01-06 18:35:00 -0500] kallen: dyer: did you get an answer to yer question yet wrt bind_master? i scrolled back and don't think i saw it. i'm interested..
[2012-01-06 18:37:00 -0500] ssd7: dajia: You can add a custom path to Ohai::Config[:plugin_path] and put it there.  Convention is something like /etc/chef/ohai_plugins.  For the purposes of chef client you can put the following in your client.rb: Ohai::Config[:plugin_path] << '/etc/chef/ohai_plugins/'
[2012-01-06 18:43:00 -0500] mmercer: lose/close
[2012-01-06 18:43:00 -0500] miketheman: mkent: I think I might also remove the file once its done, just to clean up
[2012-01-06 18:46:00 -0500] dajia: ssd7: thanks.  I tried that, and ran ohai -d /etc/chef/ohai_plugins, but my plugin isn't included.
[2012-01-06 18:47:00 -0500] c_t: anyone know off the top of their head how to get the version of a particular node's OS?
[2012-01-06 18:47:00 -0500] c_t: (like, say, squeeze or lenny if you're on Debian)
[2012-01-06 18:48:00 -0500] ssd7: dajia: Hmm.  I would have to look a bit closer and unforutnatley I'm about to be pulled away for a meeting.  I would try adding -l debug to get more output.  Are you sure it isn't loading.  Could it be that it just is failing and not creating attributes?
[2012-01-06 18:48:00 -0500] dajia: ssd7:  I wouldn't know if it were failing unless it threw an error.
[2012-01-06 18:49:00 -0500] mkent_: dyer, https://gist.github.com/65f3e638357dc233f344
[2012-01-06 18:49:00 -0500] dajia: It's not showing up in debug output at all
[2012-01-06 18:49:00 -0500] mkent_: root cause is chef/mixin/language isn't brought in for attributes i think
[2012-01-06 18:50:00 -0500] laurent\: c_t: knife status name:nodename ? :-)
[2012-01-06 18:50:00 -0500] miketheman: mkent: updated here, https://gist.github.com/1571737 for cleanup
[2012-01-06 18:50:00 -0500] mkent_: thanks :)
[2012-01-06 18:50:00 -0500] miketheman: sure thing.
[2012-01-06 18:51:00 -0500] miketheman: collaborative work, everyone wins
[2012-01-06 18:56:00 -0500] Cuzkey: did you use ohai c_t?
[2012-01-06 18:56:00 -0500] c_t: yeah
[2012-01-06 18:56:00 -0500] Cuzkey: platform?
[2012-01-06 18:56:00 -0500] bawt: platform is The Opscode Platform is a hosted chef server as a service by Opscode. Sign up at https://cookbooks.opscode.com/users
[2012-01-06 18:56:00 -0500] c_t: node[:platform_version]
[2012-01-06 18:57:00 -0500] c_t: (in my case I can rest easy that platform == "debian")
[2012-01-06 18:58:00 -0500] Cuzkey: cool
[2012-01-06 18:58:00 -0500] Cuzkey: thanks
[2012-01-06 18:58:00 -0500] miketheman: knife node show <nodename> -a platform_version
[2012-01-06 18:58:00 -0500] c_t: miketheman: wanted to know inside a recipe
[2012-01-06 18:59:00 -0500] miketheman: ah then yes, the other way.
[2012-01-06 19:10:00 -0500] kbader: has anyone bumped into this with chef-server 0.10.8?
[2012-01-06 19:10:00 -0500] kbader: http://pastebin.com/MLU9E8b1
[2012-01-06 19:31:00 -0500] dwhsix: is there a place to put code you want to share across cookbooks?  need to do anything to include it?
[2012-01-06 19:31:00 -0500] miketheman: in your pocket. ;)
[2012-01-06 19:32:00 -0500] dwhsix: ha - actually, I should search irc archives I think I asked this a few months ago :-(
[2012-01-06 19:32:00 -0500] kbader: fixed it, removed the 1.0.0.beta.4 version of the eventmachine gem
[2012-01-06 19:32:00 -0500] kbader: yay
[2012-01-06 19:32:00 -0500] dwhsix: I seem to recall response then was "write a gem", but I remember also finding a way to do it hmm...
[2012-01-06 19:33:00 -0500] jbz: dyer: Did you get your search thing working?
[2012-01-06 19:39:00 -0500] dyer: no, not yet, I had to step out for a min and am dealing w/ a fire this secondt
[2012-01-06 19:39:00 -0500] dyer: then the plan is to fix the deployment stuff and then try it again
[2012-01-06 19:50:00 -0500] gene_wood: Is anyone aware of a guide on upgrading Chef Server from 0.10.0 to 0.10.8? All I can find is this : http://wiki.opscode.com/display/chef/Upgrade+Instructions
[2012-01-06 19:50:00 -0500] gene_wood: which talks about upgrading pre 0.10.0 versions
[2012-01-06 19:52:00 -0500] jessicab: gene_wood - thats mostly about trying to upgrade from different versions, those are both 10 so you can do it just by following normal install instructions, like if you installed via gems you could use gem install chef to upgrade
[2012-01-06 19:55:00 -0500] gene_wood: got it
[2012-01-06 19:56:00 -0500] gene_wood: I'm assuming then that the differences between 0.10.0 and 0.10.8 lie only in the chef gem and that couchdb and other supporting pieces stay the same
[2012-01-06 19:58:00 -0500] gene_wood: hmm.. the process I followed when building out chef 0.10.0 server was to install the chef and chef-server gems and then run chef-solo with the https://s3.amazonaws.com/chef-solo/bootstrap-0.10.0.tar.gz file
[2012-01-06 19:59:00 -0500] gene_wood: i'm assuming the chef-solo bootstrap method for building a chef-server uses gems and so as you said a simple gem install would upgrade to 10.8?
[2012-01-06 20:00:00 -0500] jessicab: ah sorry, i was thinking chef-client.. there werent many changes though, mostly security fixes and little bugs, lots of windows stuff
[2012-01-06 20:01:00 -0500] gene_wood: hmm ok
[2012-01-06 20:06:00 -0500] gene_wood: jessicab : so you're saying that the doing a gem install of the chef 10.8 gem on chef-client would be the way to upgrade a client, but not chef-server?
[2012-01-06 20:08:00 -0500] jessicab: yea, not quite sure about server honestly
[2012-01-06 20:08:00 -0500] chip-: Crap.
[2012-01-06 20:08:00 -0500] jessicab: if you dont get an answer here, the mailing list is a good place to try too
[2012-01-06 20:08:00 -0500] chip-: Just upgraded to chef-expander via apt
[2012-01-06 20:08:00 -0500] chip-: er
[2012-01-06 20:08:00 -0500] chip-: just upgraded to Chef 0.10.8 via apt
[2012-01-06 20:08:00 -0500] chip-: and now chef-expander won't start
[2012-01-06 20:10:00 -0500] chip-: https://gist.github.com/1572181#comments
[2012-01-06 20:10:00 -0500] chip-: Any thoughts?
[2012-01-06 20:11:00 -0500] chip-: possibly related, but no resolution: http://help.rubygems.org/discussions/problems/759-problem-when-starting-chef-expander
[2012-01-06 20:11:00 -0500] gene_wood: jessicab : thanks, I'll try the mailing list
[2012-01-06 20:28:00 -0500] kallistec: chip-: looks like the addressable package isn't compatible with the version of rubygems you have?
[2012-01-06 20:28:00 -0500] kallistec: are you on Debian unstable?
[2012-01-06 20:30:00 -0500] chip-: kallistec: Ubuntu 10.04.3 LTS
[2012-01-06 20:30:00 -0500] chip-: root@chef:/var/run# gem -v
[2012-01-06 20:30:00 -0500] chip-: 1.8.13
[2012-01-06 20:31:00 -0500] kallistec: chip-: where'd you get rubygems?
[2012-01-06 20:37:00 -0500] chip-: Is gem update --system viable in OS-installed ruby?
[2012-01-06 20:37:00 -0500] dyer: gene_wood, I wrote this http://johntdyer.com/index.php/2011/12/18/upgrade-chef-server-to-0-10-8/
[2012-01-06 20:37:00 -0500] gene_wood: aha
[2012-01-06 20:37:00 -0500] jtimberman: 1.8.12 is the current version on rubygems.org, but that page sometimes doesn't have the absolute latest version of RubyGems available with "gem update --system"
[2012-01-06 20:38:00 -0500] chip-: Got it from Universe.
[2012-01-06 20:38:00 -0500] chip-: (apt / default sources.)
[2012-01-06 20:38:00 -0500] gene_wood: dyer : looks good. I'll see if I can open a jira ticket to have that added to the upgrade wiki page
[2012-01-06 20:39:00 -0500] gene_wood: thanks for the info
[2012-01-06 20:39:00 -0500] chip-: apt packages rubygems and rubygems1.8 both installed
[2012-01-06 20:39:00 -0500] dyer: cool, hope it helps
[2012-01-06 20:41:00 -0500] chip-: okay, gem update --system got me up to 1.8.15
[2012-01-06 20:41:00 -0500] jtimberman: 1.8.15?
[2012-01-06 20:41:00 -0500] chip-: still # gem --version
[2012-01-06 20:41:00 -0500] chip-: 1.8.15
[2012-01-06 20:41:00 -0500] jtimberman: O.o ?!
[2012-01-06 20:42:00 -0500] jtimberman: https://github.com/rubygems/rubygems/tags
[2012-01-06 20:42:00 -0500] chip-: I dunno
[2012-01-06 20:43:00 -0500] dyer: jbz, u around?
[2012-01-06 20:43:00 -0500] jtimberman: yfeldblum: this is why we can't have nice things
[2012-01-06 20:43:00 -0500] chip-: I can just roll back to a 10.4 snapshot for the server VM if this remains broken
[2012-01-06 20:43:00 -0500] yfeldblum: jtimberman, keep up! https://rubygems.org/gems/rubygems-update :P
[2012-01-06 20:44:00 -0500] chip-: I thought the 5 supported branches of Ruby were why we can't have nice things
[2012-01-06 20:44:00 -0500] jbz: dyer: back
[2012-01-06 20:44:00 -0500] jbz: whassup
[2012-01-06 20:44:00 -0500] dyer: I just pm'ed u a link if u have a second
[2012-01-06 20:45:00 -0500] dyer: I have refactored the bootstrap like u suggested
[2012-01-06 20:45:00 -0500] jtimberman: good grief.
[2012-01-06 20:45:00 -0500] dyer: but I think I am missing something
[2012-01-06 20:45:00 -0500] dyer: chef doesnt seem to actually run
[2012-01-06 20:47:00 -0500] chip-: Gonna try giving up on system ruby and just using rvm. Which rankles, but I need a working server more than I need to not be wrapped in the warm loving embrace of Ruby's insane bullshit.
[2012-01-06 20:49:00 -0500] yfeldblum: chip-, rubygems is thinking of dropping support for ruby-1.8 and earlier in rubygems-2.0 or later ... i think i saw that on the mailing list as a possibility
[2012-01-06 20:50:00 -0500] chip-: yfeldblum: I feel like the dog in the Far Side cartoon thinking "Oh please, oh please, oh please"
[2012-01-06 20:51:00 -0500] yfeldblum: heh
[2012-01-06 20:52:00 -0500] jtimberman: yfeldblum: you sure that isn't for 1.8.20?
[2012-01-06 20:52:00 -0500] jtimberman: :-X
[2012-01-06 20:53:00 -0500] miketheman: chip-: rvm? go for embedded
[2012-01-06 20:53:00 -0500] mostlygeek: hi, for the meta params not_if, only_if, i want to check 2 conditions, how would i do that with a ruby block?
[2012-01-06 20:53:00 -0500] mostlygeek: ie: that two strings are not empty
[2012-01-06 20:55:00 -0500] yfeldblum: jtimberman, http://rubyforge.org/pipermail/rubygems-developers/2011-December/006906.html
[2012-01-06 20:55:00 -0500] mkent_: dyer, see https://gist.github.com/65f3e638357dc233f344 from earlier?
[2012-01-06 20:55:00 -0500] dyer: mkent_, no I did
[2012-01-06 20:55:00 -0500] dyer: not
[2012-01-06 20:55:00 -0500] dyer: but I do now
[2012-01-06 20:55:00 -0500] dyer: :)
[2012-01-06 20:56:00 -0500] mkent_: :D
[2012-01-06 20:56:00 -0500] chip-: miketheman: unfamiliar with embedded. Bottom line here is that (probably foolishly) I'm using apt-provided Ruby and chef-server installed via apt on Ubuntu 10.04LTS, so moving away from that toward something managed in a different way is hours of pain and downtime.
[2012-01-06 20:56:00 -0500] jtimberman: yfeldblum: response: http://rubyforge.org/pipermail/rubygems-developers/2011-December/006907.html
[2012-01-06 20:56:00 -0500] jtimberman: "Get your shit together"
[2012-01-06 20:56:00 -0500] jtimberman: I think that statement is directed at the wrong side of the table :)
[2012-01-06 21:00:00 -0500] geekbri: Is there an opscode/chef equivalent to mcollective? Or is the general consensus if you want behavior like mcollective just use mcollective with chef
[2012-01-06 21:05:00 -0500] yfeldblum: jtimberman, ruby-1.8 support will have to be dropped ... the question is, rubygems-2.0 or later?
[2012-01-06 21:07:00 -0500] yfeldblum: jtimberman, especially after ruby-2.0 is released, since ruby-1.8 will then be two major versions behind and this is not Microsoft
[2012-01-06 21:14:00 -0500] Damm: nomnom
[2012-01-06 21:14:00 -0500] Damm: yes drop ruby-1.8
[2012-01-06 21:15:00 -0500] Damm: kick it out the door
[2012-01-06 21:17:00 -0500] kallistec: yfeldblum: in a follow up, that was explicitly dismissed as not gonna happen
[2012-01-06 21:19:00 -0500] yfeldblum: kallistec, the pain will only increase and the demand will only decrease; at some point it's gonna happen
[2012-01-06 21:19:00 -0500] kbader: debian stable is still 1.8
[2012-01-06 21:19:00 -0500] kbader: fwiw
[2012-01-06 21:20:00 -0500] kallistec: yfeldblum: for rubygems 2.0 it's not
[2012-01-06 21:20:00 -0500] yfeldblum: geekbri, never used it; knife ssh is for those times when "ssh in a for loop" suffices, and mcollective is for when you need something insane to run your insane fleets
[2012-01-06 21:20:00 -0500] yfeldblum: kallistec, right
[2012-01-06 21:21:00 -0500] yfeldblum: geekbri, that's my thoughts, because ATM, knife's "ssh in a for loop" is sufficing for me
[2012-01-06 21:21:00 -0500] yfeldblum: geekbri, and i haven't need to explore alternatives yet
[2012-01-06 21:26:00 -0500] geekbri: yfeldblum: understood
[2012-01-06 21:53:00 -0500] chip-: ahammond: when running searches boundaried by environment, use "chef_environment:foo"
[2012-01-06 21:57:00 -0500] miketheman: In a recipe, I'm trying to make the search result use the ['ec2']['public_ipv4'] instead of ['ipaddress'], as it is used here: https://github.com/opscode/cookbooks/blob/master/rsyslog/recipes/client.rb#L32
[2012-01-06 21:58:00 -0500] miketheman: I feel like I'm missing something simple.
[2012-01-06 22:04:00 -0500] yfeldblum: miketheman, unfortunately, you may have to fork the cookbook and, simplest alternative, hardcode your attribute instead
[2012-01-06 22:04:00 -0500] miketheman: hmmm.
[2012-01-06 22:10:00 -0500] miketheman: yfeldblum: got it.
[2012-01-06 22:10:00 -0500] miketheman: rsyslog_server.first['ipaddress'] ==>  rsyslog_server.first['ec2']['public_ipv4']
[2012-01-06 22:11:00 -0500] yfeldblum: right
[2012-01-06 22:12:00 -0500] miketheman: so I can actually make a fallback by:
[2012-01-06 22:13:00 -0500] miketheman: rsyslog_server.first['ec2']['public_ipv4'] || rsyslog_server.first['ipaddress'] || node['rsyslog']['server']
[2012-01-06 22:18:00 -0500] kallen: anyone have examples they can share on how they're disting ssl certificates from encrypted data bags? i'm studying 37 signals' ssl_certificates cookbook, but there's no example therein using data bags
[2012-01-06 22:41:00 -0500] schism: # manage nfs mount to shared indexes.
[2012-01-06 22:41:00 -0500] schism: mount "#{node[:lass][:raw_storage_mountpoint]}" do
[2012-01-06 22:41:00 -0500] schism:   device  "#{node[:lass][:raw_storage_volume]}"
[2012-01-06 22:41:00 -0500] schism:   fstype  "nfs"
[2012-01-06 22:41:00 -0500] schism:   options "rw,hard,bg,rsize=32768,wsize=32768,tcp,timeo=600,actimeo=30"
[2012-01-06 22:41:00 -0500] schism:   action  [:mount, :enable]
[2012-01-06 22:41:00 -0500] schism: end
[2012-01-06 22:42:00 -0500] schism: oh, huh, nm
[2012-01-06 22:42:00 -0500] schism: or not :(
[2012-01-06 22:45:00 -0500] schism: slams 80% mem usage on a 1gb mem VM as soon as it hits nfs-common
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: package[nfs-common] checking apt-cache policy
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: package[nfs-common] current version is 1:1.2.0-4ubuntu4.1
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: package[nfs-common] candidate version is 1:1.2.0-4ubuntu4.2
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: package[nfs-common] is already installed - nothing to do
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] INFO: Processing directory[/mnt/nfs/nafa1/lassrawvol0] action create (lass::mount-raw-volume line 9)
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] INFO: Processing mount[/mnt/nfs/nafa1/lassrawvol0] action mount (lass::mount-raw-volume line 19)
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: Checking for mount point /mnt/nfs/nafa1/lassrawvol0
[2012-01-06 22:45:00 -0500] schism: [Fri, 06 Jan 2012 14:43:20 -0800] DEBUG: sh(mount)
[2012-01-06 22:47:00 -0500] schism: actually, its after the nfs-common stuff
[2012-01-06 22:53:00 -0500] jtimberman: gist.github.com
[2012-01-06 22:54:00 -0500] schism: it blows up after it enumerates all the current mounts, right about:
[2012-01-06 22:54:00 -0500] schism: [Fri, 06 Jan 2012 14:53:10 -0800] DEBUG: Special device nafa1:/vol/lassrawvol0 mounted as /mnt/nfs/nafa1/lassrawvol0
[2012-01-06 22:54:00 -0500] schism: [Fri, 06 Jan 2012 14:53:10 -0800] DEBUG: Found mount nafa1:/vol/lassrawvol0 to /mnt/nfs/nafa1/lassrawvol0 in /etc/fstab
[2012-01-06 22:55:00 -0500] schism: ohh, i see
[2012-01-06 22:56:00 -0500] schism: sorry, i'll paste there
[2012-01-06 23:10:00 -0500] schism: https://gist.github.com/1572866
[2012-01-06 23:28:00 -0500] schism: so there's no expected weirdness with mounts? in 10.2?
[2012-01-06 23:33:00 -0500] tierra: how might I make sure the node client has the correct permissions to store off an AWS EBS volume ID here...
[2012-01-06 23:33:00 -0500] tierra: FATAL: Net::HTTPServerException: ruby_block[store_app_sold_database_master_production_volid] (database::ebs_volume line 77) had an error: Net::HTTPServerException: 403 "Forbidden"
[2012-01-06 23:55:00 -0500] kzoo: how does chef track which recipes/cookbooks have been run? im trying to re-install some software which was removed but chef keeps looking for it as it is still installed.
[2012-01-06 23:56:00 -0500] workmad3: kzoo: all the recipes in the run list for a node are run each time the chef client is run
[2012-01-06 23:57:00 -0500] kallistec: kzoo: chef determines if action is necessary on a resource-by-resource basis
