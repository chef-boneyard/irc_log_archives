[2012-05-06 02:04:46 -0400] _numbers: how can i tell the Directory resource to chown/chmod as root rather than the user who called chef-solo ?
[2012-05-06 02:06:55 -0400] UForgotten: _numbers: chef-solo would need to run as root to change permissions outside of the user thats running it
[2012-05-06 02:15:57 -0400] flaccid: don't believe running chef non root is advised in any docs
[2012-05-06 03:23:00 -0400] leed0: i'm having trouble getting a specific branch to deploy with the deploy resource. it keeps deploying HEAD on master, even though i'm setting a branch
[2012-05-06 03:24:28 -0400] leed0: https://gist.github.com/f80d5b5ef8fde72377be
[2012-05-06 04:18:09 -0400] _numbers: andreacampi: so my monkey patch works but only in the cookbook recipe i define it in. it doesn't apply to all cookbooks. is there a better place i can put the monkey patch so it will apply everywhere?
[2012-05-06 04:18:30 -0400] _numbers: i'm using chef-solo, if that matters
[2012-05-06 04:24:00 -0400] _numbers: nvm it was how i was running chef-solo. sry
[2012-05-06 10:30:41 -0400] rafaduran: Somebody knows if it's possible sourcing a template from more than one file?
[2012-05-06 10:34:43 -0400] ashb: no, its not really possible
[2012-05-06 10:36:29 -0400] rafaduran: ashb: ok, thanks
[2012-05-06 12:14:33 -0400] railsraider: Hi i have authprized_keys file that i want to copy to the user account .ssh dir upon create
[2012-05-06 12:14:43 -0400] railsraider: right now i am using  http://community.opscode.com/cookbooks/user
[2012-05-06 12:20:53 -0400] andreacampi: rails raider where is the question?
[2012-05-06 12:26:43 -0400] railsraider: how do i do it :)
[2012-05-06 12:27:17 -0400] railsraider: if i paste the keys into the file it works,they get copied
[2012-05-06 12:27:51 -0400] railsraider: however i want to automatically copy the keys from a server <%#= `ssh admin@server 'cat .ssh/authorized_keys'` %>
[2012-05-06 12:28:04 -0400] andreacampi: ah
[2012-05-06 12:28:10 -0400] railsraider: andreacampi:  so the above is not really working
[2012-05-06 12:28:18 -0400] railsraider: ignore the comment
[2012-05-06 12:28:44 -0400] andreacampi: this should help http://wiki.opscode.com/display/chef/Resources#Resources-RemoteFile
[2012-05-06 12:29:14 -0400] railsraider: i just wanna pour the content of authorized_keys from the server
[2012-05-06 12:29:35 -0400] railsraider: this cookbook creates a user account automatically
[2012-05-06 12:29:47 -0400] railsraider: i just need the keys pasted in from a remote server
[2012-05-06 12:31:15 -0400] andreacampi: remote_file does exactly that
[2012-05-06 12:31:27 -0400] railsraider: ok
[2012-05-06 12:31:30 -0400] railsraider: i'll try that
[2012-05-06 12:31:31 -0400] railsraider: thanks
[2012-05-06 12:31:36 -0400] andreacampi: sure
[2012-05-06 14:20:42 -0400] raz: is there a standard script/rake-task somewhere to sync all data to the chef server?
[2012-05-06 14:20:58 -0400] raz: i'm kinda tired of rake install, databag upload, cookbook upload, env upload etc.
[2012-05-06 14:21:08 -0400] raz: each of them being implemented in the least efficient way
[2012-05-06 14:47:13 -0400] zts: raz: I don't use it, but Spiceweasel may get you closer to what you want - http://wiki.opscode.com/display/chef/Spiceweasel
[2012-05-06 14:47:56 -0400] zts: though I don't believe that automatically uploads everything
[2012-05-06 16:21:23 -0400] raz: zts: nothing against you. but the absurdity of the chef ecosystem is mind boggling.
[2012-05-06 16:26:21 -0400] zts: raz: mm.. in this particular instance, I'm not sure that I get the problem you're commenting on.  Could you spell it out for me?
[2012-05-06 16:26:34 -0400] zts: am wondering whether I simply don't notice it in my workflow
[2012-05-06 16:27:19 -0400] raz: yea, or i'm missing the obvious
[2012-05-06 16:27:22 -0400] raz: to sum up:
[2012-05-06 16:27:29 -0400] raz: chef ships with 'rake install' which uploads only part of the truth.
[2012-05-06 16:27:42 -0400] raz: for a full sync one has to enumerate all cookbooks/environments/databags manually
[2012-05-06 16:28:00 -0400] raz: and even that is not a sync, but knife uploads everything every time, which is dog slow
[2012-05-06 16:28:37 -0400] raz: and finally, some parts are not even authoritative, i.e. node-metadata is blackboxed inside the chef server
[2012-05-06 16:29:43 -0400] raz: and then i see spiceweasel, that... requires me to enumerate my files in yet another file, instead of just inspecting the filesystem.
[2012-05-06 16:30:06 -0400] zts: gotcha
[2012-05-06 16:30:06 -0400] raz: or guard-chef, which monitors a directory and auto-uploads stuff, whatever temporary state it may be in
[2012-05-06 16:30:35 -0400] raz: or ironfan, which takes the concept of "wrong tool for the job" to a whole new level
[2012-05-06 16:30:44 -0400] raz: </rant>
[2012-05-06 16:30:50 -0400] zts: well, I can make a few comments about the way I use it, if you're interested?
[2012-05-06 16:31:03 -0400] raz: yes, please :)
[2012-05-06 16:32:12 -0400] zts: so on the subject of "rake install", I've never used it.  I'm wondering whether that's an old way of doing things, as the readme in the default chef-repo mutters things about tasks being replaced with knife
[2012-05-06 16:32:35 -0400] zts: that's neither here nor there, but I don't think I'm worse off for ignoring it :)
[2012-05-06 16:32:36 -0400] raz: yup, it seems to be deprecated
[2012-05-06 16:33:07 -0400] zts: in my workflow, I seldom (well, never) need to upload everything.  I can see how that functionality is lacking if you do
[2012-05-06 16:34:11 -0400] zts: I think I'd probably use spiceweasel if I did, but then I like to be specific about what's in my environment, and I have the same concern as you about guard-chef
[2012-05-06 16:34:21 -0400] raz: so you type out "knife databag from file" etc. every time you make a change?
[2012-05-06 16:35:01 -0400] zts: well, my databags fall into two categories
[2012-05-06 16:35:13 -0400] zts: there's a few that we maintain in our git repo, and for those I do use "knife databag from file"
[2012-05-06 16:35:33 -0400] zts: although the ones that are updated most frequently are usually managed by other tools
[2012-05-06 16:35:58 -0400] zts: eg, we have a user management webapp which creates and updates the user databags
[2012-05-06 16:36:35 -0400] zts: I'll sometimes use "knife databag edit" if I'm messing around with something, and then check it into git when I'm happy with it
[2012-05-06 16:37:14 -0400] raz: well, there's the point that seems utterly backwards
[2012-05-06 16:37:19 -0400] zts: I know some people in here have installed hooks on their git server to automatically upload things when they're pushed.  That's an approach I might take in the future, but I haven't felt enough pain yet
[2012-05-06 16:37:35 -0400] raz: "with check into git" you mean "knife databag show >foo.json ; git commit foo.json" right?
[2012-05-06 16:37:54 -0400] zts: yeah
[2012-05-06 16:38:13 -0400] zts: but I prefer making changes in CM and then uploading, so that's not my usual workflow.
[2012-05-06 16:38:38 -0400] raz: CM?
[2012-05-06 16:38:39 -0400] bawt_: CM is awesome because it turns your infrastructure into code, and that makes it repeatable.
[2012-05-06 16:38:48 -0400] zts: sorry, SCM
[2012-05-06 16:38:58 -0400] zts: in this case, git
[2012-05-06 16:38:59 -0400] raz: scm? ;)
[2012-05-06 16:39:00 -0400] raz: ahh
[2012-05-06 16:39:03 -0400] raz: yes. exactly.
[2012-05-06 16:39:11 -0400] raz: that's what i was aiming at.
[2012-05-06 16:39:55 -0400] raz: in pretty much any similar environment (e.g. puppet, cfengine) your local repository would be authoritative and there's an efficient "sync" command to push
[2012-05-06 16:40:17 -0400] raz: i keep gazing at the trainwreck mix that chef employs
[2012-05-06 16:40:31 -0400] raz: and can't stop thinking "i must be missing something here, they can't possibly be serios
[2012-05-06 16:40:35 -0400] raz: serious"
[2012-05-06 16:40:46 -0400] zts: in fairness, the Chef docs do note that there's two possible workflows, and you should pick one _or_ the other
[2012-05-06 16:41:24 -0400] raz: hmm, where is that page? ;)
[2012-05-06 16:41:28 -0400] zts: h5 :)
[2012-05-06 16:41:43 -0400] raz: h5?
[2012-05-06 16:44:54 -0400] raz: amazingly the objects don't even seem to be versioned inside chef (or i haven't found how to access those versions)
[2012-05-06 16:44:57 -0400] zts: apologies, "hang 5".  And the fact that I've not found the page I know exists after several tries means I'm going to concede your point on this one
[2012-05-06 16:45:45 -0400] zts: I'd imagine they're versioned in couchdb, but I'm not aware of any way to get at them through the API.
[2012-05-06 16:46:04 -0400] raz: yes, that's what i'm thinking, too.
[2012-05-06 16:46:16 -0400] raz: which makes it impossible to implement an efficient sync with conflict detection oneself.
[2012-05-06 16:46:17 -0400] zts: cookbooks notwithstanding, previous versions of those are available
[2012-05-06 16:46:49 -0400] raz: well, i made a trivial script to upload changed environment/databag/roles etc. only on change
[2012-05-06 16:46:56 -0400] raz: you know, the kind of script that you'd expect chef to ship with
[2012-05-06 16:47:18 -0400] raz: the remaining problem is that an external source might legitimately push changes to chef, too
[2012-05-06 16:47:29 -0400] raz: and i obviously don't want to steamroll those without at least a warning
[2012-05-06 16:47:46 -0400] raz: you know.. the kind of scenario that couchdb was designed for
[2012-05-06 16:48:10 -0400] raz: i can smell it. there's this huge elephant in the room that i'm not seeing.
[2012-05-06 16:50:09 -0400] yfeldblum: raz, chef is the low-level/building-blocks for creating your own infrastructure system; build your own tools/techniques/practices on top based on how you want to use it
[2012-05-06 16:50:29 -0400] raz: yfeldblum: i'm doing that. and i run into issues such as the one above.
[2012-05-06 16:50:29 -0400] zts: From my perspective, I'm not inclined to disagree with anything you'd like to see, but those deficiencies are mitigated or irrelevant to the infrastructure I've built
[2012-05-06 16:50:38 -0400] zts: infrastructure + workflow
[2012-05-06 16:51:05 -0400] yfeldblum: raz, no, you're not running into issues; what you're running into is the fact that chef provides the building blocks, but you have not yet assembled them
[2012-05-06 16:51:46 -0400] raz: yfeldblum: ok. how do i dump a role/databag/environment/anything with either a version or timestamp of last change?
[2012-05-06 16:51:54 -0400] yfeldblum: raz, `rake install` is a convenience from long ago; but who's to say you should be auto-syncing anyway? who's to say what, specifically, should be auto-synced?
[2012-05-06 16:52:40 -0400] hoover_damn: data bags are not versioned at the chef level, they might be at couchdb
[2012-05-06 16:52:41 -0400] raz: yfeldblum: chef-repo is supposed to be the source of truth, isn't it?
[2012-05-06 16:53:06 -0400] yfeldblum: raz, no; although, you may decide for yourself that your chef-repo is the source of your truth, if you wish to use chef that way
[2012-05-06 16:53:08 -0400] hoover_damn: tbh data bags have always confused me
[2012-05-06 16:53:27 -0400] raz: yfeldblum: so, how do i export a coherent snapshot of the truth from a chef-server?
[2012-05-06 16:53:31 -0400] hoover_damn: it's like the extra source of data that doesn't have anything to do with other ways you can find in recipes (e.g. attributes)
[2012-05-06 16:53:47 -0400] yfeldblum: raz, enumerate & retrieve
[2012-05-06 16:53:59 -0400] raz: yfeldblum: i looked at that and didn't see a transaction primitive
[2012-05-06 16:54:10 -0400] raz: where do i look to get a *coherent* snapshot while others may be writing?
[2012-05-06 16:54:12 -0400] yfeldblum: raz, alright, take a backup
[2012-05-06 16:54:55 -0400] yfeldblum: raz, however, chef is a distributed system, where things are eventually consistent (what do you think "converge" means?); there's no transaction primitive in a such a distributed system
[2012-05-06 16:56:04 -0400] raz: yfeldblum: well, that would be.. broken.
[2012-05-06 16:56:17 -0400] yfeldblum: raz, no, that would be ... real-world
[2012-05-06 16:56:51 -0400] hoover_damn: snapshot couchdb, snapshot solr
[2012-05-06 16:56:58 -0400] yfeldblum: raz, why do you think resources in chef are designed to be declarative, recipes designed to be idempotent & failure tolerant, etc?
[2012-05-06 16:57:02 -0400] raz: yfeldblum: so, truth is composed of cookbooks, databags, environments, roles and some other pieces. and you're telling me i can't atomically update them?
[2012-05-06 16:57:08 -0400] erikh: just keep your transaction log orthogonal to the chef database
[2012-05-06 16:57:15 -0400] erikh: e.g., git.
[2012-05-06 16:57:26 -0400] yfeldblum: raz, if you want atomicity, build a lock manager and take locks
[2012-05-06 16:57:34 -0400] erikh: down that path lies madness.
[2012-05-06 16:57:47 -0400] raz: erikh: that's what i'm trying to do. but i don't see how i can compare previous-git-revision to current-chef-sate.
[2012-05-06 16:57:49 -0400] raz: statE*
[2012-05-06 16:58:13 -0400] erikh: raz: there are tools you can build that compare differences between a chef server and the git repository
[2012-05-06 16:58:15 -0400] erikh: I've written them
[2012-05-06 16:58:18 -0400] erikh: BUT
[2012-05-06 16:58:20 -0400] erikh: I wrote them for a company.
[2012-05-06 16:58:22 -0400] erikh: :)
[2012-05-06 16:58:40 -0400] yfeldblum: erikh, raz, https://github.com/boundary/knife-plugins
[2012-05-06 16:59:06 -0400] erikh: yeah, I wrote sync tools, but yeah
[2012-05-06 16:59:21 -0400] erikh: they're not hard tools to write.
[2012-05-06 16:59:48 -0400] raz: yfeldblum: at a glance that looks like it will run into the same issue; i.e. the local json does not match the chef-server serialization, unless you export and commit to local git after each push.
[2012-05-06 17:00:09 -0400] erikh: match against the data structure, not the literal contnet.
[2012-05-06 17:00:26 -0400] raz: erikh: that's not what the knife-plugin seems to do (at least i see md5 mentioned prominently there)
[2012-05-06 17:00:37 -0400] erikh: yeah, it's not attempting to sync anything.
[2012-05-06 17:00:51 -0400] yfeldblum: raz, i'm not sure i followed that
[2012-05-06 17:01:02 -0400] erikh: anyhow, it's not a hard problem -- you just have to invest some elbow grease is all.
[2012-05-06 17:01:26 -0400] raz: yfeldblum: knife show foo -F json is a different format (and may have more fields) than my local json
[2012-05-06 17:01:33 -0400] erikh: I'll probably be doing some similar tools for $new_company I start at on monday, since they were focal points in my interviews
[2012-05-06 17:01:38 -0400] yfeldblum: raz, well, of course
[2012-05-06 17:01:54 -0400] erikh: maybe we'll get to release them this time
[2012-05-06 17:02:16 -0400] raz: yfeldblum: so the course of action would be to export the json after uploading it - and overwrite the local json, and check that into git. to have a base for comparison on the next sync.
[2012-05-06 17:03:58 -0400] yfeldblum: raz, no ... why would you need to do that?
[2012-05-06 17:04:51 -0400] raz: yfeldblum: when my local json reads {foo:bar}. and chef-server, when asked, returns {foo:bar, blah} for the same object. then i can't compare if the chef-server object is still the one that i put in.
[2012-05-06 17:05:55 -0400] raz: a deep-diff will tell me if there's difference, but i won't be able to automatically determine whether that is due to chef-server being more verbose, or due to someone else having altered my object in the meantime
[2012-05-06 17:06:30 -0400] raz: hence my question from earlier, if there's a way to get a version or lastmodified timestamp for an object
[2012-05-06 17:09:08 -0400] erikh: raz: the chef server is pretty clear about what fields it carries that are extra
[2012-05-06 17:09:18 -0400] erikh: you just need to look at Chef::DataBagItem in the chef gem
[2012-05-06 17:09:40 -0400] erikh: it's like 7 or 8 fields IIRC, easy to prune for comparison purposes.
[2012-05-06 17:09:45 -0400] raz: erikh: i'm pretty sure that will change in the future?
[2012-05-06 17:09:54 -0400] erikh: and I think there's a call that will elide them for you automatically
[2012-05-06 17:10:04 -0400] erikh: well, you can find reasons to complain or you can solve your problems
[2012-05-06 17:10:07 -0400] erikh: I can't choose that one for you.
[2012-05-06 17:10:25 -0400] raz: what is the call to elide them?
[2012-05-06 17:11:17 -0400] raz: raw_data sounds promising, i'm gonna try that
[2012-05-06 17:11:36 -0400] erikh: I don't remember. you'll have to look.
[2012-05-06 17:14:32 -0400] erikh: one thing I explicitly remember doing that you may appreciate, I removed the id field from each databag item and other locational information and sussed it out from the filename provided. it worked rather well when people were cutting and pasting databags for specific needs.
[2012-05-06 17:22:50 -0400] fafa34: anyone know how to run chef-gelf knife plugin?
[2012-05-06 18:51:58 -0400] akraut: Anyone have any suggestions as to why rabbitmq is going nuts on my chef server?
[2012-05-06 18:54:39 -0400] miah: solar flares?
[2012-05-06 18:54:45 -0400] miah: without more details. thats the best guess we can give.
[2012-05-06 18:55:01 -0400] |shad0w|: elmer fudd
[2012-05-06 19:01:17 -0400] akraut: looks like chef-expander is blocked, but the log has nothing in it. Am I in danger of losing data if I bounce rabbit and chef-expander?
[2012-05-06 19:12:48 -0400] miah: you could look and see if rabbitmq is holding anything
[2012-05-06 19:14:36 -0400] akraut: miah: Yeah, that's the problem, it seems. chef-expander's connection is marked "blocked" and there's about 15gb of data in the queue.
[2012-05-06 19:17:07 -0400] miah: ensure that the expander can log into rabbitmq
[2012-05-06 19:18:43 -0400] shuvo: if I use the ohai plugin cookbook, will I be able to pass/override values to attributes in my ohai plugin just like I can do to my normal recipes? (i,e, treat my ohai plugin just like any other "normal recipe"?)
[2012-05-06 19:20:10 -0400] akraut: miah: I see the amqp_pass line the /etc/chef/expander.rb is it always going to try user "chef"?
[2012-05-06 19:20:30 -0400] miah: yes
[2012-05-06 19:20:35 -0400] miah: make sure that user/pass works
[2012-05-06 19:24:44 -0400] akraut: Works on the rabbit mgmt web interface
[2012-05-06 19:24:53 -0400] akraut: Also: http://www.evernote.com/shard/s1/sh/7823cd6b-fc86-438d-a41c-b0c6e63c05ea/a6dd9c2508971c47c9b6175ead13785f
[2012-05-06 19:25:39 -0400] miah: and does that user have access to the chef queue?
[2012-05-06 19:26:37 -0400] akraut: Yeah, that's the same user that is inserting into the queue
[2012-05-06 19:26:48 -0400] miah: weird. i have no idea.
[2012-05-06 19:26:56 -0400] akraut: None of those settings have changed since I installed the chef-server a year ago
[2012-05-06 19:26:58 -0400] miah: maybe do a list_permissions
[2012-05-06 19:27:06 -0400] miah: and make sure that the user has read as well as write
[2012-05-06 19:27:55 -0400] akraut: permissions for vhost /chef: chef    .*      .*      .*
[2012-05-06 19:29:58 -0400] akraut: chef-expander isn't writing any logs, either, so I think I need to fix that before I'll be able to tell what's going on.
[2012-05-06 19:30:22 -0400] akraut: It really looks like it's not taking anything out of the queues so rabbit eventually gets so full of items that it starts to swap like crazy.
[2012-05-06 19:33:35 -0400] miah: iirc, you can run expander in foreground mode
[2012-05-06 19:41:05 -0400] miah: time for a walk..
[2012-05-06 19:46:32 -0400] shuvo: any good tools for screencasting vagrant and chef demos on ubuntu with audio? I would like to capture multiple terminal windows *and* have the ability to edit the initial recordings to create a well done screencast hopefully without much work :-D
[2012-05-06 19:47:43 -0400] shuvo: "run this script to do this" <demo> "and that gets you this service running" <demo> "and you configure it this way" <demo> ...
[2012-05-06 19:51:21 -0400] atomic-penguin: shuvo, desktop-recorder
[2012-05-06 19:51:42 -0400] atomic-penguin: xvidcap doesn't support modern alsa, and alsa-only devices
[2012-05-06 19:54:03 -0400] atomic-penguin: shuvo, actually the package name is, recordmydesktop
[2012-05-06 19:54:04 -0400] shuvo: atomic-penguin, thanks. is there a website/page on that tool I can read? I googled it in quotes and didn't get anything to read on. Is it also known as "gtk-recordMyDesktop"
[2012-05-06 19:54:07 -0400] shuvo: ah
[2012-05-06 19:54:41 -0400] atomic-penguin: The menu entry doesn't match the package name
[2012-05-06 19:55:23 -0400] atomic-penguin: I think it puts everything into a webm, or matroska container, which doesn't play back correctly on mplayer for some reason.  Once uploaded to something like youtube it works fine, however
[2012-05-06 19:55:53 -0400] atomic-penguin: I did this one a few weeks ago, http://www.youtube.com/watch?v=aN8lb2O-wHs
[2012-05-06 19:59:33 -0400] shuvo: atomic-penguin, your video is *exactly* what I intend to do but using vagrant and chef! Thanks. At the risk of being booted from #chef, how do you edit the videos to remove abrupt pauses or merge clips? (let's pm directly maybe to reduce channel noise)
[2012-05-06 20:31:21 -0400] rrichardsr3: \quit
[2012-05-06 20:59:18 -0400] valdezjoetl: hi
[2012-05-06 21:01:43 -0400] valdezjoetl: hi I'm new to chef, is there any same command like Win32::Service.exists? in linux to check if the service already exist ?
[2012-05-06 21:03:10 -0400] shuvo: valdezjoetl, chef dsl is ruby, so if you are running your chef client on windows OK, you should be able to use Win32::Service.exists? in your recipe
[2012-05-06 21:04:24 -0400] valdezjoetl: thanks shuvo. is there any corresponding function in linux for this ?
[2012-05-06 21:04:45 -0400] bemu: guh.
[2012-05-06 21:04:55 -0400] shuvo: depends on the service manager. for eg.using upstart, you can use status
[2012-05-06 21:05:26 -0400] shuvo: bemu, fell free to correct me if I said incorrect stuff :-D
[2012-05-06 21:06:01 -0400] bemu: My most busy ELB (480 megabits per second) is adding 10+ second latency to 30-50% of requests
[2012-05-06 21:06:14 -0400] bemu: I guess I see why people don't use this junk. :(
[2012-05-06 21:07:34 -0400] bemu: shuvo: No, that sounds right. I'm just whining. :)
[2012-05-06 21:08:05 -0400] shuvo: bemu, np but this is serendipity, I want to start learning ELB and had a q: is there a way I could make ELB choose one specific server from a cluster depending on my own custom balancing algorithm?
[2012-05-06 21:08:18 -0400] bemu: No.
[2012-05-06 21:08:32 -0400] bemu: Not that I'm aware of, at least.
[2012-05-06 21:08:50 -0400] bemu: I would strongly urge you not to use ELB. We only use it as a bandaid, and this isn't the first time it has bitten me.
[2012-05-06 21:09:15 -0400] bemu: I'm pretty sure both nginx and haproxy allow you to write custom algorithms. But I've never done this.
[2012-05-06 21:09:16 -0400] shuvo: bemu, answer 'no' not acceptable from chef gurus. I have just done reading and ELBs balancing algorithm seems something like a LRU
[2012-05-06 21:09:30 -0400] shuvo: he he
[2012-05-06 21:09:54 -0400] shuvo: the solution I currently thought of was having an internal proxy that would be "exposed" to ELB
[2012-05-06 21:10:04 -0400] bemu: That's what I do currently.
[2012-05-06 21:10:11 -0400] bemu: I use ELB simply to run health checks on my proxies.
[2012-05-06 21:10:15 -0400] shuvo: oh
[2012-05-06 21:10:34 -0400] bemu: This way if a proxy goes down, it gets removed, theoretically.
[2012-05-06 21:11:00 -0400] shuvo: yes, but is it good for latency?
[2012-05-06 21:11:52 -0400] bemu: uh
[2012-05-06 21:11:57 -0400] bemu: Are you trolling me?
[2012-05-06 21:12:05 -0400] bemu: Obviously adding extra hops is bad for latency :P
[2012-05-06 21:12:36 -0400] shuvo: no. I am a new guy "on the scene" : learning as I go, and the best source seems to be people here!
[2012-05-06 21:13:18 -0400] bemu: Nice, welcome!
[2012-05-06 21:13:27 -0400] shuvo: thanks :-D need to read a bit more
[2012-05-06 21:13:29 -0400] bemu: Yeah, adding any additional hops is a bad thing.
[2012-05-06 21:13:37 -0400] bemu: You should pick up the Web Ops book.
[2012-05-06 21:14:00 -0400] shuvo: oh: how do I search for dem books?
[2012-05-06 21:14:01 -0400] bemu: http://shop.oreilly.com/product/0636920000136.do
[2012-05-06 21:14:24 -0400] bemu: It's not specific to Chef, at all, but is a good overview.
[2012-05-06 21:14:40 -0400] bemu: Covers the basics of a lot of different topics.
[2012-05-06 21:15:05 -0400] shuvo: thank you. is there a book that can help me understand bursting issues for EC2 instances?
[2012-05-06 21:15:24 -0400] bemu: o.O
[2012-05-06 21:15:24 -0400] bemu: C
[2012-05-06 21:15:24 -0400] bemu: a
[2012-05-06 21:15:25 -0400] bemu: n
[2012-05-06 21:15:25 -0400] bemu: y
[2012-05-06 21:15:27 -0400] bemu: wow.
[2012-05-06 21:15:27 -0400] bemu: s
[2012-05-06 21:15:32 -0400] bemu: stupid colloquy
[2012-05-06 21:15:33 -0400] bemu: Sorry guys
[2012-05-06 21:15:38 -0400] bemu: Can you be more specific?
[2012-05-06 21:17:57 -0400] shuvo: "bursting issues": out of a cluster of 6 machines served by nginx LB, 2 machines always seems to have 20% utilization
[2012-05-06 21:18:07 -0400] shuvo: any 2
[2012-05-06 21:19:05 -0400] shuvo: that's a very skewed LB I managed to setup during my experimetns
[2012-05-06 21:19:26 -0400] shuvo: and I have no idea where to start looking
[2012-05-06 21:19:45 -0400] shuvo: "it works" as expected on my "in house" vagrant based "cloud"
[2012-05-06 21:20:02 -0400] shuvo: issues shows up on EC2 small instances
[2012-05-06 21:21:01 -0400] shuvo: my nginx config is based off this: http://sameerparwani.com/posts/load-balancing-with-nginx
[2012-05-06 21:25:07 -0400] bemu: shuvo: Define 20% util? You mean load or CPU?
[2012-05-06 21:25:21 -0400] shuvo: CPU
[2012-05-06 21:25:35 -0400] shuvo: It serves a single mp3 file for testing
[2012-05-06 21:25:45 -0400] bemu: nginx is not known for it's great LB algo's
[2012-05-06 21:26:01 -0400] bemu: Are you streaming the mp3, or just download?
[2012-05-06 21:26:15 -0400] shuvo: download. keeping it simple for self learning
[2012-05-06 21:26:18 -0400] bemu: That's interesting.
[2012-05-06 21:26:33 -0400] bemu: Do you have ELB in front of nginx?
[2012-05-06 21:26:40 -0400] shuvo: indeed
[2012-05-06 21:27:11 -0400] bemu: one nginx proxy?
[2012-05-06 21:27:29 -0400] shuvo: yes, but multiple content servers (again nginx)
[2012-05-06 21:29:03 -0400] shuvo: one more request: is there a separate forum(not the Amazon one)/IRC channel, where I can take these EC2 specific questions, that you know of?
[2012-05-06 21:29:18 -0400] shuvo: I am looking for the same level of interest and enthusiasm I see here
[2012-05-06 21:29:42 -0400] bemu: So just to be clear, you're using the same layout/number of servers on vagrant as ec2?
[2012-05-06 21:30:12 -0400] bemu: and you're sure you put server entries for all backends?
[2012-05-06 21:30:21 -0400] shuvo: yes. 4 servers with 1 nginx lb. EC2 has an additional ELB in front of that lb
[2012-05-06 21:31:08 -0400] bemu: It's interesting that you're seeing varied results.
[2012-05-06 21:31:16 -0400] bemu: I would urge you to check out one of two things:
[2012-05-06 21:31:21 -0400] bemu: haproxy
[2012-05-06 21:31:22 -0400] bemu: or
[2012-05-06 21:31:26 -0400] bemu: https://github.com/gnosek/nginx-upstream-fair
[2012-05-06 21:31:28 -0400] bemu: That module for nginx
[2012-05-06 21:31:38 -0400] bemu: Also, here's a quora post on the topic:
[2012-05-06 21:31:38 -0400] bemu: http://www.quora.com/What-is-the-best-way-to-get-nginx-to-do-smart-load-balancing
[2012-05-06 21:32:05 -0400] shuvo: Awesome! I am so bummed, on vagrant, the CPU hovers around 1% for *all* servers. but on EC2 I get this 20% util on any 2 servers :-(
[2012-05-06 21:32:07 -0400] bemu: There are lots of related questions off of that one as well.
[2012-05-06 21:32:23 -0400] shuvo: thanks bemu, I really appreciate the help
[2012-05-06 21:32:25 -0400] bemu: Is it a constant 20%? or does it spike?
[2012-05-06 21:32:41 -0400] shuvo: hover around 11 -20 %
[2012-05-06 21:32:47 -0400] bemu: There's ##aws, but I haven't gotten much response there. You can ask AWS questions here and in #infra-talk as well.
[2012-05-06 21:32:51 -0400] shuvo: ok
[2012-05-06 21:33:13 -0400] shuvo: hey, I am taking too much of your time. You gave me enough resources. Let me read around :-D
[2012-05-06 21:33:36 -0400] bemu: To be clear, I get some imbalance in our servers as well, even on small clusters, and even with haproxy.
[2012-05-06 21:33:48 -0400] bemu: One thing you should do is look at 15 minute load, it may be a better indicator.
[2012-05-06 21:33:58 -0400] bemu: Thanks :)
[2012-05-06 21:34:06 -0400] shuvo: hmm, the funny thing is the 20% CPU issue goes away on upgrading the instance type
[2012-05-06 21:34:36 -0400] bemu: btw, I just confirmed that ELB was the root cause of my problem -- I'd be wary of using it.
[2012-05-06 21:34:41 -0400] bemu: We'll be migrating off of it asap.
[2012-05-06 21:34:47 -0400] shuvo: ha ha. one less thing to worry about!
[2012-05-06 21:34:56 -0400] bemu: Well that isn't surprising, small's are pretty puny.
[2012-05-06 21:36:01 -0400] shuvo: I feel jealous of people serving tons of stuff off nginx on micro instances
[2012-05-06 21:38:09 -0400] bemu: You shouldn't
[2012-05-06 21:38:21 -0400] bemu: It is only relevant if you don't care about latency
[2012-05-06 21:39:39 -0400] shuvo: bemu, do you have a blog/gh I could read?
[2012-05-06 21:40:25 -0400] shuvo: I just got started and am at github.com/subhobroto
[2012-05-06 21:44:53 -0400] bemu: I have been so busy with work I haven't blogged in ages. :(
[2012-05-06 21:45:12 -0400] bemu: blog.aegisco.com, though. twitter is twitter.com/jsulinski
[2012-05-06 21:45:18 -0400] bemu: I never really use either.
[2012-05-06 21:45:29 -0400] bemu: If you're in the SF / Bay Area, I host meetups occasionally. SF DevOps.
[2012-05-06 21:45:57 -0400] shuvo: That would have been great. Unfortunately I am in SoCal :'(
[2012-05-06 21:46:04 -0400] cwj: bemu: are you going to chefconf
[2012-05-06 21:46:15 -0400] bemu: Yessir.
[2012-05-06 21:46:21 -0400] cwj: kewl
[2012-05-06 21:46:38 -0400] bemu: I'm having a meetup on Monday, in San Francisco, as well.
[2012-05-06 21:46:45 -0400] bemu: a chef hacknight, basically.
[2012-05-06 21:46:54 -0400] bemu: (the monday before ChefConf)
[2012-05-06 21:47:14 -0400] cwj: yeah i heard about something on monday, i wont be in town until tuesday night
[2012-05-06 21:49:10 -0400] bemu: ah, no worries at all. I'll probably be the only guy at ChefConf with a down mohawk, hanging out with a dude with dreadlocks (fujin). :P
[2012-05-06 21:51:06 -0400] cwj: i lack a distinguishing physical trait, but i am looking forward to meeting many people from this channel :)
[2012-05-06 21:51:34 -0400] bemu: Same here! I'm pretty sure I used or was checking out some of your work recently. I can't quite recall what it was though
[2012-05-06 21:52:52 -0400] bemu: Sometimes you don't realize how small the Ops community is, then the same names keep popping up over and over on projects that are awesome.
[2012-05-06 21:53:27 -0400] cwj: i only recently started publishing and contributing, but it feels good
[2012-05-06 21:55:29 -0400] bemu: Nice, chef-hipchat. :)
[2012-05-06 21:55:34 -0400] bemu: We use hipchat also.
[2012-05-06 21:55:58 -0400] cwj: just started using it at work, i like it
[2012-05-06 21:56:18 -0400] cwj: of course it is usually painful to get one's team to switch
[2012-05-06 21:56:44 -0400] bemu: It's a pretty solid product, just the android client is awful.
[2012-05-06 21:57:06 -0400] bemu: I'm going to dip out for a bit. Catch you guys later!
[2012-05-06 21:57:11 -0400] cwj: see ya
[2012-05-06 22:00:46 -0400] cnf: my google foo seems to be failing me, are there any docs on running chef without a server?
[2012-05-06 22:05:02 -0400] cwj: cnf: chef-solo is what you want to look at
[2012-05-06 22:05:14 -0400] cnf: aha, lets have a look,see
[2012-05-06 22:05:20 -0400] cwj: http://wiki.opscode.com/display/chef/Chef+Solo
[2012-05-06 22:05:46 -0400] cnf: yeah, just got there
[2012-05-06 22:05:49 -0400] cnf: thanks cwj
[2012-05-06 22:05:52 -0400] cwj: you bet
[2012-05-06 22:08:54 -0400] cnf: hmm, lots of info at once ^^;
[2012-05-06 22:10:47 -0400] shuvo: cnf, would you be interested in running a "ready to go" VM (I have tested it using VirtualBox) it features a full blown chef server on ubuntu 10.04 LTS
[2012-05-06 22:11:04 -0400] shuvo: you can run it on your laptop/desltop
[2012-05-06 22:11:40 -0400] cnf: shuvo: with what purpose?
[2012-05-06 22:12:38 -0400] shuvo: uhm, in case you would like to run chef *with* your own local/private server
[2012-05-06 22:13:35 -0400] cnf: don't think that would be very useful to me
[2012-05-06 22:14:38 -0400] cnf: i have a number of clients who each have 1 or 2 servers, which i manage, and want to control from my laptop
[2012-05-06 22:14:44 -0400] cnf: laptop being a roaming profile
[2012-05-06 22:15:03 -0400] shuvo: ah, ok. just looking for people to find issues/bugs in the VM I built. I will come up with a post about it and share it with all, soon, hopefully
[2012-05-06 22:15:08 -0400] cnf: (ie, ip changes are rampant)
[2012-05-06 22:15:35 -0400] cnf: heh, yeah, i am just getting started with chef, not the person to look for bugs :P
[2012-05-06 22:16:07 -0400] cnf: right now I am just looking for a way to maintain and push config to several servers
[2012-05-06 22:16:14 -0400] cnf: from my local machine
[2012-05-06 22:17:21 -0400] shuvo: au contraire, very *much* the person to look for bugs: my target audience are newcomers to chef who don't have to use chef solo and can run chef from their local machine
[2012-05-06 22:20:05 -0400] chip-: Any known concerted efforts out there right now to collaborate on updating the elastic search cookbook, before I go dropping 10-20 hours into it?
[2012-05-06 22:20:52 -0400] chip-: I'm thinking lwrp for installing plugins, encrypted data bag for ec2 creeds, update to use environments / search for autodiscovery, etc etc
[2012-05-06 22:24:46 -0400] shuvo: chip-, would you be integrating with ironfan?
[2012-05-06 22:27:17 -0400] chip-: Haven't worked with ironfan yet, hoping to learn a lot more about it at the conf
[2012-05-06 22:27:23 -0400] Guest79445: what is chef for
[2012-05-06 22:27:32 -0400] Guest79445: replacing sysadmins with scripts?
[2012-05-06 22:28:09 -0400] Guest79445: i'd like to go from 3 sysadmins to 1 (fire them), can chef help me accomplish that?
[2012-05-06 22:28:22 -0400] chip-: Guest79445: configuration management.
[2012-05-06 22:28:33 -0400] shuvo: hmm, chef might not work well in infrastructure that needs/has sysadmins
[2012-05-06 22:28:47 -0400] chip-: Guest79445: That said, as a systems admin I'm not a huge fan of your line of questioning. :)
[2012-05-06 22:29:23 -0400] Guest79445: there are not enough jobless sysadmins imo
[2012-05-06 22:29:41 -0400] chip-: There are not enough jobless middle managers either.
[2012-05-06 22:29:50 -0400] hoover_damn: Chef will not allow you to fire your staff
[2012-05-06 22:30:03 -0400] cwj: does reusable code make it easier to fire programmers?
[2012-05-06 22:30:05 -0400] hoover_damn: chef can allow you to document your infrastructure with code
[2012-05-06 22:30:14 -0400] shuvo: hoover_damn, that's an awesome quote
[2012-05-06 22:30:18 -0400] hoover_damn: and it can allow you to work in a smarter fashion where you know truth by code
[2012-05-06 22:30:32 -0400] hoover_damn: which can allow you to loose dead weight
[2012-05-06 22:30:39 -0400] hoover_damn: but chef will never allow you to fire anyone
[2012-05-06 22:30:55 -0400] hoover_damn: but if you have a sysadmin who mentions his opinion
[2012-05-06 22:31:00 -0400] hoover_damn: tell him that emotions are for the jobless
[2012-05-06 22:31:15 -0400] chip-: With Chef we've hit a ratio of many hundreds of servers per admin, and in combination with virtualization / cloud technologies, Chef can help you move into a world where your servers are object containers instead of carefully crafted, jealously protected snowflakes.
[2012-05-06 22:31:21 -0400] Guest79445: i tell them vacations are for the jobless
[2012-05-06 22:31:35 -0400] cwj: this troll is not very well constructed
[2012-05-06 22:31:41 -0400] chip-: Oh, you're trolling!
[2012-05-06 22:31:43 -0400] chip-: man I bit on that
[2012-05-06 22:31:43 -0400] hoover_damn: Chef will not help with your monitoring, it will not help with your provisioning
[2012-05-06 22:31:44 -0400] chip-: Damn.
[2012-05-06 22:31:48 -0400] hoover_damn: it will only provide configuration management
[2012-05-06 22:31:49 -0400] chip-: Nevermind.
[2012-05-06 22:31:54 -0400] Guest79445: FIRE ALL THE ADMINS
[2012-05-06 22:31:59 -0400] shuvo: whoa
[2012-05-06 22:32:16 -0400] hoover_damn: It can help setup your monitoring and configure a provisioning system
[2012-05-06 22:32:18 -0400] Guest79445: im writing computer software that will make the computer obsolete
[2012-05-06 22:32:26 -0400] hoover_damn: but Chef has nothing to do with monitoring itself directly
[2012-05-06 22:32:33 -0400] hoover_damn: that said, Chef is a hammer
[2012-05-06 22:32:33 -0400] chip-: Someone needs to feed this guy into a markov bot
[2012-05-06 22:32:48 -0400] cwj: i have created a device which makes computers obsolete, I call it the cotton gin
[2012-05-06 22:32:48 -0400] hoover_damn: time to tune your hammer
[2012-05-06 22:33:07 -0400] shuvo: Someone needs to page to chef irc gods on a sunday evening
[2012-05-06 22:33:24 -0400] hoover_damn: and as always, my logs to #chef and #chef-hacking are available at logs.likens.us
[2012-05-06 22:33:27 -0400] cwj: shuvo: why? to ban someone for making jokes on the internet? :)
[2012-05-06 22:33:32 -0400] hoover_damn: http
[2012-05-06 22:33:35 -0400] hoover_damn: have a good day
[2012-05-06 22:33:38 -0400] hoover_damn: it's sunny
[2012-05-06 22:33:40 -0400] hoover_damn: step out
[2012-05-06 22:33:43 -0400] hoover_damn: it's beautiful
[2012-05-06 22:33:47 -0400] Guest79445: https
[2012-05-06 22:33:48 -0400] Guest79445: ok bye
[2012-05-06 22:34:11 -0400] shuvo: cwj, mindreader ;-)
[2012-05-06 22:34:46 -0400] shuvo: no seriously, I will go for a walk at 7ish
[2012-05-06 22:46:48 -0400] chip-: Sitting on the patio drinking a beer and FaceTime with the folks :)
[2012-05-06 22:59:57 -0400] _numbers: sometimes there are situations where the current user must log out and log back in
[2012-05-06 23:00:05 -0400] _numbers: such as when you use sudo to change the group of the current user
[2012-05-06 23:00:12 -0400] _numbers: how can i tell chef or chef-solo to do this from within a recipe?
[2012-05-06 23:00:33 -0400] shuvo: this might not be a chef job but a fabric job
[2012-05-06 23:02:54 -0400] _numbers: fabric?
[2012-05-06 23:02:55 -0400] bawt_: fabric is a remote execution layer that is a lot more powerful than `knife ssh`
[2012-05-06 23:03:11 -0400] _numbers: we're using capistrano which is probably equal-to-or-greater-than
[2012-05-06 23:05:03 -0400] shuvo: yes, capistrano would be good. do you need to change the user groups often?
[2012-05-06 23:06:13 -0400] shuvo: the kind of use case you said makes more sense to be coded in capistrano. of course the gurus here will be able to tell better
[2012-05-06 23:09:23 -0400] _numbers: its a one-time thing
[2012-05-06 23:09:59 -0400] shuvo: I guessed so too. would use fabric/capistrano
[2012-05-06 23:10:14 -0400] _numbers: ok new question. i noticed if i define the same resource twice-in-a-row on the same recipe, like    group 'sudo' do ...      then if i had set any meta attributes like only_if or not_if, they also apply to the second .... how can i unset them between?
[2012-05-06 23:13:14 -0400] shuvo: can you create a gist or like of the code snippet
[2012-05-06 23:14:29 -0400] _numbers: The best way to execute this pattern is to give each resource a unique name, like so:
[2012-05-06 23:14:34 -0400] _numbers: http://ruby.dzone.com/articles/two-quick-chef-gotchas
[2012-05-06 23:15:56 -0400] _numbers: that works for him because he's using Execute resource, but i am using Group resource
[2012-05-06 23:16:01 -0400] _numbers: i wonder how i can work around it
[2012-05-06 23:16:44 -0400] |shad0w|: you can use group_name
[2012-05-06 23:17:04 -0400] |shad0w|: so that the resource definition will be different but the group name will be the same
[2012-05-06 23:17:08 -0400] _numbers: the group name is the same for both
[2012-05-06 23:17:13 -0400] |shad0w|: you also just might want to wrap the logic around the group resource
[2012-05-06 23:17:27 -0400] _numbers: how can i run the not_if bash test outside of a resource?
[2012-05-06 23:17:27 -0400] |shad0w|: bu the resource name would be different ...
[2012-05-06 23:17:36 -0400] |shad0w|: group name defaults to the resource name if not defined
[2012-05-06 23:17:39 -0400] _numbers: do you have an example of how to use group_name
[2012-05-06 23:17:49 -0400] |shad0w|: you can write pure ruby in your recipes
[2012-05-06 23:17:50 -0400] _numbers: is it group "sudo" { group_name 'blah' }
[2012-05-06 23:18:35 -0400] _numbers: ohh i see
[2012-05-06 23:18:42 -0400] _numbers: group "unique_name" { group_name "sudo" }
[2012-05-06 23:31:52 -0400] hoover_damn: you should never name 2 resources the same thing
[2012-05-06 23:32:01 -0400] hoover_damn: so naming your resources unique is a good
[2012-05-06 23:32:10 -0400] hoover_damn: wish someone told me that when I was learning chef
[2012-05-06 23:32:46 -0400] hoover_damn: I remember one day trying to futz with some ancient cookbooks that have been maintained over 2years trying to fix up some horrible resource issue
[2012-05-06 23:32:51 -0400] hoover_damn: was a lot of work
[2012-05-06 23:33:03 -0400] hoover_damn: template "/etc/nginx/nginx.conf" do in 40 recipes is easy
[2012-05-06 23:33:06 -0400] hoover_damn: :)
[2012-05-06 23:50:33 -0400] valdezjoetl: hi how do i copy all files in Files->Default on my /opt/MyDirectory/
