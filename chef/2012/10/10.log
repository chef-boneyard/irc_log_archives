[2012-10-10 00:10:00 -0400] aslan_: hey guys how can i create a remote client for my developers so they can have access to chef server with knife?
[2012-10-10 00:10:20 -0400] aslan_: i want them to be able to develop cookbooks on their local machine and then upload to the server
[2012-10-10 00:13:08 -0400] killfill: bluepojo, erikh: knife boostrap need to use chef-client/chef-server right?.. Should it work with chef-solo?
[2012-10-10 00:24:50 -0400] miah: you could create a new template that executes chef-solo on your node after installation.
[2012-10-10 00:25:11 -0400] miah: http://wiki.opscode.com/display/chef/Custom+Knife+Bootstrap+Script
[2012-10-10 00:31:02 -0400] hoover_damm: so, dumb question... if you want to assign a :default attribute in a lwrp that's a hash
[2012-10-10 00:31:05 -0400] hoover_damm: how?
[2012-10-10 00:31:32 -0400] hoover_damm: I have a :default => {"configobj" => "4.7.2", "psmisc", "0.0.1"}
[2012-10-10 00:33:02 -0400] hoover_damm: https://gist.github.com/bfbdab887e7807fc428a
[2012-10-10 00:33:26 -0400] hoover_damm: unexpected tLBRACE
[2012-10-10 00:34:09 -0400] miah: why not create the hash and name it 'foo' and then just do :default => foo
[2012-10-10 00:34:26 -0400] hoover_damm: because I didn't want to derp it up
[2012-10-10 00:34:32 -0400] hoover_damm: I wanted it to be clean and in your face
[2012-10-10 00:34:44 -0400] hoover_damm: not any monkeypatching or extra objects just to pass it
[2012-10-10 00:35:10 -0400] miah: lol. then don't use lwrp and jsut write a provider :P
[2012-10-10 00:35:18 -0400] hoover_damm: isn't that what i'm doing?
[2012-10-10 00:35:47 -0400] miah: no
[2012-10-10 00:36:07 -0400] miah: you're writing a lightweight provider resource, which is a dsl, which means extra objects and monkeypatching =)
[2012-10-10 00:37:43 -0400] hoover_damm: basically this loads easily in attributes
[2012-10-10 00:37:45 -0400] hoover_damm: straight forward
[2012-10-10 00:38:53 -0400] hoover_damm: in lwrp it's having a brace issue
[2012-10-10 00:40:14 -0400] miah: pass it a object rather than a block
[2012-10-10 00:40:17 -0400] aslan_: hoover_damm: hi there... i am trying to give some of my developers access to knife. what is the best way to do this?
[2012-10-10 00:40:45 -0400] aslan_: is there a way to do this without revealing the validation.pem?
[2012-10-10 00:41:03 -0400] miah: aslan_: validation.pem is only needed to add new clients automagically..
[2012-10-10 00:41:09 -0400] miah: you don't need to pass around validation.pem
[2012-10-10 00:41:20 -0400] miah: unless they will be adding nodes to your environment via knife bootstrap
[2012-10-10 00:41:23 -0400] aslan_: miah: so how can they setup their knife access?
[2012-10-10 00:41:35 -0400] miah: you can create accounts / clients for them and send them the pem's
[2012-10-10 00:41:50 -0400] aslan_: miah: no ... all they do is develop cookbooks and upload it to the server from their local box
[2012-10-10 00:42:07 -0400] miah: knife client create user1 -f user1.pem
[2012-10-10 00:42:08 -0400] miah: right
[2012-10-10 00:42:19 -0400] Axsuul: How do I check if a resource is available?
[2012-10-10 00:42:20 -0400] miah: to upload to the server they need admin access unless you are on hosted/private chef
[2012-10-10 00:42:27 -0400] aslan_: miah: is that enough for knife access?
[2012-10-10 00:42:39 -0400] miah: and if you are on hosted/private chef then you can use acl's to set that.
[2012-10-10 00:42:55 -0400] miah: a client without admin privleges is enough for knife access yes
[2012-10-10 00:42:56 -0400] aslan_: miah: no i am managing my own chef server
[2012-10-10 00:43:07 -0400] miah: ok, then they need to have admin privileges
[2012-10-10 00:43:25 -0400] aslan_: miah: there is no knife acl for chef server?
[2012-10-10 00:44:09 -0400] miah: no
[2012-10-10 00:44:25 -0400] miah: open source chef server doesn't have acl's
[2012-10-10 00:44:46 -0400] aslan_: miah: well... i can live with that. as long as they have individual accounts. is open source chef server going to have acl in the futuer?
[2012-10-10 00:45:36 -0400] miah: i have no idea. possibly?
[2012-10-10 00:45:47 -0400] miah: somebody from opscode would have to respond on that.
[2012-10-10 00:45:51 -0400] hoover_damm: miah, :( I really didn't want to :(
[2012-10-10 00:45:59 -0400] hoover_damm: miah, feels derpy
[2012-10-10 00:46:08 -0400] miah: hoover_damm: only if you hate OOP
[2012-10-10 00:46:32 -0400] aslan_: miah: thanks :)
[2012-10-10 00:47:30 -0400] hoover_damm: miah, I must
[2012-10-10 00:48:22 -0400] miah: aslan_: np
[2012-10-10 00:48:27 -0400] hoover_damm: miah, also you must remember having maintained a stack behind black magic and oop mirrors
[2012-10-10 00:48:30 -0400] hoover_damm: for awhile
[2012-10-10 00:48:36 -0400] hoover_damm: kinda makes you avoid that pattern
[2012-10-10 00:48:52 -0400] hoover_damm: it's actually where this reflex comes from tbh
[2012-10-10 00:48:58 -0400] hoover_damm: the desire to be up front and clear
[2012-10-10 00:49:54 -0400] hoover_damm: derp
[2012-10-10 00:50:01 -0400] hoover_damm: and the whole reason is likely because I can't spell
[2012-10-10 00:51:21 -0400] hoover_damm: sorry just been awhile since I cooked dedicated...
[2012-10-10 00:51:28 -0400] hoover_damm: so having silly issues
[2012-10-10 01:57:44 -0400] killfill: miah: but for using 'knife boostrap <etc>'.. do i need chef-client/server?...
[2012-10-10 02:01:59 -0400] zts: killfill: "knife bootstrap" makes use of a bootstrap script, and all of the ones that ship with knife assuming you are using client/server.  However, you can create a custom bootstrap script which doesn't assume that
[2012-10-10 02:02:29 -0400] redgetan: im having a problem with adding users to "sudo" group number 27
[2012-10-10 02:02:42 -0400] redgetan: this is a snippet of my code: http://pastie.org/5027379
[2012-10-10 02:02:55 -0400] redgetan: and my 2 databags are http://pastie.org/5027383 & http://pastie.org/5027385
[2012-10-10 02:02:56 -0400] zts: killfill: the page miah linked tells how to do that
[2012-10-10 02:03:41 -0400] zts: redgetan: what's the problem you're having?
[2012-10-10 02:03:44 -0400] redgetan: once i apply the recipe and login to the server, the group ids are not set properly
[2012-10-10 02:03:52 -0400] redgetan: id -G law gives me 1003
[2012-10-10 02:03:58 -0400] redgetan: id -G reg gives me 27
[2012-10-10 02:04:13 -0400] redgetan: i was expecting
[2012-10-10 02:04:29 -0400] redgetan: id -G law to give me 1003 27
[2012-10-10 02:04:36 -0400] redgetan: id -G reg to give me 1004 27
[2012-10-10 02:05:11 -0400] sunil__: I have a chef role to do add sudo users and disable passwordless sudo for themIs there a way for me to add an exception for a single user to be able to do passwordless sudo?
[2012-10-10 02:05:12 -0400] killfill: zts: well, the only command that works for me with knife is installing a cookbook. "No such file or directory - /etc/chef/validation.pem"  ive not set up chef-client yet..  (want to understand how chef-solo can work on my environment first)
[2012-10-10 02:06:20 -0400] zts: redgetan: I think there's two problems there - that it doesn't do what you want is the second, the first thing to explain is why the behaviour is different for both users
[2012-10-10 02:06:30 -0400] killfill: zts: do i need to set that up?.. (i hoped not..)
[2012-10-10 02:07:37 -0400] zts: redgetan: the data bags you pastied, did you take those from your chef repo, or by retrieving from the server (eg, knife data bag show users reg)
[2012-10-10 02:07:58 -0400] redgetan: from my chef-repo
[2012-10-10 02:08:08 -0400] redgetan: i didnt use knife
[2012-10-10 02:08:21 -0400] redgetan: i created it manually under data_bags/users/ folder
[2012-10-10 02:08:58 -0400] redgetan: let me try not using databags and see if i get same prob
[2012-10-10 02:09:10 -0400] zts: redgetan: have you uploaded them to the chef server?  (eg, knife data bag from file users reg.json)
[2012-10-10 02:09:23 -0400] redgetan: nope, im using chef-solo
[2012-10-10 02:09:24 -0400] zts: redgetan: remember, chef-client can't see what is in your chef-repo - it will only use what is on the server
[2012-10-10 02:09:28 -0400] zts: oh!  sorry
[2012-10-10 02:09:33 -0400] redgetan: no worries :)
[2012-10-10 02:09:38 -0400] zts: bad assumption :)
[2012-10-10 02:10:21 -0400] zts: I don't use chef-solo much, so I might not be very helpful.  Can you pastie the whole logs from a run of "chef-solo -l debug" ?
[2012-10-10 02:10:35 -0400] zts: killfill: let me just check something...
[2012-10-10 02:13:55 -0400] redgetan: zts: http://pastie.org/5027420
[2012-10-10 02:13:56 -0400] zts: killfill: okay, I am pretty sure that if you don't mention validation_key in your bootstrap template, then knife won't try to load the validation.pem
[2012-10-10 02:14:17 -0400] zts: killfill: it won't hurt you to create an empty file for that if you have a problem, but it is only used by chef-client
[2012-10-10 02:14:17 -0400] killfill: oh
[2012-10-10 02:14:28 -0400] killfill: greate
[2012-10-10 02:15:02 -0400] zts: killfill: if you're just getting started with Chef, you may find it easiest to try out chef-client using opscode's Hosted Chef - there's a lot more documentation about how to use it, and that can be helpful when you're getting started
[2012-10-10 02:15:27 -0400] zts: killfill: but it should certainly be possible to use "knife bootstrap" to setup your servers for chef-solo - but maybe not without some extra work by you
[2012-10-10 02:15:53 -0400] erikh: ./w 2
[2012-10-10 02:15:55 -0400] zts: killfill: if you have a look at Miah's link, that'll tell you how to find the bootstrap templates on your system.  Take a look at one of them, and see if it makes any sense
[2012-10-10 02:16:08 -0400] killfill: i guess im taking the difficuly way.. :P   just trying to understand how all this works.. leaving the 'magic' for later..
[2012-10-10 02:16:43 -0400] killfill: zts: im playing with some scripts myself to automatize some things already..
[2012-10-10 02:16:51 -0400] zts: killfill: I can appreciate both approaches :)  It's certainly possible to work it out the way you are, although you may need to read the code a little bit.
[2012-10-10 02:17:20 -0400] killfill: heh, cool
[2012-10-10 02:17:28 -0400] killfill: zts: thanks.
[2012-10-10 02:17:35 -0400] zts: killfill: no problem
[2012-10-10 02:18:07 -0400] zts: redgetan: okay, that output is interesting - see the "Executing useraddd" bits.  It doesn't seem to be picking up the gid for "law" at all
[2012-10-10 02:19:00 -0400] zts: redgetan: but I don't see any differences in your data bag items that would cause that
[2012-10-10 02:19:28 -0400] zts: redgetan: one thing I can point out, though, is that the 'gid' attribute of the user resource will only set the primary group
[2012-10-10 02:19:57 -0400] zts: redgetan: what you probably want to do is use the 'group' resource to add those users to gid 27
[2012-10-10 02:20:13 -0400] zts: Sorry that that only helps with half of your problem, though
[2012-10-10 02:22:00 -0400] redgetan: ic, i didnt know about 'group' resource
[2012-10-10 02:22:02 -0400] redgetan: thanks for that
[2012-10-10 02:22:13 -0400] redgetan: i think i know what my problem is now
[2012-10-10 02:25:27 -0400] redgetan: my deploy script is incorrect
[2012-10-10 02:26:06 -0400] redgetan: im sending the wrong data_bag json files to my target server
[2012-10-10 02:48:19 -0400] sunil__: I am trying to figure out how to make user2 be able to do passwordless sudo Here's a snippet of my role definition   http://pastebin.com/wvvhMm0n
[2012-10-10 02:49:29 -0400] redgetan: sunil__: i was just doing that earlier :) this is how i did it
[2012-10-10 02:49:30 -0400] redgetan: http://pastie.org/5027522
[2012-10-10 02:49:46 -0400] redgetan: kinda borrowed the command from vagrant
[2012-10-10 02:50:26 -0400] redgetan: sunil__: then all u have to do is add users to the sudo group
[2012-10-10 02:51:27 -0400] sunil__: is there a way to do it right from the role definition?
[2012-10-10 02:51:53 -0400] redgetan: not sure, i dont know about roles yet
[2012-10-10 02:52:24 -0400] sunil__: users listed in the role gets sudo access.. I find it being able to do this in role definitions keeps things super clean..
[2012-10-10 02:53:18 -0400] zts: sunil__: if you're using the opscode sudo cookbook, there is no way to do what you're asking - redgetan's solution will work, or you will need to improve the sudo cookbook
[2012-10-10 02:54:02 -0400] sunil__: Thanks zts..
[2012-10-10 02:54:16 -0400] zts: sunil__: it would certainly be nice to have more fine-grained controls for sudoers, I'm sure a patch would be accepted if you shared your work :)
[2012-10-10 02:55:05 -0400] flaccid: yeah zts, sudo cookbook can do that :)
[2012-10-10 02:55:15 -0400] flaccid: and for vagrant, i also configure it so its 'vagrant friendly'
[2012-10-10 02:56:42 -0400] zts: flaccid: hmm, the template suggests that you can set NOPASSWD for everyone or noone...
[2012-10-10 02:56:54 -0400] zts: oh!  But there's now a sudo LWRP that you could use for it
[2012-10-10 02:56:59 -0400] flaccid: isn't it per group though
[2012-10-10 02:57:05 -0400] flaccid: ah yeah that too
[2012-10-10 02:57:26 -0400] flaccid: i like the sudo cookbook
[2012-10-10 02:57:38 -0400] zts: sunil__: https://github.com/opscode-cookbooks/sudo Have a look at the "sudo LWRP" section of the readme.  You won't be able to do it directly in a role, but that will let you do what you need
[2012-10-10 02:58:04 -0400] zts: I hadn't noticed the introduction of the LWRP, that's very handy
[2012-10-10 02:58:21 -0400] flaccid: there is probably only a few more improvements needed for that cookbook
[2012-10-10 03:21:22 -0400] sunil__: @zts good suggestion..:) On the other hand I was thinking about a way to just include another file for users requiring passwordless but this will certainly work.
[2012-10-10 06:12:53 -0400] jcwdev: Deploy resource Wiki Article says: "You could also use this in more interesting ways, for example, if you have a "deploy" or "production" branch in git, you can set the provider to track this branch. This will cause your deployment to get updated the next time chef runs after pushing to that branch."
[2012-10-10 06:13:30 -0400] jcwdev: I would love to set this up to drive CI
[2012-10-10 06:13:59 -0400] jcwdev: how would you "set the provider to track this branch" ?
[2012-10-10 06:14:06 -0400] jcwdev: as it mentions
[2012-10-10 06:17:12 -0400] zts: jcwdev: use the "revision" parameter - search for "using_different_branches_in_git" on that page to see an example
[2012-10-10 06:17:32 -0400] jcwdev: does it matter that i am using subversion?
[2012-10-10 06:18:29 -0400] jcwdev: ok, so i get the using different branches part
[2012-10-10 06:19:38 -0400] jcwdev: i am trying to figure out how to have chef watch for changes to the repository and update the node automatically - which is what i thought that line was describing
[2012-10-10 06:21:08 -0400] zts: jcwdev: sort of... when chef runs, it will check the repository, and update the node if that revision has changed.  It won't, however, automatically run chef when the repository is updated
[2012-10-10 06:21:26 -0400] jcwdev: i understand
[2012-10-10 06:22:04 -0400] jcwdev: but if chef runs every 5 minutes on my CI instance then pretty much the same eh?
[2012-10-10 06:22:41 -0400] jcwdev: right now i'm doing it with a cron job, not the slickest thing in the world.
[2012-10-10 06:22:52 -0400] zts: :) sounds like that'd be a nice improvement then
[2012-10-10 06:26:03 -0400] jcwdev: sound to me like you have seen better still :)
[2012-10-10 06:27:29 -0400] zts: The answer to almost every question in that general area is "it depends" :)  My philosophy is it's important to keep improving
[2012-10-10 06:27:40 -0400] zts: and sometimes, aiming for the best possible thing is an enemy to making any improvement at all
[2012-10-10 06:28:57 -0400] zts: My personal preference is to schedule chef to run relatively infrequently, then kick off runs when they're required (eg, from a commit hook)
[2012-10-10 06:29:34 -0400] jcwdev: good to know. thank you for the insight Sir. much appreciated.
[2012-10-10 06:30:49 -0400] zts: no problem, if you try it, let me know how it works with subversion?  I haven't used it since I've done a lot with Chef, and it'd be nice to know if I'm in for any surprises the next time :)
[2012-10-10 06:36:49 -0400] jcwdev: sure thing :)
[2012-10-10 06:37:12 -0400] jcwdev: the commit-hook is a good approach but not an option for me with Jira as a service
[2012-10-10 06:37:56 -0400] jcwdev: they have one commit hook available in their on-demand offering and it's no help here.
[2012-10-10 06:38:48 -0400] jcwdev: perhaps i'll use a job to do the change discovery and let it kick off chef-client now instead
[2012-10-10 06:44:43 -0400] zts: could do, if you've already got a job handy - otherwise, might as well start off with the frequent chef-client runs, and see if it causes you problems
[2012-10-10 06:44:52 -0400] zts: if you're happy with how that works out, might as well spend your time on something else instead :)
[2012-10-10 06:47:45 -0400] jcwdev: yeah, can gut the existing job for that logic.
[2012-10-10 06:48:44 -0400] jcwdev: any idea if there is a way to get chef to spit out more info when it fails? trying to determine why the deploy resource doesn't deploy is getting painful
[2012-10-10 06:58:49 -0400] cwj: jcwdev: run chef with -l debug
[2012-10-10 06:59:11 -0400] cwj: you will get a whole lot of output
[2012-10-10 06:59:13 -0400] jcwdev: i wonder how i can tell vagrant to do that
[2012-10-10 06:59:34 -0400] cwj: https://github.com/mitchellh/vagrant/issues/28
[2012-10-10 07:06:36 -0400] jcwdev: perfect. changed a bit since that bug but in chef-solo provisioner block: chef.log_level = :debug
[2012-10-10 07:06:43 -0400] jcwdev: there is my error, plain as day
[2012-10-10 07:10:39 -0400] cwj: tada!
[2012-10-10 07:37:04 -0400] Null_Route: Hey Guys! I'm trying to take my Chef deployment from "provisioning" to "maintaining", and I'm having trouble finding documentation. That is, there is lots of documentation about writing cookbooks, but not a lot of documentation about how to, say, set up Chef to run periodically, how often is recommended
[2012-10-10 07:37:21 -0400] Null_Route: Of course by "recommended", I mean "real-world examples"
[2012-10-10 07:38:33 -0400] Null_Route: Is there a document in the wiki that gives an example of continuous configuration management of a server and, say, a an example of making a change on the Chef server and following the process to all clients?
[2012-10-10 07:43:34 -0400] Null_Route: For example, There is a REALLY good hands-on document at http://devopsanywhere.blogspot.co.il/2011/10/month-with-chef.html about moving provisinoing to Chef, but nothing about KEEPING the servers in step.
[2012-10-10 07:44:26 -0400] erikh: hm
[2012-10-10 07:44:46 -0400] Null_Route: thanks!!!
[2012-10-10 07:45:34 -0400] erikh: but here's the short of it: make liberal use of the chef-client cookbook to persist your daemon, properly constrain your cookbooks with environments and if it's not in source control, it sure as hell better not be on the chef server.
[2012-10-10 07:45:42 -0400] Null_Route: ...saying that you can run ghte Chef-Celint as a daemon doesn't help a susadmin DESIGN for CM
[2012-10-10 07:46:09 -0400] Null_Route: (wow - that's a lot of typos.)
[2012-10-10 07:46:14 -0400] BryanWB_: Null_Route: glad u like that artilce :)
[2012-10-10 07:46:31 -0400] erikh: yeah, so the opscode cookbook called "chef-client" has a default recipe which will install it into your init system
[2012-10-10 07:46:44 -0400] Null_Route: BryanWB_: It's a VERY good article
[2012-10-10 07:46:46 -0400] erikh: whether that be upstart, runsv, or sysv init.
[2012-10-10 07:46:47 -0400] Null_Route: :-)
[2012-10-10 07:46:48 -0400] erikh: etc.
[2012-10-10 07:47:07 -0400] erikh: put it in your base role, and voila.
[2012-10-10 07:47:17 -0400] Null_Route: ...but I have a bunch of cookbooks hacked to gether, and I need to present a plan on, say, how we're going to propogate changes
[2012-10-10 07:47:35 -0400] Null_Route: erikh: I mean from more of a deployment PLANNING view
[2012-10-10 07:47:44 -0400] erikh: the two comments about versioning/environments and source control are pretty critical for that.
[2012-10-10 07:47:52 -0400] Null_Route: examples of, say,
[2012-10-10 07:48:00 -0400] Null_Route: (1) Running the chef client daemon every hour
[2012-10-10 07:48:12 -0400] erikh: chef-client cookbook will manage that for you
[2012-10-10 07:48:14 -0400] Null_Route: (2) commiting the change to a testing chef e"nvironment"
[2012-10-10 07:48:23 -0400] erikh: that's what chef environments are for
[2012-10-10 07:48:28 -0400] erikh: (and cookbook versions)
[2012-10-10 07:48:30 -0400] Null_Route: erikh: Correct
[2012-10-10 07:48:51 -0400] erikh: and if you have good source control branching and tagging should be trivial.
[2012-10-10 07:48:57 -0400] Null_Route: but I havn't found any actually documenting  hands-on examples of anyone doing long-term Configuration Management
[2012-10-10 07:49:08 -0400] Null_Route: policies
[2012-10-10 07:49:27 -0400] erikh: I'm trying to give you the shorthand here
[2012-10-10 07:49:29 -0400] erikh: :)
[2012-10-10 07:49:35 -0400] Null_Route: something I can study anf go back to my boss with a PLAN
[2012-10-10 07:49:41 -0400] Null_Route: erikh: thank you,
[2012-10-10 07:49:50 -0400] Null_Route: ...and that's basically what I was doingh
[2012-10-10 07:50:03 -0400] Null_Route: but I have no way to validate that my plans are "best practices"
[2012-10-10 07:50:17 -0400] Null_Route: ...or that someone already tried that, and found a MUCH better way after 67 months of hell.
[2012-10-10 07:50:29 -0400] Null_Route: (or 6 months...)
[2012-10-10 07:50:36 -0400] erikh: I can talk about two approaches that have worked well for different environments
[2012-10-10 07:50:55 -0400] erikh: but yeah, I'm not a "thought leader" or anything, and if your boss has any sense he's not going to automatically accept some blog post as a best practice.
[2012-10-10 07:51:07 -0400] erikh: from me or anywhere else.
[2012-10-10 07:51:21 -0400] Null_Route: erikh: he'll accept the plan I present to him, if it makes sense
[2012-10-10 07:51:28 -0400] Null_Route: ...after it makes sense to me
[2012-10-10 07:51:30 -0400] erikh: honestly, as with all policies, it's best to KISS and add as necessary
[2012-10-10 07:51:36 -0400] Null_Route: we won't accept it blindly, if that's your point
[2012-10-10 07:52:22 -0400] Null_Route: hmmmm
[2012-10-10 07:52:51 -0400] erikh: really, a lot of doing devops right is finding what works best for your organization. I suggest you start with things you know are going to work for you guys and moving forward from there.
[2012-10-10 07:53:22 -0400] Null_Route: erikh: correct - That's what we've been doing until now
[2012-10-10 07:53:25 -0400] Null_Route: which is cool
[2012-10-10 07:53:34 -0400] Null_Route: and deployments with Chef work great
[2012-10-10 07:53:44 -0400] erikh: I'd just continue down that road and try ideas as you come across them, if they fit of course.
[2012-10-10 07:53:51 -0400] Null_Route: cool.
[2012-10-10 07:54:00 -0400] erikh: make it up as you go along -- it's agile in a nutshell :)
[2012-10-10 07:54:06 -0400] Null_Route: :-)
[2012-10-10 07:54:28 -0400] Null_Route: can I start a flame-war about something?
[2012-10-10 07:54:49 -0400] erikh: I mean, the other process required a chef server for each environment, a git branch for each one, and heavy, heavy, heavy use of git rebase
[2012-10-10 07:55:42 -0400] Null_Route: WHile we've been using CentoOS for a few years now, I decided to use Ubuntu for the Chef Server -
[2012-10-10 07:55:46 -0400] erikh: it worked extremely well for our needs, but also brought its own challenges. our ops team was larger than many and stomping on each other was pretty easy.
[2012-10-10 07:56:07 -0400] Null_Route: erikh: cool
[2012-10-10 07:56:22 -0400] Null_Route: installation on Ubuntu is worlds better
[2012-10-10 07:56:31 -0400] erikh: for small ops teams though, you'd be silly to adopt such a thing
[2012-10-10 07:56:46 -0400] erikh: yeah. chef is notoriously better on ubuntu, but it's getting there with centos.
[2012-10-10 07:57:17 -0400] Null_Route: we're setting up a new web app
[2012-10-10 07:57:30 -0400] Null_Route: and we're deciding whether to use Ubuntu or CentOS
[2012-10-10 07:57:41 -0400] Null_Route: As far as management, our team is proficient in both
[2012-10-10 07:58:02 -0400] Null_Route: and I was just curious as to how support for the Chef-CLIENT differs between the distros
[2012-10-10 07:58:11 -0400] erikh: it's better on ubuntu
[2012-10-10 07:58:25 -0400] erikh: especially when it comes to community cookbooks.
[2012-10-10 07:58:30 -0400] Null_Route: Hmmm
[2012-10-10 07:59:16 -0400] Null_Route: If our cloud isntances are going to be Chef-Managed, then perhaps we may be better off using Ubuntu. That is, considering the plan is never to touch them after they're provisioned.
[2012-10-10 07:59:20 -0400] erikh: there's a lot of work going into centos support. a lot of bigger groups are responsible and it's all of very high quality.
[2012-10-10 07:59:37 -0400] erikh: that said, it's "getting there" but definitely doesn't have the intertia that ubuntu has had for some time
[2012-10-10 08:00:05 -0400] Null_Route: cool. Thank you, erikh !
[2012-10-10 08:00:15 -0400] Null_Route: and BryanWB_ - thank you for the great article!
[2012-10-10 08:00:21 -0400] erikh: aye. sitting here, waiting for my maintenance window to open
[2012-10-10 08:02:40 -0400] BryanWB_: Null_Route: my pleasure!
[2012-10-10 10:02:27 -0400] masterkorp: Hey guys, i have a template with a notify block
[2012-10-10 10:02:45 -0400] masterkorp: and it restarts the service *every chef run*
[2012-10-10 10:02:58 -0400] masterkorp: and the template never changes
[2012-10-10 10:04:22 -0400] masterkorp: http://paste.debian.net/198433/
[2012-10-10 10:04:29 -0400] masterkorp: here is my chef run
[2012-10-10 10:08:15 -0400] _rc: masterkorp: according to line 70 it did change the template
[2012-10-10 10:09:30 -0400] jb__: masterkorp: first you template and then cookbook_file the pagerduty cfg
[2012-10-10 10:09:32 -0400] jb__: so..
[2012-10-10 10:13:31 -0400] masterkorp: but it does not
[2012-10-10 10:13:37 -0400] masterkorp: it never changes
[2012-10-10 10:13:46 -0400] masterkorp: let me do a diff
[2012-10-10 10:15:01 -0400] masterkorp: root@nagios-new:/etc/nagios3/conf.d# diff pagerduty_nagios.cfg /var/chef/cache/cookbooks/nagios/templates/default/pagerduty_nagios.cfg.erb
[2012-10-10 10:15:04 -0400] masterkorp: 0
[2012-10-10 10:15:40 -0400] masterkorp: Funny someone created a template with no variables
[2012-10-10 10:16:26 -0400] masterkorp: maybe is that what its causing it
[2012-10-10 10:17:27 -0400] bobw: it changed owjner group and permissions
[2012-10-10 10:17:52 -0400] flashingpumpkin: guys. I'm still stuck at bootstrapping chef-server with chef-solo: http://dpaste.org/FmP9J/
[2012-10-10 10:18:12 -0400] masterkorp: root@nagios-new:/etc/nagios3/conf.d# ls -als pagerduty_nagios.cfg
[2012-10-10 10:18:13 -0400] masterkorp: 4 -rw-r--r-- 1 nagios nagios 920 2012-10-10 05:56 pagerduty_nagios.cfg
[2012-10-10 10:18:17 -0400] masterkorp: not it did not
[2012-10-10 10:18:35 -0400] masterkorp: owner and group nagios, mode 0644
[2012-10-10 10:18:53 -0400] bobw: it thinks it did though.
[2012-10-10 10:19:04 -0400] _rc: the log says that's what it changed it to
[2012-10-10 10:22:10 -0400] masterkorp: Something fishy in here
[2012-10-10 10:23:07 -0400] bobw: the campfire confgi did the same as well
[2012-10-10 10:25:30 -0400] jb__: masterkorp: in every run you cookbook_file the pagerduty-cfg (nagios::server line 157), then again you template the same file (nagios::server line 149)
[2012-10-10 10:25:53 -0400] jb__: masterkorp: since content/owner-group differs from cookbook-file and template it notifies to restart
[2012-10-10 10:26:07 -0400] masterkorp: jb__: thing is, its a template
[2012-10-10 10:26:20 -0400] jb__: masterkorp: beside the fact that it makes no sense to have the same file first handled through template and then through cookbook_file
[2012-10-10 10:26:30 -0400] jb__: masterkorp: then kick the cookbook_file directive on line 157
[2012-10-10 10:26:45 -0400] masterkorp: Yeah this is mess
[2012-10-10 10:26:57 -0400] masterkorp: it makes no sense having a template with no vars either
[2012-10-10 10:27:03 -0400] _rc: jb__: that's  cookbook_file[/usr/local/bin/pagerduty_nagios.pl] not template[/etc/nagios3/conf.d/pagerduty_nagios.cfg]
[2012-10-10 10:27:10 -0400] _rc: unless I'm reading this wrong
[2012-10-10 10:27:16 -0400] jb__: _rc: whoops :-)
[2012-10-10 10:27:18 -0400] masterkorp: i think its that what its folling it
[2012-10-10 10:27:27 -0400] jb__: _rc: you're right
[2012-10-10 10:27:45 -0400] _rc: though that would certainly do it, if it was the case
[2012-10-10 10:27:57 -0400] jb__: _rc: just searched for pagerduty and didnt looked closely, hehe
[2012-10-10 10:28:13 -0400] masterkorp: I need to lint this cookbook with foodcritic
[2012-10-10 10:28:15 -0400] masterkorp: a mess
[2012-10-10 10:30:56 -0400] flashingpumpkin: it appears that the failing bootstrap might be na EC2 AMI issue? (http://community.opscode.com/chat/chef/2012-04-27)
[2012-10-10 10:31:38 -0400] sameerse_: Hi, I uploaded my cookbook successfully. Ran "sudo chef-client" but the updates to the cookbook do not reflect -- new knew templates, changes to recipe/default.rb
[2012-10-10 10:31:55 -0400] sameerse_: What are the steps I need to push updates to a cookbook>
[2012-10-10 10:32:09 -0400] _rc: Are you version pinning anywhere?
[2012-10-10 10:33:14 -0400] sameerse_: No - haven't frozen the cookbook version, but I haven't changed the version number in the cookbook either?
[2012-10-10 10:37:12 -0400] sameerse_: any thoughts, _rc?
[2012-10-10 10:39:51 -0400] flashingpumpkin: hm. I think the issue is that 'build-essential' was missing
[2012-10-10 10:40:05 -0400] flashingpumpkin: hence the could not create makefile
[2012-10-10 10:45:08 -0400] pietia: is overriding node['languages']['ruby'] a bad practice?
[2012-10-10 11:07:21 -0400] renchap: is it a way to set automatic attributes from a recipe ?
[2012-10-10 11:07:38 -0400] renchap: or a way to store attributes that does not appear in a knife node edit
[2012-10-10 11:58:29 -0400] ehaselwanter: is there a way to store the default ssh paramters in the knife.rb file
[2012-10-10 12:08:58 -0400] tknerr_: ohai
[2012-10-10 12:09:26 -0400] tknerr_: anyone using vagrant/chef behind a proxy?
[2012-10-10 12:09:52 -0400] tknerr_: i'm looking for a painless method of switching "proxy mode" on/off
[2012-10-10 12:26:19 -0400] aruntomar: renchap: you can use automatic attributes but you can modify them
[2012-10-10 12:44:39 -0400] intinig: can anyone help me understand this error? "ArgumentError: Attribute dir is not defined"
[2012-10-10 12:44:48 -0400] intinig: during a chef-solo run
[2012-10-10 12:44:58 -0400] _dumfrie-: Is your attribute dir defined ;)
[2012-10-10 12:45:21 -0400] intinig: I have no idea of what it means :) - I have an attribute dir and there are some files in it and they tend to work in other parts of the recipe s:)
[2012-10-10 12:45:57 -0400] _dumfrie-: well can you show me your recipe ?
[2012-10-10 12:46:03 -0400] intinig: sure :)
[2012-10-10 12:49:31 -0400] intinig: this is the part that fails
[2012-10-10 12:49:31 -0400] intinig: https://gist.github.com/3865399
[2012-10-10 12:50:06 -0400] _dumfrie-: and you've set nginx_config_path somewhere in the recipe?
[2012-10-10 12:50:18 -0400] intinig: yes let me show you just a sec :)
[2012-10-10 12:50:25 -0400] _dumfrie-: no worries
[2012-10-10 12:51:56 -0400] intinig: full recipe
[2012-10-10 12:51:57 -0400] intinig: https://gist.github.com/3865418
[2012-10-10 12:56:02 -0400] _dumfrie-: hmm, off hand that looks fine.
[2012-10-10 12:56:46 -0400] intinig: the full error is this
[2012-10-10 12:57:11 -0400] intinig: https://gist.github.com/3865465
[2012-10-10 12:58:40 -0400] _dumfrie-: intinig ah, only_if do ::File.symlink?("#{node['nginx']['dir']}/sites-enabled/#{params[:name]}") in the nginx_site definition.
[2012-10-10 13:01:29 -0400] intinig: _dumfrie-: I'm not following you there :)
[2012-10-10 13:02:15 -0400] _dumfrie-: it is looking for a attribute node.nginx.dir which doesn't exist in the context of a solo run iirc.
[2012-10-10 13:02:55 -0400] intinig: ooooh I understand now :)
[2012-10-10 13:02:57 -0400] _dumfrie-: you can add that in the json file though.
[2012-10-10 13:03:20 -0400] _dumfrie-: { "nginx": "dir": "/foo/bar" }
[2012-10-10 13:04:02 -0400] intinig: _dumfrie-: the part I don't understand is: why does this work in the screencast I am following? :) but I'll leave that for another day ;)
[2012-10-10 13:04:14 -0400] _dumfrie-: well that I cannot tell you ;)
[2012-10-10 13:04:31 -0400] _dumfrie-: could be the version of the cookbook they are using, or a custom one.
[2012-10-10 13:08:39 -0400] killfill: hi all
[2012-10-10 13:09:42 -0400] killfill: lets say i have two 'front' servers, and six 'backend' ones.  how would i the reciep on the front ones, so it can balance to all six backend's?..  if i add a new backend, i wish the front to noticed that and add it to the balancing
[2012-10-10 13:10:06 -0400] killfill: is this what databags are for?
[2012-10-10 13:11:27 -0400] _rc: you can use a databag, or just a role-based search
[2012-10-10 13:18:35 -0400] zined: ohai
[2012-10-10 13:18:52 -0400] zined: chef doesn't have a provider to apply patch files included, does it?
[2012-10-10 13:30:03 -0400] masterkorp: Guys cam i search for nodes that *do not* have a certain role?
[2012-10-10 13:30:22 -0400] masterkorp: tried knife search node "NOT role:base*"
[2012-10-10 13:42:55 -0400] _dumfrie-: masterkorp what would something like knife search node "*:* NOT role:base" give you ?
[2012-10-10 13:44:35 -0400] masterkorp: interetings
[2012-10-10 13:45:32 -0400] jonlives: masterkorp: try knife search node "(NOT role:base*)"
[2012-10-10 13:45:47 -0400] masterkorp: tried
[2012-10-10 13:45:49 -0400] masterkorp: ^Cmasterkorp ~ $ knife search node "*:* NOT role:base"
[2012-10-10 13:45:51 -0400] masterkorp: ERROR: Server returned error for http://10.0.0.18:4000/search/node?q=*%253A*%2520NOT%2520role%253Abase&sort=&start=0&rows=1000, retrying 1/5 in 3s
[2012-10-10 13:45:58 -0400] masterkorp: this one not very lucky
[2012-10-10 13:46:41 -0400] jonlives: masterkorp: you tried it with the query in brackets?
[2012-10-10 13:47:08 -0400] masterkorp: i am up for anything now
[2012-10-10 13:47:27 -0400] masterkorp: ERROR: knife search failed: invalid search query: '%5BNOT%20role%3Abase%5D' Parse error at offset: 0 Reason: Expected one of (, AND, OR, NOT, \, ?, !, +, -, " at line 1, column 1 (byte 1) after
[2012-10-10 13:47:29 -0400] masterkorp: ERROR: knife search failed: invalid search query: '%5BNOT%20role%3Abase%5D' Parse error at offset: 0 Reason: Expected one of (, AND, OR, NOT, \, ?, !, +, -, " at line 1, column 1 (byte 1) after
[2012-10-10 13:47:31 -0400] masterkorp: oops sorry
[2012-10-10 13:49:23 -0400] masterkorp: no luck
[2012-10-10 13:50:01 -0400] masterkorp: i am trying this now
[2012-10-10 13:50:19 -0400] masterkorp: knife search node "*:*" > all.out
[2012-10-10 13:50:33 -0400] masterkorp: knife search node "role:base" > base.out
[2012-10-10 13:50:37 -0400] masterkorp: diff base all
[2012-10-10 13:50:54 -0400] masterkorp: but since they dont come in the smae order there is too much diffs
[2012-10-10 13:51:33 -0400] masterkorp: i tried with -o name to sort but it gives me an error
[2012-10-10 13:54:59 -0400] mattp: matschaffer: add  |grep Name |sort to the end of the knife commands before redirecting to a file. then diff the resulting files
[2012-10-10 14:02:48 -0400] masterkorp: mattp: thanks
[2012-10-10 14:02:56 -0400] masterkorp: assuming that was a tab fail
[2012-10-10 14:05:10 -0400] masterkorp: I was really expecting with to do with knife tough
[2012-10-10 14:05:14 -0400] zts: masterkorp: for what it's worth, jonlives suggestion works for me:  knife search node "(NOT roles:base)"
[2012-10-10 14:05:29 -0400] masterkorp: oh its roles!
[2012-10-10 14:05:31 -0400] zts: masterkorp: this works for me too: knife search node "*:*" -o name
[2012-10-10 14:05:57 -0400] zts: masterkorp: yeah, role: will only match if the role is in your run_list - if it is included from something else, you need roles:
[2012-10-10 14:06:11 -0400] zts: masterkorp: but "-o name" to sort should work - what error did you get?
[2012-10-10 14:07:11 -0400] masterkorp: masterkorp ~ $ knife search node "(NOT roles:base)" -o name
[2012-10-10 14:07:13 -0400] masterkorp: ERROR: Server returned error for http://10.0.0.18:4000/search/node?q=(NOT%2520roles%253Abase)&sort=name&start=0&rows=1000, retrying 1/5 in 3s
[2012-10-10 14:07:20 -0400] masterkorp: this and so on untill 5
[2012-10-10 14:09:43 -0400] masterkorp: knife search node "(NOT roles:base*)" -i
[2012-10-10 14:09:45 -0400] masterkorp: knife search node "(NOT roles:base*)" -i
[2012-10-10 14:09:47 -0400] masterkorp: knife search node "(NOT roles:base*)" -i
[2012-10-10 14:09:49 -0400] masterkorp: knife search node "(NOT roles:base*)" -i
[2012-10-10 14:09:51 -0400] masterkorp: oops
[2012-10-10 14:09:53 -0400] masterkorp: this one worked
[2012-10-10 14:09:55 -0400] masterkorp: thanks
[2012-10-10 14:10:27 -0400] zts: no problem, and glad to hear it, although you might want to investigate why search does not work properly (maybe check your chef server logs for more hints)
[2012-10-10 14:11:12 -0400] masterkorp: I added a task for that
[2012-10-10 14:12:14 -0400] mstyne: good morning all
[2012-10-10 14:12:26 -0400] mstyne: is anyone aware of a knife plugin(?) to diff two cookbook versions
[2012-10-10 14:12:55 -0400] mstyne: or should I just download both and diff them with ... diff.
[2012-10-10 14:17:07 -0400] zts: mstyne: I've seen some plugins to diff a cookbook on the server with a local copy, but not to diff two versions on the server
[2012-10-10 14:17:07 -0400] drrk: with LRWPs am I right that the :callbacks parameter can be used to define smoe custome parameter validation?
[2012-10-10 14:17:33 -0400] drrk: if it can, can it also be used to define defaults if the parameter is forexample a hash
[2012-10-10 14:17:36 -0400] mstyne: zts: I saw the same
[2012-10-10 14:17:55 -0400] mstyne: okay, i'll go the path of least resistance
[2012-10-10 14:17:57 -0400] mstyne: zts: thanks
[2012-10-10 14:18:26 -0400] zts: mstyne: no problem, that's what I ended up doing too
[2012-10-10 14:18:37 -0400] mstyne: :)
[2012-10-10 14:19:46 -0400] yfeldblum: drrk, to what are you referring?
[2012-10-10 14:21:21 -0400] yfeldblum: drrk, for example, here's how the Chef::Resource::File#checksum method is implemented (it's the "checksum" attribute for "file" resources) https://github.com/opscode/chef/blob/master/chef/lib/chef/resource/file.rb#L69-75
[2012-10-10 14:22:15 -0400] drrk: yfeldblum: this page: http://wiki.opscode.com/display/chef/Lightweight+Resources+and+Providers+%28LWRP%29
[2012-10-10 14:22:28 -0400] drrk: i'll look at the File code though, thanks
[2012-10-10 14:30:43 -0400] drrk: yfeldblum: that's not an LRWP though, so doesn't really answer my question
[2012-10-10 14:30:51 -0400] drrk: LWRP even
[2012-10-10 14:31:10 -0400] yfeldblum: drrk, LWRP's are exactly the same as the resource classes that ship with Chef
[2012-10-10 14:31:56 -0400] yfeldblum: drrk, only with a very thin cutesy DSL on top which is what gives it the name "lightweight"
[2012-10-10 14:32:16 -0400] drrk: I know the result is, it's the DSL i'm tryign to understand
[2012-10-10 14:33:50 -0400] Yann2: Hey folks, when I deploy a file, does the old file gets removed, and a new one created with new content? or does the content just get replaced?
[2012-10-10 14:34:20 -0400] Yann2: cf "patdk-wk> yann2, yes, as long as you don't just deploy it, first REMOVE resolv.conf, then write a new one patdk-wk> if you just overwrite it, it will follow the symlink, and that will get killed via resolvconf"
[2012-10-10 14:37:59 -0400] yfeldblum: drrk, ah then yes, also works on any resources whether lightweight or not
[2012-10-10 14:38:30 -0400] yfeldblum: drrk, code: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/params_validate.rb#L201-212
[2012-10-10 14:38:48 -0400] drrk: ah right I see, can it change the prameter provided to it, or just return true/false?
[2012-10-10 14:39:42 -0400] drrk: ahh, the dsl impelmentation, thanks :)
[2012-10-10 14:39:46 -0400] yfeldblum: drrk, as the docs say, the procs you give it should return exactly `true` (not something truthy) if the value is valid
[2012-10-10 14:40:10 -0400] yfeldblum: drrk, but if you want a setter-type method that does custom behavior, then just define a method in the resource DSL file
[2012-10-10 14:40:23 -0400] yfeldblum: drrk, `def my_attr(arg = nil) ... end`
[2012-10-10 14:41:10 -0400] drrk: instead of :attribute my_attr ?
[2012-10-10 14:41:11 -0400] yfeldblum: drrk, i.e., instead of using the `attribute` DSL method to declare an attribute with the default attribute-methods implementation
[2012-10-10 14:41:19 -0400] drrk: cheers, thanks
[2012-10-10 14:49:03 -0400] masterkorp: Can i add a comment to a node ?
[2012-10-10 14:51:28 -0400] makerbreakr: masterkop, setup a databag, and a recipe for comments?
[2012-10-10 14:51:46 -0400] yfeldblum: masterkorp, sure - just stick it in any old untaken attribute
[2012-10-10 14:52:02 -0400] yfeldblum: makerbreakr, why a data-bag and a recipe just to stick a comment on a node?
[2012-10-10 14:52:34 -0400] makerbreakr: dunno
[2012-10-10 14:52:50 -0400] makerbreakr: i like to have things in one place
[2012-10-10 14:52:56 -0400] makerbreakr: probnably the wrong way to do it
[2012-10-10 14:53:09 -0400] yfeldblum: makerbreakr, i agree, only that sounds like three places :P
[2012-10-10 14:53:34 -0400] makerbreakr: heh, ya, I consisder the "databag" as one place, and the other stuff just supports it
[2012-10-10 14:59:14 -0400] masterkorp: i wanted a like a very important node, nvm i got it
[2012-10-10 15:06:15 -0400] kraM: node[:network][:interfaces].each do |iface| ... iface should be an array containing strings for the interfaces names which in turn should be usable like node[:network][:interfaces][iface][:addresses]... Right?
[2012-10-10 15:07:23 -0400] _rc: kraM: no, it'll be a tuple of key and hash
[2012-10-10 15:09:06 -0400] _rc: kraM: you want either node.network.interfaces.keys.each do |iface| or node.network.interfaces.each do |iface,props|
[2012-10-10 15:09:48 -0400] _rc: with square brackets and symbols if you prefer, just easier for me type with the dots
[2012-10-10 15:18:30 -0400] kristaps: Hi, I'm having trouble getting 10.14.4 to work on Ubuntu 12.04, installing from the opscode APT repo.
[2012-10-10 15:18:46 -0400] kristaps: It's so broken that I can't even specify what exactly is broken
[2012-10-10 15:19:12 -0400] kristaps: chef-server dies because it cannot connect to rabbitmq
[2012-10-10 15:20:11 -0400] kristaps: no validation.pem or webui.pem in /etc/chef
[2012-10-10 15:21:00 -0400] heathsnow: kristaps:  Perhaps the rabbitmq cookbook is old and doesn't work with Ubuntu 12.04....maybe there's an updated rabbitmq cookbook.
[2012-10-10 15:21:50 -0400] heathsnow: My best guess :P
[2012-10-10 15:21:51 -0400] kristaps: What would a cookbook have to do with installing the server?
[2012-10-10 15:22:14 -0400] heathsnow: Ah...sry, misunderstood
[2012-10-10 15:22:16 -0400] kristaps: also - server.rb and solr.rb are empty
[2012-10-10 15:22:24 -0400] kristaps: in /etc/chef
[2012-10-10 15:23:30 -0400] kristaps: installing 10.14.2 went without a hitch so I'm surprised by this complete quagmire
[2012-10-10 15:25:14 -0400] kraM: _rc: thx, got it with |iface,props| style but keys looks better.
[2012-10-10 15:25:28 -0400] luckymike: mroning
[2012-10-10 15:25:46 -0400] killfill: _rc, how would i do that with databags or role search?
[2012-10-10 15:27:00 -0400] _rc: killfill: http://wiki.opscode.com/display/chef/Search#Search-UsingSearchinRecipes
[2012-10-10 15:27:12 -0400] kristaps: Any way to install the 10.14.2 packages via APT?
[2012-10-10 15:37:45 -0400] kallistec: kristaps: pin or go to apt.opscode.com in a browser and download them manually
[2012-10-10 15:38:30 -0400] kristaps: kallistec: doesn't pinning require the packages to be already installed?
[2012-10-10 15:38:45 -0400] kallistec: kristaps: I don't know TBH
[2012-10-10 15:39:40 -0400] yatesy: kristaps: you should be able to install a specific version with apt-get install package=version
[2012-10-10 15:39:54 -0400] masterkorp: https://github.com/acrmp/foodcritic/issues/79
[2012-10-10 15:40:56 -0400] kristaps: yatesy: I tried that, but apparently the opscode repos only list the very latest version
[2012-10-10 15:42:10 -0400] yatesy: kristaps: ah ok, yeah that's quite likely if it's built with reprepro. You could take the risk and try to locate the .deb file yourself as kallistec pointed out
[2012-10-10 15:43:00 -0400] yatesy: I ended up doing that for a much older version as the newer one seemed to cause me memory leaks I couldn't work out
[2012-10-10 15:47:39 -0400] KarlHungus: is there any point of setting 'group "root"' on a resource?
[2012-10-10 15:48:04 -0400] KarlHungus: won't that be implied?
[2012-10-10 16:03:42 -0400] kallistec: kristaps: cc yatesy yes, it's built with reprepro, older versions are up there
[2012-10-10 16:04:49 -0400] aruntomar: KarlHungus: yes, by default the file permissions are owned by the user who ran chef-client, which is root.
[2012-10-10 16:05:08 -0400] kallistec: kristaps: http://apt.opscode.com/pool/main/c/chef/
[2012-10-10 16:06:50 -0400] kallistec: reprepro does nuke old versions at some point, which is why it only goes back to 0.10.8
[2012-10-10 16:13:46 -0400] aruntomar: i know how to create single aws instances via knife. but suppose i want to spawn 20 instances simultaneously and then shut them down after 3 hours, is there a functionality available for multiple instance creation or do i have to run my command in a loop inside some script.
[2012-10-10 17:09:48 -0400] jhayden: I have a question about environments in chef
[2012-10-10 17:09:50 -0400] cgriego: I'm unable to delete a role I just uploaded to Hosted Chef. Is there a service issue not reported on the status page or Twitter account?
[2012-10-10 17:10:38 -0400] jhayden: Am I correct that each environment.json file covers ALL cookbooks in that environment?
[2012-10-10 17:10:39 -0400] joevandyk: recommendations on the best way to create ec2 aim's with chef?
[2012-10-10 17:10:48 -0400] joevandyk: i looked into aim's a couple years ago, it was pretty confusing
[2012-10-10 17:10:57 -0400] joevandyk: s/aim/ami/ge
[2012-10-10 17:12:06 -0400] joevandyk: (i'd prefer instance storage, btw. i don't trust ebs)
[2012-10-10 17:17:24 -0400] karwash: @joevandyk, perhaps installing the ec2 tools on the target instance, then creating a "bundle_ami" role that you can use to automate ami bundling... just a thought.
[2012-10-10 17:17:34 -0400] geekbri: Creating EBS ami's is certainly a lot less of a pain than creating instance store ones.    Here are the amazon docs for instance store based amis: http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/creating-an-ami-s3-linux.html
[2012-10-10 17:18:06 -0400] joevandyk: geekbri: i figure ebs is a lot less work. just got burned by ebs too many times.
[2012-10-10 17:18:12 -0400] geekbri: Certainl you will need the ec2 tools so you can bundle the image and then register it.  Just make sure whatever recipe you write for it handles nuking confidential stuff from the AMI
[2012-10-10 17:20:32 -0400] geekbri: or at least I would do that, I suppose its not strictly necessary, especially if its private.
[2012-10-10 18:14:34 -0400] yfeldblum: jhayden, not quite sure what the question was
[2012-10-10 18:17:08 -0400] jhayden: Sorry, I'm trying to figure out how to organize my cookbook attributes by environment
[2012-10-10 18:17:49 -0400] jhayden: it seems to me that each environment  has one file for everything (all cookbooks)
[2012-10-10 18:18:21 -0400] jhayden: instead of environment with subduers for each cookbook
[2012-10-10 18:18:30 -0400] jhayden: subdirs
[2012-10-10 18:19:01 -0400] yfeldblum: jhayden, environments do *not* offer isolation or segregation
[2012-10-10 18:19:29 -0400] yfeldblum: jhayden, you have one set of cookbooks, and that set is available to all nodes in all environments
[2012-10-10 18:19:51 -0400] yfeldblum: jhayden, there are no cookbooks per-environment, no roles per-environment, no data-bags per-environment, etc
[2012-10-10 18:20:44 -0400] jhayden: yfeldblum, Thx, I think I understand now
[2012-10-10 18:20:50 -0400] paulmooring: jhayden: where cookbook versions are concerned all an environment is impose constraints on what cookbooks can be used from the global set of cookbooks
[2012-10-10 18:21:18 -0400] paulmooring: but my_cookbook can't have version 1.1.0 be different in different environments
[2012-10-10 18:21:47 -0400] paulmooring: all the env can do is say the test env use 1.1.1 and the prod env uses 1.1.0
[2012-10-10 18:23:20 -0400] yfeldblum: paulmooring, jhayden, many people use environments to separate between their dev, test, and prod infrastructures, but i tend to think environments aren't really appropriate for that and are actually more appropriate for separating between nodes in different datacenters/regions
[2012-10-10 18:23:32 -0400] yfeldblum: etc
[2012-10-10 18:24:18 -0400] paulmooring: yfeldblum: not trying to argue but I'm curious as to why you don't like environments for separating dev, test and prod?
[2012-10-10 18:24:33 -0400] chip-: yfeldblum: I respectfully disagree, I believe environments are useful for delineating both geography and intent, although the overlap can lead to confusion if a good design pattern isn't carefully followed.
[2012-10-10 18:24:47 -0400] jhayden: I'm working in 2 different was accounts (one R&D the other Prod)
[2012-10-10 18:25:16 -0400] jhayden: within in each I will have different envs like Stage and Production
[2012-10-10 18:25:20 -0400] yfeldblum: chip-, intent is fine; segregating between separate infrastructures is what i'm saying isn't a good match for chef environments ... it's a better match for multiple chef-servers, one per infrastructure
[2012-10-10 18:25:31 -0400] jhayden: so thats why I think this is the best way for me to go
[2012-10-10 18:25:58 -0400] jhayden: aws
[2012-10-10 18:26:06 -0400] yfeldblum: chip-, ie dev isn't an "intent", it's a segregated infrastructure, but that's not something you can achieve easily with chef environments, but it is something you can achieve easily with a separate chef-server or hosted-chef org
[2012-10-10 18:26:14 -0400] paulmooring: jhayden: that is a very common usage pattern and should work fine if it makes sense for your workflow
[2012-10-10 18:27:04 -0400] yfeldblum: paulmooring, all the silliness with cookbook versioning and the fact that (1) you have to be strict about every search query and (2) every data-bag or data-bag-item needs a chef-environment tag attribute
[2012-10-10 18:27:30 -0400] chip-: yfeldblum: I think we're really just discussing where on the OSI model such segregation is best achieved, and you're advocating layer 1. :)
[2012-10-10 18:27:49 -0400] yfeldblum: paulmooring, not saying cookbook versioning is silly; just saying doing cookbook versioning *this way* because of *this technical constraint* is silly
[2012-10-10 18:27:59 -0400] yfeldblum: chip-, of course not
[2012-10-10 18:28:11 -0400] yfeldblum: chip-, if environments were a little bit different i'd say have-at-'em
[2012-10-10 18:28:22 -0400] chip-: Also Spork belongs in this discussion.
[2012-10-10 18:28:45 -0400] yfeldblum: chip-, but given what they are, rather than what someone would like them to be, i don't think they're enough to achieve that type of segregation
[2012-10-10 18:28:46 -0400] paulmooring: yfeldblum: I get what you're saying, I was just curious as I'm more likely to use roles for geographic locations than environments
[2012-10-10 18:28:56 -0400] chip-: What modifications to environments do you think are necessary to make them more useful for segregating infrastructure?
[2012-10-10 18:29:37 -0400] yfeldblum: paulmooring, hehe another misuse i think - why does something being in us-east1 (env) all by itself change what it's job is (role)?
[2012-10-10 18:29:58 -0400] yfeldblum: chip-, if they were like hosted-chef orgs ^-^
[2012-10-10 18:30:12 -0400] chip-: Also I like tags, which I think don't get used very often.
[2012-10-10 18:30:45 -0400] paulmooring: yfeldblum: it doesn't but from a piratical standpoint I care about attributes and search for geo location, but not really cookbook version constraints
[2012-10-10 18:30:48 -0400] yfeldblum: chip-, if each role, node, client, data-bag, and cookbook was actually per-env
[2012-10-10 18:30:51 -0400] jonlives: yfeldblum: I have to disagree with you there too - we have one chef server, with prod and dev environments to seperate infrastructure. we actually consolidated to that from two seperate servers.
[2012-10-10 18:31:45 -0400] yfeldblum: paulmooring, yes, pirates definitely belong in this conversation :)
[2012-10-10 18:32:37 -0400] jonlives: in our case, we use environments purely for version constraints, and roles for all of the attribute logic etc.
[2012-10-10 18:32:40 -0400] paulmooring: yfeldblum: your point is definitely good "food for thought", it seems more pedantically correct than how I do things :)
[2012-10-10 18:32:47 -0400] yfeldblum: paulmooring, i'd suggest envs more for logical-level separation, such as based on dc, or possibly a dark-launch set of servers vs a main set of servers, etc
[2012-10-10 18:33:06 -0400] chip-: My question comes from watching a lot of my peers and former managers lately gravitate toward Ansible, due to simplicity, and that's got me thinking in a purely-abstract way about the ramp-up complexity of Chef.
[2012-10-10 18:33:14 -0400] yfeldblum: paulmooring, (that's different from test-vs-prod because dark-launch is prod as is main)
[2012-10-10 18:33:30 -0400] yfeldblum: chip-, i use tags
[2012-10-10 18:33:41 -0400] jonlives: paulmooring: the other thing to remember is that environments can equally be used both ways - depends what works best for you.
[2012-10-10 18:33:55 -0400] yfeldblum: jonlives, what made you switch from 2 chef-servers to 1?
[2012-10-10 18:34:25 -0400] jonlives: yfeldblum: the need to keep both servers in sync, mainly. it's much easier for us to change two environments.
[2012-10-10 18:34:42 -0400] jonlives: yfeldblum: we don't have disparity between prod and dev on the whole.
[2012-10-10 18:35:13 -0400] jonlives: the differences tend to be which ganglia server they appear in, which nagios server etc.
[2012-10-10 18:35:51 -0400] jonlives: and keeping two servers in sync when you have 40 odd people changing chef was a massive ballache.
[2012-10-10 18:36:00 -0400] yfeldblum: jonlives, well if the two infrastructures are so alike that they might as well be one infrastructure, i guess that makes sense
[2012-10-10 18:36:19 -0400] jonlives: yfeldblum: to be fair, we do have ie developer vms in dev which don't appear in prod.
[2012-10-10 18:36:42 -0400] jonlives: yfeldblum: but the caveat here is we don't use environments for anything other than version constraints. no attribs etc at that level.,
[2012-10-10 18:36:50 -0400] nXqd: hi guys, I don't understand much about LWRP, I want to specify rubies version installing with rbenv chef with Vagrant. How can I do this ?
[2012-10-10 18:37:11 -0400] nXqd: this is my current Vagrant file <https://github.com/rhacker/vagrant-rails/blob/master/Vagrantfile
[2012-10-10 18:39:02 -0400] yfeldblum: paulmooring, i'm actually coming at this from my (theoretical) PoV of "Infrastructure as Application", which is a much stricter version of "Infrastructure as Code"
[2012-10-10 18:40:13 -0400] paulmooring: yfeldblum: do you blog about this stuff at all?
[2012-10-10 18:40:27 -0400] yfeldblum: paulmooring, in my free time
[2012-10-10 18:40:32 -0400] yfeldblum: paulmooring, so ... not really :P
[2012-10-10 18:41:06 -0400] yfeldblum: paulmooring, i do my blogging in #chef
[2012-10-10 18:41:26 -0400] paulmooring: nice
[2012-10-10 18:41:47 -0400] jonlives: paulmooring: if interested, you can see a bit more about how we use chef here http://www.slideshare.net/mcdonnps/lessons-from-etsy-avoiding-kitchen-nightmares-chefconf-2012 and here http://www.slideshare.net/jonlives/michelin-starred-cooking-with-chef
[2012-10-10 18:42:14 -0400] nXqd: jonlives: nice, thanks for the link :D
[2012-10-10 18:42:19 -0400] paulmooring: jonlives: you
[2012-10-10 18:42:20 -0400] paulmooring: '
[2012-10-10 18:42:25 -0400] paulmooring: re with Etsy?
[2012-10-10 18:42:28 -0400] jonlives: yep
[2012-10-10 18:42:32 -0400] drgonzo65: is there an easy way to get chef-client to prepend the hostname during a run?  i'm parallelizing a few hundred runs and want to separate the output by host
[2012-10-10 18:42:43 -0400] yfeldblum: jonlives, what about giving each admin his own chef-server in a VM?
[2012-10-10 18:43:15 -0400] yfeldblum: jonlives, for doing cookbook work locally in a different VM
[2012-10-10 18:43:36 -0400] jonlives: yfeldblum: we have a testing environment which is unconstrained for when people are iterating on cookbooks :)
[2012-10-10 18:44:12 -0400] cwj: drgonzo65: i dont know how to do that, but have you considered using chef handlers to collect output instead of parsing stdout?
[2012-10-10 18:44:18 -0400] yfeldblum: jonlives, right but you said everyone gets their own VM running chef-client for dev stuff ... why not also their own chef-server-in-a-box for dev stuff too?
[2012-10-10 18:44:55 -0400] drgonzo65: cwj: i haven't done much with handlers.  is there a certain one that could help me with this?
[2012-10-10 18:45:17 -0400] yfeldblum: jonlives, that way everyone will really get to let loose and mess around and break everything just for kicks
[2012-10-10 18:45:36 -0400] jonlives: yfeldblum: not at all
[2012-10-10 18:45:46 -0400] jonlives: oh sorry misread
[2012-10-10 18:45:56 -0400] jonlives: yfeldblum: nothing stopping them from doing that if they want to tho
[2012-10-10 18:46:30 -0400] cwj: drgonzo65: depends on what your end goal is. i think one of the most basic handler examples out there is for writing json files locally on the node
[2012-10-10 18:47:01 -0400] jonlives: yfeldblum: but largely people iterate on the main chef server, just running the cookbook on their vm if needs be.
[2012-10-10 18:48:43 -0400] drgonzo65: cwj: mainly, i want to be able to send a chef-client run to a few hundred nodes, and have the ones that fail report back to me somehow.  if I grep the output data from knife for errors, I can't see which node had the error, as it's all intermingling with the rest of the output
[2012-10-10 18:50:24 -0400] cwj: drgonzo65: yeah the handler model lets you say "use this handler for reports and this one for errors"
[2012-10-10 18:50:41 -0400] drgonzo65: ok, i'll look into that.  thanks
[2012-10-10 18:50:43 -0400] cwj: so all your reports could get pushed to a log server and your errors can get pushed to airbrake/hipchat/irc/email/whatever
[2012-10-10 18:50:52 -0400] cwj: or use the same for both types
[2012-10-10 18:50:56 -0400] cwj: http://wiki.opscode.com/display/chef/Exception+and+Report+Handlers
[2012-10-10 19:15:42 -0400] iyp: So I've added ntp to the run-list of one of my clients. And I get this error at the run "No version specified, and no candidate version available for ntpdate"
[2012-10-10 19:15:53 -0400] iyp: Anyone have insight to offer on that?
[2012-10-10 19:28:59 -0400] mattupstate: trying to use the mysql cookbook with vagrant/chef-soloin my run list i specify build-essential first, but the mysql::ruby recipe ends up running before build-essential, any ideas?
[2012-10-10 19:30:42 -0400] mattupstate: http://pastebin.com/Hnp3pFdx
[2012-10-10 19:32:20 -0400] mattupstate: and the output http://pastebin.com/AesXPEAA
[2012-10-10 19:45:38 -0400] _0x783czar: Can I put both a not_if and only_if attribute in a resource?  If so, does it just and them together?
[2012-10-10 19:46:23 -0400] yfeldblum: _0x783czar, yes, and the provider will only run actions on the resource if all of the guards (only_if and not_if lines) pass
[2012-10-10 19:46:44 -0400] yfeldblum: _0x783czar, if any of the guards fails, then the provider will not run any actions on the resource
[2012-10-10 19:48:01 -0400] yfeldblum: _0x783czar, so if you have a `not_if { false } ; only_if { true }` then the provider will run the resource's actions, but if you've got `not_if { true } ; only_if { true }` then the provider will not run the resource's actions
[2012-10-10 19:57:34 -0400] _0x783czar: yfeldblum: thanks a bunch!  that helps
[2012-10-10 19:57:49 -0400] yfeldblum: _0x783czar, no probs
[2012-10-10 20:30:12 -0400] plethora: is there any way to find out which user knifed an environment or role last?
[2012-10-10 20:31:07 -0400] bluepojo: I don't believe so, which is why many people mange their environments and roles in a chef-repo that is autopushed to the chef server via a build job
[2012-10-10 20:31:12 -0400] bluepojo: so you have scm history
[2012-10-10 20:31:32 -0400] plethora: right, we're implementing that now
[2012-10-10 20:31:54 -0400] plethora: is there any existing tool that looks at a git commit and then runs the appropriate knife commands?
[2012-10-10 20:32:04 -0400] plethora: for the post commit hook
[2012-10-10 20:32:23 -0400] bluepojo: the way ours works is it just does an upload on the json files
[2012-10-10 20:32:27 -0400] bluepojo: in the build job
[2012-10-10 20:32:35 -0400] bluepojo: jenkins watches the repo for changes
[2012-10-10 20:32:40 -0400] bluepojo: and uploads everything every build
[2012-10-10 20:32:44 -0400] plethora: oh i see. that's a nifty way to do it
[2012-10-10 20:33:46 -0400] mhalligan: has anyone seen "Response: Cannot update sandbox 29d6775cbac941a99d6b63e9eef15325: checksum 07c3783b3a32815b1256be2e9d544088 was not uploaded" before with hosted chef?
[2012-10-10 20:40:32 -0400] rshade98: is there a way to return from a ruby block a value to use in the rest of a recipe
[2012-10-10 20:46:47 -0400] bluepojo: rshade98: you can do a node.set[:key] = value
[2012-10-10 20:47:12 -0400] bluepojo: and use node[:key] elsewhere
[2012-10-10 20:55:56 -0400] qhartman: I have an attribute that is set on a node from an old role that is not being exposed in when trying to edit the node. How can I delete it? It's interfering with the nodes new roles.
[2012-10-10 20:56:54 -0400] cwj: qhartman: try adding -a flag to your 'knife node edit' command
[2012-10-10 20:57:56 -0400] qhartman: cwj, ah soooo....
[2012-10-10 20:58:07 -0400] qhartman: did the trick! ty ty
[2012-10-10 20:58:10 -0400] cwj: np
[2012-10-10 20:58:45 -0400] qhartman: thatwill be a very handy thing to know about
[2012-10-10 21:03:20 -0400] fractaloop: Does anyone else get 500 responses from Opscode for a short period (<1 minute) after deleting a client/node?
[2012-10-10 21:15:55 -0400] qhartman: I'm self hosted so experience may not be relevant, but I'm not seeing anything like that in my instance, and I delete nodes/clients all the time.
[2012-10-10 21:23:36 -0400] uncommitted: Cannot find a resource for notifies on debian version 6.0.5
[2012-10-10 21:24:03 -0400] uncommitted: i thought "notifies" was able to be used in any recipe?
[2012-10-10 21:43:42 -0400] qhartman: here's another lifecycle one. I have edited a node to remove a role from it, but not chef-cliented it. Other nodes still show that node as having the removed role when I search for nodes with that role. How do I correct that?
[2012-10-10 21:46:30 -0400] tknerr: hi chefs
[2012-10-10 21:46:41 -0400] tknerr: those attributes are driving me crazy
[2012-10-10 21:47:07 -0400] tknerr: I have this in my attributes/default.rb
[2012-10-10 21:47:16 -0400] tknerr: default[:nexus][:use_https] = true
[2012-10-10 21:47:38 -0400] paulmooring: qhartman: knife exec -E "api.get('nodes/node_name').save"
[2012-10-10 21:47:53 -0400] tknerr: but I can not override it it seems
[2012-10-10 21:47:59 -0400] paulmooring: That would force the node `node_name` to save without requiring a Chef run
[2012-10-10 21:48:12 -0400] tknerr: in my role.rb I have this:
[2012-10-10 21:48:26 -0400] tknerr: override_attributes({   :java => {     :install_flavor => "openjdk"   },   :nexus => { :use_https => false } })
[2012-10-10 21:48:51 -0400] tknerr: Is there something worng with the way I set it in the role.rb?
[2012-10-10 21:49:14 -0400] qhartman: paulmooring, awesome, thanks for the pointer
[2012-10-10 21:49:36 -0400] paulmooring: tknerr: how/where are you expecting this to be overridden?
[2012-10-10 21:49:38 -0400] qhartman: I don't think you need the perens tknerr
[2012-10-10 21:50:00 -0400] tknerr: I have also tried setting it in the environment,but that didn't work as well
[2012-10-10 21:50:41 -0400] paulmooring: parenthesis are optional in ruby, but won't cause problems if they're there
[2012-10-10 21:51:04 -0400] tknerr: for example, I have added this in attributes/default.rb
[2012-10-10 21:51:17 -0400] tknerr: default[:nexus][:use_https]  = true
[2012-10-10 21:51:24 -0400] qhartman: Ah right, I was thinking that was in json since that's how I define my roles
[2012-10-10 21:51:24 -0400] tknerr: Chef::Log.info "node[:nexus][:use_https] is #{node[:nexus][:use_https]}"
[2012-10-10 21:52:05 -0400] tknerr: right below this line. It says it's always true no matter how hard I try to override it in the role / environment with false
[2012-10-10 21:52:40 -0400] qhartman: has it been explicitly set on the node?
[2012-10-10 21:52:42 -0400] paulmooring: tknerr: where is line?
[2012-10-10 21:52:42 -0400] tknerr: (the log was just for debugging, I'm using node[:nexus][:use_https] later on in the recipe)
[2012-10-10 21:52:58 -0400] paulmooring: ah so that's in the recipe?
[2012-10-10 21:53:02 -0400] tknerr: paulmooring: in attributes/default.rb
[2012-10-10 21:53:45 -0400] tknerr: I'm using #{node[:nexus][:use_https]} later in the recipe as well . but its always true
[2012-10-10 21:54:57 -0400] paulmooring: tknerr: try override_attributes( :java.
[2012-10-10 21:55:10 -0400] paulmooring: rather than override_attributes({ :java...
[2012-10-10 21:55:18 -0400] tknerr: `knife role show nexus` confirms me that the override has taken place:
[2012-10-10 21:55:33 -0400] paulmooring: ah nevermind then
[2012-10-10 21:55:35 -0400] tknerr: or rather that it's set to false
[2012-10-10 21:55:53 -0400] paulmooring: and it's treated as true in the recipe, not just the attributes file?
[2012-10-10 21:56:23 -0400] tknerr: paulmooring: yes, in both cases its true
[2012-10-10 21:57:02 -0400] tknerr: `knife node show my-node` confirms that the `role[nexus]` is in the nodes run list
[2012-10-10 21:57:23 -0400] tknerr: now I ssh'ed to the node and run `sudo chef-client`
[2012-10-10 21:57:46 -0400] tknerr: and it tells me
[2012-10-10 21:57:50 -0400] tknerr:  [2012-10-10T23:57:19+02:00] INFO: node[:nexus][:use_https] is true
[2012-10-10 21:58:20 -0400] tknerr: don't get it,must be a subtle thing
[2012-10-10 22:00:24 -0400] tknerr: paulmooring: ah, there's one other thing
[2012-10-10 22:00:54 -0400] tknerr: it was set to true previously
[2012-10-10 22:01:05 -0400] tknerr: since then the node did not converge anymore
[2012-10-10 22:01:36 -0400] tknerr: might it be possible that it takes the stale value from the previous successful run / save?
[2012-10-10 22:02:02 -0400] paulmooring: yeah the node will save at the end of a successful run
[2012-10-10 22:02:23 -0400] paulmooring: so if your runs are no longer finishing you're probably not updating the node on the server
[2012-10-10 22:04:58 -0400] jcwdev: hey all, in playing with the deploy resource, i am having a bit of trouble. i am calling deploy_revision, giving it a full path to the branch, and revision: HEAD. The cookbook will complete successfully after multiple runs, but not after only one.
[2012-10-10 22:06:02 -0400] jcwdev: the first time, it throws a fit about the deploy directory not being there, but when i create it with the directory resource directly beforehand, it does't keep the resource from throwing an error, but only the first time. each time after that, the deploy works.
[2012-10-10 22:06:26 -0400] jcwdev: so, i am just curious if anyone idling has experience configuring the deploy resource.
[2012-10-10 22:06:37 -0400] tknerr: paulmooring: ok, I told you something wrong. Actually, later in the recipe it is false as expected.
[2012-10-10 22:07:02 -0400] JasonF: "There you go dumbest_thang_ever. If you had told me you were trying to install from backup in the first place this would have been much quicker."
[2012-10-10 22:07:05 -0400] JasonF: "Thanks for your help. Can you give me the password you used to start the installer in case we need to follow this procedure again?"
[2012-10-10 22:07:13 -0400] JasonF: sorry, accidentally middle clicked
[2012-10-10 22:07:14 -0400] tknerr: paulmooring: it was a conditional in attributes/default.rb which is confusing me:
[2012-10-10 22:08:02 -0400] tknerr: default[:nexus][:use_https]                                    = true
[2012-10-10 22:08:08 -0400] tknerr: default[:nexus][:nginx_proxy][:listen_port]                    = node[:nexus][:use_https] ? 8443 : 8080
[2012-10-10 22:09:33 -0400] tknerr: how would I make this work? at this point in time (within the attributes file) the overrides seem to not have taken place yet
[2012-10-10 22:10:40 -0400] paulmooring: tknerr: Any reason not to use a normal attribute in the role?
[2012-10-10 22:11:38 -0400] tknerr: paulmooring: haven't tried that. but override should be even stronger, shouldn't it?
[2012-10-10 22:11:55 -0400] paulmooring: well, stronger is a relative term :)
[2012-10-10 22:12:00 -0400] paulmooring: higher precedence yes
[2012-10-10 22:16:27 -0400] tknerr: paulmooring: now I tried setting it to false in the environment only, but not in the role. still the same behaviour.
[2012-10-10 22:17:04 -0400] paulmooring: tknerr: you have it set in the environment and the role?
[2012-10-10 22:17:28 -0400] tknerr: had it like so before, now only in the environment
[2012-10-10 22:17:48 -0400] paulmooring: as an override rather than default right?
[2012-10-10 22:18:45 -0400] tknerr: now as default
[2012-10-10 22:19:32 -0400] tknerr: but since default in the attributes file is the lowest precedence of all it should not matter
[2012-10-10 22:19:37 -0400] paulmooring: so default attributes an an attributes file are the lowest precedence of all
[2012-10-10 22:20:14 -0400] paulmooring: it's not clear to if this is actually getting set by the environment or role though
[2012-10-10 22:20:37 -0400] tknerr: according to this its lowest, yes: http://wiki.opscode.com/display/chef/Attributes
[2012-10-10 22:21:55 -0400] tknerr: and: it is in fact getting set (later on in the recipe it's false), but at the time where the attributes/default.rb is evaluated it is not
[2012-10-10 22:22:00 -0400] tknerr: seems to happen later
[2012-10-10 22:22:30 -0400] paulmooring: yeah try removing those extra {} in your env
[2012-10-10 22:23:41 -0400] tknerr: will try
[2012-10-10 22:23:57 -0400] tknerr: there's the full attributes file fyi: https://gist.github.com/3868880#L42-43
[2012-10-10 22:24:28 -0400] tknerr: lines 42-43 are the ones that are confusing me
[2012-10-10 22:26:31 -0400] paulmooring: and you said that it's true in the attributes file, but false in the recipe?
[2012-10-10 22:26:39 -0400] tknerr: paulmooring: does not help, still the same
[2012-10-10 22:26:51 -0400] tknerr: paulmooring: yes
[2012-10-10 22:27:10 -0400] tknerr: that's totally counterintuitive behaviour imho
[2012-10-10 22:38:17 -0400] paulmooring: tknerr: I don't think there's any way to use override/default attributes from a role/env in an attributes file in your cookbook
[2012-10-10 22:39:25 -0400] paulmooring: The common approach would be to set the default value in the cookbook and put any logic in libraries or recipes
[2012-10-10 22:39:42 -0400] paulmooring: so in your case:
[2012-10-10 22:39:49 -0400] paulmooring: default[:nexus][:nginx_proxy][:listen_port] = 8080
[2012-10-10 22:40:05 -0400] paulmooring: in the attributes, then add an if statement into the recipe
[2012-10-10 22:41:07 -0400] tknerr: paulmooring: yes, that would work I guess
[2012-10-10 22:41:16 -0400] paulmooring: port = node[:nexus][:use_https] ? 8443 : node[:nexus][:nginx_proxy][:listen_port]
[2012-10-10 22:42:34 -0400] tknerr: paulmooring: any idea why this should not work in an attributes file, or pointers where i could read more about it. doing this in the recipe feels somehow wrong to me... :-(
[2012-10-10 22:43:14 -0400] paulmooring: tknerr: due to the order things are parsed in attributes from roles/environments aren't exposed to an attributes file
[2012-10-10 22:43:28 -0400] paulmooring: http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2012-10-10 22:44:33 -0400] paulmooring: That explains things a little if you're interested, but in general just avoid putting logic in attributes files set defaults in there and any conditional other than maybe platform switch/cases should go in recipes/libraries
[2012-10-10 22:44:55 -0400] tknerr: paulmooring: thanks for your help!
[2012-10-10 22:45:17 -0400] paulmooring: if your recipe is getting long/messy libraries and lwrps are great for abstracting away logic
[2012-10-10 22:45:22 -0400] tknerr: think I need to sleep over it. maybe it becomes clear tomorrow :-)
[2012-10-10 22:47:03 -0400] paulmooring: tknerr: feel free to ping me if you need help, I'm in here most of the time during the day
[2012-10-10 22:48:46 -0400] tknerr: paulmooring: yeah thanks! it's too late already here in germany :-) need some sleep...
[2012-10-10 22:49:08 -0400] tknerr: thanks! bye chefs! :-)
[2012-10-10 22:59:55 -0400] maulik: having trouble installing 10.14.4 client on Lucid (Ubuntu 10.04 - yes still on that) - the dependencies are preventing the install - any one run into this?
[2012-10-10 23:00:50 -0400] flaccid__: nope, you may like to cite the errors
[2012-10-10 23:01:58 -0400] maulik: Reading package lists... Done
[2012-10-10 23:01:59 -0400] maulik: Building dependency tree
[2012-10-10 23:01:59 -0400] maulik: Reading state information... Done
[2012-10-10 23:01:59 -0400] maulik: Some packages could not be installed. This may mean that you have
[2012-10-10 23:01:59 -0400] maulik: requested an impossible situation or if you are using the unstable
[2012-10-10 23:01:59 -0400] maulik: distribution that some required packages have not yet been created
[2012-10-10 23:02:00 -0400] maulik: or been moved out of Incoming.
[2012-10-10 23:02:00 -0400] maulik: The following information may help to resolve the situation:
[2012-10-10 23:02:01 -0400] maulik: The following packages have unmet dependencies:
[2012-10-10 23:02:01 -0400] maulik:   chef: Depends: libjson-ruby (>= 1.4.4)
[2012-10-10 23:02:01 -0400] maulik: E: Broken packages
[2012-10-10 23:02:10 -0400] maulik: while doing apt-get -f install chef=10.14.4-1
[2012-10-10 23:02:13 -0400] bluepojo: oh boy
[2012-10-10 23:02:21 -0400] bluepojo: use gist.github.com or something :)
[2012-10-10 23:02:35 -0400] flaccid__: prolly a bad repo conf; but yeah don't flood y0, use a pastebin
[2012-10-10 23:03:15 -0400] maulik: https://gist.github.com/3869107 sorry my bad
[2012-10-10 23:03:25 -0400] maulik: using the opscode lucid repo
[2012-10-10 23:04:52 -0400] maulik: the issue is https://gist.github.com/3869107 - dependency on libc6 to be > 2.15
[2012-10-10 23:05:30 -0400] maulik: but 2.11.1-0ubuntu7.11 is latest on lucid
[2012-10-10 23:06:21 -0400] flaccid__: i don't have time to help with a repo conf but #ubuntu might though you can install by gem if you install the pkg that provides mkmf
[2012-10-10 23:09:30 -0400] maulik: repo conf issue on opscode?
[2012-10-10 23:09:40 -0400] maulik: http://packages.ubuntu.com/lucid/libc6 shows we are at the latest on lucid
[2012-10-10 23:10:16 -0400] flaccid__: its not necessarily just the repo conf but also that you may have packages installed arbitrarily from other sources that are causing conflicts. unfortunately me too busy at work to help
[2012-10-10 23:11:50 -0400] maulik: umm not sure how tht wud be the case, brand new box with lucid on there - nothing else updated other than chef repo added to sources.list per the opscode wiki - nvm if u r busy but surprised am the only one seeing this
[2012-10-10 23:12:48 -0400] flaccid__: you have to dig into it in a different way, not enough info to make a conclusion..
[2012-10-10 23:41:35 -0400] thedeeno: I have a role which is setting some attributes. I'd like one of these attributes to include the current chef environments in it's value. In other words something like: "part-#{node.chef_environment}-part"
[2012-10-10 23:41:46 -0400] thedeeno: but, node isn't actually a local variable
[2012-10-10 23:41:49 -0400] thedeeno: how would you do this
