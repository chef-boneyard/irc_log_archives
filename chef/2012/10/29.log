[2012-10-29 01:12:03 -0400] killfill: how do i execute a command ont he 'origin' PC? i.e. my notebook, where im shooting the deplyments
[2012-10-29 01:13:21 -0400] yfeldblum: killfill, from bash, probably
[2012-10-29 01:14:28 -0400] killfill: yfeldblum: i.e. i need to take a valud of something in the attribute file of my cookbook, pass it to a local binary, and then run the deploy on the remote server with its output
[2012-10-29 01:15:01 -0400] yfeldblum: killfill, sounds like coming up with a new strategy might be in order
[2012-10-29 01:15:16 -0400] yfeldblum: killfill, chef has no concept whatsoever of a "controlling" machine
[2012-10-29 01:15:37 -0400] yfeldblum: killfill, since chef is designed to be run as a cron job or daemonized, in addition to on-demand
[2012-10-29 01:15:46 -0400] killfill: ah
[2012-10-29 01:15:48 -0400] killfill: ok
[2012-10-29 01:15:51 -0400] killfill: i understand
[2012-10-29 01:57:49 -0400] erikh: s/w 16
[2012-10-29 03:44:06 -0400] letomuaddib: anyone has any idea why a script in chef solo under vagrant would run under the "vagrant" user, although the recipe specifies another user?
[2012-10-29 05:50:22 -0400] sameersegal: Is there a way to see the actual command chef runs as it runs line by line of a recipe?
[2012-10-29 05:50:35 -0400] sameersegal: *linux command
[2012-10-29 05:56:11 -0400] ssd7: sameersegal: -ldebug gives you nearly everthing Chef is doing
[2012-10-29 05:56:35 -0400] ssd7: sameersegal: That is the command line flag `-l` with the value `debug`, for debug level logging
[2012-10-29 05:56:50 -0400] sameersegal: ssd7: sudo chef-client -ldebug ?
[2012-10-29 05:57:23 -0400] sameersegal: ssd7: thanks - got it
[2012-10-29 06:03:53 -0400] ssd7: sameersegal: cool, that is the highest level of output you can get from Chef itself, but I usually find it sufficient to solve most problems.
[2012-10-29 06:40:26 -0400] zined: sdfsdfsdfsdfsdfsdf
[2012-10-29 06:40:33 -0400] zined: grml, sorry
[2012-10-29 08:12:12 -0400] intinig: s
[2012-10-29 12:22:57 -0400] BryanWB_: ohai chefs!
[2012-10-29 12:32:48 -0400] roidrage: mornin'
[2012-10-29 12:33:34 -0400] BryanWB_: roidrage: good afternoon!
[2012-10-29 12:34:03 -0400] BryanWB_: erm, can any emacs users tell me how tor replace symbols w/ strings in to comply w/ FC01?
[2012-10-29 12:40:26 -0400] BryanWB_: ok, figured it out
[2012-10-29 12:41:38 -0400] roidrage: sorry, man, no emacs user myself :)
[2012-10-29 12:56:03 -0400] fromonesrc: BryanWB_: that rule should be ignored on principle
[2012-10-29 12:56:19 -0400] fromonesrc: ;)
[2012-10-29 12:56:22 -0400] BryanWB_: fromonesrc: i agree that it is a contentious topic :)
[2012-10-29 13:06:05 -0400] atomic-penguin: BryanWB_, I think that rule is probably going away
[2012-10-29 13:06:13 -0400] BryanWB_: atomic-penguin: orly?
[2012-10-29 13:06:17 -0400] BryanWB_: atomic-penguin: btw, hey buddy!
[2012-10-29 13:06:30 -0400] atomic-penguin: Just from the hubbub about it at chef summit
[2012-10-29 13:06:37 -0400] BryanWB_: interesting
[2012-10-29 13:07:14 -0400] atomic-penguin: I could be wrong, it could totally go the other way, like use symbols over strings
[2012-10-29 13:07:24 -0400] atomic-penguin: Not that it is something that even matters
[2012-10-29 13:08:22 -0400] atomic-penguin: BryanWB_, missed you at chef summit
[2012-10-29 13:08:39 -0400] BryanWB_: atomic-penguin: and i missed u guys, hope i can make it to the next chefconf
[2012-10-29 13:08:55 -0400] specialsauce: would be nice if fc had more tests that stopped things breaking and less that were picky about less important stuff. i did fork fc and try writing some extra rules but I suck at AST it seems
[2012-10-29 13:08:58 -0400] BryanWB_: from ffs, sounded like it was a lot of fun
[2012-10-29 13:09:50 -0400] atomic-penguin: specialsauce, the nice thing about FC is you can disable rules you disagree with.
[2012-10-29 13:15:40 -0400] jtimberman: BryanWB_: ruby-tools-mode gives a couple macros for switching easily
[2012-10-29 13:15:59 -0400] BryanWB_: jtimberman: cool, nice discovery, i still haven't tried out zossima
[2012-10-29 13:16:15 -0400] jtimberman: but yeah, after loads of discussion, i think that fc001 is annoying enough to many users that it should be removed.
[2012-10-29 13:16:24 -0400] BryanWB_: yay!
[2012-10-29 13:16:36 -0400] jtimberman: opscode will still use strings in our own cookbooks because it is consistent with our training. :-)
[2012-10-29 13:18:21 -0400] yfeldblum: or just rename fc001 to rb001?
[2012-10-29 13:19:26 -0400] jtimberman: rb?
[2012-10-29 13:20:23 -0400] specialsauce: ac001
[2012-10-29 13:20:45 -0400] yfeldblum: short for ruby
[2012-10-29 13:30:07 -0400] jtimberman: yfeldblum: i was going to keep it as a rule that we use so i can catch all the places where symbols are still used.
[2012-10-29 13:30:59 -0400] yfeldblum: jtimberman, and so you can go all silence-of-the-lambs on any opscode crew that uses symbols?
[2012-10-29 13:33:01 -0400] kryptek: Good morning, #chef
[2012-10-29 13:33:24 -0400] masterkorp: HALO ITS MONDAYYSZZ
[2012-10-29 13:33:30 -0400] kryptek: Monday.. ugh
[2012-10-29 13:34:05 -0400] jtimberman: yfeldblum: naturally
[2012-10-29 13:34:09 -0400] jtimberman: bbiab
[2012-10-29 13:35:07 -0400] peiniau: Hie
[2012-10-29 13:35:59 -0400] peiniau: I have a question about library in chef
[2012-10-29 13:36:18 -0400] kryptek: peiniau, shoot
[2012-10-29 13:37:36 -0400] peiniau: In the example on the site, we have : require 'sequel' ---> How do you install gem before chef loads library scripts ?
[2012-10-29 13:37:55 -0400] kryptek: peiniau, in your recipe file
[2012-10-29 13:38:26 -0400] kryptek: peiniau,  Place the require in your library, in a begin..rescue block, and in your recipe you should have a chef_gem block that installs the gem, then right under that block require the gem there too
[2012-10-29 13:38:56 -0400] peiniau: I was thinking that the library folder was load before the recipe
[2012-10-29 13:39:03 -0400] peiniau: loaded
[2012-10-29 13:39:39 -0400] kryptek: peiniau,  Since the library is compiled before the recipe, if you don't have the gem installed on the system it'll crash out
[2012-10-29 13:40:01 -0400] kryptek: If you wrap the require in the library with a begin..rescue block, it'll take care of that issue
[2012-10-29 13:40:17 -0400] peiniau: ok nice
[2012-10-29 13:40:56 -0400] peiniau: It's look like a hack to me
[2012-10-29 13:42:05 -0400] kryptek: I know it looks odd, but if you look at opscode cookbooks, it's the same way
[2012-10-29 13:42:19 -0400] peiniau: Since library scripts are pure ruby, it would be nice to declare the dependencies in a kind of Gemfile
[2012-10-29 13:42:56 -0400] peiniau: Anyway, thanks I will apply this solution
[2012-10-29 13:43:04 -0400] kryptek: yw
[2012-10-29 13:44:26 -0400] fromonesrc: jtimberman: thank you! FC001 never made much sense to me
[2012-10-29 13:47:08 -0400] ranjibd: ohai..
[2012-10-29 13:48:41 -0400] masterkorp: jtimberman: Sorry to redirect this to you. I have a question about the future of test-kitchen. Would be in the future a chef server approach ?
[2012-10-29 13:49:12 -0400] yfeldblum: fromonesrc, y not?
[2012-10-29 13:49:14 -0400] masterkorp: I am making a cookbook for icinga, and i want to unit test the hosts config file generation
[2012-10-29 13:50:56 -0400] fromonesrc: because I always use symbols when I can
[2012-10-29 13:51:02 -0400] fromonesrc: cleaner code in my opinion
[2012-10-29 13:51:04 -0400] ranjibd: masterkorp, you can mock the server calls and use chefspec/minitest  to unit test the generated files
[2012-10-29 13:51:33 -0400] kryptek: I personally like symbols too
[2012-10-29 13:51:36 -0400] fromonesrc: you have to use strings in certain cases  "x-y-z" can't be x-y-x: but those are rare cases for me
[2012-10-29 13:51:51 -0400] yfeldblum: fromonesrc, why do you think symbols are cleaner?
[2012-10-29 13:52:21 -0400] geekbri: :"some crazy symbol"
[2012-10-29 13:52:36 -0400] ranjibd: colon != clean. may be short and terse
[2012-10-29 13:52:37 -0400] fromonesrc: mostly just personal aesthetics, the symbol is a representation of some /thing/, it don't want to quote it if I don't have to
[2012-10-29 13:52:48 -0400] fromonesrc: your colon may not be clean, but...
[2012-10-29 13:52:57 -0400] ranjibd: lol
[2012-10-29 13:53:55 -0400] kryptek: I think I like the way {key: 'value'} looks better than {'key' => 'value'}
[2012-10-29 13:54:22 -0400] masterkorp: ranjibd: hmm, i am all ears..
[2012-10-29 13:54:37 -0400] ranjibd: kryptek, symbol: wont work with < 1.9
[2012-10-29 13:55:16 -0400] kryptek: yeah, I hear that
[2012-10-29 13:55:24 -0400] kryptek: But serves people right for using 1.81
[2012-10-29 13:55:26 -0400] kryptek: 1.8!
[2012-10-29 13:55:53 -0400] fromonesrc: if you're using old versions, you need to know the syntax
[2012-10-29 13:56:17 -0400] fromonesrc: symbols are the way of the future. the way of the future.
[2012-10-29 13:57:48 -0400] masterkorp: ranjibd: can you elaborate on that or point me to doc? I am new to unit testing in ruby btw
[2012-10-29 13:59:30 -0400] ranjibd: masterkorp, https://github.com/acrmp/chefspec , check the assertion section it has example on file with content
[2012-10-29 14:00:07 -0400] masterkorp: yeah, but i need to "fake" the search for nodes ?
[2012-10-29 14:00:24 -0400] ranjibd: masterkorp, yeah it has an example for the same .. how to stub search
[2012-10-29 14:00:58 -0400] ranjibd: if you want to assert on the search arguments , use should_receive instead of stub method
[2012-10-29 14:01:13 -0400] masterkorp: yeah, i know how to do that, i was hoping for actuall results from the search, but thanks
[2012-10-29 14:01:24 -0400] masterkorp: i am using the minitest
[2012-10-29 14:02:52 -0400] ranjibd: let me check if the file content matcher is available for minitest or not
[2012-10-29 14:03:07 -0400] yfeldblum: fromonesrc, unfortunately you're not dealing with /thing/s; you're dealing with data organized into atomic values, sequences, and string-keyed-maps
[2012-10-29 14:04:08 -0400] fromonesrc: yfeldblum: in my experience I rarely have to use a string-key
[2012-10-29 14:04:29 -0400] fromonesrc: it's a bikeshed debate, it's personal preference, it's not a rule that should be enforced by FC
[2012-10-29 14:04:41 -0400] yfeldblum: fromonesrc, not talking about how you write the code; i'm talking about what it is that you are actually dealing with: json-compatible data
[2012-10-29 14:05:16 -0400] yfeldblum: fromonesrc, with no real fixed schema
[2012-10-29 14:07:07 -0400] fromonesrc: if that's the concern, why not just use underscored_key_names?
[2012-10-29 14:08:54 -0400] yfeldblum: fromonesrc, not sure i followed that
[2012-10-29 14:10:35 -0400] fromonesrc: sorry, maybe I'm misunderstanding you. but if the concern about using "string-keys" is for json combatibility why not use underscore_keys? eliminates the need for quoted strings, right?
[2012-10-29 14:10:59 -0400] fromonesrc: and is the way I see most rubyists write their code
[2012-10-29 14:13:44 -0400] yfeldblum: fromonesrc, no, the concern is that when you use strings, it is crystal-clear to a rubyist that you're dealing with data coming from the outside; when you use symbols, rubyists might think you're talking about a method name or a recognized kwarg to a method
[2012-10-29 14:14:59 -0400] fromonesrc: yfeldblum: you have a point and I suppose that is possible but I have never had that confusion and I have only been working with ruby for a little over a year
[2012-10-29 14:17:09 -0400] yfeldblum: fromonesrc, mostly in chef? or as a general rubyist?
[2012-10-29 14:18:52 -0400] fromonesrc: both
[2012-10-29 14:18:54 -0400] yfeldblum: fromonesrc, plus it's all stored internally as string keys, so every time you ask for `node["some_attribute"].keys` or iterate the elements with `node["some_attribute"].each do |key, value|` you get string keys
[2012-10-29 14:19:30 -0400] kryptek: yfeldblum,  That's a really good point there.
[2012-10-29 14:21:34 -0400] letomuaddib: I have a problem with chef solo under vagrant, it seems to run scripts as user "vagrant" even if the recipe specifies a different user
[2012-10-29 14:21:43 -0400] letomuaddib: anyone has seen this and has an idea/suggestion?
[2012-10-29 14:22:08 -0400] fromonesrc: yfeldblum: you're saying that's how chef stores them internally?
[2012-10-29 14:22:36 -0400] yfeldblum: fromonesrc, yep
[2012-10-29 14:22:40 -0400] fromonesrc: you make a good point. I think that was an unfortunate design decision.
[2012-10-29 14:22:50 -0400] yfeldblum: fromonesrc, i mean that was one point among multiple
[2012-10-29 14:22:58 -0400] fromonesrc: :D
[2012-10-29 14:23:34 -0400] yfeldblum: fromonesrc, it would be a bad design decision for chef to store them internally as symbols because that's a recipe for very odd breakages for newbies to encounter
[2012-10-29 14:24:07 -0400] masterkorp: /usr/bin/chef-solo:23:in `load'
[2012-10-29 14:24:10 -0400] masterkorp: /usr/bin/chef-solo:23:in `<main>'
[2012-10-29 14:24:12 -0400] masterkorp: [2012-10-29T14:23:42+00:00] FATAL: Chef::Exceptions::PrivateKeyMissing: I cannot read /etc/chef/client.pem, which you told me to use to sign requests!
[2012-10-29 14:24:14 -0400] jtimberman: masterkorp: http://tickets.opscode.com/browse/KITCHEN-31
[2012-10-29 14:24:37 -0400] PDani: hi
[2012-10-29 14:24:59 -0400] letomuaddib: the previous problem with vagrant+solo chef + vagrant user I've seen with the postgres recipe
[2012-10-29 14:25:03 -0400] masterkorp: jtimberman: that would be awsesome
[2012-10-29 14:25:36 -0400] jtimberman: re node attributes, symbols are converted to strings under the hood anyway, so it doesn't matter other than which color you paint the bikeshed.
[2012-10-29 14:26:31 -0400] masterkorp: jtimberman: I am thinking on hacking some routes between the vm's just to have some testing
[2012-10-29 14:27:39 -0400] jtimberman: masterkorp: however, it is not a goal of test kitchen to provide a full stack environment, it is to give you an isolated way to run a single cookbook / project through convergence so when you get to your dev environment where the full stack is tested, you know the individual pieces work.
[2012-10-29 14:28:10 -0400] PDani: I'd like to take some action (particularily call an URL) _after_ 'converge' and 'save node'. this is important, because behind the URL there's a webservice, which accesses and changes the node's attributes. so if it happens _before_ the 'save node' step, it will overwrite the changes of the webservice. how can i instruct chef in a recipe to run some custom ruby code _after_ the 'save node' step?
[2012-10-29 14:30:00 -0400] yfeldblum: jtimberman, so it's got the scope of unit-testing and the performance of integration-testing?
[2012-10-29 14:36:55 -0400] PDani: or can i disable somehow the automatic node save step?
[2012-10-29 14:39:43 -0400] Zenigor: Has anyone had any luck installing postgres 9.X on redhat 6.1? I have tried two different cookbooks as well as simply adding in the new PG rpm and letting the postgresql cookbook install it via rpm. When I add the new RPM to yum and have the cookbook attempt to install, it still installs PG 8.4.13
[2012-10-29 14:41:16 -0400] fish_: this really drives me crazy. looks like chef-expander depends on eventmachine ~> 0.12.10
[2012-10-29 14:41:55 -0400] fish_: but some dependency of chef/chef-expander/chef-solr/chef-server-api is pulling in eventmachine 1.0.0
[2012-10-29 14:48:14 -0400] kryptek: Is it possible to set the executable flag on a template file within the resource?
[2012-10-29 14:49:21 -0400] cheeseplus: kryptek: you should be able to set "mode"
[2012-10-29 14:49:28 -0400] cheeseplus: so 755 or what have you
[2012-10-29 14:49:35 -0400] kryptek: I need to chmod +x the file though
[2012-10-29 14:50:02 -0400] turtlebender: setting the mode to 755 accomplishes the same thing
[2012-10-29 14:50:38 -0400] kryptek: ahh, thanks
[2012-10-29 14:51:15 -0400] brett_h: I'm running knife bootstrap but it's putting a different validation.pem on the server than the one in my-chef-server:/etc/chef/validation.pem, and I get 401s. Any ideas how to sync them up or why that'd happen?
[2012-10-29 14:59:01 -0400] ranjibd: PDani, you have to hack
[2012-10-29 14:59:26 -0400] ranjibd: PDani, monkey patch it with your logic if you want.. but it will be dirty
[2012-10-29 15:00:43 -0400] yfeldblum: PDani, why do you want to do that?
[2012-10-29 15:08:17 -0400] PDani: yfeldblum, the recipe calls a webservice, which externally reads and modifies the attributes of the given node (through chef api), and then returns with success or an error code. chef checks this return code. the problem is that after the run of the recipe, chef overwrites the modifications of the webservice because of the automatic node save step
[2012-10-29 15:08:39 -0400] PDani: that'
[2012-10-29 15:09:06 -0400] PDani: that's why i'd like to turn off automatic node save, or run the webservice call _after_ the automatic node save step
[2012-10-29 15:09:52 -0400] yfeldblum: PDani, why is this service modifying the node? is there some way to rearrange things so that only chef modifies the node, or only sysadmins modify the node out-of-band and not during chef runs?
[2012-10-29 15:11:28 -0400] JustinCampbell: request for comments if you've used Berkshelf: https://github.com/RiotGames/berkshelf/issues/181
[2012-10-29 15:12:19 -0400] yfeldblum: PDani, the node data should typically be treated as though chef-client takes a read-lock on it when starting a chef run, upgrades to a write-lock at the end of then run, performs a write, and releases the lock after the run is completed
[2012-10-29 15:12:54 -0400] PDani: yfeldblum, this service does some other service calls (particularily, registers some items and triggers into zabbix through zabbix webservice api), and it tries to save the generated ids into the node attributes (itemid, triggerid, etc). this service must be reachable manually too, that's why I decoupled it from chef
[2012-10-29 15:13:34 -0400] yfeldblum: PDani, perhaps it could write to a data-bag item instead?
[2012-10-29 15:13:58 -0400] PDani: yfeldblum, hm, that's a great idea :)
[2012-10-29 15:14:43 -0400] yfeldblum: PDani, or may the recipe & the webservice share data in a completely other way, such as via S3, via a postgres instance, via a mbus, whatever you like ... just not via the node because you ought to treat the node as though there's a readlock on it
[2012-10-29 15:15:40 -0400] yfeldblum: PDani, e.g., the webservice could simply respond with the generated ids in its http response, which the recipe reads and adds to the node data itself
[2012-10-29 15:16:27 -0400] yfeldblum: PDani, or maybe the webservice can operate in two modes: mode 1 is save-the-ids, and is what happens when a sysadmin triggers it out-of-band; mode 2 is return-the-ids, and is what happens when the recipe triggers it in-band
[2012-10-29 15:16:41 -0400] PDani: h
[2012-10-29 15:16:42 -0400] PDani: hm
[2012-10-29 15:17:51 -0400] yfeldblum: PDani, all i'm saying is there are a lot of ways you could do it (and i gave some examples but there are more ways too), but there's one way you're not allowed to do it because it violates certain assumptions :D
[2012-10-29 15:18:39 -0400] PDani: yfeldblum, well, I'm not too experienced with chef and ruby, that's why I asked it here, thanks for the mind-opening response :)
[2012-10-29 15:19:16 -0400] yfeldblum: PDani, no problem
[2012-10-29 15:21:16 -0400] mattray: ntpd dies, clock skews, chef can't run to fix ntp service :/
[2012-10-29 15:22:17 -0400] maek: mattray: upstart ntpd so it restarts it self
[2012-10-29 15:22:28 -0400] mattray: maek: using the ntp cookbook
[2012-10-29 15:22:37 -0400] mattray: service is enabled and started
[2012-10-29 15:22:43 -0400] mattray: it just died a few days ago
[2012-10-29 15:23:03 -0400] paulmooring: mattray: add -g to your startup script
[2012-10-29 15:23:12 -0400] maek: sure, im just saying if you switch from init to upstart you would have something on the box making sure ntpd got restarted if it died
[2012-10-29 15:23:17 -0400] mattray: paulmooring: using the default community ntp cookbook
[2012-10-29 15:23:27 -0400] mattray: anyone else had problems with it?
[2012-10-29 15:23:46 -0400] mattray: seems to be one of the most popular ones in use
[2012-10-29 15:23:49 -0400] maek: mattray: we use the hell out of it. I would be more worried as to why it died and how you got so much clock skew in just a couple days
[2012-10-29 15:24:00 -0400] qhartman: mattray, I've been using it extensively, it kinda just works for us.
[2012-10-29 15:24:04 -0400] mattray: maek: yeah, my clock skews minutes a day
[2012-10-29 15:24:11 -0400] mattray: qhartman: yeah
[2012-10-29 15:26:33 -0400] yfeldblum: mattray, improve the ntp cookbook by adding upstart support?
[2012-10-29 15:27:18 -0400] mattray: yfeldblum: I assumed it was working fine, since everyone seems to be using it
[2012-10-29 15:27:30 -0400] qhartman: I agree that the part that would concern me more would be the failure of NTP itself.
[2012-10-29 15:31:10 -0400] masterkorp: Can i redirect certain ports from the vagrant VMs ?
[2012-10-29 15:31:27 -0400] masterkorp: I am to test the icinga web interface
[2012-10-29 15:36:33 -0400] cheeseplus: masterkorp:   # config.vm.forward_port 80, 8080
[2012-10-29 15:36:39 -0400] cheeseplus: it
[2012-10-29 15:36:46 -0400] cheeseplus: is in the Vagrantfile
[2012-10-29 15:37:59 -0400] masterkorp: Yeah i know that, but the vagrantfile is generated every test-kitchen run right ?
[2012-10-29 15:39:08 -0400] cheeseplus: masterkorp: ah, sorry didn't realize you were in test-kitchen (ignore me then)
[2012-10-29 15:39:38 -0400] masterkorp: That was my fault i wasn't clear about it
[2012-10-29 15:39:55 -0400] masterkorp: i would like to redirect some ports after a recipe had run
[2012-10-29 15:53:06 -0400] PDani: thx, bye
[2012-10-29 15:53:34 -0400] bougyman: oi masterkorp
[2012-10-29 15:55:12 -0400] masterkorp: bougyman: hey bougy! how is it hnaging man ?
[2012-10-29 16:12:43 -0400] cheeseplus: mhalligan: what kind of gig are you looking for?
[2012-10-29 16:13:01 -0400] cheeseplus: I know Basho and Mozilla are hiring Ops/Devops folks right now
[2012-10-29 16:13:25 -0400] geekbri: A lot of people are hiring, Update your linked in profile and then prepare for an onslaught of insurmountable spam
[2012-10-29 16:13:37 -0400] geekbri: I am pretty sure github is hiring as well.
[2012-10-29 16:13:45 -0400] mhalligan: cheeseplus: ideally something where my job is entirely chef/tools dev, preferrably working from home 100% or in either of Emeryville, Oakland, or Berkeley California, with my fallback being a gig in SF
[2012-10-29 16:14:16 -0400] mhalligan: geekbri: hah. I already get the onslaught of insurmountable spam from 3rd party recruiters. hoping to connect with hiring managers directly. headhunters annoy me
[2012-10-29 16:14:43 -0400] cheeseplus: mhalligan: the former two are more ops-y but also both remote
[2012-10-29 16:15:05 -0400] geekbri: Livingsocial is pretty much hiring eternally I think?  I had talked to them at one point or another about a WFH ops job
[2012-10-29 16:15:11 -0400] geekbri: anyway, good luck.
[2012-10-29 16:15:22 -0400] mhalligan: ah yeah, I probably wouldn't do mozilla, it sounds too corporate, but basho might be interesting thanks
[2012-10-29 16:15:30 -0400] wcmaier: mentioning here as well (in case there are others), but simple.com/careers
[2012-10-29 16:20:35 -0400] fromonesrc: mhalligan: https://jobs.github.com/positions/2c1e0f38-1151-11e2-9445-15caa22855f6 (not 100% sure if all positions have been filled but worth applying if you are interested)
[2012-10-29 16:21:20 -0400] mhalligan: probably not github. start-ups like that seem to really believe their BS about the value of stock options. I'm a family guy, I'm all about salary.. but thanks, I'll definitely consider them and apply
[2012-10-29 16:22:29 -0400] mhalligan: their office location rocks though, and of most of the recruiters who are about to spam me, they'll probably be the only one whose product I like :)
[2012-10-29 16:26:00 -0400] kryptek: My recipe needs to install yum packages as a dependency for my chef_gem install, but the chef_gem resource gets kicked off before the other package resource installs the yum packages..
[2012-10-29 16:26:03 -0400] kryptek: Anyone have any ideas?
[2012-10-29 16:26:54 -0400] qhartman: put the code in a pastie.
[2012-10-29 16:27:07 -0400] kryptek: ahh, sup ghartman :)
[2012-10-29 16:27:13 -0400] qhartman: morning
[2012-10-29 16:27:35 -0400] qhartman: (it's a q incidentally, not a g) :D
[2012-10-29 16:27:57 -0400] kryptek: http://pastie.org/5133052
[2012-10-29 16:28:00 -0400] kryptek: Ahh, sorry :P
[2012-10-29 16:28:58 -0400] qhartman: no worries, just makes it easier for me to see if you are talking to me the lines will get highlighted right
[2012-10-29 16:30:22 -0400] kryptek: It's kicking off that block with the chef_gem stuff first
[2012-10-29 16:30:23 -0400] kryptek: :/
[2012-10-29 16:30:45 -0400] qhartman: I think it's the each loop you have those in. They will get evaluated during compilation and then the resources that they build will get stuck into the convergence in an order that I can't predict
[2012-10-29 16:31:08 -0400] kryptek: Gimme a sec, I'll try removing them from that array
[2012-10-29 16:31:09 -0400] qhartman: Are they exactly reversed? That would make some sense, and you could probably fix it by reversing your blocks in the code
[2012-10-29 16:31:39 -0400] kryptek: The gems depend on those packages
[2012-10-29 16:32:40 -0400] qhartman: Right, but with how chef treats raw ruby vs resources, it's not evaluating them in the order you expect
[2012-10-29 16:32:51 -0400] kryptek: yeah :/
[2012-10-29 16:33:04 -0400] kryptek: Let's see, testing out the code without the arrays
[2012-10-29 16:33:48 -0400] fromonesrc: mhalligan: fwiw github professes to be an extremely family oriented company
[2012-10-29 16:34:10 -0400] qhartman: I'm sure there's someone around here who knows chef guts well enough to predict what order those would be evaluated in.
[2012-10-29 16:34:25 -0400] kryptek: qhartman, http://pastie.org/5133086
[2012-10-29 16:34:28 -0400] kryptek: Doesn't seem to work
[2012-10-29 16:34:31 -0400] mhalligan: fromonesrc: interesting. it's not about benefits, or really even flexibility to me as much as it is pure compensation. I'm trying to buy a house, and a $100k down payment isn't a simple task.
[2012-10-29 16:34:48 -0400] kryptek: I think it's because chef_gem is processed immediately
[2012-10-29 16:35:00 -0400] mhalligan: startups tend not to pay well
[2012-10-29 16:35:13 -0400] qhartman: kryptek, huh, yeah, that would make sense. Can you just use them as a normal gem package?
[2012-10-29 16:35:50 -0400] kryptek: qhartman,  Great minds think alike; trying that now :p
[2012-10-29 16:36:08 -0400] qhartman: waitasec, why do you have the reqire statements in there as well?
[2012-10-29 16:36:10 -0400] kryptek: Ack.. now it barfs on the require
[2012-10-29 16:36:27 -0400] qhartman: are you using those gems in the recipe itself?
[2012-10-29 16:36:31 -0400] cheeseplus: mhalligan: for my part I can attest that Basho pays well and you get stock options but they are just icing on the cake
[2012-10-29 16:37:00 -0400] kryptek: qhartman,  I have a library I wrote that needs the gem to be loaded
[2012-10-29 16:37:08 -0400] qhartman: kryptek,
[2012-10-29 16:37:09 -0400] cheeseplus: mhalligan: I avoided startups for a long while for the very reason you mentioned
[2012-10-29 16:37:10 -0400] qhartman: ah
[2012-10-29 16:37:11 -0400] qhartman: gotcha
[2012-10-29 16:37:32 -0400] masterkorp: startups can be cool if you're in charge
[2012-10-29 16:37:44 -0400] qhartman: kryptek, Well, you've officially ventured into territory I don't know
[2012-10-29 16:37:53 -0400] kryptek: hehe
[2012-10-29 16:37:57 -0400] mhalligan: cheeseplus: every startup I talked to this last round had a $140k salary, all the public companies were at about $160k. significant enough not to care about stock options, but I'm checking out basho. I heard good things from an acquaintance about working there
[2012-10-29 16:38:29 -0400] mhalligan: cheeseplus: are they chill about WFH? I'm more productive @ home and taking BART is lame for a life that's so short
[2012-10-29 16:38:51 -0400] cheeseplus: mhalligan: it's all WFH - distributed company for a distributed database ;)
[2012-10-29 16:39:10 -0400] cheeseplus: I mean we have offices in Boston, SF, Tokyo, and London but they are completely optional
[2012-10-29 16:39:58 -0400] mhalligan: cheeseplus: they just made it to the top of the stack with that one, WFH is the only lifestyle point I'm willing to compromise salary for :)
[2012-10-29 16:40:31 -0400] Mithrandir: (well, a mix is nice.  Being able to wfh is good, but I don't want to do that all the time.  Gets lonely)
[2012-10-29 16:40:37 -0400] cheeseplus: I sometimes miss an office but coworking with friends is a nice approximation
[2012-10-29 16:40:48 -0400] mhalligan: mithrandir: me too, but at ones where my non sysadmin co-workers work, ideal = coffee shops and coworking spots
[2012-10-29 16:41:28 -0400] mhalligan: cheeseplus: aye! I used to bring tons of peeps to work from my place in the city, trying to rebuild that in Oakland.
[2012-10-29 16:41:47 -0400] cheeseplus: I'm still trying to get into a coworking spot in Austin, the nice downtown one is booked through January :(
[2012-10-29 16:41:59 -0400] nlloyds2: Is there any way I can use the omnibus embedded ruby as the system default ruby?
[2012-10-29 16:42:15 -0400] holoway: nlloyds2: you really don't want to
[2012-10-29 16:42:48 -0400] yfeldblum: nlloyds2, the whole point of the omnibus embedded ruby is that it is completely designed around not being the system default ruby
[2012-10-29 16:43:11 -0400] nlloyds2: holoway: Ok, well I want 1.9.3p286, and that's what it's using. Know of any cookbooks that install that on ubuntu 10.04?
[2012-10-29 16:43:15 -0400] holoway: and we're going to do things like upgrade it for you because it makes sense for chef
[2012-10-29 16:43:28 -0400] nlloyds2: (without having to compile?)
[2012-10-29 16:43:28 -0400] holoway: which might break your applications, etc
[2012-10-29 16:44:30 -0400] holoway: nlloyds2: I would question making the system ruby 1.9.2 on 10.04, since the ruby 1.9 package they ship already is known to not work with other software in the package repositories
[2012-10-29 16:44:49 -0400] nlloyds2: makes sense. I just had my previous bootstrap scripts installing ruby 1.9 within the bootstrap process, now I need to find or write a whole cookbook for something.
[2012-10-29 16:45:12 -0400] nlloyds2: holoway: I've been using it with a custom package and it's been working fine.
[2012-10-29 16:45:13 -0400] holoway: nlloyds2: there may be a place to grab one, but I would probably use ruby-build to put it in specific prefix for yourself, then use fpm to package it up
[2012-10-29 16:45:24 -0400] nlloyds2: ug
[2012-10-29 16:46:20 -0400] jtimberman: yeah if you have a custom package already that you like then i'd use a recipe that installs that package where you need it for your applications
[2012-10-29 16:46:20 -0400] nlloyds2: I think i'm just going to re-use https://github.com/hw-cookbooks/ruby_installer and make it so it can install this: http://blog.brightbox.co.uk/posts/next-generation-ruby-packages-for-ubuntu
[2012-10-29 16:46:36 -0400] qhartman: I've heard some rumors about a chef style guide coming from Opscode at some point. Anyone know anything about the current status of that?
[2012-10-29 16:46:45 -0400] mhalligan: is there anything like hiera for chef?
[2012-10-29 16:47:05 -0400] mhalligan: hrm I guess in a way environments do
[2012-10-29 16:47:14 -0400] nlloyds2: Sure, I just had that baked into my old bootstrap scripts so it makes switching to using the omnibus scripts more work than I had anticipated.
[2012-10-29 16:47:26 -0400] nlloyds2: Thanks for the help.
[2012-10-29 16:47:30 -0400] specialsauce: qhartman - not seen that unless its going to be part of the docs.opscode.com effort is it?
[2012-10-29 16:50:51 -0400] kryptek: ahh.. much better, had to set up BitchX windows :P hee
[2012-10-29 16:50:52 -0400] kryptek: hehe
[2012-10-29 16:51:23 -0400] mortuar: $ knife client create user -a
[2012-10-29 16:51:23 -0400] mortuar: ERROR: RuntimeError: Please set EDITOR environment variable
[2012-10-29 16:51:27 -0400] mortuar: anyone run into that one?
[2012-10-29 16:51:50 -0400] qhartman: specialsauce, Dunno. I saw mention of it in the minutes from an Opscode meeting (or something similar) a few weeks ago, but that's been it.
[2012-10-29 16:53:51 -0400] qhartman: specialsauce, oh, and I also found this draft document, but it's pretty old: http://wiki.opscode.com/display/chef/Cookbook+Style+Guide+Draft
[2012-10-29 16:59:00 -0400] specialsauce: mortuar, it wants you to double check the details in a JSON blob or something from memory and so launches it in your editor. Most envs on most hosts would have that set by default to vim or whatever. You can hack it into your bash profile as "EDITOR=/usr/bin/vi" or whatever is appropriate and it shuold just work
[2012-10-29 16:59:19 -0400] specialsauce: unless yuo're saying you have an editor var set and it still doesn't work, in which case who knows, new bug i guess :-P
[2012-10-29 16:59:29 -0400] mortuar: thanks specialsauce
[2012-10-29 16:59:39 -0400] mortuar: I just did EDITOR=vi blah blah blah
[2012-10-29 16:59:41 -0400] mortuar: and it was happy
[2012-10-29 16:59:42 -0400] mortuar: :D
[2012-10-29 16:59:49 -0400] specialsauce: cool
[2012-10-29 16:59:56 -0400] mortuar: appreciate it :)
[2012-10-29 17:06:05 -0400] jtimberman: specialsauce: i don't think a style guide is strictly a reference documentation thing more like... a guide or tutorial
[2012-10-29 17:06:52 -0400] specialsauce: fair enough
[2012-10-29 17:07:13 -0400] jtimberman: qhartman: there's a draft here: http://wiki.opscode.com/display/chef/Cookbook+Style+Guide+Draft - and ampledata has a github repository here: https://github.com/ampledata/cookbook-style-guide
[2012-10-29 17:07:20 -0400] jtimberman: i'd like to consolidate effort on this
[2012-10-29 17:07:33 -0400] jtimberman: and get foodcritic rules open for where there are gaps
[2012-10-29 17:07:59 -0400] jtimberman: specialsauce: that isn't to say that we wouldn't have guides on the docs site, but i don't think there are even any listed there yet
[2012-10-29 17:08:14 -0400] qhartman: awesome, thanks for the links. As I'm trying to get our chef infrastructure "fixed" I think these will help justify some of the stuff I want to do.
[2012-10-29 17:08:27 -0400] kryptek: jtimberman,  Can you tell me how I can get my recipe to install the yum packages I need before chef_gem kicks off in the recipe?  Would I have to place these yum package installs in another cookbook that's executed before this particular cookbook?
[2012-10-29 17:08:53 -0400] jtimberman: kryptek: package("mything").run_action :install
[2012-10-29 17:08:53 -0400] qhartman: jtimberman, We have developed a lot of bad habits in our usage of chef, some of which bit us repeatedly
[2012-10-29 17:09:45 -0400] kryptek: jtimberman,  Thanks :)
[2012-10-29 17:10:15 -0400] jtimberman: or, https://gist.github.com/3974942
[2012-10-29 17:10:21 -0400] jtimberman: for a multi-line one
[2012-10-29 17:10:54 -0400] kryptek: Thanksssss, man.  That was driving me crazy!
[2012-10-29 17:13:31 -0400] fish_: stupid question: but a node attribute should be available when rendering a template even in chef-solo if that node attribute has a default in <cookbook>/attributes/default.rb - right?
[2012-10-29 17:14:47 -0400] fish_: attribute: <cookbook>/attributes/default.rb: default[:foo] = "bar" / template: <cookbook>/templates/default/something.rb: this is <%= node[:foo] %>
[2012-10-29 17:14:51 -0400] fish_: ^- that should work, right?
[2012-10-29 17:15:26 -0400] kryptek: should work, yeah
[2012-10-29 17:15:40 -0400] kryptek: what's the error you're getting?
[2012-10-29 17:16:17 -0400] fish_: kryptek: hrm yes, what I would expect.. it works fine with chef-server but it doesn't work with chef-solo. I don't get any error, that node attribute is just empty
[2012-10-29 17:16:41 -0400] kryptek: hmm
[2012-10-29 17:16:51 -0400] kryptek: might be a bug
[2012-10-29 17:17:14 -0400] fish_: (or to be specific: the template renders just fine - but where I expect the content of the node attribute is nothing)
[2012-10-29 17:18:04 -0400] fish_: kryptek: yes, might be.. maybe I should fill another bug although I have the feeling that nobody really cares ;)
[2012-10-29 17:18:05 -0400] kryptek: yeah, like it's not processing the attribute file
[2012-10-29 17:18:34 -0400] fish_: but if it wouldn't process that, wouldn't the rendering of the template fail?
[2012-10-29 17:19:27 -0400] JustinCampbell: vagrant provision/reload is only failing when i set VAGRANT_LOG=INFO
[2012-10-29 17:20:53 -0400] kryptek: fish_, Not necessarily, because accessing a key that's nil would probably just return an empty string in chef
[2012-10-29 17:21:06 -0400] wamcvey: I'm trying to use the 'redmine' community cookbook. The one on the community site is broken. Trying to use the one on github (which is newer from the same apparent author). It depends on application_rails. I tried "cookbook site install application_rails" and got a less than helpful error:
[2012-10-29 17:21:06 -0400] wamcvey: ERROR: The object you are looking for could not be found
[2012-10-29 17:21:06 -0400] wamcvey: Response: [nothing]
[2012-10-29 17:21:10 -0400] wamcvey: Any suggestions?
[2012-10-29 17:21:42 -0400] fish_: kryptek: hrm ah yes thats right. node[:foo] would be "" but node[:foo][:bar] would crash if node[:bar] doesn't exist
[2012-10-29 17:21:50 -0400] wamcvey: sorry, take out 'community' in the first sentence... I started with 'community cookbook' it failed, so switched to github version, which is still failing.
[2012-10-29 17:22:06 -0400] kryptek: fish_, Yep
[2012-10-29 17:33:46 -0400] ci_: When using chef as a deployment tool, is there a way to specify a git repo on the local development workstation?
[2012-10-29 17:35:32 -0400] j-v-e: yfeldblum: yesteday you mentionned running chef-client with --fork to help with the memory consumption. do you have more information on what that does exactly ?
[2012-10-29 17:35:39 -0400] ekristen: I want to query chef to find out what my database server is when setting up my web server, I have a recipe for my web server, would the best place to do this be in the web recipe and then plug that value into my web configuration template?
[2012-10-29 17:38:18 -0400] ci_: From http://wiki.opscode.com/display/chef/Deploy+Resource -> how can "repo" reference a repo on the local workstation?  OR do I have to use a cloud hosted solution (git, bitbucket, my own server, etc.)?
[2012-10-29 17:39:44 -0400] wamcvey: ci_: I use git-daemon to present a downloadable/fetchable view of my local git repos.
[2012-10-29 17:40:33 -0400] ci_: wamcvey, thanks.  I am not at all familiar with that method.  Can you expound a little more?  I will google also.
[2012-10-29 17:40:35 -0400] wamcvey: (I launch git-daemons out of supervisord, managed by chef on my code-repo host).
[2012-10-29 17:41:26 -0400] wamcvey: ci_: "man git-daemon" on a linux/unix system should give you all the details you really need. :-)
[2012-10-29 17:42:15 -0400] ci_: wamcvey: should the git-daemon run on local workstation or production server (sorry for noob)
[2012-10-29 17:42:44 -0400] wamcvey: I'd share my cookbook with you if I could, but... well, it's on our private git repo (which is accessible via git-daemon, controlled by chef, ...)
[2012-10-29 17:42:53 -0400] ci_: ha
[2012-10-29 17:45:17 -0400] wamcvey: ci_: I run my repo that all my cookbooks suck from on a "production" system assigned a master-coderepo role, and then my site cookbooks uses search to fetch that repo... but you could launch it from your workstation just as easily (although coding your workstation's name/ip addr into cookbooks strikes me as a descidely bad idea.
[2012-10-29 17:45:28 -0400] wamcvey: decidedly even
[2012-10-29 17:46:06 -0400] yfeldblum: j-v-e, last time i looked through the code, i believe, when a daemonized chef-client starts the next run, it forks a child and performs the run in the child, and when the run is completed, the child exits
[2012-10-29 17:46:07 -0400] ci_: thanks wamcvey.  I will see if I can figure it out.  Appreciate the help
[2012-10-29 17:50:43 -0400] yfeldblum: j-v-e, i believe that mechanism should help you with the memory accumulation
[2012-10-29 17:51:28 -0400] stat1x: I just upgraded from 0.10.8 to latest, and updated gems, and I get this error, any ideas?
[2012-10-29 17:51:33 -0400] stat1x: usr/lib/ruby/1.8/rubygems.rb:233:in `activate': can't activate net-ssh (~> 2.2.2, runtime) for ["chef-10.16.2", "knife-ec2-0.6.2"], already activated net-ssh-2.3.0 for ["net-scp-1.0.4", "fog-1.6.0", "knife-ec2-0.6.2"] (Gem::LoadError)
[2012-10-29 17:51:35 -0400] j-v-e: that's what I thought. thanks yfeldblum, we'll try it
[2012-10-29 18:03:55 -0400] davidmz: Hello,, I want to host my own chef-server I was wondering what is the memory requirements of a full chef install for about 20-30 nodes
[2012-10-29 18:06:10 -0400] wamcvey: davidmz: that's about the scale I'm running. I have my server running in a vm with 8gig of mem and 50 gig of disk, and I've not had any problems.
[2012-10-29 18:06:46 -0400] wamcvey: I didn't fret it too much, since it's in a vm, I could always add more mem or disk if needed, but so far, it's not been needed.
[2012-10-29 18:07:47 -0400] wamcvey: I don't have a whole lot of search complexity in most of my recipes...
[2012-10-29 18:07:59 -0400] yfeldblum: davidmz, 512GB memory, 20GB disk works fine
[2012-10-29 18:08:58 -0400] yfeldblum: davidmz, that's rackspace's new smallest flavor (second-smallest flavor on their v1 cloud, smallest on their v2 cloud)
[2012-10-29 18:09:28 -0400] wamcvey: 512Gig of memory is their smallest flavor? GIG? really?
[2012-10-29 18:09:53 -0400] Twirrim: :D
[2012-10-29 18:10:02 -0400] Twirrim: damn I want 'small' instances that size
[2012-10-29 18:12:13 -0400] yfeldblum: wamcvey, heh sorry, 512MB
[2012-10-29 18:12:17 -0400] wamcvey: davidmz: literally over the weekend I deployed a new chef-server into a linux kvm for my home network. I allocated 4gig of mem for it, and I've not had any problems yet... of course, only have like 6 devices currently syncing to it.
[2012-10-29 18:12:28 -0400] erikh: reminds me of the time my friend said he was getting upgraded to 8MB of memory. I asked him what he needed it for and he said "OS/2 Warp"
[2012-10-29 18:12:32 -0400] erikh: I thought he was wasting his money
[2012-10-29 18:15:01 -0400] kryptek: ekristen, Have you considered storing the address of your DB server in a data bag?
[2012-10-29 18:15:38 -0400] josephholsten_: how has no one created a nokogiri cookbook?
[2012-10-29 18:15:57 -0400] yfeldblum: josephholsten_, why should anyone make one?
[2012-10-29 18:16:03 -0400] yfeldblum: josephholsten_, what would be the point?
[2012-10-29 18:17:04 -0400] ekristen: kryptek: I suppose I could do that, but whats the point of using chef then -- I mean with chef when my web server comes online, it should be able to look in my chef environment and determine which servers are the database servers
[2012-10-29 18:17:08 -0400] ekristen: and configure itself according
[2012-10-29 18:17:13 -0400] davidmz: wamcvey:: I was wondering if 1 gig is enough, I want to save money
[2012-10-29 18:17:18 -0400] josephholsten_: because typing `package 'libxml2-dev'; package 'libxslt-dev'; chef_gem 'nokogiri'` is a pattern on my systems
[2012-10-29 18:17:28 -0400] ekristen: otherwise I'm just having to do things manually by adding data to the data bag, unless I misunderstand databags
[2012-10-29 18:17:52 -0400] kryptek: ekristen,  Oh, was just asking.  Yeah, you could put the DB server address in the environment file (that's what I'd do)
[2012-10-29 18:18:25 -0400] ekristen: kryptek: even that is still manual
[2012-10-29 18:18:35 -0400] jtimberman: josephholsten_: "xml" cookbook
[2012-10-29 18:18:45 -0400] ekristen: kryptek: ideally using search(:node, "search") in a recipe
[2012-10-29 18:18:51 -0400] jtimberman: josephholsten_: doesn't do the nokogiri part, but does the right xml and xslt packages by platform
[2012-10-29 18:18:52 -0400] kryptek: ekristen,  So you wanna query the API and return your servers then
[2012-10-29 18:18:57 -0400] jtimberman: because you know, we can't agree on package naming
[2012-10-29 18:19:04 -0400] ekristen: kryptek: pretty much
[2012-10-29 18:19:54 -0400] davidmz: Thanks you
[2012-10-29 18:20:04 -0400] davidmz: I will start with 1 gig
[2012-10-29 18:20:40 -0400] kryptek: ekristen,  you can try using:  db_servers = search(:node, '<query>')
[2012-10-29 18:21:07 -0400] josephholsten_: jtimberman: oh, I had remembered the xml cb not having xslt. well I'll just do that then.
[2012-10-29 18:21:45 -0400] erikh: ekristen: so, I generally like to create a "app" cookbook that does these things, and then create a "webapp" cookbook that works with that
[2012-10-29 18:21:59 -0400] ekristen: erikh: do you have any examples I could see?
[2012-10-29 18:22:15 -0400] erikh: the nice thing about it is that if I want to add an app service that isn't the web, I can just base that off the app cookbook too
[2012-10-29 18:22:20 -0400] erikh: (and all the naughty bits still work)
[2012-10-29 18:22:28 -0400] erikh: ekristen: not that I can think of, sorry
[2012-10-29 18:22:54 -0400] erikh: it's not exceptionally hard though. it's just divide and conquer for the same things you'd be doing in one cookbook really
[2012-10-29 18:23:15 -0400] ekristen: erikh: yeah I understand
[2012-10-29 18:23:28 -0400] josephholsten_: jtimberman: aww, i forgot. that doesn't work because I want to chef_gem nokogiri, which requires the xml packages to be installed in the compile phase.
[2012-10-29 18:23:52 -0400] josephholsten_: isn't there another cb that abstracted that pattern? mysql::ruby or something?
[2012-10-29 18:24:36 -0400] kryptek: ekristen,  Not sure if this helps or not:  http://pastie.org/private/97yips7faoiz2l6qp65qjw
[2012-10-29 18:25:09 -0400] erikh: oh, do you need the actual search query?
[2012-10-29 18:25:14 -0400] kryptek: yeah
[2012-10-29 18:25:15 -0400] erikh: that's mega easy
[2012-10-29 18:25:27 -0400] kryptek: whoops, wrong window
[2012-10-29 18:25:28 -0400] ekristen: erikh: well actually handling the results
[2012-10-29 18:25:55 -0400] kryptek: ekristen,  You can loop over each object in the array returned by the search, just use the '.keys' method on the object to find all the data it returns
[2012-10-29 18:26:00 -0400] yfeldblum: josephholsten_, in that type of case, that goes into your bootstrap
[2012-10-29 18:26:12 -0400] yfeldblum: josephholsten_, bootstrap the node with those packages
[2012-10-29 18:26:16 -0400] erikh: well, resolving the IP address can be a bit of a bear especially if you're in multiple environments (e.g., ec2 and a local vagrant for testing)
[2012-10-29 18:26:40 -0400] kryptek: erikh, Ahh, yeah.. that gets a little more complex.. hehe
[2012-10-29 18:27:12 -0400] erikh: but more or less, search(:node, "mysql_master:true and mysql_cluster_name:#{cluster_name} and chef_environment:#{node.chef_environment}").first.ipaddress is the most basic
[2012-10-29 18:27:36 -0400] erikh: tack a rescue nil on the end for if that call chain breaks
[2012-10-29 18:27:38 -0400] josephholsten_: yfeldblum: multi run convergence is for wimps <3
[2012-10-29 18:27:52 -0400] erikh: oh; and capitalize AND
[2012-10-29 18:35:50 -0400] erikh: ekristen: https://gist.github.com/70d6a392e5887ee7b5a6
[2012-10-29 18:36:21 -0400] erikh: is what we use to manage IP address selection here, it's not general enough to be released but you may find it worth taking and modifying
[2012-10-29 18:36:51 -0400] erikh: just throw it in libraries/ in a cookbook
[2012-10-29 18:37:27 -0400] ekristen: erikh: nice! so then how do I use it? IPCalculator.primary_ip(node) ?
[2012-10-29 18:37:36 -0400] erikh: yep
[2012-10-29 18:37:47 -0400] ekristen: erikh: that is slick, thanks!
[2012-10-29 18:38:13 -0400] jtimberman: josephholsten_: ah ha. mysql::ruby does that.
[2012-10-29 18:38:20 -0400] erikh: oh, wait, I have a better version in a branch, sec.
[2012-10-29 18:38:24 -0400] ekristen: ok
[2012-10-29 18:38:41 -0400] jtimberman: josephholsten_: probably repeat the pattern for xml, make an xml::ruby recipe
[2012-10-29 18:38:47 -0400] jtimberman: and stick chef_gem nokogiri in there
[2012-10-29 18:39:09 -0400] erikh: ekristen: https://gist.github.com/5770351fcc26fd8b44e5
[2012-10-29 18:39:22 -0400] erikh: this one will let you specify if you prefer the public or private interface (if there's a difference)
[2012-10-29 18:39:37 -0400] ekristen: sweet
[2012-10-29 18:42:44 -0400] JasonBox: hrm, I can append a new role to the role list within a recipe, yes?
[2012-10-29 18:45:10 -0400] cpasmoi: never tried
[2012-10-29 18:51:28 -0400] josephholsten_: platform_family?
[2012-10-29 18:51:41 -0400] josephholsten_: aww robot
[2012-10-29 18:57:36 -0400] erikh: JasonBox: yes, but it won't run until the next run
[2012-10-29 18:57:59 -0400] erikh: it's also probably a very bad idea
[2012-10-29 19:02:11 -0400] stat1x: Just upgraded Chef and RubyGems, now I'm getting this error, any ideas?: Bootstrapping Chef on XXX -- ERROR: ArgumentError: invalid option(s): keys_only
[2012-10-29 19:05:22 -0400] josephholsten_: stat1x: could you give us more context? maybe the cookbook or log output in a gist?
[2012-10-29 19:08:52 -0400] josephholsten_: hmm, I wonder how much of that test-kitchen talk I can remember
[2012-10-29 19:09:30 -0400] stat1x: Well there wasn't much context to give, but I commented out this line in chef-10.16.2/lib/chef/knife/ssh.rb and it works now:
[2012-10-29 19:09:36 -0400] stat1x: # session_opts[:keys_only] = true if config[:identity_file]
[2012-10-29 19:23:01 -0400] Pushnell__: If I don't provide a password to the user resource, does it generate one?
[2012-10-29 19:23:38 -0400] jtimberman: Pushnell__: no
[2012-10-29 19:24:03 -0400] jtimberman: Pushnell__: the user has no password set, and would have to log in via non-password based authentication, e.g. ssh keys
[2012-10-29 19:24:34 -0400] Pushnell__: jtimberman: ah, ok, perfect.  This was for a user that only does stuff via cron.  thanks.
[2012-10-29 19:28:46 -0400] yfeldblum: a good intro to what symbols are in ruby, including when it is good to use them and when not to (unrelated to chef): http://www.youtube.com/watch?v=mBXGBbEbXZY
[2012-10-29 19:32:17 -0400] qhartman: yfeldblum, good link for us Ruby noobs. Thnks!
[2012-10-29 19:36:23 -0400] Pushnell__: If I create an ec2 instance manually and then decide I need chef on it, is there a way to trigger the same processes that are done with 'knife ec2 server create' ?  creating the node, bootstrapping, etc
[2012-10-29 19:37:37 -0400] yfeldblum: Pushnell__, `knife bootstrap`
[2012-10-29 19:40:47 -0400] Pushnell__: yfeldblum: danke
[2012-10-29 19:47:30 -0400] yfeldblum: jtimberman, http://www.youtube.com/watch?v=mBXGBbEbXZY for an overview on symbols vs strings, in case more people decide to ask
[2012-10-29 19:51:24 -0400] ci_: one more question.  Is it possible to create database tables when deploying chef?  Never attempted before and have no idea where to begin
[2012-10-29 19:51:35 -0400] holoway: ci_: it's absolutely possible
[2012-10-29 19:53:04 -0400] ci_: can you point me in the right direction?  what to google?  where should i place this?  just learning
[2012-10-29 19:53:23 -0400] yfeldblum: ci_, doesn't sound like a good idea to me ...
[2012-10-29 19:53:57 -0400] yfeldblum: ci_, sounds like your application needs to ship a script to prepare an empty database, given a valid user with perms on that database
[2012-10-29 19:54:04 -0400] ci_: the situation... have a sessions table and a variables table that needs to be there when the site is deployed
[2012-10-29 19:54:16 -0400] c_t: there's some stuff in the mysql cookbook to give inspiration
[2012-10-29 19:54:22 -0400] c_t: where it sets up the grants and such
[2012-10-29 19:54:47 -0400] yfeldblum: ci_, ship a preparation script with the app, which the deploying cookbook can run
[2012-10-29 19:54:52 -0400] c_t: but I'd do it in with the application stuff as yfeldblum says
[2012-10-29 19:55:16 -0400] yfeldblum: ci_, e.g., ship a Makefile and have your deploying cookbook run `make`
[2012-10-29 19:57:57 -0400] yfeldblum: ci_, or in the node data or data-bag-item (or wherever you're putting optional information on the application that the cookbook can read) add one more item for "build_command" and configure that however you like int he data-bag item or the role or w/e
[2012-10-29 19:58:18 -0400] behemphi: @ssd7 any word on the doc repo becoming public?
[2012-10-29 20:00:32 -0400] josephholsten_: ci_: you should look at the database cookbook
[2012-10-29 20:03:33 -0400] ci_: i am familiar with how to configure a database - credentials, privileges, etc. - but need to work on the table creation
[2012-10-29 20:07:42 -0400] yfeldblum: ci_, understood; my suggestion is to have the application do that stuff in a build script in the application's codebase, and to have the cookbook run the build script after downloading the new code but before launching it
[2012-10-29 20:09:28 -0400] josephholsten_: ci_: I'm with yfeldblum. but if you figure out a good api to abstract into a resource, you'll want to model it after the database cookbook. ideally, add it too the database cookbook.
[2012-10-29 20:09:46 -0400] josephholsten_: I forgot there wasn't a database_table resource already
[2012-10-29 20:11:11 -0400] josephholsten_: jtimberman: any doc improvements you want in while I'm updating the xml cookbook's read me?
[2012-10-29 20:12:36 -0400] ci_: thanks for the help
[2012-10-29 20:12:53 -0400] ci_: i am going to try to wrap my head around it and see what i can do but you have me pointed in the right direction
[2012-10-29 20:17:06 -0400] Lrrr: What to do when node[ipaddress] is not properly detected and thus empty?
[2012-10-29 20:17:36 -0400] jtimberman: josephholsten_: i don't know if it needs any
[2012-10-29 20:17:43 -0400] josephholsten_: jtimberman: kk
[2012-10-29 20:17:55 -0400] josephholsten_: Lrrr: it depends ;)
[2012-10-29 20:18:04 -0400] josephholsten_: are you using a cloud hosting provider?
[2012-10-29 20:18:11 -0400] Lrrr: a cheap VPS provider...
[2012-10-29 20:18:21 -0400] Lrrr: so, "kind of" a cloud hosting provider
[2012-10-29 20:18:26 -0400] josephholsten_:  do you mind saying who?
[2012-10-29 20:19:12 -0400] josephholsten_: let me rephrase: you're depending on ohai to populate that property
[2012-10-29 20:19:23 -0400] Lrrr: yes
[2012-10-29 20:19:39 -0400] josephholsten_: in some situations, it'll put information in node['cloud']['local_ipv4']
[2012-10-29 20:20:09 -0400] Lrrr: That means I'll need to change the recipe right?
[2012-10-29 20:20:25 -0400] josephholsten_: for other situations, there may be an ohai plugin that exists to grab that for you.
[2012-10-29 20:21:01 -0400] ekristen: erikh: do you ever run into a situation where you have multiple versions of your application that you need to support in a cookbook or support upgrade?
[2012-10-29 20:21:15 -0400] Lrrr: I wouldn't mind overriding that value myself. I don't have many hosts to care about
[2012-10-29 20:21:33 -0400] Lrrr: But I'd like to do without changing the recipe
[2012-10-29 20:21:45 -0400] josephholsten_: Lrrr: yes, sortof. you could have a cookbook run before hand that populates that attribute.
[2012-10-29 20:22:24 -0400] Lrrr: hmm good point
[2012-10-29 20:22:33 -0400] Lrrr: I can override that like any attributes right?
[2012-10-29 20:22:48 -0400] josephholsten_: the main issue is that some hosting providers have a host of different ipaddresses for each node, one for internal networking, another for external, maybe ipv6 and v4 also
[2012-10-29 20:22:53 -0400] josephholsten_: Lrrr: absolutely
[2012-10-29 20:23:12 -0400] Lrrr: Okay that will probably do
[2012-10-29 20:23:46 -0400] Lrrr: I'll set that as a special node attribute and put the override in a cookbook I have
[2012-10-29 20:24:55 -0400] jaimef: is there a "wget file" resource in chef? i.e. fetch a remote file from a url
[2012-10-29 20:25:08 -0400] turtlebender: remotefile
[2012-10-29 20:25:13 -0400] josephholsten_: remote_file resource
[2012-10-29 20:25:31 -0400] josephholsten_: where's our chan bot anyway?
[2012-10-29 20:25:43 -0400] jaimef: so you could replace a script block of "wget http://file|tar -xf" with a remote_file plus execute block
[2012-10-29 20:25:44 -0400] jaimef: thanks
[2012-10-29 20:26:37 -0400] josephholsten_: jaimef: keep in mind you'll want a checksum for remote_file. otherwise it'll keep checking to see if the document at the url is updated on every run
[2012-10-29 20:26:55 -0400] erikh: ekristen: no, sorry
[2012-10-29 20:27:32 -0400] josephholsten_: anyone know who was running the channel bot?
[2012-10-29 20:34:03 -0400] jtimberman: josephholsten_: it was originally set up by fujin, on a system that opscode manages.
[2012-10-29 20:34:19 -0400] jtimberman: josephholsten_: i haven't had a chance to finish restoring it on a new system
[2012-10-29 20:34:26 -0400] josephholsten_: aww
[2012-10-29 20:36:43 -0400] maek: anyone have chef-solr moved off of the chef-server box in open source chef?
[2012-10-29 20:37:22 -0400] josephholsten_: maek: want
[2012-10-29 20:37:45 -0400] maek: same. cant seem to get it to reindex
[2012-10-29 20:38:18 -0400] maek: if I stop chef-solr on the new solr box a search errors, when its running it returns 0, but knife index rebuild just gives the error cant get localhost:4000/server/reindex
[2012-10-29 20:44:14 -0400] tolland: is there a public demo of the webui up anywhere?
[2012-10-29 20:46:21 -0400] ekristen: how can I push attributes to the ohai plugin so they show up in chef
[2012-10-29 20:46:42 -0400] josephholsten_: tolland: hosted chef looks almost the same
[2012-10-29 20:46:52 -0400] josephholsten_: tolland: but mostly no, we don't want to scare people off
[2012-10-29 20:47:13 -0400] josephholsten_: ;-)
[2012-10-29 20:47:38 -0400] Lrrr: hm yeah the webui isn't great
[2012-10-29 20:47:38 -0400] josephholsten_: ekristen: http://wiki.opscode.com/display/chef/Writing+Ohai+Plugins
[2012-10-29 20:48:00 -0400] ekristen: josephholsten_: do I have to write a plugin if I just want a single value to show up as an attribute?
[2012-10-29 20:48:11 -0400] josephholsten_: tolland: my company is working on a json-api shim and a dashboard to go with it
[2012-10-29 20:48:51 -0400] josephholsten_: ekristen: node.set['attr'] = 'val' should do the trick
[2012-10-29 20:49:04 -0400] ekristen: josephholsten_: thanks
[2012-10-29 20:49:37 -0400] kryptek: If I declare a variable (x = 'test') in a recipe can I access the x variable in the same cookbook from a template? <%= x %> ?
[2012-10-29 20:52:00 -0400] josephholsten_: kryptek: template 'foo' do; variables({:x => 'test'}); end
[2012-10-29 20:53:15 -0400] kryptek: josephholsten,  thanks
[2012-10-29 20:53:37 -0400] josephholsten_: rather: the variables attribute for the template resource: http://wiki.opscode.com/display/chef/Resources#Resources-Template
[2012-10-29 20:53:50 -0400] josephholsten_: happy to help
[2012-10-29 20:57:50 -0400] jtimberman: https://github.com/acrmp/foodcritic/issues/86
[2012-10-29 20:58:00 -0400] jtimberman: Just gonna throw that out here.
[2012-10-29 20:58:01 -0400] jtimberman: :)
[2012-10-29 20:58:09 -0400] kryptek: lol
[2012-10-29 20:58:10 -0400] jtimberman: unrelated to current conversation
[2012-10-29 20:58:37 -0400] kryptek: jtimberman,  If I throw variables({'x' => 'value'}) into the template, I just access it in the template as a local var? <%= x %> ?
[2012-10-29 20:59:38 -0400] jtimberman: kryptek: in the template you need @x
[2012-10-29 20:59:43 -0400] kryptek: ahhh
[2012-10-29 20:59:55 -0400] kryptek: so variables creates the objects as instance variables?
[2012-10-29 21:00:11 -0400] jblaine: What's the basic way to test cookbooks before uploading them to the server?
[2012-10-29 21:00:24 -0400] jblaine: and by test, I mean run recipes in them
[2012-10-29 21:00:28 -0400] jblaine: not test syntax
[2012-10-29 21:00:35 -0400] kryptek: jblaine,  Vagrant ?
[2012-10-29 21:00:52 -0400] jblaine: let's assume I already have a running test VM
[2012-10-29 21:01:01 -0400] jblaine: lower level than 'vagrant'
[2012-10-29 21:01:04 -0400] jblaine: chef-solo?
[2012-10-29 21:01:11 -0400] kryptek: yeah
[2012-10-29 21:01:21 -0400] jtimberman: jblaine: that's what we're using test-kitchen to do
[2012-10-29 21:01:33 -0400] jtimberman: test that the cookbook's various components actually work when converged on a node.
[2012-10-29 21:01:44 -0400] jtimberman: it does use vagrant to run a test vm
[2012-10-29 21:06:28 -0400] jblaine: poop, no envs in chef-solo
[2012-10-29 21:06:41 -0400] jblaine: k, thanks all
[2012-10-29 21:07:26 -0400] rafaelmagu: jtimberman: how does test-kitchen work?
[2012-10-29 21:09:30 -0400] josephholsten_: rafaelmagu: it's got an awesome readme: https://github.com/opscode/test-kitchen
[2012-10-29 21:10:46 -0400] masterkorp: symbols vs variables war is getting the old mac vs linux war
[2012-10-29 21:10:48 -0400] masterkorp: :p
[2012-10-29 21:11:31 -0400] bluepojo: the biggest arguments are almost invariably bike shedding in the tech community
[2012-10-29 21:11:56 -0400] bluepojo: I can't remember the last time we discussed something so vehemently when the result actually changed things
[2012-10-29 21:12:21 -0400] bluepojo: symbols vs. strings is even worse than mac vs. linux
[2012-10-29 21:12:30 -0400] bluepojo: cause there is no functional difference between the two
[2012-10-29 21:12:34 -0400] bluepojo: in a general sense
[2012-10-29 21:13:02 -0400] bluepojo: I wish we'd spend as much energy discussing whether to use roles or not
[2012-10-29 21:13:07 -0400] bluepojo: that's actually a valuable discussion
[2012-10-29 21:13:37 -0400] jblaine: say what now? chef-solo -o 'recipe[foo]','recipe[bar]' is running recipe[bar] first
[2012-10-29 21:13:58 -0400] bluepojo: jblaine: does foo depend on bar?
[2012-10-29 21:14:19 -0400] bluepojo: ie: include recipe or some such
[2012-10-29 21:14:22 -0400] bluepojo: that you're not realizing
[2012-10-29 21:14:36 -0400] bluepojo: what's the behavior you're seeing that indicates bar is running first?
[2012-10-29 21:14:37 -0400] jblaine: it depends on some node attrs set in foo
[2012-10-29 21:14:38 -0400] josephholsten_: bluepojo: if you had to do ruby application development, you would know good arguments for any against symbols. Unfortunately, most of those apply in the opposite direction to chef.
[2012-10-29 21:15:06 -0400] bluepojo: josephholsten_: I have been a ruby developer for many years long before I learned chef
[2012-10-29 21:15:32 -0400] bluepojo: josephholsten_: and if you want to start arguing that symbols are a memory leak, you're fighting a losing battle.
[2012-10-29 21:15:50 -0400] josephholsten_: ever used ostruct in a long running proc? that's the worst abuse of symbols I've ever lost hours of my life to
[2012-10-29 21:16:25 -0400] bluepojo: that's not remotely applicable to chef recipe developers
[2012-10-29 21:16:29 -0400] jblaine: bluepojo: https://gist.github.com/3976591
[2012-10-29 21:16:40 -0400] bluepojo: I fully understand that symbols have caveats in ruby applications
[2012-10-29 21:16:52 -0400] jblaine: bluepojo: rcf-kerberos is specified last for a reason -- it needs node attrs set in rcf-netgroups
[2012-10-29 21:17:06 -0400] jblaine: bluepojo: the way I read that output, it is running rcf-kerberos first
[2012-10-29 21:17:08 -0400] jtimberman: the point of issue #86 in foodcritic is to not have it warn you that you didn't paint the bikeshed orange.
[2012-10-29 21:17:22 -0400] Mithrandir: orange bikeshed?  Really?
[2012-10-29 21:17:37 -0400] jtimberman: Mithrandir: opscode orange :)
[2012-10-29 21:17:41 -0400] bluepojo: jblaine: what you're seeing is likely a compilation error
[2012-10-29 21:17:58 -0400] bluepojo: jblaine: chef runs are 2 phase: it compiles all the recipes
[2012-10-29 21:18:00 -0400] josephholsten_: bluepojo: if I actually wanted to win that battle, I'd push for kiji style long lived objects first. and when we're at vm imll optimizations, it's really not at a day to day chef discussion
[2012-10-29 21:18:00 -0400] jtimberman: FC019 is still there, and is actually valuable as it lets you know whether the cookbook is inconsistent.
[2012-10-29 21:18:01 -0400] bluepojo: then it runes them
[2012-10-29 21:18:03 -0400] jtimberman: http://acrmp.github.com/foodcritic/#FC019
[2012-10-29 21:18:29 -0400] Mithrandir: jtimberman: ah, true, you and one of my favourite breweries use about the same colour.
[2012-10-29 21:18:47 -0400] bluepojo: s/runes/runs
[2012-10-29 21:19:30 -0400] jtimberman: Mithrandir: they have good taste!
[2012-10-29 21:19:36 -0400] bluepojo: jblaine: if you need the attributes loaded before the other cookbook gets read, you need to call include_attribute "cookbook_name::attribute_file"
[2012-10-29 21:20:22 -0400] jblaine: bluepojo: interesting
[2012-10-29 21:20:50 -0400] jblaine: bluepojo: the high-priority cookbook sets node attrs in a recipe
[2012-10-29 21:20:56 -0400] jblaine: bluepojo: not attributes file
[2012-10-29 21:21:15 -0400] bluepojo: oh then call include_recipe "cookbook_name::recipe_where_those_node_attrs_are_set"
[2012-10-29 21:21:26 -0400] Mithrandir: jtimberman: you'd like their beer, I think, and you might actually be able to find it around your place too.  Ngne .
[2012-10-29 21:21:52 -0400] jblaine: bluepojo: right but I shouldn't have to do that, because I already set the node attributes (or intend to) with the run_list ordering! :)
[2012-10-29 21:21:58 -0400] jblaine: bluepojo: back to square 1
[2012-10-29 21:22:13 -0400] jblaine: bluepojo: turns out, I solved it, but don't understand why it's a compilation error without my change
[2012-10-29 21:22:21 -0400] yfeldblum: josephholsten, the best argument for using symbols is general consistency: when you call `node["my_attr"].keys`, you get back an array of strings; and when you call `node["my_attr"].each do |key, value|`, you iterate with `key` taking on string values
[2012-10-29 21:22:30 -0400] yfeldblum: josephholsten, lulz for using strings
[2012-10-29 21:22:56 -0400] jblaine: bluepojo: if not node['netgroups']\nnode['netgroups'] = []\nend
[2012-10-29 21:23:17 -0400] jblaine: bluepojo: at start of rcf-kerberos recipe (the on that was failing)
[2012-10-29 21:23:33 -0400] josephholsten_: yfeldblum: in chef, true. outside
[2012-10-29 21:23:49 -0400] jblaine: seems the recipe is trying to resolve the node attributes at *compilation* time
[2012-10-29 21:24:00 -0400] jblaine: err, seems chef-solo is
[2012-10-29 21:24:43 -0400] jblaine: very odd IMO
[2012-10-29 21:26:03 -0400] josephholsten_: https://github.com/opscode-cookbooks/application/blob/master/recipes/java_webapp.rb#L20
[2012-10-29 21:26:11 -0400] josephholsten_: jtimberman, coderanger: ^^
[2012-10-29 21:27:06 -0400] jtimberman: josephholsten_: http://tickets.opscode.com/browse/COOK-1820
[2012-10-29 21:27:08 -0400] jtimberman: :-)
[2012-10-29 21:27:26 -0400] ekristen: can you set an attribute for your environment like you can a node? i.e. environment.set('attr') = 'value';
[2012-10-29 21:27:52 -0400] josephholsten_: woo!
[2012-10-29 21:28:36 -0400] josephholsten_: ekristen: are you hoping that would get applied to all nodes in the env?
[2012-10-29 21:29:22 -0400] ekristen: josephholsten_: well in a new env for my web app was hoping to have the recipe execute a number of database create and population scripts
[2012-10-29 21:29:29 -0400] ekristen: but I don't want it running them each time
[2012-10-29 21:29:38 -0400] ekristen: only the first time the first web server gets stood up
[2012-10-29 21:30:09 -0400] mhalligan: managing all of these cookbooks must be a huge development effort for opscode
[2012-10-29 21:32:02 -0400] josephholsten_: ekristen: I strongly encourage you to find a way of making the scripts idempotent other than changing node attributes
[2012-10-29 21:32:45 -0400] ekristen: josephholsten_: well I was thinking of making them idempotent by checking the the db had been initialized in the env
[2012-10-29 21:33:00 -0400] ekristen: by having an attribute set when it had been
[2012-10-29 21:33:03 -0400] josephholsten_: but the two hard things in chef are naming things and making weird things idempotent. ;-)
[2012-10-29 21:33:17 -0400] ekristen: naming things?
[2012-10-29 21:33:47 -0400] jtimberman: mhalligan: Yup :-)
[2012-10-29 21:35:21 -0400] lyric: I have a couple hosts that started getting FATAL: Net::HTTPServerException: 401 "Unauthorized"
[2012-10-29 21:35:36 -0400] lyric: these were previously fine
[2012-10-29 21:35:56 -0400] lyric: other hosts with the same role etc are fine
[2012-10-29 21:36:04 -0400] lyric: thoughts?
[2012-10-29 21:36:09 -0400] ekristen: josephholsten_: any docs you suggest for reading on idempotent?
[2012-10-29 21:36:30 -0400] lyric: should i delete the clients and readd?
[2012-10-29 21:55:48 -0400] ekristen: how can I do a not_if { } and search all nodes for an attributes?
[2012-10-29 21:56:20 -0400] ekristen: not_if { node.attributes?("some_atr") } I believe pertains to the current node only
[2012-10-29 21:56:32 -0400] bluepojo: you can just do a proper search
[2012-10-29 21:57:01 -0400] bluepojo: http://wiki.opscode.com/display/chef/Search#Search-UsingSearchinRecipes
[2012-10-29 21:59:50 -0400] rafaelmagu: Did anyone manage to setup Sensu in a Vagrant box using their Vagrantfile in cookbook/sensu/examples/ ?
[2012-10-29 22:10:09 -0400] hoover_damm: anyone got a cookbook for deploying https://github.com/meskyanichi/backup
[2012-10-29 22:10:35 -0400] hoover_damm: needing to solve backups and gosh darnit, I don't want to write a darn thing... (cept chef code maybe) and that looks darn easy for backups
[2012-10-29 22:11:11 -0400] programmerq: so I'm trying to get going with chef. I am a little concerned about zero downtime deploys, and how I can follow an algorithm that takes out about half of the appservers from the LB, deploys those, and then tells the LB to use only the new appservers while the rest of the deploy finishes.
[2012-10-29 22:11:22 -0400] programmerq: I'm sure chef addresses this somehow, but I don't know what feature I need to read about.
[2012-10-29 22:12:16 -0400] rafaelmagu: programmerq: you could do something like that with environment switching, but I think that's messy
[2012-10-29 22:12:27 -0400] programmerq: hmmm
[2012-10-29 22:12:56 -0400] programmerq: is it possible to "tag" a host within chef?
[2012-10-29 22:13:20 -0400] programmerq: maybe mark it as "deploying $version" or "running $version"
[2012-10-29 22:13:38 -0400] ekristen: how do I search for an attribute?
[2012-10-29 22:13:52 -0400] ekristen: search(:node, "attributes:search_query") ??
[2012-10-29 22:14:34 -0400] yfeldblum: programmerq, have two applications app-red and app-blue, and have a little switch in e.g. a node tag on the lb node or in a data-bag item that switches the lb to one group or the other; then you can deploy to each group at will
[2012-10-29 22:15:42 -0400] programmerq: that should work
[2012-10-29 22:20:45 -0400] programmerq: someone gave me another suggestion too. basically, before running chef-client for a deploy, mark certain appservers as down (file or db or whatever), and then the lb knows to take them out, and chef client knows to skip any nodes that are not down.
[2012-10-29 22:21:02 -0400] programmerq: I haven't decided if I like that one more or less than the app-red app-blue idea.
[2012-10-29 22:21:05 -0400] programmerq: both would work.
[2012-10-29 22:21:18 -0400] yfeldblum: programmerq, the second one sounds complicated :P
[2012-10-29 22:21:39 -0400] programmerq: it doesn't have to be
[2012-10-29 22:21:51 -0400] programmerq: databag or db or file or whatever "these are down, these are not"
[2012-10-29 22:22:15 -0400] programmerq: then chef-client is run, then you switch the offline appservers and run chef-client again, and then put them all online.
[2012-10-29 22:23:14 -0400] yfeldblum: programmerq, sounds more complicated than a single top-level flag with a single value, the name of the application to balance to
[2012-10-29 22:23:22 -0400] rafaelmagu: programmerq: I agree with yfeldblum, sounds more complicated than what he proposed. just data-bag the switch for the LB to pick up on it, converge, update red, update data-bag, converge LB again, update rest
[2012-10-29 22:23:51 -0400] programmerq: the disadvantage to app-blue or app-red is less flexibility. what do you do when those predefined divisions just plain don't work out?
[2012-10-29 22:24:03 -0400] programmerq: I guess I don't know how hard it would be to add/change them
[2012-10-29 22:24:10 -0400] yfeldblum: hoover_damm, i've deployed it with chef, but it's not public
[2012-10-29 22:24:29 -0400] yfeldblum: programmerq, under what circumstances won't it work out?
[2012-10-29 22:25:12 -0400] programmerq: yfeldblum: perhaps I want to deploy a single appserver and watch how it performs before updating the rest of them (I know that though rare, this practice is not unheard of)
[2012-10-29 22:25:25 -0400] programmerq: or maybe I want to do them in 3 chunks instead of 2
[2012-10-29 22:25:42 -0400] programmerq: I agree it is a corner case
[2012-10-29 22:25:56 -0400] programmerq: but I've been in enough situations where I've kicked myself for not leaving options open
[2012-10-29 22:25:57 -0400] rafaelmagu: Use capistrano-chef and create groups with limits
[2012-10-29 22:26:03 -0400] rafaelmagu: That's how I deploy mine
[2012-10-29 22:26:11 -0400] ekristen: how can I set a multilevel attribute?
[2012-10-29 22:26:22 -0400] programmerq: I'll have to check out capistrano-chef.
[2012-10-29 22:26:23 -0400] ekristen: it app.settings.option1 = value with node.set?
[2012-10-29 22:27:43 -0400] yfeldblum: programmerq, gotcha
[2012-10-29 22:35:22 -0400] hoover_damm: yfeldblum, :(
[2012-10-29 22:35:29 -0400] hoover_damm: yfeldblum, I was hoping to not have to code it and make it public
[2012-10-29 22:36:08 -0400] yfeldblum: hoover_damm, what type of service are you trying to backup?
[2012-10-29 22:36:17 -0400] hoover_damm: yfeldblum, mongo, postgres, files
[2012-10-29 22:36:19 -0400] hoover_damm: at least
[2012-10-29 22:36:43 -0400] yfeldblum: hoover_damm, it don't believe it supports diff backups
[2012-10-29 22:36:58 -0400] yfeldblum: hoover_damm, only full
[2012-10-29 22:36:59 -0400] hoover_damm: yfeldblum, then your likely not talking about the same thing as me
[2012-10-29 22:37:19 -0400] yfeldblum: hoover_damm, well a year ago anyway
[2012-10-29 22:37:26 -0400] hoover_damm: a lot changes in a year
[2012-10-29 22:37:31 -0400] hoover_damm: thanks for sharing though
[2012-10-29 22:37:32 -0400] hoover_damm: :)
[2012-10-29 22:41:42 -0400] matti: crucially: Y0
[2012-10-29 22:42:03 -0400] crucially: yo
[2012-10-29 22:42:30 -0400] matti: On Chef channel?
[2012-10-29 22:42:31 -0400] matti: ;]
[2012-10-29 22:42:40 -0400] yfeldblum: hoover_damm, did it as a chain from data-bag item ---> lwrp ---> backup-config
[2012-10-29 22:42:59 -0400] cheeseplus: crucially: did you ever release the linux tuning cookbooks? *ducks*
[2012-10-29 22:43:15 -0400] crucially: not yet
[2012-10-29 22:43:20 -0400] matti: crucially: Whereabous are you in the US? I will be in CA for a month or so.
[2012-10-29 22:43:29 -0400] crucially: san francisco
[2012-10-29 22:43:39 -0400] matti: I will be in MV.
[2012-10-29 22:43:44 -0400] cheeseplus: cool, just wanted to make sure I didn't miss them
[2012-10-29 22:43:50 -0400] matti: So, getting Caltrain I guess.
[2012-10-29 22:44:06 -0400] rafaelmagu: Question: I've setup a workstation vagrant box I'm gonna distribute internally to other sysadmins
[2012-10-29 22:44:17 -0400] JasonF: matti: if you're going to be in MV, you can probably take an employer-provided bus into SF. haha
[2012-10-29 22:44:24 -0400] matti: crucially: From 12 Nov to mid-december.
[2012-10-29 22:44:38 -0400] matti: JasonF: O?
[2012-10-29 22:44:42 -0400] JasonF: matti: (at least, I've learned to translate "going to mountain view" into "works for big colorful search engine" in my head)
[2012-10-29 22:44:42 -0400] rafaelmagu: And I can't figure out why anytime I do a chef query from capistrano it shows me debug info from the chef query
[2012-10-29 22:44:55 -0400] matti: JasonF: Haha
[2012-10-29 22:45:03 -0400] matti: JasonF: Not quite ;d
[2012-10-29 22:45:46 -0400] rafaelmagu: Did anyone experience that with the latest chef, capistrano and capistrano-chef gems in Linux? http://cl.ly/image/1g2Z0J1c2D2d
[2012-10-29 22:45:51 -0400] matti: I have Google-aversion ;p
[2012-10-29 22:46:04 -0400] matti: It took them 1 year and 3 months to finally admit that my real given name is not a fake.
[2012-10-29 22:46:12 -0400] matti: And unblock / unlock my Google services.
[2012-10-29 22:46:15 -0400] matti: ;d
[2012-10-29 22:47:48 -0400] matti: JasonF: How far away is MV from SF?
[2012-10-29 22:48:50 -0400] ekristen: arg
[2012-10-29 22:50:52 -0400] josephholsten_: jtimberman: http://tickets.opscode.com/browse/COOK-1826
[2012-10-29 22:55:44 -0400] fleish: matti: take the caltrain, it's glorious if you're without car
[2012-10-29 22:57:25 -0400] miah: its also expensive, and slow.
[2012-10-29 22:59:19 -0400] cmceldowney: Hi all--Trying to execute ruby from an external file, but execute it directly inline, as opposed to as a standalone script. e.g. I want access to the node object, and everything else that is loaded in chef run-time, but I want to use an external Ruby file. I've tried block_ruby, but it doesn't appear to actually execute. Should I read in the file using File.open() and then just paste that into the ruby resource to execute?
[2012-10-29 23:02:47 -0400] matti: miah: How expensive?
[2012-10-29 23:03:44 -0400] miah: http://www.caltrain.com/Fares/farechart.html
[2012-10-29 23:04:05 -0400] fleish: slow is all relative, depends on your endpoints, time of day, and which train you catch
[2012-10-29 23:04:24 -0400] fleish: I challenge you to get from redwood city to the core of sf in 23 minutes in rush hour
[2012-10-29 23:04:38 -0400] matti: That's nothing.
[2012-10-29 23:04:49 -0400] matti: Comparing to being stuck in rush hours in London's tube.
[2012-10-29 23:05:24 -0400] fleish: yeah, I wasn't gonna comment on expensive ... it's a drop in the bucket for me, but I'm not one to assume everyone views time value of $ the same
[2012-10-29 23:05:36 -0400] barefoot: challenge you to get anywhere in SF on wednesday
[2012-10-29 23:05:45 -0400] matti: barefoot: Why?
[2012-10-29 23:05:53 -0400] barefoot: big ass parade and stuff
[2012-10-29 23:06:04 -0400] barefoot: for Giants
[2012-10-29 23:06:44 -0400] fleish: yeah, 4 years ago I got stuck downtown after a concert in the rain with recording gear and it took me almost 2 hours to get a cab (and then he tried to drive off because he didn't want to drive to my end of town)
[2012-10-29 23:07:00 -0400] fleish: oh, I figured b/c of halloween ... it's a BIG night in sf
[2012-10-29 23:09:44 -0400] JasonF: matti: about 40m on caltrain if you take some kind of express train
[2012-10-29 23:10:35 -0400] fleish: http://www.caltrain.com/schedules/weekdaytimetable.html
[2012-10-29 23:15:07 -0400] cmceldowney: All: Any way you know of to use external file as source for Ruby code to execute inside a ruby_block?
[2012-10-29 23:16:27 -0400] bluepojo: cmceldowney: technically you can, you can run arbitrary ruby code there
[2012-10-29 23:16:40 -0400] bluepojo: which means you can run that file via an eval or require
[2012-10-29 23:17:13 -0400] bluepojo: cmceldowney: what are you trying to do, though?
[2012-10-29 23:17:19 -0400] cmceldowney: bluepojo: my issue is that I want to be able to access variables set inside the parent cookbook
[2012-10-29 23:17:32 -0400] bluepojo: you might want to make this into a library
[2012-10-29 23:19:03 -0400] cmceldowney: bluepojo: use case is I have a generic before_restart set of functions I want to run, but want to give specific sites overrides. I can maintain separate copies of the entire recipe, or put all of the code (generic + customizations) in the client codebase and just use before_restart's ability to pull from file, but am just looking for another option where I don't have to maintain as much duplicate code.
[2012-10-29 23:20:25 -0400] cmceldowney: bluepojo: e.g. http://pastebin.com/1Mx9uk8Z
[2012-10-29 23:34:51 -0400] maek: jtimberman: ping. you sent me this http://wiki.opscode.com/display/chef/Chef+Configuration+Settings#ChefConfigurationSettings-amqpsettings re splitting up open chef services. anything with chef-expander info?
[2012-10-29 23:39:15 -0400] JasonBox: hrm, just dawned on me that with omnibus, if I need the mysql gem and don't want a compiler I need to build and package the built gem
[2012-10-29 23:40:26 -0400] bluepojo: cmceldowney: you can share libraries across cookbooks
[2012-10-29 23:40:36 -0400] bluepojo: you could make a cookbook that contains a library "BeforeRestart"
[2012-10-29 23:40:37 -0400] maek: as long as you make that cookbook a depends
[2012-10-29 23:40:59 -0400] bluepojo: yeah, put depends "before_restart" or whatever you name the cookbook
[2012-10-29 23:41:12 -0400] erikh: you can't not share libraries across cookbooks
[2012-10-29 23:41:34 -0400] bluepojo: you don't have to do depends?
[2012-10-29 23:41:35 -0400] erikh: if it makes it into your chef run they're evaluated
[2012-10-29 23:41:39 -0400] bluepojo: well yeah
[2012-10-29 23:41:40 -0400] bluepojo: but
[2012-10-29 23:41:43 -0400] bluepojo: if you don't depends
[2012-10-29 23:41:45 -0400] cmceldowney: erikh: that you can do. you simply include the library in the cookbook you want to reference it from. you do have to do depends
[2012-10-29 23:41:47 -0400] bluepojo: it's not garanteed to be in your chef run
[2012-10-29 23:41:57 -0400] cmceldowney: bluepojo: library does not match my use case.
[2012-10-29 23:42:14 -0400] bluepojo: cmceldowney: I'm not sure that's true it's shared code that all your recipes need
[2012-10-29 23:42:17 -0400] erikh: I'm not sure if chef 10 still has the bug where libraries don't get reloaded when they're changed during a converge
[2012-10-29 23:42:18 -0400] bluepojo: libraries are generic ruby scripts
[2012-10-29 23:42:24 -0400] erikh: used to get us all the time on chef 9
[2012-10-29 23:42:31 -0400] erikh: (you have to restart chef-client to fix it)
[2012-10-29 23:42:51 -0400] bluepojo: erikh: like if you bump a cookbook version and it has a new library verison
[2012-10-29 23:42:53 -0400] bluepojo: version
[2012-10-29 23:43:00 -0400] bluepojo: you have to bounce chef-client to get it to pick up the new one?
[2012-10-29 23:43:11 -0400] erikh: if you change the library period
[2012-10-29 23:43:18 -0400] erikh: it'll change in the cache and never get re-evaluated
[2012-10-29 23:43:25 -0400] bluepojo: even if it's a new cookbook version?
[2012-10-29 23:43:29 -0400] erikh: not sure
[2012-10-29 23:43:37 -0400] bluepojo: I think that might happen if you overwrite cookbooks
[2012-10-29 23:43:38 -0400] bluepojo: but
[2012-10-29 23:43:48 -0400] bluepojo: you're doing it wrong if you're overwriting cookbooks with the same version
[2012-10-29 23:44:48 -0400] cmceldowney: bluepojo: I really want to include a ruby file from the file system. this would meet my needs 100% but am having trouble finding a way to do this. I have multiple clients, each using the same version of my chef repo, but with separate chef servers for each one. I just need to override a small portion of the before_restart behavior for each client. So I could use external file and simply copy the generic logic to each one and then ad
[2012-10-29 23:44:48 -0400] cmceldowney: any customizatios, but then I have a bunch of copies of the same logic. So I just want to add an optional override file-- it seems to me that pulling it in from an external file would be the cleanest possible way to handle this
[2012-10-29 23:45:07 -0400] bluepojo: oh my.
[2012-10-29 23:45:11 -0400] erikh: I disagree; versions are basically useless in chef 9 unless you're releasing them
[2012-10-29 23:45:47 -0400] bluepojo: erikh: fair enough, environments were a much needed improvement on that front
[2012-10-29 23:45:53 -0400] bluepojo: with version locks
[2012-10-29 23:46:04 -0400] erikh: and as for imposed workflow and "best practices", well, I'll spare you an earful
[2012-10-29 23:46:35 -0400] bluepojo: feel free next time we grab a beer :P
[2012-10-29 23:46:39 -0400] erikh: haha
[2012-10-29 23:46:51 -0400] cmceldowney: erikh: in my use case with libraries, I have Crifkin cookbook with utility.rb library defined. then in several supporting cookbooks I make sure to "depends crifkin" in metadata.rb, then use this to bring in my library's functions: class Chef::Recipe
[2012-10-29 23:46:51 -0400] cmceldowney:   include CrifkinUtility
[2012-10-29 23:46:52 -0400] cmceldowney: end
[2012-10-29 23:47:14 -0400] erikh: that's the right way to do it
[2012-10-29 23:47:23 -0400] erikh: well, other than monkeypatching Chef::Recipe
[2012-10-29 23:47:29 -0400] erikh: if you can avoid doing that, probably best.
[2012-10-29 23:47:50 -0400] bluepojo: yeah, you can just depends "my_cookbook" then use any libraries defined in that cookbook in your recipes
[2012-10-29 23:48:00 -0400] bluepojo: anything customized for that cookbook should be passed in as parameters
[2012-10-29 23:48:01 -0400] cmceldowney: erikh: ahh.. your comment above had a double negative.. "you can't not share..." hence my confusion.
[2012-10-29 23:48:26 -0400] bluepojo: he was reinforcing that sharing libraries happens by default
[2012-10-29 23:48:32 -0400] bluepojo: if the cookbook is used at all
[2012-10-29 23:48:43 -0400] cmceldowney: bluepojo: ya. stupid double negatives. (sigh)
[2012-10-29 23:48:48 -0400] bluepojo: haha
[2012-10-29 23:49:04 -0400] bluepojo: perhaps: you can't prevent sharing libraries
[2012-10-29 23:49:08 -0400] erikh: you can't.
[2012-10-29 23:49:12 -0400] erikh: it's a single ruby process.
[2012-10-29 23:49:15 -0400] bluepojo: right
[2012-10-29 23:49:27 -0400] erikh: so, here's what I do
[2012-10-29 23:49:35 -0400] erikh: which may or may not be a good idea for your use case
[2012-10-29 23:49:58 -0400] erikh: https://gist.github.com/50694288fca7402bea10
[2012-10-29 23:50:09 -0400] erikh: then I call this in the recipe with IPCalculator.primary_ip(node)
[2012-10-29 23:50:30 -0400] erikh: more wordy, but extremely decoupled, and more resilient
[2012-10-29 23:51:07 -0400] erikh: that and the side effect of how that works is that it works on search query results too.
[2012-10-29 23:52:06 -0400] cmceldowney: erikh: heh. for my vagrant runs, I simply export the vagrant IP in my Vagrantfile into the same spot as where ec2 would put it, e.g. http://pastebin.com/t3QZbdPH
[2012-10-29 23:53:06 -0400] erikh: this involves zero manual intervention
[2012-10-29 23:53:20 -0400] erikh: the recipe doesn't care what ip it's dealing with
[2012-10-29 23:56:56 -0400] cmceldowney: erikh: but does require more processing when doing chef runs
[2012-10-29 23:57:20 -0400] erikh: that data is already ther.
[2012-10-29 23:57:29 -0400] erikh: unless you count walking a few hashes "more processing"
[2012-10-29 23:57:56 -0400] cmceldowney: erikh: what's a few hashes between friends, ya?
[2012-10-29 23:58:14 -0400] erikh: it's probably not where your chef run slows down :)
[2012-10-29 23:59:01 -0400] cmceldowney: erikh: I'm the guy who gets on people for using print instead of echo in PHP. and pretty new to ruby/chef, so I tend to try to keep things simple whereever possible, but yes, your point is well-taken
