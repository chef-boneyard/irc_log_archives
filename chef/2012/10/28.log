[2012-10-28 02:43:18 -0400] fleish: anyone around familiar with knife openstack?
[2012-10-28 04:17:56 -0400] j-v-e: any chefers on a late saturday night ?
[2012-10-28 04:31:48 -0400] dschultz_: Late night "chefer" here...
[2012-10-28 04:36:09 -0400] j-v-e: I thought I had spotted a bug in 10.16, but it looks like it's my code :)
[2012-10-28 04:38:13 -0400] j-v-e: interesting
[2012-10-28 04:38:19 -0400] j-v-e: I have a search taht returns this
[2012-10-28 04:38:20 -0400] j-v-e: chef > s_results = Chef::Search::Query.new.search(:node,"roles:base_api_loadbalancer").first
[2012-10-28 04:38:20 -0400] j-v-e:  => [nil, nil, nil, nil, nil, nil, nil, nil]
[2012-10-28 04:38:50 -0400] j-v-e: my first question would be:what the heck is that response ?
[2012-10-28 04:39:49 -0400] j-v-e: my second question would be: How do I test this to make sure it doesn't break my recipe ?
[2012-10-28 04:43:10 -0400] dschultz_: Honestly, I can't answer your question without doing some source-diving. I've yet to upgrade to 10.16, myself. I am getting the correct search output on my end (v10.14.4)...
[2012-10-28 04:43:48 -0400] dschultz_: Tried debuggind in Shef?
[2012-10-28 04:44:08 -0400] dschultz_: *debugging
[2012-10-28 04:44:13 -0400] j-v-e: I can do that
[2012-10-28 04:44:14 -0400] hoover_damm: j-v-e, nil? that's normal
[2012-10-28 04:44:14 -0400] j-v-e:         s_results = Chef::Search::Query.new.search(:node, search_string).first
[2012-10-28 04:44:14 -0400] j-v-e:         if s_results.first.nil?
[2012-10-28 04:44:20 -0400] hoover_damm: j-v-e, .compact
[2012-10-28 04:44:21 -0400] j-v-e: but that's rather ugly
[2012-10-28 04:44:29 -0400] hoover_damm: ;)
[2012-10-28 04:44:42 -0400] j-v-e: hoover_damm: .compact ?
[2012-10-28 04:45:21 -0400] j-v-e: interesting
[2012-10-28 04:45:32 -0400] hoover_damm: nothing new
[2012-10-28 04:45:39 -0400] hoover_damm: just a ruby wat
[2012-10-28 04:46:25 -0400] j-v-e: eh
[2012-10-28 04:46:44 -0400] hoover_damm: chef > s_results = Chef::Search::Query.new.search(:node,"roles:raid-test2").class => Array
[2012-10-28 04:47:06 -0400] hoover_damm: basically it's an array, you need to compact it and then produce the first result
[2012-10-28 04:47:14 -0400] hoover_damm: chef > s_results = Chef::Search::Query.new.search(:node,"roles:raid-test2") => [[], 0, 0]
[2012-10-28 04:47:44 -0400] hoover_damm: that's empty there, but basically toss a .compact on it and it should look right
[2012-10-28 04:47:55 -0400] j-v-e: I did. it does.
[2012-10-28 04:48:08 -0400] j-v-e: thanks for the fix hoover_damm :)
[2012-10-28 04:48:10 -0400] hoover_damm: you can get the same result if you use .map :)
[2012-10-28 04:48:20 -0400] hoover_damm: you don't want to know how I knew that.
[2012-10-28 04:48:32 -0400] dschultz_: haha
[2012-10-28 04:48:33 -0400] dschultz_: nice
[2012-10-28 04:49:25 -0400] hoover_damm: old job we did weird stuff with chef... tossed a lot of stuff in the node tree
[2012-10-28 04:49:51 -0400] hoover_damm: so a lot of the time I spent time with pure ruby .map and other things to reduce and get what I want
[2012-10-28 04:50:09 -0400] hoover_damm: 10,000 node entries ain't nothing
[2012-10-28 04:50:11 -0400] hoover_damm: lol
[2012-10-28 04:50:24 -0400] j-v-e: yeah, we're starting to feel that too
[2012-10-28 04:50:37 -0400] j-v-e: returning all of the attributes of all the nodes is starting to be painful
[2012-10-28 04:50:41 -0400] hoover_damm: basically it helps to have good ruby-fu
[2012-10-28 04:50:45 -0400] hoover_damm: not excellent
[2012-10-28 04:51:06 -0400] dschultz_: *working on his ruby-fu
[2012-10-28 04:51:35 -0400] hoover_damm: well the more you know about ruby, the more you know how to manipulate data in it... the more you can do with chef
[2012-10-28 04:51:46 -0400] j-v-e: I definitely learned a lot while writing afw. still a long way to go though
[2012-10-28 04:51:57 -0400] hoover_damm: which is where the learning curve generally comes in from
[2012-10-28 04:52:22 -0400] hoover_damm: yeah thank you for that
[2012-10-28 04:52:25 -0400] hoover_damm: we tore it up and enjoyed it
[2012-10-28 04:52:37 -0400] j-v-e: tore it up ?
[2012-10-28 04:53:11 -0400] retr0h: jess feelin better?
[2012-10-28 04:53:17 -0400] retr0h: bleh.. wrong window ;P
[2012-10-28 04:54:36 -0400] j-v-e: hoover_damm: I see you've worked on diamond. did you get the network collector to work properly ?
[2012-10-28 04:55:01 -0400] j-v-e: I took a quick look at it, and it seems to be returning bogus results, due to the conversion from bytes to bits
[2012-10-28 05:37:24 -0400] hoover_damm: j-v-e, :) yep
[2012-10-28 05:37:44 -0400] hoover_damm: j-v-e, basically the lwrp makes deployment of Diamond extremely trivial... because collectors (plugins) are everything
[2012-10-28 05:38:00 -0400] hoover_damm: i wouldn't be shocked if people just load the lwrp and use shef to deploy diamond
[2012-10-28 05:38:29 -0400] hoover_damm: we use it for graphite (obv) but it has uses beyond graphite
[2012-10-28 05:39:01 -0400] hoover_damm: j-v-e, we took the basic recipe and molded it into our iptables cookbook
[2012-10-28 05:39:38 -0400] hoover_damm: j-v-e, one of our devops guys need inspiration :)
[2012-10-28 05:40:30 -0400] hoover_damm: my diamond cookbook is still too opinionated
[2012-10-28 05:40:36 -0400] hoover_damm: i need to take off a few layers of opinions
[2012-10-28 08:29:09 -0400] intinig: hello all
[2012-10-28 08:29:35 -0400] intinig: a conceptual question: once you have some servers set up with chef, is it better to deploy via chef or keep using capistrano?
[2012-10-28 08:30:08 -0400] intinig: I mean, not strictly better per se, just wondering what the best practice was
[2012-10-28 09:12:10 -0400] intinig: is there any env variable I can use to force chef to read configuration files from somewhere other than the default places or the current directory?
[2012-10-28 10:24:24 -0400] intinig: hello all
[2012-10-28 10:25:06 -0400] intinig: I have a generic recipe to define apache vhosts, and I want roles to supply it the correct vhost information. Is it possible?
[2012-10-28 15:11:06 -0400] ShawnMcCool_: ok, sort of a dumb question. but, i have a recipe that creates a directory, and i need to tell vagrant to mount it as a shared folder, using config.vm.share_folder but when i do it, it doesn't seem to wait until the point in the provisioning that the directory is created
[2012-10-28 15:46:39 -0400] j-v-e: hoover_damm: that's cool that you were able to reuse piece of it. I'd be curious to see how you designed yours. AFW is very opinionated, lots of it could use external comments.
[2012-10-28 15:49:48 -0400] j-v-e: I'm getting paged because chef-client is eating all the memory on our VMs :(
[2012-10-28 15:49:59 -0400] j-v-e: restarting chef-client every 2 days sucks...
[2012-10-28 15:59:13 -0400] j-v-e: looks like our massive use of searches in recipes doesn't play well with chef-client. Is there a way to improve the garbage collection ?
[2012-10-28 16:00:58 -0400] yfeldblum: j-v-e, configure chef-client to fork?
[2012-10-28 16:02:50 -0400] dschultz|away: I heard compacting couchdb can help in relation to searches, if that helps.
[2012-10-28 16:03:00 -0400] j-v-e: yfeldblum: is there a wiki page on how to configure chef-client correctly ?
[2012-10-28 16:03:23 -0400] j-v-e: dschultz_: isn't that done by the chef server automatically ?
[2012-10-28 16:04:24 -0400] dschultz_: j-v-e: Not that I'm aware of, at least on Open Source Chef. Someone please correct me if I'm wrong.
[2012-10-28 16:04:37 -0400] dschultz_: Just what I heard, then read about at the Summit
[2012-10-28 16:04:48 -0400] yfeldblum: j-v-e, https://github.com/opscode/chef/blob/10.16.2/chef/lib/chef/application/client.rb#L173-177
[2012-10-28 16:05:48 -0400] yfeldblum: j-v-e, that option should be useful with a daemonized chef-client
[2012-10-28 16:06:43 -0400] yfeldblum: dschultz, it may be present in earlier releases too; i just like to paste links to tagged-and-released files only, and that's the latest release tag
[2012-10-28 16:06:46 -0400] j-v-e: yfeldblum: I'll try that, thanks :)
[2012-10-28 16:06:49 -0400] dschultz_: Can you elaborate a little on what the fork option does? Are chef-clients aren't daemonized (yet)
[2012-10-28 16:07:10 -0400] yfeldblum: dschultz, haven't tried it myself
[2012-10-28 16:07:35 -0400] dschultz_: nphase, just means more source-diving for me. That's how I've learned so far
[2012-10-28 16:07:42 -0400] dschultz_: *np
[2012-10-28 16:07:47 -0400] dschultz_: Ugh, need coffee
[2012-10-28 16:10:40 -0400] dschultz_: yfeldblum: Thanks for that link
[2012-10-28 16:16:18 -0400] j-v-e: dschultz_: fyi, I just ran the compaction on our open source chef server, and it didn't reduce the number of documents in couchdb. So I'm guessing it runs on a regular basis by default
[2012-10-28 16:17:12 -0400] dschultz_: j-v-e: http://wiki.opscode.com/display/chef/CouchDB+Administration+for+Chef+Server
[2012-10-28 16:17:21 -0400] dschultz_: Was just reading that myself
[2012-10-28 16:18:18 -0400] dschultz_: But it requires the chef-server cookbook? Hmm
[2012-10-28 16:19:33 -0400] j-v-e: yeah, we don't use that yet. that's a project.
[2012-10-28 16:21:52 -0400] dschultz_: j-v-e: Now that the caffeine is kicking in, I think I recall compaction being useful when your chef-client runs are taking an extended amount of time. So, perhaps not related to searches.
[2012-10-28 16:23:49 -0400] j-v-e: for view in nodes roles registrations clients data_bags data_bag_items users checksums cookbooks sandboxes environments id_map ; do curl -H "Content-Type: application/json" -X POST http://localhost:5984/chef/_compact/$view ; done
[2012-10-28 16:23:56 -0400] j-v-e: we'll see if that helps :)
[2012-10-28 16:28:18 -0400] j-v-e: rabbitmq on chef server has almost 3,000 queued messages... that should be zero
[2012-10-28 16:28:58 -0400] j-v-e: the compaction didn't have a significant impact
[2012-10-28 16:38:33 -0400] j-v-e: Can upgrading chef from 10.4 to 10.16 have any side effect ? or is it all backward compatible ?
[2012-10-28 16:38:38 -0400] dschultz_: j-v-e: I wonder it's related to chef-expander? This is getting a little beyond my knowledge.
[2012-10-28 16:41:38 -0400] j-v-e: yeah, it looks like message are added to the queue, but dequeued very slowly... I'm looking at tuning parameters now
[2012-10-28 16:41:44 -0400] dschultz_: j-v-e: There shouldn't be any [negative] side effects as it isn't a major version upgrade.
[2012-10-28 16:44:48 -0400] j-v-e: chef-expanderctl queue-depth is hanging...
[2012-10-28 16:44:49 -0400] j-v-e: nice
[2012-10-28 16:47:16 -0400] dschultz_: j-v-e: Try increasing the number of workers? Haven't tested myself, but seems like that should help.
[2012-10-28 16:47:59 -0400] j-v-e: yeah, I'm setting it to 5
[2012-10-28 16:48:19 -0400] dschultz_: sweet
[2012-10-28 16:51:25 -0400] j-v-e: merb : chef-server (api) : worker (port 4005) ~ undefined method `closed?' for nil:NilClass - (NoMethodError)
[2012-10-28 16:51:31 -0400] j-v-e: that's from server.log
[2012-10-28 16:51:37 -0400] j-v-e: maybe I should upgrade to ruby1.9....
[2012-10-28 16:55:15 -0400] dschultz_: j-v-e: That's odd. Did you restart any services? You shouldn't have to upgrade Ruby... Are you on 1.8?
[2012-10-28 16:55:39 -0400] j-v-e: yep
[2012-10-28 16:55:45 -0400] j-v-e: ubuntu lucid's default
[2012-10-28 16:56:00 -0400] j-v-e: I'm looking into upgrading chef itself first, we use opscode's apt repo
[2012-10-28 16:57:20 -0400] j-v-e: or maybe not
[2012-10-28 16:57:28 -0400] j-v-e: looks like it was installed using gems...
[2012-10-28 16:59:00 -0400] dschultz_: Does `gem env` point to the right executable path for Ruby?
[2012-10-28 16:59:36 -0400] j-v-e:   - RUBY EXECUTABLE: /usr/bin/ruby1.8
[2012-10-28 16:59:37 -0400] j-v-e: yep
[2012-10-28 17:00:01 -0400] ashb: its /sb end
[2012-10-28 17:00:08 -0400] ashb: <-- hero
[2012-10-28 17:03:44 -0400] j-v-e: updating all the gems, looks like bunny and the amqp libs have newer versions
[2012-10-28 17:22:27 -0400] j-v-e: erk. what the heck is that https://gist.github.com/8db94ccfa608071e790b
[2012-10-28 17:22:34 -0400] j-v-e: uninitialized constant AMQ::Client::VERSION
[2012-10-28 17:24:41 -0400] dschultz_: j-v-e: Do you cleanup the old gems? Looks like a conflict with the amqp gem?
[2012-10-28 17:25:38 -0400] dschultz_: Just an idea, not sure if that's the actual issue...
[2012-10-28 17:27:26 -0400] j-v-e: trying that
[2012-10-28 17:44:59 -0400] ssd7: Ohai Chefs
[2012-10-28 17:47:48 -0400] dschultz_: Ohai
[2012-10-28 17:49:26 -0400] ssd7: j-v-e: :(
[2012-10-28 17:49:30 -0400] dschultz_: j-v-e: You can always uninstall the current version and install the version you had prior to upgrade
[2012-10-28 17:49:38 -0400] dschultz_: It's a pain
[2012-10-28 17:50:07 -0400] j-v-e: I'm installing both in parallel. ruby should be able to find the one it needs
[2012-10-28 17:53:25 -0400] j-v-e: gem's slowness reminds me of yum in the old days
[2012-10-28 17:55:31 -0400] dschultz_: agreed
[2012-10-28 18:00:31 -0400] dschultz_: j-v-e: Sorry I couldn't be of more help. Perhaps you've hit a bug in 10.16?
[2012-10-28 18:00:44 -0400] julien_: Hello. We're trying to deploy our nodes application with chef. We created cookbook based on 'application', but we're not sure how to run the script that will install the dependencies of our apps "npm install". Anyone has a clue? We tried using migration_command, but that doesn't seem to work.
[2012-10-28 18:04:38 -0400] julien_: anyone?
[2012-10-28 18:05:43 -0400] j-v-e: dschultz_: yeah, I'm still getting this one https://gist.github.com/8db94ccfa608071e790b (the AMQP version stuff)
[2012-10-28 18:05:55 -0400] j-v-e: I should probably file a bug report about it
[2012-10-28 18:07:00 -0400] j-v-e: it seems to be running correctly though
[2012-10-28 18:07:10 -0400] dschultz_: j-v-e: Yeah, I'd file a ticket. Sorry, busy watching football *Sacred Sunday's*
[2012-10-28 18:07:29 -0400] j-v-e: ha. fail
[2012-10-28 18:07:35 -0400] j-v-e: chef-client returns this
[2012-10-28 18:07:36 -0400] j-v-e: [2012-10-28T18:07:19+00:00] INFO: HTTP Request Returned 500 Internal Server Error: uninitialized constant AMQ::Client::VERSION
[2012-10-28 18:08:10 -0400] dschultz_: j-v-e: To confirm: The error occurred after increasing the worker processes for chef-expander?
[2012-10-28 18:08:46 -0400] dschultz_: j-v-e: Ewww. Um, that's not good. You revert to old version of gems?
[2012-10-28 18:08:48 -0400] j-v-e: no
[2012-10-28 18:09:01 -0400] j-v-e: this error is on chef-server's side
[2012-10-28 18:09:43 -0400] j-v-e: I reinstalled the gems needed by chef-server, it doesn't start unless it find specific versions
[2012-10-28 18:10:15 -0400] j-v-e: namely: amqp 0.6.7 and bunny 0.6.0
[2012-10-28 18:10:24 -0400] dschultz_: understood
[2012-10-28 18:11:05 -0400] j-v-e: I'll try to downgrade amq-client too
[2012-10-28 18:13:00 -0400] dschultz_: Crap, I've only been working w/ Chef for 5 months. I'm not as well versed as others in this channel :(
[2012-10-28 18:13:40 -0400] j-v-e: eh :) no worries. I'm mainly posting stuff here in case one of the chef guy is hanging around and knows how to fix the issue
[2012-10-28 18:18:39 -0400] dschultz_: These sort of issues should go to the mailing list and/or JIRA. This way the whole community is aware and can maybe learn something. I learned a few things just trying to help a brotha out :)
[2012-10-28 18:24:11 -0400] j-v-e: Aye. but mailing lists are too slow. this is our production server that I just broke :)
[2012-10-28 18:25:22 -0400] j-v-e: I fixed it
[2012-10-28 18:25:37 -0400] j-v-e: I removed amq-client-0.9.5 amqp-0.9.8
[2012-10-28 18:25:44 -0400] j-v-e: versioning ftw
[2012-10-28 18:33:11 -0400] dschultz_: right on
[2012-10-28 19:56:26 -0400] hoover_damm: yep yep
[2012-10-28 19:56:30 -0400] hoover_damm: less to care about
[2012-10-28 20:33:48 -0400] letomuaddib: hi, I have a problem with the postgres cookbook and Vagrant, setting up an Ubuntu box
[2012-10-28 20:34:21 -0400] letomuaddib: more precisely it looks like when vagrant is modifying templates (postgresql.conf and pg_hba.conf) it does not set the owner to postgres:postgres but to vagrant:vagrant
[2012-10-28 20:34:27 -0400] letomuaddib: any reason why that would be?
[2012-10-28 20:34:43 -0400] letomuaddib: weird thing is I see in the log that it's stating having changed the owner and the group to the proper ones for postgres
[2012-10-28 20:35:08 -0400] letomuaddib: but then the restart of the service fails and if I SSH into the machine I see that vagrant is owner of the files modified, not postgres
[2012-10-28 20:35:21 -0400] letomuaddib: if anyone can shed any kind of light on this I would greatly appreciate it
