[2012-03-09 08:35:00 -0500] miah: so many yawns
[2012-03-09 08:40:00 -0500] royh: goor morning eurochefs!
[2012-03-09 08:40:00 -0500] royh: s/goor/good/
[2012-03-09 08:40:00 -0500] royh: if only i could spell...
[2012-03-09 08:40:00 -0500] royh: ^^
[2012-03-09 08:43:00 -0500] us3r777: Hi
[2012-03-09 08:44:00 -0500] us3r777: I have a problem while boostrapping a rackspace server with chef, does someone want to help me ?
[2012-03-09 08:46:00 -0500] lflux: ohai
[2012-03-09 08:47:00 -0500] nico: moin chefs
[2012-03-09 08:51:00 -0500] royh: us3r777: just ask, don't ask to ask
[2012-03-09 08:56:00 -0500] us3r777: Bootstrapping Chef on *****.static.cloud-ips.com
[2012-03-09 08:56:00 -0500] us3r777: ERROR: Network Error: getaddrinfo: Name or service not known
[2012-03-09 08:56:00 -0500] us3r777: Check your knife configuration and network settings
[2012-03-09 08:57:00 -0500] us3r777: While trying to bootstrap a centos5 on rackspace with bootstrap/centos5-gems
[2012-03-09 08:59:00 -0500] royh: us3r777: what's the hostname?
[2012-03-09 08:59:00 -0500] erikh: more accurately; does 'host <hostname>' yield anything?
[2012-03-09 09:23:00 -0500] us3r777: The hostname on the created server is slice10121852
[2012-03-09 09:23:00 -0500] us3r777: The Chef server doesn't create any node
[2012-03-09 09:25:00 -0500] royh: so what host did you give chef to bootstrap on?
[2012-03-09 09:28:00 -0500] us3r777: knife rackspace server create -I 114 -f 4 -r 'role[SomeRole]' -N SomeName -d centos5-gems -V
[2012-03-09 09:28:00 -0500] us3r777: $ssh root@31-222-170-37.static.cloud-ips.com
[2012-03-09 09:28:00 -0500] us3r777: ssh: Could not resolve hostname 31-222-170-37.static.cloud-ips.com: Name or service not known
[2012-03-09 09:28:00 -0500] us3r777: $ ssh root@31.222.170.37
[2012-03-09 09:28:00 -0500] us3r777: root@31.222.170.37's password:
[2012-03-09 09:29:00 -0500] us3r777: It seems that the public dns rackspace gives isn't reachable
[2012-03-09 09:29:00 -0500] royh: yeah
[2012-03-09 09:30:00 -0500] us3r777: Can i tell to chef to bootstrap on the public ip and not on the dns ?
[2012-03-09 09:32:00 -0500] royh: us3r777: you'll want a fqdn
[2012-03-09 09:33:00 -0500] us3r777: How can i get it
[2012-03-09 09:33:00 -0500] royh: you can create it yourself
[2012-03-09 09:33:00 -0500] us3r777: So i can't create and bootstrap and deploy a server on a single line
[2012-03-09 09:33:00 -0500] royh: just create a hostname for your server like myhost.example.com and use that
[2012-03-09 09:33:00 -0500] us3r777: like i do with amazon
[2012-03-09 12:30:00 -0500] kreedy: installing packages via chef doesn't seem to respect my apt pinning rules already in place. any one have any ideas?
[2012-03-09 13:20:00 -0500] kreedy: gah it looks like since chef is specifying the version number, it just goes with the first instance of that version number in apt-cache policy
[2012-03-09 13:20:00 -0500] kreedy: so in this case ignoring priority
[2012-03-09 13:52:00 -0500] kreedy: anyone know if you can have chef explicitly not put a version number into apt-get when install a package? it's breaking apt-pinning
[2012-03-09 14:03:00 -0500] workmad3: kreedy: have you tried action :upgrade instead of action :install ?
[2012-03-09 14:04:00 -0500] kreedy: i haven't. i'll give that a shot
[2012-03-09 14:19:00 -0500] kreedy: looks like upgrade just inherits from install http://rubydoc.info/gems/chef/0.10.4/Chef/Provider/Package/Apt#upgrade_package-instance_method
[2012-03-09 15:15:00 -0500] ssd7: Ohai Chefs!
[2012-03-09 15:17:00 -0500] BryanWB: good monring!
[2012-03-09 15:36:00 -0500] bkocik: I finally got my Chef::Recipe::Utilities.private_ip library function working in a recipe. I needed "depends 'utils'" in the metadata for the cookbook that was using it.
[2012-03-09 15:37:00 -0500] bkocik: The documentation on libraries kind of implies that you don't. Or, at least doesn't mention that you do.
[2012-03-09 15:47:00 -0500] jtimberman: whos brilliant fucking idea was it to change the primary hostname for the EPEL download site? and how hard is it to make a CNAME?
[2012-03-09 15:47:00 -0500] geekbri: jtimberman: youre aws cookbook is awesome jsut fyi.
[2012-03-09 15:47:00 -0500] jtimberman: geekbri: thanks :)
[2012-03-09 15:48:00 -0500] geekbri: heh they really changed the epel download site? thats pretty funny / a terrible idea
[2012-03-09 15:48:00 -0500] jtimberman: they make it redirect
[2012-03-09 15:48:00 -0500] geekbri: oh, 302 ?
[2012-03-09 15:50:00 -0500] jtimberman: yeah 302
[2012-03-09 15:50:00 -0500] proffalken: jtimberman: I can't see any refs to the change on "announce" either...
[2012-03-09 15:50:00 -0500] jtimberman: proffalken: not that i would even know
[2012-03-09 15:50:00 -0500] jtimberman: since i don't pay attention to the project at all :)
[2012-03-09 15:56:00 -0500] Brad_K: well, i'm glad to hear the news about the OS we depend on from someone who doesn't pay any attention to the project at all.  at least you're looking out for our interests.
[2012-03-09 15:56:00 -0500] jtimberman: Brad_K: ;p
[2012-03-09 15:56:00 -0500] jtimberman: Brad_K: you didn't know either?
[2012-03-09 15:56:00 -0500] Brad_K: nope.
[2012-03-09 15:57:00 -0500] Brad_K: i'm poking some people about it, though.
[2012-03-09 15:57:00 -0500] jtimberman: yay :)
[2012-03-09 15:57:00 -0500] hoover_damm: friends don't let friends run centos
[2012-03-09 15:57:00 -0500] Brad_K: they just released centos 5.8, and at least report they had over 4000 remote sites connected to the main mirror servers, of which at least 1900+ were private mirrors.
[2012-03-09 15:58:00 -0500] Brad_K: and all the main mirror servers were totally maxed out at 100Mbps.
[2012-03-09 15:58:00 -0500] Brad_K: jtimberman: what's the exact url that 302s for you?
[2012-03-09 15:59:00 -0500] geekbri: Centos isn't so bad, I still manage a couple physical boxes runnin git.
[2012-03-09 15:59:00 -0500] Brad_K: some of us in the business world don't have a choice.
[2012-03-09 15:59:00 -0500] jtimberman: Brad_K: https://gist.github.com/2007237
[2012-03-09 15:59:00 -0500] jtimberman: Brad_K: /pub is a 404
[2012-03-09 16:00:00 -0500] Brad_K: great.  i'll pass this on.
[2012-03-09 16:00:00 -0500] jtimberman: thanks
[2012-03-09 16:00:00 -0500] jtimberman: :D
[2012-03-09 16:00:00 -0500] jtimberman: i'm find using dl.fedoraproject.org
[2012-03-09 16:00:00 -0500] jtimberman: for my purposes, *I* just want yum::epel recipe to grab the right thing.
[2012-03-09 16:00:00 -0500] jtimberman: which is the rpm
[2012-03-09 16:00:00 -0500] jtimberman: :)
[2012-03-09 16:02:00 -0500] Brad_K: i now provide the rpm for the repo myself, via cookbook_file.  from there, it can always contact the right mirrors for the most up-to-date version of that rpm.
[2012-03-09 16:03:00 -0500] Brad_K: anyway, now talking to Phibs & mdomsch on #centos-mirror.  hopefully they'll be able to get this resolved relatively quickly.
[2012-03-09 16:07:00 -0500] jtimberman: ...hope they don't break that it is working with dl.fedoraproject.org
[2012-03-09 16:08:00 -0500] jtimberman: https://gist.github.com/2007270
[2012-03-09 16:09:00 -0500] geekbri: Can you not use json [] in role files ?
[2012-03-09 16:09:00 -0500] Brad_K: jtimberman: turns out that this 302 redirection is actually the normal behaviour.  in fact, if you look at .../yum/recipes/epel.rb on lines 23 and 24, you'll see this comment:
[2012-03-09 16:09:00 -0500] Brad_K: # If rpm installation from a URL supported 302's, we'd just use that.
[2012-03-09 16:09:00 -0500] Brad_K: # Instead, we get to remote_file then rpm_package.
[2012-03-09 16:09:00 -0500] Brad_K: so, it seems like this 302 redirection behaviour is normal and has been expected for a while, because that's from the stock yum cookbook.
[2012-03-09 16:10:00 -0500] jtimberman: pretty sure this wasn't retrieving the package at all for me yesterday
[2012-03-09 16:10:00 -0500] jtimberman: i didn't have time to debug it
[2012-03-09 16:10:00 -0500] Brad_K: if you get a 302 redirect to a different site every time, "that means there is no single or set of mirrors that has declared your IP address as being "best" sent to them."
[2012-03-09 16:11:00 -0500] Brad_K: if you get a 302 redirect to the same site every time, that means that the mirror in question has listed your netblock as being best directed to them, presumably because it's closest/fastest for those customers.
[2012-03-09 16:11:00 -0500] ryan-roemer: Hi Folks, I've been googling around for a while and can't come up with a succinct answer  what's the canonical way to switch to Ruby 1.9 from 1.8.7 for my chef client servers?  Ideally I'd like a simple base role recipe to fix existing clients and work going forward on new servers...
[2012-03-09 16:12:00 -0500] ryan-roemer: Use case  I'm trying to use the elasticsearch_cluster cookbook from the community install, and one of its deps has ruby 1.9-ish syntax, breaking everything...
[2012-03-09 16:12:00 -0500] hoover_damm: ryan-roemer, I moved one of my clients from 1.8.7 to 1.9.3 via omnibus
[2012-03-09 16:13:00 -0500] Brad_K: my recollection is that the Full Stack Installer will give you ruby 1.8.7 for use with chef and all your cookbooks, so that wouldn't resolve this issue.
[2012-03-09 16:13:00 -0500] hoover_damm: it was really great
[2012-03-09 16:14:00 -0500] hoover_damm: he's using it for system ruby actually as well
[2012-03-09 16:14:00 -0500] jtimberman: fuuuuuuuuuuuuuuuuuuuuuuuu
[2012-03-09 16:14:00 -0500] hoover_damm: omnibus doesn't currently give you 1.9.3, I submitted a pull
[2012-03-09 16:14:00 -0500] jtimberman: now download.fedoraproject works.
[2012-03-09 16:14:00 -0500] hoover_damm: but well it got closed as they're taking omnibus rom clojure
[2012-03-09 16:14:00 -0500] jtimberman: how does the internet work
[2012-03-09 16:15:00 -0500] hoover_damm: from clojure to ruby
[2012-03-09 16:15:00 -0500] Brad_K: if the elasticsearch_cluster cookbook requires ruby 1.9.x, that would seem to me to be mutually incompatible with most chef installs.
[2012-03-09 16:15:00 -0500] hoover_damm: so my pull request was invalid
[2012-03-09 16:15:00 -0500] hoover_damm: :(
[2012-03-09 16:15:00 -0500] hoover_damm: but your free to checkout github.com/damm/omnibus it's in a branch
[2012-03-09 16:15:00 -0500] hoover_damm: and build it yourself and make your own debs
[2012-03-09 16:15:00 -0500] ryan-roemer: If it helps, I am only using Ruby for chef  none of my apps use it, so I don't have any outside concerns.  I'm just trying to figure out if it's easiest to find and patch the deps to 1.8.7 or upgrade my clients to 1.9
[2012-03-09 16:16:00 -0500] Brad_K: jtimberman: maybe you were being redirected to a mirror that was actually broken?
[2012-03-09 16:16:00 -0500] hoover_damm: omnibus is totally easier
[2012-03-09 16:16:00 -0500] hoover_damm: for my client he just had to re-bootstrap his nodes to goto 1.9.3
[2012-03-09 16:16:00 -0500] hoover_damm: and then remove the old system ruby when he was ready
[2012-03-09 16:16:00 -0500] jtimberman: Brad_K: possible?
[2012-03-09 16:16:00 -0500] jtimberman: people rely on this stuff though?
[2012-03-09 16:17:00 -0500] jtimberman: and mirrors are broken?
[2012-03-09 16:17:00 -0500] Brad_K: the Full Stack Installer is very easy, compared to trying to install all the packages/versions by hand.  my concern is that it provides only rub 1.8.7 itself, and therefore wouldn't solve the underlying problem.
[2012-03-09 16:17:00 -0500] hoover_damm: the full stack installer has 1.9.3 if you use my branch
[2012-03-09 16:17:00 -0500] hoover_damm: hint
[2012-03-09 16:17:00 -0500] hoover_damm: with libyaml
[2012-03-09 16:17:00 -0500] hoover_damm: full and proper
[2012-03-09 16:17:00 -0500] Brad_K: jtimberman: yeah, people rely on this all the time.  most of the time, if it fails once then on the retry you would get redirected to a different mirror that would presumably work.
[2012-03-09 16:18:00 -0500] Brad_K: jtimberman: there's literally thousands of mirror sites out there, most of which are private.  i think that's more for speed reasons than reliability, but i can't say for sure.
[2012-03-09 16:18:00 -0500] jtimberman: also the omnibus full stack chef uses ruby 1.9.2-p180
[2012-03-09 16:18:00 -0500] jtimberman: for something supposedly supporting an enterprise class linux distro, i'll opt for reliability.
[2012-03-09 16:19:00 -0500] Brad_K: hoover_damm: okay, i was wrong.  the Full Stack Installer would solve this problem.
[2012-03-09 16:19:00 -0500] jtimberman: yes i know, the answer is run a yum repo
[2012-03-09 16:19:00 -0500] jtimberman: i'm not doing that, because *I* am not the main person consuming this, people on the internet are.
[2012-03-09 16:20:00 -0500] Brad_K: jtimberman: the only real problem i've had with EPEL is getting that initial rpm out to the clients so that they can do their own enhanced mirror determination, which skips the "mirrormanager" stuff that is running on download.fedoraproject.org.
[2012-03-09 16:21:00 -0500] Brad_K: if you can provide http://download.fedoraproject.org/pub/epel/#{major}/i386/epel-release-#{epel}.noarch.rpm via a cookbook_file instead of downloading it from one of the mirror sites, then from that point on you should be fine.  at least, that has been my experience.
[2012-03-09 16:22:00 -0500] jtimberman: Brad_K: yeah i'm not going to ship the rpm in a cookbook :)
[2012-03-09 16:22:00 -0500] hoover_damm: Brad_K, at least my branch totally does
[2012-03-09 16:22:00 -0500] hoover_damm: that's all I will admit to
[2012-03-09 16:22:00 -0500] jtimberman: because this is for http://ckbk.it/yum
[2012-03-09 16:22:00 -0500] ryan-roemer: Hmm.. A bootstrap is and alternate packaging is a little heavier than I had hoped for.  I think I might try porting to 1.8.7 first, then research getting up and running with omnibus if that doesn't work.  (I'm a Ruby novice, and just two months into Chef, so this is all slow going for me).  Thanks hoover_damm and Brad_K!
[2012-03-09 16:23:00 -0500] Brad_K: jtimberman: i understand.  believe me, i wasn't too happy when i had these problems on an ongoing basis, either.  at least i had the luxury of being able to say "Screw it!" and then ship that rpm as a cookbook_file.
[2012-03-09 16:23:00 -0500] jtimberman: yeah
[2012-03-09 16:23:00 -0500] jtimberman: i wish rpm handled the 302
[2012-03-09 16:23:00 -0500] jtimberman: so i could just use rpm_package with the source url
[2012-03-09 16:24:00 -0500] Brad_K: ryan-roemer: hoover_damm is absolutely right, try the Full Stack Installer on another machine, and then build on it from there.  then you can worry about how to retrofit any existing machines, or how to migrate them to new instances.
[2012-03-09 16:24:00 -0500] hoover_damm: ryan-roemer, I hate to say if you get too lost, there are people willing to help
[2012-03-09 16:24:00 -0500] Brad_K: jtimberman: boy, do i know that feeling.  ;-)
[2012-03-09 16:24:00 -0500] hoover_damm: some of us are willing to be hired to help as well
[2012-03-09 16:24:00 -0500] hoover_damm: heh
[2012-03-09 16:25:00 -0500] hoover_damm: it's why I made that branch, is it was for a ticket and basically to provide 1.9.3 (stable) for the omnibus
[2012-03-09 16:25:00 -0500] hoover_damm: and make our bootstrap easier
[2012-03-09 16:25:00 -0500] hoover_damm: totally did
[2012-03-09 16:25:00 -0500] hoover_damm: curl | dpkg -i ftw
[2012-03-09 16:26:00 -0500] hoover_damm: :)
[2012-03-09 16:26:00 -0500] Brad_K: ryan-roemer: give yourself a little more time.  i took me about 90 days to get to the point where i started to feel more comfortable with chef.  Hence the title of my talk "From Zero to Cloud in 90 Days with Chef" (see http://www.flossuk.org/Events/Spring2012/Talks#From_Zero_to_Cloud_in_90_Days_with_Chef ).
[2012-03-09 16:27:00 -0500] sivy: how would i test if a package is installed in a not_if?
[2012-03-09 16:27:00 -0500] sivy: i'
[2012-03-09 16:27:00 -0500] Brad_K: sivy: "rpm -qa | grep package" ?
[2012-03-09 16:28:00 -0500] Brad_K: or the dpkg equivalent?
[2012-03-09 16:28:00 -0500] sivy: I've got an execute script that installs a package (that isn't in the normal places) but i only want to run it if the package is not installed
[2012-03-09 16:28:00 -0500] sivy: perhaps
[2012-03-09 16:28:00 -0500] sivy: this is new territory for me
[2012-03-09 16:29:00 -0500] Brad_K: sivy: well, most package managers are smart and will avoid re-installing a package if it is already there.  so, in most cases, you shouldn't need to protect that statement with a "not_if".  The package manager should just "Do The Right Thing" if the package is already installed.
[2012-03-09 16:29:00 -0500] sivy: ah
[2012-03-09 16:29:00 -0500] sivy: ok
[2012-03-09 16:29:00 -0500] sivy: good to know
[2012-03-09 16:29:00 -0500] ryan-roemer: hoover_damm, Brad_K: Yeah, thanks guys  I know I'm still on the "climbing" side of the learning curve, I'm just trying to get something out the door quickly, and the rest of everything works great in our system (for full staging / production clusters) with our existing chef infrastructure  everything except for this one recipe, which is touching off the rest of this tortured path.  If I can't backport and/or finally get some free 
[2012-03-09 16:30:00 -0500] hoover_damm: well if you run Ubuntu upgrading to Ocelot will give you 1.9.2
[2012-03-09 16:30:00 -0500] hoover_damm: apt-get install ruby-1.9.1-full -y
[2012-03-09 16:31:00 -0500] ryan-roemer: I am actually on ocelot.  If I just wrap a base package 'ruby-1.9.1-full' declaration is a base role, will that switch everything correctly for chef?
[2012-03-09 16:33:00 -0500] maek: anyone have knife joyent?
[2012-03-09 16:43:00 -0500] sivy: is it possible to pass opts to a service resource?
[2012-03-09 16:43:00 -0500] jtimberman: sivy: have the package as a resource before the script?
[2012-03-09 16:44:00 -0500] jtimberman: or have action :nothing on the script resource, and subscribe to the package installation
[2012-03-09 16:44:00 -0500] sivy: jtimberman: yeah, i'm actually rewriting the install.sh as a recipe :-)
[2012-03-09 16:44:00 -0500] sivy: so working on that
[2012-03-09 16:44:00 -0500] jtimberman: which install.sh?
[2012-03-09 16:44:00 -0500] sivy: i've got a service that wants 'etc/init.d/theservice start --someopt=foo'
[2012-03-09 16:45:00 -0500] sivy: jtimberman: install script for cloudpassage Halo
[2012-03-09 16:45:00 -0500] jtimberman: ooh
[2012-03-09 16:45:00 -0500] jtimberman: sivy: service takes start_command as a parameter
[2012-03-09 16:45:00 -0500] sivy: if i can make it pretty i'll contribute it
[2012-03-09 16:45:00 -0500] jtimberman: you could do
[2012-03-09 16:45:00 -0500] jtimberman: start_command "/etc/init.d/servicename start --someopt=foo"
[2012-03-09 16:45:00 -0500] sivy: ah ok
[2012-03-09 16:45:00 -0500] jtimberman: i'd probably look at putting the service options in attributes if they're configurable
[2012-03-09 16:47:00 -0500] sivy: is there a better expansion of Service than here? http://wiki.opscode.com/display/chef/Resources#Resources-Service
[2012-03-09 16:47:00 -0500] sivy: with info on attributes, etc
[2012-03-09 16:47:00 -0500] jtimberman: I mean a node attribute
[2012-03-09 16:47:00 -0500] jtimberman: the resources page is comprehensive
[2012-03-09 16:48:00 -0500] hoover_damm: you can always use the source to document
[2012-03-09 16:48:00 -0500] sivy: well, the value for someopt is already in an encrypted databag
[2012-03-09 16:49:00 -0500] sivy: (it's an apikey)
[2012-03-09 16:51:00 -0500] hoover_damm: so your passing a option to a encrypted databag in a service resource?
[2012-03-09 16:53:00 -0500] sivy: hoover_damm: that's what i'm trying to do :-)
[2012-03-09 16:53:00 -0500] sivy: not sure yet how
[2012-03-09 16:53:00 -0500] hoover_damm: then your doing it wrong
[2012-03-09 16:54:00 -0500] sivy: can i do start_command "path/to/service start --opt=#{unecrypted_value}"
[2012-03-09 16:54:00 -0500] hoover_damm: right, embed the value in a start file
[2012-03-09 16:54:00 -0500] sivy: so, in this case, the actual init.d script?
[2012-03-09 16:54:00 -0500] hoover_damm: as if you restart it outside of chef
[2012-03-09 16:54:00 -0500] hoover_damm: you'll not get the same results
[2012-03-09 16:55:00 -0500] sivy: hm, yeah
[2012-03-09 16:55:00 -0500] hoover_damm: create a reproduceable pattern
[2012-03-09 16:55:00 -0500] sivy: uuuuugh
[2012-03-09 16:55:00 -0500] sivy: stupid service
[2012-03-09 16:56:00 -0500] sivy: they take command line options and write them to a config file
[2012-03-09 16:56:00 -0500] sivy: but remove the config file first
[2012-03-09 16:56:00 -0500] sivy: so you HAVE to pass the values on the command line
[2012-03-09 17:00:00 -0500] hoover_damm: sounds stupid
[2012-03-09 17:00:00 -0500] hoover_damm: should be in a config file
[2012-03-09 17:07:00 -0500] sivy: yeah, i've sent a support email
[2012-03-09 17:11:00 -0500] Dink: Hello I need some help in a template. http://pastebin.com/7hKhKE55
[2012-03-09 17:11:00 -0500] Dink: I would like to distinguish different nodes by their name and set different attributes to them.
[2012-03-09 17:12:00 -0500] Dink: Can you use regex to determine node_name ?
[2012-03-09 17:14:00 -0500] Dink: if nodes contains  *(-md.)* then set one value else if *(-ca.)* then set another value.
[2012-03-09 17:18:00 -0500] jbz: Dink:  Is this something that you can't do with roles?
[2012-03-09 17:18:00 -0500] jbz: This is sort of what roles are for.
[2012-03-09 17:18:00 -0500] sivy: are there any samples of community cookbooks that depend on encrypted data bags?
[2012-03-09 17:18:00 -0500] sivy: ie, depend on the user having certain data in certain encrypted data bags?
[2012-03-09 17:18:00 -0500] Dink: jbz: how so? Sorry very new to chef and ruby. I thought roles was i.e.; web server, app server etc.
[2012-03-09 17:19:00 -0500] Dink: I need different resolv.conf files based on location/server name
[2012-03-09 17:20:00 -0500] jbz: Dink:  Nope.
[2012-03-09 17:20:00 -0500] jbz: roles?
[2012-03-09 17:20:00 -0500] bawt: roles is http://wiki.opscode.com/display/chef/Roles
[2012-03-09 17:21:00 -0500] jbz: Dink:  Have a gander at that link.  A 'role', in Chef terms, is a set of attribute values (including a runlist) which can be applied to a subset of your nodes.
[2012-03-09 17:22:00 -0500] Dink: so how would that role determine which value to set from the resolv cookbook ?
[2012-03-09 17:22:00 -0500] jbz: So you could, e.g., have a role named 'webserver' which all your 'webserver' nodes had applied to them - and in that role, you would set the [:resolver][:search] attribute, and then all each node would just have to cheerfully apply that attribute without worrying about checking to see which it should have.
[2012-03-09 17:22:00 -0500] jbz: It wouldn't.  The role is separate from teh cookbook.
[2012-03-09 17:22:00 -0500] jbz: All nodes belonging to that role would have a common value for (say) [:resolver][:search], because that attribute would be set in the role.
[2012-03-09 17:23:00 -0500] jbz: (the role attribute has a higher precedence than the default attributes).
[2012-03-09 17:23:00 -0500] Dink: ok so we could create a "MD" role and just set [:resolver][:search] attribute, there.
[2012-03-09 17:23:00 -0500] jbz: Exactly.
[2012-03-09 17:23:00 -0500] jbz: attributes?
[2012-03-09 17:23:00 -0500] bawt: attributes is http://wiki.opscode.com/display/chef/Attributes
[2012-03-09 17:23:00 -0500] jbz: In that document you'll see a diagram of the precedence for attributes
[2012-03-09 17:24:00 -0500] jbz: you can set them in the cookbook (default or in the recipe), or you can set them on the node using knife or the web interface, or you can set them in roles, or in environments.
[2012-03-09 17:24:00 -0500] jbz: The diagram will tell you what precedence order those get applied in.
[2012-03-09 17:24:00 -0500] jbz: Try thinking of it like this:
[2012-03-09 17:24:00 -0500] jbz: a cookbook should never care what node it's running on.
[2012-03-09 17:24:00 -0500] jbz: It should just 'do the right thing' using attributes and/or data bags to determine what config values to apply.
[2012-03-09 17:25:00 -0500] jbz: The cookbook should trust that it will be given the proper values to apply using those two avenues (attribs, data bags).
[2012-03-09 17:25:00 -0500] Dink: hmm ok I think I am following
[2012-03-09 17:25:00 -0500] jbz: Now, that's an ideal - obviously, some cookbooks may end up having to care where they're running.  But it's an ideal to strive for.
[2012-03-09 17:25:00 -0500] jbz: Making sense?
[2012-03-09 17:25:00 -0500] Dink: cookbook should be as generic as possible ?
[2012-03-09 17:25:00 -0500] jbz: Yes indeed.
[2012-03-09 17:26:00 -0500] Dink: and let roles etc set those attributes
[2012-03-09 17:26:00 -0500] jbz: Because changing cookbooks is always complex and dangerous - when you upload a new version of a cookbook, every machine which uses it is at risk of error if there's an error in the cookbook.
[2012-03-09 17:26:00 -0500] Dink: gotcha
[2012-03-09 17:26:00 -0500] jbz: So ideally, any config changes should be made using attributes or data bag items, not code.
[2012-03-09 17:27:00 -0500] jbz: In the case of the pastie you sent, there should be a cookbook which just knows how to set the resolver and search domain using a particular attribute, and it should always just assume that what's in that attribute for its node is gospel
[2012-03-09 17:28:00 -0500] Dink: So I was thinking of just using https://github.com/opscode/cookbooks/tree/master/resolver
[2012-03-09 17:28:00 -0500] jbz: and then it's the op's job to ensure that the node has the right value in the attribute using roles/environments or, as last resort, by setting that node's attribute directly.
[2012-03-09 17:28:00 -0500] Dink: then creating a MD/CA role
[2012-03-09 17:28:00 -0500] jbz: Indeed.  So the roles would each set [:resolver][:search] and [:resolver][:nameservers]
[2012-03-09 17:29:00 -0500] jbz: and that cookbook would just apply whatever it got.
[2012-03-09 17:29:00 -0500] jbz: You can specify a role in a node's runlist, e..g when you create the node
[2012-03-09 17:29:00 -0500] jbz: role[md], role[ca]
[2012-03-09 17:30:00 -0500] jbz: Environments are a step above that - for example, if you had md-roled machines in staging and then also in production, which needed different values, you'd set those values in the *environments* (staging, production, etc.).
[2012-03-09 17:32:00 -0500] Dink: http://pastebin.com/98WMnWGs
[2012-03-09 17:32:00 -0500] maek: how do I use an LWRP provided by a cookbook? just depends that cookbook in my metadata.rb and call the resource?
[2012-03-09 17:32:00 -0500] jtimberman: maek: bingo
[2012-03-09 17:32:00 -0500] maek: jtimberman: ty
[2012-03-09 17:34:00 -0500] hoover_damm: cookbooks should always be very generic and very extendable based on node attributes
[2012-03-09 17:34:00 -0500] hoover_damm: or data bags or whatever new feature opscode gives us down the line
[2012-03-09 17:34:00 -0500] Dink: sorry last line, default_attributes "resolver": { "search": ["mydomain"] }
[2012-03-09 17:34:00 -0500] Dink: so something like that
[2012-03-09 17:35:00 -0500] jbz: Dink:  Indeed.
[2012-03-09 17:35:00 -0500] hoover_damm: having a very constrained cookbook only leads you to rewriting it eventually
[2012-03-09 17:35:00 -0500] hoover_damm: to make it do more
[2012-03-09 17:35:00 -0500] hoover_damm: spending a few minutes to think about how you pass the data into your cookbooks
[2012-03-09 17:35:00 -0500] hoover_damm: and not only how you want to use it at this moment, but how you can keep using it and re-using it in the future
[2012-03-09 17:35:00 -0500] hoover_damm: is another portion of the 'coin'
[2012-03-09 17:36:00 -0500] hoover_damm: it was the very reason I pushed out the graphite cookbook I did last night for a client
[2012-03-09 17:36:00 -0500] hoover_damm: the graphite cookbooks I ran into were not generic enough or extendable enough
[2012-03-09 17:36:00 -0500] hoover_damm: (that and I wanted graphite in virtualenv and to be able to dynamically setup the storage schema so statsd was a simple thing
[2012-03-09 17:36:00 -0500] hoover_damm: )
[2012-03-09 17:37:00 -0500] hoover_damm: if i'm gonna do statsd and deal with that pain, let's make it flexible enough that statsd is easy
[2012-03-09 17:38:00 -0500] Dink: so what is an "Environment" how does that differ from a "Role" ?
[2012-03-09 17:38:00 -0500] hoover_damm: have you read over the wiki page?
[2012-03-09 17:38:00 -0500] hoover_damm: and read the page titled environments? and roles?
[2012-03-09 17:38:00 -0500] Dink: Reading through it now
[2012-03-09 17:39:00 -0500] hoover_damm: reading the wiki page will answer 50-70% of your questions
[2012-03-09 17:39:00 -0500] hoover_damm: if not more
[2012-03-09 17:41:00 -0500] Dink: It seems to be the same to be but used in a different manner. An environment is a role within a role
[2012-03-09 17:46:00 -0500] Dink: so in my example of needing different resolv.conf files based on server location that might be best within an "environment" than role right
[2012-03-09 17:46:00 -0500] jbz: Dink:  Put it this way.  A role determines what kind of server you're talking about.  So you have an infrastructure made up of servers of different roles, all working together.
[2012-03-09 17:47:00 -0500] jbz: Sometimes, though, you need to have completely different full sets of those environments.  For example, you might have the 'testing' environment and the 'production' environment, each of which contains web servers, app servers, and db servers.
[2012-03-09 17:47:00 -0500] jbz: So the web/app/db are your roles, and your environments are 'testing' and 'production.'
[2012-03-09 17:48:00 -0500] Dink: jbz: yeah I got that.
[2012-03-09 17:48:00 -0500] Dink: testing could have different ports jvm settings etc than prod
[2012-03-09 17:48:00 -0500] Dink: for the "role"
[2012-03-09 17:49:00 -0500] Dink: which would have a generic default value
[2012-03-09 17:49:00 -0500] jbz: Yep.  IN your case, if you have two servers doing exactly the same thing (same runlists, same job) but in different places, then yes, maybe environments are what you're looking for
[2012-03-09 17:49:00 -0500] Dink: jbz: yeah identical server just different location
[2012-03-09 17:49:00 -0500] jbz: You could use roles and just namespace the roles (us-east-webserver, us-west-webserver) but that's why they gave us environments. :-)
[2012-03-09 17:50:00 -0500] Dink: jbz: cool thanks for all the help and clarification
[2012-03-09 17:50:00 -0500] Dink: same to hoover_damm
[2012-03-09 17:55:00 -0500] ggolin: hey guys
[2012-03-09 17:55:00 -0500] ggolin: has anyone by chance tried adding users to mongodb using chef?
[2012-03-09 17:57:00 -0500] ggolin: https://gist.github.com/2007763
[2012-03-09 18:04:00 -0500] jbz: Dink:  you're most welcome, ping with any questions.
[2012-03-09 18:06:00 -0500] hoover_damm: Dink, we're always here to help.  logs.likens.us has a logs of an archive of the irc logs for this channel and #chef-hacking over the years
[2012-03-09 18:07:00 -0500] hoover_damm: Dink, Feel free to scrape it when your looking for questions
[2012-03-09 18:35:00 -0500] qhartman: Can I perform a search of node roles from within a template?
[2012-03-09 18:39:00 -0500] qhartman: I'm trying to http://pastebin.com/4mjbMF8t and it's telling that search is an undefined method
[2012-03-09 18:39:00 -0500] Glacee: is there any documentation for a once run cookbook?
[2012-03-09 18:39:00 -0500] Glacee: run once*
[2012-03-09 18:40:00 -0500] qhartman: Glacee, I saw something about this earlier today, I'll see if I can find it again
[2012-03-09 18:40:00 -0500] Brad_K: mattray has a cookbook for that.  i'm looking for the url.
[2012-03-09 18:41:00 -0500] mattray: https://github.com/mattray/mattray-cookbooks/tree/master/one-shot
[2012-03-09 18:41:00 -0500] qhartman: here's something: http://wiki.opscode.com/pages/viewpage.action?pageId=15728818
[2012-03-09 18:41:00 -0500] Brad_K: see https://github.com/mattray/mattray-cookbooks/tree/master/one-shot
[2012-03-09 18:42:00 -0500] Brad_K: however, i will say that in most cases where you think you might need something like this, you're probably actually doing it wrong.  this kind of thing should be very, very rare.
[2012-03-09 18:42:00 -0500] Brad_K: heheh
[2012-03-09 18:43:00 -0500] Glacee: mattray: thank you!
[2012-03-09 18:43:00 -0500] Glacee: brad_k thanks
[2012-03-09 18:43:00 -0500] Glacee: well.. the goal is to update a network driver when we install the machine.. but I do not want it as a cookbook (it seems like a recipe for disaster)
[2012-03-09 18:44:00 -0500] Glacee: in a cookbook*
[2012-03-09 18:44:00 -0500] qhartman: hah, recipe for disaster...
[2012-03-09 18:45:00 -0500] siezer: knife cookbook site search disaster
[2012-03-09 18:45:00 -0500] siezer: no results
[2012-03-09 18:45:00 -0500] Glacee: I thought about just adding it in the kick start process.. but if we can do it with Chef it would be cool
[2012-03-09 18:45:00 -0500] Glacee: anyone opinion on that Brad_k ?
[2012-03-09 18:46:00 -0500] qhartman: Glacee, might be able to add it as part of the knife bootstrap for the platform
[2012-03-09 18:46:00 -0500] Brad_K: matt wrote the cookbook, so he's probably a better judge than i am.  but putting it into part of the bootstrap would be a good start  that's already a "run once only" thing.
[2012-03-09 18:47:00 -0500] Glacee: ok thanks... I will try to add it to the bootstrap first
[2012-03-09 18:47:00 -0500] mattray: Glacee: that sounds like the pattern used by the annoyances cookbook
[2012-03-09 18:47:00 -0500] mattray: run at bootstrap, then remove
[2012-03-09 18:47:00 -0500] mattray: https://github.com/mattray/annoyances-cookbook
[2012-03-09 18:48:00 -0500] Glacee: great.. I didnt know  about these cookbooks.. I will investigate
[2012-03-09 18:48:00 -0500] Glacee: thanks a lot
[2012-03-09 18:50:00 -0500] qhartman: So, does anyone know of a way to create a list of nodes with a particular role from within template? I'm thinking I might have to create the list in the recipe and then pass it to the template.
[2012-03-09 18:52:00 -0500] sako: so does chef have a similar option as puppet where it will run every 30 mins and ensure settings are properly set?
[2012-03-09 18:53:00 -0500] mattray: sako: yes. the chef-client cookbook will automatically set that up.
[2012-03-09 18:53:00 -0500] mattray: qhartman: 1 sec
[2012-03-09 18:56:00 -0500] bencaron: anyone have any sound strategy to distributed my encrypted_data_bag_secret ?
[2012-03-09 18:57:00 -0500] mattray: qhartman: here's searching on all roles: https://github.com/opscode/cookbooks/blob/master/zenoss/recipes/server.rb#L186
[2012-03-09 18:57:00 -0500] mattray: qhartman: you could get more narrow than that
[2012-03-09 18:58:00 -0500] mattray: qhartman: more here: http://wiki.opscode.com/display/chef/Search#Search-SearchforNodesBasedonRunListEntries
[2012-03-09 18:59:00 -0500] qhartman: thanks, those will be useful. Will any of that work from within a template? IF you missed it, I'm trying to do: http://pastebin.com/4mjbMF8t
[2012-03-09 19:00:00 -0500] qhartman: passing in the roles from the recipe
[2012-03-09 19:06:00 -0500] mattray: qhartman: it would be easier to do the search in a recipe, then pass the results in
[2012-03-09 19:06:00 -0500] mattray: I dislike having much ruby in my erb
[2012-03-09 19:10:00 -0500] qhartman: cool, I'll approach it that way then. Thanks mattray.
[2012-03-09 19:11:00 -0500] mattray: good luck
[2012-03-09 19:12:00 -0500] chip-: Fun with knife ssh: knife ssh "chef_environment:amazonStaging" "sudo aptitude update && sudo aptitude safe-upgrade -y" -x oncall -a cloud.public_hostname
[2012-03-09 19:12:00 -0500] chip-: followed by
[2012-03-09 19:14:00 -0500] chip-: knife ssh "chef_environment:amazonStaging" "if [ -e /var/run/reboot-required ]; then sleep `echo $RANDOM%90`; sudo /sbin/shutdown -h now; fi" -x oncall -a cloud.public_hostname
[2012-03-09 19:14:00 -0500] chip-: (test a few by hand first of course)
[2012-03-09 19:15:00 -0500] chip-: er
[2012-03-09 19:15:00 -0500] chip-: make that a -r
[2012-03-09 19:15:00 -0500] chip-: d'oh
[2012-03-09 19:15:00 -0500] chip-: :)
[2012-03-09 19:17:00 -0500] chip-: Anyway, point being that patch day got a lot easier.
[2012-03-09 19:26:00 -0500] cjbottaro: Is it possible to have roles that will append to that list?
[2012-03-09 19:33:00 -0500] Brad_K: cjbottaro: if you define the same attribute in a role, it should get deep-merged, unless you specify it as an over-ride attribute.
[2012-03-09 19:34:00 -0500] Brad_K: or you should always be able to use the "<<" operator instead of "=", which will cause the additional value(s) to be appended.
[2012-03-09 19:35:00 -0500] Brad_K: chip-: yes, you successfully halted a whole bunch of machines.  What?  you wanted them to REBOOT instead?  OOPS!  ;-)
[2012-03-09 19:35:00 -0500] cjbottaro: I thought in a role, you had to use default_attributes and override_attributes method which only take hashes...?  Meaning, I can't use <<.
[2012-03-09 19:35:00 -0500] Brad_K: well, you're going to be waiting a while for them to all reboot, then.  BRS time, i guess.  ;-)
[2012-03-09 19:36:00 -0500] cjbottaro: I.e. you can't say in a role:  node[:blah][:some_list] << "item"
[2012-03-09 19:37:00 -0500] Brad_K: cjbottaro: hmm.  maybe i'm wrong.  you could always test it out, and that way you would know for sure.
[2012-03-09 20:00:00 -0500] chip-: Brad_K: I didn't hit enter, thank god. :)
[2012-03-09 20:00:00 -0500] chip-: Brad_K: but y'know, assuming lack of PEBKAC, knife ssh makes life easy.
[2012-03-09 20:05:00 -0500] geekbri: Is there any sensible way within a role file to set an attribute, but tell it to append that attribute to an existing one?  So life if there is an attribute that is an array, is there a way to have a role file just append to that array if its created in a different role file that was applied before it?
[2012-03-09 20:07:00 -0500] tarrant: geekbri: a bit hacky but you could have two attributes one for the node specific and one for the role, and then append them in your recipe.
[2012-03-09 20:07:00 -0500] geekbri: tarrant: hrmmm yeah I mean, I have a couple work arounds, it would just be nice if i could do that :)
[2012-03-09 20:51:00 -0500] wilton: Hello, Trying to load a data_bag via shef console. Getting the error. Can anyone help.
[2012-03-09 20:51:00 -0500] wilton: ERROR: Failed to list data bag items in data bag: "users"
[2012-03-09 20:51:00 -0500] wilton: TypeError: can't convert nil into String
[2012-03-09 20:51:00 -0500] wilton: this is a result of chef > data_bag("users")
[2012-03-09 21:09:00 -0500] wilton: Found the answer. For some reason I was not running shef in the proper mode.
[2012-03-09 21:17:00 -0500] cwj: off topic question: anyone familiar with using celery/kombu and a rabbitmq cluster? i am trying to figure out how to tell kombu that it can talk to any of the members of a rabbitmq cluster but all the examples i see show only one broker host.
[2012-03-09 21:22:00 -0500] Brad_K: we use celery and rabbit for our internal stuff, but we're SPOF'ed at the moment.  no rabbit clustering yet.
[2012-03-09 21:24:00 -0500] geekbri: tarrant: looks like if you store the attributes as an array it will merge them into it
[2012-03-09 21:27:00 -0500] Brad_K: cwj: last i saw, mirrored queues and clustering were still relatively new concepts in rabbitmq.  some minor code changes are required when creating and accessing the queues, depending on whether or not they are mirrored, for example.
[2012-03-09 21:27:00 -0500] cwj: hrm
[2012-03-09 21:28:00 -0500] Brad_K: the opscode cookbook for rabbitmq has been recently updated to support auto-clustering, however.  you might look at that to see who has done the bulk of the work and see if you can talk to them directly.
[2012-03-09 21:28:00 -0500] cwj: yeah i have been looking at it
[2012-03-09 21:29:00 -0500] cwj: whether the clustering is automatic or manual i still dont understand how to tell celery i have multiple rabbit nodes
[2012-03-09 21:30:00 -0500] Brad_K: from what i understand, you just tell celery to bind to a queue (and you have to tell it what type of queue to bind to), and from there it handles the rest.  it will randomly pick a node to talk to that advertises it has that queue, and from there rabbit handles production and consumption across mirror/cluster members.
[2012-03-09 21:31:00 -0500] cwj: how is a queue broadcast? i am setting BROKER_HOST in order to tell celery which broker to connect to
[2012-03-09 21:31:00 -0500] Brad_K: there's a good deal of auto-magic, according to our guy that has done most of the programming with celery and rabbit.
[2012-03-09 21:32:00 -0500] Brad_K: so long as that broker host has a copy of the queue on it, that should be all you need.  if not, then i don't know how it goes about finding who to talk to for that queue.
[2012-03-09 21:42:00 -0500] cjbottaro: Hmm, would be nice to be able to set encrypted_data_bag_secret as an argument to knife bootstrap instead of in knife.rb.
[2012-03-09 21:47:00 -0500] yfeldblum: cjbottaro, add it in a knife plugin ...
[2012-03-09 21:48:00 -0500] cjbottaro: yfeldblum, awesome, thanks for that tip.  Reading docs now.
[2012-03-09 22:33:00 -0500] rshade98: can I make the cron resource do hourly by putting hour [0..24]
[2012-03-09 22:45:00 -0500] ggolin: rshade98, whats wrong with hour *
[2012-03-09 22:45:00 -0500] ggolin: guys, is it possible to search attributes of other nodes?
[2012-03-09 22:48:00 -0500] workmad3_: ggolin: yes
[2012-03-09 22:49:00 -0500] ggolin: is there an example somewhere? im looking at the search doc on the wiki, it talks about search recipes and runlists
[2012-03-09 22:58:00 -0500] thehar: jtimberman: https://github.com/opscode/chef/blob/master/chef/lib/chef/knife/configure.rb#L72
[2012-03-09 22:58:00 -0500] thehar: is there a reason why that is hard coded to #{chef_repo}/cookbooks?
[2012-03-09 23:17:00 -0500] sivy: is there a trick to getting string interpolation working in an attribute value?
[2012-03-09 23:17:00 -0500] sivy: I've got     uri "http://apt.reposerver/#{data['key']}/debian" in the apt_repository resource
[2012-03-09 23:18:00 -0500] sivy: but the #{ ... } is getting written to a file, not replaced with the local var data['key'] as I expected
[2012-03-09 23:49:00 -0500] ggolin: msf, you around dude
[2012-03-09 23:52:00 -0500] maek: sivy: as far as I know you can only use node attributes in an attribute file
[2012-03-09 23:52:00 -0500] sivy: maek: well, I think my termiolgy is off
[2012-03-09 23:52:00 -0500] sivy: it's in a recipe
[2012-03-09 23:52:00 -0500] sivy: but passing the string to be interpolated in an attribute for a resource
[2012-03-09 23:53:00 -0500] sivy: someresource "foo" do { uri "string with #{var}" }
[2012-03-09 23:53:00 -0500] maek: hrm, id assume that would work
[2012-03-09 23:53:00 -0500] sivy: likewise
[2012-03-09 23:56:00 -0500] |shad0w|: you can use/set attribs in recipes
[2012-03-09 23:56:00 -0500] |shad0w|: sivy did you set a var to data or are you looking for node['data']['key]'
[2012-03-09 23:57:00 -0500] sivy: |shad0w|: it was a variable
[2012-03-09 23:57:00 -0500] sivy: pulled from an encrypted data bag
[2012-03-09 23:57:00 -0500] sivy: var  = <get value from data bag>
[2012-03-09 23:57:00 -0500] sivy: "something #{var['key']} "
[2012-03-09 23:59:00 -0500] |shad0w|: pastebin the whole resource block?
