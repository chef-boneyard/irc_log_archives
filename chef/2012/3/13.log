[2012-03-13 07:08:00 -0400] josephholsten: is there a good way to check which package provider is being used? I want this recipe to work with homebrew and macports
[2012-03-13 07:08:00 -0400] BryanWB: i think u can specify to use homebrew or macports
[2012-03-13 07:09:00 -0400] josephholsten: I want the recipe to work with both
[2012-03-13 07:09:00 -0400] josephholsten: I need an if to wrap because rabbitmq has a different package name in each
[2012-03-13 07:11:00 -0400] josephholsten: some genius (me) installed different package managers on his personal and work mac
[2012-03-13 07:16:00 -0400] josephholsten: I considered doing 'case package("foo").provider.class; when ', but that seems to obscene to live with
[2012-03-13 07:17:00 -0400] josephholsten: plus it'd need to be 'p = package 'foo' do; action :nothing; end; p.provider ...'
[2012-03-13 07:17:00 -0400] josephholsten: so horrible
[2012-03-13 07:37:00 -0400] auxome: evening, chefs
[2012-03-13 09:05:00 -0400] ProfFalken: morning all :)
[2012-03-13 09:06:00 -0400] ProfFalken: I'm trying to search through the extended run list for a given role
[2012-03-13 09:06:00 -0400] ProfFalken: The wiki suggests that search(:node, "roles:<rolename>") should work, however it doesn't appear to...
[2012-03-13 09:06:00 -0400] ProfFalken: (it just returns an empty hash)
[2012-03-13 09:06:00 -0400] ProfFalken: I've checked this in "shef -z" and I get the same result
[2012-03-13 09:07:00 -0400] BryanWB: try "role:foo"
[2012-03-13 09:07:00 -0400] BryanWB: i am able to search by roles
[2012-03-13 09:07:00 -0400] ProfFalken: BryanWB: I'm under the impression that only searches the runlist, not the expanded runlist?
[2012-03-13 09:08:00 -0400] ProfFalken: I can search by roles if the role is directly assigned, however I have a "base" role in which a number of roles are in the runlist
[2012-03-13 09:08:00 -0400] ProfFalken: and it's finding nodes which have an additional role assinged via the base role if that makes sense
[2012-03-13 09:08:00 -0400] ProfFalken: ?
[2012-03-13 09:09:00 -0400] ProfFalken: I've been reading http://wiki.opscode.com/display/chef/Search#Search-FindNodeswithaRoleintheExpandedRunList and I'm running 0.10.2
[2012-03-13 09:16:00 -0400] BryanWB: argh don't know :(
[2012-03-13 09:25:00 -0400] ProfFalken: :(
[2012-03-13 09:38:00 -0400] nico: ProfFalken: what do you do in shef ?
[2012-03-13 09:38:00 -0400] nico: nodes.find(:run_list => "role\\[Infrastructure\\]") (for eg) works for me
[2012-03-13 09:44:00 -0400] ProfFalken: nico: I've just been running the search(:node, ...) as on the wiki - I'll try your approach...
[2012-03-13 09:44:00 -0400] nico: search() is for recipes, nodes.find is for shef
[2012-03-13 09:46:00 -0400] nico: would be something like search(:nodes, "run_list:role\[Infrastructure\]") in a recipe
[2012-03-13 09:46:00 -0400] ProfFalken: ah, ok, thanks - I'm still getting used to shef vs. recipes :)
[2012-03-13 09:49:00 -0400] ProfFalken: meh, just found out what the issue is, I've got a "-" in the role name...
[2012-03-13 09:50:00 -0400] nico: ProfFalken: let me know if it solves your problem
[2012-03-13 10:00:00 -0400] ProfFalken: nico: nope, none of those are working (either in recipes or shef)
[2012-03-13 10:00:00 -0400] ProfFalken: ok, so the role is called bacula_filedaemon
[2012-03-13 10:01:00 -0400] ProfFalken: if I include it in the run_list of a node, I can do search(:node, "role:bacula_filedaemon") and it finds it without issue
[2012-03-13 10:01:00 -0400] ProfFalken: if I include it in the run_list of role[base] then search(:node, "role:bacula_filedaemon) fails (expected behaviour)
[2012-03-13 10:02:00 -0400] ProfFalken: however search(:node, "roles:bacula_filedaemon") also fails (not expected behaviour according to the Wiki)
[2012-03-13 10:02:00 -0400] ProfFalken: All the nodes have "role[base]" assigned to them which also configures monitoring etc.
[2012-03-13 10:02:00 -0400] ProfFalken: and I can see the bacula_filedaemon role being pulled in as part for a chef-client run on each node
[2012-03-13 10:04:00 -0400] nico: what does "knife node show yournode" gives ?
[2012-03-13 10:06:00 -0400] ProfFalken: it shows bacula_filedaemon in the "roles" section, not the "run_list"
[2012-03-13 10:09:00 -0400] BryanWB: miah: know a cookbook that is a good example of how to use chefspec?
[2012-03-13 10:11:00 -0400] nico: ProfFalken: pastie ?
[2012-03-13 10:13:00 -0400] ProfFalken: nico: I'll try and sanitise the output (working on a client site and not convinced that they'd be too happy putting their code on the web!)
[2012-03-13 10:16:00 -0400] nico: ok
[2012-03-13 10:19:00 -0400] ProfFalken: nico: https://gist.github.com/2028004 <- the best I can do without giving stuff away... :)
[2012-03-13 10:22:00 -0400] nico: bacula_filedaemon is included in which of the 3 bacula-* role ?
[2012-03-13 10:22:00 -0400] nico: Base ?
[2012-03-13 10:22:00 -0400] bawt: Base is in /, local stuff in /usr/local. its all pretty well documents. look at man hier
[2012-03-13 10:28:00 -0400] ProfFalken: nico: bacula_filedaemon is in "base", "base" is assigned to all nodes
[2012-03-13 10:28:00 -0400] ProfFalken: it is not included in any of the "bacula-*" roles
[2012-03-13 10:28:00 -0400] nico: ok
[2012-03-13 10:33:00 -0400] nico: can't see why it fails... maybe related to the same problem we hit with renchap
[2012-03-13 10:34:00 -0400] nico: renchap: what was the ticket for solr & attributes problem ?
[2012-03-13 10:35:00 -0400] renchap: http://tickets.opscode.com/browse/CHEF-2346
[2012-03-13 10:35:00 -0400] nico: thx
[2012-03-13 10:37:00 -0400] ProfFalken: nico: hmmm, ok, is there a way to check the number of items returned if I don't have access to the chef server?
[2012-03-13 10:38:00 -0400] nico: ngrep/tcpdump maybe
[2012-03-13 10:38:00 -0400] nico: but not sure
[2012-03-13 11:18:00 -0400] ProfFalken: ok, so what I'm after is the ability to search node.expand! for the bacula recipe - how are other people doing this?
[2012-03-13 11:39:00 -0400] wonko_be: is there a way to force a wait for the solr to reindex, or to force a reindex from a recipe?
[2012-03-13 11:40:00 -0400] wonko_be: if I set a certain attribute, and search for it, it fails to find it as the reindexing is only done once a minute (i guess)
[2012-03-13 12:16:00 -0400] workmad3: wonko_be: did you save the node before trying to search for the attribute?
[2012-03-13 12:29:00 -0400] hongbo: is anyone run chef client success on AIX and HP-UX ?
[2012-03-13 12:32:00 -0400] wonko_be: workmad3: how do i "save" a node from a recipe?
[2012-03-13 12:34:00 -0400] workmad3: wonko_be: node.save... but be warned, if something goes wrong later in the chef run, that will leave the data saved on your chef server in an inconsistent state
[2012-03-13 12:34:00 -0400] workmad3: wonko_be: however, without that, then attributes you've set in the client run won't be pushed to the server until the end of a successful run and therefore won't be indexed by solr for searching
[2012-03-13 12:37:00 -0400] wonko_be: cool, thx, I'll try if this fixes my problem
[2012-03-13 13:02:00 -0400] ProfFalken: does anyone in here have the "search expanded runlist" stuff working? (http://wiki.opscode.com/display/chef/Search#Search-FindNodeswithaRoleintheExpandedRunList)
[2012-03-13 13:03:00 -0400] ProfFalken: it's not working for me in 0.10.2
[2012-03-13 13:04:00 -0400] ProfFalken: I need to find all nodes with a given role, however that role is *always* assigned through an intermediary role so a normal search doesn't work
[2012-03-13 13:05:00 -0400] ProfFalken: node <- role["base"] <- role["the_one_im_looking_for"]
[2012-03-13 13:14:00 -0400] jtimberman: ProfFalken: you can search like this: knife search node roles:the_one_im_looking_for
[2012-03-13 13:14:00 -0400] jtimberman: ProfFalken: "roles" is different from "role" in that "roles" (and "recipes") are from the node's expanded run list
[2012-03-13 13:15:00 -0400] jtimberman: the nodes have to successfully run chef and save to the server of course :)
[2012-03-13 13:17:00 -0400] ProfFalken: jtimberman: that's half the issue - search(:node, "roles:the_one_im_looking_for") doesn't return any values, even though the recipe has run sucessfully on other nodes
[2012-03-13 13:17:00 -0400] ProfFalken: jtimberman: likewise, node.find from shef -z doesn't return anything either
[2012-03-13 13:19:00 -0400] jtimberman: wot!
[2012-03-13 13:19:00 -0400] jtimberman: i call shennanigans
[2012-03-13 13:20:00 -0400] ProfFalken: hmmm, think I might have found it.
[2012-03-13 13:21:00 -0400] ProfFalken: the role is called "bacula_filedaemon", however it imparts a recipe called "bacula::fd"
[2012-03-13 13:21:00 -0400] ProfFalken: if I search(:node, "roles:bacula\:\:fd") or nodes.find "role:bacula\:\:fd" it works
[2012-03-13 13:22:00 -0400] ProfFalken: sorry, that last one should be "roles"
[2012-03-13 13:22:00 -0400] ProfFalken: it works for "recipes" too, I'm just confused that it's picking up on the recipe name and not the role name...
[2012-03-13 13:23:00 -0400] jtimberman: wow thats weird.
[2012-03-13 13:23:00 -0400] jtimberman: i don't have anything like that handy to test a search
[2012-03-13 13:24:00 -0400] jtimberman: but finding my nodes that have 'base' applied (all included via different role by platform) works
[2012-03-13 13:24:00 -0400] nico: same here
[2012-03-13 13:25:00 -0400] nico: can't find out what's wrong in ProfFalken recipe
[2012-03-13 13:25:00 -0400] ProfFalken: hmmm, ok, let me take a look at my code again...
[2012-03-13 13:25:00 -0400] ProfFalken: jtimberman: here's a "sanitised" output that might help: https://gist.github.com/2028004
[2012-03-13 13:28:00 -0400] jtimberman: unless you're going to use that local variable of rules elsewhere in the recipe, you can do: search(:node, "roles:bacula_filedaemon") do |n|
[2012-03-13 13:29:00 -0400] BryanWB: ProfFalken: are you trying to dynamically add backup clients to a bacula server?
[2012-03-13 13:30:00 -0400] ProfFalken: BryanWB: yes
[2012-03-13 13:31:00 -0400] ProfFalken: Teh code that somes with the tk-networks bacula stuff oesn't seem to work for me
[2012-03-13 13:31:00 -0400] ProfFalken: wow - I can't remember the last time I made so many mistakes in a single message... :)
[2012-03-13 13:32:00 -0400] BryanWB: awesome, u r using creative grammar ;)
[2012-03-13 13:32:00 -0400] ProfFalken: heh
[2012-03-13 13:34:00 -0400] ProfFalken: right, even the following code doesn't find these nodes:
[2012-03-13 13:34:00 -0400] ProfFalken: 133 search(:node, "roles:bacula_filedaemon") do |n|
[2012-03-13 13:34:00 -0400] ProfFalken: 134     puts n.name
[2012-03-13 13:34:00 -0400] ProfFalken: 135 end
[2012-03-13 13:34:00 -0400] ProfFalken: I get nada..
[2012-03-13 13:35:00 -0400] ProfFalken: yet "knife node show..." gitves
[2012-03-13 13:35:00 -0400] ProfFalken: Roles:       bacula_filedaemon, Base
[2012-03-13 13:36:00 -0400] BryanWB: wtf
[2012-03-13 13:36:00 -0400] BryanWB: try bacula\_filedaemon
[2012-03-13 13:36:00 -0400] jtimberman: O.o
[2012-03-13 13:37:00 -0400] tube: is there an issue with subversion? i have following problem when using the deploy / subversion resource: when installing the new server (e.g. with FAI) and running the automatically installed chef-client afterwards (i.e. out of the box) the cookbook with the subversion resources runs into an error.
[2012-03-13 13:37:00 -0400] ProfFalken: BryanWB: nope
[2012-03-13 13:37:00 -0400] tube: when manually doing a '/etc/init.d/chef-client restart' after that, everything runs fine
[2012-03-13 13:39:00 -0400] BryanWB: try  search(:node, "role:bacula*")
[2012-03-13 13:39:00 -0400] BryanWB: ProfFalken: ^^
[2012-03-13 13:40:00 -0400] BryanWB: or `search(:node, "role:bacula*daemon")
[2012-03-13 13:41:00 -0400] ProfFalken: BryanWB: first one returned the direector server (expected - it has an explict role of "bacula-director")
[2012-03-13 13:42:00 -0400] tube: i'm running chef 0.10.8, btw
[2012-03-13 13:42:00 -0400] ProfFalken: BryanWB: second also returns the direct (expected - it also has an explicit role of bacula-storagedaemon)
[2012-03-13 13:43:00 -0400] ProfFalken: BryanWB: third search for bacula*filedaemon returns nothing...
[2012-03-13 13:43:00 -0400] BryanWB: or `search(:node, "role:bacula*ledaemon")
[2012-03-13 13:44:00 -0400] BryanWB: is it a '-' or an underscore "_" in the name?
[2012-03-13 13:46:00 -0400] ProfFalken: BryanWB: underscore
[2012-03-13 13:46:00 -0400] ProfFalken: (for the file daemon anyway - bit of an issue with naming conventions until I get the codebase cleaned up...)
[2012-03-13 13:50:00 -0400] ProfFalken: BryanWB: nope, bacula*ledaemon doesn't work either...
[2012-03-13 14:02:00 -0400] BryanWB: or `search(:node, "role:bacula_f*daemon")
[2012-03-13 14:02:00 -0400] BryanWB: i get screwed up by lowercase l's and 1's myself
[2012-03-13 14:03:00 -0400] ProfFalken: I might be getting somewhere...
[2012-03-13 14:03:00 -0400] ProfFalken: if I search:node, "recipes:bacula\:\:fd") I get
[2012-03-13 14:03:00 -0400] ProfFalken: INFO: HTTP Request Returned 400 Bad Request: invalid search query: 'recipes:bacula::fd' Parse error at offset: 14 Reason: Expected one of \, AND, &&, OR, ||, (, NOT, ?, !, +, -, " at line 1, column 15 (byte 15) after
[2012-03-13 14:03:00 -0400] jtimberman: yeah you have to escape the :
[2012-03-13 14:03:00 -0400] jtimberman: in the query
[2012-03-13 14:03:00 -0400] jtimberman: recipes:bacula\:\:fd
[2012-03-13 14:04:00 -0400] ProfFalken: jtimberman: 14:03 < ProfFalken> if I search:node, "recipes:bacula\:\:fd") I get
[2012-03-13 14:04:00 -0400] ProfFalken: :P
[2012-03-13 14:04:00 -0400] ProfFalken: is my install completely b0rked?
[2012-03-13 14:05:00 -0400] BryanWB: search(node, 'recipes:bacula\:\:fd')    single quotes around the search string
[2012-03-13 14:05:00 -0400] ProfFalken: BryanWB: if it turns out to be that... :(
[2012-03-13 14:06:00 -0400] slyphon: hey, will knife follow symlinks in a cookbook?
[2012-03-13 14:06:00 -0400] slyphon: for upload?
[2012-03-13 14:06:00 -0400] ProfFalken: BryanWB: ok, the single quotes make the error go away but unfortunately it just returns a blank again...
[2012-03-13 14:06:00 -0400] slyphon: i wanted to keep my sensitive stuff in a git submodule
[2012-03-13 14:06:00 -0400] slyphon: and symlink my way to victory
[2012-03-13 14:07:00 -0400] ProfFalken: slyphon: why not keep sensitive stuff in an encrypted data bag and template your way to victory instead? :)
[2012-03-13 14:07:00 -0400] slyphon: because that's a pain in the ass
[2012-03-13 14:07:00 -0400] slyphon: and i trust my 4-copy-backup git repo more than chef-server
[2012-03-13 14:08:00 -0400] slyphon: (no disrespect to chef-server)
[2012-03-13 14:11:00 -0400] ProfFalken: heh
[2012-03-13 14:12:00 -0400] slyphon: i mena, if i have to use an "encrypted data bag" i'll go through the pain of doing it, but converting all the stuff i already have as files-on-the-disk to json format is yak shaving i'd like to avoid
[2012-03-13 14:13:00 -0400] slyphon: ok, it looks like there's no test for symlinks, so...
[2012-03-13 14:13:00 -0400] ProfFalken: slyphon: fair enough - tbh, I've only ever used enc. databag so I can't help here.
[2012-03-13 14:13:00 -0400] ProfFalken: BryanWB: WTF?
[2012-03-13 14:13:00 -0400] ProfFalken: chef > search(:node, 'roles:bacula_filedaemon') do |n|
[2012-03-13 14:13:00 -0400] ProfFalken: chef > puts n.name
[2012-03-13 14:13:00 -0400] ProfFalken: chef ?> end => true
[2012-03-13 14:13:00 -0400] ProfFalken: chef >
[2012-03-13 14:13:00 -0400] slyphon: haha
[2012-03-13 14:15:00 -0400] BryanWB: try   search(:node, 'recipes:bacula\:\:fd')
[2012-03-13 14:15:00 -0400] BryanWB: slyphon: i am pretty happy w/ chef-server myself, so far so good
[2012-03-13 14:16:00 -0400] slyphon: oh, yeah, me too, i'm just paranoid
[2012-03-13 14:16:00 -0400] ProfFalken: BryanWB: chef > search(:node, 'recipes:bacula\:\:fd') do |n|
[2012-03-13 14:16:00 -0400] ProfFalken: chef > puts n.name
[2012-03-13 14:16:00 -0400] ProfFalken: chef ?> end => true
[2012-03-13 14:16:00 -0400] ProfFalken: chef >
[2012-03-13 14:16:00 -0400] slyphon: 'git' involves fewer moving parts than 'chef-server'
[2012-03-13 14:16:00 -0400] slyphon: and less 'erlang'
[2012-03-13 14:16:00 -0400] ProfFalken: why is returning "true" without punting out the data?
[2012-03-13 14:16:00 -0400] ProfFalken: jtimberman: ^^
[2012-03-13 14:16:00 -0400] slyphon: (yes, i know, that's not accurate, it's just i like 'erlang' as a punchline)
[2012-03-13 14:17:00 -0400] ProfFalken: heh
[2012-03-13 14:20:00 -0400] BryanWB: ProfFalken: u aren't getting any matches
[2012-03-13 14:21:00 -0400] ProfFalken: and that generates "true"?
[2012-03-13 14:21:00 -0400] ProfFalken: Ssurely it should be "false"?
[2012-03-13 14:30:00 -0400] BryanWB: search returned an array []
[2012-03-13 14:30:00 -0400] ProfFalken: ah, ok
[2012-03-13 14:30:00 -0400] BryanWB: and an empty array is still a "value" of some kind
[2012-03-13 14:31:00 -0400] BryanWB: it isn't nil or false
[2012-03-13 14:31:00 -0400] ProfFalken: yeah, gotcha.
[2012-03-13 14:32:00 -0400] jonlives: ProfFalken: try puts n.has_key?("name"
[2012-03-13 14:33:00 -0400] ProfFalken: jonlives: it's not even finding the nodes at the moment... :(
[2012-03-13 14:33:00 -0400] jonlives: ah...
[2012-03-13 14:34:00 -0400] ProfFalken: even though "knife node show..." shows that the role (and recipe) is present, search(:node, "roles:...") and search(:node, "recipes:...") don't return anything
[2012-03-13 14:34:00 -0400] jonlives: when you say present, you mean it's uploaded, or it's been added to a node's runlist?
[2012-03-13 14:37:00 -0400] rays: if I remove a role that installs the software
[2012-03-13 14:38:00 -0400] rays: does that software get uninstalled, if not how should I handle that?
[2012-03-13 14:38:00 -0400] ProfFalken: jonlives: both
[2012-03-13 14:40:00 -0400] drrk: is there a way to get a chef debug shell
[2012-03-13 14:40:00 -0400] drrk: where I can inspect variables etc in the context of a chef run
[2012-03-13 14:41:00 -0400] hcastro: drrk: this may be what you're looking for: http://wiki.opscode.com/display/chef/Shef
[2012-03-13 14:42:00 -0400] drrk: cool, thanks
[2012-03-13 14:42:00 -0400] qhartman: drrk, the closest I've come to something like that is inserting ruby statements to print out the values
[2012-03-13 14:49:00 -0400] rgould: is there a recommended way of having one node invoke commands on other nodes? Invoking 'knife ssh' from a recipe?
[2012-03-13 14:51:00 -0400] qhartman: that's how I've done it. I don't know if that's the "right" way though.
[2012-03-13 14:52:00 -0400] rgould: it seems like there should be a better way, but it's the only thing i've thought of so far
[2012-03-13 14:53:00 -0400] qhartman: when I've needed to do more complicated stuff I've written a shell script and included that as a file for a recipe I know will be on the target box, then if another node needs to fire it off I can do it simply and keep the complexity out of the knife command
[2012-03-13 14:54:00 -0400] rgould: that's a good recommendation
[2012-03-13 14:54:00 -0400] rgould: keep it to 'knife ssh /script'
[2012-03-13 14:54:00 -0400] qhartman: exactly
[2012-03-13 14:56:00 -0400] qhartman: I include them in a "baseline" recipe that gets run on all my boxes so I can be sure they'll be available
[2012-03-13 14:59:00 -0400] rgould: cool, thanks qhartman
[2012-03-13 15:01:00 -0400] drrk: hcastro: is it possible to get shef to do the same as chef-client but when it throws an exception I can then interactivly look at what's up?
[2012-03-13 15:02:00 -0400] drrk: shef -z followed by run_chef doesn't seem to work
[2012-03-13 15:02:00 -0400] hcastro: i am not sure because i've never run it that way
[2012-03-13 15:02:00 -0400] hcastro: this is the best documentation i've seen on shef: http://stevendanna.github.com/blog/2012/01/28/shef-debugging-tips-1/
[2012-03-13 15:03:00 -0400] qhartman: sure thing rgould, I hope you find it useful.
[2012-03-13 15:07:00 -0400] BryanWB: jonlives: does etsy hire remote staff?
[2012-03-13 15:07:00 -0400] jonlives: BryanWB: I'm remote - really depends on the person :)
[2012-03-13 15:08:00 -0400] BryanWB: jonlives: good to know
[2012-03-13 15:09:00 -0400] drrk: hcastro: thanks, that's already helping me debug my issue
[2012-03-13 15:22:00 -0400] Yulya: hello guys
[2012-03-13 15:22:00 -0400] Yulya: how i can manage chef users and permisions using any cli or something?
[2012-03-13 15:22:00 -0400] Yulya: not by web ui
[2012-03-13 15:24:00 -0400] ssd7: Yulya: For Hosted Chef?
[2012-03-13 15:24:00 -0400] Yulya: hm
[2012-03-13 15:24:00 -0400] Yulya: what does mean "hosted chef"?
[2012-03-13 15:24:00 -0400] jbz: Yulya: The Opscode platform.  Opscode offers chef-as-a-service.
[2012-03-13 15:24:00 -0400] jbz: manage.opscode.com
[2012-03-13 15:25:00 -0400] Yulya: oh, nope
[2012-03-13 15:25:00 -0400] Yulya: i have my own chef instalation
[2012-03-13 15:25:00 -0400] ashb: jbz: otherway round no, hosted = you host it, platform = opscode one, no?
[2012-03-13 15:25:00 -0400] ssd7: Ahh, OK.  The permissions system is one of th biggest difference beteween the two
[2012-03-13 15:25:00 -0400] agoddard: ashb: hosted == platform
[2012-03-13 15:26:00 -0400] Yulya: well
[2012-03-13 15:26:00 -0400] jbz: ashb: I always take 'hosted' to mean 'somebody else does it.'
[2012-03-13 15:26:00 -0400] ashb: fairy
[2012-03-13 15:26:00 -0400] agoddard: anyone rockin additional LWRPs for the opscode firewall cookbook? Bonus points if they're on github and work on debian ;)
[2012-03-13 15:27:00 -0400] Yulya: ok, i host chef, can i manage users permissions?
[2012-03-13 15:29:00 -0400] ssd7: Yulya: The only real permissions for the open source server are admin v non-admin clients, which you can change with knife client edit CLIENTNAME
[2012-03-13 15:29:00 -0400] jbz: I don't think user permissions are granular on the open source server.  I think that's a platform-only thing, but I could be quite wrong.
[2012-03-13 15:29:00 -0400] agoddard: pretty sure jbz is right
[2012-03-13 15:29:00 -0400] Yulya: oh
[2012-03-13 15:29:00 -0400] Yulya: crap
[2012-03-13 15:30:00 -0400] ssd7: Hosted Chef has more granular permissions, but currently our command line tools for managing them are not very polished.
[2012-03-13 15:30:00 -0400] Yulya: oh
[2012-03-13 15:30:00 -0400] Yulya: anyway
[2012-03-13 15:30:00 -0400] Yulya: thnx
[2012-03-13 15:31:00 -0400] agoddard: Yulya: depending on what access you want to give them, the API with some separate (home grown) auth might give you what you want
[2012-03-13 15:31:00 -0400] Yulya: maybe chef may provide some api or something?
[2012-03-13 15:31:00 -0400] Yulya: yes, something like this
[2012-03-13 15:31:00 -0400] agoddard: Yulya: for example, if you just want to give someone read access, but admittedly that's a lot more work than being able to give them read only knife access
[2012-03-13 15:32:00 -0400] Yulya: i just want to allow nodes permission to delete themselves
[2012-03-13 15:32:00 -0400] lflux: is gem_package horrendously slow for anyone else?
[2012-03-13 15:32:00 -0400] lflux: or is it my fault for being behind a proxy
[2012-03-13 15:32:00 -0400] Yulya: in some cases clients keys may become corrupted, and i dont want to resolve this situations manualy
[2012-03-13 15:33:00 -0400] Yulya: is there any api in chef server?
[2012-03-13 15:33:00 -0400] agoddard: Yulya: http://wiki.opscode.com/display/chef/Server+API
[2012-03-13 15:35:00 -0400] jbz: lflux: I'm installing from rubygems.org and it seems OK to me
[2012-03-13 15:35:00 -0400] lflux: jbz: seriously it's taking 3 minutes
[2012-03-13 15:35:00 -0400] lflux: to do nothing
[2012-03-13 15:35:00 -0400] jbz: huh
[2012-03-13 15:36:00 -0400] jbz: Are you on local internet, or in a cloud somewhere?
[2012-03-13 15:36:00 -0400] jbz: My stuff is running on AWS...
[2012-03-13 15:36:00 -0400] jbz: so it might be cached, too...
[2012-03-13 15:36:00 -0400] lflux: On really good internet yes.
[2012-03-13 15:38:00 -0400] lflux: but the VM I'm running can't access HTTP directly. so I have a proxy.
[2012-03-13 15:38:00 -0400] lflux: and i've set 'http_proxy: http://proxy:3128' in /etc/gemrc
[2012-03-13 15:38:00 -0400] jbz: Is it completing *any* transactions?
[2012-03-13 15:39:00 -0400] jbz: lflux: Hm, also, is chef using system ruby/ruby gems?  i.e. is that the proper config loc?
[2012-03-13 15:39:00 -0400] lflux: only gem I have configured as a gem_package is pg
[2012-03-13 15:39:00 -0400] lflux: don't know if it's completing but it's not barfing, just taking a long time
[2012-03-13 15:40:00 -0400] jbz: lflux: Are you installing the gem manually or from chef?
[2012-03-13 15:40:00 -0400] jbz: If the latter, does it work if you do it manually?
[2012-03-13 15:40:00 -0400] lflux: from chef
[2012-03-13 15:41:00 -0400] lflux: gem binary works.
[2012-03-13 15:41:00 -0400] lflux: but it's a mystery as to whether the gem API picks up the proxy config
[2012-03-13 15:41:00 -0400] jbz: lflux: I think there's a way to force Chef to spawn an external gem process to do gem installs
[2012-03-13 15:41:00 -0400] jbz: I recall reading some warning in the gem_package resource docs about this
[2012-03-13 15:42:00 -0400] lflux: yes and it involves editing the cookbook which I don't want to do since it's a community cookbook
[2012-03-13 15:42:00 -0400] lflux: and it's a freaking proxy config
[2012-03-13 15:42:00 -0400] lflux: not rocket science :)
[2012-03-13 15:42:00 -0400] lflux: as in the API should pick it up
[2012-03-13 15:53:00 -0400] matthewv1rmaak: can i change the run_context for a specific recipe, and is there a tutorial illustrating that? :0)
[2012-03-13 15:55:00 -0400] lflux: is there really no other way to force the rubygems API to pick up proxy config?
[2012-03-13 15:58:00 -0400] hoover_damm: HTTP_PROXY should work mehopes
[2012-03-13 15:58:00 -0400] lflux: as in sudo env http_proxy=http://proxy:3128 chef-client
[2012-03-13 15:58:00 -0400] lflux: yeah that doesn't work
[2012-03-13 15:58:00 -0400] drrk: is sudo allowing http_proxt to be set?
[2012-03-13 15:59:00 -0400] drrk: afaik the default config doesn't allow it
[2012-03-13 15:59:00 -0400] lflux: if you do sudo env it works
[2012-03-13 16:00:00 -0400] hoover_damm: sudo su -c 'http_proxy=http://proxy:3128 chef-client'
[2012-03-13 16:00:00 -0400] hoover_damm: perhaps
[2012-03-13 16:00:00 -0400] hoover_damm: doesn't always match up
[2012-03-13 16:00:00 -0400] fearoffish: does anyone here have a pointer on how I install a new ruby with chef, and then restart using the new ruby?
[2012-03-13 16:00:00 -0400] hoover_damm: fearoffish, I'll tell you what I did for a client.
[2012-03-13 16:00:00 -0400] hoover_damm: omnibus bootstrap
[2012-03-13 16:01:00 -0400] hoover_damm: fearoffish, and they re-bootstrapped production in order to get the new version
[2012-03-13 16:01:00 -0400] drrk: the test is   sudo env http_proxy=http://proxy:3128 echo $http_proxy
[2012-03-13 16:01:00 -0400] jbz: fearoffish: We tried that and decided it was easier to upgrade the ruby during instance startup
[2012-03-13 16:01:00 -0400] fearoffish: hoover_damm: what is 'omnibus bootstrap'?
[2012-03-13 16:01:00 -0400] drrk: which on my machine gives me a blank line
[2012-03-13 16:01:00 -0400] jbz: what hoover_damm said :-)
[2012-03-13 16:01:00 -0400] hoover_damm: fearoffish, github.com/opscode/omnibus
[2012-03-13 16:01:00 -0400] hoover_damm: fearoffish, it's their fat full installer
[2012-03-13 16:02:00 -0400] fearoffish: oh, java?
[2012-03-13 16:02:00 -0400] lflux: hoover_damm: yeah that gives the same result
[2012-03-13 16:02:00 -0400] hoover_damm: fearoffish, otherwise modify your bootstrap to help you
[2012-03-13 16:02:00 -0400] fearoffish: gotcha, thanks, I'll go with a custom bootstrap
[2012-03-13 16:02:00 -0400] hoover_damm: fearoffish, bootstrapping a new configuration / is a bit cleaner then having a recipe to do it
[2012-03-13 16:02:00 -0400] hoover_damm: recipe would be nicer
[2012-03-13 16:02:00 -0400] hoover_damm: but makes me feel weird
[2012-03-13 16:02:00 -0400] hoover_damm: and i'm wrong for feeling weird
[2012-03-13 16:03:00 -0400] fearoffish: not so sure, feels weird to me too
[2012-03-13 16:03:00 -0400] fearoffish: 'start chef using ruby..install another ruby..restart chef', the more I think about it the more I think it's wrong
[2012-03-13 16:03:00 -0400] jbz: fearoffish: What we were doing before that was installing the new ruby and then restarting the chef-client service which we'd set up to use runit
[2012-03-13 16:03:00 -0400] jbz: but it was really brittle
[2012-03-13 16:03:00 -0400] fearoffish: that was an idea I was going to run with too, good to know we all agree :)
[2012-03-13 16:03:00 -0400] jbz: we ended up chasing our tails making sure that the old ruby was gone because we couldn't fully nuke it until after the restart, and so on.
[2012-03-13 16:04:00 -0400] rgould: i also recommend doing ruby upgrades in the bootstrap file
[2012-03-13 16:04:00 -0400] rgould: trying to upgrade running instances was a huge pain
[2012-03-13 16:05:00 -0400] rgould: especially since rubygems writes the location of the ruby exec in the bin wrappers
[2012-03-13 16:08:00 -0400] fearoffish: good point, thanks
[2012-03-13 16:10:00 -0400] lflux: nobody with deeper insights into getting the gem_package provider working with a proxy?
[2012-03-13 16:10:00 -0400] lflux: besides rewriting each recipe using gem_package
[2012-03-13 16:12:00 -0400] jbz: Monkeypatching the gem_package provider? ;_P
[2012-03-13 16:13:00 -0400] lflux: unironically considering this
[2012-03-13 16:14:00 -0400] jbz: That was only half-ironically suggested :)
[2012-03-13 16:16:00 -0400] lflux: gonna run strace to see what happens
[2012-03-13 16:16:00 -0400] lflux: before resorting to that
[2012-03-13 16:17:00 -0400] hoover_damm: to get it out of LC_ALL="C"
[2012-03-13 16:18:00 -0400] lflux: although it seems that it should pick up the configuration
[2012-03-13 16:20:00 -0400] hoover_damm: hacked the init script up
[2012-03-13 16:21:00 -0400] hoover_damm: and then decided naah let's monkeypatch the provider
[2012-03-13 16:21:00 -0400] hoover_damm: so i don't have to hack it up
[2012-03-13 16:21:00 -0400] jbz: lflux:  Could you do it by putting something in the environment?
[2012-03-13 16:22:00 -0400] lflux: I'm not entirely sure that chef-client passes on the environment
[2012-03-13 16:22:00 -0400] lflux: i'm running strace right now
[2012-03-13 16:24:00 -0400] lflux: no it's definitely using the proxy, it's just slow as hell
[2012-03-13 16:24:00 -0400] jbz: huh.  But it's not slow as hell using the binary directly?
[2012-03-13 16:25:00 -0400] jbz: that's...peculiar.
[2012-03-13 16:25:00 -0400] lflux: i'm getting "NOTE: Gem.source_index is deprecated, use Specification. It will be removed on or after 2011-11-01."
[2012-03-13 16:25:00 -0400] lflux: it looks like indexing is taking a long time
[2012-03-13 16:27:00 -0400] lflux: but yeah using the binary directly takes 13s
[2012-03-13 16:27:00 -0400] lflux: and why the hell is it trying to rebuild a native extension when that version is already installed
[2012-03-13 16:28:00 -0400] AntonZ: Greetings, ah good to be back to chef channel!
[2012-03-13 16:29:00 -0400] jbz: lflux: I don't think chef installs gems to the same place as the system rubygems, does it?
[2012-03-13 16:29:00 -0400] jbz: wait, that's probably due to my setup's peculiarity.
[2012-03-13 16:30:00 -0400] lflux: jbz: even so running 'gem install pg' twice in a row has it telling me 'Building native extensions'
[2012-03-13 16:30:00 -0400] jbz: lflux: Er, um, that doesn't sound right, no.
[2012-03-13 16:41:00 -0400] lflux: nope, wireshark says it's not talking to rubygems.org
[2012-03-13 16:41:00 -0400] lflux: forgot that chef does a lot of HTTP traffic...
[2012-03-13 16:47:00 -0400] rw2: if I have a node that has some packages installed by chef and I delete one of the files that chef has installed, should I expect chef to notice and reinstall the package that supplied it?
[2012-03-13 16:49:00 -0400] lflux: jbz: nope, forcing gem_binary didn't help
[2012-03-13 16:49:00 -0400] jbz: Doh.
[2012-03-13 16:49:00 -0400] lflux: well, it did something different
[2012-03-13 16:49:00 -0400] lflux: because the depreciated messages were a lot more.
[2012-03-13 16:49:00 -0400] jbz: rw2:  If the packaging system still sees the package as installed, then no.
[2012-03-13 16:50:00 -0400] lflux: but other than that it still takes over 3 minutes.
[2012-03-13 16:50:00 -0400] rw2: jbz yeah, that's the behavior I'm seeing. Ok, so when people say that chef keeps your machine in a known configuration, they really mean at a package level, not anything 'smarter' than that.
[2012-03-13 16:50:00 -0400] rw2: jbz right?
[2012-03-13 16:50:00 -0400] jbz: rw2:  Well, unless you write chef code to check at the file level, yes.
[2012-03-13 16:51:00 -0400] jbz: You can certainly *make* it do that, but that's pretty heavyweight for a regular check.
[2012-03-13 16:51:00 -0400] rw2: jbz yeah, then it wouldn't be chef doing it. it would be me. :-)
[2012-03-13 16:51:00 -0400] jbz: rw2:  Meh, depends how you look at it.
[2012-03-13 16:51:00 -0400] jbz: Chef doesn't do anything you don't tell it to. :-)
[2012-03-13 16:51:00 -0400] lflux: at this point i'm kinda curious to what is actually happening.
[2012-03-13 16:52:00 -0400] rw2: jbz I have a need for this, so just understanding what is done out of the box. if chef doesn't do it natively, then we will probably write another process that does external to chef. then it can be used with chef/puppet/kickstart or whatever.
[2012-03-13 16:53:00 -0400] jbz: rw2: Yeah.
[2012-03-13 16:53:00 -0400] jbz: rw2: Which packaging system are you using?
[2012-03-13 16:53:00 -0400] rw2: rpm, tarball, dpkg
[2012-03-13 16:54:00 -0400] jbz: oh tarball, yeah, that's a problem.
[2012-03-13 16:55:00 -0400] rw2: there is a lot that's difficult about this project. but the requirements that drive it are legit, so not much we can do.
[2012-03-13 16:55:00 -0400] rw2: and I suppose if everything was always easy I wouldn't be able to make a living at it.
[2012-03-13 16:59:00 -0400] jbz: yeah I know that feeling.
[2012-03-13 18:01:00 -0400] ssd7: Ohai Chefs!
[2012-03-13 18:03:00 -0400] maek: can anyone talk about what happens at chef conf? like day 1 vs day 2 and 3?
[2012-03-13 18:15:00 -0400] ssd7: maek: I know we will have some more detailed information out soon, but I'm unsure whether it will include a full agenda yet.
[2012-03-13 18:22:00 -0400] maek: ssd7: so ive never been to a proper conf. Tuesday is called workshop and wed/thur are called conference. does that mean no informative talks during wed/thur?
[2012-03-13 18:23:00 -0400] jtimberman: maek: the bulk of the talks are going to be on wed/thu
[2012-03-13 18:23:00 -0400] maek: jtimberman: ty!
[2012-03-13 18:23:00 -0400] jtimberman: maek: the workshop day is going to be a getting started / new user training day
[2012-03-13 18:23:00 -0400] c_t: the illegal boxing matches will be on Tuesday
[2012-03-13 18:23:00 -0400] jtimberman: like compressed version of Chef Fundamentals
[2012-03-13 18:23:00 -0400] jtimberman: c_t: I'm not involved in organization of anything like that.
[2012-03-13 18:24:00 -0400] c_t: plausible deniability
[2012-03-13 18:24:00 -0400] maek: jtimberman: so if I use chef as a scripting tool basically and im just getting the power of lwrp would day one be useful?
[2012-03-13 18:25:00 -0400] jtimberman: maek: the workshop format hasn't been finalized, so its hard to say whether that part will be useful.
[2012-03-13 18:26:00 -0400] jtimberman: maek: we're going to have a meeting later this afternoon about the conference and there will be program announcements and the like "coming soon"
[2012-03-13 18:26:00 -0400] maek: jtimberman: thanks
[2012-03-13 18:27:00 -0400] maek: ill have to bring like 5k. my gut tells me I owe so many people in here so many beers. it will be nice to be able to pay up :)
[2012-03-13 18:34:00 -0400] geekbri: wish i could attend
[2012-03-13 18:34:00 -0400] geekbri: schedule one on the east coast sometime :-P
[2012-03-13 18:34:00 -0400] hcastro: is there a mechanism for include_recipe that mimics gem_package "r.run_action(:install)" approach?
[2012-03-13 18:38:00 -0400] cwj: hcastro: i think the correct approach would be to put the included recipe in the run list, ahead of the recipe doing the including
[2012-03-13 18:39:00 -0400] hcastro: cwj: my scenario is that i'm installing a gem via the r.run_action(:install) approach, but it requires gcc to compile c extensions
[2012-03-13 18:40:00 -0400] hcastro: i could require people using the cookbook to add "build-essential" to the run list before it, but that means having a cookbook that doesn't work on its own
[2012-03-13 18:40:00 -0400] cwj: yeah that wouldn't actually do the trick anyway
[2012-03-13 18:40:00 -0400] cwj: and cookbook dependencies are kind of just a fact of life
[2012-03-13 18:41:00 -0400] cwj: you probably need to make a list of the required packages and use the same run_action(:install) approach for those
[2012-03-13 18:41:00 -0400] hcastro: that's pretty much what i have now -- sucks because all of the platforms are covered by the build-essential cookbook already
[2012-03-13 18:42:00 -0400] cwj: or refactor your local copy of build-essential to use that approach, define it as a dependency for your cookbook and put your modified build-essential in the run_list ahead of your cookbook
[2012-03-13 18:43:00 -0400] cwj: you could also consider using some guards like "if Gem.available('foo')" to protect bits of your recipe from running until the required gem can be compiled in a subsequent chef run
[2012-03-13 18:44:00 -0400] cwj: like, don't try to compile the gem until gcc is installed, don't try to use logic that calls the gem until it is installed
[2012-03-13 18:44:00 -0400] cwj: so your recipe won't do much until the second time it is run
[2012-03-13 18:46:00 -0400] cwj: maybe i am overthinking it, others might have a better suggestion
[2012-03-13 19:03:00 -0400] rw2: jbz, still there?
[2012-03-13 19:04:00 -0400] geekbri: hcastro: you could always write things in a pure ruby block and they will run pretty much last.  Therefore the things will be installed when they fire off
[2012-03-13 19:05:00 -0400] hcastro: doesn't the ruby block make them run first?
[2012-03-13 19:10:00 -0400] geekbri: a ruby_block will run last I believe.
[2012-03-13 19:11:00 -0400] geekbri: hcastro: note, a ruby_block, not just ruby code in your recipe.  Ruby code in your recipe will happen first, ruby code inside of a ruby_block will happen last
[2012-03-13 19:11:00 -0400] geekbri: hcastro: check out the section called "ruby_block" http://wiki.opscode.com/display/chef/Resources
[2012-03-13 19:16:00 -0400] jbz: rw2: ping?
[2012-03-13 19:17:00 -0400] rw2: jbz hey, so constraining my question for before. is there a way to easily get chef to do something like yum verify or rpm verify on packages?
[2012-03-13 19:17:00 -0400] jbz: hm
[2012-03-13 19:17:00 -0400] jbz: The question is how to use the result
[2012-03-13 19:17:00 -0400] jbz: you can always use an execute block or similar to do that
[2012-03-13 19:18:00 -0400] jbz: you'd probably want to wrap it in a script that passed structured result info to Chef
[2012-03-13 19:18:00 -0400] jbz: because I presume if those fail to verify they return non-zero
[2012-03-13 19:18:00 -0400] jbz: which to Chef breaks convergence
[2012-03-13 19:21:00 -0400] rw2: ok, I understand the approach. brand new to chef and ruby though. I know how to read. Got a url you could point me to that has related doc?
[2012-03-13 19:21:00 -0400] jbz: rw2:  Sure, one sec.
[2012-03-13 19:21:00 -0400] jbz: rw2: you'd use this: http://wiki.opscode.com/display/chef/Resources#Resources-Execute
[2012-03-13 19:23:00 -0400] jbz: rw2: and then notify a resource or script execute which forced a scrub of the existing packages if it returned a problem.
[2012-03-13 19:23:00 -0400] jbz: If you can do an rpm verify that autofixes
[2012-03-13 19:23:00 -0400] kreedy: I assume http://tickets.opscode.com/browse/CHEF-1827 (Git provider should recursively update/init submodules) will be fixed in 0.10.10, right? Any idea when that is being released?
[2012-03-13 19:23:00 -0400] jbz: then you could just do that every convergence, and so long as it returned zero, you'd be good.
[2012-03-13 19:24:00 -0400] jbz: That's a lot of thrashing, though, so you'd probably either want to run chef-client 'on demand' rather than as a daemon, or have a really long daemon interval time.
[2012-03-13 19:25:00 -0400] rw2: really long daemon time is fine for this project
[2012-03-13 19:25:00 -0400] jbz: Yeah, then that should be what you need.  Can you make yum-verify autofix?
[2012-03-13 19:25:00 -0400] jbz: If so, then no chef logic needed, just an execute resource to run the command.
[2012-03-13 19:27:00 -0400] rw2: hmm, let me see about that.
[2012-03-13 19:29:00 -0400] rw2: yeah, I don't see autofix on the manpage. was wondering how I missed that.
[2012-03-13 19:30:00 -0400] rw2: jbz, is that only available on some distros?
[2012-03-13 19:31:00 -0400] jbz: no I dunno
[2012-03-13 19:31:00 -0400] jbz: I was making assumptions.
[2012-03-13 19:31:00 -0400] jbz: It looks like it doesn't do that.
[2012-03-13 19:31:00 -0400] jbz: So what you're running up against
[2012-03-13 19:31:00 -0400] jbz: is a situation where you're using chef to try to handle changes that happen outside of chef
[2012-03-13 19:31:00 -0400] jbz: and happen below the granularity of your chef recipe.
[2012-03-13 19:31:00 -0400] jbz: This is hard, and will probably require code.
[2012-03-13 19:32:00 -0400] jbz: (For example, we would solve this problem by a) making sure nothing besides Chef was making changes to our system, and threatening to shoot any engineer who logged onto it and touched anythign).
[2012-03-13 19:33:00 -0400] spacey_: Hey, quick question before I post it to the list
[2012-03-13 19:33:00 -0400] jbz: basically, your change is happening at a level that chef doesn't play at.
[2012-03-13 19:34:00 -0400] rw2: jbz, yeah, absolutely it is. you've given me some good pointers on chef in any case, thanks.
[2012-03-13 19:34:00 -0400] jbz: Most welcome, anytime.
[2012-03-13 19:34:00 -0400] jbz: rw2:  If I had to approach that problem
[2012-03-13 19:35:00 -0400] jbz: I'd first build something outside of chef that just reinstalled all the apt packages currently installed
[2012-03-13 19:35:00 -0400] spacey_: Is it possible to configure chef such that when a node is bootstrapped, INFO logs are generated on the node, but only NOTICE and higher are sent to stdout?
[2012-03-13 19:35:00 -0400] jbz: and then I'd have chef call the verify command, and if it failed, call that thing.
[2012-03-13 19:39:00 -0400] spacey_: Anyone know the mixlib-log system well?
[2012-03-13 19:39:00 -0400] rw2: jbz, yup, that makes sense. yum verify or rpm verify can tell me if stuff has changed. can I force chef to do an install? like call my script and if it fails then tell chef "no, really, I want to install package X again"?
[2012-03-13 19:39:00 -0400] jbz: no, don't do that
[2012-03-13 19:39:00 -0400] jbz: because chef only triggers an install if the package is not there
[2012-03-13 19:39:00 -0400] jbz: you can force it, but then it's a big PITA
[2012-03-13 19:40:00 -0400] jbz: because you have to deal with every place chef installs a package in every cookbook.
[2012-03-13 19:40:00 -0400] jbz: Better plan is to write a script outside of chef
[2012-03-13 19:40:00 -0400] jbz: which first dumps the list of installed packages according to the RPM db
[2012-03-13 19:40:00 -0400] jbz: and then methodically force-reinstalls all of them.
[2012-03-13 19:41:00 -0400] jbz: (or 'refreshes' them or whatever operation in RPM will fix what happened.)
[2012-03-13 19:41:00 -0400] jbz: Then, *only when the verify fails*, just call that script from chef using execute.
[2012-03-13 19:41:00 -0400] spacey_: rw2, jbz, why not just specify :upgrade to the package resource?
[2012-03-13 19:42:00 -0400] jbz: spacey_:  That might be what he wants.  The problem is that we won't know *which package is damaged.  He wants to handle the situation where someone fiddles an individual file somewhere on the box and breaks an unknown package.
[2012-03-13 19:42:00 -0400] jbz: So as far as *chef* is concerned, the package will still be installed and be fine, because RPM will think it is.
[2012-03-13 19:43:00 -0400] jbz: But in actuality, it'll be broken.
[2012-03-13 19:43:00 -0400] rw2: worse than broken: compromised
[2012-03-13 19:43:00 -0400] jbz: So rather than try to tweak chef into being able to figure out which package is mendaciously reporting that all is well
[2012-03-13 19:43:00 -0400] jbz: (right)
[2012-03-13 19:43:00 -0400] jbz: I'm advocating the Bigger Hammer approach:
[2012-03-13 19:43:00 -0400] jbz: whenever *anything* goes wrong, force *every package* to get force-upgraded or force-reinstalled, whichever operation makes more sense
[2012-03-13 19:44:00 -0400] jbz: (I'm not RPM-expert anymore).
[2012-03-13 19:44:00 -0400] jbz: If whoever screws up the machine does so by actually downgrading or uninstalling an RPM package
[2012-03-13 19:44:00 -0400] jbz: chef will catch that as-is, no problem.
[2012-03-13 19:44:00 -0400] pcn: Oh, I see.  So you want the rpm checksum output, and then use that to feed into a loop with the package resource is what it sounds like
[2012-03-13 19:44:00 -0400] jbz: pcn: Yep
[2012-03-13 19:44:00 -0400] jbz: If rpm -Va spits out a list of compromised packages, use that. E.G.
[2012-03-13 19:45:00 -0400] jbz: pcn:  Actually, no
[2012-03-13 19:45:00 -0400] jbz: pcn:  That's an elegant way to do it
[2012-03-13 19:45:00 -0400] jbz: :-)
[2012-03-13 19:45:00 -0400] jbz: I was advocating writing an outside 'HAMMER' script that just force-fixed *everything in the RPM DB*
[2012-03-13 19:45:00 -0400] jbz: and then having chef run the 'verify' script, and if that failed, HAMMER TIME.
[2012-03-13 19:45:00 -0400] pcn: %x{ rpm -Va | grep badpackage }.each do |pkg| package pkg # with a force-hammer
[2012-03-13 19:45:00 -0400] jbz: Then Chef wouldn't have to care.
[2012-03-13 19:45:00 -0400] jbz: and, pcn is in fact the way smarter one here. :-)
[2012-03-13 19:46:00 -0400] pcn: Hmm, seems six of one, half dozen of the other
[2012-03-13 19:46:00 -0400] pcn: Anyway, I'll be back.  I want to find out more about logging, but I gotta run out for a min
[2012-03-13 19:46:00 -0400] siezer: jbz you see this yet? http://www.meetup.com/chef-nyc
[2012-03-13 19:46:00 -0400] jbz: pcn:  No no, yours is better, I was just being lazy because I'm a terrible coder.
[2012-03-13 19:46:00 -0400] jbz: siezer: Heh I had not, many thanks.
[2012-03-13 19:49:00 -0400] siezer: jbz I'll probably end up talking at the first one, but they're definitely looking for content / local speakers
[2012-03-13 19:50:00 -0400] bkmontgomery: Hi. Does anyone one know of a cookbook that can be used to install arbitrary system packages?
[2012-03-13 19:51:00 -0400] bkmontgomery: Maybe something that just lets me list things in an attribute (e.g. libawesomething) and it just gets installed.
[2012-03-13 19:52:00 -0400] asg: bkmontgomery: should be trivial to write one using the package resource that iterates over some node attribute array
[2012-03-13 19:53:00 -0400] bkmontgomery: asg: yep, I know how I'd do it, but I don't want to reinvent the wheel if someone's already done this.
[2012-03-13 19:53:00 -0400] cwj: bkmontgomery: i dont know if there's one on the community site but as asg said, its very easy to do
[2012-03-13 19:53:00 -0400] cwj: here's how i do it using a data bag
[2012-03-13 19:53:00 -0400] cwj: https://gist.github.com/2031153
[2012-03-13 19:53:00 -0400] Brad_K: bkmontgomery:
[2012-03-13 19:53:00 -0400] Brad_K: %w( htop links screen socat sysstat tcpdump ).each do |pkg|
[2012-03-13 19:53:00 -0400] Brad_K:   package pkg do
[2012-03-13 19:53:00 -0400] Brad_K:     action :install
[2012-03-13 19:53:00 -0400] Brad_K:   end
[2012-03-13 19:53:00 -0400] Brad_K: end
[2012-03-13 19:54:00 -0400] bkmontgomery: cool. Thanks guys.
[2012-03-13 19:54:00 -0400] Brad_K: that's pretty much the entire contents of the cookbook we have that does this sort of thing.  just list all the packages you want in the %w expansion.
[2012-03-13 19:54:00 -0400] asg: bkmontgomery: take waht Brad_K gave you, put it in a cookbook, and stick it on github so nobody else has to reinvent the wheel :)
[2012-03-13 19:54:00 -0400] bkmontgomery: asg: that's probably what I'm going to do. or at least some version of that...
[2012-03-13 19:54:00 -0400] asg: bkmontgomery: awesome
[2012-03-13 19:55:00 -0400] bkmontgomery: now... what to name the thing?
[2012-03-13 19:55:00 -0400] Brad_K: the only thing i can think of that would improve this recipe would be to use default attributes which could be over-ridden by the role definition.
[2012-03-13 19:55:00 -0400] Brad_K: we called the cookbook "utils".  but you can call it fred, or george, or smarmy, or whatever you want.
[2012-03-13 19:55:00 -0400] asg: bkmontgomery: required_system_packages?
[2012-03-13 19:56:00 -0400] bkmontgomery: I may go with a repo named "chef-system-packages"
[2012-03-13 19:56:00 -0400] asg: seems fair
[2012-03-13 19:56:00 -0400] bkmontgomery: err, "chef-system_packages"
[2012-03-13 19:56:00 -0400] bkmontgomery: I've been putting my cookbooks in individual repos prefixed with "chef-"
[2012-03-13 19:56:00 -0400] Brad_K: be careful naming things with dashes.  some packages (like zenoss) iterate on all the names of all the things, but they can't handle dashes in the name.
[2012-03-13 19:56:00 -0400] lusis: we had a company_packages cookbook
[2012-03-13 19:57:00 -0400] bkmontgomery: Brad_K: right, I meant to use an underscore.
[2012-03-13 19:57:00 -0400] lusis: and the attributes were a list of packages that always got upgraded/installed
[2012-03-13 19:57:00 -0400] bkmontgomery: Brad_K: the cookbook would show up as "system_packages"
[2012-03-13 19:58:00 -0400] siezer: I call mine "base-debug-tool"
[2012-03-13 19:58:00 -0400] Brad_K: i'm just saying that i've gone through the pain of having to rename large numbers of roles and cookbooks, and that i can tell you that this is not a pain that you want to go through  not if you can avoid it.
[2012-03-13 19:58:00 -0400] bkmontgomery: lusis: any need/desire to specify versions of the packages?
[2012-03-13 19:58:00 -0400] asg: bkmontgomery: we called ours holy_crap_lions but I'm sure others have more generic names
[2012-03-13 19:58:00 -0400] siezer: lsof, strace, etc
[2012-03-13 19:58:00 -0400] bkmontgomery: Brad_K: agreed! Thanks for the heads up :)
[2012-03-13 19:59:00 -0400] Brad_K: sigh.  someone's mucking about with the network connection again.  ;-(
[2012-03-13 19:59:00 -0400] bkmontgomery: asg: I'm still lolling about that.
[2012-03-13 20:00:00 -0400] Brad_K: i was thinking that something like "smarmy_barmy_bam_a_lama_licktious" would be a fun name.
[2012-03-13 20:00:00 -0400] Brad_K: the cookbook name could be longer than the entire contents of the cookbook itself!
[2012-03-13 20:05:00 -0400] bkmontgomery: Brad_K: swarmy_barmy_whammo_blammo_bama_mama_a_lama_licktious ?
[2012-03-13 20:05:00 -0400] asg: Brad_K: Now that's a challenge; I wonder if there are internal limits on cookbook name length?
[2012-03-13 20:07:00 -0400] Brad_K: asg: you have the source.  it's just a small matter of finding the reference.  ;-)
[2012-03-13 20:07:00 -0400] asg: Brad_K: indeed
[2012-03-13 20:09:00 -0400] lusis: you'd likely run into some couch limitation first
[2012-03-13 20:10:00 -0400] Brad_K: lusis: you've got the source.  it's just a small matter of finding the reference.  ;->
[2012-03-13 20:10:00 -0400] asg: hah
[2012-03-13 20:14:00 -0400] tortoise_: So if you remove a run list from a Chef Node, is it possible to have Chef perform clean up on that node? So that stale files are removed, (as in that which are no longer being used, nagios.cfg.. etc..)
[2012-03-13 20:15:00 -0400] lusis: tortoise_: no
[2012-03-13 20:15:00 -0400] jbz: tortoise_: Not generally.  Chef won't *uninstall* things you tell it to stop configuring.
[2012-03-13 20:15:00 -0400] lusis: kill the node and reprovision it
[2012-03-13 20:15:00 -0400] lusis: with a new run_list ;)
[2012-03-13 20:15:00 -0400] jbz: Chef really shines in VM environments
[2012-03-13 20:15:00 -0400] jbz: as lusis just noted. :-)
[2012-03-13 20:15:00 -0400] lusis: hahaha
[2012-03-13 20:16:00 -0400] jbz: We have some cookbooks which do remove things, mostly for security reasonsi.e. we have a cookbook which installs ssh keys, and we want to be able to deauthorize users without having to reprovision nodes, so that cookbook will in fact remove accounts which are no longer in the data bag.
[2012-03-13 20:16:00 -0400] lusis: yeah
[2012-03-13 20:16:00 -0400] lusis: I have a deleted_users databag
[2012-03-13 20:17:00 -0400] lusis: that's always checked
[2012-03-13 20:17:00 -0400] jbz: lusis:  Yeah, that's probably safer.
[2012-03-13 20:17:00 -0400] jbz: We just nuke any user that isn't explicitly listed above a certain UID.
[2012-03-13 20:17:00 -0400] lusis: hahaha
[2012-03-13 20:17:00 -0400] lusis: slash and burn!
[2012-03-13 20:17:00 -0400] asg: slay(1)
[2012-03-13 20:18:00 -0400] jbz: REVOKE HIS KEY AND CAST HIM OUT
[2012-03-13 20:18:00 -0400] jbz: hahaha
[2012-03-13 20:18:00 -0400] jbz: derez(1)
[2012-03-13 20:21:00 -0400] pcn: So, anyone here know the ins-and-outs of Chef::Log aka mixlib-log aka logging?
[2012-03-13 20:22:00 -0400] asg: pcn: what are you trying to do ... or what issue are you dealing with?
[2012-03-13 20:23:00 -0400] pcn: I'm using cluster_chef aka ironfan.  If I want to launch a dozen systems I get spammed on the console and while I can see the progress, I can't see anything specific.
[2012-03-13 20:23:00 -0400] pcn: What I need to do for now is to log <=INFO -> local file on node, and >INFO -> stdout
[2012-03-13 20:24:00 -0400] pcn: I see failures, see NOTICEs, but I don't get told about every action.
[2012-03-13 20:25:00 -0400] pcn: I can't afford to lose INFO since I want to have a complete log - the stacktrace is really the main debugging tool when runs fail, but it's really useful to have Chef::Log.info("foo happened") and be able to see those markers in context in the full log
[2012-03-13 20:26:00 -0400] pcn: In addition, my use case is that I'm doing continuous deployment so I don't ever want chef to run twice, so I don't need to think about subsequent runs
[2012-03-13 20:28:00 -0400] pcn: Another meeting.  I'll keep looking for good docs.  By itself the logger module looks too simplistic to e.g. allow me to set up a log target for one threshold and a second target for another threshold
[2012-03-13 20:32:00 -0400] Brad_K: pcn: so far as i know, the current log functionality is a single target for everything  either to the console, or to a log file (by default, /var/log/chef/client.log, or somesuch).  within chef, there isn't a concept of syslog type log facilities or sending different log levels to different locations, etc.
[2012-03-13 20:34:00 -0400] Brad_K: so, does anyone have any idea how i can go about finding out the date/time stamp when a particular node/client was first created?
[2012-03-13 20:34:00 -0400] pcn: The facilities are ther eform the ruby logger.  e.g. log_level and log_location can be specified in knife.rb and maybe other places depending on some other stuff
[2012-03-13 20:34:00 -0400] Brad_K: i've gone through the online documentation as much as i can, looked at all the information for "knife node show" and "knife status", and i'm not seeing any obvious way to get the information on when a given node/client was created.
[2012-03-13 20:35:00 -0400] asg: Brad_K: you could probably get that info from stat on the root filesystem mountpoint
[2012-03-13 20:35:00 -0400] pcn: If you need approx, you should stuff a value into node data for later
[2012-03-13 20:36:00 -0400] Brad_K: that would help for the node, but not the client.  like, if an old client was left over from a previous node, and then you go to create a new node with the same name as a previous client.
[2012-03-13 20:37:00 -0400] pcn: looks like you need an rfc from opscode for the server to add that to the client
[2012-03-13 20:38:00 -0400] pcn: If you're querying the couchdb directly you can probably find out more
[2012-03-13 20:41:00 -0400] pcn: *grumble grumble* it looks like I'll have to monkeypatch the chef logger
[2012-03-13 20:45:00 -0400] pcn: http://stackoverflow.com/questions/6407141/how-can-i-have-ruby-logger-log-output-to-stdout-as-well-as-file
[2012-03-13 20:46:00 -0400] lusis: is there a reason chef handlers won't work?
[2012-03-13 20:46:00 -0400] lusis: they exist
[2012-03-13 20:46:00 -0400] lusis: if your first thought is to jump to monkey patching, it's probably worth stepping back a step ;)
[2012-03-13 20:47:00 -0400] StormSilver: Ohai chefs!
[2012-03-13 20:47:00 -0400] StormSilver: Does anyone have support for supplying personality files to `knife rackspace server create` offhand?
[2012-03-13 20:48:00 -0400] StormSilver: Doesn't seem to be in knife-rackspace, although I've found (really old) patches for adding it.
[2012-03-13 20:48:00 -0400] pcn: lusis AFAIK handlers only fire at the end of the run.  That won't work for providing feedback (the >INFO case), and if I'm not actually logging all <=INFO too, the handler won't have the data I want at the end
[2012-03-13 20:50:00 -0400] jbz: pcn:  wait, what are you trying to do?
[2012-03-13 20:51:00 -0400] jbz: pcn:  I have a chef handler that at the end of the run goes back and finds just the log lines from the last run and stores them somewhere (and optionally saves 'em to S3).
[2012-03-13 20:51:00 -0400] jbz: Does that help?
[2012-03-13 20:52:00 -0400] jbz: You can run it as an error handler, and then it *should* get fired even if the run tanks.
[2012-03-13 20:53:00 -0400] Brad_K: StormSilver: you mean, bootstrap files?  those are commonly used across all types of providers.
[2012-03-13 20:53:00 -0400] pcn: I'm trying to log less to STDOUT and log more to a file (or handler).  But I don't want to see about 99% of the data in the run unless I look in the log
[2012-03-13 20:54:00 -0400] StormSilver: Brad_K: No, rackspace specifically has the ability to inject files at server creation time. I might be able to go around it a different way... if support isn't there for it, it's probably because people have found a different way. :)
[2012-03-13 20:54:00 -0400] Brad_K: StormSilver: sounds like a bootstrap file to me.
[2012-03-13 20:56:00 -0400] jbz: pcn:  So my handler, at the end of the run, goes to the chef log file and gets only those lines from the run that triggered it.  So it will end up giving you just that run.  And you won't see it unless you look at it.
[2012-03-13 20:56:00 -0400] pcn: jbz, will it do this:
[2012-03-13 20:56:00 -0400] pcn: NOTICE: print to stdout
[2012-03-13 20:56:00 -0400] pcn: WARNING: print to stdout
[2012-03-13 20:57:00 -0400] pcn: interactively, as the run proceeds
[2012-03-13 20:57:00 -0400] jbz: pcn: No.  It doesn't print anything to stdout, and doesn't do anything until the end of the run.  Noted.
[2012-03-13 20:57:00 -0400] pcn: INFO/DEBUG/etc. log to file (can be at the end
[2012-03-13 20:57:00 -0400] pcn: Yeah, that's my pain.  I want notice to provide markers like "the important part has happened"
[2012-03-13 20:57:00 -0400] jbz: I can think of a heavyweight way to do this, though.
[2012-03-13 20:57:00 -0400] jbz: It's just a lotta work. :-)
[2012-03-13 20:58:00 -0400] jbz: You could set up rsyslog to do text-file following on the chef log and send it to a log aggregator like papertrail.com
[2012-03-13 20:58:00 -0400] pcn: log all, tail -f | egrep 'NOTICE|WARN|ERROR|CRIT' logfile ? :)
[2012-03-13 20:58:00 -0400] jbz: and then do live searches on it.
[2012-03-13 20:58:00 -0400] maek: does the chef-server cookbook not provide an attribute to switch to nginx?
[2012-03-13 20:58:00 -0400] jbz: I use papertrail to live-tail log regexps across our entire infrastructure, it is fairly cool.
[2012-03-13 20:58:00 -0400] Brad_K: maek: not so far as i know.
[2012-03-13 20:59:00 -0400] pcn: Yeah, could shovel it to graylog2, same idea, but it doesn't just show you your run, exclusive of other users
[2012-03-13 20:59:00 -0400] jbz: sure it does
[2012-03-13 20:59:00 -0400] jbz: you can put a node IP or name into the search
[2012-03-13 20:59:00 -0400] jbz: and only that node's logs will come up.
[2012-03-13 21:00:00 -0400] pcn: It's possible, but it's probably more work than monkeypatching, and it makes dev do a lot more work.  The problem is that dev a can launch a foo cluster, and so can dev b.
[2012-03-13 21:00:00 -0400] jbz: At this very moment, I'm watching a single node out of some six dozen converge, despite them all logging to the same address:port. :0)
[2012-03-13 21:00:00 -0400] jbz: Hm.
[2012-03-13 21:01:00 -0400] Brad_K: pcn: you know, if you're using ironfan and you're having issues with logging, it seems to me that you need to be talking to Flip Kromer and the guys at Infochimps.  i think they're the ones that would be best suited to help you with your logging issues.  they already do flume integration, i believe.
[2012-03-13 21:01:00 -0400] pcn: They have a longer term plan, but what I need is not in place in the next 2 months
[2012-03-13 21:01:00 -0400] maek: Brad_K: I see nginx_proxy in the recipes dir for chef-server, but nothing about how to turn it on
[2012-03-13 21:02:00 -0400] Brad_K: maek: so far as i know, that is a "to be filled in later" type of thing.
[2012-03-13 21:03:00 -0400] Brad_K: biab
[2012-03-13 21:04:00 -0400] maek: Brad_K: ty
[2012-03-13 21:09:00 -0400] lusis: I don't understand why you need it to be displayed that way I guess
[2012-03-13 21:11:00 -0400] pcn: The use case is a dozen systems lauch.  The dev launching them (e.g. integration test) is looking to make sure there are no errors.  They get feedback from NOTICE, WARNING, etc.  INFO gets logged to a file so upon errors, the progress and e.g. values at points in time can be logged (or use DEBUG all the time)
[2012-03-13 21:12:00 -0400] lusis: I don't have a helpful response except to say: this is not a job for a human
[2012-03-13 21:12:00 -0400] pcn: Launching a dev cluster of servers to confirm that the launch succeeds?
[2012-03-13 21:12:00 -0400] lusis: too focused on the micro
[2012-03-13 21:12:00 -0400] lusis: does the cluster work? that's the question
[2012-03-13 21:12:00 -0400] pcn: Right, it's for the dev cycle
[2012-03-13 21:12:00 -0400] lusis: write some "integration" tests that exercise the cluster
[2012-03-13 21:13:00 -0400] lusis: much saner than monkeypatching mixlib-log and having to maintain that drift
[2012-03-13 21:13:00 -0400] pcn: That's the question in qa/prod, but prior to that when everything is moving parts, there's also a question of "did the deploy work, and if not what do I need to fix"
[2012-03-13 21:13:00 -0400] lusis: right but if you can't express what constitutes a working deploy, the loglines aren't going to help
[2012-03-13 21:14:00 -0400] lusis: sorry, not trying to be confrontational here
[2012-03-13 21:14:00 -0400] pcn: Sure, that's just too high level
[2012-03-13 21:14:00 -0400] miah: moin
[2012-03-13 21:14:00 -0400] lusis: point being the chef run will either bail or run to completion
[2012-03-13 21:14:00 -0400] lusis: at the end, the cluster will either provide or not provide the service
[2012-03-13 21:15:00 -0400] lusis: if it bails, THEN use an error handler or the log output
[2012-03-13 21:17:00 -0400] pcn: lusis here's another part of the issue: it saves a lot of time in, say, a 15 minute deploy if 1 system fails hard in 3 minutes, but the rest run to hard failure because of that at 15... the 3 minute failure saves 12 minutes of time
[2012-03-13 21:17:00 -0400] pcn: These are inter-dependent launches, so there's a lot going on
[2012-03-13 21:17:00 -0400] lusis: I get you. I guess I would implement timeouts
[2012-03-13 21:17:00 -0400] lusis: I mean that's what I did in the Noah LWRP
[2012-03-13 21:18:00 -0400] lusis: either let it continue converging or not
[2012-03-13 21:18:00 -0400] pcn: No timeout, just A fails faster, B does lots of stuff and only talks to A, and is only ready to talk to A, at the end
[2012-03-13 21:18:00 -0400] lusis: right
[2012-03-13 21:18:00 -0400] lusis: I know this problem ;)
[2012-03-13 21:19:00 -0400] lusis: but having B do all it's stuff is happening in parallel, no?
[2012-03-13 21:19:00 -0400] lusis: so you've not lost that time
[2012-03-13 21:19:00 -0400] pcn: lusis There isn't inherent parallelism in a chef run, so probably not
[2012-03-13 21:19:00 -0400] lusis: B is over here doing blah blah and then pauses to wait for A to finish?
[2012-03-13 21:20:00 -0400] pcn: Yeah, or loops wiating
[2012-03-13 21:20:00 -0400] lusis: or is this all running sequentially?
[2012-03-13 21:20:00 -0400] pcn: Simultaneous launch
[2012-03-13 21:22:00 -0400] lusis: I guess in my mind you have to trade off the maintenance of a monkey patch vs. the small delay in timing out waiting on a dependent resource
[2012-03-13 21:23:00 -0400] pcn: We already have about 8 patches we run with for ironfan, so monkeypatch or fork until better fix comes along is about the sme.
[2012-03-13 21:23:00 -0400] AntonZ: is btm person on here ?
[2012-03-13 21:23:00 -0400] lusis: heh
[2012-03-13 21:23:00 -0400] lusis: pcn: this is how I do it: https://github.com/lusis-cookbooks/noah/blob/master/README.md
[2012-03-13 21:23:00 -0400] lusis: under blocking
[2012-03-13 21:23:00 -0400] lusis: but I'm sure getting something merged into Ironfan is probably more likely in the short term
[2012-03-13 21:24:00 -0400] pcn: And I'm curious what opscode will provide since they're expressing an interest in the problem space.
[2012-03-13 21:25:00 -0400] lusis: yeah but I'm guessing that's down the road a bit
[2012-03-13 21:25:00 -0400] pcn: What you're saying about your LWRP sounds like what I was asking for at the opscode summit, have they talked to you about your use case yet?
[2012-03-13 21:25:00 -0400] lusis: nah. But it's not a big deal to me
[2012-03-13 21:26:00 -0400] lusis: I have a workable solution
[2012-03-13 21:26:00 -0400] lusis: and any solution opscode implements likely won't solve all the usecases I have for Noah
[2012-03-13 21:26:00 -0400] lusis: since doing the coordination stuff with Chef is a smaller part
[2012-03-13 21:26:00 -0400] miah: neat
[2012-03-13 21:27:00 -0400] miah: i have to take a look at that later. i am about to start doing some stuff with zookeeper. i've been noahcurious for a while though.
[2012-03-13 21:27:00 -0400] lusis: it's not for everyone
[2012-03-13 21:27:00 -0400] lusis: I try to be up front about that
[2012-03-13 21:27:00 -0400] lusis: ZK has bigger backing and is MUCH more reliable
[2012-03-13 21:28:00 -0400] lusis: AJ is doing some cool shit abstracting this whole pattern out too
[2012-03-13 21:28:00 -0400] miah: cool
[2012-03-13 21:28:00 -0400] jbz: AGH
[2012-03-13 21:28:00 -0400] miah: i think i could probably learn more from the noah codebase than zk though
[2012-03-13 21:28:00 -0400] jbz: offtopic, but does anyone here use OS X?
[2012-03-13 21:28:00 -0400] miah: yes
[2012-03-13 21:28:00 -0400] lusis: sadly
[2012-03-13 21:28:00 -0400] lusis: yes
[2012-03-13 21:28:00 -0400] lusis: well
[2012-03-13 21:28:00 -0400] lusis: psuedo-sadly
[2012-03-13 21:29:00 -0400] jbz: Am I correct in understanding that the XCode 4.3.1 command line tools require a dev account even though XCode itself does not?
[2012-03-13 21:29:00 -0400] lusis: I think it's also in the app store
[2012-03-13 21:29:00 -0400] lusis: but
[2012-03-13 21:29:00 -0400] jbz: XCode is, yes
[2012-03-13 21:29:00 -0400] lusis: just grab the gcc-installer
[2012-03-13 21:29:00 -0400] jbz: ?
[2012-03-13 21:29:00 -0400] lusis: one sec
[2012-03-13 21:29:00 -0400] jbz: does that give me make, etc.
[2012-03-13 21:29:00 -0400] jbz: ?
[2012-03-13 21:29:00 -0400] lusis: https://github.com/kennethreitz/osx-gcc-installer
[2012-03-13 21:30:00 -0400] lusis: yep
[2012-03-13 21:30:00 -0400] lusis: some cocoa specific stuff I think has problems with it
[2012-03-13 21:30:00 -0400] lusis: but I haven't had a real issue yet
[2012-03-13 21:30:00 -0400] jbz: Can that coexist with XCode, or should I deinstall that now? ;_)
[2012-03-13 21:30:00 -0400] jbz: (thanks, btw).
[2012-03-13 21:31:00 -0400] lusis: I have both installed
[2012-03-13 21:31:00 -0400] lusis: I've never bothered to futz with paths or anything
[2012-03-13 21:31:00 -0400] lusis: so I dunno internally
[2012-03-13 21:31:00 -0400] jtran: is there a way to have a node's /etc/chef/* to point to TWO diff chef servers?
[2012-03-13 21:31:00 -0400] lusis: but it's a shitload smaller than xcode
[2012-03-13 21:31:00 -0400] jbz: ah
[2012-03-13 21:31:00 -0400] jbz: thanks much.
[2012-03-13 21:32:00 -0400] lusis: jtran: run with a different config file arg on the chef-client invocation?
[2012-03-13 21:32:00 -0400] jtran: good point.   i should try that!
[2012-03-13 21:32:00 -0400] lusis: heh
[2012-03-13 21:32:00 -0400] lusis: just make sure you don't overwrite pems and such
[2012-03-13 21:32:00 -0400] miah: point to a load balancer rather than a chef server?
[2012-03-13 21:32:00 -0400] jtran: miah: i don't think that'd be quite the same tho
[2012-03-13 21:32:00 -0400] lusis: that would work too unless they're two distinct chef servers for compartmentalization reasons
[2012-03-13 21:33:00 -0400] jtran: yes two distinct chef servers, diff cookbooks
[2012-03-13 21:33:00 -0400] ssd7: jtran: If you describe your end goal, you might get some more specific advice :)
[2012-03-13 21:33:00 -0400] jtran: ssd7, true
[2012-03-13 21:33:00 -0400] lusis: okay. gotta bail
[2012-03-13 21:33:00 -0400] lusis: peace fishes
[2012-03-13 21:33:00 -0400] jtran: i think just running chef-client w/ diff config file arg is what i was looking for.  not sure why i didn't think of it prior!
[2012-03-13 21:33:00 -0400] pcn: thanks lusis.
[2012-03-13 21:34:00 -0400] jtran: thx guys
[2012-03-13 21:39:00 -0400] pcn: Oh, this looks easier.  It looks like mixlib will take a list of log "devices".  I guess i need to see what a log device is
[2012-03-13 21:53:00 -0400] bkmontgomery: Finally pushed this out to github. Feedback is welcome. https://github.com/coroutine/chef-system_packages
[2012-03-13 22:10:00 -0400] pcn: Well, well.  It looks like it may be this simple: log1 = Chef::Log::new($stdout)
[2012-03-13 22:10:00 -0400] pcn: log1.sev_threshold=(Chef:Logger::WARN)
[2012-03-13 22:10:00 -0400] pcn: log2 = Chef::Log::new('/tmp/chef_run_log')
[2012-03-13 22:10:00 -0400] pcn: Chef::Log::use_log_devices([log1, log2])
[2012-03-13 22:11:00 -0400] cwj: is it just me or or is cookbook[god] ver 1.0.0 broken with god gem version 0.12.1?
[2012-03-13 22:11:00 -0400] pcn: It worked from irb, using the actual Logger module.  Going to see if it works using the chef->mixin->etc.
[2012-03-13 22:12:00 -0400] cwj: i get errors about the default email notification configurations in master.god
[2012-03-13 22:28:00 -0400] miah: so.. i have a cookbook named 'hostname'. it sets up my servers hostnames. my attributes file isn't seeming to load though.. wtf
[2012-03-13 22:29:00 -0400] miah: looking at the node, there are no 'hostname' related attributes. afaict i am doing everything correct
[2012-03-13 22:39:00 -0400] lflux: does search inside recipes seriously not cache at all?
[2012-03-13 22:40:00 -0400] pcn: lflux are you re-running the same search?  If so, maybe attach it to the node object for the length of the run
[2012-03-13 22:41:00 -0400] lflux: apparently I am since I have a period where a load of search traffic is going off
[2012-03-13 22:41:00 -0400] lflux: but -l debug doesn't say what I am searching for
[2012-03-13 22:54:00 -0400] chip-: I'm getting some weird-ass search results out of Hosted Chef right now
[2012-03-13 22:55:00 -0400] chip-: knife search node "role:foo" returns a lot of nodes that do not, in fact, have role foo, and this can be verified with knife node show.
[2012-03-13 23:05:00 -0400] juanje: Ohai chefs :-)
[2012-03-13 23:08:00 -0400] jbz: ohai
[2012-03-13 23:09:00 -0400] pcn: chip- really?
[2012-03-13 23:11:00 -0400] pcn: chip- have you checked the full node data, e.g. knife node show <node> -l to see if there are any other keys that may have the key "role"?
[2012-03-13 23:14:00 -0400] iamsmrtk: hey all, I was wondering, is it ok for the chef clients to be on an older version than the chef server itself? (9.8 vs 10.6)
[2012-03-13 23:14:00 -0400] iamsmrtk: (0.9.8 vs 0.10.6)**
[2012-03-13 23:16:00 -0400] chip-: pcn: D'oh!
[2012-03-13 23:18:00 -0400] chip-: *something
[2012-03-13 23:18:00 -0400] pcn: chip- I thought the fact that all keys were "lifted" to top-level was interesting, but it's always difficult when you screw with namespaces like that
[2012-03-13 23:18:00 -0400] pcn: chip- But the search is sooooo convenient
[2012-03-13 23:18:00 -0400] chip-: pcn: I learned someting today
[2012-03-13 23:19:00 -0400] lflux: jbz: turns out the gem stuff I was nattering about before was totally wrong. It _was_ picking up config from the right place
[2012-03-13 23:19:00 -0400] lflux: the 3min delay is my fault.
[2012-03-13 23:21:00 -0400] iamsmrtk: Hey all, I'm trying to set up chef to use SSL with apache and it's throwing some errors, it looks like chef's not returning a valid http response, any ideas as to what I'm doing wrong? Here's some of the log file: http://pastebin.com/C7sSvXNm
[2012-03-13 23:22:00 -0400] jbz: lflux: Ahhh
[2012-03-13 23:22:00 -0400] jbz: My rule is "How is this my fault, because I know it is."
[2012-03-13 23:22:00 -0400] jbz: Once I prove it isn't, then I go "Hmmmm..."
[2012-03-13 23:22:00 -0400] jbz: :-)
[2012-03-13 23:24:00 -0400] chip-: jbz: See, once I think I've proven it isn't, then I've double-checked, then triple-checked, then I open my big damn mouth on IRC and every time, still my fault.
[2012-03-13 23:24:00 -0400] lflux: jbz: Well it wasn't obviously my fault due to the logging
[2012-03-13 23:25:00 -0400] lflux: it was only until I sat down seriously with wireshark
[2012-03-13 23:25:00 -0400] ssd7__: chip-: pcn Here is a bug open on that issue regarding searching on roles. http://tickets.opscode.com/browse/CHEF-2915  This is one of those cases where the general behavior is super convienient, but there are a few cases where it can really sting.
[2012-03-13 23:25:00 -0400] jbz: :-)
[2012-03-13 23:28:00 -0400] lflux: chip-: I normally have that filter but I was battling ruby, DNS providers and a splitting headache caused by the former.
[2012-03-13 23:29:00 -0400] jtimberman: cwj: it might be broken.
[2012-03-13 23:29:00 -0400] jtimberman: cwj: it might not!
[2012-03-13 23:29:00 -0400] chip-: ssd7__: super-helpful. Thank you!
[2012-03-13 23:36:00 -0400] pcn: OK chefs have a good night
[2012-03-13 23:56:00 -0400] chip-: lflux: Having the filter never seems to help me. :)
