[2012-03-22 07:45:00 -0400] kreedy: le sigh. turns out my problem isn't just renaming boxes. i'm getting 401 on creating new boxes too. opened a ticket with support :-/
[2012-03-22 08:16:00 -0400] Kwanasolis: ok, vagrant is awesome.
[2012-03-22 08:25:00 -0400] BryanWB: ohai chefs!
[2012-03-22 08:38:00 -0400] maus: hi there!
[2012-03-22 08:39:00 -0400] maus: I'm following an official chef 0.9 -> 0.10 upgrading guide. apt-get install  libgecode-dev
[2012-03-22 08:41:00 -0400] maus: .. suggest installing a bunch of packages like mesa-common-dev, libqt4-sql as dependencies. Is it ok?
[2012-03-22 08:41:00 -0400] maus: or maybe there is some name collision?
[2012-03-22 08:43:00 -0400] BryanWB: maus: i think on ubuntu it pulls in those dependencies :(
[2012-03-22 08:43:00 -0400] BryanWB: not a naming collision
[2012-03-22 08:44:00 -0400] Kwanasolis: maus: are you using an ubuntu-server build or ubuntu-desktop build?  that seems like qt/Xwin is installed and the update is trying to update the components in the OS
[2012-03-22 08:45:00 -0400] Kwanasolis: btw, that's not chef stuff, that's just your server
[2012-03-22 08:46:00 -0400] maus: it's ubuntu-server lucid
[2012-03-22 08:47:00 -0400] Kwanasolis: right, but what I'm saying is those are GUI dependancies, and no reason chef would have installed them.  Did you install chef on a server that had the workstation stuff installed?
[2012-03-22 08:47:00 -0400] maus: well, there are some x11-related packages, absolutely dont need them, though. I guess they were pulled as dependencies in the past too
[2012-03-22 08:47:00 -0400] maus: Kwanasolis, no, it's a dedicated VM
[2012-03-22 08:48:00 -0400] Kwanasolis: well its updating X, has nothing to do with chef, remove X or let it run :)
[2012-03-22 08:49:00 -0400] maus: well, I just issued apt-get install libgecode-dev. Seems it depends on all that stuff. Or do you mean they're optional dependencies?
[2012-03-22 08:50:00 -0400] zoubi: is it possible to configure chef-server so it updates the url it is listening on, on startup? because with amazon ec2, the public DNS is not the same when the machine is rebooted
[2012-03-22 08:50:00 -0400] Kwanasolis: maus: that's a complicated topic.   What I'm trying to say is your VM has a GUI env installed.  Chef does not need a gui env to run.
[2012-03-22 08:51:00 -0400] maus: Kwanasolis, absolutely! Still I have no ideas how to get rid of it.
[2012-03-22 08:51:00 -0400] Kwanasolis: try #ubuntu :)
[2012-03-22 08:51:00 -0400] maus: I miss gentoo use flags sometimes :)
[2012-03-22 08:51:00 -0400] Kwanasolis: ha! I like arch now, gentoo was cool before it became crazy
[2012-03-22 08:52:00 -0400] Kwanasolis: maus: check out the 'tasksel' cmd
[2012-03-22 08:54:00 -0400] Kwanasolis: grr, I can't get vagrant to run when coupled with chef.
[2012-03-22 08:54:00 -0400] maus: Kwanasolis, it shows only 'basic ubuntu server' and 'ssh server' selected
[2012-03-22 08:54:00 -0400] BryanWB: Kwanasolis: maus isn't doing anything wrong, the the libgecode-dev package has dependencies  on QT crap
[2012-03-22 08:55:00 -0400] maus: funny :)
[2012-03-22 08:55:00 -0400] Kwanasolis: I'm not saying he is
[2012-03-22 09:00:00 -0400] Anand: i am getting this status "Not Checked In" in https://manage.opscode.com/status..why is it so??
[2012-03-22 09:00:00 -0400] Anand: i am using ec2 cloud provider
[2012-03-22 09:07:00 -0400] maus: installing chef-solr-0.10.8-2 fails with the error Error: {user_already_exists,<<"chef">>}
[2012-03-22 10:14:00 -0400] proffalken: Has anyone written a knife plugin which creates a knife.rb for you using questions/answers?
[2012-03-22 10:30:00 -0400] Anand: proffalken: I havent done it...but u can do by prompinting and do code of creating file in ruby...to create custome knife plugin check this: http://wiki.opscode.com/display/chef/Knife+Plugins
[2012-03-22 10:31:00 -0400] Anand: check this for prompting: http://stackoverflow.com/questions/2889720/one-liner-in-ruby-for-displaying-a-prompt-getting-input-and-assigning-to-a-var
[2012-03-22 10:40:00 -0400] proffalken: Anand: ok, thanks, I'll take a look - I'm hoping to expand knife-block with the ability to create knife files that you can then select
[2012-03-22 10:47:00 -0400] zts: proffalken: "knife configure" ?
[2012-03-22 10:47:00 -0400] proffalken: zts: similar, but not quite
[2012-03-22 10:48:00 -0400] proffalken: I wrote a plugin yesterday that creates a symlink from knife.rb to any one of a number of knife config files
[2012-03-22 10:48:00 -0400] zts: ah, cool
[2012-03-22 10:48:00 -0400] proffalken: What I now want to do is to have it create these config files
[2012-03-22 10:48:00 -0400] proffalken: zts: https://github.com/greenandsecure/knife-plugins
[2012-03-22 10:50:00 -0400] zts: it's a good idea
[2012-03-22 10:50:00 -0400] zts: I've got a single knife.rb which magically sets things up depending on which chef-repo I'm currently in
[2012-03-22 10:50:00 -0400] zts: but it's ugly and annoying
[2012-03-22 10:52:00 -0400] proffalken: I think I might be able to fudge it though
[2012-03-22 10:52:00 -0400] zts: it'll write to whatever you tell it with the --config option
[2012-03-22 10:52:00 -0400] zts: anyway, what does "knife configure" miss out that you need?
[2012-03-22 10:52:00 -0400] proffalken: zts: I was using a bash script to move the symlinks up until yesterday, then I thought "why not let knife do the hard work for me?"
[2012-03-22 10:52:00 -0400] proffalken: zts: it overwrites knife.rb
[2012-03-22 10:53:00 -0400] proffalken: hmmm, ok, so I could call it from inside my module and let it take over before switching to the correct file...
[2012-03-22 10:53:00 -0400] zts: yeah.  I haven't done it myself, but it looks like you should be able to
[2012-03-22 10:53:00 -0400] zoubi: my chef server is on an amazon EC2 virtual machine. When I reboot the machine, the public DNS changes, and I must change it accordingly in the chef-server configuration, and on my workstation. I restarted chef-server like explained here http://wiki.opscode.com/display/chef/Upgrading+Chef+0.9.x+to+Chef+0.10.x
[2012-03-22 10:53:00 -0400] zts: just set config[:config_file] up correctl
[2012-03-22 10:53:00 -0400] zts: =y
[2012-03-22 10:53:00 -0400] zoubi: on the workstation, I can do: knife cookbook list, it gives me something
[2012-03-22 10:54:00 -0400] zoubi: but when I want to upload a cookbook, I have : ERROR: Server returned error for http://xxxxxx.compute.amazonaws.com:4000/cookbooks/apache2/1.1.2, retrying 1/5 in 4s
[2012-03-22 10:54:00 -0400] zoubi: what do you think it can be?
[2012-03-22 10:55:00 -0400] proffalken: zoubi: are you allowing access to port 4040 in your EC2 security group?
[2012-03-22 10:55:00 -0400] zoubi: no
[2012-03-22 10:55:00 -0400] zoubi: but I wasn't either before I rebooted the virtual machine
[2012-03-22 10:57:00 -0400] proffalken: sorry, should be port 4000 - is that acces allowed?
[2012-03-22 10:57:00 -0400] zoubi: also, when I reboot the virtual machine, and the DNS has changed, chef-server takes almost all the CPU of the machine. Is this normal too?
[2012-03-22 10:57:00 -0400] zoubi: proffalken: yes it is
[2012-03-22 10:57:00 -0400] zoubi: proffalken: I can access it through a browser too
[2012-03-22 10:58:00 -0400] proffalken: zoubi: ah, ok, I think I see the issue - Chef uses the FQDN to create the certificates (AFAICT) therefore the if FQDN changes, the certs are no longer valid
[2012-03-22 10:59:00 -0400] proffalken: I'd suggest that you create a DNS record that points to the public IP Address of that node and use that for the chef server anme instead
[2012-03-22 10:59:00 -0400] zoubi: proffalken: an idea of what I should do?
[2012-03-22 10:59:00 -0400] proffalken: i.e. chef.yourdomain.com > x.x.x.x
[2012-03-22 10:59:00 -0400] proffalken: that might work, but others in here have far more knowledge than I do! :)
[2012-03-22 11:01:00 -0400] zoubi: where should the DNS record be created? on my workstation?
[2012-03-22 11:02:00 -0400] proffalken: on any domain that you have control over
[2012-03-22 11:02:00 -0400] proffalken: for example, my domain is threedrunkensysadsonthe.net
[2012-03-22 11:03:00 -0400] proffalken: do I would create something like chef.threedrunkensysadsonthe.net pointing to the EC2 public IP address
[2012-03-22 11:03:00 -0400] proffalken: that way you move away from Amazon renaming the DNS every time you reboot
[2012-03-22 11:03:00 -0400] proffalken: it's what I've done for AMI's in the past and it seems to work well
[2012-03-22 11:04:00 -0400] proffalken: you also need to change the hostname of the server to the fqdn (chef.threedrunkensysadsonthe.net in the example above)
[2012-03-22 11:07:00 -0400] zoubi: mm ok
[2012-03-22 11:07:00 -0400] zoubi: I'll give it a go
[2012-03-22 11:07:00 -0400] zoubi: thanks for your answer
[2012-03-22 11:09:00 -0400] jtgiri_: Hey guys - how can I get FQDN from knife ? I am trying knife search node  "name:chef-server[FQDN]"
[2012-03-22 11:19:00 -0400] proffalken: zts: it works! :) Knife Block now lets you configure a new knife.rb file...
[2012-03-22 11:19:00 -0400] proffalken: thanks for the pointers
[2012-03-22 11:23:00 -0400] zts: hurrah!  No problem, thankyou for writing and sharing it :)
[2012-03-22 11:24:00 -0400] proffalken: just adding it to the community wiki now...
[2012-03-22 11:36:00 -0400] proffalken: right, shameless promotion via twitter and opscode wiki over, back to work...
[2012-03-22 11:36:00 -0400] proffalken: :D
[2012-03-22 11:48:00 -0400] maus: I've upgraded chef-server from 0.9.18 to 0.10.8 and now all searches return []. What to check first?
[2012-03-22 11:55:00 -0400] skanev: Hi there. I have a new (single) server to set up and I want to give chef a try (with chef-solo). Can you guys recommend me where to start, apart from the opscode docs?
[2012-03-22 11:57:00 -0400] BryanWB: skanev: i recommend starting w/ opscode hosted chef, it is free for 5 nodes
[2012-03-22 11:57:00 -0400] alexs: I want to compose some attributes for one cookbook using some attributes from another cookbook
[2012-03-22 11:58:00 -0400] BryanWB: skanev: and the features u get when using chef w/ server are mega-fun
[2012-03-22 11:58:00 -0400] alexs: Environments seem like the way to do this, but it doesn't seem to set them :(
[2012-03-22 11:58:00 -0400] zts: maus: I'd try "knife index rebuild", followed by looking at chef-expander's logs if it didn't just work
[2012-03-22 11:58:00 -0400] BryanWB: skanev: http://wiki.opscode.com/display/chef/Fast+Start+Guide
[2012-03-22 11:59:00 -0400] skanev: BryanWB: interesting. can you tell em why is that better than just going with chef-solo?
[2012-03-22 11:59:00 -0400] BryanWB: skanev: cuz u will see the real power and productivity of chef
[2012-03-22 11:59:00 -0400] skanev: already read that, btw
[2012-03-22 11:59:00 -0400] BryanWB: esp. databags and search
[2012-03-22 11:59:00 -0400] alexs: (Specifically I want to setup some pgbouncer rules using the databases configured for our postgres receipes.)
[2012-03-22 11:59:00 -0400] BryanWB: alexs: u using the pgbouncer cookbook?
[2012-03-22 11:59:00 -0400] alexs: BryanWB: yes
[2012-03-22 12:00:00 -0400] Cope: Straw poll... of those around now, and based on general feeling, what fraction of users do you think use only chef-solo?
[2012-03-22 12:00:00 -0400] BryanWB: Cope: 25%
[2012-03-22 12:01:00 -0400] alexs: I have like default_attributes {:pgbouncer => node.default[:postgres_stuff } in my environment
[2012-03-22 12:01:00 -0400] BryanWB: Cope: actually more like 405
[2012-03-22 12:01:00 -0400] alexs: no idea if that's the correct way to read the attribute there
[2012-03-22 12:01:00 -0400] BryanWB: s/405/40%
[2012-03-22 12:01:00 -0400] Cope: BryanWB: as much as that? interesting.
[2012-03-22 12:01:00 -0400] BryanWB: i think a number of people use it w/ vagrant and not even realize it
[2012-03-22 12:01:00 -0400] maus: zts, thanks, ran it. It reported success. Log file /var/log/chef/expander.log is empty.
[2012-03-22 12:02:00 -0400] BryanWB: and just last night talked w/ githubfolks
[2012-03-22 12:02:00 -0400] BryanWB: they use it to build and package their enterprise product
[2012-03-22 12:03:00 -0400] Cope: I can see it being very powerful as a declarative scripting resource
[2012-03-22 12:03:00 -0400] alexs: Except that it isnt actually declarative...
[2012-03-22 12:03:00 -0400] maus: zts, the problem persists. Interestingly, I cant run shef -z, looks like it automatically start running runlist and fails in the middle because of incorrect results from search queries.
[2012-03-22 12:03:00 -0400] BryanWB: i could see a lot of people using it as github.com does
[2012-03-22 12:05:00 -0400] Cope: alexs: what do you mean?
[2012-03-22 12:05:00 -0400] alexs: chef scripts are full of control flow and side effects
[2012-03-22 12:07:00 -0400] Cope: alexs: could you give me an example of what you mean by a side effect?
[2012-03-22 12:07:00 -0400] alexs: it's high level and has a culture of everything being idempotent but its not declarative.
[2012-03-22 12:08:00 -0400] alexs: Cope: the underlying tools have side effects
[2012-03-22 12:08:00 -0400] alexs: e.g. apt
[2012-03-22 12:09:00 -0400] alexs: it's kind of inherently what you want from a chef though
[2012-03-22 12:09:00 -0400] alexs: it's just the wrong term for what it does
[2012-03-22 12:09:00 -0400] alexs: -a
[2012-03-22 12:09:00 -0400] Cope: I'm just trying to understand your perspective.  When I say it is declarative, I mean "declare the intended state, abstractly". What do you mean?
[2012-03-22 12:09:00 -0400] alexs: yeah but you arent doing that, you are declaring  a list of mostly idempotent instructions that should lead to that state
[2012-03-22 12:10:00 -0400] zts: maus: is chef-expander actually running?
[2012-03-22 12:11:00 -0400] zts: Cope: I'm often surprised by the amount of interest in chef-solo, so I think it's probably used more than I'd otherwise guess
[2012-03-22 12:11:00 -0400] Cope: alexs: sorry if I'm being slow on the uptake... how is "declare the intended state" different from "list of idempotent instructions that should lead to that state" ?
[2012-03-22 12:11:00 -0400] maus: zts, looks like it is... at least, there are two processes named chef-expander
[2012-03-22 12:12:00 -0400] alexs: if i have to put not_if: in a recipe to make it not-fail, it's not declarative, i'm declaring control flow
[2012-03-22 12:12:00 -0400] alexs: it's like doing test -f $DEST || cp $FILE $DEST instead of using the install command in shell.
[2012-03-22 12:13:00 -0400] Cope: alexs - ok, so there is imperative pollution in what should be declarative, if the provider isn't idempotent, or there isn't a provider.  Is that what you mean?
[2012-03-22 12:13:00 -0400] alexs: Cope: yes, but i think that's inherent in the design
[2012-03-22 12:14:00 -0400] Cope: I'm just wondering whether we're being language terminology pedants, or whether it really is inaccurate to call it declarative.
[2012-03-22 12:15:00 -0400] alexs: It's a hybrid, like makefiles.
[2012-03-22 12:15:00 -0400] Cope: right
[2012-03-22 12:15:00 -0400] Cope: good example
[2012-03-22 12:16:00 -0400] alexs: but that hyrbidness is a feature that is both useful, and precludes certain avenues of developments
[2012-03-22 12:16:00 -0400] zts: If you can't write purely declarative recipes in Chef, then you can't do so in Puppet either - but Chef certainly enables the introduction of imperative style where Puppet does not
[2012-03-22 12:16:00 -0400] alexs: I don't think it's a bad quality :)
[2012-03-22 12:16:00 -0400] Cope: And we know, and we're ok with it...
[2012-03-22 12:17:00 -0400] alexs: but anyway, anyone have any idea about my attribtues issue? :(
[2012-03-22 12:17:00 -0400] Cope: sorry alexs - i did't see it.  What's up?
[2012-03-22 12:17:00 -0400] alexs: i want to re-use the attributes i declared in my postgres recipe for pgbouncer
[2012-03-22 12:17:00 -0400] alexs: but i cant work out where to put them
[2012-03-22 12:17:00 -0400] alexs: environments seem like the right place
[2012-03-22 12:18:00 -0400] Cope: alexs - what problem are you trying to solve? What's the actual use case?
[2012-03-22 12:18:00 -0400] alexs: take the list of databases and usernames used to configure postgres and convert them to the format that pgbouncers cookbook wants
[2012-03-22 12:19:00 -0400] alexs: then just have pgbouncer in the run-list for the role
[2012-03-22 12:19:00 -0400] alexs: which should then pick up the right attributes from the environment
[2012-03-22 12:19:00 -0400] Cope: a common pattern would be to put that information in a databag
[2012-03-22 12:20:00 -0400] Cope: what you describe isn't really a node or cookbook attribute
[2012-03-22 12:20:00 -0400] Cope: it's configuration metadata
[2012-03-22 12:20:00 -0400] alexs: that makes sense
[2012-03-22 12:20:00 -0400] Cope: so if you put them in the databag, you can then have a method to make them into pgbouncer format where necessary
[2012-03-22 12:21:00 -0400] alexs: but then i need an extra recipe
[2012-03-22 12:21:00 -0400] BryanWB: Cope: never asked you on the ffshow, why is your nick Cope and why is your twitter icon an older gentleman?
[2012-03-22 12:21:00 -0400] Cope: if you think of Chef as being a bit like an MVC, you'll design your infrastructure with the right separation of logic and data.
[2012-03-22 12:22:00 -0400] alexs: Cope: i didnt set them up like this :)
[2012-03-22 12:23:00 -0400] alexs: so you mean that I should basically inherit the pgbouncer provider by writing my own recipe that pulls the databag into the pgbouncer attributes?
[2012-03-22 12:23:00 -0400] alexs: so what are attributes actually for?
[2012-03-22 12:23:00 -0400] alexs: also i'm using littlechef for extra pain
[2012-03-22 12:24:00 -0400] auduny: Hmf
[2012-03-22 12:25:00 -0400] auduny: https://github.com/opscode-cookbooks/users/blob/master/README.md
[2012-03-22 12:25:00 -0400] auduny: WHy is "/" escaped in /bin/bash here.
[2012-03-22 12:26:00 -0400] auduny: In data bags
[2012-03-22 12:26:00 -0400] auduny: Do you need to escape / in data bags?
[2012-03-22 12:34:00 -0400] Cope: alexs: attributes are for setting sane defaults in cookbooks.
[2012-03-22 12:34:00 -0400] Cope: alexs: and overriding them in certain contexts.
[2012-03-22 12:35:00 -0400] alexs: Cope: what if a cookbook's "sane defaults" are the product of another cookbooks attributes?
[2012-03-22 12:36:00 -0400] vegardx: then you are doing something wrong?
[2012-03-22 12:37:00 -0400] alexs: seems like they should just not exist to me :-/
[2012-03-22 12:37:00 -0400] vegardx: auduny: It's JSON, so you should not have to escape it, but look in the logic of the recipe, see if they do some funkybusiness with it.
[2012-03-22 12:42:00 -0400] alexs: vegardx: https://github.com/ckrybus/chef-pgbouncer so is this recipe just uselessly broken?
[2012-03-22 12:42:00 -0400] Cope: alexs: if you need to set a value dynamically, you should set it within the recipe itself, to be explicit.
[2012-03-22 12:43:00 -0400] Cope: alexs: an example might be to set the number of workers, or threads, or heap size, or some other such thing.  If your sane default depends on external factors and should be calculated, or pulled in from a third party, then that's fine - just do it explicitly in the recipe.
[2012-03-22 12:43:00 -0400] alexs: Cope: so i should make my own recipe that tweaks the attributes and then does an include_recipe "pgbouncer"
[2012-03-22 12:45:00 -0400] Cope: I'd write a pgbouncer recipe; if there are 'variables' you need to use which are sane defaults in another cookbook, pull them in, process them, set them, and then use them in the pgbouncer recipe.
[2012-03-22 12:45:00 -0400] vegardx: alexs: I cannot see anything that should make it fail
[2012-03-22 12:45:00 -0400] vegardx: but have you written it your self?
[2012-03-22 12:45:00 -0400] alexs: vegardx: no that's someone elses
[2012-03-22 12:47:00 -0400] vegardx: I cannot see anything wrong with it, ask the maintainer.
[2012-03-22 12:47:00 -0400] alexs: vegardx: the recipe works, it's the recomended usage that is broken
[2012-03-22 12:48:00 -0400] alexs: attributes seem to be a horrible API if you expect any amount of reusability
[2012-03-22 12:49:00 -0400] zts: well yeah, they're not really intended for that  (but more generally, reusability and composability is still a struggle)
[2012-03-22 12:49:00 -0400] zts: if I were redoing that pgbouncer recipe, I'd probably use search to find the databases I was interested in
[2012-03-22 12:50:00 -0400] alexs: zts: that does sound more sensible
[2012-03-22 12:50:00 -0400] zts: though I'm assuming you'd want to have one pgbouncer in front of more than one database server
[2012-03-22 12:52:00 -0400] alexs: urgh
[2012-03-22 13:39:00 -0400] decklin: are encrypted data bag items limited to string values? i'm trying to use nested hashes, and failing.
[2012-03-22 13:57:00 -0400] atomic-penguin: decklin, I think so, haven't seen a more complex example.  The key's are plaintext, the values get encrypted.
[2012-03-22 14:13:00 -0400] zoubi: is it possible to copy multiple files from a cookbook directory to the client's filesystem without calling multiple times cookbook_file in the recipe?
[2012-03-22 14:16:00 -0400] kreedy: anyone know what typical response time is from support@opscode.com for hosted chef server issues
[2012-03-22 14:20:00 -0400] karwash: hi all, getting a strange error when using the gem_package provider:
[2012-03-22 14:21:00 -0400] karwash: v
[2012-03-22 14:21:00 -0400] karwash: NoMethodError: gem_package[passenger]
[2012-03-22 14:21:00 -0400] karwash: NoMethodError: undefined method `full_name' for nil:NilClass
[2012-03-22 14:22:00 -0400] asfallows: Hey all, quick question: is 'knife bootstrap' able to bootstrap workstations, nodes, or both?
[2012-03-22 14:22:00 -0400] karwash: i'm passing the gem_package provider with a specific version of passenger via an environment override attribute
[2012-03-22 14:49:00 -0400] kreedy: anyone else every notice that with http://www.opscode.com/hosted-chef/, the price per node gets more expensive as you buy larger packages? O_o
[2012-03-22 14:54:00 -0400] fish_: uhm.. looks like I can't use libraries within a role, right?
[2012-03-22 14:55:00 -0400] BryanWB: fish_: yup, role is compiled to json then uploaded
[2012-03-22 14:56:00 -0400] fish_: :(
[2012-03-22 14:56:00 -0400] fish_: but thanks anyway :)
[2012-03-22 15:04:00 -0400] asfallows: Is it possible to use knife to bootstrap a workstation, or is bootstrap just for clients?
[2012-03-22 15:06:00 -0400] hcastro: is it possible to use the http_request resource to capture the response? looking through the code and it doesn't appear to be possible.
[2012-03-22 15:07:00 -0400] laurent\: hcastro: nope
[2012-03-22 15:08:00 -0400] hcastro: laurent\: just use open-uri in a ruby_block or something comparable?
[2012-03-22 15:09:00 -0400] jespada_: asfallows, i think you are a bit confused , you can treat your workstation as a target node
[2012-03-22 15:10:00 -0400] jespada_: hence the answer to your question is yes.. you can use knife bootstrap for a workstation
[2012-03-22 15:11:00 -0400] jespada_: asfallows, maybe you already saw this, but in case : http://wiki.opscode.com/display/chef/Knife+Bootstrap
[2012-03-22 15:14:00 -0400] asfallows: jespada: I think I phrased my question badly, rereading it. What I want to do is invoke 'knife bootstrap' on an existing workstation in order to set a remote machine up as a new workstation.
[2012-03-22 15:14:00 -0400] laurent\: hcastro: i use Net::HTTP
[2012-03-22 15:15:00 -0400] asfallows: Can I do that just with knife bootstrap, or will I need to bootstrap it as a node and then step it up to a workstation through a recipe?
[2012-03-22 15:18:00 -0400] zts: asfallows: you could make a custom bootstrap script which did all the installation, but didn't register the node with the chef-server
[2012-03-22 15:18:00 -0400] zts: asfallows: but I think all the standard bootstrap scripts assume you want to make the remote machine a node registered with the chef server, not just a workstation ready to run knife
[2012-03-22 15:18:00 -0400] zts: http://wiki.opscode.com/display/chef/Custom+Knife+Bootstrap+Script
[2012-03-22 15:18:00 -0400] jespada: asfallows, yes.. is the same case.. if you have knife properly configure,  you can, well if is managed by chef you treat it as a node/client
[2012-03-22 15:20:00 -0400] asfallows: zts: After I ran knife bootstrap, the machine I bootstrapped was fully set up with chef-client but -not-configured with knife, which is what I'd like to do. Looks like I will want to make a custom script for that, thanks for the link.
[2012-03-22 15:21:00 -0400] jtimberman: kreedy: Hosted Chef SLA: http://www.opscode.com/service-level-agreement/
[2012-03-22 15:22:00 -0400] jtimberman: kreedy: and the price goes up for larger number of nodes because that just naturally causes more load on our systems, leading to more maintenance overhead for us.
[2012-03-22 15:22:00 -0400] jespada: asfallows, you could go with custom scripts or apply a cookbook to it to configure knife
[2012-03-22 15:22:00 -0400] ssd7: jtimberman: +100 on seperate repos!
[2012-03-22 15:22:00 -0400] asfallows: jespada: Good idea, thanks.
[2012-03-22 15:22:00 -0400] jtimberman: ssd7: we weren't even talking about that!
[2012-03-22 15:22:00 -0400] jtimberman: ssd7: :)
[2012-03-22 15:22:00 -0400] jtimberman: ssd7: aren't you on vacation sir?
[2012-03-22 15:24:00 -0400] ssd7: jtimberman: Indeed.  Waiting for people to get ready, decided to try to attack my mountain of email for a few minutes. :)
[2012-03-22 15:25:00 -0400] kreedy: gotcha
[2012-03-22 15:29:00 -0400] zts: asfallows: the problem is that bootstrap sets up a machine, but you want to set knife up for a user - they are two different levels of activity
[2012-03-22 15:30:00 -0400] zts: asfallows: of course, as jespada says, you can still use Chef or a script to set up knife for a user
[2012-03-22 15:30:00 -0400] jtimberman: ssd7: select all unread, archive.
[2012-03-22 15:33:00 -0400] asfallows: zts: Yeah, I will do that. I'm working out how to get Chef set up for my whole department. Small department, but I'd still rather use a recipe than do it by hand a dozen times.
[2012-03-22 15:57:00 -0400] BryanWB: ssd7: get thee to a sauna! or mount trail
[2012-03-22 16:01:00 -0400] fractaloop: So I'm trying to use knife to bootstrap a fresh Ubuntu 10.10 box, and the install works fine and finds my validator but then I end up getting '401 Unauthorized' from Hosted Chef...Any common causes?
[2012-03-22 16:04:00 -0400] fractaloop: I'm using `knife bootstrap yoda.thefrontside.net --node-name yoda --ssh-user ubuntu --sudo -V`
[2012-03-22 16:06:00 -0400] pcn: fractaloop have you logged into the chef server?  Recently I had an issue where I had to help someone fix the permissions in the server for a case like this
[2012-03-22 16:06:00 -0400] fractaloop: Yea, I have. It seems like everything is kosher
[2012-03-22 16:07:00 -0400] pcn: If you run the chef-client with extra logging do you see which key is getting rejected?
[2012-03-22 16:10:00 -0400] fractaloop: It doesn't seem to print which key specifically, though it does say its using the registration from /etc/chef/client.pem
[2012-03-22 16:10:00 -0400] fractaloop: It prints the header hash, which just has a ton of hashes in it
[2012-03-22 16:11:00 -0400] fractaloop: One of the headers is `X-Ops-UserId:yoda'`
[2012-03-22 16:11:00 -0400] fractaloop: Should that be my UserId or is ok for the node to have it's own userid?
[2012-03-22 16:17:00 -0400] pcn: Node should have a client that is specific to the node.  Again, check out that the newly-generated client has sufficient perms to view/download roles, cookbooks, etc.
[2012-03-22 16:23:00 -0400] karwash: i'm having a strange issue with the gem_package resource... here is my gem_package block:
[2012-03-22 16:23:00 -0400] karwash: gem_package "passenger" do
[2012-03-22 16:23:00 -0400] karwash:   version node[:nginx][:passenger_version]
[2012-03-22 16:23:00 -0400] karwash:   notifies :run, resources(:bash => "compile_nginx_source")
[2012-03-22 16:23:00 -0400] karwash: end
[2012-03-22 16:23:00 -0400] BryanWB: gnight everybody
[2012-03-22 16:24:00 -0400] karwash: when i attempt to override the node[:nginx][:passenger_version] attribute in an environement only on the first run I get this error:
[2012-03-22 16:24:00 -0400] karwash: gem_package[passenger]
[2012-03-22 16:25:00 -0400] karwash: NoMethodError: undefined method `full_name' for nil:NilClass
[2012-03-22 16:25:00 -0400] karwash: i verified that the override attribute value is being set correctly with a logging statement
[2012-03-22 16:26:00 -0400] karwash: anyone have any idea why i'm getting the NoMethodError?
[2012-03-22 16:27:00 -0400] karwash: if i do *not* attempt to override the passenger version attrbute in a role or an environment the chef run completes successfully
[2012-03-22 16:28:00 -0400] karwash: using the default cookbook attribute
[2012-03-22 16:29:00 -0400] ryan-eme: can you gist the whole trace or something?
[2012-03-22 16:33:00 -0400] bestes: Hey all - trying the install using Ubuntu 11.10. Called it "natty" in the deps, because there doesn't seem to be an oneiric. Stuck with an error on chef-solr: Error: {user_already_exists,<<"chef">>}
[2012-03-22 16:42:00 -0400] karwash: @ryan-eme https://gist.github.com/2159458
[2012-03-22 16:52:00 -0400] miah: moin
[2012-03-22 16:54:00 -0400] c_t: ohai
[2012-03-22 17:02:00 -0400] ryan-eme: @karwash: are you able to do gem install passenger --version= with that version string?
[2012-03-22 17:02:00 -0400] spyvsspy: hi, what is the procedure for cahnging a hostname on a node?
[2012-03-22 17:02:00 -0400] spyvsspy: I manually changed the hostname, now I am getting an unauth error
[2012-03-22 17:03:00 -0400] spyvsspy: I am hosting the chef server
[2012-03-22 17:06:00 -0400] fractaloop: pcn: Where do I verify those permissions? If I go to management console I've given the 'yoda' node rights under "Nodes" "Roles" "Groups" and "Clients" but it stills giving me a 401 =(
[2012-03-22 17:07:00 -0400] fractaloop: Also, if I give a node a role, it will execute the run_list of that role, correct?
[2012-03-22 17:09:00 -0400] paulmooring: spyvsspy: you could specify the node name in the client.rb file to whatever the old host name was (it uses host name by default)
[2012-03-22 17:09:00 -0400] miah: fractaloop: yes
[2012-03-22 17:09:00 -0400] miah: if you can put roles inside other roles runlists
[2012-03-22 17:09:00 -0400] spyvsspy: i created a new client
[2012-03-22 17:09:00 -0400] spyvsspy: for it
[2012-03-22 17:09:00 -0400] spyvsspy: thanks
[2012-03-22 17:10:00 -0400] fractaloop: Man, I really wish the mgmt console would reflect inherited run_lists/recipes
[2012-03-22 17:10:00 -0400] miah: i usually delete the node/client, and reregister the host after changing its name
[2012-03-22 17:10:00 -0400] miah: mgmt console? i haven't used the webui really
[2012-03-22 17:10:00 -0400] miah: knife ftw
[2012-03-22 17:10:00 -0400] paulmooring: spyvsspy: deleting and creating a new client/node is a better way to go anyway imo
[2012-03-22 17:11:00 -0400] spyvsspy: well...Im trying to come up with a work flow
[2012-03-22 17:11:00 -0400] spyvsspy: I have an ISO, that I will be dd'ing to physical servers that I deploy
[2012-03-22 17:11:00 -0400] miah: why?
[2012-03-22 17:11:00 -0400] spyvsspy: and the only thing that really changes, will be the host name
[2012-03-22 17:11:00 -0400] miah: do you hate kickstart?
[2012-03-22 17:11:00 -0400] miah: =)
[2012-03-22 17:11:00 -0400] spyvsspy: its faster imo, to just dd a USb drive
[2012-03-22 17:11:00 -0400] fractaloop: miah: I use knife as well, but verify via the mgmt console since
[2012-03-22 17:11:00 -0400] spyvsspy: rather than install the OS, then boostrap
[2012-03-22 17:12:00 -0400] miah: a usb drive means you have to have access to the server
[2012-03-22 17:12:00 -0400] spyvsspy: right, i do
[2012-03-22 17:12:00 -0400] miah: i'm happy to say i haven't been in side a data center in the past 4 years
[2012-03-22 17:12:00 -0400] paulmooring: spyvsspy: if you change the hostname prior to the first chef-client run you won't need to deal with recreating the node
[2012-03-22 17:12:00 -0400] miah: =)
[2012-03-22 17:12:00 -0400] miah: no more cold days for me.
[2012-03-22 17:12:00 -0400] spyvsspy: well, i have a master image, that I call TEST then I dd it to a server and change the host name
[2012-03-22 17:13:00 -0400] miah: ah i see
[2012-03-22 17:13:00 -0400] spyvsspy: we have like 1000+ servers, and no mgmt system whatsoever
[2012-03-22 17:13:00 -0400] miah: ok
[2012-03-22 17:13:00 -0400] spyvsspy: then I just create a new client, and cut/paste the client.pemn
[2012-03-22 17:13:00 -0400] miah: you could have a first-boot script maybe?
[2012-03-22 17:13:00 -0400] spyvsspy: miah, ya, I may build that later
[2012-03-22 17:13:00 -0400] miah: that handles the host name changing and bootstrapping of chef
[2012-03-22 17:13:00 -0400] spyvsspy: im really learning chef right now, and trying to integrate it into our infrastructure
[2012-03-22 17:14:00 -0400] miah: i'm familiar with such set ups
[2012-03-22 17:14:00 -0400] paulmooring: spyvsspy: if you just delete the client.pem from the image as long as the validator key is there it will create a new client on first run
[2012-03-22 17:14:00 -0400] miah: ^
[2012-03-22 17:14:00 -0400] spyvsspy: ah, sweet
[2012-03-22 17:14:00 -0400] spyvsspy: thats even better
[2012-03-22 17:14:00 -0400] miah: you're still going to end up with weird hostnames
[2012-03-22 17:15:00 -0400] paulmooring: just be sure you do that after changing the host name not before :)
[2012-03-22 17:15:00 -0400] spyvsspy: ya, so my guys will do...dd the thumb drive image, change /etc/hosts /etc/hostname, and then deploy
[2012-03-22 17:16:00 -0400] spyvsspy: (I have chef-client running in deamon mode)
[2012-03-22 17:16:00 -0400] miah: are you using roles / environments at all?
[2012-03-22 17:16:00 -0400] spyvsspy: I havent gotten that into chef yet
[2012-03-22 17:16:00 -0400] spyvsspy: I dont think we will need too though
[2012-03-22 17:17:00 -0400] miah: are all of your servers the same?
[2012-03-22 17:17:00 -0400] spyvsspy: yes, pretty much
[2012-03-22 17:17:00 -0400] miah: they all run the same software?
[2012-03-22 17:17:00 -0400] spyvsspy: miah, yes
[2012-03-22 17:17:00 -0400] spyvsspy: only thing that changes is the xorg file
[2012-03-22 17:17:00 -0400] miah: interesting. ok. so ya. you might be able to avoid roles for now
[2012-03-22 17:17:00 -0400] spyvsspy: they arent really servers, its for digital signage
[2012-03-22 17:17:00 -0400] miah: workstations?
[2012-03-22 17:17:00 -0400] miah: oh
[2012-03-22 17:18:00 -0400] miah: like billboards?
[2012-03-22 17:18:00 -0400] spyvsspy: they run a full screen browser
[2012-03-22 17:18:00 -0400] spyvsspy: and SWF/Mp4s etc
[2012-03-22 17:18:00 -0400] spyvsspy: TVs mainly
[2012-03-22 17:18:00 -0400] spyvsspy: banks etc
[2012-03-22 17:18:00 -0400] miah: ah neat
[2012-03-22 17:18:00 -0400] spyvsspy: we have a webapp that feeds them the content, but that is getting rewritten
[2012-03-22 17:19:00 -0400] spyvsspy: I just need to figure out how to feed the "servers" the files, as the content and playlists change, and I think I have it sorted out
[2012-03-22 17:19:00 -0400] spyvsspy: (it all has to be over 443)
[2012-03-22 17:19:00 -0400] miah: i see
[2012-03-22 17:19:00 -0400] miah: luckily, you can tunnel a lot over ssl =)
[2012-03-22 17:20:00 -0400] spyvsspy: ya, I have nginx proxing thing appropriatly for chef etc
[2012-03-22 17:20:00 -0400] miah: just dont tell the banks that ;)
[2012-03-22 17:20:00 -0400] spyvsspy: as the servers can also only talk to one IP
[2012-03-22 17:20:00 -0400] spyvsspy: so I need to serve files, and route the chef stuff all on the same server
[2012-03-22 17:22:00 -0400] spyvsspy: thanks for the help! off to lunch
[2012-03-22 17:23:00 -0400] Dink: Hello. How can you push environments/*.rb up to opscode ? Its been committed to git.
[2012-03-22 17:25:00 -0400] jtimberman: Dink: knife environment from file thing.rb
[2012-03-22 17:25:00 -0400] Dink: jtimberman: Cool thanks. About to use your resolver cookbook :)
[2012-03-22 17:32:00 -0400] fractaloop: Do I need to specifically copy files to a target machine before I `knife bootstrap` it?
[2012-03-22 17:32:00 -0400] fractaloop: I was under the impression it would ssh in and copy them for me...
[2012-03-22 17:37:00 -0400] pcn: fractaloop no you don't need to manually copy config files.  The bootstrap and chef gem will do most/all of that for you.
[2012-03-22 17:37:00 -0400] pcn: The bootstrap file, that is.
[2012-03-22 17:38:00 -0400] pcn: Regarding the permissions, the client must have permissions to read/download the relevant cookbooks, there's a permission for that.
[2012-03-22 17:39:00 -0400] pcn: Regarding adding the role to the run list, yes, it will get that after the first run succeeds in contacting the server and getting roles and expanding them.  Until that you have what I believe is usally /etc/chef/first-run.json
[2012-03-22 17:40:00 -0400] Dink: I keep getting the following error when I try to upload an environment file. in `from_file': undefined local variable or method `test' for dev:Chef::Environment (NameError)    The line in question is    override_attributes[:resolver][:search] = test.net
[2012-03-22 17:42:00 -0400] fractaloop: Alright, so it works if I don't specify a nodename, but then it defaults to 'ubuntu'. When I specify a node name, I get 401 Unauthorized
[2012-03-22 17:43:00 -0400] paulmooring: Dink: try this    override_attributes[:resolver][:search] = "test.net"
[2012-03-22 17:44:00 -0400] Dink: in `from_file': undefined method `[]=' for nil:NilClass (NoMethodError)
[2012-03-22 17:47:00 -0400] Dink: I tried override_attributes[:resolver][:search] = [ "test.net" ] also
[2012-03-22 17:48:00 -0400] paulmooring: Dink I think you have the wrong format for your file run `knife help environment` and check out the format section
[2012-03-22 17:48:00 -0400] iafonov: hi chefs, I've created a more or less simple tool for testing and verification of your setup - http://iafonov.github.com/blog/pragmatic-infrastructure-testing-with-cucumber.html, I'd be glad to get any feedback, thanks
[2012-03-22 17:49:00 -0400] Dink: paulmooring: thanks will take a look
[2012-03-22 17:53:00 -0400] BryanWB__: iafonov, i really really want to play w/ that
[2012-03-22 17:54:00 -0400] BryanWB__: iafonov, tks for creating it
[2012-03-22 17:56:00 -0400] fractaloop: When y'all bootstrap a new node, do you specify the node name in the command line or in a node template?
[2012-03-22 17:56:00 -0400] fractaloop: If I don't it creates the node 'ubuntu'. If I do, it fails.
[2012-03-22 17:56:00 -0400] ryan-eme: is ubuntu your hostname?
[2012-03-22 17:56:00 -0400] fractaloop: Nope
[2012-03-22 17:57:00 -0400] fractaloop: Oh, I guess it is. Fuck.
[2012-03-22 17:57:00 -0400] fractaloop: No where does it say that it uses that as the node name in the guides >_<
[2012-03-22 17:58:00 -0400] mattray: fractaloop: how're you kicking off your boxes?
[2012-03-22 17:58:00 -0400] mattray: OS installation I mean?
[2012-03-22 17:58:00 -0400] fractaloop: Prebuilt colo
[2012-03-22 17:59:00 -0400] fractaloop: I know this stuff is simple if you know the right way to do it, but its been over a year since I did this and I forgot it all =(
[2012-03-22 17:59:00 -0400] Dink: paulmooring: works now thanks for that tip
[2012-03-22 18:02:00 -0400] asfallows: How might I point chef-client somewhere than /etc/chef to look for config and keys? Is there a behavior similar to 'knife configure'?
[2012-03-22 18:03:00 -0400] asfallows: (I mean changing the default, as opposed to using -c/-k flags every time.
[2012-03-22 18:08:00 -0400] wamcvey: I'm trying to add a role to set of machines using: knife node run_list add HOST 'role[ROLE_NAME]
[2012-03-22 18:08:00 -0400] paulmooring: asfallows: You would have to specify the key paths in the client.rb file
[2012-03-22 18:09:00 -0400] paulmooring: http://wiki.opscode.com/display/chef/Chef+Configuration+Settings
[2012-03-22 18:09:00 -0400] wamcvey: I then do a knife node show on the HOST, and I see that the 'role[ROLE_NAME]' is listed in the run_list, but "roles: " field is empty. Is this to be expected?
[2012-03-22 18:09:00 -0400] fractaloop: asfallows: I think its hard coded
[2012-03-22 18:10:00 -0400] fractaloop: client.rb line 37: :default => Chef::Config.platform_specific_path("/etc/chef/client.rb"),
[2012-03-22 18:10:00 -0400] fractaloop: So...you could alias `knife` to `knife -c /my/path` =P
[2012-03-22 18:11:00 -0400] asfallows: fractaloop: Good find, but I think paulmooring is right. If you look at the page he linked, I think you can override those defaults in client.rb
[2012-03-22 18:11:00 -0400] fractaloop: Yes, =P was intended as a joke, sorry for the misunderstanding
[2012-03-22 18:11:00 -0400] ryan-eme: fract, which version is that? wish it'd find a platform specific path on my windows boxes...
[2012-03-22 18:11:00 -0400] fractaloop: You'll notice my past 2 hours in here has been nothing but noob questions
[2012-03-22 18:12:00 -0400] paulmooring: asfallows: actually fractaloop was correct about the config file /etc/chef/client.rb is hardcoded
[2012-03-22 18:12:00 -0400] fractaloop: ryan-eme: I was just quoting HEAD
[2012-03-22 18:13:00 -0400] asfallows: paulmooring: Hm. Alright, thanks.
[2012-03-22 18:13:00 -0400] paulmooring: you would have to still use -c but not -k
[2012-03-22 18:13:00 -0400] ryan-eme: thanks
[2012-03-22 18:19:00 -0400] asfallows: Ah, screw it, I'll just chown /etc/chef
[2012-03-22 18:22:00 -0400] paulmooring: asfallows: are you not running chef-client as root?
[2012-03-22 18:24:00 -0400] ryan-eme: or at least with sudo -E?
[2012-03-22 18:24:00 -0400] iafonov: BryanWB__ - thanks, if you'll have questions/problems you can contact me directly via github or twitter
[2012-03-22 18:25:00 -0400] asfallows: ryan-eme: I should have looked into sudo flags. I was running a recipe with sudo which created files, and found that it was creating them with root as owner. I was trying to get around that.
[2012-03-22 18:26:00 -0400] paulmooring: asfallows: how were the files being created?
[2012-03-22 18:27:00 -0400] paulmooring: all the Chef stuff lets you specify owner/group if you're running as root
[2012-03-22 18:27:00 -0400] asfallows: paulmooring: I used a template and did not specify owner/group at all. That may be another way to fix the matter.
[2012-03-22 18:28:00 -0400] paulmooring: The suggested way is to run chef-client as root and specify owner/group to template/file resources
[2012-03-22 18:28:00 -0400] asfallows: Duly noted, thank you.
[2012-03-22 18:28:00 -0400] paulmooring: chef can run as non-root users, but it loses some features for obvious reasons
[2012-03-22 18:29:00 -0400] jtimberman: and you have to be careful about what kind of resources you're using.
[2012-03-22 18:29:00 -0400] jtimberman: like, you wouldn't be able to create users :)
[2012-03-22 18:30:00 -0400] jtimberman: and likely install packages on most platforms
[2012-03-22 18:31:00 -0400] asfallows: All very good points. I was working on a very basic first recipe, I think I was looking much more at my sepcific problem than at the broader scope of the environment.
[2012-03-22 18:35:00 -0400] fractaloop: Am I supposed to `knife node create NODENAME` before I run a bootstrap?
[2012-03-22 18:35:00 -0400] paulmooring: fractaloop: no
[2012-03-22 18:37:00 -0400] fractaloop: my `knife bootstrap` fails with a 401...It definitely copies my organization validator and registers itself as a client with the proper client.pem
[2012-03-22 18:38:00 -0400] fractaloop: But `sudo chef-client` line of the bootstrap always fails =(
[2012-03-22 18:38:00 -0400] fractaloop: during build_node
[2012-03-22 18:58:00 -0400] btm: Ohai 0.6.12 gem pushed live. Packages an announcement coming soon.
[2012-03-22 18:59:00 -0400] asg: congrats!
[2012-03-22 19:02:00 -0400] ryan-eme: oh is that the one with the new method for finding network interfaces?
[2012-03-22 19:03:00 -0400] btm: ryan-eme: yes, it prefers iproute2 over ifconfig if it is installed.
[2012-03-22 19:03:00 -0400] ryan-eme: awesome been looking forward
[2012-03-22 19:09:00 -0400] dgtized: I was wondering if anyone has suggestions on how to securely store ssl certificates for apache inside a git repo. Given it's basically a list of files to use it seems like secure databags are kind of awkward.  Anyone have any ideas?
[2012-03-22 19:16:00 -0400] ryan-eme: could use scp to grab them off a bastion host
[2012-03-22 19:16:00 -0400] berngp: Hi there, just posted an alpha tomcat7 recipe that the company i work for (IGN) are using for our backend servers. Feel free to try and post comments. https://github.com/ign/chef-cookbooks/tree/master/ign-tomcat
[2012-03-22 19:19:00 -0400] ryan-eme: bash "scp-pull-certs" do
[2012-03-22 19:19:00 -0400] jtimberman: btm: rockin'
[2012-03-22 19:22:00 -0400] dgtized: I guess the problem is more that I would like to store as much as possible in the git repo, and I hate needing an external host to bring up things from scratch
[2012-03-22 19:23:00 -0400] dgtized: but I keep getting the general impression that you can't quite do that, and definitely need some infrastructure already running and available
[2012-03-22 19:24:00 -0400] btm: dgtized: you could use encrypted databags. :)
[2012-03-22 19:25:00 -0400] dgtized: btm: as I said above it just seems kind of awkward to store a list of files in an encrypted data bag, but if that is actually the intended use case then perhaps that's the solution
[2012-03-22 19:26:00 -0400] asg: btm: fwiw, ohai 0.6.12 works just swimmingly on OpenBSD 5.0
[2012-03-22 19:28:00 -0400] asg: dgtized: think of it as storing file data. It's the same with storing ssh public keys.
[2012-03-22 19:35:00 -0400] btm: dgtized: well the certificates are really an id and then some ascii. I think that's only slightly hefty.
[2012-03-22 19:35:00 -0400] btm: asg: good to hear.
[2012-03-22 19:36:00 -0400] dgtized: that's fair
[2012-03-22 19:36:00 -0400] dgtized: as a second question
[2012-03-22 19:38:00 -0400] dgtized: anyone have any pointers about how to do cross-node dependencies.  In the case of frontend webservers to appservers the frontend can obviously just search for appservers on demand.  But in the case of databases, if are doing a backup restore or pre-populating a database, how do you enforce appservers delaying until that dependency is provided by another host?
[2012-03-22 19:39:00 -0400] miketheman: anyone have a decent idea of how to build/deploy a sinatra app w/chef? I haven't deployed sinatra before, wondering if anyone else has dealt with this
[2012-03-22 19:39:00 -0400] asg: dgtized: generally better to use something like noah or zookeeper to mediate that state
[2012-03-22 19:44:00 -0400] dgtized: asg: hmm, was hoping that was something i could solve without adding even more services to manage
[2012-03-22 19:44:00 -0400] dgtized: but I definitely follow how that fits the bill
[2012-03-22 19:44:00 -0400] asg: dgtized: you could do it with chef but it would be difficult. That said, you can use chef to manage the configuration of noah or zookeeper :)
[2012-03-22 19:45:00 -0400] kreedy: anyone created a web interface to knife bootstrap/ec2/rackspace to point your non-command-line-friendly people to?
[2012-03-22 19:46:00 -0400] BryanWB__: kreedy, bet u could do it w/out too much trouble using rundeck
[2012-03-22 19:46:00 -0400] BryanWB__: kreedy, but extending rundeck ui could be difficultu unless u r familiar w/ groovy
[2012-03-22 19:47:00 -0400] kreedy: i'm not familiar with either. google to the rescue!
[2012-03-22 19:47:00 -0400] icoffey: kreedy: we (ubersmith) have one just out of the oven
[2012-03-22 19:48:00 -0400] kreedy: yea? is it still cooling down or ready for consumption?
[2012-03-22 19:49:00 -0400] BryanWB__: icoffey, ooh awesome
[2012-03-22 19:50:00 -0400] icoffey: its for internal use right now, we're figuring out how best to roll it out for public consumption
[2012-03-22 19:51:00 -0400] icoffey: possibly open source the guts for folks to base their own stuff on
[2012-03-22 19:51:00 -0400] icoffey: we shall see
[2012-03-22 19:51:00 -0400] ryan-eme: @dgtized: maybe have your database restore script set a role attribute for the app servers
[2012-03-22 19:52:00 -0400] ryan-eme: and make your app server recipe check the attribute before proceeding
[2012-03-22 19:57:00 -0400] Rorgo: is it legal to do something like: default[:server][:vip_short] = node[:vip].split('.')[0] in an attributes file?
[2012-03-22 19:57:00 -0400] Rorgo: basically I'm just trying to get the short hostname of a VIP for use in a template
[2012-03-22 19:59:00 -0400] Cope: why not just pass node[:vip].split('.')[0] to the template from the recipe
[2012-03-22 19:59:00 -0400] Cope: doesn't need to be an attribute
[2012-03-22 20:02:00 -0400] matschaffer: anyone else here had trouble with knife ec2 not being able to ssh into the host after starting it? Seems like there's an ssh available race condition going on.  Do people generally just use user data scripts?
[2012-03-22 20:03:00 -0400] Rorgo: Cope: dunno, I keep getting a "NoMethodError: undefined method `[]' for nil:NilClass" when I try that. Not sure what I'm screwing up.
[2012-03-22 20:04:00 -0400] Cope: matschaffer: knife ec2 should handle and avoid that race condition. Are you using the latest version? If so, that's a bug.
[2012-03-22 20:04:00 -0400] matschaffer: Cope: latest from rubygems.org
[2012-03-22 20:04:00 -0400] Cope: Rorgo: well, what's node[:vip] ?
[2012-03-22 20:05:00 -0400] matschaffer: Cope: are bugs for that on github or opscode jira?
[2012-03-22 20:07:00 -0400] HasanB: Newbie question if I may (writing 1st cookbook)  :-)   Is there a resource for decompressing zip, tar.gz, etc.?
[2012-03-22 20:09:00 -0400] matschaffer: HasanB: there's a tar cookbook, but I couldn't figure out how to get it work on a local file
[2012-03-22 20:09:00 -0400] matschaffer: it seems to want to handle downloading the tarball as well
[2012-03-22 20:10:00 -0400] matschaffer: so I just used execute and `not_if "# check a file in the unpacked tar"`
[2012-03-22 20:10:00 -0400] spicyWith: Hey, could someone take a look at this stacktrace I'm getting when trying to use the mongodb cookbook and help me figure out why chef is flipping out?  http://pastebin.com/WthsGi63
[2012-03-22 20:12:00 -0400] Rorgo: Cope: think I got it. The split method is working, but a different recipe was complaining that I wasn't looking at. Thanks.
[2012-03-22 20:13:00 -0400] HasanB: matschaffer: well I'm looking at a zip anyway. An example I'm looking at has ---->   bash "somename" do  code <<-EOH  etc.,  etc.,  etc.,
[2012-03-22 20:14:00 -0400] matschaffer: HasanB: yeah, "execute" is basically the same thing as "bash". Just make sure to have an appropriate not_if so it's idempotent
[2012-03-22 20:15:00 -0400] HasanB: I was expecting an LWRP for decompressing but  ...  how do you look for something like that?  is there a LWRP catalog?
[2012-03-22 20:15:00 -0400] HasanB: or is LWRP not the suitable tool?
[2012-03-22 20:15:00 -0400] HasanB: (jeez, there's a lot to this, no?)
[2012-03-22 20:18:00 -0400] brett_h: can anyone help with a template error I just started receiving? http://dpaste.com/720191/
[2012-03-22 20:18:00 -0400] brett_h: why would node be nil?
[2012-03-22 20:19:00 -0400] brett_h: the resource: http://dpaste.com/720193/
[2012-03-22 20:19:00 -0400] matschaffer: HasanB: LWRPs come as part of cookbooks, so they'd be on community.opscode.com
[2012-03-22 20:20:00 -0400] matschaffer: But, as I'm sure some folks here would agree, if you want a solid process around files it's generally best to use an OS-package rather than a tarball
[2012-03-22 20:20:00 -0400] matschaffer: or zip
[2012-03-22 20:20:00 -0400] matschaffer: not to say I don't use a tar/zip from time to time :)
[2012-03-22 20:20:00 -0400] matschaffer: but that might be why there's not a lot of effort put into a really rock-solid tar/zip handler
[2012-03-22 20:20:00 -0400] matschaffer: afaik anyway
[2012-03-22 20:22:00 -0400] matschaffer: Cope: fyi, this knife-ec2 problem is on a t1.micro
[2012-03-22 20:22:00 -0400] matschaffer: I'm beginning to suspect they're just not fast enough for reliable cooking
[2012-03-22 20:23:00 -0400] matschaffer: I keep hitting mysql start timeouts as well
[2012-03-22 20:23:00 -0400] HasanB: matschaffer: maybe you know the Psi Probe manager for TomCat?  There's no cookbook for it, probably because it's just a question of unpacking a war from a zip and plopping it into TomCat webapps.
[2012-03-22 20:24:00 -0400] matschaffer: HasanB: not familiar with it, but the work I've done on tomcat wars in the past has been via RPM
[2012-03-22 20:24:00 -0400] HasanB: I thought it'd be a good way to get my feet wet, while making some sort of real world contribution.
[2012-03-22 20:24:00 -0400] matschaffer: if it's a small enough war and you just need the war, what about putting it in the cookbook's set of files?
[2012-03-22 20:24:00 -0400] matschaffer: then chef would check the md5 for you
[2012-03-22 20:24:00 -0400] matschaffer: or checksum anyway
[2012-03-22 20:24:00 -0400] matschaffer: dunno if it's md5
[2012-03-22 20:24:00 -0400] HasanB: SHA
[2012-03-22 20:25:00 -0400] HasanB: I do a remote_file to the Psi Probe repo to go get it.
[2012-03-22 20:26:00 -0400] HasanB: I'll just use an execute as you propose.
[2012-03-22 20:27:00 -0400] matschaffer: HasanB: yeah probably a fine way to go
[2012-03-22 20:28:00 -0400] HasanB: matschaffer: grateful for your help!
[2012-03-22 20:28:00 -0400] matschaffer: just include a not_if with some check to see if the file's already been extracted
[2012-03-22 20:28:00 -0400] matschaffer: I often check version numbers if that's a possibility
[2012-03-22 20:28:00 -0400] HasanB: yeah, I see the importance.
[2012-03-22 20:28:00 -0400] matschaffer: np, good luck!
[2012-03-22 20:29:00 -0400] brett_h: can anyone help with a template error I just started receiving? for some reason node is nil? this has worked before: http://dpaste.com/720191/
[2012-03-22 20:34:00 -0400] ryan-eme: are you sure node is nil? maybe it just doesnt have :ec2
[2012-03-22 20:36:00 -0400] spicyWith: Any takers for this stacktrace I'm getting when trying to use the mongodb cookbook and help me figure out why chef is flipping out?  http://pastebin.com/WthsGi63
[2012-03-22 20:40:00 -0400] matschaffer: Cope: yeah, having better luck on m1.small
[2012-03-22 20:41:00 -0400] matschaffer: spicyWith: looks like the syck/psych problem
[2012-03-22 20:42:00 -0400] spicyWith: matschaffer: what is that?
[2012-03-22 20:42:00 -0400] matschaffer: trying to find the good blog post on it
[2012-03-22 20:42:00 -0400] spicyWith: (thanks for responding, btw)
[2012-03-22 20:42:00 -0400] matschaffer: but it basically has to do with gemspecs that are packaged on bad versions of rubygems
[2012-03-22 20:42:00 -0400] geekbri: is there anything like a --dry-run flag for knife node bulk delete ?
[2012-03-22 20:43:00 -0400] matschaffer: spicyWith: this guy http://blog.rubygems.org/2011/08/31/shaving-the-yaml-yak.html
[2012-03-22 20:46:00 -0400] dezmodue: hello
[2012-03-22 20:46:00 -0400] spicyWith: matschaffer: hmmm, interesting. I'm new to ruby.
[2012-03-22 20:46:00 -0400] matschaffer: spicyWith: so yeah, what version of rubygems is on that node
[2012-03-22 20:47:00 -0400] spicyWith: matschaffer: how do I check that?
[2012-03-22 20:47:00 -0400] matschaffer: gem --version
[2012-03-22 20:47:00 -0400] matschaffer: I think
[2012-03-22 20:48:00 -0400] brett_h: when I run ohai on a new ec2 instance it's not filling out the 'ec2' hash, any ideas?
[2012-03-22 20:48:00 -0400] spicyWith: matschaffer: $ gem --version
[2012-03-22 20:48:00 -0400] spicyWith: Invalid gemspec in [/opt/ruby/lib/ruby/gems/1.9.1/specifications/mongo-1.6.0.gemspec]: Illformed requirement ["#<Syck::DefaultKey:0x00000003d7de78> 1.6.0"]
[2012-03-22 20:48:00 -0400] spicyWith: 1.8.11
[2012-03-22 20:49:00 -0400] matschaffer: move /opt/ruby/lib/ruby/gems/1.9.1/specifications/mongo-1.6.0.gemspec somewhere else and see if that helps
[2012-03-22 20:49:00 -0400] matschaffer: at least to determine the version
[2012-03-22 20:50:00 -0400] geekbri: Why does knife node delete not delete the knodes from clients as well
[2012-03-22 20:50:00 -0400] mattray: geekbri: knife node bulk delete blah*
[2012-03-22 20:50:00 -0400] mattray: geekbri: then answer "no"?
[2012-03-22 20:50:00 -0400] geekbri: mattray: yeah did that.... ;)
[2012-03-22 20:50:00 -0400] spicyWith: matschaffer:   is the search problem coming from there?  
[2012-03-22 20:50:00 -0400] mattray: but it would be nice to say "knife node bulk delete blah* -n"
[2012-03-22 20:51:00 -0400] mattray: geekbri: tickets/patches welcome
[2012-03-22 20:51:00 -0400] dezmodue: I am looking for some advice on how to scale Chef server api beside multiple workers and without shared file system if anyone around that has some experience with it
[2012-03-22 20:51:00 -0400] geekbri: mattray: by the way I gave you a pull request on spice weasel, but it really needs more testing first I just haven't had time.
[2012-03-22 20:51:00 -0400] matschaffer: spicyWith: sorry, missed that. What search problem?
[2012-03-22 20:51:00 -0400] spicyWith: should I just upgrade the gem
[2012-03-22 20:51:00 -0400] mattray: geekbri: yeah, I've been busy with some other stuff, gonna try to merge a bunch of spiceweasel patches soon
[2012-03-22 20:51:00 -0400] spicyWith: matschaffer: What I mention here:  http://pastebin.com/WthsGi63
[2012-03-22 20:51:00 -0400] Kwanasolis: archlinux-offtopic
[2012-03-22 20:51:00 -0400] geekbri: mattray: I have more changes I need to make too, just searching for time :(
[2012-03-22 20:52:00 -0400] mattray: geekbri: around anything in particular?
[2012-03-22 20:52:00 -0400] spicyWith: looking for the line
[2012-03-22 20:52:00 -0400] matschaffer: spicyWith: that's just a warning
[2012-03-22 20:52:00 -0400] geekbri: mattray: yeah, I want to make it so the cookbook part uses your cookbooks path and not just a hardcoded cookbooks/ directory
[2012-03-22 20:52:00 -0400] dezmodue: on another note anyone managing thousands of nodes?
[2012-03-22 20:52:00 -0400] spicyWith: matschaffer: starting on line 122
[2012-03-22 20:52:00 -0400] mattray: geekbri: sounds reasonable
[2012-03-22 20:53:00 -0400] geekbri: mattray: the change I already made was that currently it just looked in roles/ for roles, but I had a lot of my role files nested in sub directories so I just set it to recursively search those directories as well
[2012-03-22 20:53:00 -0400] geekbri: mattray: did my best to try to make it fit into the existing code without too many changes.
[2012-03-22 20:54:00 -0400] matschaffer: spicyWith: dunno
[2012-03-22 20:54:00 -0400] geekbri: mattray: but I only tested it with yaml, didnt have time to test it with json
[2012-03-22 20:54:00 -0400] matschaffer: seems like /srv/chef/file_store/cookbooks/mongodb/definitions/mongodb.rb:183 might be a place to look
[2012-03-22 20:54:00 -0400] mattray: geekbri: I barely test the JSON side, it usually just works
[2012-03-22 20:56:00 -0400] josephholsten: ohowdy
[2012-03-22 20:58:00 -0400] spicyWith: matschaffer: right, but can't see anything obvious there, this is what it looks like - https://github.com/bknowles/mongodb/blob/master/definitions/mongodb.rb
[2012-03-22 21:01:00 -0400] brett_h: opscode guys, the new ohai release (I'm using opscode apt repo) isn't detecting ec2 node and filling in metadata for me, breaking a lot of things.
[2012-03-22 21:01:00 -0400] spicyWith: matschaffer: moved the mongo gem and seems to have helped, but still failing on that search request :(
[2012-03-22 21:03:00 -0400] mosez: hi
[2012-03-22 21:04:00 -0400] mosez: is there a way to deploy chef server on heroku? =)
[2012-03-22 21:05:00 -0400] matschaffer: spicyWith: I suspect the cookbook is old and/or broken
[2012-03-22 21:05:00 -0400] matschaffer: mosez: you could maybe shoehorn something, but why not use the opscode hosted?
[2012-03-22 21:05:00 -0400] matschaffer: it's free for up to 5 nodes
[2012-03-22 21:05:00 -0400] aethier: Anyone can help me doing a REST call to hosted chef? I need to be bale to curl a call.  - thanks
[2012-03-22 21:06:00 -0400] matschaffer: where'd you get it, community.opscode?
[2012-03-22 21:07:00 -0400] mosez: matschaffer: because i've got more nodes when i add my vagrant boxes too :(
[2012-03-22 21:07:00 -0400] jtimberman: mosez: Andrea Campi, iirc, was discussing that at the Chef Community Summit last November.
[2012-03-22 21:07:00 -0400] mosez: matschaffer: and 100$ is much money...
[2012-03-22 21:07:00 -0400] cwj: aethier: chef-server, whether hosted chef or otherwise, requires API calls to be cryptographically signed. have you looked at writing a script that you can use with 'knife exec' ?
[2012-03-22 21:08:00 -0400] josephholsten: mosez: what's your billable rate? how many hours a month are you planning on wasting keeping your jury-rigged solution together?
[2012-03-22 21:08:00 -0400] spicyWith: matschaffer: how can cookbooks break? Yeah, this is a patched up version of the community site broken one, but the problem is that it's not even clear what's broken here
[2012-03-22 21:08:00 -0400] matschaffer: spicyWith: I'd need to see what it's doing to be sure. But the error reads like it's using an old search syntax
[2012-03-22 21:09:00 -0400] matschaffer: cookbooks are not always future proof wrt chef versions
[2012-03-22 21:09:00 -0400] brett_h: new ohai:
[2012-03-22 21:09:00 -0400] brett_h: [Thu, 22 Mar 2012 21:09:15 +0000] DEBUG: Plugin ec2 threw exception #<NoMethodError: undefined method `[]' for nil:NilClass> /usr/lib/ruby/1.8/ohai/plugins/ec2.rb:31:in `has_ec2_mac?'
[2012-03-22 21:09:00 -0400] spicyWith: matschaffer: any chance you could take a look at the source or give me some direction? new to chef and ruby :(
[2012-03-22 21:09:00 -0400] josephholsten: mosez: but you _should_ check out amazon's ec2 micro instances
[2012-03-22 21:09:00 -0400] matschaffer: josephholsten: can you run chef on a micro though?
[2012-03-22 21:10:00 -0400] matschaffer: last I tried it wasn't enough ram
[2012-03-22 21:10:00 -0400] Kwanasolis: I run a chef-server on the smallest linode they sell
[2012-03-22 21:10:00 -0400] matschaffer: spicyWith: I'd need to see that line in the mongo cookbook
[2012-03-22 21:10:00 -0400] Kwanasolis: mosez: was some work to setup, but doable
[2012-03-22 21:10:00 -0400] matschaffer: Kwanasolis: nice, maybe it's better now. I haven't run my own since 0.9
[2012-03-22 21:10:00 -0400] josephholsten: if you're running hosted couch and rabbit, maybe?
[2012-03-22 21:10:00 -0400] josephholsten: not like you could run those on heroku
[2012-03-22 21:10:00 -0400] mosez: josephholsten: thx, i will take a look at ec2 first.
[2012-03-22 21:11:00 -0400] matschaffer: mosez: http://devops.mashion.net/2011/08/19/chef-server-installation/ shows how to set one up if you need it
[2012-03-22 21:11:00 -0400] matschaffer: it's a little old but the process should still be fairly similar
[2012-03-22 21:11:00 -0400] mosez: matschaffer: linode should be an alternative, thx
[2012-03-22 21:11:00 -0400] matschaffer: of course, use the wiki for the source of truth
[2012-03-22 21:13:00 -0400] Kwanasolis: mosez: I just like linode for the iops more then the cheap ec2's
[2012-03-22 21:13:00 -0400] Kwanasolis: they don't throttle
[2012-03-22 21:15:00 -0400] spicyWith: matschaffer: here's the source https://github.com/bknowles/mongodb/blob/master/definitions/mongodb.rb#L182
[2012-03-22 21:16:00 -0400] matschaffer: spicyWith: I question that \\:\\
[2012-03-22 21:16:00 -0400] josephholsten: mosez: but if you need unlimited data transfer and are willing to learn solaris: joyent is awesome
[2012-03-22 21:17:00 -0400] spicyWith: matschaffer: what should it be?
[2012-03-22 21:17:00 -0400] c_t: josephholsten: if you like it so much, why not write a song about it?
[2012-03-22 21:17:00 -0400] c_t: some sort of Ode to Joyent
[2012-03-22 21:17:00 -0400] matschaffer: but I'd also put that big string in a var then Chef::Log.info(search_string) to make sure something else wasn't causing trouble
[2012-03-22 21:18:00 -0400] matschaffer: like a missing string or something
[2012-03-22 21:18:00 -0400] matschaffer: oh, nm, I see what that's doing
[2012-03-22 21:18:00 -0400] matschaffer: looking for a node that includes that recipe
[2012-03-22 21:19:00 -0400] matschaffer: spicyWith: do you know what your cluster_name and shard_name are?
[2012-03-22 21:20:00 -0400] spicyWith: matschaffer: yes, I set them in my Vagrantfile  chef.json = { :mongod => { :cluster_name => "clusterfluff",  # this is one replicaset } }
[2012-03-22 21:20:00 -0400] spicyWith: matschaffer: I assume that's how I should be doing it, but I might be wrong
[2012-03-22 21:21:00 -0400] matschaffer: what about the shard_name?
[2012-03-22 21:21:00 -0400] matschaffer: I don't use vagrant, so no idea :)
[2012-03-22 21:21:00 -0400] spicyWith: matschaffer: I'm not doing sharding yet, so I'm not setting it. How would you set it from the commandline?
[2012-03-22 21:22:00 -0400] matschaffer: okay, then that's probably the problem
[2012-03-22 21:22:00 -0400] matschaffer: well unless the recipe sets a default
[2012-03-22 21:22:00 -0400] matschaffer: what does ` knife search node mongodb_cluster_name:clusterfluff AND recipes:mongodb\\:\\:replicaset` do?
[2012-03-22 21:23:00 -0400] spicyWith: 0 items found
[2012-03-22 21:23:00 -0400] matschaffer: good start
[2012-03-22 21:23:00 -0400] matschaffer: are you using mongodb::replicaset on any nodes?
[2012-03-22 21:23:00 -0400] matschaffer: the recipe?
[2012-03-22 21:23:00 -0400] bawt_: the recipe is just 3 execute commands
[2012-03-22 21:25:00 -0400] kbader: since cookbooks are their own repos now I was trying to use submodules in my chef-repo/cookbooks/ directory
[2012-03-22 21:26:00 -0400] btm: bawt_: forget the recipe
[2012-03-22 21:26:00 -0400] bawt_: done
[2012-03-22 21:26:00 -0400] kbader: has anyone ran into something like this http://pastebin.com/dD1R82jj
[2012-03-22 21:26:00 -0400] spicyWith: matschaffer: yes, I have a role that includes the mongodb::replicaset recipe, following the docs https://github.com/bknowles/mongodb
[2012-03-22 21:26:00 -0400] kbader: seems to be tripping up on the _ or the -
[2012-03-22 21:27:00 -0400] spicyWith: matschaffer: it's in a role though, which is then in the runlist. This should work, right?
[2012-03-22 21:27:00 -0400] matschaffer: spicyWith: yeah, but have any of the nodes successfully run it?
[2012-03-22 21:27:00 -0400] matschaffer: or at least have it in their run list?
[2012-03-22 21:27:00 -0400] spicyWith: matschaffer: probably not, no
[2012-03-22 21:27:00 -0400] matschaffer: basically I'm trying to first determine what query would even be valid
[2012-03-22 21:27:00 -0400] matschaffer: okay
[2012-03-22 21:28:00 -0400] matschaffer: so we're good so far then
[2012-03-22 21:29:00 -0400] matschaffer: spicyWith: how about: https://gist.github.com/2164701
[2012-03-22 21:31:00 -0400] matschaffer: spicyWith: fyi, just updated. Needs quotes around the query
[2012-03-22 21:31:00 -0400] spicyWith: matschaffer: I added an AND \ in there I thought was missing
[2012-03-22 21:31:00 -0400] matschaffer: oh yeah, that too
[2012-03-22 21:31:00 -0400] spicyWith: 0 items found
[2012-03-22 21:32:00 -0400] matschaffer: okay
[2012-03-22 21:32:00 -0400] matschaffer: so sounds like the basic idea of the query is fine
[2012-03-22 21:33:00 -0400] matschaffer: which would mean replicaset['mongodb']['cluster_name'] or replicaset['mongodb']['shard_name'] or replicaset.chef_environment is producing an odd value
[2012-03-22 21:33:00 -0400] spicyWith: matschaffer: I feel like the docs are probably broken or out of sync with the code. Not sure why it's so complex to begin with though
[2012-03-22 21:33:00 -0400] spicyWith: (the recipe)
[2012-03-22 21:34:00 -0400] spicyWith: chef_environment is currently set to dev
[2012-03-22 21:34:00 -0400] matschaffer: spicyWith: so I'd try this next https://gist.github.com/2164701#file_recipe.rb
[2012-03-22 21:34:00 -0400] matschaffer: hopefully you'll see something that doesn't match up with the query that worked (although didn't find any nodes)
[2012-03-22 21:35:00 -0400] aethier: cwj Re hosted chef API call.  I need to query hosed chef from a Scala application so I can't use knife or any other chef libraries
[2012-03-22 21:36:00 -0400] aethier: cwj I was asking about curl to figure out what I need to authenticate and then query hosted chef. -thanks,
[2012-03-22 21:36:00 -0400] matschaffer: spicyWith: sharding and replication isn't super easy to begin with, but granted, there may be ways to make that query simpler
[2012-03-22 21:37:00 -0400] spicyWith: matschaffer: modifying recipe...
[2012-03-22 21:37:00 -0400] matschaffer: or support hard-coding of replica values from a node config or something
[2012-03-22 21:37:00 -0400] cwj: aethier: http://wiki.opscode.com/display/chef/Making+Authenticated+API+Requests
[2012-03-22 21:37:00 -0400] btm: aethier: have you looked at the chef library to it creates the signed headers used for authentication?
[2012-03-22 21:37:00 -0400] aethier: cwj sweet - thanks.
[2012-03-22 21:38:00 -0400] aethier: @btm yes I was jsut starting to look at it few mins ago. I can probably figure it out. thanks
[2012-03-22 21:38:00 -0400] btm: brett_h: do an apt-get update and install ohai 0.6.12-2.
[2012-03-22 21:40:00 -0400] brett_h: btm: it doesn't seem to have the dep
[2012-03-22 21:40:00 -0400] brett_h: btm: https://gist.github.com/2164770
[2012-03-22 21:40:00 -0400] brett_h: btm: (it still fails)
[2012-03-22 21:41:00 -0400] brett_h: btm: I see ruby-ipaddress in apt, though, but it's not a dep
[2012-03-22 21:42:00 -0400] spicyWith: matschaffer: hmm, looks like cluster_name is not being set :(
[2012-03-22 21:43:00 -0400] btm: brett_h: dpkg -l | grep *ohai*
[2012-03-22 21:43:00 -0400] btm: brett_h: libohai-ruby1.8 probably didn't upgrade.
[2012-03-22 21:43:00 -0400] spicyWith: matschaffer: http://pastebin.com/B4qrqmvZ
[2012-03-22 21:43:00 -0400] brett_h: btm: https://gist.github.com/2164770
[2012-03-22 21:43:00 -0400] tolland: ive started work on some chef plugins for eclipse, such as completions for the resource types and a project template
[2012-03-22 21:44:00 -0400] tolland: i see gepetto for puppet, are there any other gui projects that i can look at for chef?
[2012-03-22 21:44:00 -0400] btm: brett_h: yeah, the dep is actually on libohai-ruby1.8. all the rest is magic debian package naming from a past era. 'sudo apt-get install ohai libohai-ruby libohai-ruby1.8'
[2012-03-22 21:44:00 -0400] brett_h: btm: ah gotcha, yeah that works. let me try a fresh node
[2012-03-22 21:45:00 -0400] brett_h: btm: and thanks
[2012-03-22 21:48:00 -0400] brett_h: btm: so... this is going to cause a problem on all existing nodes
[2012-03-22 21:48:00 -0400] brett_h: btm: because "libohai-ruby libohai-ruby1.8" are kept back by default
[2012-03-22 21:48:00 -0400] brett_h: btm: so the next upgrade I run will grab the new ohai but not the deps
[2012-03-22 21:49:00 -0400] btm: brett_h: kept back because you have them pinned?
[2012-03-22 21:50:00 -0400] brett_h: definitely not on my side
[2012-03-22 21:50:00 -0400] brett_h: I don't pin anything myself
[2012-03-22 21:51:00 -0400] brett_h: I can go force the install on my boxes but it seems like this will hurt a lot of people
[2012-03-22 21:51:00 -0400] btm: brett_h: only if you've already installed 0.6.12-1.
[2012-03-22 21:51:00 -0400] btm: brett_h: otherwise, you'll upgrade all the packages to 0.6.12-2.
[2012-03-22 21:52:00 -0400] btm: brett_h: 0.6.12-1 is no longer on the server. It's only been up there a couple of hours.
[2012-03-22 21:52:00 -0400] brett_h: btm: no, I went to a box I hadn't upgraded on (and again, I don't pin anything myself, these are alestic ubuntu boxes bootstrapped by knife) and it was holding back libohai
[2012-03-22 21:53:00 -0400] btm: brett_h: what exactly do you mean by holding back?
[2012-03-22 21:55:00 -0400] brett_h: btm: https://gist.github.com/2164870
[2012-03-22 21:56:00 -0400] brett_h: note the "the following will be kept back"
[2012-03-22 21:56:00 -0400] KarlHungus: the guys building ironfan are doing some serious sorcery
[2012-03-22 21:57:00 -0400] KarlHungus: thank you, anyone who may have had a hand in it!
[2012-03-22 21:57:00 -0400] btm: brett_h: well that's sort of silly. thats a different issue because at the end of the day you're still running _0.6.10_
[2012-03-22 21:58:00 -0400] brett_h: I don't get why it's being held back/pinned, if not me
[2012-03-22 21:58:00 -0400] brett_h: unrelated, is sigar another missing dep?
[2012-03-22 21:58:00 -0400] brett_h: I see it can't be loaded
[2012-03-22 21:58:00 -0400] btm: brett_h: sigar is an optional dep
[2012-03-22 21:58:00 -0400] brett_h: ah alright
[2012-03-22 21:59:00 -0400] brett_h: btm: so updating ohai itself does... nothing?
[2012-03-22 21:59:00 -0400] brett_h: because it's happy to update ohai, just not libohai
[2012-03-22 21:59:00 -0400] btm: brett_h: the ohai package is mostly a wrapper (dpkg -L ohai)
[2012-03-22 21:59:00 -0400] brett_h: gotcha
[2012-03-22 22:00:00 -0400] brett_h: alright, as long as it's safe :)
[2012-03-22 22:00:00 -0400] brett_h: I can provision again, huzzah
[2012-03-22 22:01:00 -0400] btm: brett_h: what happens when you run 'apt-get install libohai-ruby libohai-ruby1.8'?
[2012-03-22 22:01:00 -0400] brett_h: btm: that works fine, and upgrades them, and ohai works
[2012-03-22 22:01:00 -0400] brett_h: but having to know to force it is a problem, obviously. but knowing that ohai is just a wrapper I agree that it's ok
[2012-03-22 22:02:00 -0400] btm: brett_h: so I'm clear, if you're on a system with all ohai packages at 0.6.10 and you upgrade, it still upgrade ohai to 0.6.12?
[2012-03-22 22:03:00 -0400] brett_h: btm: yes, only ohai, not the libs, but it does work, like you said
[2012-03-22 22:03:00 -0400] brett_h: since it's still really 0.6.10
[2012-03-22 22:03:00 -0400] brett_h: for some reason they're held back (and again, I don't do that)
[2012-03-22 22:03:00 -0400] brett_h: must be something in the package/your repo? I don't know alot about deb pinning
[2012-03-22 22:04:00 -0400] josephholsten: what's the right way to grab all the FQDNs and IPs of my nodes? shef? piping knife search to some script?
[2012-03-22 22:04:00 -0400] btm: brett_h: hrm. well, I suspect an 'sudo apt-get dist-upgrade' would pull them in.
[2012-03-22 22:05:00 -0400] brett_h: btm: you're right
[2012-03-22 22:05:00 -0400] btm: brett_h: that's usually what "held back" there means. I'm not sure what triggers it.
[2012-03-22 22:07:00 -0400] btm: brett_h: "If the dependencies have changed on one of the packages you have installed so that a new package must be installed to perform the upgrade then that will be listed as "kept-back"." http://www.debian-administration.org/articles/69
[2012-03-22 22:22:00 -0400] wamcvey:  I'm trying to use the user cookbook's users_manage lwrp in a site-specific recipe. In the resource stanza of the site-specific recipe, I specify 'provider :users' but when I apply the recipe through a role, I get: FATAL: NoMethodError: undefined method `users_manage'
[2012-03-22 22:24:00 -0400] wamcvey: any ideas?
[2012-03-22 22:25:00 -0400] flaccid: anyone seen any chef cookbooks/stuff for uberSVN ?
[2012-03-22 22:28:00 -0400] miah: people still use subversion?
[2012-03-22 22:28:00 -0400] btm: Alright, Ohai 0.6.12 released officially: http://www.opscode.com/blog/2012/03/22/ohai-0-6-12-released/
[2012-03-22 22:29:00 -0400] miah: nice
[2012-03-22 22:29:00 -0400] sntxrr: Ohai O!
[2012-03-22 22:29:00 -0400] wamcvey: Hmm... looks like I need to use users_manage as my provider in my recipe, but it still croaks. Ugh
[2012-03-22 22:36:00 -0400] fractaloop: Any idea why my bootstrap would fail after registration? It creates the client on hosted chef ok, but then fails when trying to create the node...
[2012-03-22 22:37:00 -0400] wamcvey: Anyone else using the opscode users cookbook/provider in their own recipes?
[2012-03-22 23:03:00 -0400] miketheman: wamcvey: I'm using an older version
[2012-03-22 23:03:00 -0400] wamcvey: I've kind of grown frustrated with trying to get it to work... so am trying to switch over to 'user' (out of the community cookbooks)
[2012-03-22 23:03:00 -0400] miketheman: wamcvey: what's the problem?
[2012-03-22 23:04:00 -0400] wamcvey:  I'm trying to use the user cookbook's users_manage lwrp in a site-specific recipe. In the resource stanza of the site-specific recipe, I specify 'provider :users_manage' but when I apply the recipe through a role, I get: FATAL: NoMethodError: undefined method `users_manage'
[2012-03-22 23:05:00 -0400] miketheman: wamcvey: I haven't tried that, but are you including the users cookbook before declaring the provider?
[2012-03-22 23:07:00 -0400] wamcvey: miketheman: Umm no.  I don't think I was. So I'd need: include_recipe "users"   which I'm pretty sure wasn't in there.
[2012-03-22 23:08:00 -0400] miketheman: wamcvey: probably the case, otherwise your site-specific cookbook has no idea of the lwrp from the users cookbook
[2012-03-22 23:08:00 -0400] wamcvey: I figured it'd know based on the fact that I specified the user_manage as my provider...
[2012-03-22 23:09:00 -0400] miketheman: it might need that in metadata.rb: depends 'users'
[2012-03-22 23:09:00 -0400] miketheman: I'd test that first, and then use the inculde_recipe
[2012-03-22 23:10:00 -0400] wamcvey: I kind of like the 'user' recipe though... allows me to lock/unlock accounts (rather than just create/delete)
[2012-03-22 23:16:00 -0400] wamcvey: miketheman: thanks though for getting back to my question. :-)
[2012-03-22 23:16:00 -0400] miketheman: wamcvey: no problem
[2012-03-22 23:40:00 -0400] TheBeast: is is possible to force chef-client to re-run a specific cookbook?
[2012-03-22 23:40:00 -0400] ryan-eme: run chef-client a second time
[2012-03-22 23:41:00 -0400] flaccid: um not sure, but you run recipes not cookbooks. you could change run_list to take out the other recipes
[2012-03-22 23:42:00 -0400] hoover_damm: Thank you for the build-essential cookbook for not failing on Gentoo!
[2012-03-22 23:42:00 -0400] hoover_damm: :D
[2012-03-22 23:47:00 -0400] TheBeast: weird, I think my recipe is poorly coded
[2012-03-22 23:47:00 -0400] TheBeast: so if I install a new kernel version i'd expect it to run and recompile a driver against my new kernel
[2012-03-22 23:47:00 -0400] TheBeast: oh well
