[2012-03-12 07:00:00 -0400] Viral1: segv: how are you handling assertions in your build for your infrastructure?
[2012-03-12 07:01:00 -0400] Viral1: or "how do you know that something bad didnt just get commit for chef"
[2012-03-12 07:01:00 -0400] segv: Viral1: oh, well, we test everything through ruby obviously to test syntax, we also have a test script before you commit
[2012-03-12 07:02:00 -0400] segv: part of our "test" before commit the buildbots just the "blame person who broke it" portion.
[2012-03-12 07:02:00 -0400] segv: Haven't yet setup a 'chef-solo' test to test whether or not it works but, thats probably out of the way at this point
[2012-03-12 07:03:00 -0400] segv: but chef-solo tests dont really work on data bags
[2012-03-12 07:03:00 -0400] segv: well they do but it was built before that worked properly
[2012-03-12 07:03:00 -0400] Viral1: segv: so you dont run a staging environment?
[2012-03-12 07:04:00 -0400] segv: we do
[2012-03-12 07:04:00 -0400] segv: we have different repos from prod/master.
[2012-03-12 07:05:00 -0400] segv: master->dev testing->staging prod->prod
[2012-03-12 07:05:00 -0400] segv: dev is local, staging is testing it live, prod is well prod
[2012-03-12 07:05:00 -0400] c64: segv: how do you keep the repo's in sync?
[2012-03-12 07:05:00 -0400] Viral1: segv: interesting, thanks
[2012-03-12 07:05:00 -0400] segv: c64: generally just forward commits on git
[2012-03-12 07:05:00 -0400] c64: kk
[2012-03-12 07:06:00 -0400] segv: not very hard since you never touch the repositories manually
[2012-03-12 07:06:00 -0400] segv: always push from one to the next w/out frying another
[2012-03-12 07:06:00 -0400] |shad0w|: and don't let people edit things in the webui
[2012-03-12 07:06:00 -0400] segv: |shad0w|: I've fixed that :)
[2012-03-12 07:06:00 -0400] |shad0w|: I'm close to it segv
[2012-03-12 07:07:00 -0400] |shad0w|: have a new 10. setup and migration to it should be fun for everyone
[2012-03-12 07:07:00 -0400] |shad0w|: putting our release process into the dev process
[2012-03-12 07:07:00 -0400] segv: A) throw :4000 behind firewall, B) lock down client acces to urls except from buildbot :D
[2012-03-12 07:07:00 -0400] |shad0w|: free compliance and change control
[2012-03-12 07:07:00 -0400] segv: you can't knife push anything to it directly
[2012-03-12 07:20:00 -0400] auro: |shad0w|: install sun-java, reinstall chef, I checked all the servers running.
[2012-03-12 07:20:00 -0400] auro: administrator@chef:~$ knife search node "chef_environment:_default"
[2012-03-12 07:20:00 -0400] auro: 0 items found
[2012-03-12 07:20:00 -0400] |shad0w|: You might have to rebuild the index
[2012-03-12 07:20:00 -0400] |shad0w|: this is a new server setup is it not auro?
[2012-03-12 07:22:00 -0400] |shad0w|: how about knife search node "*:*" -a chef_environment
[2012-03-12 07:22:00 -0400] auro: configs are old
[2012-03-12 07:24:00 -0400] auro: knife search node "*:*" -a chef_environment
[2012-03-12 07:24:00 -0400] auro: 0 items found
[2012-03-12 07:25:00 -0400] |shad0w|: did this chef setup ever work?
[2012-03-12 07:25:00 -0400] auro: don't shure
[2012-03-12 07:26:00 -0400] auro: sure*
[2012-03-12 07:26:00 -0400] auro: administrator@chef:~$ knife node list
[2012-03-12 07:26:00 -0400] auro:   auro-laptop
[2012-03-12 07:26:00 -0400] auro:   chef.haulmont.com
[2012-03-12 07:26:00 -0400] auro:   test
[2012-03-12 07:27:00 -0400] segv: hmm
[2012-03-12 07:27:00 -0400] segv: my chef_environments search doesn't return anything either
[2012-03-12 07:27:00 -0400] |shad0w|: You probably need to rebuild the index is solr wasn't properly configured. You can do this from knife with "knife index rebuild"
[2012-03-12 07:27:00 -0400] segv: I have > 300 known nodes with it
[2012-03-12 07:27:00 -0400] segv: haha
[2012-03-12 07:27:00 -0400] segv: all other searches work
[2012-03-12 07:27:00 -0400] |shad0w|: works for me
[2012-03-12 07:28:00 -0400] auro: in previous installation receipts were work
[2012-03-12 07:28:00 -0400] segv: the secondary search for -a chef_environment work
[2012-03-12 07:29:00 -0400] auro: knife index rebuild -VVV
[2012-03-12 07:29:00 -0400] auro: DEBUG: Using configuration from /home/administrator/.chef/knife.rb
[2012-03-12 07:29:00 -0400] auro: This operation is destructive. Rebuilding the index may take some time. You sure? (yes/no): yes
[2012-03-12 07:29:00 -0400] auro: DEBUG: Signing the request as administrator
[2012-03-12 07:29:00 -0400] auro: DEBUG: Sending HTTP Request via POST to chef.haulmont.com:4000//search/reindex
[2012-03-12 07:29:00 -0400] auro: INFO: HTTP Request Returned 500 Internal Server Error: Connection failed - user: chef
[2012-03-12 07:29:00 -0400] auro: ERROR: Server returned error for http://chef.haulmont.com:4000//search/reindex, retrying 1/5 in 4s
[2012-03-12 07:29:00 -0400] segv: auro: on the server end, what does it say?
[2012-03-12 07:29:00 -0400] segv: if you're getting a 500 the chef-server log will say something
[2012-03-12 07:29:00 -0400] auro: ERROR: internal server error
[2012-03-12 07:29:00 -0400] auro: Response: Connection failed - user: chef
[2012-03-12 07:30:00 -0400] |shad0w|: rabbitmqctl list_permissions -p /chef
[2012-03-12 07:30:00 -0400] segv: yeah
[2012-03-12 07:30:00 -0400] segv: was going to suggest that
[2012-03-12 07:30:00 -0400] segv: 90% of my chef issues involved rabbitmq :\
[2012-03-12 07:31:00 -0400] |shad0w|: if you have large ammounts of attrib data (like users from ohai) you can break solr too
[2012-03-12 07:31:00 -0400] |shad0w|: http://tickets.opscode.com/browse/CHEF-2346
[2012-03-12 07:31:00 -0400] segv: <3 solr
[2012-03-12 07:32:00 -0400] auro: sudo rabbitmqctl list_permissions -p /chef
[2012-03-12 07:32:00 -0400] auro: Listing permissions in vhost "/chef" ...
[2012-03-12 07:32:00 -0400] auro: chef    .*      .*      .*
[2012-03-12 07:32:00 -0400] auro: ...done.
[2012-03-12 07:32:00 -0400] |shad0w|: audo is the configured password for chef correct?
[2012-03-12 07:33:00 -0400] |shad0w|: for rabbitmq in the chef config
[2012-03-12 07:33:00 -0400] |shad0w|: segv, have you looked at elastic search yet?
[2012-03-12 07:33:00 -0400] segv: |shad0w|: for what?
[2012-03-12 07:33:00 -0400] segv: I use it for other projects already
[2012-03-12 07:33:00 -0400] |shad0w|: instead of solr
[2012-03-12 07:34:00 -0400] |shad0w|: auto sharding ftw
[2012-03-12 07:35:00 -0400] auro: where it is?
[2012-03-12 07:35:00 -0400] |shad0w|: if nothing is explicitly set i think it defaults to chef:testing for user:pass for rabbitmq. Can't honestly say though
[2012-03-12 07:35:00 -0400] segv: auro: server.rb look for "amqp_pass"
[2012-03-12 07:36:00 -0400] |shad0w|: it might also need to be in solr.rb
[2012-03-12 07:36:00 -0400] |shad0w|: can't remember
[2012-03-12 07:36:00 -0400] segv: |shad0w|: ah yep
[2012-03-12 07:36:00 -0400] auro: yes, in solr.rb
[2012-03-12 07:36:00 -0400] auro: testing
[2012-03-12 07:37:00 -0400] |shad0w|: try reseting the chef password in rabbitmq: rabbitmqctl change_password chef testing
[2012-03-12 07:37:00 -0400] |shad0w|: and make sure chef-expander is running with at least one node
[2012-03-12 07:38:00 -0400] |shad0w|: You may have to restart solr chef-expander and chef-server after the change
[2012-03-12 07:39:00 -0400] |shad0w|: chef-server-webui might need a nudge too, not sure if it does everything through chef-server api or not
[2012-03-12 07:39:00 -0400] segv: |shad0w|: where did you see the chef-solr/elasticsearch think on the ML?
[2012-03-12 07:40:00 -0400] |shad0w|: no where, was just wondering if you had taken a look at it
[2012-03-12 07:40:00 -0400] auro: yeah
[2012-03-12 07:40:00 -0400] auro: setup, restart reindex
[2012-03-12 07:40:00 -0400] auro: success
[2012-03-12 07:41:00 -0400] |shad0w|: search working now?
[2012-03-12 07:41:00 -0400] auro: not
[2012-03-12 07:42:00 -0400] |shad0w|: but the knike index rebuild didn't fail?
[2012-03-12 07:42:00 -0400] auro: yes
[2012-03-12 07:42:00 -0400] |shad0w|: ps wwwaux | grep chef-expander
[2012-03-12 07:43:00 -0400] |shad0w|: pastebin if the output is large
[2012-03-12 07:44:00 -0400] auro: http://pastebin.com/XG6jaKS9
[2012-03-12 07:44:00 -0400] |shad0w|: pastebin the output of ps wwwaux | grep chef-expander
[2012-03-12 07:45:00 -0400] auro: administrator@chef:~$ ps wwwaux | grep chef-expander
[2012-03-12 07:45:00 -0400] auro: root      5846  0.0  1.5  81884 15736 ?        S    11:39   0:00 /usr/bin/ruby1.8 /usr/bin/chef-expander -d -c /etc/chef/solr.rb -P /var/run/chef/expander.pid -L /var/log/chef/expander.log -n 1 -i 1
[2012-03-12 07:45:00 -0400] auro: root      5847  0.9  3.7 105356 38200 ?        S    11:39   0:03 chef-expander worker #1 (vnodes 0-1023)
[2012-03-12 07:45:00 -0400] |shad0w|: nm, it started with one node
[2012-03-12 07:46:00 -0400] |shad0w|: knife search node "*:*" -a name
[2012-03-12 07:47:00 -0400] auro: 0 items found
[2012-03-12 07:47:00 -0400] |shad0w|: and you have amqp_pass in both server.rb and solr.rb ?
[2012-03-12 07:48:00 -0400] auro: only solr.rb
[2012-03-12 07:48:00 -0400] |shad0w|: does rabbitmqctl list_queues -p /chef return anything?
[2012-03-12 07:49:00 -0400] auro: yes...
[2012-03-12 07:50:00 -0400] |shad0w|: how many connections does it have? rabbitmqctl list_connections -p /chef
[2012-03-12 07:50:00 -0400] auro: http://pastebin.com/FbUpkZrf
[2012-03-12 07:50:00 -0400] auro: it is just a little bit
[2012-03-12 07:50:00 -0400] |shad0w|: 1, 2 ,4 ?
[2012-03-12 07:51:00 -0400] auro: 1031
[2012-03-12 07:51:00 -0400] |shad0w|: rabbitmqctl list_connections -p /chef | grep -c running
[2012-03-12 07:51:00 -0400] auro: 2
[2012-03-12 07:52:00 -0400] |shad0w|: what happens if you rerun chef client on one of the nodes?
[2012-03-12 07:52:00 -0400] auro: nothing
[2012-03-12 07:52:00 -0400] |shad0w|: does it complete?
[2012-03-12 07:54:00 -0400] auro: yes
[2012-03-12 07:55:00 -0400] |shad0w|: is it in search now?
[2012-03-12 07:55:00 -0400] |shad0w|: and what OS's are your clients?
[2012-03-12 07:55:00 -0400] auro: not search
[2012-03-12 07:55:00 -0400] auro: mint
[2012-03-12 07:55:00 -0400] |shad0w|: does /var/log/chef/expander.log exist?
[2012-03-12 07:56:00 -0400] auro: may be, install new chef client?
[2012-03-12 07:56:00 -0400] auro: exists
[2012-03-12 07:57:00 -0400] |shad0w|: anyhthing interesting in it?
[2012-03-12 07:57:00 -0400] |shad0w|: I've got to go soon, bed time
[2012-03-12 07:57:00 -0400] auro: empty
[2012-03-12 07:58:00 -0400] auro: ok. thanks for the help me
[2012-03-12 07:58:00 -0400] |shad0w|: no problem, good luck
[2012-03-12 08:32:00 -0400] nacer: ohai
[2012-03-12 08:46:00 -0400] BryanWB: nacer: ohai!
[2012-03-12 09:08:00 -0400] shay: hi, i want to edit a data bag in my recipe but i get following error: Net::HTTPServerException: 403 "Forbidden"; how can i change the access  right for my data bags?
[2012-03-12 10:12:00 -0400] shay: hi, i want to edit a data bag in my recipe but i get following error: Net::HTTPServerException: 403 "Forbidden"; how can i change the access  right for my data bags?
[2012-03-12 10:25:00 -0400] nico: hi proffalken
[2012-03-12 10:26:00 -0400] proffalken: I'm going to suggest that "chef with an s" is renamed to "sous"
[2012-03-12 10:32:00 -0400] alclonky: is it possible to deploy mulitple cookbook files at once? with wildcards *.html or so?
[2012-03-12 10:33:00 -0400] proffalken: alclonky: what's the objective?
[2012-03-12 10:34:00 -0400] alclonky: a lot of files to deploy
[2012-03-12 10:34:00 -0400] alclonky: into the same directory with the same attributes
[2012-03-12 10:34:00 -0400] BryanWB: proffalken: i like it!
[2012-03-12 10:35:00 -0400] proffalken: alclonky: fair enough, I'd recommend sorting out the files and packaging them using something like FPM into a .deb or .rpm and then installing that as you would any other package
[2012-03-12 10:35:00 -0400] proffalken: alclonky: you can then set attributes etc. in the package and not worry about it in the recipe
[2012-03-12 10:35:00 -0400] proffalken: BryanWB: :) (Great podcast btw)
[2012-03-12 10:35:00 -0400] BryanWB: proffalken: tks!
[2012-03-12 10:36:00 -0400] alclonky: proffalken: the file could change
[2012-03-12 10:36:00 -0400] proffalken: alclonky: so you just rebuild the package - https://github.com/jordansissel/fpm
[2012-03-12 10:36:00 -0400] proffalken: alclonky: you can even build that into your automated testing
[2012-03-12 10:36:00 -0400] alclonky: it whould be nice to just copy the new html files in die files folder of the recipe
[2012-03-12 10:37:00 -0400] alclonky: without changing something else
[2012-03-12 10:37:00 -0400] alclonky: don't whant a ['file1.html','file2.html'].each do
[2012-03-12 10:38:00 -0400] proffalken: alclonky: The "recurse" from the Directory resource might do it, but I've not used it and I probably wouldn't approach it in that way
[2012-03-12 10:38:00 -0400] proffalken: http://wiki.opscode.com/display/chef/Resources#Resources-Directory
[2012-03-12 10:38:00 -0400] proffalken: alclonky: I'm not saying that you're doing it wrong, I just believe that chef should be used to configure things and some other method (.deb/.rpm/.gem/pypi etc) should be used to deploy code
[2012-03-12 10:38:00 -0400] proffalken: :D
[2012-03-12 10:39:00 -0400] alclonky: its not only html
[2012-03-12 10:39:00 -0400] alclonky: could be .pem files as well
[2012-03-12 10:39:00 -0400] alclonky: which can change
[2012-03-12 10:39:00 -0400] alclonky: and new ones could be needed
[2012-03-12 10:40:00 -0400] alclonky: and i want all of them in one folder
[2012-03-12 10:40:00 -0400] proffalken: alclonky: in that case I don't know how to do it with chef.
[2012-03-12 10:41:00 -0400] alclonky: proffalken: than ['file1.html','file2.html'].each do it is for me :-(
[2012-03-12 10:41:00 -0400] proffalken: alclonky: bear in mind that I've only been using Chef for a month - others here may have other suggestions...
[2012-03-12 10:42:00 -0400] alclonky: or is it possible to search in die files folder of the recipe?
[2012-03-12 10:42:00 -0400] Jusii: we use capistrano for deploying code
[2012-03-12 10:43:00 -0400] shay: hi, i want to edit a data bag in my recipe but i get following error: Net::HTTPServerException: 403 "Forbidden"; how can i change the access  right for my data bags?
[2012-03-12 12:02:00 -0400] shay: hi, i want to edit a data bag in my recipe but i get following error: Net::HTTPServerException: 403 "Forbidden"; how can i change the access rights for my data bags?
[2012-03-12 12:12:00 -0400] shay: i fixed this by editing the client and set "admin" to true. Is there some other way to fix that?
[2012-03-12 12:56:00 -0400] auro: |shad0w|: created new virtual machine, instal sun java, install chef - all works
[2012-03-12 14:04:00 -0400] BryanWB: juanje: hoal amigo!
[2012-03-12 14:06:00 -0400] ssd7_: heya BryanWB
[2012-03-12 14:06:00 -0400] BryanWB: ssd7_: good morning
[2012-03-12 14:13:00 -0400] juanje: BryanWB: hola! :-)
[2012-03-12 14:23:00 -0400] nico: hi BryanWB
[2012-03-12 14:23:00 -0400] BryanWB: nico: bonjour mon ami!
[2012-03-12 14:26:00 -0400] fish_: wondering how to change the server_url. it's on all nodes in the default section. Do I need to override it in default/override on each node? or is there one single place to do that?
[2012-03-12 14:28:00 -0400] flashmanbahadur1: fish_: the chef server url?
[2012-03-12 14:28:00 -0400] fish_: flashmanbahadur1: yes
[2012-03-12 14:31:00 -0400] flashmanbahadur1: depends how you build the servers
[2012-03-12 14:31:00 -0400] flashmanbahadur1: if you bootstrap with knife
[2012-03-12 14:31:00 -0400] flashmanbahadur1: there is a line in your knife.rb file
[2012-03-12 14:31:00 -0400] flashmanbahadur1: or there can be at least
[2012-03-12 14:31:00 -0400] fish_: well, I want to change the url after the node is bootstrapped
[2012-03-12 14:31:00 -0400] flashmanbahadur1: once the machines are registered though
[2012-03-12 14:31:00 -0400] flashmanbahadur1: you will need to change it manually I believe
[2012-03-12 14:32:00 -0400] flashmanbahadur1: there is a client.rb file
[2012-03-12 14:32:00 -0400] flashmanbahadur1: usually
[2012-03-12 14:32:00 -0400] flashmanbahadur1:  /etc/chef/client.rb
[2012-03-12 14:32:00 -0400] fish_: yes
[2012-03-12 14:32:00 -0400] flashmanbahadur1: that keeps that info
[2012-03-12 14:32:00 -0400] fish_: I can change this but chef will overwrite this in the next run
[2012-03-12 14:32:00 -0400] flashmanbahadur1: oic
[2012-03-12 14:32:00 -0400] flashmanbahadur1: hmm
[2012-03-12 14:32:00 -0400] flashmanbahadur1: not sure then
[2012-03-12 14:32:00 -0400] flashmanbahadur1: I guess you need to push the change the server somehow
[2012-03-12 14:32:00 -0400] fish_: I can overwrite the node attribute of that node, this will most likly fix it
[2012-03-12 14:33:00 -0400] flashmanbahadur1: probably
[2012-03-12 14:33:00 -0400] flashmanbahadur1: what kind of change are you making to the url
[2012-03-12 14:33:00 -0400] fish_: but I would prefer changing the default attribute
[2012-03-12 14:34:00 -0400] fish_: default gets set by cookbooks and ohai and I suspect that this attribute will also somehow 'autoconfigured'
[2012-03-12 14:34:00 -0400] flashmanbahadur1: i believe it gets autoconfigured when the node is registered during the bootstrap process
[2012-03-12 14:44:00 -0400] jtimberman: fish_: you can use a recipe to drop off a config file from a cookbook
[2012-03-12 14:44:00 -0400] jtimberman: e.g., opscode's chef-client::config
[2012-03-12 15:07:00 -0400] jmazzi: is there a way to force bash/deploy resources to load an actual shell? PATH isn't being setup properly
[2012-03-12 15:08:00 -0400] flashmanbahadur1: jmazzi: its a tricky issue, I have had success with running a script that ssh's into my own machine then runs the commands
[2012-03-12 15:08:00 -0400] flashmanbahadur1: that way it gets a normal environment
[2012-03-12 15:09:00 -0400] jmazzi: flashmanbahadur1: you're not using the deploy/script resource then?
[2012-03-12 15:09:00 -0400] flashmanbahadur1: I dont have a ton of experience with it
[2012-03-12 15:09:00 -0400] flashmanbahadur1: ive had trouble with the command resource and environments
[2012-03-12 15:09:00 -0400] jmazzi: flashmanbahadur1: looks like you can set ENV['PATH'] in client.rb
[2012-03-12 15:10:00 -0400] jmazzi: i'm going to give that a try
[2012-03-12 15:10:00 -0400] flashmanbahadur1: ok
[2012-03-12 15:12:00 -0400] jmazzi: flashmanbahadur1: that works
[2012-03-12 15:14:00 -0400] atomic-penguin: deploy?
[2012-03-12 15:14:00 -0400] bawt: deploy is http://wiki.opscode.com/display/chef/Deploy+Resource
[2012-03-12 16:43:00 -0400] atomic-penguin: Anybody done a gitlab cookbook?
[2012-03-12 16:45:00 -0400] hoover_damm: there was a sm thing that wayne was working on for gitlab
[2012-03-12 16:45:00 -0400] hoover_damm: not really chef
[2012-03-12 16:46:00 -0400] hoover_damm: that's all I have, and he wasn't done
[2012-03-12 16:46:00 -0400] hoover_damm: so praps I shouldn't have said squat
[2012-03-12 16:46:00 -0400] atomic-penguin: sm?
[2012-03-12 16:53:00 -0400] hoover_damm: bdsm
[2012-03-12 16:54:00 -0400] hoover_damm: https://bdsm.beginrescueend.com/
[2012-03-12 16:57:00 -0400] rshade98: is there a way to run a ruby_block as a different user?
[2012-03-12 16:59:00 -0400] hoover_damm: use resources in the ruby_block
[2012-03-12 16:59:00 -0400] hoover_damm: and set the user?
[2012-03-12 16:59:00 -0400] hoover_damm: generally a block doesn't run as a user
[2012-03-12 16:59:00 -0400] hoover_damm: no need to, the commands it writes you want to change.
[2012-03-12 17:01:00 -0400] rshade98: hoover, so above block, I can just add something like user "oracle"
[2012-03-12 17:03:00 -0400] |shad0w|: not sure you can set user in ruby block, you might have to use the script resource
[2012-03-12 17:15:00 -0400] atomic-penguin: hoover_damm, ah, you said sm, I thought sourcemod?
[2012-03-12 17:19:00 -0400] hoover_damm: atomic-penguin, no another wayne thing
[2012-03-12 17:19:00 -0400] hoover_damm: atomic-penguin, https://bdsm.beginrescueend.com/ == sm
[2012-03-12 17:19:00 -0400] hoover_damm: I really can't say anything more without just saying something bad
[2012-03-12 17:19:00 -0400] atomic-penguin: hoover_damm, yeah I gathered that when you posted bdsm and the link
[2012-03-12 17:20:00 -0400] hoover_damm: basically it's wayne's idea of config management
[2012-03-12 17:20:00 -0400] hoover_damm: he really has no concept of what configuration management is
[2012-03-12 17:20:00 -0400] hoover_damm: or what it does
[2012-03-12 17:20:00 -0400] hoover_damm: so it's better to plead the 5th here and wish I didn't mention it
[2012-03-12 17:20:00 -0400] atomic-penguin: hoover_damm, fair enough, lets not get into it
[2012-03-12 18:39:00 -0400] ciastek: maybe bdsm is like rvm - not beautiful, but works great :)
[2012-03-12 18:50:00 -0400] Rorgo: If I want to access the environment some node is in in my recipe, should I use something like 'if node[:environment] == "blah"', or 'if node.environment?("blah")'?
[2012-03-12 18:51:00 -0400] Rorgo: the "if/unless" section of the opscode doc seems to suggest you can use either: http://wiki.opscode.com/display/chef/Recipes
[2012-03-12 18:52:00 -0400] paulmooring: Rorgo: you probably want node.chef_environment
[2012-03-12 18:52:00 -0400] yenif_: I'm trying to get a modification to the bluepill recipe working but nested resources in lwrp don't seem to be getting applied. Asked the list at http://lists.opscode.com/sympa/arc/chef/2012-03/msg00183.html but haven't gotten any responses. Any suggestions?
[2012-03-12 19:04:00 -0400] gwaldo: I'm looking into a client's servers who have not checked into their (open-source Chef server) in some time.  A couple of them are giving this message:
[2012-03-12 19:04:00 -0400] gwaldo: WARN: Can not find config file: /etc/chef/client.rb, using defaults.
[2012-03-12 19:05:00 -0400] gwaldo: When I browse the filesystem, I see that the files are in place, and the permissions look correct
[2012-03-12 19:06:00 -0400] gwaldo: I'm looking for suggestions of where to go from here.
[2012-03-12 19:14:00 -0400] gmcinnes: ahoy chefs.  I have a really big repo to check out with the git scm resource.  How do I change its timeout?
[2012-03-12 19:50:00 -0400] jtimberman: ohai Chefs! just a reminder, only 64 days left until ChefConf! http://chefconf.opscode.com/
[2012-03-12 19:54:00 -0400] jtimberman: :D
[2012-03-12 19:59:00 -0400] gmcinnes: ohai shefs
[2012-03-12 19:59:00 -0400] gmcinnes: can anyone help me with a timeout situation?
[2012-03-12 19:59:00 -0400] gmcinnes: I have a scm deploy resource for a huge repo, and its timing out.
[2012-03-12 20:00:00 -0400] gmcinnes: I'm not sure how to tell the deploy resource to not timeout.
[2012-03-12 20:06:00 -0400] jdeamattson: Question about the user cookbook - http://community.opscode.com/cookbooks/user - the list of ssh keys are these the keys authorized for passwordless ssh? Or is this the private/public key pair for that user?
[2012-03-12 20:07:00 -0400] jdeamattson: Looking for a way to setup passwordless ssh by creating an appropriate authorized_keys file. This looks like it is it, but I want to see if I am missing something.
[2012-03-12 20:16:00 -0400] chip-: jdeamattson: you've got it. Create a passwordless ssh key and assign the public key to the user in the users cookbook.
[2012-03-12 20:17:00 -0400] jdeamattson: chip-:  Thanks. What I thought.
[2012-03-12 20:17:00 -0400] chip-: That said, I haven't figured out how to put multiple public keys on a user with that cookbook, and passwordless ssh keys are dangerous as hell. If you can run an ssh-agent you should do that instead.
[2012-03-12 20:17:00 -0400] chip-: (You can almost always run an ssh agent. I've even had Capistrano run one.)
[2012-03-12 20:17:00 -0400] jdeamattson: chip-: Not familiar with ssh-agent. But will research.
[2012-03-12 20:20:00 -0400] geekbri: jdeamattson: it just stores your SSH auth credentials in memory so that if you have a key with a passphrase you dont have to keep typing it
[2012-03-12 20:20:00 -0400] jdeamattson: Yes. Just looked it up. Haven't used it before, but it is a great suggestion. geekbri
[2012-03-12 20:21:00 -0400] geekbri: jdeamattson: its pretty great.
[2012-03-12 20:21:00 -0400] jdeamattson: geekbri: Looks very nice.
[2012-03-12 20:21:00 -0400] jdeamattson: geekbri: This is a setup for applications using ssh, so even one password entry is too many :-)
[2012-03-12 20:21:00 -0400] jdeamattson: But I do not fully grok it yet.
[2012-03-12 20:22:00 -0400] jdeamattson: So, does anyone have a good summary of the differences between the "user" and "users" cookbook?
[2012-03-12 20:28:00 -0400] geekbri: If you set override attributes for a nodes attributes, it will NOT merge that array with an array from default attributes in the cookbook, correct?
[2012-03-12 20:29:00 -0400] jdeamattson: It does look like the user cookbook will take multiple ssh keys and lay them down.
[2012-03-12 20:34:00 -0400] jdeamattson: The user and users cookbooks look very similar. Does anyone have a strong preference either way?
[2012-03-12 20:36:00 -0400] chip-: Oh, ssh-agent does more than that.
[2012-03-12 20:36:00 -0400] chip-: It can relay your credentials.
[2012-03-12 20:36:00 -0400] geekbri: Let me rephrase my question, is there anyway to overwrite an array set in the cookbook attributes file with one in a role file?
[2012-03-12 20:36:00 -0400] chip-: So for instance: Say I have a deploy user connecting from a host inside my network to a host at ec2, which in turn is going to use an ssh key to pull code from github.
[2012-03-12 20:37:00 -0400] chip-: On the host in my network, I fire up ssh-agent and store my private key. Meanwhile, the public key is registered with my user at github and with my user on the ec2 host.
[2012-03-12 20:37:00 -0400] chip-: Without the private key file ever leaving my network, ssh-agent will use that key to authenticate the ec2 host's attempt to authorize against github, even though the private key is never stored as a file on the ec2 host.
[2012-03-12 20:38:00 -0400] chip-: Github will relay authentication back to my personal machine, which is the only one with the private key auth
[2012-03-12 20:38:00 -0400] chip-: so alter, if some asshole compromises the ec2 host, they won't get the deploy user's private key, because it's not there.
[2012-03-12 20:38:00 -0400] chip-: *later
[2012-03-12 20:45:00 -0400] gmcinnes: chip-: That does indeed seem awesome, but to me its a very limited use case.
[2012-03-12 20:49:00 -0400] hoover_damm: ssh-agent forwarding is useful
[2012-03-12 20:49:00 -0400] hoover_damm: but it's limitations are pretty well known
[2012-03-12 20:49:00 -0400] hoover_damm: using a deploy key that cannot write is the best answer, encrypted keys
[2012-03-12 20:50:00 -0400] hoover_damm: I think we lost some security practices over the past few years that may need to be knocked in folks head again
[2012-03-12 20:50:00 -0400] gmcinnes: a deploy key that cannot write to the repo you mean?
[2012-03-12 20:50:00 -0400] hoover_damm: gchristensen, correct
[2012-03-12 20:51:00 -0400] gmcinnes: or that's not written to the deploy target?
[2012-03-12 20:51:00 -0400] hoover_damm: a standard deploy key on gtihub cannot write to the repo
[2012-03-12 20:51:00 -0400] hoover_damm: (the github repo it's cloning)
[2012-03-12 20:51:00 -0400] hoover_damm: if your pulling code off of github that's in a private repo, your means of getting the code is very limited
[2012-03-12 20:51:00 -0400] hoover_damm: http or git@
[2012-03-12 20:52:00 -0400] hoover_damm: use a password, or a ssh key
[2012-03-12 20:52:00 -0400] gmcinnes: it doesn't matter if an attacker can read your key on the deploy target machine.
[2012-03-12 20:52:00 -0400] hoover_damm: if an attacker reads your deploy key
[2012-03-12 20:52:00 -0400] gmcinnes: If they've gained that much access, seeing the artifacts you're pulling from the repo will be relatively trivial.
[2012-03-12 20:52:00 -0400] gchristensen: it appears that `knife ssl_cert FQDN=example.tld` won't actually create a CSR file, is that on purpose? it seems like that would be an oft wanted feature
[2012-03-12 20:52:00 -0400] hoover_damm: it's likely you have a lot of problems
[2012-03-12 20:53:00 -0400] hoover_damm: because once they read your repo, and they can read it on the system
[2012-03-12 20:53:00 -0400] hoover_damm: or via github
[2012-03-12 20:53:00 -0400] hoover_damm: so does the RSA private key matter if they gain access to the system?
[2012-03-12 21:03:00 -0400] chip-: gmcinnes: Oh sure, it's just layers. If the deploy key can't write to the repo AND the private half isn't there, then it's doubly-useless to a potential attacker.
[2012-03-12 21:06:00 -0400] _aeris_: hello #chef
[2012-03-12 21:06:00 -0400] _aeris_: i have a question
[2012-03-12 21:07:00 -0400] _aeris_: i have one recipe which do  ( default[:rkhunter][:hidden] << '/dev/.mdadm' ) if attribute?(:raid) 
[2012-03-12 21:07:00 -0400] _aeris_: and one role with  default_attributes(:raid => true) 
[2012-03-12 21:07:00 -0400] _aeris_: but on chef-client, raid attribute is set but not corresponding rkhunter
[2012-03-12 21:08:00 -0400] _aeris_: where i'm wrong ?
[2012-03-12 21:12:00 -0400] jdeamattson: does node['environment'] access the environment of the node?
[2012-03-12 21:13:00 -0400] |shad0w|: jdeamattson, are you after node.chef_environment ?
[2012-03-12 21:14:00 -0400] jdeamattson: Yes, that is what I want. Thank you.
[2012-03-12 21:14:00 -0400] |shad0w|: np
[2012-03-12 21:14:00 -0400] jdeamattson: Can I call that in the attributes/default.rb?
[2012-03-12 21:15:00 -0400] |shad0w|: Should be able to
[2012-03-12 21:16:00 -0400] |shad0w|: something like this: https://gist.github.com/2024729
[2012-03-12 21:20:00 -0400] _aeris_: nobody ? =(
[2012-03-12 21:50:00 -0400] yenif_: I'm trying to get a modification to the bluepill recipe working but nested resources in lwrp don't seem to be getting applied. Asked the list at http://lists.opscode.com/sympa/arc/chef/2012-03/msg00183.html but haven't gotten any responses. Any suggestions?
[2012-03-12 22:08:00 -0400] _aeris_: still nobody for my attribute problem ? =(
[2012-03-12 22:10:00 -0400] |shad0w|: in recipes I believe you need to pass node
[2012-03-12 22:11:00 -0400] |shad0w|: ( node[:default][:rkhunter][:hidden] << '/dev/.mdadm' ) if node.attribute?(:raid)
[2012-03-12 22:11:00 -0400] |shad0w|: or something similar
[2012-03-12 22:11:00 -0400] yenif_: _aeris_: guessing attribute files are loaded before roles. I would try handling conditional values in the recipe it's self
[2012-03-12 22:12:00 -0400] yenif_: but I really have no idea
[2012-03-12 22:12:00 -0400] |shad0w|: _aeris_, is this in an attribute file or a recipe
[2012-03-12 22:13:00 -0400] _aeris_: test is on an attribute recipe file
[2012-03-12 22:14:00 -0400] _aeris_: it's ok if test on the recipe
[2012-03-12 22:14:00 -0400] _aeris_: thanks yenif_
[2012-03-12 22:14:00 -0400] _aeris_: but strange behaviour =)
[2012-03-12 22:15:00 -0400] yenif_: ya, I think the attribute file is only meant to define available attributes and basic defaults. While it's just ruby, I don't think it was intended to contain any logic. But I haven't dug very deep so there are likely some options I'm not aware of
[2012-03-12 22:17:00 -0400] _aeris_: http://community.opscode.com/cookbooks/mysql/source
[2012-03-12 22:17:00 -0400] _aeris_: but for example, this cookbook use test on attribute file
[2012-03-12 22:19:00 -0400] |shad0w|: was node[:default][:rkhunter][:hidden] defined else where before you tried to append it?
[2012-03-12 22:19:00 -0400] |shad0w|: and what type of object is :hidden ?
[2012-03-12 22:19:00 -0400] |shad0w|: string, array, hash?
[2012-03-12 22:40:00 -0400] _aeris_: |shad0w| > node[:rkhunter][:hidden] is just defined above the test
[2012-03-12 22:40:00 -0400] _aeris_: and :hidden is an array
[2012-03-12 22:41:00 -0400] _aeris_: http://pastebin.com/wJw1jc6u
[2012-03-12 22:41:00 -0400] _aeris_: tests was just after this declaration
[2012-03-12 22:46:00 -0400] yenif_: It's looking like my problem is due to an LWRP action being triggered by a notification and thus executing after the normal resource pass. Thus resources defined by the notified action never get processed
[2012-03-12 22:47:00 -0400] yenif_: Any one have any experience with LWRP resources and things of this nature?
[2012-03-12 22:58:00 -0400] chip-: yenif_: I'm writing my first one right now. S'hard!
[2012-03-12 22:59:00 -0400] yenif_: at least I'm not the only one stumbling around blind :-)
[2012-03-12 23:03:00 -0400] chip-: Anyone have any example code of someone concatenating files together via Chef?
[2012-03-12 23:03:00 -0400] chip-: Do I need to drop out to Ruby to do it or can I accomplish that within the DSL?
[2012-03-12 23:04:00 -0400] chip-: ( Overall goal: Incorporate conf.d behavior for haproxy, similar to https://github.com/joewilliams/haproxy_join )
[2012-03-12 23:04:00 -0400] chip-: ( Then in the next pass, add LWRP's to write frontends and backends into conf.d folders )
[2012-03-12 23:04:00 -0400] yenif_: puppet just shells out for concatenating, haven't seen anything built into the chef dsl to handle it
[2012-03-12 23:05:00 -0400] yenif_: could shell out or do it with ruby
[2012-03-12 23:07:00 -0400] |shad0w|: chip- you can do ruby right in your recipe
[2012-03-12 23:09:00 -0400] chip-: |shad0w|: I'll probably roll a library into the cookbook and call that. Just curious if I was missing part of the DSL.
[2012-03-12 23:09:00 -0400] chip-: I try really hard to avoid wheel reinvention.
[2012-03-12 23:12:00 -0400] fujin: chip-: I don't have any around but I gave some to someone on a gist in here a while ago
[2012-03-12 23:13:00 -0400] fujin: that is, making a conf.d directory snippet style
[2012-03-12 23:13:00 -0400] fujin: I actually planned to build a config file builder lwrp that uses that mechanism, so you could plug it into any old application that supported lexical ordering of config snippets
[2012-03-12 23:13:00 -0400] fujin: or, well, snippets sorted however the fuck you like really
[2012-03-12 23:13:00 -0400] fujin: not been built yet. maybe one day
[2012-03-12 23:13:00 -0400] chip-: fujin: I've got good example code here for concatenating and ordering.
[2012-03-12 23:13:00 -0400] chip-: Not to stressed about it.
[2012-03-12 23:14:00 -0400] fujin: ah goodoh
[2012-03-12 23:14:00 -0400] chip-: The important thing is adding conf.d functionality to haproxy via Chef. Which is pretty impressive in its own right.
[2012-03-12 23:15:00 -0400] |shad0w|: if you are building the conf in chef, why bother writing multiple files then concat them?
[2012-03-12 23:15:00 -0400] |shad0w|: just build up the template proper
[2012-03-12 23:15:00 -0400] fujin: right, you can reinject variables into template
[2012-03-12 23:15:00 -0400] fujin: during compile phase
[2012-03-12 23:15:00 -0400] chip-: Because the problem with the existing haproxy recipe is that it only supports autoconfiguring a single proxy.
[2012-03-12 23:16:00 -0400] chip-: In my use case, what I want to do is have multiple proxies for each service in an application sitting on 127.0.0.1
[2012-03-12 23:16:00 -0400] chip-: and then my app developers never have to worry about being network aware, because Chef is, and it'll rewrite your proxies for you.
[2012-03-12 23:16:00 -0400] chip-: When keeping hundreds of haproxy.cfg's in eventual sync is trivial...
[2012-03-12 23:16:00 -0400] fujin: sounds like reopening a template would actually make that easier
[2012-03-12 23:16:00 -0400] fujin: |shad0w|: an interesting proposition, that one
[2012-03-12 23:17:00 -0400] chip-: anyway. haproxy doesn't natively do conf.d. It requires a monolithic config file.
[2012-03-12 23:18:00 -0400] chip-: What I'd like to do eventually is write LWRP's for defining haproxy frontend and backend objects, which would in turn drop config files into conf.d, which could be assembled by a library.
[2012-03-12 23:18:00 -0400] fujin: chip-: what we're suggesting is you can do this all in-memory with chef instead of having a foo.d dir with a library and shit.
[2012-03-12 23:18:00 -0400] fujin: just by reopening a template and stuffing an additional hash into the variables.
[2012-03-12 23:19:00 -0400] fujin: then when the template runs, it just maps through each of those hashes (proxy definition) and renders 'em out, ordered
[2012-03-12 23:19:00 -0400] fujin: much simpler in implementation
[2012-03-12 23:20:00 -0400] chip-: Where do the hashes get stored for subsequent runs?
[2012-03-12 23:21:00 -0400] fujin: well, you generate those hashes with recipes, with a definition or lwrp
[2012-03-12 23:21:00 -0400] fujin: if you get what i mean. so it's always the same
[2012-03-12 23:21:00 -0400] fujin: i would probably have the loadbalancer layer build them programatically via lwrp/definition with Search results or databag-values
[2012-03-12 23:21:00 -0400] chip-: Any public cookbooks that do your implementation? Mostly I'm designing this by looking at the apt lwrp
[2012-03-12 23:22:00 -0400] chip-: Yeah, search results is exactly what I'm going for.
[2012-03-12 23:22:00 -0400] fujin: and then the application servers (i suppose) you just use the lwrp/definition in your application cookbook to say, yo haproxy, loadbalance me
[2012-03-12 23:22:00 -0400] fujin: only works if the role is included or something like that.
[2012-03-12 23:22:00 -0400] chip-: Yup
[2012-03-12 23:22:00 -0400] fujin: that way you can use the same lwrp/definition for both -- and they just manage the one file
[2012-03-12 23:22:00 -0400] fujin: and the insertion mechanism is the same, just reopen template and add the params as a formatted hash to an array in the 'variables' parameter of the reopened template
[2012-03-12 23:22:00 -0400] fujin: one sec. I believe the database or mysql cookbook shows about grants.sql or some-such.
[2012-03-12 23:23:00 -0400] fujin: https://github.com/opscode/cookbooks/blob/master/mysql/recipes/server.rb#L121-134
[2012-03-12 23:24:00 -0400] chip-: I don't claim to have any great coding skill. Just really need this to work, and I'd rather do it right the first time.
[2012-03-12 23:24:00 -0400] fujin: so you can do that t = resources(..) then set up a hash, and put it in the 't.variables' like you would in a recipe
[2012-03-12 23:25:00 -0400] fujin: t.variables(:proxies => t.variables[:proxies].merge(new_proxy)
[2012-03-12 23:25:00 -0400] fujin: obv. with required parantheses implied
[2012-03-12 23:26:00 -0400] chip-: OK. I'll give this a once-over and see what I can do.
[2012-03-12 23:26:00 -0400] fujin: it's kind of complex but a useful pattern to wrap your head around
[2012-03-12 23:26:00 -0400] fujin: you can basically manipulate any resource during the compile phase
[2012-03-12 23:31:00 -0400] chip-: Reading
[2012-03-12 23:43:00 -0400] miah: sup
[2012-03-12 23:44:00 -0400] miah: i have a similar haproxy configuration to what fujin is describing
[2012-03-12 23:45:00 -0400] miah: i do a few searches, populate a hash, and then in my haproxy.conf.erb i fill out server pools with the contents of those hashes
[2012-03-12 23:45:00 -0400] miah: so when my chef-client runs in 10 minutes my haproxy servers have all the servers in the pools
[2012-03-12 23:45:00 -0400] fujin: there we are
[2012-03-12 23:45:00 -0400] fujin: I understand lusis was going to join the conversation as well
[2012-03-12 23:46:00 -0400] fujin: haproxy_join
[2012-03-12 23:46:00 -0400] fujin: I have been thinking about managing haproxy pool members for a long time and will probably make use of consensus in pylon (paxos) to do rolling upgrades and coordination of requests to workers
[2012-03-12 23:46:00 -0400] miah: i think i have enough chef/ruby experience at this point to lwrp my stuff. I've also been meaning too, because my haproxy cookbook is fairly _ugly_ right now
[2012-03-12 23:47:00 -0400] fujin: keke
[2012-03-12 23:47:00 -0400] miah: my haproxy cookbook fork was the first cookbook i started mangling.. unfortunately there are several rough edges =)
[2012-03-12 23:47:00 -0400] fujin: lwrp is nice. haproxy seems like an easy case, define the values you want to be able to send into the template as params, get those params and reopen the original haproxy template, stuff them in
[2012-03-12 23:47:00 -0400] miah: yup
[2012-03-12 23:48:00 -0400] miah: i was thinking about building databags that define the pools, and their options as well as the search terms needed. then haproxy would just iterate through that list and build the front/back ends dynamically
[2012-03-12 23:49:00 -0400] gmcinnes: fujin: can you hit me with a clue stick about how to adjust the ShellOut timeout for the ShellOut instance that a Git resource delegates to?
[2012-03-12 23:49:00 -0400] gmcinnes: \
[2012-03-12 23:49:00 -0400] fujin: uuhhh
[2012-03-12 23:49:00 -0400] fujin: use the code, luke
[2012-03-12 23:49:00 -0400] fujin: do what I would do
[2012-03-12 23:49:00 -0400] gmcinnes: :)
[2012-03-12 23:49:00 -0400] fujin: let me try to find
[2012-03-12 23:50:00 -0400] gmcinnes: I have been, but I can't find any nice way to do it without just overwriting ze classes.
[2012-03-12 23:50:00 -0400] gmcinnes: or writing a new resource.
[2012-03-12 23:50:00 -0400] fujin: https://github.com/opscode/chef/blob/master/chef/lib/chef/mixin/shell_out.rb#L25
[2012-03-12 23:51:00 -0400] miah: im not sure if my idea/concept is the right way, but it would keep all environment specifics out of the cookbook.
[2012-03-12 23:51:00 -0400] gmcinnes: https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/git.rb#L130
[2012-03-12 23:53:00 -0400] fujin: gmcinnes: you can go ahead and patch this one https://github.com/opscode/chef/blob/master/chef/lib/chef/provider/git.rb#L194
[2012-03-12 23:53:00 -0400] fujin: from a library
[2012-03-12 23:53:00 -0400] fujin: to add the :timeout key in
[2012-03-12 23:53:00 -0400] gmcinnes: riht.
[2012-03-12 23:53:00 -0400] fujin: adjust it up to 180s though
[2012-03-12 23:53:00 -0400] fujin: crazy that your checkout is more than 60s
[2012-03-12 23:53:00 -0400] gmcinnes: ugh. its awful.
[2012-03-12 23:54:00 -0400] fujin: slow disk?
[2012-03-12 23:54:00 -0400] gmcinnes: wordpress site with a stankload of assets in the repo.
[2012-03-12 23:54:00 -0400] gmcinnes: so, really its the first clone that's slow.
[2012-03-12 23:55:00 -0400] gmcinnes: 'cause I think there's about 20G of repo to pull down.
[2012-03-12 23:55:00 -0400] fujin: oh..
[2012-03-12 23:56:00 -0400] fujin: considered, you know.. an alternate delivery mechanism for the assets?
[2012-03-12 23:56:00 -0400] andrewle: I had to reboot my chef server and now am not able to query the chef server api.
[2012-03-12 23:57:00 -0400] andrewle: In the logs, I keep getting the following exception: Chef::Exceptions::SolrConnectionError. Any ideas?
[2012-03-12 23:57:00 -0400] gmcinnes: yeah. I'll get there eventually.  Need to get a consistent deployment platform first, then I can move up to sorting out their application spaghetti.
[2012-03-12 23:57:00 -0400] miah: solr isn't started
[2012-03-12 23:57:00 -0400] gmcinnes: and then unfuckulate the repo
[2012-03-12 23:58:00 -0400] andrewle: miah: Isn't solr started via chef-solr? There's an entry for it in my process list
