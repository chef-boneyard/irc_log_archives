[2012-03-23 07:42:00 -0400] kostyasha: what i miss ERROR: The cookbook repo /var/chef/cookbooks is not a git repository. ?
[2012-03-23 08:02:00 -0400] kostyasha: chef server need more 1gb of ram o0
[2012-03-23 08:27:00 -0400] dnbert: Is it possible, when creating a Provider, to change the behavior depending on what attribute is being called from a Rescoure Like, to say, if my resource was like attribute :mkdir, :kind_of => String. I'm not sure how I can know if that attribute is being used by a recipe.
[2012-03-23 09:36:00 -0400] zoubi: anyone know how to reset rabbitmq on the chef server when the public/private DNS of the machine are changed? (after a reboot of the EC2 instance)
[2012-03-23 09:36:00 -0400] erikh: is it not listening on localhost?
[2012-03-23 09:37:00 -0400] zoubi: it does not seem to
[2012-03-23 09:37:00 -0400] erikh: interesting
[2012-03-23 09:37:00 -0400] zoubi: I have this error : unable to connect to node 'rabbit@ip-10-226-135-68': nodedown
[2012-03-23 09:37:00 -0400] zoubi: with ip-10-226-135-68 being the start of the private DNS of the instance
[2012-03-23 09:37:00 -0400] proffalken: mornig chefs... :)
[2012-03-23 09:38:00 -0400] erikh: right
[2012-03-23 09:38:00 -0400] erikh: zoubi: any amqp references in your /etc/chef/server.rb?
[2012-03-23 09:40:00 -0400] zoubi: erikh: the online amqp reference is about the rabbitmq password
[2012-03-23 09:41:00 -0400] erikh: did you customize it in some way? the default password is 'testing'
[2012-03-23 09:41:00 -0400] zoubi: yeah, I changed it when I first installed chef
[2012-03-23 09:41:00 -0400] erikh: I mean, I'm at a loss for what to suggest here -- it doesn't seem like it's a standard configuration (to me, at least)
[2012-03-23 09:41:00 -0400] zoubi: I installed chef the default way though :)
[2012-03-23 09:42:00 -0400] zoubi: I just typed a password when I was aske
[2012-03-23 09:42:00 -0400] zoubi: +d
[2012-03-23 09:47:00 -0400] zoubi: erikh: the topic "Issues with hostname" seems to fix this issue http://www.rabbitmq.com/ec2.html
[2012-03-23 09:48:00 -0400] erikh: oh the hosts file
[2012-03-23 09:48:00 -0400] erikh: derp
[2012-03-23 09:48:00 -0400] erikh: nice catch
[2012-03-23 09:49:00 -0400] zoubi: but when sending commands to chef-server with knife, I still got errors like : ERROR: Server returned error for http://xxx.xxx.xxx.xxx:4000/cookbooks/my_cookbook/1.0.0, retrying 1/5 in 4s
[2012-03-23 09:50:00 -0400] erikh: chef 10, right?
[2012-03-23 09:50:00 -0400] zoubi: right
[2012-03-23 09:50:00 -0400] erikh: check the logs for chef-server and chef-expander
[2012-03-23 09:50:00 -0400] erikh: they'll likely tell you where to look
[2012-03-23 09:51:00 -0400] erikh: i've noticed with recent recipes that solr gets all confused on first boot because /var/run/chef isn't writable by the chef user
[2012-03-23 09:51:00 -0400] erikh: and it generally messes everything up
[2012-03-23 09:55:00 -0400] zoubi: nothing about an error in the logs
[2012-03-23 09:56:00 -0400] erikh: did you back up everything? chef keeps its cookbooks on disk, I think.
[2012-03-23 09:56:00 -0400] zoubi: and /var/run/chef is writable by the user
[2012-03-23 09:56:00 -0400] zoubi: ls -l /var/run/chef/
[2012-03-23 09:56:00 -0400] zoubi: total 28
[2012-03-23 09:56:00 -0400] zoubi: -rw-r--r-- 1 root root 3 Mar 23 08:36 client.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-r--r-- 1 root root 5 Mar 23 09:47 expander.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-rw-rw- 1 root root 4 Mar 23 09:47 server-webui.4040.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-rw-rw- 1 root root 4 Mar 23 09:47 server-webui.main.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-rw-rw- 1 root root 4 Mar 23 09:47 server.4000.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-rw-rw- 1 root root 4 Mar 23 09:47 server.main.pid
[2012-03-23 09:56:00 -0400] zoubi: -rw-r--r-- 1 chef chef 4 Mar 23 09:47 solr.pid
[2012-03-23 09:56:00 -0400] erikh: use a pastebin next time, please
[2012-03-23 09:56:00 -0400] zoubi: ohh yeah sorry
[2012-03-23 09:56:00 -0400] erikh: so I believe chef keeps them in /var/lib/chef/cookbooks
[2012-03-23 09:56:00 -0400] erikh: I'll check, one sec.
[2012-03-23 09:57:00 -0400] zoubi: I had no problems yesterday. This is when I rebooted the instance
[2012-03-23 09:57:00 -0400] erikh: interesting -- I'd just try restarting all the chef-related services and see if that clears things up.
[2012-03-23 09:57:00 -0400] zoubi: I did already :)
[2012-03-23 09:57:00 -0400] erikh: bah!
[2012-03-23 09:57:00 -0400] erikh: :)
[2012-03-23 09:58:00 -0400] zoubi: using the commands here ;: http://www.ducea.com/2011/07/01/howto-upgrade-chef-from-0-10-to-0-10-2-rubygems-install/
[2012-03-23 09:59:00 -0400] erikh: did you upgrade?
[2012-03-23 09:59:00 -0400] erikh: or just reboot?
[2012-03-23 09:59:00 -0400] zoubi: reboot
[2012-03-23 10:00:00 -0400] erikh: yeah, not sure what it is at this point
[2012-03-23 10:00:00 -0400] erikh: sorry
[2012-03-23 10:10:00 -0400] zoubi: thanks for your help anyway
[2012-03-23 12:11:00 -0400] `brendan: happy friday!
[2012-03-23 12:11:00 -0400] proffalken: w00t!!! :)
[2012-03-23 12:37:00 -0400] matschaffer: anyone have a good pointer on having a jenkins job update a chef environment based on build results? (e.g., updating the package version to the latest). Do I just make an opscode account for my CI server?
[2012-03-23 12:40:00 -0400] erikh: it could fire up a one off that loads /etc/config.rb and performs a node/databag/etc edit
[2012-03-23 12:40:00 -0400] erikh: err, a script that drives Chef::Config and friends
[2012-03-23 12:41:00 -0400] erikh: matt ray has a one-shot chef tool that could be useful for the chef-client run as well
[2012-03-23 12:41:00 -0400] BryanWB: matschaffer: do u mean like update a databag or modify a role?
[2012-03-23 12:41:00 -0400] BryanWB: spice man, spice by danryan
[2012-03-23 12:42:00 -0400] BryanWB: github.com/danryan/spice?
[2012-03-23 12:42:00 -0400] matschaffer: BryanWB: I was thinking an environment
[2012-03-23 12:42:00 -0400] matschaffer: since I set the deployed package version there
[2012-03-23 12:43:00 -0400] BryanWB: matschaffer: iirc u can use spice to update an environment as well
[2012-03-23 12:43:00 -0400] BryanWB: spice is good shit
[2012-03-23 12:43:00 -0400] matschaffer: BryanWB, erikh: is the auth I was more concerned about
[2012-03-23 12:44:00 -0400] matschaffer: seems like jenkins will need it's own account (opscode hosted)
[2012-03-23 12:44:00 -0400] BryanWB: matschaffer: u generate auth acct just like u do for yourself and load those credentials into spice
[2012-03-23 12:45:00 -0400] matschaffer: BryanWB: gotcha. So what's the advantage of spice over a ruby script that uses the chef gem?
[2012-03-23 12:46:00 -0400] matschaffer: just a nicer api?
[2012-03-23 12:46:00 -0400] BryanWB: matschaffer: yeah, +  u can use it for read-only access to the chef-repository
[2012-03-23 12:46:00 -0400] BryanWB: which I have considered doing
[2012-03-23 12:46:00 -0400] matschaffer: BryanWB: can it write back? Not seeing examples
[2012-03-23 12:47:00 -0400] BryanWB: but i actually haven't used the chef api to manipulate envs
[2012-03-23 12:47:00 -0400] BryanWB: that might not be too bad
[2012-03-23 12:47:00 -0400] matschaffer: ah
[2012-03-23 12:47:00 -0400] matschaffer: right on
[2012-03-23 12:47:00 -0400] matschaffer: k, so sounds like I'm probably on the right track
[2012-03-23 12:48:00 -0400] matschaffer: thanks for the tip on spice
[2012-03-23 12:48:00 -0400] BryanWB: matschaffer: i think it spice can write back, but people (like me) so far just use it to read from chef-repository
[2012-03-23 13:57:00 -0400] maus: Hi, what happens if one declares several resources with identical names?
[2012-03-23 14:07:00 -0400] asfallows: Where would I look on the wiki for information about dynamic environment data? For example, if I want to copy a file to the home directory of the user who ran chef-client, how do I collect that or get chef to use it automatically?
[2012-03-23 14:13:00 -0400] zts: maus: if they are different types of resources, that is fine
[2012-03-23 14:14:00 -0400] zts: maus: if they are all the same resource, then you would be re-opening the one resource and changing its settings
[2012-03-23 14:14:00 -0400] maus: zts, looks like behavior changed in 0.10
[2012-03-23 14:15:00 -0400] zts: maus: what was the previous behaviour?
[2012-03-23 14:17:00 -0400] maus: I wasn't aware of this issue and my receipts worked fine. I had a bunch of identically named lightweight resources.
[2012-03-23 14:17:00 -0400] btm: asfallows: utilize ruby, that is in the ENV['HOME'] variable.
[2012-03-23 14:17:00 -0400] maus: and after upgrade cookbook suddenly broke
[2012-03-23 14:18:00 -0400] maus: took a couple of hours to debug :)
[2012-03-23 14:19:00 -0400] maus: zts, guess it would be better if chef at least gave a warning, what do you think?
[2012-03-23 14:20:00 -0400] btm: maus: resources with the same name are a historical yak-hole. http://tickets.opscode.com/browse/CHEF-2812
[2012-03-23 14:21:00 -0400] maus: btm, almost my case, thank!
[2012-03-23 14:22:00 -0400] maus: by the way, is it an easy way to audit all the cookbooks for such sort of things?
[2012-03-23 14:23:00 -0400] maus: I'm thinking about patching the resource constructor for storing already used names...
[2012-03-23 14:24:00 -0400] asfallows: btm: Thanks!
[2012-03-23 14:30:00 -0400] btm: maus: it's kind of a nasty problem right now. We've considered explicitly prohibiting creating resources with the same name because then notifications cannot diffentiate them and that can be confusing.
[2012-03-23 14:31:00 -0400] maus: it would be great, It's far better to get a clear failure than coward bug. In my case databases silently refused to create.
[2012-03-23 14:41:00 -0400] zts: maus: the counterpoint is that reopening resources is a useful feature, and I'm sure I'm not the only person to use it!
[2012-03-23 14:42:00 -0400] zts: but the ambiguity is a problem
[2012-03-23 14:42:00 -0400] zts: perhaps there should be an attribute which says "this resource can be reopened"
[2012-03-23 14:44:00 -0400] maus: zts, well, maybe add a special attribute like 'open' for explicitly state the intention?
[2012-03-23 14:45:00 -0400] zts: maus: yeah, I'd be in favour of that (although it would be a breaking change for things that currently work)
[2012-03-23 14:45:00 -0400] maus: zts, yeah, something like that
[2012-03-23 14:45:00 -0400] zts: maybe one for Chef 0.11
[2012-03-23 14:45:00 -0400] maus: better to break loudly :)
[2012-03-23 14:45:00 -0400] zts: agreed :)
[2012-03-23 14:47:00 -0400] btm: maus: well, the history is that creating a resource with the same name duplicates and inherits the values of the previous one (except acts weird with only_if / not_if) so that you could cause an action against a resource later in a recipe that you had already defined. At the time, notifications weren't as powerful as they are now. However, you still can't do a simple top-level notification, that is trigger a notification without a resource.
[2012-03-23 14:48:00 -0400] jkyle: I get a 'FATAL: Net::HTTPServerException: 401 "Unauthorized"' when trying to run chef-client on a host. It seems to have been registered and shows up when I do a knife search node 'name:thename' query
[2012-03-23 14:50:00 -0400] jkyle: trying to fix by deleting the node, moving /etc/chef, and rebootstrapping
[2012-03-23 14:52:00 -0400] sampikesley: you need to delete the client, too
[2012-03-23 15:00:00 -0400] btm: jkyle: http://wiki.opscode.com/display/chef/Common+Errors
[2012-03-23 15:00:00 -0400] carlp: Morning all
[2012-03-23 15:01:00 -0400] carlp: I'm looking for a way to read either STDOUT of an application or the contents of a file into a variable within a cookbook.  The output is only one line. Any ideas?
[2012-03-23 15:04:00 -0400] BryanWB: jtimberman: the funniest thing about that video is that every time someone asks him about chef, he essentially answers "but I wanted to write my own solution"
[2012-03-23 15:04:00 -0400] geekbri: carlp: seems like reading the contents of a file would be easy, just use ruby's File class.
[2012-03-23 15:05:00 -0400] atomic-penguin: BryanWB, what video?
[2012-03-23 15:05:00 -0400] carlp: geekbri: OK, I can give that a try. Right now I'm trying a Open4::spawn in a ruby block and it doesn't seem to be running
[2012-03-23 15:05:00 -0400] BryanWB: cquinn talks about their deployments at netflix, and how essentially rewrote parts of chef in groovy and xml
[2012-03-23 15:06:00 -0400] geekbri: carlp: well reading from stdout will certainly be different than reading from a file.  Given the choice, i suggest reading from a file :)
[2012-03-23 15:06:00 -0400] BryanWB: atomic-penguin: http://www.infoq.com/presentations/Building-for-the-Cloud-at-Netflix
[2012-03-23 15:06:00 -0400] pcn: carlp are you executing at compile time or run time?
[2012-03-23 15:06:00 -0400] carlp: geekbri: sounds like a plan, thanks!
[2012-03-23 15:07:00 -0400] pcn: carlp rather, do you want to run at compile time or run time?
[2012-03-23 15:07:00 -0400] carlp: pcn: the goal is run time
[2012-03-23 15:07:00 -0400] pcn: I'm not sure you want a ruby block.  Doesn't that run at compile time?
[2012-03-23 15:08:00 -0400] geekbri: ruby blocks run at execution time I believe.
[2012-03-23 15:08:00 -0400] geekbri: ruby_block, but regular ruby in the cookbook will run at compile time.
[2012-03-23 15:08:00 -0400] pcn: Thanks, you're right.  I had that backwards
[2012-03-23 15:09:00 -0400] pcn: Long night
[2012-03-23 15:09:00 -0400] carlp: Let me make a pastebin of what I have
[2012-03-23 15:09:00 -0400] geekbri: :)
[2012-03-23 15:12:00 -0400] carlp: http://pastebin.com/cfBxhtTG
[2012-03-23 15:16:00 -0400] jkyle: btm: what I did seems to have fixed it
[2012-03-23 15:16:00 -0400] pcn: carlp I'm not a ruby expert, but are you doing too much here?  Would it be clearer to just do something like osi_id = %x{ceph -k #{bootstrap_path} -n client.bootstrap-osd osd create --concise}
[2012-03-23 15:18:00 -0400] pcn: it may be 6 of 1, half dozen of another, but there's only one variable to interpolate so it may be clearer
[2012-03-23 15:18:00 -0400] jtimberman: BryanWB: yeah
[2012-03-23 15:18:00 -0400] jtimberman: BryanWB: i talked to adrian cockcroft for quite some time at velocity last year.
[2012-03-23 15:18:00 -0400] jtimberman: he's smug as shit and i didn't have time for his shennanigans.
[2012-03-23 15:18:00 -0400] jtimberman: :)
[2012-03-23 15:19:00 -0400] carlp: pcn: probably :)  The ruby code was written by someone else and I too thought it was overkill.  Lemme give it a try.
[2012-03-23 15:19:00 -0400] pcn: jtimberman <insert smug solaris reference here>.  What did they re-write?
[2012-03-23 15:20:00 -0400] pcn: or bryanwb I guess.
[2012-03-23 15:20:00 -0400] fearoffish: if I run shell_out("env", { user: 'dude' }), shouldn't the env variables show the dude user?
[2012-03-23 15:20:00 -0400] BryanWB: jtimberman: i gotta say adrianco  and cquinn are very smart
[2012-03-23 15:20:00 -0400] BryanWB: pcn: chef ;)
[2012-03-23 15:21:00 -0400] fearoffish: the result I get, is root user env variables, when run as sudo -i chef-client
[2012-03-23 15:21:00 -0400] fearoffish: is this expected behaviour?
[2012-03-23 15:21:00 -0400] BryanWB: i bet cquinn's real reason for not using chef is that iwt wasn't written in a combination of groovy and jav
[2012-03-23 15:21:00 -0400] kallistec:  fearoffish: shell_out takes a lot more options than just env, you want :env => { ... }
[2012-03-23 15:21:00 -0400] fearoffish: kallistec: I was using 'env' as the command to see the context it ran in
[2012-03-23 15:22:00 -0400] fearoffish: I'm actually trying to run '/usr/local/rbenv/bin/rbenv install 1.9.3-rc1', but it fails saying it can't change the working directory to /root.hence me trying 'env'
[2012-03-23 15:22:00 -0400] pcn: I mean what parts of chef?  Looking through the code there's not a lot of opportunity to say e.g. "i'm not going to use mixlib::log here"
[2012-03-23 15:22:00 -0400] kallistec: fearoffish: oh, I see. Yeah, so you're changing the uid and euid, nothing more
[2012-03-23 15:22:00 -0400] pcn: fearoffish sudo cleans the environment
[2012-03-23 15:23:00 -0400] jtimberman: pcn: they wrote their own automation platform on ec2 for building and cloning golden images.
[2012-03-23 15:23:00 -0400] jtimberman: using a heavyweight java stack.
[2012-03-23 15:23:00 -0400] jtimberman: i mean its clearly working for them, so its totally cool, just not my bag
[2012-03-23 15:23:00 -0400] jtimberman: BryanWB: yeah, adrian is smart.
[2012-03-23 15:24:00 -0400] pcn: jtimberman: That seems to be overkill.  That takes about a day or two to do for ubuntu, at least.
[2012-03-23 15:24:00 -0400] pcn: reminds me: I need to stamp out images next week
[2012-03-23 15:24:00 -0400] kallistec: fearoffish: the issues involved are discussed here: http://tickets.opscode.com/browse/CHEF-2288
[2012-03-23 15:24:00 -0400] fearoffish: kallistec: looking
[2012-03-23 15:24:00 -0400] pcn: fearoffish: since you're setting env within chef and not from sudo, ignore me again.  Coffee is not kicking in yet
[2012-03-23 15:25:00 -0400] BryanWB: i wish people would say 'we didn't use chef because we are not comfortable w/ ruby. We use X scripting tool or heavyweight platfrom and we want our services built w/ x'
[2012-03-23 15:25:00 -0400] murphy_slaw: speaking of ruby
[2012-03-23 15:25:00 -0400] jtimberman: BryanWB: yeah come to grips with the reality of the situation :)
[2012-03-23 15:26:00 -0400] fearoffish: pcn: :)  all input is welcome, hehe
[2012-03-23 15:26:00 -0400] fearoffish: kallistec: funny, the last comment is what I'm doing.  I have a workaround now at least
[2012-03-23 15:26:00 -0400] fearoffish: thanks
[2012-03-23 15:26:00 -0400] fearoffish: both of you
[2012-03-23 15:26:00 -0400] murphy_slaw: i'm testing chef under 1.9.1 and sorting of arrays of nodes seems has changed from 1.8.7
[2012-03-23 15:26:00 -0400] pcn: fearoffish i conflated what you're doing with env foo=bar sudo something_that_looks_at_foo
[2012-03-23 15:26:00 -0400] fearoffish: ahh
[2012-03-23 15:26:00 -0400] fearoffish: that would make sense
[2012-03-23 15:27:00 -0400] murphy_slaw: under 1.8.7, if I did node_array.sort, it would sort by name. under 1.9.1 i get an exception because it can't compare two node objects
[2012-03-23 15:27:00 -0400] murphy_slaw: anyone else run into this?
[2012-03-23 15:28:00 -0400] zoubi: hi guys
[2012-03-23 15:28:00 -0400] zoubi: is there a node attribute for the name of the node/client?
[2012-03-23 15:29:00 -0400] murphy_slaw: node.name
[2012-03-23 15:29:00 -0400] zoubi: so simple...
[2012-03-23 15:29:00 -0400] zoubi: thanks
[2012-03-23 15:36:00 -0400] carlp: okay, now that I have the variable I need in a ruby_block, how do I get it out of there?
[2012-03-23 15:38:00 -0400] zoubi: murphy_slaw: do you know if a list of all the attributes exist somewhere? I can't find on the wiki
[2012-03-23 15:41:00 -0400] mklappstuhl: hey
[2012-03-23 15:43:00 -0400] jtimberman: hey!
[2012-03-23 15:43:00 -0400] jtimberman: :)
[2012-03-23 15:44:00 -0400] mklappstuhl: I want to use chef as documentation/change management tool for single servers (no need to scale), I cannot migrate the whole server setup to cookbooks in a single step though because its quite complex and would take a long time. So my question is: can I use chef to configure and manage parts of the server setup? (i.e. apache without cookbook and gitolite via cookbook)
[2012-03-23 15:46:00 -0400] jtimberman: mklappstuhl: sure, you can automate whatever you like.
[2012-03-23 15:46:00 -0400] btm: mklappstuhl: sure, but try to do it logically. When I switched from Puppet to Chef we did underlying system stuff like users, and then one application stack at a time.
[2012-03-23 15:46:00 -0400] jtimberman: but if you're not doing full automation, the manual things you do will make you sad )
[2012-03-23 15:50:00 -0400] murphy_slaw: Should I be able to sort an array of Chef::Node without specifying a sort key?
[2012-03-23 15:53:00 -0400] murphy_slaw: When I try node_array.sort I get "comparison of Chef::Node with Chef::Node failed"
[2012-03-23 15:53:00 -0400] murphy_slaw: previously this would sort the node list by node.name
[2012-03-23 15:58:00 -0400] kreedy: the other day someone in here mentioned a different monitoring program as an alternative to nagios. i remember it was ruby based, used rabbitmq for queueing up check commands, and i think its website was pink. i foolishly did not bookmark it. anyone know what i'm talking about?
[2012-03-23 15:59:00 -0400] kreedy: i might be wrong about the pink thing
[2012-03-23 16:04:00 -0400] dwhsix: kreedy: search http://likens.us/logs/2012/%23chef.03-22.12.log ?
[2012-03-23 16:05:00 -0400] kreedy: will do
[2012-03-23 16:05:00 -0400] asg: kreedy: https://github.com/sonian/sensu maybe
[2012-03-23 16:05:00 -0400] kreedy: yes! that is exactly it
[2012-03-23 16:05:00 -0400] asg: kreedy: not pink but has the other bits you mentioned
[2012-03-23 16:05:00 -0400] kreedy: thanks asg!
[2012-03-23 16:05:00 -0400] asg: kreedy: graylog2 has lots of pink though :)
[2012-03-23 16:05:00 -0400] kreedy: ha! i was looking at both of these
[2012-03-23 16:06:00 -0400] kreedy: that's probably where my head was at
[2012-03-23 16:06:00 -0400] asg: kreedy: http://portertech.ca/2011/11/01/sensu-a-monitoring-framework/
[2012-03-23 16:06:00 -0400] asg: that's where you got the pink from
[2012-03-23 16:07:00 -0400] kreedy: that's it. glad i'm not crazy
[2012-03-23 16:09:00 -0400] kreedy: thanks!
[2012-03-23 16:10:00 -0400] asg: you're welcome
[2012-03-23 16:11:00 -0400] carlp: Is there a way to get a variable out of the scope of a ruby_block?
[2012-03-23 16:15:00 -0400] geekbri: carlp: what do you mean.
[2012-03-23 16:15:00 -0400] geekbri: carlp: what do you want to do with it
[2012-03-23 16:15:00 -0400] geekbri: kreedy: scoutapp ?
[2012-03-23 16:15:00 -0400] geekbri: oh looks like it was found already :)
[2012-03-23 16:15:00 -0400] kallistec: carlp: you have to fight ruby's scoping rules a bit. define it first at the top level of the recipe (outside of any resource)
[2012-03-23 16:16:00 -0400] kallistec: then, set it to itself inside the resource, then use it in the block
[2012-03-23 16:16:00 -0400] murphy_slaw: okay, here is the simplest possible example of my sort problem
[2012-03-23 16:16:00 -0400] carlp: kallistec: OK, here's what I have right now: http://pastebin.com/GDwi1Ubi
[2012-03-23 16:16:00 -0400] murphy_slaw: in shef
[2012-03-23 16:16:00 -0400] murphy_slaw: chef > nodes.list.sort
[2012-03-23 16:16:00 -0400] murphy_slaw: ArgumentError: comparison of Chef::Node with Chef::Node failed
[2012-03-23 16:17:00 -0400] murphy_slaw: that worked under 1.9.7
[2012-03-23 16:18:00 -0400] kallistec: murphy_slaw: yeah, node doesn't implement the <=> method, you have to give a block to #sort
[2012-03-23 16:18:00 -0400] zoubi: I have this attribute default["creatures"]["database_port"] = 5432 which I'd like to use to set another attribute in another cookbook: default["postgresql"]["port"] = ["creatures"]["database_port"]
[2012-03-23 16:18:00 -0400] zoubi: I get this error: FATAL: TypeError: can't convert String into Integer
[2012-03-23 16:19:00 -0400] zoubi: I've tried to put quotes around 5432, but I still have the same issue
[2012-03-23 16:19:00 -0400] zoubi: any idea?
[2012-03-23 16:19:00 -0400] sampikesley: isn't it like this default["postgresql"]["port"] = default["creatures"]["database_port"]
[2012-03-23 16:19:00 -0400] carlp: kallistec: I must be doing something wrong.  I've updated the pastebin to be what I have now
[2012-03-23 16:20:00 -0400] zoubi: sampikesley: indeed... thanks
[2012-03-23 16:21:00 -0400] kallistec: carlp: yeah, the string that you're passing to `command` in the execute resource is getting created at compile time, but the ruby block won't run until converge time
[2012-03-23 16:21:00 -0400] kallistec: also, you need to do something like osd_id = osd_id between line 5 and 6
[2012-03-23 16:22:00 -0400] kallistec: because chef uses instance eval which messes with scoping of "captured" variables
[2012-03-23 16:22:00 -0400] murphy_slaw: kallistec: could i define a comparison method for Chef::Node somewhere?
[2012-03-23 16:22:00 -0400] kallistec: murphy_slaw: yeah, you could monkey patch it in to Chef::Node if you want
[2012-03-23 16:22:00 -0400] |shad0w|: do you even need to do you variable login in the ruby_block?
[2012-03-23 16:23:00 -0400] |shad0w|: unless you care about when it runs why not just have it in the recipe direct?
[2012-03-23 16:23:00 -0400] carlp: kallistec: Still nothing, have I just painted myself into an impossible corner?
[2012-03-23 16:23:00 -0400] kallistec: carlp: does what you're doing in the ruby_block depend on something that occurs earlier in the chef run?
[2012-03-23 16:24:00 -0400] carlp: kallistec: the creation of bootstrap_path
[2012-03-23 16:25:00 -0400] kallistec: carlp: one thing you can do is force the resource that creates bootstrap_path to run at compile time using the run_action hack
[2012-03-23 16:25:00 -0400] carlp: kallistec: OK, got an example of that?
[2012-03-23 16:25:00 -0400] kallistec: then you can run the code in your ruby block just at the top level of the recipe (not in a ruby block resource)
[2012-03-23 16:28:00 -0400] kallistec: carlp: seems it got removed from some of our cookbooks where we were using it
[2012-03-23 16:28:00 -0400] kallistec: the gist of it is, put action :nothing in your resource
[2012-03-23 16:29:00 -0400] kallistec: and put `run_action :create` (or whatever the desired action is) as the last line inside the resource
[2012-03-23 16:33:00 -0400] carlp: kallistec: it really sounds like I'm doing this wrong.  Is there no better way to get a STDOUT from a command into a variable, or from a file (I can always redirect it)
[2012-03-23 16:35:00 -0400] carlp: oh wait!  looks like I don't need to do the $x{} inside a ruby block at all, seems to work then
[2012-03-23 16:47:00 -0400] cap10morgan: how do we feel about the security of storing AWS credentials as node attributes? (using opscode platform)
[2012-03-23 16:48:00 -0400] BryanWB: cap10morgan: i don't feel good about it
[2012-03-23 16:48:00 -0400] btm: cap10morgan: encrypted data bags? http://wiki.opscode.com/display/chef/Encrypted+Data+Bags
[2012-03-23 16:48:00 -0400] cap10morgan: BryanWB: me neither
[2012-03-23 16:48:00 -0400] BryanWB: btm is right
[2012-03-23 16:48:00 -0400] cap10morgan: btm: yeah, that's probably the right answer
[2012-03-23 16:49:00 -0400] BryanWB: btm: the problem is sharing that password b/w recipes
[2012-03-23 16:49:00 -0400] cap10morgan: will require changing the duplicity cookbook, but that's ok. thanks.
[2012-03-23 16:49:00 -0400] BryanWB: u have to load the databag for each recipe that uses it
[2012-03-23 16:50:00 -0400] |shad0w|: You could dump it run_state so you only have to grab it once
[2012-03-23 16:50:00 -0400] BryanWB: |shad0w|: i have never heard of run_state
[2012-03-23 16:50:00 -0400] BryanWB: what is that???
[2012-03-23 16:50:00 -0400] |shad0w|: although I'd love to see a volitile_attrs so you can store attribs that never get saved on the node
[2012-03-23 16:51:00 -0400] BryanWB: if it is saved on the node then it is later saved unencrypted in couchdb
[2012-03-23 16:51:00 -0400] zts: BryanWB: it's not saved in the node
[2012-03-23 16:51:00 -0400] |shad0w|: run_state isn't
[2012-03-23 16:51:00 -0400] zts: it's scratch space
[2012-03-23 16:51:00 -0400] |shad0w|: the application cookbook uses it iirc
[2012-03-23 16:51:00 -0400] BryanWB: great to know! i was wholly ignorant of it
[2012-03-23 16:52:00 -0400] zts: I use it for some lazy config generators
[2012-03-23 16:52:00 -0400] zts: eg, have a definition which squirts something into run_state
[2012-03-23 16:52:00 -0400] zts: sorry, not for config, for reporting
[2012-03-23 16:52:00 -0400] zts: then pull it out in a handler
[2012-03-23 16:53:00 -0400] BryanWB: that would be quite useful for passwords
[2012-03-23 16:55:00 -0400] |shad0w|: BryanWB, what was up with the audio on the last ff show :P
[2012-03-23 16:57:00 -0400] BryanWB: |shad0w|: which part? the scraping sounds?
[2012-03-23 16:58:00 -0400] BryanWB: the belching in the background?
[2012-03-23 16:58:00 -0400] |shad0w|: the echo
[2012-03-23 16:58:00 -0400] |shad0w|: made it a bit painful to listen to :)
[2012-03-23 16:58:00 -0400] BryanWB: fuck, sorry man
[2012-03-23 16:58:00 -0400] |shad0w|: just picking
[2012-03-23 16:58:00 -0400] BryanWB: |shad0w|: was it my voice or everyone's?
[2012-03-23 16:58:00 -0400] |shad0w|: everyones
[2012-03-23 16:59:00 -0400] BryanWB: hmm, if one person has their internal speakers on we get echo
[2012-03-23 16:59:00 -0400] |shad0w|: not echo, actually sounds like someone did a hall effect on it
[2012-03-23 16:59:00 -0400] BryanWB: |shad0w|: let's be clear, did u or did u not hear the same sound twice, i.e. echo?
[2012-03-23 16:59:00 -0400] |shad0w|: not echo
[2012-03-23 16:59:00 -0400] BryanWB: |shad0w|: otherwise it's a different problem,
[2012-03-23 17:00:00 -0400] |shad0w|: sounded like a hall effect
[2012-03-23 17:00:00 -0400] BryanWB: i forgot to set the recording to mono, i had it on stereo which probably caused the effect u refer to
[2012-03-23 17:00:00 -0400] BryanWB: sorry :(
[2012-03-23 17:00:00 -0400] |shad0w|: how often do you guys do shows?
[2012-03-23 17:00:00 -0400] BryanWB: i am learning as i go but still make mistakes
[2012-03-23 17:00:00 -0400] BryanWB:  at least every 2 weeks
[2012-03-23 17:01:00 -0400] BryanWB: hardest part is getting opscoders on the show ;)
[2012-03-23 17:01:00 -0400] |shad0w|: ha
[2012-03-23 17:01:00 -0400] jtimberman: no i'm just a jerk
[2012-03-23 17:01:00 -0400] jtimberman: :)
[2012-03-23 17:01:00 -0400] |shad0w|: lurker
[2012-03-23 17:01:00 -0400] BryanWB: jtimberman: actually it's not just u but its hard to get any opscoder besides matt on the show cuz u r all so busy
[2012-03-23 17:02:00 -0400] BryanWB: or perhaps u don't like the show because of the crappy audio
[2012-03-23 17:02:00 -0400] atomic-penguin: You still using Google meetup for that?
[2012-03-23 17:02:00 -0400] |shad0w|: content is still king BryanWB :)
[2012-03-23 17:03:00 -0400] BryanWB: atomic-penguin: no, cuz it uses too much ram on my little macbook air
[2012-03-23 17:03:00 -0400] atomic-penguin: BryanWB, it seemed to be quite a bear on my old laptop
[2012-03-23 17:04:00 -0400] BryanWB: atomic-penguin: in terms of ram?
[2012-03-23 17:04:00 -0400] BryanWB: it was those reindeer antlers
[2012-03-23 17:04:00 -0400] atomic-penguin: BryanWB, in terms of performance.  Just laggy as hell
[2012-03-23 17:04:00 -0400] atomic-penguin: I didn't check RAM usage on it
[2012-03-23 17:05:00 -0400] atomic-penguin: Watcha using now, Mumble, Skype?
[2012-03-23 17:05:00 -0400] BryanWB: skype, even tho i hate it
[2012-03-23 17:05:00 -0400] hyvs: hello everyone, i have one problem that i cant figure out with ec2 plugin. Can someone help me ?
[2012-03-23 17:08:00 -0400] atomic-penguin: Check out Mumble its pretty awesome, and braindead simple to set up.
[2012-03-23 17:09:00 -0400] BryanWB: hmm, will have to consider it, atomic-penguin  but do i have to set up my own server?
[2012-03-23 17:09:00 -0400] atomic-penguin: mumble.com has a free 30 day trial, 10 slots cost $4/month
[2012-03-23 17:11:00 -0400] atomic-penguin: https://mmo-mumble.com/help/ComparisonChart
[2012-03-23 17:13:00 -0400] BryanWB: that could be worth it, skype sucks ass
[2012-03-23 17:13:00 -0400] BryanWB: people dropped out multiple times last show, fucking annoying
[2012-03-23 17:15:00 -0400] atomic-penguin: ...or just find a low latency public mumble server to set up a channel and record your show :)
[2012-03-23 17:30:00 -0400] thehar: anyone using librarian?
[2012-03-23 17:30:00 -0400] geekbri: thehar: yar
[2012-03-23 17:30:00 -0400] thehar: i am migrating all of my cookbooks to it and a bit stuck :)
[2012-03-23 17:30:00 -0400] thehar: mind if i pm?
[2012-03-23 17:30:00 -0400] geekbri: sure go ahead
[2012-03-23 17:48:00 -0400] asfallows: When I create a client with 'knife client create', using the -n flag is supposed to prevent it launching an editor, correct?
[2012-03-23 17:56:00 -0400] webframp: asfallows: correct. -n is --no-editor
[2012-03-23 17:56:00 -0400] luisico: asfallows, http://tickets.opscode.com/browse/CHEF-2641
[2012-03-23 17:59:00 -0400] asfallows: webframp, luisico: Thanks for the replies. I was getting an error becuase my EDITOR var wasn't set. Got things working for now.
[2012-03-23 18:49:00 -0400] sivy: good morning
[2012-03-23 18:50:00 -0400] sivy: i've used the apache2 cookbook many times before with noe issues, but today on a client's system it blew up on the mod_openid_auth module: https://gist.github.com/2173728 -- anyone seen this before and have an idea?
[2012-03-23 18:51:00 -0400] sivy: (an ubuntu 10.04.1 system)
[2012-03-23 18:54:00 -0400] btm: sivy: at line 29 it sets make_cmd and it should be set to 'make'
[2012-03-23 18:54:00 -0400] btm: sivy: line 29 of apache2/recipes/mod_auth_openid.rb
[2012-03-23 18:55:00 -0400] sivy: btm yes
[2012-03-23 18:55:00 -0400] btm: sivy: looks like you need the latest version of the apache2 cookbook: http://tickets.opscode.com/browse/COOK-1083
[2012-03-23 18:56:00 -0400] btm: sivy: v1.1.2
[2012-03-23 18:56:00 -0400] sivy: aha
[2012-03-23 18:58:00 -0400] sivy: thanks btm - looks like nagios pulled in an old version
[2012-03-23 19:20:00 -0400] RandyVF: Can anyone point me to examples of how to use resources inside ruby blocks?  I made an attempt (http://pastie.org/3656259) and it doesn't work.   I am trying to get remote_directory to work in a ruby block.
[2012-03-23 19:24:00 -0400] jdeamattson: jtimberman: Please take a look at http://tickets.opscode.com/browse/CHEF-2998, I believe it is a very serious issue with the Ohai 0.6.12 release. Let me know how I can assist with isolation.
[2012-03-23 19:24:00 -0400] geekbri: RandyVF: It wont.  I had the same issue.  I basically rewrote remote_file myself inside the ruby block
[2012-03-23 19:24:00 -0400] geekbri: RandyVF: the problem is that resources run at compile time and your ruby_block is running at execution time
[2012-03-23 19:25:00 -0400] geekbri: RandyVF: at least that was my experience, unless somebody here can refute me.... and I would be more than glad to be wrong
[2012-03-23 19:27:00 -0400] fractaloop: To run the cucumber features, so I need to run chef-solr-installer first? I've got rabbitmq and couchdb started
[2012-03-23 19:29:00 -0400] RandyVF: geekbri: Yes..  In my base role, I setup ldap and then later in the role in the nagios cookbook I try to assign the directory ownership (in the remote_directory resource) to an ldap account.  These of course do not exist at Compile Time.   This has been 'driving me crazy' for the past few days trying to figure out how to make it work..
[2012-03-23 19:31:00 -0400] RandyVF: geekbri:  It works ok on the second and subsequent runs as oahi has pulled in the account info after the ldap client setup was completed.
[2012-03-23 19:32:00 -0400] jdeamattson: Woot! I just opened CHEF-3000!
[2012-03-23 19:33:00 -0400] geekbri: RandyVF: yeah thats the issue I ran into.  IT will work fine on subsequent runs beacuse it will go resource runs, ruby block runs, then on subsequent runs when the resource runs whatever was set by the ruby block will be there
[2012-03-23 19:33:00 -0400] geekbri: RandyVF: however, needing 2 runs for something to work isn't very chef like :)
[2012-03-23 19:34:00 -0400] bkocik1: jdeamattson: You should get a toaster or something.
[2012-03-23 19:34:00 -0400] jdeamattson: bkocik1: How about a free ticket to ChefCon! That is something I will use :-)
[2012-03-23 19:35:00 -0400] RandyVF: geekbri: I agree..
[2012-03-23 19:35:00 -0400] geekbri: RandyVF: I had a simliar situation to you where I had a ruby_block doing something that was trying to be used by remote_file... there was no way to resolve it for me other than I basically rewrote the functionally provided by remote_file myself inside of the ruby_block
[2012-03-23 19:36:00 -0400] geekbri: RandyVF: The design of ruby_block is that it will run AFTER compile time.... resource will be run AT compile time.  You will not be able to use something calculated or done in a ruby_block in a resource.
[2012-03-23 19:36:00 -0400] geekbri: RandyVF: your only real option for that is to recreate the functionality you need that a resource provides in ruby.
[2012-03-23 19:36:00 -0400] RandyVF: geekbri: Would you be willing to share that ruby_block code?  Please...  <best lost puppy dog look>  :o)
[2012-03-23 19:37:00 -0400] geekbri: RandyVF: sure. I dont know if it will be as useful to you as its a file not a directory
[2012-03-23 19:37:00 -0400] RandyVF: geekbri:  It will be a starting point anyway..  :)
[2012-03-23 19:39:00 -0400] geekbri: RandyVF: this is probably the block you are interested in: https://gist.github.com/2174190
[2012-03-23 19:40:00 -0400] geekbri: RandyVF: its a pretty simple block, it just initiates a http GET of a file and aborts if it doesnt get a success code
[2012-03-23 19:42:00 -0400] RandyVF: geekbri: I'll take a look and see if I can figure it out.   If not, there's always script or bash..  :o/
[2012-03-23 19:43:00 -0400] geekbri: RandyVF: you could do it in a bash block... Just make sure you include some way for either your ruby_block or your bash block to stay idempotent
[2012-03-23 19:43:00 -0400] kallen: within /var/lib/chef/cookbook_index, i am finding files part of a cookbook which are stale. i purge this cookbook, and still these files remain in cookbook_index. i re-upload the cookbook with new contents. grepping thru cookbook_index reveals files of both the new and desired and stale and undesired. this sound familiar, known?
[2012-03-23 19:44:00 -0400] kallen: this is causing my cookbook to place stale content on my clients
[2012-03-23 19:45:00 -0400] RandyVF: geekbri:  Yes, that's been the limiting factor thus far.  Also figuring a way to process the files from the files folder from the cookbook inside a script or ruby_block..  :o/
[2012-03-23 19:46:00 -0400] geekbri: RandyVF: well processing the files is easy.  I usually just drop a hiddenf ile called .installed-version-number and do a not_if { File.exists(install_test_file) }
[2012-03-23 19:46:00 -0400] geekbri: RandyVF: or in the case of a pure ruby block unless File.exists?
[2012-03-23 19:49:00 -0400] RandyVF: geekbri: There are about 50 plugins for nagios in my /files/plugins folder in the cookbook.   I need to process them from that location with code inside the ruby_block.   Note: I still have much to learn in ruby..
[2012-03-23 19:50:00 -0400] geekbri: RandyVF: sounds like you've got your work cut out for you.  I'm willing to help whenever I'm online to don't hestitate to ask me questions.
[2012-03-23 19:51:00 -0400] RandyVF: geekbri:  Thanks very much..
[2012-03-23 19:51:00 -0400] geekbri: RandyVF: Might I also recommend "The Ruby Programming Language" by o'reilly.  Its written by david flannigan and Matz (the creator of ruby).  A worthwhile read if you have the time.
[2012-03-23 19:52:00 -0400] fractaloop: Has anyone here ever run the Cucumber tests?
[2012-03-23 19:53:00 -0400] RandyVF: geekbri:  I actually have that book (amoungst others) just been under such a tight timeline, I haven't been able to read much of it.   So much work to do, so little time.  Life in IT, eh?  :o)
[2012-03-23 19:55:00 -0400] geekbri: RandyVF: yes im familiar with the feeling
[2012-03-23 19:58:00 -0400] RandyVF: geekbri:  I just wish I could get the owner and group information of remote_directory populated in the run phase..
[2012-03-23 19:59:00 -0400] RandyVF: geekbri: as opposed to the compile phase
[2012-03-23 19:59:00 -0400] geekbri: RandyVF: I suggest giving up on that if you want any part of it done within a ruby_block.  the ruby_block spec says that it runs at execution time.
[2012-03-23 19:59:00 -0400] geekbri: RandyVF: you can write straight ruby inside the recipe itself.  have you tried that, instead of having it inside a ruby_block?
[2012-03-23 20:02:00 -0400] RandyVF: geekbri: Yes, see http://pastie.org/3656259
[2012-03-23 20:05:00 -0400] RandyVF: It fails when trying to set the user nagios on the remote_directory.
[2012-03-23 20:07:00 -0400] cap10morgan: how do folks handle periodic apt-get upgrades? w/ chef / something else / manual?
[2012-03-23 20:14:00 -0400] miah: cap10morgan: deployment systems
[2012-03-23 20:15:00 -0400] cap10morgan: miah: can you elaborate?
[2012-03-23 20:18:00 -0400] miah: rundeck, capistrano, knife ssh.. use something like that to manage your chef installation, or write some custom chef cookbooks to deal with it
[2012-03-23 20:18:00 -0400] miah: it depends entirely on environment
[2012-03-23 20:18:00 -0400] miah: and how you deploy chef as it is now
[2012-03-23 20:22:00 -0400] geekbri: cap10morgan: I usually pick a guinea pig server from the cluster, remove it from service, run an apt-get upgrade on it... let it bake for a bit, see what happens... if it works fine, then i usually just knife ssh the command to the remainder.  I usually do it serially though as to not overload the whole cluster at once
[2012-03-23 20:22:00 -0400] geekbri: but that also depends on critical the updates are, what they touch, if they require restarting of certain services etc etc
[2012-03-23 20:23:00 -0400] cap10morgan: sure
[2012-03-23 20:26:00 -0400] cap10morgan: anyone using unattended-upgrades?
[2012-03-23 21:55:00 -0400] matschaffer: is there any way to ensure things like delayed restarts still happen after a failed chef run? I find when Idempotence breaks down, that's usually the cause of it.
[2012-03-23 21:55:00 -0400] mgalkiewicz: Hello guys I have a problem with chef-client. When I log in to my machine through ssh and execute chef-client it does generate output to STDOUT, STDERR and to specified log file. However if I execute it like this: "ssh user@host chef-client" all I can see is STDERR. There is no output on STDOUT.  My configuration https://gist.github.com/2174039. Chef version 0.10.8. It worked fine on chef 0.9.16 with option "-V" which is now removed.
[2012-03-23 22:28:00 -0400] ssd7: Ohai Chefs!
[2012-03-23 22:28:00 -0400] paulmooring: hello ssd7
[2012-03-23 22:50:00 -0400] sivy: anre there any docs that explain how environments, nodes, and runlists relate to each other? I just moved a node from _default to production in the console and it blew away the entire runlist
[2012-03-23 22:59:00 -0400] sivy: oh, nm.
