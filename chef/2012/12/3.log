[2012-12-03 00:00:08 -0500] Virunga: Hi, if i write in the metadata.rb file of the cookbook A, depends 'B', is the B's attribute file loaded before the A's attribute file?
[2012-12-03 00:04:53 -0500] jhayden: does anyone know if it is possible to set the node name value from within an auto scale group?
[2012-12-03 00:05:31 -0500] jhayden: if I know I am going to spin up a minimum # of servers, how can I tell the chef server what names to give the nodes
[2012-12-03 00:09:57 -0500] rafaelmagu: Need some help, folks. My Chef server stopped working after the weekly cron run (which was also the end of month one) for some reason I'm not yet aware of.
[2012-12-03 00:10:21 -0500] rafaelmagu: Trying to bootstrap new servers gets me this: "You are not allowed to take this action."
[2012-12-03 00:10:38 -0500] rafaelmagu: I'm also getting "Client already exists" when it actually doesn't.
[2012-12-03 00:11:41 -0500] jtimberman: Virunga: not necessariy
[2012-12-03 00:11:47 -0500] khimera: has anyone had any issues deploying a server w/ github private repo? I am trying figure out a way on passing rya key fingerprint, if anyone can help?
[2012-12-03 00:11:56 -0500] jtimberman: Virunga: attributes files are, unfortunately, not loaded in a deterministic order.
[2012-12-03 00:11:56 -0500] rafaelmagu: And for some reason when I log into the web interface to delete the client, the webui is trying to redirect to the /clients/<node_name> page
[2012-12-03 00:11:57 -0500] khimera: rsa*
[2012-12-03 00:12:09 -0500] rafaelmagu: Which nets me a NoMethodErrror from merb
[2012-12-03 00:12:25 -0500] jtimberman: Virunga: however, you can use the include_attribute method in the attributes file of A to include_attribute "B" (or whatever the name of cookbook "B" is)
[2012-12-03 00:13:32 -0500] Virunga: jhayden: oh ok, perfect. Thanks for the solution.
[2012-12-03 00:13:47 -0500] Virunga: jtimberman: that was for you :D
[2012-12-03 00:13:49 -0500] Virunga: Thanks
[2012-12-03 00:14:06 -0500] jhayden: I'll take credit! ;-)
[2012-12-03 00:14:19 -0500] Virunga: eheh
[2012-12-03 00:16:46 -0500] Glace: any eta on fixing the CPU HOG issue on chef-client on windows?
[2012-12-03 00:26:01 -0500] yfeldblum: Virunga, jtimberman, http://tickets.opscode.com/browse/CHEF-3376 ... on a component basis, components of cookbooks should be loaded in dependency order in chef-11
[2012-12-03 00:26:25 -0500] laurent\: root      9399  1.2 36.1 2337268 2146144 ?     S    Dec02  14:46 /usr/bin/ruby1.8 /var/lib/gems/1.8/bin/chef-client -d -P /var/run/chef/client.pid -L /var/log/chef/client.log -c /etc/chef/client.rb -i 1800 -s 20 and what about the MEMORY HOG ? :)
[2012-12-03 00:27:36 -0500] Virunga: yfeldblum: awesome.
[2012-12-03 00:27:53 -0500] jtimberman: yfeldblum: yup
[2012-12-03 00:28:34 -0500] jtimberman: Glace: no eta that i'm aware of, i think the ticket used for tracking is http://tickets.opscode.com/browse/CHEF-3485
[2012-12-03 00:29:48 -0500] ssd7: laurent\: Chef 11 server and Hosted CHef have partial serach which goes a long way with memory for many run_lists
[2012-12-03 00:34:02 -0500] ssd7: Glace: I also know some internal work has been done looking at the root cause of the CPU usage.  I believe a substantial improvement was seen just by moving from Ruby 1.9.2 to Ruby 1.9.3.  I belive the current plan is to update the installers with 1.9.3 for Chef 11.
[2012-12-03 00:35:22 -0500] laurent\: ssd7: ok thanks for the info, that hinted me to http://www.opscode.com/blog/2012/10/31/introducing-partial-search-for-opscode-hosted-chef/
[2012-12-03 00:35:39 -0500] jtimberman: laurent\: the --fork option may be helpful too, in 10.16
[2012-12-03 00:36:25 -0500] Glace: ssd7 and jtimberman: thank you!
[2012-12-03 00:37:07 -0500] Glace: this is pretty much stopping us of running chef-client on Windows node in prod
[2012-12-03 00:39:23 -0500] laurent\: jtimberman: thanks (just read CHEF-3432 and CHEF-3104)
[2012-12-03 01:01:50 -0500] rafaelmagu: Grrr! What is it with Chef server and Mondays?
[2012-12-03 01:02:10 -0500] rafaelmagu: Now getting "Error Syncing Cookbooks: EOFError"
[2012-12-03 02:15:11 -0500] rafaelmagu: Anyone else ever had to deal with Chef server returning "end of file reached' in a run?
[2012-12-03 02:18:40 -0500] ctracey: rafaelmagu, i believe we ran into that when we had exhausted disk space on the server
[2012-12-03 02:19:31 -0500] rafaelmagu: ctracey just checked, 39% used.
[2012-12-03 02:35:45 -0500] jtran: the nova cookbook has depends listed in metadata.rb.   However, if I add just a recipe from that nova cookbook such as just 'recipe[nova::libvirt]'  , when the node runs chef-client it doesn't install the dependencies (such as nova-common).  is that desired behavior?
[2012-12-03 02:37:48 -0500] ctracey: jtran, might want to be using openstack-chef
[2012-12-03 02:38:05 -0500] jtran: ctracey: u mean openstack-chef repo?
[2012-12-03 02:38:09 -0500] ctracey: yes
[2012-12-03 02:38:16 -0500] ctracey: and there is #openstack-chef
[2012-12-03 02:38:32 -0500] jtran: ctracey: ah, thanks
[2012-12-03 02:38:57 -0500] ctracey: not personally using the openstack-chef repos yet, but using the rcbops chef repos currently
[2012-12-03 02:38:59 -0500] jtran: ctracey: altho i am curious in general tho, shouldn't the dependencies be installed even if I run just one recipe from the cookbook?  none of the docs go into detail on that matter
[2012-12-03 02:40:26 -0500] ctracey: jtran, yes, I would think so, though this bit of things seems to be a moving target
[2012-12-03 02:40:35 -0500] jtran: ctracey: tell me about it :)
[2012-12-03 02:40:49 -0500] jtran: ok thanks for the insight tho.
[2012-12-03 02:40:51 -0500] yfeldblum: jtran, only the recipes in your run-list are run; that's why it's the run-list
[2012-12-03 02:41:01 -0500] ctracey: essex, folsom, grizzly?
[2012-12-03 02:41:17 -0500] yfeldblum: jtran, if one recipe does `include_recipe "some_other_recipe"` then that recipe will be run as well
[2012-12-03 02:41:32 -0500] jtran: yfeldblum:   i see.  therefore in order to get dependencies to install,  it has to be in a role?
[2012-12-03 02:41:47 -0500] jtran: or perhaps i'm just not understanding, what causes dependencies to install.
[2012-12-03 02:43:14 -0500] yfeldblum: jtran, if you want chef to run a recipe, either it needs to be in the run-list directly, or it needs to be included from some other recipe that is in the run-list with `include_recipe`
[2012-12-03 02:43:36 -0500] jtran: yfeldblum:  ok, so I need to have the include_recipe in the parent recipe.
[2012-12-03 02:43:43 -0500] yfeldblum: jtran, yes
[2012-12-03 02:43:52 -0500] jtran: does it also need metadata.rb depends ?  <-- what is that for ?
[2012-12-03 02:43:53 -0500] rafaelmagu: For the record, the "end of file reached" error was fixed with a 'knife cookbook bulk delete ".*" --purge' then a re-upload of the cookbooks
[2012-12-03 02:44:16 -0500] yfeldblum: jtran, you also need to keep the `depends` in the metadata; it's so that chef-client knows to download the depended-on cookbook (just in case it's needed because of `include_recipe`)
[2012-12-03 02:44:48 -0500] jtran: aaaaah ok.   thanks for that info, yfeldblum .   I suppose http://wiki.opscode.com/display/chef/Recipes#Recipes-IncludingRecipes did explain that but I didn't comprehend .  you cleared that up :)
[2012-12-03 02:45:25 -0500] jtran: that actually explains a lot.  when i run recipe[nova] (which has default.rb of nothing), it downloads all the cookbooks listed in depends in metadata.rb .
[2012-12-03 02:45:38 -0500] jtran: but doesn't actually install anything!  That is why!
[2012-12-03 02:45:58 -0500] yfeldblum: jtran, yep
[2012-12-03 06:49:21 -0500] questionguy: hello - i'm having trouble integrating fnichol's chef-user cookbook; does anyone here use this?  i think i'm missing something simple/obvious. . .
[2012-12-03 06:55:23 -0500] alex__: I'm bootstrapping a node from a ruby script. How can I pass json attributes at bootstrap.  I'm using this : bootstrap.config[:first_boot_attributes]   but it doesn't work.  any idea?
[2012-12-03 07:00:44 -0500] martinisoft: oops, was about to help that guy :(
[2012-12-03 08:10:42 -0500] odyssey4me: hmm, I might be doing something wrong here - I'm trying to use a comparitive operator in a not_if statement... and it's not working
[2012-12-03 08:11:25 -0500] odyssey4me: I have a command to run, and if it outputs anything other than a specific line, then I want the recipe not to run
[2012-12-03 08:11:51 -0500] odyssey4me: any ideas on how best to do that?
[2012-12-03 08:15:29 -0500] odyssey4me: ok, so I did it the other way around - only_if "command | grep 'expected line when nothing's been done'"
[2012-12-03 08:15:46 -0500] odyssey4me: but I'd still like to know if it's possible to use comparitive operators?
[2012-12-03 08:56:15 -0500] masterkorp: hello checks
[2012-12-03 08:56:24 -0500] masterkorp: occupant: yes you can
[2012-12-03 08:56:40 -0500] masterkorp: oh he left
[2012-12-03 09:51:58 -0500] WPsites: I'm using the logstash cookbook and I'm trying to add some grok filters into the logstash_server role. I'm having trouble translating the logstash config file to json. The grok definition has two "add_field" elements to it. When I try enter that in json format knife accepts it but then deletes one of the add_fields which breaks everything. how do I get both off these items into the json??
[2012-12-03 10:00:00 -0500] WPsites: Here is my json structure https://gist.github.com/4193981 and here is the config file I'm trying to emulate http://cookbook.logstash.net/recipes/syslog-pri/#parsing-bsd-syslog-format. I've added the field "received_from" I just need to add "received_at" but I just can't get my head around adding 2 "add_field" items into the same structure? HELP
[2012-12-03 10:10:51 -0500] bmcgee: hey guys, I have a bit of a stupid question. I've always provisioned vm's either through vagrant or knife rackspace so I've never manually installed chef-client and registered a node. I've installed the client ok, but what I can't really figure out is how do i now register my machine as node-x with roles a,b,c. I can run it with an override list but i want the run list to be persistent
[2012-12-03 10:20:49 -0500] bmcgee: nvm found the guide
[2012-12-03 10:21:04 -0500] WPsites: bmcgee: can you not just use knife bootstrap?
[2012-12-03 10:21:21 -0500] bmcgee: WPsites: thats the guide I found
[2012-12-03 10:21:23 -0500] bmcgee: :)
[2012-12-03 10:21:46 -0500] WPsites: OK cool. I would have answered before but I'm hardly pro at this chef stuff!
[2012-12-03 10:33:05 -0500] ExxKA: Hey - when I am using chef solo to provision a server I get an error saying "already initialized constant Application"
[2012-12-03 10:37:59 -0500] ExxKA: What is the reason for this?
[2012-12-03 10:39:00 -0500] masterkorp: ExxKA: http://i.imgur.com/sdLuh.jpg
[2012-12-03 10:39:27 -0500] WPsites: ExxKA: is it an error or warning?
[2012-12-03 10:39:37 -0500] ExxKA: WPsites, warning
[2012-12-03 10:39:53 -0500] WPsites: I don't think it's a problem then is it?
[2012-12-03 10:39:55 -0500] ExxKA: That's nice masterkorp, but I cannot deduce what the solution is from your picture :)
[2012-12-03 10:40:06 -0500] WPsites: lol
[2012-12-03 10:40:27 -0500] ExxKA: WPsites, it's not a show stopper but out of interest I would like to know what the problem is
[2012-12-03 10:40:28 -0500] masterkorp: ExxKA: http://i.imgur.com/tOGGn.gif
[2012-12-03 10:40:47 -0500] WPsites: lol
[2012-12-03 10:41:33 -0500] ExxKA: masterkorp, I am afraid I still do not get it
[2012-12-03 10:43:33 -0500] WPsites: I think what masterkorp is saying is, "don't worry about it carry on with what you're doing, have a hot drink, stick a bird in-between your cleavage"
[2012-12-03 10:43:51 -0500] masterkorp: :)
[2012-12-03 13:26:28 -0500] auduny: Hmpf.
[2012-12-03 13:26:38 -0500] auduny: Seems like rolenames with "-" in them are stupid.
[2012-12-03 13:26:45 -0500] auduny: How do i Escape them?
[2012-12-03 13:26:49 -0500] auduny: \- does not work
[2012-12-03 13:33:45 -0500] masterkorp: escape ?
[2012-12-03 13:33:57 -0500] masterkorp: in ruby ? in the shell
[2012-12-03 13:34:23 -0500] auduny: Shell using knife.
[2012-12-03 13:35:14 -0500] auduny: knife search node 'roles:vg\-dev' this does not work (with or without the "\") but a role called something without a dash will work.
[2012-12-03 13:35:53 -0500] gchristensen: what about 'roles:"vg-dev"
[2012-12-03 13:35:55 -0500] gchristensen: '
[2012-12-03 13:36:21 -0500] auduny: Nope.
[2012-12-03 13:38:08 -0500] gchristensen: remarkable
[2012-12-03 13:38:59 -0500] yfeldblum: quote and escape
[2012-12-03 13:39:08 -0500] auduny: Tried that as well
[2012-12-03 13:39:10 -0500] rb2k: I'm trying to provision a vagrant VM with chef. It used to be that you could just add "module_apc" as a recipe
[2012-12-03 13:39:15 -0500] rb2k: but that seems to be deprecated now
[2012-12-03 13:39:30 -0500] rb2k: and the php_pear LWRP is supposed to be used
[2012-12-03 13:39:43 -0500] rb2k: but can that be used in the "Vagrantfile" or do i have to add a new cookbook for that parT?
[2012-12-03 13:42:24 -0500] auduny: Hmpf Something funky is going on here. Seems like I can't search on some roles at all.
[2012-12-03 13:42:31 -0500] auduny: Some roles work. Some does not work.
[2012-12-03 13:42:43 -0500] auduny: They just return 0 nomatter what I do.
[2012-12-03 13:42:55 -0500] auduny: Maybe a index that has not been updated in solr?
[2012-12-03 13:46:37 -0500] auduny: chef-expander broken. My fault.
[2012-12-03 14:00:10 -0500] masterkorp: auduny: use double quotes
[2012-12-03 14:00:18 -0500] masterkorp: what shell are you using ?
[2012-12-03 14:06:32 -0500] natim: Hello guys
[2012-12-03 14:06:57 -0500] natim: Do you guys know how I can set the global umask settings for my recipes?
[2012-12-03 14:07:57 -0500] natim: In the doc I read that the default is umask 0022 but what If I want 0027 ?
[2012-12-03 14:12:26 -0500] aruntomar: natim: change the default umask in /etc/profile and it'll be applicable globally
[2012-12-03 14:14:12 -0500] natim: aruntomar, ok thanks
[2012-12-03 14:43:53 -0500] masterkorp: Can i have sub directories in the libraries cookbook
[2012-12-03 14:44:12 -0500] masterkorp: liks libraries/resources and libraries/providers ?
[2012-12-03 15:05:59 -0500] breckognize: What is a reasonable amount of time for a run of chef client to take assuming it has an empty run list? (e.g. to check in with the server, etc.)
[2012-12-03 15:15:45 -0500] masterkorp: under 15seconds
[2012-12-03 15:16:13 -0500] masterkorp: anything over that is not acceptable at all
[2012-12-03 15:17:36 -0500] paulmooring: breckognize: it takes about 3 seconds for an empty runlist on Hosted Chef for me
[2012-12-03 15:20:50 -0500] breckognize: Thanks paul - my runs seems to take ~60 seconds... I have no idea where all the latency is coming from. chef-client just sits for a long time before starting its run
[2012-12-03 15:21:15 -0500] spox: breckognize: what version of chef, and how is it installed?
[2012-12-03 15:21:42 -0500] spox: 10.12 omnibus version had some speed issues around loading of rubygems
[2012-12-03 15:21:48 -0500] paulmooring: breckognize: if you did a gem install you might have a whole lot of overhead in the start up
[2012-12-03 15:21:58 -0500] paulmooring: also what spox said
[2012-12-03 15:22:13 -0500] breckognize: 10.16.2
[2012-12-03 15:22:36 -0500] breckognize: Yes - it probably was gem installed
[2012-12-03 15:22:59 -0500] paulmooring: breckognize: if it's a problem try using the fullstack installer http://www.opscode.com/chef/install
[2012-12-03 15:23:13 -0500] paulmooring: it will install chef under /opt with it's own ruby/gems
[2012-12-03 15:23:14 -0500] breckognize: This is probably good enough reason just to switch to hosted chef
[2012-12-03 15:23:31 -0500] breckognize: (also: this is on windows)
[2012-12-03 15:23:56 -0500] paulmooring: double ah-ha there's a few more variables that could explain it
[2012-12-03 15:24:14 -0500] paulmooring: on windows I would really really recomend using the aforementioned installer
[2012-12-03 15:24:28 -0500] breckognize: (Linux server, windows client)
[2012-12-03 15:36:35 -0500] Guest19332: I want to create a recipe that do a file transfer. What resources/action I need to do this
[2012-12-03 15:37:00 -0500] Guest19332: when I look at the file docs, there's delete and create but there's nothing about copy/move
[2012-12-03 15:38:20 -0500] masterkorp: Remote_file
[2012-12-03 15:43:12 -0500] zeroXten: The following should work right? search(:node, "role\\[bleh\\] AND chef_environment:#{node.chef_environment}")
[2012-12-03 15:43:23 -0500] Virunga: Hi, is remote_file resource only for http? Because i'm trying to download a file from a ftp server but it fails.
[2012-12-03 15:43:59 -0500] yfeldblum: zeroXten, no
[2012-12-03 15:44:20 -0500] zeroXten: ah. That would explain it then ;( What should I do instead?
[2012-12-03 15:45:20 -0500] yfeldblum: zeroXten, as background, you want to become familiar with the lucene query language, since that's what chef's search basically is (there are a couple chef-specific extensions)
[2012-12-03 15:45:52 -0500] yfeldblum: zeroXten, an example query might be "role:bleh AND chef_environment:qa"
[2012-12-03 15:47:33 -0500] zeroXten: ahhh, feck. I forgot my "run_list:"
[2012-12-03 15:47:39 -0500] zeroXten: *sigh*
[2012-12-03 15:48:58 -0500] yfeldblum: zeroXten, the "role" and "recipe" keys are taken directly from the run_list, so they may be simpler to use and have the same query
[2012-12-03 15:50:11 -0500] zeroXten: ah wait, I am doing that elsewhere, so I do also have search(:node, "run_list:role\\[bleh\\] AND chef_environment:#{node.chef_environment}") which doesn't seem to be working either
[2012-12-03 15:51:34 -0500] zeroXten: and basic use of 'role\[bleh\]' has been working elsewhere as per the wiki
[2012-12-03 15:54:13 -0500] rb2k: weird. I have chef running "Processing chef_gem[mysql] action install (mysql::ruby line 36)"
[2012-12-03 15:54:18 -0500] rb2k: before build-essential is installed
[2012-12-03 15:54:30 -0500] rb2k: although I add the build-essential script beforehand in the vagrant file
[2012-12-03 15:54:47 -0500] rb2k: that fails because mysql::ruby needs make
[2012-12-03 15:54:53 -0500] rb2k: any ideas on how to change that ordering?
[2012-12-03 15:55:41 -0500] spox: build essential cookbook has a compile time install flag that needs to be turned on where required by chef_gem
[2012-12-03 15:56:08 -0500] yfeldblum: rb2k, one option is install build-essential during bootstrap; another option is install build-essential at recipe runtime ("compile time")
[2012-12-03 15:56:36 -0500] rb2k: yfeldblum: is this a bug in one of the recipes?
[2012-12-03 15:57:58 -0500] rb2k: spox: thanks, that should solve it!
[2012-12-03 16:00:20 -0500] zeroXten: bleh, I'll just try role:bleh instead
[2012-12-03 16:02:28 -0500] yfeldblum: zeroXten, that's the ideal
[2012-12-03 16:03:12 -0500] zeroXten: k, will see if it helps
[2012-12-03 16:07:30 -0500] Virunga: Is there a resource to get a file from a ftp server?
[2012-12-03 16:16:56 -0500] Gil_: So I'm using atlassian bamboo to build projects and save the output to a shared directory in our servers. Now im trying to create a cookbook to move the files from the share directory to the deploy directory. Im wondering what resources I need to use ?
[2012-12-03 16:28:15 -0500] Gil_: should I use fileutils to move files in recipes  (new to chef)
[2012-12-03 16:29:20 -0500] bougyman: is there a defined order that delayed actions will get run in?
[2012-12-03 16:29:22 -0500] masterkorp: Either that or a bash resource
[2012-12-03 16:29:25 -0500] bougyman: determined, i guess I mean.
[2012-12-03 16:29:49 -0500] masterkorp: bougyman: i think the ones that are queued first and run first
[2012-12-03 16:29:53 -0500] bougyman: it seems some of my delayed actions change order on different runs.
[2012-12-03 16:29:56 -0500] masterkorp: not sure ture
[2012-12-03 16:30:02 -0500] bougyman: feels like a race condition.
[2012-12-03 16:30:29 -0500] bougyman: can you do something to guarantee order, then?
[2012-12-03 16:30:31 -0500] bougyman: er can I
[2012-12-03 16:32:10 -0500] yfeldblum: bougyman, can you confirm that?
[2012-12-03 16:32:12 -0500] masterkorp: no idea, would like to know too
[2012-12-03 16:32:28 -0500] bougyman: yfeldblum: will try
[2012-12-03 16:32:45 -0500] bougyman: i still haven't figured how to properly step through a run in shef, i get failcity
[2012-12-03 16:33:04 -0500] bougyman: there was a bug where attributes weren't loading in shef on a run last time i trie.
[2012-12-03 17:00:49 -0500] bmcgee: Hi guys, is it possible to have a command executed every time a given service is restarted
[2012-12-03 17:05:01 -0500] spox: bmcgee: use a subscribes statement within the execute resource
[2012-12-03 17:07:13 -0500] yfeldblum: spox, that will trigger the command every time something about the service was changed, not just every time it's restarted
[2012-12-03 17:07:41 -0500] spox: oh, sorry
[2012-12-03 17:07:44 -0500] spox: notifies!
[2012-12-03 17:08:16 -0500] flowersj: is this a problem with shell out on windows?
[2012-12-03 17:08:17 -0500] flowersj: https://gist.github.com/4196398
[2012-12-03 17:08:58 -0500] yfeldblum: spox, same deal
[2012-12-03 17:09:36 -0500] flowersj: I don't get an error there when I execute from a mac osx box...
[2012-12-03 17:15:17 -0500] bmcgee: :spox I want to kick of a command every time the reload-iptables command i executed
[2012-12-03 17:15:38 -0500] bmcgee: would that look like subscribes :run, .?
[2012-12-03 17:15:54 -0500] spox: the reload-iptables is just an execute resource, yeah?
[2012-12-03 17:16:03 -0500] bmcgee: yeah
[2012-12-03 17:16:36 -0500] spox: execute 'do my thing' { command '/bin/true'; action :nothing; subscribes :run, "execute[reload-iptables]"; }
[2012-12-03 17:16:41 -0500] bmcgee: thx
[2012-12-03 17:16:46 -0500] spox: perhaps an :immediately in there if desired
[2012-12-03 17:17:03 -0500] bmcgee: what's the diff?
[2012-12-03 17:58:21 -0500] Virunga: with immediately runs the resource immediately :D
[2012-12-03 17:58:40 -0500] Virunga: Is there a resource to get a file from a ftp server?
[2012-12-03 18:00:35 -0500] jtimberman: Virunga: remote_file should be able to take the ftp:// URI
[2012-12-03 18:00:39 -0500] jtimberman: as the source
[2012-12-03 18:01:21 -0500] dysinger: Is there any easy way to over-ride the way chef-client reports node name in chef server without messing up hostname & automatic ohai data ?
[2012-12-03 18:01:46 -0500] dysinger: client has a specific way they want to look at nodes via their ec2 env & instance ID
[2012-12-03 18:04:38 -0500] Virunga: jtimberman: i tried to use that but i get an error because it attempts to use the http protocol. I'm trying to replicate the error now, so i can paste it.
[2012-12-03 18:05:30 -0500] jtimberman: dysinger: you can use -N option for chef-client, or set node_name in /etc/chef/client.rb
[2012-12-03 18:05:54 -0500] dysinger: well, derp, that's easy
[2012-12-03 18:05:58 -0500] dysinger: thanks jtimberman
[2012-12-03 18:06:02 -0500] mattupstate: anyone getting zombie processes when running ohai?
[2012-12-03 18:07:03 -0500] mattupstate: i'm experiencing the same thing as this person http://tickets.opscode.com/browse/OHAI-86?focusedCommentId=28119&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-28119
[2012-12-03 18:09:13 -0500] chadwick: erlang peeps - is anyone dealing with a cookbook variant that grabs erlang from erlang solutions instead of a distro package?
[2012-12-03 18:09:34 -0500] jtimberman: chadwick: do they make it available as a package through a public repository?
[2012-12-03 18:09:40 -0500] chadwick: yep
[2012-12-03 18:10:00 -0500] chadwick: it's easy to do, but seems to have a lot of cascading effects (like rabbitmq not liking it with their default packages etc)
[2012-12-03 18:10:11 -0500] Virunga: The protocol should be ftp but it uses http i think, given the error http://ideone.com/AZJMo3
[2012-12-03 18:13:55 -0500] dysinger: jtimberman: is it possible to incorporate ohai data in the node name (like ec2 instance id) you think?
[2012-12-03 18:14:04 -0500] dysinger: (in /etc/chef/client.rb)
[2012-12-03 18:14:16 -0500] jtimberman: dysinger: totally!
[2012-12-03 18:14:30 -0500] dysinger: so  much  win  can't  take  it
[2012-12-03 18:16:30 -0500] yfeldblum: dysinger, /tec/chef/client.rb is normally loaded before ohai runs
[2012-12-03 18:16:46 -0500] jtimberman: dysinger: https://gist.github.com/4196830
[2012-12-03 18:16:59 -0500] dysinger: ok
[2012-12-03 18:17:14 -0500] jtimberman: you can control the plugins that are loaded, too.
[2012-12-03 18:17:16 -0500] yfeldblum: dysinger, but, as in jtimberman's example, you could run your own ohai from within client.rb if you like, and use the result of that in your client.rb
[2012-12-03 18:17:19 -0500] jtimberman: like, load specific plugins
[2012-12-03 18:17:25 -0500] jtimberman: so that it loads faster.
[2012-12-03 18:19:15 -0500] dysinger: If I needed faster, I wouldn't use ruby :P (ducks)
[2012-12-03 18:20:57 -0500] jtimberman: True story.
[2012-12-03 18:21:02 -0500] jtimberman: ohai's just running commands tho
[2012-12-03 18:21:04 -0500] jtimberman: mostly
[2012-12-03 18:21:19 -0500] Virunga: jtimberman: looking the code of remote_file provider and the error i get seems it's only for http
[2012-12-03 18:44:52 -0500] kallen_: wUUp
[2012-12-03 18:45:04 -0500] kallen_: full of mischan lately :\
[2012-12-03 18:45:10 -0500] miah: hi
[2012-12-03 18:50:42 -0500] flowersj: anyone know what I am doing wrong with this Dir.glob example: https://gist.github.com/4197055
[2012-12-03 18:53:57 -0500] qhartman: flowersj, needs a .each
[2012-12-03 18:54:11 -0500] flowersj: Doh
[2012-12-03 18:54:16 -0500] flowersj: thank you!
[2012-12-03 18:54:22 -0500] qhartman: np
[2012-12-03 19:02:00 -0500] btm: Live @opscode Ohai code review begins shortly, join: http://bit.ly/VgP6zX or watch: http://youtu.be/Ol-x4Al2KsU
[2012-12-03 19:12:28 -0500] Virunga: Cool, i never assisted to a thing like this
[2012-12-03 19:12:43 -0500] Virunga: Code review...
[2012-12-03 19:15:36 -0500] Virunga: btm: are you a bot?
[2012-12-03 19:15:48 -0500] btm: Virunga: negative, I'm a lumberjack.
[2012-12-03 19:16:13 -0500] Virunga: btm: on yt the code is too small, could you do something about it?
[2012-12-03 19:16:33 -0500] dysinger: lol
[2012-12-03 19:19:29 -0500] miah: http://www.youtube.com/watch?v=mL7n5mEmXJo
[2012-12-03 19:19:42 -0500] miah: ^- btm
[2012-12-03 19:20:32 -0500] Virunga: It's a shame
[2012-12-03 19:20:59 -0500] kvad_: hey guys im having an issue with a new chef server install. I built it like I always do but this time it will not start couch is running and belive my server.rb file looks good my problem is there is no error to what is going on. I'm on 12.04 ubuntu if anyone is interested I can paste my configs it has to be something im over looking.
[2012-12-03 19:21:12 -0500] btm: miah: I'm not sure I should open a youtube link while broadcasting a google hang out.
[2012-12-03 19:21:38 -0500] mjreed: ok, how can I create resources from within a ruby block?
[2012-12-03 19:21:45 -0500] miah: btm: ya. probably not. =)
[2012-12-03 19:21:53 -0500] btm: Virunga: we're limited by the google hangout technology for the screen share. it's best to open up your own browser window
[2012-12-03 19:21:58 -0500] miah: its just Monty Python singing your lumberjack song
[2012-12-03 19:22:52 -0500] miah: im not sure i would create a resource _inside_ a ruby_block. but i might use the results of a ruby_block when creating a resource.
[2012-12-03 19:23:12 -0500] miah: i try to keep all ruby_block's in libraries/default.rb
[2012-12-03 19:23:20 -0500] miah: as just standard method definitions
[2012-12-03 19:23:35 -0500] mjreed: the body of a ruby block doesn't get executed until runtime...
[2012-12-03 19:23:50 -0500] mjreed: I'd like to append resources to the run context from it.
[2012-12-03 19:24:49 -0500] miah: Ruby code in ruby_block resources is evaluated with other resources during convergence, whereas Ruby code outside ruby_block resources is evaluated before other resources, during recipe evaluation (compilation).
[2012-12-03 19:24:57 -0500] mjreed: right.
[2012-12-03 19:25:02 -0500] mjreed: so during convergence
[2012-12-03 19:25:13 -0500] mjreed: I want to add more resources to be evaluated
[2012-12-03 19:25:18 -0500] mjreed: as part of that same convergence phase
[2012-12-03 19:25:24 -0500] Virunga: But a resource need to be compiled first
[2012-12-03 19:25:24 -0500] miah: http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run
[2012-12-03 19:25:37 -0500] miah: it happens during the 'load resources' phase
[2012-12-03 19:26:10 -0500] anax_: Anyone have some comments on how the run list is evaluated? I'm seeing some expansion that I don't know how to control properly.
[2012-12-03 19:26:15 -0500] anax_: For example:
[2012-12-03 19:26:27 -0500] anax_: Run List expands to [logrotate, git, motd-tail ]
[2012-12-03 19:26:30 -0500] anax_: INFO: Loading cookbooks [git, logrotate, motd-tail, runit, yum]
[2012-12-03 19:26:37 -0500] miah: mjreed: what are you doing exactly? here is how i handle something that i think might be similar: https://github.com/miah/chef-graphite/blob/lwrp/recipes/_carbon_cache_runit.rb
[2012-12-03 19:27:05 -0500] miah: and lookup_resources is here: https://github.com/miah/chef-graphite/blob/lwrp/libraries/default.rb
[2012-12-03 19:27:06 -0500] rafaelmagu: Has anyone here written any scripts to help with spawning AWS instances using the ec2 cli tools?
[2012-12-03 19:27:24 -0500] rafaelmagu: I can't really use knife-ec2 for spawning an instance and then attaching an IP address to it
[2012-12-03 19:28:25 -0500] mjreed: @miah - cleanup recipe that removes users from the system who shouldn't be there.  Needs to exclude any users an earlier recipe has created, but if the earlier recipe did so via LWRP, the user resources won't be in the resource collection yet.  Hence the ruby block.
[2012-12-03 19:28:56 -0500] miah: ya
[2012-12-03 19:29:07 -0500] miah: so look at my codes i pasted. its pretty similar.
[2012-12-03 19:29:21 -0500] miah: just make sure all users are created using the same user resource
[2012-12-03 19:29:36 -0500] miah: and you can query to see what chef knows about. then diff against your list of users.
[2012-12-03 19:30:07 -0500] makmanalp: let's say I have a provider that runs an executable, but the executable needs a path to a config file, which is defined in the recipe. Can I just access the recipe?
[2012-12-03 19:30:29 -0500] makmanalp: In hindsight, I should just frickin try it, never mind
[2012-12-03 19:30:39 -0500] barnacles: anax_: git (atleast the community one) depends on some other cookbooks. Even though you specify a smaller run list, it's expanded to include what you actually need. https://github.com/opscode-cookbooks/git/blob/master/metadata.rb
[2012-12-03 19:30:43 -0500] mjreed: yeah, that all works.  as I said, the issue is that if the user resource is inside an LWRP, it won't be part of the collection yet during compilation of the cleanup recipe.
[2012-12-03 19:31:12 -0500] mjreed: to ensure that it doesn't run until those resources are in the collection, I use a ruby block
[2012-12-03 19:31:25 -0500] mjreed: but then that ruby block can't itself add new resources to the collection to be run after itself.  at least, not easily.
[2012-12-03 19:31:43 -0500] miah: right. don't use ruby_block.
[2012-12-03 19:32:30 -0500] mjreed: so without a ruby_block, how do I delay the running of the code until convergence time?
[2012-12-03 19:33:09 -0500] miah: look at my links?
[2012-12-03 19:33:37 -0500] mjreed: I did.  I see you looking in the resource collection at compile time.
[2012-12-03 19:34:18 -0500] miah: which should be all resources created at the time that code executes
[2012-12-03 19:34:23 -0500] mjreed: right.
[2012-12-03 19:34:29 -0500] mjreed: including LWRPs.
[2012-12-03 19:34:32 -0500] miah: exactly
[2012-12-03 19:34:35 -0500] mjreed: but NOT including any resource created BY the LWRPs.
[2012-12-03 19:34:43 -0500] miah: my resources are created by lwrp
[2012-12-03 19:34:57 -0500] miah: in the same cookbook infact
[2012-12-03 19:35:15 -0500] miah: just have to make sure your resources are created earlier
[2012-12-03 19:35:34 -0500] mjreed: Hm.
[2012-12-03 19:35:44 -0500] mjreed: I thought resources in an LWRP weren't created until convergence time..
[2012-12-03 19:36:52 -0500] jtimberman: fyi: http://bit.ly/kitchen070
[2012-12-03 19:38:56 -0500] miah: jtimberman: awesome
[2012-12-03 19:47:59 -0500] jtimberman: miah: :D
[2012-12-03 20:05:00 -0500] btm: Live @opscode cookbook code review begins now: join: http://bit.ly/TDRNP1, watch:  http://youtu.be/6KFxJk2i3Ms
[2012-12-03 20:12:00 -0500] Virunga: I have this warning http://ideone.com/2dPMI3 the one that talk about the compatibility issue of node['cb']['att'] = '...'
[2012-12-03 20:12:25 -0500] Virunga: But i can't figure it out where's the blamed code
[2012-12-03 20:13:25 -0500] Virunga: the code that do that thing
[2012-12-03 20:14:02 -0500] Virunga: Could you help me, please?
[2012-12-03 20:19:09 -0500] jroberts: Virunga:  That is a Warning not and Exception
[2012-12-03 20:22:19 -0500] jordane: Virunga: grep -r 'node\[\'cb\'\]\[\'att\'\]' /root/of/cookbooks
[2012-12-03 20:34:04 -0500] auduny: The server certificate keys, where are they used?
[2012-12-03 20:34:38 -0500] barnacles: jordane: you can you grep -Fr "node['cb']['att']" as well :)
[2012-12-03 20:34:40 -0500] auduny: Med with bootstrap
[2012-12-03 20:38:39 -0500] Virunga: jordane: the fact is i don't know the cookbook with the incriminated code!
[2012-12-03 20:39:34 -0500] Virunga: The report say nothing other than what's shown
[2012-12-03 20:40:23 -0500] barnacles: then go up one directory and grep from there.
[2012-12-03 20:40:41 -0500] barnacles: Virunga: you're not getting an error or anything, it's just a warning
[2012-12-03 20:41:53 -0500] auduny: Anyone migrated from one chef-server to another?
[2012-12-03 20:41:55 -0500] Virunga: barnacles: i tried wiht grep but nothing worth jump out. But that warning shouldn't be shown when there's that problem somewhere in the code?
[2012-12-03 20:45:34 -0500] jordane: Virunga: you can also run chef with the debug flag and look at the last cookbook loaded before the warning is given. That'll be the one that generates the warning.
[2012-12-03 20:45:44 -0500] jordane: turning on debug is a firehose of output though.
[2012-12-03 20:45:59 -0500] jordane: barnacles: but..but..I like my backslashes! :P
[2012-12-03 20:46:08 -0500] Virunga: jordane: i tried... I'll try again, thanks.
[2012-12-03 20:46:49 -0500] jordane: Virunga: if you run it with debug and verbose and paste the output somewhere I can help you more specifically.
[2012-12-03 20:47:17 -0500] Virunga: jordane: cool thanks, i'll do it right away.
[2012-12-03 20:49:03 -0500] Virunga: jordane: is it ok just the debug mode? I can't find the option for the more verbose mode.
[2012-12-03 20:49:08 -0500] Virunga: for chef-client
[2012-12-03 20:49:22 -0500] jordane: Virunga: yeah, debug should have it.
[2012-12-03 20:49:46 -0500] jordane: Virunga: verbose is just --verbose, or -V
[2012-12-03 20:50:02 -0500] Virunga: Ok
[2012-12-03 20:50:15 -0500] jordane: debug is -l (--log-level) debug
[2012-12-03 20:52:54 -0500] Virunga: jordane: here it is. http://pastebin.com/VimkyjCR
[2012-12-03 20:54:08 -0500] Virunga: jordane: i think it isn't the last ran recipe because the problem there was before i put the last recipe you can see.
[2012-12-03 20:55:00 -0500] jordane: Virunga: the issue is in your gmap recipe.
[2012-12-03 20:55:39 -0500] Virunga: jordane: i just created that recipe, and the warning there was before i added that recipe to the run list.
[2012-12-03 20:56:02 -0500] Virunga: If take off that recipe the problem will persists, i tried.
[2012-12-03 20:56:13 -0500] jordane: Virunga: then you most likely are using the same syntax in multiple cookbooks.
[2012-12-03 20:56:30 -0500] kaerast: auduny, migrating to a new chef server is pretty simple - it's pretty similar to the docs for migrating to hosted chef: http://docs.opscode.com/chef/migrate_to_hosted.html
[2012-12-03 20:56:55 -0500] Virunga: jordane: maybe :D . I write node.default.gmap.attribute_name = .... , is it ok?
[2012-12-03 20:57:17 -0500] jordane: Virunga: no, that is what the warning is telling you.
[2012-12-03 20:57:50 -0500] Virunga: jordane: but i'm using defualt, what's wrong with it (sorry) ?
[2012-12-03 20:57:55 -0500] jordane: Virunga: do node.set["key"] = value, instead of node.key = value
[2012-12-03 20:58:25 -0500] terbeaux: hello everybody
[2012-12-03 20:59:00 -0500] kaerast: auduny, main thing to be aware of is you'll lose your Chef search data until chef-client runs. This may cause cookbooks to fail temporarily if you use search in recipes
[2012-12-03 21:00:09 -0500] Virunga: jordane: so i have to do node.default["cb"]["att"] = ... instead of node.default.cb.att = ... ?
[2012-12-03 21:00:34 -0500] jordane: Virunga: no. set up there is literal. You literally type set.
[2012-12-03 21:00:44 -0500] jordane: it is a method called on the node.
[2012-12-03 21:00:59 -0500] auduny: kaerast: SO i shoulden follow this? http://wiki.opscode.com/display/chef/Backing+Up+Chef+Server?
[2012-12-03 21:01:17 -0500] auduny: I wonder by the knife exec stuff there did not take into account clients, just nodes and roles.
[2012-12-03 21:02:18 -0500] Virunga: jordane: but with that method i set the normal attribute, right? I want to set the default attribute.
[2012-12-03 21:02:49 -0500] kaerast: auduny, yeah so migrating the clients is done with bootstrap - http://docs.opscode.com/chef/migrate_to_hosted.html#register-nodes-with-chef-hosted
[2012-12-03 21:03:47 -0500] auduny: kaerast: So I can't move the certs and just keep the clients?
[2012-12-03 21:03:55 -0500] auduny: I have 140 chef-clients.
[2012-12-03 21:03:55 -0500] jordane: Virunga: you can use node.set['default']['key'], iirc.
[2012-12-03 21:04:16 -0500] jordane: I might be wrong on that one though.
[2012-12-03 21:04:31 -0500] kaerast: auduny, good question - I don't know
[2012-12-03 21:04:47 -0500] auduny: I did manage allmost to get everthing to work. chef-server was working. But not chef-server-webui for some strange reason. Tried to start it and it compalined about admin not beeing part of an object or something.
[2012-12-03 21:05:02 -0500] auduny: Bu It did work before the migration.
[2012-12-03 21:05:05 -0500] auduny: Knife worked nicely
[2012-12-03 21:05:19 -0500] Virunga: jordane: i think the first key is the name of the cookbook and the second the name of the attribute you want to set.
[2012-12-03 21:05:37 -0500] jordane: Virunga: ah, apparently that does set the normal value..
[2012-12-03 21:06:28 -0500] terbeaux: How can I facilitate merging a resolved issue? http://tickets.opscode.com/browse/COOK-1539
[2012-12-03 21:06:41 -0500] Virunga: jordane: yeah. If the syntax i'm using isn't deprecated should be correct.
[2012-12-03 21:07:17 -0500] Virunga: jordane: node.type_of_attribute.name_of_cookbook.name_of_attribute = ...
[2012-12-03 21:07:20 -0500] kaerast: auduny, if knife was fully working then the chef-server-webui failing is unlikely to be related to clients (I think)
[2012-12-03 21:07:37 -0500] jordane: Virunga: yeah, not sure what the plan is for that.
[2012-12-03 21:08:15 -0500] Virunga: jordane: yeah, i'll check the doc
[2012-12-03 21:08:25 -0500] Virunga: jordane: thanks for you support.
[2012-12-03 21:09:21 -0500] jordane: Virunga: np, sorry I couldn't help more.
[2012-12-03 21:09:32 -0500] Virunga: ;)
[2012-12-03 21:23:54 -0500] auduny: kaerast: Ok. I tried my old method again. Moved chef.couch checksum and ca-certs.
[2012-12-03 21:23:58 -0500] auduny: Rebuilded index.
[2012-12-03 21:24:08 -0500] auduny: And everything works. Except the webuid.
[2012-12-03 21:24:18 -0500] auduny: Trying to start it it says:
[2012-12-03 21:24:19 -0500] auduny: root@vg-chef-01:/etc/chef$ chef-server-webui  -C /etc/chef/webui.rb -L /var/log/chef/server-webui.log -p 4040 -e production -a thin -u chef -G chefMerb root at: /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-server-webui-10.16.2 ~ No Gemfile found! If you're generating new app with merb-gen this is fine, otherwise run: bundle init to create Gemfile
[2012-12-03 21:24:24 -0500] auduny: Loading init file from ./config/init.rb
[2012-12-03 21:24:26 -0500] auduny: That was not on purpse
[2012-12-03 21:24:28 -0500] auduny: Ups.
[2012-12-03 21:24:55 -0500] auduny: http://pastebin.com/EHQtjz0j
[2012-12-03 21:25:00 -0500] auduny: That was what I was supposed to paste.
[2012-12-03 21:27:09 -0500] kaerast: I wonder if that's because there's no admin certificate, I've done very little with the webui so I'm not sure I can help you here
[2012-12-03 21:28:13 -0500] auduny: But since knife is working perfectly.. Isn't the webinterface using sort of the same type of ceret?
[2012-12-03 22:19:12 -0500] dyer: Ohai Chefs, quick question if anyone is available.  I have some arbitrary data I need to store in some of my cookbooks.  This will be used by some scripts we use as part of our release process.  I would love to store it in the metadata.rb file but it looks like it doesnt like random keys :)   I am thinking about defining some attributes and using those to store these values but I am concerned if that would have any unintended implications
[2012-12-03 22:20:19 -0500] yfeldblum: dyer, cookbooks are code, not data
[2012-12-03 22:21:43 -0500] yfeldblum: dyer, sometimes code needs to have seed data in it, or default but overridable configuration data, or just hardcoded configuration data in it; but you can deal with that data in the context of it being embedded somehow in code
[2012-12-03 22:24:49 -0500] jwcarman: Does anyone have any good documentation about how you go about doing releases and versioning with chef cookbooks?
[2012-12-03 22:24:50 -0500] dyer: ok, but this not really part of the cookbook.  Let me try and explain a ltitle bit better.. .   So this cookbook I am writing is intended to be used in this deployment model we have, and I want to simply mention that in the metadata.rb.  We also use Chef-Solo, and as such I want to package this cookbook up to the correct s3 bucket for the deployment model, so I was hoping to store that in the metadata.rb file as well.   This is kinda what I was thinking (
[2012-12-03 22:24:51 -0500] dyer:  https://gist.github.com/bcdca599330167b25d4f )
[2012-12-03 22:25:04 -0500] jwcarman: I've seen this "thor" stuff.  Is that what folks are using?
[2012-12-03 22:25:24 -0500] dyer: jwcarman, I am using thor
[2012-12-03 22:25:28 -0500] dyer: and berkshefl
[2012-12-03 22:25:39 -0500] dyer: s/berkshefl/berkshelf
[2012-12-03 22:25:57 -0500] jwcarman: dyer: is that the "norm" for the community?  I've put together an example project using berkshelf (it has thor enabled, but I don't know how to use it).
[2012-12-03 22:26:34 -0500] yfeldblum: dyer, you can put that in an attributes file (my_cookbook/attributes/default.rb)
[2012-12-03 22:27:02 -0500] dyer: jwcarman, this is my "work in progress" for using Thor to package cookbooks for use in Chef-Solo -> http://bit.ly/VhjgDj
[2012-12-03 22:27:42 -0500] jwcarman: dyer: thanks for that.  Bookmarking now
[2012-12-03 22:27:46 -0500] dyer: hope it can help
[2012-12-03 22:28:32 -0500] jwcarman: dyer: There's nothing pre-built that does "releases"?
[2012-12-03 22:28:33 -0500] dyer: in short, all I wanted to do there was package the current cookbook, along w/ all its dependencies ,into a tar.gz and then upload to s3
[2012-12-03 22:28:36 -0500] jwcarman: You have to do it manually?
[2012-12-03 22:28:45 -0500] yfeldblum: jwcarman, thor is a multipurpose toolkit; it has support for making CLIs, among other things
[2012-12-03 22:29:34 -0500] dyer: jwcarman, not really that I am aware of sounds like we are kind of working thru the same problems as you are ( defining workflow )
[2012-12-03 22:29:34 -0500] jwcarman: yfeldblum: okay, cool.  Just learning my way around the ruby landscape.  Getting an idea of what the best practices are.  Any suggestions on good sites to use to catch up on stuff like that?
[2012-12-03 22:29:50 -0500] jwcarman: dyer: hopefully we're not working for the same company! :)
[2012-12-03 22:30:03 -0500] jwcarman: I doubt it, we don't use s3
[2012-12-03 22:30:24 -0500] dyer: :)
[2012-12-03 22:31:00 -0500] dyer: jwcarman: http://vialstudios.com/guide-authoring-cookbooks.html
[2012-12-03 22:31:27 -0500] jwcarman: I've seen that.  That's how I put my example together
[2012-12-03 22:31:28 -0500] dyer: yfeldblum, question.. how can I access those attibributes in thor ?
[2012-12-03 22:31:35 -0500] dyer: jwcarman, cool
[2012-12-03 22:31:43 -0500] jwcarman: https://github.com/jwcarman/chef-ntp
[2012-12-03 22:31:47 -0500] yfeldblum: dyer, that's the wrong way around
[2012-12-03 22:32:02 -0500] dyer: Also I think this episode of the foodfight show has some links / discussions on workflow
[2012-12-03 22:32:16 -0500] yfeldblum: dyer, you can set it in thor, and then e.g. add that to a node attributes file when packaging
[2012-12-03 22:32:18 -0500] dyer: I havn't finished the episode, been to busy, but it might be worth checking out
[2012-12-03 22:33:27 -0500] yfeldblum: jwcarman, if you're interested in ruby, write everyday utilitarian scripts and tools in ruby; you will naturally run into various problems, and you will then have an immediate reason to search the tubes and learn more about the particular subject
[2012-12-03 22:33:43 -0500] dyer: yfeldblum, I am trying to make a thor task for my team which will bundle cookbooks to the right place.  It should get some facts from the current cookbook, such as the name and version ( metadata.rb ) and then some other stuff, such as the "deployment_model" and the "cookbook_site"
[2012-12-03 22:34:05 -0500] dyer: I am trying to figure out where best to put those second two values so I can have one "tool" to help my team
[2012-12-03 22:34:11 -0500] jwcarman: yfeldblum: I've tinkered with ruby through the years.  Typically when I run into a scripting issue, I try to use ruby to solve it.  It's just easier than Java for that.
[2012-12-03 22:34:18 -0500] yfeldblum: dyer, in the thor script
[2012-12-03 22:34:25 -0500] yfeldblum: jwcarman, :D
[2012-12-03 22:34:28 -0500] dyer: ok, but the thor script spans all cookbooks
[2012-12-03 22:34:32 -0500] yfeldblum: jwcarman, scripting java ...
[2012-12-03 22:34:56 -0500] dyer: My goal is to not have to package this script with each cookbook
[2012-12-03 22:35:06 -0500] dyer: I want to install it on the system and have it read the data from the cookbooks
[2012-12-03 22:35:52 -0500] yfeldblum: dyer, the problem, of course, is that cookbooks are code, not data; you need to put data into somewhere that is data, and then pass data from the thing that has it to the thing that needs it
[2012-12-03 22:36:12 -0500] dyer: ok, and as u suggested I could put that in the attributes/default.rb
[2012-12-03 22:36:13 -0500] jwcarman: yfeldblum: Yeah, kind of funny.  There are some things I can just do faster in java, since I've been doing it for like 15 years or so.  But, I try to use ruby when I can.
[2012-12-03 22:37:04 -0500] jwcarman: Anyway, this is a chef forum.  I need to learn chef the "right way."  I want to understand what the general ideas are for best practices among the community.
[2012-12-03 22:37:28 -0500] yfeldblum: jwcarman, the standard tool for parsing command-line options is optparse, which is stdlib; thor is another tool; opscode has their own called mixlib-cli; and there are plenty more besides
[2012-12-03 22:37:30 -0500] jwcarman: I have seen that folks seem to be shying away from using roles, instead opting to use cookbooks instead
[2012-12-03 22:37:48 -0500] yfeldblum: jwcarman, for scripting, u familiar with Pathname?
[2012-12-03 22:38:05 -0500] jwcarman: Nope, will be after a quick Google though! :)
[2012-12-03 22:39:48 -0500] dyer: yfeldblum, so would putting it in the attributes/default.rb not work ?
[2012-12-03 22:40:26 -0500] yfeldblum: dyer, no, because that's not a database; it's code, where it is possible for you to hardcode data in it as code, but you can't really treat it as a database
[2012-12-03 22:41:07 -0500] dyer: attribute files are not core, they are a key value store
[2012-12-03 22:41:14 -0500] dyer: seems like thats what I am after, no ?
[2012-12-03 22:42:01 -0500] yfeldblum: dyer, attributes files are code, not a key-value store
[2012-12-03 22:42:18 -0500] yfeldblum: dyer, roles, environments, and data-bag items are data
[2012-12-03 22:42:42 -0500] jwcarman: I guess my main concern is about how folks go about writing "good" cookbooks.
[2012-12-03 22:43:18 -0500] jwcarman: I can see that you'd want to "expose" as many configurable properties as possible so that folks can tweak stuff by laying their cookbooks on top of yours
[2012-12-03 22:43:35 -0500] jwcarman: That seems to be a best practice
[2012-12-03 22:43:51 -0500] jwcarman: Berkshelf seems to be a pretty popular option, too
[2012-12-03 22:43:55 -0500] makmanalp: question: I have a lwrp that is creating a template in cookbook A. If I try to call it from cookbook B, it searches for the template source in cookbook B's path. How do I fix this?
[2012-12-03 22:44:40 -0500] yfeldblum: jwcarman, or librarian-chef ... must plug it, since i'm the author :D
[2012-12-03 22:45:10 -0500] yfeldblum: makmanalp, set the "cookbook" attribute of the template resource to "cookbookA"
[2012-12-03 22:45:19 -0500] jwcarman: yfeldblum: I've heard librarian too.  Sounds like a popular choice.
[2012-12-03 22:45:31 -0500] dyer: yfeldblum, I need a place to store two key value pairs inside that cookbook itself.  Surely there is a sane place to store these
[2012-12-03 22:45:38 -0500] jwcarman: yfeldblum: do berkshelf and librarian "compete", or does berkshelf build upon librarian?
[2012-12-03 22:45:40 -0500] yfeldblum: dyer, no
[2012-12-03 22:45:54 -0500] yfeldblum: jwcarman, friendly competition, i suppose
[2012-12-03 22:46:14 -0500] jwcarman: yfeldblum, so who's winning? ;)
[2012-12-03 22:46:16 -0500] yfeldblum: jwcarman, the feature-sets differ
[2012-12-03 22:46:31 -0500] dyer: guess I'll put them in a dot file then
[2012-12-03 22:46:32 -0500] jwcarman: yfeldblum: gotcha
[2012-12-03 22:46:56 -0500] yfeldblum: jwcarman, we all are, because we have a variety, choices, and the competitors get to learn from each other and produce even better things
[2012-12-03 22:47:14 -0500] yfeldblum: jwcarman, :D
[2012-12-03 22:47:34 -0500] yfeldblum: dyer, you can
[2012-12-03 22:47:40 -0500] jwcarman: yfeldblum: I hear that.  I'm pretty familiar with the open source model.  I've been around that block a time or two :)
[2012-12-03 22:47:57 -0500] makmanalp: yfeldblum: ahhh, thanks so much!
[2012-12-03 22:48:05 -0500] jwcarman: Hopefully I can contribute back to the ruby/chef community once I get my legs underneath me a bit more.
[2012-12-03 22:48:12 -0500] yfeldblum: jwcarman, cool
[2012-12-03 22:48:22 -0500] makmanalp: yfeldblum: One more thing that simple google does not seem to find: How do I programmatically access the current cookbook name?
[2012-12-03 22:48:37 -0500] jwcarman: What continuous integration server are folks using for chef work?
[2012-12-03 22:48:48 -0500] jwcarman: We've got Jenkins installed.
[2012-12-03 22:48:54 -0500] yfeldblum: jwcarman, well i'm in here fairly often and i'm a rubyist in addition to a chefist, so i can probably answer some of those ruby question
[2012-12-03 22:49:16 -0500] jwcarman: yfeldblum: I appreciate it!
[2012-12-03 22:49:21 -0500] yfeldblum: jwcarman, opscode is using all of our infrastructures as their CI server; increased support emails = build failure
[2012-12-03 22:49:34 -0500] yfeldblum: jwcarman, :D
[2012-12-03 22:51:18 -0500] qhartman: jwcarman, We don't really have a CI system for chef specifically either. We test the automation in our QA envs after we make changes and hope nothing breaks.
[2012-12-03 22:52:32 -0500] jwcarman: ok kids are home.  gotta take off
[2012-12-03 22:55:31 -0500] jwcarman: so, no "official" CI solution for chef-based projects?
[2012-12-03 22:55:53 -0500] jwcarman: and no real release procedures to speak of?
[2012-12-03 22:55:59 -0500] programmerq: so, quick question guys. I'm still pretty new to chef. We're using opscode's mysql cookbook. It ran great on chef-solo. I'm confused about where I put the attributes no that I'm trying to get it going on chef-server/chef-client. I tried putting the attributes (like mysql password) inside the environment file, but it doesn't seem to be picking them up.
[2012-12-03 22:56:15 -0500] programmerq: is there a place other than environments that attributes should go?
[2012-12-03 22:56:21 -0500] programmerq: environments seems like the right place.
[2012-12-03 22:56:29 -0500] qhartman: jwcarman, For "scary" changes we do cookbook revision locking to isolate important environments, but that's about it.
[2012-12-03 22:56:52 -0500] qhartman: programmerq, Depends on the attribute. It's also common (and often a good idea) to set them in roles.
[2012-12-03 22:57:00 -0500] jwcarman: You lock it in chef-server
[2012-12-03 22:57:04 -0500] qhartman: programmerq, and of course, cookbooks have default attributes as well.
[2012-12-03 22:57:40 -0500] programmerq: ah, I found what we did. the node isn't associated with the environment we wanted. will definitely look in to roles for a good place to put them.
[2012-12-03 22:57:53 -0500] qhartman: jwcarman, We don't lock it, but one could. Before we do something scary we set the cookbook version requirements in the environment to be the current version, then we bump the version, get it working, then bump the version requirements.
[2012-12-03 22:57:58 -0500] programmerq: and for our own cookbooks, we are definitely putting attributes in the cookbook.
[2012-12-03 22:58:34 -0500] jwcarman: qhartman: do you just use the metadata.rb file for specifying the version?
[2012-12-03 22:58:38 -0500] qhartman: jwcarman, in fact, I'm in the middle of doing that very process.
[2012-12-03 22:58:43 -0500] qhartman: jwcarman, yes.
[2012-12-03 22:59:34 -0500] jwcarman: qhartman: do you typically have one SCM repo per cookbook?
[2012-12-03 23:00:08 -0500] qhartman: jwcarman, no, we have one git repo for all of our chef stuff, including environments, roles, and databags.
[2012-12-03 23:00:30 -0500] qhartman: as well as the cookbooks
[2012-12-03 23:00:45 -0500] jwcarman: and that repo is basically what gets "pushed" up to the chef server?
[2012-12-03 23:00:55 -0500] qhartman: yes
[2012-12-03 23:01:00 -0500] jwcarman: Hmmmmm
[2012-12-03 23:01:22 -0500] qhartman: 'knife "blah" from file "foo"' is a command I issue often
[2012-12-03 23:01:47 -0500] jwcarman: Well, we have a rule that says we can't knife blah ourselves.  Jenkins has to do that.
[2012-12-03 23:02:08 -0500] qhartman: jwcarman, ah, well then you'll likely have to do something different
[2012-12-03 23:02:30 -0500] jwcarman: Yeah, we're trying to develop a "pipeline" that keeps things moving.
[2012-12-03 23:02:49 -0500] qhartman: We do a lot of small iterations on our automation, and for the most part I'm the only person who touches it, so that much structure would be more of a hinmdrance than a help
[2012-12-03 23:03:39 -0500] jwcarman: I would like to split them out into their own repos, so that I can set up jobs in our CI server that runs test-kitchen on the cookbooks themselves in isolation.  Then, if they pass that level of testing, they get pushed on down the line to be integrated with other folks to see what happens
[2012-12-03 23:04:08 -0500] qhartman: jwcarman, IT seems like it wouldn't be neccessary to have them in separate repos
[2012-12-03 23:04:16 -0500] qhartman: in fact, that sounds like a lot of overhead
[2012-12-03 23:04:54 -0500] jwcarman: Okay.
[2012-12-03 23:05:41 -0500] qhartman: If you have some other needs (security, for example) that are driving that, then great, but if you don't have a good reason for doing it that way, I wouldn't.
[2012-12-03 23:05:42 -0500] jwcarman: so,  you just run all of the integration right off the bat?
[2012-12-03 23:06:20 -0500] qhartman: yeah, since the integration is really where the rubber hits the road, there's not a lot of testing that can be done before that. At least, not in our environments.
[2012-12-03 23:07:03 -0500] jwcarman: we do run foodcritic up front, too, but I guess you could run that across the board
[2012-12-03 23:07:19 -0500] Lunar_Lamp: w/in 6
[2012-12-03 23:07:41 -0500] qhartman: Yeah, I would like to have a lower-impact tool in place to test that my changes don't blow up the universe, but we don't have one.
[2012-12-03 23:08:15 -0500] qhartman: Again, our QA environments are usually tolerant of a little downtime if the automation goes sideways, but even that is pretty rare anymore
[2012-12-03 23:09:11 -0500] jwcarman: So, as you're working on your local machine, what does your workflow look like?
[2012-12-03 23:09:58 -0500] jo_: is it possible to move a local directory files to another directory
[2012-12-03 23:10:15 -0500] qhartman: I write new code, commit to git as needed, and once I think it's in a good place knife up my changes.
[2012-12-03 23:10:41 -0500] jwcarman: and, qa pulls out of the chef-server to run their testing?
[2012-12-03 23:10:47 -0500] qhartman: jwcarman, once I do that I go into a loop of running chef-client, fixing problems, and knifing up updates.
[2012-12-03 23:11:03 -0500] jwcarman: no chef-solo?
[2012-12-03 23:11:16 -0500] jwcarman: no vagrant?
[2012-12-03 23:11:19 -0500] qhartman: once I get a clean run on QA, update the pinned versions in the other envs so they will start pulling the new code.
[2012-12-03 23:11:28 -0500] jo_: is it possible to move a local directory files to another directory
[2012-12-03 23:11:40 -0500] yfeldblum: jwcarman, it might be useful to write some integration tests in the form of monitoring assertions
[2012-12-03 23:12:15 -0500] yfeldblum: jwcarman, or maybe not, depending on how you roll
[2012-12-03 23:12:24 -0500] qhartman: no, no solo or vagrant. Too much of our automation relies on features not available in solo for it to be useful, and similarly with vagrant we need so much environment specific infrastrucutre in place vagrant would be more overhead than it's worth.
[2012-12-03 23:13:13 -0500] qhartman: jo_, Yes, the easiest way to do it would be to shell out to a script to make the changes you need. Perhaps in a script or command resource  block
[2012-12-03 23:14:05 -0500] qhartman: yfeldblum, jwcarman one of our informal integration tests are the output of some nagios monitoring we have in place.
[2012-12-03 23:14:18 -0500] jo_: qhartman oh thanks, the only thing is I want to keep a list of the files related to a role and I want to move them based on a role
[2012-12-03 23:14:22 -0500] qhartman: yfeldblum, jwcarman that will tell us if something went subtly sideways.
[2012-12-03 23:14:23 -0500] jwcarman: what sort of environment-specific infrastructure do you mean?  If you can share
[2012-12-03 23:14:58 -0500] jo_: qhartman how could this work if I want to use a script block
[2012-12-03 23:15:05 -0500] qhartman: jwcarman, in broad strokes, databases, DNS servers, ip block information, SVN servers, etc,etc
[2012-12-03 23:15:16 -0500] jwcarman: gotcha
[2012-12-03 23:15:16 -0500] yfeldblum: jo_, you can use FileUtils.mv
[2012-12-03 23:15:37 -0500] qhartman: jo_, http://wiki.opscode.com/display/chef/Resources#Resources-Script should get you started
[2012-12-03 23:16:03 -0500] jwcarman: How do you make sure nobody overwrites your cookbook changes by pushing to the server after you?
[2012-12-03 23:16:20 -0500] yfeldblum: jo_, http://ruby-doc.org/stdlib-1.8.7/libdoc/fileutils/rdoc/FileUtils.html#method-c-mv
[2012-12-03 23:16:25 -0500] siezer: knife cookbook upload cookbookname --freeze
[2012-12-03 23:16:39 -0500] qhartman: jwcarman, we just have to be careful that we pull the latest from git before we do work and knife up the changes.
[2012-12-03 23:16:40 -0500] siezer: that'll force someone to very purposefully overwrite it
[2012-12-03 23:16:57 -0500] yfeldblum: jwcarman, have your own personal chef-server that you write to, and have jenkins/git-post-receive-hook write to the production chef-server
[2012-12-03 23:17:02 -0500] jwcarman: well, if you don't commit to git before you "push", then it'd be easy to get out of sync
[2012-12-03 23:17:22 -0500] qhartman: we've looked at using --freeze, but decided against it for now since so few people touch it. If we get more people working on chef, we'll likely start using that.
[2012-12-03 23:17:34 -0500] jo_: yfeldblum thanks! what if I want to have a list of files saved as maybe 'attribute?' for a node
[2012-12-03 23:17:41 -0500] jwcarman: we've got a large team of "chefs" in the kitchen at one time
[2012-12-03 23:17:44 -0500] jo_: yfeldblum and then read the list and move the files
[2012-12-03 23:17:50 -0500] jwcarman: Large meaninga roughly 10-12 I'd say
[2012-12-03 23:18:00 -0500] qhartman: jwcarman, indeed, which is why I have a script called "pushit" that does the git commit and whatnot before knifing stuff.
[2012-12-03 23:18:00 -0500] jo_: yfeldblum do you have an idea of how could this work
[2012-12-03 23:18:23 -0500] yfeldblum: jo_, node["my_movable_files"].each do |source, destination| ; FileUtils.mv(source, destination) ; end
[2012-12-03 23:19:19 -0500] qhartman: jwcarman, yeah, with that many I'd say you probably need more structure than we use.
[2012-12-03 23:19:46 -0500] qhartman: jwcarman, having the pushes to the chef-server gated through Jenkins is probably a good idea
[2012-12-03 23:19:49 -0500] jwcarman: do you know of any resources out there that outline a good workflow for that many cooks in the kitchen
[2012-12-03 23:20:25 -0500] jwcarman: Do you just run a chef server on your local machine or do you just have one devoted to you?
[2012-12-03 23:20:42 -0500] qhartman: We run our own chef instance
[2012-12-03 23:20:49 -0500] jwcarman: on your local box?
[2012-12-03 23:21:01 -0500] qhartman: no, just the "real" one
[2012-12-03 23:21:06 -0500] jwcarman: oh, ok
[2012-12-03 23:21:20 -0500] beandip: Hey guys
[2012-12-03 23:21:31 -0500] jwcarman: I really don't want to have to run chef-server on my machine.
[2012-12-03 23:21:33 -0500] beandip: I'm setting up a vagrant dev environment for my tomcat devs
[2012-12-03 23:21:40 -0500] jwcarman: I would love to get away with chef-solo if I can
[2012-12-03 23:22:02 -0500] beandip: I'd like to provision mysql using the database cookbook but it seems that specifying the environment is required by the database cookbook
[2012-12-03 23:22:04 -0500] qhartman: I don't know of any good chef team workflows, but I imagine any sort of continuous deployment-type workflow could be adapted pretty easily.
[2012-12-03 23:22:14 -0500] beandip: Does chef solo support environments?
[2012-12-03 23:22:21 -0500] jo_: yfeldblum Thanks!
[2012-12-03 23:22:49 -0500] jtimberman: beandip: no
[2012-12-03 23:23:02 -0500] beandip: jtimberman: then I can't use the database cookbook?
[2012-12-03 23:23:07 -0500] beandip: or am I missing something?
[2012-12-03 23:23:13 -0500] yfeldblum: jwcarman, when you write a php or rails app, and you're testing it on your laptop, you don't connect it to the production database ...
[2012-12-03 23:23:41 -0500] beandip: Or does anyone have a sample tomcat vagrant dev environment I can fork?
[2012-12-03 23:24:00 -0500] jtimberman: beandip: you can't use the ebs_backup.rb, ebs_volume.rb, master.rb and snapshot.rb recipes.
[2012-12-03 23:24:00 -0500] jwcarman: I typically try to write my stuff to have all unit tests.
[2012-12-03 23:24:16 -0500] jtimberman: beandip: you can still use the resources it provides, however.
[2012-12-03 23:24:16 -0500] qhartman: jwcarman, If you want your integration tests to be meaningful I'm afraid you'll have to run a DEV one up, or accept the increased risk of doing dev stuff on the production server.
[2012-12-03 23:25:41 -0500] beandip: jtiberman, OK
[2012-12-03 23:25:46 -0500] beandip: I think that answers it for me
[2012-12-03 23:25:49 -0500] beandip: thanks
[2012-12-03 23:26:20 -0500] beandip: back to my other question, rather than me re-inventing the wheel, does anyone have a tomcat dev Vagrant environment published anywhere?
[2012-12-03 23:27:14 -0500] qhartman: cd ..
[2012-12-03 23:27:16 -0500] qhartman: lol
[2012-12-03 23:29:15 -0500] mikeg: anyone ever seen this error when trying to install a gem:  NoMethodError: gem_package[fog] (s3_file::default line 27) had an error: NoMethodError: undefined method `full_name' for nil:NilClass
[2012-12-03 23:29:54 -0500] terbeaux: what is on like 27?
[2012-12-03 23:30:00 -0500] terbeaux: line 27?
[2012-12-03 23:30:25 -0500] mikeg: g = gem_package "fog" do
[2012-12-03 23:30:25 -0500] mikeg:   version "1.1.2"
[2012-12-03 23:30:25 -0500] mikeg:   action :nothing
[2012-12-03 23:30:26 -0500] mikeg: end
[2012-12-03 23:30:26 -0500] mikeg: g.run_action(:install)
[2012-12-03 23:30:27 -0500] mikeg: that stuff
[2012-12-03 23:32:46 -0500] bluepojo: mikeg: ugh, that sounds vaguely familiar. I think it's something to do with the version of ruby or rubygems?
[2012-12-03 23:32:57 -0500] bluepojo: I got that error a very long time ago.
[2012-12-03 23:33:02 -0500] bluepojo: was equally as baffled
[2012-12-03 23:34:28 -0500] mikeg: I have 2 nodes that are "seemingly" identical.  works on 1 not the other.  very frustrating
[2012-12-03 23:37:33 -0500] beandip: mikeg, what version of the fog gem are you using and what version of ruby
[2012-12-03 23:37:35 -0500] beandip: ?
[2012-12-03 23:40:41 -0500] mikeg: 1.1.2 fog gem.  1.9.2-p290 chef
[2012-12-03 23:43:19 -0500] mikeg: here's the stacktrace https://gist.github.com/4199118
[2012-12-03 23:44:41 -0500] beandip: mikeg, use ruby 1.9.3
[2012-12-03 23:45:10 -0500] beandip: also, fog is now at 1.7.0
[2012-12-03 23:45:19 -0500] beandip: you have some old version there
[2012-12-03 23:45:22 -0500] beandip: :)
[2012-12-03 23:46:18 -0500] mikeg: well, yeah, I know.  this is reviving an old project.  old cookbooks.   old servers.  etc.
[2012-12-03 23:47:33 -0500] mikeg: this combo worked in the past.  and, it works on 1 of the nodes.  just not the other.  so I don't think it's a chef or a ruby or a gems problem.  I think somehting is different about the 2nd server and that's what's causing the issue.  was just hoping someone would know where to look for quick fix
[2012-12-03 23:47:52 -0500] beandip: hmm
[2012-12-03 23:47:59 -0500] beandip: ok
[2012-12-03 23:48:52 -0500] beandip: can you gist the s3_file::default recipe?
[2012-12-03 23:50:01 -0500] mikeg: sure:  https://gist.github.com/4199148
[2012-12-03 23:51:30 -0500] mikeg: it's just a "hacky" way of installing the fog gem if it's required.  old school way.  I guess you can do it now with "chef_gem"
[2012-12-03 23:51:54 -0500] beandip: and you should do it the non-klude way
[2012-12-03 23:51:56 -0500] beandip: ;)
[2012-12-03 23:52:34 -0500] sn0wb1rd: mikeg: You said you are using ruby 1.9.2 but the stack trace shows ruby 1.9.1
[2012-12-03 23:53:19 -0500] mikeg: that's just where ruby puts the files.  never understood that
[2012-12-03 23:53:27 -0500] sn0wb1rd: hmmm
[2012-12-03 23:53:27 -0500] bluepojo: 1.9.1 is the C API level
[2012-12-03 23:53:33 -0500] bluepojo: which hasn't changed since 1.9.1
[2012-12-03 23:53:36 -0500] mikeg: $ ruby --version
[2012-12-03 23:53:36 -0500] mikeg: ruby 1.9.2p290 (2011-07-09 revision 32553) [x86_64-linux]
[2012-12-03 23:53:40 -0500] pulsejc: I'm finally looking at using the omnibus installer, but I want to make sure I understand chef_gem vs gem_package
[2012-12-03 23:53:42 -0500] sn0wb1rd: ic
[2012-12-03 23:53:59 -0500] bluepojo: 1.9.1+ are all 1.9.1 flavor releases
[2012-12-03 23:54:02 -0500] bluepojo: so they all use that folder
[2012-12-03 23:54:56 -0500] JasonF: I'm trying to dynamically create services as they're requested to restart, but only if they exist. Would https://gist.github.com/970c02a65dade9a5da34 do the trick? Seems like it does in shef, but I'm curious if anyone has any worries about pitfalls. CC: jordane
[2012-12-03 23:55:06 -0500] pulsejc: if I currently have some legacy ruby scripts (not currently using bundler or anything of that nature) and need gems installed in the system ruby (as opposed to the chef embedded ruby), what is the proper way to handle that?
