[2012-12-28 00:27:00 -0500] cbloss: quick question, I'm trying to correctly install chef-solo on OSX, I can't seem to find the correct method to do this. Is chef-solo included in the omnibus installer?
[2012-12-28 00:47:51 -0500] savant: is there a comprehensive list of chef-solo wrappers?
[2012-12-28 02:00:53 -0500] gazoombo: savant: what do you mean by a chef-solo wrapper?
[2012-12-28 02:02:01 -0500] gazoombo: oops. stale log.
[2012-12-28 02:03:11 -0500] Qten: Hi All, i'm trying to use the unbound cookbook, (http://community.opscode.com/cookbooks/unbound) however it seems i'm having trouble creating the role.. the syntax in the example seems to not work when i create the role any ideas?
[2012-12-28 02:58:13 -0500] cwj: qten: gist the error you're encountering?
[2012-12-28 03:14:31 -0500] Lrrr: I have trouble bootstrapping a node
[2012-12-28 03:15:49 -0500] Lrrr: It says it fails to authenticate
[2012-12-28 03:15:54 -0500] Lrrr: I never had that problem
[2012-12-28 03:57:12 -0500] Lrrr: mmm seems my validation key was wrong on the startup machine
[2012-12-28 07:39:16 -0500] SirHirzu: hi, I'm desperately trying to get the chef server up and running locally, but not being very successful. The server is installed and running but I can not generate keys for client.
[2012-12-28 07:39:52 -0500] SirHirzu: The web app says 'Could not update client'
[2012-12-28 07:47:09 -0500] mattt: SirHirzu: i followed http://wiki.opscode.com/display/chef/Installing+Chef+Server yesterday and it seemed to work fine
[2012-12-28 07:48:14 -0500] SirHirzu: I probably did something wrong there.
[2012-12-28 07:48:37 -0500] SirHirzu: oh well, I suppose Ive used all the time I'm going to use for that
[2012-12-28 07:48:59 -0500] mattt: SirHirzu: hang around, i'm not that familiar w/ chef, perhaps it's an easy fix and someone with more knowledge can point you in the right direction
[2012-12-28 07:50:13 -0500] SirHirzu: somehow the message queue connection keeps failing but already used so much time here, it's getting too expensive.
[2012-12-28 07:52:06 -0500] mattt: SirHirzu: put it aside and circle back in a few hours when more people will be online
[2012-12-28 07:52:52 -0500] SirHirzu: ok
[2012-12-28 09:12:42 -0500] SirHirzu: is anyone using hosted chef server?
[2012-12-28 09:13:13 -0500] SirHirzu: How do I upload my custom cookbook to hosted chef server?
[2012-12-28 09:14:22 -0500] mattt: SirHirzu: http://wiki.opscode.com/display/chef/Fast+Start+Guide
[2012-12-28 09:14:34 -0500] mattt: ie. knife cookbook upload getting-started
[2012-12-28 09:15:05 -0500] SirHirzu: thanks
[2012-12-28 12:21:44 -0500] BryanWB__: ohai chefs!
[2012-12-28 12:22:26 -0500] aruntomar: BryanWB__: ohai
[2012-12-28 13:27:14 -0500] willejs: n
[2012-12-28 13:27:31 -0500] willejs: hi, I've got an issue with chef-colr
[2012-12-28 13:27:34 -0500] willejs: *solr
[2012-12-28 13:27:47 -0500] willejs: it fails to return any results and does not error
[2012-12-28 13:28:17 -0500] willejs: rabbitmq is working, and chef expander too. i cannot run chef-solr-rebuild as it does not exist any more?
[2012-12-28 13:28:40 -0500] willejs: i have restored a backup from another server onto a new server, and this is what has happened...
[2012-12-28 15:34:05 -0500] leifmadsen: morning all!  I have a template that will populate a file with data based on information in a database. I have some other attributes defined in the recipe that I want to make the "default" data. I want the information in the data bag to be used, but if it doesn't exist, to use the default data in the attributes file.
[2012-12-28 15:34:56 -0500] leifmadsen: I've tried doing it with something like:   <% details.attribute?('type') ? details['type'] : node['type'] %>
[2012-12-28 15:35:06 -0500] leifmadsen: but the template tells me attribute method is undefined
[2012-12-28 15:41:15 -0500] BryanWB__: leifmadsen: bag_config by chrisroberts myabe whatur looking for
[2012-12-28 15:42:48 -0500] leifmadsen: BryanWB__: thanks for the tip -- I guess using something like .attribute? isn't valid in the template then?
[2012-12-28 15:43:19 -0500] BryanWB__: leifmadsen: umm, what is `details`?
[2012-12-28 15:43:46 -0500] BryanWB__: an object?
[2012-12-28 15:43:52 -0500] leifmadsen: aye
[2012-12-28 15:44:03 -0500] leifmadsen: per @core_servers.each do |name, details|
[2012-12-28 15:44:12 -0500] leifmadsen: and @core_servers is the variable passed in from the tempalte resource
[2012-12-28 15:44:41 -0500] spox: if it's a "hash like" object you can just use has_key?
[2012-12-28 15:44:57 -0500] BryanWB__: maybe  then `!details.type.nil? ? details['type'] : node['type'] `
[2012-12-28 15:45:07 -0500] BryanWB__: spox: +1
[2012-12-28 15:45:23 -0500] BryanWB__: more elegant
[2012-12-28 15:45:28 -0500] leifmadsen: spox: ya it's just json data
[2012-12-28 15:45:39 -0500] spox: leifmadsen: then that'll do it :)
[2012-12-28 15:45:54 -0500] leifmadsen: so basically just:  details.has_key?('type')
[2012-12-28 15:45:58 -0500] spox: yup
[2012-12-28 15:46:13 -0500] leifmadsen: thanks, looks like I was perhaps just picking the wrong method
[2012-12-28 15:57:09 -0500] leifmadsen: spox: that worked great, thanks!
[2012-12-28 15:57:25 -0500] spox: leifmadsen: sure :)
[2012-12-28 16:07:12 -0500] Toger: Is there a way to OR search requests together and use the first match? I'd like to do something like the following in a chef recipe: pool = search(very specific) || search (less specific) || search(global)    and have the first search that finds results have effect. Is there a way to do that?
[2012-12-28 16:08:18 -0500] Toger: I'm specifically doing this to check if there is a pool member for the current node's environment, otherwise back off to the generic pool.
[2012-12-28 16:11:38 -0500] spox: [specific, less_specific, global].each{|s| pool = search(s); break unless pool.empty? }
[2012-12-28 16:11:41 -0500] spox: ?
[2012-12-28 16:11:58 -0500] Toger: oooh
[2012-12-28 16:12:08 -0500] Toger: I bet that'll work
[2012-12-28 16:12:10 -0500] Toger: thank you
[2012-12-28 16:36:42 -0500] polysics: hi tehre
[2012-12-28 16:37:02 -0500] polysics: how do you people handle a recipe that would need to clone a private Gitub repository, please?
[2012-12-28 16:37:06 -0500] polysics: *Github
[2012-12-28 16:51:12 -0500] cbloss: Does the Omnibus installer install chef-solo?
[2012-12-28 16:56:13 -0500] cwj: cbloss: yes it does
[2012-12-28 16:56:30 -0500] cbloss: cwj: thanks!
[2012-12-28 17:00:44 -0500] cwj: polysics: the common pattern is to install an ssh key which has access to the private repo (e.g. designated deploy key), and an ssh wrapper script that git uses to activate that key when connecting to the repo.
[2012-12-28 17:01:06 -0500] cwj: polysics: i wrote a little library cookbook for making that less repetitive http://community.opscode.com/cookbooks/deploy_wrapper
[2012-12-28 17:07:14 -0500] cwj: does anyone recall off hand at what point node[:name] stopped working? seems like i now have to use node.name
[2012-12-28 17:07:50 -0500] kallistec: cwj: don't think it ever worked
[2012-12-28 17:08:18 -0500] cwj: hrm really? maybe i was setting it somewhere
[2012-12-28 17:13:48 -0500] cbloss: When I have RVM in my path I cannot get chef to work: I get this error: /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:247:in `to_specs': Could not find chef (>= 0) amongst [bundler-1.2.3, rake-10.0.3, rubygems-bundler-1.1.0, rubygems-update-1.8.24, rvm-1.11.3.5] (Gem::LoadError)
[2012-12-28 17:14:02 -0500] cbloss: this even happens when I follow the instructions to use the absoulte path found on http://wiki.opscode.com/display/chef/Installing+Omnibus+Chef+Client+on+Linux+and+Mac
[2012-12-28 17:14:20 -0500] cbloss: I have /opt/chef/bin in my $PATH before RVM
[2012-12-28 17:14:25 -0500] cbloss: as well
[2012-12-28 17:14:44 -0500] cbloss: 1 chris@chris-dt-01  ~  gem list
[2012-12-28 17:14:45 -0500] cbloss: *** LOCAL GEMS ***
[2012-12-28 17:14:45 -0500] cbloss: bundler (1.2.3)
[2012-12-28 17:14:45 -0500] cbloss: rake (10.0.3)
[2012-12-28 17:14:45 -0500] cbloss: rubygems-bundler (1.1.0)
[2012-12-28 17:14:46 -0500] cbloss: rubygems-update (1.8.24)
[2012-12-28 17:14:46 -0500] cbloss: rvm (1.11.3.5)
[2012-12-28 17:14:46 -0500] cbloss:  chris@chris-dt-01  ~  echo $PATH
[2012-12-28 17:14:56 -0500] cbloss:  chris@chris-dt-01  ~ 
[2012-12-28 17:15:10 -0500] cbloss: usr/local/opt/coreutils/libexec/gnubin:/opt/chef/bin:/usr/local/bin:/usr/local/sbin:~/bin:/Users/chris/.rvm/gems/ruby-1.9.3-p327/bin:/Users/chris/.rvm/gems/ruby-1.9.3-p327@global/bin:/Users/chris/.rvm/rubies/ruby-1.9.3-p327/bin:/Users/chris/.rvm/bin:/usr/bin:/bin:/usr/sbin:/sbin
[2012-12-28 17:15:20 -0500] cbloss: any ideas what I'm doing wrong?
[2012-12-28 17:22:45 -0500] spox: `sudo -i` to root which i think will scrub all the rvm env vars. see if you can run it then
[2012-12-28 17:22:52 -0500] spox: cbloss: ^^
[2012-12-28 17:23:56 -0500] cbloss: yep that works. I found that on a different page. I think that is the only workaround. I might try and make an alias to temporarly set the without rvm vars
[2012-12-28 17:24:24 -0500] cbloss: or make another account and alias it with sudo
[2012-12-28 18:21:49 -0500] clizzin: hey there.  my company has a bunch of chef cookbooks written to be used in combination with the chef server run by opscode.  i'm now adding a cookbook and trying to use chef solo to get that cookbook going in a vagrant VM.  but when i bring up the vagrant and tell it to use my cookbook, it errors out bc of a "recipe compile error" in a *different* cookbook.  it seems to have something to do with the way encrypted data bags are handled in s
[2012-12-28 18:21:49 -0500] clizzin: mode vs. server mode.  basically, the offending cookbook has an attributes/default.rb file that calls Chef::EncryptedDataBagItem.load('foo', 'bar').  this produces an error Chef::Exceptions::InvalidDataBagPath: Data bag path '/var/chef/data_bags' is invalid
[2012-12-28 18:22:03 -0500] clizzin: any idea what piece of configuration i'm missing here?
[2012-12-28 18:26:40 -0500] quincunx: hi, i'm trying to use the "users" cookbook with chef-client 10.16.2 on RHEL6, and I'm getting a NoMethodError exception if i supply a password attribute in my data bag
[2012-12-28 18:27:06 -0500] quincunx: is this a known issue?
[2012-12-28 18:27:07 -0500] quincunx: [2012-12-28T18:23:53+00:00] FATAL: NoMethodError: user[test] (/var/chef/cache/cookbooks/users/providers/manage.rb line 78) had an error: NoMethodError: undefined method `sp_pwdp' for nil:NilClass
[2012-12-28 18:27:37 -0500] quincunx: in my research supposedly this was fixed in the past with the inclusion of ruby-shadow in the embedded ruby
[2012-12-28 18:44:42 -0500] WPsites: I'm thinking of using a recipe that requires another recipe that is already used in another cookbook, only when used elsewhere it's the package version but this new recipe wants the source version. So what happens? Will the package version install and then the source version install over the top?
[2012-12-28 18:45:23 -0500] cheflevelramen: Hi All, I'm getting error from a resource in a recipe when I initially spin up a new instance. I'm confused why the resource is being executed as one of the first actions in the run_list, since the recipe is the last item in the run_list. Here's the recipe:
[2012-12-28 18:45:27 -0500] cheflevelramen: Here's the error:
[2012-12-28 18:45:30 -0500] cheflevelramen: http://pastebin.com/STzZLgDa
[2012-12-28 18:45:34 -0500] cheflevelramen: http://pastebin.com/uG4Gynwk
[2012-12-28 18:48:38 -0500] cheflevelramen: Actually, looking at http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run now.
[2012-12-28 18:49:53 -0500] cheflevelramen: This error seems to come about during the compile phase of the chef run, and it's throwing an error because the value for the resource_id can't be null. But that value get's populated after early portions of the recipes run. So I'm not sure how to fix it.
[2012-12-28 18:51:24 -0500] clizzin: re my earlier error, for anyone who later reads this: the solution was to set chef.encrypted_data_bag_secret_key_path in my Vagrantfile (in the same scope where chef.roles_path, etc. are set)
[2012-12-28 19:36:00 -0500] sn0wb1rd: A small question: I change a node attribute in run time in a resource. I need to pass in this node attribute to another resource. But it takes a previous old value. How can I pass in the node attribute that got changed in the previous resource?
[2012-12-28 19:37:07 -0500] Twirrim: here's something that seems a little odd to me.  On a server, if I run ohai, the hostname attribute is just hostname.  Server side though, chef sees it as hostname.domain  (e.g. on box get 'foo' as hostname, in chef see 'foo.bar.baz' as hostname attribute)
[2012-12-28 19:37:19 -0500] Twirrim: *"chef server side though"
[2012-12-28 19:48:11 -0500] meineerde: sn0wb1rd: you either have to set it on the resource explicitly again or you make sure to read the attribute only during conversion (and not during compilation as apparently currently)
[2012-12-28 19:48:24 -0500] meineerde: sn0wb1rd: see http://wiki.opscode.com/display/chef/Anatomy+of+a+Chef+Run for more details
[2012-12-28 19:49:46 -0500] meineerde: Twirrim: then the setups are probably different (e.g. the contents of /etc/hostname)
[2012-12-28 19:50:28 -0500] meineerde: Twirrim: ohai (on linux) uses `hostname -s` for the hostname and `hostname --fqdn` for the fqdn
[2012-12-28 19:53:43 -0500] sascha_d:  chefs, I'm running into some funky behavior when we change recipe code or adjust roles, these things are not always reflected on the node during a client run
[2012-12-28 19:53:50 -0500] sascha_d: is this a database thing?
[2012-12-28 19:54:16 -0500] sascha_d: I've seen it happen on both our private chef implementation and some chef servers running (don't cringe), 10.2
[2012-12-28 19:54:35 -0500] miah: i would think it could be lag in expander/solr
[2012-12-28 19:54:54 -0500] sascha_d: think?
[2012-12-28 19:55:02 -0500] miah: how big is the gap between making a change and a client run?
[2012-12-28 19:55:08 -0500] miah: seconds, minutes, hours?
[2012-12-28 19:55:10 -0500] sascha_d: very short
[2012-12-28 19:55:19 -0500] sascha_d: seconds, less than a minute
[2012-12-28 19:55:50 -0500] miah: hrm.
[2012-12-28 19:56:12 -0500] sascha_d: I also just got a complaint that they removed a role, but the recipes are still in the run list.  Is that expected?
[2012-12-28 19:56:28 -0500] sascha_d: I told them to just go in and edit the recipe list manually now while I look at it more
[2012-12-28 19:58:14 -0500] sn0wb1rd: meineerde: Thanks
[2012-12-28 19:58:52 -0500] Mithrandir: sascha_d: as in, removed role, ran chef-client, looked at the node object and it had the old run list?
[2012-12-28 19:59:15 -0500] sascha_d: yes, it's very specific
[2012-12-28 19:59:36 -0500] sascha_d: it was a zookeeper role that had a recipe that is only used by the zookeeper role
[2012-12-28 19:59:40 -0500] Mithrandir: sascha_d: using knife node show or knife search?
[2012-12-28 19:59:42 -0500] sascha_d: the role is gone
[2012-12-28 19:59:44 -0500] miah: role does query search to pull down the list of roles
[2012-12-28 19:59:45 -0500] sascha_d: show
[2012-12-28 20:00:17 -0500] Mithrandir: miah: but node show should show what's in couch, not solr
[2012-12-28 20:00:37 -0500] miah: right
[2012-12-28 20:00:51 -0500] miah: but whats in couch would depend on the last time a node.save was done.. right?
[2012-12-28 20:01:17 -0500] miah: which unless the node was edited directly would require a client run to update its run_list
[2012-12-28 20:01:49 -0500] miah: if im wrong please edumacate me =)
[2012-12-28 20:03:06 -0500] Mithrandir: that sounds right, hence why I asked if there was a chef-client run in there
[2012-12-28 20:03:38 -0500] miah: ok. sometimes i doubt myself
[2012-12-28 20:04:00 -0500] sascha_d: so, to get rid of something for real from the run list, we'd actually have to do an override runlist or a firstboot or something?
[2012-12-28 20:04:10 -0500] miah: no
[2012-12-28 20:04:27 -0500] miah: you just need to remove the role or whatever is in question and make sure the updates are indexed
[2012-12-28 20:04:38 -0500] sascha_d: so it's probably solr that's our culprit
[2012-12-28 20:04:41 -0500] sascha_d: cool beans
[2012-12-28 20:05:09 -0500] miah: you could do a search to verify the expected results prior to running clients
[2012-12-28 20:05:10 -0500] Mithrandir: it could be, but that should also be updated on a node run
[2012-12-28 20:05:23 -0500] Mithrandir: (possibly with a delay)
[2012-12-28 20:05:27 -0500] sascha_d: well, it's too late by the time we run the client
[2012-12-28 20:05:51 -0500] miah: howso?
[2012-12-28 20:06:26 -0500] Mithrandir: sascha_d: if you remove the role, run chef-client, wait 30s or so, then check, is it still wrong?
[2012-12-28 20:06:35 -0500] Mithrandir: (have I said I hate eventual consistency?)
[2012-12-28 20:06:46 -0500] miah: =)
[2012-12-28 20:07:13 -0500] sascha_d: I'm having a different thing here I think
[2012-12-28 20:07:21 -0500] sascha_d: they apparently removed a recipe from the role, knifed in the role
[2012-12-28 20:09:08 -0500] sascha_d: hang on
[2012-12-28 20:09:15 -0500] sascha_d: I appear to have run into user error
[2012-12-28 20:09:22 -0500] sascha_d: they were confused
[2012-12-28 20:09:36 -0500] sascha_d: HOWEVER, I have seen where I've been updating recipes and things are not updated when I run the client
[2012-12-28 20:09:46 -0500] sascha_d: that could be the eventual consistency
[2012-12-28 20:10:02 -0500] drnfx: hello all, im having a brain fart and I cant remember how I can execute a single recipe with chef-cleint. i am using knife ssh to remote ly run chef-client but i dont want it ot do the entire run llist
[2012-12-28 20:10:29 -0500] Mithrandir: ah, ok.
[2012-12-28 20:10:45 -0500] Mithrandir: sascha_d: if it goes away if you wait longer, it is. :-)  Slightly hard to know without an exact log of what you/they did when
[2012-12-28 20:11:17 -0500] sascha_d: now that I know it's a potential culprit, the next time I encounter it, I will check to see
[2012-12-28 20:11:53 -0500] drnfx: clear
[2012-12-28 20:11:54 -0500] drnfx: oops
[2012-12-28 20:37:05 -0500] Twirrim: meineerde: so why does the chef server side property seemingly use "hostname -f"?
[2012-12-28 20:38:31 -0500] meineerde: Twirrim: unless you have a strange OHAI, it doesn't
[2012-12-28 20:39:02 -0500] meineerde: https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/linux/hostname.rb
[2012-12-28 20:50:19 -0500] makmanalp: Hello, I have a question regarding attribute precedence.
[2012-12-28 20:50:48 -0500] makmanalp: I'm including a cookbook that contains sphinx-cookbook which has this line in its attributes: https://github.com/RiotGames/sphinx-cookbook/blob/master/attributes/default.rb#L15
[2012-12-28 20:51:23 -0500] makmanalp: when I do set[:sphinx][:use_postgres] in *my* cookbook, it seems to work, but not when I do node.override
[2012-12-28 20:51:33 -0500] qwertyu123: hi
[2012-12-28 20:51:45 -0500] makmanalp: er, set[:sphinx][:use_postgres] = true rather
[2012-12-28 21:12:14 -0500] sg4m: I have a question about delayed evaluation : I'm using the aws_ebs_volume provider, which works fine; in a next step, I'd like to tag the volume that has just been created.  Volume creation puts the ID on the node, but I haven't been able to find a way to get the aws_resource_tag working with that - it needs to evaluate the node[aaa][bbb][ccc] expression at convergence time, and of course the ID isn't in there yet.  Anyone have a suggestion?
[2012-12-28 21:14:27 -0500] chip-: Question if anyone's tried this: If you install gems via the Omnibus Chef embedded Ruby, and then upgrade Chef, what happens to the gems installed? Do they stay the same unless the embedded Ruby version gets bumped?
[2012-12-28 21:18:07 -0500] chris613: I have a chef repo where some cohorts have created roles via the web interface and they do not appear in our git-controlled version of the repo. Is there something like the opposite of 'knife role from file' that will create .json role files from the versions on the server?
[2012-12-28 21:19:20 -0500] makmanalp: another question, what is the difference between set[] or <recipename>[] or default[] or node.foo[] ?
[2012-12-28 21:19:52 -0500] sg4m: chris613- you can get the role definition with this: knife role show --format json rolename
[2012-12-28 21:21:03 -0500] chip-: makmanalp: There are levels of precedence for attributes, depending on where they are set.
[2012-12-28 21:21:10 -0500] makmanalp: chip-: I understand that
[2012-12-28 21:21:38 -0500] makmanalp: chip-: but the docs don't really tell you about the fact that the 1st, 2nd and 3rd exist
[2012-12-28 21:21:44 -0500] chip-: makmanalp: default sets the attribute in the default namespace, node.set sets the attribute in the node object.
[2012-12-28 21:21:50 -0500] makmanalp: http://docs.opscode.com/essentials_cookbook_attribute_files.html
[2012-12-28 21:22:00 -0500] chip-: Yeah, they need a good table for the namespacing in the docs.
[2012-12-28 21:22:10 -0500] makmanalp: chip-: oh wait
[2012-12-28 21:22:45 -0500] makmanalp: chip-: but node.set sets it how? as a default attribute or an override or?
[2012-12-28 21:22:56 -0500] chip-: on the node object itself.
[2012-12-28 21:23:26 -0500] chip-: so node.set would be "normal"
[2012-12-28 21:23:37 -0500] makmanalp: ah!
[2012-12-28 21:23:40 -0500] chip-: going by the table here: http://wiki.opscode.com/display/chef/Attributes
[2012-12-28 21:24:04 -0500] makmanalp: I missed that tidbit, okay
[2012-12-28 21:24:09 -0500] chip-: There's really 4 layers: automatic (set by ohai), default, normal, override.
[2012-12-28 21:24:26 -0500] makmanalp: chip-: what is confusing me is the myriad ways to refer to all the layers
[2012-12-28 21:24:47 -0500] chip-: makmanalp: One sec.
[2012-12-28 21:24:56 -0500] makmanalp: so set == node.set == normal
[2012-12-28 21:24:58 -0500] makmanalp: chip-: sure
[2012-12-28 21:25:41 -0500] makmanalp: node.default == default
[2012-12-28 21:25:52 -0500] makmanalp: i'm still not sure about <recipename>[derp]
[2012-12-28 21:33:13 -0500] kallistec: makmanalp: probably what you're seeing is this: http://wiki.opscode.com/display/chef/Breaking+Changes+in+Chef+11#BreakingChangesinChef11-RoleandEnvironmentDefaultandOverrideAttributesareVisibleinAttributesFiles
[2012-12-28 21:35:46 -0500] makmanalp: first of all thanks to chip- for http://imgur.com/OBZIN
[2012-12-28 21:35:51 -0500] makmanalp: kallistec: reading, sec
[2012-12-28 21:36:20 -0500] kallistec: That is, in 10.x (and lower), the precedence between cookbook, role, environment for a given top-level precedence (default,normal,override) is implemented by ordering when attributes get applied, and since everything else "wins" over attribute files, roles and environments' attributes aren't merged in until after all the attributes files have been read
[2012-12-28 21:37:42 -0500] dougireton: If I create an LWRP in the Windows cookbook (i.e. resources/foo_bar.rb and providers/foo_bar.rb) what's the resulting resource name? "windows_foo_bar"?
[2012-12-28 21:38:49 -0500] dougireton: I keep getting this error: FATAL: NameError: Cannot find a resource for windows_printer_port on windows version 6.1.7601
[2012-12-28 21:39:08 -0500] dougireton: I'm trying to create a printer_port resource
[2012-12-28 21:39:19 -0500] paulmooring: dougireton: that should be correct it's $cookbookname_$resource_name
[2012-12-28 21:39:36 -0500] dougireton: k, I'll keep digging
[2012-12-28 21:39:50 -0500] paulmooring: are you depending on the windows cookbook?
[2012-12-28 21:40:02 -0500] dougireton: oh, that may be what's wrong
[2012-12-28 21:40:04 -0500] dougireton: thanks
[2012-12-28 21:40:07 -0500] dougireton: I'll try that
[2012-12-28 21:40:15 -0500] paulmooring: np, hope it works :)
[2012-12-28 21:40:39 -0500] makmanalp: kallistec: so you're saying because they aren't merged in, it defaults to nil which evaluates to false?
[2012-12-28 21:41:09 -0500] kallistec: dougireton: the debug output is pretty firehose-esque, but it does print a message for each LWRP resource and provider created
[2012-12-28 21:42:45 -0500] kallistec: makmanalp: no, the values for node[:sphinx][:use_foo] should all be false b/c of the stuff in lines 10-12
[2012-12-28 21:43:30 -0500] kallistec: if you use a role or environment to try to set that value to true, those attributes won't be merged until later
[2012-12-28 21:43:35 -0500] makmanalp: kallistec: ah, *because* the outside values get merged in later
[2012-12-28 21:43:40 -0500] makmanalp: I see
[2012-12-28 21:44:06 -0500] sg4m: re-asking my question with the hope that a recent arrival has a suggestion :) :
[2012-12-28 21:44:08 -0500] sg4m: I have a question about delayed evaluation : I'm using the aws_ebs_volume provider, which works fine; in a next step, I'd like to tag the volume that has just been created.  Volume creation puts the ID on the node, but I haven't been able to find a way to get the aws_resource_tag working with that - it needs to evaluate the node[aaa][bbb][ccc] expression at convergence time, and of course the ID isn't in there yet.  Anyone have a suggestion?
[2012-12-28 21:44:26 -0500] makmanalp: kallistec: what do you think of the fact that it's being set with sphinx[:use_derp] as opposed to default[:use_derp]? No reference to that syntax in the docs
[2012-12-28 21:45:13 -0500] paulmooring: sg4m: do you have this code up somewhere?
[2012-12-28 21:46:40 -0500] kallistec: makmanalp: it's implicitly using the method missing syntax for attribute lookup, e.g, `node.foo` is mostly equivalent to `node[:foo]`
[2012-12-28 21:47:40 -0500] kallistec: attributes files are evaluated in the context of the node, so it's the same as if you had `node.` in front of everything
[2012-12-28 21:47:56 -0500] makmanalp: kallistec: so it's node[:sphinx], ah!
[2012-12-28 21:48:07 -0500] sg4m: paulmooring: I'll put a stripped down version up... I'm thinking it's actually more general than the particular issue I'm having.  maybe, in brief, "is there some way to delay evaluation of node[] expressions, or evaluation of resource definitions in recipes?"
[2012-12-28 21:48:22 -0500] paulmooring: sg4m: I suspect that putting .run_action(:some_action) on whatever resource needs to run at compile time could fix your issue
[2012-12-28 21:49:09 -0500] makmanalp: kallistec: thanks again. I feel like if it was all forced to be node.attributetype[:foo] i.e. in an explicit form, everything would be so much clearer
[2012-12-28 21:49:11 -0500] kallistec: makmanalp: so it comes down to a style question about whether you like using that or not. if you find it easier to understand, you can use node[:sphinx] there instead
[2012-12-28 21:49:12 -0500] paulmooring: sg4m: https://github.com/opscode-cookbooks/build-essential/blob/master/recipes/default.rb#L38 there's an example of forcing a resource to run at compile time
[2012-12-28 21:49:42 -0500] makmanalp: there are too many defaults to keep track of
[2012-12-28 21:50:20 -0500] sg4m: paulmooring: hm, interesting, hadn't thought to force the create into compile-time.  I'm not sure that'll work in this case, but possibly :)
[2012-12-28 21:52:29 -0500] mrk: hey guys - trying to upload a cookbook to hosted chef on opscode.com, I get the following error
[2012-12-28 21:52:32 -0500] mrk: ERROR: Network Error: Connection timed out - connect(2)
[2012-12-28 21:52:32 -0500] mrk: Check your knife configuration and network settings
[2012-12-28 21:52:36 -0500] mrk: im not behind a proxy tho
[2012-12-28 21:52:39 -0500] mrk: any idea?
[2012-12-28 21:53:18 -0500] makmanalp: mrk: can you ping it?
[2012-12-28 21:53:29 -0500] kallistec: makmanalp: it's tough to accommodate all skill levels, since the extra boilerplate could be offputting to complete newbies and experts, but I'll concede that the varying code contexts in chef can be daunting when you get past the most basic usage
[2012-12-28 21:53:33 -0500] makmanalp: mrk: or telnet to it?
[2012-12-28 21:53:34 -0500] mrk: i can do knife cookbook list
[2012-12-28 21:53:43 -0500] mrk: just cant upload
[2012-12-28 21:54:06 -0500] makmanalp: kallistec: well said. thanks for the recognition, that's all I wanted :)
[2012-12-28 21:54:08 -0500] paulmooring: mrk: you should run the upload with `-VV` on to get more info
[2012-12-28 21:54:17 -0500] mrk: ah - good to know . will try that. thanks
[2012-12-28 21:55:36 -0500] kallistec: makmanalp: it's definitely something I think about pretty often, don't really have a great solution aside from maybe using foodcritic to enforce a particular style among your team
[2012-12-28 21:56:10 -0500] miah: it gets less daunting as your knowledge of ruby increases
[2012-12-28 21:56:12 -0500] mrk: looks like it times out when uploading to S3
[2012-12-28 21:57:37 -0500] mrk: i guess that's an issue w/ Opscode or AWS, not really chef related
[2012-12-28 21:57:38 -0500] paulmooring: mrk: sometimes if there's a network error while uploading the sandbox gets a little wacky, if you don't mind completely blowing away all the versions of the cookbook `knife cookbook delete $cookbook_name -yap` might fix it
[2012-12-28 21:57:49 -0500] mrk: ok ill try that
[2012-12-28 21:58:38 -0500] mrk: well - i dont have any cookbooks uploaded
[2012-12-28 21:58:51 -0500] mrk: only have them locally through Librarian
[2012-12-28 21:59:01 -0500] mrk: so cant delete anything
[2012-12-28 21:59:36 -0500] kallistec: mrk: can you hit S3 at all? There could obviously be a bunch of varying factors, but our internal monitoring can hit S3 just fine
[2012-12-28 22:00:48 -0500] mrk: the first bunch of files go through S3, it just stops uploading a cookbook in the middle
[2012-12-28 22:01:16 -0500] mrk: the RVM cookbook for example times out when uploading /gem_package_monkeypatch.rb
[2012-12-28 22:01:50 -0500] mrk: but i can run s3cmd on another AWS account and it lists my buckets just fine
[2012-12-28 22:07:33 -0500] cheflevelramen: Hi Guys, I'm having some trouble with the AWS cookbook hoping someone can help out real quick. The issue is aws_resource_tag needs the aws resource id. That id doesn't exist until the earlier part of the recipe runs (it creates and attaches an ebs volume). Since the resource id doesn't exist at compile time, chef errors. How do you get past errors and compile time and let it actually run the cookbooks?
[2012-12-28 22:08:49 -0500] cheflevelramen: I've tried adding ignore_failures, and not_if logic to the resource, but it seems when the recipe is being compiled, that logic is ignored, and variables and values are still evaluated
[2012-12-28 22:10:24 -0500] cwj: cheflevelramen: gist your recipe
[2012-12-28 22:10:54 -0500] mrk: cc kallistec and paulmooring https://gist.github.com/851a7fe76f17f4cb2e4b the timeout error
[2012-12-28 22:11:08 -0500] mrk: not sure if this helps at all
[2012-12-28 22:11:31 -0500] mrk: i can upload to a private chef instance, just cant push to the opscode hosted
[2012-12-28 22:11:38 -0500] cheflevelramen: cwj: http://pastebin.com/nV1cYS9s
[2012-12-28 22:12:43 -0500] cheflevelramen: cwj: Here's the error:
[2012-12-28 22:12:44 -0500] cheflevelramen: http://pastebin.com/Mw3FJjbQ
[2012-12-28 22:13:08 -0500] cheflevelramen: cwj: Oops, wrong error, one moment
[2012-12-28 22:14:15 -0500] mrk: cc kallistec and paulmooring looks like chef-client finally made it through!
[2012-12-28 22:14:23 -0500] mrk: could be S3 having timeouts issue :/
[2012-12-28 22:16:28 -0500] cwj: cheflevelramen: hrm i see your quandry
[2012-12-28 22:17:13 -0500] cwj: i wrote that aws_resource_tag lwrp, but i guess i havent tried to use it in that fashion myself
[2012-12-28 22:17:20 -0500] cwj: mostly use it to tag instances
[2012-12-28 22:17:40 -0500] mrk: still timing out for other recipes tho :/
[2012-12-28 22:18:58 -0500] cheflevelramen: cwj: I see. Any suggestions? Not sure how to get Chef to ignore an empty value there at compile time
[2012-12-28 22:20:45 -0500] cwj: cheflevelramen: thinking about it
[2012-12-28 22:21:00 -0500] sg4m: cheflevelramen: I asked a different question about the exact same problem just a little while ago :)
[2012-12-28 22:21:49 -0500] sg4m: cheflevelramen: paulmooring suggested forcing the first part (ebs volume create) into the compile phase by using run_action()
[2012-12-28 22:22:14 -0500] sg4m: cheflevelramen: I'm trying it out now.
[2012-12-28 22:23:24 -0500] cheflevelramen: sg4m: interesting, sounds like that might work
[2012-12-28 22:23:48 -0500] cwj: yeah thats probably what you need to do
[2012-12-28 22:24:31 -0500] cwj: the only other idea i have is to do some voodoo where the tag resource is inserted into the recipe via a ruby_block resource which is notified by the ebs resource
[2012-12-28 22:24:46 -0500] cwj: sg4m's suggestion is probably a better idea
[2012-12-28 22:26:53 -0500] sg4m: cheflevelramen:, cwj: ok, that almost worked, but the ebs volume resource saved null for the volume_id on the node..  I've seen it do this when run normally, and haven't looked into why (I'm referring to it like this : node[:aws][:ebs_volume][:data_ebs_volume][:volume_id], where data_ebs_volume is the name I assign it)
[2012-12-28 22:27:26 -0500] cheflevelramen: sg4m: Interesting. I've hit that exact same issue a few times (randomly it seems, not sure), where the id is null
[2012-12-28 22:30:46 -0500] dougireton: When writing a provider, should I use '@current_resource'/'@new_resource', or 'current_resource'/'new_resource'?
[2012-12-28 22:30:54 -0500] dougireton: and why?
[2012-12-28 22:31:25 -0500] miah: new_resource / current_resource
[2012-12-28 22:31:45 -0500] dougireton: miah: why?
[2012-12-28 22:31:50 -0500] miah: @foo is a instance variable.
[2012-12-28 22:32:03 -0500] miah: im not sure if its created?
[2012-12-28 22:32:33 -0500] dougireton: I see both examples in the Opscode cookbooks unfortunately
[2012-12-28 22:32:50 -0500] miah: :/
[2012-12-28 22:33:42 -0500] miah: i generally use new_resource as i know i wont have any conflicts with other instance variables. the scope is tied directly to my provider and nothing else.
[2012-12-28 22:34:03 -0500] dougireton: k
[2012-12-28 22:34:20 -0500] paulmooring: miah: If I may disagree you should use an instance variable in your provider so the scope is tied to the resource def
[2012-12-28 22:34:32 -0500] miah: paulmooring: its fine, please disagree =)
[2012-12-28 22:34:43 -0500] miah: i see
[2012-12-28 22:35:18 -0500] paulmooring: miah: respectfully disagree as you probably contribute more quality code than I do :)
[2012-12-28 22:35:21 -0500] miah: this may be why i saw issues when working with the lvm resource, if i passed it 'new_resource' it would have some issues
[2012-12-28 22:35:37 -0500] miah: so i had to stash new_resource in a different variable
[2012-12-28 22:36:01 -0500] paulmooring: you can have @new_resource and new_resource both defined
[2012-12-28 22:36:08 -0500] dougireton: I seem to be having issues with new_resource that I don't have with @new_resource
[2012-12-28 22:36:23 -0500] paulmooring: but there's nothing magic in new_resource to pull in stuff from the resource definition
[2012-12-28 22:36:23 -0500] miah: and lvm uses ruby_block a bunch :/
[2012-12-28 22:37:03 -0500] miah: i think ruby_block ends up in a different scope
[2012-12-28 22:37:23 -0500] paulmooring: variable scoping is hard
[2012-12-28 22:37:26 -0500] miah: it is really
[2012-12-28 22:37:45 -0500] miah: scoping and naming.. the problems of programming =)
[2012-12-28 22:38:13 -0500] paulmooring: I just make everything globals named TEMP1, TEMP2... problem solved
[2012-12-28 22:38:24 -0500] miah: @@TEMP1 FTW
[2012-12-28 22:38:46 -0500] dougireton: thanks all
[2012-12-28 22:39:11 -0500] miah: not only is it a global variable, its a constant :P
[2012-12-28 22:39:34 -0500] sascha_d: @miah still around?
[2012-12-28 22:39:34 -0500] sascha_d: https://gist.github.com/4402648
[2012-12-28 22:39:39 -0500] sascha_d: I need a second pair of eyes
[2012-12-28 22:39:49 -0500] miah: i have 4 eyes, so i have a extra pair for you
[2012-12-28 22:40:10 -0500] sascha_d: I just ran through and made a bunch of changes, and am getting a funky error that won't give me a line number for my cookbook
[2012-12-28 22:40:27 -0500] sascha_d: so wondering if you've seen it before and what kind of typo I should be looking for
[2012-12-28 22:40:32 -0500] miah: git diff to the rescue
[2012-12-28 22:40:44 -0500] miah: but most likely you've named something the same name as a resource but it isnt a resource?
[2012-12-28 22:40:50 -0500] sascha_d: I extracted some code from a shared cookbook and made a new cookbook
[2012-12-28 22:41:00 -0500] sascha_d: hrm, maybe
[2012-12-28 22:41:09 -0500] cwj: sascha_d: i encounted that recently and i had typoed 'resource[foo'
[2012-12-28 22:41:16 -0500] sascha_d: fanks!
[2012-12-28 22:41:17 -0500] cwj: fwiw
[2012-12-28 22:41:23 -0500] miah: interesting
[2012-12-28 22:41:26 -0500] sascha_d: that will help my digging tremendously!
[2012-12-28 22:43:11 -0500] paulmooring: sascha_d: check your run_list
[2012-12-28 22:43:26 -0500] paulmooring: or even better run chef-client with -l debug and grep for expanded run_list
[2012-12-28 22:43:36 -0500] sascha_d: GOT IT
[2012-12-28 22:43:49 -0500] sascha_d: cwj gets a gold star!
[2012-12-28 22:43:57 -0500] cwj: yey
[2012-12-28 22:44:09 -0500] sascha_d: when I moved out the functionality, I also had to change a service notification and typod the attribute
[2012-12-28 22:44:21 -0500] sascha_d: I feel the need for a bug report
[2012-12-28 22:44:26 -0500] sascha_d: that hurt my brain
[2012-12-28 22:44:39 -0500] paulmooring: sascha_d: maybe a bug report with a patch :)
[2012-12-28 22:45:00 -0500] sascha_d: @paulmooring maybe, but since I'm not an expert in tracing exceptions up the stack, probably not
[2012-12-28 22:45:13 -0500] paulmooring: fair enough, never hurts to ask
[2012-12-28 22:45:45 -0500] sascha_d: I have been trying to be conscientious girl on noting what is a bug and what I can do to address it
[2012-12-28 22:45:49 -0500] cwj: seems like it would be trivial to change the message to somehting like "ArgumentError: You must have a string like resource_type[name]! You passed 'honk_bonk[foo'"
[2012-12-28 22:46:05 -0500] paulmooring: cwj: exactly what I was thinking
[2012-12-28 22:46:13 -0500] sascha_d: cwj, I would think the problem is that somewhere the actual exception got lost though
[2012-12-28 22:48:07 -0500] sascha_d: that's the part where I feel like I'm not smart enough to figure it out
[2012-12-28 22:48:36 -0500] sascha_d: I can take a look at the last few things in the exception stack and see if it's stupid obvious though
[2012-12-28 22:48:51 -0500] cwj: yeah, either way it would be a good thing to write a ticket about i think
[2012-12-28 22:53:03 -0500] paulmooring: https://github.com/paulmooring/chef/commit/a59f95e621c73e8eee603e7c413110560c1889c7
[2012-12-28 22:57:20 -0500] kallistec: sascha_d: As far as I'm concerned any error that doesn't do a reasonable job of explaining what you did wrong is a bug. No need for people to waste their lives hunting down stuff like that.
[2012-12-28 22:57:31 -0500] dopacki: hi. is there a Chef resource/handler/something I can call from inside a chef recipe that will halt the chef run?
[2012-12-28 22:59:27 -0500] kallistec: dopacki: chef will give up if anything raises a ruby exception, so you can do `raise "I give up because reasons"` and chef will stop. Put that in a ruby_block resource to make it happen during converge instead of compile phase
[2012-12-28 22:59:41 -0500] dopacki: I'm working on a continuous deployment system, and chef-client usually takes about 5-10 minutes to run on each box.. so I have chef scheduled to run every 30 minutes via cron.
[2012-12-28 23:00:03 -0500] dopacki: however, our developers don't want to potentially wait 30 minutes for a deployment
[2012-12-28 23:00:49 -0500] dopacki: thought was I could run chef-client and have it basically be a no-op unless there's some other signal that it should do work
[2012-12-28 23:01:23 -0500] dopacki: kallistec - I'll give that a shot. thx
[2012-12-28 23:02:04 -0500] kallistec: dopacki: FWIW, Chef 11 uses flock on a lockfile to avoid running 2x instances at the same time
[2012-12-28 23:02:40 -0500] sascha_d: @kallistec we all like to be helpful though
[2012-12-28 23:03:00 -0500] sascha_d: and I'd feel pretty smart if I figured it out. Although realistically.
[2012-12-28 23:03:01 -0500] kallistec: dopacki: so you may want to leave a note for yourself to revisit this once we get Chef 11 out and you get around to upgrading
[2012-12-28 23:06:51 -0500] kallistec: sascha_d: it is a pretty great feeling when you win at debugging something obtuse, and also a bad feeling to think you could've prevented someone from having to spend an unreasonable amount of time finding a typo
[2012-12-28 23:07:54 -0500] sascha_d: @kallistec IKR? I'm not used to Chef actually being able to stump me. Esp with the new error reporting in 10.14 I barely have to work any more to find my typos :)
[2012-12-28 23:08:50 -0500] kallistec: yeah, I'm surprised that didn't help here? Running daemonized with no stdout in this case?
[2012-12-28 23:52:05 -0500] sascha_d: @kallistec  I was running by hand with debug and trying to figure out where in the recipe set it was puking.  And I'd forgotten I'd changed the notifies line so I was looking at some other blocks and trying to make sure I'd fixed all my metadata depends when I deleted a recipe in one cookbook and created a brand new cookbook
