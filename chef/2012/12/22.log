[2012-12-22 00:03:07 -0500] mrk: grep version /var/chef/cache/cookbooks/*/metadata.rb
[2012-12-22 00:03:14 -0500] mrk: this "Sorts" of help
[2012-12-22 00:26:20 -0500] c_t: well that's odd
[2012-12-22 00:26:53 -0500] c_t: had a cookbook puke over some variables defined in an environment when the same variables are fine when defined in a role
[2012-12-22 00:31:28 -0500] iverson0881: c_t: is that node defined in that environment?
[2012-12-22 00:31:44 -0500] iverson0881: c_t: and are you using node syntax when defining the variables?
[2012-12-22 00:31:50 -0500] iverson0881: in your template
[2012-12-22 00:34:54 -0500] c_t: they both sure appear to be defined the same way
[2012-12-22 00:35:11 -0500] c_t: but one way it complains about using a symbol as an array index
[2012-12-22 00:35:29 -0500] c_t: turning to shef to suss it out
[2012-12-22 00:41:02 -0500] c_t: huh, and now it works
[2012-12-22 00:47:11 -0500] c_t: and it only seemed to work because I was uploading the wrong role file
[2012-12-22 01:03:30 -0500] c_t: oh dear
[2012-12-22 01:03:50 -0500] c_t: so yeah, saving the environment file before uploading it goes a long way
[2012-12-22 01:19:37 -0500] occupant: host chef is acting slow
[2012-12-22 01:19:40 -0500] occupant: er, hosted
[2012-12-22 01:35:01 -0500] psykidellic: Has anybody tried installing 9.2 with the chef cookbook (using chef-solo) and I get: https://gist.github.com/4356952
[2012-12-22 01:41:37 -0500] psykidellic: Hmm, creating the folder manually 9.2/main fixes the issue. Not sure if its a bug or anything. Looking at: https://github.com/opscode-cookbooks/postgresql - I cannot seem to be able to create an issue. How do you guys report it to the author?
[2012-12-22 01:44:06 -0500] miah: tickets.opscode.com
[2012-12-22 01:48:00 -0500] psykidellic: Thanks. Hmm, well - not sure what happened, i created the 9.2 folder, ran the cookbook again and I see 9.1 being installed.
[2012-12-22 01:48:11 -0500] psykidellic: And /etc/postgresql has both 9.1 and 9.2
[2012-12-22 01:48:15 -0500] psykidellic: Hmm
[2012-12-22 05:43:20 -0500] Schuyler: question: why does 'knife search' fail to find a data bag?
[2012-12-22 05:43:56 -0500] Schuyler: I can `knife data bag show bag_name item_id` and that works great
[2012-12-22 05:44:15 -0500] Schuyler: but `knife search bag_name "*:*"` fails to return anything
[2012-12-22 05:44:45 -0500] Schuyler: ah I need to put in -- before the query?
[2012-12-22 06:29:23 -0500] sn0wb1rd: How can I write resource/provider in my cookbook? Not the Lightweight one. I would like to write real resource/provider.
[2012-12-22 06:32:11 -0500] yfeldblum: sn0wb1rd, LW are almost exactly like real
[2012-12-22 06:32:39 -0500] yfeldblum: sn0wb1rd, and if you just want to write the surrounding class definitions, you can just put them in a library file (my-cb/libraries/my_resource.rb)
[2012-12-22 06:33:04 -0500] sn0wb1rd: Hmm.. I wanted to write like the resources and providers in chef.
[2012-12-22 06:33:04 -0500] yfeldblum: sn0wb1rd, why do you not want LW/
[2012-12-22 06:33:50 -0500] sn0wb1rd: This will be a huge resource supporting volumes on the cloud.
[2012-12-22 06:33:56 -0500] yfeldblum: sn0wb1rd, you can write your LW resources and providers just like the ones that come in chef ... you can define methods, set instance variables, etc just like in a normal class
[2012-12-22 06:34:24 -0500] sn0wb1rd: Can you point me to some examples?
[2012-12-22 06:44:23 -0500] yfeldblum: sn0wb1rd, http://pastie.org/private/br0gbgegc0794xqy57znlw
[2012-12-22 06:45:45 -0500] sn0wb1rd: yfeldblum: Thanks. I just looked at Chef's File resource and trying to implement mine by taking that as an example.
[2012-12-22 06:46:00 -0500] yfeldblum: sn0wb1rd, ok
[2012-12-22 12:22:55 -0500] jwcarman: Is it a common idiom to have an attribute represent the name of a service for a recipe?
[2012-12-22 12:23:29 -0500] jwcarman: For example default[:myrecipe][:myservice] = "mysvc"
[2012-12-22 12:23:48 -0500] jwcarman: then in your recipe you'd do service node[:myrecipe][:myservice] do
[2012-12-22 12:24:13 -0500] jwcarman: It seems a bit over-engineered for my taste, but I'm new to chef, so I could very well be missing something.
[2012-12-22 12:24:33 -0500] jwcarman: I understand that services are named something completely different on different operating systems, so perhaps that's why?
[2012-12-22 12:25:09 -0500] jwcarman: But, if this current cookbook is intended to be run only on redhat (we only have a redhat init script for it), then that seems a bit over-engineered
[2012-12-22 12:36:10 -0500] Fapiko: personally I'd just do a which in the block that defines the service
[2012-12-22 12:36:17 -0500] Fapiko: for the different operating systems
[2012-12-22 12:36:37 -0500] jwcarman: They already do that!
[2012-12-22 12:36:47 -0500] jwcarman: But, they still parameterize the name for some reason
[2012-12-22 12:37:00 -0500] Fapiko: I tend to operate in a very iterative fashion though, I don't pull anything out into an attribute until the first time I need to change it
[2012-12-22 12:37:18 -0500] jwcarman: Yeah, that's what I am all about YAGNI!
[2012-12-22 12:37:26 -0500] jwcarman: The simplest thing that works, man
[2012-12-22 12:38:07 -0500] jwcarman: Too bad they don't have file specificity for recipes
[2012-12-22 12:38:26 -0500] jwcarman: To avoid having to put a big case statement in my recipe
[2012-12-22 12:39:46 -0500] jwcarman: You can boil the ocean trying to make recipes as parameterized as possible, IMHO
[2012-12-22 12:40:00 -0500] Fapiko: lol
[2012-12-22 12:40:12 -0500] jwcarman: Or, you can just get down to business and get the job done.
[2012-12-22 12:40:14 -0500] Fapiko: Yeah not paramaterizing enough has bitten me in the ass though
[2012-12-22 12:40:20 -0500] Fapiko: when handing cookbooks off to dev teams
[2012-12-22 12:40:21 -0500] jwcarman: I can imagine that
[2012-12-22 12:40:35 -0500] Fapiko: because they like to copy paste all over
[2012-12-22 12:40:46 -0500] jwcarman: Gotcha
[2012-12-22 12:40:57 -0500] jwcarman: I guess there's a balance
[2012-12-22 12:41:22 -0500] Fapiko: Really that just comes down to them not really knowing Chef and trying to meet the deadlines though,
[2012-12-22 12:42:51 -0500] jwcarman: Well, I'm in that "not really knowing Chef" boat at the moment.
[2012-12-22 12:43:11 -0500] jwcarman: I mean, the concepts are simple enough, but it's just getting my hands dirty and understanding how folks typically write these things
[2012-12-22 13:15:24 -0500] jwcarman: Do most folks use minitest or chefspec or both?
[2012-12-22 13:15:53 -0500] jwcarman: Or, something completely different?
[2012-12-22 13:23:16 -0500] jwcarman: Is there a way to generically define an init script for a service?
[2012-12-22 13:23:30 -0500] jwcarman: For instance, if I just say template "/etc/init.d/myservice" do
[2012-12-22 13:23:56 -0500] jwcarman: Then, that's kind of tied to redhat's (among others) way of doing things.
[2012-12-22 13:24:16 -0500] jwcarman: There is no init_template resource or something that I can use?
[2012-12-22 13:24:50 -0500] jwcarman: You can use file specificity to choose the right init script based on the operating system inside that
[2012-12-22 13:25:38 -0500] jwcarman: Perhaps it would be just as easy to define a helper method somewhere init_script("myservice") to use?
[2012-12-22 16:17:26 -0500] j0sh112: hi
[2012-12-22 18:34:02 -0500] emanuelez: I have a template file and I would love to trigger an event when a specific field of the rendered file gets changed. think for example a change of some config file where only if some very specific option is changed, a service needs to be restarted. any hint?
[2012-12-22 18:49:26 -0500] anarchist: why do i have to enter my password four times in a row when i do "knife cook ssh@xx.xx.xxx.xxx" on chef-solo?
[2012-12-22 18:49:36 -0500] anarchist: is there a way to prevent that?
[2012-12-22 19:16:47 -0500] anarchist: [2012-12-22T19:14:39+00:00] FATAL: Errno::ENOENT: git[/root/chef] (chef::default line 9) had an error: Errno::ENOENT: No such file or directory - git ls-remote https://github.com/opscode/chef.git master <-- any reason why i should get something like this?
[2012-12-22 19:17:06 -0500] anarchist: i'm following this thing http://stackoverflow.com/questions/11769219/check-out-a-git-repository-with-chef
[2012-12-22 19:29:03 -0500] anarchist: maybe it didn't have git yet so anyway i just did execute to apt-get update and grab git and do the clone manually that way
[2012-12-22 19:29:23 -0500] anarchist: still annoying to have to enter my password four times when cooking a node in chef-solo. wonder if anyone knows how to get rid of that?
[2012-12-22 20:03:31 -0500] chip-: git password?
[2012-12-22 20:03:51 -0500] chip-: use an ssh key and set up host key forwarding for your Vagrant box
[2012-12-22 20:11:03 -0500] jwcarman: I have a case where I need to delete the contents of a directory whenever the contents of a template changes (via notifies)
[2012-12-22 20:11:39 -0500] jwcarman: Right now, it's set up as an execute resource with command "rm -f /mydir/*"
[2012-12-22 20:12:17 -0500] jwcarman: I would rather use Ruby code to do the deletion (FileUtils.rm_r(Dir.blob("/mydir/*")), though
[2012-12-22 20:12:43 -0500] jwcarman: What sort of resource can I use here to notify.  This resource shouldn't run when it's defined.
[2012-12-22 20:14:38 -0500] jwcarman: oh, "nothing" is an action on everything?
[2012-12-22 20:15:11 -0500] chip-: Can the directory itself be deleted, or only its contents?
[2012-12-22 20:15:50 -0500] jwcarman: just the contents
[2012-12-22 20:15:55 -0500] jwcarman: it's a logs directory
[2012-12-22 20:16:32 -0500] jwcarman: Can I mark a ruby_block resource as action :nothing and then notify it later with action :create?
[2012-12-22 20:16:42 -0500] jwcarman: :create doesn't sound like what I want
[2012-12-22 20:16:50 -0500] jwcarman: I want to actually execute the ruby block
[2012-12-22 20:17:09 -0500] chip-: so your case is: template changes, delete all files in a  directory?
[2012-12-22 20:17:20 -0500] jwcarman: chip-: yessir
[2012-12-22 20:17:41 -0500] jwcarman: I've got a template resource that I want to notify another resource immediately
[2012-12-22 20:18:08 -0500] jwcarman: and the that will notify the service to restart (the logs directory is for the service)
[2012-12-22 20:18:38 -0500] jwcarman: Now, I'm "inheriting" this code, so if this doesn't sound like the way to go, then I'm all ears.  I am open to suggestions
[2012-12-22 20:19:35 -0500] chip-: So the pattern I'd usually use is to delete the directory entirely, contents and all
[2012-12-22 20:20:05 -0500] jwcarman: chip-: and then "mkdir" it again?
[2012-12-22 20:20:10 -0500] chip-: Right
[2012-12-22 20:20:25 -0500] chip-: One sec
[2012-12-22 20:20:27 -0500] jwcarman: And, you'd use resources for both actions
[2012-12-22 20:20:57 -0500] jwcarman: I really hate dropping out to a shell if I don't have to.  Doesn't seem very "chefy"
[2012-12-22 20:20:59 -0500] chip-: That gets interesting.
[2012-12-22 20:21:04 -0500] chip-: Yeah never drop to shell if you don't have to
[2012-12-22 20:21:26 -0500] jwcarman: chip-: Okay, glad to hear I'm not crazy! :)
[2012-12-22 20:22:49 -0500] chip-: One sec, testing some code.
[2012-12-22 20:22:58 -0500] jwcarman: chip-: no worries
[2012-12-22 20:23:08 -0500] jwcarman: chip-: I appreciate your time
[2012-12-22 20:28:35 -0500] chip-: jwcarman: https://gist.github.com/4360918
[2012-12-22 20:29:22 -0500] chip-: subsequent runs will only take action if the template changes or if the directory doesn't exist.
[2012-12-22 20:30:34 -0500] chip-: Without that :immediately, the notification might queue to the end of the Chef run, but we need it to happen the minute it's called so our next action can re-create the directory.
[2012-12-22 20:34:32 -0500] jwcarman: ok, and if I want the re-create to notify something else (restart the service), then I can do it there?
[2012-12-22 20:36:14 -0500] chip-: Yeah, you could notify from the directory create.
[2012-12-22 20:36:42 -0500] chip-: Generally not to use :immediately with service restarts though
[2012-12-22 20:36:48 -0500] chip-: *best not to
[2012-12-22 20:39:07 -0500] jwcarman: I'm not
[2012-12-22 20:39:11 -0500] jwcarman: it's just queueing that one
[2012-12-22 20:39:59 -0500] chip-: I didn't try that with a file in /var/log/foobar btw
[2012-12-22 20:41:08 -0500] jwcarman: oh, never attempted it with a non-empty dir?
[2012-12-22 20:41:24 -0500] jwcarman: let's see what happens! :)
[2012-12-22 21:18:51 -0500] jwcarman: non-empty dir doesn't work :(
[2012-12-22 21:19:04 -0500] jwcarman: chip-: non-empty dir doesn't work
[2012-12-22 21:20:22 -0500] chip-: Okay, then we do another thing and use a subscription.
[2012-12-22 21:20:53 -0500] chip-: Come to think of it this might even be cleaner.
[2012-12-22 21:22:04 -0500] jwcarman: Ok, so I do the ole switcheroo on it
[2012-12-22 21:22:19 -0500] jwcarman: So, my log remover thing subscribes to the template?
[2012-12-22 21:23:53 -0500] tamouse__: so, just in case anyone remembers what i was working on, i managed to change one line from true to false and DID NOT BREAK EVERYTHING!!!
[2012-12-22 21:24:06 -0500] tamouse__: this, in ops-land, is unheard of, i think, for a non-ops person to do.
[2012-12-22 21:26:57 -0500] chip-: Something close. Looping a few tests right now.
[2012-12-22 21:27:05 -0500] chip-: (Hooray for Vagrant & Berkshelf!)
[2012-12-22 21:29:27 -0500] chip-: https://gist.github.com/4361279
[2012-12-22 21:30:20 -0500] chip-: Need to use subscription here instead of notification to get the :recursive attribute for the directory resource.
[2012-12-22 21:31:17 -0500] chip-: (I may be wrong about that, but this appears to work as expected)
[2012-12-22 21:34:50 -0500] tamouse__: eepadeep
[2012-12-22 21:39:53 -0500] jwcarman: oh, ok, thanks.  looking...
[2012-12-22 21:39:57 -0500] jwcarman: Thanks for the poke
[2012-12-22 21:41:03 -0500] jwcarman: You're subscribing to the :delete action on the template?
[2012-12-22 21:41:10 -0500] jwcarman: When does that fire?
[2012-12-22 21:41:33 -0500] jwcarman: I subscribed to the "create"
[2012-12-22 21:41:48 -0500] jwcarman: of course, I don't know if it worked, but that's what I tried
[2012-12-22 21:42:17 -0500] chip-: I'm subscribing a :delete action to any change in the template.
[2012-12-22 21:42:31 -0500] chip-: If the template resource takes any action, the folder will be deleted recursively.
[2012-12-22 21:42:32 -0500] chip-: http://docs.opscode.com/chef/resources.html#subscribes-syntax
[2012-12-22 21:44:00 -0500] chip-: The subscription is not specifying the action on the remote resource, but the local resource; the subscription triggers on any successful action on the remote resource.
[2012-12-22 21:44:12 -0500] jwcarman: ahhh, ok
[2012-12-22 21:44:21 -0500] jwcarman: Makes more sense :)
[2012-12-22 21:44:31 -0500] jwcarman: Again, I'm a sous chef at the moment
[2012-12-22 21:45:05 -0500] chip-: Hey man, if you're looking to do it with Chef declarations instead of just converting an existing shell or ruby script into a bunch of exec blocks, you're already leveling pretty quick.
[2012-12-22 21:45:56 -0500] jwcarman: I'm trying.  As a developer, I like to stick to the norms and what makes sense
[2012-12-22 21:46:01 -0500] jwcarman: Kind of a stickler that way
[2012-12-22 21:46:25 -0500] tamouse__: make sure to write your configuration tests first, then
[2012-12-22 21:47:28 -0500] tamouse__: crikey
[2012-12-22 21:48:06 -0500] tamouse__: anyway, one of my office mates and i agreed we needed to do a chef bootcamp
[2012-12-22 21:48:14 -0500] tamouse__: and start using chef on our personal projects
[2012-12-22 21:48:41 -0500] jwcarman: where would you do the notification to restart the service?
[2012-12-22 21:48:53 -0500] jwcarman: on the second directory create?
[2012-12-22 21:49:31 -0500] chip-: Either in your template or in the directory create.
[2012-12-22 21:50:13 -0500] chip-: If the daemon won't start without the directory in place (and it might be worth checking to see if the daemon will create the log dir for you if it isn't present, or if the daemon will puke, or if the daemon will silently just not log; these are good things to know), then maybe on...
[2012-12-22 21:50:28 -0500] chip-: Hm.
[2012-12-22 21:50:31 -0500] chip-: One sec. I want to try something.
[2012-12-22 21:52:09 -0500] chip-: It's been bothering me that we're calling the same resource twice.
[2012-12-22 21:52:44 -0500] jwcarman: Yeah, feels "dirty"
[2012-12-22 21:53:51 -0500] chip-: I've never tried to figure out whether notifications fire before subscriptions or vice versa
[2012-12-22 21:54:48 -0500] chip-: okay cool.
[2012-12-22 21:55:54 -0500] chip-: Looks like it's dependent on ordering, so it's intuitive. Good deal.
[2012-12-22 21:57:11 -0500] chip-: jwcarman: https://gist.github.com/4361420
[2012-12-22 21:57:22 -0500] chip-: That should get you full idempotence.
[2012-12-22 21:57:58 -0500] jwcarman: You have both subscribe and notifies in there?
[2012-12-22 21:58:08 -0500] chip-: Multiple notifies, even!
[2012-12-22 21:59:31 -0500] jwcarman: so, the subscribes takes care of deleting
[2012-12-22 21:59:40 -0500] jwcarman: and the first notifies takes care of creating the directory
[2012-12-22 21:59:54 -0500] jwcarman: second notifies takes care of queueing the service restart
[2012-12-22 21:59:58 -0500] chip-: Yup
[2012-12-22 22:00:07 -0500] chip-: Top-down ordering.
[2012-12-22 22:00:19 -0500] jwcarman: when you notify the delete, does it use the previously-declared resource matching that or does it do it in-line?
[2012-12-22 22:00:30 -0500] jwcarman: because I need to set owner/mode on that dir, too
[2012-12-22 22:00:59 -0500] chip-: Should use the previously declared resource matching.
[2012-12-22 22:01:31 -0500] jwcarman: We're not supposed to use "recursive" on our directory creates (some crazy rule they have at the client)
[2012-12-22 22:01:33 -0500] chip-: I need to just log in and make a gist instead of throwing away new ones on this.
[2012-12-22 22:01:45 -0500] chip-: The recursive is there for the delete, really.
[2012-12-22 22:01:51 -0500] jwcarman: Should I create a separate directory :delete that subscribes to the template and have only that be recursive?
[2012-12-22 22:02:14 -0500] jwcarman: I know why the recursive is there, to support non-empty dirs
[2012-12-22 22:02:17 -0500] chip-: Yeah, give it action :nothing and subscribe that one.
[2012-12-22 22:02:27 -0500] chip-: Rules is rules.
[2012-12-22 22:02:38 -0500] jwcarman: I can have the :delete directory resource be action :nothing and have it subscribe with :delete and be recursive
[2012-12-22 22:02:45 -0500] jwcarman: :)
[2012-12-22 22:02:57 -0500] jwcarman: Sounds like we're thinking the same way about it
[2012-12-22 22:04:33 -0500] jwcarman: So, which one happens first?
[2012-12-22 22:04:37 -0500] jwcarman: The subscription or the notify?
[2012-12-22 22:04:56 -0500] jwcarman: I guess I could have my delete notify the create?
[2012-12-22 22:07:04 -0500] chip-: I think it's dependent on resource ordering in the recipe
[2012-12-22 22:07:16 -0500] chip-: if you moved the subscribe below then I think it'd fire after the notify, but you should experiment.
[2012-12-22 22:07:22 -0500] jwcarman: How about this
[2012-12-22 22:07:37 -0500] jwcarman: 1 directory (non-recursive) for the create
[2012-12-22 22:08:13 -0500] jwcarman: 1 directory (recursive) that's action :nothing and it subscribes to the template.  It notifies the 1st directory create immediately and then notifies the service to restart
[2012-12-22 22:08:44 -0500] jwcarman: oh, and the subscription is :delete directory[foo] immediately
[2012-12-22 22:11:51 -0500] jwcarman: https://gist.github.com/4361476
[2012-12-22 22:11:58 -0500] jwcarman: chip-: something like that
[2012-12-22 22:13:26 -0500] chip-: I think notifying create on a resource that has the same name as the resource calling the notification might cause you problems.
[2012-12-22 22:13:32 -0500] jwcarman: chip-: obviously this is to avoid the whole recursive create
[2012-12-22 22:13:43 -0500] jwcarman: crap!
[2012-12-22 22:13:55 -0500] jwcarman: talk about recursive! :)
[2012-12-22 22:27:11 -0500] jwcarman: chip-: thanks for your help.  It's greatly appreciated.  I'll pay it forward, once I get skillz up
[2012-12-22 22:27:34 -0500] chip-: No problem, helps me hone my own skill set.
[2012-12-22 22:28:45 -0500] jwcarman: chip-: very true!  Cheers!
[2012-12-22 22:33:49 -0500] bdha: pkgrm: ERROR: unable to remove existing directory at </>
[2012-12-22 22:33:52 -0500] bdha: Heh.
[2012-12-22 22:34:01 -0500] bdha: Probably for the best, Chef SunOS package.
[2012-12-22 22:35:50 -0500] cwj: heheh
