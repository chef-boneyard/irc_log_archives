[2014-03-28 00:00:50 -0400] tabolario: coderanger: I'd love to actually, the main Rails app setup cookbook I wrote is finally using LWRPs for everything, except I stuck all the concrete recipes for our apps into the same cookbook
[2014-03-28 00:01:24 -0400] tabolario: If I open sourced it I'd have a much better excuse to test-kitchen it all up
[2014-03-28 00:01:39 -0400] smcracraft: Also, I just did knife configure -i
[2014-03-28 00:01:49 -0400] smcracraft: After backing up knife.rb first
[2014-03-28 00:02:02 -0400] tabolario: Not a lot of time to backfill all the nice testing things these days :/
[2014-03-28 00:49:36 -0400] q[mrw]: hi all, we can inspect node info in chef-shell is there any historical record of how a node's info has changed over time, how might I access that?
[2014-03-28 00:50:47 -0400] coderanger: q[mrw]: No, chef-server doesn't do versioning
[2014-03-28 00:50:56 -0400] q[mrw]: fml
[2014-03-28 00:51:09 -0400] coderanger: q[mrw]: At some point that may be a feature of Enterprise Chef
[2014-03-28 00:51:17 -0400] coderanger: Its been talked about for a few years
[2014-03-28 00:51:35 -0400] q[mrw]: trying to recover some mount options that have changed
[2014-03-28 00:51:41 -0400] coderanger: The API doesn't even expose mtimes
[2014-03-28 00:52:02 -0400] coderanger: q[mrw]: If it wasn't in git, your best bet is your postgres backups
[2014-03-28 00:56:15 -0400] q[mrw]: thanks..
[2014-03-28 00:58:56 -0400] coderanger: :-(
[2014-03-28 01:55:37 -0400] segv: jkeiser ping
[2014-03-28 02:00:01 -0400] kbarry_: I want to "include_recipe" but am getting a warning saying i need to "depends" in my metadata
[2014-03-28 02:00:12 -0400] coderanger: kbarry_: Indeed you do
[2014-03-28 02:00:30 -0400] kbarry_: :) so...... what metadata?
[2014-03-28 02:00:34 -0400] kbarry_: MAybe I am doing thir wrong,
[2014-03-28 02:00:56 -0400] coderanger: kbarry_: the metadata.rb for the cookbook
[2014-03-28 02:01:04 -0400] kbarry_: I have a recipe, and the recipe just has a "include_recipe 'java'"
[2014-03-28 02:01:13 -0400] kbarry_: but not everything in the cookbook requires it
[2014-03-28 02:01:25 -0400] kbarry_: actually just this one recipe (of 30 so far)
[2014-03-28 02:01:33 -0400] kbarry_: (well, 20-30)
[2014-03-28 02:02:45 -0400] coderanger: Indeed, but the whole cookbook has to depend on the java cookbook
[2014-03-28 02:02:53 -0400] coderanger: kbarry_: What language are you most familiar with?
[2014-03-28 02:03:00 -0400] coderanger: (I can adapt my analogy to that :)
[2014-03-28 02:06:56 -0400] kbarry_: hahahahahahahaha
[2014-03-28 02:07:02 -0400] kbarry_: crap.
[2014-03-28 02:07:28 -0400] kbarry_: is there a "depends_on" that can go inside a recipe?
[2014-03-28 02:07:52 -0400] kbarry_: meh, it can't be that bad to have this cookbook depend on java
[2014-03-28 02:08:20 -0400] coderanger: kbarry_: The dependency graph has to be evaluated ahead of time so all the cookbooks are downloaded and ready
[2014-03-28 02:08:29 -0400] kbarry_: gotcha
[2014-03-28 02:08:37 -0400] coderanger: Adding a depends won't actually run any recipes in that cookbook
[2014-03-28 02:09:54 -0400] kbarry_: right
[2014-03-28 02:31:15 -0400] gkra: uh... Why is the mount resource claiming action umount is up to date when the fs is clearly mounted?
[2014-03-28 02:32:06 -0400] gkra: oh shoot
[2014-03-28 02:32:16 -0400] ohlol: might be a stale mount
[2014-03-28 02:32:17 -0400] ohlol: ?
[2014-03-28 02:32:18 -0400] gkra: because the path is different than what I thought.
[2014-03-28 02:32:30 -0400] gkra: and "mount" is all "yup no filesystem here!"
[2014-03-28 02:32:33 -0400] gkra: 'cause, well, there isn't.
[2014-03-28 02:32:36 -0400] gkra: *facepalm*
[2014-03-28 02:32:38 -0400] ohlol: ah
[2014-03-28 03:06:05 -0400] gkra: okay, I'm being burned by a normal attribute that shouldn't be there.
[2014-03-28 05:03:51 -0400] daxroc: How do I get nginx - passenger to use the rbenv gem path ?
[2014-03-28 05:14:23 -0400] coderanger: daxroc: You need to compile passenger with the rbenv ruby I think
[2014-03-28 05:14:38 -0400] Popsikle|2: chef search is going to put me in the ground one day
[2014-03-28 05:15:21 -0400] Popsikle: coderanger: you ever see this: http://pastebin.com/CD6B1Dvn
[2014-03-28 05:16:08 -0400] coderanger: Check if you have any deeper nested key also called roles
[2014-03-28 05:16:20 -0400] coderanger: I'll be in and out, have to go start some lasagna cooking
[2014-03-28 05:16:40 -0400] Popsikle: mmmm
[2014-03-28 05:16:41 -0400] Popsikle: lasagna
[2014-03-28 05:16:44 -0400] Popsikle: im going to bed
[2014-03-28 05:16:59 -0400] daxroc: coderanger: using default['languages']['ruby']['gems_dir'] , 'ruby_bin' ?
[2014-03-28 05:17:56 -0400] Popsikle: no, there is no deeper key called roles, unless it is hidden when i do a knife node edit
[2014-03-28 05:21:35 -0400] brucelee_: coderanger: yo you there?
[2014-03-28 05:22:18 -0400] daxroc: coderanger: do you know how nginx - passenger are idempotent, do they create locks *source?
[2014-03-28 05:22:50 -0400] daxroc: How would you triger a reinstall ?
[2014-03-28 05:24:32 -0400] Popsikle: oh shit. coderanger. I have deep nested attribs in a cookbook that are named roles
[2014-03-28 05:24:47 -0400] Popsikle: that makes shef search even dumber imho
[2014-03-28 05:26:36 -0400] Popsikle: default['logstash_templates']['roles']['logstash'] = ["syslog","auth","msgpack"] for example
[2014-03-28 05:42:32 -0400] coderanger: Popsikle: That would do it
[2014-03-28 05:42:35 -0400] coderanger: brucelee_: I am now
[2014-03-28 05:42:46 -0400] Popsikle: that does nto seem silly to you
[2014-03-28 05:42:51 -0400] Popsikle: i mean i undestand why
[2014-03-28 05:43:20 -0400] brucelee_: coderanger: im using cloudwatch for my instance
[2014-03-28 05:43:21 -0400] Popsikle: but there shoudl be a way to specify depth in the search I guess
[2014-03-28 05:43:33 -0400] brucelee_: and i have ids setup now detecting that its listening on the private IP on port 64430
[2014-03-28 05:43:38 -0400] brucelee_: but only every once in a while for just a short while
[2014-03-28 05:43:43 -0400] brucelee_: any ideas what it could be?
[2014-03-28 05:43:49 -0400] coderanger: Popsikle: Given how the system works, that isn't possible
[2014-03-28 05:44:06 -0400] Popsikle: standard opscode response ;p
[2014-03-28 05:44:25 -0400] coderanger: Popsikle: I don't work there, but I am familiar with the search code
[2014-03-28 05:44:40 -0400] coderanger: Popsikle: It expands ahead of time when the data is inserted into solr
[2014-03-28 05:44:42 -0400] brucelee_: coderanger: i'd like to believe this instance wasnt haxed... but im not sure how cloudwatch works, im not sure if it hooks into the instance and somehow controls it to listen on some random port for cloudwatch
[2014-03-28 05:44:43 -0400] Popsikle: yea, I know you dont work there ;)
[2014-03-28 05:44:47 -0400] coderanger: solr doesn't grok the nesting level
[2014-03-28 05:45:01 -0400] anthroprose: brucelee_: cloudwatch dosn't hook
[2014-03-28 05:45:02 -0400] coderanger: brucelee_: No idea, sorry
[2014-03-28 05:45:16 -0400] brucelee_: np :p
[2014-03-28 05:45:25 -0400] anthroprose: there are metadata services that tie into the linux dstros by default if aws amis
[2014-03-28 05:45:45 -0400] anthroprose: like dhcp scripts for doing routing/ip
[2014-03-28 05:45:52 -0400] Popsikle: knife exec delete attrs and then re-run chef on all nodes takes forever.  This may be running most of the night, so I am really going to bed now.
[2014-03-28 05:45:54 -0400] anthroprose: but it's 'from the hypervisor' level info
[2014-03-28 05:46:02 -0400] Popsikle: thanks again coderanger ;) night
[2014-03-28 05:49:03 -0400] brucelee_: anthroprose: would that somehow make the instance start listening on a random port
[2014-03-28 05:49:15 -0400] brucelee_: its not random actually, it does it unpredictably, but its always same port
[2014-03-28 05:49:18 -0400] brucelee_: 64400 or something
[2014-03-28 05:58:08 -0400] anthroprose: brucelee_: that I have no idea, it could be anything, but I have never noticed that when running ids on my aws instances
[2014-03-28 05:58:15 -0400] anthroprose: hop on the machine & tcpdump or something
[2014-03-28 07:59:24 -0400] PapaSierra: i'm trying to learn berkshelf the right way, i think i understand that for each of my server types i want one cookbook right?
[2014-03-28 07:59:37 -0400] n1ko: yep
[2014-03-28 08:00:13 -0400] PapaSierra: so instead of cookbook(my project) with recipes (app server/db server/cache server), i actually want cookbook(my project db server) recipe (default)
[2014-03-28 08:00:34 -0400] n1ko: yes
[2014-03-28 08:00:45 -0400] PapaSierra: awesome, i'll try again ;)
[2014-03-28 08:00:59 -0400] n1ko: the cookbook is a wrapper, so basicly in there you have the generic depencies
[2014-03-28 08:01:28 -0400] n1ko: and the specialization that the specific project db-server needs (certain scheme for example)
[2014-03-28 08:02:34 -0400] PapaSierra: right cool, i'm working towards that now. how do you name your cookbooks?
[2014-03-28 08:03:01 -0400] PapaSierra: so my project is ACME, my servers are Proxy, App, Cache, DB. how would you name those?
[2014-03-28 08:58:26 -0400] daxroc: Morning all
[2014-03-28 09:00:40 -0400] daxroc: I've been trying to create a Nginx, Passenger, rbenv and rails vm with chef. I can't seem to get passenger to build with the rbenv version of ruby (2.1.1). Here's the attributes I have driving the cookbooks https://gist.github.com/daxroc/b0de27c5b9224f0baad5
[2014-03-28 09:03:29 -0400] daxroc: * What does happen is it builds with the chef ruby.
[2014-03-28 09:10:36 -0400] daxroc: Can anyone point me in the right direction on how to get nginx::passenger to compile with the right ruby?
[2014-03-28 10:01:52 -0400] daxroc: anyone come across this before? http://pastebin.com/ppwG3VNg
[2014-03-28 10:02:10 -0400] daxroc: nginx , passgener failing on rake
[2014-03-28 10:04:17 -0400] daxroc: I'm guessing because it can't find rake
[2014-03-28 10:49:38 -0400] jesser: is there a mailing list i can ask omnibus questions on?
[2014-03-28 10:52:09 -0400] m4rcu5: i have an empty attribute "location": { "platform": null }, and i would like to search for that, but how? "location_platform:null" does not seem to work
[2014-03-28 11:01:57 -0400] Er00: I'm having a bit of weirdness that doesn't seem to be anything anyone else has come across (from a quick Google) - nginx isn't coming up on installing and configuring chef-server. I tracked it down to the key and crt files not being created in nginx/ca and not being specified in the nginx conf file, but I don't know *why* this is
[2014-03-28 11:02:18 -0400] Er00: I can manually work around it but then I'm also getting other weirdness (ERROR: URI::InvalidURIError: the scheme https does not accept registry part: :443 (or bad hostname?)
[2014-03-28 11:02:22 -0400] Er00: ) on uploading cookbooks
[2014-03-28 11:02:35 -0400] Er00: despite my chef_server_url being specified (and not specified as blank)
[2014-03-28 11:02:52 -0400] Er00: suspect the two might be related but I'm not sure how to start figuring this out, anyone come across anything like that before? :s
[2014-03-28 12:02:56 -0400] mhenrixon: should I ever have to run commands as sudo?
[2014-03-28 12:07:06 -0400] Er00: Just in case anyone ever happens across this log while searching for the above problem - I *think* I've resolved it all by changing my hostname to be an fqdn (which I thought it already was -.-)
[2014-03-28 12:15:59 -0400] bixu: Seeing tons of this error in my chef-client logs: "Encoding::InvalidByteSequenceError: "\xC3" on US-ASCII"
[2014-03-28 12:16:15 -0400] bixu: Anyone know what might be causing this?
[2014-03-28 12:17:15 -0400] bixu: We've been looking through our site cookbooks for this string, but no love so far.
[2014-03-28 12:26:48 -0400] iroller: Ohai Chefs. Is there a way to track who uploaded the cookbook/role/etc. ?
[2014-03-28 12:36:15 -0400] jascbu: Does anyone know of any nagios cookbooks other than the "nagios" listed on community.opscode.com?
[2014-03-28 12:36:34 -0400] jascbu: I'm just looking for a very basic install version
[2014-03-28 13:13:15 -0400] bixu: Update on the weird characters issue.  It seems to be a problem with the 'npm' cookbook we are using (tests to see if an npm package is installed by grepping for the weird asciart chars in the output of 'npm list')...
[2014-03-28 13:13:51 -0400] bixu: We are testing with the all-in-on 'node' cookbook now (which uses a less spooky mechanism for determining npm package status).
[2014-03-28 14:22:27 -0400] aspiers: how can I use helper methods within the action block of an LWRP but outside a platform resource block? I want to avoid having to reference the full name of the module providing the helpers each time I call a helper
[2014-03-28 14:23:25 -0400] aspiers: doing include or extend outside the action block seems to act on a Chef::Provider singleton class, whereas inside the action block, self is the Chef::Provider::MyLWRP class
[2014-03-28 14:31:43 -0400] programmerq: has anyone ever tried hosting multiple open source chef instances behind a single nginx server?
[2014-03-28 14:52:19 -0400] queuetue: Hi.  Im attempting to use chef to provision vagrant instances of ubuntu on os x using berkshelf is just not working - even with berkshelf edge and vagrant 1.5, OSX specific recipes are obviously being run on the linux box, causing failure.  (homebrew and xcode as part of build-essentials for instance)  Is there another direction to tackle this?
[2014-03-28 15:44:34 -0400] jascbu: Does anyone know of any nagios cookbooks other than the "nagios" listed on community.opscode.com?  Just looking for a very basic install version.
[2014-03-28 15:52:27 -0400] PaulB010102: question, I am seeing beam.smp thrashing... and my chef-server isn't loading cookbooks or the webui
[2014-03-28 15:52:41 -0400] PaulB010102: anyone have advice about fixing?
[2014-03-28 15:53:01 -0400] Er00: PaulB010102: I saw someone mention that problem before and updating their chef-server fixed it so check you're running latest version first
[2014-03-28 15:53:10 -0400] PaulB010102: ok will do thank you
[2014-03-28 16:06:53 -0400] GreatSUN: hi all
[2014-03-28 16:07:50 -0400] GreatSUN: I just got following issue: chef-server contains files in subdirectories of files/default, but chef-client does not download them
[2014-03-28 16:08:06 -0400] GreatSUN: chef-version 10.12
[2014-03-28 16:08:24 -0400] GreatSUN: any idea why this might happen and how I could bypass this issue?
[2014-03-28 16:23:28 -0400] tcotav: do you have cookbook_file in your recipe telling chef-client that it needs them?
[2014-03-28 16:40:49 -0400] troyready: Anyone know offhand a simple way (or recipe example) to determine whether a RHEL node is registered to redhat via the new subscription system or the legacy RHN Classic system?
[2014-03-28 16:44:27 -0400] jidar: does rhel still use up2date?
[2014-03-28 16:44:45 -0400] jidar: or whatever its called, you might be able to check that for a exit 0 status
[2014-03-28 16:50:01 -0400] troyready: I think up2date is the really old tool
[2014-03-28 16:50:35 -0400] thom: [tmay@chelsvnean001 ~]$ sudo up2date
[2014-03-28 16:50:35 -0400] thom: sudo: up2date: command not found
[2014-03-28 16:50:35 -0400] thom: [tmay@chelsvnean001 ~]$ lsb_release -d
[2014-03-28 16:50:36 -0400] thom: Description:CentOS release 6.3 (Final)
[2014-03-28 16:50:41 -0400] thom: doesn't look good
[2014-03-28 16:51:00 -0400] thom: ah, that's a centos node, but i just checked a rhel one and the same result
[2014-03-28 16:53:32 -0400] troyready: I see a '/etc/sysconfig/rhn/systemid' on a node registered via RHN Classic
[2014-03-28 16:53:58 -0400] troyready: Is that same file present on nodes registered via the new subscription management?
[2014-03-28 17:01:02 -0400] Nukepuppy: 'yum' ")
[2014-03-28 17:06:15 -0400] jidar: troyready: yea its been years since I ran a real honest to god rhel server
[2014-03-28 17:07:08 -0400] jidar: you also don't want to depend on lsb_release when possible, you could just look for the /etc/*release file instead
[2014-03-28 17:07:24 -0400] jidar: it's not always installed, but the /etc/ file is (iirc)
[2014-03-28 17:08:37 -0400] troyready: The tough part is that all of our systems are RHN classic now, so I don't have a new style subscription management node to compare
[2014-03-28 17:09:20 -0400] troyready: I'll just assume ...systemid indicates RHN classic for now and cry later if I'm wrong
[2014-03-28 17:11:04 -0400] EricL_: I've had a decom fail 3 times in a row.  It transfers all the files of and then as soon as it's done throws this error: Exception in thread "main" java.lang.RuntimeException: org.apache.cassandra.exceptions.ReadTimeoutException: Operation timed out - received only 0 responses.
[2014-03-28 17:11:27 -0400] EricL_: Receives like 6 hours worth of hints and then resumes being a regular node in a LEAVING state (which also mkes no sense to me)
[2014-03-28 17:11:40 -0400] EricL_: It continues to accept READs and WRITEs.
[2014-03-28 17:11:48 -0400] EricL_: This seems broken.
[2014-03-28 17:18:44 -0400] doomviking: yawn
[2014-03-28 17:28:22 -0400] bixu: I have what might be kind of a tough troubleshooting problem, to do with illegal characters when the 'postgresql' cookbook calls 'node.save'.
[2014-03-28 17:28:34 -0400] bixu: Anybody feel like digging in?
[2014-03-28 17:34:36 -0400] dstynchula: I need a hand with method definitions. I thought I could define a class and method then call it with class.method()
[2014-03-28 17:34:38 -0400] dstynchula: https://gist.github.com/dstynchula/9837558
[2014-03-28 17:34:51 -0400] dstynchula: Each of the blocks of code run in chef-shell
[2014-03-28 17:35:23 -0400] dstynchula: but I'm missing something. How do I call the methods I've deifned?
[2014-03-28 17:50:54 -0400] bixu: I figured my issue out.  Somehow $LANG was not set on a few of our systems.  exporting that before a chef-client run got things sorted (and then I think one of the community cookbooks set it properly?)
[2014-03-28 17:51:17 -0400] scalp42: locale cookbook maybe?
[2014-03-28 17:53:06 -0400] bixu: scalp42: I'm not sure.
[2014-03-28 17:58:41 -0400] Nukepuppy: bixu magic shell
[2014-03-28 17:58:42 -0400] Nukepuppy: look it up
[2014-03-28 17:58:44 -0400] Nukepuppy: it can do that
[2014-03-28 17:58:59 -0400] Nukepuppy: https://github.com/customink-webops/magic_shell
[2014-03-28 17:59:10 -0400] Nukepuppy: magic_shell_environment 'EDITOR' do
[2014-03-28 17:59:11 -0400] Nukepuppy:   value 'vim'
[2014-03-28 17:59:11 -0400] Nukepuppy: end
[2014-03-28 17:59:18 -0400] Nukepuppy: could of been anything.. but ya know.
[2014-03-28 17:59:34 -0400] bixu: Nukepuppy: We don't use that, but we could to *fix* this.
[2014-03-28 18:19:44 -0400] pcn: Has anyone used knife-vsphere to spin up a ubuntu 12 VM?
[2014-03-28 18:19:55 -0400] pcn: I'm having a problem where it comes up with the virtual nic "disconnected"
[2014-03-28 18:20:41 -0400] dstynchula: pcn: check the udev rules
[2014-03-28 18:20:55 -0400] dstynchula: I've had that come up with cloned machines in the past.
[2014-03-28 18:21:35 -0400] pcn: dstynchula: that's interesting.  Any tips on what I should specifically be looking for?
[2014-03-28 18:21:54 -0400] dstynchula: there's a file /etc/udev/rules.d/70-persistent-net.rules
[2014-03-28 18:22:51 -0400] dstynchula: http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1032790
[2014-03-28 18:23:04 -0400] dstynchula: It sounds to me like that may be what you're running into.
[2014-03-28 18:23:05 -0400] dstynchula: :)
[2014-03-28 18:23:33 -0400] troyready: pcn, we had similar issues when we switched to distributed switches in vsphere
[2014-03-28 18:23:41 -0400] troyready: (I might not have my terminology 100% correct)
[2014-03-28 18:24:15 -0400] troyready: Ended up needing to change the template VM configurations to more closely match the target system
[2014-03-28 18:25:06 -0400] dstynchula: Ok, so I have been working on this cookbook, and I'm really close.
[2014-03-28 18:25:10 -0400] dstynchula: https://gist.github.com/dstynchula/9839601
[2014-03-28 18:25:29 -0400] pcn: dstynchula: that KB link says its fixed in 10.10.  I'm not seeing the problem of the device dissappearing.
[2014-03-28 18:25:43 -0400] pcn: dstynchula: the device is present, but vmware lists the interface as "not connected"
[2014-03-28 18:25:45 -0400] dstynchula: pcn: Try rm'ing that file and reboot.
[2014-03-28 18:25:53 -0400] dstynchula: it may or may not work,
[2014-03-28 18:26:10 -0400] dstynchula: worst case, restore the snapshot, or move the file back.
[2014-03-28 18:26:52 -0400] dstynchula: Anyhow,
[2014-03-28 18:27:04 -0400] dstynchula: in https://gist.github.com/dstynchula/9839601 I use a chef 'bash' resource
[2014-03-28 18:27:09 -0400] dstynchula: within a class
[2014-03-28 18:27:29 -0400] dstynchula: ERROR: undefined method `bash' for #<Class:0x00000003ed18b0>::Mdadm
[2014-03-28 18:27:51 -0400] dstynchula: what do I need to include to call chef resources?
[2014-03-28 18:31:41 -0400] coderanger: dstynchula: You can't use the DSL in library functions
[2014-03-28 18:31:45 -0400] coderanger: dstynchula: Those are just plain Ruby
[2014-03-28 18:32:00 -0400] coderanger: dstynchula: If you want to build abstractions like that, use LWRPs or normal resource classes
[2014-03-28 18:32:32 -0400] dstynchula: I dont understand.
[2014-03-28 18:32:37 -0400] dstynchula: I'm sorry.
[2014-03-28 18:33:25 -0400] dstynchula: What's a DSL?
[2014-03-28 18:35:36 -0400] hasrb: I'd like to create a chef plugin to just ease running "ufw block from xxx.xxx.xxx.xxx", is there just a simple method to run a command in a plugin on a set of nodes? I know that I can query for those nodes.
[2014-03-28 18:35:40 -0400] coderanger: dstynchula: The Chef resource stuff
[2014-03-28 18:35:50 -0400] coderanger: dstynchula: calls like execute 'foo' do  end
[2014-03-28 18:35:58 -0400] coderanger: dstynchula: Thats the Chef recipe DSL
[2014-03-28 18:36:05 -0400] coderanger: DSL == domain-specific language
[2014-03-28 18:36:05 -0400] dstynchula: ahh
[2014-03-28 18:36:16 -0400] dstynchula: ok, so I cant use chef resources in a class?
[2014-03-28 18:36:16 -0400] hasrb: Once I've queried and obtained the nodes I'd like to act against, what's the method to run some command against the nodes?
[2014-03-28 18:36:19 -0400] coderanger: hasrb: Make a recipe?
[2014-03-28 18:36:46 -0400] coderanger: hasrb: I mean you could do it from knife ssh, but that would kind of be against the point of Chef
[2014-03-28 18:36:49 -0400] dstynchula: hasrb: knife ssh
[2014-03-28 18:37:10 -0400] hasrb: I use knife ssh currently, just looking to convert that to a chef plugin for our org
[2014-03-28 18:37:49 -0400] coderanger: hasrb: Chef doesn't have plugins, so I'm not sure what you mean by that
[2014-03-28 18:38:01 -0400] hasrb: knife ssh role:web_server "sudo ufw deny from xxx.xxx.xxx.", looking to just have knife block_ips --ip_addresses=xxx.xxx.xxx,xxx.xxx.xxx.xxx
[2014-03-28 18:38:03 -0400] jperry: ohai everyone!
[2014-03-28 18:38:14 -0400] hasrb: coderanger: sorry, knife plugin
[2014-03-28 18:38:15 -0400] coderanger: hasrb: Just make a Chef recipe that executes that command :)
[2014-03-28 18:39:04 -0400] jperry: recently our chef server just had some serious problems (stop responding) and we think it was due to a cookbook being locked in an environment file that didn't exist
[2014-03-28 18:39:10 -0400] jperry: anyone run into this before
[2014-03-28 18:39:20 -0400] jperry: @juliancdunn ^^^ ever here of this
[2014-03-28 18:39:55 -0400] coderanger: jperry: Yes, its a common problem
[2014-03-28 18:40:00 -0400] coderanger: jperry: No fix other than "don't do that"
[2014-03-28 18:40:12 -0400] coderanger: jperry: And sigkill any erchef process that pegs the CPU for too long
[2014-03-28 18:40:38 -0400] hasrb: coderanger: I suppose I could store that in a data bag and just have the recipe use that, can I just run a single recipe?
[2014-03-28 18:40:45 -0400] coderanger: hasrb: Makes sense to me
[2014-03-28 18:40:56 -0400] coderanger: hasrb: (other than my near-pathological dislike of bags)
[2014-03-28 18:41:16 -0400] coderanger: jperry: In general, unsolvable constraint sets will more of than not send the server into a tail spin
[2014-03-28 18:41:32 -0400] jperry: @coderanger thanks, this explains a lot
[2014-03-28 18:41:45 -0400] jperry: I think it just stopped taking requests
[2014-03-28 18:41:58 -0400] coderanger: jperry: Probably because the CPU was melting
[2014-03-28 18:41:59 -0400] jperry: the servers were up but haproxy was returning 504
[2014-03-28 18:42:12 -0400] dstynchula: coderanger: So, there's no include statement I can use to use DSL inside of a custom class?
[2014-03-28 18:42:32 -0400] coderanger: dstynchula: The simple answer is no, the long answer if yes but you need to do it in a very very specific way
[2014-03-28 18:44:45 -0400] jperry: coderanger: do you know of any good validation tools that will check the environment file before pushing it to the chef server?
[2014-03-28 18:44:53 -0400] coderanger: jperry: No such tool exists
[2014-03-28 18:44:57 -0400] jperry: ah okay
[2014-03-28 18:45:07 -0400] coderanger: jperry: There is literally nothing you can do except watch your CPU metrics carefully :-(
[2014-03-28 18:45:22 -0400] coderanger: jperry: A fix is planned in server 11.1, but that has no ETA
[2014-03-28 18:46:20 -0400] coderanger: dstynchula: Because I happen have it open, see https://github.com/balanced-cookbooks/rundeck/blob/poise/libraries/rundeck.rb for an example of using the DSL in a resource class
[2014-03-28 18:46:28 -0400] coderanger: dstynchula: Making an LWRP is far easier though
[2014-03-28 18:46:44 -0400] jperry: we use knife spork to do the promotion but if your pointing at a local chef server that has it the promote will gladly succeed
[2014-03-28 18:47:08 -0400] coderanger: jperry: The problem isn't tied to envs anyway
[2014-03-28 18:47:09 -0400] jperry: coderanger: thx.  Is there a jira ticket against this?
[2014-03-28 18:47:18 -0400] coderanger: jperry: It can happen with bad dependencies too
[2014-03-28 18:47:22 -0400] jperry: coderanger: oh
[2014-03-28 18:47:32 -0400] coderanger: jperry: Yeah, there is, but the ticket is long finished
[2014-03-28 18:47:36 -0400] jperry: so any time it has to resolve a version that doesn't exist it can get into this tail spin
[2014-03-28 18:47:48 -0400] coderanger: The code is done and live on hosted chef, they just haven't ported/released it AFAIK
[2014-03-28 18:47:58 -0400] coderanger: jperry: Not just "doesn't exist"
[2014-03-28 18:48:06 -0400] coderanger: Any unsolvable constraint set can trigger it
[2014-03-28 18:48:35 -0400] jperry: aside from cookbook version locking or a cookbook that doesn't exist what else wouldn't resolve?
[2014-03-28 18:49:01 -0400] coderanger: jperry: Two constraints that can't both be satisfied
[2014-03-28 18:49:30 -0400] coderanger: like a depends on x ~> 1.0, b depends on x ~> 2.0
[2014-03-28 18:49:39 -0400] coderanger: If you put a and b in a run list together, badness
[2014-03-28 18:49:40 -0400] jperry: I see
[2014-03-28 18:51:30 -0400] dstynchula: pcn: did it work for you?
[2014-03-28 18:56:34 -0400] PaulB010102: has anyone seen the error "Unable to solve constraints, the following solutions were attempted"
[2014-03-28 18:56:43 -0400] PaulB010102: ERROR: 412 "Precondition Failed"
[2014-03-28 18:56:53 -0400] pcn: dstynchula: I'm going through and re-installing from the iso
[2014-03-28 18:59:50 -0400] coderanger: PaulB010102: You have an unsolvable constraint set, either because of cookbook dependencies or environment settings
[2014-03-28 19:05:27 -0400] PaulB010102: ok, i am still starting and have not pinned version contraints to my environments
[2014-03-28 19:05:46 -0400] PaulB010102: and the my own cookbooks do not have pinned dependencies yet either
[2014-03-28 19:06:21 -0400] coderanger: PaulB010102: The error message should contain some deubgging info about the failure
[2014-03-28 19:06:49 -0400] PaulB010102: https://gist.github.com/paulblizzard/e7636a07625cbdfeca12
[2014-03-28 19:12:12 -0400] MrHeavy: Is there anything special about file:/// URL handling in remote_file? The docs suggest it should work, but trying to use it gives weird errors that suggest parsing issues
[2014-03-28 19:12:42 -0400] coderanger: PaulB010102: Go through all those subsets and look for the conflict
[2014-03-28 19:12:48 -0400] PaulB010102: ok
[2014-03-28 19:12:52 -0400] PaulB010102: (am doing so now)
[2014-03-28 19:12:54 -0400] pcn: dstynchula: I was using the open-vm-tools, this time I went with vmware tools.  It seems like that's necessary.
[2014-03-28 19:13:06 -0400] coderanger: PaulB010102: https://gist.github.com/coderanger/9198932
[2014-03-28 19:13:19 -0400] coderanger: MrHeavy: Why would you do that?
[2014-03-28 19:13:39 -0400] MrHeavy: coderanger: Third-party cookbook, not my remote_file
[2014-03-28 19:13:43 -0400] MrHeavy: I don't want a remote_file, I want a local file
[2014-03-28 19:13:44 -0400] MrHeavy: Easy!
[2014-03-28 19:14:28 -0400] MrHeavy: No point constantly shoveling this 20 MB file back and forth from an S3 bucket when it only needs to be in my Vagrant synced directory
[2014-03-28 19:14:29 -0400] coderanger: MrHeavy: Fix the cookbook :-)
[2014-03-28 19:14:40 -0400] MrHeavy: The cookbook already works fine if remote_file works as documented
[2014-03-28 19:14:54 -0400] MrHeavy: My question is whether remote_file actually works as documented, i.e. if anyone else has gotten this working ;)
[2014-03-28 19:15:49 -0400] MrHeavy: It gives me this:
[2014-03-28 19:15:51 -0400] MrHeavy: Connection refused - Connection refused connecting to : for /vagrant/datastax-agent-4.1.1-standalone.jar/file:///vagrant/datastax-agent-4.1.1-standalone.jar, giving up
[2014-03-28 19:17:20 -0400] coderanger: MrHeavy: https://github.com/opscode/chef/blob/master/lib/chef/provider/remote_file/local_file.rb is the code
[2014-03-28 19:17:56 -0400] coderanger: MrHeavy: And https://github.com/opscode/chef/blob/master/lib/chef/provider/remote_file/fetcher.rb#L32-L33
[2014-03-28 19:18:01 -0400] coderanger: MrHeavy: What version of Chef are you using?
[2014-03-28 19:18:14 -0400] coderanger: MrHeavy: You should see the gem version in the paths of the traceback
[2014-03-28 19:19:45 -0400] MrHeavy: 11.4.4
[2014-03-28 19:19:54 -0400] coderanger: MrHeavy: How are you computing the URI to give it?
[2014-03-28 19:20:47 -0400] MrHeavy: The path is file:///vagrant/datastax-agent-4.1.1-standalone.jar, which is the URI corresponding to that file, I'm not computing anything
[2014-03-28 19:21:06 -0400] MrHeavy: Rather, it's not being dynamically constructed or anything
[2014-03-28 19:21:11 -0400] coderanger: MrHeavy: Hmm, please pastebin the full traceback
[2014-03-28 19:21:22 -0400] PaulB010102: https://gist.github.com/paulblizzard/3caab11a34a6fe418e71
[2014-03-28 19:21:41 -0400] segv: so uhh
[2014-03-28 19:21:44 -0400] segv: nm
[2014-03-28 19:22:20 -0400] coderanger: PaulB010102: There you go, looks pretty clear to me :)
[2014-03-28 19:22:43 -0400] segv: jkeiser filled out that CLA
[2014-03-28 19:22:53 -0400] PaulB010102: build-essential
[2014-03-28 19:22:54 -0400] segv: Sent the CCLA to legal ;)
[2014-03-28 19:24:18 -0400] coderanger: PaulB010102: Yeah, your mysql cookbook wants 1.x, other stuff wants 2.x
[2014-03-28 19:25:12 -0400] PaulB010102: great, thank you very much for your help
[2014-03-28 19:26:26 -0400] MrHeavy: coderanger: Ignore everything, looks like it was a bug in that version and it works fine in 11.10
[2014-03-28 19:26:28 -0400] MrHeavy: Ugh :<
[2014-03-28 19:28:58 -0400] jkeiser: segv: ?
[2014-03-28 19:29:52 -0400] jkeiser: segv: the Chef CLA?  I sort of hope that Chef has signed a CCLA for Chef
[2014-03-28 19:31:05 -0400] werdnativ: if I try describe command "ruby --version" in serverspec, it fails with "ruby not found" but when I kitchen login, it's there. I wonder if it's missing a login shell for rbenv?
[2014-03-28 19:31:36 -0400] werdnativ: Is there a better way to make things like that work everywhere?
[2014-03-28 19:40:46 -0400] segv: jkeiser (i'm xorl on github) haha sorry!
[2014-03-28 19:41:25 -0400] CPS: when you run 'knife upload .' does it remove files from the server that no longer exist in the git repo?
[2014-03-28 19:42:10 -0400] n1ko: CPS: what does upload imply :)
[2014-03-28 19:43:41 -0400] CPS: i've learned not to guess with chef
[2014-03-28 19:44:46 -0400] pstengel: Doesnt look Chefs User provider supports the force flag for userdel. Anyone suggest a solution for this?
[2014-03-28 19:55:18 -0400] Nukepuppy: ya know how some crap wants you to do 'php install.php' on certain packages
[2014-03-28 19:55:29 -0400] Nukepuppy: is there something smart in chef to handle that?
[2014-03-28 19:55:32 -0400] Nukepuppy: or just do execute?
[2014-03-28 20:09:31 -0400] jkeiser: segv: aha!
[2014-03-28 20:09:41 -0400] jkeiser: CPS: it does not.  If you pass --purge, however, it will.
[2014-03-28 20:09:53 -0400] segv: or -P :D
[2014-03-28 20:09:57 -0400] segv: for shorthand
[2014-03-28 20:10:30 -0400] jkeiser: I'm a little surprised I made a shorthand option for that honestly :)  I despise shorthand options in general
[2014-03-28 20:11:21 -0400] segv: I may be incorrect with that actually
[2014-03-28 20:12:14 -0400] segv: jkeiser yep I was wrong, another command has the shorthand
[2014-03-28 20:12:36 -0400] jkeiser: I try to only offer them when something is going to typed a *lot* and I want to encourage someone typing it
[2014-03-28 20:13:00 -0400] CPS: is there a way to do the chef compile to see what the compiled recipe looks like?
[2014-03-28 20:13:24 -0400] segv: you can perform a dry-run
[2014-03-28 20:14:14 -0400] CPS: what's the flag for that?
[2014-03-28 20:18:36 -0400] CPS: segv: -W doesn't show the compiled resources
[2014-03-28 20:18:43 -0400] CPS: just what the log would look like
[2014-03-28 20:18:58 -0400] segv: ah, not sure off the top of my head
[2014-03-28 21:15:16 -0400] segv: jkeiser how do I push an encrypted data bag key to the server with metal?
[2014-03-28 21:15:30 -0400] segv: saw some code in your cheffish library
[2014-03-28 21:15:34 -0400] segv: was just curious as to how
[2014-03-28 21:15:49 -0400] jkeiser: segv: there is a machine_file resource you can use: machine_file '/path/on/remote/machine' do
[2014-03-28 21:15:54 -0400] segv: ah
[2014-03-28 21:15:55 -0400] segv: sweet!
[2014-03-28 21:15:56 -0400] segv: thanks
[2014-03-28 21:16:02 -0400] jkeiser:   local_path '/path/on/local/machine'
[2014-03-28 21:16:05 -0400] jkeiser:   machine 'machine'
[2014-03-28 21:16:06 -0400] segv: that saves me a lot of work
[2014-03-28 21:16:31 -0400] jkeiser: Use "action :download" if you want to download, :upload is the default
[2014-03-28 21:17:01 -0400] segv: kk
[2014-03-28 21:17:09 -0400] jkeiser: segv: I would kind of like to get the files uploaded *before* the first converge, but I haven't built that in yet
[2014-03-28 21:17:21 -0400] segv: jkeiser yeah I noticed you have the
[2014-03-28 21:17:26 -0400] segv: "upload_file" functions as well
[2014-03-28 21:17:30 -0400] segv: would be useful to use those
[2014-03-28 21:17:39 -0400] jkeiser: segv: it's what machine_file does :)
[2014-03-28 21:17:41 -0400] segv: ah
[2014-03-28 21:17:51 -0400] jkeiser: segv: the issue is that if you have machine 'x' do recipe 'uses_data_bag' end
[2014-03-28 21:18:08 -0400] jkeiser: segv: and the machine isn't constructed yet
[2014-03-28 21:18:14 -0400] jkeiser: segv: there's nothing to upload to :)
[2014-03-28 21:18:18 -0400] jkeiser: segv: the workaround for now...
[2014-03-28 21:18:55 -0400] jkeiser: is machine 'x' do ... <no recipes, just create machine> ... end; machine_file ...; machine 'x' do ... <now add the recipes> ... end
[2014-03-28 21:19:13 -0400] segv: got it
[2014-03-28 21:19:15 -0400] jkeiser: segv: i.e. create the machine without any recipes, then upload what you need, then add the recipes you want and converge
[2014-03-28 21:19:33 -0400] segv: yeah makes sense
[2014-03-28 21:19:40 -0400] segv: gets rid of the chicken before the egg syndrome
[2014-03-28 21:19:45 -0400] jkeiser: I'm looking for a more elegant way to solve this very common problem but I haven't hit on the thing that feels right yet
[2014-03-28 21:20:30 -0400] jkeiser: Could end up just being a "file" attribute on the machine that means "upload this file before converge"
[2014-03-28 21:21:00 -0400] segv: true
[2014-03-28 21:21:06 -0400] segv: it would be nice to have
[2014-03-28 21:21:19 -0400] segv: file "blah" do; action :upload;end
[2014-03-28 21:21:34 -0400] segv: just expand upon the current file functionality
[2014-03-28 21:24:21 -0400] jkeiser: segv: yeah ... though even "remote_file" didn't follow that strategy
[2014-03-28 21:24:29 -0400] segv: yeah
[2014-03-28 21:26:00 -0400] segv: jkeiser so the machine_file encompasses the machine block?
[2014-03-28 21:26:11 -0400] segv: oh nm
[2014-03-28 21:26:15 -0400] segv: misread what you pasted
[2014-03-28 21:26:19 -0400] segv: window chopped it off
[2014-03-28 21:32:47 -0400] segv: hmmm getting a 404
[2014-03-28 21:33:59 -0400] carmstrong: does anyone know if I can use Chef to see if the run was launched using Vagrant? Is checking for the existence of /vagrant trustworthy?
[2014-03-28 21:34:57 -0400] coderanger: carmstrong: No
[2014-03-28 21:35:21 -0400] coderanger: carmstrong: checking for a user named vagrant is probably better
[2014-03-28 21:35:23 -0400] coderanger: but not by much
[2014-03-28 21:35:32 -0400] coderanger: carmstrong: Make it explicit though
[2014-03-28 21:35:43 -0400] coderanger: carmstrong: Set an attribute in your vagrantfile to do whatever it is you want
[2014-03-28 21:35:52 -0400] carmstrong: coderanger: Good idea
[2014-03-28 21:35:56 -0400] carmstrong: thanks
[2014-03-28 21:42:36 -0400] mhenrixon: anyone have any ideas why a command like sudo /usr/local/ruby/2.1.1/bin/bundle install --deployment --retry 3 --jobs 8 --without development test cucumber staging --path /vendor/bundle would work in test kitchen but not on the real server?
[2014-03-28 21:42:39 -0400] mhenrixon: It hangs
[2014-03-28 21:43:43 -0400] mhenrixon: Bundler::Source::Git::GitCommandError Git error: command `git clone 'git://github.com/RushPlay/active_campaign.git' "/vendor/bundle/ruby/2.1.0/cache/bundler/git/active_campaign-990e1094d57a38700ed6f1a1a1a116c2e6cf925e" --bare --no-hardlinks --quiet` in directory /app/casinosagastage.com/api has failed.
[2014-03-28 21:43:58 -0400] mhenrixon: works on my test machine but not on the node
[2014-03-28 21:45:23 -0400] coderanger: mhenrixon: disk space?
[2014-03-28 21:45:37 -0400] coderanger: mhenrixon: Or possibly SSH host key verification?
[2014-03-28 21:45:45 -0400] mhenrixon: it must be the ssh host thing
[2014-03-28 21:46:01 -0400] mhenrixon: how the hell am I supposed to install gems on ubuntu?
[2014-03-28 21:47:31 -0400] tscanausa: use chef to install gems.
[2014-03-28 21:47:59 -0400] mhenrixon: tscanausa that isn't valid for a rails application using bundler
[2014-03-28 21:48:15 -0400] coderanger: mhenrixon: https://github.com/balanced-cookbooks/ci/blob/master/libraries/ci_deploy_key.rb#L81-L86
[2014-03-28 21:48:22 -0400] coderanger: mhenrixon: Thats how I fix that with github
[2014-03-28 21:48:33 -0400] coderanger: mhenrixon: You can also disable host key checking
[2014-03-28 21:48:42 -0400] mhenrixon: @coderanger I already did and it is working fine in development mode
[2014-03-28 21:48:50 -0400] mhenrixon: I mean in my test kitchen setup
[2014-03-28 21:49:04 -0400] mhenrixon: same ubuntu give or take in production/staging
[2014-03-28 21:50:11 -0400] mhenrixon: https://gist.github.com/e6232f2a8b6b90882949
[2014-03-28 21:50:28 -0400] mhenrixon: I removed the token to add it though
[2014-03-28 21:51:42 -0400] mhenrixon: https://github.com/jordanyaker/chef-bundler maybe that could be used... no idea
[2014-03-28 21:53:48 -0400] drywheat: does anyone know where to grab an org validator pem for hosted chef?
[2014-03-28 21:53:59 -0400] coderanger: drywheat: You can't, you'll have to reset it
[2014-03-28 21:54:03 -0400] drywheat: it's been a while, i forgot and now i need to provide it to a new user
[2014-03-28 21:54:07 -0400] drywheat: ah
[2014-03-28 21:54:14 -0400] drywheat: so i can give them a copy of mine
[2014-03-28 21:54:17 -0400] drywheat: for the org
[2014-03-28 21:54:26 -0400] dstynchula: yep
[2014-03-28 21:54:40 -0400] coderanger: drywheat: Indeed
[2014-03-28 21:54:47 -0400] drywheat: thx dudes
[2014-03-28 22:42:36 -0400] mhenrixon: package 'node' do
[2014-03-28 22:42:36 -0400] mhenrixon:   action :purge
[2014-03-28 22:42:37 -0400] mhenrixon: end
[2014-03-28 22:42:37 -0400] mhenrixon: include_recipe 'base_server::apt_repos'
[2014-03-28 22:42:38 -0400] mhenrixon: execute 'add-apt-repository -y ppa:chris-lea/node.js'
[2014-03-28 22:42:38 -0400] mhenrixon: execute 'apt-get -q -y update'
[2014-03-28 22:42:39 -0400] mhenrixon: execute 'apt-get -q -y install python-software-properties python g++ make nodejs'
[2014-03-28 22:42:39 -0400] mhenrixon: package 'nodejs'
[2014-03-28 22:42:42 -0400] mhenrixon: gaah sorry
[2014-03-28 22:42:54 -0400] mhenrixon: https://gist.github.com/3e48deac725fc2f40f96
[2014-03-28 22:43:16 -0400] mhenrixon: I want to make sure that code only runs if the version of the currently installed nodejs is less than something
[2014-03-28 22:43:45 -0400] mhenrixon: I know I can provide only_if block to a resource but can I do that for include recipe as well?
[2014-03-28 22:45:09 -0400] coderanger: kallistec: Whats the current Right Way to get a tempfile in Chef?
[2014-03-28 22:46:02 -0400] coderanger: kallistec: Read: Should I use https://github.com/opscode/chef/blob/6add21a97e5abe996abfe50950f72bdd19a3c0b2/lib/chef/file_content_management/tempfile.rb?
[2014-03-28 23:02:35 -0400] kallistec: coderanger: I think just using ruby's built-in tempfile is the way to go.
[2014-03-28 23:02:53 -0400] kallistec: Which I hesitate to say because some of that code is really frustrating
[2014-03-28 23:04:33 -0400] kallistec: coderanger: though if your resource is some sort of File resource subclass, I could see using the FileContentManagement thing
[2014-03-28 23:11:46 -0400] dstynchula: How can I write a def so that one step finishes before beginning the next?
[2014-03-28 23:13:10 -0400] cheflevelramen: Ohai Chefs. Have a question about Vagrant and Chef. Basically, I'd like to test a cookbook in multiple environments without changing the Vagrant file. I have a cookbook that sets up an application slightly differently for dev, test, prod. The documentation doesn't seem to give an answer. Any ideas?
