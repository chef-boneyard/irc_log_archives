[2014-03-19 00:07:55 -0400] chefuser: Hello, is there a way to pass an entire databag in a recipe to a template to resolve all the values without setting each individual one?
[2014-03-19 00:10:32 -0400] coderanger: chefuser: Sure, do what you said :)
[2014-03-19 00:20:55 -0400] doomviking: heh
[2014-03-19 00:38:41 -0400] fayesal: erchef 11.0.11 seems to get itself stuck with several processes busy spinning an empty epoll_wait event list with 0 timeout.  the supplied rabbitmq used to do it too, so I replaced that with the new version which fixes the bug they had (handling hangup during reserve).  I don't know if erchef's problem is the same one?
[2014-03-19 00:40:03 -0400] fayesal: by replaced, I mean gave the config to the system rabbitmq and administered the embedded rabbit down.
[2014-03-19 00:40:35 -0400] coderanger: fayesal: Are you intentionally running a dev build?
[2014-03-19 00:40:47 -0400] coderanger: Or is that actually the latest because they changed the numbering
[2014-03-19 00:40:57 -0400] coderanger: Lovely
[2014-03-19 00:40:58 -0400] coderanger: >_<
[2014-03-19 00:41:35 -0400] fayesal: I'm just running the latest 11 downloaded from get chef today.
[2014-03-19 00:41:47 -0400] shlant: I assume it's not possible to do something like node.default['minitest']['recipes'] << recipe in a role?
[2014-03-19 00:42:00 -0400] coderanger: Yeah, they changed the numbering
[2014-03-19 00:42:06 -0400] coderanger: I have to now go write an angry email
[2014-03-19 01:09:44 -0400] fayesal: does anyone know how to get etop on ubuntu 12.04?
[2014-03-19 01:11:47 -0400] fayesal: or an enough erlang to help debug why erchef is eating all my cpus
[2014-03-19 01:18:41 -0400] fayesal: I've seen mention of etop but I haven't found where that's located yet.
[2014-03-19 01:23:35 -0400] coderanger: fayesal: Almost always it is a depsolver loop
[2014-03-19 01:24:11 -0400] fayesal: is there a tool to compute where the problem is?
[2014-03-19 01:24:34 -0400] coderanger: fayesal: Unfortunately its very manual :-(
[2014-03-19 01:24:34 -0400] fayesal: I'm guessing something that needs uploading?
[2014-03-19 01:24:37 -0400] fayesal: there's zip in the log
[2014-03-19 01:24:47 -0400] coderanger: fayesal: https://gist.github.com/coderanger/9198932
[2014-03-19 01:25:05 -0400] coderanger: fayesal: Use that snippet with various run lists you use until you find one that doesn't resolve
[2014-03-19 01:25:37 -0400] coderanger: then recurse into dependencies until you find the minimal set of cookbooks that fails to resolve
[2014-03-19 01:25:41 -0400] coderanger: and then use that to find your conflict
[2014-03-19 01:27:27 -0400] coderanger: I should really package this up as a plugin or something eventually
[2014-03-19 01:27:46 -0400] coderanger: but if I just wait until April I can hopefully guilt people into releasing the fixed chef-server
[2014-03-19 01:27:57 -0400] fayesal: sigh
[2014-03-19 01:30:54 -0400] fayesal: fails to resolve will be an exception?
[2014-03-19 01:32:05 -0400] fayesal: I'm getting recipe lists for all my run lists so far
[2014-03-19 01:37:05 -0400] coderanger: fayesal: No, it will just take a while
[2014-03-19 01:37:10 -0400] coderanger: (i.e. hours)
[2014-03-19 01:37:18 -0400] coderanger: (usually)
[2014-03-19 01:37:27 -0400] fayesal: there's nothing I can look through logs to find?
[2014-03-19 01:37:32 -0400] coderanger: fayesal: No
[2014-03-19 01:37:49 -0400] fayesal: it's almost like opscode have never worked ops :D
[2014-03-19 01:38:19 -0400] coderanger: fayesal: Protip, don't make product features that depend on solving an NP complete problem
[2014-03-19 01:38:29 -0400] fayesal: heh
[2014-03-19 01:38:54 -0400] coderanger: fayesal: The new solver in chef 11 just turned out to be not viable, so chef-server is going back to the old gecode-based one
[2014-03-19 01:39:08 -0400] coderanger: fayesal: Hosted chef already switched, but they haven't released it for the FOSS version
[2014-03-19 01:39:16 -0400] coderanger: feel free to poke people about this being uncool
[2014-03-19 01:39:39 -0400] fayesal: I guess that's why it isn't getting patched?
[2014-03-19 01:39:47 -0400] fayesal: This doesn't appear to be my problem.
[2014-03-19 01:40:03 -0400] patmaddox: Hi I've set up a default attribute in environments/production.rb and done a "knife environment from file environments/production.rb" Unfortunately I can't seem to reference that attribute from a recipe. Here's a little gist with an example: https://gist.github.com/patmaddox/9633594
[2014-03-19 01:40:23 -0400] [ROOT]XxNeoLiTHi: has anyone used HAproxy in front of a chef enterprise standalone setup?
[2014-03-19 01:40:34 -0400] coderanger: [ROOT]XxNeoLiTHi: Why would you?
[2014-03-19 01:41:17 -0400] coderanger: fayesal: It is possible it is something else, but run away CPU usage from erchef is almost always depsolver
[2014-03-19 01:41:17 -0400] [ROOT]XxNeoLiTHi: I need to have the chef server on an internal only IP and reach it from a centralized HAproxy open to internet
[2014-03-19 01:41:55 -0400] [ROOT]XxNeoLiTHi: I have mine setup but its HTTP 500
[2014-03-19 01:41:56 -0400] coderanger: [ROOT]XxNeoLiTHi: It should be okay but you need to make sure chef-server knows its own hostname correctly, used when generating URLs
[2014-03-19 01:42:05 -0400] [ROOT]XxNeoLiTHi: 'on me after I attempt to login through proxy
[2014-03-19 01:43:17 -0400] [ROOT]XxNeoLiTHi: do you know of any example chef configs where they used any HAProxy at all in front of the chef server?
[2014-03-19 01:43:26 -0400] [ROOT]XxNeoLiTHi: *any proxy my bad
[2014-03-19 01:43:46 -0400] coderanger: [ROOT]XxNeoLiTHi: No, chef-server already ships its own nginx proxy internally
[2014-03-19 01:43:51 -0400] coderanger: so thats what most people use
[2014-03-19 01:45:29 -0400] coderanger: patmaddox: If you run `knife environment show production` do you see it?
[2014-03-19 01:46:44 -0400] patmaddox: coderanger: nope. weird. why might that be?
[2014-03-19 01:47:26 -0400] coderanger: patmaddox: did you knife environment from file succeed?
[2014-03-19 01:47:37 -0400] coderanger: amd/or did osmeone else overwrite it?
[2014-03-19 01:48:07 -0400] patmaddox: coderanger: yeah it did succeed. but I figured it out thanks to your tip... I guess you can't call default_attributes twice
[2014-03-19 01:48:22 -0400] patmaddox: I had two lines of default attributes, one set that chef_user and another was a much longer one
[2014-03-19 01:48:47 -0400] coderanger: Ahh yeah
[2014-03-19 01:49:08 -0400] coderanger: The Ruby DSL isn't much of a DSL
[2014-03-19 02:03:50 -0400] someara: booom
[2014-03-19 02:07:34 -0400] atomic-penguin: bada-bing
[2014-03-19 02:08:47 -0400] someara: coderanger I fixed motd-tail for ya
[2014-03-19 02:09:56 -0400] coderanger: someara: Perfect!
[2014-03-19 02:10:01 -0400] coderanger: someara: thanky :)
[2014-03-19 02:10:04 -0400] coderanger: someara: subclassing ftw
[2014-03-19 02:13:26 -0400] coderanger: someara: Reminds me I really want to sit down with smart people at chefconf and figure out how to make extensible templates :-)
[2014-03-19 03:07:08 -0400] a13x212: Unsolvable versions!, how do i know what cookbooks are missing?
[2014-03-19 03:37:08 -0400] doug1: What happens if I put multiple attribute files in /attributes?
[2014-03-19 03:39:58 -0400] a13x212: anyone using the mysql cookbook? getting ERROR: Cookbook mysql depends on cookbook 'build-essential' version '~> 1.4',
[2014-03-19 03:40:12 -0400] a13x212: i have build-essential   2.0.1
[2014-03-19 03:41:23 -0400] coderanger: a13x212: It hasn't been updated yet
[2014-03-19 03:41:29 -0400] coderanger: doug1: They get loaded in alpha order
[2014-03-19 03:42:16 -0400] a13x212: coderanger: ??
[2014-03-19 03:42:48 -0400] coderanger: a13x212: the mysql cookbook has not been updated for the new build-essential 2.0
[2014-03-19 03:47:36 -0400] a13x212: trying to use 1.4.4 doesn't work either
[2014-03-19 03:50:56 -0400] a13x212: i think the mysql cookbook is borked, if remove all the cookbooks, gives me a different error, ERROR: Cookbook mysql depends on cookbook 'openssl' version '~> 1.1',
[2014-03-19 03:55:55 -0400] anthroprose: a13: I'm using cookbook "mysql", "~> 4.1" just fine
[2014-03-19 04:01:14 -0400] a13x212: antroprose, same issue with 4.1.2
[2014-03-19 04:03:22 -0400] anthroprose: then its whats uploaded to your chefserver or whatever you are using
[2014-03-19 04:03:56 -0400] anthroprose: probably need to version pin all your cookbooks, or else you will continue to have problems
[2014-03-19 04:04:08 -0400] anthroprose: build-essential got updated, yum made breaking changes
[2014-03-19 04:04:33 -0400] a13x212: i'm trying to upload it
[2014-03-19 04:05:02 -0400] anthroprose: so whatever you have on the server for openssl is < 1.1
[2014-03-19 04:05:25 -0400] anthroprose: so what I would do, if you havnt done a bunch of uploading
[2014-03-19 04:05:35 -0400] anthroprose: is figure out what versions are on the server
[2014-03-19 04:05:44 -0400] anthroprose: then pin those in the chef environment
[2014-03-19 04:05:53 -0400] anthroprose: and also set them in Berkshelf locally
[2014-03-19 04:06:12 -0400] a13x212: this is a fresh server, so there is only 1 cookbook
[2014-03-19 04:06:37 -0400] a13x212: knife cookbook list
[2014-03-19 04:06:37 -0400] a13x212: users   1.7.0
[2014-03-19 04:07:14 -0400] anthroprose: heh
[2014-03-19 04:07:22 -0400] anthroprose: so then you need to upload openssl, before mysql
[2014-03-19 04:07:27 -0400] anthroprose: cause it depends on it, but its not there
[2014-03-19 04:08:59 -0400] a13x212: i thought knife tried to resolve the depends
[2014-03-19 04:10:32 -0400] anthroprose: not on upload I don't think
[2014-03-19 04:10:46 -0400] anthroprose: I used to do a bash forloop to upload them before switching to berkshelf
[2014-03-19 04:11:47 -0400] freerobby: Is there any way to ensure that all references to my LWRP execute before my main recipe, even if my main recipe is included before they are called?
[2014-03-19 04:13:11 -0400] freerobby: A more wholistic explanation: I'd like to build an LWRP (or definition?) that constructs a single file based on all of its instances. So it cannot create the file until after the last call is made, which can be done by any arbitrary recipe. What is the best way to design this?
[2014-03-19 04:13:15 -0400] a13x212: anthroprose, thanks for the help i was able upload the mysql cookbook
[2014-03-19 04:13:55 -0400] a13x212: just started playing around with berkshelf
[2014-03-19 04:18:33 -0400] anthroprose: a13: all the tools are your friend
[2014-03-19 04:18:54 -0400] anthroprose: https://github.com/paulczar/meez is a good best practice start for things
[2014-03-19 04:19:34 -0400] anthroprose: freerobby: what are you trying to do?
[2014-03-19 04:28:11 -0400] freerobby: anthroprose: Not sure how better to explain it than that :\
[2014-03-19 04:28:38 -0400] freerobby: anthroprose: A very close example would be, I want to create an INI file, where each line/configuration setting gets set via an LWRP
[2014-03-19 04:28:39 -0400] anthroprose: freerobby: are you spinning up a cluster of nodes that you want to perform an action when they are done?
[2014-03-19 04:28:54 -0400] freerobby: It would run on a single node
[2014-03-19 04:29:08 -0400] freerobby: anthroprose: ^^
[2014-03-19 04:29:27 -0400] anthroprose: well, how do you know when they are done?
[2014-03-19 04:29:32 -0400] anthroprose: do you know the count?
[2014-03-19 04:29:52 -0400] freerobby: Nope. That's why I was asking if there's a way to ensure all instances of an LWRP run before anything in the recipe.
[2014-03-19 04:30:08 -0400] freerobby: I was trying to figure out if there was some way to do it with :notifies
[2014-03-19 04:30:12 -0400] freerobby: But I've struck out
[2014-03-19 04:30:34 -0400] anthroprose: so you have a buncha lwrps all over a buncha recipes, but only want to perform an action when they are done?
[2014-03-19 04:30:40 -0400] anthroprose: that sounds like a report_handler to me
[2014-03-19 04:30:58 -0400] anthroprose: but not part of the convergence, so its a lil funny using it for config
[2014-03-19 04:31:18 -0400] anthroprose: you can notify delayed
[2014-03-19 04:32:00 -0400] anthroprose: freerobby: http://stackoverflow.com/questions/14633509/is-there-any-way-to-delay-a-resources-attribute-resolution-until-the-execute
[2014-03-19 04:33:32 -0400] freerobby: anthroprose: Thanks. I'm not familiar with report_handlers
[2014-03-19 04:34:13 -0400] anthroprose: freerobby: you can tell which resources were updated & such, but it happens *after* the chef run, so writing ini files isnt really what it should do
[2014-03-19 04:34:23 -0400] freerobby: Ah.
[2014-03-19 04:34:51 -0400] anthroprose: so what I would do maybe
[2014-03-19 04:34:58 -0400] anthroprose: is use the lwrp to build an attribute array
[2014-03-19 04:35:06 -0400] anthroprose: and then feed that to an ini template
[2014-03-19 04:35:13 -0400] anthroprose: 'eventually consistant' remember
[2014-03-19 04:35:32 -0400] anthroprose: 2nd chef run will finalize the structure
[2014-03-19 04:37:10 -0400] freerobby: yeah, that makes sense
[2014-03-19 04:37:39 -0400] freerobby: anthroprose: On a similar note, is there any way to have include_recipe '<recipe>' actually invoke the recipe on the second time as well? Or anysimilar workaround?
[2014-03-19 04:37:49 -0400] anthroprose: include_recipe won't run twice
[2014-03-19 04:38:08 -0400] anthroprose: thats why you are in lwrp land :)
[2014-03-19 04:38:17 -0400] freerobby: Any way to make it ignore the first and use the second?
[2014-03-19 04:38:18 -0400] freerobby: haha
[2014-03-19 04:38:20 -0400] freerobby: touche
[2014-03-19 04:38:27 -0400] anthroprose: logic in the recipe
[2014-03-19 04:38:41 -0400] freerobby: Right but it could even be called from another cookbook beyond my control
[2014-03-19 04:38:42 -0400] anthroprose: I use node attrs for a state machine all the time (even tho its not advised)
[2014-03-19 04:38:58 -0400] anthroprose: umm
[2014-03-19 04:39:05 -0400] anthroprose: wtf are you doing?
[2014-03-19 04:39:12 -0400] anthroprose: common resources for a department of chefs?
[2014-03-19 04:40:49 -0400] freerobby: anthroprose: I'm writing a resource in a cookbook whose default recipe could potentially be invoked in another cookbook
[2014-03-19 04:41:00 -0400] freerobby: My default recipe does some stuff based on how lwrps are used beforehand
[2014-03-19 04:41:13 -0400] freerobby: But if someone calls my recipe earlier in the runlist, I'm hosed until the next chef run
[2014-03-19 04:41:34 -0400] anthroprose: due to a common backend resource?
[2014-03-19 04:42:04 -0400] freerobby: Right
[2014-03-19 04:42:28 -0400] freerobby: Hang on, I'll find an analogous example
[2014-03-19 04:42:30 -0400] anthroprose: namespace the resource?
[2014-03-19 04:42:52 -0400] freerobby: anthroprose: Are you familiar with the haproxy cookbook by chance?
[2014-03-19 04:42:58 -0400] freerobby: https://github.com/hw-cookbooks/haproxy/blob/master/providers/lb.rb
[2014-03-19 04:43:09 -0400] freerobby: you can call haproxy_lb to set up a bunch of haproxy apps
[2014-03-19 04:43:19 -0400] freerobby: when you're done, you include_recipe 'haproxy' to construct them
[2014-03-19 04:43:24 -0400] freerobby: it works fine
[2014-03-19 04:43:38 -0400] freerobby: however, if someone else calls include_recipe 'haproxy' before you do any of your work, you're ttoally hosed
[2014-03-19 04:43:46 -0400] freerobby: so that cookbook really only works if it is managed from a single place
[2014-03-19 04:43:49 -0400] anthroprose: ahhhh I gotcha
[2014-03-19 04:43:53 -0400] anthroprose: interesting
[2014-03-19 04:43:54 -0400] freerobby: I'm trying to work around that caveat
[2014-03-19 04:44:16 -0400] anthroprose: you can check the runlist
[2014-03-19 04:44:18 -0400] freerobby: Yeah, this is actually the first time I've hit this block
[2014-03-19 04:44:26 -0400] anthroprose: to see if the recipe is included from inside the lwrp
[2014-03-19 04:44:32 -0400] anthroprose: and at least error?
[2014-03-19 04:44:42 -0400] freerobby: Yeah, that's a good thought
[2014-03-19 04:44:47 -0400] freerobby: I like that
[2014-03-19 04:44:49 -0400] anthroprose: you can access the runlist
[2014-03-19 04:44:59 -0400] freerobby: Yeah
[2014-03-19 04:45:14 -0400] freerobby: Thanks, I think that's the best option short of a better paradigm. Silent failure is my biggest concern.
[2014-03-19 04:45:27 -0400] anthroprose: also, test-kitchen
[2014-03-19 04:45:31 -0400] anthroprose: don't even allow it to happen :)
[2014-03-19 04:45:37 -0400] freerobby: Heh
[2014-03-19 04:46:16 -0400] anthroprose: for some reason Jenkins sending a Hipchat message is more intimating than my 5'8" 120lbs
[2014-03-19 04:48:13 -0400] anthroprose: freerobby: and if silent failure is your biggest fear..... http://docs.opscode.com/community_plugin_report_handler.html
[2014-03-19 04:49:35 -0400] freerobby: anthroprose: Thanks, and haha re: Jenkins
[2014-03-19 05:02:47 -0400] anthroprose: coderanger: you are no less than the 49832 person I've seen do OO -> CF templating
[2014-03-19 05:02:59 -0400] coderanger: anthroprose: Hmm?
[2014-03-19 05:03:04 -0400] anthroprose: stratosphere
[2014-03-19 05:03:09 -0400] coderanger: anthroprose: heh
[2014-03-19 05:03:11 -0400] anthroprose: I've seen python ones, ruby ones, yaml, etc
[2014-03-19 05:03:27 -0400] coderanger: anthroprose: There is similar thing for Ruby made by Heavy Water
[2014-03-19 05:03:32 -0400] anthroprose: how many stacks you guys run?
[2014-03-19 05:03:47 -0400] coderanger: the popular python one is Troposphere, which as the name implies this is built on
[2014-03-19 05:04:14 -0400] coderanger: No idea, Balanced decided to not use the tools I made AFAIK so I stopped paying attention
[2014-03-19 05:04:55 -0400] anthroprose: coderanger: https://gist.github.com/anthroprose/9726ec5977d0f5516f14
[2014-03-19 05:05:00 -0400] anthroprose: thats just my network layer
[2014-03-19 05:05:18 -0400] anthroprose: but its good for any region, or multiple environments prod/staging/etc...
[2014-03-19 05:05:33 -0400] anthroprose: probably not enough NACLs for your PCI compliance
[2014-03-19 05:06:21 -0400] anthroprose: btw, I just took your citadel changes for the s3 stuff and implemented them for encrypted databags and the mysql cookbook
[2014-03-19 05:06:39 -0400] anthroprose: so now I have a nice non-visible master slave cluster config going
[2014-03-19 05:10:40 -0400] coderanger: anthroprose: if you look under balanced-infra I have a whole bunch of similar stuff
[2014-03-19 05:11:30 -0400] anthroprose: coderanger: actually digging around now yeah ;)
[2014-03-19 06:46:16 -0400] lietu: I don't quite get how you're supposed to use chef-shell to run one recipe, the docs say just "recipe_mode" and "include_recipe ...", for me absolutely nothing happens after I run include_recipe, the output is just " => []"
[2014-03-19 06:46:26 -0400] lietu: more specifically, I'm using chef-shell -z
[2014-03-19 06:47:04 -0400] lietu: .. or should I use some other flag than -z if I want it to connect to the server but just run one recipe?
[2014-03-19 09:31:59 -0400] s1991: hello, can anyone tell what for Chef is used in vagrant env.
[2014-03-19 09:34:02 -0400] n1ko: for the same reason chef is used anywhere..?
[2014-03-19 09:36:25 -0400] flaccid: s1991: yes
[2014-03-19 09:37:04 -0400] s1991: flaccid: hey hi, I want to know something about Chef
[2014-03-19 09:37:43 -0400] s1991: that what actually it is, and how it is used in vagrant env.
[2014-03-19 09:37:47 -0400] flaccid: s1991: i see you are not making sense in #vagrant either
[2014-03-19 09:38:17 -0400] n1ko: s1991: http://bit.ly/1nD4KtN this will probably get you started
[2014-03-19 09:38:37 -0400] flaccid: s1991: or just read every link in the topic
[2014-03-19 09:38:54 -0400] s1991: ok
[2014-03-19 09:39:08 -0400] Siiseli_: s1991, chef, in practice, is often used to install and configure stuff. Like for example, if you're setting up a virtual machine where you want nginx installed and configured to listen to a custom port, you'd use chef with vagrant to do this
[2014-03-19 09:39:39 -0400] Siiseli_: just do as flaccid said
[2014-03-19 09:39:46 -0400] Siiseli_: and you'll have a better understanding
[2014-03-19 09:39:54 -0400] s1991: ok, i got it
[2014-03-19 10:22:55 -0400] daxroc: Can anyone point me to an example of os detection using minitest, should I test this way or is there a better alternative ?
[2014-03-19 10:32:49 -0400] gnagno: hello all
[2014-03-19 10:52:57 -0400] jaykatta: Hi, How to capture out put of knife bootstrap ?
[2014-03-19 10:53:52 -0400] jaykatta: I wanna run knife cookbooks on multiple chef-nodes paralelly and capture output in different files ( each file for each chef-node)
[2014-03-19 11:04:50 -0400] borntyping: Is there any documentation on the expected release dates for future Chef versions? I'm looking at a ticket earmarked to be fixed in 11.12.0-client and trying to work out when that will be out.
[2014-03-19 11:14:04 -0400] sthulb: Hey, I'm seemingly getting a timeout when trying to install a package with chef
[2014-03-19 11:14:30 -0400] sthulb: If I ssh into the instance and run the command: yum -d0 -e0 -y --skip-broken install bbc-pal-sandbox-packages-1.4.0-2 it seems to be fine
[2014-03-19 11:32:47 -0400] nobody18188181: How do I tell a chef-client which cookbooks to use from a chef-server?
[2014-03-19 11:33:26 -0400] n1ko: metadata.rb
[2014-03-19 11:33:43 -0400] n1ko: and run list of course
[2014-03-19 11:34:38 -0400] workmad3: nobody18188181: you can also set the run list from the chef-server webui
[2014-03-19 11:45:10 -0400] jontyw: Morning!
[2014-03-19 11:45:54 -0400] jontyw: I'm getting a Chef::Exceptions::RedirectLimitExceeded exception being thrown when using remote_file, and I can't see a way to increase the redirect limit. Am I missing something simple?
[2014-03-19 11:49:43 -0400] mhenrixon: Anyone able to help on with chef-vault? I get is not encrypted with your public key in production? What am I missing? Do I have to provide a search or something ?>
[2014-03-19 11:51:39 -0400] workmad3: mhenrixon: as I've understood chef-vault, it encrypts items with the public keys of the nodes that should have access (meaning that those nodes can then decrypt with their own private keys)... so that means that 1. you can only provide a node access to an item after the node has been registered with the chef server, 2. you need to add new nodes to existing data items when they come up
[2014-03-19 11:54:14 -0400] mhenrixon: how do I add a node to the vault workmad3 ? search? So whatever comes up in the search is added to the vault?
[2014-03-19 11:57:03 -0400] workmad3: mhenrixon: for that, I'd suggest you look at jtimberman's blog: http://jtimberman.housepub.org/blog/2013/09/10/managing-secrets-with-chef-vault/
[2014-03-19 12:15:37 -0400] jaykatta: I wanna run knife cookbooks on multiple chef-nodes paralelly and capture output in different files ( each file for each chef-node)
[2014-03-19 13:36:36 -0400] sam__: reading about berkshelf.    I wonder, how many Berksfile's do you have?  one per cookbook?  one per "project", whatever that might mean.      are there many Berkfile's?
[2014-03-19 13:37:23 -0400] mhenrixon: sam_ one per cookbook
[2014-03-19 13:38:20 -0400] sam__: hmmm, ok.     But then, berkshelf will automatically download community cookbooks for you.      and for those...., also one per cookbook?   or they don't get a Berksfile.
[2014-03-19 13:39:48 -0400] nobody18188181: Is there a difference between run-list and role on a node? If so how do you only add a role?
[2014-03-19 13:39:58 -0400] nobody18188181: add a role?*
[2014-03-19 13:40:15 -0400] sam__:  a role is applied via the run-list
[2014-03-19 13:40:24 -0400] sam__: it's in the run-list
[2014-03-19 13:41:23 -0400] nobody18188181: sam__: that's what it seemed like in the documentation, but when I do knife node show _node_ it's not showing the role, but the applied role is running.
[2014-03-19 13:41:58 -0400] sam__: knife node run_list add
[2014-03-19 13:42:01 -0400] nobody18188181: Now it's showing it; does it take a few minutes from the chef server?
[2014-03-19 13:42:06 -0400] sam__: then, chef-client on the node side
[2014-03-19 13:42:15 -0400] sam__: ok
[2014-03-19 13:42:15 -0400] sam__: >>> now it's showing it.
[2014-03-19 13:42:26 -0400] nobody18188181: it took 5 mins or so to update
[2014-03-19 13:42:51 -0400] sam__: there can be some delay, although it shouldn't be 5 minutes
[2014-03-19 13:43:00 -0400] sam__: it depends
[2014-03-19 13:43:02 -0400] nobody18188181: Applied role -> chef-client executed on node -> checked status with knife -> didn't show it -> waited a few mins and now it shows it
[2014-03-19 13:43:14 -0400] nobody18188181: i see
[2014-03-19 13:43:17 -0400] sam__: but, there is a delay.
[2014-03-19 13:43:23 -0400] sam__: true
[2014-03-19 13:58:53 -0400] shlant: can someone confirm whether or not I can do something like this is a role? node.default['minitest']['recipes'] << recipe
[2014-03-19 14:00:00 -0400] bbssysop: hi all!
[2014-03-19 14:00:19 -0400] bbssysop: any tips on using chef to deploy/configure xenserver VM's?
[2014-03-19 14:00:54 -0400] bbssysop: any tips on using chef to deploy/configure xenserver VM's? Or - how do you prefer to go about automating the xen vm deployments?
[2014-03-19 14:01:01 -0400] bbssysop: (sorry about repeat)
[2014-03-19 14:05:32 -0400] shlant: anyone getting RedirectLimitExceeded on the apache2 cookbook?
[2014-03-19 14:06:44 -0400] dbristow: In the lusis chef-logstash cookbook, there  is a problem with the email output, the options stanza.  Documentation says that options is a hash, but the cookbook produces it as a list.  I opened an issue on the github page for it, no response yet.  Anybody else using this cookbook?
[2014-03-19 14:09:11 -0400] anthroprose: dbris: I do, but not email
[2014-03-19 14:09:17 -0400] anthroprose: I drive my config with it tho
[2014-03-19 14:10:36 -0400] dbristow: We are using an AWS smtp server, which requires authentication, so we need to set stuff in options.
[2014-03-19 14:10:59 -0400] qurve: Would there be any problem using sleep within a before_restart hook of a deploy resource?
[2014-03-19 14:11:46 -0400] qurve: In my situation, when doing a deploy of a rails app to multiple servers, one of them is marked as the "point server" responsible for running DB migrations. The problem is, the other servers will pull the code and restart before that server can run the migration, and things will blow up.
[2014-03-19 14:12:20 -0400] qurve: I was considering making it so that in the deploy configuration, any server that isn't on point would loop and constantly check for pending migrations, then sleep if they are outstanding and do it again.
[2014-03-19 14:12:35 -0400] qurve: Theoretically, non-point servers wouldn't restart and finish the run until the point server had done it's job.
[2014-03-19 14:12:55 -0400] qurve: Is that reasonable? Or am I opening up a world of hurt if I do something like that?
[2014-03-19 14:13:26 -0400] anthroprose: dbris: I use postfix with a relay to SES
[2014-03-19 14:13:27 -0400] qurve: before_restart { loop { break if <migrations_done>; sleep(3); } } or something.
[2014-03-19 14:21:20 -0400] bbssysop: has anyone succesfully used chef with xenserver to configure a new vm from scratch?
[2014-03-19 14:26:25 -0400] shlant: has anyone moved their cookbooks to separate repos? is it not a pain to have to clone all of them? or am I not understanding something
[2014-03-19 14:28:20 -0400] qurve: It depends I guess, you're trading one type of pain for another.
[2014-03-19 14:28:34 -0400] qurve: Separate repos is less pain overall IMO, especially when you have tools like berkshelf and whatnot.
[2014-03-19 14:31:54 -0400] trilitheus: shlant, mmay be worth checking this out https://sethvargo.com/moving-to-individual-cookbooks/
[2014-03-19 14:31:59 -0400] crazysix_: shlant: we are putting our cookbooks in their own repos and maintaining them there. Using Berkshelf to pull them in
[2014-03-19 14:33:49 -0400] shlant: trilitheus: yea I just read that. I'm trying to figure out whether the pain of having a bunch of separate repos is worth the fairly minimal gain (for me atm)
[2014-03-19 14:34:09 -0400] shlant: I wish there were "sub-repos" or something
[2014-03-19 14:34:20 -0400] shlant: so at least I could organize all chef cookbooks
[2014-03-19 14:34:23 -0400] shlant: within git
[2014-03-19 14:34:34 -0400] shlant: i get i could prefix them
[2014-03-19 14:36:08 -0400] trilitheus: shlant, fwiw, I've found it hugely more managable with berkshelf and separate repos
[2014-03-19 14:36:58 -0400] shlant: trilitheus: yea, long term it's definitely best, but it's just me touching the repos basically atm
[2014-03-19 14:37:23 -0400] shlant: I guess I could do a bit at a time
[2014-03-19 14:37:34 -0400] shlant: start with creating all new cookbooks in new repos
[2014-03-19 14:39:43 -0400] soetest1: I'm trying to setup Enterprise chef and a trying to get the VALIDATOR.pem from the Chef-Manage page...don't know from where to download it as noted in the documentation. Can some one help pls?
[2014-03-19 15:09:04 -0400] mjuszczak: I built a MariaDB module which has three recipes: client, server, default.  I made it so default only includes client, not server.  That means when I reference it from my application-cookbook/recipes/database.rb, I'm including "mariadb::server" and "mariadb::client" (since I need both).  Is that the correct way to do it, or should I have the mariadb::server recipe include client?
[2014-03-19 15:09:39 -0400] shlant: mjuszczak: will server always need client?
[2014-03-19 15:10:22 -0400] mjuszczak: shlant: I think that's a safe bet, yeah.  We'd want client to be on all servers.
[2014-03-19 15:11:09 -0400] shlant: mjuszczak: if server always needs client, I would include_recipe it
[2014-03-19 15:11:18 -0400] shlant: less things to remember
[2014-03-19 15:11:47 -0400] mjuszczak: OK
[2014-03-19 15:12:04 -0400] mjuszczak: Can chef handle double includes?
[2014-03-19 15:12:14 -0400] shlant: mjuszczak: example?
[2014-03-19 15:12:26 -0400] mjuszczak: if server has include_recipe client, and then someone includes server and client separately, say in an application cookbook
[2014-03-19 15:14:28 -0400] shlant: mjuszczak: include_recipes are only run once: at the first point they are encountered
[2014-03-19 15:28:04 -0400] mjuszczak: awesome
[2014-03-19 15:42:15 -0400] mjuszczak: Chef always does things in order that is listed, correct?  Here: http://pastebin.com/CrSazLn2 -- when I leave mysql::ruby include commented out everything works fine.  However, when I uncomment it, it never installs the mariadb:::repo -- it literally just jumps to trying to install mariadb-client.  Why would it skip the repo install?
[2014-03-19 15:46:19 -0400] btm: mjuszczak: it could be a compile phase versus converge phase issue. the output of a "chef-client -l debug" run would help.
[2014-03-19 15:47:31 -0400] mjuszczak: btm: I'm using test kitchen.
[2014-03-19 15:51:22 -0400] mjuszczak: btm: http://pastebin.com/UgELsqG7
[2014-03-19 15:53:59 -0400] mjuszczak: Oh, I see what's going on now.  The mysql::ruby recipe includes the build-essential recipe, which is obviously doing something weird.
[2014-03-19 15:54:41 -0400] mjuszczak: btm: Why it would be going to build::essential first is beyond me, considering mariadb::repo is the first thing I have in the include_recipe list.
[2014-03-19 15:56:59 -0400] srenatus: mjuszczak: mysql::ruby does magic: https://github.com/opscode-cookbooks/mysql/blob/master/recipes/ruby.rb
[2014-03-19 15:57:11 -0400] hugespoon: I'm doing a setup of private-chef here, does anyone know if the installation process depend on node name resolution being in place before the process is run or can it be added afterward?
[2014-03-19 15:57:17 -0400] srenatus: mjuszczak: it takes special care to make build-essential run in compile-time
[2014-03-19 15:57:28 -0400] srenatus: mjuszczak: and hence _way before_ the other stuff
[2014-03-19 15:58:13 -0400] mjuszczak: srenatus: grrr.  So how would I force the install of a repo before that happens?
[2014-03-19 15:58:59 -0400] mjuszczak: srenatus: As I'm overriding the mysql packages with mariadb ones from a mariadb repo
[2014-03-19 16:00:00 -0400] mjuszczak: srenatus: I see there's a listing in there for including the percona repo.  I might just have to add the mariadb repo into that.  Gah.
[2014-03-19 16:00:13 -0400] srenatus: mjuszczak: I had a similar problem with percona some time ago.  I ended up removing the chef_gem 'mysql' and reinstalling it at (normal) converge time
[2014-03-19 16:00:46 -0400] srenatus: mjuszczak: oh. right. thanks for the pointer
[2014-03-19 16:04:16 -0400] workmad3: mjuszczak: what mariadb cookbook are you using btw?
[2014-03-19 16:05:12 -0400] workmad3: mjuszczak: because there's https://github.com/joerocklin/chef-mariadb which is a fork of the mysql cookbook... so if you were using that one, you'd do 'include_recipe "mariadb::ruby" ' rather than the mysql equivalent
[2014-03-19 16:05:47 -0400] mjuszczak: workmad3: I'm using a super simple stupid wrapper cookbook around mysql that replces the packages, per this: https://tickets.opscode.com/browse/COOK-637 and this: https://tickets.opscode.com/browse/COOK-1236
[2014-03-19 16:05:59 -0400] NightMonkey: Howdy. Just curious if anyone else has done this. I'm just starting on a fun personal project to manage a bunch of Raspberry Pis with Chef (and running Gentoo, yes I'm a glutton for punishment).
[2014-03-19 16:06:33 -0400] workmad3: mjuszczak: heh :) maybe consider that fork then? :D
[2014-03-19 16:06:46 -0400] mjuszczak: It should work, as you see in the ticket they made support for it.
[2014-03-19 16:07:06 -0400] mjuszczak: workmad3: I was using it actually :) But then read those tickets and realized the wrap would be better.
[2014-03-19 16:07:14 -0400] NightMonkey: Anyone else played this game? :)
[2014-03-19 16:07:31 -0400] mjuszczak: workmad3: To me it might almost make more sense to add the mariadb repo into ruby.rb alongside the percona one and do a pull request.
[2014-03-19 16:07:50 -0400] mjuszczak: if they're OK supporting percona as a drop-in replacement, you'd think MariaDB would also be acceptable.
[2014-03-19 16:07:59 -0400] mjuszczak: freerobby: any thoughts?
[2014-03-19 16:09:28 -0400] workmad3: mjuszczak: yeah, if there's a repo for mariadb that provides identical(ish) package names for mysql that would make perfect sense to have in the mysql cookbook :)
[2014-03-19 16:10:26 -0400] freerobby: mjuszczak: That makes sense to me. Opscode will make you sign an agreement though before accepting any of your PRs.
[2014-03-19 16:10:44 -0400] freerobby: mjuszczak: You'll also need to create a JIRA ticket for it.
[2014-03-19 16:11:11 -0400] mjuszczak: gah: https://tickets.opscode.com/browse/COOK-3487
[2014-03-19 16:11:23 -0400] mjuszczak: looks like the community has already battled :)
[2014-03-19 16:11:35 -0400] mjuszczak: sethvargo: is that still the plan?
[2014-03-19 16:12:54 -0400] sethvargo: To the best of my knowledge, nothing has changed
[2014-03-19 16:17:37 -0400] mjuszczak: sethvargo: it just kind of seems to me that, since MariaDB markets itself as a "drop in replacement", having a way to get the repo in would be helpful.  I understand re: the bloat.
[2014-03-19 16:18:22 -0400] sethvargo: Nxginx is a drop-in replacement for apache.. should we put them in the same cookbook? No. They are different pieces of software.
[2014-03-19 16:19:17 -0400] sethvargo: The fact that the java cookbook has multiple flavors seems like an anti-pattern to me. Oracle java is different than openjdk
[2014-03-19 16:20:33 -0400] mjuszczak: sethvargo: One could argue that nginx isn't a drop in replacement for apache since you can't just change the package named from httpd to nginx and have it work.  Different config files, etc.  With MariaDB and Percona, they are literally drop-in replacements, just as the innodb plugin was a drop-in replacement for innodb for many years.
[2014-03-19 16:20:52 -0400] mjuszczak: sethvargo: I'll go with the fork, just thought I'd share.  I understand where you're coming from.
[2014-03-19 16:21:21 -0400] c_t: the mysql cookbook used to have a way to specify which mysql package to install, but it may have been removed since
[2014-03-19 16:23:52 -0400] mjuszczak: c_t: it does.  and in this ... https://tickets.opscode.com/browse/COOK-637 ... Josh Timberman mentions "and other drop-ins", which means the intent was to be able to install things like MariaDB as well.  There's just an issue with ruby.rb (everything else works -- server, client) that requires the mariadb repo to be on the box before the mysql gem is installed.
[2014-03-19 16:25:23 -0400] c_t: mjuszczak: yeah, I had done something to the mysql cookbook to add the percona repo at one point
[2014-03-19 16:26:50 -0400] mjuszczak: c_t, sethvargo: and the fact that if you "yum install mysql" on the latest fedora core and slackware, you actually get mariaDB instead of mysql, should make it even more of a drop-in replacement: http://www.slackware.com (third post down) and http://fedoraproject.org/wiki/Features/ReplaceMySQLwithMariaDB
[2014-03-19 16:27:01 -0400] c_t: https://github.com/opscode-cookbooks/mysql/blob/master/recipes/ruby.rb#L33
[2014-03-19 16:27:14 -0400] c_t: oddly that refers to a recipe that's no longer in the cookbook
[2014-03-19 16:27:48 -0400] c_t: but if you duplicated the previous percona_repo recipe for mariadb and added similar logic for that, you'd get where you wanted to be
[2014-03-19 16:27:59 -0400] sethvargo: @mjuszczak I'm not going to argue about this
[2014-03-19 16:28:07 -0400] mjuszczak: sethvargo: understood
[2014-03-19 16:28:41 -0400] hugespoon: sethvargo: im having some issue with my private-chef install very early on in the process, any idea who i should contact? (im trying to get the portal login from management atm)
[2014-03-19 16:29:08 -0400] mjuszczak: sethvargo: PS, thank you for your work on Berkshelf.
[2014-03-19 16:29:58 -0400] sethvargo: @hugespoon if you are paying for private chef, email support@getchef.com
[2014-03-19 16:30:08 -0400] sethvargo: If you're not a paying custom, email support@getchef.com :)
[2014-03-19 16:30:27 -0400] hugespoon: sethvargo: heh gotcha, thx
[2014-03-19 16:30:57 -0400] c_t: and to reach someone for support on the phone, just call 1-900-MIXALOT
[2014-03-19 16:31:20 -0400] mjuszczak: c_t: thanks for your link
[2014-03-19 16:33:05 -0400] Cail: I asked over in learnchef but haven't received an answer. Does the chef Windows installer support Windows XP? I didn't see any mention of which versions of Windows are supported.
[2014-03-19 16:33:51 -0400] sethvargo: @Cail the supported versions are all here: http://www.getchef.com/chef/install/
[2014-03-19 16:33:54 -0400] sethvargo: Via the dropdown
[2014-03-19 16:34:09 -0400] sethvargo: It may work on other platforms, but those are the tested pipelines
[2014-03-19 16:34:48 -0400] Cail: Thanks, don't know how I missed that!
[2014-03-19 16:38:58 -0400] dstynchula: How can I use the cron resource to run every five minutes?
[2014-03-19 16:39:21 -0400] dstynchula: can I use /5?
[2014-03-19 16:57:46 -0400] mjuszczak: Can you chef-rewind/chef-edit a block within an if statement?
[2014-03-19 16:58:35 -0400] srenatus: mjuszczak: if it's in the resource collection (i.e. its conditional was true), yes
[2014-03-19 16:59:08 -0400] srenatus: mjuszczak: you could add the same `if` around your rewind resource... or add an only_if
[2014-03-19 16:59:22 -0400] srenatus: mjuszczak: scratch that last remark.  I didn't say that
[2014-03-19 16:59:39 -0400] srenatus: rewind is merely a function, no resource, hence doesn't have only_if at all.
[2014-03-19 17:00:42 -0400] mjuszczak: srenatus: gotcha, thank you
[2014-03-19 17:02:49 -0400] srenatus: mjuszczak: I guess you could rescue the exception rewind would throw if you tried to rewind a resource that isn't there
[2014-03-19 17:09:18 -0400] scalp42: mjuszczak you can also check if the resource exists
[2014-03-19 17:17:29 -0400] terarobb: i'm having a heck of a time getting windows 7 to bootstrap with "knife bootstrap windows winrm FQDN"
[2014-03-19 17:17:42 -0400] terarobb: 1 in 10 tries succeeds and the rest fail with what seem like weird timing issues
[2014-03-19 17:18:55 -0400] terarobb: does chef-windows work with desktop editions or is it mainly for servers?
[2014-03-19 17:19:34 -0400] terarobb: for example, i'll get an error The key file should begin with '-----BEGIN RSA PRIVATE KEY-----' and end with '-----END RSA PRIVATE KEY-----'
[2014-03-19 17:20:33 -0400] terarobb: when i go to look at the .pem on the client, the file has most of a certificate, then instead of -----END RSA PRIVATE KEY-----, it's got some commands that look like they should have run in the shell
[2014-03-19 17:21:11 -0400] terarobb: or it will detect that i'm using Windows Version 6.1, but then it won't be able to find a batch labled Version6.1.
[2014-03-19 17:21:59 -0400] terarobb: everytime is a different error.
[2014-03-19 17:22:38 -0400] terarobb: the machine i'm bootstraping is a VM, and i keep rolling it back to the same snapshot, so I don't understand why everytime I try to bootstrap I get a different result -- any ideas?
[2014-03-19 17:26:40 -0400] jidar: terarobb: I think it can work, but its really aimed at the server stuff
[2014-03-19 17:27:05 -0400] jidar: terarobb: I know personally I've had issues with the winrm service running out of memory
[2014-03-19 17:27:22 -0400] jidar: what bootstrap script are you using for getting the winrm open and usable
[2014-03-19 17:28:19 -0400] terarobb: i'm using knife-windows 0.5.15
[2014-03-19 17:34:12 -0400] dstynchula: does anyone here know the cron resource syntax?
[2014-03-19 17:34:25 -0400] dstynchula: I want to use minutes "\5" but it's not working.
[2014-03-19 17:36:11 -0400] terarobb: i have memory set to 512 (more than chef's recommendations).. i'll try 1024 and see if i can get it to succeed more consistantly
[2014-03-19 17:37:08 -0400] swalberg: is https://github.com/phlipper/chef-percona the current way to manage mysql percona or should I be looking at overrides to the opscode mysql cookbook?
[2014-03-19 17:38:32 -0400] anthroprose: swalberg: that one at least uses encrypted databags instead of node attrs
[2014-03-19 17:45:12 -0400] efeldhusen: just curious, I'm doing some cleanup on an existing chef server that we use a single shared git repo for our cookbooks, nodes, etc... and we don't have a lot of the environments, roles, nodes, and I was going to download those from the chef server. What's the best practice format for those files json or ruby?
[2014-03-19 17:46:53 -0400] shlant: dstynchula: \5 is not a valid syntax for cron. Are you using the cron resource?
[2014-03-19 17:47:16 -0400] dstynchula: I figured it out. *facepalm*
[2014-03-19 17:47:23 -0400] dstynchula: */5 worked
[2014-03-19 17:47:37 -0400] shlant: dstynchula:  ^.^
[2014-03-19 17:47:45 -0400] dstynchula: apparently, I left my right lobe at home today.
[2014-03-19 17:47:53 -0400] dstynchula: thank you for following up.
[2014-03-19 17:47:58 -0400] dstynchula: brainfail
[2014-03-19 17:51:56 -0400] sarkis: question: when i create the default recipe say for monit, i am having an issue where the service will not start up properly on the first run
[2014-03-19 17:52:06 -0400] sarkis: is there a race condition i should watch out for?
[2014-03-19 17:56:33 -0400] doomviking: I still use runit *ducks*
[2014-03-19 17:58:27 -0400] shlant: sarkis: is the conf correct?
[2014-03-19 18:02:18 -0400] jarsever: Is there a way to delay a service for 40 seconds before we start it?  We want it to start on boot but it needs to be delayed to allow other services time to start.
[2014-03-19 18:06:15 -0400] sarkis: shlant: yes, it starts up fine the second time.. really weird
[2014-03-19 18:06:22 -0400] anthroprose: jarserver: you can set the service resource to action :none, and then notify it with an action :run delayed from another resource
[2014-03-19 18:06:53 -0400] sarkis: jarsever: maybe you need dependency resolution via upstart or similar startup?
[2014-03-19 18:07:04 -0400] sarkis: or that ^
[2014-03-19 18:10:23 -0400] shlant: sarkis: yea, it would be hard for me to help without seeing the relevant recipes. nothing in the logs of the service?
[2014-03-19 18:10:56 -0400] coredump: is there any way at all to manage dependencies without berkshelf?
[2014-03-19 18:12:30 -0400] anthroprose: coredump: metadata.rb, Chef Environments
[2014-03-19 18:15:41 -0400] coredump: I meant like when I download a cookbook and it has 5 dependencies that I have to download manually
[2014-03-19 18:15:46 -0400] coredump: and want to kill myself
[2014-03-19 18:20:08 -0400] someara: coredump thats what berkshelf was written to do for you
[2014-03-19 18:20:20 -0400] CPS: does anyone have any experience using winrm to bootstrap windows nodes?
[2014-03-19 18:20:20 -0400] jidar: terarobb: you know, some of my problems with the chef runs on windows were more related to the things I was doing, ie: using hte powershell provider directly (rather than calling a script from a template) seemed to throw the sort of oom errors you might be running into. I'd look into the way you're doing the recipes and maybe track it down from there?
[2014-03-19 18:20:44 -0400] anthroprose: coredump: knife cookbook manages those for you on the download....
[2014-03-19 18:20:54 -0400] anthroprose: and controls branching & merging of upstream cookbooks
[2014-03-19 18:26:24 -0400] doomviking: knife cookbook site vendor
[2014-03-19 18:26:31 -0400] doomviking: etc
[2014-03-19 18:28:09 -0400] terarobb: jidar: I only have one recipe, that checks if an empty file exists in c:\ and creates it if it doesn't -- all the bootstrap is really doing is installing the client and registering with the server
[2014-03-19 18:28:57 -0400] coredump: thanks guys
[2014-03-19 18:29:33 -0400] jidar: terarobb: ah weird. Are you sure the client/winrm service/etc is staged properly? That doesn't seem like it should run out of memory
[2014-03-19 18:30:02 -0400] jidar: terarobb: for instance, I was trying to pull files out of S3 using the powershell provider and I think it was trying to run it inline from the ruby execution
[2014-03-19 18:30:06 -0400] jidar: but who knows
[2014-03-19 18:57:21 -0400] rdobbs: has anyone seen an error before, in application_ruby, with the database.yml template throwing an exception that it cannot find a cookbook named "none" ?
[2014-03-19 18:58:28 -0400] bbssysop: hi all. simple question. is there any reason that this won't work,. because it doesn't. http://paste.ubuntu.com/7121435/
[2014-03-19 18:58:31 -0400] bbssysop: seems simple enough.
[2014-03-19 18:58:38 -0400] bbssysop: (beginner)
[2014-03-19 19:01:19 -0400] rdobbs: It's weird in that it works in one of my Amazon accounts, but not in the other one, so it might be environment based
[2014-03-19 19:01:22 -0400] rdobbs: https://gist.github.com/anonymous/9648833
[2014-03-19 19:02:57 -0400] btm: chef/ohai code review: join: bit.ly/1gHuC2h watch: bit.ly/1gHuAr8
[2014-03-19 19:03:04 -0400] anthroprose: rdobbs: s3 artifacts? vpc routing?
[2014-03-19 19:03:19 -0400] anthroprose: same base AMI?
[2014-03-19 19:03:21 -0400] rdobbs: anthroprose, no VPC issues but possibly s3 as I'm using hosted chef.
[2014-03-19 19:03:40 -0400] rdobbs: yep same base AMI, everything is identical except environment names corresponding to different amazon accounts.
[2014-03-19 19:04:20 -0400] anthroprose: seems like a program literal got translated to a string and then fed to a recipe
[2014-03-19 19:04:30 -0400] anthroprose: I see that with python None alot
[2014-03-19 19:05:16 -0400] anthroprose: whatever you are feeding that template resource is bad
[2014-03-19 19:05:27 -0400] rdobbs: man it's weird how many cookbooks will have attributes for port numbers, some of them set to be strings, the others set to be integers. I wonder if it's a laziness/consistency thing, or something I don't get.
[2014-03-19 19:08:12 -0400] rdobbs: anthroprose: agreed. for grins and jollies I'm going to goof around with environments and rewrite some stuff. Someone here convinced me yesterday that it's time for me to scrap the deploy resource/application cookbooks and roll my own stuff anyways
[2014-03-19 19:10:20 -0400] cbarraford: does anyone know how to get omnibus to use ruby version 2.0.0 instead of 1.9.3 in /opt/app/embedded/bin/ruby?
[2014-03-19 19:11:00 -0400] cbarraford: cc sethvargo
[2014-03-19 19:11:10 -0400] sethvargo: Change the version
[2014-03-19 19:11:25 -0400] cbarraford: where/how
[2014-03-19 19:11:52 -0400] anthroprose: rdobbs: I literally just made that statement in another chat ;)
[2014-03-19 19:12:32 -0400] Kripto: Greetings, I'm trying to install the chef-client on my OS X (Mavericks) host and I'm getting embedded ruby errors.. Is there something I'm missing?
[2014-03-19 19:13:17 -0400] sethvargo: override "ruby", version: "2.0.0"
[2014-03-19 19:13:41 -0400] rdobbs: anthroprose: aye. I've spent many dozens of hours this year debugging weird problems with application_ruby, application_nginx, and the sh*tshow that is the runit cookbook
[2014-03-19 19:14:01 -0400] cbarraford: sethvargo thanks
[2014-03-19 19:14:08 -0400] rdobbs: By the  end of Q2 I hope to have runit removed from my infrastructure entirely. *kicks runit with a spiked steel-toed boot*
[2014-03-19 19:15:06 -0400] rdobbs: I just wish I were allowed to send my patches upstream and release our internal cookbooks.
[2014-03-19 19:15:12 -0400] anthroprose: rdobbs: chefspec+serverspec is awwwesome
[2014-03-19 19:16:52 -0400] rdobbs: anthroprose: Nice! This looks great. I just got the go-ahead to bring in two more engineers to the team (yes, I'm a Director of one engineer, myself), so we're finally going to have time to start doing testing
[2014-03-19 19:17:36 -0400] mondo: Is there an easy way to add a role to multiple nodes at the same time?  Something like knife node name:servers* run_list add, or do I have to use knife exec?
[2014-03-19 19:17:39 -0400] rdobbs: anthroprose: I'm writing a ton of AWS integration providers right now, this would help  prevent some of the fudges I've made .. like launching 1,000 servers for an hour (whoops)
[2014-03-19 19:17:58 -0400] mjuszczak: curious, can chef-rewind be used to inject an "include_recipe" into an existing recipe at a specific place?
[2014-03-19 19:18:56 -0400] anthroprose: rdobbs: as far as the cookbook stuff goes... check out https://github.com/paulczar/meez
[2014-03-19 19:19:10 -0400] anthroprose: re: AWS, you should seriously checkout CloudFormation
[2014-03-19 19:20:36 -0400] rdobbs: I'm still wrapping my head around CloudFormation, AWS is new to me as of a year ago. it seems like it would make a lot of this easier, especially since at night I launch a VPC programmatically, spin up about 7k spot instances, then tear it all down as they instancess finish their work or expire
[2014-03-19 19:21:16 -0400] anthroprose: haha
[2014-03-19 19:21:28 -0400] anthroprose: buy me a beer and I will save you $10k/month
[2014-03-19 19:21:53 -0400] rdobbs: :) if you're in the bay area I might take you up on that
[2014-03-19 19:22:00 -0400] terarobb: I bumped the winrm memory up to 1024 and i've bootstrapped 10 times in a row successfully.. looks like that was the issue.
[2014-03-19 19:22:02 -0400] terarobb: thanks
[2014-03-19 19:22:03 -0400] dgarstang: Shouldn't the apt cookbook run apt-get update on every run?
[2014-03-19 19:22:32 -0400] anthroprose: rdobbs: chefconf
[2014-03-19 19:22:43 -0400] anthroprose: or just chat me, I don't really drink
[2014-03-19 19:22:58 -0400] rdobbs: hah me neither, but I'll be out of the country during chefconf
[2014-03-19 19:23:01 -0400] anthroprose: but im doing my damndest to hone my chops
[2014-03-19 19:23:06 -0400] anthroprose: I
[2014-03-19 19:23:19 -0400] rdobbs: strangely, I'm always out of the country during devopsdays, chefconf, velocity, and puppetconf
[2014-03-19 19:23:34 -0400] anthroprose: blerg sorry.... I'm aws certified out the wazoo, not that it means anything
[2014-03-19 19:23:46 -0400] anthroprose: but I dont like to travel, so most solutions arch jobs are out of my realm
[2014-03-19 19:24:45 -0400] rdobbs: I wonder if I can get budget for aws training, hadn't actually thought about that
[2014-03-19 19:26:05 -0400] anthroprose: their white paper archs are good
[2014-03-19 19:26:20 -0400] rdobbs: I used to be a sales engineer implementing automation suites for customer sites. The social aspect of it was awesome, the travel aspect was pretty lame.. Now I'm just a research engineer, hiding from any on-call or customer facing responsibilities
[2014-03-19 19:26:38 -0400] anthroprose: http://aws.amazon.com/architecture/
[2014-03-19 19:26:45 -0400] rdobbs: Sweet I'll check them out after lunch!
[2014-03-19 19:27:00 -0400] rdobbs: thanks for all the suggestions :)
[2014-03-19 19:27:27 -0400] anthroprose: np
[2014-03-19 19:27:46 -0400] anthroprose: but all inside cloudformation, you can setup a schedule and any/all resources you need for the batch
[2014-03-19 19:28:16 -0400] anthroprose: including autoscale rules so that you dont run extra compute resources. not just instance resources
[2014-03-19 19:40:21 -0400] coredump: guys, created encrypted data_bags, and added the secret to /etc/chef/encrypted_data_bag_secret file (the same file I used to create them of course). The data is not appearing where it's supposed to be, and the log doesn't show me anything, What are the usual suspect problems for that?
[2014-03-19 19:42:19 -0400] anthroprose: coredump: you can use knife to query the server and see the encrypted contents
[2014-03-19 19:42:46 -0400] coredump: I can see the contents from my computer/knife. the server seems to be the one ignoring it
[2014-03-19 19:43:56 -0400] anthroprose: so you did a knife create and it opened an editor and you put the un-encrypted info in
[2014-03-19 19:43:59 -0400] anthroprose: did you upload it?
[2014-03-19 19:44:07 -0400] coredump: yeap
[2014-03-19 19:44:17 -0400] coredump: but I may have found the problem, it's unrelated to the data bags
[2014-03-19 19:44:37 -0400] anthroprose: so the databag load happens first
[2014-03-19 19:44:44 -0400] anthroprose: in the run stage
[2014-03-19 19:58:30 -0400] jharley: hey, can anyone help me out with debugging foodcritic matching what I think is a false positive?
[2014-03-19 19:58:54 -0400] jharley: It's complaining about "Resource attribute not recognised" (FC009) and I think it is mistaken
[2014-03-19 19:59:08 -0400] erichs: Hi, new chef here. Anyone have time for some basic questions about attributes?
[2014-03-19 19:59:52 -0400] jharley: erichs: I can try, what's up?
[2014-03-19 19:59:59 -0400] erichs: jharley: thanks!
[2014-03-19 20:01:11 -0400] anthroprose: jharley: might be a dynamically named resource?
[2014-03-19 20:01:14 -0400] erichs: jharley: I'm writing my first recipe, and would like to configure a piece of data for a specific node. In this case, the EBS volume that will be needed by my MySQL master db.
[2014-03-19 20:01:49 -0400] jharley: anthroprose: oddly, no.. in more strangely: if I comment out the resource it's complaining about it matches on the next one.  both are 'file'
[2014-03-19 20:02:09 -0400] jharley: *even more strangely
[2014-03-19 20:02:17 -0400] jharley: erichs: okay, I'm with you so far
[2014-03-19 20:02:18 -0400] erichs: jharley: I'm a bit confused as to where I should put this data: configured via knife node edit, or in a role file that I keep in version control?
[2014-03-19 20:03:02 -0400] jharley: erichs: you can set it on the node level, but it might be easier long term (and more generic) to setup a role that sets that attribute to what you'd like it to be
[2014-03-19 20:03:03 -0400] anthroprose: erichs: current best practice is to create a wrapper cookbook that defines needed attributes and then includes the mysql cookbook
[2014-03-19 20:03:09 -0400] jharley: or that :)
[2014-03-19 20:03:12 -0400] anthroprose: erichs: traditionally people use roles for that tho
[2014-03-19 20:03:47 -0400] erichs: anthroprose: thanks. This recipe is going to do some other, more basic stuff like assuring the device is attached, luksOpening it, etc.
[2014-03-19 20:04:06 -0400] anthroprose: roles cannot be versioned and won't scale well across an entire organization or dev team
[2014-03-19 20:04:37 -0400] erichs: anthroprose: Yes, this seems limiting.
[2014-03-19 20:04:55 -0400] jharley: anthroprose: can I paste you the file resource foodcritic is bitching about?
[2014-03-19 20:05:18 -0400] anthroprose: erichs: my wrapper cookbook's default.rb has ---- override['mysql']['tunable']['log_bin'] = 'mysql-bin'
[2014-03-19 20:05:45 -0400] anthroprose: jharley: i can try, but I largely rely on chefspec+serverspec and ignore foodcritic
[2014-03-19 20:06:17 -0400] jharley: anthroprose: fair.  I'm just getting those tools into my dev pipeline, and have learned a lot from foodcritic
[2014-03-19 20:06:28 -0400] jharley: anthroprose: http://hastebin.com/voweguboyo.rb
[2014-03-19 20:06:52 -0400] erichs: anthroprose: ok, so that's the attribute as defined in the recipe. What if you wanted to override that 'override' for a second node, and put the bin log somewhere else?
[2014-03-19 20:06:57 -0400] anthroprose: mmmmm ceph
[2014-03-19 20:06:59 -0400] aalmenar: Hi, i have a little bug found in ohai 6.20, where should i report it ?
[2014-03-19 20:07:17 -0400] anthroprose: I wrote a vagrant+chef ceph cluster POC a while back
[2014-03-19 20:07:19 -0400] aalmenar: it does not correctly detect when running inside a kvm virtual machine
[2014-03-19 20:07:28 -0400] jharley: aalmenar: tickets.opscode.com -- there's already an issue for that
[2014-03-19 20:07:36 -0400] jharley: aalmenar: I'll dig it up for you so you can up vote it :)
[2014-03-19 20:07:46 -0400] jharley: anthroprose: I love me some ceph :)
[2014-03-19 20:08:13 -0400] anthroprose: i honestly don't know much about it, i was just the one who could automate/orchestrate clusters
[2014-03-19 20:08:21 -0400] anthroprose: all I remember is that the docs were horrible
[2014-03-19 20:08:50 -0400] jharley: aalmenar: https://tickets.opscode.com/browse/OHAI-383
[2014-03-19 20:08:58 -0400] aalmenar: jharley: yeah just found it
[2014-03-19 20:09:01 -0400] aalmenar: thanks anyway
[2014-03-19 20:09:01 -0400] jharley: anthroprose: ha!  rather true
[2014-03-19 20:09:05 -0400] anthroprose: jharley: so the only thing I can think og is the content lazy is somehow confusing foodcritic due to convergence/parse issues
[2014-03-19 20:09:16 -0400] jharley: anthroprose: perhaps?
[2014-03-19 20:09:26 -0400] anthroprose: it thinks is nil and fails somewhere
[2014-03-19 20:09:39 -0400] anthroprose: change it & see ;)
[2014-03-19 20:10:59 -0400] jharley: anthroprose: blargh.. that seems to be the issue
[2014-03-19 20:11:41 -0400] anthroprose: im embarasingly ignorant about a lot of chef related things, but I've been using it for 3yrs, so the intuition kicks in occasionally
[2014-03-19 20:11:45 -0400] jharley: aalmenar: I ended up doing a bit of a gross hack around the issue and setting up 'node[is_virtual]'
[2014-03-19 20:12:59 -0400] aalmenar: jharley: but you do that setting it right away on the node, i have server that get deployed automagically and some recipes depend on this kind of information
[2014-03-19 20:14:21 -0400] posita: Stupid FAQ # 427,893: I'm new to Chef Enterprise, and the http://docs.opscode.com/chef/install_workstation.html#get-the-pem-files-and-knife-rb-files that one should download the various .pem files from the Organizations and Users tabs in the Chef management interface, but I can't for the life of me find where. I can get the knife.rb file, but not the .pems. Where does one find those?
[2014-03-19 20:14:39 -0400] aalmenar: sethvargo: available ?
[2014-03-19 20:14:43 -0400] posita: (That should have read "docs instruct" with the link.)
[2014-03-19 20:14:44 -0400] posita: (My apologies if this has been answered already, I tried searching through the docs and IRC logs, but either my search fu is not good, or I'm looking in the wrong places.)
[2014-03-19 20:14:58 -0400] sethvargo: @aalmenar not really, sorry
[2014-03-19 20:15:06 -0400] aalmenar: sethvargo: no prob
[2014-03-19 20:15:35 -0400] anthroprose: posita: new install or new user?
[2014-03-19 20:15:56 -0400] posita: Both. I just signed up for a trial account like 34 minutes ago.
[2014-03-19 20:16:19 -0400] anthroprose: ah
[2014-03-19 20:16:23 -0400] anthroprose: regenerate them
[2014-03-19 20:17:01 -0400] posita: anthroprose: Gotcha. Thanks! (Again, my apologies for the stupid question.)
[2014-03-19 20:17:28 -0400] jharley: aalmenar: the bug's been open for a while, so it's likely easiest to just check for the 'hypervisor' flag on cpu 0 and update 'guest' accordingly
[2014-03-19 20:17:30 -0400] anthroprose: not at all, I just wanted to make sure I didnt tell you to regen on an existing system ;)
[2014-03-19 20:18:47 -0400] posita: anthroprose: If that were the case, (once they're generated), where would one find them? (Just so I know.)
[2014-03-19 20:19:17 -0400] aalmenar: jharley: yes, what i dont understand it's why doesn't work https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/linux/virtualization.rb#L70
[2014-03-19 20:19:33 -0400] posita: (The docs say the user pem is available on the "Change Password" page, but that no longer appears to be the case.)
[2014-03-19 20:20:08 -0400] jharley: aalmenar: I'm pretty sure cpuinfo doesn't match any of those strings with modern libvirt/KVM?
[2014-03-19 20:20:32 -0400] anthroprose: you using the preview or manage.?
[2014-03-19 20:20:35 -0400] aalmenar: jharley: there clearly has an option to read /proc/cpuinfo, and mine has: model name: Common KVM processor
[2014-03-19 20:21:14 -0400] posita: I'm not sure what that means, but I think "preview" (the URL for the management interface is https://preview.opscode.com/organizations/).
[2014-03-19 20:21:50 -0400] jharley: aalmenar: what versioh of ohai do you have then?
[2014-03-19 20:22:16 -0400] coderanger: posita: Try getchef.com/account
[2014-03-19 20:22:38 -0400] aalmenar: jharley: yeap, my mistake, i was reading head instead of the tag
[2014-03-19 20:22:43 -0400] jharley: aalmenar: that change was only made two months ago and isn't in my copy of 6.20.0
[2014-03-19 20:22:45 -0400] aalmenar: duh
[2014-03-19 20:22:46 -0400] jharley: aalmenar: k, cool
[2014-03-19 20:25:11 -0400] jidar: anybody famiular with packer understand how it fits into the workflow? does packer check chef recipe versions and rebuild on knife upload, or what?
[2014-03-19 20:25:51 -0400] redondos: I'm having this error importing my data from chef10 to chef11: ERROR: JSON::ParserError: Unsupported `json_class` type 'Chef::WebUIUser'
[2014-03-19 20:26:17 -0400] redondos: it's supposedly fixed in CHEF-4515, but I'm using 11.0.11-1.ubuntu.12.04 which I believe to be newer
[2014-03-19 20:26:20 -0400] coderanger: jidar: packer builds images, you could have one of those steps be to run chef-solo, but packer neither knows nor cares about Chef
[2014-03-19 20:26:44 -0400] redondos: any ideas about how I can successfully do the migration?
[2014-03-19 20:27:00 -0400] posita: anthroprose & coderanger: Now I understand. All is well <http://youtu.be/zDAmPIq29ro>. Thanks for your help!
[2014-03-19 20:27:03 -0400] coderanger: redondos: Remove that object
[2014-03-19 20:27:28 -0400] coderanger: redondos: webuiuser was replaced with just user, but it has a different format and data
[2014-03-19 20:27:40 -0400] redondos: I am not sure I understand which object it is
[2014-03-19 20:27:48 -0400] redondos: there is no such a line in the webui user
[2014-03-19 20:28:07 -0400] coderanger: redondos: How are you moving the data?
[2014-03-19 20:28:17 -0400] redondos: knife download / knife upload
[2014-03-19 20:28:36 -0400] coderanger: redondos: Do after you do the download, find the user files and remove them
[2014-03-19 20:28:45 -0400] redondos: all of them?
[2014-03-19 20:29:06 -0400] coderanger: redondos: If you have multiple webui users, yes
[2014-03-19 20:29:15 -0400] jidar: coderanger: only reason I ask is because of this snippet from their site: "Packer can be used to generate new machine images for multiple platforms on every change to Chef/Puppet."
[2014-03-19 20:29:21 -0400] redondos: i guess i can try not uploading any users for now.
[2014-03-19 20:29:36 -0400] coderanger: jidar: Sure, like I said, packer can run chef-solo because it can run any command
[2014-03-19 20:29:47 -0400] redondos: ls
[2014-03-19 20:29:48 -0400] jidar: coderanger: yep, groovy
[2014-03-19 20:30:14 -0400] coderanger: jidar: It has a chef-solo provisioner to make life a bit easier, but it doesn't do anything other than run it for you
[2014-03-19 20:30:51 -0400] coderanger: jidar: If you wanted to you could setup jenkins to watch for changes to a cookbook and rebuild the images
[2014-03-19 20:31:09 -0400] coderanger: jidar: Thats basically what the netfix bakery is, except they use aminator instead of packer
[2014-03-19 20:31:46 -0400] anthroprose: heyo, thats what I'm doing right now
[2014-03-19 20:31:52 -0400] anthroprose: forgot to rebuild the box
[2014-03-19 20:31:56 -0400] anthroprose: last time thats gonna happen
[2014-03-19 20:38:35 -0400] jharley: anthroprose: I opened an issue against foodcritic -- thanks for walking me through my issue
[2014-03-19 20:40:43 -0400] hugespoon: does anyone know if using a scaled front/back end for enterprise chef, if i need LDAP server access on both the front and back end servers? i.e. add the ldap bits to private-chef.rb and then reconfigure on all nodes in the cluster? and do the back end nodes need to reach the LDAP server(s) as well?
[2014-03-19 20:41:19 -0400] iamchrisf: Trying to debug a recipe in chef-shell, but can't seem to load the run list.  Should "-j somejsonfile" load  a run list?
[2014-03-19 20:42:29 -0400] coderanger: hugespoon: Hmm, I think the actual LDAP calls come from the web UI IIRC, but its been months since I saw that code
[2014-03-19 20:42:53 -0400] coderanger: hugespoon: You are best off asking enterprise-specific questions via a support ticket to ChefInc though
[2014-03-19 20:43:42 -0400] iamchrisf: Here's my example:  http://pastie.org/pastes/8951610/text
[2014-03-19 20:44:04 -0400] hugespoon: coderanger: thanks, just was hoping someone might know so i can keep my momentum going :D
[2014-03-19 20:44:08 -0400] coderanger: iamchrisf: I suck at chef-shell but I can try and help you debug the actual recipe
[2014-03-19 20:44:09 -0400] iamchrisf: Notice how run list evaluates to [] even thought I'm passing a json file with a valid run list
[2014-03-19 20:44:25 -0400] coderanger: hugespoon: Sorry, of the few ChefInc people still active on here, they don't really touch enterprise much
[2014-03-19 20:45:21 -0400] iamchrisf: coderanger - It's the was cookbook I'm trying to use aws_ebs_volume to create a new ebs col but it seems as though it's skipping over the whole block.  I have debug on and no debug output from the was cookbook
[2014-03-19 20:45:56 -0400] coderanger: iamchrisf: Whats the role look like?
[2014-03-19 20:48:48 -0400] iamchrisf: coderanger- here's the recipe  - http://pastie.org/pastes/8951623/text
[2014-03-19 20:49:25 -0400] coderanger: iamchrisf: And you see that recipe being executed but no output from it?
[2014-03-19 20:49:55 -0400] houms: I am trying to upload cookbooks from workstation to server but get a internal service error and the server logs show. http://pastie.org/8951630
[2014-03-19 20:50:50 -0400] iamchrisf: code ranger - waiting on a new run to send you output.
[2014-03-19 20:51:08 -0400] coderanger: houms: try restarting bookshelf, also check you aren't out of disk space
[2014-03-19 20:54:08 -0400] houms: thanks coderanger, still got 5gb of space and i just restarted bookshelf with chef-server-ctl restart bookshelf. but running the knife cookbook upload $cookbook returns same error and log shows http://pastie.org/8951642
[2014-03-19 20:54:17 -0400] iamchrisf: coderanger: http://pastie.org/pastes/8951644/text
[2014-03-19 20:54:26 -0400] dgarstang: This is really painful. "could not find recipe test for cookbook bc-location".... referenced WHERE?
[2014-03-19 20:54:48 -0400] coderanger: iamchrisf: Thats not really useful output, could you include a bit more?
[2014-03-19 20:55:05 -0400] houms: dgarstang, i agree i ran into same issue. it seems in your knife.rb you should be specifying the location fo cookbooks
[2014-03-19 20:55:05 -0400] iamchrisf: coderanger: That is the problem!
[2014-03-19 20:55:07 -0400] coderanger: dgarstang: Check the traceback
[2014-03-19 20:55:16 -0400] coderanger: iamchrisf: Thats the _only_ output?
[2014-03-19 20:55:20 -0400] houms: some thing like cookbook_path ["/mypath/to/cookbooks"]
[2014-03-19 20:55:21 -0400] iamchrisf: code ranger - it's not giving anymore in debug...  That's why the next option is chef-shell
[2014-03-19 20:55:25 -0400] dgarstang: coderanger: There isn't a traceback
[2014-03-19 20:55:40 -0400] coderanger: dgarstang: Look below, it probably wrote it to a file
[2014-03-19 20:55:51 -0400] iamchrisf: It just site in that block waiting for a device that with never show up.
[2014-03-19 20:55:54 -0400] coderanger: iamchrisf: What command are you running, at a minimum chef prints out its version when it starts
[2014-03-19 20:56:00 -0400] dgarstang: houms: I don't think that's it. Some cookbook on the server is referencing bc-location::test but I dont know which one
[2014-03-19 20:56:07 -0400] iamchrisf: I cut out most of the extraneous data.
[2014-03-19 20:56:16 -0400] coderanger: iamchrisf: Please don't
[2014-03-19 20:56:22 -0400] iamchrisf: As you can see from the first line there it is in "-l debug"
[2014-03-19 20:56:39 -0400] coderanger: iamchrisf: By definition what you are considering extraneous might be incorrect
[2014-03-19 20:56:52 -0400] iamchrisf: coderanger:  Unless logging is not linear?
[2014-03-19 20:57:00 -0400] dgarstang: i gotta tell ya, it's also annoying how chef will die if a variable is unset, it means you can't use log to debug it
[2014-03-19 20:57:01 -0400] coderanger: iamchrisf: Not sure what you mean
[2014-03-19 20:57:22 -0400] iamchrisf: The issue is there is no log data between the 2 before entries.
[2014-03-19 20:57:32 -0400] iamchrisf: That is where the aws_ebs_volume block resides.
[2014-03-19 20:58:22 -0400] iamchrisf: meaning it is not being called.... the log level is debug and looking through the was cookbook there are dozens of debug output calls.
[2014-03-19 21:00:28 -0400] houms: is there anything else that can be checked that would indicate what the internal error is?
[2014-03-19 21:03:23 -0400] iamchrisf: houms:  I want to step through the recipe using chef-shell.
[2014-03-19 21:03:58 -0400] iamchrisf: houms:  but it won't load the run-list as this is a first run and it is not registered with chef... and it also seems to be ignoring the json file with a run list I am passing it.
[2014-03-19 21:04:48 -0400] houms: wish i could help chris. I am trying to get an answer for why the cookbooks do not upload to chef-server from workstation
[2014-03-19 21:04:57 -0400] houms: brb
[2014-03-19 21:09:28 -0400] lmickh: if I'm trying to define a node.default attribute using a ruby_block. The attribute gets set fine when I do a search against it, but the recipe template that goes through each of the child attributes does not see it.  Anyone have a guess as to why?
[2014-03-19 21:09:56 -0400] fayesal: lmickh: you probably want to wrap the attribute in a lazy {} block
[2014-03-19 21:13:11 -0400] fayesal: lmickh: you update the attribute's value in the ruby_block, which isn't evaluated during the time other blocks are added to the list.  the attribute values are usually cooked in at that point.  You need to use a lazy block around the places where you read that attribute, or evaluate the attribute outside of any block.
[2014-03-19 21:17:22 -0400] skansky: anyone here get chef working with Hiera? I was told that puppet's hiera is a separate thing unto itself.
[2014-03-19 21:17:45 -0400] lmickh: fayesal: can I wrap the attribute in the lazy block within the template or do I have to do it in the recipe and pass it to the template as a variable?
[2014-03-19 21:20:16 -0400] fayesal: if the attribute is evaluated in the template, I believe it would be fine.  What I suspect is happening is that you are dereferencing the attribute in the recipe.
[2014-03-19 21:21:10 -0400] fayesal: path = node['updated_attribute']
[2014-03-19 21:21:22 -0400] fayesal: and then you refer to path
[2014-03-19 21:21:26 -0400] fayesal: or something like htat
[2014-03-19 21:22:15 -0400] fayesal: if you have <%= node['foo'] %> in the template, I believe that will resolve to the updated value, provided the evaluation order is as expected.
[2014-03-19 21:24:00 -0400] lmickh: In one recipe I have some default attributes and a template that does a <% node['attri']['sub'].each do
[2014-03-19 21:24:44 -0400] lmickh: Then in another recipe I'm trying to add another node['attri']['sub'] via the ruby_block.
[2014-03-19 21:25:21 -0400] fayesal: and does that evaluate before, or after the place it is used?
[2014-03-19 21:25:41 -0400] kbarry: Anyone using the tomcat cookbook to install tomcat 8?
[2014-03-19 21:25:54 -0400] kbarry: (I can't seem to get it working, but then again, i don't really know what I am doing :)
[2014-03-19 21:26:08 -0400] lmickh: Originally it was after.  I also tried include_recipe after the ruby_block, but it performed the same way
[2014-03-19 21:26:11 -0400] kbarry: I can get it to install tomcat 6 (the default) fine, but when i change the base version to 8,
[2014-03-19 21:26:32 -0400] kbarry: no worky
[2014-03-19 21:28:50 -0400] fayesal: kbarry: you probably need to be able to define "no worky" to get useful help.
[2014-03-19 21:28:52 -0400] mjuszczak: coderanger: Looks like based on google you used to have a fork of the database cookbook, but then recommended chef-rewind.  I'm trying to do something similar to what you were doing.  Is there a way to insert a new resource with chef-rewind, not just replace a different one?
[2014-03-19 21:30:29 -0400] kbarry: ;)
[2014-03-19 21:30:45 -0400] kbarry: The tomcat recipe invokes the package resource
[2014-03-19 21:32:03 -0400] kbarry: http://pastebin.com/qK9UfXif
[2014-03-19 21:32:04 -0400] fayesal: kbarry: perhaps try running chef-client -l debug
[2014-03-19 21:32:23 -0400] kbarry: the problem seems to be with the package name "tomcat8"
[2014-03-19 21:32:46 -0400] fayesal: correct.
[2014-03-19 21:33:02 -0400] kbarry: the name of the package is dynamically defined as "tomcat" plus the value of the version attribute
[2014-03-19 21:33:13 -0400] kbarry: so the default package it installs is "tomcat6"
[2014-03-19 21:33:13 -0400] fayesal: kbarry: it certainly looks that way.
[2014-03-19 21:33:17 -0400] kbarry: because 6 is the default version
[2014-03-19 21:33:37 -0400] fayesal: stupid question: have you added a package tomcat8?
[2014-03-19 21:33:38 -0400] kbarry: I don't know how to determine the proper package name for tomcat 8.
[2014-03-19 21:33:53 -0400] kbarry: I "thought" it would be "tomcat8"
[2014-03-19 21:33:58 -0400] kbarry: if version 6, was "tomcat6"
[2014-03-19 21:34:23 -0400] kbarry: fayesal: not a stupid question, i didn't know one would need to add a package.
[2014-03-19 21:34:45 -0400] kbarry: never done that before, what would I need to have done?
[2014-03-19 21:34:47 -0400] fayesal: this isn't really a chef issue, it's based on how your OS manages packages apt or yum etc.
[2014-03-19 21:35:02 -0400] segv: arg
[2014-03-19 21:35:06 -0400] segv: any of the chef-metal devs in here?
[2014-03-19 21:35:34 -0400] fayesal: kbarry: you'd want to find the appropriate package in your distribution or rpm find etc.
[2014-03-19 21:35:49 -0400] fayesal: and then make sure your boxes have that in their available repository.
[2014-03-19 21:36:15 -0400] kbarry: the package resource, uses these local repositiories?
[2014-03-19 21:36:35 -0400] kbarry: i took it as granted that the package resource would just find what was needed :)
[2014-03-19 21:36:48 -0400] kbarry: I'm more windows, just pretending to be Linux today.
[2014-03-19 21:37:01 -0400] fayesal: kbarry: ops would be a lot easier if we could just snap our fingers :)
[2014-03-19 21:37:03 -0400] mattsurabian: is it considered a bad practice to set default attributes within recipes?
[2014-03-19 21:37:12 -0400] mattsurabian: as opposed to the attributes file
[2014-03-19 21:37:35 -0400] mattsurabian: like if an attributes value needs to be derived by a recipe or something
[2014-03-19 21:37:42 -0400] kbarry: mattsurabian I would say yet,
[2014-03-19 21:37:43 -0400] mattsurabian: and then later used by another recipe
[2014-03-19 21:37:57 -0400] mattsurabian: kbarry: it seems that way to me too
[2014-03-19 21:38:07 -0400] kbarry: take a look at attributed precedence levels,
[2014-03-19 21:38:26 -0400] kbarry: defined in the cookbooks attributes file is a good place to store them
[2014-03-19 21:38:47 -0400] fayesal: kbarry: what OS are you targetting?
[2014-03-19 21:38:50 -0400] kbarry: you might run into issues trying to override them when you define them inside the recipe itself
[2014-03-19 21:38:55 -0400] kbarry: cento
[2014-03-19 21:38:57 -0400] kbarry: 6.5
[2014-03-19 21:39:36 -0400] mattsurabian: I'm using chef on rightscale, and I need to derive the path to the collectd plugin directory was trying to this in the attributes file
[2014-03-19 21:39:37 -0400] mattsurabian: default[:collectd_alive_file_counter_path] = ::File.join(node[:rightscale][:collectd_lib], "plugins", "alive-file-counter.rb")
[2014-03-19 21:40:17 -0400] mattsurabian: but lately RS complains about node[:rightscale][:collectd_lib] being nil when it loads the attributes file so I'm stuck needing to do it in a recipe
[2014-03-19 21:40:29 -0400] mattsurabian: unfortunately multiple recipes need to know where that plugin is
[2014-03-19 21:40:35 -0400] mattsurabian: which is why it was an attribute
[2014-03-19 21:40:41 -0400] kbarry: could it be the format of the attrivuted file?
[2014-03-19 21:40:42 -0400] mattsurabian: heh
[2014-03-19 21:40:51 -0400] kbarry: meaning, are there other attributes set in the attribute file,?
[2014-03-19 21:41:15 -0400] mattsurabian: yeah but it's not that, hasn't been touched in a while
[2014-03-19 21:41:27 -0400] mattsurabian: RS has a funny way of doing things cause it's a much older fork of chef
[2014-03-19 21:41:48 -0400] mattsurabian: I suspect it has something to do with some recent change they've made but I don't know for sure
[2014-03-19 21:42:12 -0400] mattsurabian: so I was hoping to be able to just set the default, or possibly an override in the recipe that actually installs that collectd plugin
[2014-03-19 21:42:26 -0400] mattsurabian: then any other recipes that need to get node[:collectd_alive_file_counter_path]
[2014-03-19 21:42:58 -0400] mattsurabian: would be able to access it since they all already call the main plugin install recipe to ensure it's installed before trying to use it
[2014-03-19 21:43:16 -0400] kbarry: so,
[2014-03-19 21:43:31 -0400] kbarry: can you see it set to nil on the node
[2014-03-19 21:43:47 -0400] fayesal: kbarry: it look alike tomcat 8 is only available as a tar ball right now, so you'd have to deal with making an RPM or having a chef recipe that uses the tar ball.  that's the leeding edge for you.
[2014-03-19 21:43:52 -0400] kbarry: knife node show [nodename] -l -f json
[2014-03-19 21:44:06 -0400] kbarry: -l (show all attritbs.) -f (format)
[2014-03-19 21:44:10 -0400] mattsurabian: hah oh I wish I could knife in rightscale
[2014-03-19 21:44:15 -0400] mattsurabian: how much easier this would be
[2014-03-19 21:44:15 -0400] mattsurabian: heh
[2014-03-19 21:44:30 -0400] mattsurabian: sadly AFAIK knife is completely unsupported
[2014-03-19 21:45:07 -0400] mattsurabian: they have a knife plugin
[2014-03-19 21:45:18 -0400] kbarry: lucky :)
[2014-03-19 21:45:33 -0400] mattsurabian: but it doesn't support normal knife commands
[2014-03-19 21:45:39 -0400] mattsurabian: only lists servers and boots new ones
[2014-03-19 21:45:43 -0400] mattsurabian: deletes
[2014-03-19 21:45:43 -0400] mattsurabian: etc
[2014-03-19 21:45:50 -0400] mattsurabian: can't actually interact with the nodes
[2014-03-19 21:46:36 -0400] kbarry: fayesal: thanks for the info. Gives me a route to go.
[2014-03-19 21:47:01 -0400] caryp: mattsurabian: that is because RightScale's native chef is simply chef-solo runs
[2014-03-19 21:47:22 -0400] mattsurabian: oh hai caryp!
[2014-03-19 21:48:05 -0400] rdobbs: I'm doing the wrong thing and trying to use application_ruby, still. I've got this unsolvable issue around the broken runit init script it generates. I was trying to deal with it by just recreating it at the end of the block, but the bad script causes unicorn to fail which causes the nginx restart to fail .. I found that if I rm that init script manually then run chef-client, I get the file I want. if I have that file deleted at the beginning of that recipe, t
[2014-03-19 21:48:06 -0400] caryp: hey now!
[2014-03-19 21:48:09 -0400] mattsurabian: so would my best bet be to set an override in the main install recipe for this plugin?
[2014-03-19 21:48:18 -0400] rdobbs: this feels like bug 1010 in puppet, but chefified.
[2014-03-19 21:48:58 -0400] mattsurabian: given that RS doesn't support environments or roles or anything, it's not like we'd have to worry about something else trying to override this and being unable to do so
[2014-03-19 21:49:51 -0400] kbarry: i  "think" there might be a way to see them on the node itself?
[2014-03-19 21:50:49 -0400] kbarry: i would start by manually defining the attribute at the highest precedence level possible,
[2014-03-19 21:50:52 -0400] kbarry: and see if it sticks,
[2014-03-19 21:50:53 -0400] mjuszczak: sethvargo: A quick aside on this (https://github.com/opscode-cookbooks/mysql/blob/27f3b34fe0c01a371b8d576071ed575ac3bd1897/recipes/ruby.rb) - could I use chef-rewind to somehow insert a new include so that the mariadb repo gets inserted prior to the   resources("package[#{name}]").run_action(:install)?  That would solve my issue, I think, without having to need to fork.
[2014-03-19 21:50:58 -0400] kbarry: then step down thru the leters
[2014-03-19 21:51:07 -0400] mjuszczak: everything I see about chef-rewind just seems to be around modifying existing resourcs
[2014-03-19 21:52:14 -0400] sethvargo: @mjuszczak you don't need chef-rewind... you can just search the resource collection
[2014-03-19 21:53:12 -0400] mjuszczak: sethvargo: Do you have an example on one of your blog posts per chance?
[2014-03-19 21:53:31 -0400] sethvargo: no... just look in chef-rewind. It's pretty straight-forward
[2014-03-19 21:53:48 -0400] mjuszczak: okay.  Thanks.
[2014-03-19 21:53:52 -0400] sethvargo: https://github.com/bryanwb/chef-rewind/blob/0930c4ce000ad07c8547171ec146316649038c83/lib/chef/rewind.rb#L22-L29
[2014-03-19 21:53:53 -0400] sethvargo: That's it
[2014-03-19 22:05:25 -0400] caryp: mattsurabian: so it sounds like your attributes file depends on another attribute.  There looks to be a way to specify attribute file load order. http://docs.opscode.com/essentials_cookbook_attribute_files.html
[2014-03-19 22:06:02 -0400] caryp: mattsurabian: not sure what version of chef added the include_attribute method
[2014-03-19 22:06:05 -0400] mattsurabian: ah right! had read about that a while back
[2014-03-19 22:06:20 -0400] mattsurabian: right heh I tried to use init_command on service and got denied the other day :-p
[2014-03-19 22:06:48 -0400] mattsurabian: appreciate it caryp I think I'll just set the default in the recipe like we talked about
[2014-03-19 22:07:02 -0400] caryp: mattsurabian:  cool cool.
[2014-03-19 22:07:07 -0400] mattsurabian: though... heh now I'm kinda curious to try it out and see if it works
[2014-03-19 22:07:08 -0400] mattsurabian: :-p
[2014-03-19 22:07:33 -0400] caryp: mattsurabian: me too.  if you do end up trying it, lemme know how it goes.
[2014-03-19 22:07:52 -0400] mattsurabian: only worried about the non-deterministic loading... just because it "worked" doesn't mean it really worked
[2014-03-19 22:07:55 -0400] mattsurabian: I think I'll try it
[2014-03-19 22:08:34 -0400] mattsurabian: I'd assume it would reject the setting entirely like it did with init_command though
[2014-03-19 22:11:20 -0400] mattsurabian: caryp: I'm trying it I'll let you know in #rightscale
[2014-03-19 22:13:11 -0400] caryp: mattsurabian: it looks like include_attribute method was supported many moons ago. https://tickets.opscode.com/browse/CHEF-219
[2014-03-19 22:13:46 -0400] mattsurabian: 09... yeah that was right around when RS forked wasn't it? ~5 years ago
[2014-03-19 22:19:13 -0400] caryp: mattsurabian: heh. yeah it was 09. but closer to the 0.5.6 release.  I think 10.26 is current version supported by RS.  Chef 11.6 support is out in the latest RC1 images.
[2014-03-19 22:19:57 -0400] mattsurabian: that's exciting
[2014-03-19 22:20:28 -0400] mattsurabian: honestly, the biggest bummer with RS Chef is the modified workflow, and not quite being able to use the same tools as everyone else
[2014-03-19 22:20:38 -0400] mattsurabian: it's still awesome, but differently awesome
[2014-03-19 22:20:59 -0400] mattsurabian: still find we're doing a lot of the ol' boot and wait testing procedures and stuff
[2014-03-19 22:21:37 -0400] mattsurabian: any plans to release a vagrant share box or something for those right images?
[2014-03-19 22:21:58 -0400] coredump: berkshelf users: am I correct in my assumption that you need 1 repo per cookbook? And if so, how do you manage it into your organization (I mean, that can generate a lot of repos)
[2014-03-19 22:22:38 -0400] caryp: mattsurabian: it's all in what you need to do.  Many folks are using RS simply as a "launch pad" that bootstraps their chef clients then using Chef Server or hosted Chef for the actual config management.
[2014-03-19 22:22:45 -0400] anthroprose: coredump: only if you are making changes
[2014-03-19 22:22:59 -0400] coredump: we have a bunch of custom cookbooks
[2014-03-19 22:23:07 -0400] coredump: I am trying to fix that as I can, but still
[2014-03-19 22:23:21 -0400] anthroprose: my cookbooks are per repo, most others are as well
[2014-03-19 22:23:31 -0400] anthroprose: but not the knife cookbook chef-repo
[2014-03-19 22:23:37 -0400] anthroprose: standalones, for testing, etc...
[2014-03-19 22:24:17 -0400] coredump: hmm so you don't use berkshelf for your own cookbooks?
[2014-03-19 22:24:28 -0400] anthroprose: I do
[2014-03-19 22:24:33 -0400] anthroprose: in what context tho?
[2014-03-19 22:24:46 -0400] coredump: like you still using cookboks/site-cookbooks
[2014-03-19 22:24:59 -0400] anthroprose: for doing things like product demos, POCs & things
[2014-03-19 22:25:03 -0400] anthroprose: yes
[2014-03-19 22:25:20 -0400] coredump: hmm. maybe I can mix and match stuff and get the best of both worlds
[2014-03-19 22:25:22 -0400] anthroprose: i put my wrapper cookbook in site-cookbooks, then use berksfile to fill in ./cookbooks
[2014-03-19 22:25:44 -0400] anthroprose: https://gist.github.com/anthroprose/c161447d166c3fb5a64f
[2014-03-19 22:26:06 -0400] coredump: Oh
[2014-03-19 22:26:10 -0400] coredump: I didn't know the :path thing
[2014-03-19 22:26:22 -0400] coredump: I should probably RTFM
[2014-03-19 22:26:27 -0400] coredump: thanks
[2014-03-19 22:26:46 -0400] anthroprose: dude, I find 99% from blogposts
[2014-03-19 22:26:57 -0400] anthroprose: that I then find out are actually too old and dont work anymore
[2014-03-19 22:27:09 -0400] anthroprose: and then I complain here :)
[2014-03-19 22:27:10 -0400] coredump: sounds correct :)
[2014-03-19 22:27:44 -0400] coredump: the ammount of outdated information on the internet will one day surpass the useful one and we will know that the end is near
[2014-03-19 22:27:58 -0400] anthroprose: and then hope that coderanger dosn't correct me for telling other people stupid things
[2014-03-19 22:28:00 -0400] anthroprose: heh
[2014-03-19 22:28:26 -0400] anthroprose: free training tho ;)
[2014-03-19 22:28:36 -0400] werdnativ: I'm trying to decide what to put in our railsapp cookbook and what to leave for capistrano... directories? code from git? monit? upstart? they are kind of interdependent, where do you draw the line?
[2014-03-19 22:28:43 -0400] erichs: Hi, all! I'm using hosted chef, and I've uploaded a locally modified recipe using knife. The cookbook is not frozen, but running chef-client on the target node results in using a cached previous version of the cookbook. Is there a way to force cache invalidation on the client?
[2014-03-19 22:29:10 -0400] werdnativ: erichs: give the cookbook a new version number?
[2014-03-19 22:29:18 -0400] anthroprose: wednativ: all of those you describe I use chef for
[2014-03-19 22:29:22 -0400] coredump: werdnativ: I create base directories and config files with chef (managing databases.yml for example to keep passwords safe)
[2014-03-19 22:29:27 -0400] erichs: werdnativ: is that mandatory each time I change the cookbook?
[2014-03-19 22:29:37 -0400] coredump: werdnativ: capistrano only takes cares of the releases/current dir
[2014-03-19 22:30:00 -0400] coredump: and atm I fucking hate monit and want it to burn in hell
[2014-03-19 22:30:13 -0400] werdnativ: coredump yeah! :) considering bluepill or something.
[2014-03-19 22:30:24 -0400] coredump: runit
[2014-03-19 22:30:34 -0400] werdnativ: runit +1 too.
[2014-03-19 22:30:49 -0400] coredump: the runit cookbook, btw, is a thing of beauty
[2014-03-19 22:31:05 -0400] coredump: "runit_service unicorn" and a couple of templates
[2014-03-19 22:31:23 -0400] erichs: Is bumping cookbook version numbers required for each 'knife cookbook upload' to hosted chef, regardless of frozen state?
[2014-03-19 22:31:45 -0400] anthroprose: erichs: if you dont clients may run cached versions
[2014-03-19 22:31:46 -0400] werdnativ: coredump so you setup runit with chef, and leave only a blank shell until capistrano puts code into current & restarts?
[2014-03-19 22:32:11 -0400] erichs: anthroprose: ok. so, technically no, but practically yes. ;)
[2014-03-19 22:32:35 -0400] anthroprose: erichs: if I don't... I find my self rm -rf /var/chef/cache alot
[2014-03-19 22:32:48 -0400] coredump: I configure the unicorn service normally with chef, and when capistrano deploys and changes the current link it issues a sv hup to unicorn
[2014-03-19 22:32:49 -0400] erichs: anthroprose: thanks. that answered my other question .
[2014-03-19 22:32:56 -0400] coredump: hup?
[2014-03-19 22:33:04 -0400] coredump: I may be citing the wrong signal, give me a sec
[2014-03-19 22:33:35 -0400] coredump: USR2
[2014-03-19 22:33:48 -0400] coredump: the no-downtime-reload thing
[2014-03-19 22:33:52 -0400] werdnativ: yeah, the rolling restart one.
[2014-03-19 22:34:15 -0400] coredump: I am actually writing a blog post for the company blog about some unicorn weirdness with big apps
[2014-03-19 22:34:19 -0400] werdnativ: meanwhile until cap deploy it just points at an empty directory and complains?
[2014-03-19 22:34:44 -0400] coredump: the solution, believe it, was to add a 40s pause between the new master starting and the workers start respawning.
[2014-03-19 22:35:10 -0400] anthroprose: I kinda took for granted our flask app autodetects & reloads file changes
[2014-03-19 22:35:46 -0400] werdnativ: coredump hit me with a link to your blog, we run into that too... intermittently it doesn't do the "no downtime" dance correctly.
[2014-03-19 22:36:02 -0400] coredump: werdnativ: you are right, that would happen, but on all cases I did that the contents were there. But you can add a test -f on the runit script if you don't like it complaining
[2014-03-19 22:36:22 -0400] coredump: werdnativ: it will be on product.voxmedia.com in a few weeks or so
[2014-03-19 22:36:48 -0400] werdnativ: I'll keep an eye for it, cheers.
[2014-03-19 22:39:05 -0400] werdnativ: anthroprose if you use chef to do the full initial deploy, then no capistrano? is that full-auto continuous deploy on each chef-client run?
[2014-03-19 22:39:25 -0400] anthroprose: werd: so I'm running a python app with a custom deploy script
[2014-03-19 22:39:33 -0400] anthroprose: I use the git resource
[2014-03-19 22:39:39 -0400] anthroprose: and then a piece of bash
[2014-03-19 22:39:59 -0400] anthroprose: once the application cookbook is refactor'd I will do my best to ensure proper virtualenv support and a few other things
[2014-03-19 22:40:21 -0400] anthroprose: but until then, I just knife ssh "chef_environment:Production AND role:web" ""pullcode"
[2014-03-19 22:41:02 -0400] werdnativ: ah, cool. simpler requirements then, no precompile assets, etc. :)
[2014-03-19 22:41:55 -0400] anthroprose: for me yes, its a fairly simple webapp
[2014-03-19 22:42:03 -0400] anthroprose: I do store some assets in s3
[2014-03-19 22:42:14 -0400] anthroprose: but they are relativly static and do not re-build for code changes
[2014-03-19 22:44:32 -0400] werdnativ: our cap deploy does some railsy build steps, so that's what I'm wondering about keeping a consistent process between first chef run & subsequent manual deploy. I think I'll go with getting cap to put the code there as suggested.
[2014-03-19 22:44:58 -0400] rdobbs: so strange that running a run script in /etc/service/app manually works fine, but it doesn't get run at all when runit tries.
[2014-03-19 22:45:11 -0400] rdobbs:  /me hugs sysvinit, "hello my old friend"
[2014-03-19 22:45:42 -0400] redondos: coderanger: thanks for your help earlier today. i upgraded to chef11 skipping most users.
[2014-03-19 22:45:46 -0400] redondos:  i actually might not re-create them since i don't want them editing stuff on the webui, rather i want them to commit to a git repository so the changes are more visible.
[2014-03-19 22:45:56 -0400] werdnativ: don't like all these young upstarts, rdobbs? :)
[2014-03-19 22:46:07 -0400] rdobbs: werdnativ: I wouldn't mind if they worked
[2014-03-19 22:46:28 -0400] werdnativ: guess it hasn't failed me yet.
[2014-03-19 22:46:30 -0400] rdobbs: I've never seen a runit instance that didn't give that constant message of unable to lock supervisor/lock
[2014-03-19 22:47:09 -0400] rdobbs: mostly my problem rught now is that deploy/application_ruby has naive defaults when interacting with runit, throwing in a blank template that doesn't work for anything as far as I can tell
[2014-03-19 22:47:24 -0400] rdobbs: and you can't rewind it
[2014-03-19 22:47:37 -0400] werdnativ: yeah, gave up on application_* myself.
[2014-03-19 22:47:43 -0400] xmltok: how can i install chef-server on a machine without internet access?
[2014-03-19 22:47:55 -0400] rdobbs: on my rails instances I just gave up on chef this morning and baked an AMI
[2014-03-19 22:47:59 -0400] rdobbs: =~(
[2014-03-19 22:48:12 -0400] rdobbs: next week, or the week after, I'll have time to start doing this all in my own recipes
[2014-03-19 22:49:52 -0400] rdobbs: the irony is the only reason my application_ruby cookbooks deploy properly is because runit doesn't bother trying to run it's run script, it just returns a
[2014-03-19 22:50:09 -0400] rdobbs: then I have a hackish bash script to run /etc/service/app/run manually
[2014-03-19 22:50:22 -0400] rdobbs: (bash block in my recipe)
[2014-03-19 22:51:25 -0400] anthroprose: rdobbs: so you can take that & turn it into a LWRP pretty easily
[2014-03-19 22:51:39 -0400] anthroprose: to hide the bash, and give it idempotence and reporting/functionality
[2014-03-19 22:53:12 -0400] rdobbs: https://gist.github.com/anonymous/9653117
[2014-03-19 22:53:15 -0400] rdobbs: is my oogliness so far
[2014-03-19 22:53:30 -0400] rdobbs: most of that is pointless because you can't modify the internals of the application stuff without forking
[2014-03-19 22:54:32 -0400] rdobbs: I liked the idea of  the deploy resource so that it could do the right thing, put different releases in their own directories and switch a symlink, but when I have time again, next week, I'm doing what you said and going to just git repos
[2014-03-19 22:55:24 -0400] rdobbs: Opscode should publish an official document listing things like "Don't use the deploy resource, it's broken" and same with the application cookbooks.
[2014-03-19 22:56:14 -0400] rdobbs: it would have been nice to have an action to not try and start the service, so you could do that manually
[2014-03-19 22:56:39 -0400] anthroprose: action :nothing
[2014-03-19 22:56:44 -0400] anthroprose: and then notify from something else?
[2014-03-19 22:57:15 -0400] rdobbs: action :nothing won't deploy
[2014-03-19 22:57:19 -0400] rdobbs: so right?
[2014-03-19 22:57:26 -0400] rdobbs: err right?
[2014-03-19 22:58:18 -0400] anthroprose: its support nothing yeah
[2014-03-19 22:58:27 -0400] rdobbs: so what's the point?
[2014-03-19 22:58:29 -0400] anthroprose: then somewhere else you notify the deploy["whatever"]
[2014-03-19 22:58:38 -0400] anthroprose: with either delayed or immediate
[2014-03-19 22:58:46 -0400] rdobbs: I need deploy to do everything but restart the application and nginx
[2014-03-19 22:59:12 -0400] rdobbs: since I need to overwrite /etc/service/app/run before unicorn is started
[2014-03-19 22:59:16 -0400] rdobbs: or it fails, causing nginx to fail
[2014-03-19 22:59:50 -0400] anthroprose: does nginx_load_balancer dodo the restart?
[2014-03-19 23:00:04 -0400] rdobbs: let me see
[2014-03-19 23:00:58 -0400] anthroprose: cause I don't see any restarts in there, unless the app or whatever provider does it
[2014-03-19 23:01:04 -0400] rdobbs: I think it does
[2014-03-19 23:01:21 -0400] rdobbs: I wonder what will happen if I just comment out the nginx_load_balancer bit
[2014-03-19 23:01:40 -0400] rdobbs: I've been staring at this all week, I'm no longer thinking straight
[2014-03-19 23:01:45 -0400] werdnativ: yeah, too much all-in-one with that resource, not enough control.
[2014-03-19 23:02:15 -0400] rdobbs: I know it's not a popular opinion, but Opscode could really step up and publish some cookbooks in this realm that are useful
[2014-03-19 23:03:07 -0400] werdnativ: rdobbs: did you try: restart_command nil
[2014-03-19 23:04:15 -0400] anthroprose: rdobbs: common complaint in the community
[2014-03-19 23:04:40 -0400] rdobbs: werdnativ: nope, sidetracked by runit fucking up unicorn
[2014-03-19 23:05:06 -0400] rdobbs: anthroprose: I tried to start that discussion at a chef meetup once, I basically got flamed out of the room by a bunch of fanboys
[2014-03-19 23:05:18 -0400] anthroprose: rdobbs: some would call me a fanboy
[2014-03-19 23:05:20 -0400] rdobbs: the best part of Chef is it's community
[2014-03-19 23:05:24 -0400] anthroprose: that dosnt mean I'm not part of the problem
[2014-03-19 23:05:24 -0400] rdobbs: the worst part of Chef is it's community
[2014-03-19 23:05:25 -0400] anthroprose: hehehe
[2014-03-19 23:05:54 -0400] anthroprose: i just wanna figure out whats 'right' and works repeatedly
[2014-03-19 23:06:04 -0400] rdobbs: I was quite the chef advocate when I switched from Puppet
[2014-03-19 23:06:13 -0400] anthroprose: but there is no appeal to authority here except self proponents
[2014-03-19 23:06:17 -0400] rdobbs: a few years into it, watching the state of the cookbooks decay, I'm looking for some new project
[2014-03-19 23:06:31 -0400] werdnativ: agreed there should be some community effort around simple ways to do the "right thing"
[2014-03-19 23:06:49 -0400] werdnativ: problem is, opscode doesn't readily take pull requests for those cookbooks.
[2014-03-19 23:06:59 -0400] rdobbs: both Chef and Puppet suffered from following the social media model : get lots of users now and build a community, then at some point around the 2nd or 3rd round of funding, focus solely on monetization
[2014-03-19 23:07:07 -0400] werdnativ: it's not like other projects on github.
[2014-03-19 23:07:56 -0400] anthroprose: werd: so start your own
[2014-03-19 23:08:01 -0400] anthroprose: its like heavywater & balance
[2014-03-19 23:08:07 -0400] anthroprose: they are driving standards currently
[2014-03-19 23:08:21 -0400] werdnativ: it doesn't have to be all up to opscode, but taking contributions to a single curated solution would be great.
[2014-03-19 23:08:34 -0400] anthroprose: werd: gotta sign a contrib agreement tho
[2014-03-19 23:08:43 -0400] anthroprose: which most companies will not let an employee do
[2014-03-19 23:08:54 -0400] erichs: Hi! I'm writing a recipe to attach an AWS EC2 volume to a node if it is not attached.
[2014-03-19 23:08:55 -0400] erichs: What I want to do is, at client run time, parse the JSON output from the `aws ec2 describe-volumes` command,
[2014-03-19 23:08:56 -0400] anthroprose: there is a secret black market for chef pull requests
[2014-03-19 23:08:57 -0400] erichs: and, based on the JSON output, conditionally run an execute block that issues a `aws ec2 attach-volume`
[2014-03-19 23:08:59 -0400] erichs: command. I don't currently understand how to structure my recipe, using ruby_block and execute resources,
[2014-03-19 23:09:01 -0400] erichs: to accomplish this. Any ideas?
[2014-03-19 23:09:20 -0400] anthroprose: erichs: where you creating the volumes?
[2014-03-19 23:09:22 -0400] werdnativ: that's not a problem, but I'm pretty discouraged after seeing really basic PRs on other cookbooks sit around a year.
[2014-03-19 23:09:31 -0400] anthroprose: werd: yup
[2014-03-19 23:09:44 -0400] anthroprose: like AWS IAM roles and VPC support for things
[2014-03-19 23:09:51 -0400] erichs: anthroprose: volumes are pre-existing EC2 vols, vol-id configurable.
[2014-03-19 23:09:52 -0400] anthroprose: industry standard, but noooope
[2014-03-19 23:10:02 -0400] erichs: anthroprose: same region as instance
[2014-03-19 23:10:05 -0400] anthroprose: erichs: but did you API gen them, hand make, or use cloudformation?
[2014-03-19 23:10:15 -0400] rdobbs: if they only sat around a year that would be great
[2014-03-19 23:10:16 -0400] anthroprose: erichs: do they have tags?
[2014-03-19 23:10:16 -0400] erichs: anthroprose: hand make
[2014-03-19 23:10:21 -0400] rdobbs: I've seen several that are 2-3 years old
[2014-03-19 23:10:23 -0400] erichs: anthroprose: no, but they could
[2014-03-19 23:10:53 -0400] rdobbs: every once and a while I get a tiny bit of useless chatter on tickets from 1-2 years ago that I was watching, had submitted, or commented on
[2014-03-19 23:10:57 -0400] anthroprose: erichs: ok.... so you can go a few different routes
[2014-03-19 23:11:06 -0400] anthroprose: the easiest, is use the aws cookbook and the ohai metadata
[2014-03-19 23:11:55 -0400] anthroprose: second easiest is leverage an aws api like you are doing
[2014-03-19 23:12:17 -0400] anthroprose: I personally would argue that you create them *with* the instance creation somehow
[2014-03-19 23:12:44 -0400] anthroprose: cloudformation/userdata/deploy api
[2014-03-19 23:12:56 -0400] erichs: anthroprose: can't easily do. these are persistent dmcrypted vols for database storage
[2014-03-19 23:13:05 -0400] anthroprose: gotcha
[2014-03-19 23:13:17 -0400] anthroprose: put tags on them
[2014-03-19 23:13:21 -0400] anthroprose: use an sdk
[2014-03-19 23:13:39 -0400] anthroprose: use instance profiles with resource level permissions for ebs attachments
[2014-03-19 23:13:52 -0400] erichs: anthroprose: solved the iam profile part
[2014-03-19 23:14:01 -0400] erichs: anthroprose: cli attach works
[2014-03-19 23:14:14 -0400] anthroprose: so whats left?
[2014-03-19 23:14:14 -0400] erichs: anthroprose: I could use an sdk, sure
[2014-03-19 23:14:21 -0400] erichs: anthroprose: the detection part
[2014-03-19 23:14:25 -0400] anthroprose: ahhh
[2014-03-19 23:14:28 -0400] anthroprose: yeah, tags
[2014-03-19 23:14:37 -0400] werdnativ: rdobbs case in point, I might have to create a timezone-iii: http://community.opscode.com/cookbooks/timezone-ii
[2014-03-19 23:14:39 -0400] anthroprose: or a bash script to loop through the cli output
[2014-03-19 23:14:50 -0400] anthroprose: or you can %x[] the cli tools and use ruby to parse it
[2014-03-19 23:15:20 -0400] erichs: anthroprose: ok. I get that, at the Ruby level. What I'm wondering about is the Chef DSL syntax here.
[2014-03-19 23:16:01 -0400] anthroprose: sql_out = %x[mysql -uroot -p#{@new_resource.password} -e "SHOW SLAVE STATUS\\G;"|grep :].split("\n") .... sql_out.each do |l|
[2014-03-19 23:16:07 -0400] anthroprose: super hacky, but ya know
[2014-03-19 23:16:10 -0400] erichs: anthroprose: If I put the state=%x[aws describe-volumes] inside a ruby_block, how do I access that state variable in a not_if conditional for an execute block?
[2014-03-19 23:16:39 -0400] anthroprose: not_if { %x[] == '' }
[2014-03-19 23:16:57 -0400] anthroprose: but complex functionality should go in a provider, lets you do things like report & error handle
[2014-03-19 23:17:12 -0400] anthroprose: new_resource.updated_by_last_action(true)
[2014-03-19 23:17:15 -0400] anthroprose: etc...
[2014-03-19 23:17:29 -0400] erichs: anthroprose: I'm not familiar with providers yet. sounds like I have some reading to do!
[2014-03-19 23:17:45 -0400] anthroprose: erichs: the aws cookbook may do things like you want to do
[2014-03-19 23:17:47 -0400] rdobbs: I agree. Once I get any of this working I'll turn it into a provider
[2014-03-19 23:18:00 -0400] anthroprose: but after the whole we're not switching from the rightscale gem, I gave that thing the boot
[2014-03-19 23:18:01 -0400] erichs: anthroprose: I'll check into that cookbook, def
[2014-03-19 23:18:10 -0400] rdobbs: I'm being pigheaded and trying to get deploy/application t work because I've sunk so much time into it, which is stupid since it's a sunk cost at this point.
[2014-03-19 23:18:33 -0400] anthroprose: rdobbs: people have been mentioning https://github.com/bryanwb/chef-rewind
[2014-03-19 23:18:39 -0400] anthroprose: but i think that would just complicate things
[2014-03-19 23:19:05 -0400] anthroprose: you monkey patch the resource to not default to :deploy or whatever
[2014-03-19 23:19:31 -0400] anthroprose: erichs: this is how I am doing what you are talking about... https://github.com/Jumpshot/aws-minions/blob/master/snapshot-restore.py
[2014-03-19 23:19:33 -0400] rdobbs: anthroprose: as far as I can tell chef-rewind doesn't work in this case because it's nested inside of other resources
[2014-03-19 23:20:21 -0400] someara: using chef-rewind is akin to monkey patching your resource collection
[2014-03-19 23:20:24 -0400] anthroprose: rdobbs: sometimes cookbooks are written by 1 company with 1 usecase, and its better to just write a little extra to move forward
[2014-03-19 23:20:31 -0400] someara: think of chef cookbooks as software libraries
[2014-03-19 23:20:46 -0400] rdobbs: if only they were written like libraris
[2014-03-19 23:20:48 -0400] rdobbs: libraries
[2014-03-19 23:20:52 -0400] someara: some of them are
[2014-03-19 23:20:54 -0400] anthroprose: more are starting to be
[2014-03-19 23:20:57 -0400] rdobbs: miah's are :)
[2014-03-19 23:21:12 -0400] someara: but if a cookbook doesn't do what you want, you should fork it, or use a different one
[2014-03-19 23:21:15 -0400] erichs: anthroprose: nice!
[2014-03-19 23:21:15 -0400] rdobbs: I think her cookbooks are the only ones I've never sworn at
[2014-03-19 23:21:40 -0400] rdobbs: aye. I have 25 forks right now.
[2014-03-19 23:21:42 -0400] anthroprose: erichs: it has the sister, for creating the snapshots
[2014-03-19 23:21:56 -0400] anthroprose: and I've got chef/aws stuff *everywhere* with perms to give away
[2014-03-19 23:22:02 -0400] rdobbs: just maintaining versions with forks without toally fucking yourself over is a full-time job
[2014-03-19 23:22:12 -0400] someara: I'm rewriting some opscode cookbooks as library cookbooks so people can cargo cult the patterns
[2014-03-19 23:22:14 -0400] rdobbs: one accidental berks upgrade and I lost 2 days
[2014-03-19 23:22:25 -0400] anthroprose: rdobbs: before I started version pinning with berkshelf, I would lose days yeah
[2014-03-19 23:22:27 -0400] someara: this situation should get better with time
[2014-03-19 23:22:32 -0400] someara: but really, its software.
[2014-03-19 23:22:51 -0400] anthroprose: chef is.... MADE OF PEOPLE?!
[2014-03-19 23:22:53 -0400] rdobbs: hmm can rewind rewrite a provider inside of the runit cookbook without me having to for kit?
[2014-03-19 23:25:51 -0400] anthroprose: rdobbs: have you considered just adjusting the runlist
[2014-03-19 23:26:01 -0400] anthroprose: cookbook::init, cookbook::deploy
[2014-03-19 23:26:05 -0400] anthroprose: or something
[2014-03-19 23:26:13 -0400] rdobbs: I don't see how that would matter
[2014-03-19 23:26:14 -0400] anthroprose: I mean, to get things deploying
[2014-03-19 23:26:34 -0400] rdobbs: because the problem is within the huge monolithic application provider
[2014-03-19 23:26:40 -0400] anthroprose: yeah I dont really understand all the interelations
[2014-03-19 23:28:00 -0400] rdobbs: well I just got deploy working, I think I'll have application scrapped tomorrow.
[2014-03-19 23:28:13 -0400] erichs: anthroprose: thanks for all the fish!
[2014-03-19 23:28:13 -0400] rdobbs: just need to figure out what all the application provider does so I can rewrite it
[2014-03-19 23:28:25 -0400] rdobbs: yeah thanks anthroprose && someara, btw
[2014-03-19 23:28:46 -0400] someara: np
[2014-03-19 23:29:18 -0400] someara: pretend the community site is CPAN in 1998
[2014-03-19 23:29:21 -0400] someara: =)
[2014-03-19 23:30:06 -0400] rdobbs: that concept makes me cry, a lot.
[2014-03-19 23:30:18 -0400] rdobbs: though mcpan is badass nowdays
[2014-03-19 23:30:39 -0400] rdobbs: but yeah, I remember waiting days to install cpan
[2014-03-19 23:31:00 -0400] rdobbs: where installing one cpan module gave you 400 more to install
[2014-03-19 23:31:10 -0400] rdobbs: and libnet always failed
[2014-03-19 23:49:10 -0400] tscanausa: anyone with chef deploy resource around?
[2014-03-19 23:50:27 -0400] jidar: I just remember cpan having everything fail to install without the force flag and then still failing to install
[2014-03-19 23:57:16 -0400] anthroprose: rdobbs: you should try managing an R project with CRAN
[2014-03-19 23:57:19 -0400] anthroprose: bleh
[2014-03-19 23:58:08 -0400] anthroprose: but I've got SaaS for RStudio if anyone wants it
