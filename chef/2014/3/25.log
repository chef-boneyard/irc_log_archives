[2014-03-25 00:04:25 -0400] Otterley: coderanger, changing the resource to a non-inline one seems to have helped
[2014-03-25 00:05:51 -0400] dgarstang: coderanger: context?
[2014-03-25 00:06:29 -0400] coderanger: dgarstang: That cookbook has both a vagrant config and test-kitchen
[2014-03-25 00:06:33 -0400] coderanger: and works fine
[2014-03-25 00:06:57 -0400] dgarstang: coderanger: your referring to https://github.com/poise/berkshelf-api/blob/master/Berksfile#L26
[2014-03-25 00:06:59 -0400] dgarstang: ?
[2014-03-25 00:07:23 -0400] coderanger: dgarstang: Every time you ask questions both here and on the ML in parallel, you piss people off, please stop
[2014-03-25 00:07:31 -0400] coderanger: dgarstang: Pick one place and ask, and then wait
[2014-03-25 00:07:37 -0400] dgarstang: coderanger: Seriously?
[2014-03-25 00:07:45 -0400] coderanger: But sure, that berksfile exists and workds
[2014-03-25 00:08:35 -0400] dgarstang: coderanger: I dumbstruck by that statement.
[2014-03-25 00:09:29 -0400] coderanger: dgarstang: Imagine if you asked the same question to two people in different rooms, so both spent the time to answer you
[2014-03-25 00:09:38 -0400] dgarstang: coderanger: In fact, I am so insensed by that attitude, I am signing off for the day before I say something that will cause more offence.
[2014-03-25 00:13:06 -0400] rpad: When using "knife environment edit <env> from file <file>" it seems to just pull down the environment config and use the file I add in. Is my syntax right?
[2014-03-25 00:13:23 -0400] rpad: *and not use the file I add in
[2014-03-25 00:16:26 -0400] law: hey all, I'm trying to get chef-zero and test-kitchen to play nice, and as far as I can tell chef-zero isn't reading any environments other than _default
[2014-03-25 00:16:43 -0400] coderanger: rpad: Those are two different commands
[2014-03-25 00:16:58 -0400] coderanger: law: Do you have them in JSON or Ruby format?
[2014-03-25 00:17:04 -0400] coderanger: (chef-zero only supports JSON)
[2014-03-25 00:18:11 -0400] rpad: coderanger: JSON. I'm trying to update an artifact version via Jenkins and that seemed like a good route
[2014-03-25 00:18:31 -0400] coderanger: rpad: Crossing the streams, that response was to law
[2014-03-25 00:18:38 -0400] law: oh no kidding?
[2014-03-25 00:18:38 -0400] rpad: ah, didn't see that :)
[2014-03-25 00:18:48 -0400] rpad: coderanger: What's the proper syntax?
[2014-03-25 00:18:56 -0400] law: FML
[2014-03-25 00:19:11 -0400] law: is there a quick way to convert my environments from Ruby to JSON?
[2014-03-25 00:19:12 -0400] coderanger: rpad: `knife <something> edit <name>` will download the data to a temp file, open your editor, and then send the updated data to the server
[2014-03-25 00:19:33 -0400] coderanger: rpad: `knife <something> from file <filename>` will upload a given file to the server
[2014-03-25 00:19:52 -0400] coderanger: law: knife environment from file *.rb && knife download environments/
[2014-03-25 00:19:56 -0400] rpad: coderanger: Ok, thanks. I'll give that a go
[2014-03-25 00:25:54 -0400] doomviking: pretty standard netiquette
[2014-03-25 00:26:59 -0400] coderanger: doomviking: \_()_/
[2014-03-25 00:32:02 -0400] jharley: anyone have a moment to help me debug a LWRP?  Its my first attempt, so Im sure Ive done something wrong.. Im getting a NoMethodError when I try to use the resource in a recipe (the resource and the recipe are in the same cookbook)
[2014-03-25 00:32:38 -0400] doomviking: :)
[2014-03-25 00:32:43 -0400] coderanger: jharley: Whats the line thats erroring?
[2014-03-25 00:33:28 -0400] jharley: coderanger: mysql_user 'root' do (the provider being mysql_user)
[2014-03-25 00:33:45 -0400] coderanger: jharley: Okay, and whats the cookbook name and resource name?
[2014-03-25 00:33:58 -0400] coderanger: jharley: Basically tl;dr remember that LWRPs are prefixed with the cookbook name :)
[2014-03-25 00:34:54 -0400] jharley: coderanger: resource name is also mysql_user, and the cookbook name is my company name
[2014-03-25 00:35:08 -0400] jharley: ( I was using the rabbitmq cookbooks user as a guide )
[2014-03-25 00:35:17 -0400] jharley: coderanger: are you saying company::mysql_user should work?
[2014-03-25 00:35:18 -0400] coderanger: jharley: Okay, so that would have to be companyname_mysql_user in the recipe
[2014-03-25 00:35:22 -0400] jharley: oh!
[2014-03-25 00:35:51 -0400] coderanger: Its a bit hard to explain but simple in practice :)
[2014-03-25 00:36:03 -0400] coderanger: foo/resource/default.rb -> foo
[2014-03-25 00:36:09 -0400] coderanger: foo/resources/bar.rb -> foo_bar
[2014-03-25 00:36:25 -0400] jharley: coderanger: I assume its part of the convergance magic :)
[2014-03-25 00:40:22 -0400] jharley: coderanger: that worked a treat, thank you
[2014-03-25 00:41:04 -0400] coderanger: jharley: Yeah, when the LWRP is loaded, it builds the class name based on the cookbook and file names
[2014-03-25 00:41:53 -0400] redgetan_: im using chef 10.30.4 and im getting Chef::Exceptions::RedirectLimitExceeded when download nginx module from github tarball. is this a bug that has been fixed in later versions?
[2014-03-25 00:42:25 -0400] coderanger: redgetan_: Whats the URL you are trying to get?
[2014-03-25 00:42:45 -0400] redgetan_: https://github.com/agentzh/echo-nginx-module/tarball/v0.40
[2014-03-25 00:43:55 -0400] coderanger: redgetan_: Hmm, is your redirect limit set to 0?
[2014-03-25 00:44:09 -0400] coderanger: redgetan_: Been a while since I looked at that code in 10
[2014-03-25 00:44:38 -0400] redgetan_: definitely not, it redirected 10 times to same url. ill post trace in a bit
[2014-03-25 00:44:44 -0400] ephantom: I'm following the instructions to move my chef 10 admin public key over to chef 11: http://docs.opscode.com/upgrade_server_open_source.html#verify-the-admin-public-key  When I try: knife upload /users/admin.json I get the error: ERROR: /users/admin.json failed to write: HTTP error writing: 400 "Bad Request" cause: {"error":["Field 'password' invalid"]}
[2014-03-25 00:44:53 -0400] ephantom: I have the correct node_name and client_key set in my knife.rb file, and can access the chef server without problems.
[2014-03-25 00:45:02 -0400] doomviking: redgetan_: FWIW I've seen that with a poorly configured load balancer
[2014-03-25 00:45:07 -0400] redgetan_: http://pastie.org/pastes/8965945/text
[2014-03-25 00:45:20 -0400] coderanger: redgetan_: Might just be nodeload falling over, I wouldn't depend on that for prod stuffs
[2014-03-25 00:46:48 -0400] coderanger: ephantom: Yeah, its rejecting the data itself
[2014-03-25 00:47:37 -0400] redgetan_: ah, ok i'll give it a try again then.
[2014-03-25 00:48:03 -0400] doomviking: yeah its not handling the Host header correctly
[2014-03-25 00:48:48 -0400] doomviking: curl -v -H 'Host: github.com' 'https://github.com/agentzh/echo-nginx-module/tarball/v0.40' > /dev/null
[2014-03-25 00:48:54 -0400] doomviking: 302
[2014-03-25 00:50:27 -0400] doomviking: anyway. seems very similar to what I was getting from the mongodb mms server.
[2014-03-25 00:50:31 -0400] ephantom: coderanger: /users/admin.json only contains  "name":, "admin": and "public_key": fields. Is it looking for for a 'password' field in the admin.json file?
[2014-03-25 00:51:28 -0400] redgetan_: coderanger, doomviking: yeah, it worked now. it was just yesterday that im getting that error :)
[2014-03-25 00:51:36 -0400] doomviking: alrighty then
[2014-03-25 00:54:18 -0400] coderanger: ephantom: Looks like that field is required, yes https://github.com/opscode/chef_wm/blob/master/src/chef_wm_users.erl#L88
[2014-03-25 00:59:27 -0400] ephantom: coderanger: It wasn't in the /users/admin.json file when I did a download dump, in chef 10 or 11. Where would I find the format for that field, and what sort of data should be in the field? Admin clear text password, Admin encrypted password, something else?
[2014-03-25 00:59:55 -0400] coderanger: ephantom: Sorry, all I know is from looking at that code file
[2014-03-25 01:03:07 -0400] ephantom: opscode needs to re-work their upgrade documentation, they have left some important information out, either that or there is a bug in the code.
[2014-03-25 01:29:26 -0400] ephantom: Thanks coderanger, I've sent an email to docs@getchef.com. Hopefully someone will update the web page.
[2014-03-25 01:29:38 -0400] coderanger: ephantom: Good luck, sorry I can't help more
[2014-03-25 01:31:38 -0400] coderanger: ephantom: You can also file tickets on github.com/opscode/chef-docs
[2014-03-25 01:31:56 -0400] coderanger: The writer that works on them is very responsive to pull reqs
[2014-03-25 01:32:04 -0400] jidar: yea I think github is 302'ing curl gets from the chef runs
[2014-03-25 01:32:37 -0400] jidar: redgetan_: I've been getting that for almost a week now
[2014-03-25 01:32:47 -0400] coderanger: jidar: Every time I've thought "I'll be really clever and use stuff directly from Github in Chef" I usually regret it
[2014-03-25 01:33:24 -0400] jidar: heh, the only reason I use it is because I'm deving locally without a host of any sort
[2014-03-25 01:34:00 -0400] jidar: too bad ark hasn't merg'd their from_file code yet
[2014-03-25 01:34:12 -0400] jidar: would make my cleanup a bit easier to just import files for the cookbooks
[2014-03-25 01:37:08 -0400] rpad: Try to run "knife environment from file <file>" but it's saying I don't have update permissions (hosted chef). The client it's authing as has full privileges on the environment I'm updating. Does it need other permissions as well?
[2014-03-25 01:37:33 -0400] coderanger: rpad: Check your ACLs in the web UI
[2014-03-25 01:38:02 -0400] coderanger: rpad: If you are creating a new object, you need create on the container as well, and the code might do a list at some point
[2014-03-25 01:39:50 -0400] rpad: coderanger: My client (jenkins) has create/list on environment and full crud on the specific environment I'm trying to update. however, I keep getting "Response:  missing update permission"
[2014-03-25 01:43:37 -0400] coderanger: rpad: In the traceback, check which specific HTTP request is failing
[2014-03-25 01:43:55 -0400] coderanger: rpad: knife -VV can help
[2014-03-25 01:45:32 -0400] rpad: coderanger: Signs the request as jenkins and then fails on PUT to environments/<env>
[2014-03-25 01:46:09 -0400] coderanger: Sorry, thats all I got then, does it work as a full admin user?
[2014-03-25 01:46:26 -0400] coderanger: If so, your best bet is probably a ticket with ChefInf (support@getchef.com)
[2014-03-25 01:57:35 -0400] rpad: Is there a command to show which knife.rb knife is using?
[2014-03-25 01:57:53 -0400] rpad: works if I specifically pass in the config file
[2014-03-25 01:57:54 -0400] coderanger: rpad: it should be in the debugging output from -VV I think
[2014-03-25 01:58:22 -0400] coderanger: rpad: The lookup logic is to scan back along the cwd looking for a .chef/knife.rb though
[2014-03-25 02:01:21 -0400] rpad: coderanger: I should be able to fix that part out. Thanks for the help.
[2014-03-25 02:54:01 -0400] tabolario: Hello all! Question for anyone here familiar with OSS licensing, especially as it might pertain to Opscode cookbooks. For an open source application cookbook I'm writing as part of a big full-stack demo project, I took a bunch of the CI/test harnessing from the Opscode nginx cookbook. I'm just wondering what kind of attribution should be in order, and also if it's still possible for me to license my own cookbook
[2014-03-25 02:54:02 -0400] tabolario:  under MIT (I'm not opposed to using Apache if it's not) My cookbook is here: https://github.com/todonts-cookbooks/todonts-base
[2014-03-25 02:58:16 -0400] tabolario: Also, I'd just like to say I was very happy to find a good example (in the nginx cookbook) of setting up an open source cookbook with full CI on travis and digital ocean. Works like a charm!
[2014-03-25 04:03:00 -0400] coderanger: tabolario: So this is a complex topic
[2014-03-25 04:03:42 -0400] coderanger: tabolario: Basically tl;dr you can release the whole project under any license you want as long as you don't alter the copyright on the existing code (and you can't change the license on existing code either)
[2014-03-25 04:08:34 -0400] tabolario: coderanger: Oh well I'm certainly happy to abide by that. Would wording like 'Portions of this code are adapter from ...' and then include the Opscode license notice and copyrights in my readme/license.txt be appropriate?
[2014-03-25 04:09:07 -0400] coderanger: tabolario: Yes, thats pretty common, and make sure the copyright and license headers on any copied code is left intect
[2014-03-25 04:12:12 -0400] tabolario: coderanger: What would you do for things that were grabbed from say a Rakefile or even say the TESTING.md file?
[2014-03-25 04:12:42 -0400] tabolario: (That's where the bulk of my takings are from, and also some configs like kitchen.yml, travis.yml, etc.)
[2014-03-25 04:12:45 -0400] coderanger: tabolario: Unfortunately thats where things get murky and I have to whip out the I Am Not A lawyer
[2014-03-25 04:12:56 -0400] coderanger: Really though, no one is going to sue you
[2014-03-25 04:13:39 -0400] tabolario: Well I hope they're flaterred at least then haha
[2014-03-25 04:14:04 -0400] tabolario: I lifted most of the kitchen harnessing from the nginx cookbook
[2014-03-25 05:40:03 -0400] tabolario: coderanger: if you're still around, updated the authors/license section in the readme a bit if you'd like to take a look (https://github.com/todonts-cookbooks/todonts-base)
[2014-03-25 05:40:55 -0400] coderanger: tabolario: Again with the IANAL, but I think thats fine
[2014-03-25 05:41:09 -0400] coderanger: tabolario: Any reason you are using MIT license?
[2014-03-25 05:41:20 -0400] coderanger: Its not something you should generally use anymore (unfortunately)
[2014-03-25 05:41:25 -0400] tabolario: Oh?
[2014-03-25 05:41:42 -0400] tabolario: I'm very much not to up to date on OSS license stuff
[2014-03-25 05:41:43 -0400] coderanger: Yeah, you can't accept contributions on MIT/BSD code without a CLA
[2014-03-25 05:41:49 -0400] tabolario: Ah
[2014-03-25 05:41:55 -0400] coderanger: unless you want to put yourself at non-trivial legal risk
[2014-03-25 05:42:05 -0400] coderanger: holoway has a really good blog post on this from like forever ago
[2014-03-25 05:42:08 -0400] coderanger: let me find it
[2014-03-25 05:42:24 -0400] coderanger: http://www.getchef.com/blog/2009/08/11/why-we-chose-the-apache-license/
[2014-03-25 05:42:31 -0400] tabolario: Aha
[2014-03-25 05:42:35 -0400] coderanger: basically tl;dr is that you need safety from patents
[2014-03-25 05:42:42 -0400] coderanger: because software patents are a thing
[2014-03-25 05:43:32 -0400] coderanger: If someone contributes code to you under MIT/BSD, there is always a risk factor that their company (or if they get bought out, etc) can come back and say "well actually that uses our patented algorithm, remove it or pay us"
[2014-03-25 05:44:14 -0400] coderanger: CLAs generally have an explicit patent grant, as does the Apache license
[2014-03-25 05:45:35 -0400] coderanger: and the Apache license more or less boils down to the same thing as MIT/BSD in terms of permissive relicensing and copyright and indemnification
[2014-03-25 05:45:52 -0400] coderanger: </huge oversimplifications>
[2014-03-25 05:46:18 -0400] coderanger: Sadly patent trolling is, if anything, becoming more popular
[2014-03-25 05:46:25 -0400] tabolario: Well I'm more or less convinced lol, if anything that it would make the licensing for these cookbooks that much simpler
[2014-03-25 05:46:49 -0400] coderanger: So in the past ten or so years it has gone from a hypothetical legal argument to something that actually puts people out of business
[2014-03-25 05:47:30 -0400] tabolario: Yeah the last thing I would want to happen would be for someone to take what I'm trying to do with this project and pull some patent nonsense with it
[2014-03-25 05:48:07 -0400] coderanger: I mean to have some perspective, its totally not an issue for this random little example repo
[2014-03-25 05:48:17 -0400] coderanger: but its just good stuff to keep in mind as you navigate the FOSS world :-)
[2014-03-25 05:50:55 -0400] tabolario: Well thanks for the pointers :)
[2014-03-25 06:01:15 -0400] clodeindustrie: hi there
[2014-03-25 06:01:27 -0400] clodeindustrie: anyone familiar with berkshelf 3?
[2014-03-25 06:01:42 -0400] clodeindustrie: there is not much doc about how to use it without Vagrant
[2014-03-25 06:05:13 -0400] coderanger: clodeindustrie: What are you trying to do?
[2014-03-25 06:06:22 -0400] clodeindustrie: well
[2014-03-25 06:06:31 -0400] clodeindustrie: I'm using Amazon Opsworks
[2014-03-25 06:06:41 -0400] clodeindustrie: I have custom cookbooks
[2014-03-25 06:06:48 -0400] clodeindustrie: I use opscodecookbooks
[2014-03-25 06:07:09 -0400] clodeindustrie: and I depend on some of those and on some Opsworks cookbooks
[2014-03-25 06:07:44 -0400] clodeindustrie: it's a bit a pain to manage, so I would like to consolidate my cookbooks in an archive before uploading to opsworks
[2014-03-25 06:07:58 -0400] clodeindustrie: which I was doing ok until I get dependency hell
[2014-03-25 06:08:25 -0400] clodeindustrie: Berkshelf bye default tries to satisfy dependencies on the community repo
[2014-03-25 06:08:42 -0400] clodeindustrie: when sometimes he should be looking on the opsworks one
[2014-03-25 06:10:01 -0400] clodeindustrie: ideally I would love to be able to tell berkshelf that there is no need ot fech the opsworks cookbooks as they will already be loaded in the env
[2014-03-25 06:12:34 -0400] coderanger: clodeindustrie: You'll have to run your own berks API server and customize its endpoints
[2014-03-25 06:13:02 -0400] coderanger: clodeindustrie: By default berks 3 uses api.berkshelf.com which only indexes the community site
[2014-03-25 06:14:23 -0400] clodeindustrie: oh dear, that's what I was afraid of
[2014-03-25 06:17:37 -0400] holoway: clodeindustrie: you could also just point the Berksfile at your git repositories for the cookbooks
[2014-03-25 06:19:06 -0400] clodeindustrie: holoway: I guess that would do, a bit painful when you have to commit everytime you want to consolidate the coobooks but I have no choice
[2014-03-25 06:19:49 -0400] coderanger: You would have to fully expand the recursive deps though
[2014-03-25 06:20:01 -0400] coderanger: which somewhat defeats the point
[2014-03-25 06:20:25 -0400] holoway: clodeindustrie: but that's basically what you want anyway, right? just a big pile of cookbooks
[2014-03-25 06:20:39 -0400] holoway: clodeindustrie: so you stick a Berksfile in there with everything you want, then vendor the results?
[2014-03-25 06:21:05 -0400] holoway: clodeindustrie: and yeah, for your custom stuff, you have to have a way to resolve them
[2014-03-25 06:21:20 -0400] holoway: clodeindustrie: but.. they are yours, and you want them all, most likely... so not a huge deal
[2014-03-25 06:21:58 -0400] coderanger: holoway: I think clodeindustrie is referring the Amazon's forks of some of the ChefInc cookbooks
[2014-03-25 06:22:07 -0400] coderanger: They maintain a few with overlapping names
[2014-03-25 06:22:34 -0400] holoway: ah
[2014-03-25 06:22:47 -0400] holoway: gotta run to bed - good luck, clodeindustrie
[2014-03-25 06:24:07 -0400] clodeindustrie: thanks
[2014-03-25 06:24:52 -0400] clodeindustrie: stupid irc client, not notifying me
[2014-03-25 06:25:20 -0400] clodeindustrie: and yeah coderanger you're right the overlapping names are an issue
[2014-03-25 08:16:48 -0400] mhenrixon: Why is copying files as part of a chef recipe such a difficult task?
[2014-03-25 08:28:50 -0400] srenatus: mhenrixon: can you image a resource that would fit the task?  Maybe the mailing list would be a good audience for a mock-up recipe example
[2014-03-25 08:29:24 -0400] AKS: Hey guys is there any way to upload all cookbooks from workstation to chefserver using berkshelf
[2014-03-25 08:29:33 -0400] mhenrixon: Something like the remote directory would be awesome for the task but it does not work
[2014-03-25 08:29:51 -0400] AKS: like knife cookbook upload -a
[2014-03-25 08:34:50 -0400] AKS: @jonlives do you guys use berkshelf for cookbook dependency management?
[2014-03-25 10:24:12 -0400] srenatus: is there some resource for talking to a chef-server? such as wrapping "knife download"...?
[2014-03-25 10:29:24 -0400] flaccid: srenatus: why?
[2014-03-25 10:31:26 -0400] srenatus: flaccid: having a chef-run backup the chef-server state
[2014-03-25 11:26:34 -0400] will: how can i make berkshelf inherit berksfiles in wrapper cookbooks?
[2014-03-25 11:27:09 -0400] workmad3: will: afaik, you can't
[2014-03-25 11:27:37 -0400] will: so, if i have a cookbook containing a lot of wrapper cookbooks, I'm doomed?
[2014-03-25 11:28:15 -0400] workmad3: will: if you're using berkshelf 3, what you can do is run your own berkshelf API instance and use that to index your github repos and/or your chef server, in addition to the community index
[2014-03-25 11:28:40 -0400] serialsito: hi guys, anyone knows how to use a chef resource in a custom resource? its possible to do that?
[2014-03-25 12:35:28 -0400] enavarrocu: Hello guys, I having a problem trying to running knife configure -V -r . --defaults
[2014-03-25 12:35:49 -0400] enavarrocu: I got WARNING: No knife configuration file found ERROR: Ohai::Exceptions::DependencyNotFound: Can not find a plugin for dependency os
[2014-03-25 12:36:08 -0400] enavarrocu: in OsX 10.9.2
[2014-03-25 12:36:31 -0400] enavarrocu: any idea?
[2014-03-25 12:58:14 -0400] fretb: Hi guys, gem_package provider is incredibly slow for a gem install in vagrant on my machine.
[2014-03-25 12:58:41 -0400] fretb: It's from a non-standard source, but other machines don't have this problem.
[2014-03-25 12:59:01 -0400] fretb: Currently it takes about 8 minutes extra in the vagrant run to install that 1 gem.
[2014-03-25 12:59:11 -0400] fretb: Does anybody have a clue where I have to look to fix this problem?
[2014-03-25 14:01:28 -0400] adnichols: fretb: presumably if you just run 'gem install whatever' it is also slow?
[2014-03-25 14:09:43 -0400] vissree: hi, is it possible to call a recipe within a recipe?
[2014-03-25 14:10:06 -0400] bmhatfield: vissree: include_recipe
[2014-03-25 14:10:36 -0400] vissree: ie, once myrecipe1::default is executed successfully, I want to start myrecipe2::default
[2014-03-25 14:11:07 -0400] bmhatfield: vissree: yes, just put the include_recipe statement where you want your recipe to be run
[2014-03-25 14:11:22 -0400] vissree: bmhatfield: thank you
[2014-03-25 14:15:11 -0400] wassy121_: vissree: note that myrecipe1's metadata.rb needs to note that it depends myrecipe2
[2014-03-25 14:15:45 -0400] wassy121_: (else you may get an error about myrecipe1::default not being able to find myrecipe2::default)
[2014-03-25 14:30:28 -0400] amir_: what could be a couse of this error "WARNING: Failed to connect to  -- SocketError: getaddrinfo: Name or service not known"
[2014-03-25 14:30:37 -0400] rayrod2030: bad connection
[2014-03-25 14:30:57 -0400] rayrod2030: if you are running bundler or pulling from github it could be the github api flapping
[2014-03-25 14:31:14 -0400] rayrod2030: saw it about 25 minutes ago on my end while running bundler and pulling berkshelf
[2014-03-25 14:31:23 -0400] amir_: everything is local
[2014-03-25 14:31:39 -0400] rayrod2030: network issue probably
[2014-03-25 14:32:42 -0400] amir_: hmm, where should i begin troubleshooting this? i can properly ping my nodes
[2014-03-25 14:36:05 -0400] Raboo: how do i use cookbook_file in a custom provider. I want to have the file in the cookbook of the provider. Not the cookbook that calls the lwrp
[2014-03-25 14:37:41 -0400] drrk: put a 'cookbook' attribute in that specifies your cookbook
[2014-03-25 14:45:40 -0400] Raboo: drrk thanks
[2014-03-25 14:47:41 -0400] pwelch: hey everyone. I was wondering what the common practice for monitoring open source chef server logs is. Does everyone just add stuff in /var/log/chef-server to their preferred remote logging system?
[2014-03-25 14:49:30 -0400] Raboo: drrk i did specify it in the resources/default.rb
[2014-03-25 14:49:53 -0400] Raboo: but it still didn't work like that, is that somehing i put in the cookbook_file?
[2014-03-25 14:50:19 -0400] rabbite: I'm trying to build a django vagrant box and I'm having trouble with my default cookbook claiming that the virtualenv I've created doesn't exist.
[2014-03-25 14:50:25 -0400] drrk: http://docs.opscode.com/resource_cookbook_file.html
[2014-03-25 14:50:37 -0400] drrk: Raboo: see the docs there under 'Attributes'
[2014-03-25 14:51:09 -0400] rabbite: Specifically, if I try to source it or use python_pip to install django to the venv, it complains that the directories don't exist. This can be verified as false because I can see them when I ssh into the box.
[2014-03-25 14:51:28 -0400] rabbite: I can also run the pip install django command with no problems while I'm sshed in.
[2014-03-25 14:52:27 -0400] Raboo: drrk ok ty
[2014-03-25 14:52:31 -0400] rabbite: No such file or directory - dredbeard/bin/pip install  django==1.6
[2014-03-25 14:52:37 -0400] rabbite: wtf
[2014-03-25 14:53:44 -0400] jharley: coderanger: me again got a second for an other LWRP question?  notifications arent working it seems, even though I have use_inline_resources at the top of my provider.
[2014-03-25 14:55:06 -0400] rayrod2030: Hey coderanger do you offer support contracts or should we just pay you via gittip (https://www.gittip.com/coderanger/)?
[2014-03-25 15:02:26 -0400] fields: this is not specifically a chef question - but Im trying to install cookbooks with librarian chef (via vagrant-librarian-chef) and its taking forever to pull them down. Has anyone else seen that behavior?
[2014-03-25 15:06:47 -0400] pwelch: fields: I only used it once or twice but it did not take long for me
[2014-03-25 15:07:02 -0400] pwelch: slow internet? also does librarian have some type of verbose logging?
[2014-03-25 15:07:16 -0400] pwelch: might help track any issues
[2014-03-25 15:07:21 -0400] fields: definitely not slow internet (in general) - everything else is working fine
[2014-03-25 15:07:51 -0400] fields: if I do fs_usage | grep ruby, I can see it touching files in the cache every few minutes
[2014-03-25 15:07:57 -0400] fields: (this is on a mavericks mac)
[2014-03-25 15:08:53 -0400] fields: Im wondering if maybe this is related to this issue https://github.com/applicationsonline/librarian-chef/issues/31
[2014-03-25 15:19:12 -0400] fields:  looks like something in my Cheffile has introduced an infinite dependency loop
[2014-03-25 15:31:13 -0400] amir_: how do i tell knife not to use fqdn of my hosts?
[2014-03-25 15:36:50 -0400] davidordave: @amir_ when bootstrapping? -N desired_node_name
[2014-03-25 15:38:08 -0400] jharley: coderanger: apparently, throwing some updated_by_last_action in the right places worked magic? :)
[2014-03-25 15:41:06 -0400] helfire: anyone know where to get knife-pushy-0.3.gem ? from the docs it just says "install it"
[2014-03-25 15:41:55 -0400] jharley: helfire: gem install knife-pushy?
[2014-03-25 15:42:04 -0400] helfire: too easy
[2014-03-25 15:42:29 -0400] helfire: jharley: ERROR:  Could not find a valid gem 'knife-pushy' (>= 0) in any repository
[2014-03-25 15:43:10 -0400] jharley: helfire: http://docs.opscode.com/install_push_jobs.html
[2014-03-25 15:43:22 -0400] jharley: helfire: that page seems to suggest its something you pay for from Chef?
[2014-03-25 15:43:38 -0400] jharley: helfire: perhaps the gem is also?
[2014-03-25 15:43:44 -0400] renchap: yes, it is only available with hosted chef atm
[2014-03-25 15:43:57 -0400] renchap: http://www.getchef.com/blog/2013/12/16/getting-pushy-with-chef/
[2014-03-25 15:44:04 -0400] helfire: yep, we have that
[2014-03-25 15:44:11 -0400] helfire: installed the server stuff
[2014-03-25 15:44:53 -0400] renchap: maybe you can download the gem where you downloader the push server ?
[2014-03-25 15:45:11 -0400] helfire: ya, have to reach back out
[2014-03-25 15:45:21 -0400] helfire: it's email tag
[2014-03-25 15:45:31 -0400] helfire: was seeing if the knife bits were public like the cookbook
[2014-03-25 15:46:40 -0400] jchauncey: i thought pushy was only available with enterprise chef
[2014-03-25 15:46:42 -0400] jchauncey: not hosted chef
[2014-03-25 15:47:39 -0400] renchap: "Push Jobs (formerly known as Pushy) are a feature of Enterprise Chef, but we are working towards open sourcing Push Jobs in early 2014 (think Q1)."
[2014-03-25 15:47:42 -0400] renchap: you are right
[2014-03-25 15:47:44 -0400] renchap: i meant enterprise
[2014-03-25 15:47:53 -0400] helfire: ya i meant enterprise as well :)
[2014-03-25 15:49:31 -0400] daos: Getting "EOFError: end of file reached" on an attempted chef-client run. other clients run fine, and the stacktrace doesn't provide much info that has helped me debug it
[2014-03-25 15:49:35 -0400] daos: anyone seen something like this before?
[2014-03-25 15:50:56 -0400] helfire: gem install knife-push !
[2014-03-25 15:53:39 -0400] amir_: :when doing knife ssh
[2014-03-25 15:58:21 -0400] gswallow: Why is it that attributes I set in environment manifests sometimes don't seem to take hold, yet attributes I set in roles do?  For example, this Chef run failed right off the bat, but when I added mongodb['cluster_name'] to the role, it worked fine?
[2014-03-25 15:58:22 -0400] gswallow: https://gist.github.com/gswallow/9764920
[2014-03-25 16:05:34 -0400] btm: swalberg: Ohai takes whatever data is passed by getpwent
[2014-03-25 16:07:07 -0400] shlant: any ruby experts here? I have no idea what i'm doing
[2014-03-25 16:07:07 -0400] shlant: https://gist.github.com/MrMMorris/9441bb18fea10222eb31
[2014-03-25 16:07:32 -0400] shlant: I want it to break a file into lines and then only add if it doesn't already exist
[2014-03-25 16:08:26 -0400] castro1688: Is there a way to ignore or allow chef to bypass "Precondition Failed" errors? two cookbooks are using a different version of a base cookbook, but the recipe we are including doesnt even use it
[2014-03-25 16:18:14 -0400] swalberg: @btm getpwent has two entries for root. The first comes from files, the second comes from ldap. But chef is using the second when I access the user resource
[2014-03-25 16:25:08 -0400] swalberg: @btm https://gist.github.com/swalberg/9765383 shows getpwent returning two entries for root but ohai logging the second and incorrect one
[2014-03-25 16:30:39 -0400] btm: swalberg: you know you can only have one root, right? Kidding. ;)
[2014-03-25 16:31:13 -0400] gswallow: Can you actually have root in ldap?  Seems like a bad idea?
[2014-03-25 16:31:14 -0400] swalberg: @btm heh, sadly I didn't set this thing up. And I'd just change the ldap user to /root but there's some Solaris in the mix here
[2014-03-25 16:31:36 -0400] gswallow: don't you set PAM up to skip searches for UIDs < 100 by default?
[2014-03-25 16:31:49 -0400] swalberg: "can you" and "should you" are two different questions
[2014-03-25 16:31:55 -0400] gswallow: this is true!
[2014-03-25 16:32:14 -0400] btm: swalberg: you could add something like: next if etc[:passwd].has_key?(fix_encoding(entry.name))
[2014-03-25 16:32:28 -0400] btm: swalberg: before this line https://github.com/opscode/ohai/blob/master/lib/ohai/plugins/passwd.rb#L22
[2014-03-25 16:32:47 -0400] btm: swalberg: you could also open a ticket, and provide a patch with a unit test. :D
[2014-03-25 16:33:19 -0400] swalberg: heh, well, I'll give it a shot
[2014-03-25 16:40:46 -0400] btm: shlant: your gist is missing, but you should look at the Chef::Util::FileEdit helper http://sysadvent.blogspot.com/2012/12/day-24-twelve-things-you-didnt-know.html#item_2
[2014-03-25 16:41:35 -0400] shlant: btm: yea I got some answers over at #ruby. I think I'm going to figure out a better way to do it
[2014-03-25 16:42:00 -0400] swalberg: @btm running rspec on osx, should the Linux plugin stuff fail?
[2014-03-25 16:42:12 -0400] btm: shlant: editing files is always a bit iffy compared to managing the whole file, but that is what fileedit is for.
[2014-03-25 16:42:47 -0400] btm: swalberg: I don't think so. all the unit tests should be stubbed such that the platform doesn't matter.
[2014-03-25 16:43:08 -0400] swalberg: oh, had to run it under bundler
[2014-03-25 16:43:13 -0400] btm: swalberg: sometimes there are bugs in the unit test, like if something from your knife.rb leaks into the test and changes its behavior.
[2014-03-25 16:46:47 -0400] btm: gswallow: did you get your environment attribute issue solved? looking at the gist I'm not sure what the issue is, as the run is failing because of the raise in there, and does seem to have cluster_name set.
[2014-03-25 16:47:02 -0400] gswallow: no
[2014-03-25 16:47:12 -0400] gswallow: I put the raise in there
[2014-03-25 16:47:22 -0400] shlant: btm: yea, I hear ya. The file is pretty big and already in a repo that gets cloned so that's how I'll do it for now
[2014-03-25 16:47:40 -0400] gswallow: Same cookbook, right?  I gisted the log because chef's run was cut so short.
[2014-03-25 16:48:05 -0400] gswallow: When I define mongodb['cluster_name'] in environments/qa1.json, it comes up nil in that raise.
[2014-03-25 16:48:22 -0400] gswallow: When I define mongodb['cluster_name'] in roles/mongo_server.rb, it works? vOv
[2014-03-25 16:49:13 -0400] shlant: btm:  do you know of any way to read a file and append it to another?
[2014-03-25 16:49:44 -0400] shlant: as opposed to a file resource with content lazy { ::File.read
[2014-03-25 16:49:59 -0400] shlant: that overwrites
[2014-03-25 16:50:09 -0400] gswallow: @shlant http://www.ruby-doc.org/core-2.1.0/IO.html#method-i-each_line ?
[2014-03-25 16:51:45 -0400] Corey: There a quick rule of thumb I can look at for properly sizing resources for a Chef server? 150 nodes under management, but I don't know how complex the recipes are.
[2014-03-25 16:51:47 -0400] redondos_: does anybody know when a version of the webui is going to be released fixing the 20-node status page limitation? (https://github.com/opscode/chef-server-webui/pull/24)
[2014-03-25 16:53:33 -0400] btm: Corey: build it on a real computer, and not a phone or something, and you'll be fine. http://www.getchef.com/blog/2013/02/04/cycle-computing-puts-chef-11-through-its-paces-w10k-aws-servers/
[2014-03-25 16:53:48 -0400] Corey: btm: AWS in this case. So somewhere between the two. :-)
[2014-03-25 16:53:58 -0400] Corey: Trying to properly size a server instance. :-)
[2014-03-25 16:54:22 -0400] gswallow: Corey I recall I had > 200 ndoes on a server with 4 CPUs and 16GB RAM but that was chef 0.10
[2014-03-25 16:54:23 -0400] shlant: gswallow: I'll try that, thanks
[2014-03-25 16:54:31 -0400] gswallow: sorry, > 2000
[2014-03-25 16:56:10 -0400] btm: shlant: you can use a local file using 'file:///foo/bar/fez' as a source in remote_file
[2014-03-25 16:56:21 -0400] bubu: Hey guys, am writing a ruby script to interact with chef. Not sure what to do about this though: https://gist.github.com/joshmyers/9b26c7bc9b06ca3a5376
[2014-03-25 16:56:41 -0400] bubu: Any ideas?
[2014-03-25 16:58:08 -0400] btm: bubu: I would guess solr is interpreting the quotes as literal characters in the value rather than as quotes. I'm not sure why you need to use quotes in that example?
[2014-03-25 16:58:40 -0400] bubu: Because I'm actually interpolating strings that I'm passing into the search
[2014-03-25 16:59:41 -0400] armendonigian: i'm getting the following error: Errno::EACCES: Permission denied - /root/.bundler
[2014-03-25 16:59:42 -0400] bubu: btm, just added a comment to the gist
[2014-03-25 16:59:42 -0400] armendonigian:                  mkdir at org/jruby/RubyDir.java:588
[2014-03-25 16:59:55 -0400] armendonigian: during cap deploy
[2014-03-25 17:00:17 -0400] bubu: armendonigian: you don't have permissions to write to /root/
[2014-03-25 17:00:26 -0400] armendonigian: i think its due to the execute resource looking at ~/root instead of for user ubuntu
[2014-03-25 17:00:27 -0400] armendonigian: yes
[2014-03-25 17:01:01 -0400] armendonigian: here's the resource
[2014-03-25 17:01:15 -0400] armendonigian: execute 'cap deploy cp' do
[2014-03-25 17:01:16 -0400] armendonigian:   environment 'GEM_PATH' => "/opt/ruby/jruby-1.7.8/lib/ruby/gems/shared",
[2014-03-25 17:01:17 -0400] armendonigian:               'RUBYPATH' => "/usr/local/bin/ruby",
[2014-03-25 17:01:19 -0400] armendonigian:               'GEM_HOME'   => "/opt/ruby/jruby-1.7.8/lib/ruby/gems/shared"
[2014-03-25 17:01:20 -0400] armendonigian:   user 'ubuntu'
[2014-03-25 17:01:21 -0400] armendonigian:   command "/opt/ruby/default/bin/bundle install;
[2014-03-25 17:01:53 -0400] armendonigian: why isn't chef using the bunlder version specified in GEM_PATH
[2014-03-25 17:01:54 -0400] armendonigian: ?
[2014-03-25 17:02:19 -0400] swalberg: @btm Thanks... https://tickets.opscode.com/browse/OHAI-561
[2014-03-25 17:02:39 -0400] bubu: btm: any ideas to the gist? :P
[2014-03-25 17:05:12 -0400] armendonigian: @bubu why doesn't it need permission to write to /root?
[2014-03-25 17:06:15 -0400] btm: armendonigian: a gist (http://gist.github.com) with 'chef-client -l debug' output and the relevent recipe sections would be helpful.
[2014-03-25 17:06:46 -0400] btm: bubu do your variables like role have single quotes in them?
[2014-03-25 17:07:18 -0400] armendonigian: will do thanks
[2014-03-25 17:07:24 -0400] bubu: btm:
[2014-03-25 17:07:27 -0400] bubu: [1] pry(#<MyDrive::ChefSearch>)> role
[2014-03-25 17:07:28 -0400] bubu: => "api_server"
[2014-03-25 17:07:28 -0400] bubu: [2] pry(#<MyDrive::ChefSearch>)> role.is_a? String
[2014-03-25 17:07:29 -0400] bubu: => true
[2014-03-25 17:07:53 -0400] bubu: So I'm trying to interpolate strings into the search..
[2014-03-25 17:08:46 -0400] btm: bubu: I don't understand why you're adding the single quotes in your failing example: role:'api_server' <-- why are these single quotes here?
[2014-03-25 17:09:01 -0400] bubu: Because of string interpolation.
[2014-03-25 17:09:33 -0400] btm: bubu: query.search(:node, "role:#{role}") <-- does not add single quotes
[2014-03-25 17:10:09 -0400] btm: bubu: unless role => "'api_server'"
[2014-03-25 17:10:17 -0400] bubu: ^^ yes.
[2014-03-25 17:11:36 -0400] bubu: the variable role is an interpolated string here so it's like doing "role:'api_server'")
[2014-03-25 17:11:49 -0400] btm: bubu: I'm not sure why those are in your strings, but take them out. query.search(:node, "role:#{role.gsub(/'/, '')}")
[2014-03-25 17:12:42 -0400] btm: bubu: whatever is putting quotes inside your strings is probably a bug worth solving though, so you don't have to take them out everwhere else.
[2014-03-25 17:13:01 -0400] bubu: huh.
[2014-03-25 17:13:36 -0400] bubu: Nothing is putting quotes inside my string.
[2014-03-25 17:16:43 -0400] btm: bubu: the single quotes you're showing in your failing example in the gist are not caused by the act of string interpolation. https://gist.github.com/joshmyers/9b26c7bc9b06ca3a5376#comment-1198681
[2014-03-25 17:17:42 -0400] btm: swalberg: thanks for that patch. did you fill out a CLA while you were at it?
[2014-03-25 17:17:50 -0400] swalberg: yessir I did
[2014-03-25 17:18:11 -0400] mhenrixon: No resource, method, or local variable named `shared_path' for `Chef::Provider::Deploy::Timestamped ""'
[2014-03-25 17:18:15 -0400] btm: swalberg: rock on.
[2014-03-25 17:18:58 -0400] bubu: btm: ah, I see what you mean. thx
[2014-03-25 17:30:02 -0400] aspiers: is it possible to pass blocks to definitions?
[2014-03-25 17:32:05 -0400] bricker`LA: Is anybody familiar with the iptables-ng cookbook? I have added a rule but it's not showing up in the iptables. Here is the rule and the relevant lines from the chef-client command: https://gist.github.com/bricker/9766942
[2014-03-25 17:36:16 -0400] btm: bricker`LA: do you also using the iptables-ng::default recipe in your run list?
[2014-03-25 17:36:35 -0400] bricker`LA: btm: no :)
[2014-03-25 17:37:01 -0400] bricker`LA: Is that necessary?
[2014-03-25 17:39:15 -0400] btm: bricker`LA: I don't think so. if you restart iptables, do they show up? it looks like the cookbook writes the rules to files and then restarts iptables, rather than passing rules to iptables AND writing files.
[2014-03-25 17:40:11 -0400] btm: bricker`LA: you'll want to look in your run for the relevant operations from iptables-ng/libraries/restart_service.rb
[2014-03-25 17:40:51 -0400] gleam: it looks like it expects you to include iptables-ng::manage
[2014-03-25 17:40:53 -0400] bricker`LA: btm: thanks; I'm working on a hunch now that it was just refusing to overwrite another rule on port 80
[2014-03-25 17:41:07 -0400] bricker`LA: btm: btw, restarting iptables didn't help
[2014-03-25 17:42:28 -0400] Nukepuppy: hmm
[2014-03-25 17:42:45 -0400] Nukepuppy: is it even in the files it creates?
[2014-03-25 17:43:52 -0400] bricker`LA: Nukepuppy: talking to me? I see the PREROUTING file but it just says [0:0]
[2014-03-25 17:45:06 -0400] btm: gleam: iptables-ng::manage has a comment hidden underneath the license to not use it directly. default includes install which includes manage either way.
[2014-03-25 17:46:01 -0400] dstynchula: so, I'm trying to include dependencies in a cookbook to limit the length of a runlist.
[2014-03-25 17:46:13 -0400] gleam: nevermind :)
[2014-03-25 17:46:23 -0400] bricker`LA: Maybe I need to add xx- before the name to prioritize it. Removing the rule on 80 didn't help
[2014-03-25 17:46:39 -0400] dstynchula: I tried using include_recipe "mdadm::default" in the beginning of a recipe
[2014-03-25 17:46:43 -0400] dstynchula: and it tells me:
[2014-03-25 17:46:47 -0400] dstynchula: "If you're loading mdadm from another cookbook, make sure you configure the dependency in your metadata"
[2014-03-25 17:46:57 -0400] gleam: put depends 'mdadm' in metadata.rb
[2014-03-25 17:47:08 -0400] dstynchula: :)
[2014-03-25 17:47:25 -0400] bricker`LA: oh, maybe I need to create the PREROUTING chain too?
[2014-03-25 17:47:31 -0400] dstynchula: did I miss that in my search of the documentation, or is it not present?
[2014-03-25 17:48:15 -0400] gleam: probably depends on which of the 23 documentation sources you were looking at
[2014-03-25 17:48:45 -0400] btm: dstynchula: you need to add 'depends "mdadm"' to the metadata.rb file in the top level of your cookbook
[2014-03-25 17:49:29 -0400] dstynchula: gleam, btm: Thank you!
[2014-03-25 17:50:04 -0400] Nukepuppy: dstynchula its pretty much one of the most important files ;p
[2014-03-25 17:50:21 -0400] Nukepuppy: dont forget to version bump -.- i hate it when folks have 1000 versions of their cookbook with the same version 0.1.0 :(
[2014-03-25 17:50:31 -0400] robawt: Nukepuppy++
[2014-03-25 17:50:38 -0400] robawt: that's a small but very real problem
[2014-03-25 17:51:18 -0400] dstynchula: nukepuppy: Lol! I have like 20 cookbooks, and I'm a bit ashamed to admit this is the first time I've edited a metadata.rb file.
[2014-03-25 17:51:51 -0400] robawt: knowing is half the battle dstynchula
[2014-03-25 17:59:22 -0400] stormerider: cobra cabana?
[2014-03-25 17:59:24 -0400] Nukepuppy: dstynchula if you use berkshelf  you can also tell it how to resolve a cookbook in the Berksfile  like a private cookbook to aprivate repo.. helps a lot to be abel to do that in your organization
[2014-03-25 18:01:11 -0400] bricker`LA: btm: oi... I had it using eth0, our private lien :(
[2014-03-25 18:01:14 -0400] bricker`LA: btm: thanks for the help :)
[2014-03-25 18:01:18 -0400] bricker`LA: line*
[2014-03-25 18:14:23 -0400] shlant: anyone have troubleshotting advice for bootstrap going REALLY slow?
[2014-03-25 18:14:33 -0400] shlant: like a line every 30 sec
[2014-03-25 18:14:37 -0400] shlant: or more
[2014-03-25 18:16:33 -0400] tabolario: Aha, quite happy with separate-repo'd cookbooks all spun up in CI now with test-kitchen :D
[2014-03-25 18:16:59 -0400] tabolario: Now to figure out the best way to version them into my infrastructure repo... just tags maybe?
[2014-03-25 18:30:11 -0400] gswallow: @shlant most likely a DNS issue
[2014-03-25 18:48:33 -0400] law: hey all, when using chef-zero and test kitchen, is it test-kitchen that doesn't support Ruby environments, or chef zero?
[2014-03-25 18:48:45 -0400] jkeiser: law: chef-zero
[2014-03-25 18:48:54 -0400] law: well, shucks
[2014-03-25 18:49:08 -0400] law: we've got a lot of environment stuff that is dynamically calculated
[2014-03-25 18:49:22 -0400] law: is chef in general moving away from ruby environments, or is it just chef-zero?
[2014-03-25 18:50:00 -0400] jkeiser: law: I think people are moving away from it in a lot of places, but the chef-zero lack of ruby support is just a not-yet-implemented.
[2014-03-25 18:50:42 -0400] law: werd.  is there an ETA on that?
[2014-03-25 18:52:44 -0400] law: also, in Ruby environments, what does the dynamic calculation - knife itself, or the chef server?
[2014-03-25 18:58:25 -0400] Nukepuppy: more on the importance of metadata ;P if you magically made things work without including your recipe as depends 'something' in metadata
[2014-03-25 18:58:43 -0400] Nukepuppy: the attributes that would normally be passed thru it.. can not be used ;P
[2014-03-25 18:58:45 -0400] Nukepuppy: craycray
[2014-03-25 18:59:45 -0400] law: and, with test-kitchen, where do I specify what environment to use?
[2014-03-25 18:59:59 -0400] law: I've got a line under 'suites' that says 'environment: "some-env"', but that doesn't seem to be applying it
[2014-03-25 19:04:52 -0400] grepory: has anyone done anything with dynamic dependency management?
[2014-03-25 19:05:05 -0400] kennon: law, see this issue for the syntax there: https://github.com/test-kitchen/test-kitchen/issues/297
[2014-03-25 19:07:39 -0400] grepory: for example, let's say i want to deploy multiple services to a system and include their cookbooks as dependencies at runtime instead of as part of the cookbook that manages those dependencies...
[2014-03-25 19:18:49 -0400] adnichols: grepory: look at the environment cookbook pattern
[2014-03-25 19:19:05 -0400] adnichols: grepory: Although fair warning, it's quite involved
[2014-03-25 19:20:13 -0400] adnichols: grepory: there are various degrees of completeness to which you can do this and it largely depends how much you want your test env to reflect production
[2014-03-25 19:22:43 -0400] adnichols: coderanger: FYI, fwiw we got unit tests (to the extent we care about them in this case) working w/ Poise & chefspec
[2014-03-25 19:23:21 -0400] adnichols: original problem really had nothing to do w/ Poise
[2014-03-25 19:59:26 -0400] shlant: anyone know how I can handle multiple up/down values? https://gist.github.com/MrMMorris/0aa62d5bf0e73de41271
[2014-03-25 20:01:15 -0400] jbellone: Does anyone have good examples for application wrapper cookbooks? Not sure if the application/application_ruby (et al) cookbooks are used?
[2014-03-25 20:04:31 -0400] wildahunden: I'm running knife on a windows server.  I can run any knife command fine.  However, I try to install a plugin and it can't find it.  I installed set_environment in plugins/knife/set_environment.rb just below the directory where knife.rb resides.
[2014-03-25 20:09:22 -0400] coderanger: adnichols: Is it in a public repo?
[2014-03-25 20:09:45 -0400] adnichols: coderanger: unfortunately not yet - hopefully soon tho
[2014-03-25 20:09:52 -0400] coderanger: adnichols: :-(
[2014-03-25 20:10:11 -0400] adnichols: coderanger: I could probably send off a copy tho - nothing private so much as non-public dependencies
[2014-03-25 20:10:47 -0400] coderanger: adnichols: Would love to take a look at least, maybe I could use the same techniques :)
[2014-03-25 20:11:15 -0400] adnichols: coderanger: k, I'll make something available - if you see room for improvement I'm likewise interested in feedback
[2014-03-25 20:13:28 -0400] helfire: anyone know if push jobs needs a special acl? knife job start chef-client nginx-1395774522 gives me User or client 'me' does not have access to that action on this server.
[2014-03-25 20:14:28 -0400] mjuszczak: my metadata.rb file contains "mysql", but in Berksfile I'm trying to override the version of mysql it gets with a forked version.  It still seems to be pulling down the one from opscode.  What's the best way to handle this?
[2014-03-25 20:17:00 -0400] coderanger: adnichols: If you just want to email me a thing noah@coderanger.net :)
[2014-03-25 20:17:21 -0400] coderanger: helfire: Unfortunately not many people here have experience with enterprise-only features
[2014-03-25 20:17:29 -0400] coderanger: helfire: You are best off contacting ChefInc support
[2014-03-25 20:17:46 -0400] helfire: i did, just waiting
[2014-03-25 20:17:50 -0400] helfire: :)
[2014-03-25 20:17:58 -0400] helfire: cool feature if i can get it to work
[2014-03-25 20:18:24 -0400] helfire: and such is the problem too with enterprise only features,
[2014-03-25 20:18:28 -0400] doomviking: bunch of cheapskates
[2014-03-25 20:19:16 -0400] coderanger: helfire: Given that pushy is supposed to be opened at some point, maybe you can just request all the source so you can at least check yourself
[2014-03-25 20:21:00 -0400] coderanger: mjuszczak: What does your berksfile look like?
[2014-03-25 20:21:09 -0400] coderanger: mjuszczak: Also what version of berkshelf
[2014-03-25 20:21:48 -0400] mhenrixon: @coderanger deploying a multiproject github repo with chef is hard...
[2014-03-25 20:22:03 -0400] coderanger: mhenrixon: Whats hard about it?
[2014-03-25 20:23:01 -0400] mhenrixon: I have app/admin folders that should be its own rails apps running puma/nginx but I can't wrap my head around neither the deploy resource or just a simple git clone
[2014-03-25 20:24:28 -0400] mhenrixon: When using the deploy resource I run into trouble because it expects me to have a database.yml but if I create that and a folder for it like shared/config/database.yml it complains about permissions
[2014-03-25 20:24:52 -0400] anthroprose: mhenrixon: are you using any of the deploy resource's features?
[2014-03-25 20:25:02 -0400] anthroprose: other than getting code onto box and restarting services?
[2014-03-25 20:25:02 -0400] mhenrixon: depends what you mean
[2014-03-25 20:25:33 -0400] mhenrixon: well yeah I need to create some symlinks since my apps are in subfolders of the cloned repositories and not directly in the root
[2014-03-25 20:26:12 -0400] coderanger: mhenrixon: the deploy resource is to be avoided in 100% of cases
[2014-03-25 20:26:26 -0400] coderanger: mhenrixon: It is all kinds of bad
[2014-03-25 20:26:27 -0400] coderanger: :-(
[2014-03-25 20:26:50 -0400] mhenrixon: I know you said that but I ended up having to do a bunch of bash resource shell outs with multiline comments
[2014-03-25 20:26:58 -0400] mhenrixon: it became incredibly complex to test etc
[2014-03-25 20:27:32 -0400] mhenrixon: If I wanted to use ruby for that it would become even more difficult.
[2014-03-25 20:27:53 -0400] mhenrixon: I just couldn't find any good examples deploying it with just git and shell commands
[2014-03-25 20:27:55 -0400] anthroprose: mhenrixon: I use the git resource + notifies to services and a script block
[2014-03-25 20:28:15 -0400] mhenrixon: you don't care about sharing pids and logs etc?
[2014-03-25 20:28:24 -0400] coderanger: mhenrixon: I mean just think about what commands you would run normally, other than the complex symlink layout the deploy resource doesn't do anything special for you wrt to that
[2014-03-25 20:28:48 -0400] coderanger: mhenrixon: You don't need symlinks for that when you aren't switching the folder on every deploy
[2014-03-25 20:29:12 -0400] mhenrixon: but do you really suggest I run the application from the git repo?
[2014-03-25 20:29:28 -0400] coderanger: Yes, if you are using git as the transport
[2014-03-25 20:30:13 -0400] mhenrixon: fuck me.... why I never though of that!?
[2014-03-25 20:30:39 -0400] jbellone: :)
[2014-03-25 20:31:00 -0400] mhenrixon: well thanks world for keeping me humble!
[2014-03-25 20:31:03 -0400] anthroprose: mhenrixon: I wouldn't do that at scale.. you need to burn an image somehow and then check for updates with the resource
[2014-03-25 20:31:16 -0400] anthroprose: but I mean, thats how I 'deploy' to prod
[2014-03-25 20:31:33 -0400] anthroprose: jenkins calls knife ssh on the cluster
[2014-03-25 20:31:56 -0400] coderanger: mhenrixon: Come see my talk at PyCon, I explain all this in much more modular terms :-)
[2014-03-25 20:32:10 -0400] anthroprose: but I wouldn't add a node to the cluster by default without *some* code being there.... thats just asking for all sorts of trouble
[2014-03-25 20:32:23 -0400] coderanger: mhenrixon: basically you should abstract between the binary transport that gets the bits to the machine (in your case, git) and the configuration/service mgmt of the app itself
[2014-03-25 20:32:35 -0400] mhenrixon: hey so another thing :)
[2014-03-25 20:33:28 -0400] mhenrixon: Our 250MB github repo actually I removed about 100MB yesterday so 150MB. Isn't it kind of overkill to deploy that twice when we are load balanced with 2 backends?
[2014-03-25 20:33:58 -0400] coderanger: mhenrixon: Internal networking is cheap, if it becomes a problem there are other binary transports you can use :-)
[2014-03-25 20:34:13 -0400] coderanger: mhenrixon: ex. Twitter's murder
[2014-03-25 20:34:27 -0400] coderanger: But you need to be deploying thousands of nodes at once before that makes sense
[2014-03-25 20:35:03 -0400] mhenrixon: aha so thats what you meant! Well our transport costs to malta are kind of steap so I would probably only download it on the master server and send the code to the other suckers
[2014-03-25 20:35:34 -0400] mhenrixon: Thanks a lot for answering my questions! And for keeping me humble and honest :)
[2014-03-25 20:35:46 -0400] coderanger: mhenrixon: Yeah, but the nice thing is if you've kept the transport and config phases isolated, you can change one without affecting the other
[2014-03-25 20:36:04 -0400] anthroprose: mhenrixon: so I currently have 4 nodes active in my web cluster, I deployed them with a git repo previously checked out when I baked the AMI, when a new machine is added, it does a git pull, when a developer runs 'deploy', it does a git pull so you are only pulling changes
[2014-03-25 20:36:20 -0400] anthroprose: but I can't do things like that for long
[2014-03-25 20:36:33 -0400] anthroprose: #1, its not nice to github, #2, its not going to scale
[2014-03-25 20:36:46 -0400] coderanger: Yeah, we are moving all apps from git deploys to apt packages
[2014-03-25 20:36:50 -0400] anthroprose: so I will be pushing artifacts built in house instead
[2014-03-25 20:37:01 -0400] coderanger: Though if anything that has higher overhead
[2014-03-25 20:37:04 -0400] coderanger: but easier to host mirrors
[2014-03-25 20:37:07 -0400] mhenrixon: thats what I wanted to do but it was just too much work up front
[2014-03-25 20:37:08 -0400] anthroprose: coderanger: we have lots of similar problems I think
[2014-03-25 20:37:15 -0400] coderanger: anthroprose: ::softwarejazzhands::
[2014-03-25 20:37:16 -0400] mhenrixon: I need to get us up and running
[2014-03-25 20:37:25 -0400] anthroprose: rotfl
[2014-03-25 20:37:41 -0400] coderanger: mhenrixon: Yep, start with git and just keep those abstractions from leaking and worry about better transports later :)
[2014-03-25 20:38:03 -0400] anthroprose: I just had to go through teaching the developers how to get through c10k
[2014-03-25 20:38:32 -0400] anthroprose: cant wait for the 'when are we going to leave python for ingestion' discussion
[2014-03-25 20:39:09 -0400] anthroprose: coderanger: one of my new hobbies is scaring the shit out of local devops guys with your safe_node
[2014-03-25 20:39:16 -0400] sarkis: do site-cookbooks also require metadata?
[2014-03-25 20:39:24 -0400] Nukepuppy: hehe... i can fix all your storage problems.. it will cost 5billion dollars up front and 1billion a year licensing...   you can thank me now
[2014-03-25 20:39:32 -0400] rayrod2030: anything in particular you are using to package deploys as apt packages?  fpm?
[2014-03-25 20:39:43 -0400] rayrod2030: coderanger: ^^^
[2014-03-25 20:39:53 -0400] coderanger: sarkis: All cookbooks do
[2014-03-25 20:39:54 -0400] anthroprose: sarkis: its just directory organization?
[2014-03-25 20:40:05 -0400] coderanger: sarkis: metadata.rb is equiv to a setup.py or a gemspec
[2014-03-25 20:40:20 -0400] Nukepuppy: or your soul
[2014-03-25 20:40:23 -0400] coderanger: rayrod2030: omnibus (which uses fpm internally) and depot
[2014-03-25 20:40:38 -0400] rayrod2030: cool
[2014-03-25 20:40:45 -0400] anthroprose: Nukepuppy: I dont have the money and refuse to trade my soul
[2014-03-25 20:40:57 -0400] anthroprose: thnx tho
[2014-03-25 20:41:09 -0400] sarkis: got it, ty
[2014-03-25 20:42:56 -0400] dgarstang: Any links to descriptions of what kitchen converge, test, verify and so on do?
[2014-03-25 20:44:11 -0400] anthroprose: hrm, speaking of, is there any way to run tests on an already converged node? or is that just frowned upon
[2014-03-25 20:44:20 -0400] coderanger: anthroprose: serverspec?
[2014-03-25 20:44:36 -0400] anthroprose: code: when I run kitchen test, it will destroy an already running converged node
[2014-03-25 20:44:44 -0400] anthroprose: that I've been doing kitchen converge on for a while
[2014-03-25 20:45:13 -0400] anthroprose: was just wondering if that was forced best practices, or just me doing something differently
[2014-03-25 20:45:25 -0400] law: thanks kennon
[2014-03-25 20:47:17 -0400] mhenrixon: Ah but hehe
[2014-03-25 20:47:34 -0400] cwj: anthroprose: kitchen verify [suite]
[2014-03-25 20:47:49 -0400] anthroprose: cwj: thanks
[2014-03-25 20:47:54 -0400] anthroprose: dgarstang: there are your answers
[2014-03-25 20:48:21 -0400] coderanger: anthroprose: I just mean plain serverspec, not within TK
[2014-03-25 20:48:49 -0400] anthroprose: coderanger: ohh I know, I was wondering about the tooling though... I honestly had not used verify
[2014-03-25 20:49:24 -0400] coderanger: anthroprose: There isn't a way currently to run TK against an existing machine that I know of, you could make one though
[2014-03-25 20:50:09 -0400] anthroprose: coderanger: it was a machine that TK instantiated, I think cwj's comment was the correct answer to my incoherently asked question *and* use of the tool ;)
[2014-03-25 20:50:27 -0400] coderanger: anthroprose: Ahh, never mind :-)
[2014-03-25 20:50:43 -0400] cwj: :D
[2014-03-25 20:50:51 -0400] anthroprose: IRC has been forcing me to face many of my communications issues :)
[2014-03-25 20:51:19 -0400] anthroprose: due to facing technically challenging problems and being able to coherently ask questions so that people with enough understanding will pay attention
[2014-03-25 20:52:15 -0400] vyke: Can any tell me where I can get 11.1.x open source? I'm trying to get around this bug  https://tickets.opscode.com/browse/CHEF-3921
[2014-03-25 20:52:15 -0400] vyke: Missing Dependency causes chef server to consume all the CPU
[2014-03-25 20:53:33 -0400] anthroprose: there should be a drinking game involving that issue #
[2014-03-25 20:53:51 -0400] coderanger: vyke: It has not been released yet
[2014-03-25 20:54:01 -0400] coderanger: anthroprose: That game is my life
[2014-03-25 20:54:25 -0400] coderanger: vyke: I think the hope is to have it out by ChefConf in April, but ChefInc doesn't do timelines or ETAs most of the time
[2014-03-25 20:54:39 -0400] vyke: okay  thanks for the quick reply  any tips on tracking down the offending cookbook/issue
[2014-03-25 20:54:56 -0400] anthroprose: coderanger:  I can't even begin to pretend to have perspective, I am 1 guy at 1 tiny company
[2014-03-25 20:54:57 -0400] coderanger: vyke: use https://gist.github.com/coderanger/9198932 to check different sets of cookbooks
[2014-03-25 20:55:48 -0400] vyke: thank you  I will try that
[2014-03-25 20:56:20 -0400] coderanger: I should really make some kind of automated tool to debug this
[2014-03-25 20:58:22 -0400] dgarstang: kitchen help ... INSTANCE == suite? or something else?
[2014-03-25 20:58:44 -0400] coderanger: dgarstang: instances are suite x platform
[2014-03-25 20:58:53 -0400] coderanger: dgarstang: run `kitchen list` to see all of them
[2014-03-25 20:59:14 -0400] dgarstang: coderanger: k, that makes sense
[2014-03-25 20:59:33 -0400] dgarstang: I don't suppose there's a way to pass the config file loc to kitchen is there
[2014-03-25 21:01:26 -0400] coderanger: dgarstang: $KITCHEN_YAML
[2014-03-25 21:01:31 -0400] dgarstang: Here's a biggie... do suites in kitchen.yml magically match up against groups in Berksfile?
[2014-03-25 21:01:46 -0400] dgarstang: coderanger: Thanks.
[2014-03-25 21:01:50 -0400] coderanger: No
[2014-03-25 21:01:54 -0400] dgarstang: coderanger: Oh
[2014-03-25 21:02:02 -0400] coderanger: Berks groups aren't really used ever
[2014-03-25 21:02:21 -0400] dgarstang: coderanger: back to my original question from yesterday then that pissed you off
[2014-03-25 21:03:03 -0400] jchauncey: coderanger: we use them for test cookbook dependencies for testing LWRPs
[2014-03-25 21:03:19 -0400] coderanger: jchauncey: Yeah, thats the only time I use them too
[2014-03-25 21:03:23 -0400] dgarstang: coderanger: I can't put every single dependant cookbook from all the test suites into Berksfile. The unit tests then become integration tests
[2014-03-25 21:03:28 -0400] coderanger: jchauncey: and only for `berks upload -e test`
[2014-03-25 21:03:33 -0400] jchauncey: hehe
[2014-03-25 21:04:05 -0400] jchauncey: dgarstang: i have no idea what that means
[2014-03-25 21:04:21 -0400] scalp42: me either ^
[2014-03-25 21:04:40 -0400] coderanger: dgarstang: Dependent cookbooks are already pulled in via metadata dependnecies
[2014-03-25 21:04:52 -0400] dgarstang: jchauncey: sorry, getting frustrated at repeating this. if I want to unit test the cookbook, I do not want the base recipe, which means I do NOT want it in Berksfile
[2014-03-25 21:05:07 -0400] coderanger: dgarstang: The "metadata" line in a berksfile is exactly the same idea as "-e ." in a requirements.tt
[2014-03-25 21:05:25 -0400] dgarstang: coderanger: I don't want the base recipe in Berksfile for a unit test
[2014-03-25 21:05:40 -0400] coderanger: dgarstang: Then don't make your cookbook depend on it
[2014-03-25 21:06:11 -0400] dgarstang: coderanger: that's cool, until I need to do an integration test. Do I manually add it to Berksfile each time, and then remove it afterwards?
[2014-03-25 21:06:29 -0400] coderanger: No? Just don't have it as a dependency at all, anywhere
[2014-03-25 21:06:35 -0400] coderanger: Fix your ontology
[2014-03-25 21:06:44 -0400] coderanger: Each cookbook defines a noun and tests test that noun
[2014-03-25 21:06:46 -0400] anthroprose: ^^
[2014-03-25 21:06:55 -0400] anthroprose: thats what I keep learning
[2014-03-25 21:07:01 -0400] dgarstang: coderanger: For the integration test, I want to test the system as a whole, which means bringing in the base role. kitchen fails it that is in the kitchen.yml run list but not in the Berksfile
[2014-03-25 21:07:47 -0400] jchauncey: you are going to ahve a bad time
[2014-03-25 21:08:04 -0400] dgarstang: if kitchen is the wrong tool for testing the system as a whole, what tool is right?
[2014-03-25 21:08:18 -0400] law: liebnetz, I believe
[2014-03-25 21:08:22 -0400] coderanger: dgarstang: Make a cookbook for "the system as a whole"
[2014-03-25 21:08:28 -0400] jchauncey: you never test the entire system unless you are working against an "environemnt cookbook"
[2014-03-25 21:08:35 -0400] coderanger: dgarstang: Ours is called balanced-cookbooks/acceptance, for example
[2014-03-25 21:09:04 -0400] dgarstang: coderanger: I think you mean create a cookbook for the role... and test that....
[2014-03-25 21:09:17 -0400] scalp42: I think he means with multiple boxes I assume
[2014-03-25 21:09:36 -0400] coderanger: dgarstang: Yes
[2014-03-25 21:09:44 -0400] dgarstang: coderanger: ok, i can accept that
[2014-03-25 21:09:53 -0400] coderanger: though acceptance isn't a role we would ever run in prod in this example
[2014-03-25 21:09:56 -0400] jchauncey: dgarstang:  read this - http://vialstudios.logdown.com/posts/166848-the-environment-cookbook-pattern
[2014-03-25 21:10:50 -0400] dgarstang: jchauncey: i read that weeks ago. thanks. there's no direct connection between that and kitchen. i dunno. maybe it's just that the kitchen docs are so bad.
[2014-03-25 21:11:15 -0400] Nukepuppy: i dont think its bad its just basic
[2014-03-25 21:11:24 -0400] vyke: coderanger: thank you, from your post, I was able to find that my chef server had a couple cookbooks with newer versions that the one specified by the dependency.
[2014-03-25 21:11:33 -0400] Nukepuppy: i think you need to properly define the use case first to make best use of it
[2014-03-25 21:11:40 -0400] dgarstang: Nukepuppy: i was trying to work out how to set the environment... no mention whatsoever of that in the docs. i found out about it in a bug report
[2014-03-25 21:11:46 -0400] anthroprose: dgarstang: but kitchen has been written by and for the same people pushing the tautology, so they are linked
[2014-03-25 21:12:06 -0400] dgarstang: anthroprose: which kind of explains the docs. the people who wrote the docs are too close to the product.
[2014-03-25 21:12:10 -0400] dgarstang: anyway, thans
[2014-03-25 21:12:13 -0400] dgarstang: thanks for the help
[2014-03-25 21:12:21 -0400] anthroprose: dgarstang: thats the chef community :)
[2014-03-25 21:12:46 -0400] anthroprose: I just go along with whatever they say and quit complaining, my life is much easier, and way less admin'n to do
[2014-03-25 21:12:48 -0400] dgarstang: anthroprose: it makes it difficult and increases the learning curve. i am gonna go try what coderangr says before his short fuse runs out
[2014-03-25 21:12:54 -0400] anthroprose: let them figure out how to scale this stuff
[2014-03-25 21:13:08 -0400] dgarstang: anthroprose: i;'m one of those admins.
[2014-03-25 21:13:13 -0400] jchauncey: yes those patterns and test kitchen are linked whether you think they are or not
[2014-03-25 21:13:22 -0400] anthroprose: dgarstang: I totally understand, I am in a similar place
[2014-03-25 21:13:28 -0400] anthroprose: I'm just a generalist
[2014-03-25 21:13:30 -0400] dgarstang: anthroprose: :)
[2014-03-25 21:13:33 -0400] anthroprose: in charge of *everything*
[2014-03-25 21:13:38 -0400] dgarstang: anthroprose: darn tootin'
[2014-03-25 21:14:48 -0400] grepory: adnichols: thanks for the tip. i'll look into that.
[2014-03-25 21:15:09 -0400] adnichols: grepory: good luck
[2014-03-25 21:18:38 -0400] grepory: adnichols: ah yeah... basically that is what i want to use to deploy applications, but then dynamically determine which environment cookbooks are to be deployed on a given host based on a databag or some other potentially variable datasource.
[2014-03-25 21:31:40 -0400] adnichols: grepory: using that pattern only one environment cookbook can apply to a given host
[2014-03-25 21:32:14 -0400] adnichols: grepory: because you lock the environment cookbook constraints - using more than one environment cookbook in the runlist is likely to be a bad time, because they may require different versions
[2014-03-25 21:32:55 -0400] adnichols: grepory: as a result, that "one" environment cookbook can become quite a doozy - and dependency resolution is... "fun" (type 2)
[2014-03-25 21:57:20 -0400] dgarstang: If anyone is using the apt community cookbook, is there to not have apt-get update run after every single apt_repository ?
[2014-03-25 21:59:37 -0400] coderanger: dgarstang: No, doing so would be unsafe
[2014-03-25 22:00:43 -0400] dgarstang: coderanger: seems pretty safe when the calls to apt_repository are clumped sequentially together
[2014-03-25 22:01:00 -0400] coderanger: dgarstang: That isn't how convergent/idempotent systems work
[2014-03-25 22:01:22 -0400] dgarstang: coderanger: well, it means waiting for apt-get update to run 6 times then
[2014-03-25 22:01:43 -0400] coderanger: dgarstang: Each abstraction needs to be convergent itself or you end up with unmanagable cognitive load
[2014-03-25 22:02:24 -0400] coderanger: dgarstang: If that bothers you, make a new multirepository resource
[2014-03-25 22:02:35 -0400] coderanger: just as long as you maintain the boundary between convergent systems its fine
[2014-03-25 22:12:28 -0400] ephantom: I'm attempting to upload a backup of my chef 10 cookbooks to my chef 11 server. The knife upload doesn't produce any errors, but all that happens in the server is that the base cookbook folder is created, with out any data. For examples please see: https://gist.github.com/ephantom/a1eb92dabe951c14d865
[2014-03-25 22:21:28 -0400] ephantom: Does anyone have any suggestions as to what I can check next to resolve this issue?
[2014-03-25 22:56:51 -0400] rellis: Is there a convenient way to modify paritions using chef?
[2014-03-25 23:05:42 -0400] coderanger: rellis: Not really, you can just call fdisk though
[2014-03-25 23:05:59 -0400] coderanger: rellis: Normally that kind of stuff is already locked in by the time you run chef
[2014-03-25 23:08:52 -0400] rellis: okay
[2014-03-25 23:09:06 -0400] rellis: i found this which looks good, https://github.com/retr0h/cookbook-parted
[2014-03-25 23:13:12 -0400] drywheat: is there a utility that will let me easily SSH into a machine by nodename or other metadata?
[2014-03-25 23:13:41 -0400] doomviking: knife-ssh
[2014-03-25 23:14:21 -0400] drywheat: i guess i've never seen it used in that capacity
[2014-03-25 23:14:24 -0400] drywheat: ok
[2014-03-25 23:15:28 -0400] doomviking: well maybe not nodename
[2014-03-25 23:15:56 -0400] drywheat: `knife ssh name:foo-1 ...'
[2014-03-25 23:16:06 -0400] drywheat: that will let you perform operation per node name
[2014-03-25 23:16:40 -0400] doomviking: ah cool
[2014-03-25 23:16:48 -0400] dstynchula: how can I force recipes to run sequentially
[2014-03-25 23:17:13 -0400] drywheat: dstynchula: they run in sequence according to the run list
[2014-03-25 23:18:16 -0400] dstynchula: I have a cookbook where one recipe depends on the next one completing
[2014-03-25 23:18:33 -0400] dstynchula: and they're not running sequentially.
[2014-03-25 23:18:48 -0400] coderanger: dstynchula: They are run in whatever order you have in your run list
[2014-03-25 23:18:58 -0400] dstynchula: hmm...
[2014-03-25 23:19:07 -0400] dstynchula: so, I have an mdadm cookbook
[2014-03-25 23:19:11 -0400] dstynchula: and one recipe installs mdadm
[2014-03-25 23:19:21 -0400] dstynchula: I know it works, as i can run it standalone and it works
[2014-03-25 23:19:25 -0400] coderanger: But remember chef is a two-pass system so first _all_ recipes are compiled, and then _all_ resources are converged
[2014-03-25 23:19:34 -0400] dstynchula: the next one is arraymaker,
[2014-03-25 23:19:52 -0400] dstynchula: which I also know works, as I can run it after I run mdadm::default as a standalone, and it works
[2014-03-25 23:19:59 -0400] dstynchula: but when I add them both to a runlist,
[2014-03-25 23:20:09 -0400] dstynchula: the second one fails as it cant find mdadm
[2014-03-25 23:20:31 -0400] coderanger: dstynchula: Is it checking at run time or compile time?
[2014-03-25 23:21:02 -0400] dstynchula: compile error
[2014-03-25 23:21:07 -0400] dstynchula: so I think compile time
[2014-03-25 23:21:16 -0400] coderanger: Yeah, so thats the problem
[2014-03-25 23:21:22 -0400] dstynchula: Recipe Compile Error in /var/chef/cache/cookbooks/mdadm/recipes/arraymaker.rb
[2014-03-25 23:21:23 -0400] coderanger: And fortunately there is a solution :-)
[2014-03-25 23:21:27 -0400] dstynchula: hurray!
[2014-03-25 23:21:38 -0400] coderanger: Look up the now cookbook
[2014-03-25 23:21:40 -0400] coderanger: ckbk.it/now
[2014-03-25 23:21:50 -0400] dstynchula: XX
[2014-03-25 23:22:00 -0400] coderanger: you can use include_recipe_now to force execution in specific orders
[2014-03-25 23:22:12 -0400] drywheat: knife node show
[2014-03-25 23:22:15 -0400] drywheat: sorry
[2014-03-25 23:22:18 -0400] coderanger: that function will compile and converge the requested recipe before continuing
[2014-03-25 23:22:24 -0400] coderanger: drywheat: re -rf /
[2014-03-25 23:23:04 -0400] dstynchula: does the now cookbook introduce the include_recipe_now? or have some good examples?
[2014-03-25 23:23:45 -0400] coderanger: dstynchula: I mean the only example is "include_recipe_now 'name'"
[2014-03-25 23:23:46 -0400] coderanger: :-)
[2014-03-25 23:24:02 -0400] dstynchula: I just looked up the cookbook
[2014-03-25 23:24:09 -0400] dstynchula: so it adds the functionality
[2014-03-25 23:24:10 -0400] dstynchula: ?
[2014-03-25 23:24:20 -0400] coderanger: Yes, the cookbook adds to the DSL
[2014-03-25 23:24:29 -0400] dstynchula: and I need to have 'require now' in the metadata.rb of the mdadm cookbook?
[2014-03-25 23:24:47 -0400] dstynchula: and include_recipe "now" in the recipes, right?
[2014-03-25 23:24:47 -0400] coderanger: Well you need to do it at a higher level
[2014-03-25 23:24:59 -0400] coderanger: No, now has no recipes
[2014-03-25 23:26:08 -0400] coderanger: dstynchula: http://hastebin.com/ditukakeli.rb
[2014-03-25 23:26:12 -0400] coderanger: You want a new recipe that looks like that
[2014-03-25 23:26:54 -0400] dstynchula: and then I replace the runlist with the new, 'unified' recipe
[2014-03-25 23:26:55 -0400] dstynchula: ?
[2014-03-25 23:27:05 -0400] dstynchula: I 'think' I get it!
[2014-03-25 23:27:08 -0400] dstynchula: ?
[2014-03-25 23:27:12 -0400] dstynchula: !(?)
[2014-03-25 23:27:42 -0400] coderanger: dstynchula: Yeah
[2014-03-25 23:27:59 -0400] coderanger: So that will force the mdadm recipe to fully execute before even compiling the arraymaker recipe file
[2014-03-25 23:28:01 -0400] dstynchula: and that recipe needs to live in the now cookbook in recipes, right?
[2014-03-25 23:28:08 -0400] dstynchula: awesome!
[2014-03-25 23:28:11 -0400] coderanger: No, make a new cookbook
[2014-03-25 23:28:16 -0400] dstynchula: ahh ok
[2014-03-25 23:28:24 -0400] dstynchula: and include now in the metadata.rb
[2014-03-25 23:28:37 -0400] coderanger: "now" is a library-ish cookbook so you should never modify it
[2014-03-25 23:28:40 -0400] coderanger: Yep
[2014-03-25 23:31:18 -0400] ephantom_: I'm attempting to upload a backup of my chef 10 cookbooks to my chef 11 server. The knife upload doesn't produce any errors, but all that happens in the server is that the base cookbook folder is created, with out any data. For examples please see: https://gist.github.com/ephantom/a1eb92dabe951c14d865
[2014-03-25 23:32:25 -0400] ephantom_: Does anyone have any suggestions as to what I can check next to resolve this issue?
[2014-03-25 23:33:56 -0400] drywheat: coderanger: i don't understand
[2014-03-25 23:34:07 -0400] coderanger: drywheat: ?
[2014-03-25 23:34:14 -0400] drywheat: re -rf /
[2014-03-25 23:34:22 -0400] dstynchula: No resource or method named `include_recipe_now' for `Chef::Recipe "default"'
[2014-03-25 23:34:33 -0400] coderanger: drywheat: Making fun of you for typing console commands into Chef
[2014-03-25 23:34:42 -0400] drywheat: ha, got it
[2014-03-25 23:34:44 -0400] drywheat: nice
[2014-03-25 23:35:07 -0400] drywheat: i didn't see any clear way to open a login shell into a Chef node using `knife ssh'
[2014-03-25 23:35:17 -0400] drywheat: so i wrote this little snippet
[2014-03-25 23:35:31 -0400] dstynchula: n/m
[2014-03-25 23:35:43 -0400] dstynchula: (forgot to upload after metadata.rb)
[2014-03-25 23:35:45 -0400] dstynchula: doh
[2014-03-25 23:35:54 -0400] drywheat: ssh <uname>@$(knife node show $1 | awk '/IP/ { print $2 }')
[2014-03-25 23:36:26 -0400] drywheat: obviously you could parameterize the uname, but that will let you do something like `ssh-chef appsrv-1'
[2014-03-25 23:36:37 -0400] coderanger: drywheat: knife ssh "query" interactive
[2014-03-25 23:36:47 -0400] coderanger: drywheat: Also you can use "macterm" or "tmux"
[2014-03-25 23:36:49 -0400] coderanger: or cssh
[2014-03-25 23:37:18 -0400] drywheat: didn't see that
[2014-03-25 23:37:19 -0400] drywheat: jeez
[2014-03-25 23:37:48 -0400] coderanger: :-)
[2014-03-25 23:56:54 -0400] dstynchula: coderanger: thanks again man! You're the best!
