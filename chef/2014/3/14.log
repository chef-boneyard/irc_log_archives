[2014-03-14 00:02:13 -0400] maraca: hi! I am getting "ERROR: Chef::Exceptions::ContentLengthMismatch" when downloading some templates. Any idea what could be causing this? running chef 11
[2014-03-14 00:03:55 -0400] maraca: this definitely didn't use to happen
[2014-03-14 00:04:20 -0400] maraca: only happens on the first run of chef-client, if i run it a second time then it's fine.
[2014-03-14 00:07:03 -0400] carmstrong: maraca: sounds like a problem with the Chef server providing the template. does running chef-client with -l debug shed any light?
[2014-03-14 00:07:26 -0400] maraca: it's hard to tell because it only happens when the instance bootstraps for the first time
[2014-03-14 00:07:43 -0400] maraca: carmstrong: if i then run a sudo chef-client -j /etc/chef/first-run.json then it bootstraps all the way
[2014-03-14 00:08:00 -0400] maraca: wondering if related to https://tickets.opscode.com/browse/CHEF-5041
[2014-03-14 00:10:45 -0400] carmstrong: maraca: seems like it could be a good candidate
[2014-03-14 00:36:47 -0400] aspiers: I've written an alternative provider for the service resource in cookbook A, but I can't use it in cookbook despite adding depends "A" to metadata.rb - I get uninitialized constant Chef::Provider::MyService
[2014-03-14 00:36:49 -0400] aspiers: any ideas?
[2014-03-14 00:37:22 -0400] aspiers: s/cookbook despite/cookbook B despite/
[2014-03-14 00:37:37 -0400] aspiers: within the service block in cookbook B, I have a line: provider Chef::Provider::MyService
[2014-03-14 00:37:42 -0400] maraca: aspiers did you include_recipe "cookbookA::default"
[2014-03-14 00:37:54 -0400] maraca: this is a requirement to have access to the providers
[2014-03-14 00:38:11 -0400] aspiers: maraca: ohhhh
[2014-03-14 00:38:14 -0400] aspiers: maraca: why?
[2014-03-14 00:38:32 -0400] maraca: aspiers: good question
[2014-03-14 00:53:50 -0400] werdnativ: can chef-vault be used to replace over an existing data bag? i.e. add a new vault item into an existing data bag that was previously not managed by vault?
[2014-03-14 00:54:49 -0400] werdnativ: I'm thinking about replacing existing encrypted data bags with chef-vault piece by piece...
[2014-03-14 00:55:19 -0400] aspiers: maraca: does it have to be the default recipe?
[2014-03-14 01:10:32 -0400] aspiers: maraca: turns out include_recipe is not required, I just had a typo :(
[2014-03-14 01:57:38 -0400] werdnativ: Is anyone able to install this: http://community.opscode.com/cookbooks/chef-vault ? If I put it in my metadata and run berks install I get a SSL cert error.
[2014-03-14 02:25:36 -0400] juliancdunn: arir: just wanted to thank you for the Oracle cookbook. my clients find it really valuable
[2014-03-14 03:39:00 -0400] gfunky: How do people live with Chef 10 clients while all the community cookbooks move on to chef 11 features? So many books just snarf in new versions which don't fly with chef-10?
[2014-03-14 03:39:35 -0400] anthroprose: gfunky: Berkshelf like a mofo
[2014-03-14 03:39:48 -0400] anthroprose: and version pin *everything*
[2014-03-14 03:40:21 -0400] anthroprose: the yum cookbook just made breaking changes... same issues with deps all the way down the chain
[2014-03-14 03:40:50 -0400] gfunky: anthroprose: berkshelf 2 dependency resolver kinda lacks in resolution. And i can't version pin other community books. I guess, maybe i can contirbute to community books and try to get them to release another patch version for previous minor versions that i can lock to?
[2014-03-14 03:41:13 -0400] gfunky: ark, yum, maven, java
[2014-03-14 03:41:20 -0400] anthroprose: but you can control what you upload to chefserver
[2014-03-14 03:41:27 -0400] flaccid: gfunky: basically, have to get off chef 10
[2014-03-14 03:41:31 -0400] savant: gfunky: I gave up and upgraded.
[2014-03-14 03:41:31 -0400] anthroprose: so use that as the quality gate
[2014-03-14 03:41:56 -0400] anthroprose: and then version in in your Environments, so even if something does get uploaded
[2014-03-14 03:42:02 -0400] anthroprose: Production is set to 1.0.1, not wide open
[2014-03-14 03:42:03 -0400] gfunky: It's a hard migration road. "don't upload new books" + "migrate from 10 to 11"
[2014-03-14 03:42:10 -0400] savant: yeah
[2014-03-14 03:42:14 -0400] anthroprose: yeah
[2014-03-14 03:42:16 -0400] savant: i just upgraded
[2014-03-14 03:42:19 -0400] savant: took a few days
[2014-03-14 03:42:34 -0400] gfunky: 10k servers hard
[2014-03-14 03:42:39 -0400] savant: luckily i had been moving to opscode cookbooks for generic stuff
[2014-03-14 03:42:40 -0400] savant: yeah
[2014-03-14 03:42:41 -0400] savant: well
[2014-03-14 03:42:42 -0400] savant: idk.
[2014-03-14 03:42:51 -0400] flaccid: gfunky: hosted or oss chef server?
[2014-03-14 03:42:57 -0400] gfunky: thanks for the thoughts, though. :-)
[2014-03-14 03:43:02 -0400] gfunky: private.
[2014-03-14 03:43:06 -0400] savant: gfunky: good luck
[2014-03-14 03:43:14 -0400] savant: I did a migration of chef solo
[2014-03-14 03:43:16 -0400] savant: that was fun
[2014-03-14 03:43:22 -0400] savant: not near as many servers though
[2014-03-14 03:43:23 -0400] flaccid: gfunky: so you run your own chef server? or is this hosted private?
[2014-03-14 03:43:24 -0400] anthroprose: gfunky: I would use something like chefspec+serverspec to test both setups in parallel
[2014-03-14 03:43:28 -0400] anthroprose: to ensure 1:1
[2014-03-14 03:43:43 -0400] flaccid: either way the solution stop gap is a chef server for 10 and a new one for 11
[2014-03-14 03:43:57 -0400] gfunky: flaccid, yah. we run multiple private chaf servs.
[2014-03-14 03:44:08 -0400] flaccid: shard it up funky
[2014-03-14 03:44:53 -0400] gfunky: Hrmm. additional orgs. bootstrap the new one.... maybe.
[2014-03-14 03:45:22 -0400] gfunky: Kinda wish it were a metadata.rb attribute. "requires chef 11" and "no chef 11, pls"
[2014-03-14 03:45:23 -0400] flaccid: its the only way i see when you can't do the granular cookbook version thing on server
[2014-03-14 03:45:49 -0400] gfunky: Yah, we aren't awesome at berks apply <environment>
[2014-03-14 03:45:59 -0400] flaccid: gfunky: thats a good feature request. it can be done on cookbooks in metadata but i don't even think chef server can server multiple version of a cookbook as defined
[2014-03-14 03:46:01 -0400] gfunky: And need a better provisioning loop.
[2014-03-14 03:46:16 -0400] flaccid: gfunky: that looks like development if berks
[2014-03-14 03:46:20 -0400] gfunky: *provisioning test loop
[2014-03-14 04:45:40 -0400] PeterO: How do you include another recipe?
[2014-03-14 04:49:50 -0400] flaccid: PeterO: include_recipe
[2014-03-14 05:14:06 -0400] nshbrown: hey btm
[2014-03-14 05:53:37 -0400] Junaid_: Is there a chef Api to search through the attributes inside the nodes?
[2014-03-14 05:53:54 -0400] doug2: So...
[2014-03-14 05:55:22 -0400] doug2: i was just looking at putting location data, current set in a role into a cookbook, that seems really ugly.
[2014-03-14 05:57:24 -0400] savant: location data?
[2014-03-14 05:57:24 -0400] PeterO: Gah.. I'm having a hard time overriding attributes... what's wrong with the following node.override["composer"]["group"] = "root" ?
[2014-03-14 06:00:36 -0400] flaccid: PeterO: looks ok
[2014-03-14 06:01:07 -0400] PeterO: Hmm... the included recipe keeps setting their own attributes
[2014-03-14 06:01:44 -0400] flaccid: PeterO: example?
[2014-03-14 06:01:49 -0400] PeterO: I'm trying to override the group attribute in this repo: https://github.com/Morphodo/chef-composer
[2014-03-14 06:02:14 -0400] PeterO: error being thrown is: cannot determine group id for 'www-data', does the group exist on this system?
[2014-03-14 06:02:45 -0400] flaccid: thats a logical issue
[2014-03-14 06:03:14 -0400] flaccid: firstly they should have default.composer.group as default['composer']['group']
[2014-03-14 06:03:33 -0400] flaccid: second they need a resource to ensure the group exists first
[2014-03-14 06:04:08 -0400] PeterO: Well... it was just one of the few better documented composer repos I could see on Google..
[2014-03-14 06:04:24 -0400] flaccid: the later appears to be missing from https://github.com/Morphodo/chef-composer/blob/master/providers/default.rb
[2014-03-14 06:04:56 -0400] flaccid: they have not implemented user and group resources
[2014-03-14 06:05:02 -0400] flaccid: contribute that and its solved
[2014-03-14 06:05:54 -0400] PeterO: and overriding it?
[2014-03-14 06:06:27 -0400] flaccid: huh
[2014-03-14 06:07:14 -0400] PeterO: I just want to override the group
[2014-03-14 06:07:22 -0400] PeterO: I don't want www-data
[2014-03-14 06:07:39 -0400] flaccid: yes, i just explained the problem and solution
[2014-03-14 06:12:02 -0400] flaccid: PeterO: you're other options is to raise an issue https://github.com/Morphodo/chef-composer/issues
[2014-03-14 06:12:35 -0400] flaccid: you're = your
[2014-03-14 06:23:31 -0400] PeterO: yeah if I knew what I was doing I'd totally submit a pull request... but seeing as I don't.. I can't.
[2014-03-14 07:05:06 -0400] shoelessone: Could someobdy answer what is probably a stupid question: say i use chef to install nginx and php-fpm, and say i want to setup a new virtual host or whatever (sites-enabled), do I do that in nginx configuration withing vagrant? or do I write a totally seperate script to do that for me?
[2014-03-14 07:06:50 -0400] rjocoleman: you'd be doing it in a chef recipe, probably a site-cookbook by the sounds of it
[2014-03-14 07:07:50 -0400] shoelessone: thank you! and if i wanted to google this, to get an example/idea how to do this (I'm new to chef), is "site-cookbook" the term I might want to use?
[2014-03-14 07:09:43 -0400] rjocoleman: chef solo is what you're going to be using, I'm sure there are some primers for it.. lemme see I can dig something up quickly
[2014-03-14 07:10:02 -0400] shoelessone: Well, I think I have what must be chef-solo running. I have chef-librarian installed
[2014-03-14 07:10:22 -0400] shoelessone: it seems to work well at provisioning a server and installing nginx, mysql, php-fpm, etc
[2014-03-14 07:10:31 -0400] shoelessone: but, I'm at a loss for how I'm supposed to go from there
[2014-03-14 07:10:41 -0400] shoelessone: I know there are somethings you can set in vagrant via json configuration
[2014-03-14 07:10:52 -0400] rjocoleman: this looks like a pretty good primer: http://leopard.in.ua/2013/01/04/chef-solo-getting-started-part-1/
[2014-03-14 07:10:52 -0400] shoelessone: things like passwords/etc for mysql, etc
[2014-03-14 07:11:08 -0400] rjocoleman: I just found it and skimmed, so no warranty implied!
[2014-03-14 07:11:16 -0400] shoelessone: cool!
[2014-03-14 07:11:21 -0400] shoelessone: thanks rjocoleman, really appreciate it
[2014-03-14 07:11:54 -0400] rjocoleman: np, part two sounds like where you're at but it's probably worth stepping through part one to be sure
[2014-03-14 07:15:38 -0400] shoelessone: looks perfect, thanks again rjocoleman!
[2014-03-14 09:00:00 -0400] chef905: hi
[2014-03-14 09:00:45 -0400] chef905: can i check whether mysql server is running on my chef -client using chef cookbook
[2014-03-14 09:00:47 -0400] thekev: Greetings
[2014-03-14 09:03:01 -0400] chef905: how i can do the same?
[2014-03-14 09:48:10 -0400] srenatus: hmm is Foodcritic 17, "LWRP does not notify when updated", really a thing when the provider is made up of inline resources?
[2014-03-14 09:52:07 -0400] srenatus: oh my bad. forgot to throw in some use_inline_resources
[2014-03-14 10:01:47 -0400] zeroXten: is there a good way to create a cookbook tarball without using knife?
[2014-03-14 10:02:09 -0400] zeroXten: is it just a case of ensuring there is a metadata.json and then taring it up?
[2014-03-14 10:10:11 -0400] srenatus: zeroXten: checked sethvargo/stove and fnichol/emeril ? not sure if they're oversized for your usecase (or even able to do that), just pointers.
[2014-03-14 10:30:11 -0400] zeroXten: srenatus: thanks, i'll take a look
[2014-03-14 10:31:57 -0400] chef095: hi
[2014-03-14 10:32:57 -0400] chef095: is their a way to execute the chef recipe at particular interval?
[2014-03-14 10:47:30 -0400] bro79: Hi, I would like to get a list of all available packages ready for upgrade on debian systems. I was thinking of writing a script to parse the output of apt-get --just-print upgrade and storing the results in a data bag, so that I can easily view these from my workstation. Is this overkill? How do others achieve this? IMO knife ssh loops don't seem practical for this task.
[2014-03-14 11:05:26 -0400] workmad3: bro79: data bags aren't updatable from nodes, afaik (and trying to do so introduces distribute race conditions on a resource that has no transactional support)
[2014-03-14 11:09:12 -0400] zeroXten: heh, looks like stove isn't really working out for me :(
[2014-03-14 11:15:49 -0400] bro79: workmad3: That makes sense. Wishful thinking on my part. :)
[2014-03-14 11:17:46 -0400] zeroXten: ah ffs, the install gem is v1
[2014-03-14 11:18:05 -0400] lewiz1: bro79: You can make databags writable but you need to set nodes as admin nodes.  Race conditions still apply so not a great idea
[2014-03-14 11:38:18 -0400] bro79: lewiz1: Race conditions are a no no for me. :)
[2014-03-14 11:38:31 -0400] srenatus: is there a way to get all resources of type X from the resource collection?
[2014-03-14 11:38:39 -0400] bro79: Would have been neat though. :)
[2014-03-14 11:41:43 -0400] lewiz1: Given http://docs.opscode.com/chef_overview_attributes.html#attribute-precedence can anybody explain why "node.force_default['x']['y'] = false" in a wrapper cookbook recipe is not overriding "default['x']['y'] = true" in cookbook x's attribute file?  I've also tried node.force_override... I'm clearly missing somethin.
[2014-03-14 12:00:24 -0400] workmad3: bro79: you could always set that info as a node attribute
[2014-03-14 12:00:41 -0400] workmad3: bro79: and then do a search to pull out that attribute
[2014-03-14 12:01:08 -0400] bro79: workmad3:  can node attributes be multi-dimensional ?
[2014-03-14 12:03:08 -0400] workmad3: bro79: as in arrays of arrays? I think so
[2014-03-14 12:32:35 -0400] richardshaw: hey, when's 11.12.0-client due out? I'm looking for a fix for https://tickets.opscode.com/browse/CHEF-5041
[2014-03-14 12:34:22 -0400] flaccid: richardshaw: bug is only confirmed
[2014-03-14 12:36:13 -0400] richardshaw: flaccid: sure, so I'm trying to understand how long a fix might be
[2014-03-14 12:36:45 -0400] flaccid: richardshaw: someara might be able to help
[2014-03-14 12:37:25 -0400] richardshaw: ok thanks
[2014-03-14 13:25:45 -0400] bro79: workmad3: Thanks for that, will give the attribute a try and yes was for array or arrays. :)
[2014-03-14 13:38:23 -0400] dev1x: hello, i'm having a doubt, can yum_package handle multiple packages at the time?
[2014-03-14 13:41:02 -0400] mattsurabian: anyone using chef-zero?
[2014-03-14 13:41:05 -0400] HarryW: i see what you did there
[2014-03-14 13:41:40 -0400] mattsurabian: I've got it running in the foreground, the documentation says "To try it out, go into the chef-zero/playground" where uhhhh IS the chef-zero directory??
[2014-03-14 13:45:36 -0400] mattsurabian: oh I see
[2014-03-14 13:45:45 -0400] mattsurabian: this repo provides it :-p
[2014-03-14 13:45:52 -0400] mattsurabian: I didn't check out this repo I just installed the gem
[2014-03-14 13:59:38 -0400] mattsurabian: so I've got chef-zero running and it's pretty cool. What's the ideal workflow here though? Testing with vagrant or similar VMs?
[2014-03-14 14:00:42 -0400] pravinmishra: Can i configure LXC container with Chef instead of Vagrant?
[2014-03-14 14:21:25 -0400] stormerider: is there a cookbook to manage /etc/hosts?
[2014-03-14 14:22:57 -0400] flaccid: stormerider: yes, hostsfile
[2014-03-14 14:23:05 -0400] stormerider: flaccid: thanks.
[2014-03-14 14:23:10 -0400] flaccid: stormerider: or you can use my system cookbook
[2014-03-14 14:23:19 -0400] flaccid: which depends on it
[2014-03-14 14:26:23 -0400] pravinmishra:  vagrant provision , getting error http://pastebin.com/Z27DHGvt
[2014-03-14 14:26:23 -0400] pravinmishra:   Any help
[2014-03-14 14:27:29 -0400] pravinmishra: I am struggling from two days
[2014-03-14 14:27:44 -0400] flaccid: pravinmishra: try google searching with that
[2014-03-14 14:27:50 -0400] flaccid: i'm sure there would be results
[2014-03-14 14:28:55 -0400] pravinmishra: I tried, as per suggestion
[2014-03-14 14:28:59 -0400] pravinmishra:  i removed /home/ubuntu/.vagrant.d and .vagrant from current dirrectory
[2014-03-14 14:29:16 -0400] pravinmishra: now facing this issues
[2014-03-14 14:29:29 -0400] flaccid: pravinmishra: there is #vagrant
[2014-03-14 14:37:17 -0400] benner: is there way to detect if recipe running on chef-zero?
[2014-03-14 14:44:07 -0400] stormerider: benner: i think you can tell if it's in local mode, but not specifically zero
[2014-03-14 14:44:55 -0400] stormerider: I know there's Chef::Config[:solo] and Chef::Config.local_mode
[2014-03-14 15:01:09 -0400] jkeiser: mattsurabian: local mode is one way (pass -z to chef-client or knife and it brings up chef-zero internally); the spec plugin (see README) for testing is another major use of it.
[2014-03-14 15:02:06 -0400] mattsurabian: jkeiser: thanks, seems test-kitchen would be a good place to start
[2014-03-14 15:02:20 -0400] mattsurabian: switching over considering the whole deprecation of vagrant berkshelf
[2014-03-14 15:02:21 -0400] jkeiser: yep, that has a good plugin for zero too
[2014-03-14 15:27:58 -0400] pcort42: if you have files in your cookbook that don't change, they don't get uploaded to the server again when you upload the cookbook correct?
[2014-03-14 15:31:44 -0400] jbz: pcort42: I don't think cookbook uploading is sparse, but I may be wrong.  If the cookbook has a new version, I think it all goes.
[2014-03-14 15:41:35 -0400] jkeiser: pcort42, jbz: it's sparse actually
[2014-03-14 15:41:55 -0400] jbz: Oh?  Thanks for the correction, TIL!
[2014-03-14 15:41:56 -0400] jkeiser: pcort42, jbz: a cookbook in Chef is a list of files, and the files are identified by their checksum
[2014-03-14 15:42:23 -0400] jkeiser: pcort42, jbz: if a checksum is already uploaded, we don't upload again ... if it is not, then we upload
[2014-03-14 15:43:12 -0400] jkeiser: np!
[2014-03-14 15:44:20 -0400] pcort42: jbz: thanks, I'd check myself but I'm running hosted chef so I can't verify the timestamp of the files myself :(
[2014-03-14 15:44:50 -0400] jkeiser: pcort42: you were logged off, but cookbook file uploads are actually sparse
[2014-03-14 15:45:05 -0400] pcort42: oh ok, neat
[2014-03-14 15:45:07 -0400] jkeiser: pcort42: if two cookbooks (or versions) have the same checksum, it is only uploaded and stored once
[2014-03-14 15:45:22 -0400] jkeiser: pcort42: same for if you are updating a cookbook version
[2014-03-14 15:45:38 -0400] pcort42: does it run a full checksum against all the files in the cookbook?
[2014-03-14 15:46:13 -0400] pcort42: or just on the cookbook as a whole
[2014-03-14 15:46:38 -0400] jkeiser: pcort42: all files in the cookbook
[2014-03-14 15:46:53 -0400] pcort42: very interesting.
[2014-03-14 15:46:56 -0400] pcort42: well thanks, that saves me a ton of time
[2014-03-14 15:47:17 -0400] jkeiser: pcort42: so if file A is already uploaded and file B is not, then the cookbook upload will only upload file B
[2014-03-14 15:47:21 -0400] jkeiser: and will just reference file A
[2014-03-14 15:47:52 -0400] jkeiser: We automatically garbage collect files when there are no more cookbooks referencing their checksum
[2014-03-14 15:48:52 -0400] pcort42: and is it a full checksum, or partial?
[2014-03-14 15:49:05 -0400] jkeiser: full
[2014-03-14 15:49:11 -0400] jkeiser: Like, the whole file is checksummed
[2014-03-14 15:49:14 -0400] jkeiser: sha256 I believe
[2014-03-14 15:49:14 -0400] pcort42: yeah
[2014-03-14 15:49:17 -0400] pcort42: ok
[2014-03-14 15:49:36 -0400] pcort42: cause the files that i'm uploading may only have a couple changes that amount to a few bytes
[2014-03-14 15:49:58 -0400] pcort42: so it has to be thorough.
[2014-03-14 15:50:00 -0400] jkeiser: yep, they won't be missed.  We don't use heuristics like size or date or anything, just actual checksum
[2014-03-14 15:50:08 -0400] pcort42: ok awesome
[2014-03-14 15:52:21 -0400] pcort42: and does the same technique apply when the node checks in with the server and sees a new cookbook?
[2014-03-14 15:56:35 -0400] jkeiser: pcort42: yep
[2014-03-14 15:57:00 -0400] jkeiser: pcort42: though I'm not sure whether files are shared across separate versions on the node (probably not)
[2014-03-14 15:57:05 -0400] dJustin: I'm attempting to set a registry values using registry_key, and I catch the following error: chef cannot find a resource for registry_key on windows version 6.1.7601
[2014-03-14 15:58:02 -0400] jkeiser: pcort42: oh!  yes.  if you upgrade cookbook versions, or in-place modify cookbook files, the node will only download changed files
[2014-03-14 15:58:07 -0400] jkeiser: using sha256 again
[2014-03-14 16:07:48 -0400] dJustin: Any hints/tips to fix setting registry_keys, when the following occurs: chef cannot find a resource for registry_key on windows version 6.1.7601...I've run on several other windows vm's before, with no issues
[2014-03-14 16:12:06 -0400] dJustin: Well, if resources don't work, system("reg add ...") will... :)
[2014-03-14 16:31:45 -0400] dobbs: Random question about IP addresses.  I notice various blog posts and such combining chef and vagrant there seems to be a convention of using 33.33.33.* ip addresses for private network configs.
[2014-03-14 16:32:30 -0400] dobbs: That address space is real and routable and owned by US Dept of Defense.  Any reason for choosing that address instead of one of the designated private address spaces?
[2014-03-14 16:32:56 -0400] dobbs: (e.g. 10.*.*.*, or 172.16-31.*.*, or 192.168.*.*)
[2014-03-14 16:33:04 -0400] kbarry: I'm having a hard time seeing how to set the environment of a node at the command line (via knife)
[2014-03-14 16:33:11 -0400] kbarry: Am I missing something here?
[2014-03-14 16:35:09 -0400] gchristensen: dobbs: I can't say its a good reason, just a theory - that the private IPs will probably conflict with local network settings
[2014-03-14 16:36:38 -0400] dobbs: gchristensen: yeah, but that seems like a better option than interfering with real routing tables for real addresses.
[2014-03-14 16:36:59 -0400] dobbs: And these are specifically :private_network settings.
[2014-03-14 16:38:52 -0400] gchristensen: dobbs: I'm not saying it was a good idea :)
[2014-03-14 16:39:09 -0400] dobbs: gchristensen: fair enough.  :-)
[2014-03-14 16:41:22 -0400] gchristensen: dobbs: on a similar note, I don't always trample on registered address space, but when I do, its the DOD.
[2014-03-14 16:41:52 -0400] workmad3: heh
[2014-03-14 16:43:08 -0400] dJustin: wow, what's the deal with this vm of mine.  I can't load my encrypteddatabagitem either
[2014-03-14 16:43:35 -0400] notromda: I have a recipe, where I need to create a mysql user/pass, and the set up a template with that password.   Problem is, it regenerates a new password every time, and updates the config file.   I'd like it to remain the same.
[2014-03-14 16:44:10 -0400] notromda: Should I store the passoword in the node attributes somehow so future runs can find the same password?
[2014-03-14 16:44:30 -0400] ubercore: Hello all. I'm having trouble with a "bash" resource in one of my recipes. For some reason, on ubuntu, I can't meaningfully set the LANG environment variable
[2014-03-14 16:45:10 -0400] gchristensen: notromda: using chef-solo?
[2014-03-14 16:45:28 -0400] fraterlaetus: Good Morning chefs!
[2014-03-14 16:45:29 -0400] notromda: chef server
[2014-03-14 16:45:37 -0400] gchristensen: odd, it should definitely save the attribute.
[2014-03-14 16:45:43 -0400] ubercore: by that I mean that some python code that I run directly in bash after logging in sets encoding as utf-8 (as it should be), but setting LANG=en_US.UTF-8 in the bash resource causes python to still use the C locale
[2014-03-14 16:46:05 -0400] fraterlaetus: does anyone know how to address a sub-attribute of a custom attribute in a chef recipe?
[2014-03-14 16:46:17 -0400] fraterlaetus: I have a custom attribute called unpartitioned,
[2014-03-14 16:46:30 -0400] gchristensen: fraterlaetus: like node['attribute]['whut']
[2014-03-14 16:46:31 -0400] fraterlaetus: which expands in the opscode management console to unpartitioned => 0
[2014-03-14 16:46:33 -0400] gchristensen: ?
[2014-03-14 16:47:00 -0400] notromda: not the server password, but a non-priv mysql user account
[2014-03-14 16:47:01 -0400] fraterlaetus: which then expands to 0 => 0 and 0 => 1
[2014-03-14 16:47:13 -0400] fraterlaetus: I've tried unpartitioned[0]
[2014-03-14 16:47:22 -0400] fraterlaetus: and unpartitioned[0].1
[2014-03-14 16:47:30 -0400] fraterlaetus: and unpartitioned[0][1]
[2014-03-14 16:48:26 -0400] gchristensen: fraterlaetus: so, using that syntax it basically becomes an array instead of a hash, and the sort order is undefined
[2014-03-14 16:48:43 -0400] fraterlaetus: it's an array of hashes
[2014-03-14 16:48:49 -0400] gchristensen: fraterlaetus: https://coderanger.net/2013/06/arrays-and-chef/
[2014-03-14 16:48:52 -0400] fraterlaetus: datatype is array
[2014-03-14 16:48:52 -0400] gchristensen: arrays are bad-news in chef.
[2014-03-14 16:49:07 -0400] dobbs: gchristensen: I was thinking there might be some intentional interest in abusing the DoD.  Fight the Power.  :-)  Or alternately it might have been something the DoD actually wanted for some nefarious reason  :-)
[2014-03-14 16:49:34 -0400] gchristensen: dobbs: yes, using real IPs for local stuff has a serious risk of leaking data.
[2014-03-14 16:49:45 -0400] gchristensen: and yes, fight the power! I route all DOD IPs to localhost.
[2014-03-14 16:49:49 -0400] gchristensen: (just kidding)
[2014-03-14 16:51:30 -0400] fraterlaetus: as an array of hashes, the sort order doesn't really matter to me.
[2014-03-14 16:52:13 -0400] fraterlaetus: mostly, I just need a way to address unpartitioned[index][key] in a recipe
[2014-03-14 16:52:25 -0400] fraterlaetus: unpartitioned[0][1][name] or something
[2014-03-14 16:52:45 -0400] fraterlaetus: any ideas?
[2014-03-14 16:58:52 -0400] fraterlaetus: https://gist.github.com/dstynchula/9551914
[2014-03-14 17:06:51 -0400] tapH20guru: is this the right place to ask questions about opscode bento boxes?
[2014-03-14 17:11:25 -0400] zeroXten: http://community.opscode.com/cookbooks/chef_vault_pki < feedback welcome
[2014-03-14 17:13:48 -0400] xsaintish: Quick question. Is there by chance a way to make changes to a chef recipe on a file system and tell chef to not pull from the chef server but rather just run what it already has on the node? Kind of an odd request, but I'm more curious than anything.
[2014-03-14 17:14:18 -0400] zeroXten: xsaintish: you'd have to upload the changes first
[2014-03-14 17:14:52 -0400] stormerider: xsaintish: you can possibly do it using chef-zero, assuming the cookbooks play nicely with that
[2014-03-14 17:15:28 -0400] stormerider: ie, dont depend on search/databags/etc
[2014-03-14 17:15:44 -0400] dstynchula: xsaintish: I'd make a cookbook specific to the node in question
[2014-03-14 17:15:53 -0400] dstynchula: and apply it to the node directly
[2014-03-14 17:16:12 -0400] dstynchula: that way, segregation is insured.
[2014-03-14 17:16:13 -0400] dstynchula: :)
[2014-03-14 17:17:36 -0400] dgarstang3: I reeeealy wish I could attributes/default in json...
[2014-03-14 17:17:59 -0400] phutchins: Hey, how does this channel get logged to a web page?
[2014-03-14 17:18:14 -0400] phutchins: Guessing a bot but... what bot if it is?
[2014-03-14 17:19:08 -0400] xsaintish: zeroXten, stormerider, dstynchula: Thanks guys
[2014-03-14 17:19:25 -0400] dstynchula: de nada
[2014-03-14 17:20:43 -0400] dgarstang3: or, if there was a way to convert yaml to ruby assignment statements...
[2014-03-14 17:22:42 -0400] dgarstang3: putting a complex hash into ruby assignment statements is rather unmanageable.
[2014-03-14 17:28:11 -0400] chef493: hi
[2014-03-14 17:29:11 -0400] chef493: how to monitor the status of cpu usage using chef-cookbook?
[2014-03-14 17:30:13 -0400] anthroprose: the chef-client run, or using chef to report back CPU metrics?
[2014-03-14 17:32:43 -0400] chef493: i want to monitor cpu usage of the chef-client using recipe
[2014-03-14 17:33:03 -0400] chef493: how i can write in the recipe
[2014-03-14 17:33:29 -0400] chef493: which resource i can use?
[2014-03-14 17:34:31 -0400] isleshocky77: Does anyone have experience using knife ec2 plugin? It seems that when I create a new instance/node with it such as `knife ec2 server create -N node1 -r "role[webserver]"` it runs all of the recipes for that role; however, it doesn't save that as a role in the new node created. Any ideas about getting that to stick so I don't have to then update the node afterwards?
[2014-03-14 17:40:08 -0400] doomviking: never seen that happen
[2014-03-14 17:41:13 -0400] doomviking: what does your chef server know about the node?
[2014-03-14 17:41:22 -0400] doomviking: isleshocky77 ^
[2014-03-14 17:42:26 -0400] shlant: anyone have a suggestion on how to prevent installation of this package in a wrapper cookbook? https://github.com/opscode-cookbooks/memcached/blob/master/recipes/default.rb#L25
[2014-03-14 17:42:47 -0400] shlant: it's not needed on my server and I'm getting hash summismatch with custom repo
[2014-03-14 17:46:30 -0400] dgarstang3: Can I assign attributes in default.rb in blocks?
[2014-03-14 17:52:11 -0400] obazoud: hi, anybody knows where is the source code of Chef::Config[:knife].fetch(key, default_value) on github ?
[2014-03-14 17:52:35 -0400] nrhuff: I have an issue with the chef server API and was wondering if anyone can spot if I am doing something dumb.
[2014-03-14 17:53:44 -0400] nrhuff: When I run knife exec -E 'puts api.get("/environments")' I get back what I expect a hash of the environments
[2014-03-14 17:54:38 -0400] nrhuff: When I run knife exec -E 'puts api.get("/environments/dev")' where dev is one of the environments All I get back is the environment name.  No hash like I would expect.
[2014-03-14 17:59:11 -0400] kbarry: anyone using the mysql cookbook? I can't seem to get the password set
[2014-03-14 17:59:26 -0400] kbarry: (its generating a random one, which the document says happens if you don't define one)
[2014-03-14 17:59:42 -0400] kbarry: I have them defined in the role's attributes.
[2014-03-14 18:05:39 -0400] nrhuff: Nevermind apparently the problem is that the to_s method just returns the name and not the hash representation on the Chef::Environment class.
[2014-03-14 18:06:39 -0400] isleshocky77: doomviking: Thanks for the reply; sorry for the delayed response. What do you mean? It looks like the chef server knows everything about the node. It picks up the correct node name, at least.
[2014-03-14 18:07:32 -0400] doomviking: isleshocky77: so "knife node show $node_name" shows the expected run list and roles etc
[2014-03-14 18:07:38 -0400] doomviking: ?
[2014-03-14 18:08:11 -0400] isleshocky77: doomviking: Correct
[2014-03-14 18:09:06 -0400] wdilly: does eucalyptus provide a command line method for determinging how many more instances of a given instance type an availability zone supports.
[2014-03-14 18:09:11 -0400] isleshocky77: doomviking: It shows the correct roles and recipes after I add them, after creation. But doesn't have them after just creation through knife ec2
[2014-03-14 18:09:13 -0400] wdilly: oops wrong channel
[2014-03-14 18:09:56 -0400] doomviking: isleshocky77: so the bootstrapping isn't working on creation, sounds like. you just get a bare machine at the end of the knofe ec2 server create run
[2014-03-14 18:10:53 -0400] doomviking: isleshocky77: whats your full knife ec2 server create command
[2014-03-14 18:11:19 -0400] isleshocky77: doomviking: It does run the full recipe list that I've told it through -r
[2014-03-14 18:12:01 -0400] doomviking: isleshocky77: what are you expecting to happen? confused
[2014-03-14 18:12:51 -0400] isleshocky77: doomviking: One moment and I'll give you a pastebin of what I mean.
[2014-03-14 18:18:35 -0400] isleshocky77: doomviking: Nevermmind; I must have been messing around and had an error before completion in one of the earlier runs. Now it is behaving as expected; which is awesome cool.
[2014-03-14 18:18:36 -0400] isleshocky77: Thanks.
[2014-03-14 18:19:58 -0400] doomviking: rad
[2014-03-14 18:21:40 -0400] doomviking: knife-ec2 should JFW every time :)
[2014-03-14 18:22:29 -0400] mike999: anyone here have issues with knife status?  it just hangs for me and never returns.
[2014-03-14 18:23:18 -0400] doomviking: mine works
[2014-03-14 18:23:26 -0400] doomviking: FWIW
[2014-03-14 18:23:53 -0400] mike999: thats helpful, thanks :)
[2014-03-14 18:24:06 -0400] mike999: I wonder if it is just an issue with the number of clients we have
[2014-03-14 18:26:02 -0400] doomviking: yeah I have less than 100 here
[2014-03-14 18:26:46 -0400] mike999: everything else works fine and is very fast.  knife status kills my client  CPU and never returns
[2014-03-14 18:27:04 -0400] mike999: 2500 clients though.
[2014-03-14 18:29:30 -0400] pcort42: does anyone have experience using TFS and chef deploy?
[2014-03-14 18:30:43 -0400] dstynchula: knife status? What's that do?
[2014-03-14 18:31:08 -0400] doomviking: time since last chef-client run
[2014-03-14 18:31:54 -0400] mike999: we have a script that uses knife status to email us when chef clients have not checked in after a while.  I suppose I could just finish setting up the email handler
[2014-03-14 18:32:00 -0400] mike999: but I hate it when things dont work that should
[2014-03-14 18:33:56 -0400] stormerider: mike999: we have an email script like that as well... our "MIA" report
[2014-03-14 18:37:14 -0400] stormerider: but we have somewhere around 500 nodes registered. (many more to be bootstrapped....)
[2014-03-14 18:40:38 -0400] dstynchula: hmm
[2014-03-14 18:41:09 -0400] dstynchula: Does anyone know how I can search nodes based on a custom attribute with sub attributes?
[2014-03-14 18:41:54 -0400] stormerider: dstynchula: they get flattened with the _ symbol
[2014-03-14 18:42:32 -0400] stormerider: so node['XY']['ZA'] becomes "knife search node 'XY_ZA:blah'"
[2014-03-14 18:42:48 -0400] dstynchula: NICE!
[2014-03-14 18:42:52 -0400] dstynchula: trying now
[2014-03-14 18:42:53 -0400] stormerider: and it's case sensitive
[2014-03-14 18:43:13 -0400] stormerider: (i thought lucene wasnt, but ran into it the other day and found that it is)
[2014-03-14 18:43:38 -0400] dstynchula: that doesn't work for me. :(
[2014-03-14 18:43:50 -0400] dstynchula: http://tinypic.com/r/2yv2m0x/8
[2014-03-14 18:44:03 -0400] dstynchula: https://gist.github.com/dstynchula/9551914
[2014-03-14 18:46:31 -0400] dstynchula: any ideas how I'd access any of the values in unpartitioned?
[2014-03-14 18:57:27 -0400] dstynchula: coderanger, btm, jtimberman, kallistec: Do any of you have an idea as to how I can actually address this attribute?
[2014-03-14 18:57:34 -0400] dstynchula: https://gist.github.com/dstynchula/9551914
[2014-03-14 18:57:49 -0400] dstynchula: http://tinypic.com/r/2yv2m0x/8
[2014-03-14 19:00:03 -0400] anthroprose: dst: use some ruby
[2014-03-14 19:00:50 -0400] anthroprose: ohh you are trying to search, not address.... nm
[2014-03-14 19:02:41 -0400] dstynchula: basically, I have used ruby to populate the attribute to begin with.
[2014-03-14 19:02:52 -0400] anthroprose: if you can't figure out how to search it using the current namespacing, I would suggest using a helper lib or soemthing to create an index that *is* searchable
[2014-03-14 19:03:05 -0400] dstynchula: hmm
[2014-03-14 19:03:06 -0400] anthroprose: ah, yeah if you are creating it, then just work within chefserver's limitations
[2014-03-14 19:03:18 -0400] anthroprose: I hate to say that, but if you dont find any guidance got chefCo
[2014-03-14 19:03:21 -0400] anthroprose: thats what I would do
[2014-03-14 19:07:23 -0400] sbannon: I'm a noob to the Chef world.  What's the best practice on creating users?  Particularly storing the passwords to be set for admin users
[2014-03-14 19:08:07 -0400] anthroprose: dstynchula: also btw, when I tried using chefserver for a metadata store like that, coderanger et. all were wondering *WHY* I was sending so much postdata..... so if your not using hostedchef, I would pay attention to that as well
[2014-03-14 19:08:13 -0400] anthroprose: sbannon: encrypted databags
[2014-03-14 19:08:52 -0400] anthroprose: sbannon: http://docs.opscode.com/chef/essentials_data_bags.html & https://github.com/sethvargo-cookbooks/users
[2014-03-14 19:09:58 -0400] anthroprose: I personally leverage public ssh keys via the ssh_keys attr, via a system account instead of (n) users... but its up to your org
[2014-03-14 19:10:48 -0400] dstynchula: I"m using hosted chef.
[2014-03-14 19:10:57 -0400] shlant1: is there a minitest method for checking that a port is listening?
[2014-03-14 19:11:08 -0400] sbannon: I've been playing with them.  They work just fine.  How do you distribute the key files?  Part of your initial build process?
[2014-03-14 19:11:12 -0400] dstynchula: What I'm attempting to do is create a list of unpartitioned hard disks that have equal size.
[2014-03-14 19:11:15 -0400] werdnativ: Looking at the deploy resource, is it possible to get it to run "cap deploy" to bootstrap itself, but only on first run?
[2014-03-14 19:11:17 -0400] dstynchula: as an attribute in a chef node
[2014-03-14 19:11:32 -0400] a13x212: anyone using the user cookbook as a replacement for ldap/ad?
[2014-03-14 19:11:35 -0400] dstynchula: so that a chef server can identify nodes with a certain disk layout for RAID configs
[2014-03-14 19:11:48 -0400] dstynchula: a13x212: I do.
[2014-03-14 19:12:00 -0400] anthroprose: sbannon: I keep things in s3 buckets, and use s3_file + instance profiles to download them
[2014-03-14 19:12:23 -0400] dstynchula: encrypted data bag contains the user information, and the user cookbook populates /etc/passwd according to role.
[2014-03-14 19:12:50 -0400] anthroprose: dstynchula: service orchestration or ITIL/reporting?
[2014-03-14 19:13:14 -0400] a13x212: dstynchula, any gotchas that you have run into?
[2014-03-14 19:13:24 -0400] anthroprose: shlant: I use serverspec+busser for that
[2014-03-14 19:13:54 -0400] anthroprose: describe port(9200) do it { should be_listening } end
[2014-03-14 19:14:14 -0400] dstynchula: antro: service orchestration and admin
[2014-03-14 19:14:36 -0400] anthroprose: they always yell at me for trying to use chefserver as a fullfledged metadata service
[2014-03-14 19:14:37 -0400] anthroprose: heh
[2014-03-14 19:14:48 -0400] dstynchula: a13x212: Cavats I've encountered....
[2014-03-14 19:14:54 -0400] dstynchula: (e)ats...
[2014-03-14 19:14:56 -0400] shlant1: anthroprose: that look quite a bit more comprehensive than minitest maybe i should switch
[2014-03-14 19:14:59 -0400] sbannon: anthroprose: I'll look into that, thanks
[2014-03-14 19:15:06 -0400] anthroprose: I think best practices would argue for a report_handler that sends to an indexed store like elasticsearch
[2014-03-14 19:15:07 -0400] dstynchula: the glaring one is Tags are not instantaneous
[2014-03-14 19:15:13 -0400] Urocyon: Changes in yum 3.0 are breaking things for me.  :-(
[2014-03-14 19:15:22 -0400] dstynchula: so if you're using tags to manage which users are applied to which nodes,
[2014-03-14 19:15:23 -0400] anthroprose: Urocyon: pin your versions
[2014-03-14 19:15:38 -0400] dstynchula: then allow yourself time for the tags to populate
[2014-03-14 19:15:41 -0400] anthroprose: shlant1: https://github.com/paulczar/meez
[2014-03-14 19:15:42 -0400] dstynchula: or use roles instead.
[2014-03-14 19:15:49 -0400] Urocyon: I've got several recipes using yum::epel, and i've got new cookbooks that want yum 3.0.
[2014-03-14 19:16:07 -0400] anthroprose: so pin the 'new' cookbooks back a version
[2014-03-14 19:16:15 -0400] dstynchula: make sure your sudoers file in the users cookbook contains the account you want to use
[2014-03-14 19:16:20 -0400] Urocyon: and sometimes they include each other.  dependency hell.
[2014-03-14 19:16:30 -0400] anthroprose: yup ;)
[2014-03-14 19:16:31 -0400] Urocyon: sigh
[2014-03-14 19:16:33 -0400] dstynchula: you can overwrite your admin enabled user with the users cookbook and not have a working path to root.
[2014-03-14 19:16:43 -0400] anthroprose: Berkshelf as the quality gate before chefserver
[2014-03-14 19:16:48 -0400] anthroprose: and Environment version pins
[2014-03-14 19:16:58 -0400] dstynchula: provided you dont permit root logins of course.
[2014-03-14 19:17:00 -0400] spheromak: dstynchula: its just that tags/node data isn't pushed back to suerver till end of run or a forced node.save.  And when it is then you have to wait for indexing.
[2014-03-14 19:17:01 -0400] anthroprose: dystnchula: I do that with the sudo cookbook all the time
[2014-03-14 19:17:06 -0400] shlant1: anthroprose: does serverspec require test-kitchen?
[2014-03-14 19:17:08 -0400] spheromak: so in general chef-server is not a good state-database
[2014-03-14 19:17:16 -0400] anthroprose: shlant1: dont think so, its just all integrated
[2014-03-14 19:17:30 -0400] dstynchula: those are the two biggies I'd look out for.
[2014-03-14 19:17:32 -0400] anthroprose: I use it for a state machine <G>
[2014-03-14 19:17:35 -0400] dstynchula: everything else has worked like a charm.
[2014-03-14 19:17:36 -0400] spheromak: it reflects what was vs what is
[2014-03-14 19:18:27 -0400] dstynchula: so, nobody knows how to access attributes with sub attributes using knife search?
[2014-03-14 19:18:29 -0400] a13x212: dstynchula, great thanks, i thought about the root issue before, i'm thinking of moving in the direction of managing users via chef
[2014-03-14 19:18:38 -0400] dstynchula: that's how we do it.
[2014-03-14 19:18:47 -0400] dstynchula: provided a lot of user stuff doesn't change all the time
[2014-03-14 19:18:48 -0400] spheromak: if yer infra is small enough you can get away with node.saves all over the place to ensure state, but even then those have timing issues. As well as now your pushing that node object 6 times in a run  to your server ..
[2014-03-14 19:19:01 -0400] spheromak: dstynchula: what do you mean ?
[2014-03-14 19:19:10 -0400] dstynchula: as it would be a PITA to do a full chef run every time you want to add user.
[2014-03-14 19:19:24 -0400] dstynchula: Spheromak: http://tinypic.com/r/2yv2m0x/8
[2014-03-14 19:19:28 -0400] spheromak: a13x212: I've used custom library code to manage users, but plugging into existing LDAP
[2014-03-14 19:19:39 -0400] dstynchula: (screenshot from the Opscode management console)
[2014-03-14 19:19:50 -0400] spheromak: so that chef runs reflect the ldap, and create local users (removeing the login req from ldap).
[2014-03-14 19:20:06 -0400] a13x212: dstynchula, yea, this would be a handful of users
[2014-03-14 19:20:12 -0400] dstynchula: no worries.
[2014-03-14 19:20:13 -0400] spheromak: data bag based user management is ok at small scale, but it gets a bit wonk
[2014-03-14 19:20:35 -0400] dstynchula: I agree.
[2014-03-14 19:20:42 -0400] dstynchula: if you have a small team, like under 50 users
[2014-03-14 19:20:49 -0400] dstynchula: you're all set to use chef for this.
[2014-03-14 19:20:49 -0400] spheromak: dstynchula: what are you trying to do  ?
[2014-03-14 19:21:11 -0400] dstynchula: spheromak: I'm trying to use these attributes in a recipe
[2014-03-14 19:21:16 -0400] a13x212: spheromak, i have seen a similiar approach before, worked well
[2014-03-14 19:21:17 -0400] spheromak: ok
[2014-03-14 19:21:27 -0400] dstynchula: like unpartitioned[0][1][name] or something
[2014-03-14 19:21:42 -0400] spheromak: node[:unpartitioned[0][1][:name]
[2014-03-14 19:21:42 -0400] dstynchula: basically, I just need to know how I can search them using knife
[2014-03-14 19:21:53 -0400] dstynchula: and use the result in a recipe
[2014-03-14 19:22:04 -0400] spheromak: knife search 'unpartitioned_0_1_name:foo'
[2014-03-14 19:22:11 -0400] spheromak: *knife search node
[2014-03-14 19:22:25 -0400] spheromak: ah well search in recipe code then
[2014-03-14 19:22:47 -0400] spheromak:  search(:node, 'unpartitioned_0_1_name:foo')
[2014-03-14 19:23:10 -0400] spheromak: thats not tested, but should get you close to the mark )
[2014-03-14 19:23:11 -0400] spheromak: :)
[2014-03-14 19:23:18 -0400] spheromak: chef-shell is your friend for this stuff
[2014-03-14 19:25:09 -0400] dstynchula: trying it now
[2014-03-14 19:28:33 -0400] dstynchula: I'll need to do some work to get chef-shell working.
[2014-03-14 19:28:38 -0400] dstynchula: didn't know that even existed.
[2014-03-14 19:28:48 -0400] dstynchula: thank you for the point in this direction!
[2014-03-14 19:29:02 -0400] anthroprose: dystnchula: used to me schef or whatever
[2014-03-14 19:29:04 -0400] spheromak: yea just hit a node you have that talks to server
[2014-03-14 19:29:11 -0400] spheromak: shef
[2014-03-14 19:29:16 -0400] anthroprose: yup
[2014-03-14 19:29:34 -0400] spheromak: chef-shell -z  as root on a node that talks to your server will set you up for testing recipe/search
[2014-03-14 19:29:46 -0400] anthroprose: my dyslexia is going crazy today.... can't type worth shit and keep swapping words out.... maybe I should quit writing code too ;)
[2014-03-14 19:30:33 -0400] shlant1: anthroprose: I'm confused on how to implement serverspec. is there a cookbook? does it work like minitest and output test results at the end of runs?
[2014-03-14 19:30:41 -0400] shlant1: how to I make it do
[2014-03-14 19:32:28 -0400] anthroprose: shlant1: I'm digging around, I've always used it bundled
[2014-03-14 19:32:58 -0400] anthroprose: with all the deps involved, it may be that test-kitchen does *all* the driving
[2014-03-14 19:34:34 -0400] spheromak: shlant1: use test-kitchen  :)
[2014-03-14 19:35:10 -0400] spheromak: shlant1: its meant to be run from a host or workstation to test other servers.
[2014-03-14 19:35:26 -0400] shlant1: spheromak: ah. I think i'll stick with minitest for now then'
[2014-03-14 19:35:34 -0400] shlant1: berkshelf suites my needs
[2014-03-14 19:35:39 -0400] spheromak: test-kitchen supports it natively.  you could put serverspec in a recipe or handler for sure, but you would assert against localhost in that case
[2014-03-14 19:36:04 -0400] spheromak: berkshelf has nothing to do with test-kitchen  in that they server 2 different pourposes, and work together nicely
[2014-03-14 19:37:55 -0400] shlant1: spheromak: understood.
[2014-03-14 19:39:10 -0400] anthroprose: shlant1: it was vagrant-berkshelf being deprecated that made me do a full switch
[2014-03-14 19:39:18 -0400] anthroprose: "but but, I was using that...."
[2014-03-14 19:40:32 -0400] shlant1: anthroprose: it almost made me switch, but Seth kind of created unnecessary panic and some backlash with that post
[2014-03-14 19:40:52 -0400] shlant1: they are "starting" the deprecation "process"
[2014-03-14 19:42:14 -0400] shlant1: anthroprose: "We aren't cold-quitting vagrant-berkshelf. We are going to continue to support the tool, get it compatible with Berkshelf 3, etc. After that, it will likely go into "maintenance mode". In this phase, we will apply security upgrades and critical bug fixes, but no new features will be added."
[2014-03-14 19:42:42 -0400] shlant1: test-kitchen is too heavy for little gain for me atm
[2014-03-14 19:43:48 -0400] spheromak: ?
[2014-03-14 19:44:19 -0400] spheromak: dunno I think it break a boatload for not much effort, but I've been using it since fletcher did jamie.
[2014-03-14 19:45:56 -0400] sbannon: anthroprose: Just wrapping my head around this.  The s3_file instruction will grab the file and I'm assuming you remove it when finished with it.  Since the role's keys are in the recipe and the chef-client is running as root, everything is pretty much secured on the node unless someone gains root access on said node. I mean, without root access you aren't getting at those keys so it's secure.  Does that sound close?
[2014-03-14 19:46:53 -0400] anthroprose: sbannon: s3_file does not remove from s3, unless you tell it I guess
[2014-03-14 19:47:33 -0400] anthroprose: what are you trying to do exactly?
[2014-03-14 19:47:42 -0400] anthroprose: I only put pubkeys into node attrs
[2014-03-14 19:48:23 -0400] anthroprose: and anything I need a .pem for (like the chef-validator) gets stored in s3
[2014-03-14 19:48:34 -0400] anthroprose: which chef-client running as root, has full perms for yes
[2014-03-14 19:50:07 -0400] anthroprose: shlant1: yeah, but there was a long while when dependencies were broken all to hell and priorities were not on fixing the tool, so I just bailed
[2014-03-14 19:50:48 -0400] sbannon: anthroprose: It looked like s3_file needed the access key and secret access key which would pull down the file into the defined location (/tmp most likely).  The file is then used to get to the encrypted data bag and once you are done, the key file is removed.
[2014-03-14 19:51:13 -0400] anthroprose: sbannon: so I use instance profiles (as I am all aws)
[2014-03-14 19:51:22 -0400] anthroprose: so they magically get pulled from the metadata service
[2014-03-14 19:51:28 -0400] coderanger: sbannon: You might want to check out the citadel cookbook
[2014-03-14 19:53:17 -0400] anthroprose: coderanger: how is this diff than s3_file, except implementation?
[2014-03-14 19:53:23 -0400] werdnativ: I'm thinking of a way to get separate db credentials for each environment, but data bags (using chef-vault) are global. What's the best way?
[2014-03-14 19:53:47 -0400] werdnativ: I'm thinking use the environment name as the data bag name?
[2014-03-14 19:53:50 -0400] coderanger: anthroprose: Just a cleaner way to get the data, and you can skip the encrypted bags entirely
[2014-03-14 19:53:55 -0400] sbannon: We're managing clients (laptops and workstations) as well as physical servers as well as some cloud stuff.  We're pretty new to AWS, but I think I see what you are saying for your environment.
[2014-03-14 19:54:20 -0400] anthroprose: coderanger: ahhh, I see, because you are leveraging your AWS Auth in liue of encrypting the file?
[2014-03-14 19:54:44 -0400] coderanger: anthroprose: yeah, the extra encryption gets you little in the way of extra security
[2014-03-14 19:54:58 -0400] anthroprose: rotfl, try telling that to half of the tech guys
[2014-03-14 19:55:10 -0400] coderanger: anthroprose: Happily, tell them to show up here
[2014-03-14 19:55:20 -0400] anthroprose: I'll send a steady stream ;)
[2014-03-14 19:55:57 -0400] coderanger: anthroprose: I will eviscerate anyone that turns their brain off upon seeing "encrypted" in a name
[2014-03-14 19:56:07 -0400] anthroprose: coderanger: so you just re-writing everything in best-practice mode for balance??
[2014-03-14 19:56:41 -0400] coderanger: anthroprose: Pretty much, if you consider my opinions to be best practices at least
[2014-03-14 19:56:50 -0400] sbannon: Putting the AWS keys into node attributes secures them to the chef-server and the running client session.
[2014-03-14 19:56:50 -0400] coderanger: (I do, but I don't expects others to without proof :)
[2014-03-14 19:56:57 -0400] anthroprose: yeah well, most of us look to what you prodice anyways ;)
[2014-03-14 19:57:22 -0400] coderanger: sbannon: Never, under any circumstance, put something secure in node attributes
[2014-03-14 19:57:39 -0400] coderanger: sbannon: Remember that all nodes can see each others' attributes
[2014-03-14 19:58:04 -0400] anthroprose: yeah, I'm not currently, but my last setup *WAS* multi-tenant
[2014-03-14 19:58:30 -0400] anthroprose: but when your web nodes can see the mysqlDB password... whats the point eh?
[2014-03-14 19:59:47 -0400] coderanger: anthroprose: If you use iam instance profiles or roles you should actually be aware of that, ohai stores the role creds in your node attributes by default
[2014-03-14 20:00:11 -0400] coderanger: anthroprose: Meaning that unless you use the citadel cookbook (which masks them) it is an escalation vector
[2014-03-14 20:00:30 -0400] anthroprose: ah, yeah I turned off most of ohai when I was trying to run my own chef server
[2014-03-14 20:00:50 -0400] anthroprose: I still have an open ticket on that.... I can kill a fresh install of chef server 11.x repeatedly
[2014-03-14 20:00:57 -0400] anthroprose: hostedchef works just fine
[2014-03-14 20:07:22 -0400] mike999: when using cron, is there a way to stagger my chef-client times?  I have 2400 servers trying to chef-client at the same time
[2014-03-14 20:07:57 -0400] spheromak: mike999: splay if your running from daemon
[2014-03-14 20:08:11 -0400] coderanger: mike999: sleep $(($RANDOM / something)) && chef-client
[2014-03-14 20:08:21 -0400] coderanger: mike999: The chef-client::cron recipe does this for you I think
[2014-03-14 20:08:29 -0400] spheromak: otherwise ^^ but be warned
[2014-03-14 20:08:33 -0400] spheromak: you might want to use flock
[2014-03-14 20:08:57 -0400] mike999: @coderanger: it does have sleeps but they are not random at all.  they are all in the same general range of ~200 seconds
[2014-03-14 20:09:12 -0400] spheromak: or --once
[2014-03-14 20:09:20 -0400] spheromak: I think --once actually gets the right behavior
[2014-03-14 20:09:40 -0400] coderanger: mike999: https://github.com/opscode-cookbooks/chef-client/blob/master/recipes/cron.rb#L71-L74
[2014-03-14 20:09:53 -0400] spheromak: have to test that.
[2014-03-14 20:10:11 -0400] spheromak: coderanger: you know if --once will bail if the client-lock exists
[2014-03-14 20:10:22 -0400] coderanger: spheromak: No idea
[2014-03-14 20:11:00 -0400] spheromak: i did this: https://github.com/spheromak/chef-client/blob/cron_flock/recipes/cron.rb
[2014-03-14 20:11:14 -0400] spheromak: to prevent clients from stakcing if the run was taking forever
[2014-03-14 20:11:32 -0400] spheromak: https://github.com/spheromak/chef-client/blob/cron_flock/recipes/cron.rb#L80-L88
[2014-03-14 20:11:56 -0400] spheromak: but i didn't test if --once does what it should. I was suprised that chef-client doesn't bail if the client lock exists.
[2014-03-14 20:12:35 -0400] sbannon: On the workstations we are managing we need to get 2 local admin accounts.  One for us "just in case" and one for central IT to scan with (don't ask).  I want to secure that local admin password so I'm not just leaving the keys to the kingdom laying outside the gate.  Is it correct to assume that someone would have to gain root to see anything that the node would.  I mean, if you breach root there's not a whole lot that can be done
[2014-03-14 20:12:36 -0400] sbannon: to secure the info, right?
[2014-03-14 20:13:17 -0400] coderanger: sbannon: If the client key file is root:root:600 (it should be) then yes
[2014-03-14 20:13:30 -0400] coderanger: the client.pem file is what gates access to the Chef API
[2014-03-14 20:13:34 -0400] spheromak: coderanger: fyi --once waits for the lock, so yea the flock stuff is needed to prevent a slow chef or hung chef-run from making your cron runs stack and consume all your box.
[2014-03-14 20:13:49 -0400] coderanger: sbannon: If you are talking about AWS IAM stuff, thats different
[2014-03-14 20:18:14 -0400] sbannon: coderanger: I'm talking about the local filesystem on physical machines. I have to do some testing, but I think I'm on the right track.
[2014-03-14 20:18:54 -0400] sbannon: I appreciate the help.  You'll probably be seeing me around.
[2014-03-14 20:19:05 -0400] coderanger: Good luck :)
[2014-03-14 20:29:11 -0400] anthroprose: coderanger: know of any better way of doing a multi-project vagrant setup using chef-zero other than running chef-zero with rake and then doing something like this in my Vagrantfiles? CHEF_SERVER_IP = %x[ifconfig #{ETHERNET_DEVICE} | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'].strip
[2014-03-14 20:29:25 -0400] anthroprose: I'm doing really stupid stuff to be lazy...
[2014-03-14 20:29:36 -0400] coderanger: anthroprose: I've not used chef-zero for testing
[2014-03-14 20:30:52 -0400] anthroprose: im using it for product demos
[2014-03-14 20:31:18 -0400] anthroprose: and im spinning up multiple different product clusters using the same chef-zero
[2014-03-14 20:35:51 -0400] coderanger: anthroprose: I make such little use of chef-server's features that I don't need it outside of production :-)
[2014-03-14 20:39:26 -0400] anthroprose: ah, I'm doing cluster/Service orchestration using multiple runs & a tiny state machine
[2014-03-14 20:39:46 -0400] anthroprose: pubkey swapping for ssh/file transfers, etc...
[2014-03-14 20:39:56 -0400] anthroprose: I could use cloud storage, but its just sooo tiny
[2014-03-14 20:39:58 -0400] coderanger: anthroprose: Chef is really bad for state management >_<
[2014-03-14 20:40:13 -0400] coderanger: anthroprose: I sometimes use it too because its just easy, but its not a good tool for the job
[2014-03-14 20:40:28 -0400] coderanger: (compared to zk or etcd which are actual distributed state managers)
[2014-03-14 20:40:33 -0400] anthroprose: ohh I know
[2014-03-14 20:41:07 -0400] anthroprose: someday I will graduate, but havn't had the need for extra complexity
[2014-03-14 20:41:12 -0400] anthroprose: at least with zk
[2014-03-14 20:41:38 -0400] coderanger: anthroprose: Its on my list to make Easy :-)
[2014-03-14 20:41:49 -0400] coderanger: anthroprose: I did a 4 hour spike with etcd-chef as an example
[2014-03-14 20:41:59 -0400] anthroprose: I'd thrown down on that....
[2014-03-14 20:42:16 -0400] anthroprose: I've been running rabbitmq/elasticsearch/etc../etc... clusters using this method for a while
[2014-03-14 20:42:21 -0400] coderanger: just exposed an etcd object that worked more or less like the node object
[2014-03-14 20:42:56 -0400] anthroprose: [2014-03-14T20:40:38+00:00] INFO: Searching through Node: mysql-master - Cluster: Development
[2014-03-14 20:43:00 -0400] anthroprose: lots of crap like that ;)
[2014-03-14 20:43:47 -0400] anthroprose: coderanger: have any code commits on etcd-chef?
[2014-03-14 20:43:56 -0400] coderanger: anthroprose: Yeah, its up on my github
[2014-03-14 20:44:12 -0400] coderanger: be warned the code is terribad and might not be compatible with latest etcd anymore :)
[2014-03-14 20:44:49 -0400] anthroprose: story of my life, no worries
[2014-03-14 20:46:22 -0400] anthroprose: looks reasonable
[2014-03-14 20:46:25 -0400] coderanger: anthroprose: The overall model is probably solid though
[2014-03-14 20:46:31 -0400] coderanger: it does require some weird thinking
[2014-03-14 20:46:45 -0400] coderanger: since your chef-ing is split in half between config-linked and state-linked
[2014-03-14 20:47:05 -0400] coderanger: anthroprose: Also check out kelsey hightower's configd
[2014-03-14 20:47:19 -0400] coderanger: it is limited to config files, but otherwise similar
[2014-03-14 21:06:00 -0400] notromda: There's a bug in ubuntu precise's version of monit an init script error.   Should I just attempt to overlay a correct init script with chef, or should I find some way to install a newer package?    Ubuntu has a fix released, but apparently it won't ship with precise.
[2014-03-14 21:06:28 -0400] coderanger: notromda: Writing out a new init script seems fine
[2014-03-14 21:08:31 -0400] notromda: I guess I can use platform_version to make it stay with this version
[2014-03-14 21:14:22 -0400] spheromak: coderanger: re: load order (ml)   you saying that include_attribute doesn't inform the load order at all ?
[2014-03-14 21:14:39 -0400] spheromak: my point is simply be as explicit as possible about what you are loading and overriding.
[2014-03-14 21:14:58 -0400] spheromak: this method for me and our stuff has worked quite well for avoiding suprise
[2014-03-14 21:15:01 -0400] coderanger: spheromak: It does, but usually isn't needed, anything you puts as a dependency in metadata.rb will always be loaded first
[2014-03-14 21:15:08 -0400] coderanger: spheromak: This was changed between chef 10 and 11
[2014-03-14 21:15:09 -0400] spheromak: sure sure
[2014-03-14 21:15:19 -0400] spheromak: right i am probably carying some chef10 baggage here.
[2014-03-14 21:15:30 -0400] spheromak: I also like that we call out these deps explicitly in attribs tho
[2014-03-14 21:15:33 -0400] coderanger: spheromak: You only need load_order when you have multiple attribute files in a single cookbook and need to assert non-alpha order
[2014-03-14 21:15:40 -0400] spheromak: it makes it obvious when reading where / what you are overwriting
[2014-03-14 21:15:53 -0400] coderanger: spheromak: Eh, I disgree, DRY is good for dep graphs :)
[2014-03-14 21:15:59 -0400] spheromak: right I am also a fan of breaking up attrib files
[2014-03-14 21:16:21 -0400] spheromak: well its not about code correct here its about maintainability for people who haven't looked at this shit before
[2014-03-14 21:16:22 -0400] coderanger: spheromak: Heh, I also dislike that :)
[2014-03-14 21:16:38 -0400] coderanger: spheromak: (multiple attr files)
[2014-03-14 21:16:44 -0400] spheromak: yea i understood
[2014-03-14 21:16:57 -0400] coderanger: I'll do it really rarely, it is usually a good sign you should have two cookbooks though
[2014-03-14 21:17:13 -0400] spheromak: I am for more shit in resources. I am for poise aproach fundamentally. I agree with you on those points.
[2014-03-14 21:17:54 -0400] spheromak: I just wanted to make sure cause it seems like you implied that include_attribute was non functional
[2014-03-14 21:18:45 -0400] coderanger: Heh, it still functions, just generally not needed and is a literal no-op
[2014-03-14 21:18:53 -0400] coderanger: (since like include_recipe it won't run a file twice)
[2014-03-14 21:20:59 -0400] coderanger: People often assume you can use it from recipe code or whatnot to force re-execution of attributes
[2014-03-14 21:21:01 -0400] coderanger: which won't work
[2014-03-14 21:21:06 -0400] coderanger: so I tend to just skip it when teaching
[2014-03-14 21:22:13 -0400] spheromak: right
[2014-03-14 21:22:20 -0400] spheromak: I replied on ML too
[2014-03-14 21:22:32 -0400] spheromak: I just wanted to make sure I wasn't operating on some serious false thinking.
[2014-03-14 21:22:37 -0400] spheromak: I know i read the loader code
[2014-03-14 21:22:40 -0400] spheromak: more than once :)
[2014-03-14 21:23:31 -0400] coderanger: spheromak: I wouldn't call the dependency-driven ordering implicit, it is just explicit in another file :-)
[2014-03-14 21:23:38 -0400] spheromak: I get the thing where people assume its a re-eval. I udnerstand its more of a hint
[2014-03-14 21:23:48 -0400] spheromak: well
[2014-03-14 21:23:51 -0400] coderanger: spheromak: But I can see people that don't read everything before making changes seeing it as implicit
[2014-03-14 21:23:57 -0400] spheromak: I also use some shit with lots of attribs
[2014-03-14 21:24:03 -0400] spheromak: I think thats where this habbit formed for me
[2014-03-14 21:24:44 -0400] spheromak: I grok what your saying, I agree with the point, but I do have some edges that it wont cover.
[2014-03-14 21:24:59 -0400] spheromak: coderanger: i rarely see our people looking @ metadata ;)
[2014-03-14 21:28:04 -0400] coderanger: spheromak: Yeah, you live in reality, I live in magical space castle of just me :)
[2014-03-14 21:29:37 -0400] spheromak: that space castle can be awesome
[2014-03-14 21:48:02 -0400] daxroc: Evening all
[2014-03-14 21:53:16 -0400] daxroc: I'm setting the hostname in a chef_solo run accessing node[:fqdn] after i've set hasn't been updated. Should I change the phase in which the hostname is set or should reloading ohai be sufficient, I am calling ohai reload after changing the files related to hostname.
[2014-03-14 21:55:47 -0400] coderanger: kallistec: You around?
[2014-03-14 21:55:59 -0400] kallistec: in a meeting
[2014-03-14 21:56:06 -0400] coderanger: and/or does anyone know the correct new syntax for multiple version depends from a cookbook?
[2014-03-14 21:56:20 -0400] coderanger: The error message references http://wiki.opscode.com/display/chef/Metadata which is a redirect to the (unhelpful) new docs
[2014-03-14 22:39:32 -0400] joe____: hi :) does anybody experience and how to fixed this error [2014-03-14T20:19:01+00:00] FATAL: NoMethodError: undefined method `run_list' for nil:NilClass
[2014-03-14 22:39:55 -0400] joe____: on chef-client
[2014-03-14 22:40:02 -0400] joe____: on chef-client for windows
[2014-03-14 22:40:29 -0400] joe____: on chef-client for windows 10.16.2
[2014-03-14 22:41:00 -0400] joe____: the node use to run fine
[2014-03-14 22:42:26 -0400] joe____: does anybody experience and how to fixed this error [2014-03-14T20:19:01+00:00] FATAL: NoMethodError: undefined method `run_list' for nil:NilClass, on chef-client for windows 10.16.2 the node use to run fine and suddenly its giving this error.
[2014-03-14 22:53:18 -0400] dstynchula: Yo: anyone used become_node in chef-shell?
[2014-03-14 22:54:09 -0400] dstynchula: I keep getting NameError: uninitialized constant Chef::Node::
[2014-03-14 22:56:46 -0400] dgarstang3: chef environments... is there any way to put that info in the cookbook?
[2014-03-14 23:00:13 -0400] gkra: What's the best way to add array values to an attribute if you're not sure if the attribute exists or not?
[2014-03-14 23:04:41 -0400] dstynchula: gkra: "knife node show <nodename> -a -l" should give you a list of attributes for a given node
[2014-03-14 23:07:07 -0400] dgarstang3: chef environments... is there any way to put that info in the cookbook?
[2014-03-14 23:08:17 -0400] dgarstang3: i don't understand this. cookbooks are supposed to be a unit of software, and yet environment data is put somewhere external. it doesn't add up to me.
[2014-03-14 23:09:00 -0400] jbz: dgarstang:  environment data is config data that overrides the data in the cookbooks . Why doesn't it make sense?
[2014-03-14 23:09:25 -0400] jbz: Cookbooks should perform a function.  It makes sense (to me) that the results of that function might differ in different environments.
[2014-03-14 23:12:39 -0400] dgarstang3: jbz: Well the use cases all involve overriding data for a specific cookbook. I can't understand why it wouldn't go in that cookbook
[2014-03-14 23:13:03 -0400] jbz: dgarstang3: because you might have a set of config data which is common to a node but used by multiple cookbooks.
[2014-03-14 23:13:10 -0400] jbz: You wouldn't want to put that data in the cookbook.
[2014-03-14 23:13:35 -0400] dgarstang3: jbz: why not? why wouldn't the apache cookbook have all the environments defined internally?
[2014-03-14 23:13:39 -0400] jbz: uh
[2014-03-14 23:13:56 -0400] jbz: because, for example, you have web servers that behave differently depending on if they're production or dev webservers.
[2014-03-14 23:14:09 -0400] jbz: Let's say they have different apache configs, different firewall rules, different user bases.
[2014-03-14 23:14:18 -0400] dgarstang3: jbz: yes, and the environments that set the different attributes are defined within the cookbook
[2014-03-14 23:14:35 -0400] jbz: let's say there are six cookbooks that control all that stuff.
[2014-03-14 23:14:42 -0400] jbz: Also: No.
[2014-03-14 23:14:54 -0400] jbz: The environment is a charactieristic of the *node*, not the cookbook logic.
[2014-03-14 23:14:56 -0400] jbz: That's the point.
[2014-03-14 23:15:04 -0400] jbz: Cookbooks should be node-independent.
[2014-03-14 23:15:04 -0400] dgarstang3: jbz: how can a cookbook be a unit of software when some of it's confg is in a different git repo?
[2014-03-14 23:15:27 -0400] jbz: I don't know where you're getting the 'unit of software' thing, but it has the air of a furiously held piece of dogma that's at odds with what chef is doing.
[2014-03-14 23:15:41 -0400] Urocyon: dgarstang3 are you thinking of putting logic in the cookbook like "if I'm running in x environment do y; if I'm running in A envronment do B"
[2014-03-14 23:15:43 -0400] Urocyon: ?
[2014-03-14 23:15:48 -0400] dgarstang3: jbz: i thought that's what chef was trying to espouse.
[2014-03-14 23:15:56 -0400] dgarstang3: Urocyon: No.
[2014-03-14 23:15:56 -0400] jbz: Chef is a tool.
[2014-03-14 23:16:23 -0400] jbz: The only reason an environment is in a repo is for convenience.  The 'live' version of a environment, the canonical version, is on the chef server.
[2014-03-14 23:16:31 -0400] jbz: There, it is applied to nodes or sets of nodes.
[2014-03-14 23:16:39 -0400] jbz: The most important piece of info about the environment is *which nodes are in it*
[2014-03-14 23:16:44 -0400] dgarstang3: jbz: if it's in the cookbook, it's clear. if you have to go to a separate git repo to find the data, you have to know what piece of data is relevant, hope someone namespaced it correctly.
[2014-03-14 23:16:59 -0400] jbz: and when you write the cookbook, you may have no idea (as yet) what the nodes you will run this on look like or how they're organized.
[2014-03-14 23:17:08 -0400] dgarstang3: jbz: of course.
[2014-03-14 23:17:24 -0400] dgarstang3: all i'm asking is why the environments are stored along with the cookbook
[2014-03-14 23:17:27 -0400] jbz: dgarstang3: environments should not be used to provide data that is not available in default form in the cookbook.  They should be used to intelligently *override* the default values in the cookbook to better suit that node's needs.
[2014-03-14 23:17:28 -0400] dgarstang3: aren't
[2014-03-14 23:17:51 -0400] jbz: Because the people administering the environment may not be the people writing the cookbook.
[2014-03-14 23:17:52 -0400] dgarstang3: jbz: Well, I think defaults are bad in any case.
[2014-03-14 23:17:54 -0400] jbz: That's the whole point.
[2014-03-14 23:18:28 -0400] jbz: If you're using community cookbooks, why woudl those cookbook know what your environment looks like?
[2014-03-14 23:18:54 -0400] jbz: In your model, the cookbook writer is always the cookbook user.  Makes no sense.
[2014-03-14 23:18:57 -0400] dgarstang3: so, a use case here is developers. They want to be able to set values for their test environment. If they edit the data in the test environment solely within the cookbook it's easy and clear. If they have to go edit an arbitrary location in another git repo it's not clear and they are going to make mistakes and/or complain about it and get confused.
[2014-03-14 23:19:22 -0400] jbz: You are assuming that the developers configuring the test environment are the same developers who write and/or maintain the cookbooks.
[2014-03-14 23:19:27 -0400] jbz: Not true in many if not most cases.
[2014-03-14 23:19:30 -0400] dgarstang3: jbz: it would be nice
[2014-03-14 23:20:03 -0400] jbz: In my use cases, we use community cookbooks and berkshelf.  As a result, it's our goal to never touch code inside those cookbooks, because if we do, we have to fork and maintain them.
[2014-03-14 23:20:26 -0400] Urocyon: one of the uses to which I put environments probably the main use, is to pin a cookbook version, so when I release a new version of the cookbook, it doesn't bring down my production environment.
[2014-03-14 23:20:27 -0400] dgarstang3: jbz: editing an environment in the cookbook would not be touching code per se
[2014-03-14 23:20:28 -0400] jbz: Using environments lets us control the final config/behavior of the nodes without having to touch code inside the cookbooks.
[2014-03-14 23:20:41 -0400] Urocyon: I'm not sure how you would put that in the cookbook.
[2014-03-14 23:20:50 -0400] jbz: dgarstang3: but it would require you to have that cookbook in *your* version control, where *you* would be responsble for maintaining it.
[2014-03-14 23:20:55 -0400] jbz: Which is exactly what I'm trying to avoid.
[2014-03-14 23:21:09 -0400] dgarstang3: Urocyon: you actually can set it in the cookbook, but it becomes global... :(
[2014-03-14 23:21:20 -0400] dgarstang3: jbz: yes, and?
[2014-03-14 23:21:39 -0400] dgarstang3: jbz: I'm talking about wrapper cookbooks which we maintain
[2014-03-14 23:22:45 -0400] Urocyon: I did try something like this once though, putting case statements in my wrapper cookbook, to change configuration based on their environment.
[2014-03-14 23:22:49 -0400] dgarstang3: The use of roles is discouraged. I would imagine environments suffer the same issues
[2014-03-14 23:23:00 -0400] dgarstang3: Urocyon: I am not talking about case statements
[2014-03-14 23:23:55 -0400] Urocyon: I'm don't think I understand what you mean by putting your environment information with your cookbook.
[2014-03-14 23:24:29 -0400] dgarstang3: Urocyon: create an environments/ directory in the cookbook. put environments in there. have it apply only to that cookbook. use recipe as normal
[2014-03-14 23:24:33 -0400] jbz: Yeah.
[2014-03-14 23:24:55 -0400] dgarstang3: i also find it confuing that in most cases roles override environments
[2014-03-14 23:24:58 -0400] Urocyon: so, each cookbook would have it's own collection of envrionments?
[2014-03-14 23:25:07 -0400] dgarstang3: Urocyon: bingo
[2014-03-14 23:25:22 -0400] Urocyon: and if I want to add an environment, I update all my cookbooks?
[2014-03-14 23:25:24 -0400] dgarstang3: Urocyon: Then Joe Bob developer only has to touch one repo
[2014-03-14 23:25:45 -0400] dgarstang3: Urocyon: Dunno. it's moot anyway
[2014-03-14 23:25:59 -0400] Urocyon: Because?
[2014-03-14 23:26:25 -0400] dgarstang3: a HUGE issue here is that developers do their thing, hand it over to us and then there's no way to get their config data easily into chef
[2014-03-14 23:26:52 -0400] Urocyon: yeah, I feel you there.
[2014-03-14 23:27:22 -0400] dgarstang3: If they used chef from the beginning, or ops was involved in the creation of the cookbook with their config data in mind, it could be a chef recipe all the way from test to prod
[2014-03-14 23:28:40 -0400] Urocyon: My devs aren't overeager to learn chef.
[2014-03-14 23:28:43 -0400] dgarstang3: it just doesn't make sense for me to go add env data for an app into an arbitrary location in a hash in another git repo. How is a developer supposed to know what to edit?
[2014-03-14 23:29:13 -0400] Urocyon: why would a developer be the one to tune operational settings?
[2014-03-14 23:29:22 -0400] dgarstang3: Urocyon: it's software config.
[2014-03-14 23:30:02 -0400] dgarstang3: Urocyon: specifically a python webapp
[2014-03-14 23:30:07 -0400] dgarstang3: or collection of them rather
[2014-03-14 23:30:15 -0400] Urocyon: Mine aren't particularly aware say, of the hardware on which their code runs.  This may set memory setting to more than we have available, run more threads than a system can handle, in general break stuff.
[2014-03-14 23:31:02 -0400] dgarstang3: Urocyon: code review by ops :)
[2014-03-14 23:31:32 -0400] dgarstang3: i think that's an easy problem to solve. Easier than trying to munge the data from 'engineering format' to 'chef format'
[2014-03-14 23:31:43 -0400] Urocyon: I'd prefer they give me some sane defaults and provide knobs in the way of variables that I can override to tune an app for the environment in which I'm going to run it.
[2014-03-14 23:32:34 -0400] dgarstang3: Urocyon: Well they gotta tunes those knobs in their environment too
[2014-03-14 23:33:02 -0400] Urocyon: and they can.
[2014-03-14 23:33:36 -0400] Urocyon: but what's right for the dev system or for the desktop is likely not the same as what I'll need on a production server.
[2014-03-14 23:34:28 -0400] dgarstang3: Urocyon: The values may be different, but the deployment and the framework should be the same.
[2014-03-14 23:35:01 -0400] dgarstang3: this is really frustrating. Puppet's PITA was resource ordering. Chef's PITA is attribute management.
[2014-03-14 23:35:03 -0400] Urocyon: yep
[2014-03-14 23:35:50 -0400] Urocyon: that's all I change in an environment though, the value of an attribute.
[2014-03-14 23:36:14 -0400] Urocyon: deployment and framework doesn't change.
[2014-03-14 23:37:16 -0400] dgarstang3: 7 layers of attribute precedence. my head hurts
[2014-03-14 23:37:37 -0400] dgarstang3: no, sorry 15 layers
[2014-03-14 23:40:32 -0400] Urocyon: dgarstang3: well, I do agree that can get confusing
[2014-03-14 23:41:13 -0400] Urocyon: dgarstang3: You could just not use any of the others, I suppose, limit your headaches by only making changes at the recipe level or somehting.
[2014-03-14 23:41:40 -0400] Urocyon: You don't have to use variables in environments and maybe it would make more sense in your case to not.
[2014-03-14 23:42:21 -0400] Urocyon: dgarstang3 you don't need to use chef server even.  That alone is a lot of extra head hurting.
[2014-03-14 23:44:36 -0400] Urocyon: dgarstang3 you could try making a lookup library that looks in an environments directory in your cookbook to set your attributes.
[2014-03-14 23:45:41 -0400] Urocyon: dgarstang3 that might be a pretty way to do what you want.
[2014-03-14 23:46:01 -0400] Urocyon: dgarstang3 could make for an interesting talk at the next summit too.
[2014-03-14 23:48:43 -0400] Urocyon: dgarstang3 one of the things I would miss about this though is when I have an attribute I want to use in a dozen different cookbooks.  I wouldn't want to have to update it in every cookbook's own environment.
[2014-03-14 23:52:07 -0400] Urocyon: too much splitty action.
