[2014-03-18 00:00:44 -0400] coderanger: josephholsten: Except for percona's lock-free ALTERs, it isn't escapable in SQLland
[2014-03-18 00:01:15 -0400] coderanger: josephholsten: Under no circumstances should Chef do a thing that takes out a table lock
[2014-03-18 00:01:24 -0400] coderanger: josephholsten: Just requires too much coordination
[2014-03-18 00:01:45 -0400] josephholsten: oh right. I've been out of dba land for too long (not long enough?)
[2014-03-18 00:01:50 -0400] coderanger: josephholsten: Heroku got this right, binary transport and convergent steps like asset gen can go in chef
[2014-03-18 00:01:54 -0400] coderanger: but rest can't
[2014-03-18 00:06:57 -0400] josephholsten: if you were building a tool for push-button provisioning, what params would you need? chef role/runlist, chef env, datacenter, instance flavor, image, load-balancer pool (optional)
[2014-03-18 00:07:01 -0400] josephholsten: anything else?
[2014-03-18 00:07:39 -0400] coderanger: josephholsten: public vs. private IP
[2014-03-18 00:08:01 -0400] coderanger: josephholsten: and possibly info for the secrets mgmt layer
[2014-03-18 00:08:27 -0400] josephholsten: oh secrets, that's been dogging me for both our provisioning and deployment
[2014-03-18 00:10:21 -0400] coderanger: josephholsten: Its real fun, I need to write those slides soon >_<
[2014-03-18 00:10:42 -0400] josephholsten: btw, thanks for doing a talk on poise at chefconf
[2014-03-18 00:10:45 -0400] coderanger: josephholsten: If you want to make a lot of money though, go solve secrets mgmt, its basically unserved right now
[2014-03-18 00:10:55 -0400] resno: id like to go self hosted chef using ec2. does chef-client have hooks for before and after a run to start an ec2 instance?
[2014-03-18 00:11:20 -0400] coderanger: resno: Not sure what that means
[2014-03-18 00:11:29 -0400] josephholsten: I'm going one on refactoring to defns & resources, and it's nice to say "and just watch the poise talk for advanced usage"
[2014-03-18 00:11:50 -0400] coderanger: josephholsten: I haven't even started on that talk yet >_<
[2014-03-18 00:12:17 -0400] resno: coderanger: so the idea is, have an instance thats only active when doing work and turned off the other time
[2014-03-18 00:12:39 -0400] coderanger: resno: Yes, but how would chef-client manage that from on a stopped machine :)
[2014-03-18 00:14:19 -0400] resno: right, im just curious if theres any feasible way get a call off to amazon to boot the instance
[2014-03-18 00:14:54 -0400] resno: i was thinking about writing a wrapper for the chef-client to do it
[2014-03-18 00:14:59 -0400] coderanger: resno: What would be triggering it?
[2014-03-18 00:15:21 -0400] coderanger: resno: Chef isn't a provisioning system, chances are you should just be changing the capacity level on an autoscaling group
[2014-03-18 00:29:21 -0400] resno: i find it weird to keep a chef server running all the time. so im interested in turning it off when im not actively using it
[2014-03-18 00:29:29 -0400] resno: at least for my use case
[2014-03-18 00:30:01 -0400] coderanger: resno: Okay, thats the part I was missing, no there is no way to do that nor would it work well
[2014-03-18 00:30:15 -0400] tehnef: resno: sounds like you want chef solo?
[2014-03-18 00:30:31 -0400] coderanger: Yeah, or possibly Opsworks
[2014-03-18 00:31:06 -0400] resno: does chef-solo have some way to sync the cookbooks?
[2014-03-18 00:31:22 -0400] resno: i havent seen a method mentioned
[2014-03-18 00:31:28 -0400] resno: oh, sorry about that coderanger
[2014-03-18 00:31:47 -0400] coderanger: resno: knife solo is probably the most common way
[2014-03-18 00:34:49 -0400] tehnef: i'm thinking of managing employee laptops with chef
[2014-03-18 00:35:14 -0400] tehnef: group policy just doesn't quite do the stuff we need it to do anymore
[2014-03-18 00:35:31 -0400] tehnef: someone please convince me i'm wrong to do this
[2014-03-18 00:35:38 -0400] tehnef: :)
[2014-03-18 00:36:20 -0400] coderanger: tehnef: Have you seen solo wizards?
[2014-03-18 00:36:32 -0400] coderanger: tehnef: http://www.solowizard.com/
[2014-03-18 00:36:41 -0400] coderanger: might be a bit dated, but super useful
[2014-03-18 00:37:35 -0400] tehnef: interesting, i was actually thinking of doing it with chef-server
[2014-03-18 00:38:19 -0400] tehnef: that is pretty freaking awesome though
[2014-03-18 00:41:38 -0400] broconne: I am seeing something a bit odd - does anyone know if you can use tagged? inside of a guard?  I see examples of doing that.. but even when I just put the example code into its own recipe it blows up.
[2014-03-18 00:42:02 -0400] broconne: Josh Timberman from chef uses in his blog post here:  http://sysadvent.blogspot.com/2012/12/day-24-twelve-things-you-didnt-know.html#item_12
[2014-03-18 00:42:11 -0400] broconne: But even the example of just trying to log with it fails.
[2014-03-18 00:42:57 -0400] broconne: When I look at the source code, I see "tagged?" is part of recipe and when you are are doing the not_if/only_if it looks like you get put into the resource class..  But seems odd since I would imagine tagged? woudl be pretty useful inside of a not_if/only_if scenario
[2014-03-18 00:47:15 -0400] coderanger: broconne: Whats the error?
[2014-03-18 00:48:55 -0400] broconne: NoMethodError
[2014-03-18 00:48:56 -0400] broconne: -------------
[2014-03-18 00:48:57 -0400] broconne: undefined method `tagged?' for Chef::Resource::Log
[2014-03-18 00:48:57 -0400] broconne: adn here is the code
[2014-03-18 00:49:04 -0400] broconne:  15: log "I'm printed if the tag deployed is set." do
[2014-03-18 00:49:05 -0400] broconne:  16:      only_if { tagged?("deployed") }
[2014-03-18 00:49:05 -0400] broconne:  17: end
[2014-03-18 00:49:06 -0400] broconne:  18:
[2014-03-18 00:49:23 -0400] broconne: which is copied from that blog post on how to use tags :-)
[2014-03-18 01:05:45 -0400] rdobbsjrjr: any siuggestions on how to get a more useful error message from chef-client than "[2014-03-18T01:04:54+00:00] ERROR: 412 "Precondition Failed"
[2014-03-18 01:06:05 -0400] skansky: for a config file that has say 40 attributes, should I bother manageing those in chef, or just leave it in the config file?
[2014-03-18 01:06:25 -0400] rdobbsjrjr: suchas telling me which cookbook is missing?
[2014-03-18 01:06:27 -0400] skansky: just seems like overkill at some point, maybe I'll just pick a few that I care about
[2014-03-18 01:09:58 -0400] coderanger: broconne: Ahh, not_if and only_if blocks aren't run in recipe context
[2014-03-18 01:10:04 -0400] coderanger: broconne: Make node node.tagged?
[2014-03-18 01:10:07 -0400] coderanger: (probably anyway)
[2014-03-18 01:11:59 -0400] broconne: coderanger -> tired node.tagged? already.. no go
[2014-03-18 01:12:26 -0400] coderanger: broconne: Just do it the old way then node['tags'].include?('foo')
[2014-03-18 01:13:22 -0400] rdobbsjrjr: maybe an extra spiffy debug mode?
[2014-03-18 01:14:16 -0400] broconne: thanks coderanger - will give that shot while I pour one out for syntactic sugar :-)
[2014-03-18 01:19:23 -0400] rdobbsjrjr: is this a problem with hosted chef?
[2014-03-18 01:19:33 -0400] rdobbsjrjr: I didn't make any changes, anywhere, and it just sort of started doing this when running a chef-client. :/
[2014-03-18 01:20:05 -0400] rdobbsjrjr: meh
[2014-03-18 01:20:22 -0400] coderanger: broconne: Its an old bug that guards aren't run in a useful context
[2014-03-18 01:22:03 -0400] dgarstang4: it'd be nice if ^c actually stopped chef from running
[2014-03-18 01:25:35 -0400] flaccid: hehe dgarstang4 try it twice or hit ^d
[2014-03-18 01:42:08 -0400] rdobbs: Still no luck. Does anybody have any ideas as to how to figure out how to debug https://gist.github.com/anonymous/9612006
[2014-03-18 01:42:21 -0400] rdobbs: I've gone through and every cookbook I need is there.
[2014-03-18 01:42:33 -0400] rdobbs: it feels like it shouldn't be so hard for chef-client to tell me what it's missing
[2014-03-18 01:43:21 -0400] coderanger: rdobbs: You have a dependency constraint conflict most likely
[2014-03-18 01:43:22 -0400] aliljet: hm, this is weird, when I run chef-server-ctl test, I repeatedly get back no route to hosts problems, but these problems are intermittent  (i.e., running the command over and over generates different kinds of errors) -- have you guys seen soimething liek this before?
[2014-03-18 01:43:31 -0400] coderanger: rdobbs: Check the env constraints to start with
[2014-03-18 01:43:45 -0400] rdobbs: forgive me, but what do you mean by env constraints?
[2014-03-18 01:44:09 -0400] rdobbs: I just have a list of cookbooks in metadata.rb, and a setup in berkshelf that had been working before
[2014-03-18 01:44:29 -0400] aliljet: in fact, running that test command fails a bunch of times at the first "Creating client pedant_admin_client..." step with a "No route to host" error -- until I try a bunch of times and then it succeeds
[2014-03-18 01:44:37 -0400] rdobbs: I probably made a mistake by running berks update, it always seems to  cause me to lose half a day
[2014-03-18 01:44:42 -0400] coderanger: rdobbs: Are you using chef environments?
[2014-03-18 01:45:03 -0400] coderanger: rdobbs: berks has no effect on the server unless you upload things
[2014-03-18 01:45:21 -0400] rdobbs: @coderanger I am, but only to set attributes, nothing to do with cookbook versions or run lists
[2014-03-18 01:45:52 -0400] rdobbs: Oh well I did an upload too. and of course now I've brute-forced it via deleting the cookbooks that could have been offending, so I don't have much of a history
[2014-03-18 01:46:59 -0400] coderanger: rdobbs: Just have to keep looking for the conflict, unfortunately there isn't much in the way of debugging tools
[2014-03-18 01:47:10 -0400] rdobbs: =~(
[2014-03-18 01:47:20 -0400] rdobbs: how do I look for the conflict?
[2014-03-18 01:47:38 -0400] rdobbs: debug mode just gives the same data, nothing new
[2014-03-18 01:47:44 -0400] coderanger: rdobbs: https://gist.github.com/coderanger/9198932
[2014-03-18 01:47:48 -0400] coderanger: rdobbs: Thats what I use
[2014-03-18 01:49:31 -0400] mjuszczak: coderanger: What does your chef repo look like? Just environments, bin, certificates, config?  No roles, databags, etc. right?
[2014-03-18 01:50:24 -0400] rdobbs: @coderanger thanks
[2014-03-18 01:50:28 -0400] rdobbs: @coderanger I get Response: {"message"=>"Run list contains invalid items: no such cookbook recipe[rcp.", "non_existent_cookbooks"=>["recipe[rcp"], "cookbooks_with_no_versions"=>[]}
[2014-03-18 01:50:44 -0400] rdobbs: does that mean I have a typo of "rcp." somewhere in my code tree/run lists, or does that mean I'm getting the syntax wrong on knife?
[2014-03-18 01:52:07 -0400] coderanger: mjuszczak: Just a shared knife.rb
[2014-03-18 01:52:46 -0400] rdobbs: oh I should read your notes before asking, nevermind :)
[2014-03-18 01:53:19 -0400] mjuszczak: coderanger: wait, really?  Where do you put your environments?
[2014-03-18 01:53:24 -0400] rdobbs: though that doesn't do anything either
[2014-03-18 01:53:24 -0400] rdobbs: Response: {"message"=>"unable to solve dependencies in alotted time", "non_existent_cookbooks"=>[], "most_constrained_cookbooks"=>[]}
[2014-03-18 01:54:32 -0400] rdobbs: @coderanger have I perhaps broken something in hosted chef somehow?
[2014-03-18 01:58:52 -0400] rdobbs: @coderanger or perhaps any other tool suggestions since the cookbook_versions thing is just givingf me that same error?
[2014-03-18 02:00:18 -0400] rdobbs: I sort of don't have any data to work with here at all.
[2014-03-18 02:00:20 -0400] coderanger: rdobbs: You need to recurse into that cookbooks dependencies
[2014-03-18 02:00:35 -0400] coderanger: rdobbs: And find the minimum set of cookbooks that causes a failure
[2014-03-18 02:01:08 -0400] rdobbs: that cookbook doesn't do anything
[2014-03-18 02:01:10 -0400] rdobbs: it's blank
[2014-03-18 02:01:19 -0400] rdobbs: I commented everything out for grins and jollies
[2014-03-18 02:01:27 -0400] rdobbs: it should resolve to blank
[2014-03-18 02:01:47 -0400] rdobbs: or rather, nil
[2014-03-18 02:02:08 -0400] rdobbs: or should I be deleting all of my cookbooks from chef and adding each one one at a time?
[2014-03-18 02:08:18 -0400] rdobbs: please?
[2014-03-18 02:08:59 -0400] coderanger: rdobbs: No, just step through different combos of cookbooks with the command I gave you until you find a minimal set that fails
[2014-03-18 02:09:13 -0400] coderanger: rdobbs: And then look for the conflict
[2014-03-18 02:10:24 -0400] rdobbs: how?
[2014-03-18 02:10:33 -0400] rdobbs: no matter what cookbooks I give it, I get that alloted error
[2014-03-18 02:10:41 -0400] rdobbs: am I doing something stupid with regards to that tool?
[2014-03-18 02:11:48 -0400] rdobbs: should that return anything besides "precondition failed" ?
[2014-03-18 02:13:14 -0400] rdobbs: maybe I'm not understanding what you're saying. should I be pointing it at specific recipes, specific cookbooks, each and every cookbook in chef?
[2014-03-18 02:13:43 -0400] rdobbs: should I just be testing against the cookbooks individually that are required in the metadata of my wrapper cookbook?
[2014-03-18 02:14:52 -0400] coderanger: rdobbs: Yes
[2014-03-18 02:15:04 -0400] coderanger: rdobbs: Recurse through the dependencies to see which work and which don't
[2014-03-18 02:29:57 -0400] mjuszczak: Since vagrant and berkshelf integration is deprecated, should I not even be putting Vagrantfiles in my cookbooks?
[2014-03-18 02:31:08 -0400] judd7: Ohai chefs!  I want to customize the error message if a bash resource fails.  How canI do it?
[2014-03-18 02:32:26 -0400] judd7: bash "foo" do
[2014-03-18 02:32:27 -0400] judd7:   command "no_such_cuspy_app"
[2014-03-18 02:32:27 -0400] judd7:   # magic raised custom exception here
[2014-03-18 02:32:28 -0400] judd7: end
[2014-03-18 02:32:33 -0400] coderanger: judd7: Not really, why?
[2014-03-18 02:32:54 -0400] judd7: to inform the human universe of the correct remedy.
[2014-03-18 02:33:33 -0400] judd7: I'm thinking of using ignore_failure :true and then looking for the correct output and logging on that.
[2014-03-18 02:33:46 -0400] rdobbs: thanks. hopefully this will get it, I really appreciate your help!
[2014-03-18 02:33:55 -0400] rdobbs: have a good night
[2014-03-18 02:35:03 -0400] coderanger: judd7: You would have to write a thing yourself using shell_out
[2014-03-18 02:35:07 -0400] coderanger: judd7: Possibly as an LRWP
[2014-03-18 02:35:13 -0400] judd7: gotcha.
[2014-03-18 02:35:19 -0400] judd7: thanks, coderanger
[2014-03-18 02:40:15 -0400] mjuszczak: coderanger: Last question of the night, I promise.  I've got my application cookbook working but it's saying it can't find the mariadb cookbook (depends... line in metadata.rb).  That's because I'm not using one from opscode since they don't have a mariaDB cookbook.  Is that the special case where I throw a line in Berksfile?
[2014-03-18 02:40:29 -0400] coderanger: mjuszczak: Are you using berks 3 or 2?
[2014-03-18 02:40:54 -0400] mjuszczak: Looks like 2 ... Berkshelf (2.0.14)
[2014-03-18 02:41:23 -0400] coderanger: mjuszczak: Is the mariadb cookbook not listed on the community site?
[2014-03-18 02:41:31 -0400] coderanger: Or are you trying to get it via git?
[2014-03-18 02:41:39 -0400] mjuszczak: Which doesn't look like it's under active development anymore, hrm.    Maybe I should update to versoin .
[2014-03-18 02:41:43 -0400] mjuszczak: version 3*
[2014-03-18 02:41:47 -0400] mjuszczak: Trying to get it via git
[2014-03-18 02:41:49 -0400] coderanger: mjuszczak: Heh, either is fine for the moment
[2014-03-18 02:41:53 -0400] coderanger: but then yeah
[2014-03-18 02:42:47 -0400] mjuszczak: https://github.com/joerocklin/chef-mariadb
[2014-03-18 02:43:42 -0400] coderanger: cookbook 'mariadb', github: 'something/mariadb'
[2014-03-18 02:44:51 -0400] mjuszczak: thank you
[2014-03-18 02:45:47 -0400] mjuszczak: you're ways are making a lot of sense man.  I can kitchen converge on my "myapp" database server and test it, without having to have the "base" stuff in there I would have on a cloud server.
[2014-03-18 02:50:15 -0400] coderanger: Yep :)
[2014-03-18 03:00:54 -0400] mjuszczak: :)
[2014-03-18 03:19:40 -0400] mjuszczak: test kitchen doesn't let you list nested attributes in YAML form?
[2014-03-18 03:23:50 -0400] juliancdunn: mjuszczak: sure it does
[2014-03-18 03:23:57 -0400] juliancdunn: just keep indenting
[2014-03-18 03:27:53 -0400] mjuszczak: http://pastebin.com/My1bzVRp
[2014-03-18 03:27:58 -0400] mjuszczak: it's ignoring those last two variables
[2014-03-18 03:30:42 -0400] mjuszczak: juliancdunn: unless my syntax is off?
[2014-03-18 03:42:11 -0400] mjuszczak: Man I can't find a nexample of nested attributes in a kitchen.yml file to save my life.
[2014-03-18 03:42:20 -0400] mjuszczak: I've searched github, google, etc.  Every example only has one level.
[2014-03-18 03:48:32 -0400] anthroprose: mjuszcak: 1 sec, I've got some I think
[2014-03-18 03:49:08 -0400] anthroprose: eh, mine are json
[2014-03-18 03:49:10 -0400] anthroprose: attributes: { "role" : "brain", "nginx" : { "default_domain" : "localhost", "default_site_enabled" : false }
[2014-03-18 03:49:18 -0400] anthroprose: but I've seen yaml examples...
[2014-03-18 03:50:21 -0400] mjuszczak: perhaps I'll just do the JSON route
[2014-03-18 03:50:23 -0400] mjuszczak: thanks!
[2014-03-18 03:50:28 -0400] anthroprose: but you do just keep indenting tho
[2014-03-18 03:50:30 -0400] anthroprose: and using the -
[2014-03-18 03:50:35 -0400] mjuszczak: Yeah but when do you use the -?
[2014-03-18 03:50:43 -0400] mjuszczak: It seems completely random as to when it's used versus when it isn't
[2014-03-18 03:51:09 -0400] anthroprose: yeah, arrays or objects
[2014-03-18 03:51:17 -0400] anthroprose: find a yaml editor ;)
[2014-03-18 03:53:36 -0400] anthroprose: http://rubydoc.org/github/opscode/test-kitchen/
[2014-03-18 03:54:02 -0400] anthroprose: older docs have it, but I think I was in the same boat as you.... yaml didnt parse in my head so I just did json
[2014-03-18 03:57:26 -0400] mjuszczak: cool, ognna go JSON.  Thanks :)
[2014-03-18 03:58:57 -0400] davidski_web: Newbie question here - I've been using chef-solo w/vagrant (on Windows host) and need to centralize my recipes. Should I start looking at chef-zero, OSS chef-server, or some other solution?
[2014-03-18 04:04:13 -0400] jidar: davidski_web: are you looking to cleanup the directory structure or just looking at how you're going to be deploying this in the future? because they are seperate answers
[2014-03-18 04:06:26 -0400] davidski_web: jidar: Mainly looking to get out of recipe dependency hell where I grab a community cookbook, then have to manually clone a dozen other repos to get it to work.
[2014-03-18 04:06:36 -0400] jidar: berkshelf
[2014-03-18 04:06:55 -0400] jidar: install and use, thats the solution
[2014-03-18 04:06:59 -0400] davidski_web: That's what I thought, but I understood berkshelf to be deprecated under current versions of vagrant. :/
[2014-03-18 04:07:15 -0400] jidar: berkshelf has nothing to do with vagrant (basically)
[2014-03-18 04:07:20 -0400] n1ko: vagrant-berkshelf is, berkshelf isn't
[2014-03-18 04:07:37 -0400] davidski_web: Ah. vagrant-berkshelf isn't necessary to use berkshelf then?
[2014-03-18 04:07:59 -0400] n1ko: well, it kinda is since there is no other mechanism to upload to cookbook automaticly
[2014-03-18 04:08:08 -0400] n1ko: or atleast i don't know about one
[2014-03-18 04:08:32 -0400] n1ko: but berkshelf generally is the way to go
[2014-03-18 04:09:19 -0400] davidski_web: Which means I'm going to need a local ruby install on my Windows box? Vagrant supplies it's own embedded interpreter and I've tried to avoid sticking extra gems in there.
[2014-03-18 04:09:29 -0400] davidski_web: Not sure if that's a good idea...
[2014-03-18 04:13:19 -0400] jidar: when I work on windows I end up just installing ruby
[2014-03-18 04:13:42 -0400] jidar: but I put both of them in c:\program files (x86)\
[2014-03-18 04:13:51 -0400] pravinmishra: I am getting ERROR: ERROR: Failed to authenticate to https://api.opscode.com/organizations/diatm as pravinmishra88
[2014-03-18 04:14:06 -0400] pravinmishra: diatm is organization and pravinmishra88 is username
[2014-03-18 04:14:27 -0400] pravinmishra: I was going through this documentation: https://wiki.opscode.com/display/chef/Common+Errors
[2014-03-18 04:15:14 -0400] pravinmishra: For me my username and node_name is same
[2014-03-18 04:16:23 -0400] pravinmishra: I don't understand - You have a client with the same name as your user.
[2014-03-18 04:17:04 -0400] pravinmishra: Any help?
[2014-03-18 04:18:48 -0400] pravinmishra: When running chef-client -  getting error: Did not find config file: /etc/chef/client.rb, using command line options.
[2014-03-18 04:18:48 -0400] pravinmishra: [2014-03-18T09:47:39+05:30] WARN: *****************************************
[2014-03-18 04:18:49 -0400] pravinmishra: /home/ubuntu/.rvm/gems/ruby-1.9.3-p392/gems/chef-11.4.4/lib/chef/file_cache.rb:56:in `initialize': Permission denied - /var/chef/cache/chef-stacktrace.out (Errno::EACCES)
[2014-03-18 04:18:58 -0400] pravinmishra: Please help me
[2014-03-18 04:21:37 -0400] darkside_: you can't have the node_name and username the same
[2014-03-18 04:27:07 -0400] pravinmishra: darkside: I didn't created any node
[2014-03-18 04:27:13 -0400] pravinmishra: it's by default :)
[2014-03-18 04:27:40 -0400] pravinmishra: darkside: Should i delete pravinmishra88 node
[2014-03-18 04:27:48 -0400] pravinmishra: create new one using this link https://manage.opscode.com/nodes/new
[2014-03-18 04:27:54 -0400] pravinmishra: right?
[2014-03-18 04:28:16 -0400] darkside_: sounds right
[2014-03-18 04:28:31 -0400] darkside_: been awhile since I used hosted chef
[2014-03-18 04:30:47 -0400] pravinmishra: I am little bit confused, Is userkey is unique for node and organization?
[2014-03-18 04:35:44 -0400] pravinmishra: darkside: my knife client list was working fine yesterday
[2014-03-18 04:36:46 -0400] pravinmishra: I was getting ERROR on vagrant provision - 'The chef binary (either `chef-solo` or `chef-client`) was not found on'
[2014-03-18 04:37:09 -0400] pravinmishra: what i done, I ssh to my vagrant  and installed chif there
[2014-03-18 04:37:31 -0400] pravinmishra: after that this error(The chef binary (either `chef-solo` or `chef-client`) was not found on) has gone
[2014-03-18 04:38:04 -0400] pravinmishra: Now facing Authentication issues :)
[2014-03-18 04:42:43 -0400] rpad: Not getting any google love on this. Receiving "NameError: uninitialized constant Homebrew" when trying to provision a vagrant machine
[2014-03-18 04:43:20 -0400] rpad: I only have dotdeb (from git) and php in my berksfile
[2014-03-18 06:47:02 -0400] dmarr: trying to understand chef solo and knife solo.  how would i clean an install? I think the json is cached
[2014-03-18 06:51:51 -0400] Siiseli_: Anyone else ever get random chef run fails about "content length mismatch"
[2014-03-18 06:52:00 -0400] Siiseli_: they're usually fixed by running the bootstrap again
[2014-03-18 06:52:05 -0400] Siiseli_: but it's.. odd
[2014-03-18 06:52:11 -0400] Siiseli_: google was of little help
[2014-03-18 07:06:35 -0400] dmarr: I get `ERROR: Cookbook ec2convert not found` when I try to run chef-solo -c solo.rb -j localhost.json
[2014-03-18 07:07:14 -0400] dmarr: however i do have ec2convert inside a dir set in my cookbook_path
[2014-03-18 07:18:52 -0400] pravinmishra: You have a client with the same name as your user. What is it mean?
[2014-03-18 07:25:44 -0400] josh-k: hey everyone, anyone here have experience with azure and winrm?
[2014-03-18 08:07:18 -0400] pravinmishra: Why i am getting message on UI - Permission denied. You do not have permission to list the users in this organization. (Error 21001)
[2014-03-18 08:07:26 -0400] pravinmishra: I am owner of this account?
[2014-03-18 09:39:02 -0400] Raboo: hello
[2014-03-18 09:39:12 -0400] Raboo: I'm writing a LWRP
[2014-03-18 09:39:57 -0400] Raboo: so i have "action :backup" and I want to create a "action :backupmysql"
[2014-03-18 09:39:58 -0400] srenatus: hi there. does anyone use some chef-specific inventory mgmt tooling?  talking to the chef server (better) or at least consuming ohai data (still good)...?
[2014-03-18 09:40:46 -0400] Raboo: but my problem is that :backup and :backupmysql shares a lot of code..
[2014-03-18 09:41:23 -0400] Raboo: Is there a way to have like a :common or something so I don't have to duplicate code in the provider?
[2014-03-18 09:43:24 -0400] Raboo: srenatus what kind of inventory?
[2014-03-18 09:43:30 -0400] Raboo: I use foreman
[2014-03-18 09:43:34 -0400] srenatus: Raboo: you could just call the action :backup of your resource inside of the :backupmysql block, can't you?
[2014-03-18 09:43:48 -0400] srenatus: Raboo: Interesting! how far along is its chef integration?
[2014-03-18 09:44:14 -0400] Raboo: srenatus i gets the facts and reports from the chef runs
[2014-03-18 09:44:27 -0400] Raboo: s/i/it/
[2014-03-18 09:44:47 -0400] Raboo: srenatus i don't know if that works..
[2014-03-18 09:44:59 -0400] srenatus: Raboo: would you mind sharing a screenshot?
[2014-03-18 09:45:17 -0400] Raboo: if it does i will split out the shared code in :backup and put that in :common
[2014-03-18 09:46:05 -0400] Raboo: srenatus https://imgur.com/a/SnVIM
[2014-03-18 09:46:20 -0400] srenatus: Raboo: I haven't tried it with the same resource, but I don't see why it should fail.  there's also use_inline_resources, so name clashes should not happen/concern you
[2014-03-18 09:46:38 -0400] srenatus: Raboo: Thanks a lot :)
[2014-03-18 09:48:40 -0400] Raboo: srenatus if you do happen to start using it, feel free to join #theforeman
[2014-03-18 09:48:50 -0400] Raboo: they'll be happy to get input from more chef users
[2014-03-18 09:52:27 -0400] srenatus: Raboo: my data center guy just said "hmm that's not what I had in mind"... (I won't comment on that.)
[2014-03-18 09:58:57 -0400] Raboo: srenatus well maybe he should specify what he wants :-)
[2014-03-18 10:38:48 -0400] kleewho: Chefs, how to deal with 2 cookbooks with the same names in site-cookbooks and cookbooks directories? I mean only one is working but the other is used? Some additional context: one is runit from hw-cookbooks and the other is runit from aws opsworks cookbooks
[2014-03-18 10:44:48 -0400] daxroc: Morning all
[2014-03-18 10:45:43 -0400] daxroc: How should I have chef-solo reload ohai so it reads the hostname changes for use in later recipes ?
[2014-03-18 12:19:44 -0400] mattsurabian: got a chef architecture question... have some logic to create an upstart "foreman" responsible for spinning up a certain amount of "workers" which are just some other upstart process which use the instance stanza that stop themselves when the foreman is stopped. Anyway, was thinking of creating a definition responsible for writing all the configuration files to /etc/init and setting up collectd monitoring.
[2014-03-18 12:19:53 -0400] mattsurabian: could also do an LWRP
[2014-03-18 12:23:11 -0400] mattsurabian: wondering though, would the idea be to have one definition responsible for creating and another responsible for communicating with the custom upstart processes
[2014-03-18 12:23:28 -0400] mattsurabian: or would rolling in a :create action or something be better
[2014-03-18 12:25:01 -0400] mattsurabian: FWIW we have an internal style of always using a custom definition to communicate with custom services and daemons, so we only have to specify the start,stop, restart commands once
[2014-03-18 12:40:32 -0400] daxroc: Hym, seems it's not possible to call ohai:reload and overwrite variables already set am I understanding correctly?
[2014-03-18 12:52:32 -0400] juliancdunn: mjuszczak: I've got an example of nested attributes in the YAML .kitchen.yml here - https://github.com/juliandunn/oracle-instantclient/blob/master/.kitchen.yml
[2014-03-18 12:54:56 -0400] bmoritz: In http://docs.opscode.com/essentials_node_object_deep_merge.html it says that "When an attribute is of the same type of data, such as a hash or an array, the contents are merged. This is true even with different levels of precedence, such as default and override attributes. If the attribute is of a different data type, it is overwritten at higher levels of precedence."
[2014-03-18 12:55:48 -0400] bmoritz: I've found this to be untrue when using role override attributes against cookbook default attributes
[2014-03-18 12:57:28 -0400] bmoritz: Am I reading that wrong?
[2014-03-18 13:24:48 -0400] juliancdunn: yeah, I believe that is misleading
[2014-03-18 13:25:13 -0400] juliancdunn: all defaults are merged across types (roles, environments, etc.)
[2014-03-18 13:25:22 -0400] juliancdunn: override will smash defaults
[2014-03-18 13:48:35 -0400] daxroc: I'm running into an issue when I set the hostname via a recipe and then use ohai, node[:fqdn] later it remains on the original hostname prior to executing the recipe irrespective on if I reload ohai. I've found a ticket describing this https://tickets.opscode.com/browse/OHAI-389
[2014-03-18 13:49:19 -0400] daxroc: Is it possible to delete this constant prior to running reload?
[2014-03-18 13:51:09 -0400] daxroc: Object.send(:remove_const, ..) ?
[2014-03-18 13:53:40 -0400] shlant: anyone familiar with the snmp cookbook?
[2014-03-18 14:01:48 -0400] shlant: can I reference node attr with "node['ipaddress']" in role.json?
[2014-03-18 14:11:05 -0400] mattsmith: anyone else having issues getting knife-ec2 on osx 10.9
[2014-03-18 14:12:06 -0400] mattsmith: I get "ERROR: Failed to build gem native extension." I'v got nokogiri installed so not to sure what else its complaining about
[2014-03-18 14:13:27 -0400] Popsikle: you need to use the embedded ruby
[2014-03-18 14:13:35 -0400] Popsikle: . /opt/chef/embedded/blah
[2014-03-18 14:13:55 -0400] trilitheus: hi all - the embedded version of jre within latest chef-server is out of date -v7u3 (latest is v7u51) is thehre any way to update this without screwing omnibus install
[2014-03-18 14:14:03 -0400] trilitheus: open source btw
[2014-03-18 14:15:04 -0400] mattsmith: Popsikle, was that for me? if so I've just checked and gem is /opt/chef/embedded/bin/gem
[2014-03-18 14:17:57 -0400] michaelhart: I'm running open source chef server 11.0.4 and want to upgrade to 11.0.11. Any idea what's involved? Can I just upgrade the omnibus package or do I need to a do a full export/import?
[2014-03-18 14:26:31 -0400] stormerider: michaelhart: backup and then just update the package
[2014-03-18 14:26:53 -0400] cocotton: Hey all, I'm having a weird issue right now. When running chef, my recipe apply the template modifications to the target file, but then a couple of line after, removes the modifications. Also, something weird is that upon applying the modification, the recipe called is mycookbook::none
[2014-03-18 14:26:56 -0400] stormerider: and then chef-server-ctl reconfigure if the package update doesnt do it automatically
[2014-03-18 14:27:05 -0400] michaelhart: stormerider: thanks. always a bit nervous when updating chef server, it's become such a crucial part of our infrastructure
[2014-03-18 14:27:13 -0400] stormerider: *nod*
[2014-03-18 14:42:57 -0400] mjuszczak: Can someone advise on nested attributes in kitchen.yml?  I can't seem to get the MariaDB cookbook to read my tunables.
[2014-03-18 14:46:02 -0400] srenatus: mjuszczak: pasted somewhere?
[2014-03-18 14:57:33 -0400] cocotton: Is there a reason I'm missing, why during a chef run, I'll see "Recipe:  <Dynamically Defined Resource>" on one node but "Recipe: mycookbook::none" on another one?
[2014-03-18 15:14:53 -0400] drywheat: what's the best way to override the version of a package that a cookbook installs?
[2014-03-18 15:15:10 -0400] drywheat: i.e. package "monit" , but I want to install from backports
[2014-03-18 15:15:45 -0400] gleam: in that case i'd just use apt_repository to pin it before the cookbook executes it
[2014-03-18 15:15:50 -0400] gleam: err apt_preference
[2014-03-18 15:16:00 -0400] gleam: otherwise you can use chef-rewind or otherwise modify the resource
[2014-03-18 15:16:33 -0400] drywheat: i always try to stay away from pinning unless necessary
[2014-03-18 15:16:43 -0400] drywheat: i thought perhaps wrapping the cookbook
[2014-03-18 15:17:09 -0400] drywheat: and in the wrapper, install the package with the desired target prior to invoking the inner cookbook
[2014-03-18 15:31:10 -0400] pabst^: does chef cache data bags?
[2014-03-18 15:34:44 -0400] nobody18188181: With chef can I provision by IP rather than hostname?
[2014-03-18 15:35:51 -0400] mjuszczak: srenatus: http://pastebin.com/upZEPkrr
[2014-03-18 15:36:06 -0400] mjuszczak: srenatus: The server_* ones get picked up fine but the tunables are completely ignored
[2014-03-18 15:37:47 -0400] tara_h1: nobody18188181: yes, doesn't matter
[2014-03-18 15:38:00 -0400] systest: With puppet  I can create a personal workspace on the production infrastructure by simply pushing my branch to an "environment" and and then passing that environment to a node along with the classes to use.  Can someone point me to docs on how people do something similar with open source chef?
[2014-03-18 15:38:56 -0400] anthroprose: nobodoy " -a ipaddress"
[2014-03-18 15:39:09 -0400] nobody18188181: tara_h1: So, chef doesn't have the limitation that puppet has where you have to use a hostname to define a node; I can define an IP instead?
[2014-03-18 15:39:43 -0400] nobody18188181: I just want to be sure before I move away from puppet
[2014-03-18 15:40:09 -0400] anthroprose: nobody: you can define anything if you write a lil ruby
[2014-03-18 15:40:15 -0400] anthroprose: plus there are 2727239 ways to provision chef
[2014-03-18 15:40:37 -0400] mjuszczak: nobody18188181: be careful with what anthroprose said about the 2727239 ways to provision chef.  I had trouble moving from puppet to chef for that reason.  YMMV.
[2014-03-18 15:40:38 -0400] tara_h1: nobody18188181: you can set a node name to whatever
[2014-03-18 15:40:51 -0400] nobody18188181: does chef use an agent like in puppet?
[2014-03-18 15:41:18 -0400] mjuszczak: nobody18188181: it can
[2014-03-18 15:41:44 -0400] anthroprose: mjusczcak: how so?
[2014-03-18 15:41:45 -0400] mjuszczak: nobody18188181: You can do things similar to how you would do "puppet apply" locally, or you can run chef server and the nodes can "check in".
[2014-03-18 15:41:58 -0400] anthroprose: I'm curious (not much puppet experience)
[2014-03-18 15:42:09 -0400] workmad3: nobody18188181: not exactly... chef uses a client which controls the entire process locally, with data about a node being fetched from a server
[2014-03-18 15:42:19 -0400] anthroprose: I started off using knife-ec2, but it was horribly out of date re: development
[2014-03-18 15:42:27 -0400] anthroprose: so I switched to self-bootstrapping
[2014-03-18 15:42:31 -0400] workmad3: nobody18188181: as opposed to the puppet agent which, iirc, gets remote-controlled over a persistent connection by the puppet server
[2014-03-18 15:42:31 -0400] mjuszczak: anthroprose: I'm writing a blog post on it, I'll be sure to send it to you when I'm done, probably this week.
[2014-03-18 15:42:34 -0400] nobody18188181: workmad3: So then would this client run in cron to ensure provisioning?
[2014-03-18 15:42:36 -0400] anthroprose: after a brief flirt with celery+boto
[2014-03-18 15:42:50 -0400] mjuszczak: workmad3: puppet-agent checks into the puppet master
[2014-03-18 15:42:58 -0400] tara_h1: nobody18188181: if you wanted regular updates, yeah
[2014-03-18 15:42:59 -0400] mjuszczak: workmad3: a puppet run can be forced but that's usually via mcollective
[2014-03-18 15:43:26 -0400] workmad3: mjuszczak: ah, I thought the puppet master took a much more active role in puppet compared to the chef server in a chef-client run :)
[2014-03-18 15:43:58 -0400] mjuszczak: workmad3: not in most setups.  It compiles the catalog and sends it over to the agent to run, but only once the agent connects to the master and says "it's been 30 minutes... whatya got for me?"
[2014-03-18 15:44:03 -0400] workmad3: nobody18188181: the chef-client can be run daemonized with an interval in order to keep things up to date
[2014-03-18 15:44:10 -0400] mjuszczak: there are ways to tell all puppet agents to check-in, etc.
[2014-03-18 15:44:20 -0400] nobody18188181: workmad3: ooh, that's even nicer.
[2014-03-18 15:44:56 -0400] nobody18188181: I def will be looking into chef; thanks guys.
[2014-03-18 15:44:57 -0400] workmad3: nobody18188181: the chef-client recipe from opscode can be used to set that up and ensure it's daemonized on boot with your favourite process supervisor too :)
[2014-03-18 15:45:10 -0400] mjuszczak: anthroprose: The thing I like about puppet is that there aren't a ton of philosophies.  Most folks use Craig Dunn's Roles/Profiles/Components setup, Hiera is a pretty common thing these days... Puppet v3 kind of set standards that everyone follows.  Chef ... omg.  I like it :) But there's 101471414 different ways to do something and it gets messy trying to learn and understand.
[2014-03-18 15:45:13 -0400] nobody18188181: no issues with debian ?
[2014-03-18 15:45:17 -0400] anthroprose: and always remember to use a report_handler!
[2014-03-18 15:45:24 -0400] anthroprose: so you know if/when/what changes in your runs
[2014-03-18 15:45:28 -0400] mjuszczak: nobody18188181: you'll probably have a better time on debian/ubuntu with chef than you did with puppet.
[2014-03-18 15:45:48 -0400] anthroprose: mjuszczak: so puppet is kinda like python in the idiom/syntax regard?
[2014-03-18 15:46:00 -0400] nobody18188181: anthropose: more like JSON
[2014-03-18 15:46:28 -0400] mjuszczak: anthroprose: It's built in ruby but has a DSL... while it supports raw ruby in some capacity, most use the DSL strictly, except for erb templates.
[2014-03-18 15:46:40 -0400] workmad3: mjuszczak: I have to admit, I never looked at puppet in a massive amount of depth... I didn't like that it tried to be 'smart' about what order things ran in, I much prefer the chef way of 'I'll run stuff in the order you tell me to... if that's wrong, sucks to be you' :)
[2014-03-18 15:46:50 -0400] mjuszczak: if you're talking more about standards and such, yeah, I would compare puppet more closely to the way the python world works over the way the ruby world works.
[2014-03-18 15:47:08 -0400] anthroprose: yeah, I meant standards wise
[2014-03-18 15:47:12 -0400] anthroprose: I know they are both ruby
[2014-03-18 15:47:20 -0400] anthroprose: was learning more on the community culture slant
[2014-03-18 15:47:41 -0400] mjuszczak: workmad3: Agreed.  Puppet made a mistake there.  They've tried to fix that though, and are working on making it better.  It supports stages, and explciit ordering ... for instance, you can do things like:  Class['blah'] => Class['foo'] to force blah to run before foo.  But there are bugs :)
[2014-03-18 15:51:00 -0400] workmad3: mjuszczak: I also quite like the chef community in that it's trying to figure out new and interesting ways to make automation awesome :) but it does mean that there's a ton of ways of doing things and a lot of old styles that aren't recommended still in-the-wild
[2014-03-18 15:56:26 -0400] mjuszczak: workmad3: Agreed. That does make sense.  I like the approaches that have tried  to simplify things a bit, like the berkshelf method and the way coderanger does things.
[2014-03-18 15:56:39 -0400] mjuszczak: srenatus: any thoughts on that pastebin?
[2014-03-18 15:57:42 -0400] anthroprose: workmad: yeah, the only problem with that is the nature of 'appeal to authority'
[2014-03-18 15:57:54 -0400] anthroprose: so alot of times, the 'first solution' to market is the one that gets adopted
[2014-03-18 15:57:59 -0400] anthroprose: and *quick*
[2014-03-18 16:00:20 -0400] leocassarani: hello  what happens if I create a user but don't specify a password? the docs don't seem to say
[2014-03-18 16:04:24 -0400] madhatter: leocassarani: In a recipe or as chef user?
[2014-03-18 16:04:33 -0400] alxism: hello Chefs, I have a question regarding the log formatters: how do I get the /var/lo/chef/client.log to look like the chef-client standard output ?
[2014-03-18 16:04:34 -0400] leocassarani: madhatter: in a recipe, using the user provider
[2014-03-18 16:04:38 -0400] leocassarani: or resource, rather
[2014-03-18 16:08:14 -0400] madhatter: leocassarani: I'd guess no password is set so login is not possible.But you can use the user with su
[2014-03-18 16:08:20 -0400] Excolo: Hey, I was hoping someone could help me. My chef server was on a debian squeeze box, and i just updated to wheezy. Now all my clients are failing to authenticate and i have no idea what to do
[2014-03-18 16:12:32 -0400] srenatus: mjuszczak: sorry, been absent.  looks good actually
[2014-03-18 16:12:47 -0400] srenatus: mjuszczak: does it end up in /tmp/kitchen/*.json properly?
[2014-03-18 16:13:13 -0400] mjuszczak: srenatus: no worries.  I'm trying to override what's set here: https://github.com/joerocklin/chef-mariadb/blob/master/attributes/server.rb
[2014-03-18 16:13:59 -0400] mjuszczak: srenatus: dna.json is http://pastebin.com/w61aY73U
[2014-03-18 16:14:34 -0400] cheeseprocedure: Excolo: did you get output from "chef-server-ctl tail" when a client fails to check in? :)
[2014-03-18 16:15:09 -0400] srenatus: mjuszczak: mysterious.  and where is the value supposedly not effective?
[2014-03-18 16:16:01 -0400] mjuszczak: you're supposedly supposed to be able to override what's set in attributes/server.rb
[2014-03-18 16:16:05 -0400] lewiz: Is there a URL I can fetch the latest Chef client for Windows from?  I'm looking to automate this
[2014-03-18 16:16:09 -0400] mjuszczak: but it isn't being applied (IE: /etc/mysql/my.cnf gets the defaults)
[2014-03-18 16:19:11 -0400] srenatus: mjuszczak: sorry, no clue. you've done everything correctly as far as I can see
[2014-03-18 16:29:45 -0400] Excolo: so I was just talking to cheeseprocedure and he suggested I come back into main chat as he has no idea. I upgraded my chef server from debian squeeze to wheezy. Its chef 10.18.2 and ever since then no clients will authenticate, and webui will not start. Lastly there doesnt really appear to be anything in the logs
[2014-03-18 16:29:55 -0400] Excolo: any and all ideas would be helpful at this point
[2014-03-18 16:30:20 -0400] juliancdunn: lewiz: https://getchef.com/chef/install.msi
[2014-03-18 16:37:29 -0400] lewiz: juliancdunn: Thanks!
[2014-03-18 16:57:24 -0400] CPS: i'm seeing some weird behavior on a node. I've changed it's configuration to use a different data bag when generating templates, but when I run chef they still have values from the old data bag
[2014-03-18 16:59:34 -0400] CPS: anyone seen this behavior before? on windows if that matters
[2014-03-18 17:01:35 -0400] briangonzalez: hey guys, looking for some help running
[2014-03-18 17:01:47 -0400] briangonzalez: "bundle install" via the bash resource
[2014-03-18 17:02:08 -0400] daxroc: CPS: do they change if the databag changes, the resources don't have any conditionals like not_if exists etc ?
[2014-03-18 17:02:38 -0400] briangonzalez: It's working and all, albeit slowly, but I don't see the bundlers output in vagrant's stdout? any ideas?
[2014-03-18 17:02:45 -0400] CPS: no conditionals, and i haven't tried updating it since i switched over to the other bag
[2014-03-18 17:03:16 -0400] anthroprose: brian: use bash redirects to make sure you are catching STDOUT/STDERR?
[2014-03-18 17:03:28 -0400] briangonzalez: how do I do that?
[2014-03-18 17:03:31 -0400] anthroprose: or use the ruby cookbook...
[2014-03-18 17:03:43 -0400] anthroprose: brian: http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO-3.html
[2014-03-18 17:04:30 -0400] briangonzalez: But doesn't bundlers output go to stdout by default?
[2014-03-18 17:04:35 -0400] daxroc: briangonzalez:  command 2&>1 >> /tmp/my.log ^ what anthroprose
[2014-03-18 17:04:52 -0400] shlant: how do I create an empty attribute and how should I check for it not to be empty in a template?
[2014-03-18 17:05:11 -0400] shlant: is this best? default['snmp']['load_average'] = ""
[2014-03-18 17:05:49 -0400] anthroprose: brian: honestly I would assume it does, but maybe something during the ENV process makes it not, or the bash resource itself....
[2014-03-18 17:06:18 -0400] anthroprose: brian: I would argue to use the ruby_gem resource so that you can know/report/etc. on which gems are changing
[2014-03-18 17:06:32 -0400] anthroprose: unless it is just the install portion of things for an app, not just the dependencies
[2014-03-18 17:06:37 -0400] CPS: daxroc: updating the old data bag is not reflected
[2014-03-18 17:07:40 -0400] briangonzalez: anthroprose: I already have rbenv installed. I am simply trying to install my Rails app's dependencies.
[2014-03-18 17:08:46 -0400] anthroprose: briangonzalez: so I'm using python, not ruby.... but here is what I do.....
[2014-03-18 17:08:59 -0400] briangonzalez: k...
[2014-03-18 17:09:57 -0400] briangonzalez: daxroc: but would that ensure bundlers output shows in vagrant's stdout?
[2014-03-18 17:10:17 -0400] anthroprose: brian: https://gist.github.com/anthroprose/5249ae994b9568e326fe
[2014-03-18 17:10:29 -0400] anthroprose: woops, mispaste on the bottom one
[2014-03-18 17:11:00 -0400] anthroprose: there we go...
[2014-03-18 17:11:13 -0400] briangonzalez: oh, ok.
[2014-03-18 17:11:17 -0400] anthroprose: so I do global pip installs for shit like log shipping, time series, etc...
[2014-03-18 17:11:25 -0400] anthroprose: and then app specific into the app's virtualenv
[2014-03-18 17:11:32 -0400] anthroprose: everything is version tied
[2014-03-18 17:11:55 -0400] anthroprose: and you can move them from the cookbook's attrs to anywhere its appropriate for dev control
[2014-03-18 17:11:59 -0400] briangonzalez: Does python have something like bundler? I don't want to have keep my Gemfile and those attributes in sync each time one changes.
[2014-03-18 17:12:11 -0400] anthroprose: not really
[2014-03-18 17:12:25 -0400] anthroprose: easy_tools and some other things, but they are just parts of a non-whole
[2014-03-18 17:12:51 -0400] anthroprose: what alot of people do
[2014-03-18 17:13:00 -0400] anthroprose: is template everything during the build process
[2014-03-18 17:13:08 -0400] anthroprose: and drive it with a master json or other datasource
[2014-03-18 17:13:37 -0400] anthroprose: I've got CloudFormation parameters, environment params, cookbook params, node params
[2014-03-18 17:13:42 -0400] anthroprose: *splode*
[2014-03-18 17:14:00 -0400] briangonzalez: haha, nice
[2014-03-18 17:14:40 -0400] anthroprose: once you find a nice pattern that works for your org/app... its pretty coherent
[2014-03-18 17:14:54 -0400] anthroprose: its all over-ride based, so defaults happen if you forget
[2014-03-18 17:15:57 -0400] anthroprose: CF -> Node/Cluster/Env Specific Attrs, the Environment drives the cookbook versions
[2014-03-18 17:19:55 -0400] briangonzalez: cool, thanks man
[2014-03-18 17:20:18 -0400] anthroprose: also, packer.io or veewee
[2014-03-18 17:20:34 -0400] anthroprose: make your dev's boxes for them using your prod deploy code
[2014-03-18 17:20:41 -0400] anthroprose: makes live sooooo much easier
[2014-03-18 17:22:11 -0400] dstynchula: hia
[2014-03-18 17:22:34 -0400] dstynchula: How can I use knife node search to query for a specific value in an attribute?
[2014-03-18 17:22:57 -0400] anthroprose: dstynchula: still can't query that structure?
[2014-03-18 17:23:10 -0400] stormerider: knife search node "attribute:value"
[2014-03-18 17:23:14 -0400] dstynchula: I've got it MUCH further down the field now
[2014-03-18 17:23:27 -0400] dstynchula: stomrerider: I thought that should work as well.
[2014-03-18 17:23:36 -0400] dstynchula: hmm
[2014-03-18 17:24:16 -0400] anthroprose: stormerider: he has like a 3 dimensional numerical array with a hash array inside
[2014-03-18 17:24:18 -0400] stormerider: dstynchula: if it's a complex attribute, like node['blah']['blah2'] you'd do "blah_blah2:value"
[2014-03-18 17:24:37 -0400] dstynchula: underscore!
[2014-03-18 17:24:54 -0400] dstynchula: ahh
[2014-03-18 17:24:55 -0400] stormerider: attributes get flattened with underscores, yes
[2014-03-18 17:24:59 -0400] dstynchula: I've been trying .
[2014-03-18 17:25:08 -0400] dstynchula: woot
[2014-03-18 17:25:17 -0400] dstynchula: that worked as expected! thank you!
[2014-03-18 17:25:24 -0400] stormerider: np! happy to help.
[2014-03-18 17:25:26 -0400] coderanger: you can also leave off the prefix if it is still unique
[2014-03-18 17:25:30 -0400] coderanger: for blah2:value
[2014-03-18 17:26:28 -0400] anthroprose: coderanger: can you elaborate on that?
[2014-03-18 17:26:50 -0400] coderanger: anthroprose: When a node gets expanded for search, nested attrs are added in several ways
[2014-03-18 17:27:06 -0400] coderanger: so node['foo]['bar']['baz'] = '1' gets added three times
[2014-03-18 17:27:15 -0400] coderanger: baz:1 bar_baz:1 foo_bar_baz:1
[2014-03-18 17:27:20 -0400] anthroprose: like.... "cluster_name:value and cluster_type:value" could be "name:value and type:value" but they are not unique
[2014-03-18 17:27:40 -0400] coderanger: Indeed, so that might return more things than you want
[2014-03-18 17:27:53 -0400] anthroprose: but cluster_clusternamename:value and cluster_clustertype:value could be clustername:value and clustertype:value
[2014-03-18 17:27:57 -0400] dstynchula: related: Why does chef use node[attribute][subattribute] sometimes and other times use attribute.subattribute and in still other cases use attribute_subattribute?
[2014-03-18 17:28:06 -0400] dstynchula: is there a rule for when to use which?
[2014-03-18 17:28:29 -0400] stormerider: dstynchula: i believe the _ is a lucene-specific use case
[2014-03-18 17:28:41 -0400] stormerider: (ie, search)
[2014-03-18 17:32:21 -0400] sam__: "depends" in metadata.rb  , and "include_recipe" in a recipe , seem to be vaguely related to each other.    the question is whether you might use only one, or only the other, or should always have both statements.
[2014-03-18 17:33:15 -0400] stormerider: sam__: if you include_recipe, you should depend on the cookbook. if you depend on the cookbook you can use LWRPs without having to use recipes.
[2014-03-18 17:36:46 -0400] sam__: hmm, ok
[2014-03-18 17:38:03 -0400] sam__: something else that I have been thinking about lately is versioning of cookbooks.    mostly I just have one set of cookbooks.    maybe I update the version in metadata.rb.   maybe I don't.     It's just one set of cookbooks without using versioning at all, really.
[2014-03-18 17:38:17 -0400] sam__: so the version setting isn't being used.
[2014-03-18 17:38:33 -0400] sam__: the question is, how would things look, if I implemented versioning somehow
[2014-03-18 17:38:46 -0400] sam__: I don't even see how it would work, too clearly
[2014-03-18 17:38:50 -0400] segv: anyone use something like cobbler to bootstrap hosts with chef?
[2014-03-18 17:38:51 -0400] stormerider: you should always bump versions if you want expected results when you run the chef-client.
[2014-03-18 17:39:06 -0400] stormerider: segv: you might want to look into chef-metal
[2014-03-18 17:39:33 -0400] stormerider: sam__: unless you mean versioning in terms of pinning versions in environments, which is a different beast
[2014-03-18 17:40:29 -0400] sam__: stormrider:  "bump versions if you want expected results"    .    if I don't bump versions, the latest cookbook still seems to get deployed
[2014-03-18 17:40:35 -0400] sam__: regardless
[2014-03-18 17:40:44 -0400] stormerider: sam__: the main problem with not versioning properly is that if the node has a cached version of the cookbook it will execute that because the server isnt telling the node to update it
[2014-03-18 17:41:07 -0400] stormerider: which leads to "it sometimes works, and sometimes doesnt" scenarios
[2014-03-18 17:41:47 -0400] segv: stormerider, hmmm looks nice!
[2014-03-18 17:41:49 -0400] sam__: I could be wrong, but I think that when I tweak cookbooks, an then run chef-client, it's getting the newest cookbook.   it's not using the cached version
[2014-03-18 17:42:01 -0400] segv: stormerider, oh man
[2014-03-18 17:42:03 -0400] segv: this is awesome
[2014-03-18 17:42:11 -0400] mjuszczak: srenatus: okay, thank ou
[2014-03-18 17:42:41 -0400] mjuszczak: coderanger: here
[2014-03-18 17:42:59 -0400] anthroprose: yeah, when I dev locally I rm -rf /var/chef/cache a alot when not using proper tools
[2014-03-18 17:43:02 -0400] stormerider: segv: i havent had time to look into it, since i'm doing everything with ec2/vms, but ive heard it mentioned a few times and it stuck in my head :)
[2014-03-18 17:43:09 -0400] coderanger: Somewhat
[2014-03-18 17:43:12 -0400] mjuszczak: coderanger: here's my dna.json file: http://pastebin.com/w61aY73U -- yet it isn't being picked up to override https://github.com/joerocklin/chef-mariadb/blob/master/attributes/server.rb ... I'm stumped.  Any thoughts on how I could debug?
[2014-03-18 17:43:14 -0400] segv: yeah, we're a primarily ec2 shop
[2014-03-18 17:43:15 -0400] coderanger: Trying to actually get work done today :)
[2014-03-18 17:43:17 -0400] segv: so that feature looks spot on
[2014-03-18 17:43:21 -0400] mjuszczak: coderanger: was an accident, didn't mean to hit enter :)
[2014-03-18 17:43:57 -0400] mjuszczak: coderanger: the kitchen.yaml file is here, and looks great: http://pastebin.com/upZEPkrr
[2014-03-18 17:43:57 -0400] coderanger: mjuszczak: You need to put stuff under the "normal" key for it to be included
[2014-03-18 17:43:58 -0400] sam__: let's say that you did version cookbooks.  would you keep multiple directories in your chef repository?  nagios.1 , nagios.2, nagios.3
[2014-03-18 17:44:12 -0400] coderanger: mjuszczak: dna.json contains more than just attrs
[2014-03-18 17:44:32 -0400] stormerider: sam__: i have the repo in git and just bump the version in metadata.rb
[2014-03-18 17:44:46 -0400] stormerider: if i want to revert, that's what git's for
[2014-03-18 17:44:56 -0400] sam__: so, just one directory
[2014-03-18 17:44:59 -0400] anthroprose: segv: are you already using cobbler for ec2 deploys?
[2014-03-18 17:45:03 -0400] sam__: and use git, only if necessary, to rollback
[2014-03-18 17:45:09 -0400] segv: anthroprose, no
[2014-03-18 17:45:10 -0400] mjuszczak: coderanger: hrm, but the first three variables (server_root_password, server_debian_password, server_repl_password) come through fine.  It's just the tunables that are being ignored.
[2014-03-18 17:45:14 -0400] segv: was looking for a solution
[2014-03-18 17:45:20 -0400] stormerider: right, there's no need to re-implement things that an SCM does for you
[2014-03-18 17:45:21 -0400] segv: Cobbler was the closest thing I could think of
[2014-03-18 17:45:33 -0400] anthroprose: segv: CloudFormation?
[2014-03-18 17:45:56 -0400] segv: Nope, we have another jenky utility that was made in house, that doesn't work with chef currently.
[2014-03-18 17:45:57 -0400] sam__: does chef-metal replace cobbler?
[2014-03-18 17:45:59 -0400] segv: And it's not worth the time.
[2014-03-18 17:46:09 -0400] segv: It will take A LOT of work to do any of that.
[2014-03-18 17:46:11 -0400] anthroprose: if you are already AWS, going CF+ASG you'll never go back
[2014-03-18 17:46:25 -0400] segv: asgard?
[2014-03-18 17:46:29 -0400] segv: I have it setup
[2014-03-18 17:46:39 -0400] anthroprose: asgard is good for huge enterprises
[2014-03-18 17:46:42 -0400] stormerider: we're a mix of ec2 and vmware, so we dont really lean on CFN
[2014-03-18 17:46:45 -0400] anthroprose: never used it personally
[2014-03-18 17:46:54 -0400] segv: anthroprose, we're not huge, probably < 2000 ec2 instances
[2014-03-18 17:47:02 -0400] coderanger: mjuszczak: Just try fixing the formatting in there
[2014-03-18 17:47:05 -0400] anthroprose: stormrider: 95% of my infra is in JSON ;)
[2014-03-18 17:47:18 -0400] stormerider: segv: that's... not small :)
[2014-03-18 17:47:24 -0400] anthroprose: segv: yeah, but if they are all in just a few clusters, thats small
[2014-03-18 17:47:36 -0400] mjuszczak: coderanger: What's wrong with the formatting?
[2014-03-18 17:47:39 -0400] anthroprose: asgard is for like, multiple departments all with different networking and app requirements, etc...
[2014-03-18 17:48:23 -0400] anthroprose: I run 1 template for networking,  and then 1 per whatever app/service layer yada
[2014-03-18 17:48:37 -0400] stormerider: anthroprose: most of our infra is in the cookbooks. but we're still bootstrapping our vm stack.
[2014-03-18 17:48:39 -0400] anthroprose: with duplicates for other regions or staging/dev envs, buy they are all the same template
[2014-03-18 17:48:43 -0400] coderanger: mjuszczak: Put the attributes under a key "normal"
[2014-03-18 17:49:00 -0400] stormerider: about 1/3 of the way bootstrapped, i think? some 50 ec2 nodes, some 500 vms.
[2014-03-18 17:49:02 -0400] anthroprose: stormrider: thats how my last place was, doing eip assignments from the cookbooks, etc....
[2014-03-18 17:49:23 -0400] stormerider: anthroprose: we use elasticbeanstalk to handle most of that kind of stuff.
[2014-03-18 17:49:33 -0400] anthroprose: and ya know, I probably should be
[2014-03-18 17:49:44 -0400] anthroprose: my current gig is just a python app
[2014-03-18 17:49:52 -0400] segv: stormerider, for what i've seen in ec2 it's tiny haha
[2014-03-18 17:49:59 -0400] anthroprose: last one was HUGE enterprise app+network+security/yada
[2014-03-18 17:50:24 -0400] stormerider: segv: well, like i said, we're about 50 ec2 nodes :P
[2014-03-18 17:50:29 -0400] mjuszczak: coderanger: I may be doing this entirely wrong, but like this: http://pastebin.com/xsTPP7nZ ?
[2014-03-18 17:50:32 -0400] segv: ah
[2014-03-18 17:50:53 -0400] anthroprose: segv: so what I do is use CF to setup autoscale groups, and then in the instance userdata, I download chef and use the CF s3 credentials to download the validator pem, and have all my nodes self-bootstrap
[2014-03-18 17:50:55 -0400] coderanger: mjuszczak: No, this wouldn't be in the kitchen.yml
[2014-03-18 17:51:01 -0400] coderanger: mjuszczak: Just in the dna.json
[2014-03-18 17:51:09 -0400] segv: hmmm
[2014-03-18 17:51:10 -0400] coderanger: mjuszczak: Or is this from TK running solo?
[2014-03-18 17:51:11 -0400] anthroprose: heavy use of report_handler and CF Resource triggers
[2014-03-18 17:51:13 -0400] mjuszczak: coderanger: Which is being generated from my kitchen.yaml
[2014-03-18 17:51:14 -0400] mjuszczak: yeah
[2014-03-18 17:51:23 -0400] coderanger: mjuszczak: Ahh, no idea then, sorry
[2014-03-18 17:52:35 -0400] mjuszczak: okay tank you :)
[2014-03-18 17:53:34 -0400] sam__: if you aren't using a virtual environment (EC2), but rather physical servers, how do you bootstrap new machines?
[2014-03-18 17:53:35 -0400] anthroprose: segv: and so that covers my networking, loadbalancer layer, cache layer, app layer, DB layer, monitoring/alerting/log aggregation/time series metrics/etc....
[2014-03-18 17:53:49 -0400] anthroprose: all with like 6 json files a 1 cookbook
[2014-03-18 17:54:19 -0400] anthroprose: sam: using knife bootstrap, or you can generate a custom image and pxe boot things
[2014-03-18 17:54:29 -0400] anthroprose: might not be the most secure (pxe)
[2014-03-18 17:54:50 -0400] sam__: knife bootstrap, to install the OS?
[2014-03-18 17:54:56 -0400] sam__: on hardware?
[2014-03-18 17:55:09 -0400] anthroprose: ah, no it has to have an OS
[2014-03-18 17:55:20 -0400] anthroprose: if no OS, the PXE or something traditional
[2014-03-18 17:55:28 -0400] anthroprose: nothing in the chef sphere that does that stuff
[2014-03-18 17:56:01 -0400] stormerider: sam__: chef-metal is aimed at helping bootstrap bare metal machines
[2014-03-18 17:56:09 -0400] anthroprose: I havn't seen a 'real' computer in years
[2014-03-18 17:56:17 -0400] anthroprose: stormrider: so I was checking out chef-metal
[2014-03-18 17:56:30 -0400] anthroprose: its currently doing what my Rake file and a custom resource is doing
[2014-03-18 17:56:40 -0400] anthroprose: how does it take into account OS level?
[2014-03-18 17:57:19 -0400] stormerider: anthroprose: i havent used it myself. as i said earlier... i've just seen discussions about it on IRC and the mailing list.
[2014-03-18 17:57:20 -0400] mjuszczak: coderanger: Would you find it OK to create a single "base" cookbook that has recipes like users.rb, sudo.rb, etc. -- or do you prefer to split even those out into separate repos?
[2014-03-18 17:57:40 -0400] anthroprose: stormrider: it runs provisioner commands, like using the fog library to call cloud APIs
[2014-03-18 17:57:51 -0400] coderanger: mjuszczak: For users in particular I usually keep that in its own thing because its a big, complex task
[2014-03-18 17:57:55 -0400] anthroprose: it dosn't 'talk' to hardware
[2014-03-18 17:58:37 -0400] anthroprose: its like saying you should use Vagrant to deploy your enterprise clusters
[2014-03-18 17:59:13 -0400] segv: haha
[2014-03-18 17:59:29 -0400] anthroprose: but don't get me wrong, I'm currently doing exactly what chef-metal is doing.... using Rake and a resource for swapping ssh keys/scp'n files around
[2014-03-18 17:59:30 -0400] stormerider: anthroprose: huh. my understanding is that it was aiming to be like vagrant for metal/pxe setups.
[2014-03-18 17:59:33 -0400] anthroprose: so it has a purpose ;)
[2014-03-18 17:59:51 -0400] stormerider: but, like i said, hadnt had time to look into it much myself :)
[2014-03-18 17:59:54 -0400] anthroprose: stormrider: aiming and current code are different, so we may just be talking about the same thing, different timelines
[2014-03-18 18:01:06 -0400] anthroprose: right now, its supports basic provisioning such as vagrant (using fog) and allows for counts of machines (multiples), precedence of runs, and multiple convergences
[2014-03-18 18:01:19 -0400] anthroprose: along with credential sharing and file/resource sharing (using ssh/scp)
[2014-03-18 18:01:30 -0400] anthroprose: at least thats my understanding of reading the code
[2014-03-18 18:05:57 -0400] garylabronz: can i get some help, making some ruby variables for a cookbook
[2014-03-18 18:06:03 -0400] garylabronz: http://pastebin.com/nVNtxZh7 that is basically waht im trying to do
[2014-03-18 18:06:12 -0400] garylabronz: i  just dont know how to make the ruby hash correct
[2014-03-18 18:07:58 -0400] anthroprose: not sure if you can just mass assign to array members like that
[2014-03-18 18:08:17 -0400] anthroprose: ah, thats txt
[2014-03-18 18:08:18 -0400] mjuszczak: coderanger: OK, thanks
[2014-03-18 18:08:35 -0400] garylabronz: sorry, yeah so the first is the actual subset of ssh config
[2014-03-18 18:08:44 -0400] garylabronz: then i have ruby, and what would be similar json
[2014-03-18 18:08:47 -0400] garylabronz: but the ruby is all wrong
[2014-03-18 18:09:25 -0400] sam__: gary, is that a recipe , an attributes file, a ruby script?
[2014-03-18 18:09:47 -0400] anthroprose: node.default['openssh']['client']['_host']['*']['GSSAPIAuthentication'] = 'yes'
[2014-03-18 18:09:49 -0400] anthroprose: or something
[2014-03-18 18:09:56 -0400] anthroprose: let me check the docs
[2014-03-18 18:10:02 -0400] garylabronz: for every var associated with host
[2014-03-18 18:10:08 -0400] garylabronz: ?*
[2014-03-18 18:10:30 -0400] anthroprose: you gotta .each do |h|
[2014-03-18 18:10:32 -0400] anthroprose: or something
[2014-03-18 18:11:02 -0400] anthroprose: you have to remember that node.default and related things are not actually Ruby objects
[2014-03-18 18:11:05 -0400] anthroprose: but chef dsl
[2014-03-18 18:11:15 -0400] anthroprose: many are immutable
[2014-03-18 18:12:04 -0400] magoo: so I'm using the database cookbook to manage database users and I have the use case now where my database is created locally in vagrant but we've migrated to RDS in staging/production. I'd like to just create the user manually in production and have Chef just test for the user and not create it in such a case. Looking for a clean way to do this
[2014-03-18 18:12:45 -0400] garylabronz: anthroprose: thanks, im trying it out
[2014-03-18 18:12:57 -0400] anthroprose: garyla: according to the documentation you want node.set["openssh"]["client"]["*"]["g_s_s_a_p_i_authentication"] =  "yes"
[2014-03-18 18:13:25 -0400] anthroprose: well, using ' not " sorry
[2014-03-18 18:13:45 -0400] anthroprose: node.set['openssh']['client']['*']['g_s_s_a_p_i_authentication'] =  'yes'
[2014-03-18 18:14:09 -0400] garylabronz: anthroprose: bringing the vm up, hpoefully ill get what i expect
[2014-03-18 18:14:32 -0400] anthroprose: garylabronz: using : incurs some specific behaviors
[2014-03-18 18:14:57 -0400] garylabronz: anthroprose: so i inherited this code, i dont like using the : have you got any links on it?
[2014-03-18 18:15:23 -0400] anthroprose: ill try & dig some up, essentially using : will return nil for nested attributes
[2014-03-18 18:15:30 -0400] anthroprose: so is very useful in some cases
[2014-03-18 18:15:53 -0400] anthroprose: it will also cause delayed evaluation until after convergence of other attributes, so could cause unexpected behavior if used in other ways
[2014-03-18 18:16:13 -0400] garylabronz: anthroprose: thanks
[2014-03-18 18:30:08 -0400] segv: anthroprose, weird that chef-metal install 'try it out' doesn't work
[2014-03-18 18:30:34 -0400] anthroprose: segv: alpha ;)
[2014-03-18 18:30:39 -0400] segv: very
[2014-03-18 18:30:41 -0400] anthroprose: i havnt even run it, just read the code
[2014-03-18 18:30:46 -0400] segv: just the chef-client part of it
[2014-03-18 18:30:49 -0400] segv: fails miserably
[2014-03-18 18:31:07 -0400] anthroprose: like I said, I'm currently using rake and a custom resource for multiple convergences
[2014-03-18 18:31:43 -0400] anthroprose: but chef-metal has error handling, and retries, and is proper
[2014-03-18 18:33:46 -0400] segv: ah
[2014-03-18 18:33:49 -0400] segv: if you have knife.rb in place
[2014-03-18 18:33:51 -0400] segv: and cookbook_path
[2014-03-18 18:33:53 -0400] segv: it fubars it
[2014-03-18 18:34:19 -0400] segv: i should add that to the docs
[2014-03-18 18:39:57 -0400] mjuszczak: coderanger: I'm in the middle of writing a blog post about my past four weeks going from knowing nothing about Chef to figuring out that the Berkshelf method, application cookbooks, not using roles, etc. (and how my puppet experience backfired on me in certain cases and helped in others).. would love your feedback once I'm done.
[2014-03-18 18:41:59 -0400] coalbe: mjuszczak: link?
[2014-03-18 19:00:37 -0400] mjuszczak: coalbe: writing it locally.  I'll paste it once I'm a bit further.
[2014-03-18 19:01:10 -0400] mjuszczak: Now here's an interesting issue.  Part of what I want to automate with my applicatoin cookbook is importing the schema for the app (or, is that not a good idea?).  But the schema is stored in github with the code.
[2014-03-18 19:01:14 -0400] coalbe: mjuszczak: cool, would love to see it. thought about writing something along the same lines.
[2014-03-18 19:01:45 -0400] n1ko: mjuszczak: and you cant pull from github because..?
[2014-03-18 19:02:11 -0400] mjuszczak: n1ko: as part of the chef run it pulls from github?
[2014-03-18 19:02:29 -0400] n1ko: yep
[2014-03-18 19:07:27 -0400] mjuszczak: n1ko: I guess via deploy keys?
[2014-03-18 19:07:50 -0400] anthroprose: i pull from github using deploy keys
[2014-03-18 19:07:55 -0400] anthroprose: they I store in s3
[2014-03-18 19:31:58 -0400] drywheat: what is the cleanest way to install a backport package in Chef?
[2014-03-18 19:36:47 -0400] coderanger: drywheat: with a package resource?
[2014-03-18 19:38:17 -0400] bbssysop: I can add cookbooks to hosts, and get them to work with default settings. I'm wondering how you go about specifying values for the build-in variables tho. For example the nginx-fastcgi cookbook. I want to apply it to web-server01, with an ip of x, and hostname of y. How do i do that from the commandline?
[2014-03-18 19:38:40 -0400] drywheat: sorry, i should have been more clear
[2014-03-18 19:39:21 -0400] drywheat: i want to install a backport package that is leveraged by another cookbook
[2014-03-18 19:39:38 -0400] drywheat: and i'm trying to think of how to do that cleanly
[2014-03-18 19:40:27 -0400] drywheat: (wrapper cookbook) install backport pkg and then invoke the orig ckbk?
[2014-03-18 19:41:24 -0400] coderanger: drywheat: Depends on the upstream cookbook
[2014-03-18 19:41:37 -0400] coderanger: drywheat: Usually you can just setup the repo and then specify the version via a node attr
[2014-03-18 19:42:51 -0400] drywheat: yeah, the upstream doesn't allow for a version. it just installs it flat by name
[2014-03-18 19:46:39 -0400] bbssysop: perhaps more generally. after i add the cookbook to the host,. how do i call out values, in the host, that will be picked up by the cookbook?
[2014-03-18 19:47:29 -0400] bbssysop: for argument sake,. perhaps setting the nameserver to 4.2.2.2?
[2014-03-18 19:49:14 -0400] anthroprose: bbssysop: I generate an init.json that I use with chef-client -j in conjunction with the chef server environments and cookbook attributes
[2014-03-18 19:49:20 -0400] anthroprose: for very node specific data
[2014-03-18 19:51:38 -0400] RR|Here_: I'm using chef to do a an SVN checkout on a Windows machine. The svn client uses exit code 42 when it exits (42 on windows generally means success) but the built in subversion provider explicitly expects an exit code of 0, and bombs even though the command was successful.
[2014-03-18 19:51:46 -0400] RR|Here_: Not really sure what to do about this
[2014-03-18 19:52:53 -0400] coderanger: drywheat: You can use chef-rewind to patch that live, or just fork and submit a pull req
[2014-03-18 19:54:12 -0400] Cuzner: Can anyone tell me why on a knife search, every match is followed a whitespace CR? For example: knife search node -i 'run_list:*mycookbook*'
[2014-03-18 19:54:53 -0400] helfire: is there a way to tell chef not to bootstrap when using knife openstack? i already have chef-client baked into the image
[2014-03-18 19:54:53 -0400] shawn_sher: RR: you could wrap a script around svn and fix the return code
[2014-03-18 19:54:58 -0400] Cuzner: It makes it extremely frustrating when trying to wc -l that list. Is there a switch I can use to eliminate the whitespace lines in the output?
[2014-03-18 19:55:12 -0400] coderanger: Cuzner: Why not use knife exec?
[2014-03-18 19:56:28 -0400] Cuzner: i guess i could run it in a script, but I was hoping search could take care of my needs...
[2014-03-18 19:56:50 -0400] RR|Here_: Yeah I guess that's an option. I would prefer to fix Chef than to bodge up a wrapper though
[2014-03-18 19:57:03 -0400] coderanger: Cuzner: knife exec -E 'puts search(:node, "*:*").length'
[2014-03-18 19:57:12 -0400] coderanger: Not sure that counts as a wrapper :-)
[2014-03-18 19:57:50 -0400] drywheat: i think i like the latter approach. thanks.
[2014-03-18 19:59:26 -0400] Cuzner: coderanger: I'm going to have to brush up on my ruby, thanks... this is helpful.
[2014-03-18 19:59:43 -0400] coderanger: Cuzner: knife is _not_ something you should be using the output from for machine ingestion, it is a human facing tool
[2014-03-18 19:59:52 -0400] coderanger: Cuzner: Real APIs are provided for scripting
[2014-03-18 19:59:54 -0400] RR|Here_: can I redefine handle_command_failures(...) somewhere? I'm new to both Chef and Ruby
[2014-03-18 19:59:58 -0400] Cuzner: got it
[2014-03-18 20:00:46 -0400] bbssysop: anthroprose: do you have output of an example of setting that up? i just need to see the process once and i'm good to go. If you can.
[2014-03-18 20:02:09 -0400] coderanger: RR|Here_: So you could monkey patch it, but its going to be helladamn fragile :-/
[2014-03-18 20:02:33 -0400] mattsmith: anyone out there have knife-ec2 running on osx 10.9.2, xcode 5.1?
[2014-03-18 20:02:39 -0400] bbssysop: anthroprose: i have the knife bootstrap bit,. then i do a knife node run_list to add the cookbook. From there where do i head?
[2014-03-18 20:02:39 -0400] RR|Here_: That doesn't sound particularly ideal either
[2014-03-18 20:02:47 -0400] mattsmith: I can not get the gem to install at all
[2014-03-18 20:03:30 -0400] coderanger: RR|Here_: http://hastebin.com/pasukuheqa.rb
[2014-03-18 20:03:42 -0400] coderanger: RR|Here_: Not at all tested, but try dropping that in to a library file in your cookbook
[2014-03-18 20:04:46 -0400] RR|Here_: Thanks, gives me something to work with
[2014-03-18 20:05:31 -0400] coderanger: RR|Here_: Ahh, that is actually a cleaner way
[2014-03-18 20:05:32 -0400] coderanger: one sec
[2014-03-18 20:07:31 -0400] coderanger: RR|Here_: http://hastebin.com/runucuriqo.rb
[2014-03-18 20:07:42 -0400] coderanger: That should be much less fragile (assuming I didn't typo anything)
[2014-03-18 20:09:13 -0400] RR|Here_: I'll see how I get on. I should probably raise a bug for this anyway. This is just the built in provider, and the opscode subversion cookbook. Probably just wasn't tested on this platform (some return 0, some 42)
[2014-03-18 20:09:28 -0400] coderanger: RR|Here_: Indeed
[2014-03-18 20:09:40 -0400] coderanger: Windows is niche, Svn is also niche :)
[2014-03-18 20:09:48 -0400] coderanger: Probably just not a lot of overlap
[2014-03-18 20:10:29 -0400] RR|Here_: The setup is niche requirement followed by niche requirement. First hurdle so far though, not too bad
[2014-03-18 20:11:06 -0400] coderanger: RR|Here_: You can also, as a really big hammer, set ignore_failure true on the resource
[2014-03-18 20:11:11 -0400] coderanger: but that will ignore actual errors too
[2014-03-18 20:14:28 -0400] bbssysop: how do you add override attributes to a node from the command line?
[2014-03-18 20:15:14 -0400] coderanger: bbssysop: You cannot
[2014-03-18 20:15:25 -0400] coderanger: bbssysop: You can only set per-node things at the normal level
[2014-03-18 20:15:37 -0400] coderanger: bbssysop: You need to use a role, environment, or cookbook to set default/overrides
[2014-03-18 20:17:26 -0400] bbssysop: coderanger: so a cookbook, that takes variable overrides,. will not check the node for overrides?
[2014-03-18 20:17:55 -0400] coderanger: bbssysop: So to expand a bit, there are 4 levels, default, normal, override, and automatic
[2014-03-18 20:18:22 -0400] coderanger: At the start of each run, default and override are wiped clean and rebuilt from the roles/envs/cookbooks
[2014-03-18 20:18:39 -0400] coderanger: This handles situations where a role used to set a default attr but doesn't now
[2014-03-18 20:18:55 -0400] coderanger: only the normal level isn't wiped, so setting anything else on the node wouldn't accomplish anything
[2014-03-18 20:19:00 -0400] mjuszczak: coderanger: with the berkshelf method, where do attributes go?  Right now I see that inside the roles, there are attributes sections. For instance, default_attributes() sections with JSON.
[2014-03-18 20:19:14 -0400] coderanger: (automatic is also wiped, but it is only set my ohai so you normally never notice it)
[2014-03-18 20:19:27 -0400] coderanger: mjuszczak: In the cookbook
[2014-03-18 20:20:39 -0400] bbssysop: coderanger: what is the preferred way of having pushing an attribute that is different on every node then? make a role for every node?
[2014-03-18 20:20:46 -0400] iiro: about overrides... This must be a basic issue but I still cannot get things right... Im trying to do a wrapper cookbook for apache2 (and actually to nagios client too using nagios cookbook) - trying to follow this: http://www.getchef.com/blog/2013/12/03/doing-wrapper-cookbooks-right/ - but nope, my requested values arenot coming...
[2014-03-18 20:21:23 -0400] iiro: bbssysop, what kind of use would that be...?
[2014-03-18 20:22:00 -0400] coderanger: bbssysop: Set it at the normal level?
[2014-03-18 20:23:11 -0400] bbssysop: i have 20 different web servers, that host 20 different urls, so im thinking that i have to set that per node.
[2014-03-18 20:23:46 -0400] iiro: ok
[2014-03-18 20:25:05 -0400] RR|Here_: "wrong number of arguments (1 for 0)" with the run_options change
[2014-03-18 20:25:28 -0400] RR|Here_: presumably thats an argument passed to something that didn't want it, though i don't know enough Ruby to know what it was doing int he first place
[2014-03-18 20:26:06 -0400] iiro: sounds like it yes...
[2014-03-18 20:27:12 -0400] coderanger: RR|Here_: Derp, right, add *args :)
[2014-03-18 20:27:37 -0400] coderanger: RR|Here_: http://hastebin.com/muhijojewi.rb
[2014-03-18 20:27:56 -0400] coderanger: bbssysop: Thats one way to do it, I would make roles for them though
[2014-03-18 20:28:03 -0400] coderanger: bbssysop: special snowflakes are the enemy :)
[2014-03-18 20:28:19 -0400] iiro: I would make roles on them too...
[2014-03-18 20:28:30 -0400] iiro: s/on/for
[2014-03-18 20:28:40 -0400] shawn_sher: Make cookbooks for them all!
[2014-03-18 20:28:44 -0400] bbssysop: agreed. thats my sitch tho.
[2014-03-18 20:30:11 -0400] iiro: I`m puzzled with that wrapper-default-attributes thing... Isnt that the preferred way to do the wrapper cookbooks...?
[2014-03-18 20:30:35 -0400] coderanger: iiro: Please pastebin your code
[2014-03-18 20:30:48 -0400] iiro: coderanger, sure...
[2014-03-18 20:34:58 -0400] iiro: coderanger, https://gist.github.com/iiro/1a05930325011641d9d8
[2014-03-18 20:37:25 -0400] coderanger: iiro: Are you certain you are using mpm_prefork?
[2014-03-18 20:37:39 -0400] jchauncey: i have a resource which calls two other resources. These other resources (template and a custom resource we will call foo) both notify my resource (bar) to and call restart. it seems that everything works correctly the first time through and the restart action is only called once. however, if the template and foo change the next time through it will call restart twice. is there a way to insure that the call only happens ocne?
[2014-03-18 20:38:32 -0400] coderanger: jchauncey: If you use the default delayed notification they should be batched at the end of the cycle
[2014-03-18 20:38:42 -0400] iiro: coderanger, yep. Im also trying to override for example this one: default['apache']['proxy']['allow_from'] = 'localhost'
[2014-03-18 20:38:43 -0400] coderanger: jchauncey: Are you using use_inline_resources?
[2014-03-18 20:38:53 -0400] iiro: coderanger, same thing happens...
[2014-03-18 20:39:05 -0400] coderanger: iiro: Do you have depends 'apache2' in your wrapper's metadata?
[2014-03-18 20:39:24 -0400] iiro: coderanger, yep
[2014-03-18 20:39:29 -0400] coderanger: iiro: alternatively, run chef-client -l debug and it will print out the order it runs attribute files in
[2014-03-18 20:39:32 -0400] mjuszczak: coderanger: so attributes.rb?
[2014-03-18 20:39:35 -0400] jchauncey: coderanger: yeah
[2014-03-18 20:39:41 -0400] coderanger: mjuszczak: attributes/default.rb, yeah
[2014-03-18 20:39:42 -0400] iiro: coderanger, ok, Ill try that
[2014-03-18 20:39:45 -0400] jchauncey: im trying something else really quick to make sure im not just relaly stupid
[2014-03-18 20:39:49 -0400] coderanger: jchauncey: :-(
[2014-03-18 20:39:56 -0400] coderanger: jchauncey: use_inline_resources is rather broken
[2014-03-18 20:40:17 -0400] coderanger: jchauncey: If you want a better version, I can show you how to use Poise's helper for this
[2014-03-18 20:40:35 -0400] coderanger: I guess broken is the wrong word, use_inline_resources is just really limited
[2014-03-18 20:41:04 -0400] jchauncey: haha
[2014-03-18 20:41:13 -0400] jchauncey: another guy on my team is neck deep in poise right now
[2014-03-18 20:41:31 -0400] coderanger: jchauncey: Feel free to mock me for not having docs
[2014-03-18 20:41:33 -0400] coderanger: I am fail :-(
[2014-03-18 20:41:35 -0400] jchauncey: im rather limited on time on getting thsi to work since ive already refactored it once. I would much rather this install be a HWRP
[2014-03-18 20:41:58 -0400] jchauncey: he says you need to get your shit in line before your talk
[2014-03-18 20:42:14 -0400] coderanger: That I do, need to write my PyCon ones first though
[2014-03-18 20:42:40 -0400] jchauncey: =)
[2014-03-18 20:43:57 -0400] coderanger: jchauncey: Basically because each use_inline_resources action is a fully isolated run, delayed notifications will fire at the end of that
[2014-03-18 20:44:04 -0400] coderanger: instead of at the global end
[2014-03-18 20:44:36 -0400] woltage: iiro: hilight! :D
[2014-03-18 20:44:43 -0400] woltage: You should change your nick ;)
[2014-03-18 20:44:47 -0400] iiro: woltage, surpirse ;)
[2014-03-18 20:44:51 -0400] iiro: woltage, cannot do that :)
[2014-03-18 20:45:03 -0400] jchauncey: yeah
[2014-03-18 20:45:19 -0400] jchauncey: and it seems that two instnaces of the same resource are being call
[2014-03-18 20:45:30 -0400] coderanger: jchauncey: Yep
[2014-03-18 20:45:39 -0400] jchauncey: basically i do bar action :nothing then my template and foo resource call notify for :restart on that resource
[2014-03-18 20:45:57 -0400] jchauncey: all kinds of fail is happening
[2014-03-18 20:46:30 -0400] tubbo: has anyone ever made a knife plugin for building servers using PXE?
[2014-03-18 20:46:49 -0400] coderanger: tubbo: Not a knife plugin, but there is the pxe_dust cookbook
[2014-03-18 20:47:21 -0400] tubbo: coderanger: yeah i was looking at that, and i'm not really sure how it works at all. is it supposed to be for building a pxe server? how would it hook into a `knife bootstrap` command?
[2014-03-18 20:47:59 -0400] coderanger: tubbo: You wouldn't, knife bootstrap is for installing chef, not related to booting a new physical machine
[2014-03-18 20:48:14 -0400] coderanger: There are commands for doing that on most public cloud systems, but they generally have their own imaging systems
[2014-03-18 20:48:51 -0400] Cuzner: then I just power them on and bootstrap
[2014-03-18 20:48:57 -0400] tubbo: coderanger: ah that's true, but it does in fact run chef. so let's say i have a pxe server already built, outside of chef. what i really want here is a single action to build a server. i have its MAC address, but basically i just racked the box and i want to now build it as a particular role.
[2014-03-18 20:49:17 -0400] coderanger: tubbo: Look at projects like Razor or Crowbar
[2014-03-18 20:49:56 -0400] coderanger: tubbo: Those things can call chef, but they are working at a different layer of the system
[2014-03-18 20:50:04 -0400] coderanger: chef is not a provisioning system
[2014-03-18 20:50:15 -0400] coderanger: (or at best, a really bad one)
[2014-03-18 20:51:16 -0400] macros: tubbo: I've written something like this around data bags in a chef server, but still in process of being prepped for an open source release
[2014-03-18 20:51:32 -0400] macros: Planning to open as part of my chefconf talk next month
[2014-03-18 20:52:01 -0400] coderanger: warning: use of macros' software may result in an inexplicable urge to recompile your kernel
[2014-03-18 20:52:01 -0400] coderanger: ;-)
[2014-03-18 20:52:05 -0400] macros: Razor is probably a better idea
[2014-03-18 20:52:24 -0400] macros: I just can't deal with all the support infrastructure for it, and have to deploy this in 20+ data centers
[2014-03-18 20:52:48 -0400] macros: I would just use it if I could
[2014-03-18 20:52:59 -0400] coderanger: I've not touched real hardware in so long I don't really remember all that stuff
[2014-03-18 20:53:13 -0400] coderanger: I just hand Amazon a blank check and then some bad computers show up
[2014-03-18 20:53:19 -0400] macros: I use ipxe so I can get into http land as fast as possible
[2014-03-18 20:53:30 -0400] tubbo: macros: cool :) still trying to get my company to send me to chefconf
[2014-03-18 20:53:39 -0400] macros: To hell with writing a ruby tftp server
[2014-03-18 20:53:52 -0400] iiro: coderanger, checked through the debug log, it really looks its not going through the wrapper cookbooks attributes/default.rb at all...
[2014-03-18 20:54:04 -0400] coderanger: iiro: What does your run list look like?
[2014-03-18 20:54:19 -0400] tubbo: coderanger: interesting. i thought razor was a part of puppet
[2014-03-18 20:54:35 -0400] tubbo: crowbar looks cool, but it seems coupled to openstack. we don't use openstack right now (but we want to)
[2014-03-18 20:54:50 -0400] coderanger: tubbo: Made bt puppetlabs, but not tied to puppet
[2014-03-18 20:54:51 -0400] iiro: coderanger, the wrapper cookbook is mentioned as the last one of the runlist...
[2014-03-18 20:55:00 -0400] coderanger: tubbo: Just like you can use mcollective with Chef
[2014-03-18 20:55:16 -0400] coderanger: (or pushy with Puppet for that matter)
[2014-03-18 20:55:30 -0400] coderanger: iiro: Can you pastebin the exact runlist?
[2014-03-18 20:55:37 -0400] coderanger: iiro: via knife node show
[2014-03-18 20:55:43 -0400] iiro: sure
[2014-03-18 20:56:56 -0400] sharpyy: Hello Chef Folks, I m having an array attribute that I need to update from multiple cookbooks by adding values to it. How do you perform such thing? Currently, my array attribute seems being overwritten instead of merged.
[2014-03-18 20:57:06 -0400] coderanger: sharpyy: really really don't do that
[2014-03-18 20:57:28 -0400] coderanger: sharpyy: https://coderanger.net/2013/06/arrays-and-chef/ shows two better ways
[2014-03-18 20:57:41 -0400] sharpyy: thanks I ll read that
[2014-03-18 20:57:48 -0400] iiro: coderanger, I updated it to the gist link...
[2014-03-18 20:57:53 -0400] iiro: coderanger, as a comment...
[2014-03-18 20:59:35 -0400] coderanger: iiro: Do you see that cookbook loading at all?
[2014-03-18 21:00:54 -0400] iiro: coderanger, yes I see its getting loaded
[2014-03-18 21:01:13 -0400] coderanger: iiro: Okay, next question, are you certain you've upload the cookbook correctly?
[2014-03-18 21:02:16 -0400] iiro: should be but lets verify...
[2014-03-18 21:02:32 -0400] iiro: running out of options...
[2014-03-18 21:02:40 -0400] RR|Here_: your code correctly adds the return code, and the command runs thanks coderanger
[2014-03-18 21:03:16 -0400] RR|Here_: the next hurdle, is that one of the methods in subversion.rb has this little assumption ... unless [0,1].include?(status.exitstatus)
[2014-03-18 21:03:29 -0400] RR|Here_: I will just have to patch that one
[2014-03-18 21:05:15 -0400] tubbo: coderanger: pretty neat.
[2014-03-18 21:05:27 -0400] tubbo: coderanger: still gotta figure out whether we want to do openstack or just use razor and bare pxe
[2014-03-18 21:05:41 -0400] tubbo: we make appliances so we *need* a bare-metal option
[2014-03-18 21:05:58 -0400] coderanger: tubbo: how bare metal is bare metal?
[2014-03-18 21:06:04 -0400] coderanger: tubbo: Nova supports LXC just fine
[2014-03-18 21:06:35 -0400] coderanger: and Icehouse will be shipping a Heat driver for Docker
[2014-03-18 21:06:55 -0400] tubbo: coderanger: right now, it's as bare as jenna jamison in my wildest dreams.
[2014-03-18 21:07:15 -0400] tubbo: coderanger: but we are attempting to move over to LXC in the future.
[2014-03-18 21:07:38 -0400] iiro: coderanger, upload is working fine and I can see the cached cookbook with the attributes/default.rb file but still no action happening...
[2014-03-18 21:07:43 -0400] coderanger: tubbo: Please refrain from that kind of comment, this is place that must be welcoming to all
[2014-03-18 21:07:53 -0400] tubbo: coderanger: lol sorry
[2014-03-18 21:10:24 -0400] eliklein: hey there, is anyone aware of a knife ssh type plugin that will treat concurrency differently such that if a command on the first node in a set of 3 fails, knife ssh will stop?
[2014-03-18 21:10:48 -0400] coderanger: eigenjoy: fabric?
[2014-03-18 21:11:07 -0400] eliklein: coderanger: hahah, that's rather heavyweight.
[2014-03-18 21:11:32 -0400] eliklein: it's also python, which i'd rather not involve at this point
[2014-03-18 21:11:49 -0400] eliklein: hoping for something super lightweight that just extends knife ssh
[2014-03-18 21:13:10 -0400] anthroprose: eliklein: you can create a state machine in the node attributes and use chefserver or databags to move em around between nodes ;)
[2014-03-18 21:14:09 -0400] anthroprose: or use the report_handlers to feed a status somehow
[2014-03-18 21:14:29 -0400] adnichols: or.. just knife ssh one node at a time...
[2014-03-18 21:14:30 -0400] eliklein: haha, all i'm after is the return code via ssh
[2014-03-18 21:14:50 -0400] eliklein: ok, forget i asked anything :)
[2014-03-18 21:15:03 -0400] anthroprose: hehehe
[2014-03-18 21:17:00 -0400] rdobbs: @coderanger thanks for the help esterday, it took 6 hours but I eventually gbot the dependncies fixed up.
[2014-03-18 21:17:27 -0400] rdobbs: and I cloned every repo, and only pully locally, and aliases "berk update" to respond with profanities.
[2014-03-18 21:31:41 -0400] coderanger: rdobbs: Protip, unless you _know_ you are uploading multiple cookbooks, use knife cookbook upload -o .. --freeze <name>
[2014-03-18 21:38:54 -0400] eliklein: wah, i thought maybe knife[:on_error] = :raise might do what i wanted.. but it doesn't seem to cause knife ssh to blow up proper like
[2014-03-18 21:44:35 -0400] magoo: node.run_list.include?('recipe[cookbook::recipe]') doesn't seem to find a recipe that I'm certain exists
[2014-03-18 21:44:47 -0400] magoo: for the current node
[2014-03-18 21:45:03 -0400] helfire: is there a way to tell which recipe included another recipe?
[2014-03-18 21:46:52 -0400] coderanger: helfire: No
[2014-03-18 21:47:07 -0400] coderanger: magoo: node['recipes'].include?('cookbook::recipe')
[2014-03-18 21:47:47 -0400] helfire: coderanger: cool, didnt think so.
[2014-03-18 21:48:11 -0400] coderanger: helfire: include_recipe is unfortunately very much a fire-and-forget kind of thing
[2014-03-18 21:48:22 -0400] helfire: someone was asking if there were "private" recipes. If you could see who included it, you could write a little code to make it private, but i dont even know if thats valueable
[2014-03-18 21:51:07 -0400] magoo: coderanger: thanks, that took care of it
[2014-03-18 21:51:30 -0400] coderanger: helfire: You couldn't prevent them from being run directly anyway
[2014-03-18 21:51:38 -0400] coderanger: helfire: Private anything is a convention
[2014-03-18 21:54:46 -0400] tayworm: im having a weird problem with chef/vagrant and I'm hoping someone has run across this before:
[2014-03-18 21:55:08 -0400] tayworm: https://gist.github.com/anonymous/03dd97eeb2169b2604e1
[2014-03-18 21:55:34 -0400] tayworm: specifically what is that Errno::EINVAL error?
[2014-03-18 22:05:10 -0400] dgarstang: Seems like I am the only person that doesn't like having to put stuff related to a cookbook _outside_ the cookbook.
[2014-03-18 22:09:15 -0400] freerobby: If I have a resource/provider that saves settings somewhere, and then the recipe generates a file based on those settings, but I don't want them persisted as node attributes, where is the best way to keep those settings stored?
[2014-03-18 22:15:10 -0400] someara: freerobby: https://github.com/someara/ldap-cookbook/blob/master/providers/record.rb#L50
[2014-03-18 22:27:29 -0400] dgarstang: Seems like I am the only person that doesn't like having to put stuff related to a cookbook _outside_ the cookbook.
[2014-03-18 22:30:58 -0400] tayworm: dgarstang: seems like you said that same thing a little bit earlier haha
[2014-03-18 22:31:07 -0400] dgarstang: tayworm: Indeed
[2014-03-18 22:31:56 -0400] dgarstang: It just really bothers me having to put environment overrides in a totally separate place to the cookbook
[2014-03-18 22:32:06 -0400] dstynchula: Anyone know how to use become_node in chef-shell?
[2014-03-18 22:41:45 -0400] troyready: dgarstang, I'm pretty sure you don't *have* to do anything like that
[2014-03-18 22:44:00 -0400] troyready: But the existence of environments and roles does sort of iincentivize it
[2014-03-18 22:46:56 -0400] daxroc: Is using node.automatic_attrs["hostname"] = hostname a valid way to override ohai data in a reload ?
[2014-03-18 22:59:05 -0400] dgarstang: troyready: I do... for a simple application cookbook, the attributes.rb file has some dev defaults. If I want to override for prod, I have to go put those override values outside the cookcook in a seoarate repo under /environments.
[2014-03-18 22:59:55 -0400] troyready: Or set different attributes for the node in the cookbook recipe if you really don't want to use environments
[2014-03-18 23:00:40 -0400] dgarstang: troyready: default['cookbooks']['prod'] = {} and default['cookbooks']['dev'] = {} kinda stuff?
[2014-03-18 23:01:32 -0400] dgarstang: troyready: of course, then I have to explicitly qualify every access with node['cookbook'][chef.environment]
[2014-03-18 23:01:39 -0400] dgarstang: ugly
[2014-03-18 23:02:02 -0400] troyready: Such is flexibility
[2014-03-18 23:02:37 -0400] dgarstang: troyready: I'm sure that's not considered the best way to do it, yet cookbooks are supposed to be self contained units of software. Those two seem at odds.
[2014-03-18 23:03:49 -0400] dstynchula: repost: anyone know how to use become_node in chef-shell?
[2014-03-18 23:04:03 -0400] troyready: I disagree, but I can see how a very strict interpretation of the idea could almost seem like that
[2014-03-18 23:04:12 -0400] daxroc: dgarstang: Not sure that is what troyready ment be set them per node. You can override the attributes per node outside the cookbook  and not in an environment. If you have a better way to do it submit a patch.
[2014-03-18 23:04:50 -0400] dgarstang: daxroc: I don't want to override outside the cookbook. That means the cookbook is no longer a decoupled unit of software.
[2014-03-18 23:05:26 -0400] daxroc: So you want customisation but don't want it  explain your problem better.
[2014-03-18 23:06:24 -0400] anthroprose: dgarstang: I think alot of these things would be best solved with a custom lwrp, so you only have to do node['cookbook'][chef.environment] in one place, and then use more normalized resource structures elsewhere
[2014-03-18 23:06:58 -0400] dgarstang: daxroc: Ugh. Simple app cookbook. attributes/defaults.rb has settings for dev. If I want to override for another environment like prod or stage, I have to go OUTSIDE the cookbook to a DIFFERENT git repo, and edit a file in /environments. That's not very obvious ot clear. it's not even clear what attributes are used by what cookbooks at that point.
[2014-03-18 23:08:07 -0400] dgarstang: anthroprose: I suppose... and simulate all environments in the local attributes/default.rb you mean?
[2014-03-18 23:08:54 -0400] daxroc: You could check the environment of the node and load a different eg: production.rb attributes file.
[2014-03-18 23:09:20 -0400] dgarstang: daxroc: you can load something besides default.rb? *googles*
[2014-03-18 23:09:41 -0400] anthroprose: they are auto-loaded in alpha order
[2014-03-18 23:09:51 -0400] anthroprose: so if you do multiples, first one wins
[2014-03-18 23:09:55 -0400] dgarstang: oh jeez
[2014-03-18 23:10:11 -0400] anthroprose: so what I do for what you are saying
[2014-03-18 23:10:27 -0400] anthroprose: like, I have a different production/staging value for cache,db,alert queue
[2014-03-18 23:10:47 -0400] anthroprose: the cookbook defaults to dev values (mostly localhost)
[2014-03-18 23:11:17 -0400] dgarstang: so I could do  include_attribute "cookbook::#{chef.environment}" ?
[2014-03-18 23:11:22 -0400] anthroprose: but in my cause, using AWS and CloudFormation... AWS & CF *KNOW* the values of cache, db, alert queue, so I just feed those to an /etc/chef/init.json
[2014-03-18 23:11:31 -0400] anthroprose: which I then use with chef-client -j
[2014-03-18 23:11:45 -0400] dgarstang: screw environments then
[2014-03-18 23:11:58 -0400] anthroprose: environments control cookbook versions
[2014-03-18 23:12:08 -0400] anthroprose: unless you just really only use chef for 1 webapp or something
[2014-03-18 23:12:13 -0400] anthroprose: what is 'production'
[2014-03-18 23:12:16 -0400] dgarstang: i suppose I'd still put a node into an env so I knew which attribute file to load
[2014-03-18 23:13:03 -0400] daxroc: anthroprose wouldn't seting them as override and using include_attribute give the mentioned effect ? not ideal but 
[2014-03-18 23:13:29 -0400] anthroprose: daxroc: in my case they are dynamically generated before chef runtime, so I do not know their values
[2014-03-18 23:13:43 -0400] anthroprose: a machine stands up, and I dunno who/where/whatever.... but AWS does
[2014-03-18 23:13:47 -0400] anthroprose: so I let it tell chef
[2014-03-18 23:14:27 -0400] dgarstang: hang on... can I put multiple attribute files in attributes?
[2014-03-18 23:14:54 -0400] anthroprose: daxroc: in my wrapper cookbooks, I do things like that for overriding other cookbooks depending on what recipe is being run
[2014-03-18 23:14:58 -0400] anthroprose: like master/slave configs
[2014-03-18 23:15:51 -0400] anthroprose: dgarstang: https://github.com/opscode-cookbooks/mysql/blob/master/libraries/helpers.rb
[2014-03-18 23:15:58 -0400] daxroc: I follow, but isn't that more getting dynamic configuration attributes from ohai ?
[2014-03-18 23:16:02 -0400] dgarstang: If I try and use include_attribute... it won't matter, becaue according to the docs, they will all be loaded in order anyway
[2014-03-18 23:16:28 -0400] anthroprose: daxroc: I would have to write a custom ohai plugin to get the info I need
[2014-03-18 23:16:43 -0400] dgarstang: anthroprose: thanks, no idea what's going on there. ruby and my eyes don't get along
[2014-03-18 23:16:46 -0400] daxroc: anthroprose: That's why there are plugins :D
[2014-03-18 23:16:46 -0400] anthroprose: daxroc: and im using CloudFormation, so it already knows the info, and CF is what runs chef-client
[2014-03-18 23:17:02 -0400] anthroprose: so why query when I already have the source before the run?
[2014-03-18 23:17:09 -0400] anthroprose: i mean, for non-CF users, totally
[2014-03-18 23:17:23 -0400] daxroc: anthroprose: I'm all about dry ..
[2014-03-18 23:18:22 -0400] dgarstang: dunno what this means 'Cannot find a resource for include_attribute on ubuntu version 12.04'
[2014-03-18 23:19:14 -0400] anthroprose: daxroc: https://gist.github.com/anthroprose/7584b4af3bdb4389d551
[2014-03-18 23:19:20 -0400] anthroprose: thats how I launch my web nodes currently
[2014-03-18 23:20:11 -0400] dgarstang: and "Cannot find a resource for include_attributes on ubuntu version 12.04"
[2014-03-18 23:20:54 -0400] drywheat: when using the "remote_file" resource, what is the difference between the :create and :create_if_missing actions?
[2014-03-18 23:21:02 -0400] daxroc: dgarstang: http://docs.opscode.com/essentials_cookbook_attribute_files.html
[2014-03-18 23:21:29 -0400] dgarstang: daxroc: Yep, that's what I'm following
[2014-03-18 23:21:36 -0400] drywheat: i assume the resource will abstain from pulling the remote file if it already existed
[2014-03-18 23:21:45 -0400] dgarstang: it doesn't like include_attributes "bc-downloader::#{node.chef_environment}"
[2014-03-18 23:21:51 -0400] dgarstang: or the non plural
[2014-03-18 23:22:11 -0400] coderanger: dgarstang: You can't use include_attributes in a recipe file
[2014-03-18 23:22:22 -0400] coderanger: dgarstang: All attribute files are already loaded and processed by the time recipes run
[2014-03-18 23:22:29 -0400] dgarstang: coderanger: where does it go? I don't think the doc mentions where
[2014-03-18 23:22:31 -0400] coderanger: dgarstang: In general you don't need include_attributes
[2014-03-18 23:22:56 -0400] freerobby: someara: Thanks. Any in-process altneratives instead of LDAP?
[2014-03-18 23:22:59 -0400] dgarstang: coderanger: Ugh. i'm trying to avoid splattering config for a cookbook in multiple repos and I want to put prod, stage etc in the cookbook itself
[2014-03-18 23:23:08 -0400] daxroc: drywheat: from what I understand create_if_missing will only place the file if it's missing where as create will place the file if it's missing and if the files are different. Neither verify the files with the checksum.
[2014-03-18 23:23:23 -0400] someara: freerobby I was just pointing to the technique in the provider
[2014-03-18 23:23:24 -0400] coderanger: dgarstang: All attribute files for all cookbooks are always loaded, if you want conditionals it has to be in each file
[2014-03-18 23:23:29 -0400] maniacal: dgarstang: you can use case statements in your attributes file
[2014-03-18 23:24:01 -0400] maniacal: so it will only load the attributes you want for that environment
[2014-03-18 23:24:15 -0400] dgarstang: coderanger: so how would one make that work with an attribues/prod.rb, stage.rb etc?
[2014-03-18 23:24:21 -0400] coderanger: freerobby: You can store them anywhere you want, just grab the postgres gem or whatever
[2014-03-18 23:24:34 -0400] coderanger: dgarstang: Are the top of each "return unless node.chef_environment == ''"
[2014-03-18 23:24:34 -0400] dgarstang: maniacal: do you happen to have an example of that somewhere?
[2014-03-18 23:24:53 -0400] dgarstang: coderanger: oic. that's sneaky
[2014-03-18 23:25:42 -0400] maniacal: dgarstang: sounds like what coderanger said will work.  otherwise you can do a single attributes file, and put in     case node['chef_environment']      when 'prod'     <blah>     when 'stage'    <blah>   etc.
[2014-03-18 23:25:46 -0400] maniacal: except on multiple lines
[2014-03-18 23:25:55 -0400] coderanger: maniacal: No, node['chef_environemnt'] is _never_ correct
[2014-03-18 23:26:02 -0400] dgarstang: maniacal: yah I think I like his better. :)
[2014-03-18 23:26:10 -0400] coderanger: maniacal: chef_enviornment isn't a node attribute, its a real method call on the node object
[2014-03-18 23:26:13 -0400] maniacal: coderanger: right old habit
[2014-03-18 23:26:14 -0400] freerobby: someara: Ahh, thanks. Totally missed that and misread thinking it was storing that stuff in LDAP. Sorry. 7:30pm, coding for a while now.
[2014-03-18 23:26:20 -0400] drywheat: daxroc: ok, hmm, well that means "remote_file" will have to retrieve the remote file each time when using :create
[2014-03-18 23:26:26 -0400] coderanger: maniacal: Granted I think that was a mistake, but now we have to live with it :-(
[2014-03-18 23:26:43 -0400] drywheat: otherwise there's no way to check if the files are different
[2014-03-18 23:26:51 -0400] someara: I know the feeling =)
[2014-03-18 23:26:55 -0400] daxroc: Doesn't that couple 'your' environments to the cookbook
[2014-03-18 23:27:05 -0400] coderanger: someara: I think you and jtimberman just mind merged
[2014-03-18 23:27:20 -0400] coderanger: someara: You both said the same thing in different conversations within about 90 seconds of each other
[2014-03-18 23:27:37 -0400] someara: haha. must be the COOK rubbing off on me
[2014-03-18 23:27:52 -0400] someara: cant sleep PRs will eat me
[2014-03-18 23:28:52 -0400] someara: if I start wearing vibrams, I need you to hold an intervention
[2014-03-18 23:28:55 -0400] coderanger: someara: Do you have a desire to move somewhere no oxygen and eat nothing but lettuce?
[2014-03-18 23:29:00 -0400] daxroc: Is using node.automatic_attrs to update ohai information that has changed ok,bad practice ? I'm using it within the ohai :reload action
[2014-03-18 23:29:23 -0400] someara: I loled.
[2014-03-18 23:29:48 -0400] freerobby: Must sleep so PRs don't eat me. Thanks for the tip someara.
[2014-03-18 23:29:49 -0400] coderanger: daxroc: Yes, generally setting automatics yourself is a bad idea
[2014-03-18 23:30:31 -0400] coderanger: daxroc: When you install a new ohai plugin, it should run the plugin for you at that point
[2014-03-18 23:31:14 -0400] daxroc: coderanger: Isn't it the case that calling ohai reload after changing eg hostname / fqdn doesn't update it's node attributes.
[2014-03-18 23:32:17 -0400] daxroc: https://tickets.opscode.com/browse/OHAI-389
[2014-03-18 23:34:20 -0400] coderanger: daxroc: Heh, as lamont mentions in the last comment, thats an exception right now :)
[2014-03-18 23:36:55 -0400] daxroc: lamont?
[2014-03-18 23:38:33 -0400] coderanger: someara: Just for the record, super against that motd-tail change
[2014-03-18 23:38:42 -0400] coderanger: daxroc: Read the last comment on that ticket
[2014-03-18 23:39:14 -0400] someara: oh yea? whys that
[2014-03-18 23:40:09 -0400] coderanger: someara: What I said on the ticket, if you 1) don't use chef-server or 2) don't run chef-client as a daemon, that is possibly the most important info you need to know when you login to a machine
[2014-03-18 23:40:20 -0400] coderanger: And the only downside is "polluting" reporting data
[2014-03-18 23:40:35 -0400] coderanger: Its like removing a feature because rubocop complains
[2014-03-18 23:40:43 -0400] coderanger: thats a terrible reason to remove a feature
[2014-03-18 23:40:58 -0400] daxroc: Coderanger, appreciate the feedback.
[2014-03-18 23:57:05 -0400] dgarstang: coderanger: using your suggestion earlier ... would that destroy attributes loaded by earlier cookbooks?
[2014-03-18 23:57:12 -0400] coderanger: No ?
[2014-03-18 23:57:26 -0400] dgarstang: coderanger: seems like it. might be user error
[2014-03-18 23:58:30 -0400] coderanger: dgarstang: attribute files are just run via instance_eval
[2014-03-18 23:58:38 -0400] dgarstang: coderanger: ok..
