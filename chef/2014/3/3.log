[2014-03-03 00:00:30 -0500] ohmygoshjosh: I am heading out now.
[2014-03-03 00:00:42 -0500] ohmygoshjosh: coderanger: Thanks again, much appreciated
[2014-03-03 00:40:09 -0500] lukecarrier: I take it the Omnibus installer isn't supported under Fedora?
[2014-03-03 00:41:47 -0500] lukecarrier: oh, it is but the buggy as chips download page doesn't bother to mention it
[2014-03-03 00:42:01 -0500] lukecarrier: even after waiting a million light years for the damn page to load
[2014-03-03 01:13:03 -0500] resno: i have a bunch of cookbooks, i want to use doing chef-solo, any guides?
[2014-03-03 01:13:28 -0500] lukecarrier: resno, https://github.com/LukeCarrier/dotfiles
[2014-03-03 01:13:34 -0500] lukecarrier: see the chef dir under the master branch
[2014-03-03 01:13:45 -0500] lukecarrier: bit hacky, but it works every time
[2014-03-03 01:14:15 -0500] resno: is there a way to bootstrap a machine without adding them chef?
[2014-03-03 01:14:19 -0500] resno: err, chef server
[2014-03-03 01:16:26 -0500] lukecarrier: yes, install via omnibus
[2014-03-03 01:17:06 -0500] coderanger: resno: Yes, write your own bootstrap template
[2014-03-03 01:18:48 -0500] resno: oh ok
[2014-03-03 02:37:42 -0500] bettyclamp: I need to restart a service after installing some plugins. Best I can think of right now is to use 'notifies :restart, "service[the_service]", :immediately'.....but the question is: what resource should I put it in? I thought perhaps put it in an "exec 'dummy'..." with an empty command, but that looks pretty goofy. Any ideas for a better way?
[2014-03-03 02:49:13 -0500] brucelee: coderanger: hey, how would you go about chefing a source compilation installation?
[2014-03-03 02:57:58 -0500] Idealien: Gah - I'm completely stumped. Can anyone point out why this vagrantfile - https://gist.github.com/Idealien/7af9d994a23338b73e31 - would generate vagrant up provision errors listed in the gist related to Chef::Config[:solo] missing_attrs it appears to fully have?
[2014-03-03 03:03:39 -0500] coderanger: Idealien: Your wp-cookbook needs to add a dependency on the mysql cookbook
[2014-03-03 03:03:43 -0500] coderanger: in your metadata.rb
[2014-03-03 03:03:47 -0500] coderanger: depends "mysql"
[2014-03-03 03:06:23 -0500] Idealien: Thx coderanger. It seems I had the metadata.rb at project level, not within the cookbook folder. Trying again with that.
[2014-03-03 03:12:33 -0500] profit_: so is the current installer broken for el6?
[2014-03-03 03:15:42 -0500] Idealien: Was also missing a cookbook (homebrew). Slowly I inch my way closer to success....
[2014-03-03 03:24:44 -0500] coderanger: profit_: Unlikely
[2014-03-03 03:26:24 -0500] Idealien: Is there a proper command to "retrieve all depenency cookbooks" rather than vagrant / find error / download that / wash / rinse / repeat ?
[2014-03-03 03:26:32 -0500] coderanger: Idealien: berkshelf :)
[2014-03-03 03:26:41 -0500] profit_: coderanger: sure
[2014-03-03 03:26:55 -0500] profit_: but the cookbook it downloads straight-up doesn't start services right
[2014-03-03 03:26:56 -0500] Idealien: Yeah, Windows and that didn't play so nice. Gave up trying after a few nights of frustration
[2014-03-03 03:27:07 -0500] profit_: like nginx isn't running, postgres won't start
[2014-03-03 03:27:18 -0500] profit_: then again part of me blames joyent for their cent6 image
[2014-03-03 03:30:36 -0500] coderanger: profit_: You mean for chef-server or chef-client?
[2014-03-03 03:34:31 -0500] profit_: cnef-server
[2014-03-03 04:27:05 -0500] Idealien: So all cookbook dependencies now resolved. But provision failure got weirder. Log at https://gist.github.com/Idealien/7af9d994a23338b73e31 Not liking what i'm finding via google about Error executing action `install` on resource 'chef_gem[mysql]'. Anyone possibly able to help identify a n00b setup question?
[2014-03-03 04:29:43 -0500] juliancdunn: Idealien: it says "sh: 1: make: not found" in there
[2014-03-03 04:30:10 -0500] juliancdunn: you need some build tools on the box if you want to install the Ruby MySQL gem, since it needs to build native extensions against your MySQL
[2014-03-03 04:31:42 -0500] Idealien: I just did apt-get install make from within the box for make and re-provisioning. What would "the right" way to do that that supports sharing the scripts / box with other developers?
[2014-03-03 04:34:33 -0500] dataferret: I think you need ruby-dev too
[2014-03-03 04:35:18 -0500] makhan: hey guys
[2014-03-03 04:35:31 -0500] makhan: I have a problem with include_recipe
[2014-03-03 04:35:49 -0500] makhan: trying to install nginx with passenger on top of RVM
[2014-03-03 04:36:27 -0500] makhan: everything works nice but when it reaches code that iterates over node['nginx']['source']['modules'] and executes include_recipe ngx_module it throws an error
[2014-03-03 04:36:31 -0500] makhan: Cookbook http_stub_status_module not found. If you're loading http_stub_status_module from another cookbook, make sure you configure the dependency in your metadata
[2014-03-03 04:36:53 -0500] makhan: http_stub_status_module is one of the recipes in nginx cookbook
[2014-03-03 04:37:19 -0500] makhan: I'm running chef 11.10.4
[2014-03-03 04:37:34 -0500] makhan: do you have any idea what could be wrong?
[2014-03-03 04:40:51 -0500] dataferret: is it prefixed nginx::http_stub_status_module in the attribute?
[2014-03-03 06:07:25 -0500] brucelee: yo coderanger
[2014-03-03 06:07:26 -0500] brucelee: you there?
[2014-03-03 06:07:33 -0500] coderanger: mhmm
[2014-03-03 06:08:37 -0500] brucelee: coderanger: trying to use cloudformation to bootstrap chef
[2014-03-03 06:08:52 -0500] coderanger: Do you mean cfn-init?
[2014-03-03 06:08:54 -0500] brucelee: coderanger: or bootstrap some kind of script
[2014-03-03 06:09:04 -0500] brucelee: coderanger: not sure what cfn-init is :P
[2014-03-03 06:09:08 -0500] brucelee: but maybe thats what im referring to
[2014-03-03 06:09:13 -0500] brucelee: i created a json file
[2014-03-03 06:09:16 -0500] coderanger: so cloudformation can't boot stuff
[2014-03-03 06:09:23 -0500] coderanger: er, can't bootstrap stuff
[2014-03-03 06:09:31 -0500] coderanger: cloudformation just creates AWS objects
[2014-03-03 06:09:34 -0500] brucelee: and inside the resource ec2 instance, theres a property called "userdata"
[2014-03-03 06:09:42 -0500] brucelee: oh ok
[2014-03-03 06:09:48 -0500] coderanger: bootstrapping is part of either the instance config via userdata or an ASG launchconfig
[2014-03-03 06:10:03 -0500] brucelee: instance ocnfig via userdata is what im referring to
[2014-03-03 06:10:07 -0500] brucelee: most of the stuff i read online about that now
[2014-03-03 06:10:19 -0500] brucelee: involve some kind of bash script coded in json form as a string
[2014-03-03 06:10:24 -0500] brucelee: in userdata
[2014-03-03 06:10:30 -0500] brucelee: but it doesnt tell me how that works
[2014-03-03 06:10:38 -0500] coderanger: Its a base64-encoded bash script that is run on instance start generally
[2014-03-03 06:10:52 -0500] coderanger: technically the userdata can be anything, but almost all AMIs run it as a script
[2014-03-03 06:11:01 -0500] brucelee: oh ok
[2014-03-03 06:11:02 -0500] brucelee: thats what i didnt know
[2014-03-03 06:11:12 -0500] brucelee: so any AMI, (i use the centos 6 with updates AMI)
[2014-03-03 06:11:19 -0500] brucelee: will run userdata stuff as a script?
[2014-03-03 06:11:36 -0500] coderanger: So on top of that, cfn-init is a thing you can call from that script to do more complex initializations
[2014-03-03 06:11:45 -0500] coderanger: like download tarballs from S3 and running multiple scripts
[2014-03-03 06:11:59 -0500] brucelee: coderanger: awesome
[2014-03-03 06:12:00 -0500] coderanger: (based on metadata in the cloudformation template)
[2014-03-03 06:12:13 -0500] brucelee: coderanger: you just saved me a lot of time
[2014-03-03 06:12:15 -0500] coderanger: We were using cfn-init but are moving away from it
[2014-03-03 06:12:26 -0500] brucelee: moving towards what?
[2014-03-03 06:12:27 -0500] coderanger: now we just bake the bootstrap script into our AMI directly
[2014-03-03 06:12:34 -0500] brucelee: oh
[2014-03-03 06:12:37 -0500] brucelee: using a custom AMI?
[2014-03-03 06:12:51 -0500] coderanger: Yeah, though its built from an existing one with a few extra files
[2014-03-03 06:12:57 -0500] coderanger: which packer makes super easy
[2014-03-03 06:13:07 -0500] brucelee: is packer an aws tool?
[2014-03-03 06:13:17 -0500] coderanger: No, its from hashicorp, the people that make vagrant
[2014-03-03 06:13:43 -0500] coderanger: https://github.com/balanced/balanced-infra/blob/master/packer/balanced-client.json
[2014-03-03 06:13:46 -0500] coderanger: Thats our image template
[2014-03-03 06:14:36 -0500] brucelee: nice, going to look into it to create an ami
[2014-03-03 06:14:45 -0500] coderanger: And then our userdata https://github.com/balanced/balanced-infra/blob/master/stacks/balanced_gateway.py#L54-L58
[2014-03-03 06:14:51 -0500] brucelee: ill probably just incorporate chef-client into it
[2014-03-03 06:15:07 -0500] coderanger: Indeed, if you look in init.sh it installs chef
[2014-03-03 06:15:34 -0500] brucelee: init.sh where?
[2014-03-03 06:15:40 -0500] brucelee: in your github?
[2014-03-03 06:15:43 -0500] coderanger: next to the packer template
[2014-03-03 06:16:12 -0500] brucelee: oh ok sweet
[2014-03-03 06:16:20 -0500] brucelee: so to verify
[2014-03-03 06:17:03 -0500] brucelee: if i want to use cloudformation to bootstrap chef-client or whatnot
[2014-03-03 06:17:05 -0500] makhan: @dataferret: no, it's not prefixed nginx:: but it's called from within nginx cookbook
[2014-03-03 06:17:14 -0500] brucelee: i just feed a shell script that basically yum installs it
[2014-03-03 06:17:37 -0500] brucelee: and somehow the AMI is supposed to run that userdata string as a shell cmd?
[2014-03-03 06:17:39 -0500] coderanger: brucelee: Nothing to do with cloudformation, but yes
[2014-03-03 06:17:51 -0500] brucelee: coderanger: userdata resource property userdata
[2014-03-03 06:17:54 -0500] brucelee: thats cloudformation right?
[2014-03-03 06:18:14 -0500] coderanger: No, it is just part of the EC2 API which cloudformation is calling for you
[2014-03-03 06:18:19 -0500] brucelee: oh
[2014-03-03 06:18:41 -0500] brucelee: cloudformation docs dont' explain what goes on behind the userdata stuff
[2014-03-03 06:19:12 -0500] brucelee: coderanger: gonna look into cfn-init too, thanks! :P
[2014-03-03 06:19:19 -0500] coderanger: Because cloudformation isn't invovled
[2014-03-03 06:19:24 -0500] coderanger: Thats a feature of EC2
[2014-03-03 06:19:26 -0500] brucelee: yeah i was barking up the wrong tree
[2014-03-03 06:19:47 -0500] brucelee: but i couldnt find anything in google too, kept typing cloudformation userdata bootstrap
[2014-03-03 06:20:39 -0500] coderanger: Just remember that all cfn does is call other AWS APIs for you
[2014-03-03 06:21:24 -0500] brucelee: coderanger: good to know
[2014-03-03 06:21:57 -0500] brucelee: coderanger: do you still use cloudformation to set up the EBS and Elastic IPs, etc?
[2014-03-03 06:22:13 -0500] coderanger: I haven't cfn'd a server that needed either yet
[2014-03-03 06:22:23 -0500] coderanger: but probably eventually yes
[2014-03-03 06:22:29 -0500] brucelee: doing so now...
[2014-03-03 06:22:37 -0500] coderanger: literally all our CFN stuff is in that repo, you can just go read it :P
[2014-03-03 06:22:49 -0500] brucelee: even the templates and stuff?
[2014-03-03 06:23:02 -0500] brucelee: last time i looked i think there was a script that creates the template
[2014-03-03 06:23:16 -0500] brucelee: didnt actually show us the templates
[2014-03-03 06:23:22 -0500] coderanger: Yes, our templates are generated from Python code
[2014-03-03 06:23:34 -0500] coderanger: You can use brix to display the raw JSON if you want
[2014-03-03 06:24:18 -0500] brucelee: i think i just have to set up the EBS, elastic IPs and im done
[2014-03-03 06:24:37 -0500] brucelee: wll eventually look into the python code
[2014-03-03 06:24:47 -0500] brucelee: but without that how would i debug the json file
[2014-03-03 06:25:13 -0500] brucelee: or check it for properness
[2014-03-03 06:27:01 -0500] coderanger: brix has a validation command :)
[2014-03-03 06:29:17 -0500] brucelee: never heard of brix
[2014-03-03 06:29:24 -0500] brucelee: 3rd party tool i can just google?
[2014-03-03 06:29:28 -0500] coderanger: Thats the stuff in balanced-infra
[2014-03-03 06:29:29 -0500] brucelee: or is that balanced stuff
[2014-03-03 06:29:35 -0500] brucelee: ok
[2014-03-03 06:40:27 -0500] makhan: @dataferret: I changed the module names to add nginx:: at the beginning and it worked, thanks!
[2014-03-03 06:43:55 -0500] makhan: Another question
[2014-03-03 06:44:50 -0500] makhan: nginx cookbook sets the version in node['nginx']['version']  and then proceeds to use this value to set other variables: download url, local path, etc
[2014-03-03 06:45:43 -0500] makhan: overriding the version works for commands that use node['nginx']['version'] explicitly but for specifying the urls and paths the original value is used
[2014-03-03 06:46:36 -0500] makhan: is there a way to change the version without overriding every single attribute that uses node['nginx']['version'] as part of its value?
[2014-03-03 06:48:12 -0500] makhan: Example: nginx/attributes/source.rb: default['nginx']['version'] = '1.4.5' , default['nginx']['source']['prefix']                  = "/opt/nginx-#{node['nginx']['source']['version']}"
[2014-03-03 06:49:02 -0500] makhan: Is there anything I can do to just override the ['nginx']['version'] and not worry about ['nginx']['source']['prefix']?
[2014-03-03 06:49:40 -0500] n1ko: that doesnt use the value?
[2014-03-03 06:50:02 -0500] n1ko: ['nginx']['version'] vs ['nginx']['source']['version] ?
[2014-03-03 06:50:20 -0500] makhan: I set nginx version and nginx source version in my own cookbook
[2014-03-03 06:50:29 -0500] makhan: but it doesn't override paths and url
[2014-03-03 06:50:31 -0500] n1ko: also, you dont really have to worry about values that you dont use, eg. if you are not installing from the source, dont worry about those
[2014-03-03 06:50:43 -0500] n1ko: how did you override them?
[2014-03-03 06:51:21 -0500] makhan: set override['nginx']['version'] = '1.4.5' and override['nginx']['source']['version'] = '1.4.5' in my cookbook's attributes file
[2014-03-03 06:51:47 -0500] n1ko: yeah, that should work. and that doesn'
[2014-03-03 06:51:50 -0500] n1ko: t work?
[2014-03-03 06:52:02 -0500] makhan: doesn't
[2014-03-03 06:52:03 -0500] n1ko: why are you overriding both of them btw, which install method are you using?
[2014-03-03 06:52:24 -0500] makhan: got incorrect commands like
[2014-03-03 06:52:25 -0500] makhan:   code "    cd nginx-1.4.5 &&\n    ./configure --prefix=/opt/nginx-1.2.9 --conf-path=/etc/nginx/nginx.conf --sbin-path=/opt/nginx-1.2.9/sbin/nginx --add-module=/usr/local/rvm/gems/ruby-2.1.0/gems/passenger-4.0.37/ext/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module &&\n    make && make install\n"
[2014-03-03 06:52:28 -0500] n1ko: you updatet the cookbook properly, meaning that you can see the same attribute files in the target machines cache?
[2014-03-03 06:52:57 -0500] n1ko: also did you specify the repo correctly?
[2014-03-03 06:53:50 -0500] makhan: which repo do you mean?
[2014-03-03 06:54:03 -0500] n1ko: well you are using source install so it doesn't mean
[2014-03-03 06:54:23 -0500] makhan: yeah
[2014-03-03 06:54:34 -0500] makhan: if I override the paths attributes everything works perfect
[2014-03-03 06:54:46 -0500] makhan: but I'd rather not do that
[2014-03-03 06:56:00 -0500] makhan: my guess is that chef first evaluates the whole nginx/attributes/source.rb file, then evaluates my_cookbook/attributes/rails_server.rb file, which overrides the version correctly but the remaining attributes are not being recalculated
[2014-03-03 06:56:46 -0500] n1ko: yeah, i was just reading the nginx cookbook sourcecode, it should work like you said
[2014-03-03 06:57:01 -0500] n1ko: and it somehow manages to calculate two values for the ['source']['version']
[2014-03-03 06:58:51 -0500] makhan: I think it reads the nginx attributes file assuming ['source']['version'] is 1.2.9 and then finds my file, changes version to 1.4.5 but leaves the attributes that use the version to calculate paths untouched
[2014-03-03 07:01:16 -0500] makhan: I'm not sure how chef loads attributes
[2014-03-03 07:01:34 -0500] makhan: does it just go through each file once, overriding values when necessary?
[2014-03-03 07:02:13 -0500] n1ko: http://docs.opscode.com/chef_overview_attributes.html#attribute-precedence
[2014-03-03 07:05:32 -0500] makhan: yeah, I know that, the question is what happens if I have:
[2014-03-03 07:05:38 -0500] makhan: default['a'] = 1
[2014-03-03 07:05:47 -0500] makhan: default['b'] = node['a']
[2014-03-03 07:05:51 -0500] makhan: override['a'] = 2
[2014-03-03 07:05:56 -0500] makhan: does b take value 1 or 2?
[2014-03-03 07:11:31 -0500] n1ko: makhan: good question, we would probably like the latter, but i would bet my money on the first :)
[2014-03-03 07:11:50 -0500] makhan: yeah, I agree :)
[2014-03-03 07:12:53 -0500] makhan: b would be preferable but there is no easy way to implement it
[2014-03-03 07:13:13 -0500] makhan: I guess the simplest solution would be to keep recalculating attributes until they stop changing value
[2014-03-03 07:13:30 -0500] makhan: but with this method it's possible to create a loop
[2014-03-03 07:46:05 -0500] whack: Is there a way to get Ohai to load just a specific attribute or two? I'm finding 'all_plugins' takes quite a while to execute when all i want are platform and platform_version (I'm using Ohai from ruby, not chef)
[2014-03-03 08:00:21 -0500] coderanger: whack: You can run specific plugins I think
[2014-03-03 08:00:30 -0500] coderanger: whack: ohai 6 or 7?
[2014-03-03 08:49:31 -0500] brucelee: coderanger: do i need to have cloudinit on my centos 6 before this userdata thing would work?
[2014-03-03 08:49:43 -0500] brucelee: currently im just using a standard centos published AMI
[2014-03-03 08:49:49 -0500] brucelee: thats 6.4 minimum
[2014-03-03 09:06:05 -0500] brucelee: yeah
[2014-03-03 09:06:07 -0500] brucelee: just tried itd
[2014-03-03 09:06:17 -0500] brucelee: doesnt seem the cloudinit stuff ran
[2014-03-03 10:17:04 -0500] dawuud: i'm having a bit of trouble with chef-client cookbook...
[2014-03-03 10:17:19 -0500] dawuud: it seems to be ignoring my default role attributes
[2014-03-03 10:27:19 -0500] dawuud: ok. i'm going to try using a wrapper cookbook to set the attributes in a recipe
[2014-03-03 10:27:39 -0500] dawuud: override['chef_client']['config']['ssl_verify_mode'] = 'verify_peer'
[2014-03-03 10:27:47 -0500] dawuud: like this: http://chr4.org/blog/2013/08/01/howto-use-chef-with-ssl/
[2014-03-03 11:05:00 -0500] chef851: hi
[2014-03-03 11:05:18 -0500] chef851: how to download particular file from svn using chef
[2014-03-03 11:05:35 -0500] chef851: is their any recipe for that
[2014-03-03 11:06:01 -0500] chef851: any idea how i can do that?
[2014-03-03 11:08:20 -0500] workmad3: chef851: pretty sure with SVN you can provide the URL to the specific file to the 'subversion' resource and give it an action of :export to just get the file
[2014-03-03 11:10:21 -0500] chef851: but for svn user name and password required
[2014-03-03 11:10:33 -0500] chef851: so how i can specify that
[2014-03-03 11:10:49 -0500] chef851: i was tried application recipe
[2014-03-03 11:11:09 -0500] chef851: in which i have given the repository url
[2014-03-03 11:11:40 -0500] chef851: then svn_username and svn_password
[2014-03-03 11:12:01 -0500] chef851: and scm_provider Chef::Provider::RemoteFile::Deploy
[2014-03-03 11:12:46 -0500] chef851: but then it saying undefined attributes scm_username ,scm_password for application recipe
[2014-03-03 11:13:40 -0500] chef851: any idea how i can do this using application recipe
[2014-03-03 11:15:14 -0500] workmad3: chef851: http://docs.opscode.com/resource_subversion.html
[2014-03-03 11:16:13 -0500] chef851: i go through this site but i have to take the war file from svn and deploy to tomcat
[2014-03-03 11:16:28 -0500] chef851: so that's why i was using the application recipe
[2014-03-03 11:16:45 -0500] chef851: so any idea how i can implement in the application recipe
[2014-03-03 11:17:18 -0500] chef851: file local deploy i have implemented but remote deploy i can not
[2014-03-03 11:18:50 -0500] dawuud: how do i find out for sure if my chef clients are verify ssl cert of chef-server?
[2014-03-03 11:24:14 -0500] lukecarrier: Chef's file resources don't correctly escape spaces in filenames when calling restorecon to restore SELinux security contexts... http://pastebin.com/10dZm4Zf
[2014-03-03 11:25:01 -0500] dawuud: chef-client should issue a warning message if chef-server cert verification fails... is this the case?
[2014-03-03 11:29:41 -0500] workmad3: dawuud: don't think so, because that would break the default open-source chef server setup (where a self-signed cert is used)
[2014-03-03 11:29:53 -0500] denniswisnia: hey guys
[2014-03-03 11:30:39 -0500] workmad3: dawuud: however, the chef-client/server comms is also secured through the use of the chef-client certificate signed with the validator key
[2014-03-03 11:30:46 -0500] denniswisnia: I want to set the attribute of an node if it active or not, here is my snippet of the fixed nginx cookbook: https://gist.github.com/anonymous/bba042d0f1ba7e4bdd08 - does it work? I am not a Ruby expert ;)
[2014-03-03 11:31:24 -0500] segv: denniswisnia, depends on how you are setting 'node["application"]'
[2014-03-03 11:31:52 -0500] workmad3: denniswisnia: the way you have it there, I'd swap lines 2 and 3 of the gist
[2014-03-03 11:31:59 -0500] segv: you may want to verify that 'node["application"]' :application exists as well before trying to access "active" as well or that will fail if you've just bootstrapped a node.
[2014-03-03 11:32:20 -0500] workmad3: oh, scratch that...
[2014-03-03 11:32:21 -0500] segv: chicken before the egg.
[2014-03-03 11:32:31 -0500] workmad3: denniswisnia: you way want to rename your loop var to be something other than 'node'
[2014-03-03 11:32:35 -0500] segv: workmad3, yeah, he'll have to verify the data is there before even touching that data.
[2014-03-03 11:32:38 -0500] workmad3: causes confusion :)
[2014-03-03 11:32:51 -0500] denniswisnia: segv: https://gist.github.com/anonymous/c497e12c30d021dfd7b7 - thats the way that i set the attribute
[2014-03-03 11:33:13 -0500] segv: denniswisnia, so you'll have that set before you apply said recipe/cookbook?
[2014-03-03 11:33:29 -0500] denniswisnia: nope, after that.
[2014-03-03 11:33:33 -0500] denniswisnia: ah, okay - i understand
[2014-03-03 11:33:51 -0500] segv: there you go, yeah, it may fail because there is no data
[2014-03-03 11:34:08 -0500] workmad3: denniswisnia: I'd typically use 'host' instead of 'node' as the loop variable there... I'd also suggest that you (as segv suggested) ensure the data structure exists first, and also that you maybe get the application port off the host too?
[2014-03-03 11:34:25 -0500] segv: workmad3, agreed
[2014-03-03 11:34:30 -0500] segv: other than that, you're on the right track
[2014-03-03 11:34:37 -0500] workmad3: ^^ I agree there
[2014-03-03 11:34:58 -0500] denniswisnia: okay fine!
[2014-03-03 11:34:59 -0500] denniswisnia: :)
[2014-03-03 11:35:13 -0500] segv: Doing good!
[2014-03-03 11:35:26 -0500] denniswisnia: https://gist.github.com/anonymous/7e947f26304ca3fdbfbe
[2014-03-03 11:35:28 -0500] denniswisnia: better?
[2014-03-03 11:35:30 -0500] segv: And I need another beer.
[2014-03-03 11:35:37 -0500] workmad3: oh, one thing you could do... rather than check 'node["application"]["active"]' in the recipe, you could adjust your search so that you only find nodes with active applications ;)
[2014-03-03 11:36:08 -0500] segv: denniswisnia, yeah, looks good, also you do not need to use <%- %> unless that line is printing data and you don't want another line
[2014-03-03 11:36:25 -0500] segv: <%- %> negates the newline of output so almost useless, harmless tbo but just an fyi
[2014-03-03 11:36:27 -0500] workmad3: denniswisnia: no... I suggested that due to a misunderstanding of what 'node' was there
[2014-03-03 11:39:51 -0500] lukecarrier: Can anyone else reproduce this restorecon bug? https://tickets.opscode.com/browse/CHEF-5095
[2014-03-03 12:18:00 -0500] chef851: hi
[2014-03-03 12:18:44 -0500] chef851: is their any recipe to dump the mysql data from mysql dump file
[2014-03-03 12:19:41 -0500] n1ko: you can run a sql script with database cookbook
[2014-03-03 12:21:09 -0500] chef851: you mean in database cookbook i can directly give the sql script to dump the data
[2014-03-03 12:21:10 -0500] chef851: ?
[2014-03-03 12:33:39 -0500] alucardX: chef851: yo can modify your cookbook adding a few lines in order to dump your data
[2014-03-03 13:17:34 -0500] srenatus: lukecarrier: had a quick look, i think this is missing a pair of "": https://github.com/opscode/chef/blob/master/lib/chef/util/selinux.rb#L50
[2014-03-03 13:17:57 -0500] dawuud: workmad3: i believe ssl cert verification is only means that a chef client has to verify the legitimacy of a chef server
[2014-03-03 13:18:13 -0500] dawuud: therefore i need to know if verify_peers is working!
[2014-03-03 13:18:21 -0500] srenatus: lukecarrier: your file_path contains spaces, this ends up as multiple arguments to restorecon in restorecon_command, shelling out leads to the error
[2014-03-03 13:19:23 -0500] workmad3: dawuud: if the chef server wasn't valid, the server would not be able to do the chef-level signing of requests and verifying responses based off the pre-shared private keys (validator.pem, client.pem) on client and server
[2014-03-03 13:19:46 -0500] workmad3: dawuud: SSL cert verification can identify an invalid server before that point, but it's not the only mechanism that chef is using
[2014-03-03 13:22:41 -0500] workmad3: dawuud: don't get me wrong, I agree that checking verify_peers should work... my point was that chef has it's own application-level verification going on, on top of the transport-level encryption provided by SSL ;)
[2014-03-03 13:23:44 -0500] workmad3: dawuud: and also, as I said, the chef-server setup for open-source chef generates a self-signed cert which would fail verification in most setups... so I believe that chef-client turns off verify_peer by default
[2014-03-03 13:24:48 -0500] dawuud: workmad3: i'm using the chef-server and chef-client cookbooks with attributes set so i don't have to ride with the shitty default settings
[2014-03-03 13:27:54 -0500] workmad3: dawuud: then set the verify mode ;)
[2014-03-03 13:27:55 -0500] dawuud: workmad3: it is my understanding (please correct me if i am wrong) that the "chef level auth" merely authorizes the client; i am however NOT concerned right now with this... but instead am looking to prevent a situation in which the client's connection to the chef-server is MITM'ed... and then my chef nodes get pwn'ed ;(
[2014-03-03 13:28:16 -0500] workmad3: dawuud: the chef-level stuff signs all requests
[2014-03-03 13:28:39 -0500] workmad3: dawuud: if an invalid or tampered request or response came through, it would, afaik, be rejected
[2014-03-03 13:28:40 -0500] dawuud: a client sends a request. the chef-server signs the request. and then what?
[2014-03-03 13:28:51 -0500] workmad3: no, the client signs the request before sending with its key
[2014-03-03 13:29:02 -0500] workmad3: and the server validates it's not been tampered with before responding
[2014-03-03 13:29:03 -0500] dawuud: ah interesting
[2014-03-03 13:29:04 -0500] workmad3: and vice-versa
[2014-03-03 13:29:30 -0500] workmad3: SSL encrypts the transport on-top of that, so the connection can't be sniffed
[2014-03-03 13:29:37 -0500] dawuud: ok
[2014-03-03 13:29:44 -0500] dawuud: that sounds good
[2014-03-03 13:29:51 -0500] workmad3: but still, https://github.com/opscode-cookbooks/chef-client#usage gives you what you need to also set the verify mode ;)
[2014-03-03 13:30:09 -0500] workmad3: if you've provided an SSL cert for your server from a known CA
[2014-03-03 13:31:47 -0500] dawuud: yes. i've set ssl_verify_mode=verify_peer AND verify_api_cert=true
[2014-03-03 13:33:12 -0500] dawuud: so i guess i'm already doing the right thing; there's just no log output saying that it all works correctly ;)
[2014-03-03 13:35:00 -0500] workmad3: dawuud: yeah, that's what I'd expect ;)
[2014-03-03 13:35:21 -0500] workmad3: dawuud: if you want to check it, misconfigure your chef-server to use a self-signed and unverifiable cert ;)
[2014-03-03 13:35:39 -0500] lukecarrier: srenatus, I gathered as much, and just got your comment on the ticket. Thanks!
[2014-03-03 13:35:47 -0500] workmad3: dawuud: or look at debug log output of a client-run... that might give you something
[2014-03-03 13:36:20 -0500] lukecarrier: srenatus, I'll see if I can botch a fix together myself this evening and drop a patch your way, if it's literally just a case of quoting that parameter I should be capable :)
[2014-03-03 13:37:28 -0500] denniswisnia: workmad3: got this error: https://gist.github.com/anonymous/fc8d23717c4ecbc513cc - I am so dump that I dont see the error?
[2014-03-03 13:37:29 -0500] dawuud: workmad3: ok... thanks... i'll give it a try.
[2014-03-03 13:38:31 -0500] workmad3: denniswisnia: I believe it's what you were warned about - node[@resource.application.name] is returning 'nil' because the appropriate recipe hasn't run on the other host yet
[2014-03-03 13:39:03 -0500] denniswisnia: ahh!
[2014-03-03 13:44:19 -0500] samwierema: Is it possible to bootstrap a server that has been previously bootstrapped, to a different Chef server instance (i.e. re-bootstrap)?
[2014-03-03 13:44:47 -0500] jbell05: Actually I
[2014-03-03 13:44:53 -0500] jbell05: I'd like to know the same thing
[2014-03-03 13:46:44 -0500] workmad3: samwierema: you'd need to remove the validator.pem and client.pem from /etc/chef on the node, then re-bootstrap
[2014-03-03 13:50:33 -0500] dawuud: workmad3: aha! yes it fails to validate my self signed cert. so yeah... it *was* configured properly.
[2014-03-03 13:51:35 -0500] workmad3: dawuud: :D
[2014-03-03 13:52:08 -0500] workmad3: dawuud: useful to check though, and I hope you've now got increased confidence in the default chef-server setup when you're bootstraping your infrastructure too? ;)
[2014-03-03 14:00:11 -0500] dawuud: workmad3: yes... next i am going to see if bootstrapping the nodes does the validate_peer thing
[2014-03-03 14:12:38 -0500] dawuud: workmad3: actually my bootstrapping could fail earlier than it does when i use a self signed cert on the chef-server
[2014-03-03 14:23:51 -0500] shlant: morning chefs!
[2014-03-03 14:24:00 -0500] shlant: anyone know if this is best practice now? node.elasticsearch[:user]
[2014-03-03 14:24:13 -0500] shlant: just started seeing it
[2014-03-03 14:24:31 -0500] shlant: nicer to read for sure
[2014-03-03 14:25:58 -0500] dawuud: is there a way to make bootstrapping chef nodes fail immediately if the chef-server's ssl cert does not verify?
[2014-03-03 14:26:38 -0500] dawuud: it seems like there is NOT a way to do this; my node bootstrap only fails when it gets to the chef-client config which tells it to verify_peer
[2014-03-03 14:27:23 -0500] dawuud: it seems like there might be a small race condition wherein the bootstrapping node is vulnerable to a MITM
[2014-03-03 14:34:57 -0500] hughsaunders: Hello.. how can I set/update an attribute from within a ruby block? node.default[ and node.override[ have not been working for me.
[2014-03-03 14:38:15 -0500] benmoss: can someone explain to me how I might structure this with data bags/environments/roles?
[2014-03-03 14:38:33 -0500] benmoss: I have license keys that are specific to server type and server environment (staging, prod)
[2014-03-03 14:39:22 -0500] jan_bee: Hi, does anyone here know how to get vim file detection to detect chef files as chef.ruby instead of ruby? I am currently using vim-ruby and vim-chef
[2014-03-03 14:39:24 -0500] benmoss: so it cuts both dimensions of role and environment, at least in my understanding
[2014-03-03 14:40:13 -0500] benmoss: jan_bee: https://github.com/dougireton/vim-chef
[2014-03-03 14:40:27 -0500] benmoss: oh never mind you are using that you said
[2014-03-03 14:40:36 -0500] benmoss: it doesn't do what's on the label?
[2014-03-03 14:40:43 -0500] jan_bee: That's the one I am using, but somehow vim-ruby is overruling it
[2014-03-03 14:42:39 -0500] benmoss: i dunno
[2014-03-03 14:44:48 -0500] benmoss: it works for me, but only in my "cookbooks" directory, not my "site-cookbooks"
[2014-03-03 14:44:53 -0500] obryan: Are there any cookbooks for setting up an IRC server?
[2014-03-03 14:45:29 -0500] hughsaunders: obryan: http://community.opscode.com/search?query=irc&scope=cookbook
[2014-03-03 14:45:36 -0500] obryan: done that
[2014-03-03 14:45:38 -0500] obryan: nada
[2014-03-03 14:46:09 -0500] benmoss: obryan: https://github.com/tristanfisher/charybdis
[2014-03-03 14:46:43 -0500] obryan: gold star goes to benmoss :)
[2014-03-03 14:46:49 -0500] benmoss: :)
[2014-03-03 14:46:54 -0500] obryan: thanky sir :)
[2014-03-03 14:47:04 -0500] benmoss: via some googling and https://twitter.com/0xtristan/status/314498793913602049
[2014-03-03 14:47:14 -0500] benmoss: so looks like you are the second person to need this
[2014-03-03 14:47:47 -0500] obryan: i'm just shocked it wasn't already in the opscode listings
[2014-03-03 14:47:57 -0500] obryan: i mean hubot is there but not an irc?
[2014-03-03 14:48:15 -0500] obryan: like hiring a driver but not being concerned about having a car
[2014-03-03 14:48:30 -0500] benmoss: yeah i know nothing about the opscode listings, seems inevitably insufficient compared to github & google
[2014-03-03 14:48:46 -0500] benmoss: i assume people have to register and submit the repo?
[2014-03-03 14:48:47 -0500] obryan: google can be rather stupid at times though
[2014-03-03 14:49:24 -0500] benmoss: and then what, opscode hosts a mirror?
[2014-03-03 14:50:45 -0500] hughsaunders: applogies for repeating Q, but any idea if I can set an attribute from within a ruby block?
[2014-03-03 14:53:45 -0500] ShadySQL: howdy geeks
[2014-03-03 14:55:15 -0500] benmoss: would something like a license key go in a data bag, or could it also go in an environment?
[2014-03-03 15:11:41 -0500] tobiassjosten: I'm trying to use the php cookbook from opscode, with chef-solo. It requires iis, which in turn requires windows and this is where it gets silly. Am I doing something wrong? This can't seriously be a requirement for the php cookbook?
[2014-03-03 15:15:48 -0500] stormerider: tobiassjosten: it requires it because it has to to be able to support WAMP, but that doesn't mean it'll actually execute
[2014-03-03 15:15:56 -0500] mattsurabian: tobiassjosten: just because it requires it doesn't mean it uses it
[2014-03-03 15:16:02 -0500] mattsurabian: aye, what stormerider said
[2014-03-03 15:16:13 -0500] stormerider: there's an open ticket about platform-based dependencies for that very scenario
[2014-03-03 15:16:20 -0500] mattsurabian: I agree it's a bit frustrating to have "useless" cookbooks kicking around in the repo but meh
[2014-03-03 15:16:42 -0500] tobiassjosten: Alright, thanks. I'll bite the bullet and add it then.
[2014-03-03 15:17:05 -0500] mattsurabian: theoretically you could modify the checked out cookbook to remove those dependencies
[2014-03-03 15:17:05 -0500] stormerider: the alternative would be to have php-linux, php-windows, etc cookbooks, which is suboptimal
[2014-03-03 15:17:15 -0500] mattsurabian: but I've found that to be more trouble than it's worth
[2014-03-03 15:33:58 -0500] mattsurabian: so berkshelf
[2014-03-03 15:34:14 -0500] mattsurabian: haven't used it yet
[2014-03-03 15:34:19 -0500] mattsurabian: what's the main draw?
[2014-03-03 15:35:54 -0500] benmoss: not manually downloading/git submoduling your dependencies
[2014-03-03 15:37:03 -0500] mattsurabian: yeah just read this in a blog post "Being able to resolve dependent cookbooks through the Berksfile means that we can now separate our cookbooks into their own repositories. - See more at: http://www.rallydev.com/community/engineering/ermahgerd-berkshelf#sthash.oDPVKCgS.dpuf"
[2014-03-03 15:37:17 -0500] benmoss: yeah
[2014-03-03 15:37:30 -0500] benmoss: it encourages that approach instead of the monolith "chef-repo"
[2014-03-03 15:37:48 -0500] benmoss: mix public and private cookbooks, each is self-contained
[2014-03-03 15:38:06 -0500] mattsurabian: how does that work in practice though, you still end up with like, one monolith repo locally when working with knife no?
[2014-03-03 15:38:29 -0500] mattsurabian: or it actually resolves the dependencies at the time you try to use them
[2014-03-03 15:39:25 -0500] benmoss: don't understand things well enough to know how to answer that :)
[2014-03-03 15:39:37 -0500] mattsurabian: no worries
[2014-03-03 15:40:00 -0500] mattsurabian: I suppose it's the same if you're on enterprise chef anyway, since you have to upload all the cookbooks into one monolith within enterprise chef
[2014-03-03 15:40:15 -0500] benmoss: does anyone know why my recipe is loading before the corresponding attributes file? i am getting a "undefined method [] for nil" because the attributes aren't set
[2014-03-03 15:40:18 -0500] mattsurabian: thinking for the project I'm working on now I probably don't reauire berkshelf, thanks!
[2014-03-03 15:41:19 -0500] benmoss: oh, would an "include_recipe" not also require the attributes/default.rb for that recipe?
[2014-03-03 15:41:39 -0500] bubu: hola, when does ohai_time get updated in a chef run?
[2014-03-03 15:41:41 -0500] someara: benmoss there is no "corresponding" attribtues file.... all files in attributes/ get loaded before the recipes start compiling
[2014-03-03 15:41:48 -0500] stormerider: mattsurabian: not sure i follow re: EC... they're broken apart by organization IIRC
[2014-03-03 15:41:53 -0500] benmoss: hmm
[2014-03-03 15:42:23 -0500] benmoss: so i am setting a bunch of default["scout"] attributes in site-cookbooks/scout/attributes/default.rb
[2014-03-03 15:42:28 -0500] someara: require 'pry' \n binding.pry is your debugging friend for things like this
[2014-03-03 15:42:31 -0500] benmoss: argh
[2014-03-03 15:42:32 -0500] mattsurabian: stormerider: we only have one organization setup in EC
[2014-03-03 15:42:49 -0500] benmoss: well i can see that the attributes file is never even being executed
[2014-03-03 15:42:53 -0500] mattsurabian: so when I got to "policy" all the cookbooks are there
[2014-03-03 15:43:11 -0500] someara: I spent most of yesterday banging my head against the wall over something similar just to figure out that my attrbutes directory was misnamed
[2014-03-03 15:43:38 -0500] someara: benmoss what makes you think that?
[2014-03-03 15:43:52 -0500] benmoss: i put a bunch of "puts" in it, and they never are printed
[2014-03-03 15:44:04 -0500] someara: gist an example?
[2014-03-03 15:44:29 -0500] benmoss: sounds like from this you need to specify in the metadata.rb as well as doing an include_recipe: http://stackoverflow.com/questions/17490736/chef-does-not-read-attributes-and-definitions
[2014-03-03 15:44:58 -0500] benmoss: yep that fixed it
[2014-03-03 15:45:00 -0500] benmoss: :)
[2014-03-03 15:45:20 -0500] someara: ah
[2014-03-03 15:45:27 -0500] someara: from another cookbook
[2014-03-03 15:45:36 -0500] benmoss: yeah, one cookbook was including another's recipe
[2014-03-03 15:45:38 -0500] someara: all you need to do is specify the dependency in the metadata.rb
[2014-03-03 15:45:50 -0500] mattsurabian: aye
[2014-03-03 15:46:22 -0500] someara: if you have recipe['widgetfactory'] in your run_list, all of the cookbooks in widgetfactory's dependency tree will be "loaded" before any recipes compile
[2014-03-03 15:46:35 -0500] someara: so you'll get access to all libraries, attributes, resources/providers, etc
[2014-03-03 15:46:56 -0500] benmoss: what's the "right place" to set attributes from a data bag? i see the "bag_item" method is not defined in attributes files
[2014-03-03 15:47:42 -0500] someara: you don't really set node attributes from a databag...
[2014-03-03 15:47:50 -0500] benmoss: hmm
[2014-03-03 15:47:59 -0500] someara: you seach(:index_name, "solr:query") in a recipe or library usually
[2014-03-03 15:48:09 -0500] someara: where index_name is a databag or the built in ones
[2014-03-03 15:48:13 -0500] someara: node,recipe,cookbooks,etc
[2014-03-03 15:48:22 -0500] benmoss: or in a template?
[2014-03-03 15:48:26 -0500] bubu: hola, when does ohai_time get updated in a chef run? Does the ohai_time attribute get updated even if the chef run fails???
[2014-03-03 15:48:33 -0500] someara: you consume them from recipes or templates
[2014-03-03 15:49:05 -0500] someara: set them in cookbook attributes files, recipes,  roles, or envionments
[2014-03-03 15:49:15 -0500] someara: and consume them in recipes/templates
[2014-03-03 15:49:39 -0500] someara: in sean's opinion, you should only set them in cookbook attribute files and environments
[2014-03-03 15:49:48 -0500] someara: but yymv
[2014-03-03 15:49:55 -0500] benmoss: when you say "set them" you mean take them from the data bag and "set them" as variables?
[2014-03-03 15:50:18 -0500] someara: whats in the data bag
[2014-03-03 15:50:22 -0500] benmoss: a license key
[2014-03-03 15:50:50 -0500] someara: so you'd search for the data bag from a recipe, then feed the data into a resource during recipe compilation
[2014-03-03 15:50:59 -0500] someara: just like you'd feed an attribute
[2014-03-03 15:51:48 -0500] someara: lickey = search(:yourdatabag, "query:tofindit")
[2014-03-03 15:52:03 -0500] someara: file 'wherever' do
[2014-03-03 15:52:08 -0500] someara:   contents lickey
[2014-03-03 15:52:08 -0500] someara: end
[2014-03-03 15:54:16 -0500] benmoss: https://gist.github.com/benmoss/9327933
[2014-03-03 15:54:59 -0500] benmoss: so the cron recipe initializes the Command object which grabs the 'key' from the node
[2014-03-03 15:57:29 -0500] someara: so class ScoutCommand < Command
[2014-03-03 16:10:33 -0500] solvipp: hello
[2014-03-03 16:10:48 -0500] solvipp: what's the preferred way to cache data between recipes?
[2014-03-03 16:10:58 -0500] benmoss: someara: what does subclassing Command do?
[2014-03-03 16:11:06 -0500] solvipp: say, if I have recipe A that performs a number of HTTP calls, and I'd want to cache the results of those calls
[2014-03-03 16:13:13 -0500] denniswisnia: workmad3: are you there?
[2014-03-03 16:14:50 -0500] iroller_: Ohai Chefs. Any thoughts on that ChefSpec issue: https://github.com/sethvargo/chefspec/issues/368 ? Maybe some workarounds?
[2014-03-03 16:15:26 -0500] someara: solvipp for doing what as an example?
[2014-03-03 16:17:00 -0500] solvipp: someara: I have a provider that's responsible for installing software from our artifact repo.  That provider supports a special version qualifier, 'latest'.  In order to figure out what the latest version is, I need to make a few http calls.
[2014-03-03 16:18:36 -0500] solvipp: someara: That installation code then deploys software into a directory, which has the version in its name.  Something like C:\\foo\\bar\\softwarepackage-<versionstring>\...
[2014-03-03 16:19:16 -0500] solvipp: someara: So, I want to store that discovered version string somewhere, in order to be able to return the c:\\foo\\bar\softwarepackage-<version>\ path
[2014-03-03 16:21:33 -0500] someara: solvipp stash it in node.run_state
[2014-03-03 16:22:05 -0500] solvipp: someara: Ah!  node.run_state, thanks!
[2014-03-03 16:22:24 -0500] someara: node.run_state['my_thing']['latest'] = '1.2.3'
[2014-03-03 16:22:56 -0500] someara: but don't abuse it... remember a recipe should be a unit of testable intent that can stand on its own
[2014-03-03 16:23:17 -0500] someara: so check for its presence then if its not cached, make your httpd call
[2014-03-03 16:23:22 -0500] someara: s/httpd/http/
[2014-03-03 16:29:40 -0500] dawuud: hey is there a "service provider" that uses ubuntu's /etc/init/fu.conf so that it actually starts with: service fu start
[2014-03-03 16:30:09 -0500] stormerider: dawuud: i believe the service resource supports upstart, yes
[2014-03-03 16:30:50 -0500] stormerider: though it might call it as start fu instead
[2014-03-03 16:33:05 -0500] solvipp: someara: Yeah, I realize.  The use case is something like the following: https://gist.github.com/solvip/24cfb51868a96bb89184
[2014-03-03 16:34:06 -0500] solvipp: someara: in a perfect world, I would get rid of this 'latest' tag by having the build system set an explicit version number somewhere.
[2014-03-03 16:34:16 -0500] AntelopeSalad: i have a random'ish scaling question for you guys if you don't mind
[2014-03-03 16:34:24 -0500] dawuud: stormerider: ah yes you are right. in my case "service" provider was assuming Chef::Provider::Service::Init::Debian; so i explicitly told it to use Chef::Provider::Service::Upstart
[2014-03-03 16:34:46 -0500] someara: solvipp yep. wire your CI into chef-server and have it update a databag =)
[2014-03-03 16:35:01 -0500] AntelopeSalad: if you had an application/service (say a rails app, but it doesn't matter) , and you have nginx acting as a reverse proxy to it among other things (gzip and serving static files) -- would you deploy nginx to each app server?
[2014-03-03 16:35:04 -0500] someara: https://github.com/sethvargo/chef-api
[2014-03-03 16:35:24 -0500] someara: but babysteps, etc
[2014-03-03 16:37:14 -0500] solvipp: someara: yeah, precisely.  That's what I'm doing for the application deployments themselves, across all environments, except that we need to push a button to bump versions.  Dev is somewhat special, we always want the latest version running and implementing this 'latest' functionality is easier than wrestling TFS. :)
[2014-03-03 16:37:53 -0500] denniswisnia: http://pastebin.com/qvAgsEsG - i dont understand the error, can anyone help?
[2014-03-03 16:38:15 -0500] someara: you can programatically manipulate environment definitions and lock cookbooks down to specific versions
[2014-03-03 16:38:21 -0500] someara: so dev always has latest
[2014-03-03 16:38:28 -0500] j^2: denniswisnia: did you set  if node["application"]["active"] == "yes" ?
[2014-03-03 16:38:35 -0500] denniswisnia: yes!
[2014-03-03 16:38:37 -0500] someara: yymv
[2014-03-03 16:38:43 -0500] j^2: denniswisnia: where at?
[2014-03-03 16:39:05 -0500] denniswisnia: as attribute: https://gist.github.com/anonymous/a8a3e134540e7d48de2e
[2014-03-03 16:39:33 -0500] j^2: hmm
[2014-03-03 16:39:46 -0500] solvipp: someara: yeah, tried something like that first.  Found it more enjoyable to decouple application release versions from cookbook versions.
[2014-03-03 16:40:12 -0500] j^2: denniswisnia: honestly not sure sorry :(
[2014-03-03 16:40:19 -0500] denniswisnia: damn :(
[2014-03-03 16:40:29 -0500] solvipp: but chef-api looks good, thanks. :)
[2014-03-03 16:40:43 -0500] j^2: denniswisnia: but a Nil:Class is useally due to something not being set that it needs
[2014-03-03 16:41:02 -0500] denniswisnia: yea, I know - but i dont understand it why it doesnt work
[2014-03-03 16:45:55 -0500] cannonball: ISTR someone mentioning working on a new UI for managing chef server...or am I smoking crack?  I haven't found anything on the Goog or github.  Does such a thing exist?  It doesn't have to replace the current web UI, but complement it and give additional system views or controls.
[2014-03-03 16:45:59 -0500] pwelch_: So what does everyone normally do when faced with this: http://www.foodcritic.io/#FC003 Check whether you are running with chef server before using server-specific features
[2014-03-03 16:46:04 -0500] pwelch_: and using ChefSpec
[2014-03-03 16:46:20 -0500] pwelch_: the things you set with the search are not set and ChefSpec tests fail
[2014-03-03 16:46:31 -0500] pwelch_: just curious what everyone else is doing
[2014-03-03 16:47:43 -0500] failshell: is it possible to stream the output of an execute resource?
[2014-03-03 16:53:24 -0500] juliancdunn: cannonball: http://3ofcoins.net/2013/12/11/we-released-chef-browser-today/ ?
[2014-03-03 16:55:54 -0500] chef488: hi
[2014-03-03 16:56:27 -0500] chef488: how i can download the war file from svn repository and deploy to tomcat using the application cookbook?
[2014-03-03 16:56:32 -0500] chef488: any idea?
[2014-03-03 16:56:42 -0500] j^2: chef488: the deploy resource is probbably your best bet
[2014-03-03 16:56:54 -0500] j^2: chef488: http://docs.opscode.com/resource_deploy.html
[2014-03-03 16:57:54 -0500] chef488: can i not implement same using application
[2014-03-03 16:58:05 -0500] chef488: because i am doing this while boostrap
[2014-03-03 16:58:24 -0500] chef488: so i am using the application recipe
[2014-03-03 16:59:02 -0500] chef488: for autodeployment of application war to tomcat server currently i am taking it from local
[2014-03-03 16:59:33 -0500] chef488: but can same implement using remote file
[2014-03-03 17:00:02 -0500] cannonball: juliancdunn: Thanks, that looks like something I could use.
[2014-03-03 17:01:43 -0500] cannonball: juliancdunn: Something that looked realy nice was http://www.google.com/imgres?client=ubuntu&hs=bVX&sa=X&channel=fs&biw=1189&bih=695&tbm=isch&tbnid=r4BKJaTPrqbuzM%3A&imgrefurl=http%3A%2F%2Fperspectives.mvdirona.com%2Fdefault%2Cdate%2C2011-10-25.aspx&docid=I1vDn3M2rLQ-RM&imgurl=http%3A%2F%2Fperspectives.mvdirona.com%2Fcontent%2Fbinary%2FCycleServer.jpg&w=700&h=507&ei=W68UU73kM4TqoAT64YDgCw&zoom=1&ved=0CH4QhBwwDg&iact=rc&dur=760&page=2&start=12&ndsp
[2014-03-03 17:01:44 -0500] cannonball: =17
[2014-03-03 17:01:56 -0500] cannonball: It appears to be a commercial offering of some sort.
[2014-03-03 17:08:18 -0500] sdegutis: Hi!
[2014-03-03 17:08:41 -0500] sdegutis: Do you ever run some compilation steps locally and then push the compiled executables up to your nodes to run them, using Chef?
[2014-03-03 17:09:09 -0500] sdegutis: Right now we push the source to the remote servers and compile them there, but I'm investigating whether we can do this the other way around using Chef.
[2014-03-03 17:15:05 -0500] AntelopeSalad: has anyone gotten timeout "normally up, want up" errors with the runit cookbook?
[2014-03-03 17:15:32 -0500] AntelopeSalad: i'm seeing similar issues reported a few months ago with no resolution, i'm wondering if i'm doing anything wrong -- can someone take a peak at this gist of my setup? https://gist.github.com/AntelopeSalad/bdac8cf9d3be506e5139
[2014-03-03 17:18:08 -0500] Joel: AntelopeSalad: reproduceable every time?
[2014-03-03 17:18:28 -0500] AntelopeSalad: Joel: i ran that setup 3 times as is and have gotten the same error 3 times
[2014-03-03 17:18:41 -0500] Joel: AntelopeSalad: what happens when you call the command by hand on the box?
[2014-03-03 17:18:44 -0500] AntelopeSalad: i never used runit before
[2014-03-03 17:18:53 -0500] Joel: /usr/bin/sv restart /etc/service/puma
[2014-03-03 17:19:24 -0500] AntelopeSalad: identical error, and i also had to run it as sudo if it matters
[2014-03-03 17:19:32 -0500] Joel: so the issue isn't chef.
[2014-03-03 17:19:56 -0500] Joel: you need to run it as the user/group specified in chef exactly.
[2014-03-03 17:20:21 -0500] AntelopeSalad: in my recipe it's set as foo:foo
[2014-03-03 17:20:22 -0500] Joel: but the point is, you need to dig deeper into the error, and since you can reproduce it without chef involved..
[2014-03-03 17:20:31 -0500] AntelopeSalad: yeah i dunno, i saw this https://github.com/teohm/rackbox-cookbook/issues/17
[2014-03-03 17:20:39 -0500] AntelopeSalad: seems like this guy is having an identical issue
[2014-03-03 17:21:32 -0500] AntelopeSalad: googling for that error just results in a bunch of open tickets on the opscode ticket manager
[2014-03-03 17:21:44 -0500] AntelopeSalad: but they all seem to be due to unrelated issues
[2014-03-03 17:22:16 -0500] Joel: https://groups.google.com/forum/#!topic/devopsru/NKt2an7YflM
[2014-03-03 17:24:00 -0500] Joel: it basically sounds like you don't have puma configured correctly
[2014-03-03 17:24:03 -0500] AntelopeSalad: Joel: i'm not sure what i'm looking for here
[2014-03-03 17:24:04 -0500] Joel: you need to figure out why.
[2014-03-03 17:24:14 -0500] AntelopeSalad: i can run puma without runit successfully
[2014-03-03 17:24:33 -0500] Joel: you can call /etc/init.d/puma restart as foo:foo ?
[2014-03-03 17:24:54 -0500] Joel: and it exists 0?
[2014-03-03 17:24:57 -0500] Joel: exits*
[2014-03-03 17:25:14 -0500] Joel: whoops, that's not runnit.
[2014-03-03 17:25:33 -0500] Joel: so yeah, you have something not configured correctly, og. point stands :) try #runit?
[2014-03-03 17:26:38 -0500] AntelopeSalad: yeah if i run exactly what "puma_command" outputs, then the puma server starts perfectly fine
[2014-03-03 17:27:13 -0500] AntelopeSalad: cd into the release_path and run the puma_command results in the server starting and serving my app successfully
[2014-03-03 17:28:11 -0500] Joel: as the correct user?
[2014-03-03 17:28:27 -0500] AntelopeSalad: i don't know what the runit cookbook is doing behind the scenes
[2014-03-03 17:28:38 -0500] Joel: this is the failing line: "/usr/bin/sv restart /etc/service/puma"
[2014-03-03 17:28:39 -0500] AntelopeSalad: right now the user i have setup in the runit service and the user i'm logged in through ssh are both the same
[2014-03-03 17:28:42 -0500] Joel: you first told me that fails
[2014-03-03 17:28:47 -0500] Joel: now you're telling me it succeeds?
[2014-03-03 17:28:49 -0500] AntelopeSalad: no
[2014-03-03 17:28:54 -0500] AntelopeSalad: i'm saying if i run puma without runit it works
[2014-03-03 17:29:24 -0500] Joel: ok, not sure what that has to do with this.
[2014-03-03 17:29:29 -0500] AntelopeSalad: if i run the command you asked me to before it fails with that timeout error which also fails identically in the chef run
[2014-03-03 17:29:34 -0500] Joel: right
[2014-03-03 17:29:39 -0500] Joel: so guess what you need to troubleshoot?
[2014-03-03 17:29:43 -0500] Joel: runit.
[2014-03-03 17:30:03 -0500] AntelopeSalad: but if i take the command that runit is supposed to run, snip it out of the runit script and run it manually it works
[2014-03-03 17:30:33 -0500] Joel: THAT HAS NOTHING TO DO WITH THIS ISSUE.
[2014-03-03 17:31:27 -0500] AntelopeSalad: well, running it manually outside of runit confirms the puma script isn't crippled
[2014-03-03 17:31:43 -0500] Joel: Good luck, I wish you the best.
[2014-03-03 17:39:30 -0500] tvkiley: Hey, I've been using knife ssh ... 'sudo chef-client --why-run' a lot recently, but it's a little hard to read whyrun output because knife ssh doesn't seem to support color output from the ssh sessions. Is there a simple workaround for this?
[2014-03-03 18:14:18 -0500] ev0ldave: hey, does anyone know where the chef client implementation is with partial searches?  Looks like Seth's cookbook indicated it is in 11.10.0 but the search query is still missing it.
[2014-03-03 18:19:38 -0500] law: any thoughts on why I'm getting a NilClass error on this: https://gist.github.com/law/c24fe6e2bc0a18b8be98
[2014-03-03 18:19:49 -0500] law: node[:authorization][:sudo][:groups] is definitely defined
[2014-03-03 18:22:53 -0500] samwierema: Hi, I'm having some trouble with the default iptables cookbook, especially passing parameters to the iptables_rule definition
[2014-03-03 18:23:43 -0500] samwierema: When I do iptables_rule "ports", :variables => {"var1" => "#{var1}"} it never gets passed somehow
[2014-03-03 18:24:21 -0500] samwierema: I.e. I can't access <%= var1 %> in the .erb file
[2014-03-03 18:24:35 -0500] tjr9898: @law change from symbols to strings
[2014-03-03 18:24:59 -0500] tjr9898: node['authorization']['sudo']['groups']
[2014-03-03 18:25:00 -0500] law: errr... pardon my n00bishness, but what does that mean?
[2014-03-03 18:25:04 -0500] law: ahh ok!
[2014-03-03 18:26:06 -0500] law: is that a Chef10 -> Chef11 thing?
[2014-03-03 18:26:21 -0500] law: aaaand that did not work, unfortunately
[2014-03-03 18:26:41 -0500] tjr9898: check you cookbook attributes
[2014-03-03 18:27:50 -0500] law: it's in there, and I did convert the attribute to strings
[2014-03-03 18:28:08 -0500] law: default['authorization']['sudo']['groups'] = Array.new
[2014-03-03 18:30:04 -0500] sdegutis: What's the standard way to deploy some compiled executables and static files to a production server via Chef?
[2014-03-03 18:30:18 -0500] gchristensen: make an rpm or deb or whatever package?
[2014-03-03 18:30:27 -0500] gchristensen: and then have an internal yum/apt repo
[2014-03-03 18:30:40 -0500] law: ^---- what he said
[2014-03-03 18:30:54 -0500] sdegutis: Oh.
[2014-03-03 18:31:04 -0500] sdegutis: That sounds like overkill.
[2014-03-03 18:31:14 -0500] sdegutis: What about scp'ing the files to production?
[2014-03-03 18:31:14 -0500] gchristensen: it'll feel like overikill for the first package
[2014-03-03 18:31:28 -0500] gchristensen: but when its super easy for the next package, or the next version, iits real nice.
[2014-03-03 18:31:37 -0500] sdegutis: There's only like 2 executables and 1 small directory of static files.
[2014-03-03 18:31:40 -0500] law: scp fails in mysterious ways
[2014-03-03 18:31:44 -0500] law: so does 'git pull'
[2014-03-03 18:31:57 -0500] gchristensen: apt and yum are very nicely transactional
[2014-03-03 18:32:04 -0500] sdegutis: Oh?
[2014-03-03 18:32:18 -0500] sdegutis: I thought git pull was transactional too.
[2014-03-03 18:32:22 -0500] gchristensen: yeah. knowing exactly what artifacts got put into production is nice
[2014-03-03 18:32:49 -0500] law: then there's the whole mess with having to maintain ssh keys just for your deploy-user ($deity help you if you do it as root...) etc
[2014-03-03 18:33:01 -0500] law: trust me, native packaging is the way to go
[2014-03-03 18:33:05 -0500] sdegutis: I see.
[2014-03-03 18:33:07 -0500] sdegutis: Thanks.
[2014-03-03 18:33:09 -0500] law: check out 'fpm'
[2014-03-03 18:33:22 -0500] law: it's supposed to make packaging 'not hurt'
[2014-03-03 18:33:38 -0500] law: I'm comfortable writing spec files myself so I've never used it, but a lot of folks find it very useful
[2014-03-03 18:34:39 -0500] sdegutis: So, you create a native package locally, and you push that package to your internal repo which presumably lives on one of the remote servers, and you pull it from all the rest of the remote servers who have access to it?
[2014-03-03 18:34:45 -0500] law: yup
[2014-03-03 18:34:53 -0500] tjr9898: law: I was having some difficulties with sudo + 11.10 but I created that default['authorization']['sudo']['groups']= []
[2014-03-03 18:35:00 -0500] tjr9898: [] instead of array.new
[2014-03-03 18:35:11 -0500] tjr9898: don't know why that would make a difference
[2014-03-03 18:35:51 -0500] law: sdegutis: or have a dedicated 'build' host that rolls all your packages, or (ideally) have your CI server handle the package building
[2014-03-03 18:36:30 -0500] law: tjr9898: I just tried [], but am still getting the same error :-(
[2014-03-03 18:36:38 -0500] tjr9898: law: So the [] was for a different thing.  For sudo i had it equal %w(wheel)
[2014-03-03 18:36:54 -0500] law: err... so like this?
[2014-03-03 18:37:11 -0500] law: default['authorization']['sudo']['groups'] = %w(wheel) ?
[2014-03-03 18:37:17 -0500] tjr9898: yeah
[2014-03-03 18:37:38 -0500] tjr9898: %w is a fun way to do arrays of strings
[2014-03-03 18:37:40 -0500] law: what does the %w() do?
[2014-03-03 18:37:42 -0500] law: ahh ok
[2014-03-03 18:37:47 -0500] law: read my mind :-)
[2014-03-03 18:37:58 -0500] law: bah, no love.  same error :-(
[2014-03-03 18:38:14 -0500] law: this is in ~/chef-repo/cookbooks/sudo/attributes/default.rb I should be defining this, right?
[2014-03-03 18:38:38 -0500] tjr9898: instead of commas and apostrophes you can just use a space
[2014-03-03 18:38:49 -0500] tjr9898: no that was in my wrapper cookbook
[2014-03-03 18:39:34 -0500] tjr9898: the attributes was defined in the wrapper and sudo was included in the recipe
[2014-03-03 18:42:08 -0500] law: I'm only loosely familiar with the wrapper-cookbook pattern, could you recommend a place I could read up on it?
[2014-03-03 18:43:04 -0500] tjr9898: a good starting spot
[2014-03-03 18:43:20 -0500] law: yes, that would be great!
[2014-03-03 18:43:43 -0500] tjr9898: http://devopsanywhere.blogspot.com/2012/11/how-to-write-reusable-chef-cookbooks.html
[2014-03-03 18:43:54 -0500] tjr9898: I had a copy/paste failure
[2014-03-03 18:44:30 -0500] tjr9898: but it should have been fine with attributes in sudo
[2014-03-03 18:44:52 -0500] law: in this testing environment, it is being run via chef-solo if that makes a difference
[2014-03-03 18:46:02 -0500] shlant: anyone have an example of how to avoid specifying node.default['foo'] everytime in a recipe?
[2014-03-03 18:46:34 -0500] shlant: instead of node.default['foo']['bar'] having just ['bar'] somehow
[2014-03-03 18:55:09 -0500] mattsurabian: ruby variable?
[2014-03-03 18:55:37 -0500] shlant: mattsurabian: I would think so but I'm not sure where to start
[2014-03-03 19:00:29 -0500] sdegutis: so many times I thought mattsurabian's nick was fake
[2014-03-03 19:00:40 -0500] sdegutis: But nope, legit name.
[2014-03-03 19:00:49 -0500] mattsurabian: :-p
[2014-03-03 19:01:19 -0500] sdegutis: How do you deal with EC2 dynamic IPs in your recipes?
[2014-03-03 19:01:40 -0500] mattsurabian: sdegutis: you mean for config files and stuff?
[2014-03-03 19:01:55 -0500] sdegutis: We've been using Boucher[1], almost solely for its ability to insert EC2 IPs into config files automatically. [1]: https://github.com/8thlight/boucher
[2014-03-03 19:02:16 -0500] sdegutis: mattsurabian: Yea, although I was asking in general, not specifically to you, sorry for the ambiguity. Although you're welcome to answer too ;)
[2014-03-03 19:02:18 -0500] mattsurabian: services like DNSMadeEasy. When nodes come online they register a dns with a low TTL config files point to fqdn's only
[2014-03-03 19:08:57 -0500] ev0ldave: anybody on the partial search addition to chef?  would like to avoid patching the file if a release will include it soon
[2014-03-03 19:13:39 -0500] comjf: hey guys, chef newb here (shocker I know)... I'm trying to configure nginx using chef-solo and it's complaining about some undefined variable... I think I'm following the docs to a T, can anyone look at it? http://dpaste.com/1683013/
[2014-03-03 19:16:40 -0500] coderanger: ev0ldave: It was included a few releases ago
[2014-03-03 19:18:09 -0500] ev0ldave: i thought that was it but when i check the chef gem 11.10.4 it does not exist
[2014-03-03 19:18:24 -0500] ev0ldave: search/query.rb or partialsearch?
[2014-03-03 19:23:53 -0500] maplebed: Anybody know who or what process controls which cookbooks are listed in the community cookbook site? http://community.opscode.com/cookbooks
[2014-03-03 19:24:40 -0500] someara: maplebed the community does.
[2014-03-03 19:24:57 -0500] someara: its like cpan/rubygems/whatever
[2014-03-03 19:25:02 -0500] maplebed: umm...  yeah.
[2014-03-03 19:25:11 -0500] someara: why whats up
[2014-03-03 19:25:28 -0500] maplebed: so I'm interested in changing the target of the ganglia cokbook from the (unmaintained) heavywater repo to the (recently picked up) ganglia repo.
[2014-03-03 19:26:55 -0500] maplebed: (references: http://community.opscode.com/cookbooks/ganglia https://github.com/hw-cookbooks/ganglia and https://github.com/ganglia/chef-ganglia )
[2014-03-03 19:27:07 -0500] comjf: Can anyone point me in the right direction here, I feel like ohai is broken or requires me to do something the docs don't mention http://dpaste.com/1683013/
[2014-03-03 19:28:06 -0500] someara: maplebed are you part of tha ganglia dev team?
[2014-03-03 19:28:12 -0500] maplebed: yup.
[2014-03-03 19:28:29 -0500] maplebed: and I've talked to the prev maintainer at HW too.
[2014-03-03 19:28:43 -0500] someara: heavywater is pretty responsive.... I'd write them requesting to take over maintenance of the cookbook namespace
[2014-03-03 19:30:06 -0500] maplebed: ok, thanks.  continuing off channel.
[2014-03-03 19:41:11 -0500] grosbob: Hi anyone know how to deserialize data_bag_item table in postgres please ?
[2014-03-03 19:44:33 -0500] ev0ldave: coderanger:  could you point me to the correct entry?  i've grepped the code for partial_search and only find it in searchindex.js.  not seeing a class/method for it
[2014-03-03 19:44:55 -0500] coderanger: ev0ldave: entry in what?
[2014-03-03 19:45:24 -0500] ev0ldave: the chef client code
[2014-03-03 19:45:52 -0500] ev0ldave: coderanger:  https://github.com/opscode/chef
[2014-03-03 19:46:30 -0500] coderanger: ev0ldave: It was just folded into search() IIRC
[2014-03-03 19:46:48 -0500] coderanger: If you specify a list of fields, it is a partial search
[2014-03-03 19:47:58 -0500] someara: hug nation
[2014-03-03 19:48:14 -0500] someara: er, wrong window
[2014-03-03 19:49:42 -0500] grosbob: how can i access the databag other than the chef API please ?
[2014-03-03 19:49:52 -0500] grosbob: solr/PG anything
[2014-03-03 19:51:49 -0500] btm: @btmspox is ill today, so maybe go peek at some pull requests and do some code review without us?
[2014-03-03 19:54:25 -0500] ev0ldave: coderanger:  right, i checked the query.rb in search and it does not seem to include it.  I did pass in the hash to filter out all but name and still get a complete node
[2014-03-03 19:54:33 -0500] ev0ldave: nodes = Chef::Search::Query.new.search(:node, "chef_environment:*",  :keys => { 'name' => ["name"] })
[2014-03-03 19:54:41 -0500] ev0ldave: chef > nodes[0][0].size
[2014-03-03 19:54:42 -0500] ev0ldave:  => 73
[2014-03-03 19:55:54 -0500] coderanger: grosbob: What do you mean?
[2014-03-03 19:56:07 -0500] coderanger: grosbob: You could technically directly access that data in postgres, but that would be a bad idea
[2014-03-03 19:57:16 -0500] coderanger: ev0ldave: Can't check from here, network on the train is too slow for much but look under chef/dsl for where the #search DSL method is implemented
[2014-03-03 19:58:04 -0500] ev0ldave: coderanger: ok, thanks
[2014-03-03 19:58:47 -0500] coderanger: The file might eventually load, /me rubs some cheetah blood on the modem
[2014-03-03 20:05:58 -0500] maraca: any idea why an instance would come up totally fine in us-east-1 but would fail to do so in us-west-2? they are running the same code. The error I am getting is "Response body length 1508 does not match HTTP Content-Length header 206."
[2014-03-03 20:06:12 -0500] maraca: and it's about a template
[2014-03-03 20:06:19 -0500] davidordave: Getting "Chef::Exceptions::ContentLengthMismatch" on a template resource. Any clues on what might be causing this?
[2014-03-03 20:07:39 -0500] maraca: davidordave just got the same ... really curious to know what's going on. Works fine in one region but blows up in another one
[2014-03-03 20:08:47 -0500] davidordave: I get the error on the first run through, but if I re-provision the client succeeds. Not sure if it has something to do with how I have my template laid out. Google has been less than helpful with hints :)
[2014-03-03 20:09:23 -0500] grosbob: coderanger, i know it's a bad idea by API is too slow for me :(
[2014-03-03 20:09:36 -0500] grosbob: coderanger, i managed to unserialize so it's ok
[2014-03-03 20:09:43 -0500] davidordave: @maraca I am testing locally with vagrant and chef-client
[2014-03-03 20:09:47 -0500] coderanger: grosbob: What are you trying to do? The search API can give you back all of them at once
[2014-03-03 20:09:54 -0500] coderanger: grosbob: (well, up to 100 items at a time I think)
[2014-03-03 20:11:03 -0500] maraca: davidordave it works fine for me on vagrant, or in an AWS region where the chef-server is hosted, but if i go cross country then it breaks
[2014-03-03 20:11:09 -0500] coderanger: maraca davidordave: Hosted Chef or your own server?
[2014-03-03 20:11:26 -0500] davidordave: private server
[2014-03-03 20:11:26 -0500] maraca: own server
[2014-03-03 20:11:59 -0500] grosbob: coderanger, i don't know if can i get all the databag for example with the API
[2014-03-03 20:12:28 -0500] grosbob: coderanger, and ask for like 50 node info at the same time
[2014-03-03 20:12:31 -0500] coderanger: grosbob: You can get the list of bags with one API call
[2014-03-03 20:12:41 -0500] coderanger: and then one API call per bag to get all the items (unless you have more than a hundred items in the bag)
[2014-03-03 20:12:51 -0500] coderanger: grosbob: Yes, use the search API
[2014-03-03 20:12:53 -0500] grosbob: i want to get the content of all databag
[2014-03-03 20:13:01 -0500] coderanger: grosbob: With a search query of *:*
[2014-03-03 20:13:09 -0500] grosbob: coderanger, hum let me retry
[2014-03-03 20:13:35 -0500] shlant: anyone know how to use a java servicewrapper with the elasticsearch cookbook?
[2014-03-03 20:13:43 -0500] grosbob: looks like your right
[2014-03-03 20:13:54 -0500] maraca: coderanger running 11.0.8, maybe I should update :/
[2014-03-03 20:14:18 -0500] coderanger: grosbob: The default count is 20, but you can increase that
[2014-03-03 20:19:57 -0500] grosbob: coderanger, can' tmake it for databag :(
[2014-03-03 20:20:10 -0500] coderanger: grosbob: No, for that just use the normal GET /data
[2014-03-03 20:20:18 -0500] coderanger: That will give you a list of all bag names
[2014-03-03 20:20:26 -0500] coderanger: grosbob: What are you doing this for?
[2014-03-03 20:20:28 -0500] grosbob: your api can get multiple databag ?
[2014-03-03 20:20:32 -0500] grosbob: chefpy
[2014-03-03 20:20:42 -0500] grosbob: i want to link data from chef
[2014-03-03 20:20:52 -0500] grosbob: that is why i need lots of data at the same time
[2014-03-03 20:25:04 -0500] coderanger: grosbob: You can't just make one API call per bag?
[2014-03-03 20:25:14 -0500] coderanger: (and one call to get the list of bags)
[2014-03-03 20:25:21 -0500] coderanger: unless you have a ton of bags that shouldn't take long
[2014-03-03 20:26:07 -0500] coderanger: for name in DataBag.list(): items = Search(name, '*:*')
[2014-03-03 20:26:10 -0500] coderanger: or something like that
[2014-03-03 20:30:13 -0500] grosbob: i will test that thanks a lot
[2014-03-03 20:42:34 -0500] j^2: this is what happens when i get board on irc
[2014-03-03 20:42:36 -0500] j^2: https://twitter.com/jjasghar/status/440585490899554304
[2014-03-03 21:04:29 -0500] comjf: any idea why this change was made? https://github.com/opscode-cookbooks/mysql/commit/e40d2ee28ff51a96aadeffeec1e644ae7ea7d4b1
[2014-03-03 21:05:07 -0500] comjf: it appears to make my system install both of those cookbooks, and then throw an error https://github.com/opscode-cookbooks/mysql/commit/e40d2ee28ff51a96aadeffeec1e644ae7ea7d4b1
[2014-03-03 21:05:28 -0500] comjf: sorry I meant error: uninitialized constant Homebrew
[2014-03-03 21:06:05 -0500] coderanger: comjf: It would only download the cookbooks, not run their recipes
[2014-03-03 21:06:34 -0500] coderanger: Chef doesn't support optional dependencies so all platform-specific deps get listed but only used on their respective platforms
[2014-03-03 21:07:03 -0500] comjf: I guess that makes sense, but why then am I getting the uninitialized constant Homebrew error
[2014-03-03 21:07:10 -0500] comjf: when I remove that cookbook, i don't get the error
[2014-03-03 21:07:18 -0500] comjf: and everything is happy
[2014-03-03 21:08:17 -0500] coderanger: comjf: Maybe you have a non-standard cookbook called homebrew in your environment?
[2014-03-03 21:10:07 -0500] comjf: coderanger: no sir, I mean I am new with this, but this is my setup: http://dpaste.com/1683386/
[2014-03-03 21:10:49 -0500] coderanger: It should be downloading the homebrew cookbook for you which should have that Homebrew class in it
[2014-03-03 21:11:35 -0500] comjf: coderanger: the line it's complaining about is:         include ::Homebrew::Mixin  in /tmp/vagrant-chef-1/chef-solo-1/cookbooks/homebrew/libraries/homebrew_package.rb
[2014-03-03 21:15:40 -0500] coderanger: comjf: Huh, yeah
[2014-03-03 21:15:52 -0500] coderanger: It should be working I think
[2014-03-03 21:16:00 -0500] coderanger: since the lib files get loaded in alpha order
[2014-03-03 21:16:14 -0500] coderanger: Do you see a homebrew/libraries/homebrew_mixin.rb?
[2014-03-03 21:16:16 -0500] whack: coderanger: re: ohai and specific plugins; whatever is latest? 'gem list' shows 6.20.0
[2014-03-03 21:16:36 -0500] coderanger: whack: Yeah, but if you are starting something new I highly recommend using the ohai 7 rc
[2014-03-03 21:16:40 -0500] coderanger: since a bunch of stuff changed
[2014-03-03 21:16:57 -0500] whack: coderanger: I tried requiring a specific plugin, an dI got the 'platform' and 'platform_version' attributes but they didn't have values; meerly placeholders.
[2014-03-03 21:17:21 -0500] whack: coderanger: noted, will try starting with ohai7 on my next visit to the code
[2014-03-03 21:17:52 -0500] coderanger: whack: Make sure you allow the linux/platform plugin as well
[2014-03-03 21:18:01 -0500] coderanger: (and other platform-specific platform plugins)
[2014-03-03 21:18:02 -0500] whack: coderanger: will test
[2014-03-03 21:18:07 -0500] whack: coderanger: the code is super small what I have now: https://github.com/jordansissel/pleaserun/blob/master/lib/pleaserun/detector.rb#L35-L52
[2014-03-03 21:18:30 -0500] whack: coderanger: how would I know what platform-specific plugins to load?
[2014-03-03 21:18:32 -0500] coderanger: whack: Yeah, been watching the repo :)
[2014-03-03 21:18:48 -0500] coderanger: whack: https://github.com/opscode/ohai/blob/master/lib/ohai/mixin/os.rb
[2014-03-03 21:18:49 -0500] comjf: coderanger: yes that exists... its also odd because everything appears to work if I do a vagrant destroy then vagrant up... but if I do a vagrant provision, I get that error
[2014-03-03 21:19:10 -0500] coderanger: comjf: Try running with chef.log_level = :debug
[2014-03-03 21:19:16 -0500] coderanger: comjf: And see if you see that lib file loaded
[2014-03-03 21:20:36 -0500] comjf: I don't think it is
[2014-03-03 21:20:37 -0500] comjf: http://dpaste.com/1683432/
[2014-03-03 21:20:51 -0500] coderanger: comjf: You would see up above that
[2014-03-03 21:20:57 -0500] coderanger: it prints out each lib file as it gets loaded
[2014-03-03 21:21:13 -0500] coderanger: comjf: Oh, I just noticed you are using chef 10
[2014-03-03 21:21:21 -0500] coderanger: comjf: Chef 10 didn't sort stuff before loading IIRC
[2014-03-03 21:21:35 -0500] whack: coderanger: ahha, that helps muchly!
[2014-03-03 21:21:41 -0500] coderanger: comjf: If this is something new, you should really be using Chef 11
[2014-03-03 21:22:09 -0500] coderanger: whack: I have to figure out if I can work pleaserun into my eternally-planned pan-service cookbook :)
[2014-03-03 21:22:23 -0500] comjf: interesting... it says I am using Chef: 11.10.4
[2014-03-03 21:22:28 -0500] comjf: on my host at least
[2014-03-03 21:23:08 -0500] comjf: maybe berkshelf isn't using 11?
[2014-03-03 21:23:13 -0500] coderanger: comjf: You probably are, on the host
[2014-03-03 21:23:25 -0500] coderanger: comjf: but you are using a vbox image with an old version of chef in it
[2014-03-03 21:23:30 -0500] coderanger: comjf: Check out vagrant-omnibus
[2014-03-03 21:23:59 -0500] comjf: thanks, will give it a try
[2014-03-03 21:24:25 -0500] whack: coderanger: that's what I Plan anyway ;)
[2014-03-03 21:24:43 -0500] whack: coderanger: I looked at puppet/chef's custom resource docs last night and nope.avi'd right out of that nonsense.
[2014-03-03 21:24:53 -0500] coderanger: whack: Heh, I can handle that part of it
[2014-03-03 21:24:59 -0500] coderanger: whack: At least for chef :)
[2014-03-03 21:25:02 -0500] whack: coderanger: but the idea is to provide "install this crap, activate that crap" through chef
[2014-03-03 21:25:17 -0500] whack: coderanger: lovely! The API is pretty much settled for pleaserun if you want to have a go at it.
[2014-03-03 21:25:18 -0500] coderanger: whack: My goal on the chef side is to split "run this process" from "this is how to run a process"
[2014-03-03 21:25:24 -0500] whack: coderanger: +1
[2014-03-03 21:25:41 -0500] coderanger: whack: too many opscode cookbooks are hardwired to runit _
[2014-03-03 21:28:45 -0500] comjf: coderanger: beautiful, it works now, thank you so much
[2014-03-03 21:29:00 -0500] holoway: coderanger: because runit is your lord and master, you heathen
[2014-03-03 21:29:11 -0500] coderanger: comjf: This is why you never ever us listdir() without sorting it :)
[2014-03-03 21:29:22 -0500] coderanger: holoway: You are making my neckbeard itch
[2014-03-03 21:29:51 -0500] holoway: coderanger: it's the small ways that I give that keep you close
[2014-03-03 21:29:55 -0500] holoway: :)
[2014-03-03 21:30:02 -0500] comjf: coderanger: idk what I am doing, first day using chef and it's exteremly confusing from error to error, but I feel like I've accomplished at least some nw
[2014-03-03 21:30:24 -0500] coderanger: comjf: Just ask in here as you him 'em, thats what we're here for :)
[2014-03-03 21:30:29 -0500] coderanger: That and bad jokes about bitcoin
[2014-03-03 21:32:28 -0500] whack: holoway: always be sv -k /service/coderanger'ing ?
[2014-03-03 21:33:44 -0500] comjf: coderanger: no love for doge?
[2014-03-03 21:34:22 -0500] coderanger: comjf: Our resident shibe is actually in the office today, such puppy.
[2014-03-03 21:39:46 -0500] kristianpaul: Howdy,
[2014-03-03 21:40:21 -0500] kristianpaul: I have a cookbook called foo, with both a recipe named default and table
[2014-03-03 21:40:30 -0500] kristianpaul: Now happen i'm using chef-zero
[2014-03-03 21:40:55 -0500] kristianpaul: If i run chef-client -z  -o foo, all went okay
[2014-03-03 21:42:25 -0500] kristianpaul: BUT, what about chef-client -z -o foo[tables], i got this error http://pastebin.com/F4EyPL9Y
[2014-03-03 21:42:48 -0500] kristianpaul: Is this that chef zero dont support running anyother recipe besides the default from the cookbook=
[2014-03-03 21:42:52 -0500] kristianpaul: s/=/?
[2014-03-03 21:43:10 -0500] micgo: kristianpaul: the -o takes the entire cookbook
[2014-03-03 21:43:25 -0500] kristianpaul: oh, dude..
[2014-03-03 21:43:48 -0500] micgo: if you want to specify only running recipe[table], you should be able to pass in runlist recipe[table] at the end of the first command
[2014-03-03 21:44:40 -0500] coderanger: kristianpaul: That should be recipe[foo::table]
[2014-03-03 21:44:44 -0500] micgo: right
[2014-03-03 21:44:51 -0500] micgo: I'm wrong :)
[2014-03-03 21:45:06 -0500] coderanger: foo is short for recipe[foo], which is short for recipe[foo::default]
[2014-03-03 21:45:08 -0500] kristianpaul: I was about to..
[2014-03-03 21:45:18 -0500] kristianpaul: e/me triers again
[2014-03-03 21:45:25 -0500] kristianpaul: oh god, sorry
[2014-03-03 21:46:01 -0500] comjf: quick question, I was able to install a service like mysql, but I couldn't use it until I sshed in and did sudo start mysql
[2014-03-03 21:46:15 -0500] comjf: how do I do after mysql installs?
[2014-03-03 21:46:27 -0500] coderanger: comjf: The recipe should be starting
[2014-03-03 21:46:33 -0500] comjf: odd
[2014-03-03 21:46:45 -0500] comjf: I'll destroy and recreate, could be an issue with a temp thing I did
[2014-03-03 21:48:59 -0500] AntelopeSalad: coderanger, in theory all symlinks should be created before deploy's restart_command is ran right?
[2014-03-03 21:49:11 -0500] coderanger: AntelopeSalad: Yes
[2014-03-03 21:49:29 -0500] AntelopeSalad: have you had any experience with using runit in combination with deploy's restart_command?
[2014-03-03 21:49:56 -0500] coderanger: AntelopeSalad: Nope, like I said before, I don't actually recommend deploy apps this way anymore
[2014-03-03 21:50:13 -0500] AntelopeSalad: yeah i thought maybe you did in the past
[2014-03-03 21:51:36 -0500] comjf: coderanger: just curious, how do you recommend deploying apps?
[2014-03-03 21:51:54 -0500] samwierema: When installing a chef-server through the nornal ways, are the chef-server variables always available (e.g. node['chef-server']['nginx']['ssl_port'])?
[2014-03-03 21:52:01 -0500] coderanger: comjf: Build packages, omnibus + jenkins + depot
[2014-03-03 21:52:06 -0500] AntelopeSalad: i think i might just +500 rep bounty it on SO in 2 days
[2014-03-03 21:52:43 -0500] coderanger: samwierema: Not sure what you mean
[2014-03-03 21:53:37 -0500] AntelopeSalad: it's so weird how chef successfully does a run with runit/puma but then the service doesn't work
[2014-03-03 21:54:02 -0500] AntelopeSalad: so i re-run chef client and then chef rails with an error that's impossible to decrpy
[2014-03-03 21:54:08 -0500] AntelopeSalad: *fails
[2014-03-03 21:56:10 -0500] AntelopeSalad: how do you debug an error with no stack trace which gives no context?
[2014-03-03 21:56:20 -0500] AntelopeSalad: or is there a way to get chef to actually not eat up every error that other apps throw?
[2014-03-03 21:58:43 -0500] coderanger: AntelopeSalad: The deploy resource implements its callbacks in a really weird way, not surprised it is hard to debug
[2014-03-03 21:58:52 -0500] samwierema: coderanger: I installed chef-server through here http://www.getchef.com/chef/install/, but I have a cookbook where I want to know what port nginx is running from. However, when I look at the attributes for the node, I can't find it
[2014-03-03 21:59:01 -0500] samwierema: coderanger: do I need to run the chef-server cookbook to get these variables?
[2014-03-03 21:59:21 -0500] AntelopeSalad: coderanger: i constantly have to deal with this stuff -- it's not the deploy resource
[2014-03-03 21:59:32 -0500] AntelopeSalad: Ran /usr/bin/sv restart /etc/service/puma returned 1
[2014-03-03 21:59:39 -0500] AntelopeSalad: no track, no context, nothing
[2014-03-03 21:59:43 -0500] AntelopeSalad: *trace
[2014-03-03 22:01:30 -0500] jhujhiti: how does chef determine that a resource is "up to date"? i'm trying to use yum_key from the yum cookbook, with action :add, and it thinks it's up to date despite the file not existing
[2014-03-03 22:02:13 -0500] sentinal8473: hello, i am having issues with application_python, is there any examples that work with django 1.5 +
[2014-03-03 22:03:00 -0500] sentinal8473: i think its writing the settings.py file to the wrong location
[2014-03-03 22:04:26 -0500] coderanger: sentinal8473: Yeah, just set the path yourself
[2014-03-03 22:04:41 -0500] coderanger: sentinal8473: Check out the pydotorg-redesign cookbook under Python/psf-chef
[2014-03-03 22:05:17 -0500] sentinal8473: i am just about to try local_settings_file "./testdjangoproj/settings.py"
[2014-03-03 22:05:38 -0500] coderanger: sentinal8473: In my defense, that cookbook predates the new django layout by quite a while :)
[2014-03-03 22:05:50 -0500] coderanger: jhujhiti: Varies per resource
[2014-03-03 22:06:01 -0500] jhujhiti: coderanger: https://github.com/opscode-cookbooks/yum/blob/v2.4.2/providers/key.rb
[2014-03-03 22:06:07 -0500] jhujhiti: action :add
[2014-03-03 22:06:38 -0500] sentinal8473: @coderanger ah yeah, have been reading though the code, i am going to attempt to change it for newer django's
[2014-03-03 22:06:40 -0500] jhujhiti: the file /etc/pki/rpm-gpg/#{new_resource.key} does not exist, but it still decides to not do anything
[2014-03-03 22:07:08 -0500] coderanger: jhujhiti: That never calls updated_by_last_action so it will never show as updated correctly
[2014-03-03 22:07:12 -0500] sentinal8473: @coderanger this will be my first attempt at modding a cookbook :)
[2014-03-03 22:07:50 -0500] jhujhiti: then why does it work when i use it at converge-time instead of compile-time?
[2014-03-03 22:08:06 -0500] jhujhiti: all i did was add .run_action(:add) to the block.
[2014-03-03 22:09:45 -0500] coderanger: jhujhiti: It is still working, just not showing that it did :)
[2014-03-03 22:09:58 -0500] jhujhiti: it's not working. the key does not get created
[2014-03-03 22:10:15 -0500] jhujhiti: same thing with the yum_repository resource. it never creates the /etc/yum.repos.d file
[2014-03-03 22:10:35 -0500] davidordave: @maraca, did you happen to find anything regarding the 'ContentLengthMismatch' error you were seeing earlier?
[2014-03-03 22:11:22 -0500] maraca: davidordave nope - ive been having it for a few weeks now and still trying to figure out what's going on
[2014-03-03 22:11:52 -0500] coderanger: jhujhiti: Just trace it through, do you see that info log line?
[2014-03-03 22:12:06 -0500] coderanger: jhujhiti: Oh, did you say you are trying to use this at compile time?
[2014-03-03 22:12:15 -0500] jhujhiti: yes
[2014-03-03 22:12:22 -0500] coderanger: Yeah, that won't work
[2014-03-03 22:12:30 -0500] coderanger: Most LWRPs can't be used at compile time
[2014-03-03 22:12:37 -0500] coderanger: If you add use_inline_resources to it, it should work
[2014-03-03 22:12:41 -0500] someara: jhujhiti try using the 3.x series of the yum cookbooks
[2014-03-03 22:13:05 -0500] jhujhiti: someara: i can't because not all of my third-party cookbooks have been updated
[2014-03-03 22:13:14 -0500] someara: ah
[2014-03-03 22:13:50 -0500] jhujhiti: someara: i don't know who decided it was a good idea to break backwards-compatibility, but boy was i mad when i found that
[2014-03-03 22:13:55 -0500] someara: fork and PR them?
[2014-03-03 22:14:28 -0500] davidordave: @maraca, that's too bad. The only mention I have been able to find so far is: https://tickets.opscode.com/browse/CHEF-5041 which doesn't really apply in my situation.
[2014-03-03 22:14:48 -0500] jhujhiti: coderanger: example of use_inline_resources? the blurb about it on the lwrp page is not really clear to me
[2014-03-03 22:14:58 -0500] coderanger: jhujhiti: Just at the top of that file
[2014-03-03 22:15:04 -0500] coderanger: add "use_inline_resources"
[2014-03-03 22:15:28 -0500] jhujhiti: Cannot find a resource for use_inline_resources on centos version 6.4
[2014-03-03 22:15:47 -0500] jtimberman: jhujhiti: are you using Chef 11?
[2014-03-03 22:15:49 -0500] jhujhiti: yes
[2014-03-03 22:15:53 -0500] maraca: davidordave the only thing i suspect is potentially bad characters from a copy  paste somewhere .. not sure
[2014-03-03 22:16:03 -0500] jhujhiti: 11.6.0
[2014-03-03 22:18:56 -0500] jhujhiti: ideas...?
[2014-03-03 22:21:05 -0500] coderanger: jhujhiti: Pastebin what you have?
[2014-03-03 22:27:05 -0500] jhujhiti: http://pastie.org/8846698
[2014-03-03 22:28:50 -0500] coderanger: jhujhiti: Ahh no
[2014-03-03 22:28:59 -0500] coderanger: You need to add that to the top of the provider file
[2014-03-03 22:29:04 -0500] coderanger: you will have to fork the yum cookbook
[2014-03-03 22:29:11 -0500] jhujhiti: *grumble*
[2014-03-03 22:29:22 -0500] coderanger: jhujhiti: You could also use Poise or the now cookbook
[2014-03-03 22:29:28 -0500] jhujhiti: or i could just drop the files manually
[2014-03-03 22:30:01 -0500] coderanger: jhujhiti: Or that, yes
[2014-03-03 22:30:09 -0500] coderanger: the now cookbook is probably easy enough though :)
[2014-03-03 22:30:15 -0500] jhujhiti: i was typing that before i saw what you said
[2014-03-03 22:30:34 -0500] coderanger: Just move the compile time stuff to its own recipe and call include_recipe_now on it
[2014-03-03 22:30:40 -0500] jhujhiti: do you guys have any idea how infuriating it is to google chef-related things?
[2014-03-03 22:30:51 -0500] jhujhiti: can you link me to the now cookbook?
[2014-03-03 22:31:00 -0500] coderanger: jhujhiti: I literally said the same thing
[2014-03-03 22:31:10 -0500] coderanger: jhujhiti: Good shortcut, ckbk.it/<name>
[2014-03-03 22:31:13 -0500] coderanger: So ckbk.it/now
[2014-03-03 22:31:20 -0500] coderanger: Thank btm for that one :)
[2014-03-03 22:31:29 -0500] AntelopeSalad: it's only infuriating when you spend literally 40 hours over a month trying to get something to work without success because chef's error reporting is horrible
[2014-03-03 22:32:05 -0500] jhujhiti: AntelopeSalad: oh i've been very polite through this conversation, you should hear the things i say when things aren't working.
[2014-03-03 22:32:27 -0500] AntelopeSalad: i basically spent all of feb. trying to get the deploy resource to work :<
[2014-03-03 22:32:30 -0500] davidordave: @jhujhiti maybe this? https://github.com/coderanger/now-cookbook
[2014-03-03 22:32:46 -0500] coderanger: davidordave: someara has a slightly better version of it
[2014-03-03 22:33:01 -0500] someara: its on the community site
[2014-03-03 22:33:08 -0500] coderanger: Yep, thats the one I linked to
[2014-03-03 22:33:13 -0500] jhujhiti: it's on the community site without a link to github??
[2014-03-03 22:33:19 -0500] someara: just puts "depends 'now'" in your metadata.rb and let berkshelf sort it out
[2014-03-03 22:33:25 -0500] davidordave: Ah, thanks :)
[2014-03-03 22:33:59 -0500] AntelopeSalad: someara: if i start a kickstart campaign will you guys give the deploy resource some love in a future version?
[2014-03-03 22:35:54 -0500] coderanger: AntelopeSalad: It should really get removed from Chef core
[2014-03-03 22:36:32 -0500] AntelopeSalad: i'll gladly do all of the monkey work to set it up and shovel you guys money if that's what it takes
[2014-03-03 22:36:46 -0500] jmickle: someara: hey man
[2014-03-03 22:36:52 -0500] jmickle: someara: loved your last blog entry on why run
[2014-03-03 22:37:32 -0500] coderanger: AntelopeSalad: Unfortunately money doesn't buy time :)
[2014-03-03 22:37:35 -0500] jhujhiti: so... how is 'now' going to fix my issue? it sounds like it is only an include_recipe thing?
[2014-03-03 22:37:37 -0500] someara: thanks. I need to make another one. I'm falling behind my "once per year" frequency
[2014-03-03 22:37:53 -0500] coderanger: jhujhiti: include_recipe_now runs everything in the requested recipe at compile time
[2014-03-03 22:37:59 -0500] jmickle: coderanger: how are you
[2014-03-03 22:38:03 -0500] AntelopeSalad: if it raised like $30,000 you wouldn't spend a week just cranking out some stuff to make it not horrible?
[2014-03-03 22:38:04 -0500] coderanger: jhujhiti: In which a way that it will work even with older LWRPs
[2014-03-03 22:38:09 -0500] jmickle: someara: i know the feeling i haven't touched my blog in over a year
[2014-03-03 22:38:22 -0500] coderanger: AntelopeSalad: No, my time is mostly limited by burnout at this point, not funds
[2014-03-03 22:38:30 -0500] jhujhiti: coderanger: so.. i can include_recipe_now 'yum' and then use the LWRPs? and.. that will work... somehow?
[2014-03-03 22:38:43 -0500] AntelopeSalad: this has been one of the worst experiences i've encountered, like... it's enough to drive me away from chef
[2014-03-03 22:39:12 -0500] jmickle: AntelopeSalad: whats wrong
[2014-03-03 22:39:27 -0500] coderanger: jhujhiti: No, put your instantiation of yum_key in a recipe and run include_recipe_now on that
[2014-03-03 22:39:42 -0500] coderanger: AntelopeSalad: I literally told you this was a bad idea _nonstop_ when you started
[2014-03-03 22:39:51 -0500] AntelopeSalad: jmickle: all i wanted to was setup runit to handle a puma process
[2014-03-03 22:39:53 -0500] coderanger: AntelopeSalad: I can go get the chat logs if you would like proof
[2014-03-03 22:40:16 -0500] AntelopeSalad: coderanger: you and a few others told me i should move to chef to deploy my app
[2014-03-03 22:40:35 -0500] coderanger: AntelopeSalad: Yep, and I told you to use rpms or debs to do it :)
[2014-03-03 22:40:40 -0500] kshep: soo.... beam.smp on my chef server has the cpu pegged... I keep seeing https://gist.github.com/kshep/d87cae1d3477e0706f0a
[2014-03-03 22:40:44 -0500] coderanger: Deploying from git with chef is a Bad Idea
[2014-03-03 22:40:58 -0500] jmickle: deploying from git is a bad idea all together
[2014-03-03 22:41:12 -0500] jkeiser: Bad style or doesn't work?
[2014-03-03 22:41:13 -0500] coderanger: kshep: Runaway CPU is usually a sign that you have a grumpy depsolver
[2014-03-03 22:41:19 -0500] jmickle: bad style
[2014-03-03 22:41:35 -0500] jmickle: why would you want to be at the mercy of a 50/50 chance of git working/running/etc
[2014-03-03 22:41:37 -0500] AntelopeSalad: coderanger: but the problem i have now isn't the deployment, it's having deploy() handle puma through monit
[2014-03-03 22:41:44 -0500] kshep: coderanger: any suggs RE tshooting that?
[2014-03-03 22:41:47 -0500] jkeiser: We had git deploys for a long time and it was working for us.  I like doing packages better, but if there are issues deploying from git, I'd like to know
[2014-03-03 22:42:06 -0500] jkeiser: jmickle: github is one thing, git is another
[2014-03-03 22:42:10 -0500] coderanger: jkeiser: The deploy resource is a tangled mess, qed :)
[2014-03-03 22:42:11 -0500] jmickle: jkeiser: it comes down to understanding whats going to your infrastructure
[2014-03-03 22:42:32 -0500] jmickle: jkeiser: proper deploys should always create an artifact and that artifact should be able to be push around as needed
[2014-03-03 22:42:33 -0500] coderanger: kshep: Unfortunately there isn't much
[2014-03-03 22:42:41 -0500] kshep: hm
[2014-03-03 22:42:43 -0500] coderanger: kshep: Have oyu noticed any chef-clients failing to check in?
[2014-03-03 22:42:48 -0500] coderanger: kshep: knife status might help with that
[2014-03-03 22:42:55 -0500] jkeiser: I like should, I'm not a fan when it turns into must
[2014-03-03 22:43:17 -0500] jmickle: AntelopeSalad: jkeiser: its not often that I use me weight to tell you not to do something but my weight sides with code ranger :-P
[2014-03-03 22:43:29 -0500] coderanger: kshep: Once you know which run list it is (if indeed it is a grumpy devsolver) https://gist.github.com/coderanger/9198932 can help debug why it is grumpy
[2014-03-03 22:43:40 -0500] jmickle: its a bad idea and frankly the chef deploy resource is really sucky
[2014-03-03 22:43:52 -0500] jmickle: its great if you want to deploy a rails app
[2014-03-03 22:43:55 -0500] jmickle: but for everything else
[2014-03-03 22:44:03 -0500] coderanger: jkeiser: The deploy resource should at least get pulled into a cookbook outside of core
[2014-03-03 22:44:21 -0500] kshep: isn't the deploy app in large part intended to allow folks using Capistrano for Rails deployments to just have Chef do it instead?
[2014-03-03 22:44:33 -0500] jmickle: yep
[2014-03-03 22:44:35 -0500] jkeiser: I'll buy all those things :)  If deploy resource is broken, we should either fix or do it right (and I'm betting the answer is do a new one correctly rather than fix)
[2014-03-03 22:44:36 -0500] jmickle: afaik
[2014-03-03 22:45:00 -0500] kshep: coderanger: thanks... just sitting here waiting on an interminable knife status run....
[2014-03-03 22:45:02 -0500] AntelopeSalad: kshep: that's what i'm trying to do
[2014-03-03 22:45:12 -0500] AntelopeSalad: but it seems to have been one of the worst programming experiences in my entire life
[2014-03-03 22:45:14 -0500] kshep: AntelopeSalad: Have you been using Capistrano?
[2014-03-03 22:45:20 -0500] coderanger: kshep: It might help to sighup the runaway procs too
[2014-03-03 22:45:30 -0500] AntelopeSalad: yes, and it was trivial to setup and work with
[2014-03-03 22:45:34 -0500] AntelopeSalad: everything just instantly worked
[2014-03-03 22:45:37 -0500] coderanger: jmickle: It doesn't even work great with Rails
[2014-03-03 22:45:47 -0500] AntelopeSalad: but i wanted to remove it from my stack because i'm already using chef to setup the server
[2014-03-03 22:45:58 -0500] coderanger: jmickle: The whole structure is built around imperative actions not convergence
[2014-03-03 22:46:02 -0500] AntelopeSalad: and i like the idea of removing stuff when i can if it makes the overall bigger picture less complicated
[2014-03-03 22:46:17 -0500] jmickle: coderanger: got it
[2014-03-03 22:46:19 -0500] coderanger: AntelopeSalad: Just don't use the deploy resource, seriously
[2014-03-03 22:46:23 -0500] coderanger: AntelopeSalad: Use a git resource yourself
[2014-03-03 22:46:41 -0500] AntelopeSalad: at this point it might be the runit_service that's the problem
[2014-03-03 22:46:42 -0500] jkeiser: That seems like good advice to me
[2014-03-03 22:46:43 -0500] AntelopeSalad: not deploy
[2014-03-03 22:46:44 -0500] jmickle: AntelopeSalad: I create artifacts and then use an S3 resource to grab the tar balled resource
[2014-03-03 22:46:47 -0500] AntelopeSalad: but i don't know for sure
[2014-03-03 22:46:48 -0500] jkeiser: ah
[2014-03-03 22:46:53 -0500] jkeiser: What is runit_service doing?
[2014-03-03 22:47:02 -0500] jmickle: AntelopeSalad: jenkins builds revisioned versions of all my apps
[2014-03-03 22:47:10 -0500] jmickle: AntelopeSalad: jenkins uploads to s3
[2014-03-03 22:47:12 -0500] AntelopeSalad: it's doing this https://gist.github.com/AntelopeSalad/096735712f5794c9751e
[2014-03-03 22:47:14 -0500] jmickle: AntelopeSalad: chef picks off s3
[2014-03-03 22:47:26 -0500] jmickle: AntelopeSalad: much faster, more efficient and lots more control
[2014-03-03 22:47:48 -0500] jmickle: AntelopeSalad: i don't personally use rpms/debs because i don't like being OS dependent for my app
[2014-03-03 22:47:56 -0500] coderanger: jmickle: omnibus ftw
[2014-03-03 22:48:23 -0500] jmickle: coderanger: hehe thought about that but I've preferred to keep the artifacts as abstracted away from any dependencies on the system as possible
[2014-03-03 22:48:24 -0500] AntelopeSalad: you would still need to manage your process right?
[2014-03-03 22:48:45 -0500] jmickle: AntelopeSalad: manage jenkins?
[2014-03-03 22:48:52 -0500] AntelopeSalad: no, the app server
[2014-03-03 22:48:55 -0500] jmickle: AntelopeSalad: it literally picks off of github commits
[2014-03-03 22:48:59 -0500] jkeiser: holy hell I've never seen nested resources like that, is that a new thing?
[2014-03-03 22:49:01 -0500] jmickle: AntelopeSalad: then i use call backs to do chef deploys
[2014-03-03 22:49:13 -0500] AntelopeSalad: restart_command apparently accepts a block
[2014-03-03 22:49:16 -0500] AntelopeSalad: which isn't even documented
[2014-03-03 22:49:32 -0500] coderanger: jmickle: Not sure what you mean, omnibus-built packages have _no_ dependencies outside of libc
[2014-03-03 22:49:37 -0500] AntelopeSalad: the documentation says it only takes a string, but it actually takes a block too
[2014-03-03 22:49:48 -0500] coderanger: jmickle: Thats the whole point, we don't use apt as anything by a binary transport
[2014-03-03 22:49:51 -0500] jmickle: coderanger: yeah i haven't looked much into them, i meant i've thought about them lately but haven't done much with that
[2014-03-03 22:50:31 -0500] jhujhiti: coderanger: factoring it out and using now worked. thanks, but what a stupid hack for a stupid problem
[2014-03-03 22:50:50 -0500] coderanger: jhujhiti: Yep, LWRPs are fundamentally broken in several ways, don't use 'em
[2014-03-03 22:51:01 -0500] jhujhiti: coderanger: i don't but third parties do!
[2014-03-03 22:51:13 -0500] jhujhiti: coderanger: and the mantra is to re-use community code, right?
[2014-03-03 22:51:14 -0500] coderanger: jhujhiti: Rewrite the universe :) Thats what I do anyway
[2014-03-03 22:51:26 -0500] coderanger: jhujhiti: Warning: taking advice from me may lead to insanity
[2014-03-03 22:51:38 -0500] jhujhiti: coderanger: if you want something done right, you've got to do it yourself.
[2014-03-03 22:51:44 -0500] jhujhiti: i live my life by this ;)
[2014-03-03 22:52:06 -0500] coderanger: jhujhiti: Well no, I just need to make enough examples for others to learn my gospel
[2014-03-03 22:52:17 -0500] jmickle: ;-)
[2014-03-03 22:52:29 -0500] coderanger: aka Thought Leading
[2014-03-03 22:52:30 -0500] jhujhiti: and, in situations when i can actually do everything myself, everything is wonderful
[2014-03-03 22:52:54 -0500] jkeiser: AntelopeSalad: what happens when you try to run /etc/service/puma yourself?
[2014-03-03 22:53:38 -0500] tball: coderanger: What makes you say LWRPs are broken?  Is there a specific issue?
[2014-03-03 22:53:41 -0500] kshep: these days I don't start from scratch... I just make liberal use of https://github.com/bryanwb/chef-rewind
[2014-03-03 22:53:42 -0500] jkeiser: If there is a timeout running it, it sort of implies that the service is taking too long to start
[2014-03-03 22:54:02 -0500] AntelopeSalad: jkeiser: if i do "sv start puma" it says access denied which is weird because the user is not root in the runit_service
[2014-03-03 22:54:30 -0500] AntelopeSalad: if i run it with sudo manually, the server starts but it's not doing what it's supposed to do
[2014-03-03 22:54:31 -0500] coderanger: tball: Several, lack of inheritance, use_inline_resources fixes semantic scoping in one way but breaks it in another, putting the resource and provider in different files sucks, I can go on for a while
[2014-03-03 22:54:46 -0500] AntelopeSalad: it also gives no logs/stdout/feedback/errors, it just hangs when i try to access the web app it's serving
[2014-03-03 22:54:55 -0500] coderanger: tball: Poise is, in my entirely unbiased opinion, much better for a small amount of boiler plate :)
[2014-03-03 22:55:23 -0500] jkeiser: AntelopeSalad: I can't say what is wrong, but I would try to find out what's wrong with running it manually and work backwards from there
[2014-03-03 22:55:53 -0500] AntelopeSalad: jkeiser: that's what i spent the whole day doing -- nothing throws meaningful errors
[2014-03-03 22:56:13 -0500] mmzyk: If anyone is running into CHEF-3952 still (https://tickets.opscode.com/browse/CHEF-3952) Cookbook view reports ERROR: undefined method 'close!' for nil:NilClass, we'd appreciate it if anyone would send some test data our way. Feel free to attach it to the ticket. We're trying to ensure this is fixed for the 11.1 OSC release.
[2014-03-03 22:56:15 -0500] AntelopeSalad: all i know is when i remove chef and runit out of the equation and run the process through a terminal it works great
[2014-03-03 22:56:40 -0500] jkeiser: What user is the process running as when you use sv start puma?
[2014-03-03 22:57:09 -0500] AntelopeSalad: that command will fail because it says i don't have permission which is crippled imo
[2014-03-03 22:57:32 -0500] AntelopeSalad: because i told runit_service to use the user of "chef" (in the gist node[:myapp][:user] == 'chef')
[2014-03-03 22:57:48 -0500] AntelopeSalad: and i'm logged in as that user manually atm
[2014-03-03 22:59:23 -0500] AntelopeSalad: if i replace my restart_command with printetv > /tmp/puma.env the env variables are set to USER=root instead of USER=chef too for some reason, i dunno if that's normoal
[2014-03-03 22:59:46 -0500] AntelopeSalad: *printetv = printenv
[2014-03-03 23:00:14 -0500] AntelopeSalad: also most of that gist was taken from this article http://tech.hulu.com/blog/2012/07/06/automating-system-provisioning-and-application-deployment-with-chef/
[2014-03-03 23:07:12 -0500] jkeiser: I wish I knew enough to guide you, but I am not a runit expert
[2014-03-03 23:07:47 -0500] AntelopeSalad: yeah, i only started working with it today -- all i know is there's a ticket open with the same error from 3 months ago
[2014-03-03 23:08:00 -0500] AntelopeSalad: and the person decided to just stop using it all together and moved onto a different solution
[2014-03-03 23:08:31 -0500] AntelopeSalad: so i'm not sure if it's a cookbook error, runit error, user error, no idea... there's no meaningful errors provided by chef to figure it out
[2014-03-03 23:09:55 -0500] jkeiser: I think it's pretty clear there is an issue with the runit service that was created
[2014-03-03 23:10:07 -0500] kshep: coderanger: your little "puts api.post("/environments/production/cookbook_versions",..." hangs. Good sign I guess. Thanks :-)
[2014-03-03 23:10:08 -0500] jkeiser: But that doesn't mean chef isn't involved in Doing It Wrong
[2014-03-03 23:10:32 -0500] AntelopeSalad: jkeiser: it would be cool if i could even stop the runit service, but apparently that's impossible too
[2014-03-03 23:10:45 -0500] coderanger: kshep: Did you fill in the cookbooks for the ...?
[2014-03-03 23:10:47 -0500] jkeiser: kill -9!
[2014-03-03 23:10:49 -0500] kshep: yes
[2014-03-03 23:10:55 -0500] AntelopeSalad: kill -9 doesn't do it, it just insta reloads
[2014-03-03 23:11:17 -0500] AntelopeSalad: i also followed the directions on the man page, nothing -- it just insta reloads
[2014-03-03 23:11:19 -0500] kshep: coderanger: I'm backing off... trying the recipes one at a time... then building up the full runlist
[2014-03-03 23:11:20 -0500] coderanger: kshep: Then yeah, kill the erchef process and try each of the dependencies of the stuff in the run list until you find the combo that fails
[2014-03-03 23:11:26 -0500] coderanger: kshep: Yep, thats the ticket
[2014-03-03 23:11:27 -0500] kshep: coderanger: great minds ;-)
[2014-03-03 23:11:42 -0500] coderanger: kshep: Unfortunately, as you already know, dependency solvers
[2014-03-03 23:11:46 -0500] coderanger: </jokesfornerds>
[2014-03-03 23:11:58 -0500] AntelopeSalad: maybe runit is just garbage, i could try using upstart maybe
[2014-03-03 23:13:04 -0500] kshep: coderanger: isn't ther just a "run each of these recipes on it's own then try all cobinations" command line option for that knife -E command?
[2014-03-03 23:13:21 -0500] holoway: AntelopeSalad: you need to read about runit
[2014-03-03 23:13:29 -0500] holoway: http://smarden.org/runit/
[2014-03-03 23:13:39 -0500] holoway: AntelopeSalad: you need to tell the supervisor to stop the process
[2014-03-03 23:14:06 -0500] AntelopeSalad: holoway: that's fine, but about what the runit_service?
[2014-03-03 23:15:18 -0500] holoway: AntelopeSalad: don't troubleshoot the abstraction layer until you know you have the underlying subsystem working
[2014-03-03 23:15:18 -0500] coderanger: AntelopeSalad: runit_service just calls sv stop whatever
[2014-03-03 23:15:27 -0500] coderanger: That has to work first :)
[2014-03-03 23:15:34 -0500] coderanger: Or what holoway said
[2014-03-03 23:15:51 -0500] AntelopeSalad: sv stop does not work
[2014-03-03 23:16:11 -0500] holoway: AntelopeSalad: great! so that's where you start. step one, do you understand what runit does?
[2014-03-03 23:16:30 -0500] AntelopeSalad: about 5 hours ago after i read the manpages for sv i was doing things like sv stop puma, it does not stop it
[2014-03-03 23:16:59 -0500] jmickle: AntelopeSalad: why use runit?
[2014-03-03 23:17:01 -0500] jmickle: runit sucks
[2014-03-03 23:17:06 -0500] jmickle: sv is painful
[2014-03-03 23:17:07 -0500] AntelopeSalad: holoway: i think so, someone recommended that i use it to manage my app server because it'll take care of keeping it up if it crashes/etc.
[2014-03-03 23:17:20 -0500] AntelopeSalad: someone who i respect as a programmer mentioned using it
[2014-03-03 23:17:37 -0500] jmickle: what os you using?
[2014-03-03 23:17:38 -0500] jmickle: ubuntu?
[2014-03-03 23:17:39 -0500] AntelopeSalad: but i'll gladly switch for something else
[2014-03-03 23:17:41 -0500] AntelopeSalad: yes
[2014-03-03 23:17:42 -0500] coderanger: jmickle: runit works, it might be complex and arcane, but it is rock solid in a way almost nothing else is
[2014-03-03 23:17:49 -0500] jmickle: just use upstart
[2014-03-03 23:18:11 -0500] AntelopeSalad: going by hulu guide, i figured i had everything i needed setup
[2014-03-03 23:18:11 -0500] jmickle: coderanger: upstart has much less learning curver for people, just as stable and much more friendly
[2014-03-03 23:18:54 -0500] coderanger: jmickle: Indeed, and also a dead project so I don't encourage people to learn it
[2014-03-03 23:19:02 -0500] jmickle: upstart?
[2014-03-03 23:19:05 -0500] coderanger: jmickle: Yes
[2014-03-03 23:19:50 -0500] jmickle: upstart is still replacing init
[2014-03-03 23:19:58 -0500] jmickle: isn't it?
[2014-03-03 23:20:07 -0500] holoway: jmickle: not going forward - everyone converted to systemd
[2014-03-03 23:20:16 -0500] jmickle: ah systems thats true
[2014-03-03 23:20:19 -0500] jmickle: systemd*
[2014-03-03 23:20:32 -0500] jmickle: well all ubuntu LTS still running upstart
[2014-03-03 23:20:34 -0500] jmickle: so
[2014-03-03 23:21:52 -0500] coderanger: jmickle: For a time, but that only makes the fracturing worse :-(
[2014-03-03 23:21:58 -0500] jmickle: hehehe
[2014-03-03 23:22:15 -0500] coderanger: Service management is Hard, see also what I was talking to whack about earlier re: pleaserun and poise-service
[2014-03-03 23:22:19 -0500] jmickle: future problem yo
[2014-03-03 23:22:48 -0500] jmickle: don't reinvent the wheel today when you will need to reinvent the drive shaft later :-P
[2014-03-03 23:23:51 -0500] jmickle: any easy way to export knife ec2 server list into a csv?
[2014-03-03 23:24:26 -0500] coderanger: jmickle: Grab fog or boto?
[2014-03-03 23:24:30 -0500] jmickle: ha
[2014-03-03 23:24:33 -0500] jmickle: i guess
[2014-03-03 23:24:37 -0500] jmickle: wanted to be lazy
[2014-03-03 23:24:54 -0500] coderanger: jmickle: knife ec2 server list | tr '\n' ','
[2014-03-03 23:24:57 -0500] coderanger: maybe
[2014-03-03 23:25:14 -0500] kshep: knife ec2 server list > /dev/null | gem install fog
[2014-03-03 23:25:29 -0500] jmickle: ha
[2014-03-03 23:25:41 -0500] jmickle: alright boto it is
[2014-03-03 23:27:02 -0500] AntelopeSalad: coderanger: i don't think it's too hard
[2014-03-03 23:27:08 -0500] AntelopeSalad: it just seems impossibly hard with chef
[2014-03-03 23:27:57 -0500] AntelopeSalad: when i was using cap i was able to deploy an upstart managed rails app after reading 1 blog post and spending about 30min with it
[2014-03-03 23:28:07 -0500] coderanger: AntelopeSalad: Its an impedance gap, restarting services to pick up changes is a non-convergent action, chef has limited support for delta triggering via notifications but at heart the models don't match
[2014-03-03 23:28:10 -0500] AntelopeSalad: but nothing like that exists with chef
[2014-03-03 23:28:35 -0500] coderanger: AntelopeSalad: You could have used the app_ruby cookbook as is, you wanted to use puma instead of gunicorn
[2014-03-03 23:28:51 -0500] coderanger: Don't try to claim the guides didn't exist, you just didn't like 'em
[2014-03-03 23:28:59 -0500] AntelopeSalad: no, i didn't "want" to use puma, i've been using puma for like 6 months before i even knew what chef was
[2014-03-03 23:29:07 -0500] coderanger: Okay, so replace it :)
[2014-03-03 23:29:08 -0500] AntelopeSalad: i'm not going to let chef dictate my rails app
[2014-03-03 23:29:13 -0500] AntelopeSalad: that's ridiculous
[2014-03-03 23:29:31 -0500] coderanger: AntelopeSalad: You are saying it can't be both immensely flexible and supremely easy
[2014-03-03 23:29:42 -0500] AntelopeSalad: that's like saying i should replace rails with java or something because it's easier to deploy a war file with chef than rails right?
[2014-03-03 23:29:54 -0500] AntelopeSalad: totally unreasonable haha
[2014-03-03 23:29:57 -0500] coderanger: AntelopeSalad: No, puma vs gunicorn is a drop in replacement
[2014-03-03 23:30:04 -0500] coderanger: er unicorn, right this is ruby land
[2014-03-03 23:30:10 -0500] coderanger: Rack servers are modular
[2014-03-03 23:30:13 -0500] AntelopeSalad: i'm not looking to use gunicorn tho, i'm using puma
[2014-03-03 23:30:38 -0500] coderanger: Okay, so thats not something the guides or community cookbooks cover
[2014-03-03 23:30:42 -0500] coderanger: Which is why this is so hard
[2014-03-03 23:30:55 -0500] AntelopeSalad: right, but i have it all setup with the deploy resource except managing puma with runit
[2014-03-03 23:30:55 -0500] coderanger: You're cutting new trail
[2014-03-03 23:31:31 -0500] AntelopeSalad: but this last step seems impossible because i can't even get any context of the errors from chef or runit
[2014-03-03 23:32:03 -0500] AntelopeSalad: i've never seen anything like this before -- i run the service, it starts, but then the service logs nothing and doesn't serve the app but also doesn't throw an error or exit
[2014-03-03 23:32:07 -0500] AntelopeSalad: how do you debug that lol?
[2014-03-03 23:32:22 -0500] coderanger: AntelopeSalad: If you were not using the deploy resource you would have a much better time of it since you could get the normal debugging output :)
[2014-03-03 23:32:35 -0500] AntelopeSalad: then i do a chef run with the same code i used manually and it throws 1 line errors with "exit code 1"
[2014-03-03 23:33:31 -0500] AntelopeSalad: i shouldn't have to reinvent the entire deploy resource
[2014-03-03 23:33:37 -0500] dealako: Is there a separate chef dev channel?
[2014-03-03 23:33:42 -0500] coderanger: AntelopeSalad: Sorry, you do, I told you as much when you started
[2014-03-03 23:33:50 -0500] coderanger: dealako: There is #chef-hacking but it is pretty quiet
[2014-03-03 23:33:56 -0500] coderanger: dealako: Most people just ask questions in here :)
[2014-03-03 23:33:57 -0500] AntelopeSalad: that sounds like i need to stop using chef and find a tool that's capable of deploying without me inventing the wheel
[2014-03-03 23:34:09 -0500] dealako: ok, tks: Need two separate versions of sw package installed. Want to leverage my cookbook, just change attributes to reflect version that I want installed. How to install two versions of sw? (e.g. run cookbook twice with two diff sets of attributes on same VM).
[2014-03-03 23:34:15 -0500] coderanger: AntelopeSalad: Someone has to do the work, if not you, then someone else
[2014-03-03 23:34:24 -0500] coderanger: AntelopeSalad: This is how FOSS evolves :)
[2014-03-03 23:34:30 -0500] AntelopeSalad: yeah i'm ok with doing the work, i'm not ok with everything being impossible to debug
[2014-03-03 23:34:38 -0500] AntelopeSalad: and this is the fault of chef
[2014-03-03 23:34:52 -0500] coderanger: AntelopeSalad: Chef is fine, the deploy resource sucks, I don't know how many more ways I can tell you to not use it
[2014-03-03 23:35:08 -0500] AntelopeSalad: you've seen some other errors i've had in the past too, you're an expert in this field and even you were like "wow that's crazy"
[2014-03-03 23:35:35 -0500] coderanger: dealako: You cannot, make a resource (either an LWRP or class-based resource) with the body of the config and make the version be a resource attr
[2014-03-03 23:36:17 -0500] dealako: understood, thanks
[2014-03-03 23:36:41 -0500] coderanger: dealako: recipes are effectively singletons, you can't (normally) run them more than once :)
[2014-03-03 23:36:43 -0500] AntelopeSalad: at this stage it could easily be the cookbook writing the runit script out incorrectly
[2014-03-03 23:36:51 -0500] AntelopeSalad: because someone else reported a ticket with the same issue
[2014-03-03 23:37:07 -0500] coderanger: dealako: The easy solution is just paste the whole recipe chunk into an LWRP except that one version value
[2014-03-03 23:37:10 -0500] dealako: yeah, thought so.
[2014-03-03 23:38:12 -0500] AntelopeSalad: coderanger: also if i don't use the deploy resource, can you point me a guide to deploying a rails app without using the deploy resource?
[2014-03-03 23:38:17 -0500] AntelopeSalad: *me to
[2014-03-03 23:38:27 -0500] coderanger: AntelopeSalad: Never looked for one, sorry
[2014-03-03 23:38:44 -0500] AntelopeSalad: yeah it doesn't exist
[2014-03-03 23:38:59 -0500] dealako: good idea...
[2014-03-03 23:39:01 -0500] AntelopeSalad: so that forces me to use an alternative to chef
[2014-03-03 23:39:09 -0500] kshep: uh...
[2014-03-03 23:39:11 -0500] coderanger: AntelopeSalad: Short version should be a git resource pointed at your repo, a few templates for the config files, and a service resource that subscribes to the lot of them
[2014-03-03 23:39:11 -0500] kshep: capistrano
[2014-03-03 23:39:14 -0500] kshep: use what you were using
[2014-03-03 23:39:17 -0500] kshep: what was working
[2014-03-03 23:39:20 -0500] AntelopeSalad: because i already put in probably 200-300 hours of learning chef since last october
[2014-03-03 23:39:29 -0500] kshep: I think similarly you'll find that you wouldn't want to use Puppet to deploy apps
[2014-03-03 23:39:45 -0500] AntelopeSalad: kshep: coderanger and others told me to use chef to deploy my app tho
[2014-03-03 23:39:48 -0500] AntelopeSalad: months and months ago
[2014-03-03 23:39:59 -0500] coderanger: AntelopeSalad: Indeed, I use chef to deploy all my apps
[2014-03-03 23:41:12 -0500] AntelopeSalad: yet there isn't a single solution available to deploy a rails app with flawless handling of services
[2014-03-03 23:42:12 -0500] coderanger: AntelopeSalad: I just described a solution to you
[2014-03-03 23:42:29 -0500] AntelopeSalad: even if i let chef dictate my rails server of choice and switched from puma
[2014-03-03 23:42:36 -0500] coderanger: AntelopeSalad: Huh?
[2014-03-03 23:42:38 -0500] AntelopeSalad: i would also need to switch my web server (it uses apache right?)
[2014-03-03 23:42:42 -0500] coderanger: AntelopeSalad: No ...
[2014-03-03 23:42:49 -0500] coderanger: Please re-read what I wrote
[2014-03-03 23:42:54 -0500] AntelopeSalad: and then how would it handle sidekiq? because it doesn't seem to have any support for background workers
[2014-03-03 23:43:11 -0500] AntelopeSalad: i would be stick in the same position of having to manually manage a process with runit, now it would be sidekiq instead of my rails app
[2014-03-03 23:43:41 -0500] coderanger: AntelopeSalad: Then don't use runit, upstart, monit, bluepill, and god are all quite popular in the Ruby community
[2014-03-03 23:43:45 -0500] AntelopeSalad: i've also shipped 0 non-toy apps without a background worker, it's 100% necessary
[2014-03-03 23:43:55 -0500] coderanger: AntelopeSalad: I have no idea what you are talking about anymore
[2014-03-03 23:44:18 -0500] AntelopeSalad: have you heard of resque maybe instead, they do similar things
[2014-03-03 23:44:36 -0500] kshep: "deploying a rails app" wouldn't normally include sidekiq/resque
[2014-03-03 23:44:42 -0500] coderanger: I am aware you are frustrated that this isn't as easy as it could be, and I feel your pain, I'm literally working as hard as I can (despite having no reason to do so) to improve this stuff
[2014-03-03 23:44:44 -0500] AntelopeSalad: why not?
[2014-03-03 23:44:46 -0500] coderanger: However I can only move so fast
[2014-03-03 23:45:02 -0500] AntelopeSalad: contacting a third party api or sending an email inside of a rails process is kind of silly
[2014-03-03 23:45:07 -0500] coderanger: If you would like to help, I welcome your assistance
[2014-03-03 23:45:40 -0500] coderanger: If you would like to simply point out that it is difficult, I can only offer you a nod and helping hand up the ladder
[2014-03-03 23:45:49 -0500] AntelopeSalad: coderanger: what do you need assistance on?
[2014-03-03 23:46:02 -0500] coderanger: AntelopeSalad: Rewrite the core of the application cookbook to use Poise?
[2014-03-03 23:46:07 -0500] coderanger: That would be a good start at least
[2014-03-03 23:46:08 -0500] AntelopeSalad: do you want me to gist my entire app cookbook?
[2014-03-03 23:46:33 -0500] coderanger: AntelopeSalad: No, you would need to go rewrite all this deployment logic from (more or less) scratch :)
[2014-03-03 23:46:49 -0500] AntelopeSalad: there is no deployment logic tho
[2014-03-03 23:46:50 -0500] coderanger: Its no small order, which is part of why I haven't gotten there yet
[2014-03-03 23:46:52 -0500] AntelopeSalad: it's like 50 lines of code
[2014-03-03 23:47:11 -0500] AntelopeSalad: maybe less
[2014-03-03 23:47:12 -0500] coderanger: AntelopeSalad: Have you read the deploy resource and/or app cookbooks? They contain quite a bit of logic
[2014-03-03 23:47:24 -0500] coderanger: Making this stuff Easy is not, itself, an easy task
[2014-03-03 23:47:26 -0500] AntelopeSalad: oh, i meant less than 50 using the deploy resource
[2014-03-03 23:47:49 -0500] coderanger: Indeed, part of the rewrite will involve copying some stuff out of the deploy resource (and discarding others bits)
[2014-03-03 23:47:51 -0500] AntelopeSalad: i don't get why you would drop the deploy resource just to roll your own, aren't you going to end up creating the same features from scratch?
[2014-03-03 23:48:03 -0500] coderanger: AntelopeSalad: Because I can do it better by several orders of magnitude
[2014-03-03 23:48:11 -0500] AntelopeSalad: you can, but i can't
[2014-03-03 23:48:32 -0500] coderanger: Okay, then as I said, I pointed you in the direction of how to solve your problem and I wish you luck
[2014-03-03 23:48:37 -0500] AntelopeSalad: if i could, i would have solved the problem for myself 4 months ago
[2014-03-03 23:48:47 -0500] coderanger: but don't sit and complain that no one has led the way when you now see how hard it is to do so
[2014-03-03 23:49:10 -0500] AntelopeSalad: yeah but my problem isn't with taking code from a remote git server and placing it onto my server
[2014-03-03 23:49:33 -0500] AntelopeSalad: that is a done deal with the deploy resource in maybe 30-40 lines of code including all of the hooks for doing migrations/precompiling, etc.
[2014-03-03 23:49:53 -0500] coderanger: AntelopeSalad: I've now explained what to do to you several times, please just go do it
[2014-03-03 23:50:11 -0500] AntelopeSalad: you've told me to replace runit with upstart
[2014-03-03 23:50:13 -0500] AntelopeSalad: or something else
[2014-03-03 23:50:18 -0500] coderanger: No, I told you to stop using the deploy resource
[2014-03-03 23:50:28 -0500] coderanger: replace it with a git resource and some notifications
[2014-03-03 23:50:46 -0500] coderanger: as that is a far more traditional convergence-oriented setup
[2014-03-03 23:50:47 -0500] AntelopeSalad: how is that going to help me solve my process management problem tho?
[2014-03-03 23:50:59 -0500] coderanger: It will make debugging said issues much easier
[2014-03-03 23:51:33 -0500] AntelopeSalad: why is the deploy resource implemented so poorly then?
[2014-03-03 23:51:45 -0500] AntelopeSalad: was it just tacked on at the end without much thought?
[2014-03-03 23:52:03 -0500] coderanger: Because the structure was copied from Capistrano without regard for model impedance mismatch
[2014-03-03 23:52:16 -0500] coderanger: or, if you will, "it seemed like a good idea at the time"
[2014-03-03 23:52:24 -0500] AntelopeSalad: i can't even visualize another way to do it
[2014-03-03 23:52:41 -0500] coderanger: as cap was more dominant when chef was first written and so a compat shim seemed like a good idea
[2014-03-03 23:52:49 -0500] AntelopeSalad: all of the release->current links, only restarting if it's successful, etc.
[2014-03-03 23:52:54 -0500] AntelopeSalad: it's probably like thousands of lines of code
[2014-03-03 23:53:19 -0500] AntelopeSalad: but you're proposing to take those thousands of lines of code and basically reimplement them yourself
[2014-03-03 23:53:35 -0500] coderanger: No, I'm saying don't use the cap structure with all the symlinks and whatnot
[2014-03-03 23:53:42 -0500] coderanger: Just have a single git resource, thats it
[2014-03-03 23:53:53 -0500] AntelopeSalad: but then you end up with a disgusting amount of file duplication and added time to each deploy?
[2014-03-03 23:54:04 -0500] coderanger: No, its actually much faster
[2014-03-03 23:54:07 -0500] AntelopeSalad: if you have to bundle install every deploy that's such a huge time sink
[2014-03-03 23:54:11 -0500] coderanger: Huh?
[2014-03-03 23:54:22 -0500] AntelopeSalad: if you bundle install and need to pull down every gem from rubygems
[2014-03-03 23:54:22 -0500] coderanger: The deploy resource already keeps a git clone internally
[2014-03-03 23:54:24 -0500] AntelopeSalad: that might take 5 minutes
[2014-03-03 23:54:27 -0500] coderanger: and actually does a full copy every time
[2014-03-03 23:54:39 -0500] coderanger: Again, I have literally no idea what you are talking about
[2014-03-03 23:54:50 -0500] AntelopeSalad: sure but i used a symlink and bundled to vendor/bundle
[2014-03-03 23:54:55 -0500] coderanger: You have asked how to do this in a way that will be easier to debug and more robust and I've answered
[2014-03-03 23:55:03 -0500] AntelopeSalad: and then future deploys just go from there instead
[2014-03-03 23:55:12 -0500] AntelopeSalad: unless they need to be updated because the gemfile changed
[2014-03-03 23:55:38 -0500] AntelopeSalad: same goes for symlinking the log/tmp/assets directories
[2014-03-03 23:55:52 -0500] coderanger: AntelopeSalad: Again, no idea how this is relevant, the folder isn't changing so symlinks aren't needed
[2014-03-03 23:57:09 -0500] AntelopeSalad: are the symlinks only needed with deploy because it takes that cached-copy and copies it to /releases?
[2014-03-03 23:57:27 -0500] coderanger: Indeed
[2014-03-03 23:57:38 -0500] coderanger: mo copies, mo problems
[2014-03-03 23:57:46 -0500] AntelopeSalad: and you're saying with the git resource on its own, it would just be the cached-copy forever
[2014-03-03 23:58:00 -0500] coderanger: As I said before, that kind of copy-based structure isn't easy to make convergent
[2014-03-03 23:58:30 -0500] AntelopeSalad: if it were so easy to replace deploy, why didn't anyone do it yet?
[2014-03-03 23:58:43 -0500] AntelopeSalad: i mean, you're kind of hinting that all you need to do is like 3 things after you pull in the git repo
[2014-03-03 23:59:30 -0500] AntelopeSalad: bundle install, create your db / migrate (both are idempotent by rails), precompile assets
[2014-03-03 23:59:34 -0500] coderanger: AntelopeSalad: Because replacing it in one use case is easy
[2014-03-03 23:59:45 -0500] coderanger: replacing it with a full-featured and flexible deployment system is not
[2014-03-03 23:59:54 -0500] AntelopeSalad: am i on track with those steps, after pulling in the git repo those are the only 3 things you need to do
