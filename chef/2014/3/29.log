[2014-03-29 00:35:09 -0400] coderanger: kallistec: Yeah, I just reimplemented the resource-name-as-basename thing since its one line of code :)
[2014-03-29 01:11:17 -0400] jtran: i have a strange problem.    knife node show mynode -a foo.bar returns with value 'good_value', as expected.  however in my cookbook i do:  mynodes =  search(:node, 'recipe:mycookbook\:\:myrecipe')  ;  mynodes.each {|a| Chef::Log.info "My node #{a['fqdn']}  - #{a['foo']['bar']}"  }  and when ilook at that output when it iterates to node named 'mynode' it shows me a diff value.   It shows the value = the default attr of the cookbook
[2014-03-29 01:11:17 -0400] jtran: 'bad_value' insetad of the 'good_value' i wnat
[2014-03-29 03:31:25 -0400] Freeheart: Dumb question, but one I am seriously wondering. In the Puppet world (which I use professionally), the process of taking a task and implimenting it with Puppet is "Puppetizing". "Cheffing" and "Chefizing" sound stupid to me, is there some similar word when you do that process with Chef? :)
[2014-03-29 03:49:20 -0400] coderanger: Freeheart: "writing cookbooks"
[2014-03-29 03:54:49 -0400] Freeheart: Okay, I'll allow that.
[2014-03-29 03:55:00 -0400] Freeheart: I used "impliment as a cookbook".
[2014-03-29 03:55:04 -0400] Freeheart: Makes sense.
[2014-03-29 04:34:36 -0400] someara: I personally like 'Cheffing the fuck out of it'. ymmv.
[2014-03-29 04:34:55 -0400] Freeheart: #devopsasfuck is on my business card. :)
[2014-03-29 04:35:28 -0400] someara: respek knuckles
[2014-03-29 04:36:21 -0400] coderanger: someara: devops smackdown
[2014-03-29 04:37:18 -0400] Freeheart: I love flamewars at work. They're great. We're largely a Python shop...
[2014-03-29 04:37:33 -0400] someara: freebird
[2014-03-29 04:37:39 -0400] Freeheart: And then my boss jumps in, spreading the Ruby FUD.
[2014-03-29 04:37:53 -0400] Freeheart: "ORLY? So... we can move to Ansible now? It's Python!"
[2014-03-29 04:37:59 -0400] Freeheart: And I win. It's that simple. :)
[2014-03-29 04:38:35 -0400] someara: python is a wonderful language and you should feel good for loving it
[2014-03-29 04:38:52 -0400] Freeheart: I do love Python.
[2014-03-29 04:39:11 -0400] Freeheart: It's a great language, and was probably the first to get me into actually making sense of code.
[2014-03-29 04:39:26 -0400] Freeheart: I do not like the Pythonistas though. They are so unlike their Python.
[2014-03-29 04:39:47 -0400] someara: bring your affinity for well written code over here to the rubylands
[2014-03-29 04:40:04 -0400] someara: we need opinionated peoples
[2014-03-29 04:40:08 -0400] coderanger: someara: chef_gem 'activesupport'
[2014-03-29 04:40:10 -0400] coderanger: what now
[2014-03-29 04:40:18 -0400] Freeheart: I'm not only opinionated, I'm iconoclastic. :)
[2014-03-29 04:40:48 -0400] Freeheart: A friend of mine is a huge Ruby fan, and we worked at another Python shop that flat out blacklisted Ruby... except for Chef.
[2014-03-29 04:41:27 -0400] Freeheart: Ruby is the first language that made sense AND inspired me. Chef and Puppet helped in getting me used to the waters. :)
[2014-03-29 04:42:01 -0400] Freeheart: I've probably written more Ruby code in the past month than all code COMBINED in the past few years.
[2014-03-29 04:42:18 -0400] someara: it.... it actually not that bad once you figure out how to wield the toolchain
[2014-03-29 04:42:21 -0400] coderanger: Both have a lot going for them, real namespacing, anon blocks, wheels, bundler, its all cyclic
[2014-03-29 04:43:20 -0400] coderanger: Freeheart: runit restarts it immediately
[2014-03-29 04:43:24 -0400] coderanger: so rarely a big deal
[2014-03-29 04:44:14 -0400] Freeheart: 33 seconds of downtime. That's not an SLA violation around these parts? :P
[2014-03-29 04:44:44 -0400] Freeheart: Ignore me. I had a great week, and I'm enjoying moscato.
[2014-03-29 04:44:53 -0400] coderanger: Freeheart: You don't want to know how bad that code is
[2014-03-29 04:44:55 -0400] Freeheart: Well no... Don't ignore me. Just... don't take me too seriously.
[2014-03-29 04:45:17 -0400] Freeheart: Which code?
[2014-03-29 04:45:21 -0400] coderanger: The logger bot
[2014-03-29 04:45:48 -0400] Freeheart: What's it based on? I delved into Supybot and it's forks recently... Had very much the same reaction.
[2014-03-29 04:46:05 -0400] Freeheart: "Nah, fuck that. My time is better spent elsewhere."
[2014-03-29 04:46:32 -0400] someara: coderanger i need your opinion: https://github.com/someara/crossplat
[2014-03-29 04:46:40 -0400] coderanger: Freeheart: Net::IRC and a lot of hackery from contractors
[2014-03-29 04:47:29 -0400] Freeheart: I do not understand this CPAN thing... What is this chaos?
[2014-03-29 04:47:33 -0400] coderanger: someara: What am I looking at?
[2014-03-29 04:47:46 -0400] coderanger: Freeheart: Its Ruby, they both use Net:: as a namespace
[2014-03-29 04:48:04 -0400] Freeheart: Phew...
[2014-03-29 04:49:22 -0400] someara: I'm tableflipping mysql and this is the skeleton for crossplatform that I came up with
[2014-03-29 04:49:44 -0400] coderanger: someara: Looks vaguely similar to what I do
[2014-03-29 04:49:45 -0400] coderanger: sec
[2014-03-29 04:50:12 -0400] coderanger: someara: ex. https://github.com/balanced-cookbooks/rundeck/blob/poise/libraries/rundeck.rb#L61-L71
[2014-03-29 04:50:33 -0400] someara: https://github.com/someara/mysql/tree/tableflip
[2014-03-29 04:51:30 -0400] coderanger: someara: I just try to keep stuff all in one file when possible
[2014-03-29 04:51:43 -0400] coderanger: someara: Depends on the size of the platform drift though
[2014-03-29 04:52:15 -0400] coderanger: someara: Also you should really play with poise (once I write docs for it :)
[2014-03-29 04:52:32 -0400] someara: docs first =)
[2014-03-29 04:52:47 -0400] coderanger: I'm getting there, pycon talks before that
[2014-03-29 04:53:06 -0400] someara: do it
[2014-03-29 04:53:40 -0400] Freeheart: In Montreal?
[2014-03-29 04:53:55 -0400] coderanger: Freeheart: thats the one
[2014-03-29 04:54:03 -0400] Freeheart: When are you speaking?
[2014-03-29 04:54:22 -0400] Freeheart: Another speaker there made me want to punch babies...
[2014-03-29 04:54:38 -0400] Freeheart: Or more specifically, since I don't travel...
[2014-03-29 04:54:39 -0400] coderanger: Freeheart: I've not checked the schedule lately, I think one talk is on Saturday and the other Sunday
[2014-03-29 04:54:41 -0400] Freeheart: in time.
[2014-03-29 04:55:02 -0400] Freeheart: Another speaker who WILL be there did his speech for me the other day. That made me want to punch babies.
[2014-03-29 08:13:47 -0400] PapaSierra: i'm using chef solo. what's are my options for getting my ssl certs on the server?
[2014-03-29 08:15:26 -0400] n1ko: we use encrypted data bags to protect the certs
[2014-03-29 08:16:20 -0400] n1ko: but your options are the same as with any other textfile you want to have on the server
[2014-03-29 08:18:10 -0400] PapaSierra: i'm just not seeing it yet. for lack of a better option my approach would be to provision the server using chef and then use capistrano to upload the certs to the right place. that's just lousy (for one, only my laptop can do the provisioning because no one else has the certs)
[2014-03-29 08:57:25 -0400] PapaSierra: n1ko: so i'm reading up on encrypted data bags. i can see how they would be applicable in a chef server situation, but what about chef solo? where does the encrypted data bag actually stay?
[2014-03-29 08:58:56 -0400] n1ko: in your vcs, just like with chef server
[2014-03-29 08:59:26 -0400] n1ko: the only difference is that you push them straight to the node(s) rather than the node(s) getting them from the server
[2014-03-29 08:59:40 -0400] n1ko: so think server as a middle guy that just gets left out, nothing else really
[2014-03-29 09:14:26 -0400] PapaSierra: n1ko: great, that makes sense. i'm making progress with learning, but his a wall here. http://www.hastebin.com/raw/vosipikavo
[2014-03-29 09:22:41 -0400] PapaSierra: i'm not sure exactly what it's complaining about (os?) my ohai is Ohai: 7.0.0.rc.0
[2014-03-29 09:51:15 -0400] PapaSierra: hmm, not able to get knife working. thanks anyway
[2014-03-29 12:52:01 -0400] pureluck_: hey people
[2014-03-29 12:53:12 -0400] pureluck_: what's the preferred way to deal with pem files and other key/sensitive data files in chef? slap them into a databag and populate a template with them later?
[2014-03-29 12:57:46 -0400] alexbst: pureluck - encrypted databags, cookbook to handle the decryption onto the filesystem.
[2014-03-29 12:58:22 -0400] alexbst: maybe look at a ram-based filesystem for local storage so it never sits on a physical disk
[2014-03-29 13:02:25 -0400] pureluck: alexbst: great. thanks for the help and the extra tip
[2014-03-29 13:51:44 -0400] PapaSierra: i'm trying to create a data bag, using knife for the first time, getting ERROR: Your private key could not be loaded from /etc/chef/client.pem
[2014-03-29 14:02:18 -0400] PapaSierra: i'm pretty confused about this. i'm using chef-solo. there is no chef-server. so right away my assumption is that i won't be using knife. however, in order to create an encrypted data bag i need knife, and to have knife running i need a client.pem, and to get that i need to download validation.pem from my chef-server, which i don't have. i'm stuck in a sort of circular reasoning problem here.
[2014-03-29 14:05:36 -0400] Nukepuppy: papasierra im only one a few minutes..
[2014-03-29 14:05:46 -0400] Nukepuppy: but checkout knife-solo and other similar implementations
[2014-03-29 14:05:51 -0400] Nukepuppy: it should point you in right directions
[2014-03-29 14:06:34 -0400] Nukepuppy: https://github.com/thbishop/knife-solo_data_bag
[2014-03-29 14:06:35 -0400] PapaSierra: oh yeah? i've installed knife-solo already, perhaps i just keep hitting the docs for knife, let me try find the knifes-solo docs. thanks
[2014-03-29 14:06:36 -0400] Nukepuppy: specifically
[2014-03-29 14:07:20 -0400] Nukepuppy: should do exactly what you want
[2014-03-29 14:07:30 -0400] Nukepuppy: take it easy :) glad you're making progress
[2014-03-29 14:14:09 -0400] PapaSierra: so i installed it but right from the first run i get ERROR: Chef::Exceptions::InvalidDataBagPath: Configured data bag path './data_bags' is invalid
[2014-03-29 14:15:42 -0400] PapaSierra: ah, gotta create the dir manually first
[2014-03-29 14:38:16 -0400] slopjong: the oh-my-zsh recipe i've got here leads to a "Chef::Exceptions::PrivateKeyMissing: I cannot read /etc/chef/client.pem"
[2014-03-29 14:38:46 -0400] slopjong: the recipe fails here: Chef::Exceptions::PrivateKeyMissing: I cannot read /etc/chef/client.pem
[2014-03-29 14:39:15 -0400] slopjong: wrong paste, i mean this: search( :users, "shell:*zsh AND NOT action:remove" ).each do |u|
[2014-03-29 14:40:21 -0400] slopjong: what does this search exactly do, i'm not yet very familiar with the recipes etc.
[2014-03-29 15:31:00 -0400] segv: jkeiser how would I pass "hint" or hints within the fog provisioner
[2014-03-29 16:23:32 -0400] jkeiser: segv: where do you pass "hint" when you normally use fog?
[2014-03-29 16:23:46 -0400] segv: never would normally, that's a knife command
[2014-03-29 16:23:54 -0400] segv: Just trying to figure out where to pass it
[2014-03-29 16:24:02 -0400] jkeiser: segv: mostly the provisioners are passthroughs, you can pass anything fog accepts
[2014-03-29 16:24:33 -0400] jkeiser: segv: I'm not sure what it is :/  Probably bootstrap options, but it will have to be something fog understands
[2014-03-29 16:29:55 -0400] PapaSierra: is there a guide on how to take certificate key/crt strings out of an encrypted data bag and put them into files on the server?
[2014-03-29 16:40:42 -0400] segv: jkeiser, yeah, it's a Hint placing the "hint" file ec2.json in place on the host
[2014-03-29 16:40:55 -0400] segv: jkeiser, I can solve it with a remote "directory" create, how would I achieve that?
[2014-03-29 16:47:58 -0400] jkeiser: segv: I think machine_file might create the directory if it doesn't already exist
[2014-03-29 16:48:05 -0400] segv: it failed :(
[2014-03-29 16:48:07 -0400] segv: it uses mv -i
[2014-03-29 16:48:11 -0400] segv: So if the dir isn't there it fails
[2014-03-29 16:48:42 -0400] segv: sorry
[2014-03-29 16:48:45 -0400] segv: just mv, INFO: Completed mv /tmp/ec2.json.2859797367 /etc/chef/ohai/hints/ec2.json on ec2-user@10.227.14.126: exit status 1
[2014-03-29 16:49:06 -0400] jkeiser: segv: ok. machine_directory and machine_execute don't exist, but they would be easy to create
[2014-03-29 16:49:22 -0400] segv: yeah, I will work on machine_directory really fast and whip up a patch if you don't mind?
[2014-03-29 16:49:43 -0400] segv: I have to wait for my CLA approval but shouldn't be a big deal
[2014-03-29 16:49:56 -0400] jkeiser: segv: sure! Though I wonder if fog already handles this ... do you know how knife does the hint?
[2014-03-29 16:53:22 -0400] segv: yeah
[2014-03-29 16:53:29 -0400] segv: jkeiser, part of the bootstrap template
[2014-03-29 16:53:37 -0400] segv: there is a 'hint' hash that is handed over
[2014-03-29 16:54:09 -0400] segv: so knife[:hints]['ec2'] = {}
[2014-03-29 16:54:14 -0400] segv: would create the hints for knife to bootstrap it
[2014-03-29 16:54:58 -0400] werdnativ: Is there a way to make test-kitchen run with a login shell?
[2014-03-29 16:55:49 -0400] werdnativ: http://kitchen.ci/docs/getting-started/writing-test works with git, but not for ruby (installed in /opt/rbenv/ and it's available when I kitchen login)
[2014-03-29 16:57:08 -0400] werdnativ: "which ruby" with kitchen login = /opt/rbenv/shims/ruby but with kitchen verify it fails.
[2014-03-29 17:02:51 -0400] adnichols: werdnativ: not sure how you are running tests but typically wrapping commands in 'bash -l -c "command"' will allow them to use rbenv
[2014-03-29 17:04:22 -0400] werdnativ: adnichols: using serverspec right now. makes sense.
[2014-03-29 17:04:50 -0400] adnichols: werdnativ: we use serverspec as well, think that's typically what we have to do
[2014-03-29 17:05:40 -0400] werdnativ: I guess there's probably a reason it doesn't use a login shell globally...
[2014-03-29 17:06:10 -0400] werdnativ: probably so you can test non-login environment too.
[2014-03-29 17:06:11 -0400] adnichols: login shells pull in a lot of stuff, safer to assume you have a clean environment
[2014-03-29 17:15:02 -0400] jkeiser: segv: hmm.  so the bootstrap process creates the template?  Gotcha
[2014-03-29 17:15:15 -0400] segv: jkeiser, yeah, it's part of the chef-full.erb bootstrap template
[2014-03-29 17:15:32 -0400] segv: jkeiser, https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb#L51-L60
[2014-03-29 17:15:38 -0400] PapaSierra: (sorry i just posted this in vagrant, but might be good here too) how do i bootstrap a box before provisioning runs? i.e. i'm using https://github.com/atomic-penguin/cookbook-certificate and i have to upload my data_bag_secret file onto the server before chef provisions it
[2014-03-29 17:16:02 -0400] jkeiser: segv: anything that is part of the main bootstrap template, I'm totally on board with adding to metal as attributes
[2014-03-29 17:16:22 -0400] segv: jkeiser, cool, not sure where you would put that at, but directions and I'll code it haha
[2014-03-29 17:16:50 -0400] segv: I haven't fully familiarzed myself with the code base
[2014-03-29 17:17:20 -0400] jkeiser: segv: like if you want to add "hints" and "hint" attributes to the machine resource, that's probably the best place to put it
[2014-03-29 17:17:59 -0400] segv: will do
[2014-03-29 17:18:19 -0400] jkeiser: segv: then the convergence_strategy (InstallCached is the one we're using now mainly) would be the one to respond to that information, since it's the one that actually sets up chef
[2014-03-29 17:18:33 -0400] segv: yeah, found that out from the ec2 fixes I wrote up
[2014-03-29 17:18:36 -0400] jkeiser: segv: maybe a better name is ohai_hints
[2014-03-29 17:18:46 -0400] jkeiser: hint is pretty vague
[2014-03-29 17:18:50 -0400] segv: yeah i would call it ohai_hints, so that it won't be confused with some other "hint" term
[2014-03-29 17:18:58 -0400] jkeiser: sweet :)
[2014-03-29 17:19:52 -0400] jkeiser: segv: one thing I'm trying to figure out that maybe you know ... is there a way to get the AWS account number/ID from the api?  Like, not the access key, the actual account.  I'm trying to figure out how two different IAMs can figure out that they are part of the same account
[2014-03-29 17:20:41 -0400] segv: hmmm i believe you can with the "master" account api key, as it will pull down all associative accounts, but that's just for consolidated reporting
[2014-03-29 17:20:44 -0400] alexbst: maybe you can poll some shared resource and see if they match.
[2014-03-29 17:20:53 -0400] alexbst: like a list of ec2 instances
[2014-03-29 17:21:00 -0400] jkeiser: segv: the reason being, I'd like to set the provisioner_url to something IAM-user-independent, so that if you run chef-metal as one IAM, and then run again as a different one, it will know that the machine you created is the same
[2014-03-29 17:21:01 -0400] segv: I'll look at the API as well and see if there is another way
[2014-03-29 17:21:28 -0400] jkeiser: i.e. it would allow for convergence even if each of your users has different keys
[2014-03-29 17:21:43 -0400] segv: ah yeah, i get where you're going with that, but I don't know off the top of my head
[2014-03-29 17:22:03 -0400] segv: alexbst's idea may work but that requires two hosts to gather the data
[2014-03-29 17:23:37 -0400] jkeiser: and a list of instances won't work, because different iams will have access to different instances, I think
[2014-03-29 17:24:10 -0400] segv: yessir
[2014-03-29 17:24:15 -0400] alexbst: it's a hacky suggestion ;)
[2014-03-29 17:32:52 -0400] jkeiser: alexbst, segv: I know there is a 12 digit "AWS account number" that shows up if you go to your Manage Account screen
[2014-03-29 17:33:14 -0400] jkeiser: alexbst, segv: and I *think* that is the thing we want
[2014-03-29 17:33:27 -0400] jkeiser: It's even part of some iam urls
[2014-03-29 17:33:46 -0400] jkeiser: But I can't for the life of me figure out how to get it
[2014-03-29 17:34:13 -0400] segv: yes
[2014-03-29 17:34:28 -0400] segv: that is exactly what you want, that doesn't identify the IAM profile, but it does identify the account itself
[2014-03-29 17:34:41 -0400] segv: That's what I use for consolidated billing to know if it's my test account vs. prod account
[2014-03-29 17:34:57 -0400] segv: you can get that back from s3 buckets as well
[2014-03-29 17:43:09 -0400] jkeiser: segv: I'm sort of hoping we can get it back somehow from ec2 or from a global service that can't be turned off--but s3 is *absolutely* better than nothing.  It's more important that we have the number than that it works universally
[2014-03-29 17:43:25 -0400] segv: I am pretty sure we can retrieve it from EC2
[2014-03-29 17:43:43 -0400] jkeiser: segv: (the reason I have that hope is that it is possible to turn off services for a given account, and if a user is (sillily) turning on ec2 but turned off s3, it would be awesome if metal still worked :)
[2014-03-29 17:45:23 -0400] segv: yeah
[2014-03-29 17:46:20 -0400] segv: jkeiser confirm product instance.
[2014-03-29 17:46:28 -0400] segv: will return the owner id
[2014-03-29 17:46:29 -0400] segv: :D
[2014-03-29 17:46:33 -0400] segv: http://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-ConfirmProductInstance.html
[2014-03-29 17:46:43 -0400] segv: since we already have the instance ID from fog
[2014-03-29 17:46:47 -0400] segv: we can query with that \m/
[2014-03-29 17:47:04 -0400] segv: there is a devpay requirement
[2014-03-29 17:47:09 -0400] segv: but I am not sure how that would work
[2014-03-29 17:47:29 -0400] segv: ah nm
[2014-03-29 17:50:58 -0400] jkeiser: segv: I forgot to mention, I found out you CAN get this info by doing Fog::AWS[:rds].security_groups.get('default').owner_id
[2014-03-29 17:50:59 -0400] segv: haha
[2014-03-29 17:51:07 -0400] segv: jkeiser nice!
[2014-03-29 17:51:10 -0400] segv: jkeiser also http://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-DescribeInstances.html
[2014-03-29 17:51:11 -0400] jkeiser: segv: but when I ran that as my IAM account, it failed
[2014-03-29 17:51:15 -0400] segv: describeinstances
[2014-03-29 17:51:48 -0400] segv: shows ownerID all over the place
[2014-03-29 17:51:52 -0400] segv: pretty sure you can use that
[2014-03-29 17:52:35 -0400] segv: only thing I don't like about ec2 API is that they change the name of results in almost all the queries
[2014-03-29 17:59:18 -0400] jkeiser: segv: will do :)  I wonder why in the world they return owner id when all instances queried should be the same one?
[2014-03-29 17:59:36 -0400] segv: yeah, not sure, i have never seen a VPC on a different ownerid for the same account
[2014-03-29 17:59:39 -0400] jkeiser: segv: I'm looking to see if there are any other APIs, just because I'd love to get the owner id even if there are no instances
[2014-03-29 17:59:45 -0400] segv: yeah
[2014-03-29 18:01:25 -0400] segv: looking at the IAM API right now
[2014-03-29 18:01:43 -0400] segv: ah hah!
[2014-03-29 18:01:46 -0400] segv: http://docs.aws.amazon.com/IAM/latest/APIReference/API_GetRole.html
[2014-03-29 18:01:50 -0400] segv: IAM will return it.
[2014-03-29 18:01:55 -0400] segv: <Arn>arn:aws:iam::123456789012:role/application_abc/component_xyz/S3Access</Arn>
[2014-03-29 18:02:02 -0400] segv: see the ID right there in the ARN?
[2014-03-29 18:02:11 -0400] jkeiser: segv: *something* must have this because every ARN has to have it in it
[2014-03-29 18:02:15 -0400] jkeiser: segv: ah :)
[2014-03-29 18:02:19 -0400] jkeiser: http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html
[2014-03-29 18:02:24 -0400] segv: yep yep!
[2014-03-29 18:02:26 -0400] jkeiser: I just wonder where everyone gets it in the first place!
[2014-03-29 18:02:30 -0400] segv: haha, me too
[2014-03-29 18:02:38 -0400] jkeiser: Maybe it happens on first login ....
[2014-03-29 18:02:41 -0400] segv: time to start digging through some code?
[2014-03-29 18:02:48 -0400] jkeiser: are there sessions?
[2014-03-29 18:02:50 -0400] segv: see how/if fog grabs it
[2014-03-29 18:02:50 -0400] segv: yes
[2014-03-29 18:02:56 -0400] jkeiser: hmm.  maybe open session
[2014-03-29 18:02:57 -0400] segv: I believe they are "STS"
[2014-03-29 18:03:01 -0400] jkeiser: that would be a pretty reasonable place to do it
[2014-03-29 18:03:11 -0400] segv: for the "Security Token Service"
[2014-03-29 18:03:28 -0400] segv: possible that one of those endpoints returns the arn?
[2014-03-29 18:04:40 -0400] segv: oh
[2014-03-29 18:04:40 -0400] segv: haha
[2014-03-29 18:04:50 -0400] segv: the "get meta data" from an instance returns it
[2014-03-29 18:05:36 -0400] segv: but it's slow as balls
[2014-03-29 18:05:40 -0400] segv: pardon my french
[2014-03-29 18:06:08 -0400] jkeiser: And you still have to have a darn instance!  Grr
[2014-03-29 18:06:15 -0400] segv: yeah
[2014-03-29 18:07:19 -0400] jkeiser: Maybe this is a careful design to allow users to cross account boundaries
[2014-03-29 18:07:26 -0400] jkeiser: even if it isn't implemented right now
[2014-03-29 18:09:05 -0400] segv: http://docs.aws.amazon.com/IAM/latest/APIReference/API_GetUser.html
[2014-03-29 18:09:07 -0400] segv: what about that?
[2014-03-29 18:09:58 -0400] segv: we need a user
[2014-03-29 18:10:06 -0400] jkeiser: segv: yeah, even ListUsers will do it
[2014-03-29 18:10:09 -0400] segv: ah
[2014-03-29 18:10:14 -0400] jkeiser: segv: there is an arn in each result
[2014-03-29 18:10:17 -0400] segv: does that require the instance be up before hand?
[2014-03-29 18:10:29 -0400] jkeiser: Nope, IAM works without any instances
[2014-03-29 18:10:33 -0400] segv: nice
[2014-03-29 18:10:35 -0400] jkeiser: Let's see if a user can get a list of users
[2014-03-29 18:11:06 -0400] jkeiser: segv: so as long as when you create a NEW account, with no IAM users, the users endpoint returns something, we are probably done
[2014-03-29 18:11:31 -0400] segv: ah
[2014-03-29 18:11:39 -0400] jkeiser: segv: note that get instance will be enough in a lot of cases, but there will be some that won't work (if the instance doesn't exist)
[2014-03-29 18:12:24 -0400] segv: yeah and invalid results is not the objective here haha
[2014-03-29 18:12:35 -0400] segv: jkeiser do you have a roadmap posted anywhere for CM?
[2014-03-29 18:14:37 -0400] jkeiser: segv: the requirements doc in the repo is a list of the things I think are most important and the order in which I think they are important
[2014-03-29 18:14:59 -0400] segv: sounds good to me
[2014-03-29 18:15:09 -0400] segv: I'll work on basic featuers and try to jump on some stuff
[2014-03-29 18:15:11 -0400] jkeiser: segv: it's a list of scenarios rather than specific features
[2014-03-29 18:15:33 -0400] segv: My work is starting to depend on it and it's features are probably going to end up being used :)
[2014-03-29 18:15:43 -0400] segv: jkeiser also, legal should have the CCLA in by tuesday
[2014-03-29 18:16:05 -0400] jkeiser: segv: Trello is organized roughly in the order I think are most important, but only roughly.  I have been maintaining the list in leankit for the last few weeks but am moving back to Trello (and it hasn't changed a ton)
[2014-03-29 18:16:21 -0400] segv: ah
[2014-03-29 18:16:43 -0400] segv: I like trllo :)
[2014-03-29 18:16:46 -0400] segv: trello*
[2014-03-29 18:17:16 -0400] segv: I think you can share them no?
[2014-03-29 18:17:58 -0400] jkeiser: segv: the first scenario (and the only one that is actually specced out) will be done by chefconf (2-3 weeks) I think.  After that, a Metal command line that lets you manipulate the instances a bit using the metadata (provisioner_output) that Metal puts in the nodes.  After that, parallelism in Chef is mucho importante
[2014-03-29 18:18:09 -0400] jkeiser: These are the big sweeping things I'm on
[2014-03-29 18:18:15 -0400] segv: Roger that
[2014-03-29 18:18:23 -0400] segv: I'll keep banging on these knife features then :D
[2014-03-29 18:18:37 -0400] jkeiser: segv: somewhere in there is "rationalize Metal drivers with Kitchen drivers and Bootstraps--put all the best features together and separate the drivers/provisioners so EVERYONE can use them"
[2014-03-29 18:18:42 -0400] segv: So people can assume that whatever they used from knife before will be an attribute similarly of variance
[2014-03-29 18:19:13 -0400] jkeiser: segv: exactly.  I think in the end we want to retire knife ec2 bootstrap, etc. and make a unified interface with metal underneath
[2014-03-29 18:19:20 -0400] segv: yeah
[2014-03-29 18:19:23 -0400] segv: that would be awesome
[2014-03-29 18:19:33 -0400] segv: the knife ec2 command is awesome, but metal makes it so much easier now that it's a DSL
[2014-03-29 18:19:57 -0400] jkeiser: segv: one problem that needs a-solvin' is a common repository where you can put your common provisioner definitions for reuse.  ~/.chef/metal or something
[2014-03-29 18:20:36 -0400] segv: ah yeah
[2014-03-29 18:20:40 -0400] segv: that would be a big one
[2014-03-29 18:20:43 -0400] segv: instead of it being a cookbook
[2014-03-29 18:20:54 -0400] jkeiser: This will enable all sorts of scenarios.  One interesting one is "new to our company?  download all this crap to ~/.chef/metal and you will be able to make shit in our ec2 and openstack accounts."
[2014-03-29 18:21:07 -0400] segv: that would be fricken awesome
[2014-03-29 18:21:08 -0400] jkeiser: segv: it could even be a cookbook still (not sure) but having a common place seems important
[2014-03-29 18:21:13 -0400] segv: cause that's the goal I am trying to achieve with metal
[2014-03-29 18:21:22 -0400] segv: "Check out this repo, set your AWS keys with IAM, fire and forget"
[2014-03-29 18:21:40 -0400] segv: right now I have a amazon linux host with IAM access so they don't even need the api keys
[2014-03-29 18:21:51 -0400] jkeiser: segv: yep!  For your specific scenario I think you're already there since your AWS keys can be put in the default location and you're done
[2014-03-29 18:21:57 -0400] segv: yep
[2014-03-29 18:22:11 -0400] jkeiser: But as soon as you want to make new repos you have to copy stuff which makes me (sadpanda)
[2014-03-29 18:22:19 -0400] segv: I was demoing what I had to one of the guys at AWS SUmmit this week
[2014-03-29 18:23:02 -0400] jkeiser: Holy crap you can actually query an instance and ask it for its metadata?  That sounds hella useful
[2014-03-29 18:23:08 -0400] jkeiser: segv: neat!  how did that go?
[2014-03-29 18:23:13 -0400] segv: pretty cool
[2014-03-29 18:23:17 -0400] segv: it worked haha :D
[2014-03-29 18:23:25 -0400] segv: The summit was cool, I got more swag then I can handle
[2014-03-29 18:23:36 -0400] segv: got one of the shirts too which I was particularly stoked about
[2014-03-29 18:24:02 -0400] segv: also showed metal to some people at the bootcamp the day before and they were enthralled with it being in existance
[2014-03-29 18:24:30 -0400] segv: it'd be amazing to just #!/usr/bin/env chef-metal or something
[2014-03-29 18:24:33 -0400] segv: and just run a script
[2014-03-29 18:25:13 -0400] jkeiser: segv: interesting ............ can you dump that idea in Trello?
[2014-03-29 18:25:25 -0400] segv: send me an invite ryan {} chegg
[2014-03-29 18:25:28 -0400] segv: .com whoops
[2014-03-29 18:25:28 -0400] jkeiser: segv: I think it's basically a chef-client feature, but we can emulate it in a separate exe pretty easily
[2014-03-29 18:25:29 -0400] jkeiser: will do
[2014-03-29 18:25:44 -0400] segv: spam filter is going to explode now haha
[2014-03-29 18:26:57 -0400] jkeiser: segv: done!
[2014-03-29 18:27:02 -0400] segv: thanks!
[2014-03-29 18:27:08 -0400] jkeiser: segv: that sounds like an awesome high pri idea for usability
[2014-03-29 18:27:16 -0400] segv: yeah
[2014-03-29 18:28:28 -0400] segv: hmm what to call it
[2014-03-29 18:28:44 -0400] segv: Hashbang shell implementation for script execution?
[2014-03-29 18:30:33 -0400] jkeiser: segv: sure :)
[2014-03-29 18:30:40 -0400] jkeiser: segv: crap, list users is not available to a default iam
[2014-03-29 18:30:45 -0400] segv: ahhh
[2014-03-29 18:30:46 -0400] segv: lameee
[2014-03-29 18:30:47 -0400] jkeiser: there MUST be some kind of "get current user" function.
[2014-03-29 18:31:15 -0400] jkeiser: OHO
[2014-03-29 18:31:21 -0400] geggam: echo $USER
[2014-03-29 18:31:27 -0400] geggam:  `whoami`
[2014-03-29 18:31:31 -0400] jkeiser: http://docs.aws.amazon.com/IAM/latest/APIReference/API_GetUser.html
[2014-03-29 18:31:41 -0400] segv: ah
[2014-03-29 18:31:43 -0400] jkeiser: If you don't specify the user, it returns current user.
[2014-03-29 18:31:46 -0400] jkeiser: I bet we can use this.
[2014-03-29 18:31:48 -0400] segv: nice!
[2014-03-29 18:31:50 -0400] jkeiser: But I have to get the kids in the bath
[2014-03-29 18:31:51 -0400] jkeiser: :)
[2014-03-29 18:31:55 -0400] segv: roger that
[2014-03-29 18:32:04 -0400] segv: I gotta go to the apple store and get my new laptop here in like 30~
[2014-03-29 18:32:32 -0400] segv: jkeiser, also going to have a Chef Meetup at our office in santa clara here soon, would be awesome to put a nice demo of metal together for them
[2014-03-29 18:32:47 -0400] segv: probably post-chefconf
[2014-03-29 18:33:17 -0400] geggam: tshirts  ?
[2014-03-29 18:33:31 -0400] geggam: only reason i go to those things :)
[2014-03-29 18:34:29 -0400] segv: geggam,  haha, i walked away with 13~ shirts or so haha
[2014-03-29 18:34:50 -0400] geggam: devops days the mongodb chick was trying to give me a box full :)
[2014-03-29 18:35:26 -0400] geggam: needless to say all my garage work is done in mongodb
[2014-03-29 18:35:51 -0400] segv: i'll be doing a keynote at the next devopsdays hopefully
[2014-03-29 18:36:09 -0400] geggam: nice
[2014-03-29 18:36:16 -0400] segv: *hopefully* is the key
[2014-03-29 18:36:16 -0400] segv: haha
[2014-03-29 18:47:47 -0400] jkeiser: segv: lol I could have just looked at the error message from list_users to find out the account # though
[2014-03-29 18:47:51 -0400] jkeiser: segv: User: arn:aws:iam::472814791932:user/jkeiser_metal is not authorized to perform: iam:ListUsers on resource: arn:aws:iam::472814791932:user/ (Fog::AWS::IAM::Error)
[2014-03-29 18:47:56 -0400] segv: haha
[2014-03-29 18:48:09 -0400] segv: treat it as a soft error to retrieve the ID
[2014-03-29 18:48:16 -0400] segv: Would be a funny hack
[2014-03-29 18:53:59 -0400] jkeiser: segv: lol jesus AccessDenied => User: arn:aws:iam::472814791932:user/jkeiser_metal is not authorized to perform: iam:GetUser on resource: arn:aws:iam::472814791932:user/jkeiser_metal (Fog::AWS::IAM::Error)
[2014-03-29 18:54:20 -0400] jkeiser: @!$!@#
[2014-03-29 18:54:33 -0400] jkeiser: Sorely tempted to do the soft error here.
[2014-03-29 18:55:26 -0400] segv: Until we find a better way, just comment it with a gag
[2014-03-29 18:55:34 -0400] segv: # Yeah, I really did it, you can thank me later.
[2014-03-29 19:17:14 -0400] PapaSierra: so i've hit this bug https://tickets.opscode.com/browse/CHEF-4753
[2014-03-29 19:25:42 -0400] PapaSierra: does anyone know a workaround? it's a show stopper if you're using chef-solo with encrypted data bags. there must be people using that combination.
[2014-03-29 19:41:01 -0400] jkeiser: segv: yeah, just fyi IAM.ListUsers does not list the root user of the account (and probably does not list federated users, which as far as I can tell is your way to invite outside users to your "org")
[2014-03-29 19:41:18 -0400] segv: jkeiser, ah, will it still work? lol
[2014-03-29 19:41:52 -0400] jkeiser: segv: well we're using GetUser without passing the user param, which works fine for root
[2014-03-29 19:42:05 -0400] segv: hmm k
[2014-03-29 19:42:06 -0400] jkeiser: segv: and fails but reveals information for non-root
[2014-03-29 19:42:08 -0400] jkeiser: so we're all good!
[2014-03-29 19:42:14 -0400] segv: yeah, guess it works either way
[2014-03-29 19:42:49 -0400] segv: softerror and go
[2014-03-29 19:43:06 -0400] segv: almost done with the ohai stuff, going to test it shortly and push up a PR
[2014-03-29 20:03:55 -0400] cob: hey anyone work with opsworks that i can pick brain about? https://gist.github.com/conrado/9848472
[2014-03-29 20:06:00 -0400] cob: i'm trying to deploy a django app with a mix of cookbooks, one being application_python
[2014-03-29 20:10:56 -0400] coderanger: cob: None of my cookbooks work with the older opsworks stacks
[2014-03-29 20:11:05 -0400] coderanger: cob: Use the new 11.10 mode
[2014-03-29 20:13:41 -0400] cob: coderanger: does changing the stack's chef mode trigger chef-client re-install on any instances?
[2014-03-29 20:14:02 -0400] coderanger: cob: No idea, sorry
[2014-03-29 20:25:12 -0400] cob: coderanger: is there a community cookbook you can recommend as an example for deploying django on opsworks?
[2014-03-29 20:25:57 -0400] coderanger: cob: Nope, I don't use Opsworks so I don't test with it, bits of the app* cookbooks do make use of search by default, but they said search is now supported (somehow)
[2014-03-29 20:26:00 -0400] coderanger: so YMMV
[2014-03-29 20:32:49 -0400] jkeiser: segv: a nice thing about the account id change is we will no longer leak the access key id (though we never leaked the key itself anyway)
[2014-03-29 20:38:03 -0400] segv: jkeiser yeah, just a bad thing to have it susceptible to
[2014-03-29 21:17:52 -0400] jkeiser: segv: tested and uploaded
[2014-03-29 21:17:56 -0400] jkeiser: pushed I mean
[2014-03-29 21:17:58 -0400] segv: awesome
[2014-03-29 21:18:05 -0400] jkeiser: The account id thing
[2014-03-29 21:18:08 -0400] segv: I got ohai on a branch, but waiting for my ec2 fixes to make it in there
[2014-03-29 21:18:21 -0400] segv: going to clean those up
[2014-03-29 21:18:32 -0400] segv: need to find a way to better detect if PTY is required
[2014-03-29 21:19:28 -0400] jkeiser: segv: if it's not possible or easy, that's cool.  Is it possible to make instances that aren't capable of the pty thing?
[2014-03-29 21:19:41 -0400] segv: yeah
[2014-03-29 21:19:44 -0400] segv: amazon linux
[2014-03-29 21:19:56 -0400] segv: requires pty for sudo out of the box
[2014-03-29 21:20:12 -0400] jkeiser: segv: I mean can you make instances on which pty cannot be turned on
[2014-03-29 21:20:40 -0400] segv: oh, not sure about that one, but as long as ssh is enabled you can execute commands w/out pty
[2014-03-29 21:20:47 -0400] jkeiser: segv: if you cannot, we can just always do it.  If you can, we need a configurable with a reasonable default, and possible detection for the default
[2014-03-29 21:21:13 -0400] jkeiser: segv: my only worry is if we always enable pty, then machines which are not capable of it will throw an exception, yes?
[2014-03-29 21:21:21 -0400] jkeiser: thus the configurable or detectable
[2014-03-29 21:21:25 -0400] segv: yeah, 'can't acquire pty' etc.
[2014-03-29 21:21:31 -0400] segv: that's why the config option seems more helpful
[2014-03-29 21:23:01 -0400] ssd7: Ohai Chefs
[2014-03-29 21:23:11 -0400] segv: ello
[2014-03-29 21:23:30 -0400] jkeiser: segv: then let's merge :)  if we can add detection, all the more awesome
[2014-03-29 21:24:23 -0400] segv: yeah
[2014-03-29 21:24:28 -0400] jkeiser: segv: one way to do it ...
[2014-03-29 21:24:29 -0400] segv: jkeiser looks like vagrant had the same issue
[2014-03-29 21:24:30 -0400] segv: https://github.com/mitchellh/vagrant/issues/1482
[2014-03-29 21:24:41 -0400] jkeiser: segv: unconditionally turn on pty, but catch the exception and say "oops, couldn't do it"
[2014-03-29 21:24:50 -0400] segv: that's true
[2014-03-29 21:25:30 -0400] segv: yeah, looks like a few images "require" it
[2014-03-29 21:25:32 -0400] segv: but some do not.
[2014-03-29 21:25:39 -0400] jkeiser: segv: if the user sent the config option "must use pty", and you fail, then you reraise.  If they said "must not use pty," you don't even try.  If they didn't say anything, then you try, but just ignore failure.
[2014-03-29 21:25:53 -0400] jkeiser: segv: i.e. three cases: use_pty = false, use_pty = true, and use_pty = nil
[2014-03-29 21:26:06 -0400] segv: ah yes, we can do that
[2014-03-29 21:26:09 -0400] jkeiser: Best of all worlds
[2014-03-29 21:27:02 -0400] segv: jkeiser it will have to reconnect though
[2014-03-29 21:27:04 -0400] jkeiser: I've been using that pattern a lot and I like it ... where the default is neither false nor true, but "try"
[2014-03-29 21:27:06 -0400] segv: so we'll have to try/catch
[2014-03-29 21:28:01 -0400] segv: well begin/rescue, brains in a loop haha
[2014-03-29 21:29:05 -0400] jkeiser: ok sounds like a plan :)  I'll hold off merging till we have it
[2014-03-29 21:29:12 -0400] jkeiser: Thank you so much for all your help
[2014-03-29 21:31:40 -0400] segv: jkeiser not a problem! :D
[2014-03-29 21:37:01 -0400] segv: jkeiser I am going to remove that PR
[2014-03-29 21:37:09 -0400] segv: and make a cleaner one as that branch isn't clean to commit
[2014-03-29 21:37:14 -0400] segv: bah, merge
[2014-03-29 21:37:24 -0400] segv: well nm
[2014-03-29 21:37:31 -0400] segv: Just fixing it and pushing to the same thing to keep track
[2014-03-29 21:41:40 -0400] jkeiser: segv: if you use git push --force, you can override the branch with a new commit
[2014-03-29 21:42:41 -0400] segv: yeah going to do that
[2014-03-29 21:43:18 -0400] jkeiser: segv: if you do that, github will still keep the PR open and up to date with your new work :)
[2014-03-29 21:43:28 -0400] segv: woot
[2014-03-29 21:43:34 -0400] segv: haven't tried that yet, thank you for being awesome git
[2014-03-29 22:16:59 -0400] jkeiser: segv: it occurs to me that you probably need the same use_pty? fix in connect_to_machine
[2014-03-29 22:17:04 -0400] jkeiser: segv: might need some factoring if you do that
[2014-03-29 22:17:14 -0400] segv: yeah it is possible
[2014-03-29 22:17:25 -0400] segv: I was going to do a begin -> fail, detect the err on rescue
[2014-03-29 22:17:29 -0400] segv: and then reconnect with PTY enabled
[2014-03-29 22:18:01 -0400] segv: just to make it completely trivial
[2014-03-29 22:19:44 -0400] nikolay: Hi. I need to deploy an application on to one server twice for different domains. We have recipe for it. Easiest way, copy it with another name  and change paths. But I think it's not the best solution, because if I change the recipe for one, I  need to change and for another. How to do it better?
[2014-03-29 23:02:37 -0400] segv: jkeiser, pinged you a /query
