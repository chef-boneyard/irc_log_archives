[2014-07-24 00:01:10 -0400] mivok: focus stealing irc client :(
[2014-07-24 00:22:36 -0400] sam___: Question: Hi Chef experts. would need some guidance on how I should approach this use case that I have. we have multiple wily agent types (tomcat agent, jboss agent, epagent, etc.) for which we are trying to write chef recipes. We have a case where in we may need to install jboss along with epagent on the same machine. As of now we have same attribute being used for both agent types (say ['my']['agent']['version']).
[2014-07-24 00:22:56 -0400] sam___: When we try to install jboss and epagent using theWhen we try to install jboss and epagent using the same cookbook, attributes get overridden and only one install happens
[2014-07-24 00:23:05 -0400] coderanger: sam___: Use different attributes
[2014-07-24 00:23:13 -0400] sam___: is there a aah
[2014-07-24 00:23:15 -0400] coderanger: node['tomcat_agent']['version'], etc
[2014-07-24 00:23:40 -0400] sam___: ot this is the only way?
[2014-07-24 00:25:30 -0400] coderanger: sam___: I mean its just code, so you can do it any way you want, but I see no reason those agents should be related
[2014-07-24 00:59:00 -0400] Damm: coderanger, sure it is.  The webui was a component as of 0.8; you didn't have to install the webui
[2014-07-24 00:59:13 -0400] Damm: coderanger, it only became a default again with omnibus as a tuneable to disable
[2014-07-24 00:59:28 -0400] Damm: back in the gem era when you fetched solr ala rubygems
[2014-07-24 01:00:19 -0400] Damm: history is always relevent people forget it; things change
[2014-07-24 01:00:31 -0400] Damm: but a lot of people care about why enough that history matters
[2014-07-24 02:01:12 -0400] nulleric: wasnt there a cookbook that would grab all the users of an org on github's SSH public keys and create/add them to the .ssh/authorized_keys file
[2014-07-24 02:08:52 -0400] Damm: your thinking of the balanced-users cookbook nulleric
[2014-07-24 02:09:05 -0400] Damm: https://github.com/balanced-cookbooks/balanced-user
[2014-07-24 02:09:07 -0400] Damm: ^^ nulleric
[2014-07-24 02:09:31 -0400] nulleric: rock, thanks
[2014-07-24 02:09:56 -0400] nulleric: having the "i have ec2 instances across 3 accounts and my whole team needs access" problem
[2014-07-24 02:11:08 -0400] Damm: eww
[2014-07-24 02:11:17 -0400] Damm: i had to work with 2 ec2 acccounts once
[2014-07-24 02:11:19 -0400] Damm: it was such a mess
[2014-07-24 02:11:38 -0400] Damm: staging landed in production all the time :(
[2014-07-24 02:12:31 -0400] nulleric: ya i am at the early stage of "color PS1 of production red"
[2014-07-24 02:13:44 -0400] Damm: well usually that becomes a paste the environment in PS1
[2014-07-24 02:13:59 -0400] Damm: so you have user@nodename: production] ~
[2014-07-24 02:21:36 -0400] zbp: does the yum plugin not work for centos 6.5 with Chef v 11.8.2?
[2014-07-24 02:27:28 -0400] zbp: nevermind forgot to add depends 'yum' to metadata.rb
[2014-07-24 02:30:19 -0400] Damm: amazing how that works
[2014-07-24 02:38:40 -0400] nulleric: looking at these RFC's for chef12, is the goal that every cookbook should still work in 11 and 12? deprecation vs new api
[2014-07-24 02:41:18 -0400] coderanger: nulleric: No, Chef 12 will almost certainly have backwards incompatible changes
[2014-07-24 02:41:28 -0400] coderanger: though certainly the goal is to minimize them when possible
[2014-07-24 02:43:18 -0400] Scrivener: Hey guys, I've got this cookbook here https://supermarket.getchef.com/cookbooks/database and I'm trying to understand it a little bit.
[2014-07-24 02:43:30 -0400] Scrivener: My confusion specifically arises around created users and how connections should be working.
[2014-07-24 02:43:56 -0400] Scrivener: In the examples in their documentation, they extract, for example "postgresql_connection_info" into its own hash, and this connection info specifies the root user and password.
[2014-07-24 02:43:59 -0400] Damm: in the cookbooks coderanger ?
[2014-07-24 02:44:22 -0400] Scrivener: But when creating a normal user, it specifies the same connection info, and no separate password... I'm really confused by this.
[2014-07-24 02:44:29 -0400] Damm: I think it's a fairly small goal to keep cookbooks sane on upgrading; sure new things drop here and there that could become a new thing
[2014-07-24 02:44:39 -0400] coderanger: Damm: Likely yes
[2014-07-24 02:44:41 -0400] Damm: but overall I would hope that would be fairly small except for a few new resources
[2014-07-24 02:44:43 -0400] Damm: or such
[2014-07-24 02:44:57 -0400] Scrivener: When I create a user in postgresql, I specify a password for that user (which is NOT the root password), and apps will log in as that user -- not as root or postgres or what have you
[2014-07-24 02:44:58 -0400] Damm: I know I felt that sucky pain at Engine Yard
[2014-07-24 02:45:05 -0400] Damm: kind of the reason why they are still on 0.6
[2014-07-24 02:45:11 -0400] Damm: couldn't upgrade without breaking
[2014-07-24 02:45:17 -0400] Damm: i mean we could write a shim
[2014-07-24 02:45:19 -0400] Damm: but we didn't
[2014-07-24 02:46:28 -0400] coderanger: Damm: Backwards incompatibility is what defines it as Chef 12, in accordance with semver
[2014-07-24 02:46:34 -0400] hypnosb: so yeah all today screwing with that user cookbook
[2014-07-24 02:46:38 -0400] hypnosb: was old chef-server
[2014-07-24 02:46:39 -0400] Damm: coderanger, true true
[2014-07-24 02:46:42 -0400] hypnosb: FML
[2014-07-24 02:46:42 -0400] Damm: semver in that
[2014-07-24 02:47:28 -0400] coderanger: Scrivener: Which example do you mean?
[2014-07-24 02:47:28 -0400] Scrivener: So basically all I want to know is, do I want the connection info specified under the user creation to reflect the configuration my apps are using?
[2014-07-24 02:47:37 -0400] Scrivener: coderanger, lemme find the exact title
[2014-07-24 02:47:53 -0400] coderanger: Damm: You should look at kallistec's proposal to rework attributes. It's a big change but I think it will be a good one :)
[2014-07-24 02:48:20 -0400] coderanger: Damm: https://github.com/opscode/chef-rfc/pull/9
[2014-07-24 02:48:21 -0400] Scrivener: coderanger, database_user examples, scroll down to where it's doing postgresql_database_user and granting all privileges on 'foo' db
[2014-07-24 02:49:03 -0400] Scrivener: Where it gives connection, it's using the connection info that was extracted to a hash above it. The info that contains root username and password. I can't tell if that means it is expecting your apps to be connecting as the root user with root password?
[2014-07-24 02:49:22 -0400] Scrivener: In our current postgresql setup, the root user doesn't even *have* a password.
[2014-07-24 02:49:34 -0400] Scrivener: We connect as individual users that access individual databases.
[2014-07-24 02:49:58 -0400] coderanger: Scrivener: Yes, that is correct
[2014-07-24 02:50:10 -0400] Scrivener: So if I needed to create many users with this cookbook, should I be defining the contents of 'connection' as their individual usernames and passwords?
[2014-07-24 02:50:13 -0400] coderanger: Scrivener: You could have it use ident auth if you prefer, sounds like thats what you are doing now
[2014-07-24 02:50:18 -0400] Scrivener: And have multiple hashes (if I want it extracted)
[2014-07-24 02:50:25 -0400] Scrivener: coderanger, we're using md5 auth
[2014-07-24 02:50:33 -0400] Scrivener: For the various database users
[2014-07-24 02:50:35 -0400] coderanger: Scrivener: The connection info is basically just passed down to pq
[2014-07-24 02:50:54 -0400] coderanger: Scrivener: You need to connect as a user authorized to create/grant on users
[2014-07-24 02:50:55 -0400] nulleric: ooo thats interesting: node.desired[:nginx][:version] == node.current[:nginx][:version]
[2014-07-24 02:51:03 -0400] Scrivener: coderanger, so for each instance of connection, I want to use the configuration my apps are currently using?
[2014-07-24 02:51:21 -0400] coderanger: Scrivener: Probably not, I certainly hope your apps don't run as a superuser
[2014-07-24 02:51:35 -0400] Scrivener: coderanger, no no no, they each run as an individual user, that's what I was confused about.
[2014-07-24 02:51:48 -0400] coderanger: Scrivener: The connection info has nothing to do with the user being created
[2014-07-24 02:51:52 -0400] Scrivener: It looked like, from their examples here, that it was setting up all of them to run as "postgres", because that's what was shown in the examples
[2014-07-24 02:51:56 -0400] coderanger: thats just the params used to open a DB connection
[2014-07-24 02:51:59 -0400] Scrivener: At least that's how I understood it
[2014-07-24 02:52:03 -0400] Scrivener: Alright/
[2014-07-24 02:52:20 -0400] coderanger: Yes, it will run the grant as postgres, as that is almost always available and is a super user
[2014-07-24 02:52:35 -0400] Scrivener: So their postgres example omits a password -- I can just include one, and other apps can log in as that user and continue as normal?
[2014-07-24 02:52:53 -0400] Scrivener: Great :D That clears that up. Connection used for actually creating the user from the root account.
[2014-07-24 02:52:59 -0400] coderanger: Scrivener: In a default setup, the "postgres" user has no password, so you would either need to give it one or use ident auth
[2014-07-24 02:53:35 -0400] Scrivener: coderanger, I can change that later then. I just wanted to make sure I was creating usable users. :)
[2014-07-24 02:54:13 -0400] coderanger: Scrivener: The connection info used when creating a user has nothing to do with the user you are creating
[2014-07-24 02:54:23 -0400] Scrivener: coderanger, right, thank you very much :)
[2014-07-24 02:54:38 -0400] Scrivener: So if I made a user with the following block: http://pastie.org/private/vh3vynsx8mlsfc5d7mptq
[2014-07-24 02:55:00 -0400] Scrivener: An app connecting as user foo_user with password foobar would make a successful connection?
[2014-07-24 02:55:10 -0400] Scrivener: (Assuming all other factors are accounted for, like firewall and whatnot)
[2014-07-24 02:58:00 -0400] coderanger: Yes
[2014-07-24 02:58:21 -0400] Scrivener: coderanger, excellent! Thanks greatly for your help.
[2014-07-24 03:07:11 -0400] nulleric: trying to debug a service resource, it set to :enable and :start, the converge says it's started, but it's not. service x start will start it though if i do it manually
[2014-07-24 03:19:30 -0400] nulleric:        [2014-07-24T03:15:54+00:00] DEBUG: service[xx] already running - nothing to do - but it's not, service xx status says no, exits with 0
[2014-07-24 06:56:50 -0400] seshagiri_naidu: Hi Team, how to  bootstrap windows node with winRm conifiguration is part of base line image(AMI), I want to avoid manul configuration of winRm on the target node, and bootstrap the node
[2014-07-24 06:58:22 -0400] seshagiri_naidu: can someone point me to the right link,
[2014-07-24 07:08:00 -0400] coderanger: seshagiri_naidu: I've not heard of anyone doing that so I suspect you're on your own
[2014-07-24 07:15:17 -0400] seshagiri_naidu: coderanger: I could not bootstrap windows without first executing "winrm configuration" commands, then how to automate the process of installation?
[2014-07-24 07:16:24 -0400] seshagiri_naidu: I mean "winrm configuration" on the target m/c
[2014-07-24 07:55:12 -0400] SmudgerDan: Morning sexy people
[2014-07-24 09:02:26 -0400] robredpath: hey! I'm looking for help with a cookbook I'm working on - is this the right place? Is anyone around?
[2014-07-24 09:04:32 -0400] coderanger: robredpath: Right place, but most people in here are in north america where its still pretty early
[2014-07-24 09:05:03 -0400] coderanger: robredpath: the early-risers in UTC-4 might be up though, or ssd7 :)
[2014-07-24 09:05:19 -0400] robredpath: coderanger: thanks :) it's not urgent, I'll stick around
[2014-07-24 09:05:31 -0400] coderanger: robredpath: If its quick I can answer :)
[2014-07-24 09:05:35 -0400] coderanger: Just about to go pass out though
[2014-07-24 09:06:48 -0400] robredpath: i want to use ohai data in my metadata.rb but when I try, berks crashes out telling me that there's no such var as 'node' - am I trying to do something impossible?
[2014-07-24 09:06:55 -0400] coderanger: robredpath: That isn't possible
[2014-07-24 09:07:17 -0400] robredpath: ha, fair. is there any way to change what deps a cookbook has based on which OS it's working on?
[2014-07-24 09:07:18 -0400] coderanger: robredpath: The metadata.rb is just a DSL, its baked to static JSON before uploading (just like roles et al)
[2014-07-24 09:07:25 -0400] coderanger: robredpath: No, that isn't possible
[2014-07-24 09:07:47 -0400] coderanger: robredpath: You have to set the deps for all supported platforms and just make the include_recipe conditional
[2014-07-24 09:08:39 -0400] robredpath: the issue I have is that one of the cookbooks that I depend on doesn't exist for one of my supported OSes at all, so when berks goes looking, it can't resolve all its deps
[2014-07-24 09:09:17 -0400] robredpath: i might have misunderstood how smart berks is, though, i'm pretty new to chef!
[2014-07-24 09:09:23 -0400] coderanger: robredpath: Not sure what you mean, cookbooks aren't linked to OSes
[2014-07-24 09:09:46 -0400] coderanger: robredpath: If you are talking about the "supports" line in the metadata, that is for documentation purposes only, it has no actual effect on chef
[2014-07-24 09:09:57 -0400] robredpath: hmmm, i might have a different problem then
[2014-07-24 09:10:12 -0400] coderanger: robredpath: You can, and very often will, be loading the apt, yum and windows cookbooks on the same node :)
[2014-07-24 09:10:23 -0400] coderanger: You just don't use the recipes
[2014-07-24 09:12:05 -0400] workmad3: robredpath: is it possible that berks isn't finding the dependency because it's not in any of the lookup locations in the Berksfile?
[2014-07-24 09:12:27 -0400] workmad3: robredpath: bearing in mind that berkshelf doesn't look at berksfiles in dependent recipes
[2014-07-24 09:13:13 -0400] coderanger: robredpath: What error are you seeing?
[2014-07-24 09:14:21 -0400] robredpath: i don't think it's that - it works when I test on el5 but not el6. lemme kick off a kitchen run to grab the exact errors - everything i've got in my shell is errors from the wrong path i've been taking
[2014-07-24 09:14:54 -0400] robredpath: do feel free to go pass out when you want to though :) my chef issues aren't worth your sleep :p
[2014-07-24 09:15:10 -0400] workmad3: robredpath: hmm... berks isn't involved at all during the actual chef run...
[2014-07-24 09:16:15 -0400] robredpath: i've got test kitchen spinning up a vagrant vm so berks is involved to grab the right cookbooks, and it's that which is giving errors relating to metadata.rb
[2014-07-24 09:16:31 -0400] robredpath: i was quite confused at first as to how that worked
[2014-07-24 09:16:35 -0400] coderanger: robredpath: You should be able to get the same error much faster via `berks install`
[2014-07-24 09:17:22 -0400] robredpath: ah, of course, if berks isn't OS-dependent then I will get the same results on my f20 laptop as in a VM *lightbulb*
[2014-07-24 09:17:43 -0400] robredpath: [rob@localhost wwwh-cookbook-wrapper-chef-client  (feature/add-monitoring-to-cron)] berks install
[2014-07-24 09:17:45 -0400] robredpath: Resolving cookbook dependencies...
[2014-07-24 09:17:46 -0400] robredpath: Fetching 'wrapper-chef-client' from source at .
[2014-07-24 09:17:48 -0400] robredpath: Fetching 'wrapper-cron' from git@github.com:site5/wwwh-cookbook-wrapper-cron (at 0.2.0)
[2014-07-24 09:17:49 -0400] robredpath: Fetching cookbook index from https://api.berkshelf.com...
[2014-07-24 09:17:51 -0400] robredpath: Unable to satisfy constraints on package wrapper-zabbix, which does not exist, due to solution constraint (wrapper-chef-client = 0.1.3). Solution constraints that may result in a constraint on wrapper-zabbix: [(wrapper-chef-client = 0.1.3) -> (wrapper-zabbix = 0.1.2)]
[2014-07-24 09:17:52 -0400] robredpath: Missing artifacts: wrapper-zabbix
[2014-07-24 09:17:54 -0400] robredpath: Demand that cannot be met: (wrapper-chef-client = 0.1.3)
[2014-07-24 09:17:55 -0400] robredpath: Unable to find a solution for demands: wrapper-chef-client (0.1.3), wrapper-cron (0.2.0)
[2014-07-24 09:17:58 -0400] coderanger: robredpath: Please use a pastebin
[2014-07-24 09:18:05 -0400] robredpath: sure thing, sorry
[2014-07-24 09:18:38 -0400] coderanger: Can you also pastebin your metadata.rb and berksfile?
[2014-07-24 09:19:58 -0400] workmad3: robredpath: wrapper-zabbix is constrained to 0.1.2 by either your wrapper-chef-client metadata.rb or your Berksfile.lock and that version can't be found
[2014-07-24 09:20:16 -0400] robredpath: wait, i've found it - i thought berks was grabbing cookbooks from our chef-server but it's actually grabbing them from github
[2014-07-24 09:20:21 -0400] workmad3: robredpath: at a guess, you've pushed a newer version to a git repo and haven't run berks update
[2014-07-24 09:20:31 -0400] robredpath: and i didn't add the wrapper-zabbix repo to the Berksfile
[2014-07-24 09:20:37 -0400] workmad3: robredpath: aha :)
[2014-07-24 09:20:38 -0400] robredpath: *facepalm*
[2014-07-24 09:20:48 -0400] robredpath: thanks :D
[2014-07-24 09:20:58 -0400] workmad3: robredpath: you can set up your own instance of berkshelf-api that can index your chef server btw...
[2014-07-24 09:21:06 -0400] coderanger: robredpath: If you want berks to grok your chef-server as an artifact server (and you should) you need to run your own berks-api
[2014-07-24 09:21:14 -0400] coderanger: heh, what ^^ said
[2014-07-24 09:21:22 -0400] workmad3: coderanger: morning :)
[2014-07-24 09:21:44 -0400] robredpath: ooh, interesting
[2014-07-24 09:22:10 -0400] robredpath: i had no idea that was a thing
[2014-07-24 09:23:46 -0400] robredpath: *is reading* that definitely makes life easier than what we're doing at the moment. thanks coderanger workmad3 :)
[2014-07-24 09:40:14 -0400] ssd7: Ohai Chefs
[2014-07-24 10:39:22 -0400] chef751: Hey all, don't suppose anyone knows when 11.14 client is due for general release?
[2014-07-24 10:50:27 -0400] nkts: when I'm trying to run chef-client -W -j /tmp/my.json - attributes from my.json seems not working
[2014-07-24 11:02:12 -0400] chandra: [root@chefserver ~]# knife bootstrap 10.222.189.66 -x root -P root@123 Connecting to 10.222.189.66 10.222.189.66 Installing Chef Client... 10.222.189.66 --2012-05-15 20:58:26--  https://www.opscode.com/chef/install.sh 10.222.189.66 Resolving www.opscode.com (www.opscode.com)... 184.106.28.91 10.222.189.66 Connecting to www.opscode.com (www.opscode.com)|184.106.28.91|:443... failed: Connection timed out. 10.222.189.66 Retrying. 10.222.18
[2014-07-24 11:02:24 -0400] chandra: anyone has any idea ?
[2014-07-24 11:03:24 -0400] nkts: chandra: can 10.222.189.66 connect to www.opscode.com ?
[2014-07-24 11:08:57 -0400] chandra: nkts, how can i check ?
[2014-07-24 11:10:47 -0400] nkts: chandra: connect to server over ssh and do curl ..
[2014-07-24 11:39:28 -0400] workmad3: chandra: or ping
[2014-07-24 11:46:06 -0400] SmudgerDan: Hi guys, incoming newbie chef/ruby question :)
[2014-07-24 11:46:39 -0400] SmudgerDan: I have an attribute: default['cookbook']['mount_mappings'] = [['drive' => 'R:', 'folder' => '\\\\random-computer\\folder'], ['drive' =>'I:', 'folder' => '\\\\random-computer2\\another_folder']]
[2014-07-24 11:46:55 -0400] SmudgerDan: and I want to loop over it in the recipe to mount the drives
[2014-07-24 11:47:30 -0400] SmudgerDan: so I create the loop: node['cookbook']['mount_mappings'].each do |mapping|
[2014-07-24 11:47:59 -0400] SmudgerDan: then write the "mount" code
[2014-07-24 11:48:11 -0400] SmudgerDan: mount mapping['drive'] do...
[2014-07-24 11:48:30 -0400] SmudgerDan: I assume I am doing something wrong here
[2014-07-24 11:48:40 -0400] SmudgerDan: TypeError --------- can't convert String into Integer
[2014-07-24 11:48:47 -0400] SmudgerDan: is the error I get
[2014-07-24 11:50:35 -0400] SmudgerDan: I assume I have messed up my understandings of arrays, hashes and loops =(
[2014-07-24 11:56:28 -0400] zts: SmudgerDan: you probably want to swap [] with {} for the elements of your array.  ie, ...['mount_mappings]' = [{'drive' => ...}, {...}]
[2014-07-24 11:56:56 -0400] SmudgerDan: zts: thanks, will give that a go
[2014-07-24 12:01:11 -0400] SmudgerDan: wow lol that was unexpected "Server Unavailable ------------------ The Chef Server is temporarily unavailable"
[2014-07-24 12:02:04 -0400] nkts: oh hell
[2014-07-24 12:02:43 -0400] nkts: how to deal with [package][version] attributes if some plugins are returning automatic attribute for [package][version]
[2014-07-24 12:05:08 -0400] SmudgerDan: zts: thanks mate that's got it working. Need to improve my ruby skills =D
[2014-07-24 12:07:55 -0400] rsavage_: Is node.normal soon to be depreciated?
[2014-07-24 12:08:04 -0400] rsavage_: In later versions of chef?
[2014-07-24 12:08:14 -0400] rsavage_: I thought there was something like that soon to be..?
[2014-07-24 12:08:17 -0400] rsavage_: anyone know?
[2014-07-24 12:59:18 -0400] joshua__: Hey guys, is it possible to run a powershell_script and capture the output of what is returned and do some logic with it? i.e. set a node attr?
[2014-07-24 13:01:31 -0400] yruss972: Hi- in a file resource using the content attribute, are variables in the content value evaluated when compiling the recipe or at run time?
[2014-07-24 13:03:37 -0400] yruss972: nm- found it
[2014-07-24 13:04:51 -0400] SmudgerDan: guys what is the best way to check if a windows service pack is installed on a Windows Server?
[2014-07-24 13:21:50 -0400] thorduri: Was the "Hashed Path" header for the API authorization done on purpose with a space ? (spaces in header field names are not allowed) and I just got bitten by canonicalization to Hashed-Path, can't find a ticket for it
[2014-07-24 13:22:10 -0400] SmudgerDan: ok think I have it node['kernel']['os_info']['service_pack_major_version'] =D
[2014-07-24 13:22:22 -0400] thorduri: or any discussion, wondering if propsing having the chef server accept both would be worth it (it breaks when verifing the signature)
[2014-07-24 13:47:42 -0400] thorduri: ah, never mind. it's not supposed to be put in as a header, got a bit confused.
[2014-07-24 14:35:18 -0400] medya: how to simmulate pressing "enter" in shell and waiting 1 second in cookbook ? (for configing weblogic I need to enter some stuff and press enter and wait and enter more stuff ...) any idea?
[2014-07-24 14:36:25 -0400] ingolf: hey there, I want to install java 2 times on my server. with slightly different java homes (node['java']['java_home'] is the variable callled I think) how do I do that?
[2014-07-24 14:37:58 -0400] tomduffield: medya maybe use expect and send?
[2014-07-24 14:38:01 -0400] tomduffield: in a bash block
[2014-07-24 14:38:09 -0400] tomduffield: http://codrspace.com/glenbot/automate-the-non-automated-with-expect-and-chef/
[2014-07-24 14:40:10 -0400] tomduffield: ingolf use the java_ark custom resource - https://github.com/agileorbit/java#java_ark
[2014-07-24 14:40:19 -0400] kevin_boise: anyone know of a tool for viewing and then pushing changes from one chef environment/org to another? (i.e. pushing changes from QA environment to Prod)
[2014-07-24 14:40:24 -0400] medya: @tomduffield thanks I will look at it
[2014-07-24 14:42:35 -0400] tomduffield: kevin_boise have you tried knife-spork?
[2014-07-24 14:42:42 -0400] tomduffield: that might do what you are looking for
[2014-07-24 14:43:44 -0400] kevin_boise: Awesome, thank you sir
[2014-07-24 14:46:05 -0400] ingolf: tomduffield: thx, but my question was more about how to reuse a environemnt/node/default varialbe twice. (and run the recipe 2 times)
[2014-07-24 14:46:27 -0400] tomduffield: ingolf that isn't possible. chef is designed to run only once
[2014-07-24 14:46:38 -0400] tomduffield: or more accurately, resources are designed to take action only once
[2014-07-24 14:46:40 -0400] ingolf: :/
[2014-07-24 14:47:16 -0400] tomduffield: if you want to install java in two different locations, the current method is to use java_ark
[2014-07-24 14:48:06 -0400] ingolf: So I can't install (my-awesome-server) twice using different ports/files/folders/configurations ?
[2014-07-24 14:48:36 -0400] ingolf: s/server/service/
[2014-07-24 14:48:42 -0400] tomduffield: you can, but not by running a recipe twice. what you would need to do is take the resources that install my-awesome-server and put them inside an LWRP
[2014-07-24 14:49:27 -0400] tomduffield: the apache2 cookbook has a lot of good examples of this: https://github.com/onehealth-cookbooks/apache2
[2014-07-24 14:49:49 -0400] tomduffield: i.e. apache_site or web_app
[2014-07-24 14:50:12 -0400] ingolf: tomduffield: ok, thx I think thats enough hints to read for now.
[2014-07-24 14:50:21 -0400] tomduffield: okay. best of luck!
[2014-07-24 15:12:04 -0400] mbianco__: hi all
[2014-07-24 15:12:20 -0400] mbianco__: I am terribly new with chef
[2014-07-24 15:12:42 -0400] jonlives: hi mbianco__ - we all were once :p
[2014-07-24 15:12:42 -0400] mbianco__: and following any quick tutorial about chef-solo
[2014-07-24 15:12:49 -0400] mbianco__: hah ;)
[2014-07-24 15:13:04 -0400] mbianco__: I always end up with the same errors
[2014-07-24 15:13:13 -0400] mbianco__: is there any doc you guys recommend for chef-solo ?
[2014-07-24 15:13:26 -0400] mbianco__: I run ubuntu 14.0.x TLS on AWS
[2014-07-24 15:13:52 -0400] chandra: https://gist.github.com/csb29/b6e3a6367b5c3ba8ad2c
[2014-07-24 15:14:03 -0400] chandra: can anyone pls check this error
[2014-07-24 15:14:24 -0400] chandra: i am getting this error after running chef-server-ctl reconfigure
[2014-07-24 15:14:27 -0400] chandra: https://gist.github.com/csb29/b6e3a6367b5c3ba8ad2c
[2014-07-24 15:14:53 -0400] jonlives: mbianco__: it might be better to describe the errors you're getting
[2014-07-24 15:16:13 -0400] ostrev: hello guys.. i have wrapper recipe called install_golang.rb that depends on NOX37s golang and ive tried to do node.override[go][version] = 1.3
[2014-07-24 15:16:24 -0400] ostrev: but no luck im kinda stumped
[2014-07-24 15:16:28 -0400] thom: ls
[2014-07-24 15:16:30 -0400] thom: feh
[2014-07-24 15:17:02 -0400] ostrev: excuse thats NOX73.
[2014-07-24 15:18:03 -0400] tomduffield: mbianco__ have you taken a look at learnchef.com?
[2014-07-24 15:18:46 -0400] tomduffield: if you're new to chef thats what I'd recommend going through
[2014-07-24 15:19:52 -0400] tomduffield: chandra is this open source or enterprise chef?
[2014-07-24 15:21:04 -0400] zanshin: Does anyone have a good working Vagrantfile that uses chef-client as the provisioner? Maybe a helpful gist? I keep getting `/Applications/Vagrant/embedded/gems/gems/i18n-0.6.9/lib/i18n/core_ext/hash.rb:4:in `fetch': key not found: :retries (KeyError)` errors and I'm not sure why
[2014-07-24 15:21:50 -0400] tomduffield: zanshin alternatively, we may be able to help you find the bug in your Vagrantfile if you're able to share it
[2014-07-24 15:24:19 -0400] zanshin: tomduffield: Here you go. https://gist.github.com/zanshin/ef25b61fb9ad144b47ea
[2014-07-24 15:26:53 -0400] tomduffield: zanshin - https://gist.github.com/zanshin/ef25b61fb9ad144b47ea#file-vagrantfile-L27 - should this be chef.run_list?
[2014-07-24 15:29:13 -0400] tomduffield: also, are you using the latest version of vagrant?
[2014-07-24 15:29:50 -0400] zanshin: vargrant version 1.6.3
[2014-07-24 15:30:55 -0400] zanshin: I added a comment to the gist with the error I get, even with `chef.run_list`. I decided this morning to switch from chef-solo to chef-client in Vagrant to allow me to better use our roles in testing new cookbooks.
[2014-07-24 15:31:12 -0400] zanshin: Not as straight-forward as I had hoped
[2014-07-24 15:32:25 -0400] tomduffield: you should be able to use roles with chef-solo
[2014-07-24 15:32:46 -0400] zanshin: Pulled from chef server? Cool.
[2014-07-24 15:32:54 -0400] tomduffield: no, locally
[2014-07-24 15:33:06 -0400] tomduffield: if you have the roles locally, you can use them
[2014-07-24 15:33:40 -0400] zanshin: Each of our cookbooks is its own git repo. Roles and Environments and Data bags are all in a "chef-data" repo elsewhere.
[2014-07-24 15:34:34 -0400] tomduffield: okay - so this Vagrantfile is where? With the cookbook?
[2014-07-24 15:34:48 -0400] zanshin: Yes.
[2014-07-24 15:35:05 -0400] tomduffield: and what is it being used for? testing?
[2014-07-24 15:35:35 -0400] zanshin: Typically all of our homegrown cookbooks have their own Vagrantfile. Primarily used for testing prior to moving it to the Chef Server.
[2014-07-24 15:36:02 -0400] zanshin: Faster to develop/debug/iterate locally than thru chef-server
[2014-07-24 15:36:10 -0400] tomduffield: yep, totally with you there
[2014-07-24 15:36:25 -0400] tomduffield: so my question would be why you are using roles in your run list then
[2014-07-24 15:36:46 -0400] tomduffield: since the roles are stored with the chef-data repo
[2014-07-24 15:37:37 -0400] zanshin: We have a base role for all our nodes that sets up a bunch of stuff. I was curious if I could mangle the Vagrantfile so that it used that role too, to make the local testing more closely resemble what'll actually happen when it's on the chef server
[2014-07-24 15:38:09 -0400] tomduffield: right, okay
[2014-07-24 15:38:17 -0400] tomduffield: makes sense
[2014-07-24 15:39:01 -0400] zanshin: Mostly it's a rabbit whole that's keeping me from actually having to do "real" work. :)
[2014-07-24 15:40:21 -0400] tomduffield: so when I approach this type of testing, I try to differentiate between what it is that I a testing
[2014-07-24 15:40:37 -0400] tomduffield: in your cookbook repo, I would argue that you want to limit your testing to the cookbook itself
[2014-07-24 15:41:06 -0400] zanshin: Probably a good idea. I can't really disagree with that statement
[2014-07-24 15:41:18 -0400] tomduffield: if you want to do more holistic testing, i would maybe put a Vagrantfile in the chef-data directory
[2014-07-24 15:41:22 -0400] tomduffield: and maybe use multiple machines
[2014-07-24 15:41:33 -0400] tomduffield: here is an example of that: https://github.com/tduffield/dockercon2014-demo/blob/master/Vagrantfile
[2014-07-24 15:42:10 -0400] zanshin: Very nice.
[2014-07-24 15:42:22 -0400] tomduffield: I would avoid local testing against a chef server
[2014-07-24 15:42:32 -0400] tomduffield: because it requires you to upload your data to the chef server
[2014-07-24 15:42:41 -0400] tomduffield: which is...non-optimal
[2014-07-24 15:43:34 -0400] tomduffield: what I do is keep all my chef data, both the cookbook repos and chef-data repos, in a predictable location. when working with your teams, you can have them put all their repos in a single folder
[2014-07-24 15:43:46 -0400] tomduffield: this way you are all following the same relative path
[2014-07-24 15:43:54 -0400] tomduffield: and can use environment variables for pathing
[2014-07-24 15:44:18 -0400] tomduffield: CHEF_DIRS=/home/user/chef-stuff
[2014-07-24 15:44:33 -0400] zanshin: Yeah  we need to be better about having our individual workstations setup the same way
[2014-07-24 15:44:42 -0400] tomduffield: then inside your vagrantfile you can do stuff like chef.roles_path = "#{ENV['CHEF_DIRS']}/roles"
[2014-07-24 15:45:01 -0400] zanshin: I like that idea
[2014-07-24 15:45:23 -0400] tomduffield: it requires everyone on the team to follow the same processes
[2014-07-24 15:45:43 -0400] tomduffield: and not a great practice for publicly shared cookbooks
[2014-07-24 15:45:53 -0400] tomduffield: but for private homegrown cookbooks unique to you, its a workable solution
[2014-07-24 15:46:18 -0400] zanshin: Sounds like what I ought to promote here. Thanks Tom :)
[2014-07-24 15:46:55 -0400] tomduffield: yw
[2014-07-24 15:47:00 -0400] tomduffield: good luck!
[2014-07-24 15:47:14 -0400] zanshin: Thanks.
[2014-07-24 15:48:44 -0400] teshian: I am getting The system cannot find the batch label specified - Version6.3 when trying to bootstrap a windows 2012 R2 machine KNIFE-354 says that it was fixed in 2013, thoughts?
[2014-07-24 16:00:28 -0400] heathsnow: haven't seen that one teshian
[2014-07-24 16:00:45 -0400] teshian: I have an old gem installed
[2014-07-24 16:18:39 -0400] dillburger: Why would I get a "File does not exist" error on my :delete action when I have an only_if file exists in the statement, would appreciate some learn smacked upon me: http://fpaste.org/120521/40621846/ (note this is on a nfs filesystem)
[2014-07-24 16:31:18 -0400] btm: dillburger: you shouldn't need the only_if, as the delete action is idempotent.
[2014-07-24 16:31:24 -0400] heathsnow: why do some cookbooks have attributes listed in the metadata file?  for instance:  git@github.com:opscode-cookbooks/sudo.git
[2014-07-24 16:31:38 -0400] heathsnow: does it serve any purpose?
[2014-07-24 16:32:18 -0400] btm: heathsnow: mostly a form of documentation. there have been some 3rd party interfaces that have parsed it for shiny-er documentation in the past.
[2014-07-24 16:33:34 -0400] btm: dillburger: that said, you need to wrap your only_if code in a block, i.e.: only_if { File.exist?('/home/sgeadmin/lockfile') }
[2014-07-24 16:34:35 -0400] btm: dillburger: http://docs.opscode.com/chef/resources.html#guards
[2014-07-24 16:37:10 -0400] dillburger: btm: thanks, I will do that.
[2014-07-24 16:48:18 -0400] keftes: is there any way to make knife search a bit less versbose ? I just need to feed a text file with the node names that belong to an environment
[2014-07-24 16:48:22 -0400] keftes: knife search node "chef_environment:_default" = too much info
[2014-07-24 16:48:56 -0400] thom: keftes: -i
[2014-07-24 16:50:54 -0400] keftes: thatts kind of the opposite - more than the default info
[2014-07-24 16:51:02 -0400] keftes: i just need the node names
[2014-07-24 16:51:36 -0400] thom: keftes: ok, so can i recommend you look at knife search --help and in particular the docs for -a
[2014-07-24 16:51:57 -0400] keftes: yeah that's what i'm looking at
[2014-07-24 16:52:39 -0400] thom: and fwiw -i shows the node name, so you'll probably want to use -a fqdn or similar
[2014-07-24 16:54:40 -0400] keftes: correct - i was parsing it as an L .... thx
[2014-07-24 17:09:26 -0400] dcparker: i'm seeing some weirdness with one of my directory creations. I have something like  node["foo"]["data_dir"].each do |dir|  directory dir do. the first chef run it creates the directory, but doesn't set the user/group. the second time it sets it properly. is there something I might be doing wrong?
[2014-07-24 17:09:41 -0400] dcparker: i can post the full code if needed
[2014-07-24 17:14:05 -0400] Wynn: Hi chefs! Quick question for you all: If I want to find out which user edited an environment, which log files should I comb through?
[2014-07-24 17:14:48 -0400] Wynn: someone broke something in my chef environment and I need to figure out who did it
[2014-07-24 17:15:51 -0400] Eulipion: git blame?
[2014-07-24 17:16:28 -0400] Wynn: something like that
[2014-07-24 17:17:23 -0400] Eulipion: chef doesnt track who did what, u need to figure out a way enforce that everything goes through version control
[2014-07-24 17:17:37 -0400] Wynn: ah, I see
[2014-07-24 17:17:47 -0400] Wynn: darn =(
[2014-07-24 17:18:26 -0400] rbowlby: encrypted databags question: what's the preferred method of getting the shared secret onto the node?
[2014-07-24 17:18:29 -0400] Eulipion: ive been in that situation before, and clobbered whatever wasnt checked in.  if its not checked in, its negative work
[2014-07-24 17:18:41 -0400] Wynn: ah, I see
[2014-07-24 17:18:54 -0400] gchristensen: rbowlby: most people just copy the secret in during provisioning
[2014-07-24 17:19:25 -0400] rbowlby: what about in vagrant with test-kitchen?
[2014-07-24 17:19:37 -0400] double_p: Eulipion: Wynn: well, you can somewhat get a clue from the API calls via nginx logs
[2014-07-24 17:19:42 -0400] Eulipion: rbowlby: you can add it to your knife config. secret_file "~/.chef/encrypted_data_bag_secret"
[2014-07-24 17:19:58 -0400] Wynn: OK, thanks Eulipion~
[2014-07-24 17:20:11 -0400] rbowlby: Eulipion, test-kitchen will make use of that?
[2014-07-24 17:20:26 -0400] Eulipion: not sure, im very new to TK
[2014-07-24 17:20:28 -0400] Wynn: double_p: Let me give that one a try
[2014-07-24 17:20:32 -0400] Wynn: thanks guys!
[2014-07-24 17:20:56 -0400] jordane: rbowlby: in your tk config, you can set encrypted_data_bag_secret_key_path
[2014-07-24 17:21:02 -0400] jordane: to point to a secret key to use
[2014-07-24 17:21:13 -0400] rbowlby: perfect! thanks Jordane
[2014-07-24 17:21:28 -0400] jordane: rbowlby: np :)
[2014-07-24 17:21:46 -0400] rbowlby: what is the secret_file in the knife used for? Is that just for auto decryption when using knife to modify a databag?
[2014-07-24 17:21:57 -0400] rbowlby: or is it also utilized by bootstrap or anything?
[2014-07-24 17:22:35 -0400] jonlives: Wynn: we use knife-spork, which has wrapper commands for role / databag / env changes...people have to *use* them, but if they do it helps :)
[2014-07-24 17:23:53 -0400] Wynn: jonlives: hmmthat sounds promising for down the road. I'll look into it. Thanks! =)
[2014-07-24 17:23:59 -0400] jonlives: np :)
[2014-07-24 17:24:09 -0400] double_p: nginx logging still can reveal clues :)
[2014-07-24 17:25:12 -0400] Wynn: double_p: yes, unfortunately, my log rotations deleted my nginx logs from that time =(
[2014-07-24 17:25:20 -0400] gchristensen: certainly don't ask #nginx any questions unless you've carefully checked your logs, they'll eat you alive!
[2014-07-24 17:25:29 -0400] Wynn: Next time it happens again, I'll have to take a copy of those logs
[2014-07-24 17:27:19 -0400] double_p: Wynn: roll some rotated-archiving-to-central-place via chef ;-) (or use syslog/elastisearch/... in first place) - just sayin. post mortem / after the fact is always easy to brag :)
[2014-07-24 17:27:42 -0400] Wynn: lol, yeah. That's a good idea
[2014-07-24 17:28:22 -0400] double_p: should 'streamline' this backup-pullpush.rb thingy and gist it the other day
[2014-07-24 17:38:35 -0400] rbowlby: is it customary to add my /etc/chef/encrypted_data_bag_secret to an ec2 instance via cloud-init/user-data
[2014-07-24 17:38:57 -0400] rbowlby: perhaps using a wget from an S3 instance or something?
[2014-07-24 17:39:06 -0400] rbowlby: this e-bag stuff feels janky
[2014-07-24 17:39:39 -0400] shlant: jtimberman: any idea if the unicorn cookbook supports zero downtime deploys?
[2014-07-24 17:40:33 -0400] jtimberman: shlant: uhm, maybe?
[2014-07-24 17:41:22 -0400] rbowlby: can anyone sanity check my use of cloud-init to get the shared secret onto a new ec2 instance?
[2014-07-24 17:41:24 -0400] shlant: jtimberman: actually I guess I can jsut manually add the necessary before/after_fork code
[2014-07-24 17:43:11 -0400] doug1: apparently this syntax is wrong... notifies :reload, "service[nscd], service[nslcd], service[sssd]", :delayed .... what would be the correct syntax?
[2014-07-24 17:44:29 -0400] doug1: oh. stated multiple times
[2014-07-24 17:44:30 -0400] jtimberman: doug1: each would be a separate notifies.
[2014-07-24 17:44:37 -0400] doug1: jtimberman: thanks, just found that
[2014-07-24 17:45:05 -0400] jtimberman: you could also iterate over an array of servicenames.
[2014-07-24 17:45:46 -0400] doug1: jtimberman: inside the (in this case) remote_directory resource?
[2014-07-24 17:45:56 -0400] jtimberman: ["nscd", "nslcd", "sssd"].each do {|svc| notifies :reload "service[#{svc}]"}
[2014-07-24 17:45:58 -0400] jtimberman: yup
[2014-07-24 17:46:07 -0400] doug1: nifty
[2014-07-24 17:46:07 -0400] jtimberman: rubby!
[2014-07-24 17:46:15 -0400] doug1: argh!
[2014-07-24 17:46:20 -0400] double_p: notifies :restart, resources(:service => node[:dhcp][:service_name]), :delayed
[2014-07-24 17:46:21 -0400] jtimberman: (this is why i LOVE chef recipes being ruby)
[2014-07-24 17:46:37 -0400] doug1: i'll stick with for svc in ['a','b','c'] do .... much more readable
[2014-07-24 17:46:42 -0400] jtimberman: double_p: you want to use "service[#{node[:dhcp][:service_name]}]"
[2014-07-24 17:47:00 -0400] jtimberman: doug1: sure, TIMTOWTDI
[2014-07-24 17:47:19 -0400] double_p: jtimberman: not my cookbook :)
[2014-07-24 17:47:33 -0400] jtimberman: double_p: the resources lookup is old and shouldn't be used, the "type[name]" syntax uses the resource notification event system.
[2014-07-24 17:47:40 -0400] jtimberman: double_p: make a PR :)
[2014-07-24 17:48:09 -0400] double_p: right.. latest (c) in it 2012 (and 2011 for opscode)
[2014-07-24 17:49:33 -0400] jblack: jtimberman: Hey, do you a quick moment for a qeustion?
[2014-07-24 17:50:29 -0400] jblack: I'm looking at some bootstrap code for a node, and it 's doing a knife vault update. That tells me that bootstrapped nodes must be set as admin, right?
[2014-07-24 17:50:55 -0400] jblack: (knife vault uses databags, and a node must be admin to modify a data bag, is my thought process). Would that be correct?
[2014-07-24 17:51:21 -0400] jtimberman: yes, but i don't know why someone would knife vault from a node rather than from a management workstation with their user as admin.
[2014-07-24 17:52:15 -0400] jblack: Yeah. They have a some autoscaling in place, and nodes self-bootstrap.
[2014-07-24 17:52:59 -0400] jblack: I'm not quite show how the nodes are getting admin. Perhaps the validation key
[2014-07-24 17:53:04 -0400] jtimberman: no
[2014-07-24 17:53:29 -0400] jtimberman: the validation client only creates a new API client, which can then create itself a new node
[2014-07-24 17:54:53 -0400] jtimberman: jblack: is this an open source chef server?
[2014-07-24 17:55:24 -0400] jtimberman: if it's not - and is hosted / enterprise chef, admin client isn't required to modify data bags with a normal node's api client
[2014-07-24 17:55:33 -0400] jblack: I don't know yet.  However, I suppose it's possible that Read-S3Object -BucketName $s3Bucket -KeyPrefix $s3Folder -Folder "C:\chef" is downloading a pemfile
[2014-07-24 17:55:37 -0400] jblack: Oh, really?
[2014-07-24 17:56:06 -0400] jblack: Ok. That would make more sense than one pemfile shared across nodes (which I'm not sure is even possible)
[2014-07-24 17:57:05 -0400] jblack: That seems dangerous to me, that any valid  node can edit data bags
[2014-07-24 17:57:57 -0400] cheeseprocedure: rbowlby: we use EC2 IAM roles to grant instances rights to specific S3 resources. encryption keys are fetched by a hack-ish cookbook which in turn uses s3_file (https://github.com/adamsb6/s3_file)
[2014-07-24 17:58:30 -0400] evvel2: cheeseprocedure: I do the same, not pretty but gets the job done
[2014-07-24 17:58:47 -0400] cheeseprocedure: evvel2: phew! it made me feel dirty for the longest time :)
[2014-07-24 17:58:57 -0400] jblack: that's what they're doing here as well.
[2014-07-24 17:59:01 -0400] rbowlby: cheeseprocedure, perfect thanks
[2014-07-24 17:59:09 -0400] coderanger: citadel does the same thing, though possibly more cleanly :)
[2014-07-24 17:59:14 -0400] jblack: it just threw me that I saw nodes changing data bags.
[2014-07-24 18:00:07 -0400] cheeseprocedure: coderanger: citadel is on my to-do :) i'd love to be slurping pre-generated files out of s3 instead. sadly that'll take some work by people who aren't me
[2014-07-24 18:02:18 -0400] coderanger: kallistec: Lol, setting subjectaltname using openssl is hilariously terrible
[2014-07-24 18:02:45 -0400] kallistec: coderanger: it's either that or wildcard certs though, right?
[2014-07-24 18:02:55 -0400] kallistec: which aren't exactly equivalent
[2014-07-24 18:02:59 -0400] coderanger: kallistec: Or just only use the cname
[2014-07-24 18:03:42 -0400] kallistec: coderanger: then the user whould have to split-horizon their own DNS, right?
[2014-07-24 18:03:47 -0400] coderanger: kallistec: Yeah
[2014-07-24 18:04:09 -0400] cheeseprocedure: rbowlby: https://gist.github.com/anonymous/6bcb754083f810d450df - this snippet works on EC2 instances granted rights to the relevant S3 resources via IAM role
[2014-07-24 18:05:25 -0400] rbowlby: cheeseprocedure: lulz at file name
[2014-07-24 18:05:31 -0400] rbowlby: thanks
[2014-07-24 18:05:55 -0400] rbowlby: this is better than putting it in the cloud-init script
[2014-07-24 18:06:09 -0400] cheeseprocedure: rbowlby: you're welcome! i hope it helps
[2014-07-24 18:06:20 -0400] cheeseprocedure: yeah, user-data is static and a pain for this sort of thing
[2014-07-24 18:06:42 -0400] coderanger: rbowlby: Or citadel+cheffish :)
[2014-07-24 18:07:00 -0400] cheeseprocedure: TIL about cheffish
[2014-07-24 18:07:02 -0400] coderanger: (assuming thats a bag encryption key)
[2014-07-24 18:07:23 -0400] coderanger: but best way is packer to bake the key in to the AMI ahead of time
[2014-07-24 18:07:49 -0400] cheeseprocedure: coderanger: what exactly is cheffish for?
[2014-07-24 18:08:08 -0400] coderanger: cheeseprocedure: Changing chef's configuration from inside a recipe
[2014-07-24 18:08:14 -0400] cheeseprocedure: wild.
[2014-07-24 18:09:09 -0400] Damm: so did https://github.com/Nordstrom/chef-vault fall out of favor?
[2014-07-24 18:09:49 -0400] coderanger: Damm: No, its still (usually) a better solution than encrypted bags
[2014-07-24 18:09:57 -0400] Damm: coderanger, it's encrypted
[2014-07-24 18:10:05 -0400] Damm: it's just a whole workflow
[2014-07-24 18:10:20 -0400] coderanger: but it 1) uses data bags which still sucks 2) can't work with any kind of autoscaling or self-healing systems
[2014-07-24 18:10:39 -0400] coderanger: Damm: Yes, very different encryption than "chef encrypted data bags" though
[2014-07-24 18:10:41 -0400] Damm: 2) is a hard road; you'll find lots of copouts before your happy
[2014-07-24 18:10:48 -0400] cheeseprocedure: Damm: unless anything has changed, it introduced some external provisioning-related problems - we had to ensure autoscaling nodes were granted necessary access
[2014-07-24 18:10:50 -0400] Damm: and 1) encryption is really the only way
[2014-07-24 18:10:58 -0400] coderanger: Damm: No, citadel is another option
[2014-07-24 18:11:01 -0400] coderanger: (and things like it)
[2014-07-24 18:11:13 -0400] Damm: yeah i've done the citadel pattern before
[2014-07-24 18:11:15 -0400] Damm: yuck
[2014-07-24 18:11:23 -0400] Damm: I mean it's better than y
[2014-07-24 18:11:25 -0400] Damm: but still
[2014-07-24 18:11:37 -0400] coderanger: Damm: secrets management is Hard
[2014-07-24 18:11:47 -0400] Damm: databags + encrypted secrets are a lot better than shipping the secrets before running chef
[2014-07-24 18:11:57 -0400] Damm: or shipping your secrets in cookbook_file
[2014-07-24 18:12:05 -0400] Damm: that's my favorite way to ruin your encryption
[2014-07-24 18:12:32 -0400] coderanger: Damm: Yes, but then you have to manage the encryption keys, and as noted with this discussion thats Really Hard
[2014-07-24 18:12:54 -0400] Damm: nah, it's just really fraught with stupidity
[2014-07-24 18:12:55 -0400] Damm: not hard
[2014-07-24 18:13:04 -0400] coderanger: In this case, rbowlby is delegating to a trusted third party (AWS API) to handle identity and key management
[2014-07-24 18:13:31 -0400] Damm: yeah and like S3 never screws up
[2014-07-24 18:13:37 -0400] Damm: content never gets mangled by accident /ever/
[2014-07-24 18:14:11 -0400] coderanger: Damm: The critical point is that AWS has the certs required so if they share data that shuld be IAM-restricted, I'm not liable :)
[2014-07-24 18:15:10 -0400] coderanger: But yes, using S3+IAM is a fallback at best, I'm hopeful that Barbican might take its place eventually
[2014-07-24 18:15:11 -0400] Damm: have you ever had Amazon reset the permissions on a bucket to global read?
[2014-07-24 18:15:11 -0400] Damm: I have
[2014-07-24 18:15:15 -0400] Damm: it really sucked
[2014-07-24 18:15:17 -0400] JoshZ_: Is anyone using chef-metal with jenkins for testing or deploymnet?
[2014-07-24 18:15:24 -0400] cheeseprocedure: Damm: securitymonkey to the rescue?
[2014-07-24 18:15:25 -0400] Damm: no it wasn't a user
[2014-07-24 18:15:34 -0400] coderanger: Damm: Citadel doesn't use the bucket perms, its IAM based
[2014-07-24 18:15:34 -0400] Damm: it was a bug in the bucket that caused it
[2014-07-24 18:15:53 -0400] Damm: coderanger, nah the bucket itself was global and the bucket perms can get iam permissions
[2014-07-24 18:15:56 -0400] cheeseprocedure: Damm: so the AWS API's description of the resource did not match reality?
[2014-07-24 18:15:59 -0400] coderanger: And no, I've not even had an IAM policy file spontaneously revent
[2014-07-24 18:16:03 -0400] Damm: so the api screwed up in this case
[2014-07-24 18:16:25 -0400] Damm: (due to bucket error policies were not applied correctly and had to contact support to fix as well as manually revert the permissions)
[2014-07-24 18:16:35 -0400] Damm: it reallly blew
[2014-07-24 18:17:28 -0400] coderanger: Well like I said, according to PCI, I wouldn't be liable in that case, which is about the best you can hope for when it comes to secrets management
[2014-07-24 18:17:47 -0400] coderanger: JoshZ_: I've not heard of any, test-kitchen generally handles that
[2014-07-24 18:18:03 -0400] coderanger: JoshZ_: Though there is some chatter about replacing the cloud drives in TK with metal eventually :)
[2014-07-24 18:19:01 -0400] JoshZ_: coderanger: ok. We are using it right now and it works GREAT.... But the log/console output doesnt show the same way it does when running locally... so I wanted to find out if anyone knew how to play with that.
[2014-07-24 18:19:07 -0400] JoshZ_: coderanger: thank you!
[2014-07-24 18:19:21 -0400] nulleric: I have a service "x" do action :start end, but chef thinks it's already started, even though sudo service x status says stopped
[2014-07-24 18:20:39 -0400] coderanger: nulleric: Is that the whole resource?
[2014-07-24 18:20:50 -0400] coderanger: nulleric: You probably want to have the status support enabled
[2014-07-24 18:21:04 -0400] coderanger: nulleric: Otherwise it falls back to scanning for any process named "x" running
[2014-07-24 18:21:16 -0400] nulleric: i just tried   supports [:start, :stop, :restart, :status]
[2014-07-24 18:21:26 -0400] nulleric: hmm
[2014-07-24 18:22:18 -0400] nulleric: https://www.irccloud.com/pastebin/VREeZbht
[2014-07-24 18:22:37 -0400] nulleric: wonder if thats the issue, it says stopped but exits with 0
[2014-07-24 18:22:54 -0400] nulleric: (on centos6 btw)
[2014-07-24 18:23:32 -0400] rbowlby: nulleric, that's the issue
[2014-07-24 18:23:39 -0400] rbowlby: bad init script
[2014-07-24 18:24:12 -0400] rbowlby: happens pretty often, you can change the init or change the process table lookup pattern to an appropriate one
[2014-07-24 18:24:59 -0400] double_p: yeah, the gazillionst sh-wrapper and on the course the "real" exit-code is lost
[2014-07-24 18:25:05 -0400] double_p: had that with jboss lately
[2014-07-24 18:25:14 -0400] nulleric: ahh, cool, ya a custom init for a custom tomcat app
[2014-07-24 18:25:28 -0400] nulleric:   status) status $SERVICENAME
[2014-07-24 18:25:30 -0400] nulleric: thats kinda odd
[2014-07-24 18:27:12 -0400] nulleric: ahh thats a function in /etc/rc.d/init.d/functions
[2014-07-24 18:27:17 -0400] nulleric: ok getting somwhere :)
[2014-07-24 18:27:38 -0400] coderanger: nulleric: Just use upstart or systemd or something else that sucks less :)
[2014-07-24 18:30:01 -0400] nulleric: haha, ya, this was an easy fix, it just wasn't exiting after checking the status
[2014-07-24 18:30:18 -0400] nulleric: vendor script, will just add exit $?
[2014-07-24 18:30:49 -0400] double_p: coderanger: suck less and systemd... E_DAVE :P
[2014-07-24 18:31:10 -0400] coderanger: double_p: being less terrible than sysv init is a low bar
[2014-07-24 18:31:18 -0400] coderanger: very very low
[2014-07-24 18:31:25 -0400] double_p: well.. :]
[2014-07-24 18:35:21 -0400] shlant: can someone help me understand ELB? If I have SSL term on app servers with nginx, and 80 redirect to 443 in nginx, what should my listeners be on the ELB?
[2014-07-24 18:43:10 -0400] nulleric: any recommendations on a solr cookbook?
[2014-07-24 18:44:51 -0400] coderanger: shlant: ELB is just hosted HAProxy
[2014-07-24 18:49:34 -0400] Pursuit: is there any way to get "knife data bag edit" to present the json with some line breaks/formatting? I get it all on one line. The json for "node edit" is fine and more along the lines of what I'd like to see for data bags
[2014-07-24 18:50:08 -0400] derks: hello... for some reason my 'default_attributes' in a role are overriding my 'override_attributes' in an environment
[2014-07-24 18:50:11 -0400] derks: that doesn't seem right
[2014-07-24 18:50:45 -0400] coderanger: derks: Indeed, that isn't happening, likely something else :)
[2014-07-24 18:51:11 -0400] coderanger: Pursuit: I don't think so, you can do it yourself with an editor though
[2014-07-24 18:51:31 -0400] ev0ldave: last time i had that issue, there was an accidental copy of env default att in env override
[2014-07-24 18:51:55 -0400] derks: coderanger i moved my firewall rules from 'default_attributes' in my 'staging' environment, to 'override_attributes' .. and the roles 'default_attributes' are the applied rules
[2014-07-24 18:51:58 -0400] derks: doesn't make sense
[2014-07-24 18:53:02 -0400] coderanger: derks: 1) are you sure the node is in the environment you think it is 2) are you sure you uploaded the new environment?
[2014-07-24 18:53:45 -0400] derks: yeah... but I just noticed that I have an empty "override_attributes" in all of my roles... and I assume that is wiping the environments overrides out.
[2014-07-24 18:53:48 -0400] derks: re-running now
[2014-07-24 18:54:29 -0400] ev0ldave: that wont wipe them out
[2014-07-24 18:55:31 -0400] coderanger: derks: It all gets merged together
[2014-07-24 18:55:54 -0400] derks: well then.. no idea why my environments override_attributes are ignore then
[2014-07-24 18:57:23 -0400] nowthatsamatt: can i have an invite to #learnchef?
[2014-07-24 19:00:05 -0400] ev0ldave: also, make sure you didn't embed your override into another attribute
[2014-07-24 19:00:21 -0400] ev0ldave: i've had that happen too, took an hour to find it
[2014-07-24 19:12:07 -0400] doug1: It sort of looks like, from the client output, that this http://pastebin.com/41nScwim is making the services restart after every run, even when the files aren't modified. How do I only have the services restarted if the files are updated?
[2014-07-24 19:12:49 -0400] Damm:    mode 00600
[2014-07-24 19:12:51 -0400] Damm: lol
[2014-07-24 19:13:21 -0400] doug1: ?
[2014-07-24 19:13:34 -0400] coderanger: nowthatsamatt: It has been mostly shut down in favor of questions being asked here
[2014-07-24 19:13:49 -0400] coderanger: derks: Check the two things I mentioned
[2014-07-24 19:14:10 -0400] derks: coderanger, yes to both
[2014-07-24 19:14:53 -0400] coderanger: derks: What do you see for `knife environment show staging -Fj`?
[2014-07-24 19:17:06 -0400] derks: coderanger 1 sec
[2014-07-24 19:18:22 -0400] derks: coderanger, i just updated my environment from file... and in Chef server it is not showing my override_attributes
[2014-07-24 19:18:25 -0400] derks: like its not saving it
[2014-07-24 19:18:50 -0400] coderanger: derks: Okay, so thats likely the issue, please pastebin the env file
[2014-07-24 19:21:21 -0400] derks: coderanger, lots of internal stuff in here ... 1sec
[2014-07-24 19:22:17 -0400] coderanger: derks: Just check your formatting it all correct and that override_attributes is spelled correctly
[2014-07-24 19:24:43 -0400] mr_proper: Hi Folks - Wed like to be able to keep the configuration we use to spin up our VMs with in source control. Is it possible to run knife ec2 create from an input file?
[2014-07-24 19:24:49 -0400] derks: coderanger... literally moving my 'firewall' section of JSON from default_attributes to override_attributes ... and it dissappear in environment show staging
[2014-07-24 19:25:08 -0400] mr_proper: (Moving from Salt, and salt-cloud let us pass in a map file to describe the sort of instance we want)
[2014-07-24 19:25:11 -0400] derks: like something else somewhere is overriding environment
[2014-07-24 19:25:14 -0400] coderanger: derks: Okay, well if you can pastebin I can look and see if there are formatting issues
[2014-07-24 19:25:36 -0400] doug1: It sort of looks like, from the client output, that this http://pastebin.com/41nScwim is making the services restart after every run, even when the files aren't modified. How do I only have the services restarted if the files are updated?
[2014-07-24 19:25:38 -0400] STRML: Is there some sort of problem with using current_path in before_restart.rb?
[2014-07-24 19:25:46 -0400] coderanger: mr_proper: You might want to look in to cloudformation or chef-metal, but if you just want something simple, spiceweasel is that
[2014-07-24 19:25:53 -0400] STRML: I'm using it in a `bash` block and getting "undefined method `current_path' for Chef::Resource::Bash "
[2014-07-24 19:26:10 -0400] coderanger: STRML: Really really don't use the deploy resource
[2014-07-24 19:26:12 -0400] phelms2: Hey - I was looking at the "reboot_pending?" function shown > https://github.com/opscode/chef/blob/master/lib/chef/dsl/reboot_pending.rb#L31 .. I was going to add a check for centos to see if I am running the latest kernal or not. ... unless anyone has a better idea for Centos?
[2014-07-24 19:26:27 -0400] STRML: coderanger: on opsworks... not much of a choice
[2014-07-24 19:26:40 -0400] coderanger: STRML: Just use a git resource and normal executes et al
[2014-07-24 19:26:42 -0400] STRML: coderanger: stacktrace clearly shows `current_path` in scope
[2014-07-24 19:26:44 -0400] derks: coderanger, i'm a fucking retard... there was a second 'override_attributes' at the bottom of the file ... oh my fuck!
[2014-07-24 19:27:00 -0400] coderanger: STRML: The callbacks for the deploy resource are super magic, the scope is not what you think
[2014-07-24 19:27:06 -0400] STRML: yeah, I was getting that feeling
[2014-07-24 19:27:08 -0400] coderanger: derks: That would do it
[2014-07-24 19:27:12 -0400] STRML: do you have any idea what's in scope?
[2014-07-24 19:27:17 -0400] coderanger: STRML: Almost nothing
[2014-07-24 19:27:20 -0400] double_p: derks: oh, i love TAHT stuff. coworker constantly traps over this in data bags
[2014-07-24 19:27:24 -0400] STRML: hahaha okay.
[2014-07-24 19:27:30 -0400] STRML: well that's totally useless and not fun
[2014-07-24 19:27:31 -0400] coderanger: STRML: You can construct closures, but really don't
[2014-07-24 19:28:01 -0400] STRML: it appears I can use some things, like `user` and `group`... so close to finishing this deploy, would really like to figure it out. is there a way to print the current scope to log?
[2014-07-24 19:28:25 -0400] coderanger: STRML: No, ruby doesn't have a formal concept of current scope
[2014-07-24 19:28:33 -0400] coderanger: Its all just message passing
[2014-07-24 19:28:43 -0400] STRML: sometimes I think I should just use bash scripts and AMIs, this is a nightmare
[2014-07-24 19:29:07 -0400] coderanger: STRML: Like I said, use a git resource and normal chef code
[2014-07-24 19:29:11 -0400] coderanger: you'll be much happier
[2014-07-24 19:29:23 -0400] STRML: I would like to. but I don't want to rewrite the entire deploy and opsworks is not particularly flexible
[2014-07-24 19:29:37 -0400] coderanger: That part I can't help you with :)
[2014-07-24 19:29:58 -0400] STRML: yeah it's okay. I guess I need to trace down where before_restart is called and try to get a handle on what it has
[2014-07-24 19:30:03 -0400] STRML: what a pain. thanks
[2014-07-24 19:30:57 -0400] coderanger: STRML: Don't do it that way, use closures
[2014-07-24 19:31:11 -0400] STRML: well, I have different requirements for different apps
[2014-07-24 19:31:14 -0400] coderanger: STRML: local variables are lexically scoped, so just assign stuff to locals before the block and use them
[2014-07-24 19:31:17 -0400] STRML: which are deployed with the same recipe
[2014-07-24 19:31:30 -0400] STRML: so these hooks would be perfect. if they worked
[2014-07-24 19:32:06 -0400] coderanger: STRML: Sorry, not really an option
[2014-07-24 19:32:30 -0400] coderanger: STRML: You'll have to rewrite that chunk of the recipe
[2014-07-24 19:32:52 -0400] coderanger: Use an LWRP to refactor the shared bits, but use different recipes for each app
[2014-07-24 19:33:48 -0400] STRML: the complexity behind all this stuff is absolutely maddening
[2014-07-24 19:33:59 -0400] coderanger: STRML: yep, hence saying you shouldn't use any of it :)
[2014-07-24 19:34:05 -0400] coderanger: Its demonstrably worse
[2014-07-24 19:34:19 -0400] STRML: yeah. opsworks definitely feels like a house of cards
[2014-07-24 19:35:06 -0400] coderanger: This isn't really related to opsworks, other than that they document and encourage terribad ways of using chef
[2014-07-24 19:35:27 -0400] STRML: do you have any idea why the scope in these file callbacks is so messed up? what could possibly be the reasoning for that... or is it not intentional
[2014-07-24 19:35:47 -0400] mr_proper: ^ thanks guys
[2014-07-24 19:36:37 -0400] coderanger: STRML: Yes I have an idea, but its a long story
[2014-07-24 19:36:51 -0400] coderanger: STRML: The callbacks system for the deploy resource is very very old code
[2014-07-24 19:37:17 -0400] STRML: it's bizarre... at least according to AWS documentation, this is "the way" to insert custom hooks per app before migrate, restart, etc
[2014-07-24 19:37:24 -0400] STRML: and it's completely broken, and nobody says anything.
[2014-07-24 19:37:36 -0400] coderanger: The deploy resource in general hasn't be developed since it was written except for some rollback fixes by kallistec, it was added for Capistrano compat which turns out to have just been a bad idea to start with
[2014-07-24 19:37:47 -0400] coderanger: STRML: I say it frequently, ask anyone that hangs out in here ;-)
[2014-07-24 19:37:58 -0400] STRML: haha I haven't been in here much.
[2014-07-24 19:38:54 -0400] STRML: agh. they really are terrible recipes. `npm install` occasionally gets called more than once, and deploys sometimes throw different errors
[2014-07-24 19:39:23 -0400] STRML: and running it again will throw a different error. *headdesk*
[2014-07-24 19:40:00 -0400] kallistec: Yeah, the full history is that Engine Yard was a very early adopter of and contributor to Chef (like in the 0.5 and 0.6 versions), and they made the deploy resource by directly importing capistrano code for their cloud platform
[2014-07-24 19:40:34 -0400] kallistec: I wanted git and svn resources, which they already had code for, so I made the whole thing more chef-y
[2014-07-24 19:40:58 -0400] STRML: this appears to be a better explanation of what is going on. https://support.cloud.engineyard.com/entries/21016568-Use-Ruby-Deploy-Hooks
[2014-07-24 19:41:06 -0400] kallistec: and reimplemented deploy in terms of the git and svn resources I'd extracted
[2014-07-24 19:43:27 -0400] coderanger: but still a tangled mess of pseudo-capistrano-compat code
[2014-07-24 19:48:55 -0400] Damm: STRML, be aware that Engine Yard uses an old deploy resource they made
[2014-07-24 19:49:16 -0400] Damm: strictlyb, about 2011 or so they moved away from using Chef to deploy to writing their own adapter to run the hooks
[2014-07-24 19:49:28 -0400] Damm: so their documentation on deploy hooks won't be right for current chef (ever)
[2014-07-24 19:49:37 -0400] coderanger: Damm: Not relevant
[2014-07-24 19:50:18 -0400] Damm: lol i remember that documentation
[2014-07-24 19:51:12 -0400] Damm: coderanger, http://signalvnoise.com/posts/2293-on-writing-accentuate-the-positive
[2014-07-24 19:51:24 -0400] Damm: I don't really know how to respond to you anymore so I won't
[2014-07-24 19:51:30 -0400] Damm: always negative
[2014-07-24 19:55:11 -0400] rbowlby: I can't get the damn e-dbags working in test-kitchen with percona to save my life
[2014-07-24 19:57:59 -0400] cheeseprocedure: rbowlby: what's the trouble?
[2014-07-24 19:58:29 -0400] doug1: help? http://pastebin.com/68MXre1y
[2014-07-24 19:58:44 -0400] jmickle: anyone know the nexus cookbok well?
[2014-07-24 19:58:45 -0400] rbowlby: cheeseprocedure: haven't narrowed it down, can't tell if percona just isn't able to do the lookup or if the e-bag isn't appropriatelly made available
[2014-07-24 19:58:51 -0400] jmickle: having a problem with databag naming
[2014-07-24 19:59:49 -0400] doug1: i have no idea what the error in http://pastebin.com/68MXre1y means
[2014-07-24 20:00:50 -0400] coderanger: rbowlby: the log resource is your friend :)
[2014-07-24 20:01:03 -0400] jmickle: coderanger: hey
[2014-07-24 20:01:28 -0400] rbowlby: coderanger, thanks doing that now..out of anger the log lines are getting snippy
[2014-07-24 20:01:54 -0400] coderanger: rbowlby:  is also your friend :)
[2014-07-24 20:02:10 -0400] rbowlby: lol
[2014-07-24 20:02:25 -0400] coderanger: jmickle: Whats the issue?
[2014-07-24 20:02:34 -0400] coderanger: doug1: Look in the solo.rb and find the ruby syntax error
[2014-07-24 20:02:51 -0400] jmickle: i keep getting this error Unable to locate the Nexus encrypted data bag 'nexus' or data bag item nexus_ssl_files
[2014-07-24 20:02:57 -0400] jmickle: though i created a nexus__wildcard
[2014-07-24 20:03:29 -0400] doug1: coderanger: That line just contains "authorization "{:foo=>["A", "B"], :sudo=>{:groups=>nil}}""
[2014-07-24 20:03:37 -0400] doug1: not much of an error there
[2014-07-24 20:03:44 -0400] cocotton: Hey all, from a recipe I'm trying to verify is an attribute is present in a node, yet I'm not sure how to do that. I know I can use <node.attribute?('attribute')>, but what if I have something inside attribute? <node.attribute?('attribute').attribute?('anotherAttribute')> does not seem to work (and look terrible).
[2014-07-24 20:04:00 -0400] coderanger: doug1: I can't tell if you are paraphrasing, but you have incorrectly nested quotes
[2014-07-24 20:04:28 -0400] doug1: coderanger: there are no quotes in the kitchen.yml file there
[2014-07-24 20:04:56 -0400] jordane: doug1: the " before vagrant in the pastebin closes the " before {:sudo
[2014-07-24 20:04:57 -0400] coderanger: doug1: Okay, so go debug it, now you know the issue, vaya con dios
[2014-07-24 20:05:18 -0400] doug1: coderangerL well I would if there was an error in solo.rb, but there is not.
[2014-07-24 20:05:30 -0400] coderanger: cocotton: just if node['attribute']
[2014-07-24 20:05:47 -0400] coderanger: cocotton: In Ruby, a non-existent key is just nil
[2014-07-24 20:05:49 -0400] cheeseprocedure: doug1: might be worth hitting up the #kitchenci channel
[2014-07-24 20:06:04 -0400] coderanger: doug1: I literally just told you the error
[2014-07-24 20:06:08 -0400] doug1: cheeseprocedure:spose, thanks
[2014-07-24 20:06:13 -0400] doug1: coderanger: i literally don't see it
[2014-07-24 20:06:23 -0400] coderanger: doug1: Incorrectly nested quotes
[2014-07-24 20:06:27 -0400] jordane: doug1: do you have ruby syntax highlighting on?
[2014-07-24 20:06:37 -0400] doug1: ccoderanger: generated from syntactically correct yaml in kitchen.yml
[2014-07-24 20:06:57 -0400] cocotton: coderanger: Correct me if I'm wrong, but from what I remember if I try something node['attribute']['aChild']['anotherOne'], if attribute or aChild are inexistant it will return an error rather than a nil
[2014-07-24 20:07:01 -0400] coderanger: doug1: Okay, so maybe there is a bug in TK? Whats your point, go do your job and debug it
[2014-07-24 20:07:13 -0400] coderanger: doug1: If you would like me to debug, I'm happy to quote you my daily rate
[2014-07-24 20:07:35 -0400] coderanger: cocotton: Yeah, if node['foo'] && node['foo']['bar']
[2014-07-24 20:07:35 -0400] doug1: coderanger: thank you. You are a superb human being that I aspire to be just like one day
[2014-07-24 20:08:04 -0400] coderanger: cocotton: Its clunky though, I would set defaults in your cookbook attributes file so you don't need to do that
[2014-07-24 20:08:13 -0400] coderanger: cocotton: even just default['foo']['bar'] = nil
[2014-07-24 20:08:20 -0400] cocotton: coderanger: ahh so unless node['foo'] exists, it will not check for node['foo']['bar']. am I right^
[2014-07-24 20:08:22 -0400] coderanger: cocotton: That will ensure node['foo'] always exists :)
[2014-07-24 20:08:34 -0400] Neozonz: I'm getting no implicit conversion of String into Integer from this block here  >> https://gist.github.com/Neozonz/82e2360fea63daa4339d   any ideas?
[2014-07-24 20:08:38 -0400] coderanger: cocotton: Yes, Ruby does short-circuit evaluation on && and ||
[2014-07-24 20:09:03 -0400] cocotton: coderanger: Yeah the default[...] was in last resort, I don't like to fill my attribute file with things like that :(
[2014-07-24 20:09:04 -0400] coderanger: Neozonz: That usually means you are using a string/array as a hash
[2014-07-24 20:09:21 -0400] coderanger: Neozonz: In this case, instances is probably a hash itself, so instance is a string (the key from the hash)
[2014-07-24 20:09:36 -0400] Neozonz: yup that's correct
[2014-07-24 20:09:59 -0400] coderanger: cocotton: Adding stuff like that is just cost of doing business, a bit of silly boilerplate but it prevents a ton of errors down the line
[2014-07-24 20:10:10 -0400] coderanger: Neozonz: you probably want .each do |name, instance| then
[2014-07-24 20:10:39 -0400] jmickle: hmmm
[2014-07-24 20:10:46 -0400] cocotton: @coderanger Yeah you must be right. Thanks a lot for the help!
[2014-07-24 20:16:26 -0400] rbowlby: alright, getting somewhere I think
[2014-07-24 20:16:41 -0400] rbowlby: looks like the percona cookbook is not aware of the e-bag secret
[2014-07-24 20:16:57 -0400] rbowlby: when I add it as an attr to test-kitchen, what exactly is it doing with that?
[2014-07-24 20:17:08 -0400] rbowlby: is it suppose to make it available in /etc/chef/ or something
[2014-07-24 20:17:30 -0400] rbowlby: lol, wtf does encrypted_data_bag_secret_key_path actually do
[2014-07-24 20:17:46 -0400] zanshin: What's the take on pinning cookbook version to an environment? Pin everything? Just the cookbooks that will cause the biggest impact crater if they change? Something in between?
[2014-07-24 20:19:16 -0400] coderanger: zanshin: There isn't a clear best practice, most advocate pinning everything (akin to pip freeze), others so semver pinning on top-level cookbooks
[2014-07-24 20:19:22 -0400] coderanger: zanshin: Both have downsides
[2014-07-24 20:20:01 -0400] chef549: hey guys, I am wondering how to apply permissions recursively using a recipe that does a git sync
[2014-07-24 20:20:02 -0400] zanshin: We're trying the "pin the world" approach, but it is proving to be a lot of work.
[2014-07-24 20:20:23 -0400] jmickle: code ranger any idea how to tell it to not use a secret key for a data bag?
[2014-07-24 20:20:49 -0400] coderanger: zanshin: That would be the downside of that one
[2014-07-24 20:20:56 -0400] rbowlby: wtf does encrypted_data_bag_secret_key_path actually do
[2014-07-24 20:21:04 -0400] zanshin: coderanger: :)
[2014-07-24 20:21:16 -0400] coderanger: jmickle: Not sure what you mean
[2014-07-24 20:21:31 -0400] jmickle: coderanger: No secret specified to load_secret and no secret found at /etc/chef/encrypted_data_bag_secret
[2014-07-24 20:21:40 -0400] coderanger: rbowlby: Looking over https://github.com/test-kitchen/test-kitchen/blob/a48d5e1c8ddcac6bb60bd61221ce477e8480fe32/lib/kitchen/provisioner/chef_base.rb it looks like it should transfer the file over and configure client.rb
[2014-07-24 20:21:42 -0400] zanshin: That plus two places for changes to start: the github repo where they are versioned or the web interface on the Chef Server
[2014-07-24 20:22:21 -0400] coderanger: zanshin: The downside of the semver pinning strategy is that people have to do releases properly and respect semver for breaking changes
[2014-07-24 20:22:46 -0400] chef549: I am wondering how to apply permissions recursively using a recipe that does a git sync
[2014-07-24 20:23:31 -0400] coderanger: chef549: You can set a user/group on the git resource
[2014-07-24 20:23:53 -0400] chef549: for example, when running the recipe, the files are going under the root '/' directory, but the permissions are 700.  the recipe is as follows:
[2014-07-24 20:23:59 -0400] chef549: git "/testsyncfromgit" do         user "root"         group "manager"         repository "git://github.com/opscode/chef.git"         reference "master"         action :sync end
[2014-07-24 20:24:11 -0400] jmickle: coderanger: for some reason chef thinks i want to use a secret key to load the data bag
[2014-07-24 20:24:25 -0400] jmickle: coderanger: and i didnt specify one at all when creating it and verify its not encrypted
[2014-07-24 20:24:27 -0400] chef549: but when trying mode "0774" is does not work when that same command works under directory
[2014-07-24 20:24:56 -0400] coderanger: chef549: You would need to change the umask, chef can't control the file mode since they are created by git
[2014-07-24 20:25:19 -0400] coderanger: chef549: I'm not sure thats exposed on the git resource though
[2014-07-24 20:25:34 -0400] chef549: a workaround i found is by doing the following:
[2014-07-24 20:25:35 -0400] chef549: execute "setpermissions" do command "chmod -R 775 /testsyncfromgit" end
[2014-07-24 20:26:12 -0400] coderanger: chef549: I wouldn't do it that way
[2014-07-24 20:26:18 -0400] chef549: however, is takes forever because chef doesnt record the permissions that are changes and ach time the script is run, it sets the permissions.. can only imagine how long it would take with many files/sources
[2014-07-24 20:26:19 -0400] coderanger: chef549: How comfortable with Ruby are you?
[2014-07-24 20:26:29 -0400] chef549: not very :(
[2014-07-24 20:26:39 -0400] Neozonz: coderanger, here is the json that i pulled from the chef instance, removed alot of stuff but the hash layout looks like this https://gist.github.com/Neozonz/82e2360fea63daa4339d
[2014-07-24 20:26:47 -0400] double_p: ruby (in chef) can be one HELL
[2014-07-24 20:26:50 -0400] coderanger: chef549: Okay, let me make you a little example, sec
[2014-07-24 20:29:56 -0400] coderanger: chef549: http://hastebin.com/iletoyaguk.rb 190% untested, but something like that
[2014-07-24 20:30:13 -0400] chef549: haha okay ill take a look thanks!!!
[2014-07-24 20:30:58 -0400] Neozonz: coderanger, would .each do |name, instance| still apply if the json looked like that?
[2014-07-24 20:31:15 -0400] coderanger: Neozonz: Yes
[2014-07-24 20:31:41 -0400] Neozonz: so it takes each instance from within instances
[2014-07-24 20:31:44 -0400] coderanger: Neozonz: This code will still fail though
[2014-07-24 20:31:51 -0400] Neozonz: and put it in instance?
[2014-07-24 20:32:00 -0400] coderanger: Neozonz: The "node[:zkhosts] =" is probably not what you want
[2014-07-24 20:33:16 -0400] coderanger: Neozonz: Yes, what language are you most familiar with, I can adapt my metaphor
[2014-07-24 20:33:57 -0400] Neozonz: python, php, perl
[2014-07-24 20:34:05 -0400] Neozonz: bash
[2014-07-24 20:34:07 -0400] pedahzur: Is there documented somewhere why you *can't* use symlinks in files/ and templates/ directory?  For example, I want to share templates between centos 6 and redhat 6.  But if I do centos-6 -> redhat-6 it doesn't find the template on centos-6.  I don't see any sane reason why chef can't honor symlinks.
[2014-07-24 20:34:38 -0400] coderanger: Neozonz: do .each in Ruby is like iteritems in python, except you can just ignore the second argument to the block
[2014-07-24 20:35:27 -0400] coderanger: pedahzur: Because knife doesn't follow symlinks when uploading, that would just make the code way more complex
[2014-07-24 20:35:43 -0400] coderanger: pedahzur: And using file specificity is so rare that this almost never comes up :)
[2014-07-24 20:36:25 -0400] coderanger: pedahzur: If you want to do shared code in templates, you can use the sub-template rendering API now
[2014-07-24 20:36:39 -0400] coderanger: pedahzur: http://docs.opscode.com/essentials_cookbook_templates.html#partial-templates
[2014-07-24 20:36:41 -0400] pedahzur: coderanger: How does it make it more complex?  open(...), copy, whatever, doesn't care if a dir is a symlink or read file/dir.  As far as "never comes up" are you saying that matching based on os/version/etc. isn't used?
[2014-07-24 20:37:07 -0400] coderanger: pedahzur: Yes, the matching is a vestigial feature at best and I'm pushing for it to be removed in favor of a better systems :)
[2014-07-24 20:37:18 -0400] pedahzur: coderanger: This isn't knife. This is chef-solo reading a un-tar'ed ball locally.
[2014-07-24 20:37:28 -0400] coderanger: pedahzur: Same code :)
[2014-07-24 20:38:02 -0400] coderanger: If you follow symlinks in a recursive walk, you need to handle all kinds of fun cases like cycles and permission mismatches
[2014-07-24 20:38:08 -0400] coderanger: Easier to just not bother
[2014-07-24 20:40:31 -0400] gchristensen: symlinks--
[2014-07-24 20:41:58 -0400] pedahzur: coderanger: What is the earliest version that has the partials feature?
[2014-07-24 20:42:33 -0400] coderanger: pedahzur: Hmm, I don't remember anymore, sorry
[2014-07-24 20:42:55 -0400] coderanger: pedahzur: The blog says maybe 11.0
[2014-07-24 20:43:11 -0400] pedahzur: coderanger: Chef manuals need to puts notes in the their docs along the lines of "added in version xxx" :)
[2014-07-24 20:43:19 -0400] coderanger: pedahzur: No argument from me
[2014-07-24 20:43:29 -0400] shlant: pedahzur: Chef 11+ it looks like
[2014-07-24 20:43:37 -0400] Neozonz: coderanger, how's this https://gist.github.com/Neozonz/82e2360fea63daa4339d
[2014-07-24 20:43:48 -0400] pedahzur: shlant: OK, thanks.  We're stuck on 0.9 (long story, don't judge). :P
[2014-07-24 20:44:24 -0400] jmickle: coderanger: found the issue, there is a logic error on the chef vault loading of the data bages
[2014-07-24 20:44:27 -0400] jmickle: bags*
[2014-07-24 20:44:40 -0400] jmickle: the if logic around the loading is reversed
[2014-07-24 20:44:50 -0400] jmickle: il PR it *sigh*
[2014-07-24 20:45:04 -0400] coderanger: Neozonz: I added a comment with a simpler  version
[2014-07-24 20:45:24 -0400] Neozonz: that doesn't look simple at all lol
[2014-07-24 20:48:00 -0400] Neozonz: would the earlier version work though?
[2014-07-24 20:48:15 -0400] coderanger: Neozonz: Unlikely
[2014-07-24 20:48:25 -0400] Neozonz: what's wrong with it?
[2014-07-24 20:48:48 -0400] coderanger: Neozonz: + on arrays is for joining two of them, not appending
[2014-07-24 20:49:14 -0400] coderanger: Neozonz: You could do zkhosts = []; ...each do || zkhosts << instance...;
[2014-07-24 20:49:20 -0400] coderanger: but thats literally the same thing as the map
[2014-07-24 20:49:31 -0400] coderanger: map is just like a list comprehension in Python
[2014-07-24 20:50:43 -0400] Neozonz: gonna need more practise/comprehension on this
[2014-07-24 20:58:29 -0400] medya: whats the right way to install a workstation (I installed the chef-dk but it does NOT include vagrant ...is there extra steps to do after installing chef-dk )  ?
[2014-07-24 20:59:36 -0400] jordane: medya: vagrant has their own packages
[2014-07-24 21:00:22 -0400] jordane: medya: loosely, install: virtualbox, vagrant, chef-dk + whatever stuff you normally use (vim, etc)
[2014-07-24 21:00:23 -0400] medya: jordane I installed vagrant using apt-get but it did NOT create a .vagrant folder in my home folder, (thats where you vagrant parent file goes)
[2014-07-24 21:00:51 -0400] jordane: medya: it is ~/.vagrant.d
[2014-07-24 21:01:02 -0400] jordane: and iirc it may not create it until you use vagrant to do something
[2014-07-24 21:01:34 -0400] medya: @jordane , thats why probably I should use it first... there was not .vagrant.d at fierst
[2014-07-24 21:01:52 -0400] medya: thanks !
[2014-07-24 21:02:03 -0400] jtimberman: medya: you should use chefdk for your workstation. it's only related to vagrant in that it includes test kitchen, which can use vagrant as  a driver for making instances for testing cookbooks.
[2014-07-24 21:02:05 -0400] Neozonz: coderanger, how can i add :2181, to each of the server ip's but on the last key not add the ,
[2014-07-24 21:02:21 -0400] jtimberman: vagrant should create all its own directories as required when you use it
[2014-07-24 21:04:23 -0400] Neozonz: hmm
[2014-07-24 21:04:24 -0400] Neozonz: think i got it
[2014-07-24 21:05:01 -0400] rbowlby: figured out the percona e-bag issue, wrong data format in databag, FML
[2014-07-24 21:05:12 -0400] Neozonz: coderanger, https://gist.github.com/Neozonz/2448135e9f960a0b1902
[2014-07-24 21:05:33 -0400] rbowlby: they're doc is a bit misleading so I'll try to give them a PR and save someone else an hour
[2014-07-24 21:07:02 -0400] medya: @jtimberman thanks, btw do you know the proper way of using chef generate app ? what is that for ?
[2014-07-24 21:07:25 -0400] jtimberman: medya: not 'app', no. i've only used the cookbook generator.
[2014-07-24 21:07:37 -0400] jtimberman: though i have a repository that i usually clone for new cookbooks for our internal things.
[2014-07-24 21:12:45 -0400] ad^2: Hello. I am having an issue with the user creation process. The user is created with the users cookbook. Then in another recipe I go to modify the user to update the gid and comment using :modify. I receive usermod error code 8 - "The login to be modified is in use". The user is not logged in or has never logged in.
[2014-07-24 21:13:13 -0400] ad^2: I can't find an answer on the web.
[2014-07-24 21:13:57 -0400] double_p: v6 only http://www.youtube.com/watch?v=P_HYmLzxj2Y hehe
[2014-07-24 21:14:27 -0400] double_p: ewps.. missed chef didnt ssplit
[2014-07-24 21:15:56 -0400] SmudgerDan: newbie question, I am using chef on windows, after installing a package I have set it up to notify for a restart at the end of the chef run, if " if the WindowsRebootHandler is properly registered" so the question is how to I properly register the report_handler?
[2014-07-24 21:26:33 -0400] Neozonz: coderanger, one more question -> https://gist.github.com/Neozonz/2448135e9f960a0b1902
[2014-07-24 21:27:36 -0400] Neozonz: not sure why it can't find that layer
[2014-07-24 21:27:41 -0400] Neozonz: i see it right in my json
[2014-07-24 21:29:13 -0400] jordane: Neozonz: - in symbols are a no-go
[2014-07-24 21:29:19 -0400] Neozonz: ?
[2014-07-24 21:29:28 -0400] jordane: :ops-dynamic-solr
[2014-07-24 21:29:48 -0400] Neozonz: so what do i do in such a case?
[2014-07-24 21:29:50 -0400] Neozonz: '' ?
[2014-07-24 21:29:53 -0400] jordane: _
[2014-07-24 21:29:56 -0400] jordane: :ops_dynamic_solr
[2014-07-24 21:30:09 -0400] Neozonz: but the layer is actually named ops-dynamic-solr
[2014-07-24 21:30:29 -0400] jordane: then :'ops-dyanmic-solr'
[2014-07-24 21:30:36 -0400] Neozonz: ah
[2014-07-24 21:30:40 -0400] Neozonz: cool thx
[2014-07-24 21:36:02 -0400] double_p: http://www.youtube.com/watch?v=lJN850qHklw
[2014-07-24 21:36:25 -0400] double_p: ewps
[2014-07-24 21:42:09 -0400] medya_: I get error when I try to add dummy box to vagrant
[2014-07-24 21:42:28 -0400] medya_: [vagrant] Cleaning up downloaded box... The box file you're attempting to add is invalid. This can be commonly attributed to typos in the path given to the box add command. Another common case of this is invalid packaging of the box itself.
[2014-07-24 21:42:32 -0400] j^2:  medya_ can you put the error in a gist please?
[2014-07-24 21:42:38 -0400] j^2: the whole thing
[2014-07-24 21:43:00 -0400] medya_: https://gist.github.com/medyagh/606aea15458b2e056fba
[2014-07-24 21:43:24 -0400] j^2: this is vagrant not chef
[2014-07-24 21:43:40 -0400] j^2: and it looks like that box doesnt exist anymore
[2014-07-24 21:44:18 -0400] j^2: dummy.box: gzip compressed data, from Unix, last modified: Wed Feb  6 17:30:44 2013
[2014-07-24 21:44:22 -0400] j^2: so it is actually there
[2014-07-24 21:44:31 -0400] j^2: i wget'd it
[2014-07-24 21:44:33 -0400] medya_: j^2 I know this is a vagrant question and it is the box for vagrant-aws plugin, I have the box working on another amchine, is there any way I can copy it from there ? I can just copy the box from boxes folder and put it there?
[2014-07-24 21:45:15 -0400] j^2: i'd wget the file down then try to add it via the local file system
[2014-07-24 21:45:28 -0400] j^2: if that doesnt work, check the versions of vagrant you're using
[2014-07-24 21:45:35 -0400] j^2: if it's the same on both machines
[2014-07-24 21:45:41 -0400] medya_: but the folder is just empty
[2014-07-24 21:45:46 -0400] medya_: here is the link of the box
[2014-07-24 21:45:46 -0400] medya_: https://github.com/mitchellh/vagrant-aws/blob/master/dummy.box
[2014-07-24 21:45:51 -0400] j^2: 1.5 and 1.6 have some pretty crazy changes
[2014-07-24 21:45:52 -0400] medya_: it is on github, how could it not work  ?
[2014-07-24 21:46:00 -0400] j^2: dummy.box: gzip compressed data, from Unix, last modified: Wed Feb  6 17:30:44 2013
[2014-07-24 21:46:04 -0400] j^2: it's a gzip file
[2014-07-24 21:46:14 -0400] j^2: that's running file against wgettng that file down
[2014-07-24 21:46:37 -0400] medya_: well I just looked at my other machine the dummy folder in boxes is just an empty folder
[2014-07-24 21:47:02 -0400] j^2: i'd go ask #vagrant ;)
[2014-07-24 21:47:10 -0400] medya_: actualy there is only one file in it
[2014-07-24 21:47:16 -0400] medya_: with 3 lines of  ode
[2014-07-24 21:47:23 -0400] medya_:   "provider": "aws"}
[2014-07-24 21:47:29 -0400] medya_: thats it...should I just copy that
[2014-07-24 21:47:50 -0400] medya_: would copying the file add it to the list of boxes?
[2014-07-24 22:05:15 -0400] SmudgerDan: newbie question, I am using chef on windows, after installing a package I have set it up to notify for a restart at the end of the chef run, if " if the WindowsRebootHandler is properly registered" so the question is how to I properly register the report_handler?
[2014-07-24 22:11:34 -0400] hugestnob: hi guys, i'm trying to figure out a strategy for testing chef deployments on a few servers before pushing to the rest of our chef environment
[2014-07-24 22:13:04 -0400] hugestnob: i was thinking it'd be great if i could block all chef-client runs except for a few whitelisted servers, but that functionality doesnt seem to exist, does anybody have any suggestions or ideas for how i should be doing this
[2014-07-24 22:14:07 -0400] coderanger: hugestnob: Thats generally the kind of thing you would handle with environments
[2014-07-24 22:14:17 -0400] coderanger: hugestnob: Like a "canary" environment or similar
[2014-07-24 22:14:48 -0400] hugestnob: the problem i have is that i inherited a chef codebase where environments are used to designate data centers
[2014-07-24 22:15:00 -0400] hugestnob: for dns, configuring load balancers, etc. etc.
[2014-07-24 22:15:17 -0400] hugestnob: so transitioning away from that would be tricky, trying to see if i have other options
[2014-07-24 22:16:26 -0400] coderanger: hugestnob: Check out poise-appenv, it can help with that
[2014-07-24 22:20:14 -0400] hugestnob: i'll check it out thanks coderanger
[2014-07-24 22:59:49 -0400] shlant: coderanger: can you think of a reason why runit is trying to restart unicorn before app/current exists?
[2014-07-24 22:59:56 -0400] shlant: it fails with cannot locate Gemfile
[2014-07-24 23:00:21 -0400] shlant: with app_ruby
[2014-07-24 23:00:23 -0400] coderanger: Not off hand, but I've not looked at that code in a long while
[2014-07-24 23:02:10 -0400] Damm: shlant, not that smart
[2014-07-24 23:02:18 -0400] Damm: I use that script in Docker
[2014-07-24 23:02:25 -0400] Damm: i had to patch it
[2014-07-24 23:02:40 -0400] shlant: Damm: I already use a fork, any advice on what needs patching?
[2014-07-24 23:02:52 -0400] Damm: shlant, can you point me to the fork? I'm curious what's changed
[2014-07-24 23:02:55 -0400] Damm: I might want it
[2014-07-24 23:02:56 -0400] Damm: heh
[2014-07-24 23:03:17 -0400] shlant: Damm: I have removed it from public eyes as I have some very hacky stuff that is specific to my setup :p
[2014-07-24 23:03:30 -0400] shlant: maybe when I get it working I will release it
[2014-07-24 23:03:34 -0400] shlant: for those who dare
[2014-07-24 23:03:50 -0400] Damm: shlant, you'll laugh
[2014-07-24 23:03:58 -0400] Damm: if [ -d "/data/<%= appname %>/current" ] ; then
[2014-07-24 23:04:04 -0400] Damm: about 5 lines in
[2014-07-24 23:04:32 -0400] Damm: if there's no data path it just sleeps for 1 second and exits
[2014-07-24 23:04:37 -0400] Damm: then runit restarts goes back to sleep
[2014-07-24 23:04:43 -0400] Damm: kinda annoying but no ruby processes starting
[2014-07-24 23:04:45 -0400] Damm: no cpu burnup
[2014-07-24 23:05:06 -0400] Damm: shlant, so it's just a big if clause before the whole script runs
[2014-07-24 23:05:22 -0400] shlant: Damm: maybe this is causing the restart?
[2014-07-24 23:05:22 -0400] shlant: restart_on_update - Whether the service should be restarted when the run script is updated. Defaults totrue. Set to false if the service shouldn't be restarted when the run script is updated.
[2014-07-24 23:09:41 -0400] ec9988: hi, I'm trying to include library in the recipe, I keep getting Cannot find a resource for include on ubuntu version 12.04 when I install it.  any idear?
[2014-07-24 23:14:37 -0400] coderanger: ec9988: What do you mean?
[2014-07-24 23:14:49 -0400] coderanger: ec9988: Perhaps you mean to use "require"?
[2014-07-24 23:16:06 -0400] ec9988: i want to run shellout to check if a process is running out not, and catch the exit status
[2014-07-24 23:16:21 -0400] ec9988: i'm reading to page, http://docs.opscode.com/lwrp_custom_provider_ruby.html#require
[2014-07-24 23:16:53 -0400] ec9988: i think i need to put it in the providers or resources instead of recipe
[2014-07-24 23:19:12 -0400] ec9988: I think i'm making it too complicated, the problem I need to solve is to check has NIS client installed, if so, don't install a user.  So, if I run ypwhich on the node, if the exit code is not 0, then don't install the user
[2014-07-24 23:19:45 -0400] coderanger: ec9988: That page is 100% wrong, sorry
[2014-07-24 23:19:52 -0400] ec9988: oh
[2014-07-24 23:21:02 -0400] coderanger: ec9988: Are you writing an LWRP or is this just in a recipe?
[2014-07-24 23:22:00 -0400] ec9988: i want to write a simple recipe to check if NIS client is running/installed, if so, don't try to install a user
[2014-07-24 23:22:48 -0400] coderanger: ec9988: okay, sec
[2014-07-24 23:28:13 -0400] coderanger: ec9988: http://hastebin.com/oqanoyager.rb
[2014-07-24 23:28:19 -0400] coderanger: ec9988: I think thats the kind of thing you want
[2014-07-24 23:29:07 -0400] ec9988: let me try that, thanks @coderanger
[2014-07-24 23:30:07 -0400] lamont_oc: just try passing a string to a not_if guard?
[2014-07-24 23:30:29 -0400] coderanger: Yeah, if its just the user, thats better
[2014-07-24 23:30:44 -0400] coderanger: Using shell_out only makes sense if there is a lot more in there
[2014-07-24 23:31:32 -0400] ec9988: the environment is consists of different platforms, and differnt setup.
[2014-07-24 23:31:37 -0400] lamont_oc: yeah not_if with a string just gets passed to shell_out and then tests the exit code, so
[2014-07-24 23:33:01 -0400] jharley: hey, is there anyway to subscribe only to only the start action of a service?
[2014-07-24 23:33:21 -0400] jharley: I have a ruby_block that I want to have executed only when a service is started, not stopped (or whatever)
[2014-07-24 23:33:47 -0400] lamont_oc: ec9988: https://gist.github.com/lamont-granquist/5c9b0ccb3ea608851260
[2014-07-24 23:35:56 -0400] ec9988: thanks lamont_oc
[2014-07-24 23:38:47 -0400] coderanger: lamont_oc: lmao, if y'all want to manage the EPEL data in core chef, I'll notify your next of kin now and save them the trouble of waiting ;_)
[2014-07-24 23:39:59 -0400] lamont_oc: yep
[2014-07-24 23:41:01 -0400] lamont_oc: jharley: use a log resource that notifies the :start action and then :executes the ruby_block  then notify the log resource insted of the execute resource...
[2014-07-24 23:41:04 -0400] coderanger: I actually want to gut more stuff out of core :-( notably deploy, git, and svn
[2014-07-24 23:41:57 -0400] lamont_oc: unfortunately, weve got a bias for more in core
[2014-07-24 23:42:36 -0400] Damm: deploy is so old
[2014-07-24 23:42:36 -0400] lamont_oc: deploy is pretty annoying though
[2014-07-24 23:42:40 -0400] Damm: and crappy
[2014-07-24 23:42:47 -0400] Damm: i mean either clean it up or ship it out
[2014-07-24 23:44:20 -0400] lamont_oc: (jharley:  the fact that youre asking the question probably indicates youre solving a bigger problem in some strange way)
[2014-07-24 23:44:31 -0400] jharley: lamont_oc: yeea
[2014-07-24 23:44:45 -0400] lamont_oc: generally old code is all shitty
[2014-07-24 23:45:09 -0400] jharley: mysql takes a long time to start sometimes, and I want to make sure its responding when it restarts before other things proceed.. this is more important when bootstrapping a node with my cookbook
[2014-07-24 23:45:36 -0400] jharley: but, I only want the wait to happen on start.. cause stop just waits forever
[2014-07-24 23:45:36 -0400] lamont_oc: do an execute resource in a retry loop until it succeeds?
[2014-07-24 23:45:47 -0400] lamont_oc: yeah
[2014-07-24 23:45:49 -0400] jharley: the ruby_block does a sleep
[2014-07-24 23:45:55 -0400] jharley: in a loop
[2014-07-24 23:46:15 -0400] lamont_oc: so generally you want to have a cookbook that has a :start in it and a ruby_block that runs to wait for it to start
[2014-07-24 23:46:27 -0400] lamont_oc: then if you signal the resource to stop, you dont re-run the whole recipe
[2014-07-24 23:46:31 -0400] jharley: right
[2014-07-24 23:46:48 -0400] jharley: Im using an other cookbook to manage MySQL, which is why I went with subscribes in the first place
[2014-07-24 23:47:20 -0400] jharley: this is now coming up because that mysql cookbook (chef-percona) does a stop when configuring a percona cluster
[2014-07-24 23:47:25 -0400] jharley: which, Im trying to automate
[2014-07-24 23:47:32 -0400] Damm: lamont_oc, so says the 18 year old reviewing it
[2014-07-24 23:47:43 -0400] Damm: lamont_oc, everything is subjective
[2014-07-24 23:48:25 -0400] jharley: this is super hacky, but seemed better than setting retries to some huge number
[2014-07-24 23:48:41 -0400] jharley: and, I saw a jenkins cookbook do something similar
[2014-07-24 23:49:30 -0400] lamont_oc: i saw a jenkins cookbook do something similar is maybe not the best touchstone to use for best practices
[2014-07-24 23:50:18 -0400] Eulipion: https://github.com/fnichol/chef-jenkins/blob/master/recipes/default.rb#L140
[2014-07-24 23:50:21 -0400] jharley: lamont_oc: I dont disagree
[2014-07-24 23:50:39 -0400] jharley: lamont_oc: whats the best practise for waiting for a service to start?
[2014-07-24 23:52:01 -0400] lamont_oc: id just have a recipe that did a service :start and then waiting in a loop  or include_recipe mysql::start and then waited in a loop or something
[2014-07-24 23:53:03 -0400] Damm: jharley, there's lots of bad practices
[2014-07-24 23:53:09 -0400] Damm: like having your recipe check to see if the process is up
[2014-07-24 23:53:11 -0400] Damm: or ready
[2014-07-24 23:53:32 -0400] Damm: sometimes mysql takes awhile to start up; so a common trick is what we did at EY (it's gorey and you should not repeat it)
[2014-07-24 23:54:04 -0400] coderanger: jharley: There is always the nuclear option https://github.com/poise/jenkins/blob/master/libraries/jenkins.rb#L185-L197
[2014-07-24 23:54:12 -0400] Damm: this is the worst idea
[2014-07-24 23:54:13 -0400] Damm: but
[2014-07-24 23:54:14 -0400] lamont_oc: we probably need an attribute for the service resource like a not_if guard which is a wait_after_start_until guard
[2014-07-24 23:54:14 -0400] Damm: https://gist.github.com/damm/3a22d1baf2a3b76b07fb
[2014-07-24 23:54:16 -0400] Damm: it does work
[2014-07-24 23:54:42 -0400] jharley: lamont_oc: that would be good
[2014-07-24 23:54:45 -0400] Damm: basically you need to connect to mysql to see if it's up
[2014-07-24 23:54:50 -0400] jharley: coderanger: that was more or less what made me think of it
[2014-07-24 23:54:53 -0400] lamont_oc: also a wait_after_stop_until_guard
[2014-07-24 23:54:54 -0400] Damm: if your in chef using dbi is likely an easy way in
[2014-07-24 23:55:22 -0400] lamont_oc: jharley: https://github.com/opscode/chef/issues/new
[2014-07-24 23:55:24 -0400] jharley: Damm: Im using mysqladmin status, which works about as well, I think?
[2014-07-24 23:55:34 -0400] jharley: lamont_oc: Ill write one
[2014-07-24 23:55:35 -0400] Damm: jharley, no
[2014-07-24 23:55:45 -0400] Damm: jharley, really both of us should be using the user that connects that we care about
[2014-07-24 23:55:50 -0400] Damm: the admin user connecting is not a valid answer
[2014-07-24 23:55:59 -0400] jharley: Damm: in my case it as, as Im bootstrapping the database
[2014-07-24 23:56:02 -0400] Damm: mysql gives us special slots for that; so if we're running out of connections
[2014-07-24 23:56:11 -0400] Damm: you could have monitoring say mysql is fine
[2014-07-24 23:56:12 -0400] Damm: when it's not
[2014-07-24 23:56:19 -0400] Damm: or chef
