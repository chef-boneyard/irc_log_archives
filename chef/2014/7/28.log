[2014-07-28 00:00:05 -0400] Damm: thun, I've been using Logstash for awhile.  It does take a little to get used to it; but I was never able to sell splunk at an old customer
[2014-07-28 00:00:11 -0400] Damm: was able to sell them Logstash
[2014-07-28 00:00:19 -0400] Damm: works for me; works for them; works for new customer
[2014-07-28 00:01:07 -0400] thun: Does logstash have option to archive to s3?
[2014-07-28 00:05:53 -0400] n1ko: logstash really isnt a product, but a piece of open source software. So stuff like "archive to s3" are definetly up to you to do. It uses elasticsearch as backend, so anything you can do with that it supports
[2014-07-28 00:19:03 -0400] bdha: You can get support for Logstash, ElasticSearch and Kibana from ElasticSearch.
[2014-07-28 00:19:13 -0400] bdha: So calling it a product isn't really a stretch.
[2014-07-28 00:21:33 -0400] Damm: bdha, it is a product
[2014-07-28 00:21:36 -0400] Damm: bdha, I sell it as one
[2014-07-28 00:21:45 -0400] Damm: and you can get support from me ;)
[2014-07-28 00:21:49 -0400] Damm: lol if your my customer that is
[2014-07-28 00:26:09 -0400] n1ko: in my books thats selling support or service :)
[2014-07-28 00:26:21 -0400] Damm: n1ko, well Elasticsearch has to be sold
[2014-07-28 00:26:33 -0400] n1ko: but anyways, the difference is still there. of course you can find anyone to support any open source software
[2014-07-28 00:26:33 -0400] Damm: you have to be pretty stubborn to use it and support it yourself without any personal reason
[2014-07-28 00:26:56 -0400] Damm: first thing you do to elasticsearch is add the https plugin; then the users plugin
[2014-07-28 00:27:00 -0400] Damm: or lock it down another way
[2014-07-28 00:27:09 -0400] Damm: that's before you even start
[2014-07-28 00:27:31 -0400] Damm: full text search isn't a very glorious area
[2014-07-28 00:27:38 -0400] Damm: very painful really and the tools are not that good
[2014-07-28 00:27:44 -0400] Damm: just a few
[2014-07-28 00:27:48 -0400] n1ko: didnt do neither of things in my setup :)
[2014-07-28 00:27:57 -0400] n1ko: but i do agree on the painfulness of the search
[2014-07-28 00:28:01 -0400] Damm: so you leave it open to the world/
[2014-07-28 00:28:03 -0400] n1ko: especially if you are used to splunk
[2014-07-28 00:28:09 -0400] Damm: or just lock it down to internal only?
[2014-07-28 00:28:15 -0400] n1ko: there is no world that reaches a pivate network
[2014-07-28 00:28:23 -0400] Damm: oh and btw stupidiest thing of ES
[2014-07-28 00:28:24 -0400] n1ko: just opened kibana interfaced
[2014-07-28 00:28:25 -0400] Damm: cors of *
[2014-07-28 00:28:27 -0400] Damm: by default
[2014-07-28 00:28:42 -0400] n1ko: yep
[2014-07-28 00:28:45 -0400] Damm: I started locking it down and putting nginx in front for spdy
[2014-07-28 00:28:51 -0400] Damm: and I was just horrified at that stupidity
[2014-07-28 00:28:54 -0400] Damm: it's not even in the config file
[2014-07-28 00:32:07 -0400] Damm: but that's kinda why I sell it I like what I get; I dont' have to pay for it
[2014-07-28 00:32:13 -0400] Damm: no it's not perfect but really what is
[2014-07-28 00:32:57 -0400] n1ko: yeah
[2014-07-28 00:33:06 -0400] n1ko: splunk is pretty nice, but then again its pricey as hell
[2014-07-28 00:33:18 -0400] Damm: really? since when
[2014-07-28 00:33:20 -0400] n1ko: and one thing that logstash has going for it is kibana
[2014-07-28 00:33:28 -0400] Damm: indeed
[2014-07-28 00:33:38 -0400] Damm: Kibana is likely what made Logstash so parseable
[2014-07-28 00:33:41 -0400] n1ko: the interface is really nice and you can do really nice dashboards showing graphs with it
[2014-07-28 00:33:51 -0400] Damm: yep but you have to add spdy
[2014-07-28 00:33:55 -0400] n1ko: spunk dashes and graphs seems so clumsy
[2014-07-28 00:33:56 -0400] Damm: because you make a crapton of connections
[2014-07-28 00:34:10 -0400] Damm: right; I was never able to capture decent context with splunk
[2014-07-28 00:34:20 -0400] Damm: it was nice to grab a package and ship the logs into Splunk with proper documentation
[2014-07-28 00:34:27 -0400] Damm: and it was easy; looked clean had a little security on top
[2014-07-28 00:34:36 -0400] Damm: squishy feel good you know?
[2014-07-28 00:35:31 -0400] n1ko: btw, have you tackled the problem of users in kibana?
[2014-07-28 00:35:39 -0400] Damm: as in?
[2014-07-28 00:35:43 -0400] n1ko: i mean sure you can do basic auth but thats not really great
[2014-07-28 00:35:45 -0400] Damm: educating and inducting them
[2014-07-28 00:35:51 -0400] Damm: I do this with oauth2
[2014-07-28 00:36:07 -0400] Damm: basically bitly oauth2 gateway to authenticate everyone from the domain
[2014-07-28 00:36:07 -0400] n1ko: any authorization there?
[2014-07-28 00:36:15 -0400] Damm: and then setup nginx to push in ES on the routes
[2014-07-28 00:36:23 -0400] Damm: so basically as long as you can authetnicate in our domain
[2014-07-28 00:36:27 -0400] Damm: you can get access to read
[2014-07-28 00:36:28 -0400] Damm: and write
[2014-07-28 00:36:35 -0400] Damm: the limit_except GET stuff works real well in nginx
[2014-07-28 00:36:44 -0400] Damm: but really you should limit it all
[2014-07-28 00:36:49 -0400] Damm: so that's what I did
[2014-07-28 00:36:58 -0400] Damm: I can gist up my config if you want; it's got Grafana + Kibana
[2014-07-28 00:37:35 -0400] n1ko: sure, although im luckily not part of maintaining that setup anymore. but interesting to see what you came up with
[2014-07-28 00:38:12 -0400] n1ko: my context was that we were runnin multiple saas services and shipping logs to a  dedicated es backend. but would have liked to expose those logs to customers, but of course only their logs
[2014-07-28 00:38:37 -0400] n1ko: thats pretty easy to do with splunk, but needs alot of nginx-fu to do with kibana
[2014-07-28 00:39:02 -0400] Damm: granted i have a few more bits in here
[2014-07-28 00:39:05 -0400] Damm: nothing special
[2014-07-28 00:39:05 -0400] Damm: https://gist.github.com/damm/001de0c14af328fa745d
[2014-07-28 00:39:36 -0400] Damm: and i'll include the cors magic
[2014-07-28 00:39:47 -0400] Damm: that really grined on me
[2014-07-28 00:39:53 -0400] Damm: grinded*
[2014-07-28 00:40:10 -0400] Damm: you have to return a 204 without authentication with chrome
[2014-07-28 00:40:41 -0400] Damm: nothing really fancy but having spdy did decrease the load time by 5fold
[2014-07-28 00:40:49 -0400] Damm: so that alone maybe worth investigating if you keep it
[2014-07-28 00:41:26 -0400] Damm: n1ko, well that's a hard part exposing only their logs
[2014-07-28 00:42:15 -0400] Damm: n1ko, https://github.com/codelibs/elasticsearch-auth
[2014-07-28 00:42:19 -0400] Damm: is likely your best way :(
[2014-07-28 00:43:20 -0400] n1ko: yeah, my idea was an automatic nginx log appender
[2014-07-28 00:43:32 -0400] n1ko: because we had unique indexeses for the customers it could be done
[2014-07-28 00:44:03 -0400] n1ko: it was just a pita to think about all the things that you need to lock done, not just viewing the correct logs but the user accounts, limiting modifying stuff etc
[2014-07-28 00:44:30 -0400] n1ko: everything of course can be done with nginx, but its not really the correct place imho to do that. but with logstash, theres no alternative
[2014-07-28 01:10:57 -0400] Damm: very pita
[2014-07-28 04:14:04 -0400] cloudbud: Hi how can I specify multiple cookbooks in a single runlist
[2014-07-28 04:17:16 -0400] coderanger: cloudbud: Just have multiple entries in the run list
[2014-07-28 04:17:23 -0400] coderanger: recipe[foo], recipe[bar]
[2014-07-28 04:18:19 -0400] cloudbud: but if recipe foo has multiple recipes than how to handle that ? @coderanger
[2014-07-28 04:18:31 -0400] coderanger: Not sure what you mean
[2014-07-28 04:18:40 -0400] coderanger: Whatever you want to run, put that in the run list
[2014-07-28 04:19:17 -0400] cloudbud: like mysql recipe contains two recipes server.rb client.rb then how to add these two in the runlsit
[2014-07-28 04:25:31 -0400] Damm: recipe[foo::default]
[2014-07-28 04:25:36 -0400] Damm: recipe[foo::bar]
[2014-07-28 04:26:23 -0400] Damm: cloudbud, the runlist is an array so you can specify multiple cookbooks in that.  If you are trying to select a specific recipe from within the cookbook see above.
[2014-07-28 04:26:31 -0400] Damm: no such thing as single runlist
[2014-07-28 04:26:48 -0400] Damm: ["recipe[foo::bar]","recipe[foo::bill]"]
[2014-07-28 04:28:07 -0400] cloudbud: Damm : Chef server runs on 443 port ?
[2014-07-28 04:30:12 -0400] digitalchild: ssl
[2014-07-28 04:31:42 -0400] coderanger: cloudbud: Yes, chef-server uses 443/tcp by default
[2014-07-28 04:31:54 -0400] cloudbud: thanks guys
[2014-07-28 04:53:18 -0400] cloudbud: should I go with this recipe https://github.com/priestjim/chef-phpmyadmin to install phpmyadmin ?
[2014-07-28 04:56:59 -0400] coderanger: cloudbud: Reviewing community cookbooks is more complex than can be summarized in here
[2014-07-28 04:57:32 -0400] cloudbud: @coderanger : so which recipe I should follow ?
[2014-07-28 04:57:39 -0400] coderanger: cloudbud: Thats up to you
[2014-07-28 05:05:56 -0400] cloudbud: is there any command that i can use to unistall berks cookbook as defined in the berksfile
[2014-07-28 05:06:08 -0400] coderanger: cloudbud: uninstall?
[2014-07-28 05:06:18 -0400] cloudbud: yup
[2014-07-28 05:18:09 -0400] coderanger: cloudbud: What do you mean by uninstall?
[2014-07-28 05:18:55 -0400] cloudbud: I inatalled cookbooks written in berkshelf file how can i remove that cookbooks
[2014-07-28 05:19:46 -0400] coderanger: What do you mean by "installed"?
[2014-07-28 05:20:41 -0400] cloudbud: I did berks install and they got installed in.berkshelf/cookbook
[2014-07-28 05:20:51 -0400] cloudbud: then I did berks upload
[2014-07-28 05:24:59 -0400] coderanger: There isn't an uninstall that I know of, you can just delete the folders from ~/.berkshelf
[2014-07-28 05:25:37 -0400] cloudbud: @coderanger : How can I manage the cookbooks in berkshelf's cookbook and chef repo cookbook
[2014-07-28 05:26:10 -0400] cloudbud: I have same cookbooks ( some not all ) in both the cookbooks
[2014-07-28 05:26:16 -0400] cloudbud: how can I manage the redundancy
[2014-07-28 05:29:35 -0400] coderanger: cloudbud: You keep using the terms "cookbook" and "recipe" to refer to other things I think
[2014-07-28 05:29:45 -0400] coderanger: which is making it difficult to follow your questions
[2014-07-28 05:30:16 -0400] coderanger: the cookbooks kept in the berkshelf folders are a cache, you can generally ignore them unless something gets corrupted
[2014-07-28 05:31:25 -0400] cloudbud: let me explain I have few cookbooks that I installed from opscode and there are few that are dependent cookbooks in the berkshelf cookbooks
[2014-07-28 05:31:46 -0400] cloudbud: I have mysql cookbook in the chef repo cookbook as well as berkshelf cookbook
[2014-07-28 05:31:56 -0400] cloudbud: how to manage the redundancies
[2014-07-28 05:33:36 -0400] coderanger: cloudbud: "berkshelf cookbook" isn't a thing
[2014-07-28 05:33:43 -0400] coderanger: What do you mean by that?
[2014-07-28 05:34:27 -0400] cloudbud: ./berkshelf/cookbook/
[2014-07-28 05:34:41 -0400] coderanger: Those are a cache, you can ignore them
[2014-07-28 05:34:53 -0400] coderanger: You should never interact with them directly
[2014-07-28 06:17:05 -0400] cloudbud: How can I delete all cookbooks onn chef server in a single shot ?
[2014-07-28 06:19:17 -0400] coderanger: cloudbud: knife cookbook buik delete
[2014-07-28 06:20:17 -0400] cloudbud: @coderanger : did that FATAL: You must supply a regular expression to match the results against
[2014-07-28 06:20:30 -0400] coderanger: Yes, you need to provide a regex
[2014-07-28 06:20:34 -0400] coderanger: such as .*
[2014-07-28 06:21:10 -0400] cloudbud: thanks
[2014-07-28 06:26:06 -0400] cloudbud: I keep on getting error like https://github.com/berkshelf/berkshelf/issues/524
[2014-07-28 06:27:32 -0400] cloudbud: whenever I try to upload the cookbook from berksfile
[2014-07-28 06:27:34 -0400] coderanger: cloudbud: Okay, that ticket has the solution too
[2014-07-28 06:28:02 -0400] cloudbud: @coderanger : can you point to the resolution
[2014-07-28 06:28:26 -0400] cloudbud: I do  berks upload --ssl-verify=false
[2014-07-28 06:28:57 -0400] coderanger: cloudbud: You need to fix your CA certs, just like any other time you see that error
[2014-07-28 06:29:09 -0400] coderanger: OpenSSL is generally quite specific
[2014-07-28 06:29:23 -0400] coderanger: Either the remote cert is bad, or it is failing to verify due to missing CA certs
[2014-07-28 06:29:56 -0400] cloudbud: i have not installed certs
[2014-07-28 06:30:27 -0400] cloudbud: Error :http://pastebin.com/kC4eBxtL
[2014-07-28 06:32:52 -0400] coderanger: cloudbud: What OS are you on?
[2014-07-28 06:33:07 -0400] coderanger: OS X notably has pretty bad default CA certs
[2014-07-28 06:35:05 -0400] cloudbud: My workstation and chef server is on Centos 6.5
[2014-07-28 06:41:11 -0400] coderanger: I don't know how CentOS handles CA certs, so you're on your own there
[2014-07-28 06:41:36 -0400] coderanger: but rhel 6 is probably too old to have the current digicert roots
[2014-07-28 06:49:34 -0400] kramos: Hi guys, can anyone help me out why knife ssh gives me an error instead of a proper result [ http://pastebin.com/sCX2eaU1 ]
[2014-07-28 06:51:51 -0400] coderanger: kramos: ssh-gateway doesn't currently support the -i option
[2014-07-28 06:52:00 -0400] coderanger: kramos: If you add that key to your agent, it should work though
[2014-07-28 06:53:27 -0400] kramos: that -i option is for the target nodes. The ssh-gateway host is already set on ~/.ssh/config
[2014-07-28 06:54:42 -0400] coderanger: Hmm, I don't think it parses that
[2014-07-28 06:54:51 -0400] coderanger: it would have to be loaded in your ssh-agent
[2014-07-28 06:55:04 -0400] coderanger: the gateway connection is handled as a super-special case right now, which is unfortunate
[2014-07-28 06:55:35 -0400] kramos: thanks. I'll try add the target nodes in my config
[2014-07-28 07:10:47 -0400] cloudbud: I installed apache using cookbook https://github.com/onehealth-cookbooks/apache2 on ubuntu
[2014-07-28 07:10:59 -0400] cloudbud: I included default.rb recipe
[2014-07-28 07:11:26 -0400] cloudbud: apache is installed and running but when I opened it on browser
[2014-07-28 07:11:32 -0400] cloudbud: It gevame me error
[2014-07-28 07:11:44 -0400] cloudbud: the requested url / was not found on this server.
[2014-07-28 07:12:03 -0400] coderanger: cloudbud: Yes, why is that unusual
[2014-07-28 07:13:06 -0400] cloudbud: @coderanger : i have not encountered such situation
[2014-07-28 07:13:27 -0400] coderanger: cloudbud: The default vhost usually points at an empty folder
[2014-07-28 07:13:56 -0400] cloudbud: Do I nned to make any changes
[2014-07-28 07:16:29 -0400] coderanger: cloudbud: You need to make your own vhost
[2014-07-28 07:18:51 -0400] cloudbud: @coderanger : which file do i need to make changes to
[2014-07-28 07:21:24 -0400] coderanger: cloudbud: Can you explain more what you are trying to do?
[2014-07-28 07:21:36 -0400] cloudbud: Installing Lamp
[2014-07-28 07:21:37 -0400] coderanger: Chef is a complex tool, there is single file you need to chagne
[2014-07-28 08:02:23 -0400] SmudgerDan: Morning sexy people
[2014-07-28 08:03:33 -0400] Damacus: morning SmudgerDan I presume you'e speaking to me ;)
[2014-07-28 08:04:19 -0400] SmudgerDan: I am talking to everyone in here =D
[2014-07-28 08:04:38 -0400] SmudgerDan: I never know which ones of you will help me at some point today!
[2014-07-28 08:05:08 -0400] Damacus: haha I like you're style
[2014-07-28 08:06:01 -0400] SmudgerDan: Yes I am a stylish guy!
[2014-07-28 08:06:24 -0400] cloudbud: I am installing PHPMyadmin using recipe https://api.berkshelf.com/cookbooks/phpmyadmin
[2014-07-28 08:06:56 -0400] cloudbud: getting error: http://pastebin.com/gRN7hC8U
[2014-07-28 08:07:18 -0400] Damacus: interesting, any reason you're using the apt-berks site rather than https://supermarket.getchef.com/ ?
[2014-07-28 08:07:43 -0400] Damacus: have you installed the php cookbook on the chef server?
[2014-07-28 08:08:27 -0400] Damacus: "could not find recipe module_mbstring for cookbook php" indicates you've either got php but a version that doesn't provide that recipe, or no php cookbook installed at all.
[2014-07-28 08:08:52 -0400] cloudbud: Damacus : yes i have installed php on server using chef
[2014-07-28 08:11:17 -0400] Damacus: cloudbud interesting, as it would seem it can't find it. I've only had that problem when the dependency isn't met. i.e. I've not installed the right version usually.
[2014-07-28 08:12:22 -0400] Damacus: cloudbud looks like some of the older chef-php cookbooks didn't provide that recipe, what version do you have installed on the chef-server?
[2014-07-28 08:12:50 -0400] cloudbud: '1.4.7'
[2014-07-28 08:14:17 -0400] Damacus: weird, latest.
[2014-07-28 08:16:04 -0400] coderanger: cloudbud: How did you upload things after the bulk delete?
[2014-07-28 08:16:31 -0400] cloudbud: idid knife cookbook upload cookbook name
[2014-07-28 08:17:44 -0400] Damacus: yeah, whatever is on the server is all I and chef-client care about. What you could do if you're not sure still is go onto the node that you're tryin gto run the recipe and go to...
[2014-07-28 08:19:41 -0400] cloudbud: Damacus : can you give me a pointer to chef recipe to install php myadmin a simple one
[2014-07-28 08:20:56 -0400] Damacus: this will be required by any phpmyadmin, it' just making sure php is installed.
[2014-07-28 08:21:17 -0400] cloudbud: Damacus : but php is installed
[2014-07-28 08:21:20 -0400] Damacus: and as there are some pre-requisites to install it also does them.
[2014-07-28 08:21:24 -0400] cloudbud: how to resolv ethis issue
[2014-07-28 08:22:30 -0400] Damacus: do what I said above. Make sure the recipe is installed on the chef-server, and double check that the client has access to the php cookbook i.e. look in the cache on the server for the recipe.
[2014-07-28 08:24:55 -0400] coderanger: cloudbud: You might just want to set things up by hand first to familiarize yourself with the process
[2014-07-28 08:25:02 -0400] coderanger: and then write recipes that do exactly that
[2014-07-28 08:25:17 -0400] coderanger: the community cookbooks are generally fairly advanced, and best left until you have a better understanding of chef
[2014-07-28 08:25:22 -0400] SmudgerDan: Am I missing something: using the hosted chef website, there is no way to set the version of the cookbook on a run list?
[2014-07-28 08:25:50 -0400] coderanger: SmudgerDan: Thats correct, that feature is deprecated and not exposed in the UI (and never was AFAIK)
[2014-07-28 08:25:54 -0400] Damacus: SmudgerDan there any way to set it in the environment?
[2014-07-28 08:26:56 -0400] SmudgerDan: ok thanks guys
[2014-07-28 08:27:30 -0400] SmudgerDan: will knife it up, as a Windows dev I do love me a UI ;)
[2014-07-28 08:28:10 -0400] coderanger: SmudgerDan: The way to lock cookbook versions now is via environments
[2014-07-28 08:28:23 -0400] coderanger: SmudgerDan: The old syntax isn't even documented anymore I think
[2014-07-28 08:29:17 -0400] coderanger: SmudgerDan: Unless you are a chef user from way back, you might be confused about how to handle versions :)
[2014-07-28 08:29:25 -0400] SmudgerDan: ok, it's just strange, the run list for a node just states the run list (not a version) and the environment has no attributes but yet it is picking up an older version
[2014-07-28 08:29:55 -0400] coderanger: SmudgerDan: Does the environment have a cookbook_versions block in it?
[2014-07-28 08:30:20 -0400] SmudgerDan: no it is completely empty
[2014-07-28 08:32:26 -0400] SmudgerDan: must be something I am missing
[2014-07-28 08:33:04 -0400] SmudgerDan: let me download the node file see what is stored on the chef server
[2014-07-28 08:33:15 -0400] coderanger: SmudgerDan: grab knife solve
[2014-07-28 08:33:28 -0400] coderanger: https://github.com/coderanger/knife-solve
[2014-07-28 08:33:38 -0400] coderanger: It will show you the version solutions for a given node
[2014-07-28 08:39:11 -0400] coderanger: SmudgerDan: Usually those kinds of issues are driven by dependencies between cookbooks
[2014-07-28 08:39:51 -0400] SmudgerDan: makes sense, it is a powershell cookbook, and I think the windows cookbook depends on it
[2014-07-28 08:40:01 -0400] SmudgerDan: just checking if that requires a version
[2014-07-28 08:41:56 -0400] coderanger: SmudgerDan: you can force the issue by pinning the one you are about in the environment
[2014-07-28 08:42:10 -0400] coderanger: that will either fix it, or throw an error if no solution can be found
[2014-07-28 08:42:24 -0400] emfl: Is there anyway to restrict API calls without using chef enterprise ?
[2014-07-28 08:42:59 -0400] SmudgerDan: yes, will look at setting it in the environment, but my dev head wants to learn what is going on first =D
[2014-07-28 08:43:08 -0400] matti: Bork brok Chefs
[2014-07-28 08:43:14 -0400] matti: Oh, s/brok/bork/
[2014-07-28 08:43:17 -0400] matti: :d
[2014-07-28 08:44:27 -0400] coderanger: emfl: FOSS chef does ship with a simple two-level ACL system
[2014-07-28 08:44:43 -0400] coderanger: emfl: clients can be marked as admin or non-admin, non-admins are mostly read-only
[2014-07-28 08:45:15 -0400] coderanger: emfl: If you mean something more than that, you can use a proxy and filter on the API username header
[2014-07-28 08:45:59 -0400] coderanger: emfl: But as that can only blacklist, not whitelist, thats very error prone and not recommended in most cases
[2014-07-28 08:47:44 -0400] matti: Ohai coderanger
[2014-07-28 08:47:49 -0400] coderanger: matti: alo
[2014-07-28 09:37:12 -0400] SmudgerDan: Think I have worked it out, I assume if there are two versions of a cookbook, and the latest version has a "depends" on another cookbook, but that depends is not included on the nodes run list it falls back to a version which has all its "depends"?
[2014-07-28 09:45:43 -0400] gavala: is it supposed to be possible to set a force_override level attribute on a node?
[2014-07-28 10:02:12 -0400] coderanger: SmudgerDan: Chef takes all the cookbook deps and the version restrictions in the environment and puts it all in a big solver system
[2014-07-28 10:02:47 -0400] coderanger: SmudgerDan: It is biased towards more recent versions all other things being equal, but the highest priority for hte solver is find a solution that works (satisfies all constraints)
[2014-07-28 10:03:47 -0400] coderanger: gavala: 1) force_override isn't really a level, its just a method that sets things at the override level 2) no, nodes can only contain "normal" level attributes
[2014-07-28 10:04:54 -0400] gavala: coderanger: Thanks muchly, suspected as much
[2014-07-28 10:43:32 -0400] matti: Does this work for you folks?
[2014-07-28 10:43:33 -0400] matti: http://downloads.getchef.com/chef-dk/linux/
[2014-07-28 10:43:40 -0400] matti: No this, this: http://downloads.getchef.com/chef-dk/
[2014-07-28 10:43:46 -0400] matti: I get it without CSS
[2014-07-28 10:47:04 -0400] coderanger: looks fine to me
[2014-07-28 10:58:52 -0400] matti: Hmm
[2014-07-28 11:00:21 -0400] matti: Looks like AngularJS not working correctly in my browser window for some reason.
[2014-07-28 11:00:32 -0400] matti: I see template in plain-text on the web site.
[2014-07-28 11:01:08 -0400] Damacus: weird me too.
[2014-07-28 11:01:45 -0400] Damacus: Chrome and Firefox
[2014-07-28 11:01:54 -0400] thom: is fine in safari for me
[2014-07-28 11:02:16 -0400] matti: Damacus: Broken for you too?
[2014-07-28 11:02:28 -0400] Damacus: matti are you in Linux too? Yeah
[2014-07-28 11:02:32 -0400] matti: yeah
[2014-07-28 11:04:39 -0400] Damacus: actually it's broken in my Windows VM too.
[2014-07-28 11:05:28 -0400] Damacus: thom cached page?
[2014-07-28 11:06:27 -0400] thom: Damacus: had never visited that page
[2014-07-28 11:06:36 -0400] Damacus: ho hum
[2014-07-28 11:06:43 -0400] Damacus: I guess they only tested it in Safari
[2014-07-28 11:08:18 -0400] thom: Damacus: works in chrome too, on OS X.
[2014-07-28 11:08:24 -0400] thom: so maybe a CDN issue
[2014-07-28 11:09:16 -0400] Damacus: that would make sense
[2014-07-28 11:16:04 -0400] matti: I have a new VM with fresh FF in it and no prior cache.
[2014-07-28 11:16:12 -0400] matti: And indeed looks bork bork a bit ;]
[2014-07-28 12:00:41 -0400] kevn: I want to install apache into chef client using a recipe
[2014-07-28 12:06:51 -0400] JamesBelchamber: So I want to do an 'only_if <device is mounted>' - basically, just remount /tmp if it's already mounted. Am I missing something obvious here or is this a hassle to do?
[2014-07-28 12:07:45 -0400] zts: JamesBelchamber: which part are you finding a hassle?
[2014-07-28 12:08:04 -0400] JamesBelchamber: zts: the only_if part
[2014-07-28 12:09:30 -0400] zts: JamesBelchamber: sorry, I'm a bit confused.  You mean you're having trouble writing the expression to check if the device is mounted, or something else with the use of only_if?
[2014-07-28 12:10:58 -0400] JamesBelchamber: So, currently I have 'mount "/tmp" do, action :remount, options "exec",end', but that obviously fails where /tmp isn't a mount point
[2014-07-28 12:11:31 -0400] phelms: Hello - I have a 1k PowerShell script I want to run with Chef. Is it possible without putting the script in the recipie directly?
[2014-07-28 12:11:37 -0400] JamesBelchamber: so I want to write basically 'only_if mounted == true', but I don't think that would work
[2014-07-28 12:19:33 -0400] cloudbud: How can I deploy a folder to a directory like /var/www/ using chef ?
[2014-07-28 12:21:34 -0400] Kim^J: cloudbud: By reading the manual?
[2014-07-28 12:21:45 -0400] zts: JamesBelchamber: yeah, you'll need to be a bit more fancy than that.  Chef records the mounted filesystems (when it starts the run) in node['filesystems'], so you could do something like...
[2014-07-28 12:21:57 -0400] zts: oh, he left
[2014-07-28 12:22:29 -0400] cloudbud: No like I have an application code i want to place that directory in /var/www how can I do that? is there any recipe to do that  Kim^J
[2014-07-28 12:23:19 -0400] Kim^J: cloudbud: http://serverfault.com/questions/428970/copy-a-whole-directory-structure-in-chef
[2014-07-28 12:23:22 -0400] Kim^J: cloudbud: Google!
[2014-07-28 12:25:40 -0400] phelms: I have a 1k PowerShell script I want to run with Chef. Is it possible without putting the script in the recipie directly?
[2014-07-28 13:20:17 -0400] jaqline: Hi All , I want a recipe for installing apache to my chef client
[2014-07-28 13:20:32 -0400] jaqline: I have configured chef server, WS and chef client
[2014-07-28 13:27:27 -0400] zeroXten: can I "break" out of a ruby_block in such a way that notifies don't get triggered?
[2014-07-28 13:32:28 -0400] zeroXten: i guess i could do something dirty with run_state, a second dummy ruby_block and a guard
[2014-07-28 13:44:27 -0400] legal90: Hi, chefs! Is anybody using 'database' cookbook? I'm looking for a way to get output from 'mysql_query' resourse (https://github.com/opscode-cookbooks/database)
[2014-07-28 14:28:14 -0400] JamesBelchamber: When I use the :remount action of the mount resource, it seems to ignore my options :/
[2014-07-28 14:28:19 -0400] JamesBelchamber: Is this a known thing?
[2014-07-28 14:44:51 -0400] drywheat: Are all attribute files evaluated when invoking the default recipe?
[2014-07-28 14:49:02 -0400] zts: drywheat: a cookbook's attribute files are all evaluated when the cookbook is loaded - this happens before a recipe is loaded, and can happen even without any recipes from the cookbook being used
[2014-07-28 14:52:11 -0400] robbkidd: Can I interest anyone in sharing their opinions on a PR for PostgreSQL cookbook changing password for an existing DB user? https://github.com/opscode-cookbooks/database/pull/70
[2014-07-28 14:53:42 -0400] Neozonz: How can i modify this into ruby http://repl.it/VzD/1
[2014-07-28 14:55:09 -0400] drywheat: zts: thank you
[2014-07-28 14:57:45 -0400] gchristensen: Neozonz: what does it mean to modify it into ruby
[2014-07-28 14:58:49 -0400] Neozonz: how would i modify that to run at the console level
[2014-07-28 15:00:15 -0400] Neozonz: gchristensen, http://repl.it/VzD/2 - removed the <%
[2014-07-28 15:00:29 -0400] gchristensen: Neozonz: well you'd make it so all those hashes exist
[2014-07-28 15:00:34 -0400] gchristensen: :\ there isn't realyl anything unique there
[2014-07-28 15:00:36 -0400] Neozonz: but still running into issues = (eval):12: (eval):12: compile error (SyntaxError)
[2014-07-28 15:00:37 -0400] Neozonz: (eval):10: syntax error, unexpected ':', expecting kEND
[2014-07-28 15:00:37 -0400] Neozonz: server.iinstance['private_ip']:2888:3888
[2014-07-28 15:00:38 -0400] gchristensen: I mean, its ERB but that's it
[2014-07-28 15:01:00 -0400] gchristensen: Neozonz: its really basic ruby - maybe look up a basic ruby tutorial
[2014-07-28 15:01:07 -0400] Neozonz: can u run a erb within ruby?
[2014-07-28 15:02:01 -0400] bougyman: ri ERB
[2014-07-28 15:27:18 -0400] Neozonz: bougyman, using http://repl.it/
[2014-07-28 15:28:10 -0400] bougyman: Neozonz: can't require "erb" there.
[2014-07-28 15:28:22 -0400] Neozonz: ah so no way I guess
[2014-07-28 15:28:43 -0400] bougyman: interestingly enough... erb.rb is in .
[2014-07-28 15:28:49 -0400] bougyman: File.read("erb.rb") there.
[2014-07-28 15:28:58 -0400] bougyman: it exists, just gives a syntax error when you try to require it.
[2014-07-28 15:39:29 -0400] chef279: hey guys, im trying to make a chef recipe that will do a git sync to a directory on the node.  everything is working however, i am unaware of how to set the permissions on the directory once the sync completes or while sync runs. i can change owner and group but not permissions as 'mode 770' does not work for git "/mygitsync" do
[2014-07-28 15:40:24 -0400] bougyman: set permissions in another resource
[2014-07-28 15:40:29 -0400] bougyman: on the things you have to set permission on.
[2014-07-28 15:41:53 -0400] chef279: all files and subdirectories that are pulled from git problem is doing a chmod 770 command in the recipe, chef doesnt keep track of it and it will keep trying to set the permissions each time recipe is run, resulting in long recipe runs
[2014-07-28 15:42:12 -0400] chef279: looks like the following
[2014-07-28 15:42:25 -0400] chef279: directory '/testsyncfromgit' do         mode 0777 end  git "/testsyncfromgit" do         user "root"         group "manager"         repository "git://github.com/opscode/chef.git"         reference "master"         action :sync end
[2014-07-28 15:42:34 -0400] Neozonz: how do i set the variables for node['opsworks']['layers']['ops-dynamic-solr']['instances'] , is there a way to pass the json?
[2014-07-28 15:42:54 -0400] chef279: but permissions are changed once the sync is done and are incorrect permissions
[2014-07-28 15:44:05 -0400] chef279: but when trying the following:   git "/testsyncfromgit" do         user "root"     mode "770"     group "manager"         repository "git://github.com/opscode/chef.git"         reference "master"         action :sync end    i get incorrect syntax and recipe does not work
[2014-07-28 15:44:17 -0400] chef279: *run
[2014-07-28 15:45:15 -0400] nulleric: Neozonz: is that node attribute set by opsworks?
[2014-07-28 15:45:24 -0400] Neozonz: yes
[2014-07-28 15:45:29 -0400] Neozonz: but i want to test this locally
[2014-07-28 15:45:47 -0400] Neozonz: without chef, just using a ruby interpreter
[2014-07-28 15:47:04 -0400] nulleric: oh sorry i didnt see the backlog, your trying to test an erb. You should just be able to create that hash and render an erb
[2014-07-28 15:48:18 -0400] Neozonz: just wondering how can i recreate that hash, via a json?
[2014-07-28 15:51:13 -0400] nulleric: yes you can read in a json string/file and create a hash in ruby: https://stackoverflow.com/questions/7964282/convert-json-to-ruby-hash
[2014-07-28 15:51:33 -0400] nulleric: chef-spec is also handy to test and templates with 'real' fake nodes ;)
[2014-07-28 15:55:16 -0400] korishev: anyone know why I keep running up against "undefined method `location' for nil:NilClass" when I try to start a vagrant chef-metal box?
[2014-07-28 16:05:52 -0400] keftes: is there any best practice for installing a specific version of ruby && rubygems?
[2014-07-28 16:06:02 -0400] keftes: without building..
[2014-07-28 16:06:29 -0400] bougyman: I'm probably the minority here but I love rvm & the rvm cookbook for that.
[2014-07-28 16:06:42 -0400] keftes: i've tried rvm but getting the rubygems downgraded is impossible
[2014-07-28 16:06:47 -0400] bougyman: no it isn't
[2014-07-28 16:06:49 -0400] bougyman: I do it all the time.
[2014-07-28 16:07:01 -0400] bougyman: we have a beast of a rails 2.3.2 app i deploy with rvm and have to do that.
[2014-07-28 16:07:05 -0400] keftes: well
[2014-07-28 16:07:19 -0400] keftes: i'm using rvm::system_install just to get rvm on
[2014-07-28 16:07:34 -0400] bougyman: ah, I never use rvm::system
[2014-07-28 16:07:45 -0400] Eulipion: i think rvm is prod is janky
[2014-07-28 16:07:54 -0400] keftes: so for prod what would you do?
[2014-07-28 16:08:12 -0400] keftes: rvm_ruby 'ruby-1.9.2-p320' do
[2014-07-28 16:08:13 -0400] keftes:   rubygems_version '1.8.25'
[2014-07-28 16:08:13 -0400] keftes:   action :install
[2014-07-28 16:08:13 -0400] keftes: end   isn't working btw
[2014-07-28 16:08:17 -0400] Eulipion: i build system ruby and set my env for each app
[2014-07-28 16:08:18 -0400] bougyman: Eulipion: I hear that all the time but i've never had a problem with it.
[2014-07-28 16:08:55 -0400] bougyman: keftes: I do that resource withotu the rubygems_version attribute
[2014-07-28 16:09:08 -0400] keftes: that iwll bring you the latest rubygems (2.2.x)
[2014-07-28 16:09:17 -0400] keftes: for various reasons i need an older version
[2014-07-28 16:09:19 -0400] bougyman: instead I do an rvm_shell resource after it with  code "gem update --system 1.8.28"
[2014-07-28 16:09:25 -0400] keftes: oh
[2014-07-28 16:09:48 -0400] keftes: i'll give that a try
[2014-07-28 16:12:38 -0400] nico___: whatup fellow chefs.  Looking for a recipe assist - I want to guard a link so that it's only created if a package is installed.  This is what I have:
[2014-07-28 16:13:09 -0400] nico___: link "/bin/zsh" do
[2014-07-28 16:13:09 -0400] nico___:   to "/usr/local/bin/zsh"
[2014-07-28 16:13:10 -0400] nico___:   only_if { node['not sure what I ened here'] }
[2014-07-28 16:13:11 -0400] nico___: end
[2014-07-28 16:14:01 -0400] nico___: I think the 'not sure what I need here'  needs to be something like "{node['package'],['zsh']}"
[2014-07-28 16:17:30 -0400] jtimberman: nico___: only_if "rpm -q foo" ?
[2014-07-28 16:17:41 -0400] jtimberman: or dpkg -l | grep foo
[2014-07-28 16:17:51 -0400] jtimberman: where youd want the grep to be carefully crafted
[2014-07-28 16:20:45 -0400] someara: why not just put a link resource after a package resource? it would implicitly depend on it then
[2014-07-28 16:20:47 -0400] keftes: bougyman: for some reason it's not downgrading rubygems - this is what i'm using: http://pastebin.com/Uf578edu
[2014-07-28 16:20:52 -0400] nico___: ok, that makes perfect sense.  and I wil l probbaly use it - but is it posisble to be more "chef-like" in terms of looking for an attribute?  "only_if { node.run_list.include?('recipe[cookbook::recipe]') }"  would check if the recipe is in the run list - but is there an equivalent to querying the node attributes for installed packages?
[2014-07-28 16:21:11 -0400] vluther: is there a place that lists the different options available to knife environment show -F ?  , I know JSON exists, but what else?
[2014-07-28 16:21:49 -0400] nico___: @somera - I'm already doing that, but I thought I might want an extra layer of preotection
[2014-07-28 16:23:27 -0400] bougyman: keftes: odd, that's almost identical to mine
[2014-07-28 16:23:34 -0400] bougyman: but mine is a user_install
[2014-07-28 16:24:41 -0400] bougyman: do you see your 'downgrade rubygems' resource run successfully?
[2014-07-28 16:25:35 -0400] keftes: yes - that's all i get with debug turned on: http://pastebin.com/yc0G2sfX
[2014-07-28 16:35:58 -0400] a13x212: anyway to force a  chef_gem not to be installed at the beginning of a run?
[2014-07-28 16:43:41 -0400] rbowlby: How does everyone feel (emotional ops) about using one "roles" cookbook vs per-role cookbooks?
[2014-07-28 16:44:06 -0400] gyoza: i feel it works for me:)
[2014-07-28 16:44:06 -0400] jblack: the so-called berkshelf way?
[2014-07-28 16:44:20 -0400] rbowlby: yep
[2014-07-28 16:44:39 -0400] jblack: We have had problems when using a "roles" type cookbook.
[2014-07-28 16:44:39 -0400] gyoza: i like it because you can have apache, php, whateverelseweb crap in their own books
[2014-07-28 16:44:45 -0400] gyoza: and  you can have webserver roles
[2014-07-28 16:45:19 -0400] rbowlby: gyoza, so you have just one companyname-roles kind of cookbook with each role being a recipe then
[2014-07-28 16:45:42 -0400] gyoza: no each role is a set of books
[2014-07-28 16:46:00 -0400] jblack: The metadata.rb got pretty loaded up with lots of deployments, which maked convergence pretty painful. Also, we had problems with developer walkover.
[2014-07-28 16:46:20 -0400] rbowlby: gotcha, so I have for instance in dev a single node that is full-stack, and in staging two nodes one app and one db.
[2014-07-28 16:46:20 -0400] gyoza: i see
[2014-07-28 16:46:44 -0400] rbowlby: the full-stack role is so closely related to the two-node stack that it appears to make sense in one cookbook no?
[2014-07-28 16:46:59 -0400] jblack: Developer 1 would work on role A, developer 2 would work on role B, and berks uploads would stomp on each other.
[2014-07-28 16:47:09 -0400] gyoza: it entirely depends on what is in the cookbook.
[2014-07-28 16:47:26 -0400] rbowlby: have an example of your role books gyoza/
[2014-07-28 16:47:39 -0400] jblack: I think it depends on the scale of the project? It works pretty well if you're a one man band, or if you have a solid integration point.
[2014-07-28 16:47:40 -0400] rbowlby: jblack, I'm not clear on how they stomped on each other, can you elaborate?
[2014-07-28 16:48:21 -0400] gyoza: My opinion is that you make it as modular as possible so that you can fix/break 1 thing instead of 100 things
[2014-07-28 16:48:35 -0400] gyoza: that can apply to any situation imo
[2014-07-28 16:48:53 -0400] jblack: oh, for example, I'd work on roles for the fluend server, and wipe out his msvc++ cookbooks.
[2014-07-28 16:49:04 -0400] gyoza: i wouldnt wipe anything out
[2014-07-28 16:49:05 -0400] gyoza: start new ones
[2014-07-28 16:49:24 -0400] gyoza: i have a policy of never delete until its not been used for a year
[2014-07-28 16:49:25 -0400] gyoza: loool
[2014-07-28 16:49:43 -0400] jblack: Wipe out new changes..   We weren't versioning cookbooks, so he'd do a berks upload --force to the test env, then I'd do the same for my work, and his work evaporated
[2014-07-28 16:50:09 -0400] rbowlby: that just means you didn't pull in his changes right?
[2014-07-28 16:50:27 -0400] jblack: That means he often didn't commit his test work to git before he uploaded it into the test environment.
[2014-07-28 16:50:34 -0400] rbowlby: that's more of a workflow modification that needs to happen and not an issue with book based roles
[2014-07-28 16:50:37 -0400] jblack: and he also didn't always git pull.
[2014-07-28 16:50:55 -0400] jblack: Right. Like I said, "or if you have a solid integration point"
[2014-07-28 16:50:56 -0400] rbowlby: he sounds like a real winner
[2014-07-28 16:51:21 -0400] jblack: shrug. he's human.
[2014-07-28 16:51:42 -0400] jblack: I'm sure it works a lot better if you have jenkins in the mix to lint out cookbooks and to handle berks upload.
[2014-07-28 16:52:23 -0400] rbowlby: sounds like maybe a hybrid approach, maybe a cookbook per role-type. e.g. a service role cookbook with multiple roles related to that service (full-stack, two-node), and a sep book for unrelated roles
[2014-07-28 16:52:53 -0400] jblack: I think you'll be less likely to hit contention issues that way.
[2014-07-28 16:52:54 -0400] rbowlby: jblack, for sure. I have zero CI right now. I do have lint running on VIM writes and that helps
[2014-07-28 16:53:16 -0400] jblack: Yeah. Then you really want to avoid people trying to work on the same cookbook at the same time.
[2014-07-28 16:53:24 -0400] rbowlby: cool, I'm very unfortunately a one man band right now
[2014-07-28 16:53:47 -0400] jblack: Especially if you're not doing veresioning right during early dev.
[2014-07-28 16:54:00 -0400] rbowlby: anyone looking for a remote ops eng position? /solicitation
[2014-07-28 16:54:11 -0400] jblack: In that case, you won't have a resource contention. You can just upload with  abandon. =)
[2014-07-28 16:54:40 -0400] jblack: throw shit against the wall until it looks right, rev the cookbook, and commit. =)
[2014-07-28 16:54:46 -0400] rbowlby: lol, still need to figure out an env freezing strategy
[2014-07-28 16:54:52 -0400] rbowlby: lol
[2014-07-28 16:55:11 -0400] rbowlby: that's my next commit msg: "thowing shit against the wall"
[2014-07-28 16:55:30 -0400] jblack: next revision. "that one didn't stick. trying this"
[2014-07-28 17:01:08 -0400] nico___: What's the best way to put a guard in to my base role so that something only gets executed if node's run list does not contain a specific recipe?  IE) base_role creates a symlink, but if the machine has a specific recipe in it's run list then it skips the link (because the role in quiestion creates it's own verison)
[2014-07-28 17:01:49 -0400] nico___: or should I not bother ands just let the base role create the default, then have the recipe modify the link when it's run
[2014-07-28 17:02:07 -0400] jblack: you don't want to do that. Your recipe will flaip
[2014-07-28 17:02:52 -0400] jblack: not_if { node.recipes.include?(recipe_name) }   might work for you
[2014-07-28 17:04:42 -0400] nico___: that's what I was worried about.
[2014-07-28 17:05:05 -0400] nico___: I wasn't sure that node.recipes.include?(recipe) was valid.
[2014-07-28 17:05:12 -0400] nico___: good to know that it is, I'll give it a shot
[2014-07-28 17:05:33 -0400] jblack: I just stole it from stackoverflow. ymmv
[2014-07-28 17:05:53 -0400] nico___: interesting, I was actually searching for that on so before I posted here.
[2014-07-28 17:05:58 -0400] nico___: can i get a link please?
[2014-07-28 17:06:10 -0400] jblack: http://stackoverflow.com/questions/17330553/chef-node-check-if-recipe-will-run-on-it-looking-inside-roles-as-well
[2014-07-28 17:07:06 -0400] nico___: any idea of the syntax for recipe_name?  Like: not_if { node.recipes.include?("my_cookbook::my_recipe") }
[2014-07-28 17:07:30 -0400] nico___: as opposed to:    not_if { node.recipes.include?("my_recipe") }
[2014-07-28 17:07:47 -0400] jblack: I believe the former
[2014-07-28 17:08:52 -0400] nico___: I'll start with that one.  this is why we test.  :)  thanks!
[2014-07-28 17:09:06 -0400] zts: nico___: alternatively, get the specific recipe to change the parameters of the link resource if it is already defined
[2014-07-28 17:11:33 -0400] jblack: hey, how do you guys deal with pruning old nodes in chef within the context of autoscaling?
[2014-07-28 17:11:59 -0400] jblack: a crontab to delete any node+client  that hasn't been seen in more than x days?
[2014-07-28 17:12:41 -0400] phelms: If I wanted to store a file in the "files" folder and include it as part of my script (powershell) what would be the path? just files/nameoffile.ps1  ?
[2014-07-28 17:12:53 -0400] bmhatfield: jblack: I wrote this a long time ago specifically for autoscaling: https://github.com/bmhatfield/chef-deregistration-manager
[2014-07-28 17:14:06 -0400] bmhatfield: jblack: There's a blog post link at the bottom that sets a lot of extra context to help understand the point of that thing.
[2014-07-28 17:14:53 -0400] jblack: I suppose sqs Amazon's version of rabbit, and that autoscaling events can be crammed into queues?
[2014-07-28 17:15:41 -0400] jblack: I have usually used rightscale for autoscaling. I'm not sure what aws' tastes like
[2014-07-28 17:17:44 -0400] cschneid: I'm running into a Berkshelf issue: `Berkshelf::CommunitySiteError: An unexpected error occurred retrieving 'database' (2.2.0) from the cookbook site at ''` -- Any idea what's up with that?
[2014-07-28 17:18:06 -0400] jblack: can you pastebin your berksfile?
[2014-07-28 17:18:38 -0400] cschneid: jblack: https://gist.github.com/b3e0e7af58de36301175
[2014-07-28 17:18:50 -0400] cschneid: nothing too tricky - just added the database & chef vault lines - was working previously
[2014-07-28 17:18:56 -0400] cschneid: although I haven't reverted and checked if it does
[2014-07-28 17:19:19 -0400] cschneid: ahh, it worked before because I had everything cached
[2014-07-28 17:22:32 -0400] cschneid: jblack: updated w/ the error - it seems to do the resolving of the versions correctly, but then fails to actually fetch them.
[2014-07-28 17:25:52 -0400] andydba: I have a ruby method inside provider that I wrote
[2014-07-28 17:25:59 -0400] patbyrne: cschneid: try changing to use https://api.berkshelf.com instead of http
[2014-07-28 17:26:07 -0400] andydba: the ruby method runs a bash resource
[2014-07-28 17:26:17 -0400] patbyrne: I've seen something similar that was caused by redirects failing
[2014-07-28 17:26:39 -0400] cschneid: patbyrne: crazy, that worked.
[2014-07-28 17:26:41 -0400] cschneid: thanks!
[2014-07-28 17:26:48 -0400] andydba: how do I return true or false from this method back to the caller?
[2014-07-28 17:27:11 -0400] jtimberman: for berkshelf 3+, i'd recommend using https://supermarket.getchef.com - api.berkshelf.com redirects there anyway.
[2014-07-28 17:28:51 -0400] patbyrne: I think the redirect issue is fixed in 3.1.4
[2014-07-28 17:31:59 -0400] heathsnow: anyone else having an issue with ci_reporter gem and chef_minitest?
[2014-07-28 17:39:10 -0400] vt102: Any issues running the RHEL ChefDK on Amazon Linux?  It's mostly ruby gems, right?  So it should be fine?
[2014-07-28 17:40:28 -0400] keftes: works fine on Oracle linux
[2014-07-28 17:41:03 -0400] keftes: which is basically a rebranded rhel with various kernel patches
[2014-07-28 17:44:55 -0400] nico___: if I delete a recipe from a cookbook and then do "knife cookbook upload -a" do I need to do anything further to explicitly tell my chef server that the recipe has been removed?
[2014-07-28 17:46:29 -0400] btm: andydba: if you're doing a simple test to decide if a resource in your method runs or not, use an only_if/not_if block and pass it a string with the command to run.
[2014-07-28 17:46:32 -0400] jameson_: nico___: no, you might want to clean up your metadata.rb if that has some info on the recipe that is gone
[2014-07-28 17:46:52 -0400] nico___: cool, thanks!
[2014-07-28 17:47:26 -0400] jameson_: I just realized the channel message still points to www.opscode.com (homepage)
[2014-07-28 17:49:07 -0400] nico___: jameson_ thre doesn't seem to be a reference to the recipe in the cookbook's metadata.rb - is that what you were describing or have I missed something?
[2014-07-28 17:49:22 -0400] btm: andydba: if you need to run a command and evalute the exit code for more logic, look at something like: foo = Mixlib::ShellOut.new("my-command") ; foo.run_command ; foo.exitstatus
[2014-07-28 17:54:42 -0400] Cuzner: Can anyone tell me why this isn't doing what I want? I'm trying to ensure that all log files in /var/log/asterisk are 0644 and all subdirs are 0755 with root:asterisk ownership - http://hastebin.com/xuyegesacu.rb
[2014-07-28 17:55:15 -0400] Cuzner: following the example given in the directory resource doc page
[2014-07-28 17:56:41 -0400] jpoole: you need to look at the recursive option
[2014-07-28 17:56:58 -0400] jpoole: %w[ "/var/log/asterisk/*" ].each do |path| #<-- i dont' think that will work
[2014-07-28 17:58:25 -0400] jpoole: you'd have to do something like '%w{dir1 dir2 dir3}.each do |dir|' AFAIK
[2014-07-28 17:59:10 -0400] jpoole: although I see the example you are referring to now.
[2014-07-28 17:59:23 -0400] Cuzner: jpoole: yes, the one near http://docs.getchef.com/resource_directory.html#recursive-directories
[2014-07-28 17:59:39 -0400] jpoole: yeah, is there a large number of actions to do?
[2014-07-28 17:59:57 -0400] jpoole: Chris Cuzner - as in plastik?
[2014-07-28 18:00:09 -0400] Cuzner: jpoole as in JP?!
[2014-07-28 18:00:18 -0400] jpoole: ffs, i am talking to the paw.
[2014-07-28 18:00:26 -0400] Cuzner: funny how things work eh? ;)
[2014-07-28 18:00:41 -0400] jpoole: word
[2014-07-28 18:00:50 -0400] Cuzner: now all we need is nerg
[2014-07-28 18:00:54 -0400] Cuzner: oh and disco
[2014-07-28 18:06:50 -0400] onefrankguy: Cuzner: You can use a glob pattern. Dir["/var/log/asterisk/*"].each do |path|
[2014-07-28 18:07:16 -0400] Cuzner: onefrankguy: okay, i'll give that and what JPs given me a try, thanks.
[2014-07-28 18:13:30 -0400] keftes: has anyone worked with moving files off a windows share (to a linux node) ?
[2014-07-28 18:13:50 -0400] keftes: remote_file isn't actually an option
[2014-07-28 18:15:44 -0400] zaargy: keftes: can't you use remote file with file:/// as the source?
[2014-07-28 18:15:51 -0400] zaargy: assuming you've mounted the windows share on the linux node
[2014-07-28 18:17:44 -0400] keftes: trying to get the mount resource to work for me - i thought there was another option, similar to remote_file
[2014-07-28 18:20:56 -0400] zaargy: well there is ruby-net-smb - probalby wouldn't be hard to make it support smbfs:/// directly
[2014-07-28 18:33:27 -0400] tbenz9: Hello All,  I have 2 workstations, an Ubuntu and Windows 7 laptop, both are on the same network.  When i run my knife bootstrap from Ubuntu it works fine, when I run it from Windows, it doesn't run.  It also doesn't report and error, it just says "waiting for remote response..."
[2014-07-28 18:34:07 -0400] tbenz9: Any troubleshooting tips on why the exact same command would work from Ubuntu, but not from Windows 7?
[2014-07-28 18:35:21 -0400] davidordave: Is there a particular reason that many community cookbooks went from a versioning scheme of x.y.z to vx.y.z? Obviously not a big deal, I was just curious if there is a technical or standard that I am unaware of.
[2014-07-28 18:36:05 -0400] mikeface: is there a way to override an attribute in a role with the value from another attribute?  for example, node['hostname'] = "myhost", node['tags'] = "stuff" + node['hostname']
[2014-07-28 18:38:46 -0400] Eulipion: does anyone have a vagrantfile i can take a peek at for setting up multiple hosts with static ips.  all my mine are coming up with the same IP ;(
[2014-07-28 18:41:46 -0400] davidordave: @mikeface, I dont believe so as they are compiled when you upload them and from then on live as json. Someone else might know better. The documentation doesnt seem to indicate that you can access node attributes in roles (though that isnt saying much)
[2014-07-28 18:45:11 -0400] thehar: win 14
[2014-07-28 18:52:43 -0400] meth: does chef-client really authenticate the begin of a run and not with each request?  I'm running into this issue where after long runs even things like templates start to 403: http://stackoverflow.com/questions/23943089/chef-client-throws-403-forbidden-intermittently
[2014-07-28 18:55:02 -0400] lamont_oc: meth: it authenticates every run, youre seeing urls timing out after 15m
[2014-07-28 18:55:34 -0400] lamont_oc: https://tickets.opscode.com/browse/CHEF-3045
[2014-07-28 18:55:46 -0400] meth: why would an url timeout? I'm not using hosted chef with s3 or anything which is what that ticket talks about
[2014-07-28 18:55:57 -0400] meth: we run our own local chef server and don't use s3
[2014-07-28 18:56:09 -0400] lamont_oc: youre using bookshelf then which is the same difference
[2014-07-28 18:56:54 -0400] meth: hm.. so chef server has some thing called a bookshelf that has timestamps in the signed request so stop replay attacks?
[2014-07-28 18:57:11 -0400] lamont_oc: yeah its a mini-s3
[2014-07-28 18:58:14 -0400] meth: wouldn't you call this a bug in the client though? I mean the client/server protocol should know about this and ask to regenerate new bookshelf urls if the run is taking longer than the timeout?
[2014-07-28 19:00:06 -0400] lamont_oc: well the generation of the urls is occuring on the cookbook_version endpoint that returns the whole manifest.  hitting that again to refresh the urls would be messy.  you could have an authenticated endpoint that you hit and offered an expired url and ask for a refresh, but thats more moving parts.
[2014-07-28 19:00:22 -0400] lamont_oc: chef-12 will have no_lazy_load turned on by default which will mitigate the problem
[2014-07-28 19:00:37 -0400] lamont_oc: the server will also have the ttl upped to 8h
[2014-07-28 19:01:30 -0400] btm: Developer Office Hours: Join: bit.ly/1tiXt4b Watch: bit.ly/1tiXt4d
[2014-07-28 19:03:08 -0400] lamont_oc: i think theres also been some discussion of having bookshelf accept chef authentication, so instead of having a timestamped url, the client could just sign requests to bookshelf, and we could switch to using that, but doing that wouldnt help hosted cutomers unless we took cookbooks off s3 for hosted
[2014-07-28 19:03:13 -0400] meth: well i guess that would help.  someone in 3045 made a good point that you could end up downloading a bunch of files you would never need?
[2014-07-28 19:03:21 -0400] lamont_oc: yes
[2014-07-28 19:04:01 -0400] lamont_oc: if youre doing file distribution via your cookbooks and arent compartmentalizng the files by cookbook, then when you sync the whole cookbook you could get a lot of files downloaded that the client didnt need
[2014-07-28 19:04:21 -0400] meth: well s3 supports auth as well you don't have to use the timeout option as far as i know? which would make the client needs to have an s3 access key and what not..
[2014-07-28 19:05:08 -0400] lamont_oc: yeah thatll get a bit crazy on hosted with multiple customers and managing all that key material
[2014-07-28 19:05:16 -0400] lamont_oc: and the acls in s3
[2014-07-28 19:06:05 -0400] meth: yea it would probably be more complicated
[2014-07-28 19:06:10 -0400] lamont_oc: it would
[2014-07-28 19:06:29 -0400] coderanger: Also if your chef runs take that long regularly, you're going to have a bad time :)
[2014-07-28 19:06:32 -0400] onefrankguy: mikeface: Take a look at the wrapper cookbook pattern. It gives you a way to put business logic in roles. http://www.getchef.com/blog/2013/12/03/doing-wrapper-cookbooks-right/
[2014-07-28 19:06:43 -0400] meth: so wait what are saying about compartmentalizing files? is there a best practice? I'm not even sure I have a good way to test to see if my cookbooks would be affected..
[2014-07-28 19:07:35 -0400] meth: coderanger:  well we install a ton of things via homebrew and what not on our osx setup which takes a long time but i could picture other things taking a long time too..
[2014-07-28 19:07:46 -0400] lamont_oc: if you have 18 files in a cookbook which are 2GB in size and only a few servers need each one of those itd be bad.  ever server with that cookbook would get every file.  youd want 18 cookbooks with one 2GB file and then only add those cookbooks to the clients that really need them.
[2014-07-28 19:08:08 -0400] coderanger: meth: That only take a long time the first time, it will still converge over time
[2014-07-28 19:08:29 -0400] meth: yea just can't control all the time what a 3rd party cookbook does and you don't always want to invest time to write your own if community is already using another one
[2014-07-28 19:08:54 -0400] lamont_oc: im not aware of any community cookbooks that check in enormous binaries to the cookbook directly
[2014-07-28 19:09:23 -0400] meth: coderanger:  right we have to run it multiple times then after hte first run it's fine... but it's something I was looking to figure out since it's going to waste everyone's cycles over and over.. or i thought maybe inject no_lazy_load only during hte first initial run...
[2014-07-28 19:09:24 -0400] lamont_oc: most everyone slurps from a url somewhere
[2014-07-28 19:10:02 -0400] lamont_oc: if you set no_lazy_load once then the downloads are cached, and you dont hit that penalty on every run
[2014-07-28 19:10:58 -0400] lamont_oc: you most likely dont care about no_lazy_load, and it will be the default for chef-12
[2014-07-28 19:11:24 -0400] lamont_oc: (dont care in the sense that you dont care about the side-effect)
[2014-07-28 19:11:50 -0400] meth: yea but downloading a large file could take a long time too! an initial osx setup might install a bunch of apps like chrome, adium, firefox, etc you name it.. so you could easily go over the 15m time?
[2014-07-28 19:11:51 -0400] zanshin: Can the attribute definition of a resource make use of the enclosing cookbooks attributes? I.e., `attribute :webapp_location, :default => node["tomcat"]["tomcat_webapps"], :kind_of => String` ?
[2014-07-28 19:12:17 -0400] meth: yea at this point we just agreed to basically just enable eagerly loading
[2014-07-28 19:12:36 -0400] medya: how to capture the return state of a shell script in chef cookbook?  ( let say run this shell secript if it returned 1 do this ..if it returned 0 do that... )
[2014-07-28 19:14:09 -0400] coderanger: zanshin: Not on its own, poise allows this though
[2014-07-28 19:14:33 -0400] meth: thanks lamont_oc coderanger
[2014-07-28 19:14:45 -0400] meth: would be nice if this info was in that ticket too :]
[2014-07-28 19:15:09 -0400] coderanger: medya: That isn't how Chef works generally, if its something simple you can use not_if/only_if
[2014-07-28 19:15:14 -0400] zanshin: coderanger: Thanks. I'll check it out
[2014-07-28 19:15:19 -0400] meth: maybe it is but when it mentioned stuff like erchef[s3_url_ttl] i was like huh? we don't use s3... maybe this isn't the same issue...
[2014-07-28 19:15:55 -0400] medya: @coderanger but how can u say not_if  the shell script returned 1 ?
[2014-07-28 19:16:43 -0400] azr3t: does anyone know if by specifying knife[:secret_file] that it uploads the secret key as necessary?
[2014-07-28 19:16:52 -0400] coderanger: medya: You can't check ==1 specifically, just !=0
[2014-07-28 19:16:56 -0400] azr3t: or do you have to manually place the key on the server with bootstrap
[2014-07-28 19:17:02 -0400] azr3t: prior to bootstrap*
[2014-07-28 19:17:21 -0400] coderanger: azr3t: It uploads the secret on bootstrap
[2014-07-28 19:17:22 -0400] medya: @coderanger how to check if returned state !=0 ...which documentation should I read for that
[2014-07-28 19:17:35 -0400] coderanger: azr3t: I think it uses the normal Chef::Config key though
[2014-07-28 19:17:39 -0400] Eulipion: medya: if its an execute, you can specify "returns <x>", then wrap it in a begin/rescue and handle the exception
[2014-07-28 19:17:43 -0400] coderanger: medya: thats what not_if does
[2014-07-28 19:18:07 -0400] coderanger: Eulipion: No, that wouldn't work
[2014-07-28 19:18:11 -0400] Eulipion: ;(
[2014-07-28 19:18:19 -0400] coderanger: Eulipion: Remember chef is a two-pass system
[2014-07-28 19:18:23 -0400] azr3t: coderanger boo, it doesnt retain the name
[2014-07-28 19:18:25 -0400] azr3t: that could be an issue
[2014-07-28 19:18:44 -0400] medya: not_if execute "./pathToShellScript.sh"!=0  ?
[2014-07-28 19:19:54 -0400] a13x212: anyway to delay a chef_gem being installed at the beginning of the run?
[2014-07-28 19:20:18 -0400] coderanger: medya: not_if "./pathToScript.sh"
[2014-07-28 19:20:39 -0400] coderanger: medya: not_if and only_if are guard clauses, you can prevent certain resources from executing if their conditions aren't met
[2014-07-28 19:20:51 -0400] coderanger: a13x212: Use gem_package?
[2014-07-28 19:21:01 -0400] coderanger: a13x212: chef_gem is defined as gem_package but at compile time :)
[2014-07-28 19:21:12 -0400] medya: so only if by default checks for if it is == 0 ?
[2014-07-28 19:21:49 -0400] coderanger: medya: only_if means ==0, not_if means !=0
[2014-07-28 19:22:01 -0400] coderanger: these are standard shell conditional semantics
[2014-07-28 19:22:10 -0400] medya: gotcha thanks
[2014-07-28 19:24:43 -0400] a13x212: coderanger, i thought chef_package was for the system-wide ruby instance
[2014-07-28 19:25:32 -0400] coderanger: a13x212: chef_gem you mean? Yeah, but you can do that with gem_package too
[2014-07-28 19:26:00 -0400] coderanger: a13x212: https://github.com/opscode/chef/blob/master/lib/chef/resource/chef_gem.rb#L31
[2014-07-28 19:26:04 -0400] coderanger: thats the whole impl :)
[2014-07-28 19:28:26 -0400] double_p: only chef allows you that http://www.youtube.com/watch?v=wipMf4O2qEs :)
[2014-07-28 19:30:21 -0400] meth: is there a pragmatic (if that's the right term) way to add a user to a role from a bootstrap script?
[2014-07-28 19:31:54 -0400] coderanger: meth: Role?
[2014-07-28 19:32:00 -0400] coderanger: meth: Do you mean a unix group?
[2014-07-28 19:32:13 -0400] meth: sorry i meant adding a role to a node
[2014-07-28 19:32:53 -0400] coderanger: meth: Sure, https://github.com/coderanger/brix/blob/master/packer/client-bootstrap.sh#L32-L34 is my old CloudFormation bootstrap script
[2014-07-28 19:33:58 -0400] meth: lol fair enough
[2014-07-28 19:34:29 -0400] azr3t: is anyone still seeing the nginx plugin failure with ohai?
[2014-07-28 19:35:39 -0400] quantumfoam: if I want to access a specific key within a data bag item, would the syntax be data_bag_item("bag:item["key"]") ?
[2014-07-28 19:36:01 -0400] meth: i just had this weird issue though where doing that complained that node['current_user'] wasn't defined?
[2014-07-28 19:36:28 -0400] medya: does chef have more market share than puppet?
[2014-07-28 19:36:36 -0400] coderanger: quantumfoam: No, there is no such syntax
[2014-07-28 19:37:03 -0400] coderanger: meth: There are no formal measurements I know of, but probably not, puppet has a 2-3 year head start
[2014-07-28 19:37:07 -0400] quantumfoam: ok, is there a way to do that?
[2014-07-28 19:37:13 -0400] coderanger: er, medya ^^
[2014-07-28 19:37:31 -0400] quantumfoam: the items in question have only one key
[2014-07-28 19:37:32 -0400] coderanger: quantumfoam: data_bag_item('bagname', 'itemname')['key']
[2014-07-28 19:37:42 -0400] coderanger: quantumfoam: The return value of data_bag_item is just a hash
[2014-07-28 19:38:01 -0400] quantumfoam: ok so placing the ['key'] after it selects the key from the hash?
[2014-07-28 19:38:25 -0400] medya: do you guys all agree that chef is better than puppet ?
[2014-07-28 19:38:36 -0400] medya: I think it is better because the cookbook are is pure ruby
[2014-07-28 19:38:43 -0400] medya: not made up language
[2014-07-28 19:38:45 -0400] meth: coderanger:  sorry did i mention puppet?  btw in your bootstrap you pass --json-attributes does that role you set end up getting pushed to the server for the next run?
[2014-07-28 19:38:45 -0400] medya: what do yo uthink
[2014-07-28 19:39:00 -0400] coderanger: meth: You didn't, I mistabbed on "me"
[2014-07-28 19:39:03 -0400] meth: medya:  yea i agree
[2014-07-28 19:39:27 -0400] coderanger: medya: Thats a loaded question and this isn't a good place to get entirely unbiased answers
[2014-07-28 19:39:58 -0400] medya: what would be one good thing about puppet that chef might not be totaly as good as pupet ?
[2014-07-28 19:40:22 -0400] coderanger: medya: Puppet can do static analysis on the catalog in a way chef cannot
[2014-07-28 19:40:40 -0400] meth: my personal feeling is ruby is a great dsl language and adding the extra layer of managing your own language is a huge amount of work on puppet and it never feels good enough to me.. you can't even do simple things like loop over arrays (naturally) or hashes etc.. tons of weird bugs too and for what?
[2014-07-28 19:41:05 -0400] medya: @coderanger by catalog u mean cookbooks ? can you provide an example
[2014-07-28 19:41:33 -0400] doug1: it seems like chef isn't LDAP aware...
[2014-07-28 19:41:34 -0400] coderanger: medya: The set of compiled puppet modules
[2014-07-28 19:41:46 -0400] meth: coderanger:  chef's dsl still loads everything up in a declarative way so couldn't it analyze the internal structure it builds up?
[2014-07-28 19:41:53 -0400] coderanger: doug1: Thats a very broad question, in fact it isn't even a question, please ask an actual question
[2014-07-28 19:42:14 -0400] Cuzner: lol
[2014-07-28 19:42:25 -0400] coderanger: meth: No, it isn't fully declarative. There is no way to know if a given recipe has side-effects at compile time
[2014-07-28 19:42:38 -0400] doug1: coderanger: Is Chef LDAP aware? I have a system where LDAP is configured and working and a directory resource with owner/group is put making that directory owned by the given owner and group
[2014-07-28 19:42:42 -0400] coderanger: meth: why-run mode is a compromise that tries to do its best, but it is easily fallible
[2014-07-28 19:42:50 -0400] meth: coderanger:  right but isn't that the users fault for writing non side affect free code?
[2014-07-28 19:43:06 -0400] chip-: Just gonna leave this here: http://blog.afistfulofservers.net/post/2012/12/21/promises-lies-and-dryrun-mode/
[2014-07-28 19:43:11 -0400] coderanger: doug1: As aware as anything else on the system, it just calls chmod() on the file
[2014-07-28 19:43:33 -0400] doug1: coderanger: which works when done manually on the CLI. I guess something else is up
[2014-07-28 19:43:38 -0400] coderanger: meth: Yes, but puppet can actually promise that it won't do the wrong thing
[2014-07-28 19:43:52 -0400] coderanger: meth: Just saying its an example of something puppet does better :)
[2014-07-28 19:43:57 -0400] double_p: ( http://www.youtube.com/watch?v=p2avgX1fPH8 )
[2014-07-28 19:44:08 -0400] meth: coderanger:  can it really? what if i write a ruby plugin? or add a factor plugin?
[2014-07-28 19:44:24 -0400] coderanger: meth: Also to answer your question, yes, the -j data gets saved back up to the server _if the run succeeds_
[2014-07-28 19:44:37 -0400] coderanger: meth: Neither of those are modules :P
[2014-07-28 19:44:39 -0400] meth: in puppet I noticed people were always trying to use factor to get around some things and then when factor caches the result isn't even more confusing
[2014-07-28 19:44:55 -0400] doug1: So, with this ... http://pastebin.com/N94zGms7 the users home directory is being being set to user.user...
[2014-07-28 19:45:03 -0400] doug1: is NOT being set rather
[2014-07-28 19:46:17 -0400] meth: coderanger:  it would be interesting if there was some way to warn on code that can cause side affects
[2014-07-28 19:46:27 -0400] quantumfoam: well there's always the gartner quadrant
[2014-07-28 19:46:34 -0400] quantumfoam: I think chef is higher up
[2014-07-28 19:46:37 -0400] coderanger: meth: Look up the "halting problem" ;-)
[2014-07-28 19:46:49 -0400] coderanger: meth: If you can solve that for a general case, you get a PhD
[2014-07-28 19:46:53 -0400] meth: lol
[2014-07-28 19:46:59 -0400] meth: well...
[2014-07-28 19:47:09 -0400] meth: I'm not saying if the code will run forever
[2014-07-28 19:47:36 -0400] meth: i mean in the strict sense that the code is touching the system instead of using a declarative chef lwrp or whatever...
[2014-07-28 19:47:38 -0400] coderanger: meth: Its effectively the same problem (isomorphic)
[2014-07-28 19:47:45 -0400] Neozonz: what is the berksfile for the aws/opsworks-cookbooks?  I'm trying -> cookbook 'unicorn', github: 'aws/opsworks-cookbooks', rel: 'unicorn'
[2014-07-28 19:47:52 -0400] doug1: With this http://pastebin.com/N94zGms7... if the user isn't local, it doesn't work. However, LDAP is configured correctly. If the user _IS_ local, it works, so it seems that chef doesn't honor LDAP
[2014-07-28 19:48:22 -0400] azr3t: anyone know why i would still be having a problem with this https://tickets.opscode.com/browse/COOK-4533?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel
[2014-07-28 19:48:33 -0400] coderanger: doug1: Is chef the thing setting up LDAP support during the same run? NSS APIs are only initialized at the start of a process
[2014-07-28 19:49:09 -0400] coderanger: doug1: Make this work with chmod() and chef will follow suit
[2014-07-28 19:49:12 -0400] azr3t: I am using Chef-11.12.0 and ohai 7.0.0, says this bug was fixed in 11.12.0
[2014-07-28 19:49:58 -0400] coderanger: azr3t: Where does it say it was fixed?
[2014-07-28 19:50:21 -0400] coderanger: azr3t: That ticket was closed as a dup, the other one (https://tickets.opscode.com/browse/OHAI-562) says fixed in ohai 7.0.2
[2014-07-28 19:50:23 -0400] meth: coderanger:  i guess since ruby is so dynamic too you can never really know wth is going on until you run it but i mean if it was more static couldn't you easily detect statements that aren't wrapped in WhyRun that do things like read/write files or other operations? I mean kinda like how in haskell you throw an error if your not wrapped in a monad? (if i have any idea what I'm talking about lol)
[2014-07-28 19:50:48 -0400] azr3t: yes in ohai 7.0.2 sorry, not sure how to force my specific client to hit 7.0.2 then in its current state
[2014-07-28 19:51:03 -0400] coderanger: meth: Like I said, why-run is a compromise, it covers the 90% case :)
[2014-07-28 19:51:20 -0400] coderanger: meth: making it more complex to deal with people doing weird stuff was deemed not helpful
[2014-07-28 19:51:40 -0400] meth: coderanger:  i always figured that chef's dsl would still build an internal structure of all the resources that you could perform tests on
[2014-07-28 19:52:23 -0400] meth: yea i mean chef gives you the freedom to run any code you want and I like that personally.. if you go outside of it you better have good reason and honestly in puppet half the time people use exec{} calls to get around puppet being weird
[2014-07-28 19:52:33 -0400] coderanger: meth: It does, but there is nothing stopping you from putting `rm -rf /` in the middle of a recipe :)
[2014-07-28 19:52:53 -0400] coderanger: meth: And if you run that in why-run mode, you're going to have a bad day :)
[2014-07-28 19:53:58 -0400] meth: but a puppet ruby plugin / factor plugin  couldn't do the same thing?  i know that puppet compiles the manifest server side and sends it to the client but I'm not 100% sure on details of ruby code in plugins.. and i know people use factor plugins to try and run code on hte actual client..
[2014-07-28 19:54:25 -0400] coderanger: meth: You can do static analysis without run facter plugins
[2014-07-28 19:54:36 -0400] coderanger: meth: Its just a bunch of text files, parse 'em and go to town
[2014-07-28 19:56:17 -0400] a13x212: coderanger, thanks that worked but i'm going to have to edit a community cookbook to get it to work
[2014-07-28 19:56:53 -0400] coderanger: a13x212: What are you trying to accomplish?
[2014-07-28 19:57:11 -0400] coderanger: a13x212: If you are having issues with sequencing of cookbooks, include_recipe_now from then now cookbook might help :)
[2014-07-28 19:57:33 -0400] meth: coderanger:  right but you can't prove what a factor fact might do! I've seen people use that as a way to execute code on the clients instead of trying to figure out how to do soemthing in puppet correctly.. and i see people do exec{} calls all the time which puppet's static analysis is not going to inspect..
[2014-07-28 19:58:05 -0400] meth: people use exec{}'s to get around puppet weirdness all the time and honestly at least in ruby you can just use ruby instead of some nasty inline shell script (which is usually what it turns into)
[2014-07-28 19:58:28 -0400] meth: i mean it's obviously not good puppet practice but it's what people end up doing..
[2014-07-28 19:59:25 -0400] coderanger: meth: Sure, both approaches (static vs. programmatic) have issues, and clearly I prefer the latter since I'm still here :)
[2014-07-28 20:00:15 -0400] meth: I was forced to use puppet for 3 years and it was painful...
[2014-07-28 20:00:50 -0400] meth: but in defense I have not yet had the same exposure to chef but many of the things i disliked had to do with their restrictive language
[2014-07-28 20:01:16 -0400] jblack: Don't worry. Chef has its warts too.
[2014-07-28 20:01:19 -0400] jtimberman: meth: you don't want to see the thing i'm doing in this recipe then...
[2014-07-28 20:01:30 -0400] jtimberman: execute "osacript..."
[2014-07-28 20:01:47 -0400] a13x212: coderanger, using the route53 cookbook, which uses chef_gem "fog", fog 1.20 requires nokogiri --version 1.6.1, fog is trying to install before nokogir is on the system
[2014-07-28 20:02:05 -0400] meth: lol.. welcome to osx..
[2014-07-28 20:02:18 -0400] coderanger: a13x212: Yeah, check out include_recipe_now
[2014-07-28 20:02:30 -0400] coderanger: a13x212: It lets you more explicitly sequence things
[2014-07-28 20:02:32 -0400] jtimberman: oh yeah. but hey, at least i can use applescript for "gui only" configurations.
[2014-07-28 20:02:39 -0400] a13x212: thanks let me look into that
[2014-07-28 20:02:55 -0400] meth: http://projects.puppetlabs.com/projects/puppet/wiki/Anchor_Pattern  (this made me want to cry).. all the scoping issues they were working on in puppet3.. I've noticed too that various puppet labs official modules are really sloppy.. in chef you get nice looking code and good practices..
[2014-07-28 20:02:59 -0400] jblack: does include_recipe_now cause a run during compile instead of converge?
[2014-07-28 20:03:38 -0400] meth: in the old version of puppet i use to get memory leaks all the time ..
[2014-07-28 20:03:46 -0400] meth: it would oom my boxes..
[2014-07-28 20:04:04 -0400] coderanger: jblack: Yes, it runs an immediate sub-converge cycle on the specified recipe
[2014-07-28 20:04:06 -0400] Neozonz: [2014-07-28T20:02:12+00:00] ERROR: You must specify at least one cookbook repo p
[2014-07-28 20:04:07 -0400] Neozonz: ath
[2014-07-28 20:04:20 -0400] jblack: That is very nifty. Not the approach I would have expected.
[2014-07-28 20:04:23 -0400] Neozonz: Keep running into that error on vagrant :9
[2014-07-28 20:04:25 -0400] Neozonz: Any ideas
[2014-07-28 20:04:43 -0400] coderanger: jblack: Its a hack, but a very useful one at times. There is a more refined version of it in Poise
[2014-07-28 20:04:48 -0400] meth: puppetlabs::stblib is like taking ruby's nicely thought out core api and spitting it out into a global set of functions... we going back to python or something?
[2014-07-28 20:04:49 -0400] jblack: I would have have expected a new attribute for resources... perhaps  rtfn false
[2014-07-28 20:05:08 -0400] gyoza: anybody else checked out for the day?
[2014-07-28 20:05:11 -0400] gyoza: or is it just me...
[2014-07-28 20:05:35 -0400] jblack: It's a much better hack than what we've been doing.
[2014-07-28 20:05:37 -0400] coderanger: jblack: The point is you can use it on community code, so you don't need to change the route53 recipes at all, just force them into a different order
[2014-07-28 20:05:54 -0400] jblack: mmm, that's an excellent point
[2014-07-28 20:06:44 -0400] meth: are the chef guys thinking about mcollective at all? or some type of execution buss for cookbooks to discover live information about other nodes? that would be interesting.. especially it's probably much nicer than using knife-ssh to interact with a cluster?
[2014-07-28 20:06:59 -0400] coderanger: meth: Yes, pushy
[2014-07-28 20:07:15 -0400] coderanger: meth: Its a component of Enterprise Chef, and might be open sourced some day
[2014-07-28 20:07:46 -0400] jtimberman: meth: mcollective works with chef, and there's a cookbook for setting it up. it's not as tightly integrated as it is with puppet for probably obvious reasons :).
[2014-07-28 20:07:47 -0400] coderanger: Same general idea, though it uses a custom 0MQ protocol instead of Rabbit
[2014-07-28 20:08:13 -0400] coderanger: You can also integrate chef with salt's runner system too
[2014-07-28 20:08:16 -0400] zanshin: so can I use resource defined attributes in a Chef guard inside my LWPR? I.e.,
[2014-07-28 20:08:16 -0400] zanshin: not_if do ::File.exist?("#{new_resource.webapp_location}/#{new_resource.name}-#{new_resource.version}") end
[2014-07-28 20:08:24 -0400] meth: WHAT!? really? that's one of the complaints i instantly had... i was like why aren't they just using 0mq over multicast?
[2014-07-28 20:08:31 -0400] meth: i don't want to manage a buss
[2014-07-28 20:08:31 -0400] jtimberman: but push-jobs (nee pushy) is what we've built for Enterprise Chef. it was demoed at ChefConf last year
[2014-07-28 20:08:34 -0400] meth: it's just a failure point
[2014-07-28 20:08:40 -0400] coderanger: zanshin: Yes, that should work
[2014-07-28 20:08:48 -0400] zanshin: I keep getting a "required argument version is missing" error
[2014-07-28 20:08:54 -0400] coderanger: meth: multicast isn't a thing :-(
[2014-07-28 20:10:16 -0400] cschneid: Attempting to use chef-vault cookbook - is there an example of auto generating a password, then storing it in vault, and immediately using it?
[2014-07-28 20:10:31 -0400] coderanger: cschneid: You mean from recipe code?
[2014-07-28 20:11:05 -0400] cschneid: coderanger: right.  Make a random db password, store it in a secret, and create the db user.  Then later clients would be able to get at the secret
[2014-07-28 20:11:08 -0400] meth: coderanger:  are they just using some type of coordination server to enumerate hosts to talk to? i mean 0mq has to have a set of recipients.. but doing that over multicast instead of using a central server is possible 0mq has all these implementations written I believe
[2014-07-28 20:11:15 -0400] coderanger: cschneid: Are you using enterprise chef or FOSS?
[2014-07-28 20:11:29 -0400] cschneid: coderanger: FOSS afaik. self-hosted server
[2014-07-28 20:11:59 -0400] coderanger: meth: Yes, push jobs uses a custom server that is generally run on the same machine as the chef-server
[2014-07-28 20:12:04 -0400] coderanger: cschneid: Not possible then
[2014-07-28 20:12:13 -0400] coderanger: cschneid: At least not without doing something really really Bad
[2014-07-28 20:12:30 -0400] cschneid: coderanger: https://gist.github.com/cschneid/c3998ffbf22e99dfe75c this is what I'm attempting
[2014-07-28 20:12:37 -0400] cschneid: coderanger: is there a better way to go about this?
[2014-07-28 20:12:40 -0400] coderanger: cschneid: vault uses databags as the storage layer, and non-admin API clients are not allowed to write to data bags, only read
[2014-07-28 20:12:51 -0400] cschneid: coderanger: damn!
[2014-07-28 20:13:06 -0400] meth: coderanger:  i guess by the time you give in to running chef-server you might as well not care at that point.. but it's nice to think one could suppot a cluster that just auto discovers each other over a configured multicast group
[2014-07-28 20:13:07 -0400] coderanger: cschneid: Yes, generate the password on your laptop and add it to the bag
[2014-07-28 20:13:09 -0400] cschneid: coderanger: which is why I get a 403 in that commented databag create stuff
[2014-07-28 20:13:30 -0400] cschneid: coderanger: right. we are trying to automate the creation of some of these to simplify vagrant spinup. Thanks
[2014-07-28 20:13:36 -0400] coderanger: meth: Like I said, multicast isn't available for 99% of people, so not much value in supporting it for non-in-house tools
[2014-07-28 20:13:36 -0400] meth: coderanger:  http://czmq.zeromq.org/manual:zbeacon
[2014-07-28 20:13:56 -0400] meth: well even aws vpc's support it
[2014-07-28 20:13:58 -0400] meth: but yea it's a shame
[2014-07-28 20:13:58 -0400] coderanger: cschneid: Then just have a static default fallback if the bag doesn't exist
[2014-07-28 20:14:17 -0400] coderanger: meth: But few people have their VPC setup to use it without breaking everything
[2014-07-28 20:14:18 -0400] meth: multicast is a great tool and used widely I believe in local dc's
[2014-07-28 20:14:25 -0400] coderanger: Ditto on most metal networks
[2014-07-28 20:14:38 -0400] cschneid: coderanger: thanks. Too bad this can't work.
[2014-07-28 20:14:48 -0400] Eulipion: what can cause a cookbook to not be able to find itself in vagrant.  i.e  testing cookbook derp-abc, cannot find cookbook derp-abc not found--check metadata. etc..
[2014-07-28 20:15:00 -0400] meth: coderanger:  well "99% of people" might be the result of not attracting people with the said features :]
[2014-07-28 20:15:00 -0400] coderanger: cschneid: In general you shouldn't have nodes be creating new state like that anyway, chef should be feed-forward
[2014-07-28 20:15:16 -0400] coderanger: meth: Yep, same issue as IPv6 and DNSSEC
[2014-07-28 20:15:18 -0400] Damm: meth, it would be nice if multicast was supported
[2014-07-28 20:15:38 -0400] cschneid: coderanger: so why would chef-vault cookbook have the writing ability? it can't work on FOSS version, but could on enterprise?
[2014-07-28 20:15:44 -0400] gchristensen: don't most hosts shut down multicast?
[2014-07-28 20:15:47 -0400] Damm: meth, p.s. most people who say multicast isn't supported are actually inaccurate.  Multicast is actually on a lot of clouds; AWS supports it
[2014-07-28 20:15:57 -0400] gchristensen: Damm: really!
[2014-07-28 20:16:00 -0400] Damm: DO doesn't have their multicast secure
[2014-07-28 20:16:01 -0400] coderanger: cschneid: Yes
[2014-07-28 20:16:06 -0400] Damm: so you can use it
[2014-07-28 20:16:08 -0400] Damm: but other hosts see it
[2014-07-28 20:16:21 -0400] gchristensen: I anticipate much shenanigans this evening knowing that ...
[2014-07-28 20:16:26 -0400] cschneid: coderanger: thanks for the help. I'll fall back on scripts that autogen stuff outside of chef and upload into it.
[2014-07-28 20:16:31 -0400] Damm: you see it all the time in #elasticsearch
[2014-07-28 20:16:37 -0400] Damm: someone set up their ES with zen multicast
[2014-07-28 20:16:39 -0400] cschneid: then the end nodes won't be pushing, only pulling
[2014-07-28 20:16:40 -0400] meth: Damm:  yea that's what i was saying with vpc's
[2014-07-28 20:16:43 -0400] Damm: and it suddenly replicated to other customers
[2014-07-28 20:16:46 -0400] gchristensen: amazing!
[2014-07-28 20:16:51 -0400] gchristensen: I love that
[2014-07-28 20:16:54 -0400] coderanger: cschneid: Down that path lies happiness :)
[2014-07-28 20:16:56 -0400] Damm: and was pushing out search queries for other people
[2014-07-28 20:16:59 -0400] Damm: so there's a give and bad
[2014-07-28 20:17:02 -0400] Damm: good/bad
[2014-07-28 20:17:08 -0400] Damm: but that's true of any provider
[2014-07-28 20:17:19 -0400] cschneid: coderanger: well sure. Just a bit sad that I can't have the "create db & user" recipe create the password too.
[2014-07-28 20:17:45 -0400] coderanger: cschneid: I mean it doesn't "create the user" in the same sense as you say "create the password" :) The username is specified as input
[2014-07-28 20:17:57 -0400] gchristensen: Damm: ultra highly available: we replicate to other customer boxes.
[2014-07-28 20:17:57 -0400] coderanger: cschneid: If you tried to auto-generate the user name, you would have similar issues
[2014-07-28 20:18:02 -0400] meth: yea like using tomcat's cluster discovery via multicast is default and SO MUCH EASIER and less error prone then setting up some central server.. it lets you easily roll up clusters that don't need to be statically configured for one another.. and then what about auto scaling? multicast rocks..
[2014-07-28 20:21:04 -0400] gchristensen: Damm: it looks like AWS only "sort-of" supports it, as in, not officially, but using guides like  https://www.buckhill.co.uk/blog/how-to-enable-broadcast-and-multicast-on-amazon-aws-ec2/2
[2014-07-28 20:21:26 -0400] gchristensen: using a peer-to-peer VPN
[2014-07-28 20:21:35 -0400] gchristensen: even VPC doesn't support it: https://aws.amazon.com/vpc/faqs/
[2014-07-28 20:22:33 -0400] gchristensen: which explains why the ES-aws plugin exists
[2014-07-28 20:22:34 -0400] jtimberman: https://github.com/opscode-cookbooks/chef-vault#chef_vault_secret
[2014-07-28 20:23:06 -0400] coderanger: jtimberman: Yes?
[2014-07-28 20:23:07 -0400] jtimberman: cschneid: That resource will save a secret in a recipe. The node in question needs to have an 'admin' API client if you're using open source chef server.
[2014-07-28 20:23:24 -0400] coderanger: jtimberman: That would be the Bad Idea I mentioned :)
[2014-07-28 20:23:27 -0400] cschneid: jtimberman: ya - but that sounds like an iffy idea. :)
[2014-07-28 20:23:41 -0400] jtimberman: I had a use case for that myself, so I wrote it :)
[2014-07-28 20:24:41 -0400] Neozonz: anyone have experience with vagrant + aws cookbooks + berkshelf?
[2014-07-28 20:25:01 -0400] gyoza: i do
[2014-07-28 20:25:40 -0400] cschneid: jtimberman: for my use case, I'm pretty sure the dev_mode thing is the right way to fix it anyway. I was just trying to be overly clever auto-generating passwords as I needed them
[2014-07-28 20:26:42 -0400] a13x212: coderanger, fyi: include_recipe_now didn't work
[2014-07-28 20:27:13 -0400] coderanger: a13x212: define "didn't work"?
[2014-07-28 20:28:44 -0400] Neozonz: gyoza, i'm trying to develop/test my cookbooks for opsworks locally
[2014-07-28 20:29:23 -0400] Neozonz: pretty much setup my vagrant env, but i keep getting issues when provisioning the box : You must specify at least one cookbook repo path
[2014-07-28 20:29:56 -0400] Neozonz: I'm guessing when I'm referencing the cookbooks for aws im doing something wrong in berksfile
[2014-07-28 20:30:02 -0400] a13x212:  coderanger. still trying to load the chef_gem at the beginning of the run
[2014-07-28 20:30:34 -0400] coderanger: a13x212: Yes, you need to use include_recipe_now to force nokogiri to install before that
[2014-07-28 20:30:51 -0400] coderanger: a13x212: Thats what I meant by "explicit sequencing"
[2014-07-28 20:31:00 -0400] Eulipion: how can I fix a cookbook not resolving itself? http://pastebin.com/HxSMzVje
[2014-07-28 20:32:43 -0400] coderanger: Eulipion: Make sure the metadata.rb exists
[2014-07-28 20:33:02 -0400] Eulipion: i wasnt in the cb's root dir ;(
[2014-07-28 20:33:28 -0400] Neozonz: any idea gyoza?
[2014-07-28 20:35:11 -0400] a13x212: coderanger. perfect thanks
[2014-07-28 20:37:49 -0400] meth: ok thanks for chat guys cya later
[2014-07-28 20:37:54 -0400] achanda: I'm looking for best practices around template variables
[2014-07-28 20:38:12 -0400] achanda: we've been using node[:blah] style and @blah style both
[2014-07-28 20:38:18 -0400] achanda: is there a preferred way?
[2014-07-28 20:39:50 -0400] achanda: We are using chef-solo 10.28
[2014-07-28 20:40:48 -0400] coderanger: achanda: The latter
[2014-07-28 20:41:08 -0400] coderanger: achanda: It makes it easier to see from just the recipe code what inputs affect the template
[2014-07-28 20:41:50 -0400] achanda: coderanger: makes sense, thanks
[2014-07-28 20:42:05 -0400] achanda: is there a performance difference between the two?
[2014-07-28 20:42:47 -0400] coderanger: achanda: No
[2014-07-28 20:43:03 -0400] coderanger: Also using the words "performance" and "chef" in the same general area is folly at best :)
[2014-07-28 20:43:28 -0400] kersh: So I split all of the cookbooks that I kept in my giant chef-repo repository into their own Bitbucket repositories, but I cannot seem to get the Berkshelf config.json right so that it'll upload to my Chef server. I have everything as it was in the original chef-repo, but I just get "There was an error connecting to the Chef Server" when I run `berks upload`.
[2014-07-28 20:43:37 -0400] achanda: coderanger: Chef n00b here, mind explaining? :)
[2014-07-28 20:43:37 -0400] josephholsten: kersh: no worries!
[2014-07-28 20:44:23 -0400] coderanger: achanda: chef is 1) slow and 2) not in the path of user requests so talking about one way being faster than the other only matters if it is on the scale of minutes or hours
[2014-07-28 20:44:36 -0400] kersh: Is there a way to test the keyfiles to make sure they're authenticating properly, or even being used?
[2014-07-28 20:44:49 -0400] coderanger: achanda: For example, technically @foo is slightly faster by a few microseconds, this will literally never matter
[2014-07-28 20:45:14 -0400] coderanger: achanda: Chef code should optimize for maintainability and simplicity before perf, way way before :)
[2014-07-28 20:46:01 -0400] achanda: coderanger: I agree, learning slowly :)
[2014-07-28 20:46:10 -0400] achanda: coeranger: thanks for the help!
[2014-07-28 20:48:14 -0400] coredump: so
[2014-07-28 20:48:21 -0400] coredump: I am getting this Berkshelf::CommunitySiteError: An unexpected error occurred retrieving '7-zip' (1.0.2) from the cookbook site at ''.
[2014-07-28 20:48:30 -0400] coredump: am I doing something stupid or the API is fubar?
[2014-07-28 20:54:16 -0400] willejs: ohai chefs
[2014-07-28 20:55:42 -0400] coredump: error vanished after updating berkshelf to 3.1.4
[2014-07-28 20:55:58 -0400] willejs: I'm having issues where knife ssh/ec2 server is appending the host to the ssh connection twice? will@10.0.13.194@10.0.13.194
[2014-07-28 20:56:01 -0400] willejs: has anyone seen this?
[2014-07-28 20:56:05 -0400] willejs:  i think its pretty trivial
[2014-07-28 21:30:08 -0400] shlant: jtimberman: any reason why chef-client -j accepts a file and knife ec2 -j only accepts a string?
[2014-07-28 21:30:32 -0400] jtimberman: shlant: they were implemented at completely different points in time.
[2014-07-28 21:30:50 -0400] jtimberman: knife-ec2 learned the -j option much later in life.
[2014-07-28 21:31:58 -0400] shlant: jtimberman: makes sense. thanks
[2014-07-28 21:51:27 -0400] nulleric: anyone else use opsworks a lot? it's weird to get used to but seems kinda neat once i'm used to the concepts. Though i feel none of the out of box layers fit (besides like haproxy)
[2014-07-28 21:54:34 -0400] coderanger: nulleric: Many do, but few hang out here
[2014-07-28 21:54:44 -0400] coderanger: nulleric: Opsworks support is generally handled via the AWS forums
[2014-07-28 21:54:45 -0400] nulleric: where do they hang out?
[2014-07-28 21:55:05 -0400] nulleric: ya, thats not as fun as irc :)
[2014-07-28 21:56:59 -0400] SmudgerDan: right newbie question #1000 from me, I need to run "execute" using the windows provider, but I need to pass a switch, which uses a hyphen (or dash if you like) but I get some weird encoding issue where I end up with a 
[2014-07-28 21:59:35 -0400] coderanger: nulleric: You can ask in here, just not a ton of expertise in the opsworks-specific bits like their custom cookbooks
[2014-07-28 22:01:11 -0400] nulleric: ya, just looking for more links to read up on opsworks, I'm figuring things out just need a braindump blog post of the concepts :). Seems like they just use chef-zero and custom ohai data to tell the layers about eachother
[2014-07-28 22:03:24 -0400] coderanger: nulleric: Yeah, pretty much, and then the callback system to trigger different recipes and different times
[2014-07-28 22:05:35 -0400] nulleric: i do like the ssh users stuff it does vs. vanilla ec2
[2014-07-28 22:07:09 -0400] SmudgerDan: must be encoding, good old "character map" to the Windows users rescue!
[2014-07-28 22:08:04 -0400] coderanger: SmudgerDan: What encoding is your file in?
[2014-07-28 22:08:58 -0400] SmudgerDan: ANSI... I know I know it should be in UTF-8 =D
[2014-07-28 22:43:51 -0400] ec9988: Hi, does anyone knows host how to use only_if or not_if with mutliple conditions, like node['etc']['passwd']["ntp"] and (ps -f | grep process) together?
[2014-07-28 22:45:48 -0400] coderanger: ec9988: Down this path lies madness
[2014-07-28 22:46:11 -0400] coderanger: ec9988: You can use multiple guard clauses on a single resource and I _think_ they AND together
[2014-07-28 22:46:17 -0400] coderanger: but I would have to double check the code
[2014-07-28 22:46:39 -0400] Damm: ec9988, ||
[2014-07-28 22:46:52 -0400] Damm: that's not together though
[2014-07-28 22:47:20 -0400] Damm: you can always write your own provider for this ec9988
[2014-07-28 22:47:51 -0400] ec9988: i'm starting to write recipes...
[2014-07-28 22:48:18 -0400] coderanger: Damm: That is not correct in this case
[2014-07-28 22:48:31 -0400] coderanger: ec9988: What are you trying to accomplish?
[2014-07-28 22:48:34 -0400] Damm: ec9988, then try and keep it simple
[2014-07-28 22:48:46 -0400] Damm: ec9988, if your starting out you are likely making it overcomplicated (or trying to achieve too much)
[2014-07-28 22:49:52 -0400] ec9988: i think i'm trying to make it too difficult...
[2014-07-28 22:50:10 -0400] Damm: it happens
[2014-07-28 22:51:00 -0400] coderanger: ec9988: Remember chef works best when you are doing things convergently, just state what you want things to look like in the end and let chef compute what needs to happen
[2014-07-28 22:51:47 -0400] ec9988: @coderanger, i think you answered my question before, but i can't seem to fix my recipe.  So, I'm trying to create user.  Because our environment consists a variety of systems, i need to cover everything....
[2014-07-28 22:54:18 -0400] ec9988: Trying to create a new user - if new user doesn't exist, update/create.  if new user already exists, need to check the uid before decide to update or not.  I have these two scenrios covered
[2014-07-28 22:55:14 -0400] ec9988: then encounters new scenrio, if a node is NIS client, don't update it.  i can't figure out this one.
[2014-07-28 22:55:38 -0400] Damm: nis in chef
[2014-07-28 22:55:50 -0400] ec9988: me too!
[2014-07-28 22:56:05 -0400] Damm: nis + autossh is pure bliss
[2014-07-28 22:56:06 -0400] Damm: it really is
[2014-07-28 22:56:12 -0400] ec9988: i wish i can remove the user in NIS
[2014-07-28 22:56:29 -0400] Eulipion: what is the right way to update a resource when you're wrapping a cookbook?  Im trying http://pastebin.com/eYQisAzh
[2014-07-28 22:56:54 -0400] coderanger: ec9988: How are you checking if it is a nis client?
[2014-07-28 22:57:26 -0400] Damm: Eulipion, what are you trying to do here?
[2014-07-28 22:57:38 -0400] Damm: override /etc/init.d/redis6379 from  your cookbook?
[2014-07-28 22:57:40 -0400] Eulipion: get the redisio cookbook to use my init script template
[2014-07-28 22:58:06 -0400] Damm: wow redis_install does all that?
[2014-07-28 22:58:11 -0400] Damm: holy crap
[2014-07-28 22:58:40 -0400] Damm: holy
[2014-07-28 22:58:48 -0400] coderanger: Eulipion: You would want to do the mutation after the redisio_install resource
[2014-07-28 22:58:50 -0400] Damm: I really need to start using my lwrp more often that is just too much
[2014-07-28 22:58:58 -0400] coderanger: Eulipion: But you need to do it in a ruby_block :-(
[2014-07-28 22:59:06 -0400] Damm: Eulipion, https://github.com/damm/redis
[2014-07-28 22:59:09 -0400] coderanger: Eulipion: Its not easy to fix this kind of thing
[2014-07-28 22:59:12 -0400] coderanger: Eulipion: :-(
[2014-07-28 22:59:15 -0400] Damm: if you ever want to be insane and write everything yourself
[2014-07-28 22:59:32 -0400] Damm: https://github.com/damm/redis/blob/master/recipes/test_installed_and_running.rb
[2014-07-28 22:59:40 -0400] ec9988: coderanger: So, to check it's a nis client, i have tried to check if the user exist, "if "ypcat passwd | grep newuser" hasYP = true else hasYP = false end"
[2014-07-28 22:59:54 -0400] Damm: I got burned on redis cookbooks opinions a long time ago
[2014-07-28 23:00:08 -0400] Damm: so I basically tried to make it as simple as possible and then make a wrapper to achieve my goals
[2014-07-28 23:00:09 -0400] coderanger: ec9988: Can you just check if ypcat exists at all?
[2014-07-28 23:00:14 -0400] Damm: so if I go to systemd or init.d or runit
[2014-07-28 23:00:21 -0400] Damm: it's all in the wrapper instead of in the lwrp
[2014-07-28 23:00:39 -0400] Damm: installing redis should be easy; how you manage it should be yours
[2014-07-28 23:00:48 -0400] Damm: monit, runit, init.d, supervisorctl
[2014-07-28 23:00:51 -0400] coderanger: ec9988: Something like not_if { node['etc']['passwd']["ntp"] || ::File.exists?('/usr/bin/ypcat') }
[2014-07-28 23:00:52 -0400] Damm: that's all a pain
[2014-07-28 23:00:53 -0400] doug1: coderangerL Has anyone been able to modify https://github.com/poise/python to install python to somewhere besides /usr/bin ?
[2014-07-28 23:01:07 -0400] coderanger: ec9988: Or maybe check for something in /etc
[2014-07-28 23:01:29 -0400] ec9988: can i have more than 1 || in the not_if?
[2014-07-28 23:02:05 -0400] ec9988: i already have 2 conditons there
[2014-07-28 23:02:15 -0400] coderanger: ec9988: Yes, it is standard Ruby code
[2014-07-28 23:02:37 -0400] ec9988: only_if { !node['etc']['passwd']['newuser'] || node['etc']['passwd']['newuser']['uid'] == user_data['uid'] }
[2014-07-28 23:02:47 -0400] ec9988: thanks, i will give it a try
[2014-07-28 23:03:30 -0400] coderanger: ec9988: That works
[2014-07-28 23:03:34 -0400] Eulipion: coderanger: like this? http://pastebin.com/HWSXHyKf
[2014-07-28 23:13:30 -0400] Eulipion: are resources available to chef_solo or is that data also stored in the node on the server?
[2014-07-28 23:14:13 -0400] coderanger: Eulipion: hmm, no, that wouldn't do it either, let me think through the ordering here
[2014-07-28 23:14:27 -0400] Damm: use_inline_resources related?
[2014-07-28 23:14:37 -0400] coderanger: Damm: No, that would just make it entirely impossible
[2014-07-28 23:14:46 -0400] coderanger: but I'm not sure it is doable even without that
[2014-07-28 23:15:07 -0400] Eulipion: this what ive got now, http://pastebin.com/dgz6HijH
[2014-07-28 23:15:29 -0400] coderanger: Eulipion: That won't work as written
[2014-07-28 23:15:43 -0400] coderanger: Eulipion: Because the internal resources aren't created until the LWRP itself runs its action
[2014-07-28 23:15:52 -0400] coderanger: Eulipion: But you would need subclassing to make this work
[2014-07-28 23:15:53 -0400] Eulipion: i c
[2014-07-28 23:16:00 -0400] coderanger: Eulipion: And doing that with LWRPs is ... unpleasant
[2014-07-28 23:16:03 -0400] coderanger: let me find you the code
[2014-07-28 23:16:06 -0400] Eulipion: thx
[2014-07-28 23:16:26 -0400] coderanger: Eulipion: https://github.com/python/psf-chef/blob/master/cookbooks/pydotorg-redesign/recipes/default.rb#L17-L48
[2014-07-28 23:16:33 -0400] coderanger: Eulipion: You have to extend the class in recipe code
[2014-07-28 23:16:52 -0400] coderanger: Eulipion: override the action method and monkey patch there
[2014-07-28 23:17:37 -0400] coderanger: Eulipion: So basically don't do this, fork the cookbook, sorry >_<
[2014-07-28 23:17:48 -0400] coderanger: Eulipion: See also, why stuff like this needs to not be written as LWRPs :-(
[2014-07-28 23:17:56 -0400] Eulipion: coderanger: thx.  yea, seems better to make a PR with the sentinel switch i need
[2014-07-28 23:17:59 -0400] Damm: Eulipion, use mine
[2014-07-28 23:18:15 -0400] Damm: if you don't want to fork
[2014-07-28 23:18:15 -0400] Damm: :)
[2014-07-28 23:18:43 -0400] Eulipion: Damm: i'll take a look tomorrow.  thx for ur help
[2014-07-28 23:18:44 -0400] Damm: basically my hope for lwrp was a simple redis lwrp to download / install it and configure it; you wrap it up yourself
[2014-07-28 23:18:47 -0400] Damm: and kiss it
[2014-07-28 23:18:52 -0400] Damm: same with postgresql and mysql
[2014-07-28 23:18:53 -0400] Damm: and percona
[2014-07-28 23:19:10 -0400] Damm: the nuances tend to be your own; could be right could be wrong but if you care it should be easy to do it
[2014-07-28 23:19:25 -0400] Damm: and having to fork over a cookbook init.d issue just seems foul
[2014-07-28 23:19:30 -0400] Damm: that should be changeable
[2014-07-28 23:19:37 -0400] Eulipion: agreed
[2014-07-28 23:20:19 -0400] Damm: i'm no saint but I do my best
[2014-07-28 23:20:20 -0400] Damm: https://github.com/damm/diamond/blob/master/providers/configure.rb#L77
[2014-07-28 23:20:27 -0400] coderanger: Damm: LWRPs are not the right solution precisely because of that, hence Poise :)
[2014-07-28 23:20:39 -0400] Damm: someone pushed back and added upstart into the mix
[2014-07-28 23:20:42 -0400] coderanger: subclassing should be a first-class operation :)
[2014-07-28 23:20:54 -0400] Damm: I have no clue about poise; haven't paid attention to it
[2014-07-28 23:20:56 -0400] jf647: Does anyonek know if there are multiple endpoints for the hosted Chef api?  My provider is having routing problem and I'm getting timeouts to api.opscode.com - hoping it might have an alternate name via different path
[2014-07-28 23:21:15 -0400] Damm: everyone tries to shove sugar down my throat and I just refuse
[2014-07-28 23:21:51 -0400] Damm: i've been burned by the discovery cookbook which made me go back to just search
[2014-07-28 23:22:02 -0400] Damm: well heck that cookbook really burned me twice or more
[2014-07-28 23:22:14 -0400] coderanger: jf647: It lives behind a load balancer, but its just one cluster if thats what you mean
[2014-07-28 23:22:41 -0400] Damm: the more you hide and the more pretty it becomes the less obvious what the actual actions are
[2014-07-28 23:22:46 -0400] Damm: and their consequences
[2014-07-28 23:23:05 -0400] Damm: double edged sword
[2014-07-28 23:24:14 -0400] jf647: coderanger: thanks, I'll need to poke the provider for a resolution then
[2014-07-28 23:25:46 -0400] someara: Damm I made a mysql_service lwrp
[2014-07-28 23:26:28 -0400] Damm: i made a wrapper cookbook to a lwrp of a lwrp
[2014-07-28 23:26:29 -0400] Damm: heh
[2014-07-28 23:26:37 -0400] Damm: seriously
[2014-07-28 23:26:49 -0400] someara: I'm implementing an lwrp with lwrps made of lwrps
[2014-07-28 23:26:51 -0400] someara: turles
[2014-07-28 23:27:00 -0400] Damm: but i was doing this a year ago
[2014-07-28 23:27:01 -0400] Damm: honestly
[2014-07-28 23:27:03 -0400] someara: s/lwrp/resources
[2014-07-28 23:27:08 -0400] sdelano: jf647: where are you connecting from?
[2014-07-28 23:27:26 -0400] Damm: sometimes I wonder if great minds think alike
[2014-07-28 23:27:27 -0400] Damm: or what
[2014-07-28 23:28:12 -0400] jf647: the server is on Digital Ocean NYC2 (107.170/16, DIGITALOCEAN-8)
[2014-07-28 23:28:21 -0400] doug1: Is there a way in chef to see what commands it is executing?
[2014-07-28 23:28:36 -0400] Damm: doug1, -l debug
[2014-07-28 23:28:38 -0400] itmustbejj: chef-client -l debug
[2014-07-28 23:28:45 -0400] itmustbejj: beat to the punch :P
[2014-07-28 23:29:05 -0400] Damm: you know i almost feel like re-enabling my chef logs archive
[2014-07-28 23:29:06 -0400] Damm: almost
[2014-07-28 23:29:11 -0400] doug1: Damm: How about with test kitchen?
[2014-07-28 23:29:21 -0400] Damm: doug1, same
[2014-07-28 23:29:26 -0400] sdelano: jf647: And getting timeouts connecting to Hosted Chef? Hosted Chef is located in Chicago.
[2014-07-28 23:29:39 -0400] doug1: Damm: kitchen converge -l debug ...?
[2014-07-28 23:30:03 -0400] Damm: i don't know if that gets passed into chef-client
[2014-07-28 23:30:06 -0400] Damm: i think it should though
[2014-07-28 23:30:11 -0400] Damm: kitchen supports -l debug
[2014-07-28 23:30:13 -0400] Damm: and it locally debugs
[2014-07-28 23:30:21 -0400] jf647: oh, looks like connectivity is back.  For reference, 'berks upload' errors out with strange things like '/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/celluloid-0.16.0.pre2/lib/celluloid/actor.rb:357:in `each': task was terminated (Celluloid::Task::TerminatedError)' when connectivity is spotty
[2014-07-28 23:30:22 -0400] Damm: i bet this is not the case
[2014-07-28 23:30:29 -0400] doug1: I'd bet that too
[2014-07-28 23:31:09 -0400] Damm: but that is weeeak
[2014-07-28 23:31:14 -0400] Damm: but that's life
[2014-07-28 23:32:19 -0400] sdelano: jf647: interesting, is it just berks upload that's doing that? What about other API calls. Part of the cookbook upload process involves sending data to S3 (us-east-1), so there could be a connection issue there as well.
[2014-07-28 23:32:46 -0400] sdelano: We've been seeing an increased number of long requests to S3 on our end (HEAD requests taking longer than 5000ms, for instance).
[2014-07-28 23:33:33 -0400] Damm: https://app.fastly.com/#s3
[2014-07-28 23:33:37 -0400] Damm: too bad that doesn't work anymore
[2014-07-28 23:35:25 -0400] jf647: chef-client was giving a different error '[2014-07-28T16:15:55-07:00] ERROR: Error connecting to https://api.opscode.com/organizations/nadt/reports/nodes/rcpt.nadt.net/runs - getaddrinfo: Name or service not known
[2014-07-28 23:35:26 -0400] jf647: '
[2014-07-28 23:35:48 -0400] sdelano: jf647: roger, thanks for the info
[2014-07-28 23:36:41 -0400] doug1: looks like kitchen converge -l debug does do something
[2014-07-28 23:38:11 -0400] itmustbejj: Damn: was that fastly graph something like this? http://www.cloudclimate.com/s3/
[2014-07-28 23:40:22 -0400] Damm: itmustbejj, nah a lot prettier
[2014-07-28 23:40:43 -0400] Damm: but that's nice to see
[2014-07-28 23:40:46 -0400] itmustbejj: I thought you were above all that sugar :P
[2014-07-28 23:40:48 -0400] Damm: wish it was more accessable
[2014-07-28 23:41:01 -0400] Damm: nah I use influxdb
[2014-07-28 23:41:09 -0400] Damm: I prefer to have the data and render it myself
[2014-07-28 23:41:13 -0400] Damm: or just read it
[2014-07-28 23:50:18 -0400] doug1: can't quite get the python cookbook to install python to an alternate location.
[2014-07-28 23:52:11 -0400] Damm: why not?
[2014-07-28 23:52:54 -0400] doug1: Damm: Well... it's not clear what attributes I need to set
[2014-07-28 23:53:09 -0400] Damm: hmm i wonder if that branch is still there
[2014-07-28 23:53:47 -0400] doug1: This is my latest attempt... http://pastebin.com/Zk0QZGMT .. the altinstall thing isn't even documented in the cookbook but definitely required by the installer
[2014-07-28 23:54:53 -0400] doug1: that last attempt... i dunno what it did. i search for a 'find / -name python' got me nothing except th default
[2014-07-28 23:54:57 -0400] Damm: https://github.com/poise/python/blob/master/recipes/source.rb
[2014-07-28 23:55:00 -0400] Damm: is pretty straight forward
[2014-07-28 23:55:03 -0400] Damm: if you want to change the prefix
[2014-07-28 23:55:10 -0400] Damm: you need to set node['python']['prefix_dir']
[2014-07-28 23:55:33 -0400] doug1: Damm: I did. It's in my pastebin
[2014-07-28 23:56:08 -0400] Damm: does https://github.com/poise/python/blob/master/recipes/default.rb#L21
[2014-07-28 23:56:09 -0400] Damm: work?
[2014-07-28 23:56:10 -0400] bawt: work not found
[2014-07-28 23:56:10 -0400] doug1: you also gotta set altinstall in the options.... that's not mentioned in the cookbook anywhere
[2014-07-28 23:56:15 -0400] doug1: Damm: nope.
[2014-07-28 23:56:55 -0400] doug1: Damm: It built something but it went nowhere. that commented line... when that's not commented it actually puts it in /usr/local/bin but then the symlinkage fails
[2014-07-28 23:57:17 -0400] doug1: so, it's realy not clear at all what's required
[2014-07-28 23:57:31 -0400] Damm: just set that to source
[2014-07-28 23:57:35 -0400] Damm: package is including python::package
[2014-07-28 23:57:41 -0400] Damm: so if you change that to source
[2014-07-28 23:57:44 -0400] Damm: it will include_recipe source
[2014-07-28 23:58:02 -0400] Damm: node['python']['install_method']
[2014-07-28 23:58:03 -0400] Damm: that is
[2014-07-28 23:58:36 -0400] Damm: it was cool
[2014-07-28 23:58:42 -0400] doug1: Damm: I did that too
[2014-07-28 23:59:07 -0400] doug1: Damm: and it's downloading and building it from source. I can see it doing that
[2014-07-28 23:59:25 -0400] Damm: https://github.com/poise/python/blame/master/.kitchen.yml
