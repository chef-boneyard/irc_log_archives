[2014-06-10 00:03:55 -0400] jameson__: anyone have/had issue with python or rabbitmq recipe and test-kitchen? where the LWRP does weird stuff (like ignore attributes, or not actually run, but it says it did in the chef logs?)
[2014-06-10 01:03:12 -0400] nobody18188181: does chef support chaining elseif statements? I just noticed in a recipe that it's not working properly, but if I use individual if statements it's working fine.
[2014-06-10 01:03:47 -0400] digitalchild: ive seen it in recipes, so yes..
[2014-06-10 01:03:52 -0400] digitalchild: have i done it myself? no..
[2014-06-10 01:04:24 -0400] nobody18188181: im if node["platform"] = "blah" ... elseif node["platform"] == "blah2" ... end
[2014-06-10 01:04:27 -0400] nobody18188181: does not work for me at all
[2014-06-10 01:05:32 -0400] coalbe: nobody18188181: use case
[2014-06-10 01:06:04 -0400] coalbe: nobody18188181: http://stackoverflow.com/questions/948135/how-can-i-write-a-switch-statement-in-ruby
[2014-06-10 01:07:07 -0400] nobody18188181: does that mean elseif does not work?
[2014-06-10 01:07:14 -0400] nobody18188181: when dsl says it does
[2014-06-10 01:07:38 -0400] nobody18188181: see here
[2014-06-10 01:07:39 -0400] nobody18188181: http://pastebin.com/8W2JdMeQ
[2014-06-10 01:08:14 -0400] nobody18188181: no errors are thrown, chef-solo just doesn't do anything (because array isn't occupied)
[2014-06-10 01:08:19 -0400] coalbe: use elsif, not elseif
[2014-06-10 01:08:46 -0400] nobody18188181: how is that diff?
[2014-06-10 01:08:51 -0400] nobody18188181: dsl says elseif?
[2014-06-10 01:09:15 -0400] coalbe: this is easy debugged with a simple google search
[2014-06-10 01:09:23 -0400] coalbe: ruby happens to do things a little differently
[2014-06-10 01:09:32 -0400] coalbe: "ruby elseif how to"
[2014-06-10 01:10:29 -0400] coalbe: however, i think using case is more readable
[2014-06-10 01:11:08 -0400] nobody18188181: coalbe: weird that first link i already visited but the DSL threw me off
[2014-06-10 01:11:19 -0400] nobody18188181: coalbe: but yea, it works now thanks :)
[2014-06-10 09:33:32 -0400] CJNE: with chef-client, is it possible to use -o combined with -r to make it run the -o runlist only this time and for any subsequent run use the -r runlist?
[2014-06-10 09:36:58 -0400] srenatus: CJNE: no.  subsequent chef runs' run lists are determined by node[run_list] that is only put to the server on node.save, what does not happen on -o(verride)
[2014-06-10 09:39:24 -0400] CJNE: ok, i'm not using knife to bootstrap, so i guess i should put the run list in a json_attributes file and include that in client.rb then...
[2014-06-10 09:40:41 -0400] CJNE: i was thinking it might be usefule to be able to later change the run list using knife, will that be possible if i have a "hard coded" run list like that?
[2014-06-10 09:41:55 -0400] BryanWB: is there a way that i can debug the cookbooks that are cached locally using chef-client ?
[2014-06-10 09:42:10 -0400] srenatus: CJNE: what exaclty are you trying?  sounds like you could just "knife bootstrap -r my_run_list" and have that saved on the server and change it if needed
[2014-06-10 09:42:21 -0400] srenatus: CJNE: or does your first run have to be different?  (really?)
[2014-06-10 09:42:47 -0400] BryanWB: i want to add pry breakpoints in a cookbook and i would rather not inject that breakpoint to all nodes in my chef environment
[2014-06-10 09:46:51 -0400] CJNE: the first run is invoked by a shell script when the node starts, during which it should set things like node name and setting the run list. We're using aws auto scaling so knife is not an option for bootstraping. It might however be useful to be able to use knife afterwards to change the run list. It's not strictly required right now but i figured it could be nice to have
[2014-06-10 09:49:17 -0400] srenatus: CJNE: ah, I see.  if your first run uses -o OR -r, you'll end up using that run list all the time... hmm you could probably add a role, e.g. "-r role[proxy]", and possibly change that later on
[2014-06-10 09:50:07 -0400] srenatus: CJNE: but that said, if your first run just uses the chef-client cookbook to install chef-client as a service that runs continually, it would fetch the run_list from the server
[2014-06-10 09:53:14 -0400] BryanWB: ok, setting cookbook_path and `local_mode true` seems to do what i want
[2014-06-10 09:58:37 -0400] CJNE: srenatus, mmm, trying to do away with roles. I'll use an attributes file for now i think and worry about overriding it later, thanks for the input :)
[2014-06-10 09:59:40 -0400] srenatus: CJNE: just uncouple the subsequent runs from the first one.  it will know its run_list when the first run didn't use -o but -r
[2014-06-10 10:06:59 -0400] CJNE: srenatus, so i could use -r to set the subsequent run list in my first run, but run a different run list for that run?
[2014-06-10 10:29:32 -0400] ghghz: Hey, why after running chef-client tags are cleared?
[2014-06-10 10:30:50 -0400] ghghz: ah, found it, nevermind :)
[2014-06-10 11:25:18 -0400] bixu: I have an Omnibus question - is this the right channel or is there a dedicated Omnibus channel I should use?
[2014-06-10 11:35:24 -0400] giocalitri: Hi all: trying to solve a problem with chef (11.10.4) and the nokogiri gem. I know there are problems so I tried to install it using the system-libraries. My problem is that if in chef I use chef_gem "nokogiri" do options("-- --use-system-libraries") action :install I get an error saying that nokogiri needs ruby >=1.9, but the embedded ruby is the the right one! (Using Centos 6.5)
[2014-06-10 11:36:02 -0400] giocalitri: anybody have an idea of what's going on?
[2014-06-10 12:02:19 -0400] djlee: Does chef execute a recipe from top to bottom syncronously? So if i install a package in a recipe, and i want to then run a bash script which creates a unch of symlinks to binaries in that package, i can execute the bash script after the "end" statement of my "package" install command and it will work fine?
[2014-06-10 12:02:58 -0400] workmad3: djlee: yes
[2014-06-10 12:03:21 -0400] djlee: workmad3: thanks, thought id check :)
[2014-06-10 12:03:31 -0400] workmad3: djlee: although I'd highly recommend you use the link resource instead of using bash
[2014-06-10 12:03:53 -0400] workmad3: djlee: link "/foo/bar" do; to "/fizz/buzz"; end ;)
[2014-06-10 12:04:04 -0400] workmad3: (replace the ; with newlines)
[2014-06-10 12:04:58 -0400] djlee: workmad3: ah didnt realisethere was one, im new to chef (less than 24 hours in). Although i simplified my question, i actualy want to execute a bash script that the package installs into /usr/local/share. But im going to prosume theres a resource called execute for that
[2014-06-10 12:06:17 -0400] workmad3: djlee: there's an 'execute' resource and a 'bash' resource, which are pretty similar (execute is the 'general' version, which will use whichever shell provider seems appropriate, similar to package, which is the general version of apt_package, rpm_package, etc)
[2014-06-10 12:06:45 -0400] workmad3: djlee: when running scripts with execute or bash though, you need to be careful that the script is safe to run every time you run the recipe, which is why using other resources is preferrable
[2014-06-10 12:07:23 -0400] djlee: workmad3: cheers, only just realised what a resource really is after you mentioning the link resource. Amazing how something just clicks in your head and the world opens up :)
[2014-06-10 12:08:26 -0400] tsunamie: Hi there
[2014-06-10 12:08:51 -0400] tsunamie: does anyone know how I can reference that I want something to use the servers ip address in a databag
[2014-06-10 12:09:36 -0400] workmad3: djlee: yeah :) in chef, you have resources and providers... a resource declares something along the lines of 'I want X to be done' and a provider goes away and does it... the 'execute' resource can have potentially several different providers, each will execute something in a slightly different way (e.g. using bash, using zsh, using a windows command line)
[2014-06-10 12:10:04 -0400] workmad3: djlee: while the 'bash' resource will just use the bash provider
[2014-06-10 12:11:13 -0400] workmad3: djlee: with bash and execute, chef can't tell if the resource was run in a previous chef run though... so unlike with a package resource (which checks if the package is installed before doing anything else), the execute and bash resources will always run
[2014-06-10 12:13:33 -0400] djlee: workmad3: ah right, would it not be worth making a sort of inheritable resource that stores a simple DB of actions on the VM (like how it stack trace dumps to the VM's error logs). Maybe if i learn enough ruby and chef, i'll have something to work on with that idea?
[2014-06-10 12:14:28 -0400] djlee: workmad3: that way it could check if the script has been executed previously, and not run it if your installing (not sure how youd handle upgrading, maybe store an md5 hash of the file and only run it again if upgrade and hash change?)
[2014-06-10 12:28:03 -0400] bixu: Is anyone else seeing very slow cookbook syncing with hosted chef?
[2014-06-10 12:30:08 -0400] giocalitri: http://serverfault.com/questions/604064/chef-installation-of-nokogiri-with-system-libraries-fails-on-centos-6-5
[2014-06-10 12:30:47 -0400] giocalitri: (my previous question better explained)
[2014-06-10 12:36:19 -0400] Chewi: hello. planning to add postgresql backend support to the rsyslog cookbook and was looking for some guidance on the approach. was going to just add a "postgresql" recipe but then considered that the database might be on another node, so maybe "postgresql_client" and "postgresql_server". that's probably overcomplicating things though.
[2014-06-10 12:37:31 -0400] bixu: Chewi: If you configure your connection to postgres by network address it shouldn't matter if the postgres db is running locally or on another node?
[2014-06-10 12:38:42 -0400] Chewi: bixu: right but I want this to setup the database user and table. might not be able to create the user remotely so the recipe would need to run on the node running postgres.
[2014-06-10 12:39:44 -0400] bixu: I think I see what you mean.
[2014-06-10 12:40:16 -0400] Chewi: the script to create the table lives in the rsyslog package so would have to install it in both places. I don't need a remote database so maybe I'll just take the easy route. :)
[2014-06-10 12:40:41 -0400] bixu: Although I wonder if it would be better to let postgres configurations be handled in a data-driven postgres cookbook?
[2014-06-10 12:41:08 -0400] bixu: Yeah, complexity comes on its own - no need to complicate v1 of your code :)
[2014-06-10 12:41:36 -0400] Chewi: I was also wondering how to handle things like the password, maybe randomly generate it, though the postgres cookbook appears to have some problems with that
[2014-06-10 12:42:12 -0400] bixu: "the unix model" has proven to be pretty useful to me when working on coookbooks (cookbooks that do one thing and one thing well).
[2014-06-10 12:43:11 -0400] bixu: Might want to check out this alternative postgres cookbook for that reason: https://github.com/wanelo-chef/postgres
[2014-06-10 12:44:07 -0400] Chewi: not seen that one but did see another
[2014-06-10 12:44:23 -0400] Chewi: that one doesn't appear to deal with passwords
[2014-06-10 12:44:23 -0400] bixu: It worked well for us at Wanelo.
[2014-06-10 12:45:13 -0400] bixu: That's partly because if someone breaks into your app (the most vulnerable part of most stacks), they have your db, whether or not you set passwords :)
[2014-06-10 12:46:04 -0400] Chewi: true. I prefer to use passwordless peer ident but rsyslog runs as root.
[2014-06-10 12:46:37 -0400] bixu: You can also configure Postgres to allow/block based on the IP of the client, IIRC?
[2014-06-10 12:47:14 -0400] Chewi: well it would only need to listen locally anyway, I suppose
[2014-06-10 12:48:45 -0400] Chewi: think I've got something to go on then, thanks
[2014-06-10 12:52:14 -0400] bixu: Chewi: As you said, the simplest path may be best :)
[2014-06-10 13:11:25 -0400] Chewi: and here's the awkward bit. on CentOS, the SQL script lives at /usr/share/doc/rsyslog-pgsql-5.8.10/createDB.sql. is there any way to query the package version? if not, guess I'll have to use a wildcard.
[2014-06-10 13:15:47 -0400] bixu: O_o
[2014-06-10 13:16:04 -0400] bixu: I'm not very up-to-date on my CentOS/yum.
[2014-06-10 13:16:24 -0400] bixu: I'd be inclined to try to get that information directly from postgres rather than from the package manager, but YMMV.
[2014-06-10 13:16:58 -0400] Chewi: no, that script is used to create the rsyslog table. it's part of the rsyslog-pgsql package.
[2014-06-10 13:17:10 -0400] bixu: Oh - I see.
[2014-06-10 13:17:44 -0400] Chewi: on Debian/Ubuntu, it seems to be /usr/share/dbconfig-common/data/rsyslog-pgsql/install/pgsql though I haven't checked the contents of that yet
[2014-06-10 13:19:56 -0400] Chewi: yeah that's it
[2014-06-10 13:20:28 -0400] bixu: I'd be inclined to keep that logic in the cookbook rather than trusting the package.  Upstream can change pretty easily.
[2014-06-10 13:21:06 -0400] Chewi: yeah but the content on the table could differ between versions, I'd rather use the version it ships with
[2014-06-10 13:21:18 -0400] Chewi: I seem to recall asking that package version question many years ago and the answer at the time was no but a lot has changed since then
[2014-06-10 13:21:35 -0400] Chewi: a wildcard should suffice, you can't install more than one version of this
[2014-06-10 13:23:11 -0400] bixu: Makes sense.
[2014-06-10 13:24:16 -0400] bixu: For any Chef employees on this channel, initial cookbook sync is not completing for me when i provision new machines.
[2014-06-10 13:25:07 -0400] bixu: If I try to manually re-bootstrap ( chef-client -j /etc/chef/first-boot.json -l debug ) I see errors like this:
[2014-06-10 13:25:08 -0400] bixu: [2014-06-10T12:08:14+00:00] ERROR: SSL Validation failure connecting to host: s3-external-1.amazonaws.com - SSL_connect SYSCALL returned=5 errno=0 state=SSLv3 read finished A
[2014-06-10 13:33:20 -0400] mpasternacki: Hm. I'm having trouble trying to find any info, and can't tell if I'm reinventing a wheel:
[2014-06-10 13:34:18 -0400] mpasternacki: I'm writing a cookbook for http://www.tinc-vpn.org/ and I need to assign a new unique IP to each node.
[2014-06-10 13:34:46 -0400] mpasternacki: Is there any simple way that doesn't have a race condition on indexing search that I'm missing?
[2014-06-10 13:36:22 -0400] mpasternacki: Any ideas how to approach that?
[2014-06-10 13:37:54 -0400] r3dk1ng: sorry mpasternacki, I do not know...
[2014-06-10 13:38:21 -0400] workmad3: mpasternacki: personally, I'd probably set up a DHCP server on the VPN so that a new node can obtain an IP address from that... then the next time chef runs on the DHCP server, you could find all nodes on the VPN and set up their current IP address as a static assignment to prevent the IP addresses from wandering around
[2014-06-10 13:38:22 -0400] r3dk1ng: You can't use dhcp?
[2014-06-10 13:38:25 -0400] bcave: hello
[2014-06-10 13:38:41 -0400] r3dk1ng: My turn for a question...
[2014-06-10 13:39:08 -0400] r3dk1ng: I have generate sperate three lists of data, like so
[2014-06-10 13:39:16 -0400] r3dk1ng: ec2.volumes.inject({}) { |m, v| m[v.id] = v.status; m }.each do |data1|
[2014-06-10 13:39:17 -0400] r3dk1ng:   log "Data-Output: #{data1}"
[2014-06-10 13:39:17 -0400] r3dk1ng: end
[2014-06-10 13:39:24 -0400] r3dk1ng: ec2.volumes.inject({}) { |m, v| m[v.id] = v.tags["Name"]; m }.each do |data2|
[2014-06-10 13:39:24 -0400] r3dk1ng:   log "Data-Output: #{data2}"
[2014-06-10 13:39:25 -0400] r3dk1ng: end
[2014-06-10 13:39:29 -0400] r3dk1ng: ec2.volumes.inject({}) { |m, v| m[v.id] = v.tags["Instance"]; m }.each do |data3|
[2014-06-10 13:39:29 -0400] r3dk1ng:   log "Data-Output: #{data3}"
[2014-06-10 13:39:30 -0400] r3dk1ng: end
[2014-06-10 13:40:03 -0400] mpasternacki: This may work, but this would centralize the setup - whole appeal of tinc is that's it's a mesh network without a central authority or SPOF. Also, it seems to need to know its IP to start - but I'll double check that.
[2014-06-10 13:40:12 -0400] r3dk1ng: I am new to Chef and Ruby... is there a way to combine these three so that I get vol.id, stats, tag[Name] and tag[Instnace]?
[2014-06-10 13:40:40 -0400] workmad3: mpasternacki: lacking that, I'd probably try to find a non-conflicting IP address based on the current time (something like Time.now.to_i % 253 or similar) and on each attempt I'd then do a search to see if that IP address has any users other than myself... then on subsequent runs, I'd recheck the IP address, see if it conflicts and if it does, find a new one
[2014-06-10 13:42:34 -0400] bcave: hello
[2014-06-10 13:42:41 -0400] bcave: oh wait, i said that already
[2014-06-10 13:42:41 -0400] workmad3: r3dk1ng: ec2.volumes.each_with_object({}) do |v, m| m[v.id] = {status: v.status, name: v.tags["Name"], instance: v.tags["Instance"]} end
[2014-06-10 13:42:45 -0400] workmad3: bcave: heh
[2014-06-10 13:42:52 -0400] tsunamie: Help me please
[2014-06-10 13:42:53 -0400] r3dk1ng: thanks workmad3
[2014-06-10 13:42:57 -0400] r3dk1ng: I'll try it
[2014-06-10 13:42:58 -0400] bcave: long day =}
[2014-06-10 13:43:09 -0400] workmad3: r3dk1ng: you can then access that hash with [id][:status], etc.
[2014-06-10 13:43:34 -0400] mpasternacki: Hm, I'm thinking now of using last 16 bits of MD5 of node.name as a starting point, adding a counter in case of conflicts. Time would also work...
[2014-06-10 13:44:22 -0400] r3dk1ng: cool
[2014-06-10 13:44:24 -0400] workmad3: mpasternacki: what network are you using? :)
[2014-06-10 13:44:56 -0400] workmad3: mpasternacki: and could you work internally with ipv6, which would give you a much lower change of collision? :)
[2014-06-10 13:45:01 -0400] workmad3: *chance
[2014-06-10 13:45:27 -0400] bcave: i have a question: how different is chef zero to client/server ? the reason I'm asking is that I have a recipe that worked fine with client/server, but is breaking with zero
[2014-06-10 13:45:47 -0400] bcave: and this is the code it's breaking on
[2014-06-10 13:45:50 -0400] bcave: https://gist.github.com/brettcave/3e490087762bdfc066e2
[2014-06-10 13:46:53 -0400] workmad3: bcave: is an extremely lightweight in-memory server... so in many respects it'll act like a normal client/server setup... however, it will contain no persistent information
[2014-06-10 13:46:56 -0400] mpasternacki: workmad3: ipv6 could work, but I'd need to double-check how Docker plays with that
[2014-06-10 13:47:00 -0400] workmad3: bcave: how is it breaking in chef-zero?
[2014-06-10 13:47:27 -0400] bcave: I've just added a comment to the gist. undefined method `body' for nil:NilClass
[2014-06-10 13:47:51 -0400] workmad3: bcave: a) you can edit gists b) could you add the entire stack trace please? :)
[2014-06-10 13:48:14 -0400] workmad3: r3dk1ng: sorry... didn't take into account you being new with ruby...
[2014-06-10 13:48:32 -0400] r3dk1ng: yeah I am new.. sorry.. but I love it so far
[2014-06-10 13:49:47 -0400] workmad3: r3dk1ng: https://gist.github.com/workmad3/af5f372b0f6f9bb7c2b4 more complete
[2014-06-10 13:50:29 -0400] r3dk1ng: ok checking, and thanks!
[2014-06-10 13:50:56 -0400] bcave: haha, added the stacktrace to the gist
[2014-06-10 13:52:00 -0400] workmad3: bcave: hmm... I don't suppose you could include the code that you removed with the comment '# some ruby code that uses fog' please?
[2014-06-10 13:54:03 -0400] workmad3: bcave: also, 'require "rubygems" ' is never needed anymore... since ruby 1.9, rubygems is part of ruby and is always loaded, and ruby 1.8 is now dead and end of life
[2014-06-10 13:54:20 -0400] workmad3: bcave: that won't be causing issues, just suggesting a cleanup ;)
[2014-06-10 13:57:20 -0400] bcave: oh great. i'm on 1.9.1 anyway, so that's great to know
[2014-06-10 13:57:35 -0400] bcave: im adding the missing code
[2014-06-10 13:59:47 -0400] workmad3: bcave: you're on chef 11.12.8... that uses ruby 1.9.3 ;)
[2014-06-10 14:00:09 -0400] workmad3: bcave: don't get confused by the 1.9.1 in the gem path... that's the ABI version, not the version in use
[2014-06-10 14:01:14 -0400] bcave: ah, right yeah
[2014-06-10 14:01:43 -0400] bcave: 11.6.x used ?
[2014-06-10 14:01:46 -0400] bcave: the gist is updated
[2014-06-10 14:03:14 -0400] bcave: i'm wondering if its to do with the node.chef_environment that I'm using
[2014-06-10 14:03:30 -0400] bcave: considering it's not persistent?
[2014-06-10 14:04:28 -0400] workmad3: bcave: could be... 'connection.directories.get("some.bucket").files.get("path/to/my-"+env_key)' is returning nil
[2014-06-10 14:04:58 -0400] bcave: the local file is touched, but not downloaded.
[2014-06-10 14:05:07 -0400] workmad3: bcave: as '      here.write(there.body)' is what fails
[2014-06-10 14:05:10 -0400] turtle_: Anyone know why chef client might fail on the line  " require 'net/scp'  "?
[2014-06-10 14:05:18 -0400] bcave: that... might be the case if env_key isn't being set...
[2014-06-10 14:05:31 -0400] bcave: so might be related to that node reference
[2014-06-10 14:05:55 -0400] workmad3: bcave: well, env_key should be either 'test' or 'main'
[2014-06-10 14:06:09 -0400] workmad3: bcave: could be an issue if it's 'test'
[2014-06-10 14:06:23 -0400] bcave: ah, it's not reallly those values. i've obfusticated a fair amount
[2014-06-10 14:06:35 -0400] bcave: "prod" and "qa"
[2014-06-10 14:07:07 -0400] workmad3: bcave: either way :) your check there should ensure that env_key is always set to *something*
[2014-06-10 14:07:22 -0400] workmad3: bcave: but that's no guarantee that the file exists on the remote ;(
[2014-06-10 14:08:45 -0400] bcave: yeah, it's there
[2014-06-10 14:10:16 -0400] bcave: possibly a permission error
[2014-06-10 14:13:43 -0400] bcave: workmad3: you familiar with AWS and IAM instance profiles at all?
[2014-06-10 14:13:55 -0400] workmad3: bcave: sorry, I'm not
[2014-06-10 14:14:25 -0400] bcave: ok, so basically it's an authorization policy based on resources
[2014-06-10 14:16:20 -0400] bcave: does `chef-client -z` cache the repo locally?
[2014-06-10 14:16:55 -0400] bcave: never mind , im seeing the changes coming through.
[2014-06-10 14:17:21 -0400] bcave: the strange thing is that I have a similar ruby_block earlier in the recipe that does exactly the same thing on the same type of file and it runs
[2014-06-10 14:18:00 -0400] workmad3: bcave: different permissions for the user in question for the bucket?
[2014-06-10 14:18:17 -0400] bcave: i have a bucket policy that grants access to the resources
[2014-06-10 14:18:31 -0400] bcave: the wildcard matches.
[2014-06-10 14:18:58 -0400] workmad3: bcave: dunno then, sorry :(
[2014-06-10 14:19:13 -0400] bcave: ok - im running the code in irb and looks like it is an access issue
[2014-06-10 14:21:25 -0400] bcave: uh oh. complete beginner error.
[2014-06-10 14:21:46 -0400] workmad3: bcave: heh
[2014-06-10 14:22:17 -0400] bcave: it was a bit later in the block, was referencing a key from a yaml object, and the yaml source file wasn't on the host
[2014-06-10 14:23:26 -0400] bcave: ok, great. running :> thanks for the assistance workmad3
[2014-06-10 14:23:38 -0400] workmad3: bcave: np :)
[2014-06-10 14:30:58 -0400] bixu: Still seeing cookbook syncing errors for hosted chef.
[2014-06-10 14:31:08 -0400] bixu: Anyone else seeing this?  SSL-related...
[2014-06-10 14:50:02 -0400] tbenz9: Anyone know of a way to create a Windows Service using "sc.exe" in chef?
[2014-06-10 14:51:53 -0400] mjuszczak: Chef upstream is 1.0.0 but the latest module of sssd_ldap (https://github.com/tas50/chef-sssd_ldap) is 1.0.1.  How does it get updated?
[2014-06-10 14:52:41 -0400] bcave: cheers all
[2014-06-10 14:57:57 -0400] matti: Ohai
[2014-06-10 15:06:56 -0400] cygoonda: Hi. I have an easy question. I have one chef client that isnt able to be bootstrapped, Im pretty sure, because it cant make an https connection to the chef server. Other machines with the same OS, etc. are good.  I see this message woodsmoke02.sing.aws.zuora I<fqdn of client> Installing Chef Client...
[2014-06-10 15:06:56 -0400] cygoonda: <fqdn of client>
[2014-06-10 15:06:57 -0400] cygoonda: woodsmoke02.sing.aws.zuora curl: (7) couldn't connect to host
[2014-06-10 15:07:22 -0400] cygoonda: My question is, Is there a way from the command line of the client to check the connectivity?
[2014-06-10 15:07:23 -0400] cygoonda: Thanks!
[2014-06-10 15:07:58 -0400] cygoonda: I should have said that ping works fine from client to server
[2014-06-10 15:08:00 -0400] stensonb: telnet hostname 443
[2014-06-10 15:08:04 -0400] mkirk_: cygoonda: can you ssh to your client machine and debug? Maybe by using "knife ssh"
[2014-06-10 15:08:22 -0400] stensonb: check dns
[2014-06-10 15:08:23 -0400] stensonb: check route
[2014-06-10 15:10:42 -0400] cygoonda: Hi mkirk, yes I can ssh, but I am trying to bootstrap so knife doesnt yet exist there (its CENTOS) do you recommend I install it manually?
[2014-06-10 15:10:45 -0400] b-dean: I have a remote_file I'm trying to download in a recipe. the file is around 600 mb and it is causing my test kitchen VM to run out of memory (the bento boxes seem to default to 480mb). Is chef downloading remote files in such a way that the whole thing gets read into memory? If so that seems maybe bad
[2014-06-10 15:11:05 -0400] cygoonda: Stensonb: Yup, DNS and route is fine since I can ping
[2014-06-10 15:11:19 -0400] stensonb: dns and route to the chef server, that is.
[2014-06-10 15:11:32 -0400] stensonb: (ensure your local dns is caching the public A record)
[2014-06-10 15:11:53 -0400] stensonb: unless, that's what you meant. :)
[2014-06-10 15:12:09 -0400] cygoonda: yes, understood
[2014-06-10 15:12:43 -0400] cygoonda: The route is fine because I can ping and even do curl -k https://<host>
[2014-06-10 15:13:42 -0400] stensonb: do you get the same error consistently?
[2014-06-10 15:13:52 -0400] SolarisBoy: good day all - i was wondering if there is a way to prevent the chef package resource (for package installations) from using the full version string of a package to just the short name (instead of yum -y install tomcat6-6.0.24-64.el6_5 yum -y install tomcat6)
[2014-06-10 15:14:25 -0400] mkirk_: cygoonda:to clarify - I'm not recommending that you install knife on the remote machine, i meant you could use it from your own machine to connect to the remote, but it sounds like you are *at least* that far already ;)
[2014-06-10 15:14:50 -0400] cygoonda: Stensob: Yes
[2014-06-10 15:15:03 -0400] mkirk_: SolarisBoy: I think that depends on the particular recipe you are trying to use. Maybe take a peek at the recipe and see if there is an attribute you could set to provide whatever version you want.
[2014-06-10 15:15:12 -0400] cygoonda: mkirk: Yes, I can connect from workstation to client
[2014-06-10 15:15:28 -0400] cygoonda: it places the usual files /etc/chef
[2014-06-10 15:15:47 -0400] mkirk_: So what is
[2014-06-10 15:16:05 -0400] mkirk_: So what is it that's different about the way chef is curling, vs. what you are doing from the command line by inspection... hmm...
[2014-06-10 15:16:11 -0400] stensonb: you can curl to https from the box you're trying to bootstrap?
[2014-06-10 15:16:51 -0400] workmad3: cygoonda: it complains about a curl 'cannot connect to host' just after saying 'Installing chef client'?
[2014-06-10 15:16:53 -0400] b-dean: SolarisBoy: the code looks like it's always going to have that version on there: https://github.com/opscode/chef/blob/master/lib/chef/provider/package/yum.rb#L1134
[2014-06-10 15:17:03 -0400] SolarisBoy: mkirk_: looking at the tomcat community from opscode - they do have a major version which defaults to 6 - but within the actual provider code it seems static
[2014-06-10 15:17:05 -0400] cygoonda: Yes, I can curl from the client to server
[2014-06-10 15:17:24 -0400] workmad3: cygoonda: namely, when it's trying to download the appropriate file from opscode to install chef?
[2014-06-10 15:17:27 -0400] SolarisBoy: b-dean: yep - just wanted to know if there may be a way around it other than hard coding the version - if not that is ok
[2014-06-10 15:17:30 -0400] cygoonda: @Workmad3: It takes awhile. 30 seconds or so, like a time out
[2014-06-10 15:17:49 -0400] SolarisBoy: b-dean: seems like there may not be - no worries - thanks for the confirmation
[2014-06-10 15:18:00 -0400] cygoonda: wordmad3: Oh? I didnt know its going to opscode to download a file
[2014-06-10 15:18:05 -0400] mkirk_: you dont have any proxy variables being sourced in your .bashrc do you? e.g. $http_proxy or $https_proxy
[2014-06-10 15:18:20 -0400] mkirk_: cygoonda: ^^
[2014-06-10 15:19:16 -0400] workmad3: cygoonda: https://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb#L32
[2014-06-10 15:19:18 -0400] cygoonda: @mkirk, no not that I can tell.
[2014-06-10 15:20:39 -0400] workmad3: cygoonda: basically, that line is trying to download "https://www.opscode.com/chef/install.sh" with curl and then run it via bash... and it sounds like that's where your bootstrapping is failing
[2014-06-10 15:20:52 -0400] workmad3: cygoonda: can you hit www.opscode.com from your node? :)
[2014-06-10 15:22:09 -0400] cygoonda: @workmad3: That was it! Thanks!DNE working but not ping!
[2014-06-10 15:22:17 -0400] cygoonda: I can now figure out the rest, thankts!
[2014-06-10 15:22:35 -0400] workmad3: cygoonda: :)
[2014-06-10 15:22:55 -0400] cygoonda: Yeah, big thanks!
[2014-06-10 15:23:23 -0400] medya: can cookbook files have attributes like template?
[2014-06-10 15:24:01 -0400] workmad3: medya: what sort of attributes?
[2014-06-10 15:24:05 -0400] b-dean: is there a more appropriate room to ask about bento boxes?
[2014-06-10 15:25:08 -0400] whiteadam: b-dean: probably not
[2014-06-10 15:25:20 -0400] phantasm66: hey all... i have a question about knife bootstrapping a new node
[2014-06-10 15:27:14 -0400] phantasm66: my node has registered with my chef server:
[2014-06-10 15:27:15 -0400] phantasm66: https://gist.github.com/phantasm66/018fce768180d7f8225c
[2014-06-10 15:27:19 -0400] b-dean: so I have a number of test that are using the centos bento boxes that are starting to fail with unable to allocate memory errors. I've had to increase the memory to make them work again but my recipes haven't really changed at all
[2014-06-10 15:28:09 -0400] phantasm66: as a test, i have the following in my default.rb attributes file for one of the cookbook's in question:
[2014-06-10 15:28:13 -0400] phantasm66: Chef::Log.info("CUSTOM DEBUGGING: #{node[:machinename]}")
[2014-06-10 15:28:38 -0400] b-dean: I'm getting stuff like "Cannot allocate memory - fork(2)" for the apache2::default recipe
[2014-06-10 15:28:45 -0400] phantasm66: which, you can seein the chef run output gist i posted above (https://gist.github.com/phantasm66/018fce768180d7f8225c)... is seen as an empty attribute
[2014-06-10 15:28:57 -0400] phantasm66: yet, on the node in question, i run this manually:
[2014-06-10 15:29:13 -0400] phantasm66: [root@mta-docker2 ~]# ohai machinename
[2014-06-10 15:29:14 -0400] phantasm66: [
[2014-06-10 15:29:14 -0400] phantasm66:   "mta-docker2.colo.mydomain.com"
[2014-06-10 15:29:15 -0400] phantasm66: ]
[2014-06-10 15:29:35 -0400] phantasm66: so, why is the chef run for this node not able to access the attributes as they are set on the node?
[2014-06-10 15:30:55 -0400] phantasm66: also, on the chef server, "knife node show mta-docker2.mydomain.com" shows this:
[2014-06-10 15:30:57 -0400] phantasm66: https://gist.github.com/phantasm66/fd1203e235006f9bb6ea
[2014-06-10 15:31:20 -0400] phantasm66: which shows it's registered, but has no node attributes set... strangely
[2014-06-10 15:32:17 -0400] phantasm66: and this is how i knife bootstrapped the new node:
[2014-06-10 15:32:20 -0400] phantasm66: https://gist.github.com/phantasm66/ab0ab07fba19a78ebc15
[2014-06-10 15:34:09 -0400] trilitheus: Hi anyone know if it possible to automate RHEL registration via CHEF - can;t see anyway around that manual step "up2date --register"
[2014-06-10 15:34:27 -0400] trilitheus: or just automate it?
[2014-06-10 15:36:20 -0400] b-dean: trilitheus: we usually do that as part of setting up the machine before it's bootstrapped. I think maybe it's done with a VMWare customization or something. in any case it's already registered with the RHN by the time chef is doing anything
[2014-06-10 15:36:43 -0400] srenatus: trilitheus: https://github.com/bflad/chef-rhn  maybe? never tried
[2014-06-10 15:38:08 -0400] prometheanfire: can you do include_recipe within ruby blocks?
[2014-06-10 15:39:06 -0400] prometheanfire: I'n trying to figure out an resouce I can include it in so that I can delay notifiactions to it and so attributes that get set get set in the correct order
[2014-06-10 15:40:18 -0400] medya: can I have a variable in my cookbook files (files folder) that can be assigned by the attributes in the cookbook ?
[2014-06-10 15:52:14 -0400] mkirk_: medya: you can render templates (http://docs.opscode.com/essentials_cookbook_templates.html) and pass them variables. These variables can come from your attributes file.
[2014-06-10 15:55:02 -0400] medya: mkirk_ if I want a template to be created only for a platform , (let say just ubuntu) how do I do that
[2014-06-10 15:57:20 -0400] thom: template('foo') { only_if { node[:platform] == 'ubuntu' } }
[2014-06-10 15:57:32 -0400] thom: essentially
[2014-06-10 15:58:57 -0400] matti: Or, `ubuntu?' if chef-suger is there ;]
[2014-06-10 15:59:12 -0400] matti: sugar*
[2014-06-10 15:59:14 -0400] matti: Dammit.
[2014-06-10 16:01:45 -0400] medya: @+thom thanks, does it have to be on the first line?
[2014-06-10 16:02:10 -0400] thom: medya: no, anywhere in the template block
[2014-06-10 16:03:55 -0400] djlee: Hi all, i am using vagrant to help me create the chef cookbooks that i will host and use on AWS opsworks. I noticed that opsworks make some attributes available such as the deploy username and potentially other attributes i may find useful. I'm guessing a lot of you here have done the same, so how do you polyfill those attributes in vagrant? Is there an aws cookbook that i can use just with vagrant  to provide those opswo
[2014-06-10 16:03:56 -0400] djlee: rks attributes outside of opsworks?
[2014-06-10 16:14:43 -0400] gondoi: knife bootstrap just randomly started setting my chef server url as localhost
[2014-06-10 16:15:05 -0400] gondoi: has anyone ever seen this?
[2014-06-10 16:15:32 -0400] gondoi: i tried removing /etc/chef and /opt/chef and starting all over, but it insists on using localhost
[2014-06-10 16:15:37 -0400] gondoi: i'm using hosted chef
[2014-06-10 16:15:42 -0400] chernjie: hi mikesplain
[2014-06-10 16:15:55 -0400] mikesplain: Hey there chernjie
[2014-06-10 16:17:05 -0400] x0nic: gondoi: I dont think knife bootstrap will set hostname. It is more of an issue on how your VPS providers default images are configured. I had to use the hostname cookbook to fix that issue
[2014-06-10 16:19:02 -0400] gondoi: x0nic: just found the issue
[2014-06-10 16:19:06 -0400] gondoi: i was passing it -l debug
[2014-06-10 16:19:08 -0400] gondoi: .....
[2014-06-10 16:19:13 -0400] gondoi: that was causing it to connect to localhost
[2014-06-10 16:19:35 -0400] gondoi: i'm running 11.12.8
[2014-06-10 16:19:36 -0400] mkirk_: medya: consider that `template` is a method call which eventually creates the rendered template on your remote machine. So, wrap the call to that method in a conditional. e.g. if node['platform'] == 'ubuntu'
[2014-06-10 16:19:37 -0400] gondoi: :(
[2014-06-10 16:20:37 -0400] mkirk_: medya: thom's answer is better - go with their suggestion (using only_if)
[2014-06-10 16:20:54 -0400] medya: thanks mkirk_
[2014-06-10 16:26:53 -0400] doug1: I have a bunch of nodes, where chef-client has run ok, but there's NO data on the server for the node. Why would that be?
[2014-06-10 16:31:46 -0400] djlee: does anyone know where i might find a sort of opsworks shim that i can use in vagrant to provide chef with the opsworks attributes that it can expect on opsworks when i deploy
[2014-06-10 16:41:37 -0400] r3dk1ng: I have an interesting situation in one of my recipes.  I have a method called poop that generates an object like poop[crap][flies], etc... I need to test against it based upon different conditions.   However there is one condition in which the whole thing is nil..... I have something like this "if poop[crap][flies].nil?" # do something, but I keep getting undefined [] nill class
[2014-06-10 16:41:37 -0400] r3dk1ng: method errors....
[2014-06-10 16:41:41 -0400] r3dk1ng: any suggestions?
[2014-06-10 16:43:00 -0400] tcotav: use more descriptive variable names
[2014-06-10 16:43:37 -0400] tcotav: doesn't that mean that there is no crap?
[2014-06-10 16:43:38 -0400] coalbe: heh
[2014-06-10 16:44:11 -0400] tcotav: basically, you're testing two dimensions in, the nil will catch the flies part, but will error on crap
[2014-06-10 16:44:24 -0400] prometheanfire: directly calling run_context.include_recipe seems to work
[2014-06-10 16:47:19 -0400] r3dk1ng: tcotav... Ok... I that makes sense... how can I get the nil to work on the whole thing?
[2014-06-10 16:50:28 -0400] tcotav: there's probably some cooler ruby way to do it, but you'd have to check poop[crap].nil? first
[2014-06-10 16:51:20 -0400] r3dk1ng: hmm ok
[2014-06-10 16:51:24 -0400] r3dk1ng: let me try that, thanks
[2014-06-10 16:53:25 -0400] r3dk1ng: can you exit or end a recipe?
[2014-06-10 16:56:05 -0400] Brad_K: Has anyone reported any network problems with synchronizing cookbooks, etc  to Hosted Chef?
[2014-06-10 16:58:38 -0400] mfeingold: I have a question. I am running a cookbook with jenkins. I have a service resource in my recipe and it says service 'jenkins' do
[2014-06-10 16:58:53 -0400] mfeingold: action :disable
[2014-06-10 16:58:56 -0400] mfeingold: and fails
[2014-06-10 16:59:13 -0400] mfeingold: If I use any actions on it it fails for that matter
[2014-06-10 17:01:53 -0400] gleam: with what error?
[2014-06-10 17:02:20 -0400] mfeingold: [2014-06-10T16:57:13+00:00] ERROR: Exception handlers complete
[2014-06-10 17:02:21 -0400] mfeingold:        [2014-06-10T16:57:13+00:00] FATAL: Stacktrace dumped to /tmp/kitchen/cache/chef-stacktrace.out
[2014-06-10 17:02:21 -0400] mfeingold:        Chef Client failed. 12 resources updated in 97.166544122 seconds
[2014-06-10 17:02:22 -0400] mfeingold:        [2014-06-10T16:57:13+00:00] ERROR: service[jenkins] (dynamically defined) had an error: Errno::ENOENT: No such file or directory - /sbin/sv restart /etc/service/jenkins
[2014-06-10 17:02:22 -0400] mfeingold:        [2014-06-10T16:57:13+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
[2014-06-10 17:03:27 -0400] mfeingold: I think I know why now. There is no directory
[2014-06-10 17:03:35 -0400] mfeingold: when I kitchen login
[2014-06-10 17:04:10 -0400] phil_s_stein: Hello. I'm using open source chef and am trying to 'knife bootstrap' a client node. All goes well, until the client tries to connect to my server. It is using http://localhost/client for the URL instead of the chef-server url. Does anyone know where/how I set the proper URL for 'knife bootstrap'?
[2014-06-10 17:04:14 -0400] mkirk_: cygoonda: I'm (just now) seeing similar behavior from my ubuntu1404 box now. For some reason im' not able to connect to getchef.com from my vagrant box. But if I edit /etc/resolve.conf to use google DNS it resolves. This is just a temporary fix though. Did you come up with a longer term solution?
[2014-06-10 17:07:36 -0400] shlant: phil_s_stein: should be in ~/.chef/knife.rb
[2014-06-10 17:08:04 -0400] shlant: phil_s_stein: first setting :http://docs.opscode.com/config_rb_knife.html
[2014-06-10 17:08:13 -0400] phil_s_stein: What is the setting though? I have server_url which it seems to ignore.
[2014-06-10 17:08:47 -0400] shlant: phil_s_stein: chef_server_url*
[2014-06-10 17:10:21 -0400] phil_s_stein: I have that setting, but it seems to be ignoring it.
[2014-06-10 17:10:39 -0400] phil_s_stein: It's odd.
[2014-06-10 17:13:45 -0400] Alayde: Hey guys, question about node clean up (for those of us unlucky enough to work in an environment where we can just destroy and spin up VMs at will). We're thinking of something along the lines of the up/down methods in Rails migrations, where basically we have a recipe that will check for an attribute in a role, if that attribute exists it will run a recipe to install packages, write out configs, etc, but if not then we'll have a recipe
[2014-06-10 17:14:15 -0400] Alayde: opposite, where it removes said packages, removes the written out configs, etc. Anyone have experience doing this? What did you end up going with
[2014-06-10 17:14:26 -0400] Alayde: er, if so, what did you end up going with?*
[2014-06-10 17:20:41 -0400] doug1: I am horribly confused. My recipe has 'node.override['mongodb']['config']['rest'] = nil'. When I print it _immediately_ after setting it, with inspect, it shows "rest"=>false. How can that be?
[2014-06-10 17:21:31 -0400] cheeseplus: Alayde: the better designed cookbooks (imo) have an uninstall/remove resource as part of the cookbook
[2014-06-10 17:21:32 -0400] gleam: https://tickets.opscode.com/browse/CHEF-4438
[2014-06-10 17:21:38 -0400] doug1: However, if I set it to a literal and then print it, it shows the value I set.
[2014-06-10 17:21:59 -0400] gleam: ^^ doug1
[2014-06-10 17:22:24 -0400] doug1: gleam: &%$%^&#*#*! !!!
[2014-06-10 17:22:39 -0400] gleam: click the vote button, maybe it'll get fixed
[2014-06-10 17:22:54 -0400] doug1: this isn't just override btw... also happens with node.set
[2014-06-10 17:23:03 -0400] doug1: why do I always get the crazy bugs?
[2014-06-10 17:25:44 -0400] mjuszczak: If I only want test kitchen to execute a recipe if I'm running "kitchen test" but never in production, is the proper way to do just create a recipe called "testing.rb" and only include it on the runlist inside test kitchen but no where else?
[2014-06-10 17:26:57 -0400] davidordave: Alayde, the zap cookbook seems to be along those lines. Might be a place to start.
[2014-06-10 17:27:21 -0400] davidordave: I don't have any firsthand experience with it though.
[2014-06-10 17:28:40 -0400] mkirk_: mjuszczak: #kitchenci
[2014-06-10 17:29:25 -0400] mkirk_: mjuszczak: that sounds like a reasonable solution though.
[2014-06-10 17:38:09 -0400] mjuszczak: thanks mkirk!
[2014-06-10 17:39:59 -0400] doug1: So, given chef bug https://tickets.opscode.com/browse/CHEF-4438, I wonder how I can remove specific attributes for specific recipes?
[2014-06-10 17:40:24 -0400] doug1: cuz, chef loads all attributes automatically... I need to remove some for specific roles
[2014-06-10 17:45:38 -0400] doug1: *sigh*
[2014-06-10 17:45:49 -0400] mkirk_: doug1: Are they your own cookbooks, or are you using them off the shelf?
[2014-06-10 17:46:17 -0400] doug1: mkirk_: My own.
[2014-06-10 17:47:08 -0400] mkirk_: could you check in the recipe for the false value, and treat it as nil (as a kludgy work-around)?
[2014-06-10 17:47:32 -0400] doug1: mkirk_: no, because i need to remove the keys from a config file even if they are false.
[2014-06-10 17:48:51 -0400] doug1: ugh, maybe false will do. what a kludge
[2014-06-10 17:49:01 -0400] doug1: this bug has been open for a YEAR
[2014-06-10 18:01:54 -0400] Otterley: is Enterprise Chef using Postgres, or is it just the implementation used by OSS Chef Server?
[2014-06-10 18:02:36 -0400] Otterley: To my knowledge pgsql doesn't have a tunable socket backlog and the impact is bubbling up to erchef in the form of "no_connection" errors.
[2014-06-10 18:02:44 -0400] c_t: postgres all the way down
[2014-06-10 18:03:07 -0400] Otterley: I've now raised the db_pool to 300 which is insane.
[2014-06-10 18:06:44 -0400] ickymettle: howdy folks ... unless i'm missing something should "action :upgrade" on a chef_gem resource always upgrade an installed gem to the latest version available?
[2014-06-10 18:07:58 -0400] c_t: Otterley: unfortunately I'm only now finally diving into the world of postgres, so I'm not sure what the answer is
[2014-06-10 18:08:09 -0400] c_t: if I discover it I'll try to remember to let you know
[2014-06-10 18:08:32 -0400] Otterley: actually, it looks like this tunable is for erchef in terms of its own connection pool size
[2014-06-10 18:08:42 -0400] Otterley: there's a different tunable for postgresql
[2014-06-10 18:08:54 -0400] c_t: ah
[2014-06-10 18:09:03 -0400] Otterley: why erchef uses a db client pool, I'll never know
[2014-06-10 18:09:11 -0400] c_t: I've been diving in for goiardi+postgres
[2014-06-10 18:09:43 -0400] c_t: it's coming along nicely too (postgres gets the c_t stamp of approval so far), although it's on the back burner while I get import/export working
[2014-06-10 18:09:51 -0400] Alayde: cheeseplus, davidordave: Thanks guys. I'll check out the zap cookbook
[2014-06-10 18:11:51 -0400] Otterley: chef guys, is there a tunable for the 11.1 depsolver concurrency?  don't see one in the release notes or docs
[2014-06-10 18:18:14 -0400] robbkidd: Anyone seeing (or know of) a 403 error from GitHub when using a chef git resource to `action :sync` a repo? I'm getting a 403 with a message "GitHub.com no longer supports git over dumb-http: https://github.com/blog/809-git-dumb-http-transport-to-be-turned-off-in-90-days" but that post is dated 3 years ago.
[2014-06-10 18:18:57 -0400] awc737: Can I use Data bag variables within a Node file?
[2014-06-10 18:19:53 -0400] Otterley: robbkidd, the error message seems pretty self-explanatory; if the repo to be cloned is an http URL it won't work
[2014-06-10 18:20:42 -0400] robbkidd: Well, yes. Self-explanatory on the face of it. But this cookbook with no changes worked yesterday and for the past 6 months.
[2014-06-10 18:21:09 -0400] Otterley: that I cannot explain :)
[2014-06-10 18:22:16 -0400] Otterley: awc737, can you explain your use case?  not sure I understand your question
[2014-06-10 18:22:22 -0400] Otterley: a data bag and a node are separate objects
[2014-06-10 18:22:34 -0400] Otterley: separate object classes, even
[2014-06-10 18:22:47 -0400] awc737: Otterley thanks, in nodes/host.json, I have "mysql": { server_root_password": "password"
[2014-06-10 18:22:57 -0400] awc737: I want to know if I can put that password in an encrypted data bag
[2014-06-10 18:23:08 -0400] awc737: and then reference the variable within the node JSON somehow
[2014-06-10 18:23:37 -0400] robbkidd: Yea. Confusing. OK. I'm still digging. I get the error at https://github.com/opscode/chef/blob/11.12.8/lib/chef/provider/git.rb#L250 ... the ls-remote *is* being called with an https:// URL. On the chef node (Ubuntu, git v1.7.9.5), I get a 403. Running the ls-remote on Mac (git v 1.9.1), no 403. :\
[2014-06-10 18:24:28 -0400] robbkidd: Pff. And now Ubuntu, git v1.7 works.
[2014-06-10 18:24:39 -0400] Otterley: LOL
[2014-06-10 18:24:52 -0400] matti: Hahah
[2014-06-10 18:24:55 -0400] matti: robbkidd: :)
[2014-06-10 18:25:15 -0400] Otterley: robbkidd, every day I'm amazed that this shit works at all
[2014-06-10 18:25:18 -0400] matti: robbkidd: Too put your hand too high... watch out for lightnings ;]
[2014-06-10 18:25:37 -0400] matti: Otterley: More appropriate term I use: water vapour ;
[2014-06-10 18:26:23 -0400] matti: Hahah
[2014-06-10 18:26:41 -0400] matti: I just had a mental picture of this ;S
[2014-06-10 18:26:42 -0400] matti: Haha
[2014-06-10 18:27:27 -0400] awc737: Otterley did that use case make sense?
[2014-06-10 18:27:28 -0400] Otterley: awc737, for security reasons I would not copy data from an encrypted data bag to a node attribute
[2014-06-10 18:27:54 -0400] Otterley: if you're using chef server, that attribute will become cleartext visible to anyone who has access to chef
[2014-06-10 18:28:22 -0400] awc737: oh ok, so is Data bag a good use case to just store server credentials for reference?
[2014-06-10 18:28:54 -0400] Otterley: well, I don't personally use encrypted data bags, but yes, that's what they were designed for
[2014-06-10 18:30:05 -0400] robbkidd: I should have figured the git deploy problem was confined to me or I'd have some in here to find the world on fire.
[2014-06-10 18:31:23 -0400] robbkidd: s/some/come/
[2014-06-10 18:34:51 -0400] mfeingold: Hi I was wondering I'm running kitchen with jenkins on centos6.4.  I can set up an instance with vagrant portforwarding port 8080 for jenkins. How do I do that with kitchen?
[2014-06-10 18:38:06 -0400] jeffcara: You mean adjusting your .kitchen.yml file like this? https://gist.github.com/jcarapet/8acd50f1bc1ca6673ce5
[2014-06-10 18:39:09 -0400] mfeingold: Perfect thank you
[2014-06-10 18:39:17 -0400] mfeingold: Where can I find documentation like that
[2014-06-10 18:40:02 -0400] jeffcara: There is some on the test-kitchen github ReadMe.
[2014-06-10 18:40:14 -0400] sauraus: Anyone user the 'users' cookbook? Looks like it's not creating the .ssh and authorized_keys file for me :(
[2014-06-10 18:40:32 -0400] jeffcara: That being said, I don't have a full grasp of YAML syntax so sometimes when I copy/paste it doesn't work.
[2014-06-10 18:40:48 -0400] mikesplain: mfeingold: If you're using vagrant, most of it's documentation for those things is here: https://github.com/test-kitchen/kitchen-vagrant
[2014-06-10 18:41:01 -0400] chance: with the apache community cookbook, how does one pass in extra variables to the web_app lwrp and a custom template?
[2014-06-10 18:41:14 -0400] chance: with template, you just use the variables( :foo => "bar" ) but i am unsure of how to do something like that with the web_app lwrp
[2014-06-10 18:41:40 -0400] mfeingold: Thank you
[2014-06-10 18:41:47 -0400] mikesplain: np
[2014-06-10 18:42:41 -0400] Otterley: test-kitchen's documentation is... lacking
[2014-06-10 18:42:54 -0400] chance: aint it the truth..
[2014-06-10 18:43:08 -0400] mikesplain: yep... trial and error hah
[2014-06-10 18:44:31 -0400] anthonyacquanita: anyway to print, debug variables from with a template file?
[2014-06-10 18:44:50 -0400] chance: you can log the values you pass to the template lwrp
[2014-06-10 18:45:23 -0400] chance: just like foo = { :bar => baz } log foo; template "test.txt" do variables foo end
[2014-06-10 18:45:39 -0400] anthonyacquanita: @backends.each  works in the template but @backends.first right below it does not
[2014-06-10 18:45:53 -0400] anthonyacquanita: so I know the variable has values
[2014-06-10 18:46:10 -0400] chance: no errors?
[2014-06-10 18:46:29 -0400] chance: if .first isnt working, it should error, or give something
[2014-06-10 18:46:45 -0400] anthonyacquanita: nope, it just doesn't enter block
[2014-06-10 18:47:05 -0400] cap10morgan: Is there a cookbook out there for setting ec2 instance attributes? i.e. what this command does: http://docs.aws.amazon.com/cli/latest/reference/ec2/modify-instance-attribute.html
[2014-06-10 18:47:37 -0400] chance: anthonyacquanita: in the template display the value
[2014-06-10 18:47:55 -0400] chance: just <%= @value.first %>
[2014-06-10 18:47:59 -0400] chance: see what it puts into it
[2014-06-10 18:48:22 -0400] anthonyacquanita: ahh, I'll try that  https://gist.github.com/anonymous/230095300b77caea3c9f
[2014-06-10 19:10:41 -0400] jeffcara: has anybody had issues with test kitchen running 11.12.8 to converge resources? I am not able to get any of my resources to converge on a couple of recipes I have created today, and I even have Chefspec tests that confirm it's good code
[2014-06-10 19:11:28 -0400] jeffcara: I have had box issues as well entirely possible it's related
[2014-06-10 19:39:29 -0400] Dholland: Hello everyone.  Anyone here with knowledge installing the knife-ec2 gem?
[2014-06-10 19:49:43 -0400] BubbRubb: is there an omnibus channel?
[2014-06-10 19:53:14 -0400] Dholland: Is anyone actually active here?
[2014-06-10 19:53:41 -0400] stormerider: from time to time.
[2014-06-10 19:54:00 -0400] stormerider: and i've used knife-ec2 but not recently, ie, not since chefdk
[2014-06-10 19:54:07 -0400] stormerider: BubbRubb: not that im aware of, no.
[2014-06-10 19:54:29 -0400] Dholland: I'm trying to find out if anyone knows a solution to the libconv issue with nokogiri during the knife-ec2 install that happens with the most current version of software on a mac
[2014-06-10 19:54:55 -0400] Dholland: I've been all over the interwebs and am not having much luck
[2014-06-10 19:55:03 -0400] stormerider: Dholland: are you using the standard system ruby?
[2014-06-10 19:55:11 -0400] jeffcara: Ah, you too eh? My partner had a similar issue on his machine that I couldn't figure out.
[2014-06-10 19:55:16 -0400] Dholland: Installed with Brew
[2014-06-10 19:55:34 -0400] Dholland: ruby 2.0.0p451 (2014-02-24 revision 45167) [universal.x86_64-darwin13]
[2014-06-10 19:55:47 -0400] Dholland: jeff: driving me up the wall
[2014-06-10 19:55:52 -0400] stormerider: hm. that's how i have mine installed, but i havent updated it in a while. though im using 193 for the most part.
[2014-06-10 19:56:11 -0400] Dholland: I tried with 193 as well
[2014-06-10 19:56:17 -0400] stormerider: you might want to try chefdk and chef gem install knife-ec2 and see how that works
[2014-06-10 19:56:56 -0400] Dholland: grabbign chef-dk now
[2014-06-10 19:56:56 -0400] jeffcara: Yeah, I spent a good 3 hours on it the other day without a solution. I tried a direct copy of the stuff from /opt/chefdk/embedded/bin/gems (I think that's where it's stored), but even that didn't work.
[2014-06-10 19:57:15 -0400] Dholland: I've found several "solutions" on the internet but none of them work.
[2014-06-10 19:57:32 -0400] Dholland: I posted to the nokogiri group after following their directions too.. no dice...
[2014-06-10 19:57:36 -0400] Dholland: shouting into space
[2014-06-10 19:57:37 -0400] jeffcara: Dholland. They seem to be non chef specific or not applicable.
[2014-06-10 19:57:58 -0400] stensonb: you using rvm or rbenv?
[2014-06-10 19:58:14 -0400] stensonb: i've seen troubles (not specifically with this) when using the stock system ruby
[2014-06-10 19:58:17 -0400] Dholland: rvm
[2014-06-10 19:58:24 -0400] stensonb: in a new/clean gemset?
[2014-06-10 19:58:33 -0400] Dholland: yeah
[2014-06-10 19:58:57 -0400] stormerider: using chefdk i was able to build nokogiri natively just fine
[2014-06-10 19:59:06 -0400] jeffcara: When you get Chefdk I found that it didn't pickup my existing knife-ec2 gem. You might have to try <chef gem install knife-ec2> to get it to recognize it.
[2014-06-10 19:59:25 -0400] Dholland: chefdk is installing right now
[2014-06-10 20:01:39 -0400] stormerider: Dholland: i will mention the chef folks tend to be anti-rvm
[2014-06-10 20:02:16 -0400] Dholland: I'm just pro-working
[2014-06-10 20:02:21 -0400] Dholland: whatever that takes :)
[2014-06-10 20:02:27 -0400] stormerider: *nod*
[2014-06-10 20:03:08 -0400] Dholland: doing the chef gem install now for knife-ec2
[2014-06-10 20:03:42 -0400] Dholland: hopefully that does it.... head is sore and the wall is probably tired of me banging my head against it as well.
[2014-06-10 20:03:55 -0400] stormerider: heh
[2014-06-10 20:04:00 -0400] stormerider: poor wall :)
[2014-06-10 20:04:12 -0400] Dholland: indeed
[2014-06-10 20:05:21 -0400] Dholland: hooray
[2014-06-10 20:05:26 -0400] Dholland: It looks like that might have done it
[2014-06-10 20:06:44 -0400] stormerider: :)
[2014-06-10 20:11:17 -0400] Dholland: half working
[2014-06-10 20:23:52 -0400] Dholland: Totally working.  Thank you all who helped - I'm going to go reply on the threads where I found other people having this error with this solution.
[2014-06-10 20:32:10 -0400] jreslock: Has anyone used the community hadoop cookbook?  I'm using it and I want to use a local repo instead of what is defined in hadoop::repo but I'm finding it difficult to override since each of the 'hadoop::' component recipes include the repo recipe.  Makes it hard to write a wrapper without hacking it up.
[2014-06-10 20:41:39 -0400] nexact: i'm looking to build a shared web hosting server and I was wondering if chef would be able to "regenerate" apache vhost file on tha server (without restarting the server) or is it only for provisioning every boot ?
[2014-06-10 20:43:19 -0400] mattt: nexact: nope you can regenerate your apache config and reload apache
[2014-06-10 20:45:38 -0400] mattt: nexact: i'm not entirely sure chef would be the best tool for the job but it could work
[2014-06-10 20:48:30 -0400] nexact: mattt: ok, so I could like, create a script that generate a cookbook and then proceed to upload it on the server ? and once in a while, just run chef client ?
[2014-06-10 20:49:51 -0400] prometheanfire: how do I set an attribute if it doesn't exist
[2014-06-10 20:50:18 -0400] prometheanfire: tried node.set_unless and node.default['tomcat']['keystore_password'] = secure_password unless node['tomcat'].member?('keystore_password')
[2014-06-10 20:50:25 -0400] mattt: prometheanfire: node.set_unless ?
[2014-06-10 20:50:39 -0400] prometheanfire: set_unless sets unconditionally
[2014-06-10 20:50:56 -0400] prometheanfire: basically, tomcat is resetting it's config file every time it's run
[2014-06-10 20:50:57 -0400] mattt: shouldn't do?
[2014-06-10 20:51:09 -0400] prometheanfire: which restarts it every time it's run
[2014-06-10 20:51:12 -0400] prometheanfire: bad voojoo
[2014-06-10 20:52:32 -0400] mattt: nexact: not really, you would have a static cookbook to do what you want then manipulate virtualhosts using attributes
[2014-06-10 20:52:47 -0400] mattt: nexact: the workflow for this use case feels a bit odd, which is why i'm not 100% sure chef is the right tool
[2014-06-10 21:26:48 -0400] medya: is it possible for a execute block to have two Commands?
[2014-06-10 21:27:03 -0400] medya: do I need to have two execute block for two commands?
[2014-06-10 21:29:58 -0400] mivok: you might be able to do: command "foo; bar"
[2014-06-10 21:30:30 -0400] mattt: mivok: my thought too
[2014-06-10 21:30:36 -0400] CJNE: medya, you can one command but in that command you can do multiple things: command "echo 1; echo 2;"
[2014-06-10 21:30:40 -0400] mattt: but i'd rather just have two execute blocks
[2014-06-10 21:52:53 -0400] Dholland: Hey guys.  I'm bootstrapping chef in ec2.  It's a newly installed server.  I'm having an issue where the install of the chef client is bombing out because the URL it's trying to get the insall from is 404ing:
[2014-06-10 21:53:04 -0400] Dholland: Downloading https://www.opscode.com/chef/metadata?v=11.14.0.alpha.1&prerelease=false&nightlies=false&p=el&pv=6&m=x86_64
[2014-06-10 21:53:09 -0400] Dholland: ERROR 404
[2014-06-10 21:53:16 -0400] Dholland: Unable to retrieve a valid package!
[2014-06-10 21:53:25 -0400] Dholland: I have a feeling it's possible something in the versioning?
[2014-06-10 21:53:29 -0400] Dholland: possibly
[2014-06-10 21:54:27 -0400] workmad3: Dholland: hmm... you're asking for a prerelease, but saying prerelease=false...
[2014-06-10 21:54:50 -0400] workmad3: Dholland: dunno if that's an issue or not, but it certainly seems incongruous to me :)
[2014-06-10 21:54:50 -0400] Dholland: This is with a base install, too
[2014-06-10 21:54:59 -0400] Dholland: where can I change that?
[2014-06-10 21:55:52 -0400] workmad3: Dholland: not sure... are you asking it to install 11.14.0.alpha.1 anywhere? if so, I'd suggest trying 11.12.8 instead
[2014-06-10 21:56:19 -0400] Dholland: I can't find any place I'm specifying a version at all
[2014-06-10 21:57:07 -0400] tcotav: you're using chefdk, right?
[2014-06-10 21:57:34 -0400] tcotav: I thought there was some bug with that...
[2014-06-10 21:58:02 -0400] tcotav: https://tickets.opscode.com/browse/CHEF-5275
[2014-06-10 21:58:39 -0400] Dholland: I am using chefdk
[2014-06-10 21:59:03 -0400] shlant: anyone use the aws-rds cookbook?
[2014-06-10 21:59:11 -0400] Dholland: That smells exactly like my issue tcotav
[2014-06-10 21:59:12 -0400] tcotav: I think you just need to upgrade chefdk.  pretty sure they fixed that bug.  (I ran into it as well)
[2014-06-10 22:00:48 -0400] jtimberman: Dholland: you can specify the bootstrap version of chef to install with --bootstrap-version on the knife bootstrap or knife ec2 command.
[2014-06-10 22:02:00 -0400] cheeseplus: jtimberman: any idea why the -k (key) option wouldn't be respected by knife for bootstrapping?
[2014-06-10 22:02:33 -0400] cheeseplus: jtimberman: ex - knife bootstrap localhost -N zebra --sudo -u cheeseplus -P MAPASSWD -k ORG-validator.pem
[2014-06-10 22:03:14 -0400] CJNE: sure it's not capital -K ? it is for chef-client at least
[2014-06-10 22:05:00 -0400] jeffcara: tcotav: Any word on when that will be fixed? I have had the same issue and find it a minor inconvenience
[2014-06-10 22:05:23 -0400] jeffcara: or more specifically, when they are releasing chefdk 0.1.1
[2014-06-10 22:06:53 -0400] Dholland: I'm giving it a shot specifying the version now.
[2014-06-10 22:07:07 -0400] cheeseplus: CJNE: knife bootstrap show a lowercase k and errors on a capital
[2014-06-10 22:07:11 -0400] cheeseplus: shows*
[2014-06-10 22:08:24 -0400] CJNE: cheeseplus, ah yeah, it should be -k for knife. Then i don't have an answer
[2014-06-10 22:08:34 -0400] shlant: jtimberman: any Idea why I would be getting "The parameter Filter: db-instance-id is not a valid identifier. Identifiers must begin with a letter; must contain only ASCII letters, digits, and hyphens; and must not end with a hyphen or contain two consecutive hyphens." with the aws-rds cookbook example?
[2014-06-10 22:08:38 -0400] Dholland: Specifying the version: much better.  Thanks for pointing me to that but and the suggestion to specify version.
[2014-06-10 22:13:28 -0400] soukihei: If I am running chef-server and I make a change to an individual recipe, is there some re-generation command I need to issue in order for it to be applied?
[2014-06-10 22:15:01 -0400] sethvargo: @soukihei you need to upload the cookbook to the chef server and then potentially update environment constraints to pick up the new version
[2014-06-10 22:15:43 -0400] shlant: jtimberman: nevermind, figured it out
[2014-06-10 22:15:54 -0400] soukihei: @sethvargo I edited the recipe directly on the chef-server. So there must be an environment constraint set someplace
[2014-06-10 22:15:55 -0400] soukihei: thank you
[2014-06-10 22:16:39 -0400] sethvargo: @soukihei what do you mean "edited it on the Chef Server". To the best of my knowledge, that's not possible
[2014-06-10 22:16:55 -0400] sethvargo: I didn't get an error...
[2014-06-10 22:17:38 -0400] soukihei: so this a vApp that I have a management server that acts as the chef-server. I found the recipe that I wanted to modify, modified it and tried creating a new environment. It is still deploying the old version of the recipe
[2014-06-10 22:17:59 -0400] soukihei: I haven't used chef-server before and I didn't write the vApp
[2014-06-10 22:18:49 -0400] sethvargo: I'm not familiar with your setup. Chef cookbooks (which are the meta-wrappers for recipes) are individual artifacts that must be uploaded and versioned on the Chef Server
[2014-06-10 22:19:03 -0400] soukihei: ok that must be my problem then
[2014-06-10 22:19:06 -0400] soukihei: I'll take another look
[2014-06-10 22:26:27 -0400] CJNE: anyone using berkflow? i get Received connector '' is not one of ["winrm", "ssh"]. when trying to blo exec. The node it finds is in ec2, could that be the problem?
[2014-06-10 22:30:02 -0400] anthonyacquanita: can you do this in a attributes.rb file ??  if node.chef_environment   == 'QA'
[2014-06-10 22:32:16 -0400] maplebed: :( scheduled maintenance. :(  http://status.opscode.com/post/88411656061/hosted-chef-planned-maintenance-in-progress
[2014-06-10 22:32:25 -0400] maplebed: but umm...  yay status page!
[2014-06-10 22:36:18 -0400] vluther: I'm running into a brainfart of an issue.. for some reason, a new cookbook I'm writing, keeps throwing errors on lines that notify a service. It says the service[xxx] cannot be found in the resource collection
[2014-06-10 22:38:44 -0400] workmad3: vluther: did you define the service? :)
[2014-06-10 22:39:06 -0400] vluther: when I ssh into the box and type service --status-all it shows it..
[2014-06-10 22:39:20 -0400] workmad3: vluther: did you declare the service in the chef recipe?
[2014-06-10 22:39:24 -0400] vluther: @workmad3 no, but I don't think I did in the other cookbook either.. I mean here the service is "nginx"
[2014-06-10 22:39:55 -0400] workmad3: vluther: if the chef run doesn't have a service resource declaration, it has no idea what you're talking about when you want to notify it...
[2014-06-10 22:40:34 -0400] workmad3: vluther: if you didn't define it in another cookbook, chances are you got lucky and some other cookbook had defined it for you
[2014-06-10 22:40:39 -0400] vluther: workmad3: I see, where exactly would I be making these declarations.
[2014-06-10 22:40:57 -0400] vluther: i got lucky? that's a first. But.. ok
[2014-06-10 22:41:07 -0400] workmad3: vluther: in the recipe
[2014-06-10 22:41:23 -0400] workmad3: vluther: 'service "nginx" do; action :nothing; end'
[2014-06-10 22:41:31 -0400] workmad3: (replace ; with newlines for clarity)
[2014-06-10 22:42:15 -0400] cheeseplus: facepalm at using the -u instead of -x for username
[2014-06-10 22:42:56 -0400] vluther: hah looky there.. https://gist.github.com/vidluther/2c3e092c8438aea9a00c I did have it defined in the other recipe
[2014-06-10 22:43:08 -0400] workmad3: vluther: ;)
[2014-06-10 22:48:15 -0400] shlant: hey all. If I had a template variables like this, is there a way to print them all into the template without referencing each one?
[2014-06-10 22:48:16 -0400] shlant:       template "#{applications_root}/#{app}/database.yml" do
[2014-06-10 22:48:17 -0400] shlant:         variables lazy {
[2014-06-10 22:48:17 -0400] shlant:           {
[2014-06-10 22:48:18 -0400] shlant:             env:      app_info['rails_env'],
[2014-06-10 22:48:19 -0400] shlant:             host:     node['aws_rds'][app_info['db']['id']]['endpoint_address'],
[2014-06-10 22:48:19 -0400] shlant:             adapter:  app_info['db']['adapter'],
[2014-06-10 22:48:20 -0400] shlant:             encoding: 'unicode',
[2014-06-10 22:48:20 -0400] shlant:             database: app_info['db']['name'],
[2014-06-10 22:48:21 -0400] shlant:             username: app_info['db']['username'],
[2014-06-10 22:48:21 -0400] shlant:             password: app_info['db']['password']
[2014-06-10 22:48:22 -0400] shlant:           }
[2014-06-10 22:48:22 -0400] shlant:         }
[2014-06-10 23:01:14 -0400] jblack: Is anyone using a recent version of the iptables cookbook to do nat? It seems iptables.snat has been removed and the new rebuild-iptables.rb is... kind of complex.
[2014-06-10 23:02:35 -0400] jblack: Reading over teh script, it looks like the only writable table is filter
[2014-06-10 23:02:58 -0400] vluther: I've given up and just redirect everything to /dev/nsa
[2014-06-10 23:06:49 -0400] jblack: https://github.com/opscode-cookbooks/iptables/blob/master/templates/default/rebuild-iptables.erb#L11  has a function named read_iptables that should, at least in theory, support a nat table.
[2014-06-10 23:07:21 -0400] jblack: However, it's only ever called by line 107, which relies on the default argument of :filter.
[2014-06-10 23:37:38 -0400] segv: where does the bookshelf get it's data from? postgres directly or solr?
[2014-06-10 23:39:37 -0400] anthonyacquanita: someone was asking yesterday about test-kitchen and environments.. here ya go: https://github.com/test-kitchen/test-kitchen/issues/297
[2014-06-10 23:40:51 -0400] jahkobi: I justed watch Seth Vargos's talk on abstracting chef logic into rubygems. Are there anymore resources out there on the subject?
[2014-06-10 23:43:49 -0400] coderanger: jahkobi: Yes, you can hire me for training :)
[2014-06-10 23:44:03 -0400] coderanger: segv: Filesystem
[2014-06-10 23:44:36 -0400] cheeseplus: coderanger: lol
[2014-06-10 23:50:39 -0400] mjuszczak: coderanger: I was thinking this the other hour.  If you don't like data bags, and you also don't like openldap, how do you create users on your servers?  Do you not use http://community.opscode.com/cookbooks/users?
[2014-06-10 23:51:16 -0400] coderanger: mjuszczak: https://github.com/balanced-cookbooks/balanced-user/blob/master/recipes/default.rb
[2014-06-10 23:52:57 -0400] coderanger: mjuszczak: if I was in an environment with 100+ users I would probably use LDAP though, I just wouldn't enjoy it :)
[2014-06-10 23:54:38 -0400] cheeseplus: oof, ldap is always ugly
[2014-06-10 23:54:43 -0400] cheeseplus: and I love LDAP
[2014-06-10 23:54:47 -0400] cheeseplus: as much as one can
[2014-06-10 23:56:13 -0400] someara: cheeseplus you want to maintain the openldap cookbook? =)
[2014-06-10 23:58:50 -0400] mjuszczak: someara: I will!
[2014-06-10 23:59:07 -0400] mjuszczak: There are some bugs I really need to do pull requests for that I've fixed with chef rewind/unwind
[2014-06-10 23:59:32 -0400] someara: email me your github and community site usernames
[2014-06-10 23:59:43 -0400] someara: I'll do the transfers after dinner =)
