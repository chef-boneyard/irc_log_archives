[2014-04-03 00:01:43 -0400] lrr: I'm having an issue setting a node attribute.
[2014-04-03 00:02:30 -0400] lrr: more specifically, i have a recipe that sets default['users'], but I need to add to that list in a different recipe without obliterating the first declaration of default['users']
[2014-04-03 00:04:59 -0400] sbrinkmeyer: lrr are you adding to a new attribute?
[2014-04-03 00:05:09 -0400] kisoku: someara: about ?
[2014-04-03 00:05:16 -0400] sbrinkmeyer: or appending to the node['users']
[2014-04-03 00:05:25 -0400] lrr: sbrinkmeyer: i'd like to append to it
[2014-04-03 00:05:56 -0400] kisoku: is it just me or does having apt_repository touch /var/lib/apt/periodic/update-success-stamp not make any sense seeing as it does a partial update of the apt cache
[2014-04-03 00:06:27 -0400] sbrinkmeyer: node.set['users']=['bob',tom',"#{node['users']"]
[2014-04-03 00:06:56 -0400] roadze: you can be a bit more explicit like node.default['users'].append(...) maybe ?
[2014-04-03 00:06:56 -0400] lrr: can i set this in the attributes of the second recipe?
[2014-04-03 00:08:03 -0400] sbrinkmeyer: you'd have to "include_attributes" or so, but yes in the other recipe where you have the dependency on the first append to it, then call the use the first recipe
[2014-04-03 00:08:11 -0400] coderanger: lrr: Don't use arrays in node attributes
[2014-04-03 00:08:39 -0400] lrr: coderanger: i would if i didn't have to
[2014-04-03 00:08:45 -0400] sbrinkmeyer: why not?
[2014-04-03 00:09:07 -0400] coderanger: sbrinkmeyer: https://coderanger.net/2013/06/arrays-and-chef/
[2014-04-03 00:09:15 -0400] coderanger: lrr: You don't have to ^^ has fixes
[2014-04-03 00:10:10 -0400] sbrinkmeyer: oh yeah the stupid merge thing
[2014-04-03 00:12:37 -0400] papasierra: so using the chef resource "user" i know how to replace the user's group, but how do you add a user to a group?
[2014-04-03 00:13:38 -0400] lrr: coderanger: in your example, the ordering of the things doesn't matter (it's just a list of users). all that matters is that the specified users end up in that list
[2014-04-03 00:13:40 -0400] coderanger: papasierra: You can use the group resource
[2014-04-03 00:13:47 -0400] roadze: coderanger: thanks for the help ;o
[2014-04-03 00:13:53 -0400] papasierra: coderanger: right, let me see about that...
[2014-04-03 00:13:55 -0400] coderanger: lrr: Okay, thats one of the two examples I gave
[2014-04-03 00:19:12 -0400] sbrinkmeyer: lrr the answer i gave it going to stick an array in an array
[2014-04-03 00:19:32 -0400] sbrinkmeyer: there is an issue with deep merging, but its about the ruby constructs not chef
[2014-04-03 00:19:32 -0400] lrr: sbrinkmeyer: yeah, i saw that :(
[2014-04-03 00:19:43 -0400] sbrinkmeyer: sorry tried it out after i sent it
[2014-04-03 00:20:06 -0400] sbrinkmeyer: look at what coderanger said.  i see what ranger is suggesting i just don't fully buy it
[2014-04-03 00:21:18 -0400] sbrinkmeyer: my 1 cent is if you merge it implicitly yourself you'll get what you want
[2014-04-03 00:33:41 -0400] justizin: hey guys, i have a wierd issue that i run into periodically.  i want to fork a community cookbook and i want to test / use it before its merged upstream.  if i change the version number, i potentially collide with a future _real_ version, and it only accepts x.y.z, nothing like x.y.z-a or x.y.z-justizin1 or whatever.  anyone have a canonical solution for this?
[2014-04-03 00:34:13 -0400] justizin: like what is the typical practice? it seems if i use the old version number, even when i delete the cookbook from /var/chef/cache/cookbooks it doesnt have my intended changes
[2014-04-03 00:34:20 -0400] justizin: but i see berkshelf upload from the appropriate git branch
[2014-04-03 00:35:52 -0400] roadze: justizin: you probably don't want to bump the version up
[2014-04-03 00:36:05 -0400] roadze: justizin: you can still tag your branch tho
[2014-04-03 00:36:06 -0400] justizin: right, i don't.
[2014-04-03 00:36:13 -0400] justizin: right, but chef isnt aware of that.
[2014-04-03 00:36:17 -0400] roadze: justizin: and use tag: inside the berksfile
[2014-04-03 00:36:40 -0400] coderanger: justizin: Don't fork cookbooks, problem solved :)
[2014-04-03 00:36:41 -0400] justizin: i just noticed when i tried to knife cookbook upload the new version, instead of berks upload, it made me force because the version was locked
[2014-04-03 00:36:50 -0400] justizin: coderanger: how do you test a change that you expect to submit upstream
[2014-04-03 00:37:01 -0400] coderanger: justizin: locally in test-kitchen
[2014-04-03 00:37:06 -0400] justizin: okay
[2014-04-03 00:37:21 -0400] justizin: so i guess heres a reason to
[2014-04-03 00:37:24 -0400] roadze: ;o
[2014-04-03 00:37:45 -0400] justizin: but also, lets say i have a useful change to a community cookbook.  youre suggesting that i dont use it until its accepted by the maintainer?
[2014-04-03 00:37:47 -0400] justizin: that seems silly.
[2014-04-03 00:38:11 -0400] justizin: Well, we cant use the one-line change to the config file until some person i dont know tests and accepts my change."
[2014-04-03 00:38:23 -0400] justizin: i would get stabbed ;d
[2014-04-03 00:38:40 -0400] coderanger: justizin: Thats why I only contribute stuff back up long after I implement the needful in a wrapper cookbook or similar
[2014-04-03 00:38:59 -0400] justizin: fair enough, i use wrapper cookbooks pretty heavily
[2014-04-03 00:39:09 -0400] justizin: but some things are a fuck ton more trouble to do in a wrapper than in the core cookbook
[2014-04-03 00:40:41 -0400] coderanger: justizin: Those are generally cookbooks I burn to the ground and rewrite anyway :)
[2014-04-03 00:40:53 -0400] justizin: :)
[2014-04-03 00:42:49 -0400] coderanger: justizin: When you do that, my convention is to set the first version component to 99
[2014-04-03 00:43:01 -0400] coderanger: so like our jenkins cookbook is currently 99.1.16 I think
[2014-04-03 00:43:21 -0400] justizin: ah okay i like that
[2014-04-03 00:43:55 -0400] coderanger: justizin: Also most people do even/odd versioning which helps
[2014-04-03 00:44:08 -0400] coderanger: released versions always have an even last number
[2014-04-03 00:44:12 -0400] coderanger: and vice versa for dev
[2014-04-03 00:49:37 -0400] roadze: coderanger: I tried to load the cookbook first, I checked that MyHelper.object_id was the same than the Myhelper I try to stub into the test, it was. The problem I see now is that the converge will actually require the MyHelper again and sort of erase the stub. https://gist.github.com/albandiguer/9946281
[2014-04-03 00:51:54 -0400] roadze: well, I just checked the source of the converge method
[2014-04-03 00:52:07 -0400] roadze: i can actually give a block to stub things ;))
[2014-04-03 00:52:32 -0400] roadze: Thanks for the suggestions, that was helpful
[2014-04-03 00:57:23 -0400] papasierra: does chef have a provider for adding an entry to the known_hosts file?
[2014-04-03 00:57:35 -0400] coderanger: papasierra: template?
[2014-04-03 00:58:22 -0400] papasierra: coderanger: yup, that would work! ty (again)
[2014-04-03 00:58:48 -0400] law: hey coderanger, I've written my mini-test, uploaded the cookbook, and tried to converge the client.  However, it's throwing this error on me:
[2014-04-03 00:58:51 -0400] law: NoMethodError: undefined method `count' for Chef::Resource::File
[2014-04-03 00:59:01 -0400] coderanger: papasierra: Generally with config management we shy away from adding a thing to a file in favor of just writing the whole file out each time
[2014-04-03 00:59:14 -0400] coderanger: law: The thing you are looking at isn't a string
[2014-04-03 00:59:18 -0400] coderanger: Whats the code?
[2014-04-03 00:59:37 -0400] law: http://pastebin.com/z0PTjNLg
[2014-04-03 00:59:42 -0400] law: ^--- that
[2014-04-03 00:59:58 -0400] papasierra: coderanger: understood. i see why. thanks
[2014-04-03 01:00:23 -0400] coderanger: law: file() isn't a thing
[2014-04-03 01:00:32 -0400] coderanger: law: Maybe you mean IO.read('')
[2014-04-03 01:00:38 -0400] law: well shucks
[2014-04-03 01:00:40 -0400] Majost_: I am running into this issue: https://gist.github.com/jcarapet/9531009
[2014-04-03 01:00:46 -0400] law: I was stealing some other minitest code written elsewhere in my repo
[2014-04-03 01:00:47 -0400] coderanger: law: Also why are you using minitest?
[2014-04-03 01:00:57 -0400] coderanger: law: tk+serverspec is more common for this kind of thing
[2014-04-03 01:01:45 -0400] law: I'm just trying to duplicate what other folks have written in our repo
[2014-04-03 01:02:03 -0400] law: to be honest, rspec, minitest, serverspec... it all is one big blob of 'the same crap' to me
[2014-04-03 01:03:13 -0400] law: my marching orders were 'write a test for that file that errors out if it has less than 5 lines in it, and make it the same as the other tests we have in this cookbook over here...'
[2014-04-03 01:03:35 -0400] law: the other tests used minitest, so I sallied forth and did likewise
[2014-04-03 01:04:03 -0400] law: I commenced googling 'minitest introduction', 'minitest file line count', 'minitest for the impatient systems administrator', etc, all to no avail
[2014-04-03 01:05:26 -0400] coderanger: law: It really sounds like whomever is in charge of your Chef setup needs to be twapped with a dead fish
[2014-04-03 01:05:40 -0400] law: lol, I wouldn't doubt that for a second :-)
[2014-04-03 01:05:58 -0400] law: I'm a puppet guy myself, trying to wrap my head around everything Chef and... kind of succeeding.  Sometimes
[2014-04-03 01:06:04 -0400] law: "60% of the time, it makes sense every time"
[2014-04-03 01:08:04 -0400] coderanger: law: test kitchen (http://kitchen.ci) is a testing harness for chef
[2014-04-03 01:08:14 -0400] coderanger: and within that serverspec is the mostly commonly used testing library
[2014-04-03 01:08:20 -0400] coderanger: though bats and minitest can also be used
[2014-04-03 01:14:14 -0400] law: oh I know test kitchen
[2014-04-03 01:14:25 -0400] law: I've been trying to implement it for a month now, to no avail
[2014-04-03 01:14:43 -0400] law: shit keeps breaking in mysterious ways, and the documentation is (not to put too fine a point on it) *terrible*
[2014-04-03 01:14:51 -0400] maplebed: oh good! I need a hand with test kitchen.  My upstream connection is very slow and it seems every time I spin up a test it downloads and installs chef. What's the best way to make this not happen?
[2014-04-03 01:15:21 -0400] maplebed: I imagine it's some variant of 'make a custom vagrant box', which I don't know how to do.
[2014-04-03 01:15:39 -0400] law: so, rather than have me continue to flail ineffectually at test kitchen, the team decided to leave that as a 'skunkworks' project and continue on in the old way
[2014-04-03 01:15:41 -0400] coderanger: maplebed: Unfortunately there isn't a great way right now
[2014-04-03 01:16:04 -0400] law: which is, one of the guys who's been here the longest, has a special LXC-enabled Vagrant box that we spin up
[2014-04-03 01:16:24 -0400] law: and our bigger, more environment-oriented cookbooks all have vagrant files that play nice on LXC
[2014-04-03 01:16:51 -0400] law: 'vagrant up' on the LXC host spins up a local chef server, provisions the test-hosts to connect to the local chef server, and we're off to the races
[2014-04-03 01:17:05 -0400] law: test kitchen would be an incredible improvement over that... if I could get it to work
[2014-04-03 01:18:53 -0400] law: maplebed: one thing you might want to try is having a local caching proxy on your machine.  The first time it downloads, the proxy will cache it.  future downloads will just pull it from the cache
[2014-04-03 01:19:17 -0400] coderanger: Yeah, I've seen some people try to integrate TK and vagrant cachier, never tried myself though
[2014-04-03 01:19:29 -0400] maplebed: how would I configure the virtual image to use the cache?
[2014-04-03 01:19:50 -0400] law: vagrant has some config file options that say "use this http cache"
[2014-04-03 01:19:53 -0400] law: hang on, Googling...
[2014-04-03 01:20:02 -0400] maplebed: today is a good day - only 1m18s to download chef, but it's pretty lame to have to do that on every fresh test. last week it was closer to 5-10min to get chef.
[2014-04-03 01:20:04 -0400] aslan_: hey guys. I have few Devops questions mostly about nagios in the cloud can anyone help me?
[2014-04-03 01:20:23 -0400] coderanger: maplebed: I'm not sure you can right now
[2014-04-03 01:20:28 -0400] coderanger: aslan_: You can always try
[2014-04-03 01:21:04 -0400] law: maplebed: https://acodingblog.wordpress.com/2014/02/06/fast-offline-provisioning-with-vagrant-part-1/
[2014-04-03 01:21:11 -0400] maplebed: hrmph.  it'd be really nice to be able to do test kitchen work while offline.
[2014-04-03 01:21:44 -0400] coderanger: maplebed: It is on the list to fix
[2014-04-03 01:21:50 -0400] law: and this: http://tmatilai.github.io/vagrant-proxyconf/
[2014-04-03 01:21:55 -0400] maplebed: hm.  thanks, law. that seems like it's worth a try.
[2014-04-03 01:22:28 -0400] coderanger: maplebed: Check out https://github.com/fgrehm/vagrant-cachier too
[2014-04-03 01:23:44 -0400] aslan_: coderanger: ok, the situation is that i have a nagios server that is checking a whole bunch of servers on the cloud. some them auto scale. in other words in a matter of minutes my farm (amazon ec2) of 100 servers can grow to 120 and then suddenly i get nagios alerts from 20 new servers until they are fully configured by chef. then the same problem when they scale down. i get 20 alerts for host down. nagios is managed by chef and updates the
[2014-04-03 01:23:45 -0400] aslan_: host.cfg every 30 minutes. So this has made my nagios unusable. I have turned off email and alerts for groups that need to auto scale. I was wondering if chef community has a solution for this problem?
[2014-04-03 01:24:02 -0400] coderanger: aslan_: The solution is "stop using Nagios"
[2014-04-03 01:24:20 -0400] coderanger: It was never built for that kind of thing and fails at it spectacularly
[2014-04-03 01:24:40 -0400] law: aslan_: you could adjust your alert thresholds
[2014-04-03 01:24:41 -0400] aslan_: coderanger: what should i use instead?
[2014-04-03 01:24:59 -0400] coderanger: aslan_: My personal recommendation is a mix of collectd, riemann, and zookeeper
[2014-04-03 01:25:29 -0400] aslan_: law: adjusting nagios checks to 30 min interval ( same interval as chef ) doesn't sound like a good use of nagios
[2014-04-03 01:25:54 -0400] coderanger: aslan_: Doing this Right is super hard though
[2014-04-03 01:26:08 -0400] law: you could have just the Nagios box run Chef every 5 minutes
[2014-04-03 01:26:28 -0400] aslan_: coderanger: this has to be such a common issue for devops guys i am really surprised that there are very few good solutions out there
[2014-04-03 01:26:44 -0400] maplebed: aslan_: my solution for autoscaling groups is to monitor the service, not the host.
[2014-04-03 01:27:04 -0400] maplebed: i.e. a metacheck that goes out and makes sure things are all ok across the ASG.
[2014-04-03 01:27:06 -0400] law: maplebed++
[2014-04-03 01:27:14 -0400] coderanger: aslan_: If I had a nickel every time I heard that line ...
[2014-04-03 01:27:26 -0400] aslan_: law: that still means i should expect alerts for 5 minutes until hosts.cfg is updated
[2014-04-03 01:27:39 -0400] maplebed: but I do also manage hosts, and use a combination of chef and zookeeper to make things better.
[2014-04-03 01:27:47 -0400] coderanger: maplebed: Really what you are saying then is "don't use nagios, use cloudwatch" :)
[2014-04-03 01:27:50 -0400] coderanger: (for host metrics)
[2014-04-03 01:27:59 -0400] law: set your alert threshold for 6 minutes ;-)
[2014-04-03 01:28:03 -0400] coderanger: which is fine, its just a relatively mediocre tool
[2014-04-03 01:28:34 -0400] maplebed: meh. doesn't matter to me so much what process is doing the wtaching (nagios vs. cloudwatch) but I do like to have my alerting centralized (instead of some from here and some from there). So I don't use cloudwatch, having nagios do everything instead.
[2014-04-03 01:29:39 -0400] Majost_: Does anyone know what would cause chefspec/rspec to barf like this: https://gist.github.com/jcarapet/9531009
[2014-04-03 01:29:57 -0400] aslan_: coderanger: you said its complicated to set this up with collectd and zookeeper, how hard is it, what are the chalanges?
[2014-04-03 01:30:06 -0400] aslan_: challenges*
[2014-04-03 01:30:17 -0400] coderanger: aslan_: Challenge 1) you will find almost not documentation about doing this anywhere
[2014-04-03 01:30:30 -0400] aslan_: oh boy
[2014-04-03 01:30:48 -0400] maplebed: aslan_: what metrics are you watching on the hosts that autoscale?
[2014-04-03 01:30:49 -0400] coderanger: Honestly if you get past that, the rest are easy
[2014-04-03 01:31:01 -0400] coderanger: aslan_: Not saying that following my lead is a good idea :)
[2014-04-03 01:31:02 -0400] law: welcome to the greater Ruby community ;-)
[2014-04-03 01:31:18 -0400] coderanger: law: Actually nothing I mentioned is related to Ruby
[2014-04-03 01:31:23 -0400] law: "Where the people are friendly, the beer is cold, and the docs are nonexistent"
[2014-04-03 01:31:29 -0400] aslan_: maplebed: few things , basic nagios stats, + chef-client process is alive and most importantly the app server is responding (http checks)
[2014-04-03 01:31:29 -0400] coderanger: Riemann uses clojure, the rest are in C
[2014-04-03 01:31:53 -0400] law: bahh, so much for being able to inject some topical snark on a Wednesday :-)
[2014-04-03 01:32:49 -0400] maplebed: aslan_: so your load balancer should be watching the app (http), and nagios should be watching the load balancer and asking it what percentage of backends are healthy.
[2014-04-03 01:33:18 -0400] maplebed: aslan_: for the chef client check, you can write one that queries all hosts in the ASG and reports if any have not run chef in <timespec>
[2014-04-03 01:33:21 -0400] aslan_: maplebed: I already have that check in my nagios
[2014-04-03 01:33:38 -0400] maplebed: with those, don't bother asking nagios to watch the actual servers.
[2014-04-03 01:33:45 -0400] maplebed: it doesn't get you anything useful.
[2014-04-03 01:33:54 -0400] coderanger: The problem at the heart of all of this is you need to disconnect state vs. config
[2014-04-03 01:34:03 -0400] coderanger: nagios will never know the network state
[2014-04-03 01:34:05 -0400] coderanger: and it really likes to
[2014-04-03 01:34:31 -0400] coderanger: The further its snapshot of the state gets from reality, the sadder things get
[2014-04-03 01:34:50 -0400] aslan_: coderanger: I came up with this lame solution of having a crontab query aws and update hosts.cfg every minute
[2014-04-03 01:34:59 -0400] maplebed: +1 coderanger - chef is for how things should be, zookeeper / etcd is for how things are.  But part of the reason for monitoring is to tell you how far apart the reality is from how it should be.
[2014-04-03 01:35:00 -0400] aslan_: I was just hoping for a better solution
[2014-04-03 01:35:13 -0400] coderanger: aslan_: Sure, so then you just have to worry about the drift with 60s
[2014-04-03 01:35:21 -0400] coderanger: aslan_: er within
[2014-04-03 01:35:24 -0400] coderanger: but its a band aid
[2014-04-03 01:35:50 -0400] maplebed: honestly, the better solution is to shift mindsets from hosts to services, which, granted, nagios has a hard time with, but it's not impossible.
[2014-04-03 01:35:59 -0400] coderanger: maplebed: Yeah, there is a narrow thread linking config and state
[2014-04-03 01:36:09 -0400] coderanger: maplebed: but its often hard to follow :)
[2014-04-03 01:36:22 -0400] aslan_: I agree that this that i have philosophical problem with nagios. :P
[2014-04-03 01:36:50 -0400] coderanger: aslan_: Sounds like you probably have things about as good as you can get
[2014-04-03 01:36:54 -0400] aslan_: it was such a good tool for our colo that i tried to bring it to the cloud
[2014-04-03 01:37:02 -0400] coderanger: Just set your alerting timeouts to >60s
[2014-04-03 01:37:21 -0400] coderanger: so that the state reconciliation will kick in before false alerts get sent
[2014-04-03 01:37:33 -0400] aslan_: coderanger: alright, but someone has to come up with a cool solution for this
[2014-04-03 01:37:38 -0400] aslan_: its about time
[2014-04-03 01:37:54 -0400] law: I would adopt the mindset that you don't care about the individual servers in the pool.  So long as there are X number or greater of green servers (or the response time of the application is < X seconds), don't alert
[2014-04-03 01:37:57 -0400] coderanger: aslan_: The problem is most peoples' Cool Solution are super specific
[2014-04-03 01:38:01 -0400] coderanger: and not a single tool
[2014-04-03 01:38:06 -0400] law: you could then slave all your host checks to that meta-check
[2014-04-03 01:38:20 -0400] maplebed: back to test kitchen - do any of you have an example of a cookbook that does a good job using test kitchen and minitest?
[2014-04-03 01:38:23 -0400] coderanger: Like I was talking to Pinterest on Monday, they do this with a mix of collectd, statsd, kafka, storm, and opentsdb
[2014-04-03 01:38:35 -0400] coderanger: Works super well for them, but probably overkill for most :)
[2014-04-03 01:38:48 -0400] coderanger: maplebed: Poise does
[2014-04-03 01:39:37 -0400] maplebed: what / who is poise?
[2014-04-03 01:39:41 -0400] aslan_: coderanger: i have seen couple of those solutions. to me it looks like too many moving parts and a little bit fragile
[2014-04-03 01:40:13 -0400] aslan_: alright guys, thanks for the help :)
[2014-04-03 01:40:15 -0400] coderanger: aslan_: Nagios has just as many parts, but its all under one label so you don't see it
[2014-04-03 01:40:27 -0400] maplebed: aslan_: there are a number of companies trying to build this and provide it as a service. I hear yelp is doing an interesting job of using Sensu to pull it off.
[2014-04-03 01:40:31 -0400] coderanger: aslan_: nagios is made up of ~3 dozen different perl and bash scripts :P
[2014-04-03 01:40:40 -0400] maplebed: (if you're in SF they're talking about it next week)
[2014-04-03 01:40:59 -0400] aslan_: maplebed: im in LA
[2014-04-03 01:41:11 -0400] maplebed: the interesting bit about sensu being that the config is much more realtime and servers register themselves as they come up.
[2014-04-03 01:41:27 -0400] maplebed: that's about all I know; I'm interested but haven't set it up yet.
[2014-04-03 01:42:04 -0400] aslan_: the issue with ec2 is they way they are terminated the shut down script doesn't really have any time to do things like that.
[2014-04-03 01:42:33 -0400] maplebed: coderanger: https://github.com/poise/poise ?
[2014-04-03 01:42:50 -0400] coderanger: aslan_: You can get the ASG to send a message to a queue on scaling events
[2014-04-03 01:42:53 -0400] coderanger: maplebed: Yep
[2014-04-03 01:42:57 -0400] maplebed: cool. thanks.
[2014-04-03 01:43:35 -0400] aslan_: coderanger: i think i am going to look into that. sounds like a good solution
[2014-04-03 01:58:13 -0400] maplebed: coderanger: so I see the .kitchen.yml references the test cookbook recipe (eg test/cookbooks/poise_test/recipes/subcontext_block.rb) but the tests actually exist in /test/cookbooks/poise_test/files/default/test/subcontext_block_test.rb. What triggers the actual test files - the minitest-handler cookobok?
[2014-04-03 01:58:29 -0400] coderanger: yep
[2014-04-03 01:58:31 -0400] coderanger: :-)
[2014-04-03 01:58:42 -0400] coderanger: minitest-hander checks what recipes ran, and looks for matching tests
[2014-04-03 01:59:02 -0400] maplebed: fascinating. ok.
[2014-04-03 01:59:23 -0400] maplebed: so if I want to check many different configurations for a recipe, is the common practice to put each in a different test kitchen suite?
[2014-04-03 02:00:30 -0400] coderanger: Depends on your needs
[2014-04-03 02:00:36 -0400] coderanger: Probably faster to use a single suite :)
[2014-04-03 02:01:28 -0400] maplebed: I think I'm getting ahead of myself with that question anyways.  I'll see how far I can get with this basic structure.  thanks.
[2014-04-03 02:02:04 -0400] coderanger: I keep them separate because Poise monkeys with some global stuffs
[2014-04-03 02:02:16 -0400] coderanger: so I want each running in isolation
[2014-04-03 02:05:03 -0400] maplebed: 0 tests, 0 assertions, 0 failures, 0 errors, 0 skips
[2014-04-03 02:05:08 -0400] maplebed: I must have some files in the wrong place.
[2014-04-03 02:05:09 -0400] maplebed: :(
[2014-04-03 02:05:23 -0400] coderanger: maplebed: Make sure you have the _spec in the test filename
[2014-04-03 02:08:19 -0400] maplebed: I'm not sure what you mean by the _spec. I'm using the default.rb recipe in my test cookbook; the test is at ./test/cookbooks/ganglia_test/files/default/tests/minitest/default.rb
[2014-04-03 02:08:33 -0400] maplebed: hey, there's one difference.  I have 'minitest' in the path to the test file.
[2014-04-03 02:08:54 -0400] coderanger: maplebed: that needs to be default_spec.rb
[2014-04-03 02:09:20 -0400] coderanger: Sorry default_test.rb
[2014-04-03 02:09:23 -0400] coderanger: thinking of rspec :)
[2014-04-03 02:09:30 -0400] maplebed: rspec is next.
[2014-04-03 02:09:32 -0400] maplebed: :P
[2014-04-03 02:11:18 -0400] maplebed: is there something I need to do to update stuff before running 'kitchen converge' again?
[2014-04-03 02:11:58 -0400] coderanger: Nope
[2014-04-03 02:12:10 -0400] maplebed: hm.
[2014-04-03 02:14:14 -0400] maplebed: hooray!!!
[2014-04-03 02:14:15 -0400] maplebed: 1 tests, 1 assertions, 0 failures, 0 errors, 0 skips
[2014-04-03 02:14:38 -0400] maplebed: I inadvertently included the main cookbook rather than the test cookbook in the .kitchen.yml file.
[2014-04-03 02:21:51 -0400] maplebed: thanks, coderanger! I'm sure I'll be back later with more.  :)
[2014-04-03 02:57:03 -0400] krz: if i have an execute block that should be used by two recipes. where should i place this execute block?
[2014-04-03 02:57:23 -0400] coderanger: krz: Not sure what you mean
[2014-04-03 02:58:14 -0400] krz: coderanger: i have 2 recipes: default and restart_sidekiq
[2014-04-03 02:58:27 -0400] krz: both recipes contain the same execute block
[2014-04-03 02:58:45 -0400] krz: is there a way to refactor this, so i dont have 2 repetetive blocks ?
[2014-04-03 02:58:59 -0400] krz: coderanger: does that make sense?
[2014-04-03 03:00:00 -0400] coderanger: krz: Have one just notify the other
[2014-04-03 03:29:54 -0400] jpr: krz: I like a "private" recipe in that case
[2014-04-03 03:30:01 -0400] jpr: _common_execute.rb
[2014-04-03 03:30:05 -0400] jpr: and include it in both
[2014-04-03 03:30:29 -0400] jpr: but also depends what you are doing
[2014-04-03 03:38:35 -0400] krz: coderanger: but where should that block exist?
[2014-04-03 03:38:37 -0400] krz: in template?
[2014-04-03 03:38:52 -0400] krz: or private recipe as jpr suggested?
[2014-04-03 03:57:04 -0400] _dougg: I'm trying to use the ssl-cookbook cookbook, and I keep getting "I cannot read /etc/chef/client.pem, which you told me to use to sign requests!" and I have NO idea why
[2014-04-03 03:57:57 -0400] _dougg: What the heck does the ssl-cookbook have to do with /etc/chef/client.pem ?
[2014-04-03 04:06:49 -0400] coderanger: krz: Kind of moot, just remember you can't run a recipe more than once
[2014-04-03 04:07:06 -0400] coderanger: _dougg: Are you making calls to the Chef API from chef-solo?
[2014-04-03 04:07:28 -0400] _dougg: coderanger: No, I don't think so.
[2014-04-03 04:07:52 -0400] coderanger: _dougg: You should be able to see whats making the call from the full traceback
[2014-04-03 04:08:09 -0400] _dougg: coderanger: just removed the include_recipe "ssl-cookbook" from my recipe, and error doesn't happen.
[2014-04-03 04:08:23 -0400] _dougg: coderanger: got a traceback, no idea how to interpret it though
[2014-04-03 04:08:44 -0400] coderanger: _dougg: _dougg I don't know of cookbook called that
[2014-04-03 04:08:49 -0400] coderanger: Is this something you wrote?
[2014-04-03 04:08:56 -0400] coderanger: There is a cookbook called "ssl"
[2014-04-03 04:09:01 -0400] coderanger: but not "ssl-cookbook"
[2014-04-03 04:09:32 -0400] _dougg: coderanger: https://github.com/cap10morgan/ssl-cookbook
[2014-04-03 04:09:47 -0400] coderanger: Yeah, that one, that should be include_recipe "ssl", but it won't work anyway
[2014-04-03 04:09:51 -0400] coderanger: not compatible with chef-solo
[2014-04-03 04:09:58 -0400] coderanger: https://github.com/cap10morgan/ssl-cookbook/blob/master/recipes/default.rb#L1-L2
[2014-04-03 04:10:13 -0400] coderanger: No point anyway, it wouldn't help
[2014-04-03 04:10:32 -0400] _dougg: coderanger: aw crap.
[2014-04-03 04:10:44 -0400] _dougg: coderanger: Can you recommend one that does work with solo?
[2014-04-03 04:10:58 -0400] coderanger: _dougg: you don't need anything special, just make a cookbook that writes out the files
[2014-04-03 04:11:15 -0400] _dougg: coderanger: with encryption...
[2014-04-03 04:11:18 -0400] coderanger: _dougg: With solo you are doing everything push-based and manually anyway, so security is a non-issue
[2014-04-03 04:11:38 -0400] _dougg: coderanger: well solo is just for testing purpose. real boxes use client
[2014-04-03 04:11:38 -0400] coderanger: _dougg: The word "encryption" doesn't actually make things better
[2014-04-03 04:12:29 -0400] coderanger: _dougg: If you want a real secrets management system, thats a horse of a different color
[2014-04-03 04:13:09 -0400] coderanger: the tl;dr on that is 1) there isn't anything good right now 2) S3+IAM is best if you are on AWS 3) chef-vault isn't terrible but has issues due to its use of data bags and pre-baking encryption 4) Look at Barbican
[2014-04-03 04:13:45 -0400] _dougg: coderanger: well, I also wanted to make it generic, and without the use of LWRP's, which are beyond my abilities with ruby, I'm not sure thats doable
[2014-04-03 04:14:07 -0400] coderanger: Not sure what you mean by generic
[2014-04-03 04:14:15 -0400] coderanger: the generic form of this is what I said, secrets management
[2014-04-03 04:14:24 -0400] _dougg: coderanger: usable by other cookbooks
[2014-04-03 04:14:25 -0400] coderanger: SSL keys happen to be one kind of secret
[2014-04-03 04:14:29 -0400] _dougg: not hard coded
[2014-04-03 04:14:31 -0400] coderanger: _dougg: Are you using AWS
[2014-04-03 04:14:42 -0400] coderanger: If so, citadel is what you want
[2014-04-03 04:14:49 -0400] _dougg: coderanger: yes, citadel isn't an option. Also using GCE
[2014-04-03 04:15:01 -0400] coderanger: Boo, then chef-vault is your best bet right now
[2014-04-03 04:15:30 -0400] coderanger: But keep an eye on barbican and red october
[2014-04-03 04:15:41 -0400] coderanger: (used for two very different things, but worth tracking)
[2014-04-03 04:17:20 -0400] _dougg: coderanger: well in the meantime I'll have to hard code something, which makes me sad
[2014-04-03 04:17:27 -0400] coderanger: _dougg: ?
[2014-04-03 04:17:32 -0400] coderanger: I literally just said "use chef-vault"
[2014-04-03 04:18:28 -0400] _dougg: coderanger: was referring to the certs themsevles, their names, their paths etc
[2014-04-03 04:18:55 -0400] coderanger: How is that hard coding, chef is the thing thats supposed to know that information
[2014-04-03 04:19:27 -0400] _dougg: coderanger: well if I throw it into a recipe, how do I make it so other cookbooks can use it?
[2014-04-03 04:19:43 -0400] _dougg: coderanger: some_function "cert_name"
[2014-04-03 04:19:46 -0400] coderanger: Use node attributes to configure it
[2014-04-03 04:19:53 -0400] coderanger: Or make an LWRP, but you said you don't want to :)
[2014-04-03 04:20:09 -0400] _dougg: coderanger: No, I said thats beyond my abilities.
[2014-04-03 04:20:43 -0400] coderanger: No time like the present to learn :)
[2014-04-03 04:20:53 -0400] coderanger: There isn't much you need to do differently than recipe code
[2014-04-03 04:21:08 -0400] _dougg: coderanger: and the ruby learning curve
[2014-04-03 04:22:01 -0400] coderanger: _dougg: You don't need to learn any more ruby than you already know from writing recipes
[2014-04-03 04:23:55 -0400] _dougg: coderanger: not sure I agree with that statement
[2014-04-03 04:24:52 -0400] _dougg: some good docs would help
[2014-04-03 04:25:30 -0400] coderanger: Heh, I'm working on it, though in my case it isn't for LWRPs :)
[2014-04-03 04:25:32 -0400] _dougg: 'writing lwrp's for non ruby folks who can't get their head around ruby syntax'
[2014-04-03 04:25:37 -0400] coderanger: close though
[2014-04-03 04:47:13 -0400] wdpro_kevin: good evening evryone
[2014-04-03 04:48:39 -0400] wdpro_kevin: fun with Berkshelf tonight any clue how to pass berkshelf config to a jenkins job?
[2014-04-03 04:49:55 -0400] wdpro_kevin: bhef server but doesn't have a pem associated
[2014-04-03 05:01:28 -0400] coderanger: wdpro_kevin: You mean pass it a client key?
[2014-04-03 05:02:02 -0400] wdpro_kevin: yeah I'm using test-kitchen via jenkins
[2014-04-03 05:02:06 -0400] coderanger: sec
[2014-04-03 05:02:33 -0400] wdpro_kevin: and the job runs under an anonymous user
[2014-04-03 05:04:03 -0400] coderanger: wdpro_kevin: https://github.com/balanced-cookbooks/balanced-ci/blob/master/libraries/balanced_ci_pipeline.rb#L229-L240
[2014-04-03 05:06:40 -0400] wdpro_kevin: thanks looking
[2014-04-03 05:45:51 -0400] ssd7: Ohai Chefs
[2014-04-03 05:53:06 -0400] mhenrixon: funny
[2014-04-03 06:00:32 -0400] freedrull: should i check my node.json files into git
[2014-04-03 07:04:45 -0400] GreatSUN: rehi
[2014-04-03 07:29:24 -0400] JensOfSweden: 2014-04-03T09:28:28+02:00] DEBUG: Saving the current state of node devblade19.os.skd.midasplayer.com
[2014-04-03 07:29:25 -0400] JensOfSweden: devblade19.os.skd.midasplayer.com [2014-04-03T09:28:28+02:00] DEBUG: Re-raising exception: JSON::GeneratorError - source sequence is illegal/malformed utf-8
[2014-04-03 07:29:31 -0400] JensOfSweden: Whenever i run chef-client on a node i get this at the end, anyone know why?
[2014-04-03 07:37:06 -0400] bricker`LA: Hello, I'm a little confused about attributes. Where should I defining these attributes? https://github.com/opscode-cookbooks/nginx We have a cookbook that includes recipes for several different of our sites, and each site needs a different nginx config.
[2014-04-03 07:41:57 -0400] JensOfSweden: You can either use the override attributes per node, or add nodes into different environments and set the override attributes in each environment, then bootstrap nodes in different locations to different environments, atleast thats how i would od it. Might be a better way
[2014-04-03 07:43:47 -0400] bricker`LA: JensOfSweden: would I define override attributes for a node in the cookbook?
[2014-04-03 07:44:03 -0400] bricker`LA: or the recipe, I mean
[2014-04-03 07:44:45 -0400] JensOfSweden: I would not, since your using vendor cookbooks from opscode its better to make an environment and override the attributes in the environment
[2014-04-03 07:53:15 -0400] mkorolyov: hi, could you be so kind and point me to some solution for my comment(3rd one) on http://community.opscode.com/cookbooks/build-essential/comments
[2014-04-03 07:53:16 -0400] JensOfSweden: http://docs.opscode.com/chef_overview_attributes.html later on it explains how the attributes can be overrided by environment or roles
[2014-04-03 07:55:05 -0400] JensOfSweden: mkorolyov: i got that error when i ran a vagrant ubuntu with chef 10, when i upgraded to chef 11 i didnt get that problem anymore, you could allso downgrade build_essentials to a lower version, dont remember witch now that works with chef 10
[2014-04-03 07:55:08 -0400] mhenrixon: Regarding deployments, how to handle automatic depployments?
[2014-04-03 07:55:50 -0400] mhenrixon: I don't want to give everyone access to the production environment but I do want about anyone to be able to deploy a new version
[2014-04-03 07:56:05 -0400] mkorolyov: JensOfSweden: will give a try now, thanks!
[2014-04-03 07:56:38 -0400] JensOfSweden: mhenrixon: what do you meen?
[2014-04-03 07:56:45 -0400] mhenrixon: With berkshelf I need to deploy a new version of the app_cookbook to release a  new version but I don't want everyone to have to setup chef on their machines to be able to deploy
[2014-04-03 07:57:33 -0400] JensOfSweden: mhenrixon: Like a dev changes a cookbook and wants it deployed, but you dont want them to have access to the chef prod environemtn?
[2014-04-03 07:57:56 -0400] mhenrixon: Right now we checkout a specific revision from our github repos to make sure stuff isn't accidentally deployed for now/ Would the regular checkin handle any new commits and deploy those automatically_
[2014-04-03 07:58:28 -0400] mhenrixon: JensOfSweden well yeah I don't even want everyone to have to know about chefs existance. It is such a big subject
[2014-04-03 08:05:23 -0400] JensOfSweden: mhenrixon: I used sortof a setup with jenkins and separate git repos for each cookbook, then letting devs have access to there app cookbooks and let jenkins push cookbooks for deployment either on a tag in the git commits or from a branch they cant merge into without supervision =)
[2014-04-03 08:11:43 -0400] double_p: hm, on very long convergings the AWS key expires, but i cannot see how to set its expire date
[2014-04-03 08:31:53 -0400] mkorolyov: JensOfSweden: about platform_family issue. downgrading build-essential version didn't fixed the problem :( i'he tried 1.4.4, 1.4.2, 1.4.0
[2014-04-03 08:36:02 -0400] JensOfSweden: mkorolyov: did you upgrade chef-client to 11?
[2014-04-03 08:38:13 -0400] mkorolyov: it was 11 from the beginning.
[2014-04-03 08:38:46 -0400] mkorolyov: hmmm.. sorry. it is 10.14.2
[2014-04-03 08:44:40 -0400] mkorolyov: JensOfSweden: upgrading to chef-client 11 fixed the problem. thanks a lot!
[2014-04-03 08:46:41 -0400] JensOfSweden: mkorolyov: np, just add a post script in your vagrant files that upgrades the chef client on ubuntu 12.04 boxes
[2014-04-03 08:46:50 -0400] JensOfSweden: or remake a box of your own =)
[2014-04-03 09:08:57 -0400] srenatus: so... anyone proud of their cheffy database backup solution?  ;)
[2014-04-03 09:25:44 -0400] JensOfSweden: Anyone know why i get this at the end of the chef run? [2014-04-03T10:27:21+02:00] ERROR: source sequence is illegal/malformed utf-8 it runs all recipies and stuff but doesnt send info back to the chef server
[2014-04-03 09:56:52 -0400] JensOfSweden: Btw, is there anyway to run commands with knife on multiple nodes using regexp?
[2014-04-03 09:59:37 -0400] double_p: JensOfSweden: wildcars... or maybe via 'knife xargs'?
[2014-04-03 10:00:00 -0400] JensOfSweden: double_p: trying to remove devblade[18-205].xxx.x.x.x.x.xx.x =)
[2014-04-03 10:06:23 -0400] workmad3: JensOfSweden: the knife ssh command takes a search string to find nodes to operate on
[2014-04-03 10:07:46 -0400] workmad3: JensOfSweden: dunno about with other commands though...
[2014-04-03 10:19:14 -0400] srenatus: you can always throw some for-loop and awk-magic into the mix
[2014-04-03 10:22:36 -0400] nkts: Hi, I have an attribute (array) in environment file and in role file - and in template I'm getting merged result
[2014-04-03 10:23:05 -0400] nkts: tho I was expecting, that atrribute from role file will overwrite one from environment
[2014-04-03 10:25:15 -0400] nkts: https://coderanger.net/2013/06/arrays-and-chef/ more less like described here..
[2014-04-03 10:27:16 -0400] papasierra: hi, using the php-fpm cookbook (or any cookbook for that matter i guess), instead of "php_options 'php_admin_flag[log_errors]' => 'on', 'php_admin_value[memory_limit]' => '128M'" i'd like to split those directives over multiple lines, for clarity of reading. how do i do that?
[2014-04-03 10:28:11 -0400] dev1x: how come? I'm not sure on what you mean
[2014-04-03 10:28:16 -0400] papasierra: dev1x: https://gist.github.com/paulsschwarz/ca34280e8ce904ae1233
[2014-04-03 10:28:39 -0400] papasierra: see how lines 10, 11, 12 are so much easier to maintain then line 3?
[2014-04-03 10:30:57 -0400] dev1x: I'm guessing this is what you want
[2014-04-03 10:30:58 -0400] dev1x: php_options [
[2014-04-03 10:30:59 -0400] dev1x:   :php_admin_flag[log_errors] => 'on',
[2014-04-03 10:30:59 -0400] dev1x:   :php_admin_value[memory_limit] => '128M',
[2014-04-03 10:30:59 -0400] dev1x:   :env[TEMP] => '/tmp'
[2014-04-03 10:31:00 -0400] dev1x:  ]
[2014-04-03 10:31:04 -0400] dev1x: sorry for the copy pasta
[2014-04-03 10:31:13 -0400] dev1x: or paste flood :)
[2014-04-03 10:31:49 -0400] papasierra: right, yeah i'm just reading up on http://www.ruby-doc.org/core-2.1.1/Hash.html and what you're saying makes sense
[2014-04-03 10:32:15 -0400] shimo: probably {} instead of []
[2014-04-03 10:33:12 -0400] papasierra: yeah, hash, not array
[2014-04-03 10:35:51 -0400] papasierra: dev1x shimo something's off http://pastie.org/private/knvv6tgqegswfss6ivjpa
[2014-04-03 10:38:34 -0400] workmad3: papasierra: two things wrong there - one, you want to either use no {} at all (implicit hash) or you need to put () around the entire thing
[2014-04-03 10:39:04 -0400] dev1x: :) that
[2014-04-03 10:39:18 -0400] workmad3: papasierra: two, :php_admin_flag[log_errors] needs to be either "php_admin_flag[log_errors]" or :"<same again>" if you really want a symbol
[2014-04-03 10:40:06 -0400] papasierra: yeah, i don't want to make a symbol. no point. so yeah, back to strings... and i'll try the implicit hash, if not then the (). testing...
[2014-04-03 10:40:17 -0400] workmad3: papasierra: as :php_admin_flag[log_errors] isn't the symbol called 'php_admin_flag[log_errors]', it's the symbol :php_admin_flag, and then you try to call the [] method on the symbol with a parameter of 'log_errors' (which will most likely be a NoMethodError)
[2014-04-03 10:40:32 -0400] workmad3: papasierra: if you use an implicit hash, the first item needs to be on the same line as php_options
[2014-04-03 10:40:51 -0400] workmad3: papasierra: so php_options "php_admin_flag[log_errors]" => 'on', ...
[2014-04-03 10:42:58 -0400] papasierra: workmad3: spot on, plus for bonus points i actually understand what you mean (ruby skills level up for me) thanks so much. final solution: http://pastie.org/private/wcknmeldlyrw5jcfcgikq
[2014-04-03 10:43:33 -0400] workmad3: papasierra: final thing - drop the space between php_options and the opening (
[2014-04-03 10:43:53 -0400] workmad3: papasierra: that changes the meaning somewhat, and would cause you issues in the future :)
[2014-04-03 10:44:46 -0400] papasierra: workmad3: right, important lesson! ty
[2014-04-03 10:45:31 -0400] workmad3: papasierra: also, I'll not tell apeiros this time, but cross-posting between channels without letting the people in both channels know is slightly ill-mannered... means that the peeps in both chans could be giving redundant info
[2014-04-03 10:45:45 -0400] workmad3: papasierra: apeiros gets quite annoyed about that in #ruby ;)
[2014-04-03 10:47:01 -0400] papasierra: right, sorry about that. this started out as a "ruby syntax" question. then when canton7 couldn't help further i came to chef. i was only posting back to ruby to let him know i had a solution, which turned into further feedback :) apologies though
[2014-04-03 10:47:40 -0400] workmad3: papasierra: no worries this time :)
[2014-04-03 10:48:31 -0400] workmad3: papasierra: it's more annoying when it's between channels with larger crossover tbh... so #ruby to #ruby-lang and #rubyonrails
[2014-04-03 10:48:55 -0400] workmad3: papasierra: while #chef has fewer people shared with those channels :)
[2014-04-03 10:50:16 -0400] papasierra: right, i believed all along it my issue was a ruby syntax question. however canton lead me to believe it was chef specific. anyway, on the plus side, my ruby knowledge is growing rapidly thanks to chef and vagrant and general curiosity
[2014-04-03 10:52:01 -0400] workmad3: papasierra: it's an edge case of ruby syntax that gets hit more often in chef than a lot of other places in ruby-land, IME :)
[2014-04-03 10:52:45 -0400] workmad3: papasierra: basically, ruby sees the line 'some_method {:foo => :bar}' as a call to some_method with a block, not a hash
[2014-04-03 10:53:29 -0400] workmad3: papasierra: so it then tries to parse {:foo => :bar} as the contents of a block... but it then hits hash syntax, which isn't valid in that context so you get a syntax error... one of the places you need to disambiguate with ()
[2014-04-03 10:53:30 -0400] papasierra: right ok, ruby appears to have tons of options when it comes to syntax for things like hashes. is that because there are genuinely different use cases or did someone go overboard with syntax sugar?
[2014-04-03 10:54:23 -0400] workmad3: ruby started with just implicit hashes, so 'some_method :foo => :bar', intended as a way to look like named arguments without having a full named argument syntax
[2014-04-03 10:55:29 -0400] workmad3: as it's just a hash, you can have whatever objects you want as keys and values, so 'some_method "foo" => "bar" ' is also fine... or 'some_method [1,2,3,4] => "fizzbuzz" ' if you really wanted (but it's fairly uncommon to have anything other than a symbol or a string as a hash key)
[2014-04-03 10:56:01 -0400] workmad3: then ruby introduced a new symbol-hash literal in 1.9, in preparation for a full named-argument syntax in 2.0... so 'some_method foo: "bar" ' became valid
[2014-04-03 10:56:28 -0400] papasierra: whoa some_method [1,2,3,4] => "fizzbuzz" means what? some_method[1] contains 'fizzbuzz' as does 2, 3, 4?
[2014-04-03 10:56:41 -0400] workmad3: papasierra: no, it's just another hash :)
[2014-04-03 10:56:58 -0400] papasierra: ok got it
[2014-04-03 10:57:08 -0400] workmad3: papasierra: the array is the hash key
[2014-04-03 10:57:22 -0400] papasierra: wow, screwy but yeah, got it
[2014-04-03 10:58:47 -0400] workmad3: papasierra: so yeah, some of it is extra syntax sugar and edge-cases conflicting, some of it was adding in new language features while maintaining certain backwards compatibility
[2014-04-03 10:59:42 -0400] workmad3: papasierra: a lot of the time, it doesn't cause issue... chef's DSL seems somewhat prone to hitting that particular edge-case though, and a lot of the people using chef are then new to ruby, so don't spot the problem
[2014-04-03 11:00:19 -0400] workmad3: papasierra: which wasn't helped by the previous incarnation of chef's docs actually having invalid syntax as an example :)
[2014-04-03 11:17:52 -0400] papasierra: workmad3: lol, that's interesting! and thanks for the history
[2014-04-03 11:27:11 -0400] JensOfSw_: So noone knows why i get  [2014-04-03T10:27:21+02:00] ERROR: source sequence is illegal/malformed utf-8 at the end of a chef run when chef tries to post info back to the chef server?
[2014-04-03 11:30:19 -0400] zeroXten: hi. any hints of debugging/fixing this bootstrap failure? https://gist.github.com/zeroXten/9952715
[2014-04-03 12:00:56 -0400] zeroXten: meh, I seem to be getting somewhere just running the chef-client myself
[2014-04-03 12:09:53 -0400] localgod: Hi
[2014-04-03 12:10:39 -0400] localgod: I keep getting No resource or method named `mysql_service' for `Chef::Recipe "server"' when i try to use the latest http://community.opscode.com/cookbooks/mysql.... any hits?
[2014-04-03 12:11:15 -0400] zeroXten: no, i take that back.. chef-client -l debug gives me nothing
[2014-04-03 12:33:18 -0400] zeroXten: looks like a problem/bug with having username/password in the proxy url
[2014-04-03 12:33:28 -0400] zeroXten: like http://stackoverflow.com/questions/21746223/bootstrap-proxy-issues-in-chef
[2014-04-03 13:11:33 -0400] dd: Hello, does anybody know of a PHP library wrapper for the chef API? something I could use with codeiniter?
[2014-04-03 14:32:39 -0400] Nukepuppy: hmm.. more of a ruby question.. anyone have a good suggestion on porting all my gem versions to another desktop?
[2014-04-03 14:32:51 -0400] Nukepuppy: can i like make a Gemfile of all my gems? ;p
[2014-04-03 14:37:22 -0400] srenatus: coderanger: hi there.  just hit some weird problem with the gpg for the ruby.poise.io repo not being found...?
[2014-04-03 14:48:18 -0400] rayrod2030: anyone run netflix asgard in vpc?
[2014-04-03 14:51:29 -0400] erbruce: i have recipe which installs service package, declare template file and declare service
[2014-04-03 14:51:57 -0400] erbruce: template has attribute  notifies :restart, "service[karaf]"
[2014-04-03 14:52:11 -0400] erbruce: service "karaf" do   supports :status => true, :restart => true, :reload => false   action [ :enable, :start ] end
[2014-04-03 14:53:16 -0400] Nukepuppy: and the issue? :P
[2014-04-03 14:53:20 -0400] erbruce: problem is following - on first run, when no service is running chef starts service and at the end later restart it
[2014-04-03 14:54:21 -0400] erbruce: template triggers restart even on first run
[2014-04-03 14:56:45 -0400] erbruce: during execution of recipe chef first starts service and later restart it - there is no reason to restart if template file is installed first time and service is not running
[2014-04-03 15:01:45 -0400] erbruce: chef should only start service on first run
[2014-04-03 15:06:39 -0400] Majost_: Does anyone know if/how chefspec supports compiling attributes files which values are set with nested attributes? eg: default['my_os'] = "I use #{node[os]}"
[2014-04-03 15:07:34 -0400] Majost_: https://gist.github.com/rhass-r7/9956127
[2014-04-03 15:07:59 -0400] Majost_: I get that error in my actual cookbook when I run rspec.
[2014-04-03 15:15:48 -0400] CPS: Majost_: you've got a ]] in there on the line that's flagged
[2014-04-03 15:16:45 -0400] CPS: oh nm i see why
[2014-04-03 15:16:50 -0400] Majost_: =)
[2014-04-03 15:17:37 -0400] CPS: well anyway, the error is pretty clear, something you're referencing on that line is nil
[2014-04-03 15:17:50 -0400] CPS: you can look at the node's attributes in the web ui to see where it is
[2014-04-03 15:18:33 -0400] Majost_: yeah... it seems like chefspec isnt mocking out 'os', despite configuring that stuff
[2014-04-03 15:19:37 -0400] Majost_: CPS, this is only in chefspec/rspec -- so there isn't a node attribute to look at.
[2014-04-03 15:22:09 -0400] CPS: could also be on the left side of the =
[2014-04-03 15:34:21 -0400] jbellone: :D
[2014-04-03 15:41:22 -0400] srenatus: coderanger: the issue resolved itself (?!)
[2014-04-03 15:46:02 -0400] mhenrixon: Is it possible to pass arguments to a recipe ?
[2014-04-03 15:46:19 -0400] mhenrixon: include_recipe "myname" { something 'value' }
[2014-04-03 15:47:05 -0400] mhenrixon: I could of course do some runtime values on the node perhaps?
[2014-04-03 15:57:07 -0400] shlant: anyone know where to find data bags in the new webui?
[2014-04-03 15:58:01 -0400] shlant: nm found it
[2014-04-03 15:59:13 -0400] jchauncey: \
[2014-04-03 16:06:08 -0400] juliancdunn: mhenrixon: what would you use them for?
[2014-04-03 16:06:33 -0400] mhenrixon: I am too lazy to write resources for everything was thinking of a short cut :)
[2014-04-03 16:06:59 -0400] ddr_: hiall.
[2014-04-03 16:07:20 -0400] ddr_: can i install and configure percona-server with opscode cookbook mysql v5?
[2014-04-03 16:08:23 -0400] hugespoon: hello all, i was wondering if there was a way to mass invite users to an organization through the manage interface for enterprise chef? if not, is there an API call that i might not have spotted that would help me accomplish this? ive got a lot of users that need a lot of organization invites, and id rather not do it one by one
[2014-04-03 16:08:39 -0400] juliancdunn: ddr_: read the "Scope" section
[2014-04-03 16:09:18 -0400] juliancdunn: hugespoon: check out https://github.com/opscode/knife-opc
[2014-04-03 16:11:43 -0400] ddr_: juliancdunn: thanks
[2014-04-03 16:14:48 -0400] hugespoon: juliancdunn: ah thx, it seems i lack the permissions, now to figure out how to grant myself those perms
[2014-04-03 16:17:38 -0400] juliancdunn: hugespoon: if you're an enterprise customer, you can always ask support to help you if you can't figure it out
[2014-04-03 16:18:47 -0400] hugespoon: juliancdunn: indeed, will be doing so, scouring the docs first
[2014-04-03 16:29:53 -0400] neurogenesis_: hey guys. anyone out there have any experience with mysql / mariadb on opsworks? trying to install mariadb on top of an opsworks layer but can't get around the issue that the opsworks mysql::client is being called by default (and is pinned to 5.5). this is preventing me from installing mysql 5.6 or mariadb 10.0.
[2014-04-03 16:30:17 -0400] neurogenesis_: is there a way to suppress the mysql::client from being run? i'm trying chef-rewind but am digging myself a really deep hole.
[2014-04-03 16:31:21 -0400] dgarstang: I'm looking at https://github.com/hw-cookbooks/haproxy ... "To override the configuration, modify the templates/default/haproxy.cfg.erb file directly, or supply your own and override the cookbook and source by reopening the template[/etc/haproxy/haproxy.cfg] resource.".... what does that mean exactly?
[2014-04-03 16:32:06 -0400] dgarstang: specifically, "override the cookbook and source by reopening the template"
[2014-04-03 16:32:52 -0400] vegardx: You can use host overrides, ie. by putting it in templates/<host>/haproxy.cfg.erb
[2014-04-03 16:33:46 -0400] dgarstang: vegardx: Ick, thanks.
[2014-04-03 16:38:02 -0400] hugespoon: juliancdunn: aha! found it, would you not recommend using knife-acl instead of opc?
[2014-04-03 16:40:50 -0400] workmad3: dgarstang: more likely, it means use chef-rewind to change the values
[2014-04-03 16:41:24 -0400] workmad3: dgarstang: or do 'template "/etc/haproxy/haproxy.cfg" do; cookbook "other-cookbook"; template "my-template.cfg.erb"; end'
[2014-04-03 16:44:07 -0400] dgarstang: workmad3: I think it's that fugly "t = resources("template[/etc/haproxy/haproxy.cfg]")" syntax.
[2014-04-03 16:44:17 -0400] dgarstang: t.source  "api_lb/haproxy.cfg.erb" etc
[2014-04-03 16:44:48 -0400] workmad3: dgarstang: that avoids the 'reopening already declared resource' warning
[2014-04-03 16:45:10 -0400] workmad3: dgarstang: if you don't want the fuglyness, use chef-rewind ;)
[2014-04-03 16:55:38 -0400] juliancdunn: hugespoon: not sure. again, ask support. I know nothing, I only work here :-P
[2014-04-03 16:55:54 -0400] juliancdunn: oh, ENOSPOON
[2014-04-03 17:23:13 -0400] kbarry: I need/want to get a variable into a heredoc block of code in a bash resource
[2014-04-03 17:23:39 -0400] kbarry: http://pastebin.com/MVGCWRsK
[2014-04-03 17:24:06 -0400] kbarry: I have a feeling I am overusing the heredoc. How with one get this to work?
[2014-04-03 17:25:35 -0400] maplebed: kbarry: it's not quite answering your question but you could use the file resource with content of the variable (instead of bash and heredoc)
[2014-04-03 17:26:06 -0400] kbarry: do you mean, take line
[2014-04-03 17:26:30 -0400] kbarry: take line 3, minus the echo, and put it in a file,
[2014-04-03 17:26:35 -0400] kbarry: does it need to be a template
[2014-04-03 17:26:38 -0400] kbarry: template?
[2014-04-03 17:26:53 -0400] kbarry: I mean, will ruby be interpolated in a file?
[2014-04-03 17:26:57 -0400] maplebed: http://docs.opscode.com/resource_file.html
[2014-04-03 17:27:32 -0400] maplebed: file "//opt/zookeeper/data/myid"  do
[2014-04-03 17:27:36 -0400] maplebed: action :create
[2014-04-03 17:27:56 -0400] maplebed: content node['hostname'].match#.toi etc. tec.
[2014-04-03 17:27:57 -0400] maplebed: end
[2014-04-03 17:28:57 -0400] icarus: Hello all, im getting an odd error with chef-client from a server that was formerly functioning fine as of 3 days ago:
[2014-04-03 17:29:00 -0400] icarus: # ./bin/chef-client -j /etc/chef/first-boot.json
[2014-04-03 17:29:03 -0400] icarus: /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:247:in `to_specs': Could not find chef (>= 0) amongst [bundler-1.5.3, bundler-unload-1.0.2, executable-hooks-1.3.1, gem-wrappers-1.2.4, rubygems-bundler-1.4.2, rvm-1.11.3.9] (Gem::LoadError) from /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:256:in `to_spec'
[2014-04-03 17:29:08 -0400] icarus:  from /opt/che/embedded/lib/ruby/site_ruby/1.9.1/rubygrems.rb:1231:in `gem' from ./bin/chef-client:22:in `<main>'
[2014-04-03 17:29:17 -0400] icarus: nothing about the environment should have changed
[2014-04-03 17:37:20 -0400] michaelpjohnson: Hello everyone, I've got a quick knife question. I'm trying to add a recipe to the run_list in the first position. I see the option for "--after" but how do you add a recipe if there's nothing to pass to --after ?
[2014-04-03 17:42:06 -0400] tjadmin: @icarus Are you using rvm or rbenv?
[2014-04-03 17:44:17 -0400] kbarry: http://pastebin.com/2R35pBHZ
[2014-04-03 17:44:25 -0400] kbarry: maplebed: getting an error,
[2014-04-03 17:44:31 -0400] kbarry: the syntax i have all wrong,
[2014-04-03 17:44:39 -0400] kbarry: I'm not a ruby user, and new to chef still
[2014-04-03 17:45:03 -0400] kbarry: I know #{node['hostname']} has a value
[2014-04-03 17:45:47 -0400] dgarstang: Hm... so I'm trying to use the haproxy community cookbook. I'm successfully overriding the default config from my own wrapper cookbook. However, the haproxy service is being started from haproxy cookbook before my wrapper can finish configuring it. I don't want to start haproxy until my cookbook has finished configuring it.
[2014-04-03 17:46:20 -0400] kbarry: but the rest of the line wasn't interpolating,
[2014-04-03 17:46:22 -0400] dgarstang: oh, derr.. include_recipe "haproxy" at the end I suppose
[2014-04-03 17:46:38 -0400] dgarstang: no wait, that't won't work
[2014-04-03 17:46:52 -0400] kbarry: and I got "hostname.match(/[0-9]+[.]/)[0].to_i"
[2014-04-03 17:47:07 -0400] kbarry: maplebed: Mind pointing out my syntax problem?
[2014-04-03 17:48:32 -0400] bandicot: @michaelpjohnson - You don't see a --before flag for `knife node run list add` ??
[2014-04-03 17:49:28 -0400] bandicot: @michaelpjohnson - worst case scenario just use `... run list set` and rip/replace the whole deal, but my version of knife supports --before and --after flags. (11.12.0.rc.1)
[2014-04-03 17:49:53 -0400] bandicot: @michaelpjohnson I don't know when that was implemented, through.
[2014-04-03 17:54:29 -0400] maplebed: kbarry: what's the format of a hostname? I'm expecting something like zookeeper23 but if it's that I'm not sure what the [.] is about.
[2014-04-03 17:54:45 -0400] workmad3: dgarstang: is it installing haproxy from packages?
[2014-04-03 17:55:02 -0400] workmad3: dgarstang: and if so, is it likely that the service is being started when the package is installed?
[2014-04-03 17:55:07 -0400] kbarry: maplebed: example is zookeeper21
[2014-04-03 17:55:16 -0400] icarus: tjadmin: neither, it was jsut an opscode bootstrap of chef-client
[2014-04-03 17:55:26 -0400] kbarry: sorry
[2014-04-03 17:55:27 -0400] kbarry: i mean to say
[2014-04-03 17:55:27 -0400] maplebed: so I think you want your regex as .match(/[0-9]+/)[0].to_i
[2014-04-03 17:55:51 -0400] maplebed: one thing I like to do when fighting syntax like this is play with it in irb
[2014-04-03 17:56:00 -0400] maplebed: since mostly this is a ruby thing not a chef thing
[2014-04-03 17:56:08 -0400] dgarstang: workmad3: either that or it's in the haproxy cookbook. In either case it's starting haproxy before my cookbook can configure it
[2014-04-03 17:56:16 -0400] maplebed: (assuming the node['hostname'] part is working fine)
[2014-04-03 17:56:40 -0400] tjadmin: @icarus what's: >> knife --version
[2014-04-03 17:57:00 -0400] workmad3: dgarstang: if it's being started by the package, you'll need to mess around with your package managers mechanisms to customise the install and stop the service being started as part of it
[2014-04-03 17:57:18 -0400] dgarstang: workmad3: checking cookbook
[2014-04-03 17:57:50 -0400] djustin: wow, those cpachas are rediculous, now
[2014-04-03 17:58:09 -0400] dgarstang: workmad3: it's in the haproxy cookbook... service haproxy start. Might be in the package too... so even if package doesn't start it, haproxy cookbook still does
[2014-04-03 17:58:25 -0400] workmad3: dgarstang: yeah, but that service declaration will run at converge time, not compile time
[2014-04-03 17:58:32 -0400] workmad3: dgarstang: and you're altering the template config at compile time
[2014-04-03 17:58:33 -0400] dgarstang: workmad3: so... even if I modified package, I still need to ...
[2014-04-03 17:58:52 -0400] djustin: I'm trying to use powershell_out in a only_if of a lwerp...but get the following: uninitialized constant chef::mixin::powershellout...any ideas for a fix?
[2014-04-03 17:59:10 -0400] dgarstang: workmad3: so, now I'm confuse
[2014-04-03 17:59:22 -0400] workmad3: dgarstang: that means it's almost certainly the package that's starting the service
[2014-04-03 17:59:40 -0400] workmad3: dgarstang: and if you sort that out, you'll get your desired behaviour
[2014-04-03 17:59:48 -0400] dgarstang: workmad3: *sigh* K
[2014-04-03 18:01:47 -0400] kbarry: maplebed: standby, trying something
[2014-04-03 18:02:05 -0400] dgarstang: workmad3: Dammit. Normally I can control this behaviour by setting everything up, and installing the package last. When the service starts then, everything is ready.
[2014-04-03 18:05:49 -0400] [ROOT]XxNeoLiTHi: hi all, is it possible to use Ohai values inside knife.rb ? In particular wanted to get platform_family but havent found any examples of synatix, can I just call platform_family? directly?
[2014-04-03 18:06:18 -0400] [ROOT]XxNeoLiTHi: !nick neolithic
[2014-04-03 18:13:27 -0400] michaelpjohnson: @bandicot Thanks! I'll look into upgrading knife since my version doesn't have --before
[2014-04-03 18:19:59 -0400] notromda: the postfix cookbook has examples of putting the node specific attributes in a role.   I want to put the attributes in my own recipe's attibutes file, and then use include_recipe to include the postfix recipe.  It seems though, that the postfix default attributes don't get loaded right or something, and I'm stumbling on nil errors around ['postfix']['sasl_password_file']  not being set.
[2014-04-03 18:20:39 -0400] notromda: If I set it in my attributes, it kciks the can down into a template where a attribute isn't set.
[2014-04-03 18:21:17 -0400] notromda: Am I fighting the system by using include_recipe like this?
[2014-04-03 18:24:29 -0400] markvan: Is it possible for library method to call library method in another cookbook?  How to include/require that?
[2014-04-03 18:27:56 -0400] a13x212: it it possible to change the default group when using the chef user cookbook?
[2014-04-03 18:27:57 -0400] kbarry: apparently i have a syntax problem,
[2014-04-03 18:28:02 -0400] kbarry: i am trying to use "match"
[2014-04-03 18:28:26 -0400] neolithic: @notromda:  the opscode tutorial has an example of something like that, I forgot off the top of my head as I havent done it myself but have you tried setting the metadata.rb depends to include postfix
[2014-04-03 18:28:42 -0400] kbarry: maplebed: example name is "nm01server01"
[2014-04-03 18:28:55 -0400] kbarry: i  "thought" i could  do soemthing like
[2014-04-03 18:29:03 -0400] notromda: yes, the depends is set.
[2014-04-03 18:30:07 -0400] kbarry: node['hostname'].match(/.\d\d/)[1]
[2014-04-03 18:30:23 -0400] kbarry: would return  "r01"
[2014-04-03 18:30:31 -0400] kbarry: (the last 3 characters)
[2014-04-03 18:30:39 -0400] kbarry: apparently match doesnt work this way?
[2014-04-03 18:34:56 -0400] maplebed: kbarry: irb(main):001:0> "nm01server01".match(/.\d\d$/)[0]
[2014-04-03 18:34:57 -0400] maplebed: => "r01"
[2014-04-03 18:35:51 -0400] notromda: may be related to this?  https://tickets.opscode.com/browse/CHEF-3823
[2014-04-03 18:35:59 -0400] maplebed: though for a zk id, /\d+$/ would be better.
[2014-04-03 18:40:07 -0400] notromda: I have this in my metadata:
[2014-04-03 18:40:07 -0400] notromda: depends "postfix"
[2014-04-03 18:40:27 -0400] notromda: Isn't that what this ticket is talking about?
[2014-04-03 18:40:31 -0400] notromda: https://tickets.opscode.com/browse/CHEF-3820
[2014-04-03 18:48:01 -0400] D0rian: Did somebody notice any real performance degradation on the chef-server by  chef_solr['commit_interval'] = "5000" ? or even lower  I have less than 200 nodes
[2014-04-03 18:52:31 -0400] drywheat: when searching for nodes, what is the difference between using "role" and "roles" ?
[2014-04-03 18:53:02 -0400] drywheat: (i.e. search(:node, "role:yaddah") VS search(:node, "roles:yaddah"))
[2014-04-03 18:53:17 -0400] ranjib: roles is populated by chef as an attribute as part of the run list expansion
[2014-04-03 18:53:32 -0400] ranjib: not sure from where role: comes.. or even if its work
[2014-04-03 18:54:04 -0400] drywheat: maybe the docs are off
[2014-04-03 18:54:31 -0400] drywheat: chef docs for search indicate 'knife search node "role:web NOT name:web03"' is valid; probably a typo
[2014-04-03 18:55:36 -0400] dgarstang: *sigh* having trouble pulling data from data bag. foo = data_bag_item('ssl_certificates', 'dl_usercontent_com') works... I cant extract the damn data.
[2014-04-03 18:55:52 -0400] ranjib: if its in doc.. probably its correct. i just tried using role: and it worked :-)
[2014-04-03 18:57:15 -0400] ranjib: dgarstang,the syntax looks legit
[2014-04-03 18:58:24 -0400] dgarstang: ranjib: Ok, I got it. inspect was showing me data_bag_item["ssl_certificates", "dl_usercontent_com", {"id"=>"dl_usercontent_com", "key"=>"1", "cert"=>"2", "chain"=>["3", "4"]}] ... but cert['ssl_certificates'] and so on didn't work... cert['key'] does. Make no sense, but it's ruby who knows.
[2014-04-03 19:01:15 -0400] ranjib: datbag items are hash like, not the data bag itself. cert['ssl_certificate'] is the data bag, which is just a rest end point to the data bag, you cant do [] against it
[2014-04-03 19:10:47 -0400] notromda: https://wiki.opscode.com/display/chef/Attributes+Cookbook says "When Chef loads cookbook attribute files, it does so in alphabetical order for all the cookbooks. If you need to ensure that one attribute file is loaded before another (for example, if your Apache cookbook attributes requires that the Rails cookbook attributes are available first) you can use the include_attribute method"
[2014-04-03 19:11:04 -0400] notromda: my cookbook is "wested" which means it is loaded last.
[2014-04-03 19:11:18 -0400] notromda: but when I add include_attribute 'postfix'
[2014-04-03 19:11:32 -0400] notromda: It still doesn't load the right postfix attributes.
[2014-04-03 19:18:16 -0400] a13x212: anyone use chef tags? looking for a way to mark a system as dev, prod, staging, etc
[2014-04-03 19:21:44 -0400] shlant: can chef-client be urn on ubuntu 10.04?
[2014-04-03 19:23:04 -0400] jarsever: Am I free to ask a question or are we on a specific topic?
[2014-04-03 19:26:46 -0400] troyready: jarsever, I don't think there's ever really a "specific" topic going on here per se; you're always free to just ask
[2014-04-03 19:27:00 -0400] troyready: shlant, yes
[2014-04-03 19:27:15 -0400] shlant: troyready: cool, thanks
[2014-04-03 19:30:23 -0400] CPS: a13x212: we use tags but environments sounds more like what you need
[2014-04-03 19:31:37 -0400] jarsever: okay,  I am working on some cookbooks to automate Attlassian products (jira, stash, confluence, etc...) and everything works fine except for the fact that the java process that is started by the 'service' resource is then killed when chef finishes.  There are no errors ever logged and there is even a stale pid file left.  if i pry it after the service starts but before the end of the run the service remains running.  If chef finishes
[2014-04-03 19:32:58 -0400] jarsever: Could irt have something to do with the ssh connection closing when it finishes?
[2014-04-03 19:33:18 -0400] troyready: jarsever, is pry a java thing? (sincerely asking)
[2014-04-03 19:33:40 -0400] shlant: jarsever: how is the service handled? init? upstart? I had a similar issue and it was a problem with the service script
[2014-04-03 19:34:17 -0400] troyready: +1 on the script side. Generally that's the sort of thing I've run into too
[2014-04-03 19:34:47 -0400] jarsever: init is handling it but the script actually calls other specific scripts that Attlassian says to use.
[2014-04-03 19:35:23 -0400] troyready: When you're calling the service resource in Chef, it's just then calling the appropriate init system on your system. So you can typically troubleshoot the issue by calling it manually
[2014-04-03 19:35:46 -0400] bricker: How are resources/ files and attributes/ files related?
[2014-04-03 19:35:49 -0400] troyready: And when calling the init script manually produces a different result, it tends to be because things are changing during a chef-client run
[2014-04-03 19:36:23 -0400] jarsever: troyready pry is a gem that will pause the chef run and allow you to test stuff in the middle.
[2014-04-03 19:37:15 -0400] troyready: For awhile, I had a recipe/template that was mis-configured, so every chef-client run the template would change twice, which then obviously would introduce problems if the service tried to start durinjg the run
[2014-04-03 19:37:27 -0400] troyready: All kinda basic info, but just throwing it out there in case it's useful
[2014-04-03 19:37:51 -0400] troyready: and HOLY COW, conceptually that's been exactly the sort of thing I've wanted before. Thanks for the tip!
[2014-04-03 19:39:04 -0400] jarsever: the script is created correctly and manually calling it runs it perfectly.  Somehow it is dying when chef finishes.
[2014-04-03 19:41:33 -0400] troyready: Conceptually, I'd look at increasing your chef-client run logging verbosity and insert some debug logging into the startup script itself
[2014-04-03 19:42:53 -0400] troyready: If you're calling 'service "jira" - action :start', then chef will just end up doing executing 'service jira start' (or '/etc/init.d/jira start', or whatever equivalent for solaris, etc)
[2014-04-03 19:43:41 -0400] troyready: None of which should care about the root user still being logged in, locally or via ssh or whatever
[2014-04-03 19:46:46 -0400] jarsever: troyready, yea and that starts it correctly, logs even show no errors but when it finishes the process mysteriously dies.
[2014-04-03 19:48:59 -0400] jarsever: the 'runit' cookbook works but i haven't figured out how to put separate start/stop commands for it.
[2014-04-03 19:49:48 -0400] troyready: Without investigating it deeply, nothing else to look at comes to mind. It's all just subprocess calls and return  codes, and then the interactions between whatever resource (e.g. "service") you're using
[2014-04-03 19:49:58 -0400] notromda: if run_context.loaded_fully_qualified_attribute?(cookbook_name, attr_file)
[2014-04-03 19:49:59 -0400] notromda: Chef::Log.debug("I am not loading attribute file #{cookbook_name}::#{attr_file}, because I have already seen it.")
[2014-04-03 19:50:24 -0400] notromda: so I can't use include_attribute from cookbook "wested" to reload the "postfix" attributes.
[2014-04-03 19:51:13 -0400] notromda: I don't load the postfix cookbook directly because it loads from berkshelf
[2014-04-03 19:51:26 -0400] notromda: looks like I *must* set this via role. :(
[2014-04-03 20:23:00 -0400] kbarry: Ok, so when i am using the "template" resource
[2014-04-03 20:23:17 -0400] kbarry: i'd like to use a variable to populate the variable names
[2014-04-03 20:24:28 -0400] kbarry: variables({:name => #{variable_with_first_word}_list})
[2014-04-03 20:24:42 -0400] kbarry: i have 2 variables that have data in them,
[2014-04-03 20:24:47 -0400] kbarry: first_list
[2014-04-03 20:24:50 -0400] kbarry: second_list
[2014-04-03 20:24:53 -0400] jarsever: kbarry, add variables({  :home => node["jira"]["home"]   }) and then call it in the template with <%= @home %>
[2014-04-03 20:25:38 -0400] jarsever: kbarry, replace with your info though
[2014-04-03 20:25:59 -0400] kbarry: what i am looking for is slightly different
[2014-04-03 20:26:20 -0400] kbarry:  node["jira"]["home"]
[2014-04-03 20:26:53 -0400] kbarry: lets imagine that = "home"
[2014-04-03 20:27:04 -0400] kbarry: and i have a variable called "home_list"
[2014-04-03 20:27:24 -0400] kbarry:  :home => node["jira"]["home"]_list
[2014-04-03 20:28:34 -0400] jarsever: yes ":home => home_list"
[2014-04-03 20:30:53 -0400] kbarry: ok, this is just a syntax thing, i am sure
[2014-04-03 20:31:16 -0400] jarsever: kbarry, so it should be "variables({ :var1 => line_1, :var2 => line_2})"
[2014-04-03 20:34:18 -0400] kbarry: standby
[2014-04-03 20:34:22 -0400] kbarry: i'll pastebin
[2014-04-03 20:37:10 -0400] kbarry: http://pastebin.com/Wj0rxy6M
[2014-04-03 20:38:05 -0400] kbarry: So i have these variables feedredis_list, graphredis_list, etc.
[2014-04-03 20:38:30 -0400] kbarry: this recipe will be on machines that have 'feedredis' in their name,
[2014-04-03 20:38:35 -0400] kbarry: or 'graphredis"
[2014-04-03 20:38:37 -0400] kbarry: etc.
[2014-04-03 20:38:53 -0400] jarsever: kbarry, try "variables({:name => host_group})"
[2014-04-03 20:39:27 -0400] kbarry: my variables are in the form "host_group"_list
[2014-04-03 20:39:44 -0400] kbarry: the question is, how do i do
[2014-04-03 20:40:08 -0400] kbarry: variables({:name => #{host_group}"_list"})
[2014-04-03 20:40:21 -0400] kbarry: (i am just making syntax up)
[2014-04-03 20:41:10 -0400] jarsever: are you trying to pull information from host_group because you don't have a host_group_list declared.
[2014-04-03 20:41:51 -0400] kbarry: http://pastebin.com/Wj0rxy6M
[2014-04-03 20:42:07 -0400] kbarry: I have 3 variables declared at the top
[2014-04-03 20:42:14 -0400] kbarry: feedredis_list
[2014-04-03 20:42:18 -0400] kbarry: graphredis_list
[2014-04-03 20:42:22 -0400] kbarry: coreredis_list
[2014-04-03 20:43:14 -0400] kbarry: hostgroup will equal one of the following "feedredis" (not feed_redis_list), "graphredis", or "coreredis"
[2014-04-03 20:43:45 -0400] kbarry: what i wan to do is reference a variable,
[2014-04-03 20:43:47 -0400] kbarry: dor isntance
[2014-04-03 20:43:52 -0400] kbarry: feedredis_list
[2014-04-03 20:44:29 -0400] kbarry: using the value that is in "host_group", PLUS "_list"
[2014-04-03 20:45:03 -0400] kbarry: so when the machine is nm01feedredis14
[2014-04-03 20:45:08 -0400] workmad3: kbarry: why not do this instead? https://gist.github.com/workmad3/b6f6ce3a791339a86c20
[2014-04-03 20:46:05 -0400] jarsever: +1 ^^
[2014-04-03 20:46:22 -0400] kbarry: host_group will be equal toI actually wanted to do that first :)
[2014-04-03 20:46:31 -0400] kbarry: :)
[2014-04-03 20:46:35 -0400] kbarry: Thanks
[2014-04-03 20:47:06 -0400] workmad3: kbarry: also saves you 2 unnecessary searches ;)
[2014-04-03 20:57:42 -0400] coderanger: kbarry: Use a hash
[2014-04-03 21:07:42 -0400] supercom32: Question: When creating a library for a chef recipe, do you need to use the module clause from within your library.rb file?
[2014-04-03 21:07:57 -0400] supercom32: And if so, must it be unique, or does it have to match your recipe name or something?
[2014-04-03 21:08:05 -0400] coderanger: supercom32: module clause?
[2014-04-03 21:08:22 -0400] coderanger: supercom32: To rewind a bit, library files are just run as Ruby code, you can do whatever you want in them
[2014-04-03 21:08:26 -0400] supercom32: Sorry, I mean to say "module <something>  ....  end"
[2014-04-03 21:08:42 -0400] coderanger: supercom32: Yes, you probably should put any classes or methods in a namespace
[2014-04-03 21:08:51 -0400] coderanger: otherwise you risk collisions with other libraries
[2014-04-03 21:09:01 -0400] coderanger: but it depends on exactly what you are doing
[2014-04-03 21:09:36 -0400] supercom32: Ok, but this name could be anything you want. So for example if I wanted to make a git library I would go "module git" and then start defining methods?
[2014-04-03 21:10:05 -0400] coderanger: Sure, the name has to start with a capital
[2014-04-03 21:10:10 -0400] coderanger: module Git; end
[2014-04-03 21:10:25 -0400] coderanger: Its all the standard Ruby, nothing specific to Chef in there :)
[2014-04-03 21:10:31 -0400] supercom32: Ah I see!
[2014-04-03 21:33:28 -0400] supercom32: Here's a question: When writing a library for your chef recipe, does that library itself have access to chef resources and/or node attributes?
[2014-04-03 21:34:23 -0400] coderanger: supercom32: Normally, no
[2014-04-03 21:34:34 -0400] coderanger: Like I said, no DSL, its all just standard Ruby
[2014-04-03 21:34:46 -0400] coderanger: If you want to extend the Chef DSL itself, thats a thing you can do
[2014-04-03 21:42:16 -0400] Majost: Anyone know which is the better one: https://github.com/andrewgross/vagrant-chef-zero OR https://github.com/whitepages/vagrant-chefzero
[2014-04-03 21:47:38 -0400] workmad3: Majost: not sure how you'd class 'better', but I'd probably go for https://github.com/andrewgross/vagrant-chef-zero as it has more contributors, more commits, has been contributed to more recently and has enough users that some cared enough to raise issues (more than half of which have been closed)
[2014-04-03 21:54:39 -0400] supercom32: Hrm... How does Chef handle packages downloaded with gem? For example, if I go "gem install json" and then use some of that functionality in my recipe, what do I need to do to ensure the recipe works on all machines chef works with?
[2014-04-03 21:55:44 -0400] roadze: supercom32: give a look to chef_gem resources http://docs.opscode.com/resource_chef_gem.html
[2014-04-03 21:55:58 -0400] supercom32: Ah awsome. Thanks
[2014-04-03 22:00:49 -0400] coderanger: supercom32: Reminder, you can't use chef_gem in a library file :)
[2014-04-03 22:05:41 -0400] Majost: coderanger, what about in an lwrp?
[2014-04-03 22:05:46 -0400] justizin: if anyone read about sysdig and was like, this is awesome, i wonder if theres a chef cookbook to install it for me?! i created one that covers debuntu for now, ill add rpmland stuff later or happily accept a patch: https://github.com/bitmonk/chef-sysdig
[2014-04-03 22:08:50 -0400] stevenringo: Hi. I am using a cookbook to install CouchDB from source. There is an issue in the source code of CouchDB that is not in their master and need to patch one file. What would be better here? (1) Point to a patched version of the source, or (2) use the normal source and patch the file in a recipe?
[2014-04-03 22:11:05 -0400] roadze: I would point to a patched version til they merge the patch
[2014-04-03 22:15:25 -0400] coderanger: Majost: Depends on the context, inside the action method, yes
[2014-04-03 22:15:43 -0400] Majost: hrm
[2014-04-03 22:19:25 -0400] stevenringo: That's what I was thinking too, but wanted to make sure
[2014-04-03 22:29:06 -0400] rpad: If I'm overriding an attribute via an environment attribute, shouldn't it also cascade down to attributes that are set based on that attributes?
[2014-04-03 22:38:40 -0400] agoddard: playing with enterprise chef tooling again, wondering if theres a programmatic (or even manual) way to create a user that can see every organization?
[2014-04-03 22:39:57 -0400] coderanger: agoddard: You would have to do it manually
[2014-04-03 22:40:12 -0400] coderanger: agoddard: Its been a long-standing request to have an admin dashboard for OPC admins though
[2014-04-03 22:40:24 -0400] coderanger: agoddard: And the new UI was built specifically to allow for it in the future :)
[2014-04-03 22:40:36 -0400] agoddard: coderanger: nice :) thanks
[2014-04-03 22:41:03 -0400] agoddard: coderanger: does the user have to have more perms than just admin"
[2014-04-03 22:41:23 -0400] agoddard: coderanger: admin users still seem to only see their own org
[2014-04-03 22:41:35 -0400] coderanger: agoddard: Being in the org at all gives you baseline read to know that the org exists
[2014-04-03 22:42:18 -0400] agoddard: coderanger: how do I take that user and then give them privs to see every organization?
[2014-04-03 22:42:58 -0400] coderanger: agoddard: Add them to every org, manually
[2014-04-03 22:44:02 -0400] agoddard: coderanger: ah! doh, I thought adding the mega user manually was the manual part haha..
[2014-04-03 22:45:30 -0400] agoddard: coderanger: is there a way to list all orgs so I know which ones I then need to add the user to? Im guessing maybe db lookup in postgres?
[2014-04-03 22:46:06 -0400] coderanger: agoddard: Either you need to use the magic superuser (I think that exists in OPC) or yeah, break the abstraction and talk to the DB directly
[2014-04-03 22:46:58 -0400] agoddard: coderanger: ok cool, last question - how do I find the magic superuser (or if it exists)?
[2014-04-03 22:52:03 -0400] agoddard: coderanger: NSA user.. ;) Im gonna go smash some more at this, thanks for the help again!
[2014-04-03 22:55:08 -0400] erroric: quick question: Is chef month by month when it comes to payment or only yearly ?
[2014-04-03 22:58:03 -0400] coderanger: erroric: Hosted Chef bills monthy
[2014-04-03 22:58:16 -0400] coderanger: I think support contracts might be yearly
[2014-04-03 22:58:29 -0400] coderanger: and no idea on OPC licensing, probably whatever you negotiate
[2014-04-03 22:58:53 -0400] rpad: Are the node values I'm receiving expected value? https://gist.github.com/rpaddock/157fb9657401568d5ffc
[2014-04-03 22:59:20 -0400] rpad: I figured the environment variables would cascade down, but for some reason it's only affecting the explicit override
[2014-04-03 22:59:49 -0400] erroric: Codemonkey: Thanks!
[2014-04-03 23:10:58 -0400] kbarry: i got a stumper for me
[2014-04-03 23:11:03 -0400] kbarry: i was working on it earlier
[2014-04-03 23:11:10 -0400] kbarry: getting an error in testing
[2014-04-03 23:12:27 -0400] coderanger: rpad: Yes, you specified you want logname based only on the default values
[2014-04-03 23:12:44 -0400] kbarry: host_group = node['hostname'].match(/\d\d(\D+)\d\d/).match(string)[1]
[2014-04-03 23:13:02 -0400] kbarry: You must supply a name when declaring a string resource
[2014-04-03 23:13:08 -0400] kbarry: thats the error i ma getting
[2014-04-03 23:13:28 -0400] kbarry: i am sure its from the last part ".match(String)[1]
[2014-04-03 23:13:32 -0400] coderanger: kbarry: string is an undefined variable
[2014-04-03 23:13:45 -0400] kbarry: the question is
[2014-04-03 23:13:51 -0400] kbarry: host_group = node['hostname'].match(/\d\d(\D+)\d\d/)
[2014-04-03 23:13:57 -0400] coderanger: Because of the recipe DSL it is getting interpreted as a resource method invocation
[2014-04-03 23:13:59 -0400] kbarry: the \D+ is in  ()
[2014-04-03 23:14:09 -0400] coderanger: kbarry: match(string)
[2014-04-03 23:14:11 -0400] kbarry: so it should be numbered or soemthing
[2014-04-03 23:14:14 -0400] coderanger: that "string" is not defined
[2014-04-03 23:14:37 -0400] kbarry: in, notepad++, i could do a find/replace
[2014-04-03 23:14:55 -0400] kbarry: \d\d(\D+)\d\d would be my find
[2014-04-03 23:15:04 -0400] kbarry: and /1 would be my replace
[2014-04-03 23:15:17 -0400] kbarry: and if the text were nm01servername05
[2014-04-03 23:15:24 -0400] kbarry: the repalce would be nmservername
[2014-04-03 23:15:37 -0400] coderanger: kbarry: Your regex is fine
[2014-04-03 23:15:38 -0400] kbarry: or to be specific /1 would be "servername"
[2014-04-03 23:15:41 -0400] coderanger: It isn't related to that
[2014-04-03 23:15:47 -0400] coderanger: You just have an undefined variable
[2014-04-03 23:15:53 -0400] kbarry: coderanger
[2014-04-03 23:16:20 -0400] kbarry: how do I extract only the (\D) part of my regex?
[2014-04-03 23:16:37 -0400] kbarry: sorry
[2014-04-03 23:16:40 -0400] kbarry: (\D+)
[2014-04-03 23:17:03 -0400] kbarry: i dont even know what its called.
[2014-04-03 23:17:17 -0400] coderanger: kbarry: thats fine
[2014-04-03 23:17:24 -0400] coderanger: What are you trying to match against though
[2014-04-03 23:18:10 -0400] kbarry: node['hostname'] = nm01servername01
[2014-04-03 23:18:28 -0400] kbarry: I need host_group to equal "servername"
[2014-04-03 23:18:29 -0400] coderanger: then match(node['hostname'])
[2014-04-03 23:19:18 -0400] kbarry: coderanger,
[2014-04-03 23:19:29 -0400] kbarry: hostname is nm01servername01
[2014-04-03 23:19:41 -0400] kbarry: i need ONLY the part of that string that is between the 2 pair of numbers
[2014-04-03 23:19:52 -0400] kbarry: 01"servername"01
[2014-04-03 23:19:52 -0400] coderanger: kbarry: Okay ...
[2014-04-03 23:20:03 -0400] kbarry: I only want the non number part
[2014-04-03 23:20:06 -0400] coderanger: I've said now several times, your regex is fine
[2014-04-03 23:20:16 -0400] coderanger: Your code is failing because you have an undefined variable
[2014-04-03 23:20:43 -0400] kbarry: string in undefined
[2014-04-03 23:20:56 -0400] kbarry: should does it need to be befined as?
[2014-04-03 23:21:23 -0400] coderanger: I get the feeling you aren't super familiar with programming, perhaps you can avoid the need for this?
[2014-04-03 23:23:06 -0400] kbarry: host_group = node['hostname'].match(/\d\d(\D+)\d\d/).match(/\D+/)[1]
[2014-04-03 23:23:19 -0400] coderanger: kbarry: match(node['hostname')
[2014-04-03 23:23:24 -0400] coderanger: As I said before
[2014-04-03 23:24:19 -0400] kbarry: even thought node['hostname'] is equal to "nm01servername01"
[2014-04-03 23:24:40 -0400] kbarry: ?
[2014-04-03 23:26:04 -0400] coderanger: Yes
[2014-04-03 23:26:18 -0400] coderanger: The thing you give to match() is the string you are running the regexp against
[2014-04-03 23:26:45 -0400] coderanger: It returns either nil if the regexp doesn't match, or a match data object with the groupings if it does match
[2014-04-03 23:27:01 -0400] kbarry: ok
[2014-04-03 23:27:25 -0400] kbarry: and the syntax for keeping only the first grouping ... ?
[2014-04-03 23:27:35 -0400] kbarry: (since my regex only has one grouping)
[2014-04-03 23:28:03 -0400] coderanger: Please check the docs on Regexps in Ruby
[2014-04-03 23:28:09 -0400] coderanger: They are far more detailed than I can possibly be
[2014-04-03 23:36:03 -0400] doomviking: (now you have two problems)
[2014-04-03 23:37:52 -0400] coderanger: doomviking: Now you have turing complete problems
[2014-04-03 23:39:14 -0400] doomviking: :)
[2014-04-03 23:40:26 -0400] doomviking: My name isn't Alan
[2014-04-03 23:47:47 -0400] notromda: node['hostname'].match(/\d+(\D+)\d+/)[1]
[2014-04-03 23:48:19 -0400] coderanger: notromda: Either works :)
[2014-04-03 23:48:26 -0400] notromda: the string to be searched does not go inside math(), but ot the left
[2014-04-03 23:48:49 -0400] coderanger: notromda: String#match != Regexp#match
[2014-04-03 23:48:54 -0400] coderanger: notromda: They are opposites
[2014-04-03 23:51:14 -0400] bluepojo: If I want a chef run to exit such that chef-client's exit code is 0, how would I do that? Chef::Application.exit!("foo", 0) still raises an error "exit"
[2014-04-03 23:51:34 -0400] coderanger: bluepojo: I don't think can without --no-fork
[2014-04-03 23:51:44 -0400] notromda: hah, I had never seen Regex#match, I always saw String#match
[2014-04-03 23:52:48 -0400] bluepojo: coderanger: Oh I see... what problems might I see if I run chef-client with --no-fork?
[2014-04-03 23:53:14 -0400] coderanger: bluepojo: If you use interval mode, you might get memory leaks or other effects bleeding between runs
[2014-04-03 23:53:21 -0400] coderanger: bluepojo: For a one-off run, its fine though
[2014-04-03 23:53:25 -0400] bluepojo: ah ok
[2014-04-03 23:53:26 -0400] bluepojo: hm
[2014-04-03 23:53:50 -0400] bluepojo: I have a recipe that I prepend to nodes that I disable that exits the chef run... I want that not to be reported as a failure
[2014-04-03 23:53:57 -0400] bluepojo: recipe[disabled]
[2014-04-03 23:54:05 -0400] bluepojo: when I run chef-client on a cluster
[2014-04-03 23:54:51 -0400] coderanger: bluepojo: I don't think theres a great way to do that, unless ...
[2014-04-03 23:54:56 -0400] notromda: How to decide which talks to go to at chef conf...
[2014-04-03 23:55:04 -0400] coderanger:  you don't mind doing funky magic to chef internals
[2014-04-03 23:55:08 -0400] coderanger: notromda: Mine, always mine
[2014-04-03 23:55:12 -0400] bluepojo: I can come up with a better way of disabling a node if it's too funky
[2014-04-03 23:55:23 -0400] bluepojo: but I'd be interested to know what funkiness would be required
[2014-04-03 23:55:36 -0400] notromda: I still have a lot to learn, I'm sure I'm missing a lot
[2014-04-03 23:55:41 -0400] coderanger: bluepojo: The way I would do it is probably have a library file in that cookbook that monkey patches any of a number of places to make the run a no-op
[2014-04-03 23:55:51 -0400] coderanger: bluepojo: Chef::Runner would be the easiest probably
[2014-04-03 23:56:04 -0400] bluepojo: ah, that sounds reasonable.
[2014-04-03 23:56:16 -0400] bluepojo: just redefine a method so no recipes can run
[2014-04-03 23:56:23 -0400] coderanger: bluepojo: Yep
[2014-04-03 23:56:35 -0400] coderanger: bluepojo: And also don't forget to monkeypatch node.save
[2014-04-03 23:56:43 -0400] bluepojo: and, because it's forked, this won't apply to future runs if chef-client is daemonized
[2014-04-03 23:56:45 -0400] bluepojo: right?
[2014-04-03 23:56:49 -0400] coderanger: bluepojo: Right
[2014-04-03 23:57:00 -0400] bluepojo: I'll poke around at that, thanks for the thought
[2014-04-03 23:57:39 -0400] notromda: reusable cookbooks?  cool, that was one that I was looking at
[2014-04-03 23:57:43 -0400] tara_h: hey, has anybody run into this bug recently? https://tickets.opscode.com/browse/CHEF-3638
[2014-04-03 23:58:21 -0400] tara_h: I appear to be hitting it now, even though I'm using a version of chef that's well past the fix
[2014-04-03 23:58:30 -0400] coderanger: bluepojo: As usual with my "diddle with chef internals" advice, if this breaks you get to keep all the pieces ;-)
