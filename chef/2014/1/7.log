[2014-01-07 00:00:18 -0500] AntelopeSalad: yeah but then add in logging, elastic search and half a dozen other necessary modules
[2014-01-07 00:00:35 -0500] queuetip: i just realized i have all these branches now on my chef repo that are like: chef-vendor-yum-epel ... why?
[2014-01-07 00:00:43 -0500] coderanger: AntelopeSalad: Yes, so your options are spend the time to learn each of those in turn and understand them enough to run them, or pay someone else
[2014-01-07 00:00:46 -0500] queuetip: i had been making changes in one of them and didn't even realize i wasn't on my own master branch
[2014-01-07 00:00:47 -0500] coderanger: AntelopeSalad: There is no shortcut
[2014-01-07 00:00:53 -0500] flaccid: AntelopeSalad: if you assume a t1.micro can do the job and you don't need HA
[2014-01-07 00:01:00 -0500] coderanger: queuetip: Those are created by knife cookbook site install
[2014-01-07 00:01:07 -0500] AntelopeSalad: well, i have no problems with coderanger with using cap to deploy my app
[2014-01-07 00:01:14 -0500] coderanger: AntelopeSalad: Then keep using cap?
[2014-01-07 00:01:21 -0500] queuetip: coderanger: ahhh, lame!!! why would it create extra branches for each thing?
[2014-01-07 00:01:23 -0500] flaccid: AntelopeSalad: if you just want to deploy a rails app, there is many ways to do it that don't cost heaps
[2014-01-07 00:01:29 -0500] AntelopeSalad: sure, but you guys told me to move to chef for deploying an app
[2014-01-07 00:01:33 -0500] coderanger: You keep sounding like you are looking for shortcuts and abstracted complexity
[2014-01-07 00:01:37 -0500] coderanger: neither of which chef offers
[2014-01-07 00:01:38 -0500] AntelopeSalad: flaccid: it can do the job
[2014-01-07 00:02:07 -0500] flaccid: AntelopeSalad: ok can i tell you to do other things and you'll just do it too?
[2014-01-07 00:02:09 -0500] flaccid: :)
[2014-01-07 00:02:19 -0500] coderanger: queuetip: Because when you upgrade via knife cookbook site, it can rebase your changes
[2014-01-07 00:02:22 -0500] AntelopeSalad: what do you mean?
[2014-01-07 00:02:28 -0500] coderanger: queuetip: or diamond merge
[2014-01-07 00:02:45 -0500] coderanger: AntelopeSalad: Basically you need to spend a bunch of time learning to do something by hand before Chef helps automate it
[2014-01-07 00:02:47 -0500] flaccid: if i told you to jump off a cliff would yo do it heh
[2014-01-07 00:02:58 -0500] coderanger: AntelopeSalad: You, to be honest, don't know how to deploy a Rails app by hand
[2014-01-07 00:03:09 -0500] coderanger: and as such, you are struggling a lot with automating it
[2014-01-07 00:03:23 -0500] AntelopeSalad: why would i deploy it by hand tho?
[2014-01-07 00:03:29 -0500] coderanger: To learn how it all works
[2014-01-07 00:03:36 -0500] coderanger: what interacts with what, what every piece does
[2014-01-07 00:03:38 -0500] AntelopeSalad: i like to leverage tools to help me, not create things from scratch
[2014-01-07 00:03:38 -0500] queuetip: in the knife cookbook site install documentation, it says: The pristine copy branch is merged into the master branch.
[2014-01-07 00:03:56 -0500] queuetip: it should also git checkout master again
[2014-01-07 00:03:59 -0500] coderanger: AntelopeSalad: And thats, unfortunately, not a way you can do operations, we don't have good abstraction layers yet
[2014-01-07 00:04:16 -0500] AntelopeSalad: i never looked deep into the internals of cap, but it takes ~3min to deploy a trivial app and spams my stdout with like 50 commands
[2014-01-07 00:04:21 -0500] AntelopeSalad: so i imagine it's doing a ton of things
[2014-01-07 00:04:29 -0500] coderanger: AntelopeSalad: The webdev world has really good abstractions over the system, ops doesn't
[2014-01-07 00:04:33 -0500] AntelopeSalad: i could probably spend a year+ just learning about it and implementing it from scratch
[2014-01-07 00:04:38 -0500] coderanger: AntelopeSalad: Yep
[2014-01-07 00:04:43 -0500] coderanger: AntelopeSalad: I spent 4 years
[2014-01-07 00:04:45 -0500] AntelopeSalad: but i would rather spend a year developing an app and then getting users
[2014-01-07 00:04:59 -0500] coderanger: AntelopeSalad: As I said, thats not really how it works right now :-(
[2014-01-07 00:05:00 -0500] coderanger: Sorry
[2014-01-07 00:05:13 -0500] DanS1978: coderanger: I'm missing something...
[2014-01-07 00:05:17 -0500] borntyping: AntelopeSalad: then why are you moving away from the stuff that already works for you?
[2014-01-07 00:05:20 -0500] flaccid: you can either learn a framework so you can deploy something how you want, or you can pay for PaaS
[2014-01-07 00:05:27 -0500] AntelopeSalad: but it does tho, cap got me from never deploying a rails app to having it work with phased restarts, puma, etc.. in like 8 hours
[2014-01-07 00:05:37 -0500] coderanger: Chef doesn't help you learn the underlying system, you need to know it already
[2014-01-07 00:05:52 -0500] AntelopeSalad: borntyping: because i'm using chef now to setup my server
[2014-01-07 00:05:55 -0500] coderanger: AntelopeSalad: cap is fine for one server, it fails for 100
[2014-01-07 00:05:59 -0500] queuetip: AntelopeSalad: you could roll your own fairly easily in my opinion, easy mode git deploy is one such way, just add a remote repo which is your box you want to deploy to and then it's pretty much just git push "deploy" master
[2014-01-07 00:06:07 -0500] AntelopeSalad: and since chef has a deploy resource , i figured i'd use it too because so far i am loving chef
[2014-01-07 00:06:08 -0500] DanS1978: bash "spititout" do; user "admin"; code <<EOF"cat #{search(:node, 'tags:appserver').map{|n| n['hostname']}.join(' ')} >> /home/admin/text.txt" EOF; end
[2014-01-07 00:06:09 -0500] coderanger: which is why things like bcfg and cfengine, and later chef/puppet were written
[2014-01-07 00:06:31 -0500] AntelopeSalad: queuetip: it's more complicated for rails
[2014-01-07 00:06:40 -0500] DanS1978: does not export a list of appservers into the text file.
[2014-01-07 00:06:50 -0500] AntelopeSalad: precompiling assets, migrations, knowing when it intelligently stop taking connections on your background workers, etc.
[2014-01-07 00:07:06 -0500] queuetip: AntelopeSalad: well, git has post receive scripts and such which would allow you to just add in your rake commands or whatever
[2014-01-07 00:07:14 -0500] AntelopeSalad: ot
[2014-01-07 00:07:30 -0500] AntelopeSalad: it's not just simple rake commands though, there's 100+ lines of custom cap plugins to handle all of that stuff
[2014-01-07 00:07:32 -0500] coderanger: AntelopeSalad: You can totally keep using Chef, I'm just saying that you are going to feel frustrated that Chef is "making things difficult" when the truth is more than Chef just doesn't make them easy
[2014-01-07 00:07:35 -0500] AntelopeSalad: i just don't have the experience to port it to chef
[2014-01-07 00:08:07 -0500] flaccid: you can gain that experience though if you attempt this, its probably just going to take a lot of time
[2014-01-07 00:08:10 -0500] coderanger: The problems that Chef makes easy are mostly problems you don't have
[2014-01-07 00:08:12 -0500] AntelopeSalad: there is also very little community support around the topic of application deployment with chef
[2014-01-07 00:08:22 -0500] AntelopeSalad: like blog posts, tutorials, SO questions, presentations, etc.
[2014-01-07 00:08:27 -0500] coderanger: like replicating configs across a hundred machines
[2014-01-07 00:08:33 -0500] AntelopeSalad: there's a million for setting up your server, but not app deploys
[2014-01-07 00:08:38 -0500] queuetip: AntelopeSalad: underneath the hood of capistrano (and most of these kinds of systems) is it's just ssh'ing into an array (or a single box) of hosts and executing commands
[2014-01-07 00:08:53 -0500] coderanger: AntelopeSalad: Because its "do the same thing you do by hand, but have chef do it"
[2014-01-07 00:09:01 -0500] AntelopeSalad: queuetip: yeah, that's about all i know because i don't need to do know anymore to use it (imo)
[2014-01-07 00:09:07 -0500] coderanger: So you need to know all the things you would do by hand
[2014-01-07 00:09:23 -0500] AntelopeSalad: it abstracts away all of the dirty work and lets me get on to developing an app instead of worrying about the rest
[2014-01-07 00:09:47 -0500] coderanger: That is not something that, as this point, Chef does
[2014-01-07 00:10:04 -0500] AntelopeSalad: it could be abstracted away with cookbooks right?
[2014-01-07 00:10:15 -0500] coderanger: Maybe eventually, but its Very Hard
[2014-01-07 00:10:18 -0500] AntelopeSalad: or more specifically resources maybe?
[2014-01-07 00:10:19 -0500] coderanger: I've been trying for years
[2014-01-07 00:10:28 -0500] coderanger: and I've barely made a dent
[2014-01-07 00:10:46 -0500] coderanger: I'll get there one day, but as you said, you have more important stuff to do :)
[2014-01-07 00:10:50 -0500] AntelopeSalad: that leads me to believe capistrano is a lot more complicated than i imagine
[2014-01-07 00:10:59 -0500] AntelopeSalad: if they can abstract it and provide a super simple config based approach, why can't chef?
[2014-01-07 00:11:02 -0500] DanS1978: (what I'm actually trying to do is run a query of all cache servers and run "ssh <hostname> command" a few times. )
[2014-01-07 00:11:06 -0500] coderanger: capistrano is baked in workflows from years of rails devs
[2014-01-07 00:12:03 -0500] AntelopeSalad: running the rake tasks on the server is the easy part, it's tying all of your components together and handling failed deploys, migrations/etc. that is difficult
[2014-01-07 00:12:04 -0500] coderanger: DanS1978: bash 'asdf' do command search(:node, '').map{|n| "ssh #{n['fqdn']} command"}.join("\n"); end
[2014-01-07 00:12:16 -0500] coderanger: AntelopeSalad: It is, indeed, difficult
[2014-01-07 00:12:56 -0500] AntelopeSalad: if you can't figure out, then there's no way i'm going to be able to do haha
[2014-01-07 00:12:59 -0500] AntelopeSalad: *figure it out
[2014-01-07 00:13:39 -0500] DanS1978: command instead of code?
[2014-01-07 00:13:52 -0500] coderanger: AntelopeSalad: We as a community are all trying to solve this, and if thats what you want to spend your time on then I welcome your input, but I don't think thats your goal
[2014-01-07 00:13:56 -0500] coderanger: DanS1978: Sorry, should be code
[2014-01-07 00:14:04 -0500] coderanger: DanS1978: Was just ad-libbing :)
[2014-01-07 00:14:04 -0500] AntelopeSalad: it's mostly a problem with how i learn i guess, i can't just open the source to something i barely understand and writing plugins for it
[2014-01-07 00:14:26 -0500] AntelopeSalad: i learn by looking at examples and following end to end tutorials, there's none of that for deploying rails apps with chef tho
[2014-01-07 00:14:28 -0500] DanS1978: gotcha
[2014-01-07 00:14:47 -0500] flaccid: treat chef like any framework AntelopeSalad. if you want to write something with it, its not necessarily going to be something basic
[2014-01-07 00:14:47 -0500] DanS1978: but I can use search() inside of a bash resource inside of the code block and it will return values?
[2014-01-07 00:14:50 -0500] AntelopeSalad: coderanger: i don't mind providing anything to help people who are interested in that
[2014-01-07 00:15:07 -0500] AntelopeSalad: but i have no intentions of writing low level libs to build upon
[2014-01-07 00:15:22 -0500] flaccid: AntelopeSalad: the application_ruby shows you how and my cookbook implements it dynamically, but you want to deploy it with other servers/components in the mix
[2014-01-07 00:15:39 -0500] AntelopeSalad: flaccid: yeah but that's because how my app is setup
[2014-01-07 00:15:58 -0500] flaccid: AntelopeSalad: yeah so you have a big decision to make on what you do now
[2014-01-07 00:15:59 -0500] AntelopeSalad: it requires all of those things to run, without it then it will nto ru n
[2014-01-07 00:16:34 -0500] AntelopeSalad: i totally agree that i should try to deploy a more simple app maybe, if that's what you're hinting at
[2014-01-07 00:16:45 -0500] coderanger: AntelopeSalad: That would be a start
[2014-01-07 00:17:22 -0500] AntelopeSalad: maybe going through the cap source to figure out exactly what it's doing would help too
[2014-01-07 00:17:27 -0500] coderanger: AntelopeSalad: Surviving the current "devops ecosystem" seems to require a very high tolerance for diving into a project to figure out what the hell it is doing
[2014-01-07 00:17:31 -0500] AntelopeSalad: because really, i don't know the -exact- steps
[2014-01-07 00:17:39 -0500] coderanger: Or at least thats how I survive, maybe it is different for others
[2014-01-07 00:17:44 -0500] AntelopeSalad: however i do not want to end up writing a 4,000 line chef resource to duplicate cap in chef
[2014-01-07 00:17:47 -0500] josephholsten: +9000 to reading the code, unfortunately
[2014-01-07 00:18:00 -0500] AntelopeSalad: coderanger: that's my biggest weakness
[2014-01-07 00:18:02 -0500] flaccid: AntelopeSalad: not really, its like anything, if you want to do it how you want it, you will need to learn and develop that
[2014-01-07 00:18:12 -0500] AntelopeSalad: i've always been terrible at just being able to figure things out by reading someone elses code
[2014-01-07 00:18:16 -0500] flaccid: AntelopeSalad: deploying the code is the easy part, thats already done for you
[2014-01-07 00:18:22 -0500] coderanger: I don't think there is a single tool I use regularly that I don't have patches in
[2014-01-07 00:18:28 -0500] AntelopeSalad: and i don't know how to improve that either other than the obvious "read more code"
[2014-01-07 00:18:30 -0500] coderanger: Which is cool in some ways, but also infurating
[2014-01-07 00:18:33 -0500] josephholsten: if you want cap in chef, I would strongly encourage using the application_ruby approach
[2014-01-07 00:18:53 -0500] coderanger: yeah, but app_ruby is very much "this is the one thing it supports"
[2014-01-07 00:18:58 -0500] josephholsten: coderanger: inorite?
[2014-01-07 00:19:03 -0500] coderanger: and puma isn't on the list
[2014-01-07 00:19:08 -0500] coderanger: because all I wrote was unicorn
[2014-01-07 00:19:10 -0500] josephholsten: I know I know
[2014-01-07 00:19:20 -0500] AntelopeSalad: i have the puma cap scripts written but i'm not sure how that will help
[2014-01-07 00:19:28 -0500] josephholsten: I'm trying to get the stuff to have the descartes cookbook build on app_ruby
[2014-01-07 00:19:31 -0500] AntelopeSalad: but i didn't write them, i roached them from a digital ocean blog post
[2014-01-07 00:19:37 -0500] AntelopeSalad: however i vaguely understand them!
[2014-01-07 00:20:22 -0500] flaccid: you can deploy with application and build on top if you don't want to enhance application_ruby with a puma sub resource or what not
[2014-01-07 00:20:31 -0500] AntelopeSalad: i saw this earlier today too https://github.com/yourabi/chef-puma
[2014-01-07 00:20:52 -0500] AntelopeSalad: but it had me completely baffled on how to implement it in the big picture of deployment
[2014-01-07 00:21:06 -0500] AntelopeSalad: flaccid: if i knew how to, i would
[2014-01-07 00:21:45 -0500] DanS1978: bash 'asdf' do
[2014-01-07 00:21:46 -0500] DanS1978: code <<EOF
[2014-01-07 00:21:46 -0500] DanS1978: search(:node, 'tags:varnish').map{|n| "cat #{n['hostname']} >> /home/admin/test.txt"}.join("\n")
[2014-01-07 00:21:47 -0500] DanS1978: EOF
[2014-01-07 00:21:49 -0500] DanS1978: end
[2014-01-07 00:21:53 -0500] DanS1978: (fails)
[2014-01-07 00:21:59 -0500] flaccid: AntelopeSalad: thus the decision is on your hands. either learn and try or do something else..
[2014-01-07 00:22:00 -0500] coderanger: DanS1978: No <<EOF
[2014-01-07 00:22:25 -0500] AntelopeSalad: flaccid: yeah, that's the main problem -- there is nothing to learn from other than reading source code
[2014-01-07 00:22:50 -0500] flaccid: AntelopeSalad: there is documentation on the said cookbooks and the deploy resource is documented too
[2014-01-07 00:23:03 -0500] flaccid: how to create cookbooks and their components is also well documented
[2014-01-07 00:23:11 -0500] AntelopeSalad: i read the deploy resource docs today, all i kept thinking was "how can i apply this"
[2014-01-07 00:23:31 -0500] AntelopeSalad: it didn't explain the most basic need of how you actually deploy apps with chef
[2014-01-07 00:23:56 -0500] AntelopeSalad: do you just upload the cookbook and it deploys? does the deploy code need to be a recipe in your app cookbook?
[2014-01-07 00:24:40 -0500] DanS1978: ok, that ran, but produced no output in the text file.
[2014-01-07 00:24:47 -0500] AntelopeSalad: flaccid: i already have a 5 recipe application cookbook that sets the whole server up btw, so while my chef knowledge isn't huge i'm not a total donk
[2014-01-07 00:24:52 -0500] coderanger: DanS1978: What text file?
[2014-01-07 00:24:57 -0500] DanS1978: also, why does that change things? (Please excuse my ignorance)
[2014-01-07 00:25:20 -0500] coderanger: DanS1978: I see what you tried to do
[2014-01-07 00:25:31 -0500] coderanger: So just by luck, what you typed is valid ruby syntax
[2014-01-07 00:25:34 -0500] coderanger: that happens to do nothing :-)
[2014-01-07 00:25:49 -0500] DanS1978: lawl
[2014-01-07 00:25:53 -0500] DanS1978: story of my life.
[2014-01-07 00:26:01 -0500] AntelopeSalad: i see all sorts of hard coded values in this cookbook too
[2014-01-07 00:26:01 -0500] flaccid: AntelopeSalad: does sound more like you need to learn chef basics first. you put the deploy resource in your recipe or provider, cookbooks are uploaded to the chef server, nodes run recipes of cookbooks via a run_list or similar, etc. etc.
[2014-01-07 00:27:08 -0500] coderanger: DanS1978: http://hastebin.com/wimihicutu.rb
[2014-01-07 00:29:34 -0500] AntelopeSalad: flaccid: i know most of that
[2014-01-07 00:30:13 -0500] AntelopeSalad: my run list consists of a single recipe , and that recipe concats all of the recipes needed to make my server
[2014-01-07 00:30:33 -0500] AntelopeSalad: so do i need a recipes/app_deploy.rb file that has all of the deploy stuff?
[2014-01-07 00:31:22 -0500] DanS1978: coderanger: thank you so very much for your help man.
[2014-01-07 00:31:31 -0500] DanS1978: I've been banging my head against this for hours.
[2014-01-07 00:31:32 -0500] jidar: coderanger: I just wish it wasn't so hard to figure out what the funk knife is doing, so I could actually troubleshoot why the role/recipe is getting mangled prior to sending to the chef server
[2014-01-07 00:31:37 -0500] flaccid: AntelopeSalad: sorry i don't understand your question. don't know your cookbook either
[2014-01-07 00:31:48 -0500] AntelopeSalad: flaccid: i'm using the standard application berkshelf way style
[2014-01-07 00:32:03 -0500] AntelopeSalad: 1 cookbook that has all of the components to create my app
[2014-01-07 00:32:13 -0500] flaccid: AntelopeSalad: but what is your question
[2014-01-07 00:32:35 -0500] AntelopeSalad: would i then introduce a deploy.rb file that gets included in the webserver recipe?
[2014-01-07 00:32:44 -0500] jidar: I mean I'd kill to run a knife command through a debugger, but I'm confused as to what to even start on
[2014-01-07 00:32:59 -0500] AntelopeSalad: since i'm deploying code to the web server
[2014-01-07 00:33:15 -0500] flaccid: AntelopeSalad: what you put in your recipes and how many you use to do x,y,z is your design choice
[2014-01-07 00:33:40 -0500] AntelopeSalad: in the end of the day every recipe file gets combined into 1 file right?
[2014-01-07 00:33:57 -0500] AntelopeSalad: include_recipe is just pulling in the code from that file and placing it at the exact point you called include_recipe?
[2014-01-07 00:34:19 -0500] flaccid: thats probably not the right way to look at it AntelopeSalad. they get compiled in order yes
[2014-01-07 00:34:34 -0500] AntelopeSalad: how should i be looking at it?
[2014-01-07 00:35:09 -0500] flaccid: it processes or evaluates each recipe in compile time. it doesn't combine them into 1 file.
[2014-01-07 00:35:20 -0500] AntelopeSalad: it includes them
[2014-01-07 00:35:35 -0500] flaccid: sure does
[2014-01-07 00:36:07 -0500] AntelopeSalad: i guess it's some weird mental block i have with having chef handle the app deploy
[2014-01-07 00:36:10 -0500] AntelopeSalad: i just don't get it
[2014-01-07 00:36:21 -0500] coderanger: jidar: mangled?
[2014-01-07 00:36:40 -0500] waltisfrozen: Having an odd minitest issue. I'm doing a shell_out to a curl statement with a long timeout, but the shell_out command completes almost immediately. I've tried adding a long timeout to the shell_out commadn as well, but it doesn't seem to work. Has anyone else seen something like this?
[2014-01-07 00:37:11 -0500] jidar: coderanger: ah, er... https://tickets.opscode.com/browse/KNIFE-1 knife node set foo "role[foo]"
[2014-01-07 00:37:25 -0500] jidar: but only from a windows box, I showed with the same knife version on linux it works fine
[2014-01-07 00:37:36 -0500] jidar: I also added some knife node -VV output for both clients
[2014-01-07 00:37:41 -0500] AntelopeSalad: the thing that really boggles my mind is, how could i situationally run certain things based on arguments i send to knife or ssh?
[2014-01-07 00:38:08 -0500] jidar: AntelopeSalad: include it in the recipe?
[2014-01-07 00:38:14 -0500] AntelopeSalad: like with capistrano i can do: cap production deploy images:generate_favicons
[2014-01-07 00:38:21 -0500] jidar: "recipe[foo::specialrun]"
[2014-01-07 00:38:23 -0500] flaccid: AntelopeSalad: if you are talking about node attributes there is a cli option to provide a node.json to knife
[2014-01-07 00:38:26 -0500] coderanger: AntelopeSalad: You don't, it is all a single convergent system
[2014-01-07 00:38:27 -0500] AntelopeSalad: but i could also call: cap production deploy
[2014-01-07 00:38:36 -0500] AntelopeSalad: because maybe i don't want to generate new favicons on this deploy
[2014-01-07 00:38:39 -0500] coderanger: AntelopeSalad: Define the end state, and let chef get it there
[2014-01-07 00:38:51 -0500] coderanger: so, for example, if the images are out of date have your recipe regenerate them
[2014-01-07 00:38:56 -0500] AntelopeSalad: every deploy is different, sometimes i want to run migrations, other times i do not
[2014-01-07 00:39:02 -0500] coderanger: (checking mtime, for example)
[2014-01-07 00:39:16 -0500] AntelopeSalad: so do you just go into your cookbook and hardcode the options you want every time you upload the cookbook?
[2014-01-07 00:39:17 -0500] coderanger: Run the migrations every time, usually they will be an no-op
[2014-01-07 00:39:17 -0500] jidar: the idea, "every deploy is different" just sounds wrong to me
[2014-01-07 00:39:19 -0500] flaccid: AntelopeSalad: this is generally what parameterizing with node attributes if for
[2014-01-07 00:39:31 -0500] flaccid: AntelopeSalad: see how my cookbook didn't hardcode..
[2014-01-07 00:39:36 -0500] AntelopeSalad: hardcoded attributes are still hard coded
[2014-01-07 00:39:45 -0500] AntelopeSalad: it's something i need to edit in the cookbook on every deploy
[2014-01-07 00:39:49 -0500] coderanger: AntelopeSalad: You don't "run a deploy"
[2014-01-07 00:40:09 -0500] flaccid: AntelopeSalad: as you can see my application recipe didn't hard code them in the cookbook at all
[2014-01-07 00:40:12 -0500] coderanger: You just set a value that says what the current version should be, and when chef-client runs next time it sees current != target
[2014-01-07 00:40:14 -0500] AntelopeSalad: jidar: the difference comes on what you're trying to do with the deploy
[2014-01-07 00:40:15 -0500] coderanger: and so it fixes that
[2014-01-07 00:40:51 -0500] AntelopeSalad: sometimes when i cap deploy my app, i tell it to also update my sitemap, but i don't do this always
[2014-01-07 00:41:07 -0500] AntelopeSalad: that is a difference in my eyes
[2014-01-07 00:41:23 -0500] flaccid: AntelopeSalad: i hope you are listening to me :)
[2014-01-07 00:41:28 -0500] AntelopeSalad: flaccid: i am
[2014-01-07 00:41:42 -0500] flaccid: ins be da solutions
[2014-01-07 00:41:44 -0500] coderanger: AntelopeSalad: You need to rethink things in terms of idempotent operations
[2014-01-07 00:42:01 -0500] AntelopeSalad: coderanger: most of those tasks are rake tasks that are not idempotent
[2014-01-07 00:42:04 -0500] AntelopeSalad: *are
[2014-01-07 00:42:12 -0500] coderanger: So rather than "I tell it to update my sitemap" you need to figure out how to check when it is out of date
[2014-01-07 00:42:17 -0500] coderanger: or otherwise make it idempotent
[2014-01-07 00:42:36 -0500] jidar: yea this just sounds like proper revisions
[2014-01-07 00:42:43 -0500] jidar: and weather or not to update stuff
[2014-01-07 00:42:49 -0500] AntelopeSalad: also i have a custom cap task that syncs my elastic search DB from my rails db (postgres)
[2014-01-07 00:42:53 -0500] AntelopeSalad: i don't run that every time i deploy
[2014-01-07 00:43:14 -0500] AntelopeSalad: sometimes i need to change the ES index around which requires reimporting the data, etc.
[2014-01-07 00:43:30 -0500] coderanger: AntelopeSalad: So got to figure out how to make that idempotent, or do it outside of chef :-)
[2014-01-07 00:43:38 -0500] jidar: >or do it outside of chef :-)
[2014-01-07 00:43:41 -0500] jidar: this is what I was thinking
[2014-01-07 00:43:52 -0500] coderanger: This is why the databases that people are moving towards don't have these kinds of operations
[2014-01-07 00:43:55 -0500] AntelopeSalad: but cap does that for me by just letting me append the task name in the command
[2014-01-07 00:43:58 -0500] coderanger: (Cassandra, Riak, etc)
[2014-01-07 00:44:11 -0500] AntelopeSalad: i can just do: cap refresh_elastic_search
[2014-01-07 00:44:14 -0500] coderanger: AntelopeSalad: Yes, cap is an imperative system, not an idempotent one
[2014-01-07 00:44:19 -0500] AntelopeSalad: i admit tho
[2014-01-07 00:44:25 -0500] AntelopeSalad: that style of deploying does suck
[2014-01-07 00:44:28 -0500] coderanger: Chef is built around convergence, not task execution
[2014-01-07 00:44:36 -0500] AntelopeSalad: because i have to remember which tasks to run manually
[2014-01-07 00:44:54 -0500] coderanger: Yep, with cap you are making it idempotent via the human at the keyboard
[2014-01-07 00:45:04 -0500] AntelopeSalad: yeah, that's a good point too because it's more than that
[2014-01-07 00:45:10 -0500] coderanger: So figure out what mental rules you are applying
[2014-01-07 00:45:13 -0500] AntelopeSalad: i'm using cap to deploy and to "run ssh commands"
[2014-01-07 00:45:14 -0500] coderanger: and turn those into Ruby code
[2014-01-07 00:45:23 -0500] AntelopeSalad: so it's perfoming the job of i guess 2 tools?
[2014-01-07 00:46:15 -0500] AntelopeSalad: even restarting puma requires a different cap argument
[2014-01-07 00:46:37 -0500] flaccid: so make that decision y0
[2014-01-07 00:46:37 -0500] AntelopeSalad: sometimes i do a phased restart with no schema change and other times i need to tell it to do a full restart
[2014-01-07 00:47:00 -0500] AntelopeSalad: i dunno now
[2014-01-07 00:47:27 -0500] AntelopeSalad: is chef not the right tool for the job to run arbitrary rake tasks from a workstation to x number of machines?
[2014-01-07 00:47:35 -0500] josephholsten: nope
[2014-01-07 00:48:00 -0500] josephholsten: cap, fabric, rundeck, mcollective, pushy
[2014-01-07 00:48:11 -0500] coderanger: Chef, in fact, can't do that at all
[2014-01-07 00:48:22 -0500] AntelopeSalad: there's no knife command for that? i never checked tbh
[2014-01-07 00:48:36 -0500] coderanger: AntelopeSalad: There is "knife ssh" but thats not much help
[2014-01-07 00:48:42 -0500] flaccid: rake, just another ruby craziness imo
[2014-01-07 00:48:44 -0500] coderanger: and thats not really related to chef
[2014-01-07 00:48:45 -0500] AntelopeSalad: i wonder why, wouldn't you want to do that?
[2014-01-07 00:49:02 -0500] josephholsten: especially once you've got 100+ nodes that approach sucks
[2014-01-07 00:49:03 -0500] AntelopeSalad: do you guys never have a need to run some task across multiple machines?
[2014-01-07 00:49:13 -0500] coderanger: AntelopeSalad: Sure, I use fabric for that
[2014-01-07 00:49:19 -0500] flaccid: notice how the problem doesn't exist if you didn't do ruby things hehe
[2014-01-07 00:49:30 -0500] coderanger: flaccid: Thats not true
[2014-01-07 00:49:30 -0500] flaccid: i use rightscale for it heh
[2014-01-07 00:49:48 -0500] josephholsten: flaccid: troll ;-)
[2014-01-07 00:49:54 -0500] AntelopeSalad: yeah i dunno, i feel like this problem would exist with any language right?
[2014-01-07 00:49:57 -0500] flaccid: partial troll yes
[2014-01-07 00:50:09 -0500] josephholsten: AntelopeSalad: it's true.
[2014-01-07 00:50:17 -0500] coderanger: flaccid: Stuff like "give be a DB debugging session" or "flush the production caches"
[2014-01-07 00:50:21 -0500] flaccid: i don't believe it exists with other languages because you do things different, well at least you don't rake
[2014-01-07 00:50:28 -0500] josephholsten: but a great deal of it has more to do with your application arch than it does with the tools
[2014-01-07 00:50:41 -0500] flaccid: coderanger: we call those operational scripts at rightscale, click a button :)
[2014-01-07 00:51:01 -0500] josephholsten: eg, you could conceivably use any of the tools I mentioned to automate master failover for a database
[2014-01-07 00:51:01 -0500] coderanger: flaccid: "fab cache_zap" vs. "click a button", same atructure
[2014-01-07 00:51:05 -0500] coderanger: structure
[2014-01-07 00:51:12 -0500] AntelopeSalad: how would i even begin to architect my app to not need this? other than rewriting about 5 rails gems that have massive traction?
[2014-01-07 00:51:22 -0500] coderanger: AntelopeSalad: Step one, don't use SQL
[2014-01-07 00:51:29 -0500] coderanger: Schemaless DB means no migrations
[2014-01-07 00:51:37 -0500] AntelopeSalad: schemaless db sounds like a myth to me
[2014-01-07 00:51:48 -0500] coderanger: Step two, never use the filesystem, all I/O goes via network APIs
[2014-01-07 00:51:49 -0500] AntelopeSalad: because as soon as you introduce validation then you need a schema
[2014-01-07 00:51:55 -0500] josephholsten: AntelopeSalad: it just means the schema is imposed in your application, not in the data store
[2014-01-07 00:52:00 -0500] coderanger: AntelopeSalad: No, validation and schema are different
[2014-01-07 00:52:13 -0500] coderanger: validation allows things like multiple versions of a schema to live concurrently
[2014-01-07 00:52:31 -0500] coderanger: Your app code gets gross, but you can do it
[2014-01-07 00:52:32 -0500] AntelopeSalad: i'm still pretty new to rails, about 5 months in
[2014-01-07 00:52:46 -0500] AntelopeSalad: i picked learning it because it deals with a lot of bs for me, because i came from the other side of the fence
[2014-01-07 00:52:46 -0500] flaccid: coderanger: well, not entirely. things like fabric or even knife-ssh use ssh.
[2014-01-07 00:52:56 -0500] AntelopeSalad: and having to invent a million libs just to develop an app is horrible (for me)
[2014-01-07 00:53:04 -0500] josephholsten: not using sql implies not using acid transactions, which means you can actually use a database clustering approach that doesn't require a single master
[2014-01-07 00:53:17 -0500] coderanger: flaccid: Okay fine, SSH vs. message bus is a minor variation ;-)
[2014-01-07 00:53:28 -0500] AntelopeSalad: ok, so let's say i used cassandra
[2014-01-07 00:53:30 -0500] flaccid: coderanger: its not minor if you get hacked hehe
[2014-01-07 00:53:34 -0500] AntelopeSalad: no schema right?
[2014-01-07 00:53:41 -0500] josephholsten: sure
[2014-01-07 00:53:43 -0500] coderanger: AntelopeSalad: Sure, I favor Riak, but Cassandra is fine too
[2014-01-07 00:53:56 -0500] AntelopeSalad: and it handles all of that fun stuff like self replication and balancing in its ring?
[2014-01-07 00:53:58 -0500] josephholsten: (I was going to say the same)
[2014-01-07 00:54:00 -0500] AntelopeSalad: i never looked into it in depth
[2014-01-07 00:54:09 -0500] coderanger: AntelopeSalad: For the purposes of this discussion, "yes"
[2014-01-07 00:54:10 -0500] josephholsten: more or less
[2014-01-07 00:54:19 -0500] AntelopeSalad: i think we just come from different worlds
[2014-01-07 00:54:19 -0500] coderanger: operating a c* or riak cluster is far from trivial
[2014-01-07 00:54:26 -0500] coderanger: but ditto on a postgres cluster
[2014-01-07 00:54:34 -0500] AntelopeSalad: yeah i know a sql db is close to impossible
[2014-01-07 00:54:40 -0500] AntelopeSalad: but that's when you scale vertically
[2014-01-07 00:54:46 -0500] coderanger: It isn't impossible, it is just CP
[2014-01-07 00:54:51 -0500] coderanger: and brings all that lovely baggage
[2014-01-07 00:54:54 -0500] coderanger: AP is the future
[2014-01-07 00:55:11 -0500] AntelopeSalad: i think we come from diff worlds because i build apps that rarely take off
[2014-01-07 00:55:15 -0500] josephholsten: or the present, unequally distributed ;-)
[2014-01-07 00:55:24 -0500] AntelopeSalad: the dream for me to run some saas with like 20k people paying me per month
[2014-01-07 00:55:40 -0500] AntelopeSalad: you don't need 15 db servers to do that :o
[2014-01-07 00:55:49 -0500] flaccid: saas or paas or managed services heh
[2014-01-07 00:55:55 -0500] coderanger: AntelopeSalad: Sure, thats why I was recommending Heroku, running a small service off a single dyno is totally doable
[2014-01-07 00:56:03 -0500] coderanger: and thats free
[2014-01-07 00:56:04 -0500] josephholsten: AntelopeSalad: if they're fortune 5000 users, you might
[2014-01-07 00:56:05 -0500] flaccid: appengine is good
[2014-01-07 00:56:10 -0500] AntelopeSalad: but at the same time, i enjoy learning
[2014-01-07 00:56:22 -0500] josephholsten: +1 to heroku, appengine
[2014-01-07 00:56:52 -0500] AntelopeSalad: i just don't see my problems going away by moving away from rails
[2014-01-07 00:56:58 -0500] josephholsten: to my knowledge, chef is only used in anger
[2014-01-07 00:56:59 -0500] flaccid: there is some other app paas out there, but they are not up to it
[2014-01-07 00:57:06 -0500] josephholsten: and if you can avoid it, I'd encourage you to
[2014-01-07 00:57:25 -0500] AntelopeSalad: i'm always for learning new things but i have not found any web framework that handles everything so well (IMO)
[2014-01-07 00:58:02 -0500] AntelopeSalad: josephholsten: i'm already using chef for managing the server, just not deploying the app
[2014-01-07 00:58:04 -0500] flaccid: django *cough*
[2014-01-07 00:58:13 -0500] AntelopeSalad: it was worth the ~week or so to get down the basics
[2014-01-07 00:58:32 -0500] AntelopeSalad: flaccid yeah but the same problems will still arrise
[2014-01-07 00:58:40 -0500] josephholsten: django beats the pants off rails for cms-like usage
[2014-01-07 00:59:04 -0500] AntelopeSalad: in a perfect world you would be dealing with like 20x micro services right?
[2014-01-07 00:59:09 -0500] AntelopeSalad: and then combine them all into 1 parent app
[2014-01-07 00:59:13 -0500] AntelopeSalad: but that seems like a pipe dream
[2014-01-07 00:59:24 -0500] AntelopeSalad: there are no web frameworks that let you do that in a sane way
[2014-01-07 00:59:44 -0500] flaccid: AntelopeSalad: i don't believe they do. virtualenv works great.
[2014-01-07 01:00:02 -0500] flaccid: AntelopeSalad: whats a micro service?
[2014-01-07 01:00:16 -0500] AntelopeSalad: instead of having 1 monolithic application
[2014-01-07 01:00:21 -0500] AntelopeSalad: you would have many small isolated services
[2014-01-07 01:00:41 -0500] josephholsten: AntelopeSalad: http://www.drdobbs.com/errant-architectures/184414966
[2014-01-07 01:00:47 -0500] AntelopeSalad: maybe they use a rest interface, maybe they don't -- it doesn't matter
[2014-01-07 01:01:04 -0500] flaccid: AntelopeSalad: sounds like django apps to me
[2014-01-07 01:01:19 -0500] AntelopeSalad: i never looked into django but isn't it just a collection of middleware?
[2014-01-07 01:01:22 -0500] josephholsten: Fowler's First Law of Distributed Object Design: Don't distribute your objects
[2014-01-07 01:01:24 -0500] AntelopeSalad: and has "subapps" for lack of a better term?
[2014-01-07 01:01:37 -0500] AntelopeSalad: but they all get combined into 1 process in the end AFAIK
[2014-01-07 01:01:44 -0500] flaccid: django is a framework. it has middleware yes
[2014-01-07 01:01:57 -0500] AntelopeSalad: rails has the same thing, you have "engines" that you can embed into other apps
[2014-01-07 01:02:06 -0500] AntelopeSalad: but the end result is 1 big app composed of smaller apps
[2014-01-07 01:02:10 -0500] AntelopeSalad: they are not isolated services
[2014-01-07 01:02:19 -0500] josephholsten: why do you need isolated services?
[2014-01-07 01:02:27 -0500] AntelopeSalad: isn't that the holy grail of application development?
[2014-01-07 01:02:48 -0500] josephholsten: no, the holy grail is to make it as simple as possible, but no simpler
[2014-01-07 01:02:49 -0500] AntelopeSalad: to give you maximum flexibility and separation
[2014-01-07 01:02:58 -0500] flaccid: you do understand its not really possible to split an app on the same vhost
[2014-01-07 01:03:08 -0500] flaccid: of course you can establish backend services, thats different
[2014-01-07 01:03:16 -0500] josephholsten: at the cost of increased abstraction
[2014-01-07 01:03:34 -0500] AntelopeSalad: what's your definition of simple tho?
[2014-01-07 01:03:46 -0500] josephholsten: I'm not sure I agree that you should always establish backend services
[2014-01-07 01:03:55 -0500] AntelopeSalad: if you step back from rails (and maybe djano), now you have to invent your own framework to deal with the cruft
[2014-01-07 01:03:59 -0500] AntelopeSalad: *django
[2014-01-07 01:04:17 -0500] flaccid: to me it sounds like you are trying to solve a problem that doesn't really exist
[2014-01-07 01:04:33 -0500] flaccid: django aint rails 3
[2014-01-07 01:05:05 -0500] josephholsten: AntelopeSalad: you're very worried about the Right Way. That's admirable.
[2014-01-07 01:05:31 -0500] AntelopeSalad: i don't let it stop me from coding josephholsten, i'm just saying
[2014-01-07 01:05:38 -0500] josephholsten: but before you do something the Right Way, make sure you're trying to do the Right Thing
[2014-01-07 01:05:44 -0500] AntelopeSalad: moving to a schemaless db and not using rails won't be fixing anything in my case
[2014-01-07 01:05:56 -0500] AntelopeSalad: it just means i have to spend my time solving problems rails already solved
[2014-01-07 01:06:23 -0500] josephholsten: let's take a step back. what are you trying to do today?
[2014-01-07 01:06:28 -0500] flaccid: i wasn't aware that rails solved problems, i thought it created them :p
[2014-01-07 01:06:51 -0500] AntelopeSalad: josephholsten: i was hoping to replace cap with chef for my application deploys
[2014-01-07 01:07:00 -0500] AntelopeSalad: since i already use chef to setup the server
[2014-01-07 01:07:45 -0500] AntelopeSalad: but after 90min of talking we decided i'm using cap for more than deployment
[2014-01-07 01:09:23 -0500] josephholsten: for that, I'd suggest the applicication_ruby cookbook. I'd still do my schema migrations out of band
[2014-01-07 01:09:53 -0500] AntelopeSalad: yeah but it's more complicated, my app has almost nothing in common with that cookbook
[2014-01-07 01:10:12 -0500] flaccid: AntelopeSalad: i'm sure it does. it lives in git or something right?
[2014-01-07 01:10:21 -0500] josephholsten: are you using the standard cap deploy tasks?
[2014-01-07 01:10:28 -0500] AntelopeSalad: it lives in git and it's a rails app, that's it
[2014-01-07 01:10:42 -0500] AntelopeSalad: i'm not using apache, unicorn, runit, memcached, or passenger
[2014-01-07 01:10:52 -0500] josephholsten: oh right, you're using puma
[2014-01-07 01:11:06 -0500] flaccid: AntelopeSalad: great, so you can deploy the app code, thats a good first step
[2014-01-07 01:11:08 -0500] AntelopeSalad: instead i'm using nginx/puma/redis (sidekiq) and it's all setup in cap with foreman to write the upstart scripts
[2014-01-07 01:11:11 -0500] queuetip: AntelopeSalad: i kind of feel your frustration, i too wish there was an all inclusive easy tool to use for launching servers, provisioning them, and deploying an app to them :) i'm actually building something like that now but it's sort of hardcoded to my own needs, but like... i have a shell script for launching ec2 boxes in my vpc and making sure the security groups get updated to allow the traffic, then i use chef to provisi
[2014-01-07 01:11:21 -0500] AntelopeSalad: flaccid: i've been deploying it for 3 months now with cap
[2014-01-07 01:11:37 -0500] flaccid: AntelopeSalad: i know. you said your goal was to do it with chef not with cap
[2014-01-07 01:11:47 -0500] AntelopeSalad: yeah
[2014-01-07 01:11:47 -0500] flaccid: lets just run around in circles heh
[2014-01-07 01:11:57 -0500] AntelopeSalad: right now chef is being used for nothing other than provisioning the server
[2014-01-07 01:12:01 -0500] josephholsten: flaccid: don't forget to make fun of ruby
[2014-01-07 01:12:03 -0500] AntelopeSalad: and it's all on 1 server atm (db included)
[2014-01-07 01:12:16 -0500] AntelopeSalad: mainly because it's fine with the load as is
[2014-01-07 01:12:43 -0500] flaccid: josephholsten: i never forget that :)
[2014-01-07 01:12:48 -0500] AntelopeSalad: queuetip: why aren't you using knife to launch the boxes?
[2014-01-07 01:13:34 -0500] queuetip: AntelopeSalad: it's more of the fine control of specifying a private ip in the private subnet and adding a rule to the security group
[2014-01-07 01:13:40 -0500] AntelopeSalad: oh
[2014-01-07 01:14:05 -0500] queuetip: AntelopeSalad: i definitely looked into it though :) also for instance, knife can't create the actual vpc .. or rather knife-ec2 i should say
[2014-01-07 01:14:15 -0500] AntelopeSalad: josephholsten: now you see my situation right? i would have to climb though the bowels of many cap plugins + cap itself and basically rewrite it all with chef
[2014-01-07 01:14:23 -0500] AntelopeSalad: i'm not sure i'm even qualified to do that
[2014-01-07 01:14:42 -0500] queuetip: but you may indeed be qualified for climbing into bowels!!! zing!
[2014-01-07 01:14:49 -0500] josephholsten: yeah, and I could solve some of it for you
[2014-01-07 01:14:51 -0500] AntelopeSalad: then i would still need to use cap to deal with the whole "execute this task on many servers"
[2014-01-07 01:15:07 -0500] josephholsten: like add a puma thing to app_ruby
[2014-01-07 01:15:10 -0500] AntelopeSalad: or some other cap-alternative if there's something more light weight and faster, although that's not an issue atm
[2014-01-07 01:15:28 -0500] josephholsten: but I'd want it to mirror unicorn, which would use runit, which would be annoying to you since you're using foreman
[2014-01-07 01:15:46 -0500] AntelopeSalad: maybe foreman isn't necessary tho?
[2014-01-07 01:16:01 -0500] josephholsten: hmm, I guess there could be a foreman resource, I could use that
[2014-01-07 01:16:02 -0500] AntelopeSalad: i'm not tied into using foreman, i just used it because it let me solve my problems very quickly
[2014-01-07 01:16:12 -0500] AntelopeSalad: i am tied into using it now, but i'm willing to change, etc.
[2014-01-07 01:16:32 -0500] josephholsten: honestly I love procfiles, it bugs me that I haven't put together a good workflow for us to use them
[2014-01-07 01:17:01 -0500] josephholsten: I think it would work really well with the application cookbooks
[2014-01-07 01:17:27 -0500] AntelopeSalad: https://gist.github.com/AntelopeSalad/8293083
[2014-01-07 01:17:59 -0500] AntelopeSalad: that is pretty much my entire cap script minus the configuration stuff that doesn't matter like the git repo location, etc.
[2014-01-07 01:18:00 -0500] josephholsten: line 28!
[2014-01-07 01:18:22 -0500] AntelopeSalad: i didn't write the :foreman or :deploy namespaces
[2014-01-07 01:18:22 -0500] flaccid: yep, i stabbed my eyes just as you said that
[2014-01-07 01:18:32 -0500] AntelopeSalad: it came from digital ocean
[2014-01-07 01:18:44 -0500] AntelopeSalad: https://www.digitalocean.com/community/articles/how-to-set-up-zero-downtime-rails-deploys-using-puma-and-foreman
[2014-01-07 01:18:47 -0500] AntelopeSalad: from that blog post
[2014-01-07 01:19:04 -0500] AntelopeSalad: it doesn't work very well tho, it's kind of inefficient
[2014-01-07 01:19:09 -0500] AntelopeSalad: but it works in the end
[2014-01-07 01:19:30 -0500] AntelopeSalad: here's the official puma cap plugin https://github.com/puma/puma/blob/master/lib/puma/capistrano.rb , but i don't use it
[2014-01-07 01:20:02 -0500] josephholsten: wow, they don't even apologize for that line
[2014-01-07 01:20:08 -0500] AntelopeSalad: heh
[2014-01-07 01:20:37 -0500] AntelopeSalad: you can see its inefficiency tho right?
[2014-01-07 01:20:49 -0500] AntelopeSalad: it always exports a new upstart script on each deploy
[2014-01-07 01:21:02 -0500] AntelopeSalad: but you would in theory only need to change it when your procfile changes
[2014-01-07 01:21:44 -0500] AntelopeSalad: i never got the phased restarts to actually work, i always had to do a full restart to see changes, even trivial changes like changing a view template
[2014-01-07 01:22:39 -0500] flaccid: it doesn't even say who the author is of it
[2014-01-07 01:23:41 -0500] AntelopeSalad: flaccid: hmm, i didn't notice that
[2014-01-07 01:24:08 -0500] AntelopeSalad: although i did email DO about the article to fix it for rails 4, the person who responded said they would talk to some DO guy to confirm the fix
[2014-01-07 01:26:03 -0500] AntelopeSalad: josephholsten: is there anything i can to help you integrate puma/foreman/redis support into it?
[2014-01-07 01:26:07 -0500] AntelopeSalad: *do
[2014-01-07 01:28:28 -0500] flaccid: DO looks like vps
[2014-01-07 01:28:40 -0500] masterkorp: it is
[2014-01-07 01:28:45 -0500] AntelopeSalad: flaccid: yeah, they are popular
[2014-01-07 01:28:47 -0500] masterkorp: but with an openstack api
[2014-01-07 01:28:51 -0500] masterkorp: and they are cheap
[2014-01-07 01:28:55 -0500] flaccid: good ol cloud washing
[2014-01-07 01:29:06 -0500] masterkorp: not overpriced like AWS
[2014-01-07 01:29:30 -0500] AntelopeSalad: yep, for small apps it's much cheaper than aws
[2014-01-07 01:29:44 -0500] masterkorp: its cool for temporary stuff and scaling
[2014-01-07 01:30:00 -0500] flaccid: but you pay per month?
[2014-01-07 01:30:06 -0500] masterkorp: yeah
[2014-01-07 01:30:17 -0500] flaccid: pro-rate post paid?
[2014-01-07 01:30:22 -0500] flaccid: *pro-rata
[2014-01-07 01:30:29 -0500] masterkorp: no idea
[2014-01-07 01:31:12 -0500] flaccid: oh it can do hourly
[2014-01-07 01:32:34 -0500] AntelopeSalad: i'm surprised you never heard of them
[2014-01-07 01:32:55 -0500] flaccid: i have heard of them and i checked out the site long time ago
[2014-01-07 01:33:32 -0500] flaccid: i merely trying to deciper if they are good enough to regard as cloud and not vps
[2014-01-07 01:33:42 -0500] AntelopeSalad: aws seems good if you're at the point where you need a ton of servers i think
[2014-01-07 01:33:52 -0500] AntelopeSalad: because trying to hand roll that setup seems like it would be really difficult
[2014-01-07 01:33:56 -0500] masterkorp: flaccid: as long as they have an API that is fine by my
[2014-01-07 01:34:13 -0500] flaccid: there are more public clouds of size than just ec2
[2014-01-07 01:34:13 -0500] masterkorp: flaccid: i just roll servers with knife digital ocean plugin
[2014-01-07 01:34:37 -0500] AntelopeSalad: yeah masterkorp, but how do you deal with load balancing and auto scaling?
[2014-01-07 01:34:43 -0500] AntelopeSalad: you would have to write all of that stuff yourself?
[2014-01-07 01:35:04 -0500] flaccid: masterkorp: i've inspected their knife plugin code, it was ok
[2014-01-07 01:35:30 -0500] masterkorp: AntelopeSalad: currently i have some glue code between haprozy, zookeper and knife
[2014-01-07 01:35:37 -0500] masterkorp: *haproxy
[2014-01-07 01:35:51 -0500] masterkorp: i only ever scaled the web stack
[2014-01-07 01:36:06 -0500] AntelopeSalad: it's working out well for you on DO?
[2014-01-07 01:36:25 -0500] flaccid: if you can knife bootstrap with them to do chef, then it just comes down to if their network is fine for the balancing
[2014-01-07 01:36:28 -0500] masterkorp: its meh.. really
[2014-01-07 01:36:30 -0500] AntelopeSalad: i imagine it's much cheaper than aws if you can pull it off, especially if you're talking low hundreds of nodes
[2014-01-07 01:36:41 -0500] masterkorp: AntelopeSalad: i wont trust cloud with real workload
[2014-01-07 01:36:56 -0500] masterkorp: they are very unconsistent perfomance terms
[2014-01-07 01:37:03 -0500] flaccid: masterkorp: you need GCE then
[2014-01-07 01:37:10 -0500] josephholsten: or joyent
[2014-01-07 01:37:11 -0500] masterkorp: but they are handy for scaling
[2014-01-07 01:37:19 -0500] masterkorp: flaccid: hmm, elaborate
[2014-01-07 01:37:27 -0500] josephholsten: better perf
[2014-01-07 01:37:32 -0500] AntelopeSalad: josephholsten: the sidekiq guy wrote some chef recipes too btw
[2014-01-07 01:37:47 -0500] AntelopeSalad: if you're looking to cater towards rails devs that is one of the most popular background workers
[2014-01-07 01:37:56 -0500] masterkorp: josephholsten: meh, we use dedicated machines for real work
[2014-01-07 01:38:07 -0500] josephholsten: let's not have me discuss sidekiq unless we're in a pubu
[2014-01-07 01:38:16 -0500] AntelopeSalad: you didn't like it?
[2014-01-07 01:38:28 -0500] masterkorp: the cloud its just to quick deploy stuff
[2014-01-07 01:38:46 -0500] josephholsten: masterkorp: same here, that's why we're in rackspace. dedicated for hadoop and queuing
[2014-01-07 01:38:51 -0500] masterkorp: in case the webservers are burning (aka reddit effect) we call some 10 servers
[2014-01-07 01:39:09 -0500] masterkorp: josephholsten: i also use rackspace
[2014-01-07 01:39:15 -0500] masterkorp: sadly they enforce red hat
[2014-01-07 01:39:20 -0500] josephholsten: AntelopeSalad: he's not very interested in accepting patches
[2014-01-07 01:39:32 -0500] josephholsten: masterkorp: I am very much aware
[2014-01-07 01:39:40 -0500] AntelopeSalad: oh, i only used it because it seemed to have good traction and lots of documentation
[2014-01-07 01:39:49 -0500] masterkorp: yeah they have
[2014-01-07 01:40:10 -0500] masterkorp: we use bought hardware and just pay for the rent
[2014-01-07 01:40:17 -0500] masterkorp: on a local datacenter
[2014-01-07 01:40:32 -0500] josephholsten: unfortunately, it's got the same failure modes as resque. no sane way to do HA
[2014-01-07 01:40:53 -0500] AntelopeSalad: oh right
[2014-01-07 01:41:07 -0500] AntelopeSalad: if the redis process dies then you're out of luck?
[2014-01-07 01:41:13 -0500] josephholsten: yep
[2014-01-07 01:41:16 -0500] AntelopeSalad: you lose everything in the que that's unfinished
[2014-01-07 01:41:50 -0500] josephholsten: also susceptible to workers death causing dropped jobs
[2014-01-07 01:41:53 -0500] flaccid: masterkorp: consistent
[2014-01-07 01:41:55 -0500] AntelopeSalad: i've never gotten to the point where that's an issue
[2014-01-07 01:42:10 -0500] AntelopeSalad: what are you using as a background worker then josephholsten?
[2014-01-07 01:42:12 -0500] josephholsten: the latter is the bigger issue for us
[2014-01-07 01:42:14 -0500] josephholsten: resque
[2014-01-07 01:42:15 -0500] AntelopeSalad: assuming you're using rails
[2014-01-07 01:42:32 -0500] josephholsten: yaauie works at simplymeasured, he's one of the main maintainers of resque now
[2014-01-07 01:42:43 -0500] flaccid: masterkorp: who enforced redhat?
[2014-01-07 01:42:51 -0500] josephholsten: I'm not going to talk you into resque from sidekiq though
[2014-01-07 01:42:52 -0500] AntelopeSalad: that's why i didn't look into resque much
[2014-01-07 01:42:57 -0500] AntelopeSalad: at the time it looked like it was going to die
[2014-01-07 01:43:08 -0500] josephholsten: flaccid: rackspace's dedicated support team
[2014-01-07 01:43:25 -0500] AntelopeSalad: yeah, i only brought it up because it's part of a typical app deploy
[2014-01-07 01:43:42 -0500] josephholsten: flaccid: it's not going to die the way you mean. but it's taking a shit ton of work to fix it.
[2014-01-07 01:43:51 -0500] flaccid: josephholsten: oh ouch, hope they don't do that for opencloud
[2014-01-07 01:44:03 -0500] josephholsten: flaccid: hell no
[2014-01-07 01:44:23 -0500] josephholsten: though their base images don't play nice with cloudinit out of the box
[2014-01-07 01:44:30 -0500] AntelopeSalad: josephholsten: are you guys using chef then to deploy your apps?
[2014-01-07 01:44:49 -0500] josephholsten: AntelopeSalad: our go and java ones: yes, ruby: no (cap)
[2014-01-07 01:44:59 -0500] flaccid: josephholsten: try the rightimages, not sure if they have cloud-init though
[2014-01-07 01:45:06 -0500] AntelopeSalad: what made you stick with cap for your ruby apps?
[2014-01-07 01:45:17 -0500] josephholsten: time in the day
[2014-01-07 01:45:52 -0500] AntelopeSalad: i never used java, is it similar to go in the sense that a deployment consists of a single binary?
[2014-01-07 01:46:05 -0500] josephholsten: yeah, we've got single jar deploys
[2014-01-07 01:46:49 -0500] AntelopeSalad: giving a serious look into java has always haunted me, it sucks being a curious developer
[2014-01-07 01:46:58 -0500] AntelopeSalad: all i think about is learning something and then learning something else
[2014-01-07 01:47:34 -0500] josephholsten: there's worse things than curiousity
[2014-01-07 01:48:15 -0500] AntelopeSalad: yeah but then you end up in situations where all you do is learn, instead of mastering something
[2014-01-07 01:49:13 -0500] josephholsten: trying to learn something you're not interested in, and have no use for, is a waste of effort
[2014-01-07 01:49:40 -0500] AntelopeSalad: yeah i'd agree with that
[2014-01-07 01:49:50 -0500] josephholsten: you can learn a tool very deeply and become a master of the tool, or you can learn all of the tools that solve a problem and master the problemspace
[2014-01-07 01:49:51 -0500] AntelopeSalad: i guess i just have a constant need to evaluate things to see if i'm doing it right
[2014-01-07 01:50:09 -0500] flaccid: hands dirty is part of eval
[2014-01-07 01:50:54 -0500] josephholsten: on my desk I've got a copy of Four Steps to the Epiphany, OpenGL Programming Guide, and Cocoa Programming for Mac OS X
[2014-01-07 01:50:56 -0500] AntelopeSalad: i like being a jack of all trades type of person
[2014-01-07 01:51:10 -0500] josephholsten: I'm a sysadmin managing web apps that run on linux
[2014-01-07 01:52:02 -0500] ktklam9: hi, I keep getting this when I try to install Postgres: WARN: Failed to properly build pg gem. Forcing properly linking and retrying (omnibus fix), does anyone know what this is?
[2014-01-07 01:52:04 -0500] flaccid: i like to do all i cand while trolling ruby
[2014-01-07 01:52:42 -0500] AntelopeSalad: ktklam9: you can't use omnibus built rubies and the pg gem atm
[2014-01-07 01:53:01 -0500] AntelopeSalad: i had the exact same problem today, there's some obscure openssl linking error
[2014-01-07 01:53:02 -0500] josephholsten: that's supposed to be fixed.
[2014-01-07 01:53:03 -0500] magoo: can someone remind me of the knife tool to build chef servers?
[2014-01-07 01:53:05 -0500] ktklam9: AntelopeSalad: what should I do atm?
[2014-01-07 01:53:12 -0500] AntelopeSalad: install ruby with rbenv or rvm :<
[2014-01-07 01:53:32 -0500] AntelopeSalad: https://bitbucket.org/ged/ruby-pg/issue/178/pgs-way-of-linking-to-openssl-is-not
[2014-01-07 01:53:39 -0500] josephholsten: magoo: https://github.com/fnichol/knife-server
[2014-01-07 01:53:47 -0500] AntelopeSalad: i opened a ticket today on it if you want to follow it
[2014-01-07 01:57:31 -0500] queuetip: i have a custom cookbook and in that cookbook i have something like: package 'php-fpm' which works fine on yum based distros but on ubuntu it's php5-fpm ... how can i handle that?
[2014-01-07 01:58:03 -0500] flaccid: queuetip: use platform? or node['platform'] or platform_family logic
[2014-01-07 01:58:16 -0500] queuetip: flaccid: awesome, that's what i was looking for, thanks
[2014-01-07 02:36:29 -0500] chefologist: Howdy, I have a question about cloudformation using json with particular reference to Userdata and the client.rb (node_name \"`ec2metadata --instance-id`\")
[2014-01-07 02:39:22 -0500] chefologist: anybody there?
[2014-01-07 02:39:55 -0500] flaccid: chefologist: try ##aws
[2014-01-07 02:40:24 -0500] chefologist: ahh ok thanks
[2014-01-07 02:40:46 -0500] chefologist: ##aws
[2014-01-07 02:46:02 -0500] queuetip: i need to set irssi to put things like mr glennpratt here in another window
[2014-01-07 03:05:11 -0500] chefologist: ERROR: Attempt to use relative path '' when current directory is outside the repository path
[2014-01-07 03:05:20 -0500] chefologist: receiving this when I run knife list
[2014-01-07 03:18:47 -0500] carmstrong: chefologist: does your current directory have a .chef directory?
[2014-01-07 03:29:47 -0500] chefologist: anybody here?
[2014-01-07 03:29:58 -0500] chefologist: have a questing regarding knife error
[2014-01-07 03:36:04 -0500] chefologist: any assistance would be great
[2014-01-07 03:36:19 -0500] jbz: What's up?  NO guarantees :-)
[2014-01-07 03:43:06 -0500] flaccid: won't get an answer if question is not asked
[2014-01-07 05:12:23 -0500] chefologist: hi anyone around?
[2014-01-07 05:13:22 -0500] silk: presumably
[2014-01-07 05:13:26 -0500] joonas: why not chefista?
[2014-01-07 05:13:36 -0500] joonas: or chefyist
[2014-01-07 05:37:00 -0500] jblack: So, correction. You're 1 month ahead. =) ears agoit
[2014-01-07 05:37:53 -0500] chefologist: hi can anyone assist with a knife issue
[2014-01-07 05:39:49 -0500] carmstrong: chefologist: you have asked 3 times. ask your question
[2014-01-07 05:39:58 -0500] chefologist: having trouble running knife list
[2014-01-07 05:40:37 -0500] chefologist: ERROR: Attempt to use relative path '' when current directory is outside the repository path
[2014-01-07 05:42:04 -0500] carmstrong: chefologist: are you running that command in a directory with a .chef directory?
[2014-01-07 05:42:21 -0500] chefologist: I have been, but just removed it
[2014-01-07 05:42:47 -0500] carmstrong: ...well, your .chef/knife.rb tells knife what chef server to talk to
[2014-01-07 05:42:59 -0500] carmstrong: unless you have a ~/.chef
[2014-01-07 05:43:40 -0500] chefologist: I don not have a ~/.chef directory
[2014-01-07 05:45:58 -0500] carmstrong: you'll need to generate a knife.rb and your username.pem file
[2014-01-07 05:46:23 -0500] carmstrong: from hosted Chef, Chef server, etc.
[2014-01-07 05:46:37 -0500] chefologist: chef on my local mac
[2014-01-07 05:48:53 -0500] carmstrong: what are you trying to accomplish? are you running Chef solo?
[2014-01-07 05:50:56 -0500] chefologist: so I have created a ~/.chef folder now
[2014-01-07 05:55:31 -0500] chefologist: keep getting attempt to use path error
[2014-01-07 06:19:06 -0500] chefologist: hi receiving this when I run knife status: ERROR: OpenSSL::PKey::RSAError: private key needed.
[2014-01-07 08:37:24 -0500] josephholsten: coderanger: I hope you have a proposal into chefconf re poise
[2014-01-07 08:37:43 -0500] josephholsten: since I just submitted one about how it's made my life easier
[2014-01-07 08:38:17 -0500] josephholsten: I also seriously hope you aren't in here at this hour
[2014-01-07 08:53:54 -0500] masterkorp: yawn
[2014-01-07 09:54:01 -0500] zxd: is there a cook book for running bash scripts ?
[2014-01-07 09:54:58 -0500] slicknick: pretty sure that defeats the purpose of chef ..
[2014-01-07 09:55:09 -0500] slicknick: but there is a one time run something rather you can do
[2014-01-07 09:55:09 -0500] zxd: yea
[2014-01-07 09:55:59 -0500] zxd: I have something like:
[2014-01-07 09:55:59 -0500] zxd: http://beginrescueend.com/rvm/install/
[2014-01-07 09:56:00 -0500] zxd: \curl -L https://get.rvm.io | bash -s stable
[2014-01-07 09:56:00 -0500] zxd: tail -n 1 ~/.bashrc # make sure rvm is installed
[2014-01-07 09:56:00 -0500] zxd: rvm install 1.8.7 && rvm use 1.8.7 && rvm install 1.9.2 && rvm use --default 1.9.2
[2014-01-07 09:57:40 -0500] woltage: zxd: https://github.com/fnichol/chef-rvm
[2014-01-07 10:03:47 -0500] flaccid: zxd: there is script resource with a shortcut resource for bash
[2014-01-07 10:04:33 -0500] zxd: woltage: is it on opscode community of cookbooks can't find it
[2014-01-07 10:04:46 -0500] zxd: flaccid: where?
[2014-01-07 10:04:58 -0500] flaccid: zxd: the docs show you
[2014-01-07 10:06:29 -0500] henk76: morning guys. quick question. If i want to use a subfolder for a file on the chef server i now use: cookbook_file "/config/#{node['client']}/web.config" do ... But the file doesn't get applied on the node. the file is available in the cookbook/files/defaults/config/<client name>/web.config
[2014-01-07 10:06:49 -0500] flaccid: zxd: its there, http://community.opscode.com/cookbooks/rvm
[2014-01-07 10:09:23 -0500] zeroXten: what is the best way to unit test LWRP methods without doing a full chef run?
[2014-01-07 10:09:37 -0500] zxd: flaccid: yes but it says ver 0.0.4 on https://github.com/fnichol/chef-rvm/blob/master/metadata.rb it says "0.9.1"
[2014-01-07 10:09:45 -0500] flaccid: henk76: cookbook_file "/config/#{node['client']}/web.config"  looks like its referencing the start of the root fs
[2014-01-07 10:10:13 -0500] flaccid: zxd: that just means fnichol has not updated the community site
[2014-01-07 10:10:27 -0500] henk76: yeah. i also tried it without the first /
[2014-01-07 10:10:52 -0500] henk76: didn't work also. But is there a way to use subfolders on the chef server with a cookbook_file?
[2014-01-07 10:11:06 -0500] flaccid: henk76: i don't understand what you mean 'on the chef server'
[2014-01-07 10:11:17 -0500] flaccid: you don't run recipes on the chef server
[2014-01-07 10:11:20 -0500] henk76: sorry, i meant recipe.
[2014-01-07 10:11:52 -0500] henk76: what my plan is, is to use a subdirectory for every client with the same named file in it, and then use it in the recipe
[2014-01-07 10:12:26 -0500] flaccid: henk76: the recipes get run on the client not he server so whatever files you put on the server won't be accessible by client nodes
[2014-01-07 10:13:03 -0500] flaccid: are you saying you want to use cookbook_file for a file in a folder of the cookbook?
[2014-01-07 10:13:19 -0500] henk76: but doesn't cookbook_file also upload the file to the client?
[2014-01-07 10:13:32 -0500] flaccid: henk76: no
[2014-01-07 10:14:12 -0500] henk76: i just want to upload a file from a subdirectory to the client
[2014-01-07 10:14:16 -0500] henk76: that's basically it.
[2014-01-07 10:14:31 -0500] henk76: i think i'm overthinking it
[2014-01-07 10:14:44 -0500] flaccid: you are more likely underthinking it
[2014-01-07 10:15:05 -0500] flaccid: coookbooks are not for uploading files
[2014-01-07 10:15:13 -0500] flaccid: whats the file for, where does it live etc.
[2014-01-07 10:17:09 -0500] henk76: but if i read the cookbook_file page: http://docs.opscode.com/resource_cookbook_file.html it states that you can transfer a file. so that's why i used it.
[2014-01-07 10:18:52 -0500] flaccid: henk76: yes the example shows how http://docs.opscode.com/resource_cookbook_file.html cookbook_test_file resides in files/ in the cookbook
[2014-01-07 10:20:02 -0500] flaccid: cookbook_file "/config/#{node['client']}/web.config" <-- don't use '/' and don't use node['client']
[2014-01-07 10:20:38 -0500] flaccid: i guess you could use node['client'] but its probably not the right design if you are doing this dynamically
[2014-01-07 10:20:58 -0500] henk76: so it will become a static recipe per client?
[2014-01-07 10:21:34 -0500] flaccid: i don't know why you are trying to do it this way
[2014-01-07 10:22:30 -0500] flaccid: you most likely want to use templates and node attributes.
[2014-01-07 10:24:56 -0500] henk76: one sec.  be right back
[2014-01-07 10:25:43 -0500] workmad3: zeroXten: I've been testing LWRPs by using chefspec to avoid a full chef run
[2014-01-07 10:28:02 -0500] zeroXten: workmad3: ah ok, i've been using minitest-handler so far
[2014-01-07 10:30:06 -0500] workmad3: zeroXten: yeah, minitest-handler seems to be more appropriate as a form of integration test or smoke test of a run, chefspec is aimed at more of a unit-test level integration
[2014-01-07 10:33:57 -0500] zeroXten: workmad3: cool thanks
[2014-01-07 10:48:22 -0500] zxd: there was a doc that explains how to install chef and knife and its depedencies with gem if I have ruby installed instead of default to /opt ? where can I find it
[2014-01-07 11:44:43 -0500] railsraider: anyone was able to get chef handler notify exceptions to hipchat?
[2014-01-07 11:45:14 -0500] railsraider: im using this https://github.com/mojotech/hipchat/blob/master/lib/hipchat/chef.rb but it has conflicts with json
[2014-01-07 11:45:24 -0500] railsraider: FATAL: Unknown error processing config file /etc/chef/client.rb with error Unable to activate httparty-0.12.0, because json-1.7.7 conflicts with json (~> 1.8)
[2014-01-07 11:54:26 -0500] railsraider: if i remove the json gems and install omnibus again on top of it it does not install json
[2014-01-07 12:00:27 -0500] workmad3: railsraider: remove httparty and install httparty 0.11.0 before installing hipchat
[2014-01-07 12:00:35 -0500] railsraider: thanks
[2014-01-07 12:00:53 -0500] workmad3: railsraider: as hipchat has a bad version spec for httparty (>= 0) which leads to a bad dependency graph with httparty 0.12.0
[2014-01-07 12:02:26 -0500] railsraider: workmad3: is there another way to set hipchat handler not in client.rb?
[2014-01-07 12:03:13 -0500] workmad3: railsraider: it wouldn't matter where you set it... the problem is that chef has a requirement on json <= 1.7.7, httparty 0.12.0 has a requirement on json ~> 1.8
[2014-01-07 12:03:27 -0500] workmad3: railsraider: so you can't load them both in the same ruby process
[2014-01-07 12:03:47 -0500] railsraider: yeah i understand this part, it was another question
[2014-01-07 12:04:02 -0500] workmad3: railsraider: ah ok :)
[2014-01-07 12:04:23 -0500] workmad3: railsraider: doing it in client.rb is the best, I believe, as then you're guaranteed to have it loaded before the chef run
[2014-01-07 12:04:43 -0500] workmad3: railsraider: however, you could do the .d trick and have something like /etc/chef/handlers.d/hipchat.rb
[2014-01-07 12:04:52 -0500] railsraider: a bit tricky for all servers that are installed
[2014-01-07 12:05:07 -0500] workmad3: well you can manage your chef client.rb with chef ;)
[2014-01-07 12:05:09 -0500] railsraider: so i can add it via a cookbook?
[2014-01-07 12:05:20 -0500] railsraider: oh, ok
[2014-01-07 12:05:22 -0500] railsraider: thanks
[2014-01-07 12:05:27 -0500] workmad3: the chef-client cookbook has a mechanism for adding handlers too
[2014-01-07 12:05:38 -0500] workmad3: and then reloads the config
[2014-01-07 12:06:02 -0500] railsraider: a resource?
[2014-01-07 12:06:09 -0500] workmad3: unfortunately not
[2014-01-07 12:06:14 -0500] epcim: Hi all. Beginer question. I use Vagrant + Chef_solo. Provisioning takes 1hour. Now I want to debug cookgbook I wrote and frequently re"cook" it. Using Vagrant reload --provision would take another hour. Is there a way to use "knife solo cook" to connect VM under the vagrant profile?
[2014-01-07 12:06:15 -0500] workmad3: it's the chef-client::config recipe
[2014-01-07 12:06:29 -0500] railsraider: thanks workmad3
[2014-01-07 12:06:38 -0500] workmad3: best place to read is the opscode cookbook for it
[2014-01-07 12:07:15 -0500] workmad3: I stuck the handlers I wanted in the environment attribute overrides, seemed a bit neater than roles or directly on nodes :)
[2014-01-07 12:08:07 -0500] ptrf: hmm
[2014-01-07 12:08:34 -0500] ptrf: I'm experiencing some weird behavior regarding the cookbook_file resource
[2014-01-07 12:08:42 -0500] workmad3: railsraider: something like 'chef_gem "httparty"; version "0.12.0"; action :remove; end; chef_gem "httparty"; version "0.11.0"; end; chef_gem "hipchat"' in your cookbooks would also sort out the install btw, if you do it before you run the chef-client::config recipe
[2014-01-07 12:08:49 -0500] workmad3: ptrf: weird how?
[2014-01-07 12:09:20 -0500] ptrf: hmm
[2014-01-07 12:09:41 -0500] epcim_: Hi, anybody with vagrant + chef_solo experience?
[2014-01-07 12:09:43 -0500] ptrf: well, it installs a different version of the file
[2014-01-07 12:09:54 -0500] ptrf: before installing the right version
[2014-01-07 12:09:58 -0500] teukka: epcim_: `vagrant provision`
[2014-01-07 12:10:16 -0500] teukka: epcim_: you can also trigger the chef-solo run over ssh manually if you want
[2014-01-07 12:10:21 -0500] epcim_: teukka: BEGGINER QUESTION. I use Vagrant + chef_solo. Provisioning takes 1hour. Now I want to debug cookbook I wrote and frequently re"cook" it. Using Vagrant reload --provision would take another hour. Is there a way to use "knife solo cook" to connect VM under the vagrant profile?
[2014-01-07 12:10:53 -0500] workmad3: epcim_: 'vagrant provision'
[2014-01-07 12:11:01 -0500] ptrf: oh
[2014-01-07 12:11:04 -0500] workmad3: epcim_: which just re-runs the provisioning, it doesn't reload the entire thing
[2014-01-07 12:11:06 -0500] ptrf: ehm
[2014-01-07 12:11:06 -0500] epcim_: teukka: re: "vagrant provision" I assume it just reprocess the Vagrantfile
[2014-01-07 12:11:20 -0500] ptrf: workmad3: nevermind, I've just found my problem
[2014-01-07 12:11:20 -0500] workmad3: epcim_: don't assume things ;)
[2014-01-07 12:11:21 -0500] epcim_: teukka: not the modified cookbooks? Am I wrong?
[2014-01-07 12:11:46 -0500] teukka: epcim_: chef-solo also runs everything
[2014-01-07 12:11:46 -0500] ptrf: I have the same file in a different cookbook, but I was unaware of that as it was 'hidden' by berkshel
[2014-01-07 12:11:49 -0500] ptrf: f
[2014-01-07 12:11:55 -0500] workmad3: ptrf: ah :)
[2014-01-07 12:12:01 -0500] workmad3: ptrf: that would do it
[2014-01-07 12:12:12 -0500] teukka: epcim_: sa does `knife solo cook`
[2014-01-07 12:12:14 -0500] workmad3: ptrf: I've gotten into the habit of specifying the cookbook for file and template resources
[2014-01-07 12:12:17 -0500] teukka: s/sa/as/
[2014-01-07 12:13:07 -0500] epcim_: teukka: thx, (for now:)
[2014-01-07 12:13:48 -0500] teukka: epcim_: the only catch with `vagrant provision` is that it won't work if you are using berkshelf or librarian plugin, and use NFS mounts and/or vmware provider
[2014-01-07 12:15:12 -0500] ptrf: workmad3: well, I actually need to unwind one of the resources here
[2014-01-07 12:15:16 -0500] ptrf: that should do the trick
[2014-01-07 12:15:29 -0500] ptrf: problem was that I was getting a different ruby script installed
[2014-01-07 12:15:40 -0500] epcim_: teukka: Yes.. I am using the Berks
[2014-01-07 12:15:56 -0500] ptrf: so I got some weird errors about missing options from an optionparser, from a different framework
[2014-01-07 12:16:12 -0500] teukka: epcim_: berkshelf with virtualbox (without `chef.nfs = true`) is fine
[2014-01-07 12:16:37 -0500] ptrf: but I found out that the error would only occur in that file, and only during chef-client runs
[2014-01-07 12:17:26 -0500] epcim_: teukka: my configuration uses mount -t vboxsf (not NFS). or it's irelevant and chef.nfs=true will work either
[2014-01-07 12:18:40 -0500] teukka: epcim_: that is the default and works fine. only nfs and vmware mounts break when the directory on the host is deleted and recreated
[2014-01-07 12:19:38 -0500] epcim_: teukka: good to know...
[2014-01-07 12:20:50 -0500] epcim_: teukka: damn man! you were right. It started cooking ;-) thx
[2014-01-07 12:21:39 -0500] zxd: anyone used yum-epel didn't understand where I put the priority number of the repository
[2014-01-07 12:31:09 -0500] zxd: should I add apt and yum recepies before running any other package recpeie ?
[2014-01-07 12:32:53 -0500] zxd: i Think yum automatically updates repository with every run
[2014-01-07 13:11:11 -0500] zxd: is template the right resource to use if I want to get the source file from the web
[2014-01-07 13:11:23 -0500] zxd: like http://repos.fedorapeople.org/repos/spot/chromium-stable/fedora-chromium-stable.repo
[2014-01-07 13:12:01 -0500] jonlives: zxd: you want remote_file: http://docs.opscode.com/resource_remote_file.html
[2014-01-07 13:12:15 -0500] zxd: jonlives: thanks
[2014-01-07 13:12:48 -0500] jonlives: np :)
[2014-01-07 13:27:16 -0500] railsraider: workmad3: can you please help me with this http://pastebin.com/PDuiL748 it does not install the gems when i use a role for chef-client cookbook to generate te config
[2014-01-07 13:28:29 -0500] railsraider: doh sorry workmad3 i still had the old client.rb
[2014-01-07 13:38:53 -0500] zxd: what's the common way to  catch platform family and ver 6  in say platform family rhel all = to 6.x
[2014-01-07 13:39:49 -0500] zxd: case node['platform_family'] when 'rhel' &&  node['platform_version'].to_i == 6   ?
[2014-01-07 13:39:52 -0500] zxd: is this valid code?
[2014-01-07 13:43:28 -0500] viraptor: hi all, is there a way to include a mixin in a LWRP similar to how it's done in a platform provider? I'm trying to get Chef::Mixin::Checksum included for example, but doing that at the top level in the provider implementation doesn't seem to do the right thing (still getting undefined method `checksum' for Chef::Resource::...)
[2014-01-07 13:52:26 -0500] viraptor: also, can I make an LWRP a subclass of some other provider?
[2014-01-07 14:00:12 -0500] someara: not with the LWRP DSL
[2014-01-07 14:01:00 -0500] bubu: hola, foodcritic prefers markdown readme's rather than rdocs, so I converted my .rdoc to .md but am unable to upload the cookbook now..
[2014-01-07 14:01:11 -0500] someara: you can Real Ruby to do so... https://gist.github.com/andrewgross/5349748
[2014-01-07 14:01:19 -0500] bubu: ERROR: Errno::ENOENT: No such file or directory - README.rdoc
[2014-01-07 14:02:01 -0500] viraptor: someara: but those can't be distributed in the cookbooks, right?
[2014-01-07 14:02:10 -0500] someara: sure they can
[2014-01-07 14:02:34 -0500] someara: you just put them in the libraries directory instead of the resources/providers direcories
[2014-01-07 14:02:38 -0500] viraptor: huh? I've just had one fail in a spectacular way...
[2014-01-07 14:02:50 -0500] someara: basically all the lwrp dsl buys you is not having to type Class
[2014-01-07 14:02:51 -0500] viraptor: ah! libraries directory - that would be the answer :)
[2014-01-07 14:03:19 -0500] someara: you also get a method called use_inline_resources that will isolate you an run_context
[2014-01-07 14:03:53 -0500] viraptor: is there any specific hierarchy / naming scheme, or do I just dump the blah_provider.rb in there?
[2014-01-07 14:06:06 -0500] borntyping: bubu: metadata.rb reads the README.md in, you need to change the filename there as well
[2014-01-07 14:07:52 -0500] someara: just dump blah_provider in there
[2014-01-07 14:08:06 -0500] viraptor: awesome, thank you very much someara
[2014-01-07 14:08:39 -0500] someara: np
[2014-01-07 14:08:59 -0500] zxd: how do I get the node to execute its runlist from a workstation using knife
[2014-01-07 14:09:59 -0500] someara: knife ssh "hostname:whatever" -a attribute_to_ssh_to_if_you_need_it chef-client
[2014-01-07 14:10:16 -0500] someara: where -a can be cloud.public_ipv4
[2014-01-07 14:10:23 -0500] someara: or whatever
[2014-01-07 14:26:06 -0500] zxd:  knife bootstrap   bash: line 36: /etc/chef/validation.pem: Permission denied
[2014-01-07 14:26:23 -0500] zxd: why is it trying to read that file not the settings in .chef/knife.rb
[2014-01-07 14:27:01 -0500] goacid: what is inside your ?.chef/knife.rb
[2014-01-07 14:27:14 -0500] goacid: to you have a path to : /etc/chef/validation.pem?
[2014-01-07 14:27:30 -0500] zxd: validation_key           '/home/d/chef-repo/.chef/chef-validator.pem'
[2014-01-07 14:27:40 -0500] zxd: ~/chef-repo/.chef$ ls
[2014-01-07 14:27:40 -0500] zxd: admin.pem  chef-validator.pem  chef-webui.pem  d.pem  knife.rb
[2014-01-07 14:30:48 -0500] zxd: I think I installed ruby packages and knife via gem in addition to the bash script in /opt   I think it screwed some settings
[2014-01-07 14:34:34 -0500] zxd: Recipe Compile Error in /var/chef/cache/cookbooks/chromium/recipes/default.rb
[2014-01-07 14:34:34 -0500] zxd: NameError
[2014-01-07 14:34:34 -0500] zxd: ---------
[2014-01-07 14:34:35 -0500] zxd: Cannot find a resource for chromium on ubuntu version 13.10
[2014-01-07 14:34:41 -0500] zxd:  11>>   package chromium-browser
[2014-01-07 14:39:31 -0500] zxd: ?
[2014-01-07 14:41:31 -0500] workmad3: zxd: package "chromium-browser"
[2014-01-07 14:41:36 -0500] workmad3: zxd: the " are important :P
[2014-01-07 14:46:57 -0500] zxd: workmad3: is there a way to make chef-client verbose while it's running to see what's it is doing
[2014-01-07 14:47:18 -0500] adnichols: chef-client -l debug
[2014-01-07 14:48:15 -0500] zxd: thanks
[2014-01-07 14:49:42 -0500] shlant: can someone explain to me what the ssh_wrapper is for when using git?
[2014-01-07 14:50:00 -0500] shlant: and why do you need a public key as well as private?
[2014-01-07 14:50:33 -0500] zxd: I think i did  gem install knife-github-cookbooks
[2014-01-07 14:50:36 -0500] zxd: which screwed things
[2014-01-07 14:50:47 -0500] workmad3: shlant: the ssh wrapper is to allow customisation of the ssh command that git uses (which you need even if you want something simple, such as altering the identity key to use)
[2014-01-07 14:50:59 -0500] workmad3: shlant: and you don't need both the public and private keys on the server, you only need the private
[2014-01-07 14:51:50 -0500] shlant: workmad3: yea I don't see why you would need a public key on the node, but the current code has it and this post also says it's required: http://stackoverflow.com/questions/18388722/chef-deploy-resource-private-repo-ssh-deploy-keys-and-ssh-wrapper
[2014-01-07 14:53:02 -0500] workmad3: shlant: you don't need it ;)
[2014-01-07 14:53:23 -0500] zxd: should it popup a manual page when I type - /knife help cookbook site
[2014-01-07 14:53:37 -0500] workmad3: shlant: also, file "/home/#{node[:base][:username]}/.ssh/id_rsa"; content private_key_var; <rest of file attributes>; end
[2014-01-07 14:53:43 -0500] zxd: Multiple help topics match your query. Pick one:
[2014-01-07 14:53:43 -0500] zxd: 1. knife-cookbook-site
[2014-01-07 14:53:44 -0500] zxd: 2. knife-cookbook
[2014-01-07 14:53:49 -0500] workmad3: shlant: rather than having a template with a single line like <%= @key %>
[2014-01-07 14:54:46 -0500] workmad3: shlant: additionally, you may want to consider encrypted data bags or something like chef-vault for getting the private key to the node
[2014-01-07 14:56:00 -0500] shlant: workmad3: that's the problem I'm solving, is the private key is in the files directory for some reason
[2014-01-07 14:56:15 -0500] shlant: do i need all this if I'm only cloning a repo?
[2014-01-07 14:56:24 -0500] shlant: or just for the deploy resource?
[2014-01-07 14:56:30 -0500] workmad3: shlant: is the repo public?
[2014-01-07 14:57:29 -0500] shlant: no
[2014-01-07 14:57:44 -0500] workmad3: shlant: right, then yes you need the private key to auth to the repo
[2014-01-07 14:58:08 -0500] shlant: and the wrapper
[2014-01-07 14:58:28 -0500] phutchin2: Any thoguhts on why my chef server is always high load and has both cpu's pegged all of the time?
[2014-01-07 14:58:42 -0500] phutchin2: i spun up a completely new server on a different host
[2014-01-07 14:58:52 -0500] phutchin2: and coppied all of the data over with knife backup and restore
[2014-01-07 14:58:54 -0500] phutchin2: and its doing the same thing
[2014-01-07 14:59:01 -0500] workmad3: shlant: you need the wrapper if you need something other than the default ssh setup
[2014-01-07 15:00:03 -0500] shlant: workmad3: ok, thanks!
[2014-01-07 15:00:40 -0500] workmad3: shlant: unless you fancy dumping out the .ssh/known_hosts file though, you're gonna want the SSH wrapper :)
[2014-01-07 15:01:37 -0500] shlant: phutchin2: can you see what process is using the cpu?
[2014-01-07 15:02:20 -0500] zxd: ok it just hates me
[2014-01-07 15:02:20 -0500] zxd: it does read ~/chef-repo/.chef/knife.rb  but still complains about bash: line 36: /etc/chef/validation.pem: Permission denied
[2014-01-07 15:05:08 -0500] bubu: thanks borntyping :)
[2014-01-07 15:28:17 -0500] phutchin2: Anyone? High load on chef server?
[2014-01-07 15:28:22 -0500] phutchin2: Thoughts as to why?
[2014-01-07 15:28:31 -0500] lazypower: How many nodes are converging at once?
[2014-01-07 15:29:28 -0500] phutchin2: well none right now :)
[2014-01-07 15:29:33 -0500] phutchin2: none are running on auto so nothign is hittin git
[2014-01-07 15:29:41 -0500] phutchin2: i think the load stays low until i try to run chef-client on a single node
[2014-01-07 15:29:42 -0500] phutchin2: then it pegs
[2014-01-07 15:29:44 -0500] phutchin2: until i restart it
[2014-01-07 15:29:55 -0500] phutchin2: i created a new chef server and did a knife backup and knife restore to the new one
[2014-01-07 15:30:00 -0500] phutchin2: and have the exact same problem :-\
[2014-01-07 15:30:03 -0500] phutchin2: its chef 11
[2014-01-07 15:30:46 -0500] lazypower: Well since you're running the omnibus you shouldn't be seeing crazy spikes. I've seen my OS-Chef-Server spike when ~ 30 nodes were converging at once.
[2014-01-07 15:31:00 -0500] lazypower: but it stops after the runs are complete. My suggestion is to tail the logs, see if there's a process thats hanging.
[2014-01-07 15:31:10 -0500] lazypower: watch the procs with htop
[2014-01-07 15:31:13 -0500] lazypower: all that fun jazz
[2014-01-07 15:31:53 -0500] Marcs_1: Hello all, currently using self hosted chef server. I am having some issues with bootstrapping EC2 instances. I am using elastic IPs + proper domains names, yet chef seems to take amazons internal IP and sets that as FQDN. its causing problems everywhere. from chef-client to knife cookbook upload. googling hasnt helped a whole lot, any help would be much appreciated. thank you.
[2014-01-07 15:32:58 -0500] steveb: anyone know why the default attributes i have in my syslog-ng cookbook aren't being picked up when i do include_recipe in another cookbook? when it runs the syslog-ng default recipe it gives me an error undefined method `[]' for nil:NilClass, on a node attribute that should be being set in the defaults
[2014-01-07 15:35:13 -0500] phutchin2: lazypower: yeah i've been watching it with htop. I see the erchef process staying on top. THey jump around tho. I don't see anything weird in the logs... let me look again tho.
[2014-01-07 15:36:40 -0500] phutchin2: lazypower: still looks like upstream connection time out... upstream: "http://127.0.0.1:8000/environments/_default/cookbook_versions", host: "my.host"
[2014-01-07 15:36:49 -0500] phutchin2: i thought maybe a problem with the api
[2014-01-07 15:36:53 -0500] phutchin2: but not sure where to start looking
[2014-01-07 15:37:11 -0500] phutchin2: should that be over https?
[2014-01-07 15:40:44 -0500] lazypower: yeah, it should.
[2014-01-07 15:48:59 -0500] phutchin2: lazypower: found this... wondering if its the same thing https://tickets.opscode.com/browse/CHEF-3921
[2014-01-07 15:49:03 -0500] shlant: what's a better way to set static IP's rather than having the settings in a data bag for each node?
[2014-01-07 15:50:00 -0500] workmad3: shlant: you could set that data on the node directly... it would make a certain amount of sense as it is node-specific
[2014-01-07 15:50:41 -0500] phutchin2: lazypower: actually i do think thats fine to be http as its local on the node... translates from https to http through nginx
[2014-01-07 15:50:45 -0500] phutchin2: to the api
[2014-01-07 15:50:45 -0500] lazypower: phutchin2, quite possibly. Not knowing your specific implementation thats a possibility.
[2014-01-07 15:50:46 -0500] Marcs_1: htop
[2014-01-07 15:50:56 -0500] Marcs_1: wrong channel
[2014-01-07 15:51:28 -0500] shlant: workmad3: like just set it using server info attributes
[2014-01-07 15:51:49 -0500] workmad3: Marcs_1: looks like the wrong window entirely ;)
[2014-01-07 15:52:24 -0500] mjn_: Hey all. I am a chef newb but looking for some help. I have a bootstrap that was working fine but now (after reverting to a snapshot of the ubuntu target, is not working. bootstrap connects and installs chef just fine but when attempting to register the node, chef-client is trying to connect to 127.0.0.1 instead of the enterprise chef server it should be hitting. Any ideas on how to fix this or where the problem resides?
[2014-01-07 15:53:56 -0500] Marcs_1: workmad3: :)
[2014-01-07 15:54:45 -0500] phutchin_: mjn_: did you specify your chef-server url in the bootstrap command line ?
[2014-01-07 15:54:57 -0500] shlant: mjn_: or in knife.rb
[2014-01-07 15:55:09 -0500] mjn_: it is specified in knife.rb
[2014-01-07 15:55:45 -0500] mjn_: and if I log into the node and change the settings in the local knife.rb ( think that's the file) and run chef-client manually, it works
[2014-01-07 15:55:45 -0500] shlant: mjn_: are you trying to bootstrap an already bootstrapped node?
[2014-01-07 15:55:58 -0500] mjn_: I have nuked the registered node
[2014-01-07 15:56:12 -0500] mjn_: and reverted the node to a pre-chef snapshot
[2014-01-07 15:56:20 -0500] phutchin_: mjn_: and client?
[2014-01-07 15:56:24 -0500] phutchin_: for that node?
[2014-01-07 15:56:24 -0500] shlant: but the node itself, has it already been bootstrapped?
[2014-01-07 15:56:40 -0500] mjn_: shlant: it had been bootstrapped, yes
[2014-01-07 15:56:50 -0500] mjn_: but, I believe, I removed all of the traces of that
[2014-01-07 15:56:55 -0500] phutchin_: mjn_: from the node that is trying to register, /etc/chef/client.rb will need to reflect the correct host
[2014-01-07 15:57:39 -0500] shlant: mjn_: so you bootstrapped a vanilla ubuntu instance, then deleted the node (using knife) and bootstrapped again?
[2014-01-07 15:57:56 -0500] mjn_: shlant: yes
[2014-01-07 15:58:56 -0500] shlant: mjn_: I think rebootstrapping a node will cause issues. You should only bootstrap "un-chefed" servers
[2014-01-07 15:59:08 -0500] mjn_: hrm
[2014-01-07 15:59:10 -0500] shlant: then you would run chef-client manually
[2014-01-07 15:59:15 -0500] shlant: or wait for it to do it
[2014-01-07 15:59:33 -0500] shlant: does it bootstrap if you spin up a new instance?
[2014-01-07 15:59:39 -0500] workmad3: you need to delete the client from the server if you bootstrap a node again (assuming it maintains the same client name)
[2014-01-07 15:59:48 -0500] mjn_: but why is it that client.rb is getting created with the wrong enterprise chef URL?
[2014-01-07 16:00:00 -0500] mjn_: I have removed all traces of the node from chef server
[2014-01-07 16:00:44 -0500] mjn_: it does work if I change the value entered into client.rb on the node
[2014-01-07 16:00:47 -0500] mjn_: runs fine
[2014-01-07 16:00:54 -0500] mjn_: but why create it wrong in the first place?
[2014-01-07 16:03:13 -0500] mjn_: or maybe the question is: once I bootstrap something, how do I make certain I have removed it completely from chef server?
[2014-01-07 16:05:47 -0500] joelmoss: hi all
[2014-01-07 16:05:52 -0500] joelmoss: anyone know what this means?
[2014-01-07 16:05:53 -0500] joelmoss: Cannot find a resource for to_ary on ubuntu version 13.04
[2014-01-07 16:06:00 -0500] joelmoss: https://github.com/hw-cookbooks/dpkg_autostart/blob/master/libraries/resource.rb#L27
[2014-01-07 16:07:20 -0500] joelmoss: to_ary is a Ruby method
[2014-01-07 16:07:24 -0500] chris613: can I use include_recipe from inside an LWRP provider file?
[2014-01-07 16:08:16 -0500] phutchin_: I think thats kind against the purpose of an lwrp
[2014-01-07 16:09:32 -0500] mjn__: so, any advice on completely removing a node from chef server?
[2014-01-07 16:09:45 -0500] chris613: phutchin_: Sure, but is it expected to work? Essentially I have an LWRP that won't work until another recipe has set up some stuff in the background.
[2014-01-07 16:10:05 -0500] chris613: mjn__: usually - knife node delete <name> && knife client delete <name>
[2014-01-07 16:10:35 -0500] chris613: I suppose I could move all my recipe logic into the LWRP proper...
[2014-01-07 16:11:28 -0500] phutchin_: chris613: i'm not sure if it shoudl work or not but I believe I remember that it doesn't? i could be wrong...
[2014-01-07 16:11:30 -0500] shlant: mjn_: my concern is why you would want to rebootstrap a node. bootstrapping is to get chef running on it, and if it's there already, there is no need to
[2014-01-07 16:12:56 -0500] mjn__: shlant__: Then I am approaching the work of iterating through my recipes wrong. I am in pure testing mode right now. I want to be assured that I can spin up this node, apply my few recipes, and have a replacmenet up quickly
[2014-01-07 16:13:03 -0500] mjn__: is there a better way to do that testing?
[2014-01-07 16:13:17 -0500] chris613: mjn__: Have you looked at vagrant?
[2014-01-07 16:13:27 -0500] mjn__: I think I hear you saying: bootstrap it and your testing should be purely re-applying recipes
[2014-01-07 16:13:27 -0500] shlant: +1 for vagrant
[2014-01-07 16:13:40 -0500] mjn__: I have not looked at vagrant
[2014-01-07 16:14:08 -0500] mjn__: and minuses if I have no API control of my VM environment?
[2014-01-07 16:14:18 -0500] mjn__: (or none known)
[2014-01-07 16:14:49 -0500] mjn__: I've got web vsphere for our vmware environment and that's all
[2014-01-07 16:15:01 -0500] mjn__: (and I admit to knowing little of the benefits of vagrant
[2014-01-07 16:15:07 -0500] mjn__: so maybe I am assuming too much
[2014-01-07 16:15:29 -0500] chris613: mjn__: You can use vagrant with a local copy of virtualbox, independent of your VM environment.
[2014-01-07 16:15:38 -0500] mjn__: ah ha
[2014-01-07 16:15:39 -0500] mjn__: ok
[2014-01-07 16:15:43 -0500] chris613: Not sure if that meets your needs, but it's nice if it does
[2014-01-07 16:15:53 -0500] shlant: mjn_: check out http://zeroturnaround.com/rebellabs/pragmatic-devops-how-to-create-your-first-environment-with-chef-and-vagrant/
[2014-01-07 16:16:08 -0500] shlant: it may seem like a lot to set up, but your testing will be WAY faster
[2014-01-07 16:16:16 -0500] mjn__: thanks chris613 and shlant. I will do some reading
[2014-01-07 16:16:20 -0500] mjn__: that helps!
[2014-01-07 16:16:23 -0500] shlant: especially if you use chef-solo as well
[2014-01-07 16:16:34 -0500] mjn__: we've got enterprise chef here
[2014-01-07 16:16:39 -0500] mjn__: if it makes a difference
[2014-01-07 16:17:08 -0500] mjn__: hot
[2014-01-07 16:17:17 -0500] mjn__: ok
[2014-01-07 16:17:18 -0500] chris613: Pointing your vagrant nodes to your existing chef server is also a possibility
[2014-01-07 16:17:26 -0500] mjn__: good ideas
[2014-01-07 16:17:30 -0500] ctote_: Hey everyone - is it possible to update system variables through Chef? Permanently
[2014-01-07 16:17:57 -0500] AntelopeSalad: adnichols: you said you were using fnichol's rbenv right? did you ever use the rbenv::system recipe?
[2014-01-07 16:18:28 -0500] adnichols: AntelopeSalad: yes, that's what I use typically
[2014-01-07 16:18:30 -0500] workmad3: ctote_: system variables as in environment variables?
[2014-01-07 16:18:45 -0500] AntelopeSalad: adnichols: did you ever encounter a chef error where it says it cannot find the system recipe?
[2014-01-07 16:19:06 -0500] adnichols: if you aren't using the right cookbook
[2014-01-07 16:19:36 -0500] workmad3: AntelopeSalad: how did you install the rbenv cookbook you're using?
[2014-01-07 16:19:39 -0500] adnichols: note that if you had another rbenv cookbook on the server - you should delete it
[2014-01-07 16:19:42 -0500] ctote_: workmad3: yep
[2014-01-07 16:19:56 -0500] AntelopeSalad: workmad3: through berkshelf
[2014-01-07 16:20:04 -0500] adnichols: because I think the riot one in particular has a higher version than the fnichol one - and will hence get used
[2014-01-07 16:20:05 -0500] AntelopeSalad: adnichols: that might be it, i did in the past
[2014-01-07 16:20:19 -0500] adnichols: .. unless you are strict on your versioning
[2014-01-07 16:20:34 -0500] AntelopeSalad: i've ~>'d everything except this cookbook
[2014-01-07 16:21:41 -0500] AntelopeSalad: interesting, berks didn't even upload the cookbook
[2014-01-07 16:21:59 -0500] AntelopeSalad: there's only 1 cookbook on the server and it's 1.7.1 which is the riot one
[2014-01-07 16:24:02 -0500] shlant: if i bootstrap a node with --secret-file, where does the key get placed on the server by default?
[2014-01-07 16:24:33 -0500] shlant:  /etc/chef?
[2014-01-07 16:24:38 -0500] AntelopeSalad: yeah i think so
[2014-01-07 16:24:58 -0500] phutchin_: what if i bootstrap a node and nothing getse put in /etc/chef ?
[2014-01-07 16:25:03 -0500] shlant: so when I reference it in recipes, is there a node attribute for that?
[2014-01-07 16:25:44 -0500] workmad3: shlant: if you're using the default location, you don't need to specify it, the chef encrypted data bag methods will just use the default location
[2014-01-07 16:25:59 -0500] shlant: so i don't need Chef::EncryptedDataBagItem.load_secret
[2014-01-07 16:26:03 -0500] workmad3: shlant: and you shouldn't be touching the secret file outside of the chef stuff for dealing with it really :)
[2014-01-07 16:26:29 -0500] adnichols: AntelopeSalad: berks will silently not upload a cookbook if it thinks it doesn't need to
[2014-01-07 16:26:40 -0500] adnichols: berk 2.x will, that is
[2014-01-07 16:26:41 -0500] workmad3: shlant: you do
[2014-01-07 16:27:04 -0500] AntelopeSalad: adnichols: it only showed the latest version in the knife cookbook list , but it was there hiding
[2014-01-07 16:27:09 -0500] workmad3: shlant: but you don't need to pass a path to it, it'll default to the path in /etc/chef/client.rb (which will default to something like /etc/chef/secret)
[2014-01-07 16:27:53 -0500] workmad3: shlant: you only really need to pass around secrets there if you're using multiple secrets for different data bag items
[2014-01-07 16:28:20 -0500] shlant: workmad3: what do you mean by pass around secrets?
[2014-01-07 16:28:23 -0500] AntelopeSalad: adnichols: any idea what's wrong here? rbenv says ruby 2.1.0 cannot be found https://gist.github.com/AntelopeSalad/8301806
[2014-01-07 16:28:34 -0500] workmad3: shlant: sorry, I mean you only need to pass the path to a secret file
[2014-01-07 16:28:40 -0500] AntelopeSalad: of course it's not found, it didn't install it yet heh
[2014-01-07 16:28:43 -0500] workmad3: shlant: I realise that wasn't the best phrasing I could use :)
[2014-01-07 16:28:46 -0500] ctote_: workmad3: did you have any suggestions for modifying env variables?
[2014-01-07 16:29:01 -0500] workmad3: ctote_: what OS?
[2014-01-07 16:29:26 -0500] adnichols: AntelopeSalad: you aren't calling ruby_build to install it - how is it getting installed?
[2014-01-07 16:29:37 -0500] ctote_: workmad3: windows
[2014-01-07 16:29:54 -0500] AntelopeSalad: adnichols: i followed the readme's instructions "Installs the rbenv codebase system-wide (that is, into /usr/local/rbenv) and installs rubies driven off attribute metadata"
[2014-01-07 16:30:02 -0500] workmad3: ctote_: oh, no idea there I'm afraid
[2014-01-07 16:30:04 -0500] AntelopeSalad: that is under the system recipe's readme
[2014-01-07 16:30:30 -0500] AntelopeSalad: i figured if i supplied attribute data it would actually install it
[2014-01-07 16:30:39 -0500] workmad3: ctote_: I'd guess that there is a command line tool you can run to set/modify windows environment vars, but I don't know what it is
[2014-01-07 16:31:18 -0500] shlant: workmad3: is the --secret-file option with the bootstrap command telling it where to put the key on the server, or where to find the key locally?
[2014-01-07 16:31:28 -0500] workmad3: shlant: where to find it locally
[2014-01-07 16:31:36 -0500] shlant: ok that's what I thought
[2014-01-07 16:32:02 -0500] shlant: so in my recipe I just need private_key = Chef::EncryptedDataBagItem.load_secret
[2014-01-07 16:32:03 -0500] AntelopeSalad: adnichols: the recipe seems to say it installs it too unless i'm reading the code wrong
[2014-01-07 16:32:07 -0500] shlant: no path passed
[2014-01-07 16:32:15 -0500] shlant: cause it's default
[2014-01-07 16:32:20 -0500] workmad3: shlant: yup
[2014-01-07 16:32:28 -0500] shlant: workmad3: awesome, thanks
[2014-01-07 16:33:06 -0500] workmad3: shlant: hell, you could just use Chef::EncryptedDataBagItem.load("data bag name", "item) :)
[2014-01-07 16:33:16 -0500] workmad3: (with a closing " obviously)
[2014-01-07 16:33:36 -0500] shlant: workmad3: one less line is fine with me!
[2014-01-07 16:33:48 -0500] ctote_: Thanks workmad3:  Looks like this is what I need to do:  http://stackoverflow.com/questions/3835518/can-a-script-bat-make-changes-to-windows-path-environment-variable
[2014-01-07 16:34:35 -0500] workmad3: ctote_: cool :)
[2014-01-07 16:37:22 -0500] steveb: what do i need to do to make a cookbook aware of an lwrp in another cookbook? i can use the resources from the one they are defined in, but as soon as i try to from a different one i get errors telling me "Cannot find a resource"
[2014-01-07 16:37:36 -0500] AntelopeSalad: adnichols: i tried taking a stab in the dark and included ruby_build but then chef says the cookbook cannot be found
[2014-01-07 16:43:04 -0500] juliancdunn: steveb: put the name of the other cookbook in your current cookbook's metadata as a 'depends' line
[2014-01-07 16:44:39 -0500] steveb: yeah, did that :-/
[2014-01-07 16:46:20 -0500] steveb: oh... apparently i forgot to check in the resources directory
[2014-01-07 16:46:23 -0500] steveb: i'm an idiot
[2014-01-07 16:48:59 -0500] shlant: is it better to have two separate template blocks or have one using .each and just not use a variable
[2014-01-07 16:49:08 -0500] shlant: I know food critic complains about unused variables
[2014-01-07 16:49:30 -0500] shlant: wait nm there would be no unused variable
[2014-01-07 16:58:19 -0500] adnichols: AntelopeSalad: rbenv cookbook will not install ruby w/out ruby_build - you have to include that cookbook first - and since it's another cookbook it'll need to be uploaded by berks
[2014-01-07 16:59:15 -0500] sneak: hi, i'm having trouble with test-kitchen parsing my databags - it's throwing a JSON::ParserError unexpected token then showing a valid json string (it validates)
[2014-01-07 16:59:22 -0500] sneak: anyone have any suggestions on how to fix it?
[2014-01-07 16:59:34 -0500] adnichols: sneak: would need to see the contents of the databag - sounds like there's invalid json
[2014-01-07 16:59:48 -0500] AntelopeSalad: adnichols: oh, i ended up just using the rvm cookbook
[2014-01-07 16:59:52 -0500] AntelopeSalad: everything worked without fuss
[2014-01-07 16:59:55 -0500] adnichols: AntelopeSalad: I'm sorry
[2014-01-07 17:00:01 -0500] sneak: adnichols: "jq" parses it just fine
[2014-01-07 17:00:02 -0500] adnichols: err good luck
[2014-01-07 17:00:10 -0500] AntelopeSalad: it's ok, this one seems to install ruby faster too since it doesn't compile it
[2014-01-07 17:00:16 -0500] phutchin_: Any idea why a call to https://my.server/environments/workstation/cookbook_versions would 404 ?
[2014-01-07 17:00:29 -0500] phutchin_: looks like this ist he last call ebfore my chef server pegs its cpu and hangs
[2014-01-07 17:00:38 -0500] adnichols: sneak: that's fantastic - when you can convince knife that it's wrong then you'll be all set :)
[2014-01-07 17:00:46 -0500] sneak: heh
[2014-01-07 17:01:14 -0500] sneak: oh, perhaps it wants \n instead of newlines
[2014-01-07 17:01:18 -0500] sneak: i will feed it jq's output
[2014-01-07 17:01:46 -0500] phutchin_: Logs (chef-server-webui/current) say ActionController::RoutingError (No route matches [GET] "/environments/workstation/cookbook_versions"):
[2014-01-07 17:02:09 -0500] Marcs_1: sorry for the repeat folks but :
[2014-01-07 17:02:17 -0500] Marcs_1: currently using self hosted chef server. I am having some issues with bootstrapping EC2 instances. I am using elastic IPs + proper domains names, yet chef seems to take amazons internal IP and sets that as FQDN. its causing problems everywhere. from chef-client to knife cookbook upload. googling hasnt helped a whole lot, any help would be much appreciated. thank you.
[2014-01-07 17:03:43 -0500] robawt: does anyone know if there's a set schedule for Chef training at Scale 12x?
[2014-01-07 17:03:49 -0500] robawt: i can't seem to find last years
[2014-01-07 17:04:33 -0500] sneak: adnichols: thanks for your help. turns out it won't parse newlines in a "" string in json even though it's valid. i ran it through jq and it converted them to \n and now it parses. g'day
[2014-01-07 17:04:39 -0500] robawt: ah n/m
[2014-01-07 17:04:44 -0500] robawt: it was the last day
[2014-01-07 17:08:06 -0500] juliancdunn: Marcs_1: you can set api_fqdn to the public FQDN of the Amazon instance
[2014-01-07 17:08:18 -0500] juliancdunn: in chef-server.rb that is
[2014-01-07 17:08:39 -0500] mr_t_: hi
[2014-01-07 17:09:04 -0500] Marcs_1: juliancdunn: thank you checking that now
[2014-01-07 17:10:21 -0500] juliancdunn: Marcs_1: also, set bookshelf['vip'] to the same
[2014-01-07 17:10:30 -0500] juliancdunn: otherwise it'll take on the internal FQDN of the box
[2014-01-07 17:11:15 -0500] juliancdunn: http://docs.opscode.com/config_rb_chef_server.html
[2014-01-07 17:13:15 -0500] Marcs_1: juliancdunn: thank you reading that now
[2014-01-07 17:18:22 -0500] zxd: how does the package resource work on macOSX?
[2014-01-07 17:18:49 -0500] jslusher: can anyone tell me where I could find information on how to add keys and values to query from chef search?
[2014-01-07 17:20:22 -0500] jslusher: I want to be able to have the chef server know what the instance's IP is in a way that I can reference it in a recipe
[2014-01-07 17:21:01 -0500] jslusher: not having very much luck figuring it out searching google
[2014-01-07 17:23:22 -0500] zxd: is it possible to add a dependency to a cookbook only if platform family matches mac_os
[2014-01-07 17:24:08 -0500] JayF: no :(
[2014-01-07 17:26:56 -0500] ichag: could this work with something like this: if node['plattform'] == "mac" do include_recipe 'xy'
[2014-01-07 17:29:22 -0500] zxd: maybe yea
[2014-01-07 17:31:28 -0500] ichag: try it, let me know
[2014-01-07 17:33:02 -0500] zxd: ok
[2014-01-07 17:47:54 -0500] juliancdunn: zxd: I think it uses macports if you have it installed
[2014-01-07 17:48:06 -0500] juliancdunn: since Macs don't have a "real" package manager
[2014-01-07 17:49:39 -0500] thun_: I just downloaded postfix cookbook from the site. No modifications at all, when I go to knife cookbook upload I get this error...
[2014-01-07 17:49:53 -0500] thun_: http://pastebin.com/rJghy8xv
[2014-01-07 17:51:33 -0500] c_t: ohai chefs
[2014-01-07 17:53:32 -0500] allaire: When I try to overwrite this attribute: https://github.com/opscode-cookbooks/nginx/blob/master/attributes/default.rb#L26 in a wrapper cookbook, it never works, because the attribute is used in other attributes (see https://github.com/opscode-cookbooks/nginx/blob/master/attributes/source.rb#L35). Then I need to redefine in my wrapper attributes file every attributes that use the version attribute. BUT, when I only change the
[2014-01-07 17:53:33 -0500] allaire:  version number in a default_attributes in a role, it works. I understand there's atributes precedence, but I struggle to see how it's applied in this case
[2014-01-07 17:53:42 -0500] juliancdunn: thun_: are you running an end-of-life Ruby?
[2014-01-07 17:55:18 -0500] workmad3: allaire: that's less to do with attribute precedence and more to do with that attribute files are loaded and evaluated before the recipe
[2014-01-07 17:55:52 -0500] allaire: workmad3: but roles are loaded before atribute files?
[2014-01-07 17:56:01 -0500] allaire: hence that's why it works when I overwrite it in my role?
[2014-01-07 17:56:04 -0500] c_t: juliancdunn: before I forget all about it, did you ever see the ohai output from debian/390?
[2014-01-07 17:56:32 -0500] bettyclamp: (newbie): I've set up a chef server on a private host. What's the best way to get a minimal chef repo to put into git?
[2014-01-07 17:56:48 -0500] allaire: bettyclamp: https://github.com/opscode/chef-repo
[2014-01-07 17:56:51 -0500] allaire: clone this
[2014-01-07 17:57:08 -0500] allaire: or just download it and `git init` it :)
[2014-01-07 17:57:40 -0500] bettyclamp: allaire: thanks. Another newbie question: is knife supposed to be run from just one machine, or can the several team members run it from their several private laptops?
[2014-01-07 17:58:03 -0500] juliancdunn: c_t: yeah, that was awesome
[2014-01-07 17:58:05 -0500] allaire: bettyclamp: knife is supposed to be used on workstations. Every chef has a workstation on his laptop
[2014-01-07 17:58:20 -0500] allaire: so yeah, no problem in using knife on multiple machines
[2014-01-07 17:58:39 -0500] c_t: juliancdunn: of course it looks an awful lot like normal ohai output, with some weird s390 hardware mixed in
[2014-01-07 17:59:04 -0500] c_t: (iirc references to ctcX and dasdX)
[2014-01-07 17:59:23 -0500] bettyclamp: (I asked because I thought knife.rb, which has a 'node' attribute', would have to be part of the repo. Pls disregard.)
[2014-01-07 17:59:27 -0500] allaire: workmad3: Do you have any docs about loading order in Chef?
[2014-01-07 18:00:01 -0500] workmad3: allaire: not handy, no
[2014-01-07 18:00:13 -0500] juliancdunn: c_t: yeah, i was hoping for some indication that it was running a 31-bit kernel, or maybe a /dev/punchcard0 or something :-P
[2014-01-07 18:00:39 -0500] workmad3: juliancdunn: man... I now want to build a 31 bit machine :D
[2014-01-07 18:00:47 -0500] c_t: workmad3: you can!
[2014-01-07 18:00:57 -0500] allaire: workmad3: Do you know then the order then?
[2014-01-07 18:01:11 -0500] allaire: of what is loaded before what
[2014-01-07 18:01:28 -0500] workmad3: allaire: I think it's libraries, then some order of [attributes, roles, databags, ...] with recipes last
[2014-01-07 18:01:56 -0500] c_t: juliancdunn: once the initial novelty wears off, linux on s390/z/Arch is awfully similar to Linux on any other platform
[2014-01-07 18:02:32 -0500] c_t: however, I've noticed it's a handy way to test if your code is clean for endianness
[2014-01-07 18:04:55 -0500] allaire: workmad3: So, there is no really anyway to overwrite the version attribute in a wrapper-cookbook without redefining every attributes it uses the version attr?
[2014-01-07 18:05:23 -0500] thun_: juliancdunn: Yes 1.8.7 ... what should I minimally run?
[2014-01-07 18:05:46 -0500] allaire: thun_: at least 1.9 :)
[2014-01-07 18:06:10 -0500] nebrera2: helllo
[2014-01-07 18:06:21 -0500] c_t: also for anyone interested, goiardi can save its data and indexes to disk
[2014-01-07 18:06:25 -0500] c_t: so, persistence!
[2014-01-07 18:06:31 -0500] nebrera2: can I upload a binary file into data bag and distribute to the chef-client ?
[2014-01-07 18:06:44 -0500] c_t: that's not how I would do it
[2014-01-07 18:07:07 -0500] allaire: thun_: http://docs.opscode.com/chef_system_requirements.html
[2014-01-07 18:07:23 -0500] allaire: 1.8.7 will be deprecated, and many cookbooks don't support it anymore
[2014-01-07 18:08:01 -0500] workmad3: allaire: you could set the version in wrapper-cookbook/attributes/default.rb and include_attribute "wrapped-cookbook" after you've set it
[2014-01-07 18:08:39 -0500] allaire: workmad3: Ok, cause right now, somehow, the wrapped-cookbooks is loaded before
[2014-01-07 18:08:42 -0500] workmad3: allaire: if my guess is correct, that will (fingers crossed) cause a re-evaluation of the wrapped cookbooks attributes after your wrapper has set the version, causing the updates to be propagated
[2014-01-07 18:09:05 -0500] workmad3: allaire: yeah, all load orders are now done using topographic sorting, so dependencies are loaded first
[2014-01-07 18:09:16 -0500] workmad3: topographic??? topological...
[2014-01-07 18:10:24 -0500] allaire: workmad3: Roger that
[2014-01-07 18:10:44 -0500] allaire: workmad3: Now i'm wondering if I should do that for every wrapped-cookbooks I did :)
[2014-01-07 18:11:06 -0500] allaire: some people always overwrite directly in wrapped-cookbooks recipes instead of attributes files
[2014-01-07 18:11:16 -0500] allaire: is it to avoid this?
[2014-01-07 18:12:47 -0500] workmad3: allaire: personally, I dislike supposedly 'library' cookbooks that rely overly much on attributes
[2014-01-07 18:13:54 -0500] workmad3: allaire: I'd rather have a set of resources that let me control where my data is coming from (searches, databags, attributes,...)
[2014-01-07 18:15:26 -0500] AntelopeSalad: hey workmad3
[2014-01-07 18:15:43 -0500] AntelopeSalad: when you used nichol's rvm book to install bundler, does it install 1.5.0 for you by default?
[2014-01-07 18:16:07 -0500] AntelopeSalad: i noticed it uses 1.5.0 if you do not supply a version number, but it will install 1.5.1 if you ask for it specifically
[2014-01-07 18:20:08 -0500] savant: hi all
[2014-01-07 18:20:26 -0500] savant: i've been waiting on a pr to be merged on the mysql cookbook for 2 weeks now
[2014-01-07 18:20:41 -0500] savant: is there a way I can get this merged on the next merge window?
[2014-01-07 18:20:48 -0500] savant: re: https://github.com/opscode-cookbooks/mysql/pull/147
[2014-01-07 18:21:20 -0500] savant: Fixes 7 related and semi-duplicative cook issues
[2014-01-07 18:22:01 -0500] savant: hell i'd even be happy with helping with the merge of the other pull requests
[2014-01-07 18:22:29 -0500] workmad3: AntelopeSalad: it's been quite a while since I used that tbh
[2014-01-07 18:23:09 -0500] AntelopeSalad: oh
[2014-01-07 18:23:22 -0500] AntelopeSalad: it's not a big deal, i just wanted to see if you had the same thing happen
[2014-01-07 18:23:51 -0500] allaire: when u use rbenv or rvm in production, do you define a global version with it, or stick with the system's default, and use .ruby-version file?
[2014-01-07 18:23:56 -0500] allaire: cc: AntelopeSalad  & workmad3
[2014-01-07 18:24:37 -0500] lazypower: allaire, i leave the system ruby untouched and use .ruby-version for my deployments
[2014-01-07 18:24:58 -0500] allaire: lazypower: Yeah, I'll probably do that now
[2014-01-07 18:25:14 -0500] allaire: lazypower: otherwise it hijack gem_package with the rbenv version
[2014-01-07 18:25:19 -0500] lazypower: mhmm
[2014-01-07 18:25:25 -0500] workmad3: allaire: most of the time when I need ruby on a production server, it's for web apps, where I'll generally specify the ruby to use via the path to the runtime and control over a runit service's env vars
[2014-01-07 18:29:34 -0500] shlant: am I passing variables into template wrong?
[2014-01-07 18:29:44 -0500] shlant: variables({:git_private => git_private})
[2014-01-07 18:30:31 -0500] shlant: "undefined method `git_private' for Chef::Resource::Template"
[2014-01-07 18:30:49 -0500] allaire: workmad3: but you leave the system version default right?
[2014-01-07 18:31:17 -0500] allaire: workmad3: using include_attribute didn't work unfortunatly :(
[2014-01-07 18:31:19 -0500] savant: variables(
[2014-01-07 18:31:20 -0500] savant:   :git_private => git_private
[2014-01-07 18:31:20 -0500] savant: )
[2014-01-07 18:31:20 -0500] savant: thats what I normally do
[2014-01-07 18:32:44 -0500] shlant: savant: same thing...
[2014-01-07 18:35:04 -0500] phutchin2: Anyone know more about this: http://lists.opscode.com/sympa/arc/chef/2013-07/msg00372.html
[2014-01-07 18:35:16 -0500] phutchin2: chef server timeouts and 100% cpu load on chef server ?
[2014-01-07 18:35:32 -0500] phutchin2: seems the cause is a cookbook or dependency that isn't being found? but not logging it and then the chef-client never dies
[2014-01-07 18:35:58 -0500] phutchin2: the resolve was to delete all cookbooks and add them back making sure no older versions were being called or something
[2014-01-07 18:36:03 -0500] phutchin2: and that doesn't seem like a good solution
[2014-01-07 18:36:11 -0500] phutchin2: i'm in 11.6 so i thought it woudl be fixed there
[2014-01-07 18:36:11 -0500] shlant: savant: nm I named the same variable differently elsewhere
[2014-01-07 18:42:01 -0500] Dan_TheAdmin: hello again!
[2014-01-07 18:42:15 -0500] jblack: Me?
[2014-01-07 18:42:17 -0500] Dan_TheAdmin: so last night @coderanger helped me out with this
[2014-01-07 18:42:34 -0500] Dan_TheAdmin: Here's the spaghetti
[2014-01-07 18:42:36 -0500] sbrink: hello
[2014-01-07 18:42:59 -0500] Dan_TheAdmin: bash 'remove_from_cache' do
[2014-01-07 18:43:00 -0500] Dan_TheAdmin: user "admin"
[2014-01-07 18:43:00 -0500] Dan_TheAdmin:   code search(:node, 'tags:varnish').map{|n| "ssh #{n['hostname']} sudo varnishadm backend.set_health #{node['hostname']} sick;"}.join("/n")
[2014-01-07 18:43:01 -0500] Dan_TheAdmin: end
[2014-01-07 18:43:20 -0500] Dan_TheAdmin: the goal is, as part of a deploy chef-run to remove the current appserver from varnish
[2014-01-07 18:44:07 -0500] Dan_TheAdmin: When I placed "echo" in front of the codeblock and ">>test.txt" the output was correct
[2014-01-07 18:44:56 -0500] Dan_TheAdmin: (ssh cache1 sudo varnishadm backend.set_health app1 sick;/n ssh cache2 sudo varnishadm backend.set_health app1)
[2014-01-07 18:45:17 -0500] Dan_TheAdmin: (with /n being represented with a line break in test.txt)
[2014-01-07 18:45:18 -0500] jblack: ugh  gem list shows chef  as being installed.
[2014-01-07 18:45:52 -0500] Dan_TheAdmin: (and sick after app1, typo on my part, sorry)
[2014-01-07 18:46:03 -0500] jblack: never mind, seems a bunch of gems are acting up
[2014-01-07 18:46:22 -0500] sbrink: Encoding::UndefinedConversionError error occuring in a vagrant chef-solo centos run but not during a "real" rhel running using chef-client
[2014-01-07 18:46:25 -0500] sbrink: same recipe
[2014-01-07 18:46:27 -0500] Dan_TheAdmin: the problem is, when I just run it without the "echo" and ">>file.txt" the ssh command does not run successfully.
[2014-01-07 18:48:24 -0500] Dan_TheAdmin: Mixlib::ShellOut::ShellCommandFailed: bash[remove_from_cache] (appserver::deploy line 59) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '127'
[2014-01-07 18:48:58 -0500] coderanger: Dan_TheAdmin: Run chef-client with `-l debug` to set the log level to debug
[2014-01-07 18:49:01 -0500] coderanger: it should show the process output
[2014-01-07 18:49:18 -0500] Dan_TheAdmin: willco
[2014-01-07 18:49:18 -0500] SFLimey: I'm looking for a chef consultant for a four to five day consulting gig. Is there a good place to look for someone that anyone knows of?
[2014-01-07 18:50:47 -0500] jblack: Bleh, ruby 1.8.7... need to include rubygems... :P
[2014-01-07 18:51:29 -0500] cheeseplus: SFLimey: http://www.getchef.com/services/
[2014-01-07 18:52:01 -0500] Dan_TheAdmin: hmm
[2014-01-07 18:52:10 -0500] Dan_TheAdmin: [2014-01-07T10:50:53-08:00] ERROR: bash[remove_from_cache] (appserver::deploy line 59) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '255'
[2014-01-07 18:52:10 -0500] Dan_TheAdmin: ---- Begin output of "bash"  "/tmp/chef-script20140107-29436-nrr5ur" ----
[2014-01-07 18:52:11 -0500] Dan_TheAdmin: STDOUT:
[2014-01-07 18:52:12 -0500] Dan_TheAdmin: STDERR: Host key verification failed.
[2014-01-07 18:52:14 -0500] Dan_TheAdmin: ---- End output of "bash"  "/tmp/chef-script20140107-29436-nrr5ur" ----
[2014-01-07 18:52:16 -0500] Dan_TheAdmin: Ran "bash"  "/tmp/chef-script20140107-29436-nrr5ur" returned 255
[2014-01-07 18:52:18 -0500] Dan_TheAdmin: [2014-01-07T10:50:53-08:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
[2014-01-07 18:52:23 -0500] Dan_TheAdmin: Host key verification failed?
[2014-01-07 18:52:25 -0500] coderanger: Dan_TheAdmin: please use a pastebin next time
[2014-01-07 18:52:32 -0500] coderanger: Dan_TheAdmin: And yeah, your SSH command is failing
[2014-01-07 18:52:35 -0500] Dan_TheAdmin: will do. Sorry.
[2014-01-07 18:52:56 -0500] Dan_TheAdmin: I have an id_rsa matching an id_rsa.pub on the cache server.
[2014-01-07 18:53:10 -0500] Dan_TheAdmin: where is this ssh session originating?
[2014-01-07 18:53:15 -0500] coderanger: Dan_TheAdmin: No, host key is what is used to identify the server, not the client
[2014-01-07 18:53:47 -0500] Dan_TheAdmin: ? as in known_hosts?
[2014-01-07 18:53:57 -0500] Dan_TheAdmin: I can ssh from app1 to cache1 from the admin account.
[2014-01-07 18:54:40 -0500] Dan_TheAdmin: and I can ssh from the chef-workstation to either.
[2014-01-07 18:56:29 -0500] adnichols: Dan_TheAdmin:  what is your base[remove_from_cache] resource doing? Running ssh?
[2014-01-07 18:56:38 -0500] adnichols: err bash[remove_from_cache]
[2014-01-07 18:57:05 -0500] adnichols: It's that resource execution that's getting a host verification error
[2014-01-07 18:57:43 -0500] Dan_TheAdmin: http://pastebin.com/CiKNgu8d
[2014-01-07 18:58:11 -0500] adnichols: so, where is that sshing from/to? that'll tell you what's not working
[2014-01-07 18:58:22 -0500] adnichols: it's an ssh problem
[2014-01-07 18:58:37 -0500] Dan_TheAdmin: I want it to run a search for varnish servers, and remove the deploy node from the varnish boxes before deploying new code.
[2014-01-07 18:58:51 -0500] Dan_TheAdmin: As I understand it, the ssh session should be running from the app server
[2014-01-07 18:58:57 -0500] adnichols: ok, so whatever node you are converging on , it's trying to ssh to other nodes & getting a host verification error
[2014-01-07 18:59:31 -0500] Dan_TheAdmin: I think that's correct. When I log into an appserver using the 'admin' account though,
[2014-01-07 18:59:39 -0500] Dan_TheAdmin: I can ssh to the cache server with no issue
[2014-01-07 18:59:52 -0500] adnichols: then you aren't reproducting the problem correctly
[2014-01-07 19:00:33 -0500] helfire: hii keep getting a undefined method []= when i try to mock a node attribute in chefspec with fauxhai: Fauxhai.mock(platform: 'redhat', version: '6.3') do |node|                node['cpu']['total'] = 1
[2014-01-07 19:00:40 -0500] adnichols: not sure what is different
[2014-01-07 19:00:51 -0500] Dan_TheAdmin: I dont get it either.
[2014-01-07 19:01:57 -0500] Lunar_Lamp: 5/win 6
[2014-01-07 19:03:22 -0500] sbrink: hello, i need an idea as to why i'd be getting a utf8 conversion error on a vagrant box running chef-solo doing a remote_file on an rpm and not get that issue in "real-life" using chef-client
[2014-01-07 19:08:16 -0500] sparr: on a linux chef client, where are cookbooks and recipes cached?
[2014-01-07 19:08:28 -0500] sparr: I want to make sure that some changes I'm making on my server are being properly replicated
[2014-01-07 19:09:02 -0500] Dan_TheAdmin: sparr: We use github.
[2014-01-07 19:09:12 -0500] Dan_TheAdmin: I recommend it as a backup.
[2014-01-07 19:09:24 -0500] Dan_TheAdmin: the knife cookbook upload command puts them on your chef server
[2014-01-07 19:09:36 -0500] Dan_TheAdmin: but github has MUCH better revision control
[2014-01-07 19:09:39 -0500] sparr: right
[2014-01-07 19:09:43 -0500] sparr: I mean, when a chef client runs
[2014-01-07 19:09:45 -0500] Dan_TheAdmin: my $0.02
[2014-01-07 19:09:48 -0500] sparr: it downloads the recipes from the server
[2014-01-07 19:09:54 -0500] sparr: where does the client keep them, at that point?
[2014-01-07 19:09:59 -0500] Dan_TheAdmin: in temp files
[2014-01-07 19:10:06 -0500] Dan_TheAdmin: that get deleted after the chef run
[2014-01-07 19:10:19 -0500] sparr: aha, found it
[2014-01-07 19:10:25 -0500] sparr: it seems to be in /var/chef/cache/
[2014-01-07 19:11:03 -0500] shlant: should I put my ssh wrapper as a node attribute or as a template? is one better?
[2014-01-07 19:11:28 -0500] Dan_TheAdmin: a lot of mine get dropped into folders like /tmp/chef-script<timestamp/...
[2014-01-07 19:11:40 -0500] shlant: so use a template?
[2014-01-07 19:11:49 -0500] shlant: or sorry worng convo
[2014-01-07 19:12:12 -0500] sparr: ok, so now I've found my problem
[2014-01-07 19:12:16 -0500] sparr: my changes aren't being replicated
[2014-01-07 19:12:29 -0500] josephholsten: shlant: node attribute sounds awefuly painful, are you planning on having it be different for each node?
[2014-01-07 19:12:30 -0500] Dan_TheAdmin: forgot to knife cookbook upload <cookbook name>?
[2014-01-07 19:12:36 -0500] sparr: no, I did that
[2014-01-07 19:12:42 -0500] sparr: and I bumped the version number in metadata.rb
[2014-01-07 19:12:46 -0500] sparr: and OTHER changes are working
[2014-01-07 19:12:50 -0500] sparr: just not changes to libraries/
[2014-01-07 19:13:07 -0500] shlant: josephholsten: not sure, I was asking cause I've seen both ways
[2014-01-07 19:13:22 -0500] josephholsten: sparr: do you have cookbook versions pinned in either your environment or cookbook dependencies?
[2014-01-07 19:13:23 -0500] shlant: I guess attributes uses less code, but I could see the problem
[2014-01-07 19:13:34 -0500] Dan_TheAdmin: that's weird. I'm new at this, so I'm not sure I can be of help with that particular rabbit hole.
[2014-01-07 19:13:35 -0500] sparr: josephholsten: I do not, and other changes in the new cookbook version are working
[2014-01-07 19:13:36 -0500] Dan_TheAdmin: sorry.
[2014-01-07 19:13:38 -0500] Dan_TheAdmin: :(
[2014-01-07 19:14:04 -0500] sparr: I just deleted the cache and it's working now
[2014-01-07 19:14:04 -0500] josephholsten: sparr: ohh, that's strange. you can verify that the libraries content on the chef-server is correct?
[2014-01-07 19:14:15 -0500] josephholsten: palm -> face
[2014-01-07 19:14:25 -0500] sparr: after deleting the cache the new libraries got downloaded
[2014-01-07 19:14:35 -0500] sparr: but I need to figure out what was stopping them from getting downloaded previously
[2014-01-07 19:14:37 -0500] josephholsten: that's not itdeal
[2014-01-07 19:14:44 -0500] sparr: (I have other nodes that are still exhibiting this misbehavior)
[2014-01-07 19:15:12 -0500] josephholsten: shlant: I would default to templates, and only pull it into a configurable attribute when you need it
[2014-01-07 19:15:37 -0500] shlant: josephholsten: makes sense.
[2014-01-07 19:16:03 -0500] josephholsten: sparr: on one of those other nodes, can you go into /var/chef/cache/cookbooks (or your equiv) and verify the contents of the cookbook are correct?
[2014-01-07 19:17:04 -0500] shlant: josephholsten: would you put temporary scripts into /tmp or Chef::Config[:file_cache_path]?
[2014-01-07 19:17:40 -0500] josephholsten: shlant: I wouldn't use temporary scripts, but if I did I'd put them in Chef::Config[:file_cache_path]
[2014-01-07 19:17:59 -0500] gleam: you can use the bash resource instead of a temporary script
[2014-01-07 19:18:05 -0500] gleam: although i guess if it's huge..
[2014-01-07 19:18:07 -0500] josephholsten: if it was a really temporary script, I'd use a bash/powershell/ruby resource
[2014-01-07 19:18:42 -0500] josephholsten: but I really try to keep my scripts in /usr/local/bin, document them, &c
[2014-01-07 19:18:47 -0500] sparr: josephholsten: I did that on this node. It was not correct. The change to the library was missing. OTHER changes to the cookbook had been correctly cached, though.
[2014-01-07 19:19:09 -0500] josephholsten: sparr: what version of chef-client are you using?
[2014-01-07 19:19:53 -0500] sparr: 11.4.4
[2014-01-07 19:21:05 -0500] josephholsten: are your library files in a subdirectory of libraries?
[2014-01-07 19:22:07 -0500] josephholsten: as in my-cookbook/libraries/sub/lib.rb
[2014-01-07 19:22:12 -0500] sparr: no
[2014-01-07 19:22:17 -0500] sparr: directly in libraries/
[2014-01-07 19:22:29 -0500] josephholsten: aww, thought it might be CHEF-672
[2014-01-07 19:23:12 -0500] sparr: cookbooks/sma_node/libraries/ifconfig_provider.rb
[2014-01-07 19:23:12 -0500] sparr: cookbooks/sma_node/libraries/ifconfig_resource.rb
[2014-01-07 19:24:45 -0500] josephholsten: are you running the chef-client as a daemon?
[2014-01-07 19:25:32 -0500] josephholsten: as in /etc/init.d/chef-client
[2014-01-07 19:27:43 -0500] sparr: yes
[2014-01-07 19:28:52 -0500] josephholsten: could you restart the service? does it act properly?
[2014-01-07 19:29:11 -0500] josephholsten: (this is CHEF-1027)
[2014-01-07 19:34:55 -0500] sparr: I'll try that
[2014-01-07 19:34:57 -0500] sparr: will be a short while
[2014-01-07 19:34:59 -0500] sparr: thanks for the help
[2014-01-07 19:36:06 -0500] sbrink: Hello?
[2014-01-07 19:36:21 -0500] jpoole: pong!
[2014-01-07 19:36:41 -0500] sbrink: thanks wasn't sure if my posts were coming through
[2014-01-07 19:36:47 -0500] jpoole: :)
[2014-01-07 19:38:01 -0500] sbrink: is this the correct irc to ask about issuues between a chef-solo run vs a chef-client run?
[2014-01-07 19:38:09 -0500] jpoole: ask and find out!
[2014-01-07 19:38:53 -0500] sbrink: hello, i need an idea as to why i'd be getting a utf8 conversion error on a vagrant box running chef-solo doing a remote_file on an rpm and not get that issue in "real-life" using chef-client
[2014-01-07 19:40:37 -0500] jpoole: sounds like a locale issue
[2014-01-07 19:40:40 -0500] jpoole: in vagrant
[2014-01-07 19:41:00 -0500] jpoole: vagrant ubuntu base box?
[2014-01-07 19:41:46 -0500] jpoole: when you ssh into your vagrant box, do you get the warning: setlocale: LC_ALL: cannot change locale?
[2014-01-07 19:43:07 -0500] sbrink: vagrant centos
[2014-01-07 19:43:11 -0500] sbrink: 6
[2014-01-07 19:43:24 -0500] sbrink: 6.4 and the locale is correct
[2014-01-07 19:43:40 -0500] sbrink: i'll check the setlocale to verify
[2014-01-07 19:44:35 -0500] jleveque: Hello, we are having an issue which seems similar to CHEF-3921,  erchef takes all CPU and everything is slow, and sometime just unresponsive and we have to restart erchef to get chef running again, it works fine for a few minutes, then erchef takes all CPU again.
[2014-01-07 19:45:41 -0500] jleveque: Looking at the zabbix history I did correlate the CPU increase to a specific git push, but I do not understand clealy  the stuff mentionned in CHEF-3921
[2014-01-07 19:45:51 -0500] jleveque: could you help me diagnose the problem ?
[2014-01-07 19:46:43 -0500] jleveque: the change is mainly changing an environment constraint from "=" to "~>"
[2014-01-07 19:47:06 -0500] sbrink: we had a similar issue when pinning
[2014-01-07 19:47:32 -0500] sbrink: the regex tries to use  something that doesn't resolve
[2014-01-07 19:47:41 -0500] sbrink: to what is on the chef server
[2014-01-07 19:48:00 -0500] jleveque: sbrink, by regex you mean the "~>" ?
[2014-01-07 19:48:05 -0500] sbrink: yes
[2014-01-07 19:48:57 -0500] jleveque: do you have more precision ? maybe a chef incident number ?
[2014-01-07 19:49:09 -0500] sbrink: we had to either reset the constraint to be = or remove it
[2014-01-07 19:49:09 -0500] jleveque: cos ~> was use elsewhere with no problem
[2014-01-07 19:49:17 -0500] sfalcon: jleveque: changing a constraint to use "~>" is consistent with the issues we've seen with the depsolver that is shipped in the current OSC server release.
[2014-01-07 19:49:30 -0500] sbrink: ok
[2014-01-07 19:49:51 -0500] jleveque: sfalcon, so you recommend removing all "~>" ?
[2014-01-07 19:50:32 -0500] jleveque: yesterday you told me to run a api.post("environments/env/cookbook_versions", {:run_list => ["cookbookname"]})
[2014-01-07 19:50:54 -0500] jleveque: it returns a big json that I do not know how to use to diagnose the problem
[2014-01-07 19:52:22 -0500] mikeg: is this a good place for knife vsphere questions?  or does anyone know of a channel that does?
[2014-01-07 19:53:06 -0500] jleveque: must there be a dependency to a cookbook version which is not on the chef server bookshelf  ? or can  it be  something else?
[2014-01-07 19:53:35 -0500] sbrink: jleveque, that is what happened to us
[2014-01-07 19:54:02 -0500] sbrink: we might have had one more scenario, ... i'm asking
[2014-01-07 19:55:14 -0500] sfalcon: jleveque: the "~>" constraint was in the cookbook or in your environment? Either way, with the depsolver you are using, you want to equality pin as much as possible. Would generally recommend equality pin in environment as the way to go in general.
[2014-01-07 19:55:17 -0500] jslusher: anyone know how I would make a reference to an ec2 tag in a chef recipe?
[2014-01-07 19:55:50 -0500] jslusher: I looked up the was recipe, but it seems to be able to create tags, but this tag is already created
[2014-01-07 19:56:14 -0500] jslusher: when knife launches an instance, it creates the 'Name:' tag
[2014-01-07 19:56:24 -0500] jslusher: how would I reference that in a recipe?
[2014-01-07 19:57:52 -0500] sbrink: search(:node, tag.
[2014-01-07 19:58:36 -0500] shlant: can anyone see anything song with my ssh wrapper? It's really frustrating me. Such a hacky fix
[2014-01-07 19:58:45 -0500] shlant: exec ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i "/home/user/.ssh/id_rsa" "$@"
[2014-01-07 19:59:39 -0500] gchristensen: shlant: what issue are you experiencing?
[2014-01-07 19:59:54 -0500] shlant: it still prompts for passkey
[2014-01-07 20:00:18 -0500] shlant: I have the ssh_wrapper in the file_cache with the right permissions
[2014-01-07 20:00:33 -0500] shlant: it is set for the gti resource
[2014-01-07 20:00:35 -0500] shlant: git*
[2014-01-07 20:01:09 -0500] jleveque: sfalcon, there were  "~>" constraint added both in the cookbook and in the  environment
[2014-01-07 20:02:24 -0500] sbrink: jleveque we hit the issue 2 ways
[2014-01-07 20:02:47 -0500] sbrink: one where the environment is pinned at one revision and the recipe at another
[2014-01-07 20:03:23 -0500] sbrink: i.e the environment was pinned at 1.4 and the recipe was ~> to 1.3.
[2014-01-07 20:03:24 -0500] jleveque: the ops guys do not want to revert to using = , they prefer ~> which is easier to manage , So I'd like to find the root cause rather than reverting to = everywhere
[2014-01-07 20:04:45 -0500] sbrink: our other was when the environment pinned to an unused recipe and we did house cleaning and removed the recipe, ... an example recipe was loaded in to the kitchen and the example version got pinned in the environment so we removed the example from the kitchen
[2014-01-07 20:04:46 -0500] jhunter: silly q, but is there a way to enforce strict ordering wrt operations?
[2014-01-07 20:04:51 -0500] shlant: gchristensen: I tried throwing this into a ssh config and it didn't work either: Host *\n  UserKnownHostsFile=/dev/null\n  StrictHostKeyChecking no\n
[2014-01-07 20:05:17 -0500] jhunter: i need a git checkout to occur before i do an operation, and it looks like the operation is getting called before the git checkout
[2014-01-07 20:06:18 -0500] adnichols: jhunter: code example in pastebin? it should be ordered based on the order of resources in the recipe
[2014-01-07 20:06:19 -0500] sbrink: jhunter you can force the git checkout to happen just by doing a `git .... blah` in the start of the recipe as that will happen at compile time and not convergence
[2014-01-07 20:07:10 -0500] sbrink: sorry adnichols
[2014-01-07 20:07:28 -0500] adnichols: sbrink: for? two answers are better than one :)
[2014-01-07 20:07:33 -0500] workmad3: sbrink: or, slightly more chef-ey, you can do 'git "name" do <normal definition>; action :nothing; end.run_action(:sync)'
[2014-01-07 20:07:43 -0500] jhunter: well the git checkout occurs on say, line 20, and the library call gets called as the final command in the recipe
[2014-01-07 20:07:49 -0500] jleveque: I realize now that in the envinoment there is a cookbook = 0.1.8  ( a version 0.1.9 exists) and in the cookbook metadata the dependecy to the same cookbook is "~> 0.1"
[2014-01-07 20:08:05 -0500] adnichols: jhunter: is the 'library call' a chef resource?
[2014-01-07 20:08:08 -0500] sbrink: jleveque, yes that is what cooked us
[2014-01-07 20:08:09 -0500] workmad3: jhunter: is the library call wrapped up in a chef resource?
[2014-01-07 20:08:14 -0500] jhunter: heh.. checking
[2014-01-07 20:08:16 -0500] jhunter: thx
[2014-01-07 20:08:16 -0500] jleveque: sbrink, thanks a lot
[2014-01-07 20:08:36 -0500] jhunter: it's in the libraried recipe, and is wrapped in
[2014-01-07 20:08:37 -0500] jhunter: class Chef::Recipe
[2014-01-07 20:08:54 -0500] jhunter: er it's in the libraries directory*
[2014-01-07 20:08:55 -0500] helfire: is there a way for chefspec to dump what the template is creating? render_file and create_tempalte say the resource is being created, but i cant match any content that should be there
[2014-01-07 20:09:22 -0500] workmad3: helfire: render_file allows you to chain on matchers with content regexs
[2014-01-07 20:10:09 -0500] workmad3: helfire: e.g. expect(chef_run).to render_file("/foo/bar").with_content("buzz")
[2014-01-07 20:11:15 -0500] helfire: workmad3: sure, but i have a '#' character as the first char, but .with_content("#") fails
[2014-01-07 20:11:16 -0500] shlant: do encrypted data bag items show up in plain text on the server?
[2014-01-07 20:11:24 -0500] shlant: or does it have a data bag reference in the file
[2014-01-07 20:11:44 -0500] workmad3: helfire: sounds like you should be using a regex at that point
[2014-01-07 20:11:47 -0500] sbrink: shlant what server
[2014-01-07 20:11:58 -0500] shlant: on the node
[2014-01-07 20:12:02 -0500] adnichols: shlant: the data comes from the server in encrypted form and the node decrypts it - where are you worried about it 'showing up'?
[2014-01-07 20:12:27 -0500] adnichols: shlant: if a resource converge fails and the encrypted value is assigned to an attribute - it'll probably show up in the trace
[2014-01-07 20:12:27 -0500] shlant: adnichols: no I'm trying to troubleshoot this ssh issue
[2014-01-07 20:12:28 -0500] workmad3: shlant: it's only available in cleartext once you've loaded the data bag item with the secret
[2014-01-07 20:12:40 -0500] helfire: workmad3: why? i just want it to match anything at this point. When i use .with_content it never matches anything i have statically set in the file
[2014-01-07 20:13:12 -0500] workmad3: helfire: iirc, .with_content("some string") does a match against the entire file content, expecting it to be the string
[2014-01-07 20:13:33 -0500] workmad3: helfire: so if you're doing .with_content("#") and there's more than just a single # in the file, the matcher will fail
[2014-01-07 20:13:53 -0500] helfire: hmm
[2014-01-07 20:14:15 -0500] jslusher: sbrink: I tried that, but this would be a tag in EC2 and not something the chef server knows about, unless I'm misunderstanding something. at any rate, when I try this:
[2014-01-07 20:14:16 -0500] jslusher: search(:node, "tag:*")
[2014-01-07 20:14:51 -0500] workmad3: helfire: see if it still fails when you do .with_content(/#/) ;)
[2014-01-07 20:15:56 -0500] jslusher: sbrink: comes back with a few items, but none of them are the name of the instance on which I run the recipe
[2014-01-07 20:16:11 -0500] fak3r: so we're failing to add an apt-repo for ubuntu, chef-client fails w/"(/var/chef/cache/cookbooks/apt/providers/repository.rb line 28) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '2'"
[2014-01-07 20:18:02 -0500] workmad3: jslusher: are you using any form of ec2 ohai plugin?
[2014-01-07 20:18:26 -0500] jslusher: workmad3: I use knife ec2 to launch the instance
[2014-01-07 20:18:43 -0500] workmad3: jslusher: that's a knife plugin, not an ohai plugin
[2014-01-07 20:18:45 -0500] jslusher: I specify the Name tag upon creation of the instance
[2014-01-07 20:19:12 -0500] jslusher: oh. I didn't see an ohai plugin for ec2 in the documentation I was reading
[2014-01-07 20:19:28 -0500] helfire: workmad3:   1) openresty-wrapper::default installs with one context
[2014-01-07 20:19:28 -0500] helfire:      Failure/Error: expect(chef_run).to create_template("/etc/nginx/sites-available/default.conf").with_content(/#/)
[2014-01-07 20:19:29 -0500] helfire:        expected "template[/etc/nginx/sites-available/default.conf]" to have parameters:
[2014-01-07 20:19:29 -0500] helfire:          content /#/, was nil
[2014-01-07 20:20:53 -0500] jslusher: workmad3: I think I was looking at the custom plugins
[2014-01-07 20:20:58 -0500] jslusher: and not the native?
[2014-01-07 20:21:21 -0500] workmad3: jslusher: I'm not sure if there is an ohai plugin... but without something like that, I'd highly doubt that any ec2 management info will be available as node attributes
[2014-01-07 20:21:29 -0500] workmad3: jslusher: and by extension, won't be searchable via chef
[2014-01-07 20:22:09 -0500] workmad3: jslusher: you could potentially install an aws api gem in your chef run and use that to query information from ec2 and set it as node information
[2014-01-07 20:22:40 -0500] jslusher: workmad3: I don't have the ohai cookbook installed at all in this recipe, so I suppose it's possible a plugin within the cookbook would do it
[2014-01-07 20:23:23 -0500] jslusher: I'll see if that's possible first since it seems easiest
[2014-01-07 20:27:00 -0500] chefuser00: hello all. i hav a vanilla install of newest chef from today. im trying to run the chef-client on a client and i am getting a 'localhost' address,.. but a second later it reports my correct address. # chef-client ... Networking Error: ----------------- Errno::ECONNREFUSED: Connection refused - Connection refused connecting to https://localhost/bookshelf/organization-00000000000000000000000000000000/checksum-easdf5?AWSAccessKeyId=26
[2014-01-07 20:27:06 -0500] chefuser00: any ideas?
[2014-01-07 20:27:38 -0500] chefuser00: Relevant Config Settings: ------------------------- chef_server_url  "https://chef01.mynetwork.lan"
[2014-01-07 20:27:52 -0500] chefuser00: that was the next part -- so it definitely knows the correct address.
[2014-01-07 20:30:18 -0500] ctote: Hey everyone, I'm having some issues with my recipe - I'm pretty new to Chef, so I'm kind of lost on why this is happening
[2014-01-07 20:30:26 -0500] ctote: Here's my gist: https://gist.github.com/anonymous/8306326
[2014-01-07 20:30:48 -0500] ctote: What happens is, the sleep gets kicked off prior to the execution of the Oracle setup, which I don't understand at all
[2014-01-07 20:31:25 -0500] workmad3: ctote: ok, you've very quickly encountered the two-phase aspect of a chef run :)
[2014-01-07 20:31:40 -0500] stormerider: chefuser00: that sounds like your chef server does not have a correctly configured FQDN
[2014-01-07 20:31:49 -0500] jslusher: it seems there is an ec2 plugin that is part of Ohai, but the documentation is not clear as to how I add it
[2014-01-07 20:32:04 -0500] workmad3: ctote: basically, when chef runs a convergence it does two passes - first it evaluates your recipes to get a list of what resources need to be executed
[2014-01-07 20:32:13 -0500] jslusher: https://github.com/opscode/ohai/tree/master/lib/ohai/plugins
[2014-01-07 20:32:17 -0500] stormerider: this is a very, very common problem people run into with the bookshelf component
[2014-01-07 20:32:17 -0500] workmad3: ctote: your sleep is happening in the first phase
[2014-01-07 20:32:34 -0500] chefuser00: stormerider: soo. i have it configured in /etc/sysconfig/network and /etc/hosts and 'hostname' brings back the correct fqdn,.. and also knife bootstrap works fine.
[2014-01-07 20:32:36 -0500] workmad3: ctote: in the second phase, resources that need to be executed (like your oracle install) are run
[2014-01-07 20:32:48 -0500] jslusher: lots of them there, but nothing in the docs except how to add custom plugins
[2014-01-07 20:32:54 -0500] jslusher: does that mean it's already there?
[2014-01-07 20:33:11 -0500] ctote: workmad3: hmm, ok - so then I guess I'm writing my recipe wrong? I shouldn't be mixing resources and ruby code?
[2014-01-07 20:33:12 -0500] workmad3: ctote: btw, it's a *really* bad idea to have a sleep in your recipe like that... it's a killer for race conditions and a permanent extra minute on each chef run
[2014-01-07 20:33:14 -0500] stormerider: chefuser00: assuming chef 11, you need to edit /etc/chef-server/chef-server.rb (check tho docs for what to configure)
[2014-01-07 20:34:02 -0500] workmad3: ctote: surely the setup.exe will run through the install and only exit once its finished?
[2014-01-07 20:36:32 -0500] ctote: workmad3: sadly, that's not the case here -- it appears as though the oracle installer launches another cmd window, and prematurely returns a success (0)
[2014-01-07 20:38:36 -0500] cnb_: I'm having a problem with the opscode installer
[2014-01-07 20:39:17 -0500] ctote: workmad3: this is actually the source of my issues right now - I can't find a graceful wait to halt the execution until after Oracle is completed. Because of that, I had to add a sleep (and have also avoided deleting my temp directories so as to not remove necessary installation files)
[2014-01-07 20:39:53 -0500] workmad3: ctote: I'd personally do something along these lines: https://gist.github.com/workmad3/8306422
[2014-01-07 20:40:17 -0500] cnb_: It runs, but then if I run "chef-solo" I get a /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:247:in `to_specs`: Could not find json (<= 1.7.7, >= 1.4.4) amongst [.....]
[2014-01-07 20:41:33 -0500] cnb_: So how can I install Chef on RHEL 6?
[2014-01-07 20:42:51 -0500] workmad3: ctote: if you do need to run some ruby code at converge time rather than compile time (first phase is called compile, second phase is called convergence) there's a 'ruby_block' resource you can look up too ;)
[2014-01-07 20:43:33 -0500] workmad3: ctote: you could use that to put your sleep into place, I guess, although I'd personally want to look at some way to delay for just the right amount of time (such as monitoring an install log or something)
[2014-01-07 20:44:08 -0500] sbrink: workmad3 (or lwrp or library right?)
[2014-01-07 20:44:52 -0500] workmad3: sbrink: yeah, I'd probably want to wrap the entire lot up into a custom resource :)
[2014-01-07 20:45:08 -0500] ctote: workmad3: Ok, very awesome - thanks for the help! I've not been able to understand the 'not_if' bit.. does that just mean 'don't do any of this if (this) is true'?
[2014-01-07 20:45:19 -0500] workmad3: ctote: yup, that's exactly it :)
[2014-01-07 20:45:31 -0500] workmad3: ctote: a.k.a. don't install oracle if it's already installed :)
[2014-01-07 20:46:33 -0500] ctote: workmad3: Ok neat, I'll give that a shot - I have a feeling I'm going to need the sleep, unless I can figure out why it's exiting back to the recipe prematurely.
[2014-01-07 20:46:44 -0500] ctote: workmad3: Are templates just assocaited files?
[2014-01-07 20:47:17 -0500] workmad3: ctote: templates are a way to output files that depend on dynamic or node-specific data
[2014-01-07 20:48:08 -0500] workmad3: ctote: e.g. in your case you could push the install directory into a node attribute and then you'd have a template to generate your response file rather than a plain cookbook file. The template could then put the install directory into the response file in the correct place
[2014-01-07 20:49:07 -0500] ctote: workmad3: Ok, the response file is just a file that lists installation parameters so I can do a silent installation... so same idea?
[2014-01-07 20:49:50 -0500] workmad3: ctote: yeah... just imagine as you build your infrastructure that you want to alter the response file to do slightly different installs on some nodes
[2014-01-07 20:49:54 -0500] cnb_: Does anyone know how to install chef client on RHEL 6?  I tried the Opscode installer, and it creates a broken installation.
[2014-01-07 20:50:19 -0500] workmad3: ctote: rather than have a separate response file for each node, you'd have one response file template and configure it based on specific data on the node
[2014-01-07 20:50:26 -0500] sbrink: ctote: is it possible that the responsefile and noconsole is sending it off to the background so the execute call isn't waiting
[2014-01-07 20:50:27 -0500] spheromak: cnb_: the omni package works for me
[2014-01-07 20:50:46 -0500] workmad3: sbrink: oh, the -noconsole is probably doing that :)
[2014-01-07 20:50:56 -0500] workmad3: ctote: try removing -noconsole from your execute ;)
[2014-01-07 20:51:09 -0500] ctote: sbrink / workmad3: Unfortunately not - I just added that today.  :(
[2014-01-07 20:51:28 -0500] spheromak: cnb_: https://opscode-omnibus-packages.s3.amazonaws.com/el/6/x86_64/chef-11.8.2-1.el6.x86_64.rpm (assuming x86_64)
[2014-01-07 20:51:30 -0500] sbrink: other forum someone says without noconsole the oracle client doesn't swallow the responsfile
[2014-01-07 20:51:52 -0500] workmad3: ctote: bah :)
[2014-01-07 20:52:31 -0500] sbrink: ctote: like workmad3 said, i'd try to wrap it in a lwrp (custom resource) that notifies a watcher for the pid of the installer
[2014-01-07 20:52:54 -0500] sbrink: where i work i can't give out gists
[2014-01-07 20:52:54 -0500] workmad3: ctote: scripting windows installs is nasty... so many of them are tied to graphical ways of doing things, no decent scripting in sight :(
[2014-01-07 20:53:30 -0500] spheromak: automating oracle is a nightmare
[2014-01-07 20:54:02 -0500] workmad3: spheromak: I figured that would also likely be the case, but I've fortunately never had the misfortune :)
[2014-01-07 20:54:21 -0500] ctote: sbrink: I haven't made it that far yet in my trials :)   I've read about lwrp, but have been a little scared to try it out
[2014-01-07 20:55:07 -0500] sbrink: haven't looked at this but a quick google
[2014-01-07 20:55:08 -0500] sbrink: https://github.com/cla-rce/oracle-instantclient
[2014-01-07 20:55:20 -0500] concertman: Hello all. I'm trying to log into my Chef11 web ui and I keep getting "Could not complete logging in." Anyone have some suggestions for me?
[2014-01-07 20:57:11 -0500] chefuser00: stormerider: its a bug
[2014-01-07 20:57:20 -0500] chefuser00: stormrider: https://tickets.opscode.com/browse/CHEF-4650
[2014-01-07 20:57:33 -0500] chefuser00: what a pain in the ass
[2014-01-07 20:58:53 -0500] ctote: is there an equivalent of not_if? can I just use if?
[2014-01-07 20:59:18 -0500] sbrink: only_if
[2014-01-07 20:59:27 -0500] ctote: tyty
[2014-01-07 20:59:50 -0500] cnb_: spheromak: I get a "chef is already installed" error installing from that RPM
[2014-01-07 21:00:08 -0500] sbrink: cnb_
[2014-01-07 21:00:18 -0500] koaps: are library files loaded before or after resource/providers?
[2014-01-07 21:00:41 -0500] ctote: Can I do this?  notifies :run, "ruby_block[check_path]"  --- instead of 'execute' use another resource, like ruby_block
[2014-01-07 21:00:42 -0500] sbrink: cnb_: i'd say since you have the broken install do the rpm -qa | grep chef
[2014-01-07 21:01:13 -0500] sbrink: then rpm -e the existing chef before doing the omnibus
[2014-01-07 21:01:15 -0500] cnb_: sbrink: chef-11.8.2-1.el6.x86_64
[2014-01-07 21:01:21 -0500] cnb_: ok
[2014-01-07 21:01:23 -0500] sbrink: ctote, yes
[2014-01-07 21:02:09 -0500] cnb_: sbrink: Did that.  Same error.
[2014-01-07 21:02:13 -0500] sbrink: though execute is a resource (i think .... as i've never thought of that)
[2014-01-07 21:13:49 -0500] kevinburke: Hello
[2014-01-07 21:14:08 -0500] kevinburke: Let's say I needed to get data from a file on disk and use it in a definition
[2014-01-07 21:14:10 -0500] kevinburke: so i try:
[2014-01-07 21:14:21 -0500] kevinburke: roles = get_roles("/var/run/foo")
[2014-01-07 21:14:50 -0500] kevinburke: I tried creating "def roles()" directly inside the definition, however my chef complains that it can't find a method named get_roles
[2014-01-07 21:15:15 -0500] cnb_: Does anyone have any idea what went wrong in the chef install?
[2014-01-07 21:15:42 -0500] cnb_: I've tried the installer script and the rpm, and afterwards chef-solo gives an error
[2014-01-07 21:15:46 -0500] cnb_: It runs, but then if I run "chef-solo" I get a /opt/chef/embedded/lib/ruby/site_ruby/1.9.1/rubygems/dependency.rb:247:in `to_specs`: Could not find json (<= 1.7.7, >= 1.4.4) amongst [.....]
[2014-01-07 21:16:37 -0500] ssd7: kevinburke: Do you happen to have a link to the code in particular?
[2014-01-07 21:17:07 -0500] jslusher: can anyone help me better understand ohai plugins?
[2014-01-07 21:17:16 -0500] jslusher: particularly the ec2 plugin
[2014-01-07 21:17:30 -0500] jslusher: just trying to figure out how to install it within a recipe
[2014-01-07 21:17:35 -0500] jslusher: if it's not already installed
[2014-01-07 21:19:06 -0500] cwj: jslusher: heres an example https://github.com/opscode-cookbooks/nginx/blob/master/recipes/ohai_plugin.rb
[2014-01-07 21:19:48 -0500] koaps: cnb_: you can try GEM_PATH=:/opt/chef/embedded/lib/ruby/gems/1.9.1:$GEM_PATH; export GEM_PATH
[2014-01-07 21:19:51 -0500] jblack: ugh  gem list shows chef  as being installed.  What should I look at to fix it?
[2014-01-07 21:21:24 -0500] cnb_: koaps: Well, that didn't work.
[2014-01-07 21:21:26 -0500] cwj: jslusher: but id wager 99% of the time the ec2 plugin will be there. if your ec2 instances arent getting attributes under node[ec2] then you may need to drop off a hint file for ohai
[2014-01-07 21:21:35 -0500] cnb_: It runs, but it barfs a ton of stuff to the console
[2014-01-07 21:21:51 -0500] koaps: cnb_: check the path is right, I copied it from some notes I had
[2014-01-07 21:22:01 -0500] koaps: you using rvm?
[2014-01-07 21:22:01 -0500] cnb_: Ending with "You may have encountered a bug in the Ruby interpreter or extension libraries."
[2014-01-07 21:22:29 -0500] jslusher: cwj: it might just be that I'm not referencing them properly. I haven't tried using node['ec2']
[2014-01-07 21:22:32 -0500] cnb_: And "FAtAL: Chef::Exceptions::ChildConvergeError: Chef run process terminated by signal 6 (ABRT)"
[2014-01-07 21:22:45 -0500] cnb_: I don't know if I'm using rvm.
[2014-01-07 21:22:47 -0500] ctote: can you notify multiple resources?
[2014-01-07 21:22:59 -0500] koaps: cnb_: if you installed the system you would know
[2014-01-07 21:22:59 -0500] cnb_: So, no.
[2014-01-07 21:23:08 -0500] cwj: jslusher: well node[ec2] should be the same as node.ec2, node[:ec2] etc
[2014-01-07 21:23:18 -0500] koaps: yea, I stoped using the rpm for the client and use gems
[2014-01-07 21:23:20 -0500] bettyclamp: Can't install Berkshelf because my ruby version is behind, and I can't upgrade on this machine. Solutions? (Are there good alternatives to Berkshelf?)
[2014-01-07 21:23:22 -0500] ctote: Like, could I do:  notifies :run, "ruby_block[check_path]", "ruby_block[cleanup]"
[2014-01-07 21:23:32 -0500] cwj: jslusher: try touch /etc/chef/ohai/hints/ec2.json
[2014-01-07 21:23:37 -0500] cwj: then re-run chef
[2014-01-07 21:24:19 -0500] koaps: bettyclamp: rvm maybe
[2014-01-07 21:24:24 -0500] jslusher: cwj: yeah, I didn't know about node.ec2 anything. totally overlooked that
[2014-01-07 21:24:45 -0500] cwj: ok
[2014-01-07 21:24:48 -0500] cwj: hth :)
[2014-01-07 21:24:53 -0500] koaps: bettyclamp: you can install ruby and gems in your homedir with rvm
[2014-01-07 21:25:30 -0500] Yoteco: I'm still struggling with the best solution to provision a VM. I work with berkshelf and then upload my application recipe to the chef server. After that what's the best way to provision a VM? A: create a node and define a run list with the application recipe. B: (like vagrant) register the node with knife and the create the run list. C: other?
[2014-01-07 21:26:01 -0500] koaps: bettyclamp: thought if you don't have basic dev tools like gcc installed you will have issues
[2014-01-07 21:26:15 -0500] sbrink: Yoteco: we have started using knife bootstrap
[2014-01-07 21:26:24 -0500] jblack: Whoops. Palm'ed by the mouse.  I meant to ask for a problem with knife. I'm running knife download / but I'm getting  "/usr/lib64/ruby/gems/1.8/gems/chef-11.8.2/lib/chef/chef_fs/file_system.rb:292: warning: don't put space before argument"
[2014-01-07 21:26:31 -0500] castro1688: Quick question.. anyone know how to tell ohai to use eth1 for node[:ipaddress] and not eth0?
[2014-01-07 21:26:39 -0500] shlant: Yoteco: i also use bootstrap
[2014-01-07 21:27:02 -0500] flaccid: castro1688: you'll probably want to use a different key instead
[2014-01-07 21:27:10 -0500] shlant: does anybody know if this is what the contents of a encrypted data bag file are supposed to be?
[2014-01-07 21:27:11 -0500] shlant: #<Chef::EncryptedDataBagItem:0x0000000367d740>
[2014-01-07 21:27:20 -0500] sbrink: Yoteco: you still have to do some scripting as well as have the validation key handy
[2014-01-07 21:27:21 -0500] shlant: on the node
[2014-01-07 21:27:30 -0500] flaccid: shlant: thats the object
[2014-01-07 21:27:31 -0500] Yoteco: In my company we are using VMware vSphere. So basically we have to create the VM and the bootstrap the VM with knife bootstrap?
[2014-01-07 21:27:48 -0500] shlant: flaccid: so that's how it should be?
[2014-01-07 21:27:59 -0500] flaccid: shlant: i assume so
[2014-01-07 21:28:03 -0500] bettyclamp: thanks, koaps
[2014-01-07 21:28:21 -0500] flaccid: Yoteco: i think there is a knife plugin for vsphere, not sure
[2014-01-07 21:28:41 -0500] flaccid: Yoteco: https://github.com/ezrapagel/knife-vsphere
[2014-01-07 21:28:47 -0500] shlant: flaccid: I'm so lost then. I have a private ssh key encrypted and when I manually paste it into the id_rsa it works, but if it gets put there with a data bag it doesn't
[2014-01-07 21:29:09 -0500] sbrink: shlant: yes but maybe something like this to get hash contents of the data bag
[2014-01-07 21:29:51 -0500] cnb_: y
[2014-01-07 21:30:29 -0500] cnb_: I rebooted my virtual machine.  I'm trying to reinstall chef from a blank machine.
[2014-01-07 21:30:46 -0500] cnb_: I'm not hopeful.
[2014-01-07 21:30:59 -0500] sbrink: http://docs.opscode.com/essentials_data_bags.html
[2014-01-07 21:31:16 -0500] shlant: sbrink: i figured it out. I put the data bag into a variable, but I referenced that variable instead of the specific data bag item
[2014-01-07 21:31:22 -0500] sbrink: ...
[2014-01-07 21:31:32 -0500] sbrink: ok i was just about to ask that sorry
[2014-01-07 21:31:38 -0500] koaps: cnb_: I would rpm install the server and gem install the client, just personal preference
[2014-01-07 21:32:03 -0500] Yoteco: Ok I start to understand it. I'll play around with knife bootstrap. For the moment I was just playing with vagrant and everything happens under cover :)
[2014-01-07 21:32:16 -0500] Yoteco: Thanks for your help?
[2014-01-07 21:32:18 -0500] cnb_: koaps: I'll try that.  Do I need the server to run chef-solo?
[2014-01-07 21:32:37 -0500] sbrink: do not need a server for chef-solo
[2014-01-07 21:32:43 -0500] koaps: cnb_: no, chef-solo is for when you don't use a server
[2014-01-07 21:32:49 -0500] shlant: sbrink: should the chef_run output be displaying encrypted items in plain text?
[2014-01-07 21:32:51 -0500] sbrink: although searchs do not work
[2014-01-07 21:33:12 -0500] sbrink: shlant, .... uhm ... yes?
[2014-01-07 21:33:15 -0500] koaps: cnb_: but there care catches you using chef-solo and some cookbooks, not everything is available
[2014-01-07 21:33:17 -0500] sbrink: thinking
[2014-01-07 21:33:26 -0500] koaps: s/care/are/
[2014-01-07 21:33:40 -0500] cnb_: koaps: This system I'm trying to set up is for vagrant
[2014-01-07 21:33:53 -0500] cnb_: koaps: So it's chef-solo only.
[2014-01-07 21:34:34 -0500] koaps: cnb_: yea, probably be ok, I think its things like databags or environments or stuff like that isn't in chef-solo, would have to look
[2014-01-07 21:34:53 -0500] sbrink: shlant when you decrypt the data bag no it won't show the contents
[2014-01-07 21:35:02 -0500] cnb_: Okay, I've run "gem install chef"
[2014-01-07 21:35:07 -0500] cnb_: And it says it did it
[2014-01-07 21:35:25 -0500] sbrink: cnb_ what ruby version are you running?
[2014-01-07 21:35:27 -0500] shlant: sbrink: in the stdout?
[2014-01-07 21:35:36 -0500] cnb_: I think it worked
[2014-01-07 21:35:49 -0500] cnb_: chef-solo --version seems to work, correctly
[2014-01-07 21:36:10 -0500] cnb_: It's ruby 2.0.0p353
[2014-01-07 21:36:16 -0500] sbrink: shlant i don't think so, not unless you did something to the effect of puts mysql_creds["pass"]
[2014-01-07 21:36:24 -0500] Majost: sethvargo: Hey, do you have the URI to the Jenkins cookbook refactor?
[2014-01-07 21:36:35 -0500] sbrink: cnb_ cool
[2014-01-07 21:36:53 -0500] cnb_: Thanks so much, for everyone's help.
[2014-01-07 21:37:05 -0500] cnb_: That was way more work than it should have been.
[2014-01-07 21:37:14 -0500] koaps: cnb_: gems are a good way, since chef installs in /opt you might get funky stuff with system ruby vs embedded
[2014-01-07 21:37:20 -0500] sethvargo: @Majost sethvargo/groovy_api (on opscode-cookbooks/jenkins)
[2014-01-07 21:37:40 -0500] Majost: sethvargo: Thanks! =)
[2014-01-07 21:38:15 -0500] jslusher: cwj: how would I get a list of keys using chef? is there a way to have all the keys of a node listed? something like node['ec2'].keys()
[2014-01-07 21:38:31 -0500] cwj: jslusher: yep just like that
[2014-01-07 21:39:10 -0500] koaps: so anyone know why if I'm making a resource class in a library, the compiling of another cookbook that depends on the libaray cookbook would fail with cannot find resource?
[2014-01-07 21:39:19 -0500] sbrink: jslusher i muck about with that by ssh to the box then chef-shell -z -c /.../client.rb
[2014-01-07 21:39:49 -0500] jslusher: sbrink: I think you're about to save me a lot of tedium
[2014-01-07 21:40:13 -0500] sbrink: koaps did you include it in your metadata, or include in the calling recipe
[2014-01-07 21:40:21 -0500] visof: hello
[2014-01-07 21:40:51 -0500] koaps: sbrink: I did not, I thought the depends took of it, guess that would be wrong :)
[2014-01-07 21:41:05 -0500] jslusher: sbrink: the client.rb file is an arbitrary file containing chef code I put in it?
[2014-01-07 21:41:06 -0500] visof: i'm trying to execute squid -z using execute -> command , and bash -> code , but with no effect
[2014-01-07 21:41:12 -0500] sbrink: chef-shell gives your the equivelent of the irb/pry  so once you are on the box and inside the chef-shell -z you can have at the node object
[2014-01-07 21:41:22 -0500] visof: i'm providing the full path of bin
[2014-01-07 21:41:32 -0500] sbrink: the client.rb is what the "real" box uses to connect to the chef server
[2014-01-07 21:41:41 -0500] visof: when running it outside chef it's running
[2014-01-07 21:42:12 -0500] visof: please how can i figure it out?
[2014-01-07 21:42:23 -0500] sbrink: if this is a vagrant ... well i need to bring up a vagrant to see if you need that
[2014-01-07 21:42:25 -0500] jslusher: sbrink: ok. I'll try it out
[2014-01-07 21:42:31 -0500] sbrink: but chef-shell is a lovely thing
[2014-01-07 21:47:54 -0500] sbrink: visof can you put what you've tried in a gist
[2014-01-07 21:55:05 -0500] visof: sbrink: https://gist.github.com/aibrahim/8307609
[2014-01-07 21:56:17 -0500] ctote: So, would it be a bad idea to include installation files with my cookbook? Like if I have a zip that's 600MB, should I have a script that downloads it, or just include it with the cookbook?
[2014-01-07 21:56:36 -0500] sbrink: jslusher within chef-shell heres a bit of "fun" https://gist.github.com/anonymous/8307616
[2014-01-07 21:57:10 -0500] mattupstate: ctote: its gotta get downloaded from somewhere, better to just manage a version number in your cookbook attributes and point it somewhere to download it
[2014-01-07 21:57:31 -0500] jslusher: sbrink: still trying to get it to work. apparently I don't have a new enough ruby on this ec2 instance
[2014-01-07 21:57:44 -0500] jslusher: working through that atm
[2014-01-07 21:57:48 -0500] ctote: mattupstate: Ok, so even if the file never changes do I still need to worry about version numbers? (I don't really understand how to do that yet)
[2014-01-07 21:59:15 -0500] mattupstate: ctote: that would still be better, especially if you're keeping your cookbooks under version control
[2014-01-07 21:59:27 -0500] mattupstate: (which you should be)
[2014-01-07 21:59:37 -0500] mattupstate: you don't want a 600MB in your repository
[2014-01-07 21:59:42 -0500] sbrink: visof: i think your app is only running in the context of your chef run
[2014-01-07 22:00:24 -0500] clayb: I was getting an error when I moved to Chef 11 from Chef 10 having big binaries in my cookbook
[2014-01-07 22:00:40 -0500] sbrink: visof: and then when chef finishes the app exits
[2014-01-07 22:00:56 -0500] visof: sbrink: so how can i fix this?
[2014-01-07 22:01:01 -0500] sbrink: visof: might you need to nohup it? or send it off to the background
[2014-01-07 22:01:20 -0500] visof: sbrink: so add & for the end of the command
[2014-01-07 22:01:23 -0500] sbrink: visof: i don't know ?squid? so i can't help on that
[2014-01-07 22:01:38 -0500] sbrink: visof: i'd try that
[2014-01-07 22:01:43 -0500] visof: sbrink: it's just bin
[2014-01-07 22:01:59 -0500] sbrink: or just look for the pid or return value
[2014-01-07 22:02:28 -0500] clayb: I'd recommend writting a runit service wrapper around squid (see the Jenkins community cookbook for an example). As then squid can be managed like a service on the machine opposed to a lone orphaned daemon.
[2014-01-07 22:02:48 -0500] ctote: So I have this:  https://gist.github.com/anonymous/8307724, but this sets my PATH to nil --- am I missing something?
[2014-01-07 22:02:57 -0500] visof: sbrink: with nothing too
[2014-01-07 22:03:17 -0500] visof: sbrink: it don't even run
[2014-01-07 22:03:48 -0500] visof: squid -z create cache swap , squid will run the bin itself
[2014-01-07 22:05:00 -0500] sbrink: visof: based on your gist you are trying to run squid as your user running "chef-client" or "chef-solo" does this user have the rights to run squid?
[2014-01-07 22:05:50 -0500] visof: sbrink: i'm running it as root
[2014-01-07 22:07:24 -0500] koaps: yay! my cookbook finally works
[2014-01-07 22:09:57 -0500] greenmoss: anyone had experience with ironfan?
[2014-01-07 22:10:56 -0500] greenmoss: Garo_: I see you're in chef too
[2014-01-07 22:11:25 -0500] greenmoss: bah, wrong rrom
[2014-01-07 22:11:26 -0500] greenmoss: room
[2014-01-07 22:11:47 -0500] ctote: Hey guys - I have this:  https://gist.github.com/anonymous/8307724, but this sets my PATH to nil --- am I missing something?
[2014-01-07 22:11:47 -0500] visof: sbrink: ?
[2014-01-07 22:12:14 -0500] sbrink: ctote: the envPath that you set up at the very top via straight ruby gets mucked with during compile
[2014-01-07 22:12:41 -0500] ctote: sbrink: is there a better way to do this?
[2014-01-07 22:12:46 -0500] sbrink: ctote: i believe that even the env.dupe won't update it so you end up with empty
[2014-01-07 22:13:18 -0500] ctote: If I put envPath = ENV["PATH"].dup at the top, it works fine - but I need to capture it after the installation
[2014-01-07 22:13:19 -0500] sbrink: visof: try an "execute" instead of bash
[2014-01-07 22:13:26 -0500] ctote: sbrink:  ^
[2014-01-07 22:14:47 -0500] visof: sbrink: the same
[2014-01-07 22:15:15 -0500] sbrink: visof: i'm at a loss
[2014-01-07 22:15:24 -0500] sbrink: ctote, i'd use a recipe attribute
[2014-01-07 22:15:33 -0500] sbrink: especially with all the ruby blocks
[2014-01-07 22:15:47 -0500] sbrink: node.set[foo][bar]=env
[2014-01-07 22:16:03 -0500] ctote: I've just been doing like...
[2014-01-07 22:16:13 -0500] sbrink: then use the #{node[:foo][:bar}
[2014-01-07 22:16:16 -0500] ctote: default[:foo] = 'bar'
[2014-01-07 22:16:19 -0500] mikeg: In an lwrp I'm writing, I'm trying to add a hash to an array like so:   node.default.authorization.access.users << user_hash     I get the following error:  Undefined node attribute or method `<<' on `node'. To set an attribute, use `<<=value' instead.
[2014-01-07 22:16:27 -0500] mikeg: any ideas?
[2014-01-07 22:16:47 -0500] mikeg: worked before when it was a simple array.   now that it's an array of hashes it's failing
[2014-01-07 22:17:01 -0500] jslusher: sbrink: I'm in the shell, but I can't even run the help command
[2014-01-07 22:17:09 -0500] sbrink: ?
[2014-01-07 22:17:16 -0500] jslusher: chef > help
[2014-01-07 22:17:16 -0500] jslusher: chef ?>
[2014-01-07 22:17:21 -0500] sbrink: jslusher what does node.keys get you
[2014-01-07 22:17:43 -0500] ichag: does anyone have an idea about this: https://github.com/hw-cookbooks/postgresql/issues/103 ?
[2014-01-07 22:17:55 -0500] jslusher: sbrink: same: chef > node.keys
[2014-01-07 22:17:56 -0500] jslusher: chef ?>
[2014-01-07 22:18:11 -0500] sbrink: holy carp
[2014-01-07 22:18:16 -0500] sbrink: o.0
[2014-01-07 22:18:47 -0500] mikeg: looks like the problem was me trying to use force_default in attributes file instead of default
[2014-01-07 22:18:49 -0500] mikeg: sigh
[2014-01-07 22:19:09 -0500] kristian1aul: Heya
[2014-01-07 22:19:18 -0500] kristian1aul: Tricky question
[2014-01-07 22:20:00 -0500] kristian1aul: Is chef actually capable of editing (for adding or deleting) its own recipes for example a NFS server was installed by chef
[2014-01-07 22:20:04 -0500] sbrink: jslusher is this a vagrant or a real machine
[2014-01-07 22:20:10 -0500] NewBKaeK: does anyone have a recipe for setting up rvm with chef?
[2014-01-07 22:20:13 -0500] kristian1aul: But for every NFS share you need describe it on the recipe
[2014-01-07 22:20:17 -0500] jslusher: sbrink: it's an ec2 instance
[2014-01-07 22:20:26 -0500] jslusher: ubuntu precise 12.04
[2014-01-07 22:20:32 -0500] kristian1aul: so this manual action requires modifify code
[2014-01-07 22:20:34 -0500] flaccid: NewBKaeK: easily found on google or community site
[2014-01-07 22:20:57 -0500] kristian1aul: So can chef edit its own code, or what do in this kind of situations?
[2014-01-07 22:21:30 -0500] NewBKaeK: I wouldn't be asking if i wasn't confused by the links I'm looking at.
[2014-01-07 22:22:01 -0500] jslusher: won't even let me exit
[2014-01-07 22:22:38 -0500] sbrink: jslusher, that looks like the ruby that is running the chef shell is not the "right" ruby ...
[2014-01-07 22:22:50 -0500] jslusher: sbrink: NM. missing a closing quote or something
[2014-01-07 22:23:03 -0500] sbrink: oh
[2014-01-07 22:23:11 -0500] sbrink: cool, you had me really scairt
[2014-01-07 22:24:06 -0500] sbrink: kristian1aul, i'd stick my nfs definitions in a data bag
[2014-01-07 22:24:17 -0500] sbrink: write a library that understands that contract
[2014-01-07 22:24:44 -0500] sbrink: have chef-client running as a service on that machine, then it would update it's nfs mounts as needed
[2014-01-07 22:24:51 -0500] sbrink: but i probably don't understand
[2014-01-07 22:24:55 -0500] sbrink: ...
[2014-01-07 22:28:08 -0500] jslusher: sbrink: this is so much better than what I was doing
[2014-01-07 22:28:15 -0500] jslusher: really helps
[2014-01-07 22:28:27 -0500] kristian1aul: sbrink: good point
[2014-01-07 22:28:53 -0500] kristian1aul: yeah good idea
[2014-01-07 22:29:10 -0500] jslusher: so for future reference if you want to reference the name you gave to your ec2 instance you created using knife ec2 create, the reference is node.name
[2014-01-07 22:29:12 -0500] kristian1aul: if you think about data bag as a datbase not just a storage for sensitive info..
[2014-01-07 22:30:32 -0500] visof: i can not run squid -z from inside execute or bash in chef , but i can run from the shell, what issues maybe this?
[2014-01-07 22:30:38 -0500] visof: and how can fix them
[2014-01-07 22:30:45 -0500] visof: please anyone help to figure it out
[2014-01-07 22:32:31 -0500] koaps: I would use shell_out, but then I would also build a LWRP
[2014-01-07 22:37:59 -0500] sbrink: ichag: have you looked in the configuration file that the service uses to start/stop/restart the postgres?
[2014-01-07 22:39:09 -0500] sbrink: ichag: what does the ?/var/log/postgres? log file say?
[2014-01-07 22:41:18 -0500] ichag: sbrink: hm.. stay tuned, i will take a look. i concentrated on the pg_hba.conf which i had in suspicion
[2014-01-07 22:43:12 -0500] jleveque: do you know what is the lists:member/2 function in erchef ? doing a etop within erlang shell tells me that this is the function in which chef is spending all its CPU
[2014-01-07 22:44:04 -0500] sfalcon: jleveque: that function, part of the standard library, does an O(n) membership search for an element in a list.
[2014-01-07 22:45:55 -0500] coderanger: equiv to #include? or __contains__
[2014-01-07 22:49:14 -0500] paulczar: is there a test-kitchen specific IRC channel ?
[2014-01-07 22:49:28 -0500] coderanger: paulczar: #kitchenci
[2014-01-07 22:49:35 -0500] coderanger: but you can ask questions here too
[2014-01-07 22:49:48 -0500] jleveque: thanks is it supposed to work correctly within erchef ? because erchef  does not seem to spend its time in depsolver, but here in this function. ( i removed the ~> and replaced them by in each environment constraint and I also removed as much as possible on the cookbook's metadata constraints but the erchef cpu problem is still here)
[2014-01-07 22:50:29 -0500] ichag: @sbrink logfile shows the given error message. nothing about "host" in init.d script. i will install postgre manually and compare it as i should do it first next time ;)
[2014-01-07 22:50:57 -0500] jleveque: doing a perf top shows the function lists_member_2 and eq taking all cpu
[2014-01-07 22:53:50 -0500] bugoff: ping /5
[2014-01-07 22:58:15 -0500] ichag1: ping
[2014-01-07 23:02:06 -0500] helfire: i cant figure out why chefspec doesnt like this: http://pastebin.com/vXzwiGJx
[2014-01-07 23:03:20 -0500] visof: please anyone can help me in my problem , what are the reasons which make me can not run command via execute or bash ?
[2014-01-07 23:03:29 -0500] visof: with no effect or errors
[2014-01-07 23:03:48 -0500] visof: and it's working okay in shell directly
[2014-01-07 23:04:08 -0500] visof: the command is /opt/squid/sbin/squid -z
[2014-01-07 23:04:12 -0500] workmad3: helfire: it's because, even with fauxhai, you need to do node.set["cpu"]["total"] = 1
[2014-01-07 23:04:54 -0500] workmad3: helfire: same as in a recipe... just doing node["cpu"]["total"] will first evaluate node["cpu"] which gives you nil (not a mash) and then a no method error
[2014-01-07 23:04:55 -0500] helfire: workmad3: https://github.com/customink/fauxhai/ doesnt show node.set
[2014-01-07 23:06:02 -0500] workmad3: helfire: trust me
[2014-01-07 23:06:06 -0500] helfire: even changing to node.set the recipe gives NilClass
[2014-01-07 23:06:23 -0500] workmad3: helfire: works fine for me when I do node.set
[2014-01-07 23:08:19 -0500] helfire: if i set cpu total in the attributes file, the recipe reads it fine
[2014-01-07 23:10:22 -0500] workmad3: helfire: hmm, here's a question... what version of chefspec are you using?
[2014-01-07 23:10:37 -0500] helfire: $ bundle env | grep chefspec
[2014-01-07 23:10:37 -0500] helfire:  gem 'chefspec'
[2014-01-07 23:10:37 -0500] helfire:     chefspec (3.1.4)
[2014-01-07 23:10:48 -0500] workmad3: helfire: right... pretty sure you don't need fauxhai for that
[2014-01-07 23:11:03 -0500] workmad3: helfire: https://github.com/sethvargo/chefspec#setting-node-attributes
[2014-01-07 23:11:22 -0500] helfire: doh, i got side tracked on fauxhai
[2014-01-07 23:11:28 -0500] helfire: let me try this
[2014-01-07 23:11:29 -0500] helfire: :)
[2014-01-07 23:11:33 -0500] workmad3: helfire: and fauxhai seems to do some weird things like not doing some initialize stuff unless chefspec is older than 0.9
[2014-01-07 23:12:21 -0500] workmad3: helfire: unfortunately, I hid that detail away in my test suites :) wrote a small set of helpers so I just add a setup_node method if I want to add node attributes
[2014-01-07 23:12:32 -0500] workmad3: helfire: so forgot that I never touched fauxhai :)
[2014-01-07 23:14:07 -0500] notromda: What's best practice for cloning a repo from a private github account?   install ssh deploy key as a template as suggested in http://stackoverflow.com/questions/18388722/chef-deploy-resource-private-repo-ssh-deploy-keys-and-ssh-wrapper/18495349#18495349 ?
[2014-01-07 23:15:08 -0500] helfire: oh workmad3, if you wernt so mad i'd love you
[2014-01-07 23:15:24 -0500] workmad3: notromda: I prefer using file("/path/to/key") with the key as the content attribute
[2014-01-07 23:15:38 -0500] workmad3: notromda: because templates with a single line spitting out a variable annoy me :)
[2014-01-07 23:15:45 -0500] workmad3: helfire: sorted? :)
[2014-01-07 23:16:18 -0500] helfire: yes, ugh, i got side tracked down so many side issues that i lost the most basic thing
[2014-01-07 23:17:15 -0500] helfire: still cant figure out why i cant validate my template .with_content, but can mess with that now
[2014-01-07 23:17:57 -0500] helfire: Finished in 1.06 seconds
[2014-01-07 23:17:58 -0500] helfire: 3 examples, 0 failures
[2014-01-07 23:17:59 -0500] helfire: woot
[2014-01-07 23:18:31 -0500] savant: nice
[2014-01-07 23:20:28 -0500] workmad3: helfire: https://github.com/hedtek-infra/chefspec-ext if you're interested btw
[2014-01-07 23:21:02 -0500] workmad3: helfire: it's not exactly complicated and I keep on paring it down as chefspec adds new features but it's still somewhat useful :)
[2014-01-07 23:22:23 -0500] helfire: cool, will look into it
[2014-01-07 23:24:46 -0500] helfire: is there a way to just dump the tempalte to stdout so i can see what is going on, it's there on real chef runs, but i cant validate the content
[2014-01-07 23:36:03 -0500] notromda: workmad3: sonds good, but the point is essentially still to put a ssh key on the node filesystem before cloning the repo.
[2014-01-07 23:39:48 -0500] workmad3: notromda: yeah... which stands to reason. If it's a private repo, you need some form of authentication credentials to clone it
[2014-01-07 23:39:59 -0500] workmad3: notromda: which, with git, is typically an ssh private key
[2014-01-07 23:42:58 -0500] notromda: I wonder if I could put down, clone the repo, and then delete it.   The rest of the time, deploys are handled via git push, but I have a chicken and egg problem that needs the repo cloned once to bootstrap it.
[2014-01-07 23:43:10 -0500] notromda: delete it = ssh key
[2014-01-07 23:43:50 -0500] workmad3: notromda: sure, you can do that if you want
[2014-01-07 23:44:10 -0500] workmad3: notromda: not sure what you expect that would provide though...
[2014-01-07 23:44:31 -0500] notromda: that way if someone gets access to the server, they don't have access to the github account
[2014-01-07 23:44:36 -0500] workmad3: notromda: yeah they do
[2014-01-07 23:44:53 -0500] workmad3: notromda: they just need to run a chef-shell and pull the ssh key out through that instead
[2014-01-07 23:45:03 -0500] workmad3: notromda: it's slightly trickier, but the ssh key is still available
[2014-01-07 23:45:46 -0500] notromda: I see.   I wonder if each project should have its own ssh deploy key then.
[2014-01-07 23:45:56 -0500] notromda: I may be over analyizing it
[2014-01-07 23:46:25 -0500] workmad3: notromda: probably... if someone has that level of access to your server(s), everything has to be considered as compromised
[2014-01-07 23:47:00 -0500] notromda: I suppose the good news is chef lets me replace the key easily
[2014-01-07 23:47:02 -0500] workmad3: notromda: if you wanted to be a bit more careful, you could make sure that your deploy key(s) only ever have pull access though
[2014-01-07 23:47:16 -0500] notromda: that makes sense.
[2014-01-07 23:47:33 -0500] workmad3: notromda: we've got a deploy github account that we add to gh teams with pull-only access for that purpose :)
[2014-01-07 23:49:13 -0500] workmad3: notromda: that's more because we don't want to accidentally push something to github from a production server due to a borked recipe though :) the security aspect (considering this is encrypted data bags, different keys per item and environment, HIDS monitoring the nodes, etc... if someone gets onto the node, security of our GH account is probably low priority :) )
[2014-01-07 23:49:48 -0500] josephholsten: coderanger: is there a good contact person for me to get an OSS account to put chef-mongodb tests up on vagrant-rackspace?
[2014-01-07 23:51:37 -0500] derks: Hello all.  I had a working chef server that I guess was manually configured some time ago.  I added the 'chef-server' cookbook to its runlist... and now it appears like a fresh install?  no data
[2014-01-07 23:51:57 -0500] derks: however if I curl couchdb directly, the data is there.
[2014-01-07 23:52:15 -0500] derks: At a bit of a loss... need some guidense.
[2014-01-07 23:52:20 -0500] sfalcon: derks: perhaps you have a Chef 10 server and a Chef 11 server installed on top of each other?
[2014-01-07 23:53:00 -0500] derks: sfalcon, possible.
[2014-01-07 23:53:02 -0500] notromda: workmad3:  yeah the other thing then, I guess is that the ssh key should probably be filled in from a databag, right?
[2014-01-07 23:53:24 -0500] workmad3: notromda: preferably a secure data bag
[2014-01-07 23:53:27 -0500] sfalcon: I think the latest chef-server cookbook installs Chef 11. Do you have a chef-server-ctl command on your PATH and files in /opt/chef-server?
[2014-01-07 23:53:31 -0500] workmad3: notromda: you may want to consider chef-vault ;)
[2014-01-07 23:53:49 -0500] notromda: yeah, I' still learning all the pieces
[2014-01-07 23:54:21 -0500] workmad3: notromda: chef-vault is a separate piece that lets you encrypt data items using a node's public key (available through searches)
[2014-01-07 23:54:26 -0500] derks: sfalcon, yes I do.
[2014-01-07 23:54:36 -0500] notromda: chef-vault uses the node's key to encrypt if I read that right.   Does that mean it has to be re-encrypted every time a new node is added?
[2014-01-07 23:54:45 -0500] sfalcon: derks: so Chef 11 doesn't have couchdb so it sounds like that is indeed what has happened.
[2014-01-07 23:55:08 -0500] workmad3: notromda: you need to add the new node to the list of allowed readers when necessary, yes
[2014-01-07 23:55:37 -0500] derks: damnit
[2014-01-07 23:55:41 -0500] sfalcon: derks: I'd recommend stopping the chef 11 server and seeing if you can get back to working Chef 10 server from which you can use `knife download` to capture a full backup. Then you can do a fresh install of 11, knife upload to upgrade.
[2014-01-07 23:55:50 -0500] sfalcon: sudo chef-server-ctl stop
[2014-01-07 23:56:01 -0500] workmad3: notromda: jtimberman wrote a pretty decent article on chef-vault... it does point out that not all bases are covered, there is a bit of a chicken-egg problem... but it's still a pretty good step up from many solutions :)
[2014-01-07 23:56:09 -0500] derks: thankfully I do have a full chef backup (nodes, roles, environments)
[2014-01-07 23:56:14 -0500] notromda: I'm hoping to eventually get this to the point where I rarely have to use chef - most of the deployment should be possible by editing data bag values and triggering a few web apis
[2014-01-07 23:56:16 -0500] workmad3: notromda: and adds a fairly useful extra bit of tooling onto chef's encyrpted data bags
[2014-01-07 23:57:09 -0500] notromda: But sounds like chef vault is a good step
[2014-01-07 23:57:11 -0500] derks: sfalcon, thanks. I'll get back to a working 10.. then do a planned migration
[2014-01-07 23:57:35 -0500] notromda: I'm going to have to start a new git project and redo everything "the right way" soon. lol
[2014-01-07 23:57:51 -0500] sfalcon: sounds good. would be nice to find a way for the chef-server cookbook to detect a 10 system and bail out.
[2014-01-07 23:58:00 -0500] workmad3: notromda: yeah, I kinda wish I'd known about it before I rolled some of my own secret management :)
[2014-01-07 23:58:17 -0500] derks: sfalcon that would have been nice...
[2014-01-07 23:58:25 -0500] workmad3: notromda: have you gotten your head around environments yet? :)
[2014-01-07 23:58:29 -0500] derks: but i should have known better
[2014-01-07 23:58:36 -0500] notromda: I got a ways into it using knife cookbook site install before learning about berkshelf.
[2014-01-07 23:59:20 -0500] notromda: At this point, my environment usage is small.
[2014-01-07 23:59:42 -0500] workmad3: notromda: I'd suggest grokking environments before considering a restart ;)
