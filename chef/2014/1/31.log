[2014-01-31 00:05:09 -0500] Guest79111: Hello! I've installed chef 11.8.2 on a vagrant ubuntu 13.10 machine with vagrant-omnibus, but the chef-solo runs out of memory with an empty run list . I keep getting this [2014-01-30T23:55:30+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process terminated by signal 9 (KILL)
[2014-01-31 00:08:03 -0500] Guest79111: anyone been able to get chef 11.8.2 to run on ubuntu 13.10 ?
[2014-01-31 00:08:53 -0500] coderanger: Guest79111: How much RAM does the system have?
[2014-01-31 00:09:26 -0500] Guest79111: The virtual machine has 2048 MB of ram. I also bumped it up to 4096 MB, but it still runs out of memory
[2014-01-31 00:09:51 -0500] coderanger: Where are you seeing that its killed due to OOM?
[2014-01-31 00:10:35 -0500] Guest79111: @coderanger: Yes, theres an OOM error message that shows up in syslog
[2014-01-31 00:10:43 -0500] coderanger: Can you pastebin the log?
[2014-01-31 00:10:49 -0500] coderanger: It should show what else is using RAM
[2014-01-31 00:15:25 -0500] Guest79111: @coderanger: here it is http://pastebin.com/pyX4n33p
[2014-01-31 00:17:59 -0500] coderanger: Guest79111: Whats your vagrantfile look like?
[2014-01-31 00:18:13 -0500] acts_as_coder: Can anyone point me to info on how to pre-compile Ruby binaries for application servers and having Chef install those instead of building Ruby from src on each application server?
[2014-01-31 00:18:21 -0500] coderanger: acts_as_coder: FUNNY STORY
[2014-01-31 00:18:25 -0500] coderanger: acts_as_coder: I did it for you
[2014-01-31 00:18:36 -0500] robawt: wow talk about service coderanger
[2014-01-31 00:18:41 -0500] coderanger: acts_as_coder: https://github.com/poise/poise-ruby
[2014-01-31 00:19:52 -0500] coderanger: acts_as_coder: If you really want to build it yourself for whatever reason, https://github.com/coderanger/kitchen-rubies is the build lab
[2014-01-31 00:21:07 -0500] bahamas10: coderanger: node.run_context.resource_collection seems to be exactly what i want.. but it appears to only show the provider as a resource... i can't get the template path out of it (as that is not available at runtime)
[2014-01-31 00:21:19 -0500] bahamas10: regardless, this will be enough info to create the correct path
[2014-01-31 00:21:37 -0500] acts_as_coder: coderanger: awesome links. I'd been struggling to track something like this down. I always seemed to end up with rvm or rbenv resources, which I want to get away from on my servers.
[2014-01-31 00:22:46 -0500] coderanger: bahamas10: .each do {|r| if r.is_a?(Chef::Resource::MyLwrp); do something; end }
[2014-01-31 00:24:35 -0500] coderanger: acts_as_coder: Yeah, compiling ruby in prod needs to DIAF
[2014-01-31 00:25:50 -0500] coderanger: (also compiling everything else)
[2014-01-31 00:29:20 -0500] acts_as_coder: coderanger: So then I just make sure the omnibus ruby is the first ruby my user account finds in its path? I've become to dependent on rvm/rbenv I've forgotten all the stuff they are hiding from me!
[2014-01-31 00:29:36 -0500] coderanger: acts_as_coder: I always do it explicitly
[2014-01-31 00:29:57 -0500] coderanger: https://github.com/poise/berkshelf-api/blob/master/templates/default/sv-berkshelf-api-run.erb#L3
[2014-01-31 00:29:59 -0500] coderanger: and so on
[2014-01-31 00:30:41 -0500] coderanger: similarly https://github.com/poise/berkshelf-api/blob/master/libraries/berkshelf_api.rb#L193-L194
[2014-01-31 00:30:55 -0500] acts_as_coder: coderanger: what about stuff like rake, bundler, etc. that I might want to run interactively? Then I just need to export it in my shell, right?
[2014-01-31 00:31:16 -0500] acts_as_coder: I mean, I know that will work but just wondering if I'm approaching this the wrong way.
[2014-01-31 00:31:51 -0500] coderanger: acts_as_coder: Yeah
[2014-01-31 00:32:36 -0500] coderanger: acts_as_coder: I just wouldn't do that by default in favor of explicitly running /opt/ruby-210/bin/rake or something
[2014-01-31 00:33:44 -0500] coderanger: acts_as_coder: But theres no magic, its really just Ruby in a package and nothing else
[2014-01-31 00:36:43 -0500] bahamas10: coderanger: great, thanks for all your help.. i got it all working!
[2014-01-31 00:50:46 -0500] acts_as_coder: coderanger: mind commenting on using apt to distribute these builds instead of, say, a tarball? Totally honest/clueless question - no judgement on the decision!
[2014-01-31 00:51:02 -0500] coderanger: acts_as_coder: Why would I not use apt?
[2014-01-31 00:51:27 -0500] coderanger: Native package systems have nice integration with tools, handle upgrades, etc
[2014-01-31 00:52:10 -0500] acts_as_coder: coderanger: Hmmm... good point. Well, for me I'll need to build some weird ruby versions for some of our apps that will not be in your apt repository so then I think I'd need to create my own apt server?
[2014-01-31 00:52:22 -0500] coderanger: acts_as_coder: "apt server" == S3 bucket
[2014-01-31 00:52:26 -0500] coderanger: thats what I'm using anyway
[2014-01-31 00:52:44 -0500] coderanger: Another one of my projects https://pypi.python.org/pypi/depot
[2014-01-31 00:52:52 -0500] acts_as_coder: Ah, I see. Remember how I prefaced my question with "clueless"? ;)
[2014-01-31 00:52:53 -0500] coderanger: a cloud-aware apt (and soon yum) repo manager
[2014-01-31 00:53:28 -0500] coderanger: acts_as_coder: If you are looking for a more full stack solution, I can point you at better resources
[2014-01-31 00:53:55 -0500] acts_as_coder: coderanger: Will dig into the code a little deeper, but already using poise-ruby in my Vagrant box and trying it out!
[2014-01-31 00:54:31 -0500] coderanger: acts_as_coder: https://github.com/balanced-cookbooks/balanced-ci/blob/master/templates/default/commands/build.sh.erb is how we do production app builds for Balanced :)
[2014-01-31 00:55:25 -0500] coderanger: acts_as_coder: and https://github.com/balanced/omnibus-balanced is all our omnibus defs
[2014-01-31 00:59:08 -0500] acts_as_coder: coderanger: Awesome, thanks. Will study up on all this.
[2014-01-31 01:02:16 -0500] acts_as_coder: coderanger: Ok, I lied... in this context what are you calling a "package"? Are you creating omnibus packages with *all* the dependencies to run a specific application?
[2014-01-31 01:02:24 -0500] coderanger: acts_as_coder: YEp
[2014-01-31 01:13:05 -0500] acts_as_coder: coderanger: wait a second... "[2014-01-31T01:12:04+00:00] INFO: rbenv_ruby[1.9.3-p484] is building, this may take a while..." inside the Vagrant box for omnibus-balanced!? Why not poise-ruby ;)
[2014-01-31 01:13:38 -0500] coderanger: acts_as_coder: it uses the upstream omnibus cookbook
[2014-01-31 01:13:59 -0500] coderanger: https://github.com/balanced-cookbooks/balanced-omnibus/blob/master/recipes/default.rb#L22
[2014-01-31 01:13:59 -0500] coderanger: :-)
[2014-01-31 01:14:09 -0500] coderanger: thats the actual recipe we use for our build VMs
[2014-01-31 01:14:53 -0500] acts_as_coder: haha, nice.
[2014-01-31 02:00:39 -0500] axsuul: how does chef server know what node's ip is?
[2014-01-31 02:00:52 -0500] axsuul: or why dont you need to specify it?
[2014-01-31 02:07:59 -0500] coderanger: axsuul: ohai
[2014-01-31 02:08:15 -0500] coderanger: it scrapes lots of info off the server and massages it into standard formats
[2014-01-31 02:08:57 -0500] axsuul: coderanger: i'm trying to udnerstand this before I go with chef-server, so when I add a node, I don't specify its ip address?
[2014-01-31 02:09:18 -0500] coderanger: No, the server doesn't care what the nodes IP is
[2014-01-31 02:09:38 -0500] axsuul: coderanger: then how does it know which vps is the node?
[2014-01-31 02:11:52 -0500] coderanger: chef-client is running on the node, it does eveyrthing
[2014-01-31 02:12:21 -0500] axsuul: coderanger: oh so on the vps, i have to connect chef-client to the server?
[2014-01-31 02:13:05 -0500] coderanger: Yes, chef-client is the thing that does all the stuff, it contacts chef-server for its config in a pull-driven way
[2014-01-31 02:13:58 -0500] axsuul: coderanger: cool thanks
[2014-01-31 02:14:22 -0500] regork: Hi, does anyone know what node.transform does?
[2014-01-31 02:17:00 -0500] coderanger: regork: It lets you do map operations on nodes via knife exec
[2014-01-31 02:17:38 -0500] regork: so, it's analogous to map function in many languages that accepts an array/list and performs some operation on each element?
[2014-01-31 02:18:05 -0500] coderanger: Basically
[2014-01-31 02:18:44 -0500] regork: cool! I'm trying to reset an existing attribute via knife without having to edit the whole node.
[2014-01-31 02:25:45 -0500] regork: Also, is there a way to tell what the version of chef-client is on a node? I've tried chef_packages.chef.version but it doesn't seem 100% reliable.
[2014-01-31 02:28:09 -0500] coderanger: regork: chef-client --version
[2014-01-31 02:28:18 -0500] coderanger: Unless you mean inside chef
[2014-01-31 02:28:37 -0500] coderanger: in which case, Chef::VERSION
[2014-01-31 02:30:28 -0500] regork: this is from the workstation, using knife
[2014-01-31 02:31:15 -0500] helfire: i hacked together a script to wrap kitchen to use it without a system ruby (just using vagrant) I made a hacked up thing: http://erichelgeson.github.io/blog/2014/01/30/cellophane-a-hacked-up-kitchen-vagrant-berkshelf/
[2014-01-31 02:32:30 -0500] regork: I learned about this attribute from: http://dougireton.com/blog/2013/01/19/get-chef-clients-by-version/
[2014-01-31 02:34:32 -0500] regork: @hellfire: looks interesting, though those backticks on command line don't seem right
[2014-01-31 02:34:59 -0500] helfire: that just evals the command
[2014-01-31 02:35:09 -0500] helfire: just what i'm used too, there's other ways
[2014-01-31 02:35:35 -0500] helfire: Thanks for that command, looks like i have a few 11.6.2 servers out there still :)
[2014-01-31 02:36:31 -0500] teukka: helfire: `vagrant plugin install bundler` also adds it to vagrant's plugin.json, which should be harmless but still a bit wrong. it gets listed in `vagrant plugin list`
[2014-01-31 02:36:34 -0500] regork: ./kitchenw converge` (these backticks)
[2014-01-31 02:36:57 -0500] helfire: oh whooops, those were formatting before i put it in markdown
[2014-01-31 02:37:24 -0500] regork: incidentally, speaking of 11.6 clients, are they somehow more chatty than 11.4 clients? We're seeing some strangeness at our own Chef backend servers.
[2014-01-31 02:37:47 -0500] helfire: teukka: ya i hope bundler is harmeless, had a few issues running the gems and getting it to install right
[2014-01-31 02:37:50 -0500] teukka: helfire: you could install it with `.../embedded/bin/gem install bundler --install-dir ~/.vagrant.d/gems` or something
[2014-01-31 02:38:03 -0500] teukka: helfire: and vagrant 1.5 will already come with bundler
[2014-01-31 02:38:03 -0500] regork: couchdb compaction errors, etc.
[2014-01-31 02:38:37 -0500] helfire: teukka: yup, i wonder how that will work with plugins, eg if you could make a test-kitchen plugin and keep the gems isolated
[2014-01-31 02:39:43 -0500] helfire: regork: we dont have enough nodes to notice :)
[2014-01-31 02:40:10 -0500] teukka: helfire: no, it generates a Gemfile which includes all plugins. all is still installed to same place and loaded
[2014-01-31 02:40:37 -0500] regork: @hellfire and @coderanger: thanks, gotta run
[2014-01-31 02:40:45 -0500] teukka: helfire: the biggest thing is to catch conflicts while installing the plugins, not at runtime
[2014-01-31 02:41:56 -0500] teukka: helfire: and it should also be able to install compatible dependencies while installing a plugin. current version can upgrade some and then another old plugin breaks at run time
[2014-01-31 02:42:41 -0500] teukka: helfire: interesting thing you made anyway =)
[2014-01-31 02:43:06 -0500] helfire: haha, "interesting"
[2014-01-31 02:45:21 -0500] teukka: well, I've been messing with vagrant's gem storage more than enough myself. especially now when the master is not very compatible with old installer ;)
[2014-01-31 03:10:30 -0500] ctracey: anyone have thoughts on percona xtradb cluster cookbooks?
[2014-01-31 03:10:46 -0500] ctracey: looks like the community cookbook for cluster is deprecated
[2014-01-31 04:54:55 -0500] cnk_: Any opinions about this TDD blog post http://leopard.in.ua/2013/12/01/chef-and-tdd/ ?
[2014-01-31 04:55:36 -0500] cnk_: seems sensible but I haven't done much chef so I have a way to gauge it
[2014-01-31 05:06:01 -0500] jchauncey: cnk_: yes its a pretty good post
[2014-01-31 05:06:26 -0500] jchauncey: cnk_: but instead of bats we use serverspec which seems to be more widely accepted now than bats for chef testing (but i could be wrong)
[2014-01-31 05:06:39 -0500] cnk_: thanks.
[2014-01-31 05:06:41 -0500] jchauncey: cnk_: if you arent testing your cookbooks you're doing it wrong
[2014-01-31 05:06:43 -0500] jchauncey: =)
[2014-01-31 05:06:55 -0500] cnk_: I was actually considering just going with mintiest
[2014-01-31 05:07:28 -0500] cnk_: I was following the TDD with Chef book but it has some gaps - like how to set up the unit tests
[2014-01-31 05:11:05 -0500] jchauncey: https://github.com/RallySoftware-cookbooks/chef-tutorials/tree/master/examples/search
[2014-01-31 05:11:11 -0500] jchauncey: you can use that as a base if you like
[2014-01-31 05:11:23 -0500] cnk_: thank you!
[2014-01-31 05:11:25 -0500] jchauncey: pull it down, run bundle install, then rake test
[2014-01-31 05:12:10 -0500] jchauncey: it uses a gem that my company built that installs things like test-kitchen, berkshelf, etc.. but it "should" work =P
[2014-01-31 05:13:09 -0500] jchauncey: i find that minitest is really hard to read for some reason
[2014-01-31 05:13:29 -0500] jchauncey: serverspec is much cleaner and you can use them later as verification taht your system is converged correctly
[2014-01-31 05:13:42 -0500] jchauncey: (you can execute serverspec tests against a remote host using ssh)
[2014-01-31 05:13:53 -0500] cnk_: I'll have to see in the infrastructure context but I like it better than rspec because it reads like code not english
[2014-01-31 05:16:17 -0500] cnk_: hmm that sounds quite attractive - checking up on the real thing
[2014-01-31 06:52:48 -0500] Abhishek_: What is the best way to manage multiple application environments like dev, test , stag, prod in multidata center using chef? How we can manage environment specific configuration in chef for multi datacenter application?
[2014-01-31 08:45:48 -0500] aanglade: Good morning everyone
[2014-01-31 08:47:10 -0500] aanglade: i am trying to set-up chef server on an ubuntu server 12.04, and i get a failure on postgresql createdb. Can anyone give me a hint on how to fix this ?
[2014-01-31 08:47:19 -0500] aanglade: "Error executing action `run` on resource 'execute[/opt/chef-server/embedded/bin/createdb -T template0 -E UTF-8 opscode_chef]'"
[2014-01-31 08:53:04 -0500] flaccid: aanglade: you could run the command in shell to see what teh problem is
[2014-01-31 09:18:31 -0500] shay-: hey guys. I am using centos6 and have the following reproducable problem: I have a service running. If I do a ssh <servername> "service watcher restart" it works. But if I run knife ssh "name:<servername>" "service watcher restart" and then do service watcher status on the server itself I get: watcher dead but subsys locked
[2014-01-31 09:18:34 -0500] shay-: any idea? :/
[2014-01-31 09:27:06 -0500] Abhishek: Hi Guys , is there any to pass custom attributes during chef-client run  the way we can do it in puppet like FACTER_releaseversion=1.1.0 ?
[2014-01-31 09:44:52 -0500] m4rcu5: ohai chefs
[2014-01-31 09:48:59 -0500] m4rcu5: is there a way to limit uploading cookbooks to a single client only? (im looking to upload cookbooks by git hook, and this should be the only way that cookbooks are uploaded)
[2014-01-31 09:49:57 -0500] ocholetras: any authorized client, can upload cookbooks
[2014-01-31 09:50:01 -0500] ocholetras: AFAIK
[2014-01-31 09:50:18 -0500] ocholetras: sorry, admin client i think
[2014-01-31 09:50:21 -0500] ocholetras: not sure O_o
[2014-01-31 09:50:51 -0500] m4rcu5: yes, but normal client cant add clients iirc
[2014-01-31 09:52:42 -0500] aanglade: flaccid: i found what the problem was, my postgresql was locked by another tool. i changed to another vm, and it worked
[2014-01-31 09:55:34 -0500] Abhishek: Hi Guys , is there any to pass custom attributes during chef-client run  the way we can do it in puppet like FACTER_releaseversion=1.1.0 ?
[2014-01-31 09:56:07 -0500] ocholetras: atomic-penguin: re u ther?
[2014-01-31 09:57:05 -0500] ocholetras: Abhishek: what you mean with custom attributes?
[2014-01-31 09:57:21 -0500] ocholetras: and by the way, what you mean by during chef-run?
[2014-01-31 09:57:45 -0500] ocholetras: You set your attributes on attribute files, recipes, roles whatever..
[2014-01-31 09:57:50 -0500] ocholetras: what else do yo ned?
[2014-01-31 09:57:53 -0500] ocholetras: need*
[2014-01-31 09:58:32 -0500] ocholetras: If you want to change an attribute dynamically, you can do on recipes but be carefull about the order of execution, all recipes on a runlist are executed in order.
[2014-01-31 09:59:12 -0500] shay-: hey guys. I am using centos6 and have the following reproducable problem: I have a service running. If I do a ssh <servername> "service watcher restart" it works. But if I run knife ssh "name:<servername>" "service watcher restart" and then do service watcher status on the server itself I get: watcher dead but subsys locked. any idea?
[2014-01-31 09:59:33 -0500] Abhishek: hey ocholetras: my requirement is to pass release_version attribute during my chef-client run on node and i do not wants to hard code release_version in my cookbook or roles?
[2014-01-31 10:00:13 -0500] ocholetras: from where do you get that value?
[2014-01-31 10:00:17 -0500] ocholetras: by hand?
[2014-01-31 10:00:21 -0500] Abhishek: yeah
[2014-01-31 10:01:01 -0500] ocholetras: omg
[2014-01-31 10:01:13 -0500] ocholetras: ho many releases do you have?
[2014-01-31 10:01:15 -0500] ocholetras: how*
[2014-01-31 10:01:18 -0500] Abhishek: like in puppet people can set facts from command line like FACTER_release_version=1.0.0 puppet agent -t
[2014-01-31 10:01:50 -0500] Abhishek: i mean this is dynamic value and it will keep changing for every release
[2014-01-31 10:02:14 -0500] ocholetras: You have to have some control about your deployment so this release version cant be a crazy changing thing...
[2014-01-31 10:02:23 -0500] ocholetras: have to have some sense ...
[2014-01-31 10:02:30 -0500] ocholetras: new software release
[2014-01-31 10:02:31 -0500] ocholetras: ?
[2014-01-31 10:02:50 -0500] ocholetras: because if you use that number to identify your diferents implementations of a deployment
[2014-01-31 10:02:54 -0500] ocholetras: that would be cookbook version
[2014-01-31 10:03:05 -0500] ocholetras: and you can set versions on runlists
[2014-01-31 10:03:11 -0500] ocholetras: and on include_recipe
[2014-01-31 10:03:26 -0500] Abhishek: btw it is not my cookbook version it is my application version
[2014-01-31 10:03:33 -0500] Abhishek: that is getting deployed using chef
[2014-01-31 10:03:37 -0500] ocholetras: so your aplication changes every day?
[2014-01-31 10:03:42 -0500] Abhishek: yeah
[2014-01-31 10:03:52 -0500] ocholetras: and you are pining versions every day? xd
[2014-01-31 10:04:04 -0500] ocholetras: Normaly you have a stable release
[2014-01-31 10:04:07 -0500] Abhishek: and probably chances are we have to deploy new versions every hour
[2014-01-31 10:04:22 -0500] ocholetras: But you have a stable release
[2014-01-31 10:04:25 -0500] Abhishek: for every new fix version will change
[2014-01-31 10:04:26 -0500] ocholetras: right?
[2014-01-31 10:04:31 -0500] Abhishek: yeah stable release
[2014-01-31 10:04:41 -0500] ocholetras: So you always clone that release, right?
[2014-01-31 10:05:24 -0500] Abhishek: ocholetras my question is very simple is it possible to pass custom attribute using knife or chef-client ?
[2014-01-31 10:05:41 -0500] ocholetras: The answer is not, AFAIK
[2014-01-31 10:05:51 -0500] Abhishek: so that i can use that attribute in my recipe to take some decisioning
[2014-01-31 10:05:58 -0500] ocholetras: but you should ask yourself what is the reason you need to do such a thing..
[2014-01-31 10:06:10 -0500] ocholetras: because automation is thinked to be automatic..
[2014-01-31 10:06:10 -0500] Abhishek: yeah there is reason
[2014-01-31 10:06:23 -0500] ocholetras: so if you need a human behind the keyboard..
[2014-01-31 10:06:35 -0500] ocholetras: you probably are doing something wrong with automation
[2014-01-31 10:06:39 -0500] ocholetras: IMO
[2014-01-31 10:06:41 -0500] ocholetras: ^^
[2014-01-31 10:06:57 -0500] ocholetras: anyway
[2014-01-31 10:07:05 -0500] Abhishek: but what if you wants to some controlled deployment
[2014-01-31 10:07:09 -0500] drrk: Abhishek: I would put the version in a attribute in the role, then update that attribute when you want to change version
[2014-01-31 10:07:11 -0500] ocholetras: You can check file existense, get an URL on a recipe and take some decisioning
[2014-01-31 10:07:27 -0500] ocholetras: With chef
[2014-01-31 10:07:33 -0500] ocholetras: you control the deployment
[2014-01-31 10:07:36 -0500] ocholetras: it is idempotent
[2014-01-31 10:07:37 -0500] Abhishek: i know i can use databags for this
[2014-01-31 10:07:44 -0500] ocholetras: and you say what is going to be done..
[2014-01-31 10:08:04 -0500] Abhishek: but i just wanted to see if it possible to pass something from command line like people can do in puppet
[2014-01-31 10:08:05 -0500] ocholetras: and you can freeze versions and have a production environment where everything works great
[2014-01-31 10:08:28 -0500] ocholetras: AFAIK it is not possible to do that with chef
[2014-01-31 10:09:21 -0500] ocholetras: If you develop a software the release version is on some cvs system.
[2014-01-31 10:09:28 -0500] ocholetras: so you can clone stable branch
[2014-01-31 10:09:47 -0500] ocholetras: you normaly have production, staging and testing..
[2014-01-31 10:10:17 -0500] ocholetras: and with that you can check things is working..
[2014-01-31 10:10:40 -0500] Abhishek: guys let me explain what i am doing
[2014-01-31 10:12:49 -0500] jonlives: Abhishek: there isn't a way with chef to pass specific attributes to the run at run_time.
[2014-01-31 10:12:56 -0500] jonlives: simple answer.
[2014-01-31 10:13:04 -0500] jonlives: you can however set attributes in a variety of other places.
[2014-01-31 10:14:17 -0500] Abhishek: my code base is in github and we use jenkins to generate rpms and rpms will have different release version everytime and jenkins pushes rpms to our custom repo , after that we have to deploy application on dev env ( there may be 2-3 deployments in dev env in a single day ) . now if i put release_version in attributes.rb in my cookbook or modify role to change attributes then it becomes manual as well and for one simple attribute chan
[2014-01-31 10:14:20 -0500] Abhishek: cookbook
[2014-01-31 10:14:31 -0500] Abhishek: that i do not think is good idea?
[2014-01-31 10:15:04 -0500] drrk: jenkins can update an attibute in a role?
[2014-01-31 10:15:25 -0500] Abhishek: using API?
[2014-01-31 10:15:48 -0500] drrk: it's just a file that needs editing
[2014-01-31 10:16:02 -0500] drrk: then a knife role from file blah.json
[2014-01-31 10:16:20 -0500] jonlives: Abhishek: so the app version just tells Chef what version of the rpm to download and install?
[2014-01-31 10:16:31 -0500] Abhishek: yeah that is the question for one simple dynamic attribute why should i modify role
[2014-01-31 10:16:36 -0500] Abhishek: yeah @jonlives
[2014-01-31 10:17:20 -0500] jonlives: Abhishek: my suggestion would be to have jenkins write out the current RPM version to a text file on a server, then use the remote_file resource to download that file onto each node, extract the version number and pass it to the package resource.
[2014-01-31 10:17:25 -0500] jonlives: something along those lines.
[2014-01-31 10:18:31 -0500] Abhishek: jonlives i think databags makes more sense if chef do not support custom attribute
[2014-01-31 10:18:47 -0500] jonlives: Abhishek: sure, you could add it to a databag too
[2014-01-31 10:18:54 -0500] Abhishek: that way we can use API to update version number in databag
[2014-01-31 10:18:59 -0500] jonlives: absolutely
[2014-01-31 10:19:17 -0500] jonlives: just you didn't seem keen on doing that with roles so I perhaps falsely assumed you didn't want to use the API
[2014-01-31 10:19:55 -0500] jonlives: Abhishek: tho we might be able to do this more simply - do you essentially always want chef to use the *latest* rpm version available in the repo?
[2014-01-31 10:20:06 -0500] jonlives: or are there sometimes more recent rpms you don't want to deploy yet?
[2014-01-31 10:20:08 -0500] Abhishek: not really
[2014-01-31 10:20:39 -0500] jonlives: Abhishek: cos you could always use the package resource with :upgrade if you want the latest, but that of course gives you less control.
[2014-01-31 10:20:41 -0500] Abhishek: yeah sometimes possibly we will have mutiple dev env and all using same repo system then latest do not make sense
[2014-01-31 10:21:02 -0500] jonlives: ah fair enough
[2014-01-31 10:21:15 -0500] jonlives: Abhishek: yeah data bag item is probably your best bet then
[2014-01-31 10:21:30 -0500] Abhishek: but i feel chef should have FACTER kind of thing
[2014-01-31 10:21:37 -0500] Abhishek: that makes things very easy
[2014-01-31 10:22:13 -0500] jonlives: Abhishek: the closest approximation to that would be an ohai plugin which fetched the build version from somewhere and set it as an attribute.
[2014-01-31 10:22:38 -0500] jonlives: which would happen before any recipes ran etc.
[2014-01-31 10:23:03 -0500] Abhishek: but does ohai provides setting attribute from command line
[2014-01-31 10:23:04 -0500] Abhishek: ?
[2014-01-31 10:23:26 -0500] jonlives: Abhishek: nope, it runs on the node as part of the chef run
[2014-01-31 10:23:40 -0500] Abhishek: yeah for that i need to write ohai custom plugins
[2014-01-31 10:23:47 -0500] jonlives: yeah
[2014-01-31 10:23:51 -0500] jonlives: it's not hard though :)
[2014-01-31 10:23:58 -0500] Abhishek: yeah agreed
[2014-01-31 10:24:27 -0500] jonlives: Abhishek: injecting data on the command line (unless it's overriding the run_list) isn't really the "chef" way of doing things
[2014-01-31 10:25:05 -0500] jonlives: tho I can see your use case for doing so, certainly.
[2014-01-31 10:26:15 -0500] Abhishek: does chefserver uses always latest cookbook from chefserver? suppose i have two versions of cookbook on chefserver but i want to make sure node should use one specific cookbook version for controlled changes on nodes how can i do this?
[2014-01-31 10:26:44 -0500] jonlives: Abhishek: that's where environments are your friend
[2014-01-31 10:26:55 -0500] jonlives: Abhishek: environments let you set version constraints for cookbooks
[2014-01-31 10:27:35 -0500] jonlives: Abhishek: at Etsy we use https://github.com/jonlives/knife-flip for moving nodes between environments, and https://github.com/jonlives/knife-spork for our general environment based workflow
[2014-01-31 10:28:43 -0500] jonlives: Abhishek: video on how it all fits together too: http://www.youtube.com/watch?v=nSnJCJiZDDU
[2014-01-31 10:29:19 -0500] Abhishek: kool thanks @jonlives i will certainly go through this video
[2014-01-31 10:30:16 -0500] jonlives: Abhishek: np :)
[2014-01-31 10:30:26 -0500] Abhishek: how do you guys maintain multiple app environments at etsy like dev, stag, prod? do you guys use chef environments or something else? as i understand chef environments are built for chef cookbook developments workflow?
[2014-01-31 10:31:31 -0500] jonlives: Abhishek: so we have production and development environments which are constrained, and we have a testing environment which gets the latest version of everything.
[2014-01-31 10:31:45 -0500] jonlives: Abhishek: we don't actually control multiple *app* environments that way
[2014-01-31 10:32:21 -0500] jonlives: Abhishek: our dev, staging and prod environments all get the same cookbook versions. we use the testing env to mess around with changes on a single node or group of nodes before pushing them out to everything
[2014-01-31 10:32:44 -0500] jonlives: and we're actually now looking at collapsing dev and prod *chef* environments into just prod because they both have the same constraints anyway :p
[2014-01-31 10:33:28 -0500] Abhishek: so it means you have different chef servers for dev , test and prod
[2014-01-31 10:33:30 -0500] Abhishek: right?
[2014-01-31 10:33:45 -0500] jonlives: Abhishek: nope, just the one chef server.
[2014-01-31 10:34:02 -0500] jonlives: Abhishek: we try to have our dev and prod servers as close to identically configured as we can.
[2014-01-31 10:34:24 -0500] jonlives: Abhishek: important note though - we don't deploy *app* code with Chef - we use https://github.com/etsy/deployinator for that
[2014-01-31 10:34:27 -0500] Abhishek: so you use roles to map the machines for specific env
[2014-01-31 10:34:41 -0500] Abhishek: oh ok got it.
[2014-01-31 10:34:51 -0500] jonlives: Abhishek: yeah should have mentioned that earlier
[2014-01-31 10:35:18 -0500] jonlives: Abhishek: once we collapse environments, *everything* will be in one constrained environment called production, unless it's been flipped into testing.
[2014-01-31 10:35:47 -0500] Abhishek: what is your take on using chef for application deployment?
[2014-01-31 10:36:20 -0500] jonlives: Abhishek: personally, and this is just personal opinion, I don't like using Chef for app deployment. I think there are better tools for doing that.
[2014-01-31 10:37:01 -0500] jonlives: there's definitely nothing to *stop* you doing app deployment with chef though, and a lot of people do it.
[2014-01-31 10:38:50 -0500] jonlives: it also helps keeps things manageable at Etsy to seperate app deploys and chef changes - we have around 70 code deploys and 20-30 chef changes per day :p
[2014-01-31 10:54:24 -0500] Abhishek: @jonlives  hey can you please share the urls again that you shared with me just few min back. somehow my webchat got unexpected error and i lost the chat that we had .
[2014-01-31 10:54:42 -0500] jonlives: Abhishek: sure: Abhishek: at Etsy we use https://github.com/jonlives/knife-flip for moving nodes between environments, and https://github.com/jonlives/knife-spork for our general environment based workflow
[2014-01-31 10:54:46 -0500] jonlives: video on how it all fits together too: http://www.youtube.com/watch?v=nSnJCJiZDDU
[2014-01-31 10:54:54 -0500] jonlives: aaand video on how it all fits together too: http://www.youtube.com/watch?v=nSnJCJiZDDU
[2014-01-31 10:54:56 -0500] jonlives: whoops
[2014-01-31 10:55:03 -0500] jonlives: important note though - we don't deploy *app* code with Chef - we use https://github.com/etsy/deployinator for that
[2014-01-31 10:55:07 -0500] jonlives: ^ that's all of 'em
[2014-01-31 10:55:41 -0500] Abhishek: Thanks a ton jonlives.
[2014-01-31 10:55:47 -0500] jonlives: np :)
[2014-01-31 12:03:09 -0500] glen: the "version constructs for cookbooks" is available only for "environments" or can be done with roles/nodes too?
[2014-01-31 12:42:06 -0500] clocKwize: hey, is there any way I can see what databags a host sees? I'm trying to access node[:elasticsearch][:users] in my recipe and its saying its nil, except my database is up to date and it contains {"id": "users", {"environment_name": {"users": [...]}}} so I don't know what its problem is
[2014-01-31 12:56:47 -0500] stchesme: hi alls. I have a trouble installing hef server. I got error when i add /etc/chef-server/chef-server.rb to override some default configuration value.
[2014-01-31 12:57:22 -0500] stchesme: i got an "ArgumentError
[2014-01-31 12:57:22 -0500] stchesme: -------------
[2014-01-31 12:57:23 -0500] stchesme: wrong number of arguments (0 for 1)"
[2014-01-31 13:12:51 -0500] nougad: Hi, I'm a chef noob but I'm looking for a short advice how to do thinks "cheflike". I want to write a cookbook for gentoo per package configuration. I wrote down the details and my problem here: http://indeedgeek.de/~feitel/tmp/cheflike_problem.html -- Its a bit of explanation but I'm only want a short advice what the most cheflike way is.
[2014-01-31 13:17:22 -0500] denniswisnia: How can I choose the internal IPs in Cookbooks?
[2014-01-31 13:32:56 -0500] ocholetras: on a lwrp when you put default value and required on a field of the resource
[2014-01-31 13:33:10 -0500] ocholetras: there is no error if you dont give a value on the resource declaration on the recipe
[2014-01-31 13:33:12 -0500] ocholetras: right?
[2014-01-31 13:34:10 -0500] denniswisnia: I want to set local_ipaddress for each node manually, how?
[2014-01-31 13:38:30 -0500] ocholetras: chef needs ip  of the node to bootstrap it
[2014-01-31 13:38:41 -0500] ocholetras: you have to manage that with other provision tool
[2014-01-31 13:39:07 -0500] ocholetras: or by hand
[2014-01-31 13:40:03 -0500] denniswisnia: yea, I have one public Address and one local
[2014-01-31 13:40:28 -0500] denniswisnia: e.g in the mysql cookbook: node.attribute?('cloud') && node['cloud']['local_ipv4'] ? node['cloud']['local_ipv4'] : node['ipaddress']
[2014-01-31 13:40:49 -0500] denniswisnia: and now I want to set the local_ipv4 attribute for node "db01" and node "db02"
[2014-01-31 13:41:01 -0500] denniswisnia: knife node edit and add a new attribute?
[2014-01-31 13:41:09 -0500] denniswisnia: he dont save the new attribute :(
[2014-01-31 13:45:48 -0500] ocholetras: it should do
[2014-01-31 13:46:31 -0500] ocholetras: Anyone knows if when putting default value + required on a LWRP resource attribute it says that is missing when executin chef clients..
[2014-01-31 13:46:39 -0500] ocholetras: it should take the default value, right?
[2014-01-31 13:46:40 -0500] ocholetras: O_o
[2014-01-31 13:47:12 -0500] denniswisnia: ocholetras: everytime i add a new attribute with "knife node edit <nodename>" and edit the file with vim he only say: "Node not updated, skipping node save"
[2014-01-31 13:49:16 -0500] ocholetras: are you using the right syntax?
[2014-01-31 13:50:21 -0500] denniswisnia: yea, sure
[2014-01-31 13:52:15 -0500] ocholetras: jimm
[2014-01-31 13:52:24 -0500] ocholetras: can you give me a pastebin example
[2014-01-31 13:52:33 -0500] ocholetras: (just to not blob the channel)
[2014-01-31 13:55:10 -0500] denniswisnia: ocholetras: yea! http://pastebin.com/znCPyukd
[2014-01-31 13:55:24 -0500] denniswisnia: (added line 4 here)
[2014-01-31 13:55:31 -0500] denniswisnia: but if i save it, no change set.
[2014-01-31 13:56:38 -0500] clocKwize: hey, is there any way I can see what databags a host sees? I'm trying to access node[:elasticsearch][:users] in my recipe and its saying its nil, except my database is up to date and it contains {"id": "users", {"environment_name": {"users": [...]}}} so I don't know what its problem is
[2014-01-31 13:58:08 -0500] laurent\: clocKwize: you don't access databag thru the node object
[2014-01-31 13:58:19 -0500] clocKwize: oh really, how does one do it?
[2014-01-31 13:58:24 -0500] ocholetras: denniswisnia: you know you have to add lines inside "normal": { } hash
[2014-01-31 13:58:28 -0500] ocholetras: right
[2014-01-31 13:58:29 -0500] clocKwize: I was copying code from another databag and it looked like they did :/
[2014-01-31 13:59:10 -0500] laurent\: clocKwize: http://docs.opscode.com/essentials_data_bags.html#with-recipes
[2014-01-31 13:59:18 -0500] clocKwize: thanks
[2014-01-31 14:02:37 -0500] clocKwize: thanks, I've got it.. laurent\ my databag has keys with the environment, how do I find the current environment to get the right part (inside a ruby_block)?
[2014-01-31 14:02:54 -0500] denniswisnia: ocholetras: damn, yea! you are right ;)
[2014-01-31 14:03:16 -0500] denniswisnia: ocholetras: the attribute is set, but the cookbook doesnt take it...
[2014-01-31 14:03:35 -0500] ocholetras: cookbook should take it
[2014-01-31 14:03:40 -0500] ocholetras: if yo do
[2014-01-31 14:03:55 -0500] ocholetras: knife node show nodename -a attribute
[2014-01-31 14:04:01 -0500] denniswisnia: node.attribute?('cloud') && node['cloud']['local_ipv4'] ? node['cloud']['local_ipv4'] : node['ipaddress']
[2014-01-31 14:04:02 -0500] ocholetras: do yo see it?
[2014-01-31 14:04:24 -0500] ocholetras: umm
[2014-01-31 14:04:31 -0500] denniswisnia: yea, i see the right attribute
[2014-01-31 14:04:48 -0500] denniswisnia: but not in the cookbook, he takes the ipaddress, also the public address,
[2014-01-31 14:04:51 -0500] ocholetras: think you should do somethin like node['cloud'].nil?
[2014-01-31 14:05:05 -0500] denniswisnia: no
[2014-01-31 14:06:29 -0500] denniswisnia: ocholetras:  ah, now it works ;)
[2014-01-31 14:06:30 -0500] denniswisnia: very great
[2014-01-31 14:11:08 -0500] laurent\: clocKwize: node.chef_environment
[2014-01-31 15:04:54 -0500] benner: does anyone suggest how to make service resource (subscribe) do not restart service if it was started in same chef-client run?
[2014-01-31 15:15:00 -0500] wamilton: anyone familiar with getting a ResourceNotFound exception for attempts to notify service[apache2] in the apache2 web_app definition ?
[2014-01-31 15:16:30 -0500] wamilton: or, more generally, does anyone know if use_inline_resources makes the apache2 web_app 'just work' when invoking it in an lwrp?
[2014-01-31 15:19:17 -0500] masterkorp: Hello chefs
[2014-01-31 15:19:29 -0500] masterkorp: $ knife node list
[2014-01-31 15:19:31 -0500] masterkorp: knifeERROR: Errno::ECONNRESET: Connection reset by peer - SSL_connect
[2014-01-31 15:19:40 -0500] masterkorp: i can't seem to connect to my chef-server
[2014-01-31 15:30:50 -0500] shlant: masterkorp: is this your own chef server?
[2014-01-31 15:32:29 -0500] masterkorp: yeah
[2014-01-31 15:33:53 -0500] cocotton: Hey all. In a cookbook, under files/default I added a directory MyDirectory, yet Chef won't go check it in for files. Does anyone know how to tell chef to seeks files in that directory too?
[2014-01-31 15:36:12 -0500] masterkorp: shlant: any ideas ?
[2014-01-31 15:37:15 -0500] shlant: masterkorp: is your knife.rb correct?
[2014-01-31 15:37:57 -0500] MattStratton: ok. i have about the stupidest question ever, and I'm blaming a lack of coffee. If I'm using knife bootstrap, how do I use this to make sure that the bootstrapped node is having chef-client run as a daemon?
[2014-01-31 15:37:58 -0500] masterkorp: yeah
[2014-01-31 15:38:19 -0500] masterkorp: Ok i found the problem by searching the logs
[2014-01-31 15:38:52 -0500] masterkorp: aparantly the built in versions of chef (nginx rabbitmq postgresql) cant live with local nginx and rabbitmq
[2014-01-31 15:38:56 -0500] masterkorp: and postgresql
[2014-01-31 15:39:01 -0500] masterkorp: which is pretty silly
[2014-01-31 15:39:08 -0500] masterkorp: but that will do for now
[2014-01-31 15:40:20 -0500] btm: MattStratton: bootstrapping just installs chef and runs it, use the chef-client cookbook to set it up to run as a daemon, http://ckbk.it/chef-client
[2014-01-31 15:40:23 -0500] jbz: MattStratton: Generally, you use a cookbook which installs and sets up the chef-client as a service on the node as part of the runlist.
[2014-01-31 15:41:09 -0500] MattStratton: duh. thanks guys :)
[2014-01-31 15:41:15 -0500] MattStratton: i told you, needed more coffee
[2014-01-31 15:41:38 -0500] jbz: MattStratton:  Not at all, it's a bit opaque.  Also...
[2014-01-31 15:42:09 -0500] shlant: is there any point in trying to automate a php upgrade on ubuntu 12.04?
[2014-01-31 15:42:34 -0500] jbz: MattStratton: One way to assign the role or cookbook containing that recipe is to use the -j (json attribute) flag on the knfie bootstrap call.  This will pass on the json string or file to the bootstrapped node that it should execute when the chef install is complete, as a one-time deal.
[2014-01-31 15:42:34 -0500] shlant: right now I have delete old repo, add new php 5.5 repo, package php upgrade, remove new repo
[2014-01-31 15:43:37 -0500] btm: cocotton: you just need to specify: source "MyDirectory/my_file" in the cookbook_file resource -- https://gist.github.com/btm/eaa29a335173a80e4364
[2014-01-31 15:43:48 -0500] workmad3: shlant: why remove the new repo?
[2014-01-31 15:44:16 -0500] shlant: workmad3: because then other packages upgrade using that repo right?
[2014-01-31 15:44:22 -0500] shlant: or at least that's what I experienced
[2014-01-31 15:44:50 -0500] cocotton: btm: Thank you
[2014-01-31 15:45:28 -0500] MattStratton: jbz Thanks!
[2014-01-31 15:45:39 -0500] workmad3: shlant: you could handle that with package pinning, although if a PPA for php 5.5 has packages in it, I'd suspect that you'd want to use those versions (otherwise I'd suspect you would have version issues with packages for old PHP alongside packages for 5.5)
[2014-01-31 15:46:20 -0500] shlant: workmad3: isn't package pinning not recommended? and then wouldn't I have to pin every package ?
[2014-01-31 15:46:40 -0500] shlant: I'm using ppa:ondrej/php5
[2014-01-31 15:47:09 -0500] workmad3: shlant: sorry, I meant apt pinning (which assigns priorities to packages from the repo to control behaviour)
[2014-01-31 15:48:58 -0500] shlant: workmad3: same thing though. apt pinning not recommended. is holding possible?
[2014-01-31 15:49:11 -0500] workmad3: shlant: I don't see why apt pinning is not recommend...
[2014-01-31 15:49:54 -0500] shlant: workmad3: something about libc6 version updates
[2014-01-31 15:50:02 -0500] workmad3: shlant: not with PPAs anyway... I can see why you would want to be careful with distro repos
[2014-01-31 15:50:11 -0500] workmad3: shlant: but a ppa exposes a really small set of packages
[2014-01-31 15:50:48 -0500] workmad3: shlant: and basically what you want is a way to add the PPA to your repos and then only install packages from it when explicitly requested, which is handled, afaik, most easily through pinning
[2014-01-31 15:50:51 -0500] shlant: workmad3: how do I use ppa's instead of repos?
[2014-01-31 15:50:56 -0500] workmad3: shlant: a ppa is a repo
[2014-01-31 15:51:06 -0500] shlant: do I use apt_repository?
[2014-01-31 15:51:25 -0500] workmad3: shlant: you just said you were using a ppa ;)
[2014-01-31 15:51:34 -0500] workmad3: shlant: ppa/ondrej/php5
[2014-01-31 15:51:39 -0500] workmad3: *ppa:
[2014-01-31 15:51:56 -0500] shlant: right now I have apt_repository using http://ppa.launchpad.net/ondrej/php5/ubuntu
[2014-01-31 15:52:25 -0500] shlant: but it seems to add all packages not just those in php
[2014-01-31 15:52:53 -0500] shlant: is there a ppa attribute for apt_repository?
[2014-01-31 15:53:05 -0500] workmad3: shlant: there's nothing wrong with how you're adding the repo
[2014-01-31 15:53:12 -0500] workmad3: shlant: a ppa is just a particular type of repo
[2014-01-31 15:53:40 -0500] workmad3: shlant: and that PHP ppa you're using is providing dependencies for PHP5.5 alongside the main packages
[2014-01-31 15:54:14 -0500] shlant: workmad3: so in a php recipe, would I add that repo and then upgrade php?
[2014-01-31 15:54:31 -0500] workmad3: shlant: that's what I'd personally do
[2014-01-31 15:55:06 -0500] shlant: would it be package 'php' do action :upgrade end?
[2014-01-31 15:55:07 -0500] workmad3: shlant: and I also would accept that it's gonna want to update some other packages, such as apache, in order to have an environment that should work with the php version in the repo
[2014-01-31 15:56:17 -0500] zeroXten: is it posible to tell what mode chef has been run in (solo, client etc) from a recipe? is the best way to check the availability of search or something?
[2014-01-31 15:57:11 -0500] workmad3: zeroXten: you have a 'Chef::Config[:solo]' that's only present in a chef-solo run, iirc
[2014-01-31 15:57:25 -0500] zeroXten: workmad3: ah cool
[2014-01-31 15:58:54 -0500] shlant: workmad3:  I am going to try your suggestion and let you know. thanks
[2014-01-31 16:04:38 -0500] techminer: Is there a chef resource for 'setfacl'?
[2014-01-31 16:05:41 -0500] btm: techminer: use the file resource and the mode attribute?
[2014-01-31 16:08:39 -0500] techminer: btm.not quite enough granularity with just mode
[2014-01-31 16:09:26 -0500] masterkorp: Guys can you help me a bit
[2014-01-31 16:09:28 -0500] masterkorp: http://pastie.org/8685848
[2014-01-31 16:09:48 -0500] btm: techminer: probable an execute resource calling setfacl with a only_if/not_if guard with getfacl then.
[2014-01-31 16:10:13 -0500] masterkorp: i can't upload any cookbooks to my server
[2014-01-31 16:10:16 -0500] btm: techminer: or do it similarly with ruby in a ruby_block.
[2014-01-31 16:10:29 -0500] techminer: btm:  right....thanks
[2014-01-31 16:12:17 -0500] masterkorp: /usr/lib/ruby/2.0.0/net/http.rb:878:in `initialize': getaddrinfo: Name or service not known (SocketError)
[2014-01-31 16:12:22 -0500] masterkorp: i get this error
[2014-01-31 16:12:46 -0500] masterkorp: but other commands seems to authenticate fine
[2014-01-31 16:12:58 -0500] masterkorp: the repo is empty
[2014-01-31 16:13:38 -0500] masterkorp: knifeUploading apt          [2.3.4]
[2014-01-31 16:13:40 -0500] masterkorp: ERROR: Network Error: getaddrinfo: Name or service not known
[2014-01-31 16:13:53 -0500] masterkorp: if i upload a single cookbook i get this
[2014-01-31 16:16:06 -0500] shlant: masterkorp: run the knife command with -VV
[2014-01-31 16:17:08 -0500] masterkorp: http://pastie.org/8685869
[2014-01-31 16:18:02 -0500] masterkorp: its using a wrong link
[2014-01-31 16:18:22 -0500] masterkorp: 7 chef_server_url          'https://boobierack.masterkorp.net:443'
[2014-01-31 16:18:37 -0500] masterkorp: is the link i set on the knife rb
[2014-01-31 16:18:39 -0500] masterkorp: hmm
[2014-01-31 16:18:44 -0500] masterkorp: shlant: any ideas ?
[2014-01-31 16:19:31 -0500] masterkorp: why is not using the correct url ?
[2014-01-31 16:19:51 -0500] masterkorp: why
[2014-01-31 16:19:52 -0500] masterkorp: INFO: Uploading /home/masterkorp/Documents/projects/private/chef-repo/cookbooks/apt/attributes/default.rb (checksum hex = 0190aa56b0c88a2cd2e856f6aa181cac) to https://boobierack:443/bookshelf/organization-00000000000000000000000000000000/checksum-0190aa56b0c88a2cd2e856f6aa181cac?AWSAccessKeyId=fb7e9a14cf43de787b4e404bd0066af76c119bb0&Expires=1391185903&Signature=MMYsh4o6tjBtFNPExLkEPrutNq0%3D
[2014-01-31 16:20:40 -0500] shlant: masterkorp: have you seen this?
[2014-01-31 16:20:41 -0500] shlant: http://stackoverflow.com/questions/18870361/unable-to-upload-cookbook-from-knife-to-chef-server
[2014-01-31 16:21:11 -0500] btm: masterkorp: Chef 11 server? make sure 'hostname -f' on your chef server is returning the full fqdn, potentially set api_fqdn in /etc/chef-server/chef-server.rb and run "sudo chef-server-ctl reconfigure" on the server. http://docs.opscode.com/config_rb_chef_server.html
[2014-01-31 16:21:46 -0500] masterkorp: btm: hmm, its seems its this problem
[2014-01-31 16:23:03 -0500] btm: masterkorp: check that your /etc/hosts has an fqdn on the same line as your shortname.
[2014-01-31 16:24:21 -0500] masterkorp: i edited it, how do I make the changes effective without a reboot ?
[2014-01-31 16:24:45 -0500] btm: masterkorp: you edited /etc/hosts?
[2014-01-31 16:25:17 -0500] masterkorp: yeah
[2014-01-31 16:25:26 -0500] masterkorp: i added the fqdn
[2014-01-31 16:25:33 -0500] btm: masterkorp: depends on your platform. newer ubuntu: "sudo start hostname" should work
[2014-01-31 16:27:05 -0500] masterkorp: its debian 7
[2014-01-31 16:27:35 -0500] laurent\: /etc/init.d/hostname.sh then
[2014-01-31 16:27:44 -0500] masterkorp: also i have no config.rb on /etc/chef-server
[2014-01-31 16:27:55 -0500] masterkorp: i have /etc/chef/server.rb tough
[2014-01-31 16:28:03 -0500] masterkorp: maybe this was older chef ?
[2014-01-31 16:30:20 -0500] masterkorp: boobierack# /etc/init.d/hostname.sh
[2014-01-31 16:30:23 -0500] masterkorp: boobierack# hostname -f
[2014-01-31 16:30:25 -0500] masterkorp: boobierack
[2014-01-31 16:30:27 -0500] masterkorp: :(
[2014-01-31 16:30:53 -0500] masterkorp: 127.0.0.1 boobierack boobierack.masterkorp.net
[2014-01-31 16:31:01 -0500] masterkorp: i edited etc hosts like this
[2014-01-31 16:31:34 -0500] laurent\: hostname is set in /etc/hostname
[2014-01-31 16:32:56 -0500] masterkorp: same
[2014-01-31 16:33:21 -0500] btm: laurent\: his hostname is technically correct, but no fqdn.
[2014-01-31 16:33:34 -0500] masterkorp: boobierack# cat /etc/hostname
[2014-01-31 16:33:37 -0500] masterkorp: boobierack.masterkorp.net
[2014-01-31 16:33:39 -0500] masterkorp: boobierack# /etc/init.d/hostname.sh
[2014-01-31 16:33:41 -0500] masterkorp: boobierack# hostname -f
[2014-01-31 16:33:43 -0500] masterkorp: boobierack
[2014-01-31 16:33:45 -0500] masterkorp: ooops sorry pastie script fail
[2014-01-31 16:33:47 -0500] btm: masterkorp: /etc/init.d/hostname.sh start
[2014-01-31 16:33:54 -0500] masterkorp: yeah i did start
[2014-01-31 16:34:26 -0500] btm: masterkorp: run dnsdomainname
[2014-01-31 16:34:41 -0500] laurent\: and what if you swap the order in your /etc/hosts
[2014-01-31 16:34:50 -0500] laurent\: ip fqdn shortname
[2014-01-31 16:34:53 -0500] masterkorp: btm: dnsdomainname ?
[2014-01-31 16:34:57 -0500] laurent\: instead of ip shortname fqdn
[2014-01-31 16:35:07 -0500] btm: masterkorp: what laurent\ just said, the order is wrong in your hosts file.
[2014-01-31 16:35:16 -0500] masterkorp: laurent\: i could try that
[2014-01-31 16:35:22 -0500] laurent\: do it ! :-)
[2014-01-31 16:35:33 -0500] btm: masterkorp: it should be: ip_address fqdn nickname nickname nickname nickname...
[2014-01-31 16:36:11 -0500] masterkorp: done
[2014-01-31 16:36:21 -0500] masterkorp: no dnsdomainname returns masterkorp.net
[2014-01-31 16:36:29 -0500] masterkorp: but same error on knife
[2014-01-31 16:37:07 -0500] masterkorp: ran a reconfigure and restart
[2014-01-31 16:37:08 -0500] phutchins: Anyone know of a way to manage a chef-solo coobkook repo with Berkshelf? I.E. I have a repo that contains a bunch of cookbooks (that are not their own git repos) that is picked up by Amazon OpsWorks. I would like to keep each of these cookbooks in their own repo and use berks install to update all of the cookbooks in that directory then commit my changes.
[2014-01-31 16:37:14 -0500] btm: masterkorp: dpkg -l | grep chef-server
[2014-01-31 16:37:20 -0500] masterkorp: 'boobierack# hostname -f
[2014-01-31 16:37:22 -0500] masterkorp: boobierack.masterkorp.net
[2014-01-31 16:37:39 -0500] phutchins: I've noticed that if i use berks install --path . it seems to nuke everything in the current dir and drops the cookbooks in. I dont' want it to nuke my Berksfile tho :)
[2014-01-31 16:37:44 -0500] laurent\: hey hey, one step at a time :)
[2014-01-31 16:38:09 -0500] masterkorp: http://pastie.org/8685925
[2014-01-31 16:38:31 -0500] masterkorp: hmm it seems i still have old chef parts installed
[2014-01-31 16:38:43 -0500] btm: masterkorp: sudo chef-server-ctl reconfigure
[2014-01-31 16:39:02 -0500] masterkorp: i did
[2014-01-31 16:39:05 -0500] teukka: masterkorp: you'll want 127.0.0.1 to resolve to localhost. on debianoids the normal way is to have then `127.0.1.1 blaa.domain.tld blaa` entry
[2014-01-31 16:39:07 -0500] masterkorp: ok, now it works
[2014-01-31 16:39:31 -0500] masterkorp: i guess i had to wait for erchef to come back up
[2014-01-31 16:39:34 -0500] btm: masterkorp laurent\ (highfive)
[2014-01-31 16:39:35 -0500] masterkorp: thanks guys
[2014-01-31 16:40:19 -0500] laurent\: :-)
[2014-01-31 16:40:49 -0500] masterkorp: thanks you guys
[2014-01-31 16:41:27 -0500] laurent\: Beers and table football, T-20minutes :)
[2014-01-31 16:41:42 -0500] laurent\: i might leave early now you've mentionned beer :)
[2014-01-31 16:42:32 -0500] gleam: bash -c 'cd "/Users/efisher/Dropbox/Alfred/Alfred.alfredpreferences/workflows/user.workflow.AC4EC29B-7C6F-4A36-A9C4-CEE2CA74303C" && bash setup.sh'
[2014-01-31 17:01:36 -0500] zanshin: Looking at remote-file resource, is there a way to have it error when the resulting file is empty? I'm using it to grab artifacts from our artifactory server and when that fails I *do not* want an empty war file created, I want an error raised.
[2014-01-31 17:10:46 -0500] mattsurabian: so the remote file would exist
[2014-01-31 17:10:53 -0500] mattsurabian: but have no content?
[2014-01-31 17:11:40 -0500] mattsurabian: zanshin ^
[2014-01-31 17:18:15 -0500] masterkorp: Guys on a first bootstrap
[2014-01-31 17:18:17 -0500] masterkorp: http://pastie.org/8686033
[2014-01-31 17:18:22 -0500] masterkorp: /usr/lib/ruby/vendor_ruby/mixlib/log.rb:97:in `level=': Log level must be one of :debug, :info, :warn, :error, or :fatal (ArgumentError)
[2014-01-31 17:18:33 -0500] masterkorp: i dont get it, my knife rb is :info
[2014-01-31 17:19:16 -0500] masterkorp: og_level        :auto
[2014-01-31 17:19:18 -0500] masterkorp: oh
[2014-01-31 17:19:31 -0500] masterkorp: how can i set for it to be info on bootstraps ??
[2014-01-31 17:38:22 -0500] jwitrick: question about ohai plugins. correct me if im wrong but arnt plugins supposed to save information back to the chef server (assuming im using the chef-server -> server model) ?
[2014-01-31 17:39:10 -0500] jbz: jwitrick: The plugins themselves do not.  THe chef client saves node state back to the server, and that state normally contains the output of the plugins, as attributes.
[2014-01-31 17:39:54 -0500] jwitrick: sorry mis-spoke. but yes that is the work flow. i.e. depending on the plugin the data it gathers should be accessible as a node key?
[2014-01-31 17:41:20 -0500] jwitrick: im running centos/rhel machines and Im trying to use the rpm ohai plugin in combination with the ohai cookbook. and what Im seeing is that the key 'rpm' is not available during a chef run.
[2014-01-31 17:41:36 -0500] dstdenis: Hi, having problems getting the syntax right for the --override-runlist option to chef-client.  I've tried combos like this:
[2014-01-31 17:41:37 -0500] jwitrick: but when i do knife node edit <node> -a  i can see the key 'rpm'
[2014-01-31 17:41:40 -0500] dstdenis: root@snap-workers:~# sudo chef-client --override-runlist='recipe["server_snap::app_snap-workers@0.1.35"]' /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-11.8.0/lib/chef/run_list/run_list_item.rb:59:in `initialize': Unable to create Chef::RunList::RunListItem from String:"recipe[\"server_snap::app_snap-workers@0.\ 1.35\"]": must be recipe[] or role[] (ArgumentError) ... root@snap-workers:~# sudo chef-client --override-runlist='recipe
[2014-01-31 17:41:50 -0500] dstdenis: can you see that?
[2014-01-31 17:41:59 -0500] dstdenis: let me break it up
[2014-01-31 17:42:41 -0500] dstdenis: root@snap-workers:~# sudo chef-client --override-runlist='recipe["server_snap::app_snap-workers@0.1.35"]' /opt/chef/embedded/lib/ruby/gems/1.9.1/gems/chef-11.8.0/lib/chef/run_list/run_list_item.rb:59:in `initialize': Unable to create Chef::RunList::RunListItem from String:"recipe[\"server_snap::app_snap-workers@0.\ 1.35\"]": must be recipe[] or role[] (ArgumentError)
[2014-01-31 17:43:30 -0500] jbz: dstdenis: Please use pastie or gist instead of pasting into channel
[2014-01-31 17:43:56 -0500] jwitrick: jtimberman: any thoughts on the ohai issue? or thoughts on how im using it wrong?
[2014-01-31 17:44:34 -0500] jbz: jwitrick:  If the ohai plugin is being installed in the same run, it probably isn't available yet.  The server state is generally saved at the *end* of the run, unless you do that manually - so it's possible that it's just not yet available?
[2014-01-31 17:44:36 -0500] masterkorp: guys any idea ???
[2014-01-31 17:45:20 -0500] jwitrick: so during the first run i agree, but what about second run ? it should still have the information
[2014-01-31 17:45:48 -0500] jbz: jwitrick: Can you gist/pastie where you're trying to use the ['rpm'] attribute?
[2014-01-31 17:46:29 -0500] jwitrick: so on chef client10: shef -z  node.keys.sort
[2014-01-31 17:46:50 -0500] jwitrick: and its not there. but it is on the chef server when i do knife node edit ...
[2014-01-31 17:48:26 -0500] dstdenis: Pastie of what I tried: http://pastie.org/8686089
[2014-01-31 17:48:27 -0500] jwitrick: in my recipe I am using it like: if node.has_key?("rpm") and node['rpm'].has_key?(pkg)
[2014-01-31 17:48:52 -0500] jwitrick: and since that key is not defined the if block is skipped (but thats hurting the intended steps0
[2014-01-31 17:48:56 -0500] jwitrick: steps)*
[2014-01-31 17:50:21 -0500] jbz: dstdenis: Try without the quotes inside the square brackets
[2014-01-31 17:51:57 -0500] dstdenis: Thanks, that appears work.
[2014-01-31 17:51:59 -0500] jbz: jwitrick: hmmm
[2014-01-31 17:52:16 -0500] jbz: jwitrick: try using node.attribute? rather than key?  i.e.
[2014-01-31 17:52:45 -0500] jbz: jwitrick: node.attribute?(:rpm)  ...maybe
[2014-01-31 17:53:03 -0500] jbz: node[:rpm].attribute?(:pkg)
[2014-01-31 17:53:30 -0500] jwitrick: same thing. the key name 'rpm' is not defined.
[2014-01-31 17:54:22 -0500] jbz: jwitrick: Huh.  Sorry, I'm going to have to shrug at that point - I'm not shef-savvy, either. :-/
[2014-01-31 17:55:07 -0500] jwitrick: ya i have never had this type of the occur before.
[2014-01-31 18:12:46 -0500] Frank_: Is anyone here successfully using chef to automate .Net 4.5 installs?
[2014-01-31 18:20:35 -0500] kbarry: Frank_ I think we are, lemme ask how we are doing it
[2014-01-31 18:20:47 -0500] kbarry: It may be a shef wrapper around PoSh
[2014-01-31 18:20:54 -0500] kbarry: er chef even :)
[2014-01-31 18:23:27 -0500] rbattula: is it possible to call methods from a community cookbook's provider?
[2014-01-31 18:24:10 -0500] rbattula: addendum: calling from a recipe
[2014-01-31 18:41:36 -0500] zanshin: It appears that remote_file uses curl under the covers to do it's work, and what's more, when it can't reach the source due to permissions (403) it happily puts a zero-length file at the target. Is there a better remote file resource than the standard one? One that doesn't create zero-length files quietly?
[2014-01-31 18:48:21 -0500] MattStratton: Running into an inconsistent error with knife-azure - occasionally I get this error: "ERROR: Failed to create the server -- exception being rescued: undefined method `content' for nil:NilClass". However, it actually does seem to be creating the VM, but knife bails, so I end up with a vM that never gets provisioned. Not sure where to start digging.
[2014-01-31 18:49:56 -0500] MattStratton: Ah. Looks like this is brought up in KNIFE-443
[2014-01-31 18:49:58 -0500] MattStratton: great.
[2014-01-31 19:06:29 -0500] magoo: any idea why Chef::Provider::Service::Upstart wouldn't be able to properly utilize my upstart script https://gist.github.com/mago0/8740811
[2014-01-31 19:07:13 -0500] magoo: it's trying to send a start to it after it's already running
[2014-01-31 19:08:10 -0500] kbarry: Reading thru the Docs: Are users typically using different versions of a recipe to make versions for different environments?
[2014-01-31 19:08:30 -0500] kbarry: (still getting a handle on how environments are used.)
[2014-01-31 19:08:56 -0500] magoo: yeah, you can essentially lock the version of the cookbook in use for each environment
[2014-01-31 19:09:06 -0500] magoo: so staging might not have a version constraint
[2014-01-31 19:09:17 -0500] magoo: but production would specify the version to control when it's released
[2014-01-31 19:09:18 -0500] kbarry: just use the latest?
[2014-01-31 19:09:27 -0500] kbarry: Right,
[2014-01-31 19:10:10 -0500] magoo: yeah, really up to you - you might want to constrain staging as well
[2014-01-31 19:10:27 -0500] magoo: but I think this is a common workflow in conjuction with "freezing" cookbooks
[2014-01-31 19:10:35 -0500] kbarry: I'm trying to figure out how this is all going to work. Its a big picture
[2014-01-31 19:11:01 -0500] magoo: yeah, it's a bit to take in
[2014-01-31 19:11:14 -0500] magoo: there are some really great write-ups on chef workflow
[2014-01-31 19:11:33 -0500] magoo: look for cookbook freezing and knife tools built around enforcing a work-flow
[2014-01-31 19:11:38 -0500] magoo: knife-spork comes to mind
[2014-01-31 19:12:19 -0500] kbarry: today I am churning thru the documentation.
[2014-01-31 19:12:27 -0500] kbarry: been playing with it for a week,
[2014-01-31 19:12:34 -0500] kbarry: got a rought framework now
[2014-01-31 19:12:38 -0500] kbarry: just need to flesh it out
[2014-01-31 19:12:47 -0500] magoo: it's evolving as fast as you can learn about the current best-practices
[2014-01-31 19:12:49 -0500] magoo: best of luck
[2014-01-31 19:13:41 -0500] kbarry: gotta start somewhere.
[2014-01-31 19:13:43 -0500] kbarry: :)
[2014-01-31 19:14:05 -0500] kbarry: But it is like trying to board a train thats only "slows a bit" at the station :)
[2014-01-31 19:14:11 -0500] kbarry: grab on, or get run over.
[2014-01-31 19:14:24 -0500] magoo: haha, yes
[2014-01-31 19:33:48 -0500] MattStratton: any ideas on how to debug if I do a knife bootstrap to a node, and there are no errors, but nothing happens?
[2014-01-31 19:34:19 -0500] MattStratton: it basically just says "bootstrapping chef on <nodename> and then half a second later it goes back to the prompt
[2014-01-31 19:35:47 -0500] PapaSierra: hi, i haven't told the run_list to include application_ruby, i simple pasted application_ruby into my cookbooks/ and when i provision i get this http://www.hastebin.com/raw/tawebibame
[2014-01-31 19:41:17 -0500] kbarry: I had something similar to that, where a recipe said it completed, but the change expected wasnt happening
[2014-01-31 19:41:36 -0500] kbarry: it ended up being a problem with 64-bit with a 32-bit client :)
[2014-01-31 19:41:43 -0500] kbarry: er reverse that
[2014-01-31 19:43:30 -0500] PapaSierra: i'm suspecting it's a chef version issue. we're on 10.x and i believe the cookbook requires 11
[2014-01-31 19:48:27 -0500] MattStratton: what might be causing knife bootstrap to just do nothing? no errors, just an immediate return to the prompt after stating "bootstrapping chef on servername.x.com"
[2014-01-31 19:49:28 -0500] MattStratton: command is knife bootstrap jenkins.COMPANY.net -x USERNAME -i ~/.ssh/KEYNAME.key --run-list 'chef-client' sudo
[2014-01-31 20:03:45 -0500] MattStratton: ok, i can see it's not actually trying to make the connection. when I try it without the -i parameter, it never prompts me for a password
[2014-01-31 20:06:04 -0500] jslusher: anyone used the nginx cookbook to set up a simple proxy_pass configuration?
[2014-01-31 20:06:34 -0500] jslusher: trying to figure out how to do that form the documentation and not finding it
[2014-01-31 20:06:41 -0500] kbarry: anyone have a link handy for a good writeup on templates?
[2014-01-31 20:07:11 -0500] coderanger: cheeseplus: Please tell me that is satire
[2014-01-31 20:07:21 -0500] cheeseplus: I wish
[2014-01-31 20:13:25 -0500] cheeseplus: coderanger: I'm sure you can imagine how it's going over in our hipchat channels O_o
[2014-01-31 20:18:45 -0500] rshade98: how do I get chef to see tun0
[2014-01-31 20:21:04 -0500] rshade98: also, node[:ipaddress] seems to be blank
[2014-01-31 20:21:53 -0500] PapaSierra: someara: i needed build-essentials, but that required yum which required yum-epel, which requires "windows". i think i'm doing something wrong! (provisioning an ubuntu machine. nothing unusual)
[2014-01-31 20:22:00 -0500] coderanger: rshade98: node['ipaddress'] is set based on which interface corresponds to the default gateway
[2014-01-31 20:22:10 -0500] coderanger: if you don't have a default gateway, it usually leaves it blank
[2014-01-31 20:24:44 -0500] rshade98: any reason it would be blank: default         10.240.0.1      0.0.0.0         UG    0      0        0 eth0
[2014-01-31 20:24:53 -0500] martinisoft: coderanger: I figured out how to hack the ipaddress with an ohai plugin, wasnt as difficult as I thought once I figured out how to get the plugins to install
[2014-01-31 20:25:05 -0500] rshade98: we are on 11.8.2
[2014-01-31 20:25:25 -0500] martinisoft: rshade98: if im reading that right, your gateway is 0.0.0.0 ?
[2014-01-31 20:25:40 -0500] rshade98: gateway is 10.240.0.1
[2014-01-31 20:26:21 -0500] martinisoft: Ah hmm, that should be how ohai selects the default interface. It looks at routes and then ifconfig
[2014-01-31 20:28:42 -0500] rshade98: yeah, but we are getting a blank
[2014-01-31 20:31:51 -0500] dgarstang1: Is the a way in chef to run a system command and get the output?
[2014-01-31 20:32:03 -0500] rshade98: ohai | grep ipaddress
[2014-01-31 20:32:08 -0500] rshade98: returns empty
[2014-01-31 20:33:17 -0500] mattray: dgarstang1: mixlib/shellout
[2014-01-31 20:33:36 -0500] dgarstang1: mattray: is that any better than backticks?
[2014-01-31 20:34:02 -0500] mattray: dgarstang1: definitely. It's part of Chef and captures stderr and stdout
[2014-01-31 20:34:11 -0500] dgarstang1: mattray: kk, thanks
[2014-01-31 20:34:21 -0500] btm: dgarstang1: it's way better than backticks, we've put a lot of work into making process execution stable/cross-platform.
[2014-01-31 20:34:25 -0500] PapaSierra: can anyone tell me why i'm seeing: "If you're loading windows from another cookbook", i'm not on windows. i don't want windows. nothing should be requiring windows.
[2014-01-31 20:34:32 -0500] dgarstang1: mattray: standard chef, or is that a cookbook I'm looking at?
[2014-01-31 20:34:33 -0500] mattray: dgarstang1: https://github.com/opscode/mixlib-shellout
[2014-01-31 20:34:42 -0500] mattray: dgarstang1: standard Chef
[2014-01-31 20:34:46 -0500] dgarstang1: mattray: Woo!
[2014-01-31 20:34:56 -0500] jbz: PapaSierra:  Sometimes, cross-platform cookbooks will have windows cookbooks in their dependencies.  It makes me nuts, but it happens.
[2014-01-31 20:35:03 -0500] mattray: lots of cookbooks use it to capture shell output
[2014-01-31 20:35:23 -0500] PapaSierra: jbz: so i have to have the windows cookbook then?
[2014-01-31 20:35:37 -0500] mattray: PapaSierra: it's downloaded, just unused
[2014-01-31 20:35:50 -0500] jbz: what mattray said.
[2014-01-31 20:36:11 -0500] dgarstang1: jbz: mysql requiring xfs... that's nuts
[2014-01-31 20:36:30 -0500] dgarstang1: and aws...
[2014-01-31 20:36:33 -0500] jbz: dgarstang1: heh.
[2014-01-31 20:36:34 -0500] dgarstang1: more nutty
[2014-01-31 20:37:10 -0500] PapaSierra: jbz: mattray but i've seen a few examples where folks have build-essentials (requires yum (requires yum-epel)), but they aren't required to have windows. is it just because i'm using a newer version of some cookbook?
[2014-01-31 20:38:51 -0500] jbz: PapaSierra: It depends entirely on the cookbook in question.  There's no 'standard.'  If you are using a cookbook whose author decided it should have windows deps to avoid trouble when it is used on windows, then it'll happen.
[2014-01-31 20:39:45 -0500] PapaSierra: jbz: understood. i guess i'm saying i'm using the exact cookbooks than my colleagues are, but in my case it needs windows, in their case it doesn't. hence the confusion
[2014-01-31 20:41:07 -0500] jbz: Oh, I see.  Well, yes, it might depend on version, absolutely.  Cross-platform functionality might have been added in a later version.
[2014-01-31 20:41:18 -0500] PapaSierra: got it
[2014-01-31 20:41:21 -0500] PapaSierra: ty
[2014-01-31 20:41:53 -0500] jbz: sure
[2014-01-31 20:43:20 -0500] geggam: for fun :)
[2014-01-31 20:43:29 -0500] dgarstang1: I wonder why https://github.com/opscode/mixlib-shellout uses puts as an example.
[2014-01-31 21:03:23 -0500] EricL_: If I have search() query in the variables section of a template method that works fine on an existing node, why would that same search query fail on a bootstrapping node 100% of the time?
[2014-01-31 21:06:03 -0500] coderanger: EricL_: Whats the code look like?
[2014-01-31 21:10:44 -0500] btm: @getchefdotcom Cookbook Code Review: Join: bit.ly/1hZhrsl, watch: bit.ly/1hZhsw8
[2014-01-31 21:17:55 -0500] EricL_: coderanger: :blog_hosts => search(:node, 'roles:web-server-blog')
[2014-01-31 21:24:13 -0500] EricL_: It also works completely fine when I run it in knife "knife search 'roles:web-server-blog'"
[2014-01-31 21:25:31 -0500] heathsnow_: Is the IIS cookbook guy on right now?  I don't think the 'iis_app' resource is handling notifications right now :S
[2014-01-31 21:26:30 -0500] heathsnow_: ah, there's a 2.0 out now and I'm using 1.5.4...maybe that will help
[2014-01-31 21:35:33 -0500] chance: quick question, what exactly is 'hosted enterprise chef'
[2014-01-31 21:35:36 -0500] chance: it seems free
[2014-01-31 21:35:59 -0500] btm: chance: 5 nodes free.
[2014-01-31 21:36:04 -0500] chance: oh okay
[2014-01-31 21:36:17 -0500] chance: where do you find those details, i must be retarded since i dont see that
[2014-01-31 21:36:35 -0500] btm: chance: http://www.getchef.com/enterprise-chef/#plans-pricing
[2014-01-31 21:36:45 -0500] chance: thanks
[2014-01-31 21:36:58 -0500] chance: this'll work better that chef solo for managing my VPS, awesome.
[2014-01-31 21:37:06 -0500] chance: and i can manage my laptop this way too :D
[2014-01-31 21:37:12 -0500] EricL_: No one has any thoughts on why a search would fail on a bootstrap but work on an existing node?
[2014-01-31 21:37:39 -0500] btm: chance: yessir, that's what I do for my personal servers. I guess since I work at Chef it doesn't matter though. ;)
[2014-01-31 21:37:57 -0500] chance: haha
[2014-01-31 21:38:11 -0500] chance: btm: an aside, do you use berkshelf?
[2014-01-31 21:38:42 -0500] chance: well actually in general, can any one explain how I would use berkshelf with chef solo in a manner similar to how you would with vagrant, except not with vagrant?
[2014-01-31 21:38:57 -0500] chance: i asked in #berkshelf and havent gotten anything back yet.
[2014-01-31 21:39:19 -0500] btm: chance: not really.
[2014-01-31 21:39:50 -0500] chance: no worries.
[2014-01-31 21:40:01 -0500] chance: most of thats moot now that i can used hosted chef server, just curious.
[2014-01-31 21:57:27 -0500] jchauncey: chance: what do you mean use berkshelf?
[2014-01-31 21:57:46 -0500] chance: i mean using it w/ chef solo
[2014-01-31 21:57:58 -0500] chance: so with varant it's as easy as vagrant provision
[2014-01-31 21:58:11 -0500] jchauncey: right because it's been told where the cookbooks are located
[2014-01-31 21:58:28 -0500] jchauncey: you basically need to tell chef solo where the cookbooks you want to converge with are located
[2014-01-31 21:58:29 -0500] chance: without vagrant, i can berks install into my berkshelf, and the docs say you can't necessarily just set your cookbooks path to your berkshelf
[2014-01-31 21:58:57 -0500] jchauncey: right
[2014-01-31 21:59:03 -0500] jchauncey: you can do a berks install into any directory you want
[2014-01-31 21:59:07 -0500] chance: so i was wondering if my only option is to just vendorize the cookbooks each run, and then point chef-solo to the vendored cookbooks
[2014-01-31 22:00:15 -0500] jchauncey: yeah that's what we do
[2014-01-31 22:00:18 -0500] chance: so for each run it would look like "berks install", "chef solo solo.rb" with cookbooks_path set to ~/.berkshelf"
[2014-01-31 22:00:27 -0500] chance: basically, right?
[2014-01-31 22:00:41 -0500] jchauncey: we do a berks install to ~/.berkshelf but when your test-kitchen run executes it vendors them to ~/projects/cookbooks/foo-cookbook/vendor
[2014-01-31 22:01:01 -0500] jchauncey: what are you using chef-solo for? to converge an actual box?
[2014-01-31 22:01:02 -0500] chance: i see.
[2014-01-31 22:01:03 -0500] jchauncey: or for testing?
[2014-01-31 22:01:07 -0500] chance: actual box
[2014-01-31 22:01:10 -0500] jchauncey: ah
[2014-01-31 22:01:28 -0500] chance: basically wondering how to configure my laptop using chef solo + berkshelf
[2014-01-31 22:01:29 -0500] jchauncey: berkshelf has a handy tool called package that will generate a tarball with all the dependent cookbooks so you can run chef-solo with that
[2014-01-31 22:01:49 -0500] chance: mostly wondering about easiest workflow with the least amount of redundant commands
[2014-01-31 22:02:03 -0500] chance: i wish i could just vagrant provision to my laptop xD
[2014-01-31 22:02:09 -0500] jchauncey: check this out then - http://www.solowizard.com/
[2014-01-31 22:02:31 -0500] chance: woah
[2014-01-31 22:02:41 -0500] chance: that is going into my favorite irc channels
[2014-01-31 22:03:11 -0500] chance: good osx support too, ill be switching from a linux thinkpad to a macbook this summer, so this could be useful!
[2014-01-31 22:03:17 -0500] jchauncey: yup
[2014-01-31 22:03:24 -0500] jchauncey: we built our own custom one for work
[2014-01-31 22:03:33 -0500] jchauncey: makes bringing up a dev laptop super simple
[2014-01-31 22:03:34 -0500] doomviking: wow
[2014-01-31 22:04:15 -0500] chance: yeah, it looks pretty awesome
[2014-01-31 22:13:49 -0500] mconigliaro: hey guys, i remember reading on the maling list something about a temporary storage area in the node object that i can use across resources and cookbooks. does anyone know anything about this?
[2014-01-31 22:13:55 -0500] mconigliaro: i don't think it's documented
[2014-01-31 22:16:49 -0500] cwj: mconigliaro: i use node.run_state for that purpose
[2014-01-31 22:17:00 -0500] cwj: node.run_state[:lols] = {}
[2014-01-31 22:17:42 -0500] mconigliaro: cwj: that was it
[2014-01-31 22:17:43 -0500] mconigliaro: http://lists.opscode.com/sympa/arc/chef/2010-12/msg00067.html
[2014-01-31 22:17:46 -0500] mconigliaro: thanks!
[2014-01-31 22:18:18 -0500] cwj: np
[2014-01-31 22:18:30 -0500] jchauncey: why would you use that?
[2014-01-31 22:18:59 -0500] cwj: jchauncey: because i want to cache search results and access them across multiple recipes
[2014-01-31 22:19:08 -0500] jchauncey: ah good one
[2014-01-31 22:19:10 -0500] cwj: and not store them as node attributes
[2014-01-31 22:19:25 -0500] mconigliaro: yeah, I've ended up using attributes for things like that
[2014-01-31 22:19:28 -0500] jchauncey: yeah search results are expensive
[2014-01-31 22:20:02 -0500] lukecarrier: The omnibus download page doesn't seem to be working and the packages in 14.04 are broken. wat du?
[2014-01-31 22:20:46 -0500] lukecarrier: I should clarify I'm talking about Ubuntu 14.04, and seeking Chef 11.x preferably, but that Ubuntu's own packages have broken dependencies on net::ssh (require 1.1, but 1.2 is the only release in the repos)
[2014-01-31 22:20:56 -0500] lukecarrier: I also only need Chef Solo, if that makes it any easier
[2014-01-31 22:23:57 -0500] cwj: lukecarrier: i dont see ubuntu 14.04 in the list on the omnibus download page, is that what you mean by doesnt seem to be working ?
[2014-01-31 22:24:42 -0500] cwj: or are you trying to download a different version and thats failing?
[2014-01-31 22:25:17 -0500] lukecarrier: cwj, nope, I can't use the dropdowns
[2014-01-31 22:25:21 -0500] lukecarrier: nothing ever appears in them
[2014-01-31 22:25:34 -0500] cwj: oh, im not seeing that here, fwiw
[2014-01-31 22:25:41 -0500] lukecarrier: I can see the XHRs happen in the console, but the <select>s never get populated in
[2014-01-31 22:26:10 -0500] lukecarrier: I opened up the file and looked at the URLs and have a good one for the 13.04 client (or 12.04, lost track) which supposedly works
[2014-01-31 22:26:17 -0500] lukecarrier: but I can't get the server download URL
[2014-01-31 22:27:08 -0500] lukecarrier: by the looks it's hosted on S3, so it's possibly a config/caching issue on the Ireland AZ or sth
[2014-01-31 22:28:16 -0500] yuppers: so do people tend to treat git or their chef server as the source of truth?
[2014-01-31 22:29:17 -0500] cwj: lukecarrier: maybe try https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chef-server_11.0.10-1.ubuntu.12.04_amd64.deb ?
[2014-01-31 22:31:13 -0500] lukecarrier: cwj, thanks, will give it a shot. only getting 110kB/s from S3, remarkably unimpressive for a CDN...
[2014-01-31 22:31:32 -0500] lukecarrier: I have 80mbit down
[2014-01-31 22:31:44 -0500] cwj: ah i dont think thats a cdn url
[2014-01-31 22:31:57 -0500] cwj: i could be mistaken
[2014-01-31 22:55:33 -0500] wdilly_: in an execute resource, is it normal to be able to do compound shell statement... ie command " touch foo && cp foo bar"
[2014-01-31 22:59:54 -0500] jchauncey: wdilly: sure
[2014-01-31 23:00:21 -0500] jchauncey: wdilly: just make sure you add an appropriate guard in case you dont want it to execute everytime
[2014-01-31 23:00:31 -0500] jchauncey: idompotency is important!
[2014-01-31 23:06:55 -0500] scalp42: wdilly_ https://gist.github.com/scalp42/9ff646bfc54576d0b058 this would work as well
[2014-01-31 23:07:08 -0500] wdilly_: thanks guys
[2014-01-31 23:08:14 -0500] wdilly_: scalp42, what is the action :nothing saying?
[2014-01-31 23:08:26 -0500] scalp42: it won't do anything
[2014-01-31 23:08:35 -0500] wdilly_: but it will cp foo bar ?
[2014-01-31 23:08:41 -0500] scalp42: so you would ask this execute to actually run when you want it
[2014-01-31 23:08:47 -0500] scalp42: not if you dont call it
[2014-01-31 23:08:51 -0500] wdilly_: oooo i see i see
[2014-01-31 23:08:54 -0500] wdilly_: this is cool
[2014-01-31 23:09:02 -0500] scalp42: that's why the file provider with touch will notifies execute to run
[2014-01-31 23:09:08 -0500] wdilly_: i didnt know you could do this
[2014-01-31 23:09:12 -0500] scalp42: no worries
[2014-01-31 23:09:46 -0500] scalp42: wdilly_have a look at this: http://docs.opscode.com/chef/resources.html#notifications
[2014-01-31 23:11:37 -0500] scalp42: ping me if you need some help
[2014-01-31 23:14:48 -0500] EricL_: If I have search() query in the variables section of a template method that works fine on an existing node, why would that same search query fail on a bootstrapping node 100% of the time?
[2014-01-31 23:15:58 -0500] scalp42: do you have a gist for it EricL_ ?
[2014-01-31 23:16:09 -0500] scalp42: whats the "error"?
[2014-01-31 23:16:17 -0500] scalp42: empty results or Chef exception
[2014-01-31 23:16:19 -0500] EricL_: It is just this line:    :blog_hosts => search(:node, 'roles:web-server-blog')
[2014-01-31 23:16:39 -0500] EricL_: And then in the template, I do   @blog_hosts and it comes back as nil.  The problem is that the knife search comes back with a host.
[2014-01-31 23:17:15 -0500] scalp42: are you passing the blog_hosts variable into the template?
[2014-01-31 23:19:25 -0500] scalp42: EricL_https://gist.github.com/scalp42/5883624ae78d32d5678a
[2014-01-31 23:20:22 -0500] EricL_: scalp42: variables({:blog_hosts => search(:node, 'roles:web-server-blog')})
[2014-01-31 23:20:40 -0500] EricL_: And then in the template, I'm referencing it with an @blog_hosts
[2014-01-31 23:20:41 -0500] scalp42: mmh
[2014-01-31 23:20:45 -0500] scalp42: in the recipe
[2014-01-31 23:20:54 -0500] scalp42: can you print it :blog_hosts to be sure
[2014-01-31 23:21:48 -0500] EricL_: I can, but since the full role hasn't completed, printing it will take quite a while to complete since it has to run the full role (including recompiling nginx)
[2014-01-31 23:22:07 -0500] scalp42: oh gotcha I see
[2014-01-31 23:22:13 -0500] scalp42: curious if its the '-'
[2014-01-31 23:22:16 -0500] scalp42: in the search
[2014-01-31 23:22:32 -0500] scalp42: (feel free to tell me to fuck off in case)
[2014-01-31 23:23:02 -0500] scalp42: but I think it would blow up with exception
[2014-01-31 23:23:13 -0500] EricL_: It works in knife, why wouldn't it work in the search() method?
[2014-01-31 23:24:11 -0500] scalp42: yeah actually dashes are fine sorry
[2014-01-31 23:25:13 -0500] scalp42: would need someone else to help
[2014-01-31 23:25:25 -0500] scalp42: I'd start by printing the results of that search
[2014-01-31 23:26:06 -0500] EricL_: Yea coderanger started to help, but then had to disappear.  He's been 100% on giving me viable answers for my issues.  I'll just keep pushigng on it in the mean time.
[2014-01-31 23:26:26 -0500] coderanger: EricL_: Sorry, at a meetup
[2014-01-31 23:26:33 -0500] coderanger: Will be paying attention to IRC again in a few hours
[2014-01-31 23:26:51 -0500] scalp42: well then
[2014-01-31 23:27:34 -0500] EricL_: coderanger: Sorry, didn't mean to call you out.  Just saying that you seem to be good at providing answers to obscure questions (which all of mine seem to fall into that category).
[2014-01-31 23:31:23 -0500] scalp42: `knife search node roles:web-server-blog` sure returns something?
[2014-01-31 23:31:47 -0500] EricL_: scalp42: Yes.  100% of the time from my laptop.
[2014-01-31 23:32:21 -0500] scalp42: no exceptions nothing during the run?
[2014-01-31 23:32:38 -0500] EricL_: Nope.  I keep running it and it works out fine.
[2014-01-31 23:33:17 -0500] scalp42: no clues then but curious to know what was the issue
[2014-01-31 23:34:20 -0500] EricL_: That makes two of us.
[2014-01-31 23:40:47 -0500] EricL_: Ok. I see it.  I'm getting this: log[The result of the search: [node[blog-001.aws.simplereach.com]]] action write
[2014-01-31 23:40:53 -0500] EricL_: Where I think I'm getting nil
[2014-01-31 23:41:24 -0500] EricL_: Well, I don't htink I'm getting nil.  Ruby thinks I'm getting nil.
[2014-01-31 23:41:49 -0500] scalp42: what does your logic look like in the template
[2014-01-31 23:42:35 -0500] EricL_: http://pastie.org/8687045
[2014-01-31 23:42:38 -0500] scalp42: @blog_hosts.each do |node| ?
[2014-01-31 23:42:45 -0500] EricL_: Sorry, forgot the template.  Hold on.
[2014-01-31 23:42:48 -0500] scalp42: np
[2014-01-31 23:43:16 -0500] EricL_: http://pastie.org/8687047
[2014-01-31 23:43:34 -0500] EricL_: This is the error: undefined method `each' for nil:NilClass
[2014-01-31 23:45:45 -0500] EricL_: See why I am so confused?
[2014-01-31 23:47:18 -0500] scalp42: can you try this: https://gist.github.com/scalp42/e771a2bc1b3d7d1fcd4f
[2014-01-31 23:48:24 -0500] EricL_: So basically just change to the new hash setup.
[2014-01-31 23:48:39 -0500] scalp42: yeah its the same though
[2014-01-31 23:48:56 -0500] EricL_: I know.  Trying it now.
[2014-01-31 23:50:25 -0500] EricL_: Same error.
[2014-01-31 23:50:49 -0500] scalp42: no clues then :D
[2014-01-31 23:51:07 -0500] EricL_: Alright.  Then I'm going to take off for the day.  I'll give it a shot tomorrow.
[2014-01-31 23:51:09 -0500] scalp42: looks like that blog_hosts doesnt make it to the erb
[2014-01-31 23:51:22 -0500] EricL_: Yea, but it does on hosts that already exist.
[2014-01-31 23:51:26 -0500] EricL_: Just not on a bootstrapping host.
