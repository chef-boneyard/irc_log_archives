[2014-02-25 00:00:19 -0500] Dairenn: I was relying on the status page to try and troubleshoot a different issue (null #{node} variable, causing an encrypted data bag load failure, could not find the secrets file because the path is provided by a node object array element.)
[2014-02-25 00:01:44 -0500] nicholasserra: Anyone ever see berks taking a very long time on "parsing Chef response body as JSON" after API fetch?
[2014-02-25 00:02:18 -0500] coderanger: nicholasserra: You see to have a lot of issues with JSON parsing today
[2014-02-25 00:02:33 -0500] coderanger: Did you anger the Crockford?
[2014-02-25 00:02:38 -0500] nicholasserra: coderanger: You know it. ^_^ haha
[2014-02-25 00:03:04 -0500] nicholasserra: Turned out that I wasn't getting hung up on the API, it was returning quickly, but the JSON parse afterwards is hanging
[2014-02-25 00:03:14 -0500] nicholasserra: But it worked for about an hour. Now hanging again.
[2014-02-25 00:03:37 -0500] nicholasserra: My guess is that since i'm using a lot of cookbooks, it's doing some terrible parsing operation over all of them.
[2014-02-25 00:04:01 -0500] nicholasserra: I started fresh and that's where i'm at :P
[2014-02-25 00:07:08 -0500] Dairenn: OK, still don't know WTF hostname --fqdn is returning "Unknown host" in spite of the fact that "host" and "dig" are returning the IP from the NS in /etc/resolv.conf just fine.  But, that's a Linux problem--not a Chef problem.
[2014-02-25 00:07:52 -0500] mjuszczak: Does anyone have any thoughts on chef server implementation?  Single server for staging/prod with knife-spork?  Or separate servers for staging/prod and some process to copy between them to reduce human error?
[2014-02-25 00:08:46 -0500] Dairenn: We run a live-chef-server and a test-chef-server, so we don't have to worry about coming up with test names for the same orgs and environments.
[2014-02-25 00:09:11 -0500] coderanger: mjuszczak: How many people will be doing cookbook development?
[2014-02-25 00:09:17 -0500] Dairenn: And then use Jenkins git hooks to automatically kick off client runs in Vagrants bootstrapped to the test server.
[2014-02-25 00:09:30 -0500] Dairenn: (Because we have multiple people editing our cookbooks.) :)
[2014-02-25 00:11:28 -0500] mjuszczak: coderanger: 5 ish, 2 full time
[2014-02-25 00:11:43 -0500] coderanger: mjuszczak: Probably fine with a single server then
[2014-02-25 00:11:58 -0500] coderanger: Just coordinate externally so people aren't doing dev on things at the same time :)
[2014-02-25 00:12:05 -0500] coderanger: and use chef envs to pin stuff as needed
[2014-02-25 00:13:04 -0500] mjuszczak: coderanger: our worry is not being able to version databags and roles and such.  We're both new to chef, and are scared to overwrite stuff :)
[2014-02-25 00:13:18 -0500] coderanger: mjuszczak: Simple solution, don't use them
[2014-02-25 00:13:36 -0500] mjuszczak: eh?
[2014-02-25 00:13:43 -0500] coderanger: You don't need either
[2014-02-25 00:14:01 -0500] mjuszczak: are you suggesting chef solo?
[2014-02-25 00:14:03 -0500] coderanger: re: bags, https://coderanger.net/2014/02/data-bags/
[2014-02-25 00:14:11 -0500] coderanger: No, chef-server is fine, jsut don't use roles or bags
[2014-02-25 00:16:53 -0500] mjuszczak: interesting.  We've been thinking about going sssd anyway for users/keys.
[2014-02-25 00:17:35 -0500] coderanger: No idea what that is
[2014-02-25 00:17:40 -0500] mjuszczak: coderanger: So you can actually version the data then.
[2014-02-25 00:17:51 -0500] mjuszczak: coderanger: LDAP Users/Keys, sssd is just a more modern pam_ldap/nss_ldap
[2014-02-25 00:18:19 -0500] mjuszczak: Dairenn: How do you get stuff from your test chef server to prod chef server?
[2014-02-25 00:18:42 -0500] coderanger: mjuszczak: Eh, cookbook works fine for use as you can see :)
[2014-02-25 00:20:47 -0500] mjuszczak: coderanger: so you don't use databags or roles at all??
[2014-02-25 00:20:54 -0500] coderanger: Nope
[2014-02-25 00:21:28 -0500] AntelopeSalad: if you don't use encrypted data bags for passwords then what are you using?
[2014-02-25 00:21:41 -0500] coderanger: AntelopeSalad: What passwords?
[2014-02-25 00:21:59 -0500] AntelopeSalad: database passwords, session tokens, etc.
[2014-02-25 00:22:11 -0500] coderanger: Stored in S3 via the citadel cookbook
[2014-02-25 00:22:25 -0500] coderanger: s3 + iam roles for security
[2014-02-25 00:22:31 -0500] AntelopeSalad: i wouldn't want my rails session token in version control, especially not an open source app
[2014-02-25 00:22:41 -0500] coderanger: S3 is not version control ...
[2014-02-25 00:22:50 -0500] AntelopeSalad: yeah, i typed that before reading
[2014-02-25 00:23:14 -0500] AntelopeSalad: looks interesting
[2014-02-25 00:23:59 -0500] coderanger: AntelopeSalad: As mentioned in the post, Barbican and RedOctober may be options in the future as well
[2014-02-25 00:24:29 -0500] AntelopeSalad: i've only ever used encrypted bags, never regular ones
[2014-02-25 00:24:35 -0500] AntelopeSalad: going to read your post tho
[2014-02-25 00:25:12 -0500] mjuszczak: coderanger: and so if I went this way, where everything was a cookbook, we can have full versioning of everything - data, etc. - and therefore can use a single chef server with environments safely
[2014-02-25 00:25:31 -0500] coderanger: mjuszczak: mhmm
[2014-02-25 00:25:39 -0500] mjuszczak: and therefore knife-spork becomes useful
[2014-02-25 00:25:53 -0500] coderanger: mjuszczak: Until you have a lot more people working on cookbooks in parallel which increases the chances of collision
[2014-02-25 00:26:30 -0500] mjuszczak: coderanger: Understood.  Do you agree that using a single chef server (with environments) and using roles and databags can be a bit scary?  And at that point might make sense to run two separate chef servers?
[2014-02-25 00:27:05 -0500] coderanger: mjuszczak: Eh, just be rigorous about "always push to git before uploading to the server" and its fine
[2014-02-25 00:27:43 -0500] AntelopeSalad: oh yeah speaking about git, i came across a chicken/egg problem before
[2014-02-25 00:28:02 -0500] AntelopeSalad: if i have my cookbook reading a server-local git directory that i pushed to, how can i successfully do a first run?
[2014-02-25 00:28:22 -0500] AntelopeSalad: if the server isn't provisioned then i cannot push to it, so it fails since the git dir is going to be empty on the first run
[2014-02-25 00:29:10 -0500] AntelopeSalad: do most of you guys have your cookbooks pull from an external server that has the git repo instead?
[2014-02-25 00:30:24 -0500] pushnell: is there any way to force the 'git' resource to leave my repo in a state where 'git branch' shows the branch I actually checked out instead of 'deploy' ?
[2014-02-25 00:33:53 -0500] coderanger: pushnell: I think that was added really recently
[2014-02-25 00:34:22 -0500] pushnell: coderanger: I just discovered https://tickets.opscode.com/browse/CHEF-3734 and I'm looking through the commit now
[2014-02-25 00:38:48 -0500] mjuszczak: coderanger: So then, does this make sense to you as well... http://alluvium.com/blog/2013/05/03/the-application-cookbook-pattern-berkshelf-and-team-chef-workflow/  <-- the "problem with roles" section
[2014-02-25 00:39:22 -0500] coderanger: mjuszczak: mhmm
[2014-02-25 00:39:49 -0500] AntelopeSalad: mjuszczak: if you use the berkshelf/application cookbook style then you can easily avoid roles
[2014-02-25 00:41:26 -0500] mjuszczak: This is making me happy, because it matches more of what I'm used to with Puppet.
[2014-02-25 00:41:33 -0500] mjuszczak: Where everything is versioned, including roles, since it's just in code.
[2014-02-25 00:41:47 -0500] mjuszczak: coderanger: Do you use knife-spork with your workflow?
[2014-02-25 00:42:04 -0500] AntelopeSalad: not sure how the really experienced guys do it but i just compose my recipes in my berkshelf-controlled cookbook to handle roles
[2014-02-25 00:42:15 -0500] coderanger: mjuszczak: No, but taking advice from me on workflow can be a bit like drinking from a firehose
[2014-02-25 00:42:34 -0500] AntelopeSalad: if you have: foo, bar, baz recipes and you really want some node to be a foobar then you just make a recipe called foobar that includes both foo and bar
[2014-02-25 00:42:46 -0500] mjuszczak: AntelopeSalad: So you're essentially creating a cookbook for each server you have inside site-cookbooks?
[2014-02-25 00:43:01 -0500] mjuszczak: AntelopeSalad: yes!  That's exactly how I do it in Puppet.  Sweeeeet. I love it.
[2014-02-25 00:43:18 -0500] AntelopeSalad: and it's as simple as having that foobar recipe just "include" the foo and bar recipes
[2014-02-25 00:43:31 -0500] AntelopeSalad: and then in your runlist for the node you just assign recipe['foobar']
[2014-02-25 00:44:21 -0500] coderanger: mjuszczak: Minor note, don't have a single site-cookbooks folder
[2014-02-25 00:44:35 -0500] coderanger: mjuszczak: Each cookbook should be its own repo and managed as an independent software module
[2014-02-25 00:44:43 -0500] AntelopeSalad: http://misheska.com/blog/2013/06/16/getting-started-writing-chef-cookbooks-the-berkshelf-way/
[2014-02-25 00:44:54 -0500] AntelopeSalad: that was a top notch tutorial to get started using berkshelf-style cookbooks
[2014-02-25 00:46:02 -0500] flaccid: personally, i write cookbooks the chef-style way
[2014-02-25 00:46:37 -0500] mjuszczak: coderanger: I thought of that, again that's the "puppet way", but it seems most people do things inside site-cookbooks.  Where would you put your "role" cookbooks?  Or would you amke that a single cookbook with a bunch of recipies?
[2014-02-25 00:47:05 -0500] coderanger: mjuszczak: You indeed end up with a lot of repos with little cookbooks in them
[2014-02-25 00:47:08 -0500] justinabrahms: hey chef folks. I'm using hosted chef. How can I diagnose why my node isn't downloading the latest version of a cookbook? I don't have the version specified anywhere that I can see.
[2014-02-25 00:47:16 -0500] coderanger: justinabrahms: ::waves::
[2014-02-25 00:47:20 -0500] justinabrahms: o/ coderanger
[2014-02-25 00:47:34 -0500] coderanger: justinabrahms: Do you have an environment policy set?
[2014-02-25 00:47:45 -0500] pushnell: coderanger: confirming that "enable_checkout false" on the 'git' resource now leaves me on the correct branch.  (Docs are lagging at http://docs.opscode.com/resource_git.html )  Thanks for the sanity check.
[2014-02-25 00:48:06 -0500] justinabrahms: coderanger: I don't actually know what that is, so I think no?
[2014-02-25 00:48:19 -0500] coderanger: pushnell: lmao if you don't review every ticket on new releases, isn't that how normal people run software?
[2014-02-25 00:48:37 -0500] pushnell: coderanger: :)
[2014-02-25 00:48:44 -0500] justinabrahms: coderanger: bah! looking at the new chef-ui... apparently that's a thing I do have setup..
[2014-02-25 00:48:53 -0500] AntelopeSalad: mjuszczak: are you a ruby dev?
[2014-02-25 00:49:09 -0500] coderanger: justinabrahms: :-) Unpin the cookbook in the environment and it should work again
[2014-02-25 00:50:00 -0500] justinabrahms: thx
[2014-02-25 00:50:26 -0500] coderanger: justinabrahms: o7
[2014-02-25 00:51:07 -0500] mjuszczak: AntelopeSalad: not yet :)
[2014-02-25 00:51:38 -0500] coderanger: mjuszczak: :thumbsup:
[2014-02-25 00:51:59 -0500] mjuszczak: coderanger: Do you have a probem with this route? http://www.getchef.com/blog/2013/11/19/chef-roles-arent-evil/  -- essentially saying you can use roles, but just version role cookbooks.
[2014-02-25 00:53:08 -0500] AntelopeSalad: mjuszczak: oh, i only mentioned that because berkshelf will manage your cookbook deps, you wouldn't have them in site-cookbook
[2014-02-25 00:53:11 -0500] coderanger: mjuszczak: I think that exaggerates the benefits and introduces a lot of extra complexity that isn't needed
[2014-02-25 01:02:51 -0500] mjuszczak: coderanger: Got it.  So you really feel for an organization of our size then (2 primary, 2-3 "here and there"), just skipping roles entirely is best.  What would you call the "role cookbook" then?  The one with the recipies in it like database-server.rb, rabbitmq-node.rb, etc. (that are including other cookbooks)
[2014-02-25 01:03:10 -0500] coderanger: mjuszczak: Yep
[2014-02-25 01:03:52 -0500] mjuszczak: sweet
[2014-02-25 01:19:22 -0500] mjuszczak: coderanger: seems with the role-less method, you run into the problem of modifying the run-list across hundreds of nodes.  For instance, if I had 100s of "worker nodes" that included the "worker" recipe, and I wanted to install ntpd on all of them, normally I could just edit the role and deploy.  What would be the way here?
[2014-02-25 01:19:46 -0500] coderanger: mjuszczak: Edit the worker cookbook?
[2014-02-25 01:20:10 -0500] coderanger: It is still semantically a role, just using different code to accomplish that
[2014-02-25 01:20:26 -0500] mjuszczak: ahhh, gotcha.  OK :)
[2014-02-25 01:36:39 -0500] mjuszczak: coderanger: So just to clarify, you support "the berkshelf way" 100%, minus their recommendation to use databags sparingly.  You feel not to use them at all. Just want to make sure I'm understanding your recommendations - watching this hour long presentation :)
[2014-02-25 01:37:00 -0500] coderanger: mhmm
[2014-02-25 01:41:09 -0500] mjuszczak: thanks :)
[2014-02-25 01:41:47 -0500] kbarry: i'm trying to use an attribute inside a heredoc
[2014-02-25 01:42:12 -0500] kbarry: <<- EOB #{node[role][name]} EOB
[2014-02-25 01:42:36 -0500] AntelopeSalad: try... <<- 'EOB' #{node[role][name]} EOB
[2014-02-25 02:19:10 -0500] pushnell: hrm ... my first chef server install is not going well.  (AWS linux)  Hung at: ruby_block[supervise_rabbitmq_sleep] action run
[2014-02-25 02:20:37 -0500] flaccid: is it supported on amzn linux?
[2014-02-25 02:21:09 -0500] pushnell: gah ... https://tickets.opscode.com/browse/CHEF-3838?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab
[2014-02-25 02:21:22 -0500] pushnell: ok, next question then .... how can I get an rpm of v11.2.x?
[2014-02-25 02:22:02 -0500] coderanger: pushnell: You would have to build it youself, and that is so not recommend it would make your head spin
[2014-02-25 02:22:07 -0500] coderanger: pushnell: Just use CentOS
[2014-02-25 02:22:08 -0500] flaccid: pushnell: follow http://www.getchef.com/chef/install/
[2014-02-25 02:22:21 -0500] flaccid: Ubuntu
[2014-02-25 02:22:27 -0500] pushnell: lol, k :)
[2014-02-25 02:22:35 -0500] pushnell: rpm != Ubuntu
[2014-02-25 02:22:46 -0500] flaccid: thankfully that is true
[2014-02-25 02:22:52 -0500] pushnell: but I'll have to use Ubuntu for this
[2014-02-25 02:22:52 -0500] flaccid: i wouldn't be using it if it did
[2014-02-25 02:22:56 -0500] coderanger: Sure, ubuntu is better, but amzn linux is already just mildly customized centos
[2014-02-25 02:23:10 -0500] pushnell: well, mildly customized and massively updated
[2014-02-25 02:23:14 -0500] flaccid: centos or amzn linux are not supported
[2014-02-25 02:23:40 -0500] pushnell: lots of packages available there but not in the main centos/rhel rpm repos
[2014-02-25 02:24:08 -0500] coderanger: flaccid: CentOS is
[2014-02-25 02:24:20 -0500] coderanger: CentOS == RHEL
[2014-02-25 02:25:55 -0500] pushnell: 13.10 ok for chef server?
[2014-02-25 02:26:12 -0500] coderanger: pushnell: I think there should be packages for it, yes
[2014-02-25 02:26:24 -0500] coderanger: general support matrix is Ubuntu LTS + latest
[2014-02-25 02:27:54 -0500] pushnell: hm ... k.  I'm going to save myself some headaches & pick 12.04 because it's in the official list :)
[2014-02-25 02:40:47 -0500] Durzo: Hi guys, when i do a 'knife node edit xyz' and insert an "override" element, it says "node not updated, not saving", i have tried override, force_override and nothing seems to stick... any ideas?
[2014-02-25 02:43:08 -0500] FireBeyond: so in my knife.rb there's a node_name - I just decided to create a second user account on my chef server while i copied the key and credentials... so, question... should my desktop and my laptop have different node names - they are only used to upload - i'll be using the same chef server account from each
[2014-02-25 02:44:02 -0500] Durzo: FireBeyond, i use the same knife.rb accross several machines to manage chef server and its working fine
[2014-02-25 02:44:14 -0500] FireBeyond: Durzo: great, thanks
[2014-02-25 02:44:26 -0500] Durzo: just probably dont run chef-client on them
[2014-02-25 03:06:37 -0500] josephholsten: wow, attempting to replace the authz from sql to ldap is crazy
[2014-02-25 03:07:11 -0500] josephholsten: I'm deep inside chef_db's chef_sql now, and it's obviously not just handled here
[2014-02-25 03:10:00 -0500] coderanger: josephholsten: You mean for the web UI?
[2014-02-25 03:10:15 -0500] josephholsten: oh, I'm way deeper than the web-ui at this point
[2014-02-25 03:10:29 -0500] coderanger: yeah, but is that what oyu mean
[2014-02-25 03:10:30 -0500] josephholsten: but yes, that's how this spelunking expedition started
[2014-02-25 03:10:41 -0500] coderanger: or are you trying to do user keys from LDAP too
[2014-02-25 03:11:05 -0500] josephholsten: I'm trying to see if I can see where enterprise chef hooks in
[2014-02-25 03:11:16 -0500] josephholsten: I'd really love to do user keys from ldap also
[2014-02-25 03:11:21 -0500] Durzo: while you guys are looking (heh)... whats the best way to do a mass chef-client upgrade ? i have 60+ nodes that all need updating to get a feature from a newer chef-client
[2014-02-25 03:11:30 -0500] coderanger: so enterprise does it entirely differently than FOSS
[2014-02-25 03:11:31 -0500] coderanger: but one sec
[2014-02-25 03:11:42 -0500] coderanger: Durzo: omnibus_updater cookbook
[2014-02-25 03:11:44 -0500] josephholsten: Durzo: https://github.com/hw-cookbooks/omnibus_updater
[2014-02-25 03:11:58 -0500] Durzo: opscode docs all say that upgrade from within a recipe is bad
[2014-02-25 03:12:08 -0500] Durzo: was wondering what the 'official' way was, omnibus seems the _only_ way
[2014-02-25 03:12:27 -0500] josephholsten: hmm, that's odd. it's the only way I'd do it if you're running the official packages
[2014-02-25 03:12:54 -0500] Durzo: yeah i couldnt see any other way
[2014-02-25 03:12:54 -0500] coderanger: josephholsten: https://github.com/opscode/chef_wm/blob/master/src/chef_wm_authenticate_user.erl#L73
[2014-02-25 03:13:03 -0500] coderanger: josephholsten: replace that chef_db:fetch with a call to LDAP
[2014-02-25 03:13:04 -0500] Durzo: cheers guys
[2014-02-25 03:13:14 -0500] josephholsten: coderanger: subtle
[2014-02-25 03:13:50 -0500] coderanger: Just make sure you return that same chef_user record
[2014-02-25 03:14:01 -0500] josephholsten: hmm, I guess users still have to be created in enterprise chef's sql for them to work correctly?
[2014-02-25 03:14:24 -0500] coderanger: Like I said, enterprise does this differently
[2014-02-25 03:14:43 -0500] coderanger: there is an entirely different service endpoint that does user auth and management
[2014-02-25 03:15:12 -0500] josephholsten: ah, well I've got to sign off atm
[2014-02-25 03:15:24 -0500] josephholsten: thanks for the pointer
[2014-02-25 03:15:32 -0500] coderanger: lat0rz
[2014-02-25 03:50:57 -0500] norman: all,  I'd already installed the chef-server 11.0.10, and today  I try to install the 11.0.11 , but there are lots of conflict info, such as  file /opt/chef-server/embedded/service/erchef/lib/rabbit_common-0.0.0/ebin/rabbit_misc.beam from install of chef-server-11.0.11-1.el6.x86_64 conflicts with file from package chef-server-11.0.10-1.el6.x86_64
[2014-02-25 03:51:16 -0500] norman: so should I ignore them?
[2014-02-25 03:51:23 -0500] norman: or how to fix them?
[2014-02-25 03:53:39 -0500] Durzo: norman, how are you trying to upgrade?
[2014-02-25 03:54:13 -0500] norman: rpm -ivh ......  to reinstall it
[2014-02-25 03:54:31 -0500] Durzo: norman, wouldnt you rpm -Fvh or -Uvh to upgrade?
[2014-02-25 03:54:34 -0500] coderanger: norman: I think that should be -U
[2014-02-25 03:54:35 -0500] coderanger: yeah
[2014-02-25 03:54:52 -0500] Durzo: you dont want to install two versions, you want to upgrade one
[2014-02-25 03:54:52 -0500] norman: ok, I will try it again
[2014-02-25 03:55:01 -0500] norman: yes, upgrade
[2014-02-25 03:55:13 -0500] Durzo: -i is install, -U is upgrade and -F is freshen
[2014-02-25 03:55:32 -0500] Durzo: i believe -U was deprecated in favor of -F but its been a long time since i used rpm
[2014-02-25 03:55:41 -0500] norman: I am not familair with linux,  sorry for that, Thanks, I will try
[2014-02-25 03:58:42 -0500] norman: that works!
[2014-02-25 03:59:38 -0500] norman: another question,  should we also upgrade the existing chef-client in the Node when new chef-server updated?
[2014-02-25 04:00:49 -0500] Durzo: norman, i usually do, but its best to read the release_notes for both products
[2014-02-25 04:02:55 -0500] norman: actually, I did not find it in the release logs,  and did you know how can we upgrade it since I use the bootstrap to initilize the Node?
[2014-02-25 04:07:57 -0500] norman: Durzo: actually, I did not find it in the release logs,  and did you know how can we upgrade it since I use the bootstrap to initilize the Node?
[2014-02-25 04:08:30 -0500] Durzo: norman, omnibus_updater https://github.com/hw-cookbooks/omnibus_updater
[2014-02-25 04:09:25 -0500] norman: Durzo: you know ,we will be in the intranet, and after we install the chef-server,  Node will only be communicate with the chef-server
[2014-02-25 04:09:46 -0500] norman: then Node may can't get the code from that address
[2014-02-25 04:10:05 -0500] norman: can the Node get the latest info from the updated chef-server?
[2014-02-25 04:11:36 -0500] norman: anyway, I will try it , it may works
[2014-02-25 04:15:22 -0500] Damm: how do you get chef to stop verifying ssl certificates, :verify_none does not appear to work
[2014-02-25 04:15:36 -0500] Damm: rather annoying as I have other hosts with the same version of chef and they could give 2 craps
[2014-02-25 04:15:42 -0500] Damm: but that's life
[2014-02-25 04:27:10 -0500] Damm: annoying it appears to be old settings dunno why that even worked
[2014-02-25 04:27:12 -0500] Damm: figures
[2014-02-25 08:11:48 -0500] RSTJNII: Can you search to show nodes running a given cookbook?
[2014-02-25 08:14:10 -0500] RSTJNII: recipes:cookbook::recipe throws an invalid search query error
[2014-02-25 09:03:59 -0500] coderanger: RSTJNII: Escape the :s
[2014-02-25 09:05:45 -0500] RSTJNII: Thanks, I figured I was missing something simple like that.
[2014-02-25 09:07:28 -0500] RSTJNII: I have another question, I have a file on a server and I'm not sure if it is Chef managed, I don't think it is.  How can I confirm?
[2014-02-25 09:08:21 -0500] coderanger: RSTJNII: You can't directly
[2014-02-25 09:08:35 -0500] coderanger: You would have to run chef and see what happens, possibly using why-run mode
[2014-02-25 09:08:47 -0500] RSTJNII: Hmm, okay
[2014-02-25 09:08:52 -0500] coderanger: but chef recipes are executable code, there is no way to do a declarative lookup
[2014-02-25 09:09:51 -0500] RSTJNII: Makes sense.  I know in Puppet I can query the PuppetDB API (if configured) but Puppet DSL has some critical differences that enable that.
[2014-02-25 09:09:55 -0500] RSTJNII: Thanks
[2014-02-25 09:19:57 -0500] coderanger: Indeed
[2014-02-25 10:05:24 -0500] zygmunt: hi, I'm trying to modify custom recipe to work in chef-solo mode, The problem I have now is with 'cookbook_file' method which tries to connect to the chef server and complains I don't have pem key specified. Is there a way to use cookbook_file without need to connect to chef server ?
[2014-02-25 10:08:50 -0500] flaccid: zygmunt: whats your objective?
[2014-02-25 10:11:58 -0500] zygmunt: flaccid: I have recipe that works with managed chef server, I want to change it to work in offline mode through chef-solo
[2014-02-25 10:12:47 -0500] zygmunt: recipe was using Chef::CookbookVersion load, and @cookbook object but I've managed to replace that with my own methods, but now provision fails with cookook_file block
[2014-02-25 11:03:05 -0500] flaccid: is it fine to do case platform?
[2014-02-25 11:12:03 -0500] flaccid: i see its boolean only, use node['platform']
[2014-02-25 11:12:54 -0500] ShadySQL: hi
[2014-02-25 11:13:01 -0500] ShadySQL: I am new to Chef
[2014-02-25 11:13:06 -0500] ShadySQL: I am trying to learn it
[2014-02-25 11:13:15 -0500] ShadySQL: please dont judge me but I am on Windows
[2014-02-25 11:14:00 -0500] ShadySQL: I have an error
[2014-02-25 11:14:09 -0500] ShadySQL: when I try to bootstrap my first node
[2014-02-25 11:14:14 -0500] flaccid: i'd say people are more likely to judge windows than you yourself
[2014-02-25 11:14:23 -0500] ShadySQL: ok
[2014-02-25 11:14:32 -0500] ShadySQL: Authentication error
[2014-02-25 11:14:39 -0500] ShadySQL: http 401
[2014-02-25 11:15:06 -0500] flaccid: did you boostrap from the chef server itself by ip with knife bootstrap ?
[2014-02-25 11:15:19 -0500] ShadySQL: yes the command I issued was
[2014-02-25 11:15:55 -0500] ShadySQL: knife bootstrap 192.168.3.212 --sudo -x opscode -P opscode -N "opscode"
[2014-02-25 11:16:39 -0500] ShadySQL: the process fails
[2014-02-25 11:16:51 -0500] flaccid: hmm is that what they say for windows? there isnt' any sudo on windows
[2014-02-25 11:16:57 -0500] flaccid: i guess i'm not the best person to help here
[2014-02-25 11:17:16 -0500] ShadySQL: when it trieds to create a new client identity for opscode using the validator key
[2014-02-25 12:06:19 -0500] flaccid: whats the diff between %w[foo] and %w(foo)  ?
[2014-02-25 12:25:52 -0500] laurent\: flaccid: ruby -e 'puts %w[foo]==%w(foo)'
[2014-02-25 12:38:16 -0500] Siiseli: how do I run a recipe multiple times with different parameters? I'm trying to make a cookbook that installs nginx to two different places, and need custom cookbook configurations for both
[2014-02-25 12:40:10 -0500] Siiseli: tried to do something like node['teletubby']['proxyserver']['dns_names'].each do |dns, server| { node.default['nginx']['install_method'] = 'source'; node.default['nginx']['source']['prefix'] = "/home/#{dns}"; include_recipe 'nginx'; } but that doesn't quite work
[2014-02-25 12:42:59 -0500] flaccid: Siiseli: you can't really do that. its going to be hell
[2014-02-25 12:44:20 -0500] misheska: Actually covered here: http://comments.gmane.org/gmane.comp.sysutils.chef.user/1685
[2014-02-25 12:45:30 -0500] misheska: Yeah, if you try to run "include_recipe" in a loop using the same recipe, won't work because a recipe is only expanded once,, even if you include it multiple times
[2014-02-25 12:45:31 -0500] Siiseli: flaccid, oh? Then how am I supposed to achieve what I want? the end result, I mean. Which is two nginx installations on one machine in different places?
[2014-02-25 12:45:38 -0500] Siiseli: misheska, I see
[2014-02-25 12:46:16 -0500] misheska: LWRP is the best way to go for that
[2014-02-25 12:46:29 -0500] flaccid: Siiseli: learn about more high level design with lwrps
[2014-02-25 12:46:44 -0500] Siiseli: mmkay. Thanks
[2014-02-25 12:46:58 -0500] flaccid: i doubt you would install nginx twice.
[2014-02-25 12:47:09 -0500] flaccid: unless you are doing LXC.
[2014-02-25 12:49:53 -0500] Siiseli: flaccid, for this setup, I need two nginx installations. One for staging, one for prod. Then there's one for rerouting traffic to the correct receiving nginx. It's done like this because then you can separately reload configurations for staging without restarting prod(and vice versa etc)
[2014-02-25 12:50:21 -0500] Siiseli: and because we like to assume they might end up on different computers, but also have to be able to run on the same computer
[2014-02-25 12:50:33 -0500] flaccid: Siiseli: that doesn't sound like 'separate' installations. if you want that do docker.
[2014-02-25 12:53:05 -0500] Siiseli: so what you're suggesting is I make docker containers of each nginx installation and provision them using chef?
[2014-02-25 12:53:29 -0500] flaccid: if thats what you want
[2014-02-25 12:53:54 -0500] Siiseli: unfortunately all this server stuff isn't exactly my area of expertise
[2014-02-25 12:54:00 -0500] Siiseli: I just currently have to do it
[2014-02-25 12:54:27 -0500] Siiseli: I was just shown plans for the setup
[2014-02-25 12:54:38 -0500] Siiseli: and told to make it happen :P
[2014-02-25 12:54:41 -0500] flaccid: hire a devop
[2014-02-25 12:55:05 -0500] Siiseli: we have devops, they're busy doing other things. And I was asked to do this so that we'd have more people in the company who know this shit
[2014-02-25 12:55:51 -0500] flaccid: sounds good
[2014-02-25 12:56:23 -0500] Siiseli: but yeah, if there's just one nginx installation, won't changing the configuration of one site force us to reload the whole nginx config
[2014-02-25 12:56:49 -0500] flaccid: thats an nginx question, not chef
[2014-02-25 13:45:40 -0500] GreatSUN: hi all
[2014-02-25 13:46:29 -0500] GreatSUN: can someone explain me if/how I can have dynamic dependencies (for example according to if someone is using chef-server or chef-solo environment)?
[2014-02-25 13:55:59 -0500] flaccid: GreatSUN: sounds non-standard
[2014-02-25 13:57:53 -0500] GreatSUN: flaccid: correct
[2014-02-25 13:58:49 -0500] flaccid: GreatSUN: best of luck
[2014-02-25 14:00:17 -0500] GreatSUN: flaccid: thanks...
[2014-02-25 14:00:36 -0500] mixandgo: hello, I'm getting this: Error executing action `start` on resource 'service[nginx]'. Any idea why ?
[2014-02-25 14:01:18 -0500] flaccid: mixandgo: paste the whole output to a bin
[2014-02-25 14:02:23 -0500] mintuz: how would i go about altering the nginx receipe to allow me to override the default site template?
[2014-02-25 14:02:33 -0500] mintuz: i am new to chef.
[2014-02-25 14:04:05 -0500] flaccid: mintuz: what cookbok nginx are you using?
[2014-02-25 14:04:28 -0500] mintuz: opscode?
[2014-02-25 14:04:40 -0500] flaccid: mintuz: url?
[2014-02-25 14:05:11 -0500] mintuz: Installing nginx (2.2.2) from site: 'http://cookbooks.opscode.com/api/v1/cookbooks'
[2014-02-25 14:05:43 -0500] mintuz: thats what Berkshelf outputted
[2014-02-25 14:06:40 -0500] mintuz: it'll be this http://community.opscode.com/cookbooks/nginx
[2014-02-25 14:06:42 -0500] flaccid: mintuz: which recipe in particular?'
[2014-02-25 14:06:55 -0500] mintuz: the default one
[2014-02-25 14:07:31 -0500] mixandgo: flaccid: https://gist.github.com/mixandgo/9209422
[2014-02-25 14:07:36 -0500] flaccid: not much to do there, it includes https://github.com/opscode-cookbooks/nginx/blob/master/recipes/default.rb
[2014-02-25 14:08:18 -0500] mintuz: how would i go about altering the default vhost then for nginx?
[2014-02-25 14:10:41 -0500] flaccid: mintuz: text editors work well
[2014-02-25 14:11:16 -0500] mintuz: :/
[2014-02-25 14:12:13 -0500] flaccid: mintuz: first step, learn and use the nginx cookbook. if its not right, contrib.
[2014-02-25 14:12:41 -0500] mixandgo: flaccid: do you see anything that would help in that gist ?
[2014-02-25 14:14:06 -0500] flaccid: mixandgo: no. you should be seeing what the problem is, run /etc/init.d/nginx start
[2014-02-25 14:15:26 -0500] flaccid: that will help you habib
[2014-02-25 14:16:32 -0500] mixandgo: flaccid: yeah, I think it's looking for a ssl cert that's missing so I've disabled that lookup in my nginx template and I wanted to override the one on the server
[2014-02-25 14:16:43 -0500] mixandgo: but I get that exception, and I doesn't override it
[2014-02-25 14:16:52 -0500] mixandgo: I guess I'll have to remove it manually
[2014-02-25 14:17:23 -0500] mljsimone: Hello
[2014-02-25 14:17:29 -0500] flaccid: ol yulaa
[2014-02-25 14:17:36 -0500] mljsimone: I'm using vagrant + chef
[2014-02-25 14:17:51 -0500] mljsimone: Anyone use it too?
[2014-02-25 14:17:58 -0500] mintuz: yes im learning to
[2014-02-25 14:18:25 -0500] mljsimone: i'm using NFS for the shared folders because of performance problem with Virtualbox's shared folders implementation
[2014-02-25 14:18:41 -0500] mljsimone: "/Users/ack/Repositories/framework-upgrade-dev" 10.10.10.10 -alldirs -mapall=501:20 < any idea how to change that mapall?
[2014-02-25 14:19:21 -0500] flaccid: mljsimone: english?
[2014-02-25 14:20:04 -0500] mljsimone: flaccid: ya sorry about that. But it is faster that way if I found someone that know what I'm talking about
[2014-02-25 14:20:42 -0500] flaccid: mljsimone: good lunck
[2014-02-25 14:20:53 -0500] mljsimone: flaccid: thanks. you too.
[2014-02-25 14:22:06 -0500] flaccid: mljsimone: before you go sick, 10.10.10.10 is not even gnu
[2014-02-25 14:22:21 -0500] mljsimone: huh?
[2014-02-25 14:22:43 -0500] flaccid: you know, gnu gpl versioning
[2014-02-25 14:22:58 -0500] mljsimone: lol
[2014-02-25 14:23:11 -0500] mljsimone: that isn't a version number. that is an internal ip address
[2014-02-25 14:23:20 -0500] mljsimone: cat /etc/exports
[2014-02-25 14:23:20 -0500] mljsimone: # VAGRANT-BEGIN: 501 48a34e34-befd-4365-b435-9d11262c4d03
[2014-02-25 14:23:21 -0500] mljsimone: "/Users/ack/Repositories/framework-upgrade-dev" 10.10.10.10 -alldirs -mapall=501:20
[2014-02-25 14:23:22 -0500] mljsimone: # VAGRANT-END: 501 48a34e34-befd-4365-b435-9d11262c4d03
[2014-02-25 14:23:44 -0500] flaccid: i see
[2014-02-25 14:23:46 -0500] mljsimone: you see that mapall there?
[2014-02-25 14:24:02 -0500] mljsimone: I need to change that from Vagrantfile. So it map to vagrant:vagrant
[2014-02-25 14:24:07 -0500] flaccid: what does that have todo with chef?
[2014-02-25 14:24:28 -0500] mljsimone: not directly. But there is a high change that someone here know
[2014-02-25 14:24:36 -0500] mljsimone: I already asked on the rest of the channel
[2014-02-25 14:24:49 -0500] mljsimone: channels*
[2014-02-25 14:24:57 -0500] flaccid:  ok, its off-topic
[2014-02-25 14:25:06 -0500] flaccid: best of luck mary-anne
[2014-02-25 14:25:20 -0500] mljsimone: w/e
[2014-02-25 14:28:10 -0500] AntelopeSalad: question, i think i narrowed down a problem to being that environment variables are not loaded at the time i execute something, how can i force load so they are in the context of the commands i'm running?
[2014-02-25 14:28:22 -0500] AntelopeSalad: i have about ~15 env variables written to /etc/profile and they are exported
[2014-02-25 14:28:51 -0500] mujina: hi all, silly question but does anyone know how you access attributes defined in .kitchen.yml in your recipes?
[2014-02-25 14:29:04 -0500] AntelopeSalad: i'm using the chef deploy resource to run certain rake tasks, but i "think" the issue i'm having is that they are failing because the env vars are not loaded at the time of execution
[2014-02-25 14:29:08 -0500] flaccid: AntelopeSalad: asfaik chef does not source /etc/profile
[2014-02-25 14:29:50 -0500] AntelopeSalad: flaccid: the deploy resource asks for a user which i supplied, i thought they would load the commands under the context of that user?
[2014-02-25 14:31:00 -0500] flaccid: AntelopeSalad: don't know, sorry
[2014-02-25 14:31:01 -0500] AntelopeSalad: or better question is, is there something i can do so that chef sources /etc/profile?
[2014-02-25 14:31:42 -0500] flaccid: AntelopeSalad: what the end goal?
[2014-02-25 14:32:29 -0500] AntelopeSalad: ok, it's for a rails app -- rails has this notion of a database.yml file which contains information like the db url, user, pass, etc.
[2014-02-25 14:32:47 -0500] AntelopeSalad: in my database.yml file i have ENV variables holding all of that information which get populated by /etc/profile
[2014-02-25 14:32:53 -0500] nerdbeere: Hi
[2014-02-25 14:33:17 -0500] AntelopeSalad: rails also has various db manipulation tasks, i want to run one of these tasks with chef deploy
[2014-02-25 14:33:26 -0500] AntelopeSalad: but for it to work it needs to have loaded the ENV variables
[2014-02-25 14:34:02 -0500] AntelopeSalad: i'm getting postgres db authentication errors because the username is empty, so rails is trying to default to the current user (which fails of course because my database user is not the current user)
[2014-02-25 14:34:16 -0500] AntelopeSalad: so i think it's pretty safe to say the ENV vars are unset at the time of running those commands
[2014-02-25 14:34:26 -0500] AntelopeSalad: everything works flawless when i login manually and run identical commands
[2014-02-25 14:38:03 -0500] flaccid: AntelopeSalad: use and enhance application_ruby
[2014-02-25 14:39:02 -0500] AntelopeSalad: flaccid: that has nothing to do with the problem
[2014-02-25 14:39:49 -0500] flaccid: AntelopeSalad: how so?
[2014-02-25 14:40:25 -0500] AntelopeSalad: i just want chef to be able to source the ENV variables from /etc/profile before running the deploy resource
[2014-02-25 14:40:30 -0500] AntelopeSalad: i'm not looking to use application_ruby
[2014-02-25 14:41:06 -0500] mujina: I solved my own problem the attributes are at normal level
[2014-02-25 14:41:09 -0500] flaccid: thats pretty messy, but you can do it
[2014-02-25 14:42:19 -0500] AntelopeSalad: flaccid: i'm all ears for what's messy about it, i'm new to devops and using env variables to keep secret info out of my rails app / repo seemed like a reasonable thing to do -- i also wanted a few things to be tweakable without requiring a code change
[2014-02-25 14:42:51 -0500] lewiz: In knife is a the attribute 'my_attribute: false' that same as 'my_attribute: "false"'?
[2014-02-25 14:43:00 -0500] AntelopeSalad: it's also what heroku use and almost every other cloud provider i've seen
[2014-02-25 14:43:07 -0500] flaccid: AntelopeSalad: what do you want to solve now?
[2014-02-25 14:43:21 -0500] lewiz: and if I do: "if node['my_attribute']..." will "false"/false evaluate in the same way?  Or will "false" evaluate to true since it's not false :P
[2014-02-25 14:43:38 -0500] flaccid: this isn't ##docker
[2014-02-25 14:43:41 -0500] AntelopeSalad: flaccid: all i want to do is run arbitrary rake tasks and have the /etc/profile env variables loaded
[2014-02-25 14:43:48 -0500] flaccid:  or ##packer
[2014-02-25 14:44:30 -0500] flaccid: so you want rake to source /etc/profile?
[2014-02-25 14:45:32 -0500] AntelopeSalad: not rake specifically, i just want /etc/profile always sourced when running anything inside of the "deploy" resource
[2014-02-25 14:45:49 -0500] flaccid: oh
[2014-02-25 14:45:58 -0500] AntelopeSalad: i will be running other commands too such as the app server which also depends on all of the envs in /etc/profile
[2014-02-25 14:46:38 -0500] flaccid: you can't do that.
[2014-02-25 14:47:00 -0500] AntelopeSalad: why not?
[2014-02-25 14:47:29 -0500] flaccid: simple answer: chef doesn't do it
[2014-02-25 14:48:32 -0500] AntelopeSalad: what's the unsimple answer? because this seems like such a common request
[2014-02-25 14:48:47 -0500] flaccid: you can always source that file, thats your choice
[2014-02-25 14:49:06 -0500] flaccid: the simple answer is no
[2014-02-25 14:49:28 -0500] AntelopeSalad: does that just mean performing an "execute" which runs 'source /etc/profile' right before i use the deploy resource?
[2014-02-25 14:50:08 -0500] flaccid: no, they are separate resources
[2014-02-25 14:51:03 -0500] flaccid: AntelopeSalad: tell me what you trying to do coz i'm going to sleep soon
[2014-02-25 14:51:23 -0500] AntelopeSalad: i explained it about 5 times haha
[2014-02-25 14:51:40 -0500] flaccid: none of which made sense
[2014-02-25 14:51:49 -0500] AntelopeSalad: i just want /etc/profile always sourced when running anything inside of the "deploy" resource
[2014-02-25 14:51:57 -0500] AntelopeSalad: what doesn't make sense about that so i know for next time
[2014-02-25 14:53:46 -0500] flaccid: AntelopeSalad: http://docs.opscode.com/resource_deploy.html#attributes
[2014-02-25 14:54:05 -0500] flaccid: environmentA hash of environment variables in the form of {"ENV_VARIABLE" => "VALUE"}. (These variables must exist for a command to be run successfully.)
[2014-02-25 14:54:23 -0500] AntelopeSalad: yeah, i'm not interested in loading all 15 of these commands in that hash tho
[2014-02-25 14:54:29 -0500] AntelopeSalad: i mean env variables
[2014-02-25 14:54:48 -0500] flaccid: AntelopeSalad: but it doesn't support what you want
[2014-02-25 14:55:15 -0500] flaccid: you can't have what you want
[2014-02-25 14:55:41 -0500] flaccid: http://docs.opscode.com/resource_deploy.html
[2014-02-25 14:55:46 -0500] tscanausa: is anyone aware of isssues with bootstrap and the chef client?
[2014-02-25 14:55:54 -0500] AntelopeSalad: there has to be another way
[2014-02-25 14:56:12 -0500] flaccid: tscanausa: i'm aware of the possibility of aliens
[2014-02-25 14:56:34 -0500] matti: '
[2014-02-25 14:56:36 -0500] matti: ;]
[2014-02-25 14:59:45 -0500] tscanausa: flaccid: it appears that somepoint chef client picks up the wrong / old client.pem or client.rb and so it can not communicate with the chef server
[2014-02-25 15:00:15 -0500] flaccid: tscanausa: issue resolved?
[2014-02-25 15:01:00 -0500] tscanausa: it only gets resolved with a reboot, which is not very nice
[2014-02-25 15:09:29 -0500] jbellone: hullo
[2014-02-25 15:20:35 -0500] helfire: is it possible to set the environment in the firstrun.json?
[2014-02-25 15:20:43 -0500] helfire: i cant find an example
[2014-02-25 15:30:09 -0500] shlant: is there any reason not to consolidate directory resources using an array?
[2014-02-25 15:32:07 -0500] gchristensen: shlant: explicitness
[2014-02-25 15:33:11 -0500] AntelopeSalad: should i be looking to move code out of my recipe into a provider if the code does a lot of standard ruby "stuff" to setup a variable that later gets used by a chef resource?
[2014-02-25 15:33:43 -0500] AntelopeSalad: like if you had to read from a file, and do about 15-20 lines of string manipulation/etc... you would definitely look to move that out of the recipe right?
[2014-02-25 15:33:55 -0500] shlant: AntelopeSalad: I think so , yes
[2014-02-25 15:34:40 -0500] AntelopeSalad: shlant: ok thanks, and in this case what i want to do is probably a provider and not a resource right?
[2014-02-25 15:34:56 -0500] AntelopeSalad: it's all just dirty implementation details to setup a value of a variable that gets used in another resource provided by chef
[2014-02-25 15:35:40 -0500] shlant: AntelopeSalad: sort of like a resource wrapper?
[2014-02-25 15:37:08 -0500] AntelopeSalad: shlant: in this specific case i'm reading from a file, parsing out some information that i want, filling up a ruby hash with the information and then later using that hash to populate the "environment" aspects of a few execute/deploy commands
[2014-02-25 15:39:27 -0500] shlant: AntelopeSalad: I think you would need a provider to populate the hash and then a resource to pass the hash into deploy commands
[2014-02-25 15:39:40 -0500] shlant: not really sure though
[2014-02-25 15:40:32 -0500] AntelopeSalad: shlant: right now i have it all working, but all of that stuff is just sitting in a single recipe
[2014-02-25 15:41:03 -0500] AntelopeSalad: the variable is stored outside of the scope of the resources i'm using, so essentially the entire recipe has access to that variable
[2014-02-25 15:42:09 -0500] shlant: AntelopeSalad: yea i'm still not familiar with how to make variables accessible myself
[2014-02-25 15:45:15 -0500] AntelopeSalad: shlant: that just comes down to regular ruby scoping rules i believe
[2014-02-25 15:55:29 -0500] AntelopeSalad: hmm, maybe what i'm after is actually a library?
[2014-02-25 16:17:47 -0500] Joel: can anyone recommend a recipe for rbenv that supports rails 2.1.0?
[2014-02-25 16:18:04 -0500] gleam: rails 2.1.0? or ruby 2.1.0?
[2014-02-25 16:18:08 -0500] gchristensen: "rails 2.1.0"
[2014-02-25 16:18:25 -0500] gleam: get the fnichol one and in providers/ruby.rb change
[2014-02-25 16:18:26 -0500] gchristensen: rails 2 for all the security issues.
[2014-02-25 16:18:26 -0500] gleam:   when /^\d\.\d\.\d-/, /^rbx-/, /^ree-/
[2014-02-25 16:18:39 -0500] gleam: to when /^\d\.\d\.\d-?/, /^rbx-/, /^ree-/
[2014-02-25 16:22:55 -0500] Joel: whoops, ruby.
[2014-02-25 16:23:32 -0500] Joel: gleam: I made that change, but I'm still crapping out: https://gist.github.com/jjshoe/28eea2a16912ddf33242
[2014-02-25 16:28:30 -0500] gleam: that would be a different problem entirely
[2014-02-25 16:28:44 -0500] gleam: like rbenv didn't actually get installed
[2014-02-25 16:29:00 -0500] dawuud: *doh* broken chef-client cookbook
[2014-02-25 16:29:13 -0500] gleam: did you include_recipe rbenv::system or rbenv::user?
[2014-02-25 16:31:01 -0500] Joel: gleam: that could be my issue, I expected default to resolve to one or the other, doesn't look like it does now. gah. dumb.
[2014-02-25 16:32:59 -0500] Joel: gleam: much better, thanks, I know it says to specify in the docs, not sure what I thought I was pulling there.
[2014-02-25 16:38:10 -0500] tmkt: morning
[2014-02-25 16:39:12 -0500] tmkt: having issues with haml and ubuntu 13.10 seems to be this guy  - https://tickets.opscode.com/browse/CHEF-3898  just can't find a solution for ubuntu..if i uninstall the ruby-haml package it uninstalls all of chef
[2014-02-25 16:40:11 -0500] shlant: how do I go about getting the git resource to check out a branch after syncing?
[2014-02-25 16:41:51 -0500] tmkt: nm..i'll try the instructions on the web rather then the repo
[2014-02-25 16:44:02 -0500] mattsurabian: simple question on the community apache2 cookbook if I create a template file in /templates/default/mods/ with the same name as the module that will become the configuration file for that module if I use the apache_conf definition?
[2014-02-25 16:44:43 -0500] mattsurabian: so like /templates/default/mods/deflate.conf.erb then in my cookbook call apache_conf "deflate"
[2014-02-25 16:46:34 -0500] icarus_: mattsurabian: thats correct, as long as nothing else depends on the file
[2014-02-25 16:46:50 -0500] icarus_: mattsurabian: you'll probably know pretty quick if the chef run fails
[2014-02-25 16:47:25 -0500] mattsurabian: :-p yeah figured testing would be easy but figured I'd ask
[2014-02-25 16:48:20 -0500] mattsurabian: thanks icarus_
[2014-02-25 16:49:26 -0500] icarus_: hello all, i have a question
[2014-02-25 16:49:38 -0500] icarus_: where does the chef-repo reside on workstations?
[2014-02-25 16:49:44 -0500] icarus_: or for that matter, on the chef server
[2014-02-25 16:49:55 -0500] icarus_: i can't seem to locate it on a clients machine
[2014-02-25 16:50:09 -0500] gleam: check .chef/knife.rb
[2014-02-25 16:50:18 -0500] gleam: (on the workstation)
[2014-02-25 16:53:07 -0500] mattsurabian: ahhh reading the apache2 documentation a bit further looks like this cookbook I'm looking at is a bit long winded. Instead of including the individual mod recipes then configuring them, I could just be using the apache_module definition and pass conf true
[2014-02-25 16:53:22 -0500] mattsurabian: that's ideal
[2014-02-25 16:56:32 -0500] davidordave: Maybe a crazy question, but is there an existing resource for managing chef server users within a recipe? For instance, if I want to modify what groups users are in based on a data bag. I think knife-acl might be an option. Has anyone had experience with this?
[2014-02-25 17:01:06 -0500] icarus_: gleam: im not seeing .chef anywhere on the workstation
[2014-02-25 17:01:16 -0500] icarus_: im looking in: /etc/chef, /opt/chef
[2014-02-25 17:03:28 -0500] shlant: icarus: .chef should be in the user home
[2014-02-25 17:03:49 -0500] shlant: !/.chef
[2014-02-25 17:03:49 -0500] shlant: ~/.chef
[2014-02-25 17:04:31 -0500] shlant: icarus: you're looking for cookbooks on a node?
[2014-02-25 17:06:02 -0500] fknight: When I do "sudo chef-client" on a node, I'm getting an out of date recipe. How can I track that down?
[2014-02-25 17:06:59 -0500] shlant: fknight: are your cookbook version specifies in an environments file ro something?
[2014-02-25 17:07:09 -0500] shlant: specified*
[2014-02-25 17:07:11 -0500] fknight: Nah
[2014-02-25 17:07:24 -0500] fknight: I have a monit config that I've been working on.
[2014-02-25 17:07:40 -0500] fknight: I'm pulling down an older version of that custom monit config, not the latest..
[2014-02-25 17:07:50 -0500] fknight: Despite running "knife cookbook upload ..."
[2014-02-25 17:08:15 -0500] shlant: fknight: is the change on the chef server
[2014-02-25 17:08:27 -0500] fknight: Is there a way I can query the chef server to figure out what it thinks the recipe is?
[2014-02-25 17:09:57 -0500] fknight: shlant: Any ideas how I can do that?
[2014-02-25 17:10:06 -0500] shlant: fknight: you don't have a way to access the server through the web ui?
[2014-02-25 17:10:20 -0500] fknight: Umm.. does the web ui show the entire recipe?
[2014-02-25 17:10:37 -0500] fknight: shlant: Let me check
[2014-02-25 17:19:42 -0500] shlant: ok this should be straight forward, but I can't find a solution. How do I copy the contents of a directory to another directory?
[2014-02-25 17:30:16 -0500] fknight: shlant: What would be wrong with just doing "cp -rf"?
[2014-02-25 17:36:15 -0500] shlant: fknight: that's what I'm using currently, but I don't like using bash if I don't have to. I would have thought there would be a resource for something so common
[2014-02-25 17:36:16 -0500] shlant: bash/execute
[2014-02-25 17:39:47 -0500] fknight: shlant: Yea, I'm not familiar enough with chef, but I suppose something like that should have been built into the DSL.
[2014-02-25 17:42:28 -0500] tscanausa: shlant: most people dont need to copy full directories around. you could simply use link, or if you explain your use case better there is probably a better solution/
[2014-02-25 17:43:54 -0500] fknight: So I'm still having issues with "chef-client": http://serverfault.com/questions/578207/running-sudo-chef-client-does-not-update-with-latest-version-of-cookbook
[2014-02-25 17:45:55 -0500] shlant: fknight: are you using the template resource for the monit conf?
[2014-02-25 17:46:08 -0500] stormerider: fknight: i'd check the version of the cookbook in your cache directory to see what chef-client is actually working on. /var/cache/chef/cookbooks/ or such
[2014-02-25 17:47:39 -0500] brucelee_: coderanger: what do you guys use for network security ids/ips for balanced?
[2014-02-25 17:51:36 -0500] MattStratton: Anyone using enterprise chef on prem? We're doing an implementaion of it for a customer, and I really hate how people have to "sign up" and create an org just to be added to the on prem
[2014-02-25 17:51:39 -0500] MattStratton: am I missing osmething?
[2014-02-25 17:58:40 -0500] jbellone: hullo
[2014-02-25 17:58:41 -0500] Gary: Hey Guys
[2014-02-25 17:58:51 -0500] Gary: got a quick question for everyone
[2014-02-25 17:59:38 -0500] kbarry: whats the question
[2014-02-25 17:59:58 -0500] Guest24837: When I SSH into my chef workstation from my client node and try to run the bootstrap command, the client node's client.rb is given localhost as the chef_server_url instead of the one I specified in my workstation's knife.rb file, any idea why?
[2014-02-25 18:00:10 -0500] kbarry: I am trying to use "not_if" in some of my recourse calls as a guard (particularly Powershell use-cases),
[2014-02-25 18:00:13 -0500] jbellone: Anyone available that knows Ridley innards? :)
[2014-02-25 18:00:24 -0500] kbarry: And it "seems" i must miunderstand what not_if means.
[2014-02-25 18:00:24 -0500] Guest24837: If I run the bootstrap on the workstation without SSHing in to run the command, it works fine.
[2014-02-25 18:02:38 -0500] Guest24837: any ideas?
[2014-02-25 18:03:33 -0500] Guest24837: how do I register a nick btw?
[2014-02-25 18:05:43 -0500] Test: how do I register a nickname?
[2014-02-25 18:06:25 -0500] MattStratton: here's the FAQ on registering a nick https://freenode.net/faq.shtml
[2014-02-25 18:07:08 -0500] mattsurabian: bleh the apt cookbook seems to be corrupting the sources list?!
[2014-02-25 18:08:32 -0500] mattsurabian: is the uri param not optional?
[2014-02-25 18:08:36 -0500] Guest24837: When I SSH into my chef workstation from my client node and try to run the bootstrap command, the client node's client.rb is given localhost as the chef_server_url instead of the one I specified in my workstation's knife.rb file, any idea why?
[2014-02-25 18:11:30 -0500] mattsurabian: hah wah wah code is using apt_repository instead of apt_package
[2014-02-25 18:11:35 -0500] mattsurabian: today seems to not be my day
[2014-02-25 18:12:23 -0500] gmdawkins: When I SSH into my chef workstation from my client node and try to run the bootstrap command, the client node's client.rb is given localhost as the chef_server_url instead of the one I specified in my workstation's knife.rb file, any idea why?
[2014-02-25 18:13:09 -0500] gmdawkins:  guess I just have to spam the question until someone answers?
[2014-02-25 18:13:41 -0500] kbarry: are you sure you need to be running bootstrap from the remote node?
[2014-02-25 18:13:52 -0500] gmdawkins: It's at the end of my kickstart file
[2014-02-25 18:14:02 -0500] gmdawkins: so it runs post-installation after the server as spun up
[2014-02-25 18:14:25 -0500] gmdawkins: only way I know how to run the bootstrap after the server is done spinning up is by putting it at the end of the kickstart file
[2014-02-25 18:15:01 -0500] kbarry: I am going out on a limb here, but I think you'll need to hand it some more settings,
[2014-02-25 18:15:05 -0500] kbarry: like a pem,
[2014-02-25 18:15:12 -0500] kbarry: specs for the chef server?
[2014-02-25 18:15:31 -0500] gmdawkins: it's running centos 6.4
[2014-02-25 18:16:14 -0500] gmdawkins: so, here's the command I'm running
[2014-02-25 18:16:16 -0500] gmdawkins: knife bootstrap $1 -r 'recipe[packages::cassandra]' -x root -i /root/.ssh/id_rsa --no-host-key-verify
[2014-02-25 18:16:27 -0500] gmdawkins: I SSH into the chef server, and run the .sh file with that command inside
[2014-02-25 18:16:38 -0500] gmdawkins: passing it the node name parameter for $1 of course
[2014-02-25 18:17:31 -0500] gmdawkins: like I said, if I run it directly from the server it works fine, just has the problem when running it from an SSHed connection for some reason
[2014-02-25 18:17:44 -0500] gmdawkins: from a remote server
[2014-02-25 18:20:16 -0500] gmdawkins: any other ideas kbarry?
[2014-02-25 18:20:38 -0500] Majost: Anyone know if there is going to be an after-party at ChefConf?
[2014-02-25 18:20:38 -0500] Majost: Just trying to book appropriately.
[2014-02-25 18:20:42 -0500] gmdawkins: or how did you want me to hand it more settings like the pem file?
[2014-02-25 18:22:13 -0500] gmdawkins: is there a way to set the chef_server_url variable specifically on each node that would overwrite the default setting in the work station's knife.rb?
[2014-02-25 18:23:14 -0500] Majost: Guest24837: /msg nickserv help register
[2014-02-25 18:23:15 -0500] Majost: I don't recall the exact syntax.
[2014-02-25 18:23:23 -0500] Majost: As for bootstrapping, can you gist the error you see
[2014-02-25 18:23:23 -0500] Majost: It may not be using the one in your ~/.chef directory...
[2014-02-25 18:24:23 -0500] gmdawkins: Errno::ENETUNREACH: Network is unreachable - connect(2)
[2014-02-25 18:25:18 -0500] gmdawkins: the network error is because the /etc/chef/client.rb on the node has this setting:
[2014-02-25 18:25:18 -0500] gmdawkins: chef_server_url  "https://localhost:443"
[2014-02-25 18:25:33 -0500] gmdawkins: it's using localhost instead of my actual chef_server_url that I'm trying to use
[2014-02-25 18:26:24 -0500] gmdawkins: any thoughts Majost?
[2014-02-25 18:26:40 -0500] viglesias: gmdawkins: whats in your knife.rb?
[2014-02-25 18:27:03 -0500] gmdawkins: chef_server_url          "https://qtmchefs1.atl.careerbuilder.com/organizations/cb"
[2014-02-25 18:27:12 -0500] gmdawkins: I'm setting that as the server url
[2014-02-25 18:27:19 -0500] gmdawkins: along with the other normal options specified in the file
[2014-02-25 18:27:27 -0500] gmdawkins: how much did you want to see?
[2014-02-25 18:27:35 -0500] viglesias: that was it, just checking the basics
[2014-02-25 18:28:09 -0500] gmdawkins: been trying to figure this out for a while, so figured I'd try here for some help. Not sure why the SSH connection is messing it up.
[2014-02-25 18:28:26 -0500] viglesias: are you sure that knife.rb is being used, maybe pass it with -c to make sure
[2014-02-25 18:29:05 -0500] gmdawkins: well, I'm running the same file / same command. Only difference is the SSH connection.
[2014-02-25 18:29:17 -0500] gmdawkins: Where's the -c flag go? During the bootstrap?
[2014-02-25 18:32:04 -0500] gmdawkins: Still with me viglesias?
[2014-02-25 18:32:50 -0500] anthroprose: gmdawkins: optionss go after the first command
[2014-02-25 18:32:58 -0500] anthroprose: knife bootstrap -c /etc/chef/knife.rb
[2014-02-25 18:33:08 -0500] gmdawkins: I'll give it a shot
[2014-02-25 18:36:15 -0500] gmdawkins: wow, would you believe that worked?
[2014-02-25 18:36:38 -0500] fknight: stormerider: So I tried checking the cache directory, as you mentioned, and my recipe isn't even there. Which is strange because it exists on the web UI and it's the correct version.
[2014-02-25 18:36:43 -0500] gmdawkins: why wasn't it detecting the file by default I wonder?
[2014-02-25 18:36:52 -0500] fknight: stormerider: Is there a cache of the cookbook on the node?
[2014-02-25 18:36:57 -0500] gmdawkins: Anyways, thanks a ton for the help viglesias and anthroprose
[2014-02-25 18:36:59 -0500] gmdawkins: i appreciate it!
[2014-02-25 18:37:29 -0500] stormerider: fknight: so i'd look at however you're pulling it in (role, other cookbook, etc)
[2014-02-25 18:37:57 -0500] viglesias: np gmdawkins
[2014-02-25 18:39:12 -0500] fknight: stormerider: So the node has a specific role. That role was updated recently, to add a new recipe. It has since pulled in an old version of that recipe but not the newest version.
[2014-02-25 18:40:07 -0500] fknight: stormerider: So it runs the role, with an old version of the recipe, but not the new version (which is on the chef server web UI)
[2014-02-25 18:40:30 -0500] stormerider: fknight: then if you're not seeing the cookbook in the cache directory, it's probably the wrong directory you're looking in
[2014-02-25 18:40:40 -0500] jcockhren: hey, when using chef solo with vagrant, I'm getting "Cannot find a resource for users_manage"
[2014-02-25 18:40:57 -0500] fknight: stormerider: Right, where else can I look besides /var/cache/chef ?
[2014-02-25 18:41:11 -0500] helfire: jcockhren: does the recipe your using the resource from depends 'users'
[2014-02-25 18:41:24 -0500] stormerider: try /var/chef/cache
[2014-02-25 18:41:59 -0500] fknight: stormerider: Nah, not seeing anything there
[2014-02-25 18:42:31 -0500] stormerider: fknight: not sure, then.
[2014-02-25 18:45:06 -0500] chef808: Hello. When using zabbix cookbook from here: https://github.com/laradji/zabbix I get the following error: undefined method `baseurl' for Chef::Resource::YumRepository at yum-epel/recipes/default.rb:27 >>  baseurl node['yum'][repo]['baseurl']
[2014-02-25 18:45:42 -0500] viglesias: chef808: do you have the yum cookbook?
[2014-02-25 18:45:43 -0500] viglesias: http://docs.opscode.com/lwrp_yum.html
[2014-02-25 18:46:08 -0500] jbell05: Hello again...
[2014-02-25 18:46:38 -0500] icarus_: im really confusing myself
[2014-02-25 18:46:41 -0500] jbell05: New questions (for those who are willing to tackle them)... first of all, am I just doing this in an unintelligent way, and second, (if the first is no), how can I make this work...
[2014-02-25 18:46:56 -0500] chef808: Yes. depends yum and yum-epel. Full error: http://pastie.org/8781412
[2014-02-25 18:47:02 -0500] jbell05: I'm trying to edit some node defaults by utilizing ruby's array + and - operators...
[2014-02-25 18:47:12 -0500] icarus_: theres 2 servers: chef-server and then we have a management node setup as a workstation with knife that authenticates against chef-server
[2014-02-25 18:47:19 -0500] icarus_: i can not find where chef-repo is located
[2014-02-25 18:47:25 -0500] jbell05: so, for instances, if we have a list of NTP peers (from the community cookbook), and I want to remove the another list from it, I'm trying to do something like this...
[2014-02-25 18:47:31 -0500] jbell05: node.default['ntp']['peers'] -= node.default['ntp-config']['autoPeers']
[2014-02-25 18:48:08 -0500] jbell05: In straight-up ruby, if you have a list such as %w{a b c d}, and you subtract from it %w{b d}, you get ['a', 'c']
[2014-02-25 18:48:21 -0500] jbell05: I'd like to produce that same result on the node defaults...
[2014-02-25 18:48:37 -0500] jcockhren: helfire: yeah. I have it sat in the run_list
[2014-02-25 18:48:40 -0500] jbell05: but apparently, those aren't actually arrays, but "Chef::Node::VividMash"es
[2014-02-25 18:48:58 -0500] anthroprose: jbelle: immutable depending on version & reference type, I usually do something like ntp-peers = node['ntp']['peers'], operate on ntp-peers, and then at the end re-assign it to node['ntp']['peers']
[2014-02-25 18:49:15 -0500] jbell05: Lovely.  I was hoping that kind of method would work...
[2014-02-25 18:49:15 -0500] anthroprose: (might not be best practices, but it works for me and is testable...)
[2014-02-25 18:49:27 -0500] jbell05: anthroprose: thanks.  I'll try that.
[2014-02-25 18:56:01 -0500] chef808: Any ideas on this: http://pastie.org/8781412
[2014-02-25 18:56:19 -0500] jbell05: anthroprose: It appears that assignment (such as ntpPeers = node.default['ntp']['peers']) still pulls up a VividMash
[2014-02-25 18:56:27 -0500] jbell05: ... should I not be using .default?
[2014-02-25 18:56:49 -0500] jbell05: Does node['ntp'] work as well? I'm fairly new at this...
[2014-02-25 18:59:37 -0500] anthroprose: it should have done a object re-assignment to a ruby array instead of whatever chef class it had
[2014-02-25 18:59:45 -0500] anthroprose: 1 sec, lemme find some old code if I can
[2014-02-25 19:01:04 -0500] jbell05: anthroprose: thanks - I appreciate it.
[2014-02-25 19:03:48 -0500] jbell05: anthroprose: FYI I just changed clients
[2014-02-25 19:03:52 -0500] jbell05: still here. :)
[2014-02-25 19:04:40 -0500] anthroprose: jbell: maybe try a .to_a or otherwise force the typecast
[2014-02-25 19:05:02 -0500] jbell05: Well the error is that it can't convert it to an array... let me see what I can come up with.
[2014-02-25 19:05:05 -0500] anthroprose: hell, I may have make a blank array and the iterated through the node's attr array to assign it to the ruby object
[2014-02-25 19:05:24 -0500] anthroprose: its been a little bit, but thats pretty much how I did it, chef -> ruby -> chef, and there is probably a better way
[2014-02-25 19:05:48 -0500] jbell05: Iteration would work -- didnt think of that (even though I'm doing it elsewhere LOL)
[2014-02-25 19:05:54 -0500] anthroprose: Array(node.default['ntp']['peers'])
[2014-02-25 19:06:00 -0500] anthroprose: yeah, its hacky
[2014-02-25 19:06:07 -0500] jbell05: Ah.. okay one sec.
[2014-02-25 19:06:36 -0500] anthroprose: technically, I think the opscode guys would say write a provider, that operated on the chef classes instead
[2014-02-25 19:06:47 -0500] anthroprose: so you would merge_ntp do...
[2014-02-25 19:07:43 -0500] jbell05: IMO this operation should already be provided by their own typing libraries since things like .each work on them though.... I'd rather not invent their wheel...
[2014-02-25 19:07:48 -0500] anthroprose: reason being then you could report on the ntp entries or the array as itself as a resource, so you know when they get updated or not
[2014-02-25 19:08:24 -0500] jbell05: hmm... I'm not 100% sure on how providers work yet... is it documented on opscode's site?
[2014-02-25 19:08:30 -0500] jbell05: probably yes, duh?
[2014-02-25 19:09:01 -0500] anthroprose: jbell: I think it's due to all of the merging layers for node attrs, they get converged then run, so if you go mucking with them at different stages, its not part of the logical flow (i do this alot admittidly)
[2014-02-25 19:09:29 -0500] anthroprose: jbell: http://docs.opscode.com/chef/lwrps_custom.html
[2014-02-25 19:09:53 -0500] jbell05: anthroprose: It seems though, that the community recipe does that anyway... if you don't have any defaults set for your ntp servers, it writes them.
[2014-02-25 19:10:19 -0500] anthroprose: community cookbooks are just that... and may or may not have best practices (one of the biggest issues in the community right now imho)
[2014-02-25 19:10:52 -0500] anthroprose: but following conventions is how we got where we are ;) so if it works somewhere else....
[2014-02-25 19:10:58 -0500] jbell05: I suppose you'd have that with a community... yeah LOL
[2014-02-25 19:11:45 -0500] anthroprose: what I do alot of times, is have an init.rb recipe (others do this with a wrapper cookbook and is the suggested method)
[2014-02-25 19:11:56 -0500] anthroprose: and thats where I do things like merge databags and node attrs
[2014-02-25 19:12:03 -0500] anthroprose: and do logic that sets up the run
[2014-02-25 19:12:07 -0500] jbell05: Interesting...
[2014-02-25 19:12:23 -0500] anthroprose: opscode says do this instead: http://www.getchef.com/blog/2013/12/03/doing-wrapper-cookbooks-right/
[2014-02-25 19:12:32 -0500] anthroprose: so you can properly version control
[2014-02-25 19:13:14 -0500] jbell05: I suppose I did the same thing in a different method... I've got an ntp-config cookbook that writes defaults for the NTP cookbook according to our infrastructure and doesn't modify the ntp cookbook at all.
[2014-02-25 19:13:28 -0500] jbell05: ... based on databags and our configs... for that very reason.
[2014-02-25 19:13:28 -0500] anthroprose: seems like you are on the correct path
[2014-02-25 19:13:41 -0500] jbell05: versioning got really really stupid as soon as i even tried to modify the community one
[2014-02-25 19:14:01 -0500] anthroprose: just wait till you get 4 Environments with 8 Roles each ;)
[2014-02-25 19:14:15 -0500] anthroprose: thats why people switched to the cookbook wrappers, so you can control all your deps
[2014-02-25 19:14:26 -0500] anthroprose: mattray: good day to you
[2014-02-25 19:14:28 -0500] jbell05: so my cookbook sets its own "auto" lists and the servers tag themselves base don recipe... and then auto-organize, set peers and whatnot based on tags.
[2014-02-25 19:14:37 -0500] jbell05: at least in theory. :)
[2014-02-25 19:14:39 -0500] mattray: anthroprose: greetings
[2014-02-25 19:15:07 -0500] anthroprose: jbell: I use the metadata for similar things, service orchestration and a little bit of state machine
[2014-02-25 19:15:20 -0500] jbell05: yeah.
[2014-02-25 19:15:32 -0500] anthroprose: cluster order-of-operations and what-not
[2014-02-25 19:15:39 -0500] jbell05: nice.
[2014-02-25 19:15:56 -0500] jbell05: FWIW I'm just about ankle deep in chef, so I'm sure there are a ton of things that I don't know how to do...
[2014-02-25 19:16:07 -0500] fknight: Where is the source code for chef-client?
[2014-02-25 19:16:17 -0500] fknight: All I've found is the cookbook for it.
[2014-02-25 19:16:17 -0500] anthroprose: quit paying attention for a week and come back, it'll still be the same ;)
[2014-02-25 19:16:18 -0500] jbell05: anthroprose: at the moment though, manually managing a collection of ~20 servers that do the same thing is a pain.
[2014-02-25 19:16:36 -0500] jbell05: So chef is a big deal for us
[2014-02-25 19:16:46 -0500] anthroprose: jbell: develop good patterns, and you will not notice the difference between 1 or 20
[2014-02-25 19:17:03 -0500] spicy: anyone have any advice for chasing down cookbook dependency issues on chef server? As per https://tickets.opscode.com/browse/CHEF-3921?
[2014-02-25 19:17:08 -0500] anthroprose: I wakeup sometimes to order of magnitude differences in my cluster sizes due to variable load/traffic
[2014-02-25 19:17:20 -0500] jbell05: Fun stuff.
[2014-02-25 19:17:37 -0500] anthroprose: with automation & lots of alerting, it is ;)
[2014-02-25 19:17:54 -0500] jbell05: Fab. Array() works.  Thanks again!
[2014-02-25 19:18:16 -0500] anthroprose: jbell: if you ever figure out a better/more proper way lemme know
[2014-02-25 19:18:25 -0500] jbell05: anthroprose: Will do!
[2014-02-25 19:19:13 -0500] anthroprose: mattray: should we be typecasting immutable node attr's to Ruby Array classes in order to manipulate them?
[2014-02-25 19:19:14 -0500] fknight: When chef-client runs, it synchronizes the cookbooks with the chef server. How do I flush the local cache of cookbooks?
[2014-02-25 19:19:33 -0500] anthroprose: fknight: /var/chef/cache?
[2014-02-25 19:20:39 -0500] mattray: fknight: https://github.com/opscode/chef/blob/master/lib/chef/client.rb
[2014-02-25 19:21:07 -0500] mattray: anthroprose: what are you trying to do?
[2014-02-25 19:21:20 -0500] jbell05: mattray: well it's more what I was trying to do...
[2014-02-25 19:21:22 -0500] fknight: Ah.. okay, so the local cache has the correct version. But chef-client doesn't seem to be running that version.
[2014-02-25 19:21:25 -0500] anthroprose: mattray: this was actually a jbell question, but I've done it before too
[2014-02-25 19:21:27 -0500] fknight: It's running an older version.
[2014-02-25 19:21:38 -0500] mattray: fknight: then it may be pinned by an Environment?
[2014-02-25 19:21:45 -0500] jbz: fknight: if an environmentwhat mattray said. :-)
[2014-02-25 19:21:50 -0500] anthroprose: essentially wanting to manipulate an array that is stored in the node attributes, such as merging, appending/removing entries
[2014-02-25 19:21:51 -0500] jbell05: mattray: I wanted to utilize Ruby's array adding & subtracting on some data contained in node.default
[2014-02-25 19:21:55 -0500] fknight: mattray: How do I check for that?
[2014-02-25 19:22:47 -0500] mattray: jbell05: I believe the Node object has hashes for default and override attributes, you want to look at those?
[2014-02-25 19:22:59 -0500] mattray: s/hash/Mash/
[2014-02-25 19:23:18 -0500] anthroprose: not just look, but change
[2014-02-25 19:23:21 -0500] jbell05: mattray: I can access them... the problem is that the VividMash type doesn't work with Ruby's += and -= operators
[2014-02-25 19:23:30 -0500] jbell05: (and possibly + and - though I haven't tried)
[2014-02-25 19:23:54 -0500] anthroprose: essentially trying to use Ruby iterators/operations on Chef objects ;)
[2014-02-25 19:23:55 -0500] mattray: it escapes me off the top of my head, I'd throw a pry breakpoint in where I'm curious and look around
[2014-02-25 19:23:55 -0500] jbell05: so the idea being I want to do VividMash -= VividMash where both look like arrays (in the json, they're bound by [brckets])
[2014-02-25 19:24:37 -0500] anthroprose: so I've always just typecast to ruby, then re-assigned to the node attribute
[2014-02-25 19:24:37 -0500] jbell05: Is there a good guide to utilizing breakpoints?  I tried using chef-shell and it really didn't like me at all...
[2014-02-25 19:25:43 -0500] mattray: jbell05: Chef 11.8 and later have pry built in
[2014-02-25 19:26:09 -0500] mattray: which makes this irrelevant except the README tells you how to use a breakpoint
[2014-02-25 19:26:09 -0500] mattray: https://github.com/mattray/chef-pry-cookbook
[2014-02-25 19:26:25 -0500] jbell05: Okay... so do I just put the pry breakpoint statement into my recipe and then run chef-client?
[2014-02-25 19:26:29 -0500] mattray: yup
[2014-02-25 19:26:29 -0500] jbell05: kk... I'll read that over.
[2014-02-25 19:26:34 -0500] mattray: it's super sweet
[2014-02-25 19:26:53 -0500] mattray: because then you have the Node and context and a full on debugger
[2014-02-25 19:27:07 -0500] jbell05: ... when I have more time to diagnose. at the moment I just wanna get it runnign... I'll do that with v2 of my cookbook.
[2014-02-25 19:27:09 -0500] jbell05: Thanks for the tip.
[2014-02-25 19:28:02 -0500] anthroprose: jbell: https://github.com/opscode/chef/blob/1bb1a934fe397874b86ec00d6aff2df7b3eb6017/lib/chef/node/attribute.rb
[2014-02-25 19:28:12 -0500] anthroprose: maybe try just using the dsl's methods
[2014-02-25 19:29:10 -0500] anthroprose: why o why invent new names for everything
[2014-02-25 19:29:21 -0500] jbell05: LOL perhaps?
[2014-02-25 19:29:33 -0500] anthroprose: job security ;)
[2014-02-25 19:29:36 -0500] jbell05: (honestly at the moment I'm not versed enough in ruby to understand this source)
[2014-02-25 19:30:17 -0500] anthroprose: .inject/.reject maybe, its not intuitive *at all*
[2014-02-25 19:31:09 -0500] jbell05: As in... .inject == "+=" and .reject == "-="?
[2014-02-25 19:31:13 -0500] jbell05: dur.
[2014-02-25 19:31:28 -0500] anthroprose: not sure, I'm just spouting with no code run at this point
[2014-02-25 19:31:33 -0500] jbell05: I'll futz with that later... yeah
[2014-02-25 19:31:35 -0500] jbell05: no kidding
[2014-02-25 19:31:39 -0500] anthroprose: but i would assume the dsl would allow for operations
[2014-02-25 19:31:51 -0500] jbell05: in theory LOL but that's what brought me here. :P
[2014-02-25 19:31:58 -0500] anthroprose: welcome to the club!
[2014-02-25 19:32:09 -0500] anthroprose: making stuff up as we go along here
[2014-02-25 19:32:33 -0500] jbell05: yeah no kidding
[2014-02-25 19:32:52 -0500] anthroprose: meetups are nice, depending on your town
[2014-02-25 19:32:58 -0500] anthroprose: thats where most knowledge gets swapped
[2014-02-25 19:33:14 -0500] jbell05: what's funny is I have to do this like four times -- one for each remove/insert operation on a different list each time
[2014-02-25 19:33:53 -0500] anthroprose: so...
[2014-02-25 19:34:17 -0500] jbell05: IDK. Just funny I suppose. it's a lil bit round about to typecast.  At the moment I want to get the POC workign.  I'll make it pretty later.
[2014-02-25 19:34:23 -0500] jbell05: Thanks for the help again... i'm bouncin outta here.
[2014-02-25 19:34:53 -0500] anthroprose: jbell: https://github.com/poise/poise
[2014-02-25 19:35:04 -0500] anthroprose: good luck :)
[2014-02-25 19:35:17 -0500] jbell05: Thanks again.
[2014-02-25 19:37:57 -0500] fknight: mattray: So can chef-client be pinned to an environment if I only have one environment? And it's never been changed?
[2014-02-25 19:38:28 -0500] mattray: fknight: yes. All nodes have an implicit "_default" Environment
[2014-02-25 19:38:37 -0500] mattray: _default is immutable
[2014-02-25 19:38:46 -0500] fknight: mattray: Right, it's never been anything but _default
[2014-02-25 19:39:07 -0500] mattray: but you can add another and move your node to it, pinning cookbook versions
[2014-02-25 19:39:45 -0500] fknight: mattray: Right, but that never happened. It's always been _default, so I don't think it's been pinned in any way.
[2014-02-25 19:39:45 -0500] bmhatfield: We're running into a bug with chef-zero that seems to be fixed in 2.0.2 - has anyone successfully be able to run 2.0.2 alongside the chef client gem that explicitly depends on 1.7.3?
[2014-02-25 19:40:02 -0500] mattray: fknight: right, you can't pin anything in _default
[2014-02-25 19:41:08 -0500] fknight: mattray: Yeah, I'm at a loss as to why it won't update to the newest version of my recipe. Would digging through the source code help? Or is there a better way to understand where the problem is?
[2014-02-25 19:42:13 -0500] mattray: fknight: what version of Chef?
[2014-02-25 19:43:01 -0500] fknight: mattray: I've got Chef: 11.8.0
[2014-02-25 19:43:18 -0500] micgo: bmhatfield: is this bug due to the metadata not reading properly?
[2014-02-25 19:43:46 -0500] bmhatfield: micgo: No, chef-zero is sending us empty responses for cookbook_versions when the runlist is too long
[2014-02-25 19:43:52 -0500] mattray: fknight: so you have a node that has applied an older version of the cookbook but is not downloading the new version?
[2014-02-25 19:43:57 -0500] bmhatfield: it's causing EOF exceptions within chef-client itself
[2014-02-25 19:44:15 -0500] bmhatfield: the behavior does not seem to occur in chef-zero 2.0.2 but is happening in 1.7.3
[2014-02-25 19:44:20 -0500] fknight: mattray: It's not running the new version. It's actually got the new version in it's cache, but it's not being run.
[2014-02-25 19:44:42 -0500] bmhatfield: The only problem is I need chef-zero running as a process AND I need the chef gem.
[2014-02-25 19:44:49 -0500] mattray: fknight: and the new version > greater than the old version?
[2014-02-25 19:45:08 -0500] bmhatfield: And for some reason chef has been slow to keep up with versions.
[2014-02-25 19:45:23 -0500] mattray: fknight: do you have other cookbooks pinning the dependency?
[2014-02-25 19:45:37 -0500] fknight: mattray: Actually the version numbers haven't been bumped at all. It's a custom cookbook that has been at 0.0.1 the entire time.
[2014-02-25 19:45:43 -0500] micgo: bmhatfield: hmmm the only thing that was in 2.0.2 that was backported for 1.7.3 was the JSON reading problem everything else doesn't seem like it was related
[2014-02-25 19:45:51 -0500] fknight: mattray: I will try bumping that version, but I'm not sure if that's the issue.
[2014-02-25 19:46:32 -0500] mattray: fknight: odd, like it doesn't care that you've uploaded a new version
[2014-02-25 19:46:36 -0500] micgo: bmhatfield: does 2.0.1 or 2.0.0 work as well?
[2014-02-25 19:47:19 -0500] bmhatfield: micgo: I'm not sure I understand what you mean about things being backported - I've only tested on 1.7.3 and 2.0.2
[2014-02-25 19:48:14 -0500] bmhatfield: micgo:  one moment, I have a reduced CURL command that can reproduce, let me try 2.0.0
[2014-02-25 19:48:56 -0500] micgo: bmhatfield: So 1.7.3 contains a fix to from_json that was in 2.0.2 that was backported there was a decent amount of work done in 2.0.0 and 2.0.1 that might also be the fix
[2014-02-25 19:49:05 -0500] fknight: mattray: Yea, I used to do lots of Rails work before I started this job. I've been learning lots of chef since I started and learning how little they seem to conform to best practices.
[2014-02-25 19:50:01 -0500] bmhatfield: micgo: Ah, yes - so to be more clear: I /do/ have the problem in 1.7.3 but not in 2.0.2. So There's a number of things that could have solved it.
[2014-02-25 19:50:06 -0500] CPS: Is there a way to use an erb file as a template source that is outside of the chef cookbook?
[2014-02-25 19:50:11 -0500] bmhatfield: I'll try to repro again right now, one moment.
[2014-02-25 19:50:35 -0500] micgo: bmhatfield: you should be able to run the 2.x version of the chef-zero gem without issue per this ticket: https://tickets.opscode.com/browse/CHEF-4901
[2014-02-25 19:50:55 -0500] fknight: mattray: At first glance bumping the version number doesn't help much.
[2014-02-25 19:51:31 -0500] mattray: fknight: and you already deleted the /var/chef/cache version?
[2014-02-25 19:51:50 -0500] bmhatfield: micgo: yeah, I saw that, but bundler freaks out because of Chef's dependencies
[2014-02-25 19:51:52 -0500] mattray: fknight: I'm really curious what's happening
[2014-02-25 19:52:10 -0500] fknight: mattray: What would the repercussions be of deleting /var/chef/cache? I'm on a production server, so I don't want to blow it away and then be left in a bad state.
[2014-02-25 19:52:16 -0500] mattray: fknight: chef-client -l debug will show http headers on the cookbook requests
[2014-02-25 19:52:37 -0500] mattray: fknight: it's safe, it'll re-download the contents
[2014-02-25 19:52:39 -0500] CPS:  is there somewhere to file feature requests?
[2014-02-25 19:52:45 -0500] micgo: bmhatfield: yeah, if you are using bundler, I'm not sure how to fix that since '~> 1.7' is in the gemspec for the current versions of chef :(
[2014-02-25 19:53:12 -0500] fknight: mattray: Okay, but if /var/chef/cache looks correct, should I bother with it?
[2014-02-25 19:53:16 -0500] mattray: CPS: like what?
[2014-02-25 19:53:37 -0500] fknight: mattray: I don't think the cache is the problem, but maybe the way it reads it? Or maybe there's some in-memory cache? I dunno
[2014-02-25 19:53:42 -0500] mattray: fknight: can't hurt
[2014-02-25 19:54:00 -0500] CPS: mattray: the template resource only allows you to use erb files pulled from the chef server into the cache, not external files
[2014-02-25 19:54:14 -0500] CPS: i have a situation where using an external erb file would solve a lot of problems
[2014-02-25 19:55:18 -0500] mattray: CPS: hmmmm....
[2014-02-25 19:55:57 -0500] CPS: i tried copying to the cache as part of the recipe run but that didn't work
[2014-02-25 19:56:05 -0500] peoplemerge: mattray: hey loved your talk at #scale12x
[2014-02-25 19:56:23 -0500] fknight: mattray: Yea, no luck there. I removed the cache, it got rebuilt by chef-client with the correct recipes, but running chef-client did not install the proper files I expected.
[2014-02-25 19:56:25 -0500] CPS: and using a full path for the source gives file not found: templates/windows-6.1.7601/D:\files\asdf.erb
[2014-02-25 19:56:58 -0500] mattray: fknight: so the right files are in /var/chef/cache?
[2014-02-25 19:57:08 -0500] fknight: mattray: Yes. Those files are correct.
[2014-02-25 19:57:21 -0500] fknight: mattray: It's just the run and the result of the run that is incorrect.
[2014-02-25 19:57:30 -0500] mattray: fknight: that leads me to believe that the recipe isn't doing what you think it is doing
[2014-02-25 19:57:53 -0500] fknight: mattray: Nah, it's just one configuration file that it needs to install.
[2014-02-25 19:58:05 -0500] pokerface3: Hey all.
[2014-02-25 19:58:11 -0500] fknight: mattray: It's spitting out the old version of that file, not the new one I've got
[2014-02-25 19:58:12 -0500] mattray: maybe move the existing config file to file.bak and re-run the chef-client
[2014-02-25 19:58:29 -0500] fknight: mattray: I've tried deleting and re-running without much help
[2014-02-25 19:58:33 -0500] mattray: CPS: I'd open a bug on tickets.opscode.com, you'll start a conversation there
[2014-02-25 19:58:39 -0500] pokerface3: Anyone know how to configure splunk with chef as an universal forwarder?
[2014-02-25 19:58:42 -0500] CPS: will do
[2014-02-25 19:59:01 -0500] mattray: fknight: hmmm try doing knife cookbook delete and then knife cookbook upload
[2014-02-25 19:59:13 -0500] mattray: fknight: nuts, that won't change anything either
[2014-02-25 19:59:28 -0500] mattray: fknight: you have the right .erb in /var/cache/chef?
[2014-02-25 19:59:38 -0500] fknight: mattray: Yea, it's not happening at the server level. It's definitely something screwy with chef-client
[2014-02-25 19:59:48 -0500] fknight: mattray: Yes, that version is correct
[2014-02-25 20:00:13 -0500] fknight: mattray: If you have a bitcoin address, I'll buy you a beer for your help so far!
[2014-02-25 20:00:18 -0500] mattray: fknight: lol
[2014-02-25 20:00:19 -0500] pokerface3: I'm using https://github.com/bestbuycom/splunk_cookbook but I can't seem to find where I define the listener/indexer that the clients will forward logs too. Anyone have any ideas? I've been working on this for many hours now and I still can't seem to figure it out.
[2014-02-25 20:00:44 -0500] fknight: mattray: No one else at the office really has a good understanding of chef and the docs out there are a bit thin on issues like this.
[2014-02-25 20:01:40 -0500] bmhatfield: micgo: thanks for jumping in. You've at least given me a pointer that might help.
[2014-02-25 20:02:15 -0500] mattray: fknight: so you've moved the existing config file out of the way and re-run chef and the old version comes back, which isn't the version in /var/chef/cache/cookbooks/FOO/templates/?
[2014-02-25 20:02:27 -0500] fknight: mattray: Exactly
[2014-02-25 20:02:36 -0500] peoplemerge: Question about chef roadmap... "Please be aware that you just installed a ruby that is no longer maintained ... Please consider upgrading to ruby-2.1.0"
[2014-02-25 20:02:59 -0500] mattray: peoplemerge: Chef 12 Omnibus will probably be ruby 2.1
[2014-02-25 20:03:13 -0500] mattray: Chef 11 omnibus is currently 1.9.3
[2014-02-25 20:03:29 -0500] peoplemerge: mattray: at chefconf?
[2014-02-25 20:04:52 -0500] mattray: fknight: try moving the file, deleting the cache, running chef-client -l debug and sending me a DM with a private gist of it
[2014-02-25 20:07:06 -0500] coalbe: Is it possible to exclude a recipe much like you can do an "include_recipe"?
[2014-02-25 20:14:25 -0500] CPS: mattray mmzyk https://tickets.opscode.com/browse/CHEF-5077
[2014-02-25 20:17:36 -0500] coalbe: Or at least a way to drop a recipe from the runlist when declared in another cookbook.
[2014-02-25 20:18:43 -0500] helfire: coalbe: can you just edit the other recipe, or have a wrapper cookbook that includes only the recipes you want?
[2014-02-25 20:20:11 -0500] coalbe: hmm, perhaps a wrapper is best.
[2014-02-25 20:20:34 -0500] helfire: ya, it would be unexpected if someone saw it was included in the run-list, then suddently it was gone after it entered your recipe
[2014-02-25 20:21:09 -0500] coalbe: i have a production cookbook i want to use for local development, but exclude the monitoring that it includes.
[2014-02-25 20:21:17 -0500] coalbe: if that makes sense
[2014-02-25 20:21:32 -0500] helfire: if chef_env != production then dont include
[2014-02-25 20:21:39 -0500] helfire: in you're wrapper
[2014-02-25 20:22:36 -0500] coalbe: Ah, I havent implemented env's yet, is my catch. perhaps i'll start there.
[2014-02-25 20:25:15 -0500] AntelopeSalad: does anyone know why chef's deploy resource keeps trying to run an old version of the app code it's pulling in from a git repo?
[2014-02-25 20:25:24 -0500] coalbe: helfire: tanks
[2014-02-25 20:25:25 -0500] coalbe: *thanks
[2014-02-25 20:25:57 -0500] AntelopeSalad: i pushed to the server, it has the latest version in shared/cached-copy yet every chef-run results in an error because it's using code from like 5 releases ago instead of HEAD -- even tho it's set to use HEAD
[2014-02-25 20:26:52 -0500] mattsurabian: anyone else seen knife cookbook upload -all not actually upload cookbooks? Reports that it uploaded all cookbooks but unless I do it individually they don't actually get uploaded
[2014-02-25 20:28:38 -0500] mattsurabian: as in I don't see them within the opscode management console
[2014-02-25 20:30:48 -0500] mattsurabian: hah interesting, -all makes it seem like it's running, but the actual option is either -a or --all
[2014-02-25 20:31:03 -0500] mattsurabian: --all actually uploaded em
[2014-02-25 20:32:17 -0500] kbarry: I think i might be confused with  heredoc usage,
[2014-02-25 20:32:27 -0500] kbarry: I want to use some attributes inside a heredoc
[2014-02-25 20:41:01 -0500] pokerface3: Anyone? Please.
[2014-02-25 20:43:01 -0500] pokerface3: ;'(
[2014-02-25 20:57:10 -0500] pokerface3: Has anyone gotten splunkforwarder to work with Chef?
[2014-02-25 21:01:46 -0500] j^2: pokerface3: which part of chef?
[2014-02-25 21:03:26 -0500] AntelopeSalad: can someone fill in a few gaps from this article please http://tech.hulu.com/blog/2012/07/06/automating-system-provisioning-and-application-deployment-with-chef/
[2014-02-25 21:03:56 -0500] AntelopeSalad: if you scroll down about half way there's a deploy resource , but the symlinked directories in /shared are never created so the symlinks are dead
[2014-02-25 21:04:42 -0500] AntelopeSalad: how would i go about symlinking the contents of a few directories into the shared folder?
[2014-02-25 21:06:46 -0500] anthroprose: AntelopeSalad: the deploy resource is kinda written for Capistrano or at least in it's same style
[2014-02-25 21:07:00 -0500] anthroprose: which is why/how it knows where the shared dir is
[2014-02-25 21:07:10 -0500] AntelopeSalad: anthroprose: yeah but the shared folder for me is always empty
[2014-02-25 21:07:31 -0500] AntelopeSalad: except for the cache-copy folder which is the git repo's original contents
[2014-02-25 21:07:41 -0500] pokerface3: j^2: I'm trying to configure splunk via chef and I'm not sure how to do it correctly.
[2014-02-25 21:07:59 -0500] pokerface3: I got it installing and using the proper input.conf but its not adding the forward-server
[2014-02-25 21:08:10 -0500] j^2: ah, pokerface3 yeah i've gotten it to work, one sec
[2014-02-25 21:08:16 -0500] pokerface3: Thanks!
[2014-02-25 21:08:19 -0500] j^2: pokerface3: i'll show you the main recipe
[2014-02-25 21:08:32 -0500] anthroprose: AntelopeSalad: and you have directories under ./ of the git repo to be shared?
[2014-02-25 21:08:59 -0500] j^2: pokerface3: total hack but here -> https://gist.github.com/jjasghar/97ea27ebed4404216d84
[2014-02-25 21:09:42 -0500] AntelopeSalad: anthroprose: in the "current" release yes, i would like the contents of a few dirs to be stored in the shared folder instead of current -- and then current would read from the symlink
[2014-02-25 21:09:57 -0500] pokerface3: Thanks j^2
[2014-02-25 21:09:58 -0500] anthroprose: im using the git provider to deploy because I don't need the complexity, so im just going based on me poking at it a while back
[2014-02-25 21:10:01 -0500] pokerface3: I'm going to give this a try.
[2014-02-25 21:10:17 -0500] j^2: pokerface3: no problem, there's some attrubiutes you'll need to set, but it should do the heavy lifting for you
[2014-02-25 21:10:39 -0500] pokerface3: thanks j^2
[2014-02-25 21:10:40 -0500] AntelopeSalad: anthroprose: specifically i am deploying a rails app and inside of the root rails dir i want these directories: log tmp public/system public/assets , to all be symlinked from current to /shared/*
[2014-02-25 21:10:53 -0500] AntelopeSalad: i hope that makes sense
[2014-02-25 21:11:28 -0500] anthroprose: AntelopeSalad: https://github.com/opscode/chef/blob/master/lib/chef/provider/deploy.rb lines 290++
[2014-02-25 21:11:51 -0500] AntelopeSalad: for some reason it always doubles up the directories for me
[2014-02-25 21:12:47 -0500] AntelopeSalad: for example i used this directly from that hulu blog post https://gist.github.com/AntelopeSalad/9217873
[2014-02-25 21:12:52 -0500] pokerface3: j^2, where do you define :forward_server
[2014-02-25 21:13:04 -0500] AntelopeSalad: and when i do a chef run, the /shared/ folder is always empty except for the cached-copy
[2014-02-25 21:13:08 -0500] brimstone: why does the run_list specified by chef-client -j overrite the run_list on chef-server?
[2014-02-25 21:13:15 -0500] j^2: pokerface3: it's an attrubute
[2014-02-25 21:13:18 -0500] brimstone: more importantly, how can i prevent that?
[2014-02-25 21:13:27 -0500] j^2: in the default.rb in attrubutes
[2014-02-25 21:13:29 -0500] j^2: i cant spell
[2014-02-25 21:13:36 -0500] pokerface3: no worries
[2014-02-25 21:13:45 -0500] pokerface3: ok
[2014-02-25 21:14:23 -0500] anthroprose: brimstone: -o does a temp override
[2014-02-25 21:14:36 -0500] brimstone: anthroprose: thanks, i just found that in the man page too
[2014-02-25 21:14:45 -0500] brimstone: i was looking for a merge of some sort, but a temp override will work
[2014-02-25 21:14:46 -0500] anthroprose: they recently changed some of that be havior
[2014-02-25 21:15:01 -0500] anthroprose: it didnt used to, so if you are pre 11.8.x or so, i'd double check on things
[2014-02-25 21:15:05 -0500] AntelopeSalad: anthroprose: it's really difficult because the docs for the deploy resource is written for a version of rails that's like 5 years old, so has much changed
[2014-02-25 21:15:21 -0500] brimstone: AntelopeSalad: i'm 11.10.1 i think
[2014-02-25 21:15:23 -0500] anthroprose: AntelopeSalad: pretty much the same boat I am in 50% of the time ;)
[2014-02-25 21:15:24 -0500] AntelopeSalad: i'm beginning to think no one uses chef to deploy apps haha
[2014-02-25 21:15:43 -0500] AntelopeSalad: because there's not a single (not even 1) blog post explaining how to use deploy for a version of rails that's close to relevant
[2014-02-25 21:16:02 -0500] AntelopeSalad: i have it like 99% setup but the symlink stuff is undocumented and really difficult to figure out
[2014-02-25 21:16:06 -0500] anthroprose: so write one and help save the world of bad chef practices ;)
[2014-02-25 21:16:13 -0500] AntelopeSalad: i would if i could get this to work
[2014-02-25 21:16:22 -0500] jbellone: Anyone have experience with knife-openstack? I seem to be hitting issues where I an unable to destroy servers :(.
[2014-02-25 21:16:30 -0500] anthroprose: I dont do ruby apps or the lwrp, so im not much help other than looking at the code
[2014-02-25 21:16:37 -0500] AntelopeSalad: i've spent the last 18 hours over 2 days working with the deploy resource, it's so close to done except for the symlinking of certain folders
[2014-02-25 21:16:58 -0500] anthroprose: jbellone: i use knife-ec2 and imma say, security groups, routing, certificate permissions, ssh username
[2014-02-25 21:17:13 -0500] AntelopeSalad: it's not specific to ruby or rails, it's just the deploy resource in general that i need help with
[2014-02-25 21:17:17 -0500] anthroprose: AntelopseSalad: you can monkeypatch the provider
[2014-02-25 21:17:28 -0500] jbellone: anthroprose: Yeah, specifically knife-openstack seems to fail only on server destroying.
[2014-02-25 21:17:33 -0500] AntelopeSalad: i don't even know what a provider is
[2014-02-25 21:17:39 -0500] anthroprose: ah
[2014-02-25 21:17:59 -0500] AntelopeSalad: all i know is the deploy resource has almost half a dozen symlink related functions but only 1 of them does what makes sense based on reading its name
[2014-02-25 21:18:23 -0500] benner: can you give a hint how to test cookbooks with encrypted databags using test kitchen?
[2014-02-25 21:18:33 -0500] anthroprose: benner: chef-solo
[2014-02-25 21:18:36 -0500] anthroprose: er chef-zero
[2014-02-25 21:18:37 -0500] anthroprose: sorry
[2014-02-25 21:22:27 -0500] benner: anthroprose: chef-zero
[2014-02-25 21:22:53 -0500] benner: and vagrant
[2014-02-25 21:36:52 -0500] mrkyle: I am having a difficult time understanding this: https://github.com/opscode-cookbooks/users
[2014-02-25 21:37:04 -0500] mrkyle: the model seems to suggest that group membership is an attribute of a user
[2014-02-25 21:37:28 -0500] mrkyle: on some machines, we have users in one set of groups, on other machines, they have different access and responsibility
[2014-02-25 21:37:43 -0500] mrkyle: is that cookbook the wrong way to approach this problem?
[2014-02-25 21:39:35 -0500] jbellone: The users or the groups? If they're in the same groups you can control their rights with sudo, etc.
[2014-02-25 21:40:39 -0500] mrkyle: well, sudo crossed my mind, but right part of sudo's access is based on group memberships
[2014-02-25 21:41:20 -0500] mrkyle: so on box-a some user might have access to his three company directories, and on another, he might only have access to one directory
[2014-02-25 21:41:35 -0500] jbellone: But you control that access via groups?
[2014-02-25 21:41:40 -0500] mrkyle: so group membership is not the same across the board
[2014-02-25 21:41:55 -0500] jbellone: Ah I see.
[2014-02-25 21:42:00 -0500] mrkyle: yes, right now group membership is largely how it's handled
[2014-02-25 21:43:49 -0500] jbellone: mrkyle: I find it much easier to keep group membership the same and just modify the individual ownerships on the machie.
[2014-02-25 21:44:33 -0500] anthroprose: benner: that is what I use yes
[2014-02-25 21:45:02 -0500] anthroprose: then I take all that & use packer to make a vagrant box for the developers
[2014-02-25 21:47:35 -0500] mrkyle: jbellone: thanks for the input, I may try my hand at writing something on my own, I don't thnk we're going to be able to make huge changes right now
[2014-02-25 22:43:01 -0500] icarus_: I'm having trouble pushing changes from a chef-repo to chef server, and then having chef-client reflect those changes
[2014-02-25 22:43:36 -0500] icarus_: I'm using 'berks upload' to get the changes to chef server
[2014-02-25 22:44:00 -0500] icarus_: however i cant find where on chef server any components of my chef-repo reside
[2014-02-25 22:44:53 -0500] icarus_: "find / -type f | grep knife.rb" on the chef server doesn't show anything related to my chef repo
[2014-02-25 22:45:15 -0500] icarus_: My understanding of chef is probably not correct, but im not seeing how chef server is getting any of these changes
[2014-02-25 22:49:19 -0500] AcesWayUpHigh: icarus_, i believe knife is only on the chef-client?
[2014-02-25 22:50:05 -0500] Guest81188: knife is the interface to push things to the server as well as manage chef-clients on individual nodes
[2014-02-25 22:52:46 -0500] Guest81188: your chef server should have an http interface that allows you to see the state of the world
[2014-02-25 22:52:48 -0500] icarus_: AcesWayUpHigh: Guest81188: it can be run from a workstation as well, correct?
[2014-02-25 22:53:16 -0500] Guest81188: I've never tried that myself, but theoretically I suppose
[2014-02-25 22:53:25 -0500] AcesWayUpHigh: icarus_, yes, it should be on the workstation and the clients (nodes)
[2014-02-25 22:53:27 -0500] Guest81188: for local server functionality I've tended to use chef-zero instead
[2014-02-25 22:53:30 -0500] Guest81188: more light weight
[2014-02-25 22:53:44 -0500] Guest81188: oh, sorry, I may have misunderstood your question
[2014-02-25 22:53:51 -0500] AcesWayUpHigh: the workstation is usually where you run knife from
[2014-02-25 22:57:58 -0500] icarus_: i have made changes to chef-repo files, specifically: vendor/cookbooks/company/templates/default/ping.html.erb
[2014-02-25 22:58:39 -0500] icarus_: ive added an html comment to test the file being pushed to the nodes
[2014-02-25 22:59:05 -0500] icarus_: i run berks upload, which pushes the chef-repo presumably to chef-server
[2014-02-25 22:59:12 -0500] icarus_: then go to a node, and run chef-client
[2014-02-25 22:59:43 -0500] icarus_: and then cat ping.html on the node, and my added comment isn't there
[2014-02-25 23:01:30 -0500] josephholsten: if I hate the depsolver and I want to know what state it's in when it jams, is there a tool I should use to live inspect/debug the erchef process?
[2014-02-25 23:01:47 -0500] icarus_: knife cookbook upload --all, similary doesn't seem to push the ping.html revision to the node when i run chef-client
[2014-02-25 23:03:10 -0500] Guest81188: if you do knife node show <node name>, do you see the correct things in the runlist?
[2014-02-25 23:03:17 -0500] josephholsten: icarus_: I'd check that the correct version of your cookbook is present in /var/cache/chef/cookbooks (or equivalent for your install)
[2014-02-25 23:16:38 -0500] josephholsten: hmm, if I want to access the chef-server's postgres tables, what are the users (esp for readonly)
[2014-02-25 23:20:11 -0500] icarus_: ls
[2014-02-25 23:31:23 -0500] redondos: hi. what's the recommended way of getting the default gateway in chef?
[2014-02-25 23:32:11 -0500] redondos: i can parse netstat or ip route, but is there a resource I can use? Youscribe/network_interfaces seems to allow it
[2014-02-25 23:35:22 -0500] mjuszczak: Does anyone here NOT recommend the berkshelf method? IE: sticking with roles instead of using cookbooks and wrapper cookbooks
[2014-02-25 23:35:41 -0500] redondos: not me
[2014-02-25 23:37:16 -0500] mjuszczak: redondos: meaning you do recommend it or you don't?
[2014-02-25 23:37:17 -0500] pushnell: it's worked well for me, but I only use role attributes in very rare occasions
[2014-02-25 23:37:49 -0500] mjuszczak: pushnell: the berkshelf method has?  So you don't define roles inside chef server at all?
[2014-02-25 23:39:36 -0500] pushnell: No, I use roles.  Our environment has several different well-defined "classes" of servers -- each server has a specific job to do from a list of about 7-8 jobs.  I think that having a well-defined and segmented environment makes total sense with roles.
[2014-02-25 23:39:50 -0500] pushnell: My suspicion is that too many people have a collection of snowflakes and then expect chef to help them maintain it.
[2014-02-25 23:41:07 -0500] mjuszczak: We have pretty well-defined servers.  MySQL servers, Worker servers, NginX servers.... each serves a purpose.
[2014-02-25 23:41:13 -0500] pushnell: I only ever use role attributes to create snowflakes -- usually for testing purposes, like building a server with non-standard code branches.  Snowflakes don't last long in my life.
[2014-02-25 23:41:58 -0500] seryl: problem with roles vs cookbooks-as-roles
[2014-02-25 23:42:01 -0500] mjuszczak: pushnell: so then, do you still create cookbooks for each role, or do you include sub-roles with roles
[2014-02-25 23:42:02 -0500] seryl: is roles cannot be versioned
[2014-02-25 23:42:06 -0500] mjuszczak: yeah.
[2014-02-25 23:42:19 -0500] seryl: that's more of the fundamental problem
[2014-02-25 23:42:25 -0500] seryl: and cookbooks can do everything that a role can do
[2014-02-25 23:43:01 -0500] pushnell: Yeah, I've never understood why people want their roles to be versioned.  Does your webserver stop serving webpages at a certain version?  etc.
[2014-02-25 23:43:23 -0500] seryl: You are making money and at no cost want to have that fail
[2014-02-25 23:43:26 -0500] coderanger: pushnell: Try upgrading from Apache 2.2 to 2.4 and you will understand why it matters :)
[2014-02-25 23:43:29 -0500] seryl: it's pretty straightforward
[2014-02-25 23:43:31 -0500] seryl: like
[2014-02-25 23:43:34 -0500] seryl: you have a business
[2014-02-25 23:43:50 -0500] coderanger: pushnell: And if your solution is a role named 'webserver2' then you've lost the game ;-)
[2014-02-25 23:44:14 -0500] coderanger: Ditto for a DB upgrade
[2014-02-25 23:44:15 -0500] pushnell: We switched from apache to nginx at one point for our main app servers, which wasn't a problem .... mainproduct_appserver stayed in place and we created mainproduct_nginx_appserver ...
[2014-02-25 23:44:34 -0500] coderanger: pushnell: Yeah, thats terrible and loses most of the semantic meaning of a role
[2014-02-25 23:44:37 -0500] pushnell: when all the apache servers were gone, we deleted the old role
[2014-02-25 23:44:51 -0500] coderanger: For example every search referencing it needs to be updated too
[2014-02-25 23:46:13 -0500] pushnell: Hm, yeah, I never used roles for searching though.
[2014-02-25 23:46:40 -0500] seryl: using roles instead of cookbooks is like copying files for version control
[2014-02-25 23:48:27 -0500] pushnell: We build our recipes in layers, so there was a webserver layer and then the actual site deploy/config layer.  We search by nodes with the site deploy recipe in the runlist.
[2014-02-25 23:48:36 -0500] pushnell: and similar elsewhere
[2014-02-25 23:49:20 -0500] seryl: cannot lock environments to a specific version of a role
[2014-02-25 23:49:22 -0500] seryl: you can a cookbook
[2014-02-25 23:54:47 -0500] pushnell: sounds like you got bit hard by some role issues, seryl.  We've never had any issues with using roles, but I guess that's why this debate rages on :)
[2014-02-25 23:55:40 -0500] seryl: Versioning is just good practice, after doing installations where multiple environments were heavily used, it become extremely important
[2014-02-25 23:55:46 -0500] seryl: but ya, definitely got bit.
[2014-02-25 23:55:53 -0500] brucelee_: i just included the opscode snort cookbook in a default wrapper cookbook
[2014-02-25 23:56:02 -0500] coderanger: pushnell: Its just a question of your churn rate
[2014-02-25 23:56:04 -0500] brucelee_: i just typed "include_recipe snort" but it doesnt seem to work
[2014-02-25 23:56:08 -0500] brucelee_: how do i get it to install snort?
[2014-02-25 23:56:13 -0500] coderanger: You can use the env-speicifc-run-lists system to move stuff around between envs
[2014-02-25 23:56:29 -0500] coderanger: but its a manual copy-pasta to do env->env promotions
[2014-02-25 23:56:31 -0500] redondos: brucelee_: did you add the dependency to metadata.rb?
[2014-02-25 23:56:43 -0500] brucelee_: yeah
[2014-02-25 23:56:45 -0500] brucelee_: in my vagrant vm
[2014-02-25 23:56:46 -0500] brucelee_: its in there
[2014-02-25 23:56:47 -0500] AntelopeSalad: btw coderanger, yesterday you mentioned you won't be using the deploy resource in application 2.0 , what shortcomings did you run into using it?
[2014-02-25 23:56:58 -0500] redondos: brucelee_: so it is working?
[2014-02-25 23:56:59 -0500] coderanger: AntelopeSalad: The many to list
[2014-02-25 23:57:09 -0500] brucelee_: redondos: the cookbook for snort is in htere
[2014-02-25 23:57:11 -0500] brucelee_: but it didnt install snort
[2014-02-25 23:57:18 -0500] redondos: oh.
[2014-02-25 23:57:24 -0500] coderanger: AntelopeSalad: For one, I need to accommodate omnibus-packaged apps
[2014-02-25 23:57:31 -0500] AntelopeSalad: coderanger: is it not dependable, or is it a scaling issue with many nodes?
[2014-02-25 23:57:32 -0500] redondos: I'm not familiar with this cookbook, let me take a look at it, brucelee_
[2014-02-25 23:57:35 -0500] coderanger: AntelopeSalad: For second, the callbacks system in it is super bad
[2014-02-25 23:57:45 -0500] pushnell: Hm.  See, when we started using chef, environments didn't exist so we created our own "environment" functionality.
[2014-02-25 23:57:54 -0500] coderanger: AntelopeSalad: No that part is all fine, its just too restrictive and I can do better on my own
[2014-02-25 23:57:58 -0500] pushnell: It sounds like the major beef is with roles <-> environments
[2014-02-25 23:58:18 -0500] AntelopeSalad: coderanger: ok so for a relatively small deploy with pretty basic needs it should be fine?
[2014-02-25 23:58:24 -0500] redondos: brucelee_: is snort available in your apt/yum repository?
[2014-02-25 23:58:26 -0500] coderanger: pushnell: At heart the issue is "how does stuff go from a developer to production"
[2014-02-25 23:58:27 -0500] redondos: ries*
[2014-02-25 23:58:35 -0500] AntelopeSalad: i got like 90% of the way there today, all working -- just need to hookup puma to runit
[2014-02-25 23:58:44 -0500] coderanger: pushnell: roles offer a lot of ways to break that flow and overall low visibility into whats running where
[2014-02-25 23:58:47 -0500] kallistec: coderanger: do you still have the gem configuration where it has to do a lot of backtracking to load stuff?
[2014-02-25 23:59:23 -0500] coderanger: kallistec: You mean the one I hit yesterday with nokogiri?
[2014-02-25 23:59:42 -0500] coderanger: AntelopeSalad: Yeah, its fine for little stuff and if you want cap-style deploys
[2014-02-25 23:59:50 -0500] kallistec: coderanger: no, from a few months back where knife took 10s or whatever to load because of rubygems backtracking on load
