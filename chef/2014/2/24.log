[2014-02-24 07:02:48 -0500] ianselby: new question... anyone run into issues with rabbitmq not starting?
[2014-02-24 07:03:51 -0500] coderanger: ianselby: Yes, pretty common if your FQDN isn't setup correctly before you install it
[2014-02-24 07:04:02 -0500] ianselby: it was
[2014-02-24 07:04:15 -0500] ianselby: it just decided to die on me because I hadn't talked to it in a while
[2014-02-24 07:04:33 -0500] coderanger: Check the rabbit logs for something like "unable to connect to ..."
[2014-02-24 07:04:39 -0500] ianselby: yup
[2014-02-24 07:04:59 -0500] ianselby: Reason: {error,mnesia_not_running}
[2014-02-24 07:05:23 -0500] ianselby: should I give a chef-server-ctl reconfigure a shot?
[2014-02-24 07:05:43 -0500] coderanger: More likely you need to rabbitmqctl something
[2014-02-24 07:05:47 -0500] coderanger: No idea what though, sorry
[2014-02-24 07:05:55 -0500] ianselby: well fuck me then
[2014-02-24 07:06:08 -0500] ianselby: thanks for trying tho :)
[2014-02-24 07:06:11 -0500] coderanger: Has anything about the hostname changed?
[2014-02-24 07:06:52 -0500] ianselby: don't think so
[2014-02-24 07:06:57 -0500] ianselby: but I wouldn't put it past this thing
[2014-02-24 07:07:00 -0500] ianselby: hired a new devops guy
[2014-02-24 07:07:08 -0500] ianselby: hey may have done something inadvertently
[2014-02-24 07:07:19 -0500] coderanger: basically rabbit encodes the hostname into its data files, not just configs and other sane things
[2014-02-24 07:07:35 -0500] coderanger: so if it either changes or isn't findable, it shits the bed
[2014-02-24 07:08:23 -0500] ianselby: that's what I'm gathering from logs / google / you
[2014-02-24 07:08:32 -0500] ianselby: can I just nuke the data files and reboot?
[2014-02-24 07:08:56 -0500] coderanger: Probably, unfortunately every time I have to do that my brain manages to purge what to from my memory afterwards
[2014-02-24 07:09:12 -0500] coderanger: Probably a self-defense mechanism for the stupid :)
[2014-02-24 07:10:17 -0500] coderanger: Or you can use the rabbit cli tool to reinitialize the channels
[2014-02-24 07:11:14 -0500] ianselby: that did it
[2014-02-24 07:11:36 -0500] ianselby: cd /var/opt/chef-server/rabbitmq/db && rm -rf *
[2014-02-24 07:11:39 -0500] ianselby: restart
[2014-02-24 07:11:41 -0500] ianselby: happy camper
[2014-02-24 07:11:45 -0500] ianselby: so far
[2014-02-24 07:11:54 -0500] coderanger: lolcomputers
[2014-02-24 07:12:01 -0500] ianselby: yep
[2014-02-24 07:12:14 -0500] ianselby: well, at least it was just rabbit and not something important
[2014-02-24 07:12:16 -0500] ianselby: heh
[2014-02-24 07:12:36 -0500] ianselby: I was about 5 minutes away from coughing up the cash for enterprise
[2014-02-24 07:14:25 -0500] ianselby: oh good, it's still broken
[2014-02-24 07:14:30 -0500] ianselby: 502 when uploading cookbooks
[2014-02-24 07:15:04 -0500] coderanger: Did you recreate the channels for chef?
[2014-02-24 07:15:32 -0500] coderanger: ianselby: https://wiki.opscode.com/display/chef/Chef+Indexer
[2014-02-24 07:15:37 -0500] coderanger: That has the commands for it
[2014-02-24 07:15:56 -0500] coderanger: because, again, storing that kind of stuff in config files is for wimps
[2014-02-24 07:16:13 -0500] coderanger: a reconfigure might do it for you too
[2014-02-24 07:16:42 -0500] ianselby: I'll give it a shot
[2014-02-24 07:16:44 -0500] ianselby: one sec...
[2014-02-24 07:17:43 -0500] ianselby: GAH, where do they have the binary for rabbitmqctl?
[2014-02-24 07:17:57 -0500] coderanger: Probably opt/chef/embedded/bin
[2014-02-24 07:18:34 -0500] ianselby: you'd think
[2014-02-24 07:18:57 -0500] ianselby: I shouldn't be allowed to use the internet
[2014-02-24 07:19:27 -0500] ianselby: ./rabbitmqctl: 23: exec: erl: not found
[2014-02-24 07:20:00 -0500] coderanger: You probably have to add that folder to your path
[2014-02-24 07:20:08 -0500] ianselby: probably
[2014-02-24 07:20:20 -0500] ianselby: these are things one usually thinks of when they've had sleep
[2014-02-24 07:28:15 -0500] ianselby: oh this thing is effed up
[2014-02-24 07:29:26 -0500] ianselby: erchef is puking all over itself
[2014-02-24 07:30:05 -0500] coderanger: Whats the error?
[2014-02-24 07:33:24 -0500] ianselby: coderanger: sent it to you directly
[2014-02-24 07:33:26 -0500] coderanger: ianselby: Did you recreate the chans via rabbitmqctl or chef-server-ctl reconfigure?
[2014-02-24 07:33:33 -0500] ianselby: both
[2014-02-24 07:33:39 -0500] coderanger: Heh, in which order?
[2014-02-24 07:34:41 -0500] ianselby: all permutations
[2014-02-24 07:34:42 -0500] ianselby: lol
[2014-02-24 07:35:06 -0500] coderanger: ianselby: Got it
[2014-02-24 07:35:15 -0500] coderanger: The default password has changed
[2014-02-24 07:35:16 -0500] coderanger: https://github.com/opscode/omnibus-chef-server/blob/master/files/chef-server-cookbooks/chef-server/attributes/default.rb#L47
[2014-02-24 07:35:26 -0500] ianselby: jerks
[2014-02-24 07:35:28 -0500] coderanger: reset the password to chefrocks
[2014-02-24 07:35:31 -0500] ianselby: ok, lemme try again
[2014-02-24 07:36:13 -0500] coderanger: ianselby: rabbitmqctl change_password chef chefrocks
[2014-02-24 07:36:56 -0500] ianselby: then restart?
[2014-02-24 07:37:03 -0500] coderanger: Don't think you need to restart
[2014-02-24 07:37:25 -0500] ianselby: it's so weird how they didn't update their docs
[2014-02-24 07:37:33 -0500] coderanger: the wiki isn't the docs anymore
[2014-02-24 07:37:40 -0500] coderanger: formally deprecated long ago
[2014-02-24 07:37:42 -0500] ianselby: I know, being smarmy
[2014-02-24 07:38:42 -0500] coderanger: any better now?
[2014-02-24 07:39:00 -0500] ianselby: wasn't, restarted for fun
[2014-02-24 08:01:31 -0500] enbergj-: is there any way to get knife to give a sane amount of information on warnings such as when it fails to connect to somewhere? I'm running knife ssh '*:*' with -V and it just sayis "Failed to connect to  -- Errno:ETIMEOUT: Operation timed out - connect(2)", but doesn't care to say which node that was .. at least for authentication failed it shows user@hostname that it tried to connect to
[2014-02-24 08:02:26 -0500] ianselby: does knife timeout on all operations?
[2014-02-24 08:02:33 -0500] ianselby: e.g. knife client list
[2014-02-24 08:02:58 -0500] enbergj-: no, it times out when trying to ssh to certain servers, which is expected in this case, but I want to see *which* servers they are
[2014-02-24 08:03:23 -0500] coderanger: enbergj-: Unlikely, I would use something other than knife ssh for anything Real :)
[2014-02-24 08:04:19 -0500] enbergj-: my "real" is trying to figure out which servers knife is having issues connecting to
[2014-02-24 08:04:20 -0500] coderanger: The interactive mode might give you more info
[2014-02-24 08:04:21 -0500] enbergj-: I *could* make a bash loop around knife node list and then try and knife ssh to each one specifically, but that sounds pretty stupid really
[2014-02-24 08:04:22 -0500] coderanger: or run `knife ssh '*:*' hostname`
[2014-02-24 08:04:22 -0500] coderanger: and see which don't print out :)
[2014-02-24 08:04:37 -0500] enbergj-: coderanger: that is pretty much exactly what I am doing, the point is, it fails to connect to X amount of servers and only says "timed out" and not to *which* server
[2014-02-24 08:05:19 -0500] coderanger: enbergj-: Right, see which hostnames you don't see
[2014-02-24 08:09:35 -0500] spheromak: enbergj-: knfie ssh -m
[2014-02-24 08:10:17 -0500] spheromak: vs shell loop, but yea the not printing what it can't connect to  is anoying
[2014-02-24 08:10:29 -0500] coderanger: fab ftw :)
[2014-02-24 08:11:08 -0500] spheromak: really want serf for this stuff, but yea
[2014-02-24 08:41:18 -0500] madnificent: when i try to bootstrap a node, i get an error indicating that /etc/chef/validation.pem is supposed to be a private key.  indeed, on the bootstrapped node, the file contains a public key.  has anyone encountered this before?  i'm trying to test-drive chef here, but the bootstrap process is failing.
[2014-02-24 08:42:38 -0500] flaccid: madnificent: it should be a rsa private key
[2014-02-24 08:42:54 -0500] flaccid: not sure how you got public key there, go through the bootstrap doc again i guess
[2014-02-24 08:45:09 -0500] madnificent: flaccid: the bootstrap command places the key there.  if i change it with a private key, it replaces it with the public key again.  it's a fairly standard setup using ubuntu 12.04 for both the server as the clients.
[2014-02-24 08:46:57 -0500] flaccid: madnificent: are you doing $ knife bootstrap 123.45.6.789 -x username -P password --sudo from the chef server?
[2014-02-24 08:46:59 -0500] madnificent: flaccid: also, when you say 'the bootstrap doc', can you point me to which resource you mean exactly?  perhaps i'm using a non-standard document
[2014-02-24 08:47:30 -0500] madnificent: flaccid: i'm running it from a client which has admin privileges.  should it always be ran from the server?
[2014-02-24 08:48:08 -0500] flaccid: madnificent: http://docs.opscode.com/install_bootstrap.html
[2014-02-24 08:48:16 -0500] flaccid: you can do it from a workstation if you have setup that workstation properly
[2014-02-24 08:48:37 -0500] flaccid: http://docs.opscode.com/install_workstation.html
[2014-02-24 08:50:35 -0500] madnificent: flaccid: i'll try it from the server.  babysteps :)
[2014-02-24 09:14:04 -0500] brucele_: in chef whats a %w() do? for instance: %w(centos redhat suse fedora)
[2014-02-24 09:16:03 -0500] brucele_: found it nm
[2014-02-24 09:17:17 -0500] madnificent: flaccid: how should i set up the server in order to do it from the server?
[2014-02-24 09:35:54 -0500] awakenrogue: Hi guys
[2014-02-24 09:36:05 -0500] awakenrogue: i am trying to set up chef server 11.11
[2014-02-24 09:36:10 -0500] awakenrogue: on centos machine
[2014-02-24 09:36:28 -0500] awakenrogue: i downloaded the rpm and installed
[2014-02-24 09:36:33 -0500] awakenrogue: that went successfullt
[2014-02-24 09:36:37 -0500] awakenrogue: successfully
[2014-02-24 09:37:17 -0500] awakenrogue: however when i configure the chef using  sudo chef-server-ctl reconfigure
[2014-02-24 09:37:33 -0500] awakenrogue: throws somting Error executing action `run` on resource 'execute[boostrap-chef-server]'
[2014-02-24 09:37:51 -0500] awakenrogue: i have the whole chunk of stack trace with me
[2014-02-24 09:39:22 -0500] ganaiwali: that might mean bootstaping he chef-server node first ( give it run-lists enviroenment etc )
[2014-02-24 09:42:32 -0500] awakenrogue: yeah
[2014-02-24 09:42:39 -0500] awakenrogue: something like this
[2014-02-24 09:42:40 -0500] awakenrogue: STDOUT: error creating client <<"chef-validator">>: {badrpc,                                              {'EXIT',                                               {undef,                                                [{chef_object,new_record,                                                  [chef_client,                                                   <<"00000000000000000000000000000000">>,                                         
[2014-02-24 09:51:30 -0500] Guest28512: Hi , does anyone has a success story with knife google plugin , is it stable ?
[2014-02-24 09:52:15 -0500] Guest28512: I have it set up , but it seems to disconnect from google cloud every few hours  , and then i have to reconnect it again using knife google setup
[2014-02-24 09:52:30 -0500] Guest28512: which makes it a real blocker to work with
[2014-02-24 09:53:06 -0500] Guest28512: also google seems to provide server with the same IP''S , not like AWS
[2014-02-24 09:53:34 -0500] slicknick: inactivity timeout they enforce?
[2014-02-24 09:53:43 -0500] Guest28512: and they are written in the ~/.ssh/known_hosts file
[2014-02-24 09:53:48 -0500] slicknick: no idea about the plugin nor what it does so dont trust me
[2014-02-24 09:54:11 -0500] Guest28512: i dont know what it is , but what i get after a few hours is : root@jenkins:/opt/chef-repo# knife google server delete www5 --purge -Z us-central1-a ERROR: Google::Compute::BadRequest: {  "error": {   "errors": [    {     "domain": "global",     "reason": "authError",     "message": "Invalid Credentials",     "locationType": "header",     "location": "Authorization"    }   ],   "code": 401,   "message": "Invalid Credentials"  } }
[2014-02-24 09:54:35 -0500] Guest28512: and it worked like 5 min ago
[2014-02-24 09:55:15 -0500] slicknick: go ask the plug author
[2014-02-24 09:56:44 -0500] Guest28512: yea will do
[2014-02-24 10:13:40 -0500] roman-pfeffer: anyone has connections to the knife google plugin author ?
[2014-02-24 10:13:50 -0500] roman-pfeffer: the github repository is not accepting issues
[2014-02-24 10:13:57 -0500] roman-pfeffer: https://github.com/opscode/knife-google
[2014-02-24 10:35:32 -0500] madnificent: flaccid: for the backlog (and your name is mentioned in it).  I must have missed something in the workstation configuration.  I configured a workstation from scratch, and it looks like the bootstrapping of a node is working as expected now.
[2014-02-24 10:35:36 -0500] madnificent: flaccid: and thanks
[2014-02-24 11:28:35 -0500] gokul: What happens when my cookbook depends on another recipe with data bag ?
[2014-02-24 11:33:45 -0500] gokul: * another cookbook with databag.
[2014-02-24 11:35:56 -0500] Siiseli: is there any way to tell a node to reprovision itself with knife?
[2014-02-24 11:36:06 -0500] Siiseli: when I, for example, update roles and cookbooks in this case
[2014-02-24 11:36:14 -0500] Siiseli: or do I just.. rebootstrap the machine?
[2014-02-24 11:38:49 -0500] roman-pfeffer: data bags are local , there is no connection to cookbooks and databags
[2014-02-24 11:45:42 -0500] ocholetras: i have found this on a provider Class:   Provider.klass(@type).new(self)
[2014-02-24 11:45:49 -0500] ocholetras: that klass method do?
[2014-02-24 12:12:22 -0500] roman-pfeffer: knife ec2 server create .... gets me an ERROR: Fog::Compute::AWS::Error: UnauthorizedOperation => You are not authorized to perform this operation.
[2014-02-24 12:12:41 -0500] roman-pfeffer: any idea how to fix that ? knife ec2 server list works fine
[2014-02-24 13:44:26 -0500] calucifer: hi all, I have a question on encrypted data bags .... anyone any knowledge?
[2014-02-24 13:51:55 -0500] calucifer: anyone? data bag encryption key knowledge?
[2014-02-24 14:03:17 -0500] micgo: calucifer: what's your question?
[2014-02-24 14:06:55 -0500] calucifer: sorry, was elsewhere. I've setup an encrypted databag containing ssh keys. the docs I'm reading say that if I put my secret key on the server, it will be pulled down as part of a bootstrap, but where should I put it on the server?
[2014-02-24 14:08:31 -0500] AntelopeSalad: calucifer: i put mine in /etc/chef
[2014-02-24 14:10:06 -0500] calucifer: will try that, thanks
[2014-02-24 14:10:48 -0500] micgo: calucifer: Where did you read that it will be pulled down from the chef server upon bootstrap?
[2014-02-24 14:10:59 -0500] AntelopeSalad: calucifer: you can knife bootstrap your server with --secret-file /local/path/to/file and it puts it on the server too by default
[2014-02-24 14:12:26 -0500] calucifer: in the book "Chef Infrastructure Automation Cookbook"
[2014-02-24 14:16:19 -0500] micgo: hmmm.. I have that book and I'm not seeing that. I'm pretty confident that you need to provide the key yourself. The Chef server doesn't keep the key
[2014-02-24 14:16:59 -0500] micgo: but if you do what AntelopeSalad says, you should be fine. Just remember that chef looks for a file called '/etc/chef/encrypted_data_bag_secret' by default when the chef-client runs
[2014-02-24 14:17:30 -0500] micgo: you can also set 'knife[:secret-file]' in your knife.rb and it will use that instead of having to remember the command line flag
[2014-02-24 14:19:18 -0500] AntelopeSalad: i should probably start doing that, typing out the secret-file flag is annoying
[2014-02-24 14:20:56 -0500] micgo: sorry.. it's 'knife[:secret_file]' no hypen
[2014-02-24 14:22:39 -0500] calucifer: @micgo its at the end of the using  encrypted databag items section, and I know about putting that line into my knife.rb, it's something i need to do, I keep forgetting where key files are annd what they're called :-)
[2014-02-24 14:24:30 -0500] AntelopeSalad: i wish the knife cli let you set the remote location for that file, it would make using custom secret file names much easier
[2014-02-24 14:25:26 -0500] calucifer: putting that file into /etc/chef on the server didn't bring it down as part of the bootstrap :-( I'll have to go manual scp and I hate manual
[2014-02-24 14:26:32 -0500] AntelopeSalad: the file ends up in /etc/chef after you bootstrap it with --secret-file
[2014-02-24 14:26:55 -0500] AntelopeSalad: if you want to add the secret file after you've already bootstrapped the server i think you're stuck having to scp it
[2014-02-24 14:33:26 -0500] micgo: calucifer: I think you might be misreading that section. This is what it says from the book - "To enable your node to decrypt the data bag item, you need to scp your secret key file to your node and put it in the /etc/chef/ directory."
[2014-02-24 14:33:52 -0500] micgo: or use the secret-file options
[2014-02-24 14:36:59 -0500] AntelopeSalad: question: for the deploy resource, is it reasonable to use a local git path on the server which assumes you've already pushed some code to it before the chef run occurs?
[2014-02-24 14:37:22 -0500] AntelopeSalad: this is in regards to the "repo" method in the deploy resource
[2014-02-24 14:39:32 -0500] AntelopeSalad: also is that an anti-pattern because then wouldn't you have to keep your workstation up to date with all of the app servers that you need to push to?
[2014-02-24 14:42:36 -0500] calucifer: micgo, I think I've a newer (or older) copy of that book (reading on safaribooks), because the next line down is a tip box and it says "The initial bootstrap procedure for a node will put the key in the right place on the node, if one already exists in your Chef repository."
[2014-02-24 14:48:48 -0500] micgo: calucifer: Ah, yes however the chef-repo is on your local workstation (or whatever system is doing the bootstrapping). Just wanted to clarify that you can't bootstrap without have the key locally (ie. it won't come from the chef server if the workstation doesn't have it available for SCP/secret-file access)
[2014-02-24 15:05:37 -0500] erthad: hiall
[2014-02-24 15:05:38 -0500] calucifer: thanks to all, passing as an option to the bootstrap process works (which is fine for me because the actual servers I'll be using haven't been provisioned yet - I'll be bootstraping when the time comes)
[2014-02-24 15:06:02 -0500] erthad: does chef-client write log anywhere by default when I run it by cron?
[2014-02-24 15:06:30 -0500] erthad: I see, it is configured in /etc/chef/client.rb
[2014-02-24 15:42:57 -0500] mljsimone: what is the diff. between Vagrant.configure("2") do |config|  and Vagrant::Config.run do |config|
[2014-02-24 15:43:55 -0500] clayb: http://docs.vagrantup.com/v2/vagrantfile/version.html (There is a #vagrant too for vagrant specific questions)
[2014-02-24 15:45:27 -0500] mljsimone: oh you are right. that is more related to vagrant
[2014-02-24 15:46:12 -0500] AntelopeSalad: is there a way to capture stdout from something that chef runs from within a recipe?
[2014-02-24 15:46:40 -0500] AntelopeSalad: example: chef runs some command, the command outputs "hello" , is it possible within a recipe to get "hello" in a variable?
[2014-02-24 15:46:52 -0500] clayb: AntelopeSalad, one can use a ruby block to execute and capture standard output into a variable
[2014-02-24 15:47:16 -0500] AntelopeSalad: clayb: oh, so the 'execute' command has that built in as an option?
[2014-02-24 15:48:16 -0500] clayb: No, you'd have to do a ruby block instead of an execute.
[2014-02-24 15:48:36 -0500] AntelopeSalad: what do you mean?
[2014-02-24 15:54:00 -0500] clayb: AntelopeSalad an example is https://github.com/bloomberg/chef-bcpc/blob/master/cookbooks/bcpc/recipes/certs.rb#L38
[2014-02-24 15:54:27 -0500] clayb: (Notice that the %x[] Ruby syntax gives up a lot of the nice features of a Chef bash action
[2014-02-24 15:55:08 -0500] AntelopeSalad: oh, so i need to use raw ruby instead of "execute"?
[2014-02-24 15:55:54 -0500] clayb: That's to my knowledge the only way. Or you can use execute and store to a temporary file and read it back in with raw ruby (but that too is round-about)
[2014-02-24 15:56:09 -0500] AntelopeSalad: raw ruby sounds a lot easier than messing with temp files, thanks
[2014-02-24 15:56:19 -0500] clayb: No doubt; good luck
[2014-02-24 15:56:30 -0500] AntelopeSalad: i'm kind of surprised execute doesn't have a way to capture stdout tho
[2014-02-24 15:58:15 -0500] kbarry: I'm very interested in writing an LWRP, Wondering if there are some resources available for how to get started,
[2014-02-24 15:58:50 -0500] kbarry: I read doug ireton (from nordstroms) 3 part blog about LWRPs, and was wondering if there weren't a reference manual, or a "Chef Bible" as it were?
[2014-02-24 16:16:11 -0500] calucifer: hello all, I'm back :-) Does anyone know how to add an item to an encrypted data bag?
[2014-02-24 16:21:54 -0500] FireBeyond: So I'm taking over a Chef Server from a previous admin. Think I'm 90% there. I made a change to a template in a cookbook. From there, I need to push to the server... just type knife upload? or more to it than that
[2014-02-24 16:22:26 -0500] mortuar: knife cookbook upload <cookbookname>
[2014-02-24 16:22:40 -0500] micgo: kbarry: Have you checked out the official docs yet? http://docs.opscode.com/chef/lwrps_custom.html
[2014-02-24 16:22:54 -0500] mortuar: depending on your versioning, you probably want to also bump your version in metadata.rb as well FireBeyond
[2014-02-24 16:23:14 -0500] kbarry: micgo: Yes, and its slowly seeping in,
[2014-02-24 16:23:21 -0500] FireBeyond: Yeah, this is what I'm trying to figure, kinda jumping in blindly (but cautiously, hence why I'm here)
[2014-02-24 16:23:24 -0500] kbarry: thought there might be other resources,
[2014-02-24 16:23:40 -0500] micgo: calucifer: You can just re-upload the data bag item with the added content using the secret-key
[2014-02-24 16:24:55 -0500] mljsimone: what is a good way to handle the cookbooks? add them to the project, using the archive url or using git submodules?
[2014-02-24 16:24:59 -0500] mjuszcza1: Is there a way I can just apply a cookbook to a host?  No roles, etc.  Just apply it.
[2014-02-24 16:25:03 -0500] calucifer: micgo, I was afaid of that, they're ssh keys I'd deleted the json once the upload was done
[2014-02-24 16:25:44 -0500] calucifer: @mjuszcza1 chef-client -o <cookbook namer>
[2014-02-24 16:26:29 -0500] micgo: calucifer: yeah, there isn't really an append functionality from the command line. You could do something in a code by pulling down, decrypting the hash, appending, then reuploading with the secret file. no out of the box way though that I'm aware of
[2014-02-24 16:26:47 -0500] mjuszcza1: calucifer: That's looking for /etc/chef, /etc/chef/validation.pem, etc.
[2014-02-24 16:27:11 -0500] mjuszcza1: Which don't exist.  I simply installed chef-client and chef-solo and want to apply the cookbook locally.  Do I stlil need to generate keys and such?
[2014-02-24 16:27:58 -0500] micgo: mjuszcza1: you can use chef-solo or local-mode depending on what version you are running without generating keys
[2014-02-24 16:28:26 -0500] micgo: you could also use chef-apply: http://docs.opscode.com/ctl_chef_apply.html
[2014-02-24 16:30:42 -0500] mjuszcza1: Thanks!
[2014-02-24 16:30:59 -0500] micgo: mjuszcza1: with chef-solo it would be something like 'chef-solo -c ~/solo.rb -j ~/node.json' -> http://docs.opscode.com/chef_solo.html
[2014-02-24 16:32:06 -0500] micgo: you would tell chef where to find cookbooks in the solo.rb you could also add the run_list flag to specific a run list (or add it to the node.json file along with any node attributes you need to set in advance)
[2014-02-24 16:34:25 -0500] mjuszcza1: My second questoin: for staging environments within Chef, do you all recommend using environments inside chef server, or separating things out entirely and having a completely separate chef staging server?  I'm just learning, so I feel like physical separation of our staging environment might help reduce errors, but I'm wondering if I'll regret that a month from now when I know chef better :)
[2014-02-24 16:43:10 -0500] mjuszcza1: grr: http://pastebin.com/BfyC99Xz
[2014-02-24 16:43:11 -0500] mconigliaro: @mjuszcza1 we have the same question lately
[2014-02-24 16:43:27 -0500] mconigliaro: i think we're going to move to separate chef servers for staging/production
[2014-02-24 16:43:34 -0500] mconigliaro: we're using chef environments now
[2014-02-24 16:43:54 -0500] shlant: anyone have an example of searching for a node by hostname and passing that nodes fqdn into a template ? :)
[2014-02-24 16:43:56 -0500] yatesy: mjuszcza1: i started out with seperate installations (well separate orgs in hosted chef) to separate, but when i got comfortable with chef i moved into a single org with multi environments
[2014-02-24 16:44:33 -0500] mconigliaro: the problem with chef environments is that it's not easy to role cookbook changes through staging into prod
[2014-02-24 16:44:42 -0500] mconigliaro: err, role = roll
[2014-02-24 16:45:37 -0500] yatesy: it can be, check out knife spork
[2014-02-24 16:45:48 -0500] yatesy: excellent plugin written by the etsy folks
[2014-02-24 16:45:51 -0500] mjuszcza1: mconigliaro: Oh, so you're saying that even if we use the same server, it's not easy to roll them from one env to the other?
[2014-02-24 16:46:07 -0500] mconigliaro: yatesy: how does that help?
[2014-02-24 16:47:58 -0500] mconigliaro: it's just that dependency management is a pain in the ass in general
[2014-02-24 16:47:59 -0500] mconigliaro: i don't think it's chef's fault really
[2014-02-24 16:47:59 -0500] mconigliaro: so consider this
[2014-02-24 16:48:24 -0500] yatesy: it provides a workflow on top of chef functionality in this area which is using cookbook pinning in environments
[2014-02-24 16:48:24 -0500] mconigliaro: all your cookbooks have versioned dependencies, right?
[2014-02-24 16:48:24 -0500] mconigliaro: well, it depends on how you pin things
[2014-02-24 16:49:52 -0500] mconigliaro: you're probably doing something like this in the cookbooks: depends 'foo', '~> x.y'
[2014-02-24 16:49:53 -0500] mconigliaro: if you're more specific than that, then you get a lot of conflicts
[2014-02-24 16:49:53 -0500] mconigliaro: this is really hard to explain in chat...
[2014-02-24 16:55:17 -0500] yatesy: ie you pin a certain version of a cookbook in an environment, meanwhile you develop new versions in a different environment. When ready to go to prod, you "promote" the new version into the production environment
[2014-02-24 16:56:21 -0500] yatesy: if you're talking external to cookbook versions and instead things like versions of packages (such as nginx for example) then I make use of attributes to achieve that
[2014-02-24 16:56:25 -0500] yatesy: so each environment will specify a different value for a given attribute, then adjust that way
[2014-02-24 16:56:33 -0500] yatesy: but i agree dependency management can be a PITA :)
[2014-02-24 17:14:08 -0500] awakenrogue: Hi
[2014-02-24 17:14:31 -0500] awakenrogue: i am facing one problem during chef server installtion
[2014-02-24 17:14:44 -0500] awakenrogue: i installed and configured chef server .
[2014-02-24 17:14:55 -0500] awakenrogue: it seemed to be success
[2014-02-24 17:15:26 -0500] awakenrogue: but when i do chef-server-ctl test
[2014-02-24 17:16:02 -0500] awakenrogue: it throws me exception saying Creating client pedant_admin_client... > Exception during Pedant credentials setup > #<Errno::ECONNREFUSED: Connection refused - connect(2)>
[2014-02-24 17:16:21 -0500] awakenrogue: any one faced this issue?
[2014-02-24 17:24:33 -0500] jagatveer: Hi everyone
[2014-02-24 17:24:54 -0500] jagatveer: need some help
[2014-02-24 17:25:51 -0500] jagatveer: http://serverfault.com/questions/577755/force-execution-of-a-chef-script-before-the-first-one-finishes
[2014-02-24 17:25:58 -0500] jagatveer: This is my question.
[2014-02-24 17:26:19 -0500] jagatveer: Can someone have a look and let me know what can be done in this case?
[2014-02-24 17:28:10 -0500] jagatveer: It shows the section of Chef code that is creating the problem for me. Everything works fine but then in order to upgrade percona, I need to run the 'mysql_upgrade' step while the 'mysql_safe' step is still working.
[2014-02-24 17:28:50 -0500] jagatveer: Unfortunately chef never finishes that execution because the 'mysql_safe' step keeps waiting for argument and second step is never reached. (Note: using && did not help either).
[2014-02-24 17:36:12 -0500] Guest63879: what argument is mysql_safe waiting for?
[2014-02-24 17:38:59 -0500] jagatveer: mysql_safe is for accepting the upgrade request.
[2014-02-24 17:39:19 -0500] jagatveer: I am actually upgrading from Percona 5.5 to 5.6 via chef.
[2014-02-24 17:40:03 -0500] jagatveer: Now the issue is, mysql_safe command never completes as it is expecting the input (mysql_upgrade) mentioned in the next line.
[2014-02-24 17:40:23 -0500] jagatveer: And as the first command does not complete, Chef does not proceed to the next one.
[2014-02-24 17:40:56 -0500] jagatveer: When you give it a dry run.. following is how the upgrade is done at this point:
[2014-02-24 17:41:19 -0500] jagatveer: Run the mysql_safe, as I mentioned there on the link, it will wait for the next input from you.
[2014-02-24 17:41:46 -0500] jagatveer: The input there has to be the mysql_upgrade option, while mysql_safe is still running
[2014-02-24 17:44:20 -0500] Guest63879: sorry, chef rookie, but can't you do something like echo "whatever mysql_safe wants" | mysql_safe -args?
[2014-02-24 18:44:18 -0500] tscanausa: is there a way to override / persist detect attributes?
[2014-02-24 18:53:57 -0500] geggam: TypeError
[2014-02-24 18:53:58 -0500] geggam: can't convert Symbol into Integer
[2014-02-24 18:54:05 -0500] geggam: what makes that happen ?
[2014-02-24 18:54:32 -0500] geggam: 193>>     :docbase =>  node[:application_install][:nginx_docbase],
[2014-02-24 18:54:59 -0500] coderanger: geggam: It means one of those is an array
[2014-02-24 18:55:13 -0500] coderanger: and ['a', 'b'][:symbol] isn't allowed
[2014-02-24 18:55:43 -0500] geggam: default["application_install"]["nginx_docbase"] ="/usr/share/nginx/webui"
[2014-02-24 18:55:54 -0500] geggam: so what am i wrong  with there ?
[2014-02-24 18:56:13 -0500] coderanger: Nothing, check that your recipe code isn't overwriting node with a variable
[2014-02-24 18:56:18 -0500] coderanger: or overriding attrs
[2014-02-24 18:56:53 -0500] geggam: so if i set an override with application_install something that will make it break ?
[2014-02-24 18:57:03 -0500] coderanger: If you set it wrong, sure
[2014-02-24 19:00:16 -0500] AntelopeSalad: hey coderanger: i sniped your bundle install code from application_ruby and i noticed something strange
[2014-02-24 19:00:42 -0500] AntelopeSalad: if i do a chef run on a brand new server bundle install fails compiling the pg gem
[2014-02-24 19:01:07 -0500] AntelopeSalad: but if i login manually and copy/paste the exact command directly on the server it works -- have you experienced anything like?
[2014-02-24 19:03:32 -0500] cwj: AntelopeSalad: is it possible you are using chef_gem to install pg (which tries to build the gem during compile phase), and not installing build-essential during compile phase?
[2014-02-24 19:03:59 -0500] cwj: i think pg is one of the popular gems which tries to compile native extensions
[2014-02-24 19:04:20 -0500] AntelopeSalad: cwj: i simply ran bundle install from within the app directory using standard flags like --deployment and --without
[2014-02-24 19:04:47 -0500] AntelopeSalad: it grabbed what to install from within the Gemfile contained in the app directory
[2014-02-24 19:05:46 -0500] jagatveer: Hi guys, need some help on this:
[2014-02-24 19:05:47 -0500] jagatveer: http://stackoverflow.com/questions/21977687/force-execution-of-a-second-chef-script-before-the-first-one-finishes
[2014-02-24 19:05:52 -0500] cwj: ok, sure, id still check that your build-essentials are getting installed before bundler runs
[2014-02-24 19:06:14 -0500] jagatveer: I tried mysql_upgrade -u root -p$(cat ~/.mysql) | mysqld_safe --skip-grant-tables --user=mysql &
[2014-02-24 19:06:20 -0500] jagatveer: but did not help either.
[2014-02-24 19:06:57 -0500] AntelopeSalad: cwj: build-essentials? i don't think i've called that manually
[2014-02-24 19:07:41 -0500] cwj: AntelopeSalad: https://github.com/opscode-cookbooks/build-essential
[2014-02-24 19:07:50 -0500] cwj: https://github.com/opscode-cookbooks/build-essential/blob/master/attributes/default.rb#L20
[2014-02-24 19:07:52 -0500] AntelopeSalad: here's the command in question https://gist.github.com/AntelopeSalad/9194759
[2014-02-24 19:07:55 -0500] coderanger: jagatveer: Please get percona to provide you with the correct script
[2014-02-24 19:08:20 -0500] coderanger: jagatveer: Or don't upgrade like that
[2014-02-24 19:08:20 -0500] cwj: AntelopeSalad: anyway this is all just guessing until we see a stacktrace from the bundler failure
[2014-02-24 19:08:33 -0500] coderanger: jagatveer: Better option would be to start mysqld as a normal service and then upgrade it
[2014-02-24 19:08:51 -0500] AntelopeSalad: cwj: yeah, it will take about 30min to do another fresh run to test, unfortunately the error is long gone in my buffer
[2014-02-24 19:09:06 -0500] AntelopeSalad: but basically it tried to install the extensions for pg and failed but only during the chef run
[2014-02-24 19:09:18 -0500] coderanger: jagatveer: --skip-grant-tables is actively dangerous and should only be used in "we lost the password" situations generally
[2014-02-24 19:09:22 -0500] jagatveer: Hi coderanger. I am able to run the upgrade manually, I am facing the issue with chef only.
[2014-02-24 19:09:44 -0500] coderanger: jagatveer: I get the feeling you are unfamiliar with that those commands actually do?
[2014-02-24 19:10:01 -0500] geggam: thanks coderanger ... ihad jacked up json :)
[2014-02-24 19:11:15 -0500] coderanger: geggam: GIGO :)
[2014-02-24 19:11:37 -0500] jagatveer: coderanger: I am familiar with the stuff. For Percona 5.6 the schema for grant tables have been changed. This is why it must be done this way
[2014-02-24 19:11:51 -0500] jagatveer: reference is at :
[2014-02-24 19:11:51 -0500] jagatveer: http://www.percona.com/doc/percona-server/5.6/upgrading_guide_55_56.html
[2014-02-24 19:12:01 -0500] coderanger: jagatveer: Oy, thats going to suck, is this a one time thing? If so, just don't do it in chef
[2014-02-24 19:12:37 -0500] jagatveer: I wish. But we have many server nodes so need it on chef... Manual upgrades worked like charm for me
[2014-02-24 19:12:53 -0500] geggam: databases are finicky things and should be treated with manual  loving care
[2014-02-24 19:12:55 -0500] coderanger: jagatveer: So write a little cap or fab script to do the upgrade once and then never care again?
[2014-02-24 19:13:24 -0500] coderanger: This isn't a converge-oriented process, so it isn't something that will be clean to do in chef
[2014-02-24 19:13:41 -0500] geggam: automating huge database changes is really fun to spectate... you see the look of horror slowly dawn on peoples face as things casade into one big crash :)
[2014-02-24 19:13:54 -0500] jagatveer: coderanger: You got it right. Just need it to work once for us.
[2014-02-24 19:14:00 -0500] geggam: then offer recovery services at a huge upcharge
[2014-02-24 19:14:10 -0500] jagatveer: Because the next cluster upgrade might not even use Percona
[2014-02-24 19:14:15 -0500] coderanger: jagatveer: So yeah, get out your favorite scripted SSH client and write a thing
[2014-02-24 19:14:36 -0500] jagatveer: Recovery I can handle ;) Lol
[2014-02-24 19:15:28 -0500] jagatveer: coderanger: yep, I was trying the same thing, by calling bash from chef:
[2014-02-24 19:15:44 -0500] jagatveer: so following should have worked:
[2014-02-24 19:15:58 -0500] jagatveer: mysql_upgrade -u root -p$(cat ~/.mysql) | mysqld_safe --skip-grant-tables --user=mysql &
[2014-02-24 19:16:28 -0500] jagatveer: but noooope, it ain't gonna do it :/
[2014-02-24 19:17:21 -0500] AntelopeSalad: cwj: while this machine is setting itself up i read through the readme for build-essential, i don't think this is the case
[2014-02-24 19:17:43 -0500] AntelopeSalad: because it works completely fine when i logged into the server manually and ran the exact command chef ran
[2014-02-24 19:18:12 -0500] cwj: i could be wrong, its happened before :)
[2014-02-24 19:18:14 -0500] AntelopeSalad: if i were missing the tools required to compile something it would have failed to compile right?
[2014-02-24 19:18:18 -0500] cwj: just guessing since theres no stactrace
[2014-02-24 19:18:50 -0500] cwj: if you were missing the compile tools at the time the gem was being compiled, and the gem required native extentions, you would have a problem
[2014-02-24 19:19:10 -0500] jagatveer: @coderanger: any thoughts?
[2014-02-24 19:20:13 -0500] AntelopeSalad: cwj: i'll send the trace as soon as this thing finishes
[2014-02-24 19:20:21 -0500] cwj: kewl
[2014-02-24 19:20:48 -0500] AntelopeSalad: btw, do you have an opinion on using release-specific bundle install paths?
[2014-02-24 19:21:03 -0500] AntelopeSalad: running bundle install alone takes like 5-6 full minutes, seems like a lot of work when 99% of the time it doesn't change
[2014-02-24 19:21:34 -0500] cwj: i dont have a lot of experience running rails/ruby web apps so i dont have a strong opinion about it
[2014-02-24 19:22:08 -0500] AntelopeSalad: oh, the alternative is to bundle install on the system (or some other) path, so every time you run bundle install it looks there first
[2014-02-24 19:22:25 -0500] AntelopeSalad: but i guess the downside is you could end up accumulating cruft if you decide to remove gems in a later release
[2014-02-24 19:23:25 -0500] cwj: sure
[2014-02-24 19:23:44 -0500] cwj: that variety of cruft seems easy to live with
[2014-02-24 19:24:14 -0500] AntelopeSalad: yeah, i'm willing to trade a few megs of potential cruft for removing 5-6 min from every deploy
[2014-02-24 19:34:11 -0500] AntelopeSalad: cwj: moment of truth coming up, it's running the bundle install
[2014-02-24 19:39:56 -0500] AntelopeSalad: cwj: here's the full trace https://gist.github.com/AntelopeSalad/684a939d491afb1c5405
[2014-02-24 19:40:39 -0500] cwj: AntelopeSalad: ubuntu?
[2014-02-24 19:40:57 -0500] AntelopeSalad: also this recipe is running after i install postgres, the rails app (what's erroring out atm) is the last recipe on my list
[2014-02-24 19:41:33 -0500] AntelopeSalad: yes 12.04 lts -- also i have the libpg-dev packages installed (provided by the postgres cookbook i'm using)
[2014-02-24 19:41:59 -0500] cwj: you are probably missing ruby*-dev, and may still be missing other build-essential tools (at that point in the chef run)
[2014-02-24 19:42:24 -0500] AntelopeSalad: at this point in the run everything that includes deps are already installed
[2014-02-24 19:42:36 -0500] mjuszcza1: Anyone here have any thoughts on naming schemes?
[2014-02-24 19:44:22 -0500] jagatveer: what do you need to know on that?
[2014-02-24 19:47:17 -0500] mjuszcza1: Does: yellow.mysql.hydra.dfw1.rs.dev.blah.net scare you for a naming scheme?
[2014-02-24 19:47:59 -0500] gleam: yes
[2014-02-24 19:48:21 -0500] jagatveer: Yes it does :/
[2014-02-24 19:49:25 -0500] AntelopeSalad: cwj: is it possible bundle install is running from a different ruby context somehow?
[2014-02-24 19:53:57 -0500] coderanger: jagatveer: No, that wouldn't work, piping from one to the other makes no sense and that would result in the server starting second
[2014-02-24 19:54:44 -0500] mjuszcza1: jagatveer, gleam: Why does it scare you?
[2014-02-24 19:55:03 -0500] mjuszcza1: jagatvee_: gleam: These are cloud servers, so the first part is a random GUID, then role, app, data center, provider, environment, TLD
[2014-02-24 19:55:25 -0500] nicgrayson: is there any reason chef would run an old version of a cookbook when there is no pin for that cookbook?
[2014-02-24 19:56:08 -0500] jagatvee_: Do you have the old cookbook versions uploaded on your chef server?
[2014-02-24 19:56:16 -0500] nicgrayson: yes
[2014-02-24 19:56:33 -0500] nicgrayson: it should always use the newest though, right?
[2014-02-24 19:57:03 -0500] fknight: How can I update the recipes of an existing node? I updated the role for a node but the recipes don't seem to be updating alongside it.
[2014-02-24 19:57:42 -0500] nicgrayson: fknight: do you want to update the run-list?
[2014-02-24 19:57:54 -0500] fknight: nicgrayson, exactly!
[2014-02-24 19:58:17 -0500] nicgrayson: fknight: so you updated the run-list in the role?
[2014-02-24 19:59:11 -0500] nicgrayson: jagatvee_: the client should always use the newest though right?
[2014-02-24 20:00:43 -0500] jagatvee_: It is a good practice to remove any old recipe from the server.. I mean I had this issue once using their hosted trial.
[2014-02-24 20:01:16 -0500] fknight: nicgrayson: Yea, I've updated that, but when I run "knife node show <node-name>" the recipe list is old
[2014-02-24 20:01:16 -0500] jagatvee_: I removed the old one from the server and that did the trick for me.
[2014-02-24 20:01:53 -0500] nicgrayson: fknight: did you run chef-client on the node?
[2014-02-24 20:02:14 -0500] btm: Chef Code Review: Join bit.ly/1k5OaQU watch: bit.ly/1k5OdvT
[2014-02-24 20:02:21 -0500] fknight: nicgrayson: Yea, I'm actually running that command and my run list is empty: resolving cookbooks for run list: []
[2014-02-24 20:02:36 -0500] fknight: nicgrayson: Not sure why
[2014-02-24 20:05:43 -0500] fknight: If anyone wants to gain some server fault points: http://serverfault.com/questions/577987/how-can-i-update-the-recipes-of-a-chef-node
[2014-02-24 20:13:42 -0500] nicholasserra: Can anyone tell me if Berkshelf v3 requires you to roll out your own api server? Thanks!
[2014-02-24 20:16:39 -0500] AntelopeSalad: is there a way to get chef's deploy's migrate_command to call a method instead of accept a string?
[2014-02-24 20:18:58 -0500] garnertb: Does anyone know if it is possible to provision to Travis-CI using Chef?
[2014-02-24 20:19:31 -0500] mjuszczak: Anyone here use knife-spork?
[2014-02-24 20:19:36 -0500] mattupstate: mjuszczak: absolutely
[2014-02-24 20:19:40 -0500] mattupstate: highly recommend it
[2014-02-24 20:20:29 -0500] mjuszczak: mattupstate: The theory that you test by "swapping nodes" out of production scares me.  Also, we were thinking of using two separate chef servers: one for prod, and one for dev/staging, but it looks like with knife sporkk you use the same chef server
[2014-02-24 20:20:30 -0500] mattsurabian: anyone using chef with opsworks?
[2014-02-24 20:22:14 -0500] mattupstate: mjuszczak: i'm not sure where that theory comes from, honestly
[2014-02-24 20:22:21 -0500] mattupstate: spork fit my workflow
[2014-02-24 20:22:32 -0500] mattupstate: so i like it
[2014-02-24 20:22:52 -0500] mjuszczak: mattupstate: Do you use a single chef server for both production and dev?
[2014-02-24 20:23:08 -0500] mattupstate: at the moment, yes
[2014-02-24 20:23:24 -0500] mjuszczak: mattupstate: Would knife-spork still work for you even if you didn't?
[2014-02-24 20:23:51 -0500] mattupstate: mjuszczak: no idea
[2014-02-24 20:23:57 -0500] mattupstate: haven't tried
[2014-02-24 20:24:04 -0500] mjuszczak: mattupstate: This is what they recommend when testing --> https://github.com/jonlives/knife-flip ... that's what I meant by swapping nodes in/out of environments
[2014-02-24 20:24:24 -0500] mattupstate: who is "they"? and why are they important?
[2014-02-24 20:25:20 -0500] mjuszczak: mattupstate: etsy
[2014-02-24 20:25:56 -0500] mjuszczak: mattupstate: Sorry, just starting with chef and trying to find a workflow that works for multiple developers.  Some seem to recommend chef-zero for local testing, others recommend multiple production chef servers, others recommend a single chef server with environments.
[2014-02-24 20:25:59 -0500] geggam: just because its a name you have heard doesnt mean they are doing anything right
[2014-02-24 20:26:15 -0500] mattupstate: mjuszczak: ahh, gotcha
[2014-02-24 20:26:28 -0500] mattupstate: mjuszczak: how many developers are you talking about?
[2014-02-24 20:27:06 -0500] mattupstate: actually, now that i think about it, spork is still very useful regardless of your chef-server situation
[2014-02-24 20:27:35 -0500] mattupstate: at least for me, its really just enables a decent versioning workflow
[2014-02-24 20:28:58 -0500] mattupstate: you'll be dealing with versioning in any case
[2014-02-24 20:30:01 -0500] mjuszczak: mattupstate: OK :) Gotcha.  Thank you!
[2014-02-24 20:30:07 -0500] monsterzz: mjuszczak: we found that using single chef server with environments not so good idea, as we found it earlier. we're using OSC and there is no any role based access control, so anyone who has a key could make anything. Now we're implementing workflow with two chef servers  one for devs (little bit anarchy), and one for staging/prod (no direct uploads from workstations, only CI path).
[2014-02-24 20:33:19 -0500] mjuszczak: monsterzz: How do you enforce the staging/prod CI path?
[2014-02-24 20:33:32 -0500] monsterzz: mjuszczak: but it matters if you want devs to be little chefs. In case when only op-team works with chef  single chef server with environments and knife-spork is a good choice, but you need to be very careful when uploading cookbooks :) Also roles and data bags is not versioned at all and possibly could break your production
[2014-02-24 20:33:58 -0500] mjuszczak: monsterzz: You can't version databags and roles even between environments?  Only cookbooks?
[2014-02-24 20:37:07 -0500] monsterzz: mjuszczak: we're using teamcity and a lot of ruby scripts to run tests against repository (lint, cookbook unit tests, cookbook integration tests, repository consistency) and then using chef internals upload all the things to chef server (to staging environments from develop branch and to production from master). So to run in acceptance testing we just need to merge feature branch to develop and wait a bit. Of course we're locking all the cookbooks
[2014-02-24 20:37:07 -0500] monsterzz:  versions in production environments. But you can't lock roles and/or databags, because they don't have versions :(
[2014-02-24 20:37:44 -0500] mjuszczak: monsterzz: Gotcha.  So for true, 100% separation testing, better to have a dev chef server.  Do you use chef-zero?
[2014-02-24 20:41:44 -0500] monsterzz: mjuszczak: dev chef server is very useful for devs who want to try chef, improve their app recipes and so on. they have full control on cookbooks, roles and databags. Also it could be used to debug recipes by ops-team.
[2014-02-24 20:41:45 -0500] monsterzz: mjuszczak: we're using chef-zero to run consistency checks on the repo (uploading all contents of repo to zero and then running spec tests)
[2014-02-24 20:42:35 -0500] monsterzz: mjuszczak: also it's useful for test-kitchen, but we still using chef-solo for that
[2014-02-24 20:46:19 -0500] mjuszczak: monsterzz: OK :) thanks!  So new to chef, you'd recommend a full dev environment completely separate from production, and then workflows to do dev -> staging/prod
[2014-02-24 20:48:26 -0500] aneel: hi
[2014-02-24 20:49:02 -0500] aneel: is there a good way to use chef to be sure that a config file contains a stanza
[2014-02-24 20:49:18 -0500] aneel: eg, i want sshd_config to contain:
[2014-02-24 20:49:18 -0500] aneel: Match Group sftpusers
[2014-02-24 20:49:18 -0500] aneel:         ChrootDirectory /sftp/%u
[2014-02-24 20:49:19 -0500] aneel: ForceCommand internal-sftp -f AUTHPRIV -l VERBOSE
[2014-02-24 20:49:41 -0500] aneel: but i don't want the sftp setup recipe to put in a whole different sshd_config
[2014-02-24 20:49:58 -0500] monsterzz: aneel: do you want to add this stanze if it's absent or just check configuration and fail?
[2014-02-24 20:50:05 -0500] aneel: add if absent
[2014-02-24 20:50:36 -0500] monsterzz: aneel: i'm using ruby_block and Chef::Util::FileEdit
[2014-02-24 20:51:11 -0500] aneel: is can that deal with multi-line?
[2014-02-24 20:51:53 -0500] aneel: i could test and add the stanza if the leading line is missing
[2014-02-24 20:52:23 -0500] aneel: but if something ever changed in the stanza, the recipe wouldn't update existing hosts
[2014-02-24 20:53:12 -0500] monsterzz: aneel: nop, it iterates over lines and match each with pattern
[2014-02-24 20:54:27 -0500] aneel: perhaps the best solution is a script that looks for the stanza's introductory line and replaces it wholesale if it's there and adds it if it's not
[2014-02-24 20:55:13 -0500] aneel: thanks for the FileEdit suggestion, though
[2014-02-24 20:55:33 -0500] monsterzz: aneel: you could fall in plain ruby to do that, but in any case you need some magic to use notifications (reload sshd for example)
[2014-02-24 20:56:39 -0500] monsterzz: aneel: and if you can check it from command line with one command you can use execute resource that will append to file (using bash) with not_if condition
[2014-02-24 20:56:55 -0500] AntelopeSalad: why is the chef deploy resource trying to symlink config/database.yml even when i have symlink_before_migrate set to nil?
[2014-02-24 20:56:56 -0500] pabst^: Can you force a cookbook to use a certain version of another installed cookbook, while other cookbooks use another version?
[2014-02-24 20:57:27 -0500] aneel: yeah, i think I'll use string = File.read(...) and munge that
[2014-02-24 20:57:29 -0500] aneel: thanks!
[2014-02-24 20:57:53 -0500] pushnell: hey folks.  I have a chef script which checks out a git repo and then runs some local templates.  I'm using VirtualBox with NFS shares, and my chef script doesn't see the local template files after it checks them out, but if I re-run `vagrant provision` then it sees them and runs them just fine.  Is there any way I can kick virtualbox / chef into noticing these new files? (asking in #vagrant too)
[2014-02-24 20:58:27 -0500] pushnell: this is within a ::Dir.glob() section which searches for *.conf.erb
[2014-02-24 21:04:51 -0500] nicholasserra: Can anyone tell me if Berkshelf v3 requires you to roll out your own api server? Thanks!
[2014-02-24 21:07:09 -0500] drrk: nicholasserra: it helps, but there is a server that covers the community server
[2014-02-24 21:07:40 -0500] drrk: there is a community cookbook that makes it trivial though
[2014-02-24 21:08:00 -0500] nicholasserra: drrk: It seems that the api.berkshelf.com endpoint doesn't work. My vagrant install stops at that point. Hitting the url returns "not found".
[2014-02-24 21:08:45 -0500] drrk: oh, i've not had that problem
[2014-02-24 21:09:04 -0500] nicholasserra: drrk: My vagrant setup stops at: [Berkshelf] Fetching cookbook index from https://api.berkshelf.com...
[2014-02-24 21:09:22 -0500] nicholasserra: drrk: Any more info you can provide would be amazing, i'm kind of stuck.
[2014-02-24 21:09:23 -0500] drrk: the not found is correct though, it doesn't return anython on the base hostname
[2014-02-24 21:09:51 -0500] nicholasserra: Hm. Maybe my vagrant plugin is out of date.
[2014-02-24 21:09:52 -0500] micgo: Berkshelf 3 hits this endpoint by default: http://api.berkshelf.com/universe.json
[2014-02-24 21:10:08 -0500] nicholasserra: micgo: So i need to specify that in my berks file?
[2014-02-24 21:10:29 -0500] nicholasserra: uCurrently I have source "https://api.berkshelf.com"
[2014-02-24 21:10:48 -0500] drrk: you don't want to be using berkshelf-vagrant anymore either, it's been deprecated, you want just the kitchen-vagrant plugin
[2014-02-24 21:10:51 -0500] jbellone: Hi
[2014-02-24 21:10:55 -0500] drrk: nicholasserra: that's correct
[2014-02-24 21:11:10 -0500] micgo: what drrk said :)
[2014-02-24 21:11:18 -0500] nicholasserra: drrk: What I have currently is correct, or do I need to change to the universe url? micgo
[2014-02-24 21:11:20 -0500] jbellone: Looking for a wee bit of help with knife-server :)
[2014-02-24 21:11:32 -0500] micgo: source "https://api.berkshelf.com" < that should work just fine
[2014-02-24 21:11:32 -0500] nicholasserra: Also, thanks for this, you guys are saving my life right now
[2014-02-24 21:12:01 -0500] micgo: if it doesn't, try to hit the universe.json link above and see if it's a connectivity problem
[2014-02-24 21:12:03 -0500] nicholasserra: Okay. That's what I have right now and no go.
[2014-02-24 21:12:05 -0500] micgo: I just hit it fine
[2014-02-24 21:12:11 -0500] nicholasserra: Yeah, works fine for me hitting it.
[2014-02-24 21:12:22 -0500] drrk: oh make sure you have the ca-certificates
[2014-02-24 21:12:37 -0500] nicholasserra: I don't think I have those.
[2014-02-24 21:12:42 -0500] nicholasserra: Here's my gemfile: https://gist.github.com/nicholasserra/791c37c02fabdca2adca
[2014-02-24 21:12:48 -0500] nicholasserra: Do I not need the vagrant plugin?
[2014-02-24 21:13:23 -0500] drrk: no, you don't want vagrnat-berkshelf now
[2014-02-24 21:13:45 -0500] micgo: you should have ca-certificates that work by default on your system. you could try just switching it from https -> http to see if that solves your issue
[2014-02-24 21:13:48 -0500] nicholasserra: Okay. I'll nuke that and remove it. DO I need something else?
[2014-02-24 21:14:00 -0500] nicholasserra: micgo: http and https don't work.
[2014-02-24 21:14:15 -0500] coderanger: nicholasserra: export SSL_CERT_FILE="$(brew --prefix curl-ca-bundle)/share/ca-bundle.crt"
[2014-02-24 21:14:28 -0500] micgo: nicholasserra: Are you just trying to test cookbooks locally? If so, then just use http://kitchen.ci/
[2014-02-24 21:14:45 -0500] nicholasserra: No, trying to build a workingvagrant box from cookbooks
[2014-02-24 21:15:25 -0500] nicholasserra: coderanger: Thank you. Any way to expedite that process or will any new teammate need to also grab those certs?
[2014-02-24 21:15:49 -0500] monsterzz: nicholasserra: micgo: api.berkshelf.com is not accessible over IPv6 :( if you run ipv6-only setup then you'll need to setup your own server
[2014-02-24 21:15:58 -0500] drrk: https://sethvargo.com/the-future-of-vagrant-berkshelf/
[2014-02-24 21:16:07 -0500] jbellone: Am trying to use knife-server to bootstrap an openstack Chef server. Hitting a snag: ERROR: Your private key could not be loaded from /etc/chef-server/chef-webui.pem
[2014-02-24 21:16:10 -0500] coderanger: nicholasserra: Nothing comes to mind, thats just a thing you should always do on new machines if you touch Ruby
[2014-02-24 21:16:26 -0500] coderanger: drrk: Its demise has been somewhat exaggerated
[2014-02-24 21:16:35 -0500] drrk: coderanger: oh?
[2014-02-24 21:16:39 -0500] nicholasserra: Not an ip6 setup. Thankk you though monsterzz
[2014-02-24 21:16:58 -0500] nicholasserra: drrk: thanks for the link. So If I remove that vagrant-berkshelf plugin, is there anything I need to replace it with?
[2014-02-24 21:17:03 -0500] coderanger: drrk: vagrant-berks is going no where any time soon, it will be supported until berks 4 at least (meaning year+)
[2014-02-24 21:17:10 -0500] coderanger: drrk: It is still the right tool for a lot of jobs
[2014-02-24 21:17:22 -0500] coderanger: nicholasserra: No, using it is fine, please disregard that link
[2014-02-24 21:17:30 -0500] nicholasserra: Okay.
[2014-02-24 21:17:45 -0500] nicholasserra: Going to try the certs file, but at this point, it sounds like I have everything set correctly :(
[2014-02-24 21:17:51 -0500] coderanger: drrk: TK doesn't have the documentation to be used by non-domain-experts for this kind of use case so recommending it is unhelpful
[2014-02-24 21:18:03 -0500] coderanger: nicholasserra: Make sure you brew install the certs too
[2014-02-24 21:18:08 -0500] drrk: coderanger: fair enough
[2014-02-24 21:18:12 -0500] coderanger: Or otherwise grab them from Curl
[2014-02-24 21:19:11 -0500] nicholasserra: coderanger:  That brew command seemed to be a no-go.
[2014-02-24 21:19:16 -0500] coderanger: nicholasserra: Hmm?
[2014-02-24 21:19:34 -0500] coderanger: nicholasserra: Did you first `brew install curl-ca-bundle`?
[2014-02-24 21:20:22 -0500] nicholasserra: Yeah, running into an error on it. Gonna update and retry
[2014-02-24 21:21:25 -0500] nicholasserra: Error: Failed to download resource "curl-ca-bundle"
[2014-02-24 21:21:30 -0500] nicholasserra: Blah. New rabbit hole
[2014-02-24 21:26:36 -0500] pabst^: I hate when I can't scroll buffers
[2014-02-24 21:30:28 -0500] drrk: nicholasserra: you aren't having a proxy issue are you?
[2014-02-24 21:31:17 -0500] nicholasserra: drrk: I don't think so. Funny, I can't brew install the curl-ca-bundle because i'm missing the curl-ca-bundle. Wtf
[2014-02-24 21:31:49 -0500] nicholasserra: https://gist.github.com/nicholasserra/977d2c23d1d0a87740a3
[2014-02-24 21:31:50 -0500] nicholasserra: lol
[2014-02-24 21:32:15 -0500] coderanger: nicholasserra: unset SSL_CERTIFICATEPATH
[2014-02-24 21:32:28 -0500] coderanger: You set it before the download so yes, it would now fail saying you don't have it
[2014-02-24 21:32:53 -0500] nicholasserra: Ugh. I'm really failing today.
[2014-02-24 21:32:56 -0500] nicholasserra: Thank you.
[2014-02-24 21:33:36 -0500] nicholasserra: Gonna try to rebuild vagrant again now that that's installed.
[2014-02-24 21:35:11 -0500] coderanger: nicholasserra: First try `berks install`
[2014-02-24 21:35:15 -0500] coderanger: Make sure that works
[2014-02-24 21:36:18 -0500] nicholasserra: coderanger: Good call. berks install was fine when i was using site: opscode, but now that i have my berksfile on source "https://api.berkshelf.com" it's hanging up.
[2014-02-24 21:36:27 -0500] coderanger: Whats the error?
[2014-02-24 21:37:23 -0500] nicholasserra: No error, just sitting at "Fetching cookbook index from https://api.berkshelf.com..."
[2014-02-24 21:37:26 -0500] nicholasserra: coderanger
[2014-02-24 21:38:02 -0500] coderanger: nicholasserra: For how long? That step can easily take a few minutes on a slow connection
[2014-02-24 21:38:41 -0500] nicholasserra: I've let it sit for a while. I'll let it go again and see. On 50mbit.
[2014-02-24 21:39:26 -0500] nicholasserra: It's doing something. Ruby is maxing out my cpu. Hm
[2014-02-24 21:39:50 -0500] nicholasserra: I appreciate all the help coderanger, thanks again
[2014-02-24 21:40:17 -0500] coderanger: nicholasserra: That step is it downloading a JSON blob containing info on every cookbook on the community site
[2014-02-24 21:43:06 -0500] coderanger: No idea then, but if you can get berks install to work, then vagrant should as well
[2014-02-24 21:43:32 -0500] nicholasserra: Yeah. Thanks
[2014-02-24 21:43:35 -0500] holms: maybe someone interested? vagrant+chef https://github.com/holms/vagrant-starter/
[2014-02-24 21:45:20 -0500] nicholasserra: 5 minutes later still on downloading the cookbook index. it's gotta be pointing to the wrong url.
[2014-02-24 21:46:20 -0500] AntelopeSalad: coderanger: would you mind taking a peek at this? https://gist.github.com/AntelopeSalad/04b7ab1973f55f64ce78 , it's killig me inside and you're the only person who seems to have experience with the deploy resource
[2014-02-24 21:46:26 -0500] AntelopeSalad: *killing
[2014-02-24 21:46:46 -0500] shlant: coderanger: would you be able to help me with this search problem? Currently I have 2 redis nodes, but the template only end up with the second node: https://gist.github.com/MrMMorris/e655a93794630fc53008
[2014-02-24 21:47:13 -0500] coderanger: nicholasserra: No, thats correct, try turning up berkshelfs verbosity
[2014-02-24 21:47:36 -0500] nicholasserra: Is there a flag for that?
[2014-02-24 21:47:41 -0500] coderanger: AntelopeSalad: You need to start that with "env"
[2014-02-24 21:47:55 -0500] coderanger: AntelopeSalad: "FOO=bar" isn't a program you can run, thats bash syntax
[2014-02-24 21:48:02 -0500] hugespoon: shlant: need an .each?
[2014-02-24 21:48:07 -0500] hugespoon: total shot in the dark
[2014-02-24 21:48:20 -0500] AntelopeSalad: coderanger: i included the source to my recipe
[2014-02-24 21:48:22 -0500] nicholasserra: GOt it, there's a -d debug
[2014-02-24 21:48:26 -0500] coderanger: hugespoon: Actually you don't :-)
[2014-02-24 21:48:31 -0500] shlant: hugespoon: where should the .each go? I have it in the template
[2014-02-24 21:48:39 -0500] hugespoon: shlant: yeah im wrong :D
[2014-02-24 21:48:55 -0500] coderanger: AntelopeSalad: Yes, and "migration_command "#{rails_env} #{rvm_context} rake db:migrate"" is correct
[2014-02-24 21:49:04 -0500] coderanger: AntelopeSalad: Make it migration_command "env #{rails_env} #{rvm_context} rake db:migrate"
[2014-02-24 21:49:05 -0500] hugespoon: just figured coderanger was getting inundated so id take a random stab
[2014-02-24 21:49:25 -0500] shlant: hugespoon: haha thanks for trying!
[2014-02-24 21:49:28 -0500] coderanger: shlant: I'm not sure this does what you want though
[2014-02-24 21:49:38 -0500] coderanger: You want to find a single server and then write a single config file?
[2014-02-24 21:49:39 -0500] AntelopeSalad: coderanger: thanks, testing it -- will let you know in a few
[2014-02-24 21:49:47 -0500] coderanger: This will overrwrite the config file N times
[2014-02-24 21:50:01 -0500] shlant: coderanger:  I want ot find all servers running the redis role and put each one on a line in the template
[2014-02-24 21:50:04 -0500] coderanger: shlant: servers = search()
[2014-02-24 21:50:19 -0500] luisg: hi jtimberman, i see ur a a collaborator in the mysql cookbook, i wanted to send out a patch making the default storage engine innodb, because of this bug https://bugs.launchpad.net/openstack-chef/+bug/1284272
[2014-02-24 21:50:21 -0500] coderanger: shlant: template '' do variables :servers => servers
[2014-02-24 21:50:32 -0500] coderanger: shlant: You want to pass the full list of servers into a single template
[2014-02-24 21:50:39 -0500] luisg: u think that would be ok?
[2014-02-24 21:50:45 -0500] coderanger: luisg: Have you submitted a ticket in Jira?
[2014-02-24 21:50:57 -0500] luisg: no, i was wondering about the process too
[2014-02-24 21:51:25 -0500] coderanger: luisg: Please open a pull request, create a jira ticket, and mark it as Fix Provided
[2014-02-24 21:51:35 -0500] coderanger: luisg: It will then get reviewed in the next merge meeting
[2014-02-24 21:51:36 -0500] shlant: coderanger: thanks, I'll try it out
[2014-02-24 21:52:00 -0500] luisg: coderanger, sounds good, when is ur next merge meeting?
[2014-02-24 21:52:08 -0500] nicholasserra: Somehow making it past berks install now. Didn't change anything.
[2014-02-24 21:52:52 -0500] AntelopeSalad: coderanger: that seems to not throw the invalid command anymore but it still skips running the db:create command in the before_migration callback
[2014-02-24 21:52:54 -0500] coderanger: luisg: No idea, sorry
[2014-02-24 21:53:05 -0500] AntelopeSalad: all details included in https://gist.github.com/AntelopeSalad/04b7ab1973f55f64ce78#file-tests-rb
[2014-02-24 21:53:38 -0500] luisg: coderanger, do u know who might know? or even a ballpark timeframe would help
[2014-02-24 21:54:01 -0500] coderanger: luisg: I do not work for ChefInc so I'm not involved in that process, sorry
[2014-02-24 21:54:16 -0500] luisg: ok np, thanks for the info though
[2014-02-24 21:55:28 -0500] coderanger: AntelopeSalad: Same issue with the rvm shell
[2014-02-24 21:55:43 -0500] AntelopeSalad: i'm noticing in both the bundle install and db:create commands, it says it skips them because action :nothing
[2014-02-24 21:55:45 -0500] coderanger: AntelopeSalad: FOO=bar is _not_ command syntax, you cant' use it ever
[2014-02-24 21:56:02 -0500] coderanger: It is understood by either /bin/bash or /usr/bin/env
[2014-02-24 21:56:08 -0500] coderanger: which are actual processes you can run
[2014-02-24 21:56:14 -0500] coderanger: You cannot run FOO=bar
[2014-02-24 21:56:22 -0500] AntelopeSalad: yeah i changed the migrate command to be env ...
[2014-02-24 21:56:35 -0500] coderanger: You didn't change the rvm_shells in the before_migrate
[2014-02-24 21:56:45 -0500] AntelopeSalad: i went by the readme
[2014-02-24 21:57:10 -0500] AntelopeSalad: https://github.com/fnichol/chef-rvm#run-a-rake-task
[2014-02-24 21:58:00 -0500] AntelopeSalad: i figured him dropping RAILS_ENV=foo after the rake was an error on his part, so i moved it before
[2014-02-24 21:59:41 -0500] pokerface3: Hey, anyone got a minute to lend a newbie a hand?
[2014-02-24 22:00:21 -0500] mjuszczak: Anyone else have any comments on running a single chef server for staging/prod versus two separate chef servers?
[2014-02-24 22:04:56 -0500] daxroc: Evening
[2014-02-24 22:05:11 -0500] daxroc: Does yum support groupinstall ?
[2014-02-24 22:05:29 -0500] daxroc: *Does chef support yum groupinstall :D
[2014-02-24 22:06:04 -0500] daxroc: from what I can tell no https://tickets.opscode.com/browse/CHEF-1392
[2014-02-24 22:07:29 -0500] pokerface3: Does anyone know how to setup a splunk forwarder using chef? I am new to chef and I don't see how we would define the forwarder-server for the node to connect too.
[2014-02-24 22:16:56 -0500] coderanger: daxroc: Which group are you trying to install?
[2014-02-24 22:17:12 -0500] coderanger: pokerface3: You could either use chef search or just set it as a node attribute
[2014-02-24 22:17:21 -0500] coderanger: (or use ZK, etcd, etc)
[2014-02-24 22:18:16 -0500] AntelopeSalad: coderanger: i made some progress, basically rvm_shell never runs those commands because its action is set to :nothing
[2014-02-24 22:18:49 -0500] daxroc: coderanger: 'Deveopment Tools'
[2014-02-24 22:19:01 -0500] daxroc: *'Development Tools'
[2014-02-24 22:19:39 -0500] coderanger: daxroc: Already handled for you in the build-essentials cookbook
[2014-02-24 22:19:43 -0500] coderanger: :-)
[2014-02-24 22:19:56 -0500] daxroc: Nice
[2014-02-24 22:19:59 -0500] BLZbubba_: hi guys, how well does chef on windows handle software package installation?  e.g. on one machine i want python and some exe/msi based software; on another sql server, etc, etc
[2014-02-24 22:20:04 -0500] daxroc: *yoink
[2014-02-24 22:20:17 -0500] BLZbubba_: i'm assuming you can't just use yum/apt or anything nice & easy like that
[2014-02-24 22:20:47 -0500] coderanger: BLZbubba_: There are resources for MSIs, InstallShield installers, and Choclatey
[2014-02-24 22:20:54 -0500] coderanger: and Windows Compoents
[2014-02-24 22:21:02 -0500] AntelopeSalad: coderanger: this is the correct syntax using 'execute' right? https://gist.github.com/AntelopeSalad/82538a63441f7d32a6f6
[2014-02-24 22:21:10 -0500] daxroc: coderanger: I did come across this https://gist.github.com/leventyalcin/5619203
[2014-02-24 22:21:35 -0500] coderanger: daxroc: Yeah, don't do that
[2014-02-24 22:21:39 -0500] BLZbubba_: coderanger: ah excellent
[2014-02-24 22:21:49 -0500] coderanger: just set your cookbook to depend on the build essential one and include_recipe it
[2014-02-24 22:22:14 -0500] pokerface3: Thanks coderanger. I'm not sure exactly how I would do that. Could you provide me with an example or where I can read to learn more on how to do that?
[2014-02-24 22:22:17 -0500] coderanger: AntelopeSalad: Without knowing whats in those variables I can't say, just make sure the first thing in the command line is actually a program
[2014-02-24 22:22:51 -0500] coderanger: pokerface3: https://github.com/bestbuycom/splunk_cookbook/blob/master/recipes/forwarder.rb perhaps
[2014-02-24 22:23:06 -0500] AntelopeSalad: coderanger: the messed up thing is if i run the db:create, db:migrate , assets:precompile in the server directly, using identical commands -- all 3 work
[2014-02-24 22:23:18 -0500] coderanger: AntelopeSalad: Again, no, you are running them in bash
[2014-02-24 22:23:21 -0500] coderanger: thats very different
[2014-02-24 22:23:29 -0500] coderanger: bash does a lot more than just run programs
[2014-02-24 22:23:35 -0500] pokerface3: Thanks coderanger!
[2014-02-24 22:23:54 -0500] coderanger: AntelopeSalad: Basically this is the same thing as typing ruby code into bash and it not working
[2014-02-24 22:24:24 -0500] coderanger: bash is a superset of "can run programs"
[2014-02-24 22:24:33 -0500] AntelopeSalad: coderanger: ok, would it helped if i gist the entire delpoy block?
[2014-02-24 22:24:36 -0500] AntelopeSalad: *help
[2014-02-24 22:24:45 -0500] AntelopeSalad: it's about 30 lines or so
[2014-02-24 22:25:02 -0500] shlant: coderanger: you got me almost there, but I get node[redis-server] in the template instead of just redis-server
[2014-02-24 22:25:03 -0500] shlant: https://gist.github.com/MrMMorris/e655a93794630fc53008
[2014-02-24 22:25:53 -0500] coderanger: shlant: in your template do <%= server['fqdn'] %> instead of just <%= server %>
[2014-02-24 22:26:15 -0500] coderanger: The list isn't a list of FQDNs, it is a list of chef node objects
[2014-02-24 22:27:09 -0500] AntelopeSalad: coderanger: maybe i'm doing something wrong? https://gist.github.com/AntelopeSalad/82538a63441f7d32a6f6
[2014-02-24 22:28:03 -0500] coderanger: AntelopeSalad: Check that rvm is available on the path, it usually isn't for non-users
[2014-02-24 22:28:16 -0500] coderanger: AntelopeSalad: Reminder, using rvm on a service is teeeeeerrible
[2014-02-24 22:28:33 -0500] AntelopeSalad: coderanger: i'm not really sure how to check, i installed it using fn's cookbook
[2014-02-24 22:29:26 -0500] AntelopeSalad: and mpapis showed me that rvm VERSION do ... trick to run commands within the context of rvm's ruby
[2014-02-24 22:31:15 -0500] shlant: coderanger: perfect! thanks for your help. right at quitin' time :)
[2014-02-24 22:32:33 -0500] coderanger: AntelopeSalad: Yes, and so using the rvm_exec resource gets all that setup for you :)
[2014-02-24 22:32:57 -0500] AntelopeSalad: ctrl+F'd on fn's readme shows nothing for rvm_exec
[2014-02-24 22:33:17 -0500] nicholasserra: coderanger: Turns out it's getting stuck on "parsing Chef response body as JSON". Debug shows me it's making it past http request. I was up and running for a bit not now it's reparsing the json again. Looks like it does it on any lockfile change. Just dealing with inconsistencies now.
[2014-02-24 22:33:37 -0500] coderanger: AntelopeSalad: https://github.com/fnichol/chef-rvm#-rvm_shell
[2014-02-24 22:34:07 -0500] AntelopeSalad: rvm_shell is what i've been using, but it always skips running it because action :none
[2014-02-24 22:34:21 -0500] AntelopeSalad: i changed it to execute recently because rvm_shell always skipped
[2014-02-24 22:34:38 -0500] coderanger: AntelopeSalad: So set the action?
[2014-02-24 22:34:39 -0500] AntelopeSalad: and how can i run rvm_shell for the migrate_command when the migrate_commands expects a string
[2014-02-24 22:35:00 -0500] AntelopeSalad: the readme doesn't mention that the action is even available to set
[2014-02-24 22:35:14 -0500] coderanger: Yes it does, the actions are summarized right there :)
[2014-02-24 22:35:21 -0500] AntelopeSalad: and it says it defaults to run
[2014-02-24 22:35:43 -0500] coderanger: Indeed, so either thats wrong or something else isn't working :)
[2014-02-24 22:35:59 -0500] AntelopeSalad: one thing is for sure, there's no way to use rvm_shell for running the migrate command
[2014-02-24 22:36:05 -0500] AntelopeSalad: since deploy.migrate_command takes a string
[2014-02-24 22:37:10 -0500] coderanger: AntelopeSalad: I think thats correct, yes
[2014-02-24 22:37:29 -0500] coderanger: You'll have to get the full paths to rake managed manually for that
[2014-02-24 22:37:44 -0500] AntelopeSalad: i'm re-running it now with rvm_shell explicitly setting action to run
[2014-02-24 22:37:54 -0500] AntelopeSalad: the problem with that is
[2014-02-24 22:38:01 -0500] AntelopeSalad: i don't know the path at that stage of the run
[2014-02-24 22:38:23 -0500] AntelopeSalad: the path gets created based on the current time after i initialize migrate_command
[2014-02-24 22:39:03 -0500] AntelopeSalad: also setting action to :run does the same thing -- it fails saying skipped due to action :nothing when it's actually set to run
[2014-02-24 22:40:28 -0500] AntelopeSalad: https://gist.github.com/AntelopeSalad/704cf029ddf1bf3175f7 , how is that even possible? i double checked the cookbook version and it's the correct copy
[2014-02-24 22:49:09 -0500] pokerface3: I still can't for the life of me figure out where to put the indexer server. Everywhere says to use the splunk binary to add the indexer and I don't see that.
[2014-02-24 23:16:09 -0500] luisg: coderanger, i created the pull request here https://github.com/opscode-cookbooks/mysql/pull/165
[2014-02-24 23:16:15 -0500] luisg: and the corrsponding jira issue
[2014-02-24 23:16:22 -0500] luisg: anything else needed?
[2014-02-24 23:16:47 -0500] coderanger: luisg: If oyu have a CLA on file you should have permission to mark the ticket as Fix Provided
[2014-02-24 23:17:46 -0500] luisg: im not sure i have a cla
[2014-02-24 23:18:29 -0500] luisg: coderanger, where can i sign it?
[2014-02-24 23:19:01 -0500] coderanger: luisg: https://secure.echosign.com/public/hostedForm?formid=PJIF5694K6L
[2014-02-24 23:19:15 -0500] luisg: thx
[2014-02-24 23:26:59 -0500] AntelopeSalad: coderanger: i was able to get a stack trace on the db migrate with some help in #rvm
[2014-02-24 23:27:31 -0500] AntelopeSalad: when it runs the db:migrate command it fails with 'role "chef" does not exist" , why on earth is the deploy resource trying to access roles? i don't even use roles
[2014-02-24 23:28:27 -0500] coderanger: AntelopeSalad: Roles are what postgres calls users
[2014-02-24 23:28:51 -0500] coderanger: Thats an error form postgres, not related to chef roles
[2014-02-24 23:29:04 -0500] coderanger: You are trying to connect as a user called chef
[2014-02-24 23:30:21 -0500] spicy: Any tips on trying to debug missing dependencies on chef-server (ala https://tickets.opscode.com/browse/CHEF-3921)? Having trouble tracking one down here and it is as clear as mud...
[2014-02-24 23:31:36 -0500] AntelopeSalad: coderanger: that's such a troll error
[2014-02-24 23:31:46 -0500] coderanger: AntelopeSalad: Terminology collision :)
[2014-02-24 23:32:00 -0500] AntelopeSalad: is chef's error reporting going to improve btw?
[2014-02-24 23:32:11 -0500] AntelopeSalad: i had to do... 2>&1 | tee /tmp/dbmigrate.log , in the migrate command just to see the trace
[2014-02-24 23:32:12 -0500] coderanger: AntelopeSalad: As I don't work for ChefInc, I can't say
[2014-02-24 23:32:24 -0500] AntelopeSalad: without that it wouldn't even say anything, not an ounce of detail
[2014-02-24 23:32:29 -0500] AntelopeSalad: other than "rvm exited with 1"
[2014-02-24 23:32:38 -0500] coderanger: I can tell you the next iteration of the app cookbooks won't be using the deploy resource though :)
[2014-02-24 23:32:53 -0500] AntelopeSalad: that's fine, i need something that works like 2 months ago
[2014-02-24 23:33:00 -0500] AntelopeSalad: not 2 years from now :o
[2014-02-24 23:33:33 -0500] coderanger: AntelopeSalad: https://www.youtube.com/watch?v=siwpn14IE7E
[2014-02-24 23:34:30 -0500] AntelopeSalad: that's a good song
[2014-02-24 23:36:22 -0500] AntelopeSalad: btw my database yaml file has the database user "postgres" not "chef", any thoughts on why it's trying to use "chef"?
[2014-02-24 23:37:03 -0500] coderanger: AntelopeSalad: Postgres uses the local username by default, does chef run as a user named "chef"?
[2014-02-24 23:37:30 -0500] AntelopeSalad: yes for debugging purposes i've setup this server with the user of "chef"
[2014-02-24 23:37:49 -0500] coderanger: There ya go
[2014-02-24 23:38:03 -0500] coderanger: Now why does it not use the user in the file, no clue
[2014-02-24 23:38:07 -0500] AntelopeSalad: i'm using https://gist.github.com/AntelopeSalad/e9144fcb35e0d51c1434
[2014-02-24 23:38:09 -0500] coderanger: Thats a rails question though :)
[2014-02-24 23:38:12 -0500] AntelopeSalad: to setup my postgres db
[2014-02-24 23:38:36 -0500] coderanger: AntelopeSalad: Erm, putting a password on the postgres user is a bad idea and generally won't work
[2014-02-24 23:38:38 -0500] AntelopeSalad: i would think pg_user is certainly using the user "postgres" right?
[2014-02-24 23:39:19 -0500] AntelopeSalad: i am also using this cookbook https://github.com/phlipper/chef-postgresql
[2014-02-24 23:39:33 -0500] coderanger: Never used that one, I use the chefinc postgres one
[2014-02-24 23:39:47 -0500] AntelopeSalad: i wanted to but it wouldn't let me install postgres 9.3 without making about 40 lines of changes
[2014-02-24 23:40:15 -0500] Dairenn: And then also bringing in the psql cookbook.
[2014-02-24 23:40:42 -0500] AntelopeSalad: yeah the opscode postgres cookbook is usuable for 9.3 imo
[2014-02-24 23:40:49 -0500] AntelopeSalad: *unusable
[2014-02-24 23:41:24 -0500] Dairenn: The psql cookbook allowed me to use the Unix psql client for adding a postgres user with a password, and then the LWRP from the same cookbook to further add other users, databases, and set grants.
[2014-02-24 23:42:25 -0500] Dairenn: But hey, I gotta weird one.  How come I can see a node on the "Nodes" page on my Chef enterprise server Web UI but under "Status" it's not there?  I know it's running, because of the ohai time, and, well, chef-client receives the run_list that I've set.
[2014-02-24 23:43:35 -0500] coderanger: Dairenn: Which status page do you mean?
[2014-02-24 23:43:42 -0500] coderanger: The new UI shouldn't have one
[2014-02-24 23:59:04 -0500] Dairenn: Turns out I had to delete the node and re-bootstrap it with a new API key.
[2014-02-24 23:59:16 -0500] Dairenn: (We are running a Chef enterprise server with the previous Web UI.)
