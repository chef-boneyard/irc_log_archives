[2014-05-09 00:08:15 -0400] sauraus1: What is private chef error 10000?
[2014-05-09 00:13:13 -0400] coderanger: sauraus1: In what context
[2014-05-09 00:13:53 -0400] sauraus1: web GUI, trying to edit a data bag
[2014-05-09 00:21:18 -0400] coderanger: sauraus1: Hmm, can you open up the JS console and see if there an error logged there?
[2014-05-09 00:22:59 -0400] sauraus1: When I enter the data in a different bag it works, only this one fails with: An application error has occurred. Please try again later. (Error 10000)
[2014-05-09 00:23:18 -0400] coderanger: sauraus1: What browser?
[2014-05-09 00:23:24 -0400] sauraus1: safari :)
[2014-05-09 00:23:44 -0400] coderanger: 6?
[2014-05-09 00:24:04 -0400] sauraus1: 7
[2014-05-09 00:26:07 -0400] coderanger: Hmm, not sure then, best bet would be to contact support@getchef.com. the new webui isn't open source so I can't do much more from here
[2014-05-09 00:26:35 -0400] sauraus1: Now I get this when I create a new data bag: The new data bag item is not formed correctly. Check for illegal characters in the data bag item's body, and check that the body is formed correctly. (Error 27009) :(
[2014-05-09 00:26:54 -0400] sauraus1: content is this:: {"id":""} :D
[2014-05-09 00:27:18 -0400] coderanger: You need to fill in an id
[2014-05-09 00:28:59 -0400] sauraus1: It's not that, it saved it after a couple of times trying to enter a private_key:RSA_KEY pair
[2014-05-09 00:29:22 -0400] sauraus1: The Chef Server UI is and has been a PITA as long as I can remember
[2014-05-09 00:29:38 -0400] redondos: yep. i stopped giving it a chance a long time ago
[2014-05-09 00:29:52 -0400] redondos: i remember it used to add dos line breaks to nodes
[2014-05-09 00:30:04 -0400] redondos: the latest one only shows like 20-25 entries in the "status" list
[2014-05-09 00:30:25 -0400] sauraus1: That's actually not a bug but an intentional limitations :D
[2014-05-09 00:30:29 -0400] redondos: adding attributes to a node needs a special incantation i can never remember
[2014-05-09 00:30:50 -0400] coderanger: sauraus1: Hmm, it shouldn't allow you to submit with bas JSON (unless someone took out that code) so that would point at something cranky on the backend
[2014-05-09 00:30:55 -0400] redondos: it sucks either from bugs or decisions i don't agree with, true.
[2014-05-09 00:32:40 -0400] sauraus1: OMG I just created a data_bag called 'new' when I hit edit it redirects me to create a new data_bag :D
[2014-05-09 00:33:16 -0400] dtrott: Well you created one perhaps you want another one :-P
[2014-05-09 00:33:23 -0400] sauraus1: LOL
[2014-05-09 00:34:04 -0400] coderanger: sauraus1: Yeah, I ignored that particular case
[2014-05-09 00:34:10 -0400] coderanger: sauraus1: Same thing will happen with roles too
[2014-05-09 00:34:21 -0400] coderanger: sauraus1: It was deemed "your own damn fault" :)
[2014-05-09 00:35:49 -0400] sauraus1: ok I can repro the case now, I create a data_bag, add "id":"x" to it, save the bag, then replace "x" with a private RSA key and hit safe, which returns then An application error has occured. Please try again later (Error 10000)
[2014-05-09 00:37:07 -0400] coderanger: sauraus1: Hmm, any weird characters in there? Notably newlines or unicode whitespace?
[2014-05-09 00:39:27 -0400] coderanger: or "fancy" quotes
[2014-05-09 00:42:06 -0400] sauraus1: newlines as it's a 1-1 copy of the private RSA key
[2014-05-09 00:42:23 -0400] coderanger: Yeah, thats not allowed
[2014-05-09 00:42:34 -0400] coderanger: And it should be catching it when you click submit :-(
[2014-05-09 00:42:44 -0400] coderanger: Newlines have to be "\n"
[2014-05-09 00:43:00 -0400] coderanger: JSON doesn't allow multiline strings
[2014-05-09 00:45:42 -0400] sauraus1: Well it allows me to upload it but it's borged when I try to edit it
[2014-05-09 00:46:00 -0400] sauraus1: What is the proper way of uploading a PRIVATE RSA KEY? remove all the new lines?
[2014-05-09 00:46:13 -0400] coderanger: sauraus1: newline -> \n
[2014-05-09 00:48:50 -0400] doomviking: I record a vim macro when I have to do that, as I'm captain fat finger.
[2014-05-09 00:49:36 -0400] doomviking: but there are many ways to drive to San Diego.
[2014-05-09 00:50:04 -0400] sauraus1: yeah :) \n good old C times :D
[2014-05-09 00:52:20 -0400] sauraus1: Well that doesn't allow it to be saved through the UI :(
[2014-05-09 00:52:26 -0400] sauraus1: all \n at every line end now
[2014-05-09 00:58:09 -0400] doomviking: yeah I don't use the UI for that
[2014-05-09 01:01:38 -0400] sauraus1: well uploading using knife also fails with invalid character just before the \n :(
[2014-05-09 01:02:52 -0400] coderanger: sauraus1: can you pastebin a suitably redacted version?
[2014-05-09 01:03:26 -0400] sauraus1: {"private_key":"-----BEGIN RSA PRIVATE KEY-----\n
[2014-05-09 01:03:27 -0400] sauraus1: MIIJKAIBAAKCAgEAqjJNrZuvLQctxAR3tzeZ53xqSrcoqMv6he3MHyggLrSxTBYW\n
[2014-05-09 01:03:38 -0400] sauraus1: ERROR: Yajl::ParseError: lexical error: invalid character inside string.
[2014-05-09 01:03:39 -0400] sauraus1:           --BEGIN RSA PRIVATE KEY-----\n MIIJKAIBAAKCAgEAqjJNrZuvLQctx
[2014-05-09 01:03:39 -0400] sauraus1:                      (right here) ------^
[2014-05-09 01:03:57 -0400] sauraus1: the ^ above is pointing at the ' ' between \n and M
[2014-05-09 01:03:58 -0400] xmltok_: why does chef install some packages and gems before it finishes converging my cookbooks? its installing packages before my repos are configured and i get gems built against out of date libraries
[2014-05-09 01:06:00 -0400] coderanger: sauraus1: Is there still an actual line break after the \n?
[2014-05-09 01:06:17 -0400] sauraus1: :D yes there is :) I see where you are going :D
[2014-05-09 01:06:24 -0400] coderanger: xmltok_: Some recipes install stuff at compile time
[2014-05-09 01:06:35 -0400] xmltok_: how can i do that for my repos?
[2014-05-09 01:06:40 -0400] coderanger: sauraus1: Literally there can be no line breaks inside a JSON string
[2014-05-09 01:06:59 -0400] coderanger: xmltok_: What package in particular are you having issues with?
[2014-05-09 01:07:00 -0400] sauraus1: yeah :)
[2014-05-09 01:08:04 -0400] xmltok_: coderanger: libmariadbclient-dev and the chef_gem[mysql] from the mysql cookbook, i need to get my repo in there because i have a different version of mariadb (10.x) that i am using for galera
[2014-05-09 01:08:25 -0400] xmltok_: the gem gets built against the old version
[2014-05-09 01:08:28 -0400] coderanger: xmltok_: So for something that complex, you are best off with the now cookbook
[2014-05-09 01:08:40 -0400] coderanger: it gives you include_recipe_now, which lets you manually sequence things
[2014-05-09 01:08:58 -0400] xmltok_: cool
[2014-05-09 01:09:09 -0400] coderanger: you'll need to make a wrapper cookbook that calls include_recipe_now on your mariadb recipe and then the mysql recipe in the correct order
[2014-05-09 01:09:29 -0400] xmltok_: i already have a wrapper, and my repos get installed in my base cookbook, ill just include_recipe_now the base cookbook and i should be good
[2014-05-09 01:11:13 -0400] slith: Hello all, I'm newbie here and I'm trying to configure my development environment. one of the things i'm trying to do is to create a database for all my projects, and then import a mysql dump file (if one exists).  i got it working where i'm basically copying the mysql_database create block, and the execute import block for the sqldump. ideally what i would like is to specify the database name and sql dump path in a multidimensional array 
[2014-05-09 01:11:14 -0400] slith: should i be doing this in a recipeor a template? what is the recommended approach for something like this?
[2014-05-09 03:54:40 -0400] jidar: slith: sounds like an attribte to me
[2014-05-09 03:54:51 -0400] jidar: attribute rather
[2014-05-09 04:36:25 -0400] Shiv093: Hi
[2014-05-09 05:13:47 -0400] slith: jidar: so set the attributes and then a template?
[2014-05-09 05:24:35 -0400] Shiv0392: hi
[2014-05-09 05:27:42 -0400] coderanger: Alo
[2014-05-09 05:34:33 -0400] shiv0349: Hi
[2014-05-09 06:07:56 -0400] _pingu: test-kitchen: I don't want to define a run_list in the .kitchen.yml. I want to define a node.json, because it contains the run_list together with the neccessary environment. How can I do that?
[2014-05-09 06:08:45 -0400] makhan: Hey guys. How do I stop chef from creating recursive symlinks when using symlink_before_migrate with folders?
[2014-05-09 06:09:34 -0400] makhan: I use symlink_before_migrate({'folder' => 'folder'}) and it correctly links current/folder to shared/folder but also creates a link shared/folder/folder that links to shared/folder
[2014-05-09 06:15:53 -0400] coderanger: makhan: step one) don't use the deploy resource
[2014-05-09 06:16:09 -0400] makhan: what's wrong with deploy resource?
[2014-05-09 06:16:25 -0400] coderanger: many things, such as the fact that it creates symlinks poorly :)
[2014-05-09 06:16:37 -0400] coderanger: It is also just not necessary
[2014-05-09 06:16:44 -0400] coderanger: Just use a git resource and some execute resources
[2014-05-09 06:17:05 -0400] makhan: hmm, sounds reasonable
[2014-05-09 06:17:47 -0400] makhan: is there an easy way to mimic the versioning?
[2014-05-09 06:18:00 -0400] coderanger: No, nor should you, just let the git resource be convergent
[2014-05-09 06:18:09 -0400] coderanger: The symlinks stuff gets you roughly nothing
[2014-05-09 06:18:35 -0400] coderanger: It is a relic of attempted capistrano interop
[2014-05-09 06:18:57 -0400] makhan: hmm, it does give me a nice history of recent versions
[2014-05-09 06:19:30 -0400] coderanger: That history belongs in git or whatever you use to manage "what version goes where"
[2014-05-09 06:19:39 -0400] coderanger: (often in a data bag, though I prefer recipe code)
[2014-05-09 06:21:33 -0400] makhan: will think about it, thanks
[2014-05-09 06:21:54 -0400] makhan: is there any resource that nicely summarises best Chef coding practices?
[2014-05-09 06:23:53 -0400] makhan: I actually like the versioning because I use Chef along with Capistrano
[2014-05-09 06:23:56 -0400] coderanger: makhan: Not really :-/
[2014-05-09 06:24:22 -0400] coderanger: And it is worth noting my idea of "best practices" are far from universally accepted :)
[2014-05-09 06:24:38 -0400] makhan: ok ;)
[2014-05-09 06:24:41 -0400] coderanger: I'm a few stddev out from even normal opiniated-neckbeard status
[2014-05-09 06:24:44 -0400] double_p: that's the problem with BCP :)
[2014-05-09 06:25:20 -0400] makhan: :)
[2014-05-09 06:25:43 -0400] makhan: Well, maybe I'll just get rid of the deploy resource. I put it there before I started using capistrano, now it's kind of redundant
[2014-05-09 06:26:15 -0400] makhan: I left it there because it gives me the option to create a fully functional server with a single click of a button
[2014-05-09 06:26:27 -0400] coderanger: makhan: So does a git resource though :)
[2014-05-09 06:26:46 -0400] SHIV456: Hi Guys
[2014-05-09 06:27:24 -0400] makhan: ok, thanks
[2014-05-09 06:27:25 -0400] SHIV456: new in chef can anyone share link for any cookbook in which we chef_handler email functionality is implemented
[2014-05-09 06:27:27 -0400] SHIV456: ?
[2014-05-09 06:27:31 -0400] double_p: is there a logfile/history of node manipuliation via knife (e.g. when was a run_list added)
[2014-05-09 06:28:11 -0400] coderanger: SHIV456: Not sure what you mean
[2014-05-09 06:28:26 -0400] coderanger: double_p: Not really, its on the list for enterprise chef though
[2014-05-09 06:28:38 -0400] coderanger: double_p: ETA is end of Q2 I think
[2014-05-09 06:28:47 -0400] double_p: rgr, another reason to move this to cookbooks
[2014-05-09 06:29:35 -0400] SHIV456: i mean any example in which chef_handler is used to send notification on chef-client run
[2014-05-09 06:29:46 -0400] SHIV456: in email
[2014-05-09 06:30:01 -0400] coderanger: double_p: There are nginx access logs, but tracking down the right log line will be pretty hard and at best you get the remote IP, not the username
[2014-05-09 06:30:52 -0400] coderanger: SHIV456: See https://github.com/kisoku/chef-handler-mail
[2014-05-09 06:31:07 -0400] double_p: SHIV456: http://docs.opscode.com/essentials_handlers.html down the page is 'simple email'
[2014-05-09 06:31:50 -0400] double_p: coderanger: oh, indeed. since i'm rather for WHEN, that's sufficient. i could track down the user with that since it's only three working on it :)
[2014-05-09 06:31:57 -0400] SHIV456: double_p : Thanks :) let me check
[2014-05-09 06:33:18 -0400] coderanger: double_p: Look for a POST to /nodes/<name>
[2014-05-09 06:33:40 -0400] coderanger: Or is it a PUT
[2014-05-09 06:33:42 -0400] coderanger: I forget :)
[2014-05-09 06:33:50 -0400] _pingu: how can i define, that suite x in .kitchen.yml should use a.json from the nodes dir and b.json from the environment dir?
[2014-05-09 06:34:48 -0400] coderanger: _pingu: Node JSON is defined in-line, environment can be set via "environment: foo"
[2014-05-09 06:39:58 -0400] double_p: coderanger: basically.. PUT /nodes/dlagrpx311 ... "Chef Knife/11.6.2 .. "pbuehler" "2014-05-06T14:31:14Z"
[2014-05-09 06:40:01 -0400] double_p: coderanger: all there! :)
[2014-05-09 06:40:52 -0400] coderanger: Hah, nice, I guess they added the header to the log format
[2014-05-09 06:40:59 -0400] double_p: yep
[2014-05-09 06:41:26 -0400] double_p: http_x_ops_userid
[2014-05-09 06:42:39 -0400] double_p: no more "i didnt do it!" :-D
[2014-05-09 06:42:57 -0400] double_p: BOFH - you can run, but you cannot hide
[2014-05-09 06:43:08 -0400] _pingu: coderanger: would you please give me an example? I'am not sure if environment: foo has to be a sibling to suites: attributes or a child of attributes. Gues inline means: attributes: {..}? And where can I read that information for myself the next time?
[2014-05-09 06:43:24 -0400] coderanger: _pingu: https://github.com/test-kitchen/test-kitchen/issues/199#issuecomment-39164874
[2014-05-09 06:44:47 -0400] Malkav: hey everyone
[2014-05-09 06:45:04 -0400] Malkav: I'm just getting started with Chef Solo.
[2014-05-09 06:45:49 -0400] Malkav: I've run curl -L https://www.opscode.com/chef/install.sh | bash
[2014-05-09 06:46:03 -0400] Malkav: do I need to install ruby separately?
[2014-05-09 06:46:40 -0400] coderanger: Malkav: No, it comes with its own ruby internally
[2014-05-09 06:46:51 -0400] Malkav: great
[2014-05-09 06:47:10 -0400] Malkav:  so I can just download the cookbooks and get started
[2014-05-09 06:48:53 -0400] double_p: hm, actually i can pull a ton of metrics out of that log without having hassle of handlers here and there
[2014-05-09 06:53:12 -0400] _pingu: coderanger: ok, thanks!
[2014-05-09 08:36:58 -0400] Bryn_: Hi, I'm trying to use knife ssh but am having issues which I think are related to public vs private IP address
[2014-05-09 08:37:11 -0400] Bryn_: This works: knife ssh name:webserver1 "ls" --attribute ipaddress
[2014-05-09 08:37:26 -0400] Bryn_: This doesn't: knife ssh name:webserver1 "ls"
[2014-05-09 08:38:30 -0400] srenatus: Bryn_: as expected, I'd say. by default, knife ssh tries to use the hostname or fqdn
[2014-05-09 08:38:51 -0400] srenatus: Bryn_: to use the ip address, you need to use "-a ipaddress" (as you did)
[2014-05-09 08:39:18 -0400] Bryn_: I see
[2014-05-09 08:39:38 -0400] Bryn_: I'll go check the dns settings. Thanks
[2014-05-09 08:40:23 -0400] srenatus: :)
[2014-05-09 09:32:08 -0400] Malkav: Is it possible to edit visudo through Chef?
[2014-05-09 09:32:54 -0400] itwasntandy: Malkav: https://github.com/opscode-cookbooks/sudo
[2014-05-09 09:40:45 -0400] Bryn_: I still can't get chef ssh to work.
[2014-05-09 09:40:59 -0400] Bryn_: knife ssh name:webserver1 "ls" --attribute hostname works
[2014-05-09 09:41:07 -0400] Bryn_: as does knife ssh name:webserver1 "ls" --attribute fqdn
[2014-05-09 09:43:10 -0400] Bryn_: The strange thing is that if I get the node info via knife search it reports the IP address as the public IP of the box, which differs from the ipaddress attribute
[2014-05-09 09:46:30 -0400] srenatus: Bryn_: oh there might be some "clever" behaviour involved then... apparently, it uses public_ip4 ?
[2014-05-09 09:46:34 -0400] grahamlyons: Hello all.
[2014-05-09 09:46:44 -0400] grahamlyons: I'm looking at http://www.getchef.com/chef/install/ and there's an option to download an RPM.
[2014-05-09 09:47:03 -0400] grahamlyons: I also found this page - https://wiki.opscode.com/display/chef/Opscode+Yum+Repository+Excerpt - which has details of a yum repo.
[2014-05-09 09:47:25 -0400] grahamlyons: I used the yum repo but the package version isn't as new as the one available for download.
[2014-05-09 09:48:13 -0400] grahamlyons: I've also tried replacing the host for the yum repo with the S3 bucket that the download package comes from but it looks like that doesn't have any repo metadata and associated gubbins.
[2014-05-09 09:48:31 -0400] grahamlyons: So my question: is there an up to date yum repo for chef RPMs?
[2014-05-09 09:49:00 -0400] grahamlyons: btm, coderanger, jkeiser, jtimberman, juliancdunn, kallistec, schisamo ^^^
[2014-05-09 09:49:04 -0400] grahamlyons: Thanks!
[2014-05-09 09:49:08 -0400] epcim_: how to use chef search to discover deployed recipe? (I was about run_list:<cook book::recipe>) however my run_list contains only roles. Is there a way to search an "expanded" runlist?
[2014-05-09 09:49:17 -0400] NaTx: grahalyons: I prefer the omnibus package, since it's independent of your ruby installation
[2014-05-09 09:50:23 -0400] epcim_: grahamlyons: for client node or for workstation?
[2014-05-09 09:54:52 -0400] jonlives: epcim_: do you want to find out what recipes are running on a particular node, or what nodes are running a particular recipe?
[2014-05-09 09:55:56 -0400] epcim_: jonlives: nodes running particular recipe
[2014-05-09 09:56:44 -0400] jonlives: epcim_: you prob want to do knife search node 'recipes:apache\:\:default' - using recipes searches the expanded runlist.
[2014-05-09 09:56:52 -0400] jonlives: I also wrote https://github.com/jonlives/knife-preflight to do the same thing with less typing
[2014-05-09 09:57:09 -0400] epcim_: thanks, will check
[2014-05-09 09:57:23 -0400] jonlives: that search query won't pick up recipes included via "include_recipe" tho.
[2014-05-09 09:57:32 -0400] jonlives: because those don't show in the expanded run_list
[2014-05-09 09:59:04 -0400] epcim_: not my case, but worth to know
[2014-05-09 09:59:32 -0400] grahamlyons: epcim_: for client
[2014-05-09 09:59:39 -0400] Bryn_: srenatus: Yes it looks like it's picking it up from ec2.public_ipv4
[2014-05-09 09:59:51 -0400] oles: Hello! IS the chef-client version available in some special variable from the recipes or do i have to exech chef-client -v to obtain it ?
[2014-05-09 10:00:45 -0400] grahamlyons: NaTx: is the omnibus package the download one from getchef.com/...
[2014-05-09 10:00:46 -0400] grahamlyons: ?
[2014-05-09 10:01:29 -0400] epcim_: grahamlyons: btw, I have an issues with "search" functionality inside vagrant/kitchen provisioned box. The chef-zero returns 500. It was originally due the wrong search query, but even from cmdline "knife search "XYZ:xyz" -z -c client.rb; from /tmp/kitchen ... it returns only the node name - other attributes are empty..
[2014-05-09 10:02:06 -0400] epcim_: grahamlyons: Have you play with chef-zero or how to you test "search" in the development?
[2014-05-09 10:02:11 -0400] oles: The issue im trying to solve is that the chef-client version we run on most of our nodes is not compatible with the new ohai syntax, but all newly bootstrapped nodes requires the new syntax. So the idea is to serve old-syntax plugins to nodes with old chef-version and new syntax plugins to all other nodes
[2014-05-09 10:02:45 -0400] oles: Is there maybe a better way to solve that ?
[2014-05-09 10:02:55 -0400] grahamlyons: epcim_: no, I've not tried chef-zero - just figuring out a robust way to install the chef package(s).
[2014-05-09 10:03:04 -0400] jonlives: oles: I'd suggest updating the plugins, the switch isn't that hard.
[2014-05-09 10:03:17 -0400] NaTx: grahamlyons: I thin k you can get it from http://www.getchef.com/chef/install/
[2014-05-09 10:03:55 -0400] jonlives: oles: assuming by new format you mean ohai 7, I wrote this on the differences: http://programming.oreilly.com/2014/04/ohai-new-ohai-plugins.html
[2014-05-09 10:04:21 -0400] oles: jonlives: By upgrading the plugins you mean upgrading the chef-client ?
[2014-05-09 10:04:24 -0400] grahamlyons: NaTx: thanks. I was just wondering if that was available in a yum repo anywhere.
[2014-05-09 10:04:41 -0400] jonlives: oles: which ohai plugins are you having issues with, specifically?
[2014-05-09 10:04:57 -0400] oles: jonlives: custom ones
[2014-05-09 10:05:24 -0400] jonlives: oles: so I'd say you have two choices - install the older chef-client version on new nodes, or upgrade chef client everywhere and update the plugins.
[2014-05-09 10:05:52 -0400] oles: jonlives: Yeah, im going to upgrade all nodes eventually, i just wanted to have a fallback mechanism in place while doing it
[2014-05-09 10:06:09 -0400] NaTx: grahamlyons: are you installing a chef server or a node?
[2014-05-09 10:06:12 -0400] jonlives: oles: afaik the new version won't actually *break* old plugins, it will just warn that they are deprecated
[2014-05-09 10:06:24 -0400] jonlives: unless that's changed very recently.
[2014-05-09 10:07:38 -0400] oles: So I could probably distribute both old and new syntax plugins side by side and chef-client will use the appropriate one ?
[2014-05-09 10:07:51 -0400] oles: Then i could delete the old version plugins when all nodes is upgraded ?
[2014-05-09 10:08:28 -0400] jonlives: oles: as long as the plugin names don't clash, then yes.
[2014-05-09 10:08:33 -0400] oles: jonlives: Useful article btw, thanks :)
[2014-05-09 10:08:36 -0400] jonlives: np :)
[2014-05-09 10:09:51 -0400] jonlives: oles: confirmed - v6 plugins will just print a deprecation warning.
[2014-05-09 10:10:12 -0400] jonlives: oles: I'd actually recommend upgrading chef-client everywhere first, or at least the ohai gem, then update the plugins.
[2014-05-09 10:10:15 -0400] oles: jonlives: Nice, then i'll use that approach. Thank you very much :)
[2014-05-09 10:10:22 -0400] jonlives: np :)
[2014-05-09 10:11:48 -0400] oles: jonlives: Yeah, i probably should do that, but i suspect it to be a tendious task since there is a awful lots of nodes and someone might fail
[2014-05-09 10:12:34 -0400] jonlives: oles: good argument for having a good way to expose chef run failures ;)
[2014-05-09 10:12:53 -0400] oles: hehe, that's true
[2014-05-09 10:13:04 -0400] jonlives: oles: obligatory slides on how we do it at Etsy ;) http://www.slideshare.net/mcdonnps/lessons-from-etsy-avoiding-kitchen-nightmares-chefconf-2012
[2014-05-09 10:13:21 -0400] jonlives: and video for those slides: https://www.youtube.com/watch?v=nSnJCJiZDDU
[2014-05-09 10:13:47 -0400] oles: Nice, will read up
[2014-05-09 10:17:55 -0400] double_p: cant wrap my head around in postfix cookbook if i need additional entries in main.cf only if run_list contains opendkim
[2014-05-09 10:34:21 -0400] grahamlyons: NaTx: node.
[2014-05-09 10:34:29 -0400] grahamlyons: Server packages would be lovely too though!
[2014-05-09 10:36:34 -0400] NaTx: grahamlyons: ah, I'm not using RPM based distribution, but I preferred omnibus package, since deb mangles system rubyu install
[2014-05-09 10:38:22 -0400] grahamlyons: OK, thanks NaTx.
[2014-05-09 11:56:01 -0400] double_p: Option variables must be a kind of [Hash]!  You passed ["10.64.0.0/16", "10.65.0.0/16", "10.66.0.0/16"].
[2014-05-09 11:56:05 -0400] double_p: need-moar-ruby-skill
[2014-05-09 13:15:47 -0400] zeroXten: jtimberman: hi. May I pm regarding chef-vault?
[2014-05-09 13:28:36 -0400] CPS: has anyone been able to call a vbs script from chef? i'm getting a i/o error when trying to modify a service account
[2014-05-09 13:56:26 -0400] SkiOne: Hi, I am very new to Chef and I am taking over from another dev team that used it. I made some changes to a recipe and when I try to upload the cookbook I get an error that my client.pem key is missing. I get the same error when running kinfe client list. Do I need to download a starter kit for this? Won't that possibly break stuff?
[2014-05-09 14:04:20 -0400] mattray: SkiOne: you'll need to download your client.pem from the webUI
[2014-05-09 14:05:53 -0400] SkiOne: @mattray where do I get that?
[2014-05-09 14:06:23 -0400] SkiOne: is that in the starter kit?
[2014-05-09 14:06:41 -0400] mattray: SkiOne: dunno, I haven't done the starter in a few years
[2014-05-09 14:06:46 -0400] mattray: SkiOne: 1 sec
[2014-05-09 14:06:59 -0400] Shubby: it's in the starter kit but wouldn't getting the starter kit also reset the org validator key?
[2014-05-09 14:07:00 -0400] SkiOne: thanks
[2014-05-09 14:07:12 -0400] SkiOne: thats what I am afraid off
[2014-05-09 14:07:26 -0400] mattray: SkiOne: login to https://www.getchef.com/account/password
[2014-05-09 14:07:49 -0400] Shubby: I was in the same situation as you two months ago except I already had my client.pem, but not the validator.pem, I ended up "stealing" the validator.pem from an active Chef node
[2014-05-09 14:07:50 -0400] SkiOne: so this won't reset the validator key?
[2014-05-09 14:07:58 -0400] mattray: SkiOne: the link "Get a New Key" will get reset your personal key
[2014-05-09 14:08:26 -0400] mattray: Shubby: SkiOne: you need the organization key?
[2014-05-09 14:08:40 -0400] SkiOne: no I have that
[2014-05-09 14:09:04 -0400] mattray: SkiOne: then that first link will revoke and download you a new client.pem
[2014-05-09 14:09:07 -0400] Shubby: SkiOne: mattray's link above will sort you out
[2014-05-09 14:09:10 -0400] SkiOne: I believe this is another key, normally kept in /etc/chef
[2014-05-09 14:09:13 -0400] mattray: Shubby: https://manage.opscode.com/organizations
[2014-05-09 14:09:20 -0400] mattray: that'll get you your Org key
[2014-05-09 14:09:27 -0400] SkiOne: that sounds about right @mattray
[2014-05-09 14:09:36 -0400] mattray: good, hope you're sorted
[2014-05-09 14:09:49 -0400] SkiOne: I'll find out soon enough
[2014-05-09 14:09:50 -0400] Shubby: mattray: I sorted myself out with my org key a while back, but thanks :)
[2014-05-09 14:10:20 -0400] mattray: SkiOne: the /etc/chef/validation.pem is the organization pem installed on a client machine. You don't need to keep that after the node has bootstrapped
[2014-05-09 14:10:56 -0400] mattray: the org key let's you join the org and create your own client key
[2014-05-09 14:24:49 -0400] kallistec: grahamlyons: There's no actual yum repo yet, but that's being worked on. The omnibus packages are rpm/deb/etc. under the hood
[2014-05-09 14:25:39 -0400] kallistec: grahamlyons: I've seen people post examples of generating the yum metadata locally and have it point back to the S3 buckets to run a yum repo on top of that, but I don't have the links handy
[2014-05-09 14:32:50 -0400] heathsnow: Is there any cool tool (or methodology) to run only a subset of recipes on a node (and not it's full run_list)?  I know there's chef-apply...but I don't want to just run tests.  I'd like to speed up Chef runs by allowing users to only run the recipe they care about to speed things up.
[2014-05-09 14:34:59 -0400] heathsnow: the only thing I can think of is to put a boolean attribute wrapper around each cookbook that determines if action should be taken on the recipe or not.
[2014-05-09 14:35:27 -0400] heathsnow: seems like something like that would be built into Chef though
[2014-05-09 14:35:40 -0400] srenatus: heathsnow: chef-client -o only_run::this ?
[2014-05-09 14:36:07 -0400] srenatus: take care though, this won't do node.save even when successful
[2014-05-09 14:36:19 -0400] heathsnow: srenatus: I've never seen that...I'll give it a shot!
[2014-05-09 14:51:39 -0400] gyoza: irc
[2014-05-09 14:51:41 -0400] gyoza: hello
[2014-05-09 14:52:10 -0400] whiteadam: ohai
[2014-05-09 15:03:58 -0400] AskSteve: ohai2u
[2014-05-09 15:04:33 -0400] sauraus1: Good mornig
[2014-05-09 15:04:38 -0400] gyoza: yoyo
[2014-05-09 15:04:45 -0400] gyoza: ok
[2014-05-09 15:04:47 -0400] gyoza: ;(
[2014-05-09 15:05:01 -0400] sauraus: Back
[2014-05-09 15:05:17 -0400] sauraus: What's the best way to create a data bag in a recipe? Can it be done at all?
[2014-05-09 15:06:57 -0400] |rt|: I ran into an issue yesterday where chef was failing to run due to an issue with the /tmp filesystem.  It was reporting back a very strange error rather than a meaningful error like "Error creating temporary file."  Should I file a bug?
[2014-05-09 15:07:02 -0400] ssd7: ohai chefs
[2014-05-09 15:07:11 -0400] gyoza: can i see the log?
[2014-05-09 15:07:19 -0400] davidordave: @sauraus http://docs.opscode.com/essentials_data_bags.html#create-and-edit
[2014-05-09 15:07:19 -0400] gyoza: what happens if you try to go onto the system yourself and touch /tmp
[2014-05-09 15:07:25 -0400] gyoza: ?
[2014-05-09 15:07:30 -0400] gyoza: with the same user
[2014-05-09 15:07:40 -0400] |rt|: gyoza: it had too many links so the filesystem couldn't create any more files
[2014-05-09 15:07:49 -0400] gyoza: you mean inodes?
[2014-05-09 15:07:59 -0400] sauraus: @davidordave thanks!
[2014-05-09 15:08:32 -0400] |rt|: gyoza: it had inodes on the filesystem
[2014-05-09 15:08:45 -0400] davidordave: no problem :)
[2014-05-09 15:08:46 -0400] gyoza: i dont understand what you mean by too many links?
[2014-05-09 15:08:47 -0400] |rt|: gyoza: there are limits on the number of files/directories that can be in one directory as well
[2014-05-09 15:08:53 -0400] gyoza: oh wow
[2014-05-09 15:08:54 -0400] |rt|: http://pastebin.com/BDXtH0EZ
[2014-05-09 15:08:59 -0400] gyoza: can you change your ulimit?
[2014-05-09 15:09:02 -0400] gyoza: ulimit -a 2048
[2014-05-09 15:09:04 -0400] |rt|: that's the fun error that chef spit back out
[2014-05-09 15:09:06 -0400] gyoza: i think thats the command
[2014-05-09 15:09:14 -0400] gyoza: increases the amnount of open files on the system
[2014-05-09 15:09:17 -0400] gyoza: or is it just files period?
[2014-05-09 15:09:20 -0400] |rt|: gyoza: it had over 65k folders in the file sytem thanks to munin
[2014-05-09 15:09:24 -0400] gyoza: lol wow
[2014-05-09 15:09:28 -0400] |rt|: it's a filesystem limit
[2014-05-09 15:09:32 -0400] gyoza: hmmm
[2014-05-09 15:09:45 -0400] gyoza: da linux?
[2014-05-09 15:09:52 -0400] |rt|: ulimit are just kernel limits and wouldn't help in this case
[2014-05-09 15:10:09 -0400] |rt|: this is an older debian box I think it's running ext3 for tmp
[2014-05-09 15:10:09 -0400] gyoza: i mean i have some systems with more than 65k files on them
[2014-05-09 15:10:13 -0400] |rt|: let me verify that
[2014-05-09 15:10:16 -0400] jbz: df -i tells you the limit is hit?
[2014-05-09 15:10:28 -0400] gyoza: yea small files suck
[2014-05-09 15:10:29 -0400] |rt|: df -i looks at inodes on the filesystem
[2014-05-09 15:10:34 -0400] |rt|: not size of a directory
[2014-05-09 15:11:13 -0400] |rt|: I was able to delete the directories causing the issue once I figured out what the real problem was
[2014-05-09 15:11:25 -0400] gyoza: We are getting close to the 32k limit for number of files in a single folder on ext3 filesystem. W
[2014-05-09 15:11:25 -0400] gyoza: wow
[2014-05-09 15:11:27 -0400] gyoza: i did not know
[2014-05-09 15:11:29 -0400] gyoza: ^^^
[2014-05-09 15:11:34 -0400] gyoza: been doing this shit since 1993
[2014-05-09 15:11:34 -0400] gyoza: lol
[2014-05-09 15:11:53 -0400] |rt|: yeah it's ext3 on this system
[2014-05-09 15:11:54 -0400] gyoza: Surprised I never ran into that issue..
[2014-05-09 15:12:25 -0400] gyoza: you could always symlink
[2014-05-09 15:12:37 -0400] gyoza: or do not install in /tmp
[2014-05-09 15:12:49 -0400] gyoza: its ghetto
[2014-05-09 15:12:51 -0400] gyoza: but it will work
[2014-05-09 15:13:05 -0400] gyoza: i have a fondness in my heart for ghettosolutions
[2014-05-09 15:13:09 -0400] |rt|: yeah according to Wikipedia the limits on ext3 "A directory can have at most 31998 subdirectories, because an inode can have at most 32000 links."
[2014-05-09 15:13:18 -0400] gyoza: interesting
[2014-05-09 15:13:26 -0400] gyoza: well
[2014-05-09 15:13:29 -0400] gyoza: dd a new tmp drive
[2014-05-09 15:13:32 -0400] |rt|: gyoza: chef uses /tmp to stage cookbooks and render templates
[2014-05-09 15:13:38 -0400] gyoza: im sure you can change it no?
[2014-05-09 15:13:42 -0400] gyoza: you can change nearly everything else
[2014-05-09 15:14:00 -0400] |rt|: maybe there's a setting in client.rb that can be tweaked
[2014-05-09 15:14:12 -0400] |rt|: but /tmp is fine....this shouldn't be an issue on a healthy system
[2014-05-09 15:14:23 -0400] |rt|: munin was doing something weird on this system
[2014-05-09 15:15:37 -0400] jbz: |rt|: you can use file_staging_uses_dstdir
[2014-05-09 15:15:42 -0400] jbz: er, destdir
[2014-05-09 15:15:46 -0400] jbz: in client.rb
[2014-05-09 15:15:54 -0400] jbz: that tells the client to use the final destination for staging/temp files
[2014-05-09 15:15:58 -0400] jbz: (final destination dir)
[2014-05-09 15:15:59 -0400] |rt|: sudo find /tmp/ -type d -user nobody -group munin | wc -l
[2014-05-09 15:15:59 -0400] |rt|: 224
[2014-05-09 15:16:01 -0400] jbz: rather than /tmp
[2014-05-09 15:16:11 -0400] jbz: OR, I think, you can set the temp location in env
[2014-05-09 15:16:11 -0400] |rt|: munin is already racking up new directories in tmp
[2014-05-09 15:16:41 -0400] |rt|: I think I'll just fix munin...probably removing it as we have switched metric collection over to collectd
[2014-05-09 15:18:28 -0400] |rt|: jbz: good to know
[2014-05-09 15:21:29 -0400] gyoza: even though i specified 10 in the version..
[2014-05-09 15:21:30 -0400] gyoza: anybody know why?
[2014-05-09 15:21:42 -0400] gyoza: had to use the --prerelease flag
[2014-05-09 15:21:48 -0400] gyoza: on the Amazon linux ami..
[2014-05-09 15:32:39 -0400] brian_dupras_: @jkeiser check out our first cut at a chef-metal-vsphere provisioner - https://github.com/RallySoftware-cookbooks/chef-metal-vsphere.
[2014-05-09 15:34:32 -0400] stormerider: is there a way like, if you're writing to a template file, that you can tell Chef not to show the diff for that resource?
[2014-05-09 15:36:02 -0400] jkeiser: brian_dupras_: awesome! I noticed on twitter when you published last night :)
[2014-05-09 15:36:47 -0400] jkeiser: brian_dupras_: one suggestion: wrap the perform_action(start_vm) in an if statement that checks whether the vm needs to be started
[2014-05-09 15:37:21 -0400] jkeiser: brian_dupras_: the effect of the current code is, Chef will think the machine was updated every single time it runs (even though you don't actually do anything) an little green text is printed saying you are starting the VM
[2014-05-09 15:37:22 -0400] brian_dupras_: jkeiser: cool - I will do that
[2014-05-09 15:37:35 -0400] jkeiser: brian_dupras_: so the user will think that you are actually taking an action, when you aren't really
[2014-05-09 15:37:39 -0400] jkeiser: brian_dupras_: I love it :)
[2014-05-09 15:37:57 -0400] brian_dupras_: jkeiser: it was super easy to make the provisioner - nice framework
[2014-05-09 15:38:15 -0400] double_p: hm, ohai cannot determine the hostname on one machine. almost(heh) the same installation on a second box works
[2014-05-09 15:38:31 -0400] jkeiser: brian_dupras_: warning: I am changing the driver interface in a major way for the first (and hopefully last) time in 0.11.  Internals won't have to change much, and a lot of stuff will get easier, but method names and parameters will change
[2014-05-09 15:38:43 -0400] jkeiser: brian_dupras_: I will reach out to you when I've got it in a prerelease
[2014-05-09 15:39:19 -0400] brian_dupras_: jkeiser: np - thanks
[2014-05-09 15:40:01 -0400] jkeiser: brian_dupras_: the changes are (a) to make it so drivers can be easily reused by test-kitchen and other non-chef clients; (b) to make it a little easier to parallelize; and (c) to make configuration and credentials a lot saner and more obvious
[2014-05-09 15:40:10 -0400] double_p: http://pastie.org/9159643
[2014-05-09 15:40:41 -0400] jkeiser: I'm also making some stuff easier (I hated typing node['normal']['provisioner_options'] and such all the time)
[2014-05-09 15:41:14 -0400] sauraus: How do I create/update an encrypted data bag from a recipe? I only found info on how to decode data in an encrypted data bag
[2014-05-09 15:41:31 -0400] canada_chef: Hey everyone. I have a quick question about attribute precedence in Chef:
[2014-05-09 15:44:11 -0400] canada_chef: I'm including the Chef Postgresql cookbook (https://github.com/hw-cookbooks/postgresql/tree/v3.3.4) in one of my own cookbooks, but when trying to override the Postgresql version attribute nothing I do seems to work. I set node['postgresql']['version'] to "9.3" in my own cookbook (either directly, or by using override / normal attributes), but it always installs Postgresql 9.1 instead. Is there something I'm missing?
[2014-05-09 15:47:35 -0400] double_p: ok.. foobar in /etc/hosts :(
[2014-05-09 15:51:06 -0400] Tricon: Is there a good pattern or cookbook for ensuring PATH order? I'm using magic_shell to amend the PATH env, but it is applied too early.
[2014-05-09 15:53:57 -0400] sauraus: Anyone got an idea how to create an encrypted data bag from a recipe?
[2014-05-09 15:55:13 -0400] zanshin: So I have an application cookbook, foo, that is deploying the app to Nginx. I've got a LWRP on my Nginx cookbook that will put the site config in site-available. How do I collect the file from foo and pass it to the lwrp? Wrap the lwrp call inside a cookbook_file resource?
[2014-05-09 16:00:01 -0400] drywheat_: should Chef roles be based on a specific technology or a concept?
[2014-05-09 16:00:25 -0400] drywheat_: i.e. should a role be called 'haproxy' or 'load-balancer'?
[2014-05-09 16:01:06 -0400] Tricon: drywheat_: I think that's fine.
[2014-05-09 16:01:32 -0400] zanshin: drywheat_ I'd go with concept, that way when the underlying implementation changes, the name will still work.
[2014-05-09 16:01:49 -0400] drywheat_: Tricon: which one? the technology or the purpose?
[2014-05-09 16:01:59 -0400] drywheat_: zanshin: that's the feeling i had
[2014-05-09 16:02:01 -0400] Tricon: drywheat_: What zanshin said.
[2014-05-09 16:03:30 -0400] drywheat: thanks guys
[2014-05-09 16:29:24 -0400] mjuszczak: Roles and Environments in .rb or .json?
[2014-05-09 16:29:57 -0400] grahamlyons: Thanks kallistec; do you know when there's likely to be a yum repo?
[2014-05-09 16:34:10 -0400] cbarraford: is it possible to share a node attribute within chef? Maybe thats a data bag, but if it is, can a recipe update/change a data bag?
[2014-05-09 16:35:15 -0400] cbarraford: found my answer here
[2014-05-09 16:35:16 -0400] cbarraford: http://docs.opscode.com/essentials_data_bags.html
[2014-05-09 16:36:24 -0400] mjuszczak: The only way you can do knife download and knife upload is if your roles and environments are in .json format, right?
[2014-05-09 16:36:32 -0400] jkeiser: correct
[2014-05-09 16:37:19 -0400] mjuszczak: jkeiser: If I'm using the berkshelf method where I'm not really putting anything inside environments and roles anyway, any negatives to using .json?
[2014-05-09 16:37:57 -0400] jkeiser: no negatives to json unless you are trying to run code in there
[2014-05-09 17:30:01 -0400] gyoza: this users cookbook is pissing me offfff
[2014-05-09 17:30:02 -0400] gyoza: lol
[2014-05-09 17:30:07 -0400] tera_robb: i'm having trouble mounting a share in windows. wondering if anyone has run into this?
[2014-05-09 17:30:17 -0400] tera_robb: i have mount "M:" do as shown in the docs
[2014-05-09 17:30:31 -0400] tera_robb: but it returns FATAL: ArgumentError: mount[M:] (cookbook::recipe line 12) had an error: ArgumentError: The parameter is incorrect.
[2014-05-09 17:31:05 -0400] gyoza: what is line 12?
[2014-05-09 17:31:12 -0400] tera_robb: mount "M:" do
[2014-05-09 17:31:16 -0400] gyoza: hmm
[2014-05-09 17:31:32 -0400] gyoza: have you tried without a colon?
[2014-05-09 17:31:46 -0400] tera_robb: i haven't.. jus a sec
[2014-05-09 17:32:49 -0400] tera_robb: same deal  -- FATAL: ArgumentError: mount[M]
[2014-05-09 17:32:55 -0400] gyoza: hmm
[2014-05-09 17:33:27 -0400] gyoza: oh i see
[2014-05-09 17:33:29 -0400] gyoza: im looking at the cookbook
[2014-05-09 17:33:47 -0400] gyoza: what happens if you try like
[2014-05-09 17:33:48 -0400] gyoza: A:
[2014-05-09 17:34:14 -0400] double_p: .oo( chrrrrrk-zonk )
[2014-05-09 17:34:17 -0400] gyoza: also maybe M: is mounted already?
[2014-05-09 17:34:53 -0400] tera_robb: nope, same result with A:
[2014-05-09 17:35:06 -0400] tera_robb: The client only has C: J: and S:  so far
[2014-05-09 17:40:46 -0400] Shubby: does the service account under which Chef is running have permissions to the share you're trying to mount?
[2014-05-09 17:41:21 -0400] Shubby: (note I've never run into this and I've never even used Chef in Windows but I used to work in Windows Server administration)
[2014-05-09 17:43:07 -0400] tera_robb: ah.. i'll check that shubby, thx
[2014-05-09 17:44:33 -0400] CPS: is it possible to have bootstrap place the secret keyfile for encypted data bags on a node?
[2014-05-09 17:46:22 -0400] Shubby: CPS: yes, just add --secret-file <path to your keyfile> to the bootstrap command
[2014-05-09 17:46:38 -0400] jperry: anyone have a suggestion on how best to use berkshelf in a single large repo of cookbooks where community versions are not checked in
[2014-05-09 17:46:45 -0400] Shubby: e.g. --secret-file .chef/encrypted_data_bag_secret
[2014-05-09 17:46:55 -0400] CPS: does that just set the config field or also put the file there?
[2014-05-09 17:47:01 -0400] Shubby: it does both
[2014-05-09 17:47:05 -0400] CPS: neat
[2014-05-09 17:47:07 -0400] tera_robb: it works when i issue a "net use" command, i guess i'll just do it that way..
[2014-05-09 17:47:32 -0400] Shubby: tera_robb: and you're issuing that net use command while logged in as the same account as Chef runs under?
[2014-05-09 17:48:58 -0400] double_p: CPS: *mumble* http://pastie.org/private/davuyqcetawp4kbsbt3gzw
[2014-05-09 17:49:18 -0400] tera_robb: shubby: yeah, i just changed mount "m:" do to execute "Mount" do and put the net use command there.
[2014-05-09 17:49:44 -0400] Shubby: that's odd
[2014-05-09 17:49:56 -0400] CPS: double_p: what am i looking at?
[2014-05-09 17:50:03 -0400] Shubby: well I guess I don't know if it is odd since I've never done this myself
[2014-05-09 17:50:19 -0400] double_p: CPS: that's how we 'seed' keys
[2014-05-09 18:31:15 -0400] jstarcher: Is there a way to create a chef organization via a REST API call?
[2014-05-09 18:44:34 -0400] mjuszczak: coderanger: quick question on berks.  If I have a custom chef-cookbook called chef-blah, and in metadata.rb require chef-hoarf as a dependency, and have the location of chef-hoarf inside Berksfile (since it's public), it works fine... unless chef-hoarf has dependencies listed in its Berksfile. Those don't get resolved.  Is dependency tracking not recursive with Berkshelf?
[2014-05-09 18:47:58 -0400] sauraus: I am trying to load  secret = Chef::EncryptedDataBagItem.load_secret("#{node['secrets']}") but the file is created by a recipe in the current run_list this fails because at compile time the file doesn't exist, how do I work around this?
[2014-05-09 18:54:06 -0400] doomviking: This cookbook makes your favorite breakfast sandwich.
[2014-05-09 19:14:26 -0400] coderanger: mjuszczak: That is correct
[2014-05-09 19:14:41 -0400] coderanger: mjuszczak: metadata.rb vs berksfile works just like gemspec/gemfile or setup.py/requirements.txt
[2014-05-09 19:14:56 -0400] coderanger: mjuszczak: Use a chef server as your release point
[2014-05-09 19:23:22 -0400] Shubby: has anyone used Chef to install git and use that to clone a private repo onto the node? I'm trying to automate a server build and one of the last steps is for me to go grab the website content from the private GH repo and dump it where Nginx expects it... my problem seems to be that I can't even authenticate the node to GitHub.com, in fact I can't even clone the repo manually via shell at this point, even though I have a login and password of an a
[2014-05-09 19:23:23 -0400] Shubby: ccount that has access to the repo
[2014-05-09 19:24:29 -0400] mjuszczak: coderanger: That's interesting.  So the Berksfile of the application cookbook will need to include the locations of the contents of the Berksfiles of all dependent cookbooks?
[2014-05-09 19:24:50 -0400] coderanger: If you are using git-driven locations, yes, which is why you shouldn't :-)
[2014-05-09 19:25:09 -0400] c_t: Shubby: sounds like an ssh key problem maybe
[2014-05-09 19:25:13 -0400] jchauncey: berks upload if your friend
[2014-05-09 19:25:24 -0400] alexbst: my friend is true
[2014-05-09 19:25:37 -0400] Shubby: c_t: actually I'm trying to authenticate via HTTPS but I've never done that successfully, perhaps that's my problem
[2014-05-09 19:25:43 -0400] mjuszczak: coderanger: What are the alternatives to git driven locations?
[2014-05-09 19:25:47 -0400] Shubby: I did ask my coworker for the private key attached to that account so perhaps that would help
[2014-05-09 19:26:27 -0400] coderanger: mjuszczak: Use a chef server as an artifact (cookbook) release site
[2014-05-09 19:26:31 -0400] grubernaut: What does everyone else use to provision chef-nodes quickly in production? We currently use libvirt (without chef) and it's terribly slow and requires a lot of hands-on work. I'm opposed to containers at this point as it is in production, and I would be doing everything in LInux.
[2014-05-09 19:26:53 -0400] coderanger: grubernaut: You have a lot of options depending on how crazy you are
[2014-05-09 19:26:59 -0400] coderanger: grubernaut: and what cloud tech you use
[2014-05-09 19:27:26 -0400] mjuszczak: coderanger: So that it pulls in the cookbooks from chef server instead of git?
[2014-05-09 19:27:27 -0400] coderanger: grubernaut: OpenStack Nova supports LXC, Mesos, Docker (note: not production ready), CloudFomration, Heat, etc
[2014-05-09 19:27:28 -0400] grubernaut: coderanger:  no cloud. Currenlty two local hypervisors (libvirt and QEMU).
[2014-05-09 19:27:34 -0400] Neozonz: if i create an attribute called node[:apache][:keepalive] = "On" in a recipe that runs after the initial apache recipe, will that override the default value of keepalive? or will it be too late?
[2014-05-09 19:27:35 -0400] mjuszczak: when you're testing locally?
[2014-05-09 19:27:46 -0400] coderanger: mjuszczak: Yep
[2014-05-09 19:27:56 -0400] coderanger: mjuszczak: The chef-server is like a package server
[2014-05-09 19:28:21 -0400] grubernaut: coderanger:  would prefer to stay away from containers as it is production and keep it with vms so we have persistent disk images should something really go wrong we can recover
[2014-05-09 19:28:36 -0400] Neozonz: it's using the following cookbooks https://github.com/aws/opsworks-cookbooks/tree/release-chef-11.4/apache2
[2014-05-09 19:28:42 -0400] Neozonz: (pretty much aws opsworks)
[2014-05-09 19:28:54 -0400] coderanger: grubernaut: Then nova is pretty much the best you can do, but thats not saying much
[2014-05-09 19:29:22 -0400] coderanger: Neozonz: How are you setting that attribute?
[2014-05-09 19:30:43 -0400] grubernaut: coderanger:  would nova be using chef to automate the vm build process then? Also, if anyone hosts their own chef server, is it ran on bare-metal, in a VM, or managed by chef-solo?
[2014-05-09 19:31:18 -0400] coderanger: grubernaut: Not sure what you mean, chef itself isn't a provisioning system, chef-metal is but its not nearly ready for prod use
[2014-05-09 19:31:27 -0400] Neozonz: coderanger in an attribute file
[2014-05-09 19:31:38 -0400] Neozonz: not in the apache cookbook, but in another custom cookbook i have
[2014-05-09 19:31:49 -0400] Neozonz: *recipe
[2014-05-09 19:32:07 -0400] coderanger: Neozonz: You want override[], not node, but yes, that will work
[2014-05-09 19:32:17 -0400] grubernaut: coderanger:  ah, gotcha. so, what does everyone else use as a provisioning system for prod?
[2014-05-09 19:32:19 -0400] Neozonz: oh so no matter where you specify it will work?
[2014-05-09 19:32:29 -0400] coderanger: grubernaut: Vast majority of people do it by hand
[2014-05-09 19:32:29 -0400] Neozonz: does chef work like this, parses all json then does a deploy?
[2014-05-09 19:32:37 -0400] Neozonz: or is it sequencial
[2014-05-09 19:32:43 -0400] Neozonz: by when the recipe is called
[2014-05-09 19:32:44 -0400] mjuszczak: coderanger: I'm still kind of confused.  How would that help with a local kitchen test when we're trying to test new versions of dependencies?
[2014-05-09 19:32:48 -0400] coderanger: grubernaut: If you aren't using AWS, your options are pretty much Heat+OpenStack or Mesos
[2014-05-09 19:33:16 -0400] coderanger: mjuszczak: When testing locally you would re-add the git source, or path source
[2014-05-09 19:33:31 -0400] coderanger: Neozonz: All attribute files are run before it starts on the recipe code
[2014-05-09 19:33:41 -0400] Neozonz: oh sweet
[2014-05-09 19:33:57 -0400] Neozonz: its not per recipe but rather globally?
[2014-05-09 19:34:12 -0400] Neozonz: so all attributes shoved into a big json that gets parsed for the recipes
[2014-05-09 19:34:55 -0400] coderanger: Neozonz: yep
[2014-05-09 19:35:01 -0400] Neozonz: cool thanks
[2014-05-09 19:35:10 -0400] Neozonz: helps while i code these things, now i'll understand more :D
[2014-05-09 19:35:22 -0400] coderanger: Neozonz: First it loads roles/envs, then all attributes files, then recipes as specified by the expanded run list
[2014-05-09 19:35:40 -0400] Neozonz: sweet thanks
[2014-05-09 19:35:55 -0400] grubernaut: coderanger:  ty for the help as well
[2014-05-09 19:38:19 -0400] Shubby: Neozonz: if you run: $ knife node show -Fj -l <your_node_name>
[2014-05-09 19:38:27 -0400] Shubby: you can actually see the resulting json
[2014-05-09 19:38:40 -0400] Neozonz: ah cool
[2014-05-09 19:38:43 -0400] Neozonz: very good to know
[2014-05-09 19:38:49 -0400] Shubby: it's a lot of text so you might want to add >> output.txt
[2014-05-09 19:38:52 -0400] Neozonz: how does one do that on an aws instance from opsworks?
[2014-05-09 19:39:23 -0400] Shubby: good question, no clue
[2014-05-09 19:39:23 -0400] Shubby: :)
[2014-05-09 19:39:27 -0400] Shubby: I haven't used Opsworks yet
[2014-05-09 19:55:22 -0400] mjuszczak: if each cookbook has a Berksfile, then how does one do berks upload when the .chef is in the main chef repo?
[2014-05-09 19:56:30 -0400] coderanger: mjuszczak: I symlink it one folder down, ln -s chef/.chef
[2014-05-09 19:57:49 -0400] coderanger: Neozonz: You can't do that in Opsworks, they don't store that data
[2014-05-09 19:58:00 -0400] mmzyk: Its late on a Friday on the east coast, so now is a good time to announce that an RC is available for the open source chef server 11.1.0 release right?
[2014-05-09 19:58:02 -0400] mjuszczak: so it's in your home dir?
[2014-05-09 19:58:10 -0400] coderanger: mmzyk: :-)
[2014-05-09 19:58:19 -0400] mjuszczak: $HOME/.chef -> $HOME/chef/.chef?
[2014-05-09 19:58:22 -0400] coderanger: mjuszczak: Well in my case thats ~/src/<company name>
[2014-05-09 19:58:33 -0400] mjuszczak: but where are you doing the berks upload from?
[2014-05-09 19:58:34 -0400] coderanger: mjuszczak: But I have a lot of chef configs floating around :)
[2014-05-09 19:58:39 -0400] coderanger: mjuszczak: The cookbook folder
[2014-05-09 19:58:39 -0400] c_t: mmzyk: what could possibly go wrong?
[2014-05-09 19:58:51 -0400] mjuszczak: coderanger: But don't you have a bunch of different application cookbooks living in different repos?
[2014-05-09 19:59:04 -0400] mmzyk: Well, its just an RC, and it is ready. You can use the omnitruck api to download it.
[2014-05-09 19:59:09 -0400] mmzyk: A blog post should go up shortly.
[2014-05-09 19:59:09 -0400] coderanger: mjuszczak: Yep, they are all in subfolders like ~/src/<companyname>/<cookbookname>
[2014-05-09 19:59:19 -0400] mmzyk: The actual release will go out next week.
[2014-05-09 19:59:31 -0400] c_t: list o' changes the same as before?
[2014-05-09 19:59:33 -0400] mmzyk: I wouldnt do a release on Friday, but Im not as hesitant about an RC
[2014-05-09 19:59:57 -0400] mjuszczak: coderanger: if I go into ~/src/companyname/cookbookname and do berks upload, it can't find my .chef, because that's in ~/src/companymame/chef-repo
[2014-05-09 20:00:08 -0400] coderanger: mjuszczak: Right, hence the symlink
[2014-05-09 20:00:13 -0400] mmzyk: c_t yeah, weve just been bug fixing. Fixed the latest Rails CVE as well. https://github.com/opscode/omnibus-chef-server/blob/master/CHANGELOG.md
[2014-05-09 20:00:22 -0400] coderanger: I have a ~/src/name/.chef -> ~/src/name/chef/.chef
[2014-05-09 20:00:25 -0400] mmzyk: changelog has been cleaned up, clarified some more.
[2014-05-09 20:00:35 -0400] mjuszczak: coderanger: Does berks look for a .chef in the parent dir?
[2014-05-09 20:00:41 -0400] mmzyk: Relase notes are here: http://docs.opscode.com/release/osc_11-1/release_notes.html
[2014-05-09 20:00:55 -0400] coderanger: mjuszczak: Yes, same rules as knife, it scans up the whole tree
[2014-05-09 20:00:59 -0400] mmzyk: but they mostly say the same as what is in the change log. Were working on getting the docs cleaned up.
[2014-05-09 20:01:01 -0400] mjuszczak: Great thank you!
[2014-05-09 20:01:45 -0400] c_t: mmzyk: yeah, looks pretty much the same
[2014-05-09 20:02:12 -0400] c_t: you inspired me before to go and make the goiardi ipv6 support a bit more robust
[2014-05-09 20:02:14 -0400] mmzyk: yeah, no major feature changes since I last talked about this, c_t
[2014-05-09 20:02:28 -0400] c_t: it worked, but more accidentally than anything
[2014-05-09 20:04:10 -0400] mjuszczak: coderanger: http://pastebin.com/6rJKKJK4  <-- that makes no sense
[2014-05-09 20:04:38 -0400] coderanger: mjuszczak: What version of berkshelf
[2014-05-09 20:04:46 -0400] mjuszczak: 3
[2014-05-09 20:04:55 -0400] coderanger: Check that its the latest
[2014-05-09 20:05:03 -0400] mjuszczak: 3.1.2
[2014-05-09 20:05:23 -0400] coderanger: Okay, it is
[2014-05-09 20:06:05 -0400] coderanger: mjuszczak: I would jump in #berkshelf and show it to ivey and/or reset
[2014-05-09 20:06:05 -0400] spheromak: mmzyk: nice gecode solver.
[2014-05-09 20:06:11 -0400] spheromak: finally!
[2014-05-09 20:06:31 -0400] mmzyk: more like finally moving back to it, but yeah, spheromak.
[2014-05-09 20:06:43 -0400] mmzyk: Sorry abou tthe delay in getting here.
[2014-05-09 20:06:48 -0400] mjuszczak: OK, thank ya
[2014-05-09 20:06:51 -0400] spheromak: yea i reported that terrible non terminating solve mmzyk
[2014-05-09 20:06:57 -0400] spheromak: when 11 came out
[2014-05-09 20:07:31 -0400] mjuszczak: coderanger: I'm still kind of confused as to why subsequent Berkfiles aren't processed.  That's expected behavior?
[2014-05-09 20:07:36 -0400] spheromak: mmzyk: don't have to apologize. I am happy theres a non nightly with a fix
[2014-05-09 20:08:06 -0400] coderanger: mjuszczak: Yes, that is expected and correct
[2014-05-09 20:08:19 -0400] coderanger: mjuszczak: berkshelf only knows about cookbooks, not other berksfiles
[2014-05-09 20:08:57 -0400] mjuszczak: So I don't have to put the sub-dependent cookbooks in metadata.rb, but I do need to put them in the application cookbook's Berksfile
[2014-05-09 20:08:59 -0400] mmzyk: All right, a blog post is now up with RC details: http://www.getchef.com/blog/2014/05/09/release-candidate-for-open-source-chef-server-11-1-0/
[2014-05-09 20:10:30 -0400] coderanger: mjuszczak: No, you should be putting them nowhere but metadata.rb
[2014-05-09 20:10:34 -0400] coderanger: (normally)
[2014-05-09 20:10:47 -0400] mjuszczak: So I shouldn't even have a Berksfile?  Or it should be mostly empty
[2014-05-09 20:11:08 -0400] coderanger: Yep, mine are two lines other than the license header and test stuff
[2014-05-09 20:11:37 -0400] coderanger: ex. https://github.com/balanced-cookbooks/rundeck/blob/master/Berksfile
[2014-05-09 20:18:31 -0400] mjuszczak: coderanger: So you're saying if I make a cookbook that requires other cookbooks that are in git only, I should go into those cookbooks and berks install/upload them ahead of time (so they exist locally and on the server), and then other cookbooks that depend on those cookbooks will just work because they'll be installed already?
[2014-05-09 20:18:57 -0400] coderanger: mjuszczak: Yes
[2014-05-09 20:19:09 -0400] coderanger: mjuszczak: Same way you handle any vendored package system
[2014-05-09 20:24:04 -0400] mjuszczak: coderanger: got it.  So *no* berksfiles will have git references.  Not even when it's one level deep.
[2014-05-09 20:24:29 -0400] mjuszczak: if I have a cookbook that depends on another cookbook in git, I just berks install/upload the first cookbook and forget about the reference in git in general.  Gotcha.
[2014-05-09 20:24:36 -0400] mjuszczak: http://pastebin.com/YVXNdrX3 <-- now I'm even worse off :(
[2014-05-09 20:24:38 -0400] coderanger: mjuszczak: So it depends on how you want to pull them in initially, the easiest way to handle that, if somewhat imprecise, is that at the very edge of the graph you'll have the git ref
[2014-05-09 20:28:37 -0400] mjuszczak: coderanger: but why even reference them in a Berksfile at all?
[2014-05-09 20:29:21 -0400] coderanger: mjuszczak: You need to get the external cookbook in to the system somehow, either by uploading it manually or via a berks upload at some point
[2014-05-09 20:33:12 -0400] mjuszczak: coderanger: right, but since berks upload only goes one level deep (IE: it won't interpret the Berksfile of a dependency cookbook), might it make sense to just berks upload/install cookbooks on an individual basis?  If berks install isn't recursive what's the point?
[2014-05-09 20:33:35 -0400] coderanger: mjuszczak: I don't follow you, it is recursive _for cookbooks_
[2014-05-09 20:34:50 -0400] mjuszczak: coderanger: So I have github.com/blah/cookbook1.git which depends on github.com/blah/cookbook2.git. Inside cookbook2.git I have a Berksfile that references github.com/blah/cookbook3.git.  If I berks install on a checkout of cookbook1, it'll fetch cookbook2 and install it, but not cookbook3
[2014-05-09 20:35:13 -0400] coderanger: mjuszczak: Cookbooks _can't_ depend on something from git
[2014-05-09 20:35:19 -0400] coderanger: they only depend on a name
[2014-05-09 20:35:46 -0400] mjuszczak: gotcha, totally understood.
[2014-05-09 20:35:59 -0400] mjuszczak: So I'm saying, is there ever a reason to put a reference to something in git inside a Berksfile?
[2014-05-09 20:36:01 -0400] coderanger: By default, berks install will try to find that name using the berks-api server you have it pointed at
[2014-05-09 20:36:11 -0400] coderanger: you can override it with a git source though
[2014-05-09 20:36:41 -0400] mjuszczak: Right.  Which means I either need to put every github-hosted cookbook in every Berksfile in each of my application cookbooks or try another way.
[2014-05-09 20:36:43 -0400] coderanger: so if you have cookbook1, 2, and 3 internally thats fine and they all just refer to each other symbolically and can find each other because they are all uploaded to the chef-server
[2014-05-09 20:36:57 -0400] mjuszczak: coderanger: More talking local development here.  berks install and then kitchen test.
[2014-05-09 20:37:16 -0400] coderanger: mjuszczak: Doesn't matter, you still get your dependencies from the chef-server, even for local dev
[2014-05-09 20:37:30 -0400] sauraus: Hi coderanger, got a question for you. How can I 'delay' the compilation of this code: secret = Chef::EncryptedDataBagItem.load_secret("#{node['secrets']}"). The file path which node['secrets'] contains doesn't exist when the recipes are compiled as it will be created by a recipe earlier in the run_list
[2014-05-09 20:37:39 -0400] coderanger: If you need to override things when developing related cookbooks, use a path source
[2014-05-09 20:37:58 -0400] coderanger: sauraus: Are you attempting to distribute your encryption key via chef?
[2014-05-09 20:39:21 -0400] mmzyk: All right, b/c we figured most of you are lazy, the blog post for the RC has been updated with direct links for the download for the major platforms: http://www.getchef.com/blog/2014/05/09/release-candidate-for-open-source-chef-server-11-1-0/
[2014-05-09 20:39:53 -0400] sauraus: I am using chef to distribute the key used to encrypt my data bags
[2014-05-09 20:39:55 -0400] mjuszczak: coderanger: OK.  So if I do a berks upload on a cookbook, it'll upload that cookbooks dependencies to the chef-server, but not the cookbook's cookbook's git dependencies... so really, I need to run a berks upload on each cookbook individually to always make sure I Hace everything I need on the chef server IF I'm using custom git repos.
[2014-05-09 20:40:37 -0400] coderanger: sauraus: Don't, that entirely defeats the point
[2014-05-09 20:40:49 -0400] sauraus: @mjuszczak no you don't :) you can do something like this in your Berksfile:
[2014-05-09 20:40:50 -0400] coderanger: mmzyk: Can haz apt repo yet? :D
[2014-05-09 20:40:51 -0400] sauraus: cookbook 'perforce', git: 'https://github.com/sauraus/perforce-cookbook.git'
[2014-05-09 20:41:14 -0400] mmzyk: coderanger I think thats in the works, but obviously not for this release.
[2014-05-09 20:41:15 -0400] coderanger: mjuszczak: No, it will upload every cookbook in the recursive expansion of the berksfile
[2014-05-09 20:41:42 -0400] coderanger: mjuszczak: The "metadata" line brings in all deps from the metadata.rb, but cookbook lines with an explicit source come too
[2014-05-09 20:41:58 -0400] coderanger: mmzyk: I know, just being flippant :)
[2014-05-09 20:42:22 -0400] mmzyk: coderanger I figured. :) Its something I don t know the timeline on though.
[2014-05-09 20:42:52 -0400] coderanger: mmzyk: If someone wants me to show them how to do it, I can get y'all setup in about 20m
[2014-05-09 20:44:51 -0400] coderanger: sauraus: So the only security gains you get from encrypted data bags are that if the chef-server DB is compromised, your data isn't. If your key is inside chef, that is no longer the case
[2014-05-09 20:45:13 -0400] coderanger: sauraus: The encrypted bags system punts on key management and makes it your problem out-of-band
[2014-05-09 20:45:32 -0400] mjuszczak: coderanger: OK, that's not what I'm seeing. I'll just use a real world example.  I have a cookbook called <org>-base which includes all dependencies in a metadata.rb references by name only, and a Berksfile which contains three references to cookbooks appearing in <org>'s github repo which aren't public modules.  When I go into <org>-base and run kitchen test/berks install/berks upload, life is good.  However, when I have another cookbook called chef
[2014-05-09 20:46:20 -0400] mjuszczak: Is it to never reference things that only live in git in Berksfiles in general? And just force folks to do a berks install/upload whenever they make a new version of a cookbook?  I just wish there was an easy way to do this without chef server being in the picture at all.
[2014-05-09 20:46:45 -0400] coderanger: mjuszczak: I think your confusion may be that you think Berksfile is a place to put dependencies
[2014-05-09 20:47:02 -0400] coderanger: Things in the berksfile are not deps
[2014-05-09 20:47:18 -0400] mjuszczak: they're overwritten locations for dependencies, right?
[2014-05-09 20:47:38 -0400] coderanger: Not really, more like explicit things to install
[2014-05-09 20:47:42 -0400] mjuszczak: ah
[2014-05-09 20:47:50 -0400] mjuszczak: but that only works on one level, not recursively.
[2014-05-09 20:48:12 -0400] coderanger: Indeed, since berks only recursively expands dependencies
[2014-05-09 20:48:20 -0400] mjuszczak: Gotcha.
[2014-05-09 20:48:46 -0400] coderanger: The working set of cookbooks is everything listed in the berksfile and all of their dependencies recursively
[2014-05-09 20:56:25 -0400] mjuszczak: So I guess I'm just asking for an optimal workflow.  If referencing a cookbook in a Berksfile that lives in git will only work for that specific cookbook, then a berks install is not always guaranteed to work.  Neither is a berksupload.  So if that's the case, it either only makes sense to put every github-hosted cookbook in every application cookbook's Berksfile so that if someone does a berks upload or berks install, it's guaranteed to work, OR to 
[2014-05-09 20:56:49 -0400] coderanger: mjuszczak: Okay, to make this clearer, none of your cookbooks will be "github hosted"
[2014-05-09 20:56:56 -0400] coderanger: Thats just not a thing you should ever do
[2014-05-09 20:57:01 -0400] _aeris_: ohai #chef :)
[2014-05-09 20:57:04 -0400] coderanger: Released cookbooks live in a chef-server
[2014-05-09 20:57:14 -0400] coderanger: even if you didn't write them, you release them into your environment
[2014-05-09 20:57:20 -0400] coderanger: like your own private chef universe
[2014-05-09 20:57:40 -0400] coderanger: So what you are asking is "how do I release an external cookbook into my chef server"
[2014-05-09 20:57:59 -0400] coderanger: and your options are either do it manually, download each external cookbook and knife cookbook upload it
[2014-05-09 20:58:18 -0400] coderanger: or at the edge of the dependency tree, add it to the berksfile so it gets pulled in via berks upload
[2014-05-09 20:58:19 -0400] _aeris_: i have some trouble with node attribute
[2014-05-09 20:58:26 -0400] coderanger: the former is more precise, the latter is a bit less work
[2014-05-09 20:58:33 -0400] mjuszczak: Do you mind explaining what you mean by edge of dependency tree?
[2014-05-09 20:58:55 -0400] _aeris_: i have attributes on a role, assigned to a node, but those attributes are not visible, so not searcheable, until the node really run chef-client
[2014-05-09 20:58:59 -0400] coderanger: mjuszczak: You have cookbooks that depend on each others, if you draw a graph of these it will look like a big tree
[2014-05-09 20:59:06 -0400] coderanger: x -> y -> z, etc
[2014-05-09 20:59:23 -0400] coderanger: _aeris_: That is correct
[2014-05-09 20:59:31 -0400] _aeris_: how i can search for such attributes for another node deployment, no matter the run order ?
[2014-05-09 20:59:38 -0400] coderanger: _aeris_: That is not possible
[2014-05-09 20:59:42 -0400] _aeris_: :(
[2014-05-09 20:59:47 -0400] coderanger: _aeris_: Attribute expansion is only done on the client
[2014-05-09 20:59:50 -0400] mjuszczak: So in that case, I would add it to y's Berksfile
[2014-05-09 20:59:54 -0400] mjuszczak: so that z got uploaded
[2014-05-09 21:00:05 -0400] coderanger: mjuszczak: Assuming Z was external, yes
[2014-05-09 21:00:07 -0400] mjuszczak: But if I upload x, and z isn't there, it won't work, even though y's Berkfile says it.
[2014-05-09 21:00:17 -0400] _aeris_: coderanger > any workarround available ? :(
[2014-05-09 21:00:18 -0400] coderanger: mjuszczak: that way when x tries to get it, it will pull it in from your chef-server
[2014-05-09 21:00:24 -0400] coderanger: _aeris_: Not really, what are you trying to do
[2014-05-09 21:00:48 -0400] mjuszczak: coderanger: when x tries to get it after a berks upload was run on y.  I can't run a berks upload on x because it won't look at y's Berksfile.
[2014-05-09 21:00:57 -0400] _aeris_: ask a lxc-host to create lxc-guest, without (obviously) running the chef lxc-guest :]
[2014-05-09 21:01:20 -0400] coderanger: mjuszczak: No, you can, because x knows about z via the chef-server
[2014-05-09 21:01:25 -0400] _aeris_: lxc-guest declare it host in an attribute
[2014-05-09 21:01:37 -0400] coderanger: _aeris_: Chef isn't a provisioning system :P
[2014-05-09 21:01:48 -0400] coderanger: _aeris_: But in that kind of case, you could scan for the role more manually
[2014-05-09 21:01:52 -0400] _aeris_: provisionning no, but configuration deployment, yes :D
[2014-05-09 21:01:56 -0400] coderanger: _aeris_: search(:node, 'role:foo')
[2014-05-09 21:02:02 -0400] mjuszczak: coderanger: right, but that's because I ran a berks upload from within either y or z first.  There's no way to berks upload from x and have it push both y and z if both of those are external cookbooks.
[2014-05-09 21:02:05 -0400] coderanger: Note that in this case you need role:foo, not roles:foo
[2014-05-09 21:02:22 -0400] coderanger: mjuszczak: Not unless you've done y first, that is correct and is the way it should be
[2014-05-09 21:02:26 -0400] _aeris_: coderanger > lxc-guest node haven't actually specific lxc role
[2014-05-09 21:02:31 -0400] mjuszczak: Gotcha
[2014-05-09 21:02:41 -0400] mjuszczak: Thanks :)
[2014-05-09 21:02:44 -0400] _aeris_: seems  normal  because virtualisation must be transparent :D
[2014-05-09 21:02:51 -0400] coderanger: _aeris_: You'll have to check for each individually
[2014-05-09 21:03:06 -0400] coderanger: _aeris_: or otherwise process things yourself on the hypervisor system
[2014-05-09 21:03:30 -0400] _aeris_: why attribute are not resolve before the run ?
[2014-05-09 21:03:41 -0400] _aeris_: some of those can be calculated on deploy, no ?
[2014-05-09 21:03:53 -0400] coderanger: _aeris_: The server doesn't resolve anything, it can't since that requires code execution
[2014-05-09 21:04:23 -0400] _aeris_: could be possible from knife, no ?
[2014-05-09 21:04:56 -0400] coderanger: _aeris_: No, there is no way to statically expand the attributes in chef since it depends on executable code in cookbooks
[2014-05-09 21:05:07 -0400] coderanger: and a partial expansion would be worse than no expansion
[2014-05-09 21:05:23 -0400] coderanger: _aeris_: This really isn't a good thing to use node attributes for
[2014-05-09 21:05:36 -0400] coderanger: _aeris_: If you really want to do lxc provisioning in chef, look at chef-metal and data bags
[2014-05-09 21:05:48 -0400] _aeris_: not partial expansion, seems just static one in this case
[2014-05-09 21:06:02 -0400] _aeris_: attributes associated to node or roles of this node
[2014-05-09 21:06:16 -0400] coderanger: _aeris_: That would be a partial expansion, the static components are only part of the final attribute set which also includes cookbook attributes and ohai data
[2014-05-09 21:06:33 -0400] _aeris_: somethings like  tags  more than like attributes in fact
[2014-05-09 21:06:49 -0400] coderanger: tags are attributes :)
[2014-05-09 21:07:11 -0400] _aeris_: yep :]
[2014-05-09 21:07:34 -0400] _aeris_: but i will have the problem for others things in this case :(
[2014-05-09 21:07:51 -0400] _aeris_: reverse-proxy nginx (must run apache before nginx)
[2014-05-09 21:08:08 -0400] _aeris_: mysql part of a lamp stack (must run mysql before apache)
[2014-05-09 21:08:09 -0400] _aeris_: etc
[2014-05-09 21:09:01 -0400] coderanger: _aeris_: Yes, you need to make sure you run chef in the correct order or you have to design your recipes very carefully
[2014-05-09 21:09:10 -0400] coderanger: _aeris_: This is what tools like rundeck and mcollective are for
[2014-05-09 21:09:55 -0400] _aeris_: seems better and more bug-proof to have a order independant tool, no ?
[2014-05-09 21:10:15 -0400] _aeris_: specifically with chef-client running each day with jitter ><
[2014-05-09 21:10:27 -0400] coderanger: _aeris_: Chef doesn't care about order, its your code that does
[2014-05-09 21:10:40 -0400] coderanger: _aeris_: You can write recipes to be order-independent but it is much harder, so most people don't
[2014-05-09 21:11:07 -0400] _aeris_: in case of mysql/apache, nginx/apache, firewalling, backup, mail gateway
[2014-05-09 21:11:18 -0400] _aeris_: in case of a very lot of things in fact
[2014-05-09 21:11:26 -0400] coderanger: Yep
[2014-05-09 21:11:40 -0400] coderanger: _aeris_: Building convergent infrastructure, an thing :)
[2014-05-09 21:11:52 -0400] coderanger: but you are absolutely correct that it is the right way to do things
[2014-05-09 21:12:21 -0400] _aeris_: right way, but seems in this case that chef is not the right tool, no ?
[2014-05-09 21:12:47 -0400] coderanger: No, chef can do it just fine, you just need to write your recipes with it in mind
[2014-05-09 21:13:16 -0400] coderanger: What you probably don't want to use is chef search
[2014-05-09 21:13:29 -0400] coderanger: for something like that ZooKeeper would be a better way to track state data
[2014-05-09 21:13:43 -0400] coderanger: you can see my etcd-chef spike as an example of this idea that I never finished
[2014-05-09 21:13:58 -0400] _aeris_: putting lxc-guest config on lxc-host node, hurting me
[2014-05-09 21:14:17 -0400] _aeris_: putting lxc-guest config on lxc-guest node, hurting run order
[2014-05-09 21:15:05 -0400] _aeris_: seems very better way to use chef search to look for each lxc-guest declaring to be hosted by the host
[2014-05-09 21:16:02 -0400] coderanger: _aeris_: Except as I said, chef can't do that if it hasn't run yet :)
[2014-05-09 21:16:22 -0400] coderanger: as I said, chef isn't a provisioning tool, that would be something like cloudformation or heat
[2014-05-09 21:16:30 -0400] _aeris_: for mysql/apache, seems it leads to code duplication too
[2014-05-09 21:16:44 -0400] _aeris_: on apache-node, declaring mysql-node to use
[2014-05-09 21:16:53 -0400] _aeris_: on mysql-node, open apache-node on firewall
[2014-05-09 21:17:04 -0400] coderanger: _aeris_: Not sure what you mean
[2014-05-09 21:17:25 -0400] _aeris_: if i want to be order-proof, i have to declare the mysql to use on the apache-node
[2014-05-09 21:17:42 -0400] _aeris_: and the apache node on the mysql node to open the firewall
[2014-05-09 21:17:58 -0400] _aeris_: relation between apache and mysql, duplicated
[2014-05-09 21:18:24 -0400] _aeris_: will be better to have only one side declaring the relation-ship, and using chef-search for the other side
[2014-05-09 21:19:35 -0400] coderanger: _aeris_: Not sure what you mean, just query ZK for it
[2014-05-09 21:19:36 -0400] _aeris_: for example on mysql-side, taking into account *ALL* (not only apache) node using this mysql-node,  search(:node, "mysql:#{node.name}") 
[2014-05-09 21:20:15 -0400] _aeris_: but if mysql run before apache-nodes, result is empty
[2014-05-09 21:20:30 -0400] coderanger: Yes, so you need to just abort the recipe and try again later
[2014-05-09 21:20:59 -0400] _aeris_: yep, but no way to detecte partial configuration
[2014-05-09 21:21:07 -0400] coderanger: You have to detect it yourself
[2014-05-09 21:21:15 -0400] coderanger: thats why I said this is harder than most people want to deal with
[2014-05-09 21:21:27 -0400] coderanger: There is no generic way to define "partial configuration"
[2014-05-09 21:21:35 -0400] coderanger: its all dependent on your infra
[2014-05-09 21:21:40 -0400] _aeris_: there is no way at all i guess
[2014-05-09 21:21:57 -0400] coderanger: Preferably your app should continue to operate with its database, just in a degraded or static mode
[2014-05-09 21:22:01 -0400] coderanger: er, without
[2014-05-09 21:22:02 -0400] _aeris_: in this case, i can have no apache, all apache, all apache except one, old apache
[2014-05-09 21:22:26 -0400] _aeris_: or a mix of old and new apache
[2014-05-09 21:22:39 -0400] _aeris_: or any combination
[2014-05-09 21:23:02 -0400] _aeris_: such sadness :'(
[2014-05-09 21:23:18 -0400] _aeris_: i love chef, but this behaviour breaks my heart :'(
[2014-05-09 21:23:24 -0400] coderanger: Yep, like I said, its a really hard problem to solve
[2014-05-09 21:23:37 -0400] _aeris_: not  really  hard
[2014-05-09 21:23:42 -0400] _aeris_: with chef, i'm ok
[2014-05-09 21:23:43 -0400] coderanger: No, it is
[2014-05-09 21:24:13 -0400] _aeris_: but for me, computing the good topology from description can be possible
[2014-05-09 21:24:36 -0400] coderanger: _aeris_: The question is what computes it
[2014-05-09 21:24:51 -0400] _aeris_: chef-server
[2014-05-09 21:24:56 -0400] _aeris_: or equivalent :)
[2014-05-09 21:24:57 -0400] coderanger: Either you make it distributed and convergent, or you have a single point of failure in your coordniator layer
[2014-05-09 21:25:01 -0400] coderanger: no, thats not what chef-server does
[2014-05-09 21:25:07 -0400] coderanger: chef-server is a fancy file server, nothing more
[2014-05-09 21:25:40 -0400] coderanger: CloudFormation is more or less what you are describing though
[2014-05-09 21:25:42 -0400] _aeris_: i'm ok, but in my mind of a theorical configuration system, will be the role of a chef-server equivalent
[2014-05-09 21:26:08 -0400] _aeris_: putting topology description on it, calculate the resulting configuration to deploy
[2014-05-09 21:26:11 -0400] coderanger: _aeris_: No, chef-server is really just a transport mechanism, it isn't a cooridniator
[2014-05-09 21:26:22 -0400] _aeris_:  equivalent 
[2014-05-09 21:26:29 -0400] coderanger: I mean you can invent something new to be a strong external coordinator, but this has nothing to do with chef-server
[2014-05-09 21:26:34 -0400] _aeris_: central system if you prefer :D
[2014-05-09 21:26:52 -0400] coderanger: and I dare you to go up to a DB engineer and say "strong external coordinator" and see what they do :-)
[2014-05-09 21:27:56 -0400] _aeris_: i'm not expert in the field, but in my case, seem's not very complex to generate configuration file from description
[2014-05-09 21:28:46 -0400] coderanger: _aeris_: When you factor in the nature of distributed systems, it becomes much harder
[2014-05-09 21:28:55 -0400] coderanger: thats why I said you are describing CloudFormation
[2014-05-09 21:29:04 -0400] _aeris_: i look for it :)
[2014-05-09 21:29:24 -0400] coderanger: And to be fair, cloudformation is what I use today, so its not toooo bad
[2014-05-09 21:30:00 -0400] _aeris_: in my case, i don't think i'm on distributed systems
[2014-05-09 21:30:19 -0400] coderanger: Do you have more than one server?
[2014-05-09 21:30:24 -0400] _aeris_: yep
[2014-05-09 21:30:27 -0400] coderanger: Then you are
[2014-05-09 21:30:44 -0400] _aeris_: we don't have the same definition in this case :D
[2014-05-09 21:31:00 -0400] _aeris_: in my case, i just have X servers (physic or virtual)
[2014-05-09 21:31:19 -0400] coderanger: Then your definition is incorrect, any system with more than one failure domain is a distributed system
[2014-05-09 21:31:38 -0400] _aeris_: Y relationships between them (lxc-host/guest, apache/mysql, nginx/apache, mail gateway, monitoring, firewall)
[2014-05-09 21:32:15 -0400] _aeris_: and want to generate all the related configuration file and install the correct software on each
[2014-05-09 21:32:56 -0400] _aeris_: currently, the full topology can be draw on paper
[2014-05-09 21:33:19 -0400] coderanger: The topology isn't static
[2014-05-09 21:33:29 -0400] coderanger: as long as things can fail, it needs to be dynamic
[2014-05-09 21:33:32 -0400] _aeris_: just the relationship management is very tedious to do by hand
[2014-05-09 21:33:39 -0400] _aeris_: and error-prone
[2014-05-09 21:33:51 -0400] _aeris_: it's not a dynamic topo on my case
[2014-05-09 21:34:09 -0400] _aeris_: failure is not of the responsability of the chef-equivalent tool
[2014-05-09 21:34:34 -0400] _aeris_: theorically, will be a  one-shot  run on each server
[2014-05-09 21:34:37 -0400] coderanger: I suspect you may disagree when something breaks at 4AM and you need to boot a new server :D
[2014-05-09 21:34:55 -0400] _aeris_: no, i'm agree :)
[2014-05-09 21:35:04 -0400] _aeris_: i'm not at all on the cloud in my case
[2014-05-09 21:35:28 -0400] coderanger: Servers can still fail
[2014-05-09 21:35:32 -0400] _aeris_: yep
[2014-05-09 21:35:53 -0400] _aeris_: but in this case, i wake up, i boot a new machine, run the tool, and finish
[2014-05-09 21:36:38 -0400] coderanger: Thats fine, but "the tool" isn't chef
[2014-05-09 21:36:39 -0400] _aeris_: i don't look for 99.999% uptime or no human intervention at all
[2014-05-09 21:36:58 -0400] coderanger: That tool might run chef internally to handle config management
[2014-05-09 21:37:00 -0400] _aeris_: just replace tedious manual configuration not well documented
[2014-05-09 21:37:01 -0400] gleam: if you're looking at other options (one I've not played with at all), juju has the ability to define relationships between services and your charms can take specific action based on that relationship breaking/being established
[2014-05-09 21:37:01 -0400] coderanger: but it isn't chef itself
[2014-05-09 21:40:14 -0400] davidordave: does anyone here use chef shell in solo mode? The default attributes from my cookbooks don't seem to be getting loaded. Which is lame.
[2014-05-09 21:40:39 -0400] _aeris_: coderanger > in this case, what about puppet so ?
[2014-05-09 21:40:41 -0400] _aeris_: same problem ?
[2014-05-09 21:40:51 -0400] Neozonz: coderanger, are u familiar with opsworks in anyway?  it deploys all 3 of my php apps on start up- is there anyway to just deploy a single one?
[2014-05-09 21:41:09 -0400] coderanger: _aeris_: Yep, what are you describing in a provisioning system, not config management
[2014-05-09 21:41:28 -0400] coderanger: _aeris_: and as I said, config management is a component of provisioning, but there is more
[2014-05-09 21:41:39 -0400] coderanger: Neozonz: Not really, I used it enough to know I don't like it :)
[2014-05-09 21:41:45 -0400] Neozonz: Davey, i think opsworks does, so i am
[2014-05-09 21:41:48 -0400] _aeris_: i don't see very well the difference between the 2
[2014-05-09 21:41:55 -0400] Neozonz: coderanger, lol i see
[2014-05-09 21:42:29 -0400] coderanger: davidordave: I've been using Chef for ~4 years, I _still_ can't make chef-shell work >_<
[2014-05-09 21:43:32 -0400] Neozonz: coderanger, it looks like its due to this here
[2014-05-09 21:43:33 -0400] Neozonz: https://github.com/aws/opsworks-cookbooks/blob/945499863560cac1e2c4454adc4a5601b1094e63/php/recipes/configure.rb
[2014-05-09 21:43:36 -0400] davidordave: haha, at least now I know I'm not the only one. Every time I have seen an example of chef shell I think "hey, that's nifty, I should use that". It never pans out.
[2014-05-09 21:44:24 -0400] Neozonz: for each deploy in php apps it configures apache, anyway to override that line
[2014-05-09 21:44:32 -0400] coderanger: davidordave: test-kitchen + Chef::Log.debug
[2014-05-09 21:44:32 -0400] Neozonz: or just make ti deploy a specific app instead of for each
[2014-05-09 21:45:22 -0400] _aeris_: coderanger > what do you mean by provisionning ? allocating server and ressources ?
[2014-05-09 21:45:35 -0400] _aeris_: seems not what i need in this case
[2014-05-09 21:45:47 -0400] coderanger: _aeris_: Yep, allocation of resources and the relationships between them
[2014-05-09 21:46:28 -0400] _aeris_: for ressources, in my case, servers are provisionned manually
[2014-05-09 21:46:47 -0400] _aeris_: and for relationship, i expect using chef for this :(
[2014-05-09 21:49:55 -0400] coderanger: _aeris_: If you want to use chef for it, you need to use the convergent style I mentioned instead of a strong coordinator
[2014-05-09 21:50:29 -0400] coderanger: I guess thats not true, you could use data bags as the coordinator
[2014-05-09 21:50:33 -0400] coderanger: but I just wouldn't :)
[2014-05-09 21:53:21 -0400] damien: greetings!
[2014-05-09 21:53:30 -0400] damien: hey can someone help me understand how to wire up a custom ohai plugin?
[2014-05-09 21:53:35 -0400] coderanger: damien: Sure
[2014-05-09 21:53:47 -0400] damien: I found this page http://johntdyer.com/blog/2013/01/25/ohai/ which talksa bout a a way to use eth1 instead of eth0 for vagrant
[2014-05-09 21:53:53 -0400] damien: which would /reallly/ /really/ help me out
[2014-05-09 21:54:25 -0400] damien: I've put in a bunch of junk code over last few months juggling local, virtualbox and ec2 ip issues in recipes
[2014-05-09 21:54:38 -0400] damien: and can see how this change would seriously make my life a lot easier
[2014-05-09 21:54:45 -0400] damien: but... I dont' really understand where to put it...
[2014-05-09 21:54:55 -0400] damien: do I check out ohai cookbook from git hub?
[2014-05-09 21:55:02 -0400] damien: can I just add this in to my existing company cookbook?
[2014-05-09 21:55:48 -0400] damien: Do I just put it in my existing cookbook in files/default and install it to the /etc/chef/ohai_plugins dir?
[2014-05-09 21:56:00 -0400] troyready: That will do it
[2014-05-09 21:56:02 -0400] damien: like with cookbook_file?
[2014-05-09 21:56:07 -0400] damien: is that the right way to do this?
[2014-05-09 21:56:25 -0400] coderanger: damien: Check out https://github.com/coderanger/ohai-example
[2014-05-09 21:57:33 -0400] damien: coderanger: oh wow, thank you
[2014-05-09 21:58:19 -0400] damien: sorry, so the default recipe includes 'ohai' and then does that recipe use the default attributes 'plugins' dir of files/default then?
[2014-05-09 21:58:31 -0400] coderanger: damien: Yep
[2014-05-09 21:58:53 -0400] damien: and the standard ohai cookbook just deploys all of those that are in files/default/plugin?
[2014-05-09 21:58:54 -0400] damien: noice
[2014-05-09 21:58:59 -0400] damien: aight! I will give it a try, TY! :D
[2014-05-09 21:59:18 -0400] coderanger: damien: You can name the folder something different if you want, just has to match the attribute value
[2014-05-09 21:59:33 -0400] damien: k, nice
[2014-05-09 21:59:57 -0400] Neozonz: ok found the line in opsworks that deploys all my php apps... https://github.com/aws/opsworks-cookbooks/blob/945499863560cac1e2c4454adc4a5601b1094e63/php/recipes/configure.rb#L1
[2014-05-09 22:00:07 -0400] Neozonz: anyway I can override that to only deploy 1 of my php apps
[2014-05-09 22:00:12 -0400] damien: is it a good idea to like make a copy of his ohai-example -> ohai-company?  or can I just put it in my existing cookbook, add an atribute and includde the ohai recipe?
[2014-05-09 22:00:21 -0400] damien: not sure of best practice there...
[2014-05-09 22:01:09 -0400] coderanger: damien: usually it would be company-ohai
[2014-05-09 22:01:17 -0400] coderanger: but other than that, yep
[2014-05-09 22:01:26 -0400] damien: coderanger, k, awesome, thanks a lot!
[2014-05-09 22:05:39 -0400] tmichael: FYI chefs, interesting bug(?) I just stumbled upon in foodcritic that's packaged with ChefDK: https://github.com/acrmp/foodcritic/issues/238
[2014-05-09 22:06:22 -0400] tmichael: feel free to tell me if PIBKAC and I'll pull it.
[2014-05-09 22:14:58 -0400] dgarstang: Err... what version of berkshelf should I be using? 2 or 3?
[2014-05-09 22:15:51 -0400] coderanger: 3
[2014-05-09 22:17:15 -0400] damien: coderanger, thanks a lot! it works! so happy, don't have to dink around with eth0/eth1 anymore.... ahhhhh the goodness... happy friday :)
[2014-05-09 22:17:29 -0400] dgarstang: coderanger: any particular reason berkshelf.com says to use 2.0.1?
[2014-05-09 22:17:54 -0400] coderanger: dgarstang: Thats vagrant-berkshelf
[2014-05-09 22:18:02 -0400] coderanger: different tool
[2014-05-09 22:18:20 -0400] dtrott: In a (metadata) depends clause whats the difference between  optimistically greater >=  and pessimistically greater  ~>
[2014-05-09 22:18:53 -0400] dgarstang: coderanger: I must be missing something then cuz that's the only discussion of installing anything on berkshelf.com that I can see.
[2014-05-09 22:19:31 -0400] coderanger: dgarstang: Please re-read the first paragraph
[2014-05-09 22:20:01 -0400] coderanger: dtrott: ~> is basically semver greater than
[2014-05-09 22:20:09 -0400] dgarstang: ugh, refactor
[2014-05-09 22:20:26 -0400] coderanger: so if you have ~>1.0, it will allow 1.0.1, 1.1.0, but not 2.0
[2014-05-09 22:21:44 -0400] dtrott: K thanks that explains an error i am seeing.
[2014-05-09 22:52:23 -0400] dgarstang: I've seen this before... "FATAL: Chef::Exceptions::PrivateKeyMissing: I cannot read /etc/chef/client.pem, which you told me to use to sign requests!" ... darned if I know what the solution was before tho. This is with vagrant and chef-solo.
[2014-05-09 22:53:14 -0400] coderanger: You are probably trying to use search() in chef solo
[2014-05-09 22:54:25 -0400] dgarstang: coderanger: I hope not. I just created a new cookbook with 'chef generate cookbook foo'
[2014-05-09 23:03:10 -0400] dgarstang: Added 'depends "chef-solo-search"' to metadata.rb. Same deal.
[2014-05-09 23:07:01 -0400] dgarstang: I commented out data bags and environments from the Vagrantfile. That fixed it. Now I am confused.
[2014-05-09 23:41:10 -0400] dgarstang: Oh lovely. Why me? "NameError: uninitialized constant Chef::EventDispatch"
[2014-05-09 23:41:41 -0400] Guest111: ?
[2014-05-09 23:41:58 -0400] coderanger: dgarstang: You are trying to use a cookbook that requires a new version version of chef
[2014-05-09 23:42:55 -0400] Guest111: noob question.. how can i see discussion history?
[2014-05-09 23:43:19 -0400] dgarstang: coderanger: Well that would have to be https://github.com/edelight/chef-solo-search
[2014-05-09 23:44:00 -0400] dgarstang: coderanger: I'm not sure how I would specify an older version in Berksfile
[2014-05-09 23:45:31 -0400] dgarstang: I guess the backtrace would suggest that it is in the edgelight chef-solo-search cookbook.
[2014-05-09 23:48:29 -0400] dgarstang: Oh noes.
[2014-05-09 23:51:09 -0400] dgarstang: Is chef-client supported on centos/redhat?
[2014-05-09 23:53:11 -0400] troyreadyy: dgarstang, yes
[2014-05-09 23:56:08 -0400] dgarstang: so, it seems I need a vagrant box with a newer version of the client.
[2014-05-09 23:57:53 -0400] lrr: vagrant-omnibus? then you don't have to install the client to the vagrant box before hand
[2014-05-09 23:58:25 -0400] dgarstang: lrr: then I gotta wait while it goes and downloads it every single time. :)
[2014-05-09 23:58:37 -0400] lrr: meh
[2014-05-09 23:58:52 -0400] dgarstang: lrr: meh on the wait.... but a valid workaround for now, thanks
[2014-05-09 23:58:53 -0400] coderanger: dgarstang: vagrant-omnibus is the supported way to do it
[2014-05-09 23:59:19 -0400] dgarstang: coderanger: egads, that would make everything I do take considerably longer
[2014-05-09 23:59:30 -0400] coderanger: Then run a local proxy
[2014-05-09 23:59:36 -0400] coderanger: Or use test-kitchen
[2014-05-09 23:59:41 -0400] lrr: ^^
[2014-05-09 23:59:52 -0400] dgarstang: coderanger: it's my 2nd day here. Haven't quite gotten there yet
[2014-05-09 23:59:55 -0400] coderanger: Or use packer to make your own vbox images
