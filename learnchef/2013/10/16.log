[2013-10-16 15:09:08 -0400] CPS: i'm having trouble using the remote_resource on windows
[2013-10-16 15:09:24 -0400] CPS: i have a network share containing installers, i want to copy one locally
[2013-10-16 15:09:45 -0400] CPS: with remote_resource, I get 'directory does not exist' for my path attribute
[2013-10-16 15:10:10 -0400] CPS: using the same source and destination i am able to copy them over using an execute block with "copy source dest" as the command
[2013-10-16 15:23:08 -0400] vt102: Anybody using chef to populate nagios data, as opposed to configuring the software?
[2013-10-16 15:27:25 -0400] joe_k: i have a chef node bootstrapped but I dont know what entities to start defining to configure/provision it
[2013-10-16 15:27:32 -0400] joe_k: do i need to write a cookbook? or a recipe? or a role?
[2013-10-16 15:27:42 -0400] joe_k: or do i just specify existing cookbooks in a run list?
[2013-10-16 15:28:07 -0400] CPS: if you have existing cookbooks you can add them to the node's run list
[2013-10-16 15:28:10 -0400] joe_k: pages like http://docs.opscode.com/essentials_node_object_run_lists.html are not drawing a big picture
[2013-10-16 15:28:15 -0400] joe_k: i am starting from scratch
[2013-10-16 15:28:22 -0400] joe_k: i dont have existinng cookbooks and am not sure of the chef mental model
[2013-10-16 15:28:24 -0400] CPS: otherwise you'll need to create cookbooks to do whatever it is you want to do
[2013-10-16 15:28:59 -0400] CPS: cookbooks contain a collection of recipes, you can specify a particular one, or if not it runs default.rb
[2013-10-16 15:29:18 -0400] CPS: roles are basically a set of pre-defined run lists and attributes (i think)
[2013-10-16 15:30:16 -0400] joe_k: and a recipe is just a .rb file in a cookbook directory?
[2013-10-16 15:30:19 -0400] mmzyk: vt102 ask in #chef, its likely someone there is doing and/or trying what you're asking about.
[2013-10-16 15:30:21 -0400] CPS: yes
[2013-10-16 15:30:33 -0400] joe_k: gotta love jargon
[2013-10-16 15:30:40 -0400] CPS: yeah
[2013-10-16 15:30:52 -0400] mmzyk: joe_k The base container in chef is cookbooks, which are made up of recipes. CPS is correct.
[2013-10-16 15:31:52 -0400] joe_k: i dont like that my (local / org-specific) cookbooks are intermingled with cookbooks from "knife cookbook site install" - is there a better way to specify dependencies rather than pulling them into the repo and then manually keeping them up to date?
[2013-10-16 15:33:36 -0400] ssd7: joe_k: A number of people use Berkshelf to handle that issue.  It allows you to specify cookbook dependencies much like Ruby's bundler does.  (http://berkshelf.com/)
[2013-10-16 15:34:18 -0400] ssd7: joe_k: Personally, I don't mind the intermingling, but those who do have found Berkshelf very useful.
[2013-10-16 15:35:01 -0400] joe_k: seems like cookbooks could just be gems
[2013-10-16 15:35:09 -0400] mmzyk: I think you can specify separate paths for them in your knife config? Maybe I'm wrong on that.
[2013-10-16 15:36:37 -0400] mmzyk: I think that discussion has been had many times joe_k, but I haven't been in on it to be able to relay pros and cons.
[2013-10-16 15:36:41 -0400] joe_k: grrr, http://docs.opscode.com/essentials_repository.html "Knife is used to upload data to the server from the chef-repo. Once uploaded, "
[2013-10-16 15:36:42 -0400] joe_k: BUT HOW
[2013-10-16 15:36:59 -0400] joe_k: seems like the docs people need to sit with a beginner for a few days
[2013-10-16 15:37:07 -0400] joe_k: sooooo much context is just left ouyt
[2013-10-16 15:37:42 -0400] CPS: knife cookbook upload -a
[2013-10-16 15:37:47 -0400] CPS: will upload your recipes to the server
[2013-10-16 15:38:30 -0400] joe_k: you mean cookbooks?
[2013-10-16 15:38:47 -0400] CPS: yes
[2013-10-16 15:38:56 -0400] mmzyk: Believe us joe_k, we know. (I'm an Opscode dev, fyi)
[2013-10-16 15:39:05 -0400] joe_k: is there a function where the server can just watch github?
[2013-10-16 15:39:23 -0400] joe_k: or an integration
[2013-10-16 15:39:27 -0400] mmzyk: Since bringing on our tech writer his first job was get docs.opscode.com up and useful as a reference (it's much better than the old wiki)
[2013-10-16 15:39:49 -0400] mmzyk: And he's now starting to write the docs you want, but I unfortunately they aren't in place yet, which doesn't help you, I now.
[2013-10-16 15:40:10 -0400] mmzyk: No, chef doesn't have any kind of integration with github.
[2013-10-16 15:40:24 -0400] mmzyk: Unless someone in the community has added it as an add-on I don't know about.
[2013-10-16 15:40:27 -0400] CPS: just be happy you aren't do this stuff on windows joe_k 
[2013-10-16 15:40:46 -0400] joe_k: i am on windows
[2013-10-16 15:40:59 -0400] joe_k: im coming back after year when we tried a year ago
[2013-10-16 15:41:04 -0400] mmzyk: :) 
[2013-10-16 15:41:06 -0400] joe_k: i have put many days into trying to make this work
[2013-10-16 15:41:20 -0400] mmzyk: Well, CPS, meet joe_k, joe_k, meet CPS.
[2013-10-16 15:41:26 -0400] CPS: oh well i'm on windows too
[2013-10-16 15:41:27 -0400] mmzyk: You're both configuring windows nodes.
[2013-10-16 15:41:34 -0400] CPS: started this about a week ago
[2013-10-16 15:41:49 -0400] mmzyk: My apologies on the troubles joe_k. I'll try to help you out as much as I can.
[2013-10-16 15:41:57 -0400] mmzyk: First, you seem very aware of http://docs.opscode.com
[2013-10-16 15:42:11 -0400] joe_k: i am aware of google sending me there :)
[2013-10-16 15:42:33 -0400] joe_k: i dont think i've found or looked for a "big table of contents"
[2013-10-16 15:42:36 -0400] mmzyk: The old wiki docs are here: https://wiki.opscode.com/display/chef/Home
[2013-10-16 15:43:01 -0400] mmzyk: Those have some tutorials and older docs that might be of value, but the information could be out of date.
[2013-10-16 15:43:05 -0400] joe_k: top bar doesnt change when I navigate so i know its not breadcrumbs to any hierarchical nav
[2013-10-16 15:43:09 -0400] joe_k: so not sure how to find "the top"
[2013-10-16 15:43:54 -0400] mmzyk: gotcha. Yeah, the docs are generated with sphinx, so maybe it's a limitation of the tool, I'm not sure.
[2013-10-16 15:44:00 -0400] mmzyk: So docs.opscode.com is the top.
[2013-10-16 15:44:17 -0400] mmzyk: If you want the windows specific page, which is new and not yet the best organized, it's here: http://docs.opscode.com/windows.html
[2013-10-16 15:44:30 -0400] mmzyk: That page lists everything in the docs that is windows specific.
[2013-10-16 15:44:44 -0400] mmzyk: We know it needs better organization but wanted to get that up so windows info was easier to find.
[2013-10-16 15:45:28 -0400] mmzyk: If you're more the git type, all the docs live on github: https://github.com/opscode/chef-docs
[2013-10-16 15:45:41 -0400] joe_k: can i mention #1 : windows paths have backslashes. backslash is the ruby string escape character. 
[2013-10-16 15:45:58 -0400] CPS: i've been having a lot of trouble with that
[2013-10-16 15:46:02 -0400] joe_k: if i see a windows path in ruby, it needs to have double-backslashes, and they dont
[2013-10-16 15:46:07 -0400] joe_k: ruby people just dont know or care it seems
[2013-10-16 15:46:22 -0400] joe_k: there is no common way to join paths
[2013-10-16 15:46:55 -0400] CPS: joe_k: your options are '"C:\path\stuff"' or using Ruby's / character or doing your own file path joins
[2013-10-16 15:47:02 -0400] mmzyk: That's excellent feedback, I'll pass that on to our tech writer so he can incorporate that into the docs.
[2013-10-16 15:47:04 -0400] CPS: don't mix slashes - it doesn't work
[2013-10-16 15:47:14 -0400] joe_k: also the devs who write the stuff
[2013-10-16 15:47:21 -0400] CPS: File.join joins paths
[2013-10-16 15:48:39 -0400] CPS: but its a ruby function and uses /
[2013-10-16 15:50:11 -0400] joe_k: i wonder how many people are just mystified when they copy an example and their folder or file name starts with r,t,b,n, etc 
[2013-10-16 15:50:25 -0400] joe_k: and c:\repo turns into c:<CR>epo
[2013-10-16 16:12:33 -0400] quatrix: hey, how do i access environment attributes from a library in a recipe?
[2013-10-16 16:13:00 -0400] CPS: system environment variables?
[2013-10-16 16:13:47 -0400] quatrix: nope, attributes, i have default_attributes "node" => { "foo" => "bar" }
[2013-10-16 16:14:23 -0400] CPS: no idea, sorry
[2013-10-16 16:14:31 -0400] quatrix: thanks
[2013-10-16 16:18:13 -0400] quatrix: i'll ask differently, maybe someone can help:
[2013-10-16 16:18:18 -0400] quatrix: hi, in an environment i have default_attributes "node" => { "a" => "b" }, how do i access "a" from a library inside a cookbook? @node["a"] doesn't seem to work
[2013-10-16 16:18:34 -0400] CPS: you might also try #chef
[2013-10-16 16:18:53 -0400] quatrix: thanks, i asked there too
[2013-10-16 16:19:31 -0400] tomduffield: quatrix: the node object should be available in Libraries. Does node['a'] work?
[2013-10-16 16:20:16 -0400] quatrix: i tried that and i think it said it's undefined
[2013-10-16 16:20:25 -0400] sfalcon: quatrix: actually, @node is not available in ruby files defined in the libraries subdir.
[2013-10-16 16:20:42 -0400] quatrix: problem is everytime i want to try something, i need to upload the cookbook and then bootstrap a node with it, is there a faster way?
[2013-10-16 16:20:48 -0400] sfalcon: You have a couple of options.
[2013-10-16 16:21:38 -0400] quatrix: 192.118.71.42 undefined local variable or method `node' for ConfHelper:Module
[2013-10-16 16:21:47 -0400] sfalcon: You can define your helper function to take node as an argument.
[2013-10-16 16:21:48 -0400] quatrix: opps, didn't mean to copy paste my ip :)
[2013-10-16 16:22:33 -0400] sfalcon: If you are creating a ConfHelper class, you can make it a class you can instantiate and have it be like: helper = ConfHelper.new(node)  <-- that's in your recipe
[2013-10-16 16:22:50 -0400] sfalcon: Then in recipe you can do: helper.help_me(123) and it will have a reference to your node.
[2013-10-16 16:23:08 -0400] sfalcon: You can do a more magical thing by mixing your helper into Chef::Recipe.
[2013-10-16 16:24:00 -0400] quatrix: Chef::Recipe is a mixin? 
[2013-10-16 16:24:06 -0400] quatrix: i can inherit from it?
[2013-10-16 16:24:23 -0400] sfalcon: quatrix: sec, I'll paste an example if you like
[2013-10-16 16:24:30 -0400] quatrix: yeah, thanks
[2013-10-16 16:24:36 -0400] tomduffield: http://docs.opscode.com/essentials_cookbook_libraries.html
[2013-10-16 16:24:46 -0400] tomduffield: quatrix: you can see what they did there with ISP
[2013-10-16 16:25:39 -0400] sfalcon:  That works. You can also do: Chef:;Recipe.send(:include, HelperModule)
[2013-10-16 16:26:19 -0400] sfalcon: You could decide whether to put that in the helper module file (max convenience and magic) or in the recipe -- less convenience, but less magic
[2013-10-16 16:26:48 -0400] sfalcon: (although since the include is not really scoped, probably less of an argument for executing the include within a recipe)
[2013-10-16 16:26:54 -0400] quatrix: well, I don't like the idea of passing the node from the recipe file
[2013-10-16 16:27:59 -0400] quatrix: so if i go with the class Chef \ class Recipe, i get the node variable?
[2013-10-16 16:28:12 -0400] sfalcon: Fair enough. Passing the node makes it feel more "programmery" but has the upside of keeping the flow explicit.
[2013-10-16 16:29:01 -0400] quatrix: ok, i'll try some examples from that link, thanks
[2013-10-16 16:29:12 -0400] sfalcon: quatrix: yep, if you include the helper in Chef::Recipe you should have access to node
[2013-10-16 16:29:15 -0400] quatrix: is there a way to quickly try things without uploading the cb and bootstraping the machine?
[2013-10-16 16:29:33 -0400] tomduffield: quatrix: Vagrant is a popular option
[2013-10-16 16:29:49 -0400] tomduffield: quatrix: otherwise you can also use chef-shell
[2013-10-16 16:34:34 -0400] quatrix: if you could have a look: http://pastebin.com/fMCX6bCW
[2013-10-16 16:34:43 -0400] quatrix: i'm getting an undefined method `gen_servers' for Chef::Resource::HaproxyLb
[2013-10-16 16:35:20 -0400] quatrix: ohh, modules go to library and class should go to the recipe?
[2013-10-16 16:36:42 -0400] sfalcon: Here's a more complete helper module to look at: https://github.com/opscode-cookbooks/windows/blob/master/libraries/helper.rb#L53
[2013-10-16 16:37:35 -0400] quatrix: ohh. ok, lets me try that out.
[2013-10-16 16:39:06 -0400] sfalcon: Hmm, maybe for what you're trying to do you want to include your helper in Chef::Resource (I was expecting ::Recipe was going to work though)
[2013-10-16 16:39:59 -0400] sfalcon: With what you pasted, what happens if just before your resource you do: mine_servers = gen_servers('mine') and then use min_servers as the attribute value in the resource.
[2013-10-16 16:42:24 -0400] quatrix: ok, now i get undefined method `[]' for nil:NilClass
[2013-10-16 16:42:41 -0400] quatrix: on this line:  return (node["services_ports"][name]).map do |port|
[2013-10-16 16:44:07 -0400] sfalcon: quatrix: might help to pp some intermediate values to understand what's up. Maybe node doesn't hae a "services_ports"] attribute or nothing for 'mine'?
[2013-10-16 16:44:29 -0400] quatrix: can i do pp node?
[2013-10-16 16:45:51 -0400] sfalcon: Sure, but that might be a bit much. I'd suggest some more targeted printouts.
[2013-10-16 16:46:02 -0400] quatrix: oh, pp node says node[node_name]
[2013-10-16 16:47:57 -0400] quatrix: pp node["services_ports"] prints nil. 
[2013-10-16 16:48:17 -0400] quatrix: maybe it's default_attributes["node"]["services_ports"] or something likethat?
[2013-10-16 16:57:46 -0400] quatrix: oh oh, ok, getting it to work :)
[2013-10-16 16:57:47 -0400] quatrix: thanks
[2013-10-16 16:58:08 -0400] sfalcon: quatrix: yay! What was missing?
[2013-10-16 17:07:12 -0400] quatrix: in the enviornment i did default_attributes "node" => { "services_ports" => { ... } and it didn't work, but if i'm doing default_attributes "services_ports" => { ... } it works
[2013-10-16 17:07:42 -0400] quatrix: btw, what's the diff between node["something"] and node[:something] ?
[2013-10-16 17:09:02 -0400] bean__: : is a symbol
[2013-10-16 17:09:47 -0400] bean__: you can use either.
[2013-10-16 17:12:04 -0400] quatrix: thanks for all the help guys :)
[2013-10-16 17:17:17 -0400] quatrix: btw, maybe you can comment on my design: i have a haproxy wrapper cookbook and a supervisord wrapper cookbook, and a 'prod' envionment 
[2013-10-16 17:17:22 -0400] joelmoss: hi all
[2013-10-16 17:17:39 -0400] quatrix: in the env, i have this services dict that says which services has what ports
[2013-10-16 17:17:57 -0400] joelmoss: can anyone tell me why the mongodb cookbook would fail using knife-ec2 plugin, but not when using bootstrap directly?
[2013-10-16 17:18:07 -0400] quatrix: and the haproxy templates and supervisord templates are generated from those port ranges.
[2013-10-16 17:18:10 -0400] joelmoss: just fails on package[mongodb-10gen] action install
[2013-10-16 17:18:18 -0400] quatrix: is that the way to go about it?
[2013-10-16 17:26:31 -0400] mmzyk: We just started an internal meeting here at Opscode, so some of us are going to be sparse for a while, but quatrix and joelmoss those are excellent questions for the #chef channel that has a lot of advanced users in it who are likely to have comments.
[2013-10-16 17:31:57 -0400] joe_k: when I do "knife node run_list add NODE ITEM" does it edit the chef server or the files in the chef repo?
[2013-10-16 17:32:27 -0400] isafarnik: joe_k: That would update the node's run_list which is saved on the chef server
[2013-10-16 17:32:35 -0400] joe_k: also, is "edit" supposed to work on windows? I just get the command back with "Node not updated, skipping node save"
[2013-10-16 17:32:49 -0400] joe_k: so that command mutates the running state but doesn't save that mutation anywhere source-controlled?
[2013-10-16 17:33:29 -0400] joe_k: (i have EDITOR set to "vim" and vim is in the path)
[2013-10-16 17:33:33 -0400] isafarnik: It would update the run_list on the chef server, meaning that the node would need to run chef-client to check in and receive the updated run_list
[2013-10-16 17:33:41 -0400] bean__: ^
[2013-10-16 17:33:55 -0400] joe_k: isafarnik: and at that point I have to hand-update my chef-repo
[2013-10-16 17:34:09 -0400] joe_k: i am confused why examples run knife in the context of the chef-repo when they are really orthogonal
[2013-10-16 17:34:11 -0400] bean__: only if you're saving node run lists in version control
[2013-10-16 17:34:17 -0400] joe_k: knife - edits server
[2013-10-16 17:34:28 -0400] joe_k: repo - doesnt edit server, has to be manually moved to server
[2013-10-16 17:34:33 -0400] bean__: correct.
[2013-10-16 17:35:12 -0400] joe_k: seems like the only purpose of the repo for knife is to know where the config file is, which kind of conflates the purpose of the repo 
[2013-10-16 17:35:41 -0400] bean__: have you looked into berkshelf as well?
[2013-10-16 17:35:42 -0400] joelmoss: yeah I've been confused/annoyed by that too
[2013-10-16 17:35:47 -0400] isafarnik: Ish
[2013-10-16 17:35:49 -0400] joe_k: how can I see the result of applying that run list item? I just added it and want to know when its "finished"
[2013-10-16 17:36:17 -0400] isafarnik: Chef is a "pull model"
[2013-10-16 17:36:31 -0400] isafarnik: The chef server is the end-all-be-all of cookbooks/run_lists/etc.
[2013-10-16 17:36:33 -0400] bean__: `knife show node name`
[2013-10-16 17:36:42 -0400] bean__: err
[2013-10-16 17:36:47 -0400] bean__: `knife node show nodename`
[2013-10-16 17:36:49 -0400] isafarnik: So the node needs to check into the server by running chef-client to pick up the changes
[2013-10-16 17:37:02 -0400] isafarnik: The point of the repo is almost exclusively to check into source control.
[2013-10-16 17:37:26 -0400] joe_k: please tell me chef client runs automatically like every minute
[2013-10-16 17:37:32 -0400] joe_k: and i am not supposed to log in and run it
[2013-10-16 17:37:46 -0400] bean__: by default it runs every 30 minutes.
[2013-10-16 17:37:50 -0400] isafarnik: You can configure it to, but it doesn't set itself up to do that by default.
[2013-10-16 17:37:54 -0400] joelmoss: why would it need to do that?
[2013-10-16 17:38:10 -0400] joelmoss: surely running the client should be done only when needed?
[2013-10-16 17:38:15 -0400] joe_k: "node show" shows it in the metadata but I dont know if the node has applied it
[2013-10-16 17:38:48 -0400] joe_k: joelmoss: why would you ever want to touch anything by hand in a automated deployment?
[2013-10-16 17:39:02 -0400] joelmoss: I'm talking about running the client tho
[2013-10-16 17:39:10 -0400] joe_k: especially telling it "go check the automation"
[2013-10-16 17:39:11 -0400] bean__: oh, joe_k, `knife node show nodename -r` will show the runlist.
[2013-10-16 17:39:33 -0400] joelmoss: ok, so is it good practise to run client automatically?]
[2013-10-16 17:39:37 -0400] isafarnik: http://docs.opscode.com/chef_client.html http://docs.opscode.com/essentials_chef_client.html
[2013-10-16 17:39:40 -0400] bean__: I'd say so.
[2013-10-16 17:39:47 -0400] joe_k: i dont know. i presumed it reacted to your changes
[2013-10-16 17:39:56 -0400] joelmoss: whats the best way?
[2013-10-16 17:40:14 -0400] joelmoss: daemon?
[2013-10-16 17:40:24 -0400] joe_k: until now i presumed it was a daemon
[2013-10-16 17:40:25 -0400] bean__: we run it as a daemon and I wouldn't ahve it any other way
[2013-10-16 17:40:28 -0400] joe_k: i guess now
[2013-10-16 17:40:29 -0400] joe_k: not
[2013-10-16 17:40:30 -0400] isafarnik: You have lots of options, you can demonize it, windows service it
[2013-10-16 17:40:36 -0400] isafarnik: you can cron it
[2013-10-16 17:40:48 -0400] joelmoss: ok, so knife bootstrap doesn't setup the client as a daemon?
[2013-10-16 17:40:57 -0400] joelmoss: daemon sounds best to me
[2013-10-16 17:41:02 -0400] isafarnik: Not be default, no
[2013-10-16 17:41:35 -0400] isafarnik: The good news is that there is a config for the client, client.rb, which can manipulated via a cookbook: community.opscode.com/cookbooks/chef-client
[2013-10-16 17:41:51 -0400] joe_k: jeez
[2013-10-16 17:41:57 -0400] isafarnik: Use chef to manage your chef
[2013-10-16 17:42:11 -0400] joe_k: how do you get it to pull the new config if it's not already pulling?
[2013-10-16 17:42:18 -0400] bean__: by running chef-client
[2013-10-16 17:42:27 -0400] isafarnik: Use one of the methods above to run chef-client
[2013-10-16 17:43:43 -0400] joe_k: i think I am missing something. I am trying to get machines up in automation to do things like run tests.  I dont want to ever, ever touch or log into those machines by hand
[2013-10-16 17:43:45 -0400] joe_k: to run chef or anything else
[2013-10-16 17:44:02 -0400] joe_k: i need chef to be the thing that sets up everything, but if it doesn't run until I touch it, how is that supposed to work
[2013-10-16 17:44:46 -0400] isafarnik: I think you are missing something, you can set up chef-client to run automatically (and thus pickup changes) in a number of ways.
[2013-10-16 17:44:55 -0400] isafarnik: Many people just bake chef-client into their VMs/images
[2013-10-16 17:44:57 -0400] joe_k: "you can setup"
[2013-10-16 17:44:58 -0400] joe_k: = touching
[2013-10-16 17:45:30 -0400] joe_k: i have chef-client on the machine by virtue of ec2 bootstrapping
[2013-10-16 17:46:21 -0400] isafarnik: So using the chef-client cookbook might be the best way to configure the client to cron/run as a servive/daemonize that you would understand as "not touching"
[2013-10-16 17:47:23 -0400] joe_k: ok now I am really confused.
[2013-10-16 17:47:30 -0400] joe_k: the EC2 instance that's running is not listed by "node list"
[2013-10-16 17:47:43 -0400] joe_k: and the node that is listed by "node list" is not listed by "ec2 server list"
[2013-10-16 17:48:03 -0400] joe_k: (and isn't running on EC2)
[2013-10-16 17:48:17 -0400] joe_k: which like - wtf?
[2013-10-16 17:48:22 -0400] joe_k: its supposed to bring machines up and keep track of them
[2013-10-16 17:48:30 -0400] isafarnik: knife ec2 servee list needs --region
[2013-10-16 17:48:44 -0400] isafarnik: s/servee/server
[2013-10-16 17:49:39 -0400] isafarnik: the AWS API (of which knife is a client) defaults to us-east-1 
[2013-10-16 17:50:01 -0400] joe_k: thats the only region i've used
[2013-10-16 17:50:09 -0400] joe_k: and all instances were created by the same knife ec2
[2013-10-16 17:50:17 -0400] isafarnik: I usually keep "knife[:region] = 'us-west-2'
[2013-10-16 17:50:18 -0400] isafarnik: knife[:availability_zone] = 'us-west-2a'" in my knife.rb
[2013-10-16 17:50:20 -0400] joe_k: so unless the region default changes between runs, ????
[2013-10-16 17:50:46 -0400] joe_k: why would chef not keep the details about where the instance is, in its database?
[2013-10-16 17:50:53 -0400] joe_k: do i need to maintain that list separately?
[2013-10-16 17:51:47 -0400] joe_k: ec2 server list agrees with my aws web page
[2013-10-16 17:51:52 -0400] joe_k: its the "node list" that doesn't
[2013-10-16 17:52:00 -0400] joe_k: is a node and a server different concepts?
[2013-10-16 17:52:04 -0400] joe_k: s/is/are?
[2013-10-16 17:52:07 -0400] isafarnik: Indeed
[2013-10-16 17:52:27 -0400] isafarnik: a "node" is the information about a server, run_list/previous state/etc., saved as json on the chef server
[2013-10-16 17:52:41 -0400] isafarnik: a Chef "node" I should say
[2013-10-16 17:52:50 -0400] joe_k: and that's not created by ec2 plugin?
[2013-10-16 17:52:59 -0400] joe_k: when it creates a server?
[2013-10-16 17:53:17 -0400] isafarnik: It, but it isn't destroyed by knife ec2 server delete, unless you use the --purge flag (I think)
[2013-10-16 17:53:41 -0400] joe_k: that doesn't match what im seeing, which is that there is NO node record corresponding to the launched EC2 vm
[2013-10-16 17:53:45 -0400] isafarnik: Every managed chef machine has a Chef "node" and a Chef "client" created on the chef server the first time it checks in.
[2013-10-16 17:54:39 -0400] isafarnik: knife ec2 server create does ~4 things in one go, running chef-client on the newly created machine being the last
[2013-10-16 17:54:55 -0400] isafarnik: If it didn't complete successfully it may not have created the Chef "node" on the chef server
[2013-10-16 17:55:28 -0400] joe_k: that doesnt sound promising
[2013-10-16 17:55:34 -0400] joe_k: if it doesnt clean up failed attempts
[2013-10-16 17:56:52 -0400] isafarnik: If EC2 fails in the instance creation process, the node and client will never be created on the chef server.
[2013-10-16 17:57:01 -0400] isafarnik: Which it is won't to do.
[2013-10-16 17:58:08 -0400] joe_k: now knife node list is empty (i ran knife node delete NODE) and ec2 server list is empty (i ran knife ec2 server delete OTHERNODE)
[2013-10-16 17:58:29 -0400] joe_k: so i'll try again assuming I did something wrong, but I am pretty sure it lost track of the node
[2013-10-16 17:58:39 -0400] joe_k: it booted a node that it didnt have listed
[2013-10-16 17:58:48 -0400] joe_k: and had a node listed that it had destroyed on ec2
[2013-10-16 18:00:00 -0400] isafarnik: apart from knife ec2 server delete's --purge option (delete node & client on the chef server), there is also knife (node|client) bulk delete that takes regex
[2013-10-16 18:08:56 -0400] joe_k: how would i know if someone ran "knife" and my repo is now out of date? and then sync it with reality?
[2013-10-16 18:10:40 -0400] isafarnik: That information would come from git. It sounds like you are sharing a remote repo with someone else, so "git fetch" would tell you if your local repo is out of sync with the remote repo
[2013-10-16 18:11:01 -0400] joe_k: no i just learned above that "knife" commands mutate the server, not anyone's repo
[2013-10-16 18:11:50 -0400] joe_k: if someone had done that (added stuff to a run list with knife node run_list add x)
[2013-10-16 18:12:04 -0400] joe_k: then my repo (and github and everyone else's) would be out of date compared to the current server metadata
[2013-10-16 18:12:15 -0400] joe_k: its the web client.
[2013-10-16 18:12:32 -0400] isafarnik: Ah I see what you mean.
[2013-10-16 18:13:25 -0400] joe_k: i understand that maybe "people shouldn't do that".... but the instructions I read for "ec2" say just tag a -r on the end
[2013-10-16 18:13:33 -0400] joe_k: in that case there would be configuration on-server that is not in any repo
[2013-10-16 18:13:40 -0400] isafarnik: You'd want to see "knife node show" to see if it's different
[2013-10-16 18:14:05 -0400] isafarnik: Generally speaking, keeping a node's json in your chef-repo isn't done
[2013-10-16 18:14:10 -0400] joe_k: oh wait maybe those are roles and not run lists?
[2013-10-16 18:14:11 -0400] joe_k: hmm
[2013-10-16 18:14:54 -0400] isafarnik: You /can/ do it, but like you've discovered, if it changes on the server, your saved copy is no longer accurate 
[2013-10-16 18:15:01 -0400] joe_k: so, "how to configure" machines is kept in the repo but not "what is the current state"
[2013-10-16 18:15:27 -0400] isafarnik: the chef-repo is more meant for keeping cookbooks and for cookbook authorship.
[2013-10-16 18:15:29 -0400] isafarnik: right, exactly
[2013-10-16 18:15:30 -0400] joe_k: is there a way to declaratively describe "what the current state should be"
[2013-10-16 18:15:37 -0400] joe_k: ?
[2013-10-16 18:15:45 -0400] isafarnik: That's really what a cookbook/recipe does for you
[2013-10-16 18:15:48 -0400] joe_k: if i dont check it in
[2013-10-16 18:17:44 -0400] joe_k: it does what for me?
[2013-10-16 18:18:06 -0400] joe_k: it says how to achieve a state, not what states have been requested, esp. among multiple machines
[2013-10-16 18:18:44 -0400] joe_k: where do I check that part into version control? or is that outside of chef?
[2013-10-16 18:19:25 -0400] joe_k: ok, node coming up after 20 minutes :)
[2013-10-16 18:19:36 -0400] isafarnik: The chef server keeps track of cookbook versions on it's own
[2013-10-16 18:20:19 -0400] isafarnik: you don't have to check in your chef-repo if the only thing you are using it for is cookbook authorship, but the whole point of chef is to define your infrastructure as code, so why not take advantage of that by using code-revisioing.
[2013-10-16 18:20:36 -0400] joe_k: hmm, i see this on my console
[2013-10-16 18:20:37 -0400] joe_k: ec2-54-226-35-180.compute-1.amazonaws.com 'chef-client' is not recognized as an internal or external command, ec2-54-226-35-180.compute-1.amazonaws.com operable program or batch file.
[2013-10-16 18:21:05 -0400] joe_k: isafarnik: i agree with that vision but I dont see where to keep that code in the chef repo
[2013-10-16 18:21:08 -0400] isafarnik: Is this a windows instance on EC2?
[2013-10-16 18:21:22 -0400] joe_k: you can define "cookbooks" but not "what my infrastructure should be"
[2013-10-16 18:21:25 -0400] joe_k: isafarnik: yes
[2013-10-16 18:21:45 -0400] isafarnik: And is it running an ssh server?
[2013-10-16 18:21:53 -0400] joe_k: why would it be?
[2013-10-16 18:21:59 -0400] joe_k: its a windows machine bootstrapped with winrm
[2013-10-16 18:22:05 -0400] isafarnik: Ah okay
[2013-10-16 18:22:10 -0400] isafarnik: Have you installed knife-windows?
[2013-10-16 18:22:11 -0400] joe_k: using stock amis - windows doesnt have ssh
[2013-10-16 18:22:27 -0400] isafarnik: https://github.com/opscode/knife-windows
[2013-10-16 18:22:27 -0400] joe_k: goddamnit. so now the new EC2 node is _NOT_ in node list
[2013-10-16 18:22:40 -0400] joe_k: isafarnik: yes, i have knife-windows on my workstation
[2013-10-16 18:23:27 -0400] joe_k: ec2 server create finished with a status messaged that looked ok, summarizing the node information
[2013-10-16 18:23:36 -0400] joe_k: but now "knife node list" shows no nodes
[2013-10-16 18:23:53 -0400] isafarnik: ec2-54-226-35-180.compute-1.amazonaws.com 'chef-client' is not recognized as an internal or external command, ec2-54-226-35-180.compute-1.amazonaws.com operable program or batch file.makes me think the chef-client run didn't compelte
[2013-10-16 18:24:07 -0400] isafarnik: so the node would not have registered itself with the chef server.
[2013-10-16 18:24:11 -0400] joe_k: but after that i see 
[2013-10-16 18:24:13 -0400] joe_k: ec2-54-226-35-180.compute-1.amazonaws.com C:\Users\v1deploy>chef-client -c c:/chef/client.rb -j c:/chef/first-boot.json -E _default
[2013-10-16 18:24:18 -0400] joe_k: and then the summary output
[2013-10-16 18:24:44 -0400] isafarnik: huh
[2013-10-16 18:24:48 -0400] isafarnik: sounds wonky
[2013-10-16 18:24:49 -0400] joe_k: so in other words - the tools dont work for windows. Chef cannot bootstrap a windows node on its own.  I wish people would just say that instead of pretending
[2013-10-16 18:26:07 -0400] isafarnik: What isn't working here is using "knife ec2" to bootstrap a windows node via winrm
[2013-10-16 18:26:32 -0400] isafarnik: After the initial knife ec2 server create command, can you use 
[2013-10-16 18:26:40 -0400] joe_k: i guess so
[2013-10-16 18:26:41 -0400] isafarnik: "knife bootstrap windows winrm ec2-50-xx-xx-124.compute-1.amazonaws.com -r 'role[webserver],role[production]' -x Administrator -P 'super_secret_password'" kind syntax?
[2013-10-16 18:26:44 -0400] joe_k: goddamnit. i thought i had it solved.
[2013-10-16 18:26:59 -0400] isafarnik: I'm looking into if knife ec2 does winrm bootstrapping
[2013-10-16 18:27:12 -0400] joe_k: it sure tries
[2013-10-16 18:27:22 -0400] joe_k: but things like getting the chef client msi onto the host and running it are failing
[2013-10-16 18:27:25 -0400] isafarnik: heh, plucky little knife-ec2
[2013-10-16 18:27:27 -0400] joe_k: i have log output
[2013-10-16 18:28:22 -0400] joe_k: bootstrap command: http://pastebin.com/Txu1fdme
[2013-10-16 18:30:28 -0400] joe_k: the ps1 file that runs at first boot http://pastebin.com/xKJvxyU8
[2013-10-16 18:30:41 -0400] isafarnik: Hmm it sounds like that bootstrapping an ec2 windows instance works in the upcoming version of the knife-ec2 gem
[2013-10-16 18:30:44 -0400] isafarnik: += via winrm
[2013-10-16 18:30:54 -0400] joe_k: I am using the github version
[2013-10-16 18:31:07 -0400] joe_k: gemfile sez
[2013-10-16 18:31:07 -0400] joe_k:  gem 'knife-ec2', {git: "https://github.com/opscode/knife-ec2.git"}
[2013-10-16 18:33:21 -0400] isafarnik: huh
[2013-10-16 18:33:35 -0400] isafarnik: That sounds like it might be worthy of a ticket
[2013-10-16 18:33:48 -0400] joe_k: i dont see a way to open an issue on github
[2013-10-16 18:34:00 -0400] isafarnik: They live on tickets.opscode.com
[2013-10-16 18:34:08 -0400] isafarnik: You can use your hosted creeds to login there.
[2013-10-16 18:34:17 -0400] isafarnik: s/creeds/creds
[2013-10-16 18:34:48 -0400] joe_k: i wonder if its possible to get the author in here
[2013-10-16 18:35:05 -0400] joe_k: to understand if its even supposed to work
[2013-10-16 18:35:54 -0400] isafarnik: I think he's preoccupied
[2013-10-16 18:36:19 -0400] isafarnik: But that all looks like...
[2013-10-16 18:36:33 -0400] isafarnik: Have you looked at uploading user-data using knife ec2 ?
[2013-10-16 18:37:02 -0400] joe_k: ec2-54-226-35-180.compute-1.amazonaws.com C:\Users\v1deploy>cscript /nologo C:\chef\wget.vbs /url:"https://www.opscode.com/chef/download?p=windows&pv=2012&m=x86_64" /path:"C:\Users\v1deploy\AppData\Local\Temp\chef-client-latest.msi" ec2-54-226-35-180.compute-1.amazonaws.com C:\chef\wget.vbs(34, 1) Provider: Not enough storage is available to complete this operation.
[2013-10-16 18:37:22 -0400] joe_k: isafarnik: that is what i'm doing. see pastebin above
[2013-10-16 18:37:48 -0400] joe_k: i know of some better methods he can use for that
[2013-10-16 18:37:59 -0400] joe_k: like powershell invoke-restmethod
[2013-10-16 18:38:34 -0400] isafarnik: That would be great to put in the ticket
[2013-10-16 18:38:43 -0400] isafarnik: I think that's the best way to get the author's eyes on it right now
[2013-10-16 18:39:36 -0400] joe_k: ugh i just want to start using something
[2013-10-16 18:40:08 -0400] joe_k: my goal is not to get chef running, its to get automated test instances up
[2013-10-16 18:40:24 -0400] isafarnik: Automated windows instances I take it.
[2013-10-16 18:40:31 -0400] joe_k: yes
[2013-10-16 18:40:54 -0400] joe_k: i turned to chef to do provisioning because I can do the configuration once its up with chocolatey
[2013-10-16 18:41:02 -0400] isafarnik: What version of windows is the AMI?
[2013-10-16 18:41:06 -0400] joe_k: 2012
[2013-10-16 18:41:37 -0400] joe_k: i dont need chef to configure machines that have already been mostly configured
[2013-10-16 18:42:06 -0400] joe_k: so i am back to amazon cloudformation (which CAN describe a multi-machine infrastructure) and chocolatey
[2013-10-16 18:42:15 -0400] joe_k: making chef work is just extra steps
[2013-10-16 18:42:19 -0400] isafarnik: 2. If he's running on win2k12, there's a bug that will make that fail
[2013-10-16 18:42:19 -0400] isafarnik: it will ignore the maxmemorypershellmb
[2013-10-16 18:42:20 -0400] isafarnik: See https://tickets.opscode.com/browse/KNIFE-208
[2013-10-16 18:42:22 -0400] isafarnik: it is fixed with knife-windows
[2013-10-16 18:42:22 -0400] isafarnik: which uses an alternate download mechanism
[2013-10-16 18:43:11 -0400] joe_k: it was resolved 9 months ago and its still not shipped?
[2013-10-16 18:43:32 -0400] isafarnik: it shipped with knife-windows
[2013-10-16 18:45:06 -0400] joe_k: JKOBERG1 ~/devops/chef-repo $ bundle list | grep knife   * knife-azure (1.1.2)   * knife-ec2 (0.6.4 4eb91eb)   * knife-windows (0.5.12)
[2013-10-16 18:45:31 -0400] joe_k: must not have
[2013-10-16 18:47:08 -0400] joe_k_: dang wifi switch
[2013-10-16 18:47:22 -0400] isafarnik: wb
[2013-10-16 18:48:12 -0400] isafarnik: Well, if you can take the time, this would be a good ticket.
[2013-10-16 18:48:43 -0400] isafarnik: It sounds like there's suppose to be a retry of the mdi installer download happening with powershell that doesn't seem to be working for you
[2013-10-16 18:49:56 -0400] joe_k_: fyi my hosted chef creds do NOT work on the ticket site
[2013-10-16 18:51:04 -0400] isafarnik: :(
[2013-10-16 19:03:18 -0400] joe_k_: https://tickets.opscode.com/browse/KNIFE-391 created
[2013-10-16 19:11:40 -0400] joe_k_: seems like there are a bunch of tickets for related things, many closed. I dont know if this is supposed to have been fixed or not
[2013-10-16 19:47:23 -0400] joe_k_: guess i'll try again another day. thanks.
[2013-10-16 20:27:45 -0400] vt102: Is it possible to have two data bags with the same name somehow?
[2013-10-16 20:32:40 -0400] mmzyk: not sure vt102 - I don't think so, but ask in #chef.
