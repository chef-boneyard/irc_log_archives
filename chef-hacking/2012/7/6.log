[2012-07-06 19:00:32 -0400] justNeph: Hello, I got a bit of a problem if anyone has a minute to help
[2012-07-06 19:00:35 -0400] justNeph: ArgumentError: Unable to create Chef::RunList::RunListItem from String:"role[base],role[prod_base],role[mysql],role[mysql_slave]": must be recipe[] or role[]. I'm doing this programmatically by setting a new Chef::Knife::Bootstrap attribute like this : kb.config[:run_list]        = options[:roles]
[2012-07-06 19:00:55 -0400] justNeph: Any ideas where I might be going wrong?
[2012-07-06 19:02:12 -0400] ampledata: what does options[:role] look like?
[2012-07-06 19:02:20 -0400] ampledata: i'm guessing you'll want to use a list instead of a string there
[2012-07-06 19:02:27 -0400] justNeph: 'role[base],role[prod_base],role[mysql],role[mysql_slave]'
[2012-07-06 19:02:32 -0400] ampledata: ["role[base]",]
[2012-07-06 19:02:40 -0400] c_t: ^ what he said
[2012-07-06 19:02:41 -0400] ampledata: instead of "role[base],"
[2012-07-06 19:02:51 -0400] justNeph: ah Let me try that
[2012-07-06 19:07:26 -0400] hoover_damm: neat
[2012-07-06 19:07:28 -0400] hoover_damm: he double asked
[2012-07-06 19:07:32 -0400] hoover_damm: so I answered what was answered
[2012-07-06 19:07:33 -0400] hoover_damm: damn
[2012-07-06 19:07:50 -0400] justNeph: hm that seemed to work but I think environment isn't getting set properly. I'm setting it like this: Chef::Config[:environment]  = options[:environment] there error returned is: HTTP Request Returned 500 Internal Server Error: undefined method `cookbook_versions' for nil:NilClass
[2012-07-06 19:08:11 -0400] justNeph: hoover_damm: My apologies. I didn't see anyone speaking in there so that's why I tried here. Sorry :(
[2012-07-06 19:09:05 -0400] justNeph: The line after that error is ERROR: Server returned error for http://SERVER_INFO/environments/_default/cookbook_versions, retrying 1/5 in 3s
[2012-07-06 19:09:28 -0400] justNeph: but it says _default which makes me think the environment isn't getting set properly
[2012-07-06 19:10:45 -0400] hoover_damm: if it says _default then correct
[2012-07-06 19:10:49 -0400] hoover_damm: your environment isn't being honored
[2012-07-06 19:11:08 -0400] justNeph: What could be the cause of it not being honored?
[2012-07-06 19:11:11 -0400] hoover_damm: justNeph, eh everyone does it.  Usually people just ignore people who cross-post their questions
[2012-07-06 19:11:54 -0400] hoover_damm: justNeph, not everyone follows that but you'll find it occoasionally.  Not trying to be mean just give you a heads up
[2012-07-06 19:12:03 -0400] hoover_damm: in the future it's better to wait :)
[2012-07-06 19:12:11 -0400] hoover_damm: then get ignored
[2012-07-06 19:12:21 -0400] justNeph: hoover_damm: haha My apologies again. Next time I'll wait :)
[2012-07-06 19:12:32 -0400] hoover_damm: justNeph, so are you doing this in knife exec?
[2012-07-06 19:12:46 -0400] hoover_damm: justNeph, I guess we need more context of what's going on to help further
[2012-07-06 19:13:32 -0400] justNeph: I'm doing it programmatically. Sure thing. I'll pastebin my snippet
[2012-07-06 19:14:27 -0400] justNeph: http://pastebin.com/2thtzKUq
[2012-07-06 19:15:16 -0400] hoover_damm: Chef::Config[:environment]  = options[:environment]
[2012-07-06 19:15:17 -0400] justNeph: and so the environment I'm passing it is just something like "prod"
[2012-07-06 19:15:33 -0400] hoover_damm: fwiw it's chef_environment
[2012-07-06 19:15:35 -0400] hoover_damm: not environment
[2012-07-06 19:15:37 -0400] justNeph: when I manually edit the node via knife node edit
[2012-07-06 19:15:39 -0400] hoover_damm: if your trying to set the environment
[2012-07-06 19:15:42 -0400] justNeph: yea
[2012-07-06 19:15:53 -0400] justNeph: do I do it under Chef::Config
[2012-07-06 19:15:58 -0400] hoover_damm: I really don't understand your bootstrap script here.  This could all be done under a regular knife bootstrap
[2012-07-06 19:16:23 -0400] hoover_damm: knife bootstrap server -x ubuntu --template-file ..
[2012-07-06 19:16:26 -0400] justNeph: Well the reason we were doing originally is because when I ran the corresponding knife bootstrap
[2012-07-06 19:16:33 -0400] justNeph: the environment and roles weren't getting set
[2012-07-06 19:16:45 -0400] hoover_damm: sounds like you modified your bootstrap template
[2012-07-06 19:17:03 -0400] hoover_damm: if you modify the bootstrap template it's pretty easy to take out the 'environment' code without realizing
[2012-07-06 19:17:15 -0400] hoover_damm: why don't you post your bootstrap up? (pastebin or whatever)
[2012-07-06 19:21:07 -0400] justNeph: http://pastebin.com/F5Rf7pYn
[2012-07-06 19:31:26 -0400] hoover_damm: yep
[2012-07-06 19:31:30 -0400] hoover_damm: line 46
[2012-07-06 19:31:35 -0400] hoover_damm: you need <% start_chef -%>
[2012-07-06 19:31:38 -0400] hoover_damm: not hardcode the path
[2012-07-06 19:31:42 -0400] hoover_damm: you broke environments
[2012-07-06 19:31:52 -0400] hoover_damm: if you need to specify a different path to where the chef-client binary is there's a way to do that now
[2012-07-06 19:32:32 -0400] hoover_damm: justNeph, just configure config[:chef_client_path]
[2012-07-06 19:32:46 -0400] hoover_damm: review def start_chef 's source code
[2012-07-06 19:35:37 -0400] hoover_damm: justNeph, https://github.com/opscode/chef/blob/9c0b8cf05505143b14369e32271fcb09023beed4/chef/lib/chef/knife/core/bootstrap_context.rb#L82
[2012-07-06 19:36:07 -0400] justNeph: Hm ok, Let me try that
[2012-07-06 19:36:23 -0400] hoover_damm: basically you shouldn't have to use a different template
[2012-07-06 19:36:34 -0400] hoover_damm: you should be able to use the stock ubuntu gems template and then point to the proper path for the chef-client
[2012-07-06 21:55:19 -0400] justNeph: Hey again, so say I wanted to just do the bootstrap programmatically, after fixing the template, it still seems to have an issue applying the environment
[2012-07-06 21:55:25 -0400] justNeph: I changed it to :chef_environment
[2012-07-06 21:55:27 -0400] justNeph: but no god
[2012-07-06 21:55:28 -0400] justNeph: good
[2012-07-06 21:58:48 -0400] hoover_damm: are you still not using <% start_chef ~%>?
[2012-07-06 22:00:18 -0400] justNeph: I had changed it to <%= start_chef %> and when I had run knife it had worked, the problem is when running that through ruby the output is suppressed
[2012-07-06 22:01:00 -0400] justNeph: When I run it using Chef::Knife::Bootstrap the output is shown but the environment isn't getting set
[2012-07-06 22:01:42 -0400] hoover_damm: it's <% start_chef %>
[2012-07-06 22:01:43 -0400] hoover_damm: not =
[2012-07-06 22:06:06 -0400] justNeph: I changed it but still no go
[2012-07-06 22:06:24 -0400] justNeph: when I knife node show instance_name
[2012-07-06 22:06:32 -0400] justNeph: it only has one field filled out
[2012-07-06 22:06:39 -0400] justNeph: and that's the environment of "_default"
[2012-07-06 22:08:12 -0400] hoover_damm: basically the problem is your running chef-client without -E <name>
[2012-07-06 22:08:18 -0400] hoover_damm: and start_chef automates that
[2012-07-06 22:08:38 -0400] hoover_damm: most common problem of bootstraps because the path is different
[2012-07-06 22:08:48 -0400] hoover_damm: :( horrible reason to make a custom bootstrap
[2012-07-06 22:09:02 -0400] hoover_damm: and if you want to modify loglevels and such look into the other bootstrap constants
[2012-07-06 22:09:14 -0400] hoover_damm: less tedious then your own bootstrap file
[2012-07-06 22:09:24 -0400] justNeph: Well this was kinda thrown onto me, so I'm working with what I was given haha
[2012-07-06 22:11:52 -0400] justNeph: is there a way to simulate the -e command?
[2012-07-06 22:12:09 -0400] justNeph:  i thought setting the config[:chef_environment] did that
[2012-07-06 22:13:36 -0400] justNeph: so does run on a Chef::Knife::Bootstrap not actually simulate running the command?
[2012-07-06 22:34:23 -0400] justNeph: Sorry, lost connection
[2012-07-06 22:42:17 -0400] github-bawt: [chef] danielsdeleo pushed 3 new commits to master: http://git.io/Jurjiw
[2012-07-06 22:42:17 -0400] github-bawt: [chef/master] Moved notification storage to the run_context to fix subscribes - aschlaep
[2012-07-06 22:42:17 -0400] github-bawt: [chef/master] move misplace error reporting code. - Daniel DeLeo
[2012-07-06 22:42:17 -0400] github-bawt: [chef/master] Merge branch 'CHEF-1994' - Daniel DeLeo
[2012-07-06 23:55:26 -0400] fujin: Cope: around
