[2012-11-26 15:58:24 -0500] odyssey4me: g'day all
[2012-11-26 15:59:47 -0500] odyssey4me: anyone around? I need a spot of help with the essex swift recipe from rcbops
[2012-11-26 17:04:03 -0500] galstrom: odyssey4me: what kind of issue are you seeing
[2012-11-26 17:12:10 -0500] odyssey4me: SyntaxError - swift_mounts[/srv/node] (swift::disks line 37) had an error: SyntaxError: (eval):1:in `class_from_file': compile error
[2012-11-26 17:12:31 -0500] odyssey4me: (eval):1: syntax error, unexpected tIDENTIFIER, expecting $end
[2012-11-26 17:12:43 -0500] odyssey4me: ...ft"]["state"]["devs"]=4735a22b-88aa-4898-a86e-847d9db1bf55mo...
[2012-11-26 17:13:33 -0500] rackerjoe: odyssey4me: what version of chef-client are you running?
[2012-11-26 17:15:58 -0500] odyssey4me: Chef: 10.16.2
[2012-11-26 17:16:50 -0500] odyssey4me: On Ubuntu precise (12.04.1 LTS)
[2012-11-26 17:17:34 -0500] odyssey4me: I put more detail in the forum - essentially I'm at a brick wall unless I can understand what the purpose of a piece of the code is.
[2012-11-26 17:18:05 -0500] odyssey4me: more specifically, the last few lines in the mounts provider
[2012-11-26 17:19:27 -0500] rackerjoe: Can you pastebin more of the stack trace?
[2012-11-26 17:20:07 -0500] odyssey4me: sure, gimme a few mins
[2012-11-26 17:25:08 -0500] odyssey4me: the stacktrace: http://pastebin.com/7GsS66xt
[2012-11-26 17:29:12 -0500] rackerjoe: the last code block is pushing the status of the new disk to the node attribute AFAIK.  Not sure why you are getting an error there.
[2012-11-26 17:29:38 -0500] odyssey4me: as an aside, is there a way to make the logger output variables in a structure?
[2012-11-26 17:30:12 -0500] rackerjoe: You can throw a Chef::Log.info in there..
[2012-11-26 17:30:35 -0500] odyssey4me: I did, and foo is a very large block of text
[2012-11-26 17:30:52 -0500] rackerjoe: can you drop the full line here?
[2012-11-26 17:31:08 -0500] odyssey4me: I have the feeling it's a structured block. Is there a way to make Chef::Log output a variable/array with more structure?
[2012-11-26 17:31:37 -0500] odyssey4me: [Mon, 26 Nov 2012 19:09:43 +0200] INFO: Foo Content: node.set["swift"]["state"]["devs"]=a81df61d-15fa-4e1b-b78c-1740a7346de6size2861020mountpointa81df61d15fa4e1bb78c1740a7346de6mountedtrueip10.12.12.206uuida81df61d-15fa-4e1b-b78c-1740a7346de6devicesdk1974ff817-929f-4b39-8352-dfb3aed56068size2861020mountpoint974ff817929f4b398352dfb3aed56068mountedtrueip10.12.12.206uuid974ff817-929f-4b39-8352-dfb3aed56068devicesdj1aa126ccc-
[2012-11-26 17:31:54 -0500] odyssey4me: it's more than that, but the limit of this irc client's line input is reached
[2012-11-26 17:34:25 -0500] odyssey4me: The complete line: http://pastebin.com/mRrB9EAE
[2012-11-26 17:35:08 -0500] rackerjoe: thanks.  not related - but how many disks do you have in the box?
[2012-11-26 17:35:55 -0500] odyssey4me: 1 for OS, 12 for object storage
[2012-11-26 17:36:09 -0500] rackerjoe: ok - thanks.
[2012-11-26 17:36:40 -0500] odyssey4me:   /dev/sdb -> /dev/sdm
[2012-11-26 17:39:13 -0500] rackerjoe: one last question - are you using hosted chef or the open source chef server?
[2012-11-26 17:39:24 -0500] odyssey4me: open source chef server
[2012-11-26 17:39:35 -0500] rackerjoe: ok - thanks.  I'll try and duplicate it
[2012-11-26 17:40:13 -0500] odyssey4me: it would perhaps help if I knew what it was trying to build - do you have a sample node attribute structure?
[2012-11-26 17:40:23 -0500] odyssey4me: thanks, I really appreciate the time and effort
[2012-11-26 17:45:44 -0500] galstrom: odyssey4me: here is what it is trying to build.. http://pastebin.com/6kn8Mfii
[2012-11-26 17:45:49 -0500] galstrom: that is a snip from one of my nodes
[2012-11-26 17:47:29 -0500] odyssey4me: thanks galstrom
[2012-11-26 17:47:51 -0500] galstrom: np
[2012-11-26 17:48:07 -0500] galstrom: it is missing a couple of keys.. but it has the section you are seeing issues with
[2012-11-26 17:49:02 -0500] odyssey4me: that's in json format - what I'm seeing in the log output is a glob of info that may be structured... is there a way for me to log or output the dev_info array into a structure ?
[2012-11-26 17:51:08 -0500] galstrom: Chef::Log.info("#{PP.pp(foo)}")
[2012-11-26 17:51:10 -0500] galstrom: that should work
[2012-11-26 17:51:15 -0500] galstrom: bit dirty..
[2012-11-26 17:52:21 -0500] odyssey4me: hopefully that's a little better than Chef::Log.info("Breakdown: " + dev_info.inspect)
[2012-11-26 17:55:59 -0500] odyssey4me: lol, I guess not: INFO: Foo Content: #<IO:0x7f5a69ddbad8>
[2012-11-26 17:56:05 -0500] galstrom: hm..
[2012-11-26 17:57:40 -0500] galstrom: might have to look at the collector
[2012-11-26 17:58:33 -0500] galstrom: Chef::Log.info("#{PP.pp(dev_info)}")
[2012-11-26 18:01:38 -0500] odyssey4me: thanks, although that outputs exactly like .inspect
[2012-11-26 18:02:46 -0500] odyssey4me: here's the first one: http://pastebin.com/eRcbD8tF
[2012-11-26 18:03:44 -0500] odyssey4me: I see, comparing it to your example, that it's missing the 'format', and the device doesn't have the '/dev/ prepended
[2012-11-26 18:11:56 -0500] odyssey4me: ah, format was added in a later cookbook - providing the option of xfs or ext4
[2012-11-26 18:12:09 -0500] odyssey4me: it's not relevant for this version of the cookbook (v1.0)
[2012-11-26 18:15:54 -0500] odyssey4me: (v1.0.0 actually)
[2012-11-26 18:21:04 -0500] odyssey4me: The array is well formed, so there goes that idea: http://pastebin.com/upZgvxRP
[2012-11-26 18:26:24 -0500] galstrom: odyssey4me: actually the /dev bit was a typo.. it was actually sdb1 and sdc1 on mine (without /dev/)
[2012-11-26 18:26:54 -0500] odyssey4me: ah, ok thanks
[2012-11-26 18:27:00 -0500] galstrom: odyssey4me: also what branch did you clone of the rcbops cookbooks?
[2012-11-26 18:27:03 -0500] odyssey4me: I'm just working through the updates in code since the version I have
[2012-11-26 18:27:25 -0500] odyssey4me: I see this version is much easier for me to grasp: https://github.com/rcbops-cookbooks/swift/blob/452577a1d60a964c6da4ef441c762eaf23a35a32/recipes/disks.rb
[2012-11-26 18:27:31 -0500] galstrom: cause v1.0.0 is really old
[2012-11-26 18:28:21 -0500] galstrom: like before june or so
[2012-11-26 18:28:50 -0500] galstrom: odyssey4me: short answer is that you probably have to upgrade cookbooks
[2012-11-26 18:29:56 -0500] odyssey4me: yeah, I tried that some time ago - the problem is that we haven't use chef to deploy most of the infrastructure... and the newer cookbooks don't fall back to a node/environment config like the older ones
[2012-11-26 18:30:12 -0500] odyssey4me: the newer recipes prefer to just use role searches
[2012-11-26 18:30:26 -0500] odyssey4me: and the code's a little harder for me to grasp, being a ruby noob ;)
[2012-11-26 18:31:50 -0500] odyssey4me: until I have more confidence in ruby, chef and openstack altogether I'd like to keep the code I work with simpler to understand if possible
[2012-11-26 18:32:36 -0500] galstrom: i can understand that.. but the swift stuff is fairly complecated to begin with.. I am not sure the cookbook version you have is actually stable or not..
[2012-11-26 18:32:43 -0500] odyssey4me: right now I'm thinking of doing a quick loop in the recipe to publish each device in turn, similar to the older version of the code
[2012-11-26 18:33:18 -0500] odyssey4me: one thing I could do is back this cookbook up, the update only this one, then try that
[2012-11-26 18:33:35 -0500] odyssey4me: let me try that quickly
[2012-11-26 18:52:37 -0500] odyssey4me: so much for quick
[2012-11-26 18:53:37 -0500] odyssey4me: with the changed way of working, there are other missing bits of metadata which I have to debug and resolve... I've been doing that a lot lately
[2012-11-26 19:43:54 -0500] odyssey4me: this seems to have worked perfectly in its place:
[2012-11-26 19:43:56 -0500] odyssey4me:     dev_info.each do |k,v|
[2012-11-26 19:44:47 -0500] odyssey4me: http://pastebin.com/iJSB1gMG
[2012-11-26 19:57:01 -0500] odyssey4me: thanks to you all for the help - hopefully we can bring our deployment up to the later cookbook versions soon-ish... we just need to be able to adjust some of the recipes to cater for HA
[2012-11-26 19:58:09 -0500] odyssey4me: time for me to head home - it's 10pm :p
[2012-11-26 19:58:11 -0500] odyssey4me: g'night
